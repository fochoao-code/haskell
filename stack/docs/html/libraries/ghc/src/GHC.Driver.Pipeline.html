<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP, NamedFieldPuns, NondecreasingIndentation, BangPatterns, MultiWayIf #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-incomplete-uni-patterns #-}</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-7"></span><span class="hs-comment">--</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- GHC Driver</span><span>
</span><span id="line-9"></span><span class="hs-comment">--</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- (c) The University of Glasgow 2005</span><span>
</span><span id="line-11"></span><span class="hs-comment">--</span><span>
</span><span id="line-12"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">GHC.Driver.Pipeline</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-15"></span><span>        </span><span class="hs-comment">-- Run a series of compilation steps in a pipeline, for a</span><span>
</span><span id="line-16"></span><span>        </span><span class="hs-comment">-- collection of source files.</span><span>
</span><span id="line-17"></span><span>   </span><span class="annot"><a href="GHC.Driver.Pipeline.html#oneShot"><span class="hs-identifier">oneShot</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.html#compileFile"><span class="hs-identifier">compileFile</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>
</span><span id="line-19"></span><span>        </span><span class="hs-comment">-- Interfaces for the batch-mode driver</span><span>
</span><span id="line-20"></span><span>   </span><span class="annot"><a href="GHC.Driver.Pipeline.html#linkBinary"><span class="hs-identifier">linkBinary</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span>        </span><span class="hs-comment">-- Interfaces for the compilation manager (interpreted/batch-mode)</span><span>
</span><span id="line-23"></span><span>   </span><span class="annot"><a href="GHC.Driver.Pipeline.html#preprocess"><span class="hs-identifier">preprocess</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>   </span><span class="annot"><a href="GHC.Driver.Pipeline.html#compileOne"><span class="hs-identifier">compileOne</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.html#compileOne%27"><span class="hs-identifier">compileOne'</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>   </span><span class="annot"><a href="GHC.Driver.Pipeline.html#link"><span class="hs-identifier">link</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>
</span><span id="line-27"></span><span>        </span><span class="hs-comment">-- Exports for hooks to override runPhase and link</span><span>
</span><span id="line-28"></span><span>   </span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#PhasePlus"><span class="hs-identifier">PhasePlus</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#CompPipeline"><span class="hs-identifier">CompPipeline</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#PipeEnv"><span class="hs-identifier">PipeEnv</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#PipeState"><span class="hs-identifier">PipeState</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>   </span><span class="annot"><a href="GHC.Driver.Pipeline.html#phaseOutputFilename"><span class="hs-identifier">phaseOutputFilename</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.html#getOutputFilename"><span class="hs-identifier">getOutputFilename</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#getPipeState"><span class="hs-identifier">getPipeState</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#getPipeEnv"><span class="hs-identifier">getPipeEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>   </span><span class="annot"><a href="GHC.Driver.Pipeline.html#hscPostBackendPhase"><span class="hs-identifier">hscPostBackendPhase</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.html#getLocation"><span class="hs-identifier">getLocation</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#setModLocation"><span class="hs-identifier">setModLocation</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#setDynFlags"><span class="hs-identifier">setDynFlags</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>   </span><span class="annot"><a href="GHC.Driver.Pipeline.html#runPhase"><span class="hs-identifier">runPhase</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.html#exeFileName"><span class="hs-identifier">exeFileName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>   </span><span class="annot"><a href="GHC.Driver.Pipeline.html#maybeCreateManifest"><span class="hs-identifier">maybeCreateManifest</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>   </span><span class="annot"><a href="GHC.Driver.Pipeline.html#doCpp"><span class="hs-identifier">doCpp</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>   </span><span class="annot"><a href="GHC.Driver.Pipeline.html#linkingNeeded"><span class="hs-identifier">linkingNeeded</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.SysTools.ExtraObj.html#checkLinkInfo"><span class="hs-identifier">checkLinkInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.html#writeInterfaceOnlyMode"><span class="hs-identifier">writeInterfaceOnlyMode</span></a></span><span>
</span><span id="line-35"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span class="hs-cpp">

#include &lt;ghcplatform.h&gt;
</span><span class="hs-cpp">#include &quot;HsVersions.h&quot;
</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html"><span class="hs-identifier">GHC.Driver.Pipeline.Monad</span></a></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.State.html"><span class="hs-identifier">GHC.Unit.State</span></a></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Ways.html"><span class="hs-identifier">GHC.Driver.Ways</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Parser.Header.html"><span class="hs-identifier">GHC.Parser.Header</span></a></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Phases.html"><span class="hs-identifier">GHC.Driver.Phases</span></a></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.SysTools.html"><span class="hs-identifier">GHC.SysTools</span></a></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.SysTools.ExtraObj.html"><span class="hs-identifier">GHC.SysTools.ExtraObj</span></a></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html"><span class="hs-identifier">GHC.Driver.Main</span></a></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Finder.html"><span class="hs-identifier">GHC.Driver.Finder</span></a></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html"><span class="hs-identifier">GHC.Driver.Types</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#Hsc"><span class="hs-identifier">Hsc</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.html"><span class="hs-identifier">GHC.Unit.Module</span></a></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html"><span class="hs-identifier">GHC.Utils.Error</span></a></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html"><span class="hs-identifier">GHC.Driver.Session</span></a></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.StringBuffer.html"><span class="hs-identifier">GHC.Data.StringBuffer</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Data.StringBuffer.html#hGetStringBuffer"><span class="hs-identifier">hGetStringBuffer</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Data.StringBuffer.html#hPutStringBuffer"><span class="hs-identifier">hPutStringBuffer</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html"><span class="hs-identifier">GHC.Types.Basic</span></a></span><span>       </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#SuccessFlag"><span class="hs-identifier">SuccessFlag</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html"><span class="hs-identifier">GHC.Data.Maybe</span></a></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html#expectJust"><span class="hs-identifier">expectJust</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html"><span class="hs-identifier">GHC.Types.SrcLoc</span></a></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.CmmToLlvm.html"><span class="hs-identifier">GHC.CmmToLlvm</span></a></span><span>         </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.CmmToLlvm.Mangler.html#llvmFixupAsm"><span class="hs-identifier">llvmFixupAsm</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CmmToLlvm.Base.html#llvmVersionList"><span class="hs-identifier">llvmVersionList</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Monad.html"><span class="hs-identifier">GHC.Utils.Monad</span></a></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../ghc-boot/src/GHC.Platform.html#"><span class="hs-identifier">GHC.Platform</span></a></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html"><span class="hs-identifier">GHC.Tc.Types</span></a></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Hooks.html"><span class="hs-identifier">GHC.Driver.Hooks</span></a></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../ghc-boot/src/GHC.LanguageExtensions.html#"><span class="hs-identifier">GHC.LanguageExtensions</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LangExt</span></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.SysTools.FileCleanup.html"><span class="hs-identifier">GHC.SysTools.FileCleanup</span></a></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.SysTools.Ar.html"><span class="hs-identifier">GHC.SysTools.Ar</span></a></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Settings.html"><span class="hs-identifier">GHC.Settings</span></a></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html"><span class="hs-identifier">GHC.Data.Bag</span></a></span><span>             </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html#unitBag"><span class="hs-identifier">unitBag</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html"><span class="hs-identifier">GHC.Data.FastString</span></a></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#mkFastString"><span class="hs-identifier">mkFastString</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Iface.Make.html"><span class="hs-identifier">GHC.Iface.Make</span></a></span><span>           </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Iface.Make.html#mkFullIface"><span class="hs-identifier">mkFullIface</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-74"></span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Exception.html"><span class="hs-identifier">GHC.Utils.Exception</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Exception</span></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../directory/src/System.Directory.html#"><span class="hs-identifier">System.Directory</span></a></span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../filepath/src/System.FilePath.html#"><span class="hs-identifier">System.FilePath</span></a></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base/src/System.IO.html#"><span class="hs-identifier">System.IO</span></a></span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base/src/Control.Monad.html#"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../exceptions/src/Control.Monad.Catch.html#"><span class="hs-identifier">Control.Monad.Catch</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">MC</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../exceptions/src/Control.Monad.Catch.html#handle"><span class="hs-identifier">handle</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base/src/Data.List.html#"><span class="hs-identifier">Data.List</span></a></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../base/src/Data.OldList.html#isInfixOf"><span class="hs-identifier">isInfixOf</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base/src/Data.OldList.html#intercalate"><span class="hs-identifier">intercalate</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base/src/Data.Maybe.html#"><span class="hs-identifier">Data.Maybe</span></a></span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base/src/Data.Version.html#"><span class="hs-identifier">Data.Version</span></a></span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base/src/Data.Either.html#"><span class="hs-identifier">Data.Either</span></a></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../base/src/Data.Either.html#partitionEithers"><span class="hs-identifier">partitionEithers</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-85"></span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../time/src/Data.Time.html#"><span class="hs-identifier">Data.Time</span></a></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../time/src/Data.Time.Clock.Internal.UTCTime.html#UTCTime"><span class="hs-identifier">UTCTime</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span class="hs-comment">-- ---------------------------------------------------------------------------</span><span>
</span><span id="line-89"></span><span class="hs-comment">-- Pre-process</span><span>
</span><span id="line-90"></span><span>
</span><span id="line-91"></span><span class="hs-comment">-- | Just preprocess a file, put the result in a temp. file (used by the</span><span>
</span><span id="line-92"></span><span class="hs-comment">-- compilation manager during the summary phase).</span><span>
</span><span id="line-93"></span><span class="hs-comment">--</span><span>
</span><span id="line-94"></span><span class="hs-comment">-- We return the augmented DynFlags, because they contain the result</span><span>
</span><span id="line-95"></span><span class="hs-comment">-- of slurping in the OPTIONS pragmas</span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span class="annot"><a href="GHC.Driver.Pipeline.html#preprocess"><span class="hs-identifier hs-type">preprocess</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-98"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-comment">-- ^ input filename</span><span>
</span><span id="line-99"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#InputFileBuffer"><span class="hs-identifier hs-type">InputFileBuffer</span></a></span><span>
</span><span id="line-100"></span><span>           </span><span class="hs-comment">-- ^ optional buffer to use instead of reading the input file</span><span>
</span><span id="line-101"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Phases.html#Phase"><span class="hs-identifier hs-type">Phase</span></a></span><span> </span><span class="hs-comment">-- ^ starting phase</span><span>
</span><span id="line-102"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#ErrorMessages"><span class="hs-identifier hs-type">ErrorMessages</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span id="preprocess"><span class="annot"><span class="annottext">preprocess :: HscEnv
-&gt; String
-&gt; Maybe InputFileBuffer
-&gt; Maybe Phase
-&gt; IO (Either ErrorMessages (DynFlags, String))
</span><a href="GHC.Driver.Pipeline.html#preprocess"><span class="hs-identifier hs-var hs-var">preprocess</span></a></span></span><span> </span><span id="local-6989586621681201973"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681201973"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681201972"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201972"><span class="hs-identifier hs-var">input_fn</span></a></span></span><span> </span><span id="local-6989586621681201971"><span class="annot"><span class="annottext">Maybe InputFileBuffer
</span><a href="#local-6989586621681201971"><span class="hs-identifier hs-var">mb_input_buf</span></a></span></span><span> </span><span id="local-6989586621681201970"><span class="annot"><span class="annottext">Maybe Phase
</span><a href="#local-6989586621681201970"><span class="hs-identifier hs-var">mb_phase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-104"></span><span>  </span><span class="annot"><span class="annottext">(SourceError -&gt; IO (Either ErrorMessages (DynFlags, String)))
-&gt; IO (Either ErrorMessages (DynFlags, String))
-&gt; IO (Either ErrorMessages (DynFlags, String))
forall (m :: * -&gt; *) a.
MonadCatch m =&gt;
(SourceError -&gt; m a) -&gt; m a -&gt; m a
</span><a href="GHC.Driver.Types.html#handleSourceError"><span class="hs-identifier hs-var">handleSourceError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681201968"><span class="annot"><span class="annottext">SourceError
</span><a href="#local-6989586621681201968"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either ErrorMessages (DynFlags, String)
-&gt; IO (Either ErrorMessages (DynFlags, String))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ErrorMessages -&gt; Either ErrorMessages (DynFlags, String)
forall a b. a -&gt; Either a b
</span><a href="../../base/src/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceError -&gt; ErrorMessages
</span><a href="GHC.Driver.Types.html#srcErrorMessages"><span class="hs-identifier hs-var">srcErrorMessages</span></a></span><span> </span><span class="annot"><span class="annottext">SourceError
</span><a href="#local-6989586621681201968"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO (Either ErrorMessages (DynFlags, String))
 -&gt; IO (Either ErrorMessages (DynFlags, String)))
-&gt; IO (Either ErrorMessages (DynFlags, String))
-&gt; IO (Either ErrorMessages (DynFlags, String))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-105"></span><span>  </span><span class="annot"><span class="annottext">(GhcException -&gt; IO (Either ErrorMessages (DynFlags, String)))
-&gt; IO (Either ErrorMessages (DynFlags, String))
-&gt; IO (Either ErrorMessages (DynFlags, String))
forall (m :: * -&gt; *) e a.
(MonadCatch m, Exception e) =&gt;
(e -&gt; m a) -&gt; m a -&gt; m a
</span><a href="../../exceptions/src/Control.Monad.Catch.html#handle"><span class="hs-identifier hs-var">MC.handle</span></a></span><span> </span><span class="annot"><span class="annottext">GhcException -&gt; IO (Either ErrorMessages (DynFlags, String))
forall {b}. GhcException -&gt; IO (Either ErrorMessages b)
</span><a href="#local-6989586621681201966"><span class="hs-identifier hs-var">handler</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (Either ErrorMessages (DynFlags, String))
 -&gt; IO (Either ErrorMessages (DynFlags, String)))
-&gt; IO (Either ErrorMessages (DynFlags, String))
-&gt; IO (Either ErrorMessages (DynFlags, String))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-106"></span><span>  </span><span class="annot"><span class="annottext">((DynFlags, String) -&gt; Either ErrorMessages (DynFlags, String))
-&gt; IO (DynFlags, String)
-&gt; IO (Either ErrorMessages (DynFlags, String))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">(DynFlags, String) -&gt; Either ErrorMessages (DynFlags, String)
forall a b. b -&gt; Either a b
</span><a href="../../base/src/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (DynFlags, String)
 -&gt; IO (Either ErrorMessages (DynFlags, String)))
-&gt; IO (DynFlags, String)
-&gt; IO (Either ErrorMessages (DynFlags, String))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-107"></span><span>  </span><span class="hs-identifier">MASSERT2</span><span class="hs-special">(</span><span class="hs-identifier">isJust</span><span> </span><span class="hs-identifier">mb_phase</span><span> </span><span class="hs-operator">||</span><span> </span><span class="hs-identifier">isHaskellSrcFilename</span><span> </span><span class="hs-identifier">input_fn</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">text</span><span> </span><span class="hs-identifier">input_fn</span><span class="hs-special">)</span><span>
</span><span id="line-108"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621681201957"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201957"><span class="hs-identifier hs-var">dflags</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681201956"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201956"><span class="hs-identifier hs-var">fp</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681201955"><span class="annot"><span class="annottext">Maybe ModIface
</span><a href="#local-6989586621681201955"><span class="hs-identifier hs-var">mb_iface</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Phase
-&gt; HscEnv
-&gt; (String, Maybe InputFileBuffer, Maybe PhasePlus)
-&gt; Maybe String
-&gt; PipelineOutput
-&gt; Maybe ModLocation
-&gt; [String]
-&gt; IO (DynFlags, String, Maybe ModIface)
</span><a href="GHC.Driver.Pipeline.html#runPipeline"><span class="hs-identifier hs-var">runPipeline</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#anyHsc"><span class="hs-identifier hs-var">anyHsc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681201973"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201972"><span class="hs-identifier hs-var">input_fn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe InputFileBuffer
</span><a href="#local-6989586621681201971"><span class="hs-identifier hs-var">mb_input_buf</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Phase -&gt; PhasePlus) -&gt; Maybe Phase -&gt; Maybe PhasePlus
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Phase -&gt; PhasePlus
</span><a href="GHC.Driver.Pipeline.Monad.html#RealPhase"><span class="hs-identifier hs-var">RealPhase</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Phase
</span><a href="#local-6989586621681201970"><span class="hs-identifier hs-var">mb_phase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span>        </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-110"></span><span>        </span><span class="hs-comment">-- We keep the processed file for the whole session to save on</span><span>
</span><span id="line-111"></span><span>        </span><span class="hs-comment">-- duplicated work in ghci.</span><span>
</span><span id="line-112"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TempFileLifetime -&gt; PipelineOutput
</span><a href="GHC.Driver.Pipeline.Monad.html#Temporary"><span class="hs-identifier hs-var">Temporary</span></a></span><span> </span><span class="annot"><span class="annottext">TempFileLifetime
</span><a href="GHC.SysTools.FileCleanup.html#TFL_GhcSession"><span class="hs-identifier hs-var">TFL_GhcSession</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-113"></span><span>        </span><span class="annot"><span class="annottext">Maybe ModLocation
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-comment">{-no ModLocation-}</span><span>
</span><span id="line-114"></span><span>        </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-comment">{-no foreign objects-}</span><span>
</span><span id="line-115"></span><span>  </span><span class="hs-comment">-- We stop before Hsc phase so we shouldn't generate an interface</span><span>
</span><span id="line-116"></span><span>  </span><span class="hs-identifier">MASSERT</span><span class="hs-special">(</span><span class="hs-identifier">isNothing</span><span> </span><span class="hs-identifier">mb_iface</span><span class="hs-special">)</span><span>
</span><span id="line-117"></span><span>  </span><span class="annot"><span class="annottext">(DynFlags, String) -&gt; IO (DynFlags, String)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201957"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201956"><span class="hs-identifier hs-var">fp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-119"></span><span>    </span><span id="local-6989586621681201947"><span class="annot"><span class="annottext">srcspan :: SrcSpan
</span><a href="#local-6989586621681201947"><span class="hs-identifier hs-var hs-var">srcspan</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; SrcSpan
</span><a href="GHC.Types.SrcLoc.html#srcLocSpan"><span class="hs-identifier hs-var">srcLocSpan</span></a></span><span> </span><span class="annot"><span class="annottext">(SrcLoc -&gt; SrcSpan) -&gt; SrcLoc -&gt; SrcSpan
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; Int -&gt; Int -&gt; SrcLoc
</span><a href="GHC.Types.SrcLoc.html#mkSrcLoc"><span class="hs-identifier hs-var">mkSrcLoc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#mkFastString"><span class="hs-identifier hs-var">mkFastString</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201972"><span class="hs-identifier hs-var">input_fn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-120"></span><span>    </span><span id="local-6989586621681201966"><span class="annot"><span class="annottext">handler :: GhcException -&gt; IO (Either ErrorMessages b)
</span><a href="#local-6989586621681201966"><span class="hs-identifier hs-var hs-var">handler</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Panic.html#ProgramError"><span class="hs-identifier hs-type">ProgramError</span></a></span><span> </span><span id="local-6989586621681201942"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201942"><span class="hs-identifier hs-var">msg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Either ErrorMessages b -&gt; IO (Either ErrorMessages b)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Either ErrorMessages b -&gt; IO (Either ErrorMessages b))
-&gt; Either ErrorMessages b -&gt; IO (Either ErrorMessages b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorMessages -&gt; Either ErrorMessages b
forall a b. a -&gt; Either a b
</span><a href="../../base/src/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrorMessages -&gt; Either ErrorMessages b)
-&gt; ErrorMessages -&gt; Either ErrorMessages b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ErrMsg -&gt; ErrorMessages
forall a. a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#unitBag"><span class="hs-identifier hs-var">unitBag</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrMsg -&gt; ErrorMessages) -&gt; ErrMsg -&gt; ErrorMessages
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-121"></span><span>        </span><span class="annot"><span class="annottext">DynFlags -&gt; SrcSpan -&gt; SDoc -&gt; ErrMsg
</span><a href="GHC.Utils.Error.html#mkPlainErrMsg"><span class="hs-identifier hs-var">mkPlainErrMsg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681201973"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681201947"><span class="hs-identifier hs-var">srcspan</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; ErrMsg) -&gt; SDoc -&gt; ErrMsg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201942"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-122"></span><span>    </span><span class="annot"><a href="#local-6989586621681201966"><span class="hs-identifier hs-var">handler</span></a></span><span> </span><span id="local-6989586621681201939"><span class="annot"><span class="annottext">GhcException
</span><a href="#local-6989586621681201939"><span class="hs-identifier hs-var">ex</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GhcException -&gt; IO (Either ErrorMessages b)
forall a. GhcException -&gt; IO a
</span><a href="GHC.Utils.Panic.html#throwGhcExceptionIO"><span class="hs-identifier hs-var">throwGhcExceptionIO</span></a></span><span> </span><span class="annot"><span class="annottext">GhcException
</span><a href="#local-6989586621681201939"><span class="hs-identifier hs-var">ex</span></a></span><span>
</span><span id="line-123"></span><span>
</span><span id="line-124"></span><span class="hs-comment">-- ---------------------------------------------------------------------------</span><span>
</span><span id="line-125"></span><span>
</span><span id="line-126"></span><span class="hs-comment">-- | Compile</span><span>
</span><span id="line-127"></span><span class="hs-comment">--</span><span>
</span><span id="line-128"></span><span class="hs-comment">-- Compile a single module, under the control of the compilation manager.</span><span>
</span><span id="line-129"></span><span class="hs-comment">--</span><span>
</span><span id="line-130"></span><span class="hs-comment">-- This is the interface between the compilation manager and the</span><span>
</span><span id="line-131"></span><span class="hs-comment">-- compiler proper (hsc), where we deal with tedious details like</span><span>
</span><span id="line-132"></span><span class="hs-comment">-- reading the OPTIONS pragma from the source file, converting the</span><span>
</span><span id="line-133"></span><span class="hs-comment">-- C or assembly that GHC produces into an object file, and compiling</span><span>
</span><span id="line-134"></span><span class="hs-comment">-- FFI stub files.</span><span>
</span><span id="line-135"></span><span class="hs-comment">--</span><span>
</span><span id="line-136"></span><span class="hs-comment">-- NB.  No old interface can also mean that the source has changed.</span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span class="annot"><a href="GHC.Driver.Pipeline.html#compileOne"><span class="hs-identifier hs-type">compileOne</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-139"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span>      </span><span class="hs-comment">-- ^ summary for module being compiled</span><span>
</span><span id="line-140"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>             </span><span class="hs-comment">-- ^ module N ...</span><span>
</span><span id="line-141"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>             </span><span class="hs-comment">-- ^ ... of M</span><span>
</span><span id="line-142"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a></span><span>  </span><span class="hs-comment">-- ^ old interface, if we have one</span><span>
</span><span id="line-143"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Runtime.Linker.Types.html#Linkable"><span class="hs-identifier hs-type">Linkable</span></a></span><span>  </span><span class="hs-comment">-- ^ old linkable, if we have one</span><span>
</span><span id="line-144"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#SourceModified"><span class="hs-identifier hs-type">SourceModified</span></a></span><span>
</span><span id="line-145"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HomeModInfo"><span class="hs-identifier hs-type">HomeModInfo</span></a></span><span>   </span><span class="hs-comment">-- ^ the complete HomeModInfo, if successful</span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span id="compileOne"><span class="annot"><span class="annottext">compileOne :: HscEnv
-&gt; ModSummary
-&gt; Int
-&gt; Int
-&gt; Maybe ModIface
-&gt; Maybe Linkable
-&gt; SourceModified
-&gt; IO HomeModInfo
</span><a href="GHC.Driver.Pipeline.html#compileOne"><span class="hs-identifier hs-var hs-var">compileOne</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe TcGblEnv
-&gt; Maybe Messager
-&gt; HscEnv
-&gt; ModSummary
-&gt; Int
-&gt; Int
-&gt; Maybe ModIface
-&gt; Maybe Linkable
-&gt; SourceModified
-&gt; IO HomeModInfo
</span><a href="GHC.Driver.Pipeline.html#compileOne%27"><span class="hs-identifier hs-var">compileOne'</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TcGblEnv
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Messager -&gt; Maybe Messager
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Messager
</span><a href="GHC.Driver.Main.html#batchMsg"><span class="hs-identifier hs-var">batchMsg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-148"></span><span>
</span><span id="line-149"></span><span class="annot"><a href="GHC.Driver.Pipeline.html#compileOne%27"><span class="hs-identifier hs-type">compileOne'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span>
</span><span id="line-150"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#Messager"><span class="hs-identifier hs-type">Messager</span></a></span><span>
</span><span id="line-151"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-152"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span>      </span><span class="hs-comment">-- ^ summary for module being compiled</span><span>
</span><span id="line-153"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>             </span><span class="hs-comment">-- ^ module N ...</span><span>
</span><span id="line-154"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>             </span><span class="hs-comment">-- ^ ... of M</span><span>
</span><span id="line-155"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a></span><span>  </span><span class="hs-comment">-- ^ old interface, if we have one</span><span>
</span><span id="line-156"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Runtime.Linker.Types.html#Linkable"><span class="hs-identifier hs-type">Linkable</span></a></span><span>  </span><span class="hs-comment">-- ^ old linkable, if we have one</span><span>
</span><span id="line-157"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#SourceModified"><span class="hs-identifier hs-type">SourceModified</span></a></span><span>
</span><span id="line-158"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HomeModInfo"><span class="hs-identifier hs-type">HomeModInfo</span></a></span><span>   </span><span class="hs-comment">-- ^ the complete HomeModInfo, if successful</span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span id="compileOne%27"><span class="annot"><span class="annottext">compileOne' :: Maybe TcGblEnv
-&gt; Maybe Messager
-&gt; HscEnv
-&gt; ModSummary
-&gt; Int
-&gt; Int
-&gt; Maybe ModIface
-&gt; Maybe Linkable
-&gt; SourceModified
-&gt; IO HomeModInfo
</span><a href="GHC.Driver.Pipeline.html#compileOne%27"><span class="hs-identifier hs-var hs-var">compileOne'</span></a></span></span><span> </span><span id="local-6989586621681201936"><span class="annot"><span class="annottext">Maybe TcGblEnv
</span><a href="#local-6989586621681201936"><span class="hs-identifier hs-var">m_tc_result</span></a></span></span><span> </span><span id="local-6989586621681201935"><span class="annot"><span class="annottext">Maybe Messager
</span><a href="#local-6989586621681201935"><span class="hs-identifier hs-var">mHscMessage</span></a></span></span><span>
</span><span id="line-161"></span><span>            </span><span id="local-6989586621681201934"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681201934"><span class="hs-identifier hs-var">hsc_env0</span></a></span></span><span> </span><span id="local-6989586621681201933"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681201933"><span class="hs-identifier hs-var">summary</span></a></span></span><span> </span><span id="local-6989586621681201932"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681201932"><span class="hs-identifier hs-var">mod_index</span></a></span></span><span> </span><span id="local-6989586621681201931"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681201931"><span class="hs-identifier hs-var">nmods</span></a></span></span><span> </span><span id="local-6989586621681201930"><span class="annot"><span class="annottext">Maybe ModIface
</span><a href="#local-6989586621681201930"><span class="hs-identifier hs-var">mb_old_iface</span></a></span></span><span> </span><span id="local-6989586621681201929"><span class="annot"><span class="annottext">Maybe Linkable
</span><a href="#local-6989586621681201929"><span class="hs-identifier hs-var">mb_old_linkable</span></a></span></span><span>
</span><span id="line-162"></span><span>            </span><span id="local-6989586621681201928"><span class="annot"><span class="annottext">SourceModified
</span><a href="#local-6989586621681201928"><span class="hs-identifier hs-var">source_modified0</span></a></span></span><span>
</span><span id="line-163"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span>   </span><span class="annot"><span class="annottext">DynFlags -&gt; Int -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201926"><span class="hs-identifier hs-var">dflags1</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;compile: input file&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201924"><span class="hs-identifier hs-var">input_fnpp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-166"></span><span>
</span><span id="line-167"></span><span>   </span><span class="hs-comment">-- Run the pipeline up to codeGen (so everything up to, but not including, STG)</span><span>
</span><span id="line-168"></span><span>   </span><span class="hs-special">(</span><span id="local-6989586621681201923"><span class="annot"><span class="annottext">HscStatus
</span><a href="#local-6989586621681201923"><span class="hs-identifier hs-var">status</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681201922"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201922"><span class="hs-identifier hs-var">plugin_dflags</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; Maybe TcGblEnv
-&gt; Maybe Messager
-&gt; HscEnv
-&gt; ModSummary
-&gt; SourceModified
-&gt; Maybe ModIface
-&gt; (Int, Int)
-&gt; IO (HscStatus, DynFlags)
</span><a href="GHC.Driver.Main.html#hscIncrementalCompile"><span class="hs-identifier hs-var">hscIncrementalCompile</span></a></span><span>
</span><span id="line-169"></span><span>                        </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681201920"><span class="hs-identifier hs-var">always_do_basic_recompilation_check</span></a></span><span>
</span><span id="line-170"></span><span>                        </span><span class="annot"><span class="annottext">Maybe TcGblEnv
</span><a href="#local-6989586621681201936"><span class="hs-identifier hs-var">m_tc_result</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Messager
</span><a href="#local-6989586621681201935"><span class="hs-identifier hs-var">mHscMessage</span></a></span><span>
</span><span id="line-171"></span><span>                        </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681201919"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681201933"><span class="hs-identifier hs-var">summary</span></a></span><span> </span><span class="annot"><span class="annottext">SourceModified
</span><a href="#local-6989586621681201918"><span class="hs-identifier hs-var">source_modified</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ModIface
</span><a href="#local-6989586621681201930"><span class="hs-identifier hs-var">mb_old_iface</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681201932"><span class="hs-identifier hs-var">mod_index</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681201931"><span class="hs-identifier hs-var">nmods</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-172"></span><span>
</span><span id="line-173"></span><span>   </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201917"><span class="annot"><span class="annottext">flags :: DynFlags
</span><a href="#local-6989586621681201917"><span class="hs-identifier hs-var hs-var">flags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681201934"><span class="hs-identifier hs-var">hsc_env0</span></a></span><span>
</span><span id="line-174"></span><span>     </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base/src/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_KeepHiFiles"><span class="hs-identifier hs-var">Opt_KeepHiFiles</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201917"><span class="hs-identifier hs-var">flags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-175"></span><span>               </span><span class="annot"><span class="annottext">DynFlags -&gt; TempFileLifetime -&gt; [String] -&gt; IO ()
</span><a href="GHC.SysTools.FileCleanup.html#addFilesToClean"><span class="hs-identifier hs-var">addFilesToClean</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201917"><span class="hs-identifier hs-var">flags</span></a></span><span> </span><span class="annot"><span class="annottext">TempFileLifetime
</span><a href="GHC.SysTools.FileCleanup.html#TFL_CurrentModule"><span class="hs-identifier hs-var">TFL_CurrentModule</span></a></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; IO ()) -&gt; [String] -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-176"></span><span>                   </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ModLocation -&gt; String
</span><a href="GHC.Unit.Module.Location.html#ml_hi_file"><span class="hs-identifier hs-var hs-var">ml_hi_file</span></a></span><span> </span><span class="annot"><span class="annottext">(ModLocation -&gt; String) -&gt; ModLocation -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; ModLocation
</span><a href="GHC.Driver.Types.html#ms_location"><span class="hs-identifier hs-var hs-var">ms_location</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681201933"><span class="hs-identifier hs-var">summary</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-177"></span><span>           </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base/src/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_KeepOFiles"><span class="hs-identifier hs-var">Opt_KeepOFiles</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201917"><span class="hs-identifier hs-var">flags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-178"></span><span>               </span><span class="annot"><span class="annottext">DynFlags -&gt; TempFileLifetime -&gt; [String] -&gt; IO ()
</span><a href="GHC.SysTools.FileCleanup.html#addFilesToClean"><span class="hs-identifier hs-var">addFilesToClean</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201917"><span class="hs-identifier hs-var">flags</span></a></span><span> </span><span class="annot"><span class="annottext">TempFileLifetime
</span><a href="GHC.SysTools.FileCleanup.html#TFL_GhcSession"><span class="hs-identifier hs-var">TFL_GhcSession</span></a></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; IO ()) -&gt; [String] -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-179"></span><span>                   </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ModLocation -&gt; String
</span><a href="GHC.Unit.Module.Location.html#ml_obj_file"><span class="hs-identifier hs-var hs-var">ml_obj_file</span></a></span><span> </span><span class="annot"><span class="annottext">(ModLocation -&gt; String) -&gt; ModLocation -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; ModLocation
</span><a href="GHC.Driver.Types.html#ms_location"><span class="hs-identifier hs-var hs-var">ms_location</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681201933"><span class="hs-identifier hs-var">summary</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-180"></span><span>
</span><span id="line-181"></span><span>   </span><span class="hs-comment">-- Use an HscEnv with DynFlags updated with the plugin info (returned from</span><span>
</span><span id="line-182"></span><span>   </span><span class="hs-comment">-- hscIncrementalCompile)</span><span>
</span><span id="line-183"></span><span>   </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201907"><span class="annot"><span class="annottext">hsc_env' :: HscEnv
</span><a href="#local-6989586621681201907"><span class="hs-identifier hs-var hs-var">hsc_env'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681201919"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hsc_dflags :: DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201922"><span class="hs-identifier hs-var">plugin_dflags</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-184"></span><span>
</span><span id="line-185"></span><span>   </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscStatus
</span><a href="#local-6989586621681201923"><span class="hs-identifier hs-var">status</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HscTarget
</span><a href="#local-6989586621681201906"><span class="hs-identifier hs-var">hsc_lang</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-186"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Types.html#HscUpToDate"><span class="hs-identifier hs-type">HscUpToDate</span></a></span><span> </span><span id="local-6989586621681201904"><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621681201904"><span class="hs-identifier hs-var">iface</span></a></span></span><span> </span><span id="local-6989586621681201903"><span class="annot"><span class="annottext">ModDetails
</span><a href="#local-6989586621681201903"><span class="hs-identifier hs-var">hmi_details</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HscTarget
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-187"></span><span>            </span><span class="hs-comment">-- TODO recomp014 triggers this assert. What's going on?!</span><span>
</span><span id="line-188"></span><span>            </span><span class="hs-comment">-- ASSERT( isJust mb_old_linkable || isNoLink (ghcLink dflags) )</span><span>
</span><span id="line-189"></span><span>            </span><span class="annot"><span class="annottext">HomeModInfo -&gt; IO HomeModInfo
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(HomeModInfo -&gt; IO HomeModInfo) -&gt; HomeModInfo -&gt; IO HomeModInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface -&gt; ModDetails -&gt; Maybe Linkable -&gt; HomeModInfo
</span><a href="GHC.Driver.Types.html#HomeModInfo"><span class="hs-identifier hs-var">HomeModInfo</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621681201904"><span class="hs-identifier hs-var">iface</span></a></span><span> </span><span class="annot"><span class="annottext">ModDetails
</span><a href="#local-6989586621681201903"><span class="hs-identifier hs-var">hmi_details</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Linkable
</span><a href="#local-6989586621681201929"><span class="hs-identifier hs-var">mb_old_linkable</span></a></span><span>
</span><span id="line-190"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Types.html#HscNotGeneratingCode"><span class="hs-identifier hs-type">HscNotGeneratingCode</span></a></span><span> </span><span id="local-6989586621681201899"><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621681201899"><span class="hs-identifier hs-var">iface</span></a></span></span><span> </span><span id="local-6989586621681201898"><span class="annot"><span class="annottext">ModDetails
</span><a href="#local-6989586621681201898"><span class="hs-identifier hs-var">hmi_details</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HscTarget
</span><a href="GHC.Driver.Session.html#HscNothing"><span class="hs-identifier hs-var">HscNothing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-191"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201896"><span class="annot"><span class="annottext">mb_linkable :: Maybe Linkable
</span><a href="#local-6989586621681201896"><span class="hs-identifier hs-var hs-var">mb_linkable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">HscSource -&gt; Bool
</span><a href="GHC.Driver.Phases.html#isHsBootOrSig"><span class="hs-identifier hs-var">isHsBootOrSig</span></a></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621681201894"><span class="hs-identifier hs-var">src_flavour</span></a></span><span>
</span><span id="line-192"></span><span>                                </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Maybe Linkable
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-193"></span><span>                                </span><span class="hs-comment">-- TODO: Questionable.</span><span>
</span><span id="line-194"></span><span>                                </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Linkable -&gt; Maybe Linkable
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UTCTime -&gt; Module -&gt; [Unlinked] -&gt; Linkable
</span><a href="GHC.Runtime.Linker.Types.html#LM"><span class="hs-identifier hs-var">LM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; UTCTime
</span><a href="GHC.Driver.Types.html#ms_hs_date"><span class="hs-identifier hs-var hs-var">ms_hs_date</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681201933"><span class="hs-identifier hs-var">summary</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681201891"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-195"></span><span>            </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">HomeModInfo -&gt; IO HomeModInfo
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(HomeModInfo -&gt; IO HomeModInfo) -&gt; HomeModInfo -&gt; IO HomeModInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface -&gt; ModDetails -&gt; Maybe Linkable -&gt; HomeModInfo
</span><a href="GHC.Driver.Types.html#HomeModInfo"><span class="hs-identifier hs-var">HomeModInfo</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621681201899"><span class="hs-identifier hs-var">iface</span></a></span><span> </span><span class="annot"><span class="annottext">ModDetails
</span><a href="#local-6989586621681201898"><span class="hs-identifier hs-var">hmi_details</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Linkable
</span><a href="#local-6989586621681201896"><span class="hs-identifier hs-var">mb_linkable</span></a></span><span>
</span><span id="line-196"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Types.html#HscNotGeneratingCode"><span class="hs-identifier hs-type">HscNotGeneratingCode</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ModDetails
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HscTarget
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO HomeModInfo
forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;compileOne HscNotGeneratingCode&quot;</span></span><span>
</span><span id="line-197"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscStatus
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HscTarget
</span><a href="GHC.Driver.Session.html#HscNothing"><span class="hs-identifier hs-var">HscNothing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO HomeModInfo
forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;compileOne HscNothing&quot;</span></span><span>
</span><span id="line-198"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Types.html#HscUpdateBoot"><span class="hs-identifier hs-type">HscUpdateBoot</span></a></span><span> </span><span id="local-6989586621681201888"><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621681201888"><span class="hs-identifier hs-var">iface</span></a></span></span><span> </span><span id="local-6989586621681201887"><span class="annot"><span class="annottext">ModDetails
</span><a href="#local-6989586621681201887"><span class="hs-identifier hs-var">hmi_details</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HscTarget
</span><a href="GHC.Driver.Session.html#HscInterpreted"><span class="hs-identifier hs-var">HscInterpreted</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-199"></span><span>            </span><span class="annot"><span class="annottext">HomeModInfo -&gt; IO HomeModInfo
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(HomeModInfo -&gt; IO HomeModInfo) -&gt; HomeModInfo -&gt; IO HomeModInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface -&gt; ModDetails -&gt; Maybe Linkable -&gt; HomeModInfo
</span><a href="GHC.Driver.Types.html#HomeModInfo"><span class="hs-identifier hs-var">HomeModInfo</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621681201888"><span class="hs-identifier hs-var">iface</span></a></span><span> </span><span class="annot"><span class="annottext">ModDetails
</span><a href="#local-6989586621681201887"><span class="hs-identifier hs-var">hmi_details</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Linkable
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-200"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Types.html#HscUpdateBoot"><span class="hs-identifier hs-type">HscUpdateBoot</span></a></span><span> </span><span id="local-6989586621681201885"><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621681201885"><span class="hs-identifier hs-var">iface</span></a></span></span><span> </span><span id="local-6989586621681201884"><span class="annot"><span class="annottext">ModDetails
</span><a href="#local-6989586621681201884"><span class="hs-identifier hs-var">hmi_details</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HscTarget
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-201"></span><span>            </span><span class="annot"><span class="annottext">DynFlags -&gt; String -&gt; IO ()
</span><a href="GHC.Driver.Pipeline.html#touchObjectFile"><span class="hs-identifier hs-var">touchObjectFile</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201882"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201881"><span class="hs-identifier hs-var">object_filename</span></a></span><span>
</span><span id="line-202"></span><span>            </span><span class="annot"><span class="annottext">HomeModInfo -&gt; IO HomeModInfo
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(HomeModInfo -&gt; IO HomeModInfo) -&gt; HomeModInfo -&gt; IO HomeModInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface -&gt; ModDetails -&gt; Maybe Linkable -&gt; HomeModInfo
</span><a href="GHC.Driver.Types.html#HomeModInfo"><span class="hs-identifier hs-var">HomeModInfo</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621681201885"><span class="hs-identifier hs-var">iface</span></a></span><span> </span><span class="annot"><span class="annottext">ModDetails
</span><a href="#local-6989586621681201884"><span class="hs-identifier hs-var">hmi_details</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Linkable
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-203"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Types.html#HscUpdateSig"><span class="hs-identifier hs-type">HscUpdateSig</span></a></span><span> </span><span id="local-6989586621681201879"><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621681201879"><span class="hs-identifier hs-var">iface</span></a></span></span><span> </span><span id="local-6989586621681201878"><span class="annot"><span class="annottext">ModDetails
</span><a href="#local-6989586621681201878"><span class="hs-identifier hs-var">hmi_details</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HscTarget
</span><a href="GHC.Driver.Session.html#HscInterpreted"><span class="hs-identifier hs-var">HscInterpreted</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-204"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681201877"><span class="annot"><span class="annottext">linkable :: Linkable
</span><a href="#local-6989586621681201877"><span class="hs-identifier hs-var hs-var">linkable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTCTime -&gt; Module -&gt; [Unlinked] -&gt; Linkable
</span><a href="GHC.Runtime.Linker.Types.html#LM"><span class="hs-identifier hs-var">LM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; UTCTime
</span><a href="GHC.Driver.Types.html#ms_hs_date"><span class="hs-identifier hs-var hs-var">ms_hs_date</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681201933"><span class="hs-identifier hs-var">summary</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681201891"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-205"></span><span>            </span><span class="annot"><span class="annottext">HomeModInfo -&gt; IO HomeModInfo
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(HomeModInfo -&gt; IO HomeModInfo) -&gt; HomeModInfo -&gt; IO HomeModInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface -&gt; ModDetails -&gt; Maybe Linkable -&gt; HomeModInfo
</span><a href="GHC.Driver.Types.html#HomeModInfo"><span class="hs-identifier hs-var">HomeModInfo</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621681201879"><span class="hs-identifier hs-var">iface</span></a></span><span> </span><span class="annot"><span class="annottext">ModDetails
</span><a href="#local-6989586621681201878"><span class="hs-identifier hs-var">hmi_details</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Linkable -&gt; Maybe Linkable
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621681201877"><span class="hs-identifier hs-var">linkable</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-206"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Types.html#HscUpdateSig"><span class="hs-identifier hs-type">HscUpdateSig</span></a></span><span> </span><span id="local-6989586621681201876"><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621681201876"><span class="hs-identifier hs-var">iface</span></a></span></span><span> </span><span id="local-6989586621681201875"><span class="annot"><span class="annottext">ModDetails
</span><a href="#local-6989586621681201875"><span class="hs-identifier hs-var">hmi_details</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HscTarget
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-207"></span><span>            </span><span id="local-6989586621681201874"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201874"><span class="hs-identifier hs-var">output_fn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Phase
-&gt; PipelineOutput
-&gt; String
-&gt; DynFlags
-&gt; Phase
-&gt; Maybe ModLocation
-&gt; IO String
</span><a href="GHC.Driver.Pipeline.html#getOutputFilename"><span class="hs-identifier hs-var">getOutputFilename</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201873"><span class="hs-identifier hs-var">next_phase</span></a></span><span>
</span><span id="line-208"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TempFileLifetime -&gt; PipelineOutput
</span><a href="GHC.Driver.Pipeline.Monad.html#Temporary"><span class="hs-identifier hs-var">Temporary</span></a></span><span> </span><span class="annot"><span class="annottext">TempFileLifetime
</span><a href="GHC.SysTools.FileCleanup.html#TFL_CurrentModule"><span class="hs-identifier hs-var">TFL_CurrentModule</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201872"><span class="hs-identifier hs-var">basename</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201882"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-209"></span><span>                            </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201873"><span class="hs-identifier hs-var">next_phase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModLocation -&gt; Maybe ModLocation
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681201871"><span class="hs-identifier hs-var">location</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-210"></span><span>
</span><span id="line-211"></span><span>            </span><span class="hs-comment">-- #10660: Use the pipeline instead of calling</span><span>
</span><span id="line-212"></span><span>            </span><span class="hs-comment">-- compileEmptyStub directly, so -dynamic-too gets</span><span>
</span><span id="line-213"></span><span>            </span><span class="hs-comment">-- handled properly</span><span>
</span><span id="line-214"></span><span>            </span><span class="annot"><span class="annottext">(DynFlags, String, Maybe ModIface)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Phase
-&gt; HscEnv
-&gt; (String, Maybe InputFileBuffer, Maybe PhasePlus)
-&gt; Maybe String
-&gt; PipelineOutput
-&gt; Maybe ModLocation
-&gt; [String]
-&gt; IO (DynFlags, String, Maybe ModIface)
</span><a href="GHC.Driver.Pipeline.html#runPipeline"><span class="hs-identifier hs-var">runPipeline</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#StopLn"><span class="hs-identifier hs-var">StopLn</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681201907"><span class="hs-identifier hs-var">hsc_env'</span></a></span><span>
</span><span id="line-215"></span><span>                              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201874"><span class="hs-identifier hs-var">output_fn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-216"></span><span>                               </span><span class="annot"><span class="annottext">Maybe InputFileBuffer
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-217"></span><span>                               </span><span class="annot"><span class="annottext">PhasePlus -&gt; Maybe PhasePlus
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscSource -&gt; ModuleName -&gt; HscStatus -&gt; PhasePlus
</span><a href="GHC.Driver.Pipeline.Monad.html#HscOut"><span class="hs-identifier hs-var">HscOut</span></a></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621681201894"><span class="hs-identifier hs-var">src_flavour</span></a></span><span>
</span><span id="line-218"></span><span>                                            </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681201868"><span class="hs-identifier hs-var">mod_name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModIface -&gt; ModDetails -&gt; HscStatus
</span><a href="GHC.Driver.Types.html#HscUpdateSig"><span class="hs-identifier hs-var">HscUpdateSig</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621681201876"><span class="hs-identifier hs-var">iface</span></a></span><span> </span><span class="annot"><span class="annottext">ModDetails
</span><a href="#local-6989586621681201875"><span class="hs-identifier hs-var">hmi_details</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-219"></span><span>                              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Maybe String
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201872"><span class="hs-identifier hs-var">basename</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-220"></span><span>                              </span><span class="annot"><span class="annottext">PipelineOutput
</span><a href="GHC.Driver.Pipeline.Monad.html#Persistent"><span class="hs-identifier hs-var">Persistent</span></a></span><span>
</span><span id="line-221"></span><span>                              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModLocation -&gt; Maybe ModLocation
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681201871"><span class="hs-identifier hs-var">location</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-222"></span><span>                              </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-223"></span><span>            </span><span id="local-6989586621681201866"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621681201866"><span class="hs-identifier hs-var">o_time</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO UTCTime
</span><a href="GHC.Utils.Misc.html#getModificationUTCTime"><span class="hs-identifier hs-var">getModificationUTCTime</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201881"><span class="hs-identifier hs-var">object_filename</span></a></span><span>
</span><span id="line-224"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681201864"><span class="annot"><span class="annottext">linkable :: Linkable
</span><a href="#local-6989586621681201864"><span class="hs-identifier hs-var hs-var">linkable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTCTime -&gt; Module -&gt; [Unlinked] -&gt; Linkable
</span><a href="GHC.Runtime.Linker.Types.html#LM"><span class="hs-identifier hs-var">LM</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621681201866"><span class="hs-identifier hs-var">o_time</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681201891"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String -&gt; Unlinked
</span><a href="GHC.Runtime.Linker.Types.html#DotO"><span class="hs-identifier hs-var">DotO</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201881"><span class="hs-identifier hs-var">object_filename</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-225"></span><span>            </span><span class="annot"><span class="annottext">HomeModInfo -&gt; IO HomeModInfo
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(HomeModInfo -&gt; IO HomeModInfo) -&gt; HomeModInfo -&gt; IO HomeModInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface -&gt; ModDetails -&gt; Maybe Linkable -&gt; HomeModInfo
</span><a href="GHC.Driver.Types.html#HomeModInfo"><span class="hs-identifier hs-var">HomeModInfo</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621681201876"><span class="hs-identifier hs-var">iface</span></a></span><span> </span><span class="annot"><span class="annottext">ModDetails
</span><a href="#local-6989586621681201875"><span class="hs-identifier hs-var">hmi_details</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Linkable -&gt; Maybe Linkable
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621681201864"><span class="hs-identifier hs-var">linkable</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-226"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Types.html#HscRecomp"><span class="hs-identifier hs-type">HscRecomp</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hscs_guts :: HscStatus -&gt; CgGuts
</span><a href="GHC.Driver.Types.html#hscs_guts"><span class="hs-identifier hs-var">hscs_guts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681201860"><span class="annot"><span class="annottext">CgGuts
</span><a href="#local-6989586621681201860"><span class="hs-identifier hs-var">cgguts</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-227"></span><span>                     </span><span class="annot"><span class="annottext">hscs_mod_location :: HscStatus -&gt; ModLocation
</span><a href="GHC.Driver.Types.html#hscs_mod_location"><span class="hs-identifier hs-var">hscs_mod_location</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681201858"><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681201858"><span class="hs-identifier hs-var">mod_location</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-228"></span><span>                     </span><span class="annot"><span class="annottext">hscs_partial_iface :: HscStatus -&gt; PartialModIface
</span><a href="GHC.Driver.Types.html#hscs_partial_iface"><span class="hs-identifier hs-var">hscs_partial_iface</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681201856"><span class="annot"><span class="annottext">PartialModIface
</span><a href="#local-6989586621681201856"><span class="hs-identifier hs-var">partial_iface</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-229"></span><span>                     </span><span class="annot"><span class="annottext">hscs_old_iface_hash :: HscStatus -&gt; Maybe Fingerprint
</span><a href="GHC.Driver.Types.html#hscs_old_iface_hash"><span class="hs-identifier hs-var">hscs_old_iface_hash</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681201854"><span class="annot"><span class="annottext">Maybe Fingerprint
</span><a href="#local-6989586621681201854"><span class="hs-identifier hs-var">mb_old_iface_hash</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-230"></span><span>                     </span><span class="annot"><span class="annottext">hscs_iface_dflags :: HscStatus -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hscs_iface_dflags"><span class="hs-identifier hs-var">hscs_iface_dflags</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681201852"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201852"><span class="hs-identifier hs-var">iface_dflags</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HscTarget
</span><a href="GHC.Driver.Session.html#HscInterpreted"><span class="hs-identifier hs-var">HscInterpreted</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-231"></span><span>            </span><span class="hs-comment">-- In interpreted mode the regular codeGen backend is not run so we</span><span>
</span><span id="line-232"></span><span>            </span><span class="hs-comment">-- generate a interface without codeGen info.</span><span>
</span><span id="line-233"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201851"><span class="annot"><span class="annottext">hsc_env'' :: HscEnv
</span><a href="#local-6989586621681201851"><span class="hs-identifier hs-var hs-var">hsc_env''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681201907"><span class="hs-identifier hs-var">hsc_env'</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">hsc_dflags :: DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201852"><span class="hs-identifier hs-var">iface_dflags</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-234"></span><span>            </span><span id="local-6989586621681201850"><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621681201850"><span class="hs-identifier hs-var">final_iface</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; PartialModIface -&gt; Maybe CgInfos -&gt; IO ModIface
</span><a href="GHC.Iface.Make.html#mkFullIface"><span class="hs-identifier hs-var">mkFullIface</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681201851"><span class="hs-identifier hs-var">hsc_env''</span></a></span><span> </span><span class="annot"><span class="annottext">PartialModIface
</span><a href="#local-6989586621681201856"><span class="hs-identifier hs-var">partial_iface</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe CgInfos
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-235"></span><span>            </span><span class="hs-comment">-- Reconstruct the `ModDetails` from the just-constructed `ModIface`</span><span>
</span><span id="line-236"></span><span>            </span><span class="hs-comment">-- See Note [ModDetails and --make mode]</span><span>
</span><span id="line-237"></span><span>            </span><span id="local-6989586621681201849"><span class="annot"><span class="annottext">ModDetails
</span><a href="#local-6989586621681201849"><span class="hs-identifier hs-var">hmi_details</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ModDetails -&gt; IO ModDetails
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ModDetails -&gt; IO ModDetails) -&gt; IO ModDetails -&gt; IO ModDetails
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; ModSummary -&gt; ModIface -&gt; IO ModDetails
</span><a href="GHC.Driver.Main.html#initModDetails"><span class="hs-identifier hs-var">initModDetails</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681201851"><span class="hs-identifier hs-var">hsc_env''</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681201933"><span class="hs-identifier hs-var">summary</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621681201850"><span class="hs-identifier hs-var">final_iface</span></a></span><span>
</span><span id="line-238"></span><span>            </span><span class="annot"><span class="annottext">IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; ModIface -&gt; Maybe Fingerprint -&gt; ModLocation -&gt; IO ()
</span><a href="GHC.Driver.Main.html#hscMaybeWriteIface"><span class="hs-identifier hs-var">hscMaybeWriteIface</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201882"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621681201850"><span class="hs-identifier hs-var">final_iface</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Fingerprint
</span><a href="#local-6989586621681201854"><span class="hs-identifier hs-var">mb_old_iface_hash</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; ModLocation
</span><a href="GHC.Driver.Types.html#ms_location"><span class="hs-identifier hs-var hs-var">ms_location</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681201933"><span class="hs-identifier hs-var">summary</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-239"></span><span>
</span><span id="line-240"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621681201845"><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621681201845"><span class="hs-identifier hs-var">hasStub</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681201844"><span class="annot"><span class="annottext">CompiledByteCode
</span><a href="#local-6989586621681201844"><span class="hs-identifier hs-var">comp_bc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681201843"><span class="annot"><span class="annottext">[SptEntry]
</span><a href="#local-6989586621681201843"><span class="hs-identifier hs-var">spt_entries</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; CgGuts
-&gt; ModLocation
-&gt; IO (Maybe String, CompiledByteCode, [SptEntry])
</span><a href="GHC.Driver.Main.html#hscInteractive"><span class="hs-identifier hs-var">hscInteractive</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681201907"><span class="hs-identifier hs-var">hsc_env'</span></a></span><span> </span><span class="annot"><span class="annottext">CgGuts
</span><a href="#local-6989586621681201860"><span class="hs-identifier hs-var">cgguts</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681201858"><span class="hs-identifier hs-var">mod_location</span></a></span><span>
</span><span id="line-241"></span><span>
</span><span id="line-242"></span><span>            </span><span id="local-6989586621681201841"><span class="annot"><span class="annottext">[Unlinked]
</span><a href="#local-6989586621681201841"><span class="hs-identifier hs-var">stub_o</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621681201845"><span class="hs-identifier hs-var">hasStub</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-243"></span><span>                      </span><span class="annot"><span class="annottext">Maybe String
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Unlinked] -&gt; IO [Unlinked]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-244"></span><span>                      </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681201840"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201840"><span class="hs-identifier hs-var">stub_c</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-245"></span><span>                          </span><span id="local-6989586621681201839"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201839"><span class="hs-identifier hs-var">stub_o</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; String -&gt; IO String
</span><a href="GHC.Driver.Pipeline.html#compileStub"><span class="hs-identifier hs-var">compileStub</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681201907"><span class="hs-identifier hs-var">hsc_env'</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201840"><span class="hs-identifier hs-var">stub_c</span></a></span><span>
</span><span id="line-246"></span><span>                          </span><span class="annot"><span class="annottext">[Unlinked] -&gt; IO [Unlinked]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String -&gt; Unlinked
</span><a href="GHC.Runtime.Linker.Types.html#DotO"><span class="hs-identifier hs-var">DotO</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201839"><span class="hs-identifier hs-var">stub_o</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-247"></span><span>
</span><span id="line-248"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201837"><span class="annot"><span class="annottext">hs_unlinked :: [Unlinked]
</span><a href="#local-6989586621681201837"><span class="hs-identifier hs-var hs-var">hs_unlinked</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CompiledByteCode -&gt; [SptEntry] -&gt; Unlinked
</span><a href="GHC.Runtime.Linker.Types.html#BCOs"><span class="hs-identifier hs-var">BCOs</span></a></span><span> </span><span class="annot"><span class="annottext">CompiledByteCode
</span><a href="#local-6989586621681201844"><span class="hs-identifier hs-var">comp_bc</span></a></span><span> </span><span class="annot"><span class="annottext">[SptEntry]
</span><a href="#local-6989586621681201843"><span class="hs-identifier hs-var">spt_entries</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-249"></span><span>                </span><span id="local-6989586621681201835"><span class="annot"><span class="annottext">unlinked_time :: UTCTime
</span><a href="#local-6989586621681201835"><span class="hs-identifier hs-var hs-var">unlinked_time</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; UTCTime
</span><a href="GHC.Driver.Types.html#ms_hs_date"><span class="hs-identifier hs-var hs-var">ms_hs_date</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681201933"><span class="hs-identifier hs-var">summary</span></a></span><span>
</span><span id="line-250"></span><span>              </span><span class="hs-comment">-- Why do we use the timestamp of the source file here,</span><span>
</span><span id="line-251"></span><span>              </span><span class="hs-comment">-- rather than the current time?  This works better in</span><span>
</span><span id="line-252"></span><span>              </span><span class="hs-comment">-- the case where the local clock is out of sync</span><span>
</span><span id="line-253"></span><span>              </span><span class="hs-comment">-- with the filesystem's clock.  It's just as accurate:</span><span>
</span><span id="line-254"></span><span>              </span><span class="hs-comment">-- if the source is modified, then the linkable will</span><span>
</span><span id="line-255"></span><span>              </span><span class="hs-comment">-- be out of date.</span><span>
</span><span id="line-256"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681201834"><span class="annot"><span class="annottext">linkable :: Linkable
</span><a href="#local-6989586621681201834"><span class="hs-identifier hs-var hs-var">linkable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTCTime -&gt; Module -&gt; [Unlinked] -&gt; Linkable
</span><a href="GHC.Runtime.Linker.Types.html#LM"><span class="hs-identifier hs-var">LM</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621681201835"><span class="hs-identifier hs-var">unlinked_time</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; Module
</span><a href="GHC.Driver.Types.html#ms_mod"><span class="hs-identifier hs-var hs-var">ms_mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681201933"><span class="hs-identifier hs-var">summary</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-257"></span><span>                           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Unlinked]
</span><a href="#local-6989586621681201837"><span class="hs-identifier hs-var">hs_unlinked</span></a></span><span> </span><span class="annot"><span class="annottext">[Unlinked] -&gt; [Unlinked] -&gt; [Unlinked]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Unlinked]
</span><a href="#local-6989586621681201841"><span class="hs-identifier hs-var">stub_o</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-258"></span><span>            </span><span class="annot"><span class="annottext">HomeModInfo -&gt; IO HomeModInfo
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(HomeModInfo -&gt; IO HomeModInfo) -&gt; HomeModInfo -&gt; IO HomeModInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface -&gt; ModDetails -&gt; Maybe Linkable -&gt; HomeModInfo
</span><a href="GHC.Driver.Types.html#HomeModInfo"><span class="hs-identifier hs-var">HomeModInfo</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621681201850"><span class="hs-identifier hs-var">final_iface</span></a></span><span> </span><span class="annot"><span class="annottext">ModDetails
</span><a href="#local-6989586621681201849"><span class="hs-identifier hs-var">hmi_details</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Linkable -&gt; Maybe Linkable
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621681201834"><span class="hs-identifier hs-var">linkable</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-259"></span><span>        </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Types.html#HscRecomp"><span class="hs-identifier hs-type">HscRecomp</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HscTarget
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-260"></span><span>            </span><span id="local-6989586621681201832"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201832"><span class="hs-identifier hs-var">output_fn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Phase
-&gt; PipelineOutput
-&gt; String
-&gt; DynFlags
-&gt; Phase
-&gt; Maybe ModLocation
-&gt; IO String
</span><a href="GHC.Driver.Pipeline.html#getOutputFilename"><span class="hs-identifier hs-var">getOutputFilename</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201873"><span class="hs-identifier hs-var">next_phase</span></a></span><span>
</span><span id="line-261"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TempFileLifetime -&gt; PipelineOutput
</span><a href="GHC.Driver.Pipeline.Monad.html#Temporary"><span class="hs-identifier hs-var">Temporary</span></a></span><span> </span><span class="annot"><span class="annottext">TempFileLifetime
</span><a href="GHC.SysTools.FileCleanup.html#TFL_CurrentModule"><span class="hs-identifier hs-var">TFL_CurrentModule</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-262"></span><span>                            </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201872"><span class="hs-identifier hs-var">basename</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201882"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201873"><span class="hs-identifier hs-var">next_phase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModLocation -&gt; Maybe ModLocation
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681201871"><span class="hs-identifier hs-var">location</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-263"></span><span>            </span><span class="hs-comment">-- We're in --make mode: finish the compilation pipeline.</span><span>
</span><span id="line-264"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681201831"><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621681201831"><span class="hs-identifier hs-var">iface</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Phase
-&gt; HscEnv
-&gt; (String, Maybe InputFileBuffer, Maybe PhasePlus)
-&gt; Maybe String
-&gt; PipelineOutput
-&gt; Maybe ModLocation
-&gt; [String]
-&gt; IO (DynFlags, String, Maybe ModIface)
</span><a href="GHC.Driver.Pipeline.html#runPipeline"><span class="hs-identifier hs-var">runPipeline</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#StopLn"><span class="hs-identifier hs-var">StopLn</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681201907"><span class="hs-identifier hs-var">hsc_env'</span></a></span><span>
</span><span id="line-265"></span><span>                              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201832"><span class="hs-identifier hs-var">output_fn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-266"></span><span>                               </span><span class="annot"><span class="annottext">Maybe InputFileBuffer
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-267"></span><span>                               </span><span class="annot"><span class="annottext">PhasePlus -&gt; Maybe PhasePlus
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscSource -&gt; ModuleName -&gt; HscStatus -&gt; PhasePlus
</span><a href="GHC.Driver.Pipeline.Monad.html#HscOut"><span class="hs-identifier hs-var">HscOut</span></a></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621681201894"><span class="hs-identifier hs-var">src_flavour</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681201868"><span class="hs-identifier hs-var">mod_name</span></a></span><span> </span><span class="annot"><span class="annottext">HscStatus
</span><a href="#local-6989586621681201923"><span class="hs-identifier hs-var">status</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-268"></span><span>                              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Maybe String
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201872"><span class="hs-identifier hs-var">basename</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-269"></span><span>                              </span><span class="annot"><span class="annottext">PipelineOutput
</span><a href="GHC.Driver.Pipeline.Monad.html#Persistent"><span class="hs-identifier hs-var">Persistent</span></a></span><span>
</span><span id="line-270"></span><span>                              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModLocation -&gt; Maybe ModLocation
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681201871"><span class="hs-identifier hs-var">location</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-271"></span><span>                              </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-272"></span><span>                  </span><span class="hs-comment">-- The object filename comes from the ModLocation</span><span>
</span><span id="line-273"></span><span>            </span><span id="local-6989586621681201830"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621681201830"><span class="hs-identifier hs-var">o_time</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO UTCTime
</span><a href="GHC.Utils.Misc.html#getModificationUTCTime"><span class="hs-identifier hs-var">getModificationUTCTime</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201881"><span class="hs-identifier hs-var">object_filename</span></a></span><span>
</span><span id="line-274"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681201829"><span class="annot"><span class="annottext">linkable :: Linkable
</span><a href="#local-6989586621681201829"><span class="hs-identifier hs-var hs-var">linkable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTCTime -&gt; Module -&gt; [Unlinked] -&gt; Linkable
</span><a href="GHC.Runtime.Linker.Types.html#LM"><span class="hs-identifier hs-var">LM</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621681201830"><span class="hs-identifier hs-var">o_time</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681201891"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String -&gt; Unlinked
</span><a href="GHC.Runtime.Linker.Types.html#DotO"><span class="hs-identifier hs-var">DotO</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201881"><span class="hs-identifier hs-var">object_filename</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-275"></span><span>            </span><span class="hs-comment">-- See Note [ModDetails and --make mode]</span><span>
</span><span id="line-276"></span><span>            </span><span id="local-6989586621681201828"><span class="annot"><span class="annottext">ModDetails
</span><a href="#local-6989586621681201828"><span class="hs-identifier hs-var">details</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; ModSummary -&gt; ModIface -&gt; IO ModDetails
</span><a href="GHC.Driver.Main.html#initModDetails"><span class="hs-identifier hs-var">initModDetails</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681201907"><span class="hs-identifier hs-var">hsc_env'</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681201933"><span class="hs-identifier hs-var">summary</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621681201831"><span class="hs-identifier hs-var">iface</span></a></span><span>
</span><span id="line-277"></span><span>            </span><span class="annot"><span class="annottext">HomeModInfo -&gt; IO HomeModInfo
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(HomeModInfo -&gt; IO HomeModInfo) -&gt; HomeModInfo -&gt; IO HomeModInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface -&gt; ModDetails -&gt; Maybe Linkable -&gt; HomeModInfo
</span><a href="GHC.Driver.Types.html#HomeModInfo"><span class="hs-identifier hs-var">HomeModInfo</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621681201831"><span class="hs-identifier hs-var">iface</span></a></span><span> </span><span class="annot"><span class="annottext">ModDetails
</span><a href="#local-6989586621681201828"><span class="hs-identifier hs-var">details</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Linkable -&gt; Maybe Linkable
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621681201829"><span class="hs-identifier hs-var">linkable</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-278"></span><span>
</span><span id="line-279"></span><span> </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681201827"><span class="annot"><span class="annottext">dflags0 :: DynFlags
</span><a href="#local-6989586621681201827"><span class="hs-identifier hs-var hs-var">dflags0</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#ms_hspp_opts"><span class="hs-identifier hs-var hs-var">ms_hspp_opts</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681201933"><span class="hs-identifier hs-var">summary</span></a></span><span>
</span><span id="line-280"></span><span>       </span><span id="local-6989586621681201891"><span class="annot"><span class="annottext">this_mod :: Module
</span><a href="#local-6989586621681201891"><span class="hs-identifier hs-var hs-var">this_mod</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; Module
</span><a href="GHC.Driver.Types.html#ms_mod"><span class="hs-identifier hs-var hs-var">ms_mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681201933"><span class="hs-identifier hs-var">summary</span></a></span><span>
</span><span id="line-281"></span><span>       </span><span id="local-6989586621681201871"><span class="annot"><span class="annottext">location :: ModLocation
</span><a href="#local-6989586621681201871"><span class="hs-identifier hs-var hs-var">location</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; ModLocation
</span><a href="GHC.Driver.Types.html#ms_location"><span class="hs-identifier hs-var hs-var">ms_location</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681201933"><span class="hs-identifier hs-var">summary</span></a></span><span>
</span><span id="line-282"></span><span>       </span><span id="local-6989586621681201823"><span class="annot"><span class="annottext">input_fn :: String
</span><a href="#local-6989586621681201823"><span class="hs-identifier hs-var hs-var">input_fn</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe String -&gt; String
forall a. HasCallStack =&gt; String -&gt; Maybe a -&gt; a
</span><a href="GHC.Data.Maybe.html#expectJust"><span class="hs-identifier hs-var">expectJust</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;compile:hs&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModLocation -&gt; Maybe String
</span><a href="GHC.Unit.Module.Location.html#ml_hs_file"><span class="hs-identifier hs-var hs-var">ml_hs_file</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681201871"><span class="hs-identifier hs-var">location</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-283"></span><span>       </span><span id="local-6989586621681201924"><span class="annot"><span class="annottext">input_fnpp :: String
</span><a href="#local-6989586621681201924"><span class="hs-identifier hs-var hs-var">input_fnpp</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; String
</span><a href="GHC.Driver.Types.html#ms_hspp_file"><span class="hs-identifier hs-var hs-var">ms_hspp_file</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681201933"><span class="hs-identifier hs-var">summary</span></a></span><span>
</span><span id="line-284"></span><span>       </span><span id="local-6989586621681201820"><span class="annot"><span class="annottext">mod_graph :: ModuleGraph
</span><a href="#local-6989586621681201820"><span class="hs-identifier hs-var hs-var">mod_graph</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; ModuleGraph
</span><a href="GHC.Driver.Types.html#hsc_mod_graph"><span class="hs-identifier hs-var hs-var">hsc_mod_graph</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681201934"><span class="hs-identifier hs-var">hsc_env0</span></a></span><span>
</span><span id="line-285"></span><span>       </span><span id="local-6989586621681201818"><span class="annot"><span class="annottext">needsLinker :: Bool
</span><a href="#local-6989586621681201818"><span class="hs-identifier hs-var hs-var">needsLinker</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleGraph -&gt; Bool
</span><a href="GHC.Driver.Types.html#needsTemplateHaskellOrQQ"><span class="hs-identifier hs-var">needsTemplateHaskellOrQQ</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621681201820"><span class="hs-identifier hs-var">mod_graph</span></a></span><span>
</span><span id="line-286"></span><span>       </span><span id="local-6989586621681201812"><span class="annot"><span class="annottext">isDynWay :: Bool
</span><a href="#local-6989586621681201812"><span class="hs-identifier hs-var hs-var">isDynWay</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Way -&gt; Bool) -&gt; Set Way -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Way -&gt; Way -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Way
</span><a href="GHC.Driver.Ways.html#WayDyn"><span class="hs-identifier hs-var">WayDyn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Set Way
</span><a href="GHC.Driver.Session.html#ways"><span class="hs-identifier hs-var hs-var">ways</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201827"><span class="hs-identifier hs-var">dflags0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-287"></span><span>       </span><span id="local-6989586621681201806"><span class="annot"><span class="annottext">isProfWay :: Bool
</span><a href="#local-6989586621681201806"><span class="hs-identifier hs-var hs-var">isProfWay</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Way -&gt; Bool) -&gt; Set Way -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Way -&gt; Way -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Way
</span><a href="GHC.Driver.Ways.html#WayProf"><span class="hs-identifier hs-var">WayProf</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Set Way
</span><a href="GHC.Driver.Session.html#ways"><span class="hs-identifier hs-var hs-var">ways</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201827"><span class="hs-identifier hs-var">dflags0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-288"></span><span>       </span><span id="local-6989586621681201804"><span class="annot"><span class="annottext">internalInterpreter :: Bool
</span><a href="#local-6989586621681201804"><span class="hs-identifier hs-var hs-var">internalInterpreter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_ExternalInterpreter"><span class="hs-identifier hs-var">Opt_ExternalInterpreter</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201827"><span class="hs-identifier hs-var">dflags0</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-289"></span><span>
</span><span id="line-290"></span><span>       </span><span id="local-6989586621681201894"><span class="annot"><span class="annottext">src_flavour :: HscSource
</span><a href="#local-6989586621681201894"><span class="hs-identifier hs-var hs-var">src_flavour</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; HscSource
</span><a href="GHC.Driver.Types.html#ms_hsc_src"><span class="hs-identifier hs-var hs-var">ms_hsc_src</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681201933"><span class="hs-identifier hs-var">summary</span></a></span><span>
</span><span id="line-291"></span><span>       </span><span id="local-6989586621681201868"><span class="annot"><span class="annottext">mod_name :: ModuleName
</span><a href="#local-6989586621681201868"><span class="hs-identifier hs-var hs-var">mod_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; ModuleName
</span><a href="GHC.Driver.Types.html#ms_mod_name"><span class="hs-identifier hs-var">ms_mod_name</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681201933"><span class="hs-identifier hs-var">summary</span></a></span><span>
</span><span id="line-292"></span><span>       </span><span id="local-6989586621681201873"><span class="annot"><span class="annottext">next_phase :: Phase
</span><a href="#local-6989586621681201873"><span class="hs-identifier hs-var hs-var">next_phase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscSource -&gt; HscTarget -&gt; Phase
</span><a href="GHC.Driver.Pipeline.html#hscPostBackendPhase"><span class="hs-identifier hs-var">hscPostBackendPhase</span></a></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621681201894"><span class="hs-identifier hs-var">src_flavour</span></a></span><span> </span><span class="annot"><span class="annottext">HscTarget
</span><a href="#local-6989586621681201906"><span class="hs-identifier hs-var">hsc_lang</span></a></span><span>
</span><span id="line-293"></span><span>       </span><span id="local-6989586621681201881"><span class="annot"><span class="annottext">object_filename :: String
</span><a href="#local-6989586621681201881"><span class="hs-identifier hs-var hs-var">object_filename</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModLocation -&gt; String
</span><a href="GHC.Unit.Module.Location.html#ml_obj_file"><span class="hs-identifier hs-var hs-var">ml_obj_file</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681201871"><span class="hs-identifier hs-var">location</span></a></span><span>
</span><span id="line-294"></span><span>
</span><span id="line-295"></span><span>       </span><span class="hs-comment">-- #8180 - when using TemplateHaskell, switch on -dynamic-too so</span><span>
</span><span id="line-296"></span><span>       </span><span class="hs-comment">-- the linker can correctly load the object files.  This isn't necessary</span><span>
</span><span id="line-297"></span><span>       </span><span class="hs-comment">-- when using -fexternal-interpreter.</span><span>
</span><span id="line-298"></span><span>       </span><span id="local-6989586621681201926"><span class="annot"><span class="annottext">dflags1 :: DynFlags
</span><a href="#local-6989586621681201926"><span class="hs-identifier hs-var hs-var">dflags1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="GHC.Driver.Ways.html#hostIsDynamic"><span class="hs-identifier hs-var">hostIsDynamic</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681201804"><span class="hs-identifier hs-var">internalInterpreter</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-299"></span><span>                    </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681201812"><span class="hs-identifier hs-var">isDynWay</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681201806"><span class="hs-identifier hs-var">isProfWay</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681201818"><span class="hs-identifier hs-var">needsLinker</span></a></span><span>
</span><span id="line-300"></span><span>                  </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; GeneralFlag -&gt; DynFlags
</span><a href="GHC.Driver.Session.html#gopt_set"><span class="hs-identifier hs-var">gopt_set</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201827"><span class="hs-identifier hs-var">dflags0</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_BuildDynamicToo"><span class="hs-identifier hs-var">Opt_BuildDynamicToo</span></a></span><span>
</span><span id="line-301"></span><span>                  </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201827"><span class="hs-identifier hs-var">dflags0</span></a></span><span>
</span><span id="line-302"></span><span>
</span><span id="line-303"></span><span>       </span><span class="hs-comment">-- #16331 - when no &quot;internal interpreter&quot; is available but we</span><span>
</span><span id="line-304"></span><span>       </span><span class="hs-comment">-- need to process some TemplateHaskell or QuasiQuotes, we automatically</span><span>
</span><span id="line-305"></span><span>       </span><span class="hs-comment">-- turn on -fexternal-interpreter.</span><span>
</span><span id="line-306"></span><span>       </span><span id="local-6989586621681201797"><span class="annot"><span class="annottext">dflags2 :: DynFlags
</span><a href="#local-6989586621681201797"><span class="hs-identifier hs-var hs-var">dflags2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681201804"><span class="hs-identifier hs-var">internalInterpreter</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681201818"><span class="hs-identifier hs-var">needsLinker</span></a></span><span>
</span><span id="line-307"></span><span>                 </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; GeneralFlag -&gt; DynFlags
</span><a href="GHC.Driver.Session.html#gopt_set"><span class="hs-identifier hs-var">gopt_set</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201926"><span class="hs-identifier hs-var">dflags1</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_ExternalInterpreter"><span class="hs-identifier hs-var">Opt_ExternalInterpreter</span></a></span><span>
</span><span id="line-308"></span><span>                 </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201926"><span class="hs-identifier hs-var">dflags1</span></a></span><span>
</span><span id="line-309"></span><span>
</span><span id="line-310"></span><span>       </span><span id="local-6989586621681201872"><span class="annot"><span class="annottext">basename :: String
</span><a href="#local-6989586621681201872"><span class="hs-identifier hs-var hs-var">basename</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String
</span><a href="../../filepath/src/System.FilePath.Windows.html#dropExtension"><span class="hs-identifier hs-var">dropExtension</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201823"><span class="hs-identifier hs-var">input_fn</span></a></span><span>
</span><span id="line-311"></span><span>
</span><span id="line-312"></span><span>       </span><span class="hs-comment">-- We add the directory in which the .hs files resides) to the import</span><span>
</span><span id="line-313"></span><span>       </span><span class="hs-comment">-- path.  This is needed when we try to compile the .hc file later, if it</span><span>
</span><span id="line-314"></span><span>       </span><span class="hs-comment">-- imports a _stub.h file that we created here.</span><span>
</span><span id="line-315"></span><span>       </span><span id="local-6989586621681201795"><span class="annot"><span class="annottext">current_dir :: String
</span><a href="#local-6989586621681201795"><span class="hs-identifier hs-var hs-var">current_dir</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String
</span><a href="../../filepath/src/System.FilePath.Windows.html#takeDirectory"><span class="hs-identifier hs-var">takeDirectory</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201872"><span class="hs-identifier hs-var">basename</span></a></span><span>
</span><span id="line-316"></span><span>       </span><span id="local-6989586621681201793"><span class="annot"><span class="annottext">old_paths :: IncludeSpecs
</span><a href="#local-6989586621681201793"><span class="hs-identifier hs-var hs-var">old_paths</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; IncludeSpecs
</span><a href="GHC.Driver.Session.html#includePaths"><span class="hs-identifier hs-var hs-var">includePaths</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201797"><span class="hs-identifier hs-var">dflags2</span></a></span><span>
</span><span id="line-317"></span><span>       </span><span class="hs-glyph">!</span><span id="local-6989586621681201791"><span class="annot"><span class="annottext">prevailing_dflags :: DynFlags
</span><a href="#local-6989586621681201791"><span class="hs-identifier hs-var hs-var">prevailing_dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681201934"><span class="hs-identifier hs-var">hsc_env0</span></a></span><span>
</span><span id="line-318"></span><span>       </span><span id="local-6989586621681201882"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621681201882"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-319"></span><span>          </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201797"><span class="hs-identifier hs-var">dflags2</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">includePaths :: IncludeSpecs
</span><a href="GHC.Driver.Session.html#includePaths"><span class="hs-identifier hs-var">includePaths</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IncludeSpecs -&gt; [String] -&gt; IncludeSpecs
</span><a href="GHC.Driver.Session.html#addImplicitQuoteInclude"><span class="hs-identifier hs-var">addImplicitQuoteInclude</span></a></span><span> </span><span class="annot"><span class="annottext">IncludeSpecs
</span><a href="#local-6989586621681201793"><span class="hs-identifier hs-var">old_paths</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201795"><span class="hs-identifier hs-var">current_dir</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-320"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">log_action :: LogAction
</span><a href="GHC.Driver.Session.html#log_action"><span class="hs-identifier hs-var">log_action</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; LogAction
</span><a href="GHC.Driver.Session.html#log_action"><span class="hs-identifier hs-var hs-var">log_action</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201791"><span class="hs-identifier hs-var">prevailing_dflags</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-321"></span><span>                  </span><span class="hs-comment">-- use the prevailing log_action / log_finaliser,</span><span>
</span><span id="line-322"></span><span>                  </span><span class="hs-comment">-- not the one cached in the summary.  This is so</span><span>
</span><span id="line-323"></span><span>                  </span><span class="hs-comment">-- that we can change the log_action without having</span><span>
</span><span id="line-324"></span><span>                  </span><span class="hs-comment">-- to re-summarize all the source files.</span><span>
</span><span id="line-325"></span><span>       </span><span id="local-6989586621681201919"><span class="annot"><span class="annottext">hsc_env :: HscEnv
</span><a href="#local-6989586621681201919"><span class="hs-identifier hs-var hs-var">hsc_env</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681201934"><span class="hs-identifier hs-var">hsc_env0</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">hsc_dflags :: DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201882"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-326"></span><span>
</span><span id="line-327"></span><span>       </span><span class="hs-comment">-- Figure out what lang we're generating</span><span>
</span><span id="line-328"></span><span>       </span><span id="local-6989586621681201906"><span class="annot"><span class="annottext">hsc_lang :: HscTarget
</span><a href="#local-6989586621681201906"><span class="hs-identifier hs-var hs-var">hsc_lang</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; HscTarget
</span><a href="GHC.Driver.Session.html#hscTarget"><span class="hs-identifier hs-var hs-var">hscTarget</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201882"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-329"></span><span>
</span><span id="line-330"></span><span>       </span><span class="hs-comment">-- -fforce-recomp should also work with --make</span><span>
</span><span id="line-331"></span><span>       </span><span id="local-6989586621681201787"><span class="annot"><span class="annottext">force_recomp :: Bool
</span><a href="#local-6989586621681201787"><span class="hs-identifier hs-var hs-var">force_recomp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_ForceRecomp"><span class="hs-identifier hs-var">Opt_ForceRecomp</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201882"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-332"></span><span>       </span><span id="local-6989586621681201918"><span class="annot"><span class="annottext">source_modified :: SourceModified
</span><a href="#local-6989586621681201918"><span class="hs-identifier hs-var hs-var">source_modified</span></a></span></span><span>
</span><span id="line-333"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681201787"><span class="hs-identifier hs-var">force_recomp</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourceModified
</span><a href="GHC.Driver.Types.html#SourceModified"><span class="hs-identifier hs-var">SourceModified</span></a></span><span>
</span><span id="line-334"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourceModified
</span><a href="#local-6989586621681201928"><span class="hs-identifier hs-var">source_modified0</span></a></span><span>
</span><span id="line-335"></span><span>
</span><span id="line-336"></span><span>       </span><span id="local-6989586621681201920"><span class="annot"><span class="annottext">always_do_basic_recompilation_check :: Bool
</span><a href="#local-6989586621681201920"><span class="hs-identifier hs-var hs-var">always_do_basic_recompilation_check</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HscTarget
</span><a href="#local-6989586621681201906"><span class="hs-identifier hs-var">hsc_lang</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-337"></span><span>                                             </span><span class="annot"><span class="annottext">HscTarget
</span><a href="GHC.Driver.Session.html#HscInterpreted"><span class="hs-identifier hs-var">HscInterpreted</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-338"></span><span>                                             </span><span class="annot"><span class="annottext">HscTarget
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-339"></span><span>
</span><span id="line-340"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-341"></span><span class="hs-comment">-- stub .h and .c files (for foreign export support), and cc files.</span><span>
</span><span id="line-342"></span><span>
</span><span id="line-343"></span><span class="hs-comment">-- The _stub.c file is derived from the haskell source file, possibly taking</span><span>
</span><span id="line-344"></span><span class="hs-comment">-- into account the -stubdir option.</span><span>
</span><span id="line-345"></span><span class="hs-comment">--</span><span>
</span><span id="line-346"></span><span class="hs-comment">-- The object file created by compiling the _stub.c file is put into a</span><span>
</span><span id="line-347"></span><span class="hs-comment">-- temporary file, which will be later combined with the main .o file</span><span>
</span><span id="line-348"></span><span class="hs-comment">-- (see the MergeForeigns phase).</span><span>
</span><span id="line-349"></span><span class="hs-comment">--</span><span>
</span><span id="line-350"></span><span class="hs-comment">-- Moreover, we also let the user emit arbitrary C/C++/ObjC/ObjC++ files</span><span>
</span><span id="line-351"></span><span class="hs-comment">-- from TH, that are then compiled and linked to the module. This is</span><span>
</span><span id="line-352"></span><span class="hs-comment">-- useful to implement facilities such as inline-c.</span><span>
</span><span id="line-353"></span><span>
</span><span id="line-354"></span><span class="annot"><a href="GHC.Driver.Pipeline.html#compileForeign"><span class="hs-identifier hs-type">compileForeign</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghc-boot-th/src/GHC.ForeignSrcLang.Type.html#ForeignSrcLang"><span class="hs-identifier hs-type">ForeignSrcLang</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="../../base/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>
</span><span id="line-355"></span><span id="compileForeign"><span class="annot"><span class="annottext">compileForeign :: HscEnv -&gt; ForeignSrcLang -&gt; String -&gt; IO String
</span><a href="GHC.Driver.Pipeline.html#compileForeign"><span class="hs-identifier hs-var hs-var">compileForeign</span></a></span></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ForeignSrcLang
</span><a href="../../ghc-boot-th/src/GHC.ForeignSrcLang.Type.html#RawObject"><span class="hs-identifier hs-var">RawObject</span></a></span><span> </span><span id="local-6989586621681201782"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201782"><span class="hs-identifier hs-var">object_file</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO String
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201782"><span class="hs-identifier hs-var">object_file</span></a></span><span>
</span><span id="line-356"></span><span class="annot"><a href="GHC.Driver.Pipeline.html#compileForeign"><span class="hs-identifier hs-var">compileForeign</span></a></span><span> </span><span id="local-6989586621681201781"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681201781"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681201780"><span class="annot"><span class="annottext">ForeignSrcLang
</span><a href="#local-6989586621681201780"><span class="hs-identifier hs-var">lang</span></a></span></span><span> </span><span id="local-6989586621681201779"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201779"><span class="hs-identifier hs-var">stub_c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-357"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201778"><span class="annot"><span class="annottext">phase :: Phase
</span><a href="#local-6989586621681201778"><span class="hs-identifier hs-var hs-var">phase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ForeignSrcLang
</span><a href="#local-6989586621681201780"><span class="hs-identifier hs-var">lang</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-358"></span><span>              </span><span class="annot"><span class="annottext">ForeignSrcLang
</span><a href="../../ghc-boot-th/src/GHC.ForeignSrcLang.Type.html#LangC"><span class="hs-identifier hs-var">LangC</span></a></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#Cc"><span class="hs-identifier hs-var">Cc</span></a></span><span>
</span><span id="line-359"></span><span>              </span><span class="annot"><span class="annottext">ForeignSrcLang
</span><a href="../../ghc-boot-th/src/GHC.ForeignSrcLang.Type.html#LangCxx"><span class="hs-identifier hs-var">LangCxx</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#Ccxx"><span class="hs-identifier hs-var">Ccxx</span></a></span><span>
</span><span id="line-360"></span><span>              </span><span class="annot"><span class="annottext">ForeignSrcLang
</span><a href="../../ghc-boot-th/src/GHC.ForeignSrcLang.Type.html#LangObjc"><span class="hs-identifier hs-var">LangObjc</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#Cobjc"><span class="hs-identifier hs-var">Cobjc</span></a></span><span>
</span><span id="line-361"></span><span>              </span><span class="annot"><span class="annottext">ForeignSrcLang
</span><a href="../../ghc-boot-th/src/GHC.ForeignSrcLang.Type.html#LangObjcxx"><span class="hs-identifier hs-var">LangObjcxx</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#Cobjcxx"><span class="hs-identifier hs-var">Cobjcxx</span></a></span><span>
</span><span id="line-362"></span><span>              </span><span class="annot"><span class="annottext">ForeignSrcLang
</span><a href="../../ghc-boot-th/src/GHC.ForeignSrcLang.Type.html#LangAsm"><span class="hs-identifier hs-var">LangAsm</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Phase
</span><a href="GHC.Driver.Phases.html#As"><span class="hs-identifier hs-var">As</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-comment">-- allow CPP</span><span class="hs-cpp">
#if __GLASGOW_HASKELL__ &lt; 811
</span><span>              </span><span class="hs-identifier">RawObject</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">panic</span><span> </span><span class="hs-string">&quot;compileForeign: should be unreachable&quot;</span><span class="hs-cpp">
#endif
</span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681201767"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201767"><span class="hs-identifier hs-var">stub_o</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe ModIface
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Phase
-&gt; HscEnv
-&gt; (String, Maybe InputFileBuffer, Maybe PhasePlus)
-&gt; Maybe String
-&gt; PipelineOutput
-&gt; Maybe ModLocation
-&gt; [String]
-&gt; IO (DynFlags, String, Maybe ModIface)
</span><a href="GHC.Driver.Pipeline.html#runPipeline"><span class="hs-identifier hs-var">runPipeline</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#StopLn"><span class="hs-identifier hs-var">StopLn</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681201781"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-367"></span><span>                       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201779"><span class="hs-identifier hs-var">stub_c</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe InputFileBuffer
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PhasePlus -&gt; Maybe PhasePlus
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Phase -&gt; PhasePlus
</span><a href="GHC.Driver.Pipeline.Monad.html#RealPhase"><span class="hs-identifier hs-var">RealPhase</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201778"><span class="hs-identifier hs-var">phase</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-368"></span><span>                       </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TempFileLifetime -&gt; PipelineOutput
</span><a href="GHC.Driver.Pipeline.Monad.html#Temporary"><span class="hs-identifier hs-var">Temporary</span></a></span><span> </span><span class="annot"><span class="annottext">TempFileLifetime
</span><a href="GHC.SysTools.FileCleanup.html#TFL_GhcSession"><span class="hs-identifier hs-var">TFL_GhcSession</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-369"></span><span>                       </span><span class="annot"><span class="annottext">Maybe ModLocation
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-comment">{-no ModLocation-}</span><span>
</span><span id="line-370"></span><span>                       </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-371"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; IO String
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201767"><span class="hs-identifier hs-var">stub_o</span></a></span><span>
</span><span id="line-372"></span><span>
</span><span id="line-373"></span><span class="annot"><a href="GHC.Driver.Pipeline.html#compileStub"><span class="hs-identifier hs-type">compileStub</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="../../base/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>
</span><span id="line-374"></span><span id="compileStub"><span class="annot"><span class="annottext">compileStub :: HscEnv -&gt; String -&gt; IO String
</span><a href="GHC.Driver.Pipeline.html#compileStub"><span class="hs-identifier hs-var hs-var">compileStub</span></a></span></span><span> </span><span id="local-6989586621681201766"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681201766"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681201765"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201765"><span class="hs-identifier hs-var">stub_c</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; ForeignSrcLang -&gt; String -&gt; IO String
</span><a href="GHC.Driver.Pipeline.html#compileForeign"><span class="hs-identifier hs-var">compileForeign</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681201766"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignSrcLang
</span><a href="../../ghc-boot-th/src/GHC.ForeignSrcLang.Type.html#LangC"><span class="hs-identifier hs-var">LangC</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201765"><span class="hs-identifier hs-var">stub_c</span></a></span><span>
</span><span id="line-375"></span><span>
</span><span id="line-376"></span><span class="annot"><a href="GHC.Driver.Pipeline.html#compileEmptyStub"><span class="hs-identifier hs-type">compileEmptyStub</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Location.html#ModLocation"><span class="hs-identifier hs-type">ModLocation</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-377"></span><span id="compileEmptyStub"><span class="annot"><span class="annottext">compileEmptyStub :: DynFlags -&gt; HscEnv -&gt; String -&gt; ModLocation -&gt; ModuleName -&gt; IO ()
</span><a href="GHC.Driver.Pipeline.html#compileEmptyStub"><span class="hs-identifier hs-var hs-var">compileEmptyStub</span></a></span></span><span> </span><span id="local-6989586621681201763"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201763"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621681201762"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681201762"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681201761"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201761"><span class="hs-identifier hs-var">basename</span></a></span></span><span> </span><span id="local-6989586621681201760"><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681201760"><span class="hs-identifier hs-var">location</span></a></span></span><span> </span><span id="local-6989586621681201759"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681201759"><span class="hs-identifier hs-var">mod_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-378"></span><span>  </span><span class="hs-comment">-- To maintain the invariant that every Haskell file</span><span>
</span><span id="line-379"></span><span>  </span><span class="hs-comment">-- compiles to object code, we make an empty (but</span><span>
</span><span id="line-380"></span><span>  </span><span class="hs-comment">-- valid) stub object file for signatures.  However,</span><span>
</span><span id="line-381"></span><span>  </span><span class="hs-comment">-- we make sure this object file has a unique symbol,</span><span>
</span><span id="line-382"></span><span>  </span><span class="hs-comment">-- so that ranlib on OS X doesn't complain, see</span><span>
</span><span id="line-383"></span><span>  </span><span class="hs-comment">-- https://gitlab.haskell.org/ghc/ghc/issues/12673</span><span>
</span><span id="line-384"></span><span>  </span><span class="hs-comment">-- and https://github.com/haskell/cabal/issues/2257</span><span>
</span><span id="line-385"></span><span>  </span><span id="local-6989586621681201758"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201758"><span class="hs-identifier hs-var">empty_stub</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; TempFileLifetime -&gt; String -&gt; IO String
</span><a href="GHC.SysTools.FileCleanup.html#newTempName"><span class="hs-identifier hs-var">newTempName</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201763"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">TempFileLifetime
</span><a href="GHC.SysTools.FileCleanup.html#TFL_CurrentModule"><span class="hs-identifier hs-var">TFL_CurrentModule</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;c&quot;</span></span><span>
</span><span id="line-386"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201754"><span class="annot"><span class="annottext">src :: SDoc
</span><a href="#local-6989586621681201754"><span class="hs-identifier hs-var hs-var">src</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;int&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Module -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; ModuleName -&gt; Module
</span><a href="GHC.Driver.Session.html#mkHomeModule"><span class="hs-identifier hs-var">mkHomeModule</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201763"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681201759"><span class="hs-identifier hs-var">mod_name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;= 0;&quot;</span></span><span>
</span><span id="line-387"></span><span>  </span><span class="annot"><span class="annottext">String -&gt; String -&gt; IO ()
</span><a href="../../base/src/System.IO.html#writeFile"><span class="hs-identifier hs-var">writeFile</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201758"><span class="hs-identifier hs-var">empty_stub</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; SDoc -&gt; String
</span><a href="GHC.Utils.Outputable.html#showSDoc"><span class="hs-identifier hs-var">showSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201763"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CodeStyle -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pprCode"><span class="hs-identifier hs-var">pprCode</span></a></span><span> </span><span class="annot"><span class="annottext">CodeStyle
</span><a href="GHC.Utils.Outputable.html#CStyle"><span class="hs-identifier hs-var">CStyle</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681201754"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-388"></span><span>  </span><span class="annot"><span class="annottext">(DynFlags, String, Maybe ModIface)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Phase
-&gt; HscEnv
-&gt; (String, Maybe InputFileBuffer, Maybe PhasePlus)
-&gt; Maybe String
-&gt; PipelineOutput
-&gt; Maybe ModLocation
-&gt; [String]
-&gt; IO (DynFlags, String, Maybe ModIface)
</span><a href="GHC.Driver.Pipeline.html#runPipeline"><span class="hs-identifier hs-var">runPipeline</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#StopLn"><span class="hs-identifier hs-var">StopLn</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681201762"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-389"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201758"><span class="hs-identifier hs-var">empty_stub</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe InputFileBuffer
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe PhasePlus
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-390"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Maybe String
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201761"><span class="hs-identifier hs-var">basename</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-391"></span><span>                  </span><span class="annot"><span class="annottext">PipelineOutput
</span><a href="GHC.Driver.Pipeline.Monad.html#Persistent"><span class="hs-identifier hs-var">Persistent</span></a></span><span>
</span><span id="line-392"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModLocation -&gt; Maybe ModLocation
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681201760"><span class="hs-identifier hs-var">location</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-393"></span><span>                  </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-394"></span><span>  </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-395"></span><span>
</span><span id="line-396"></span><span class="hs-comment">-- ---------------------------------------------------------------------------</span><span>
</span><span id="line-397"></span><span class="hs-comment">-- Link</span><span>
</span><span id="line-398"></span><span class="hs-comment">--</span><span>
</span><span id="line-399"></span><span class="hs-comment">-- Note [Dynamic linking on macOS]</span><span>
</span><span id="line-400"></span><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><span id="line-401"></span><span class="hs-comment">--</span><span>
</span><span id="line-402"></span><span class="hs-comment">-- Since macOS Sierra (10.14), the dynamic system linker enforces</span><span>
</span><span id="line-403"></span><span class="hs-comment">-- a limit on the Load Commands.  Specifically the Load Command Size</span><span>
</span><span id="line-404"></span><span class="hs-comment">-- Limit is at 32K (32768).  The Load Commands contain the install</span><span>
</span><span id="line-405"></span><span class="hs-comment">-- name, dependencies, runpaths, and a few other commands.  We however</span><span>
</span><span id="line-406"></span><span class="hs-comment">-- only have control over the install name, dependencies and runpaths.</span><span>
</span><span id="line-407"></span><span class="hs-comment">--</span><span>
</span><span id="line-408"></span><span class="hs-comment">-- The install name is the name by which this library will be</span><span>
</span><span id="line-409"></span><span class="hs-comment">-- referenced.  This is such that we do not need to bake in the full</span><span>
</span><span id="line-410"></span><span class="hs-comment">-- absolute location of the library, and can move the library around.</span><span>
</span><span id="line-411"></span><span class="hs-comment">--</span><span>
</span><span id="line-412"></span><span class="hs-comment">-- The dependency commands contain the install names from of referenced</span><span>
</span><span id="line-413"></span><span class="hs-comment">-- libraries.  Thus if a libraries install name is @rpath/libHS...dylib,</span><span>
</span><span id="line-414"></span><span class="hs-comment">-- that will end up as the dependency.</span><span>
</span><span id="line-415"></span><span class="hs-comment">--</span><span>
</span><span id="line-416"></span><span class="hs-comment">-- Finally we have the runpaths, which informs the linker about the</span><span>
</span><span id="line-417"></span><span class="hs-comment">-- directories to search for the referenced dependencies.</span><span>
</span><span id="line-418"></span><span class="hs-comment">--</span><span>
</span><span id="line-419"></span><span class="hs-comment">-- The system linker can do recursive linking, however using only the</span><span>
</span><span id="line-420"></span><span class="hs-comment">-- direct dependencies conflicts with ghc's ability to inline across</span><span>
</span><span id="line-421"></span><span class="hs-comment">-- packages, and as such would end up with unresolved symbols.</span><span>
</span><span id="line-422"></span><span class="hs-comment">--</span><span>
</span><span id="line-423"></span><span class="hs-comment">-- Thus we will pass the full dependency closure to the linker, and then</span><span>
</span><span id="line-424"></span><span class="hs-comment">-- ask the linker to remove any unused dynamic libraries (-dead_strip_dylibs).</span><span>
</span><span id="line-425"></span><span class="hs-comment">--</span><span>
</span><span id="line-426"></span><span class="hs-comment">-- We still need to add the relevant runpaths, for the dynamic linker to</span><span>
</span><span id="line-427"></span><span class="hs-comment">-- lookup the referenced libraries though.  The linker (ld64) does not</span><span>
</span><span id="line-428"></span><span class="hs-comment">-- have any option to dead strip runpaths; which makes sense as runpaths</span><span>
</span><span id="line-429"></span><span class="hs-comment">-- can be used for dependencies of dependencies as well.</span><span>
</span><span id="line-430"></span><span class="hs-comment">--</span><span>
</span><span id="line-431"></span><span class="hs-comment">-- The solution we then take in GHC is to not pass any runpaths to the</span><span>
</span><span id="line-432"></span><span class="hs-comment">-- linker at link time, but inject them after the linking.  For this to</span><span>
</span><span id="line-433"></span><span class="hs-comment">-- work we'll need to ask the linker to create enough space in the header</span><span>
</span><span id="line-434"></span><span class="hs-comment">-- to add more runpaths after the linking (-headerpad 8000).</span><span>
</span><span id="line-435"></span><span class="hs-comment">--</span><span>
</span><span id="line-436"></span><span class="hs-comment">-- After the library has been linked by $LD (usually ld64), we will use</span><span>
</span><span id="line-437"></span><span class="hs-comment">-- otool to inspect the libraries left over after dead stripping, compute</span><span>
</span><span id="line-438"></span><span class="hs-comment">-- the relevant runpaths, and inject them into the linked product using</span><span>
</span><span id="line-439"></span><span class="hs-comment">-- the install_name_tool command.</span><span>
</span><span id="line-440"></span><span class="hs-comment">--</span><span>
</span><span id="line-441"></span><span class="hs-comment">-- This strategy should produce the smallest possible set of load commands</span><span>
</span><span id="line-442"></span><span class="hs-comment">-- while still retaining some form of relocatability via runpaths.</span><span>
</span><span id="line-443"></span><span class="hs-comment">--</span><span>
</span><span id="line-444"></span><span class="hs-comment">-- The only way I can see to reduce the load command size further would be</span><span>
</span><span id="line-445"></span><span class="hs-comment">-- by shortening the library names, or start putting libraries into the same</span><span>
</span><span id="line-446"></span><span class="hs-comment">-- folders, such that one runpath would be sufficient for multiple/all</span><span>
</span><span id="line-447"></span><span class="hs-comment">-- libraries.</span><span>
</span><span id="line-448"></span><span class="annot"><a href="GHC.Driver.Pipeline.html#link"><span class="hs-identifier hs-type">link</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#GhcLink"><span class="hs-identifier hs-type">GhcLink</span></a></span><span>                 </span><span class="hs-comment">-- interactive or batch</span><span>
</span><span id="line-449"></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span>                </span><span class="hs-comment">-- dynamic flags</span><span>
</span><span id="line-450"></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>                    </span><span class="hs-comment">-- attempt linking in batch mode?</span><span>
</span><span id="line-451"></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HomePackageTable"><span class="hs-identifier hs-type">HomePackageTable</span></a></span><span>        </span><span class="hs-comment">-- what to link</span><span>
</span><span id="line-452"></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#SuccessFlag"><span class="hs-identifier hs-type">SuccessFlag</span></a></span><span>
</span><span id="line-453"></span><span>
</span><span id="line-454"></span><span class="hs-comment">-- For the moment, in the batch linker, we don't bother to tell doLink</span><span>
</span><span id="line-455"></span><span class="hs-comment">-- which packages to link -- it just tries all that are available.</span><span>
</span><span id="line-456"></span><span class="hs-comment">-- batch_attempt_linking should only be *looked at* in batch mode.  It</span><span>
</span><span id="line-457"></span><span class="hs-comment">-- should only be True if the upsweep was successful and someone</span><span>
</span><span id="line-458"></span><span class="hs-comment">-- exports main, i.e., we have good reason to believe that linking</span><span>
</span><span id="line-459"></span><span class="hs-comment">-- will succeed.</span><span>
</span><span id="line-460"></span><span>
</span><span id="line-461"></span><span id="link"><span class="annot"><span class="annottext">link :: GhcLink -&gt; DynFlags -&gt; Bool -&gt; HomePackageTable -&gt; IO SuccessFlag
</span><a href="GHC.Driver.Pipeline.html#link"><span class="hs-identifier hs-var hs-var">link</span></a></span></span><span> </span><span id="local-6989586621681201747"><span class="annot"><span class="annottext">GhcLink
</span><a href="#local-6989586621681201747"><span class="hs-identifier hs-var">ghcLink</span></a></span></span><span> </span><span id="local-6989586621681201746"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201746"><span class="hs-identifier hs-var">dflags</span></a></span></span><span>
</span><span id="line-462"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Hooks
 -&gt; Maybe
      (GhcLink
       -&gt; DynFlags -&gt; Bool -&gt; HomePackageTable -&gt; IO SuccessFlag))
-&gt; (GhcLink
    -&gt; DynFlags -&gt; Bool -&gt; HomePackageTable -&gt; IO SuccessFlag)
-&gt; DynFlags
-&gt; GhcLink
-&gt; DynFlags
-&gt; Bool
-&gt; HomePackageTable
-&gt; IO SuccessFlag
forall a. (Hooks -&gt; Maybe a) -&gt; a -&gt; DynFlags -&gt; a
</span><a href="GHC.Driver.Hooks.html#lookupHook"><span class="hs-identifier hs-var">lookupHook</span></a></span><span> </span><span class="annot"><span class="annottext">Hooks
-&gt; Maybe
     (GhcLink -&gt; DynFlags -&gt; Bool -&gt; HomePackageTable -&gt; IO SuccessFlag)
</span><a href="GHC.Driver.Hooks.html#linkHook"><span class="hs-identifier hs-var hs-var">linkHook</span></a></span><span> </span><span class="annot"><span class="annottext">GhcLink -&gt; DynFlags -&gt; Bool -&gt; HomePackageTable -&gt; IO SuccessFlag
</span><a href="#local-6989586621681201743"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201746"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">GhcLink
</span><a href="#local-6989586621681201747"><span class="hs-identifier hs-var">ghcLink</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201746"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-463"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-464"></span><span>    </span><span id="local-6989586621681201743"><span class="annot"><span class="annottext">l :: GhcLink -&gt; DynFlags -&gt; Bool -&gt; HomePackageTable -&gt; IO SuccessFlag
</span><a href="#local-6989586621681201743"><span class="hs-identifier hs-var hs-var">l</span></a></span></span><span> </span><span class="annot"><span class="annottext">GhcLink
</span><a href="GHC.Driver.Session.html#LinkInMemory"><span class="hs-identifier hs-var">LinkInMemory</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">HomePackageTable
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-465"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">PlatformMisc -&gt; Bool
</span><a href="../../ghc-boot/src/GHC.Platform.html#platformMisc_ghcWithInterpreter"><span class="hs-identifier hs-var hs-var">platformMisc_ghcWithInterpreter</span></a></span><span> </span><span class="annot"><span class="annottext">(PlatformMisc -&gt; Bool) -&gt; PlatformMisc -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; PlatformMisc
</span><a href="GHC.Driver.Session.html#platformMisc"><span class="hs-identifier hs-var hs-var">platformMisc</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201746"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-466"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-comment">-- Not Linking...(demand linker will do the job)</span><span>
</span><span id="line-467"></span><span>             </span><span class="annot"><span class="annottext">SuccessFlag -&gt; IO SuccessFlag
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">SuccessFlag
</span><a href="GHC.Types.Basic.html#Succeeded"><span class="hs-identifier hs-var">Succeeded</span></a></span><span>
</span><span id="line-468"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">GhcLink -&gt; IO SuccessFlag
forall a. GhcLink -&gt; a
</span><a href="GHC.Driver.Pipeline.html#panicBadLink"><span class="hs-identifier hs-var">panicBadLink</span></a></span><span> </span><span class="annot"><span class="annottext">GhcLink
</span><a href="GHC.Driver.Session.html#LinkInMemory"><span class="hs-identifier hs-var">LinkInMemory</span></a></span><span>
</span><span id="line-469"></span><span>
</span><span id="line-470"></span><span>    </span><span class="annot"><a href="#local-6989586621681201743"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">GhcLink
</span><a href="GHC.Driver.Session.html#NoLink"><span class="hs-identifier hs-var">NoLink</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">HomePackageTable
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-471"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SuccessFlag -&gt; IO SuccessFlag
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">SuccessFlag
</span><a href="GHC.Types.Basic.html#Succeeded"><span class="hs-identifier hs-var">Succeeded</span></a></span><span>
</span><span id="line-472"></span><span>
</span><span id="line-473"></span><span>    </span><span class="annot"><a href="#local-6989586621681201743"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">GhcLink
</span><a href="GHC.Driver.Session.html#LinkBinary"><span class="hs-identifier hs-var">LinkBinary</span></a></span><span> </span><span id="local-6989586621681201733"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201733"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621681201732"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681201732"><span class="hs-identifier hs-var">batch_attempt_linking</span></a></span></span><span> </span><span id="local-6989586621681201731"><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621681201731"><span class="hs-identifier hs-var">hpt</span></a></span></span><span>
</span><span id="line-474"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool -&gt; HomePackageTable -&gt; IO SuccessFlag
</span><a href="GHC.Driver.Pipeline.html#link%27"><span class="hs-identifier hs-var">link'</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201733"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681201732"><span class="hs-identifier hs-var">batch_attempt_linking</span></a></span><span> </span><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621681201731"><span class="hs-identifier hs-var">hpt</span></a></span><span>
</span><span id="line-475"></span><span>
</span><span id="line-476"></span><span>    </span><span class="annot"><a href="#local-6989586621681201743"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">GhcLink
</span><a href="GHC.Driver.Session.html#LinkStaticLib"><span class="hs-identifier hs-var">LinkStaticLib</span></a></span><span> </span><span id="local-6989586621681201728"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201728"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621681201727"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681201727"><span class="hs-identifier hs-var">batch_attempt_linking</span></a></span></span><span> </span><span id="local-6989586621681201726"><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621681201726"><span class="hs-identifier hs-var">hpt</span></a></span></span><span>
</span><span id="line-477"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool -&gt; HomePackageTable -&gt; IO SuccessFlag
</span><a href="GHC.Driver.Pipeline.html#link%27"><span class="hs-identifier hs-var">link'</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201728"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681201727"><span class="hs-identifier hs-var">batch_attempt_linking</span></a></span><span> </span><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621681201726"><span class="hs-identifier hs-var">hpt</span></a></span><span>
</span><span id="line-478"></span><span>
</span><span id="line-479"></span><span>    </span><span class="annot"><a href="#local-6989586621681201743"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">GhcLink
</span><a href="GHC.Driver.Session.html#LinkDynLib"><span class="hs-identifier hs-var">LinkDynLib</span></a></span><span> </span><span id="local-6989586621681201724"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201724"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621681201723"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681201723"><span class="hs-identifier hs-var">batch_attempt_linking</span></a></span></span><span> </span><span id="local-6989586621681201722"><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621681201722"><span class="hs-identifier hs-var">hpt</span></a></span></span><span>
</span><span id="line-480"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool -&gt; HomePackageTable -&gt; IO SuccessFlag
</span><a href="GHC.Driver.Pipeline.html#link%27"><span class="hs-identifier hs-var">link'</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201724"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681201723"><span class="hs-identifier hs-var">batch_attempt_linking</span></a></span><span> </span><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621681201722"><span class="hs-identifier hs-var">hpt</span></a></span><span>
</span><span id="line-481"></span><span>
</span><span id="line-482"></span><span id="local-6989586621681202628"><span class="annot"><a href="GHC.Driver.Pipeline.html#panicBadLink"><span class="hs-identifier hs-type">panicBadLink</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#GhcLink"><span class="hs-identifier hs-type">GhcLink</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681202628"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-483"></span><span id="panicBadLink"><span class="annot"><span class="annottext">panicBadLink :: forall a. GhcLink -&gt; a
</span><a href="GHC.Driver.Pipeline.html#panicBadLink"><span class="hs-identifier hs-var hs-var">panicBadLink</span></a></span></span><span> </span><span id="local-6989586621681201719"><span class="annot"><span class="annottext">GhcLink
</span><a href="#local-6989586621681201719"><span class="hs-identifier hs-var">other</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; a
forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;link: GHC not built to link this way: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-484"></span><span>                            </span><span class="annot"><span class="annottext">GhcLink -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../base/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">GhcLink
</span><a href="#local-6989586621681201719"><span class="hs-identifier hs-var">other</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-485"></span><span>
</span><span id="line-486"></span><span class="annot"><a href="GHC.Driver.Pipeline.html#link%27"><span class="hs-identifier hs-type">link'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span>                </span><span class="hs-comment">-- dynamic flags</span><span>
</span><span id="line-487"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>                    </span><span class="hs-comment">-- attempt linking in batch mode?</span><span>
</span><span id="line-488"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HomePackageTable"><span class="hs-identifier hs-type">HomePackageTable</span></a></span><span>        </span><span class="hs-comment">-- what to link</span><span>
</span><span id="line-489"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#SuccessFlag"><span class="hs-identifier hs-type">SuccessFlag</span></a></span><span>
</span><span id="line-490"></span><span>
</span><span id="line-491"></span><span id="link%27"><span class="annot"><span class="annottext">link' :: DynFlags -&gt; Bool -&gt; HomePackageTable -&gt; IO SuccessFlag
</span><a href="GHC.Driver.Pipeline.html#link%27"><span class="hs-identifier hs-var hs-var">link'</span></a></span></span><span> </span><span id="local-6989586621681201717"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201717"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621681201716"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681201716"><span class="hs-identifier hs-var">batch_attempt_linking</span></a></span></span><span> </span><span id="local-6989586621681201715"><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621681201715"><span class="hs-identifier hs-var">hpt</span></a></span></span><span>
</span><span id="line-492"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681201716"><span class="hs-identifier hs-var">batch_attempt_linking</span></a></span><span>
</span><span id="line-493"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-494"></span><span>        </span><span class="hs-keyword">let</span><span>
</span><span id="line-495"></span><span>            </span><span id="local-6989586621681201714"><span class="annot"><span class="annottext">staticLink :: Bool
</span><a href="#local-6989586621681201714"><span class="hs-identifier hs-var hs-var">staticLink</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; GhcLink
</span><a href="GHC.Driver.Session.html#ghcLink"><span class="hs-identifier hs-var hs-var">ghcLink</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201717"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-496"></span><span>                          </span><span class="annot"><span class="annottext">GhcLink
</span><a href="GHC.Driver.Session.html#LinkStaticLib"><span class="hs-identifier hs-var">LinkStaticLib</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-497"></span><span>                          </span><span class="annot"><span class="annottext">GhcLink
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-498"></span><span>
</span><span id="line-499"></span><span>            </span><span id="local-6989586621681201712"><span class="annot"><span class="annottext">home_mod_infos :: [HomeModInfo]
</span><a href="#local-6989586621681201712"><span class="hs-identifier hs-var hs-var">home_mod_infos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HomePackageTable -&gt; [HomeModInfo]
</span><a href="GHC.Driver.Types.html#eltsHpt"><span class="hs-identifier hs-var">eltsHpt</span></a></span><span> </span><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621681201715"><span class="hs-identifier hs-var">hpt</span></a></span><span>
</span><span id="line-500"></span><span>
</span><span id="line-501"></span><span>            </span><span class="hs-comment">-- the packages we depend on</span><span>
</span><span id="line-502"></span><span>            </span><span id="local-6989586621681201709"><span class="annot"><span class="annottext">pkg_deps :: [UnitId]
</span><a href="#local-6989586621681201709"><span class="hs-identifier hs-var hs-var">pkg_deps</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HomeModInfo -&gt; [UnitId]) -&gt; [HomeModInfo] -&gt; [UnitId]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><a href="../../base/src/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((UnitId, Bool) -&gt; UnitId) -&gt; [(UnitId, Bool)] -&gt; [UnitId]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">(UnitId, Bool) -&gt; UnitId
forall a b. (a, b) -&gt; a
</span><a href="../../base/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">([(UnitId, Bool)] -&gt; [UnitId])
-&gt; (HomeModInfo -&gt; [(UnitId, Bool)]) -&gt; HomeModInfo -&gt; [UnitId]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Dependencies -&gt; [(UnitId, Bool)]
</span><a href="GHC.Driver.Types.html#dep_pkgs"><span class="hs-identifier hs-var hs-var">dep_pkgs</span></a></span><span> </span><span class="annot"><span class="annottext">(Dependencies -&gt; [(UnitId, Bool)])
-&gt; (HomeModInfo -&gt; Dependencies) -&gt; HomeModInfo -&gt; [(UnitId, Bool)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface -&gt; Dependencies
forall (phase :: ModIfacePhase). ModIface_ phase -&gt; Dependencies
</span><a href="GHC.Driver.Types.html#mi_deps"><span class="hs-identifier hs-var hs-var">mi_deps</span></a></span><span> </span><span class="annot"><span class="annottext">(ModIface -&gt; Dependencies)
-&gt; (HomeModInfo -&gt; ModIface) -&gt; HomeModInfo -&gt; Dependencies
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModInfo -&gt; ModIface
</span><a href="GHC.Driver.Types.html#hm_iface"><span class="hs-identifier hs-var hs-var">hm_iface</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[HomeModInfo]
</span><a href="#local-6989586621681201712"><span class="hs-identifier hs-var">home_mod_infos</span></a></span><span>
</span><span id="line-503"></span><span>
</span><span id="line-504"></span><span>            </span><span class="hs-comment">-- the linkables to link</span><span>
</span><span id="line-505"></span><span>            </span><span id="local-6989586621681201701"><span class="annot"><span class="annottext">linkables :: [Linkable]
</span><a href="#local-6989586621681201701"><span class="hs-identifier hs-var hs-var">linkables</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HomeModInfo -&gt; Linkable) -&gt; [HomeModInfo] -&gt; [Linkable]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Maybe Linkable -&gt; Linkable
forall a. HasCallStack =&gt; String -&gt; Maybe a -&gt; a
</span><a href="GHC.Data.Maybe.html#expectJust"><span class="hs-identifier hs-var">expectJust</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;link&quot;</span></span><span class="annot"><span class="annottext">(Maybe Linkable -&gt; Linkable)
-&gt; (HomeModInfo -&gt; Maybe Linkable) -&gt; HomeModInfo -&gt; Linkable
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span class="annot"><span class="annottext">HomeModInfo -&gt; Maybe Linkable
</span><a href="GHC.Driver.Types.html#hm_linkable"><span class="hs-identifier hs-var hs-var">hm_linkable</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[HomeModInfo]
</span><a href="#local-6989586621681201712"><span class="hs-identifier hs-var">home_mod_infos</span></a></span><span>
</span><span id="line-506"></span><span>
</span><span id="line-507"></span><span>        </span><span class="annot"><span class="annottext">DynFlags -&gt; Int -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201717"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;link: linkables are ...&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Linkable -&gt; SDoc) -&gt; [Linkable] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Linkable -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Linkable]
</span><a href="#local-6989586621681201701"><span class="hs-identifier hs-var">linkables</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-508"></span><span>
</span><span id="line-509"></span><span>        </span><span class="hs-comment">-- check for the -no-link flag</span><span>
</span><span id="line-510"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">GhcLink -&gt; Bool
</span><a href="GHC.Driver.Session.html#isNoLink"><span class="hs-identifier hs-var">isNoLink</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; GhcLink
</span><a href="GHC.Driver.Session.html#ghcLink"><span class="hs-identifier hs-var hs-var">ghcLink</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201717"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-511"></span><span>          </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Int -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201717"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;link(batch): linking omitted (-c flag given).&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-512"></span><span>                  </span><span class="annot"><span class="annottext">SuccessFlag -&gt; IO SuccessFlag
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">SuccessFlag
</span><a href="GHC.Types.Basic.html#Succeeded"><span class="hs-identifier hs-var">Succeeded</span></a></span><span>
</span><span id="line-513"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-514"></span><span>
</span><span id="line-515"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201696"><span class="annot"><span class="annottext">getOfiles :: Linkable -&gt; [String]
</span><a href="#local-6989586621681201696"><span class="hs-identifier hs-var hs-var">getOfiles</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Linker.Types.html#LM"><span class="hs-identifier hs-type">LM</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Module
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681201695"><span class="annot"><span class="annottext">[Unlinked]
</span><a href="#local-6989586621681201695"><span class="hs-identifier hs-var">us</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Unlinked -&gt; String) -&gt; [Unlinked] -&gt; [String]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Unlinked -&gt; String
</span><a href="GHC.Driver.Types.html#nameOfObject"><span class="hs-identifier hs-var">nameOfObject</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Unlinked -&gt; Bool) -&gt; [Unlinked] -&gt; [Unlinked]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="annot"><span class="annottext">Unlinked -&gt; Bool
</span><a href="GHC.Driver.Types.html#isObject"><span class="hs-identifier hs-var">isObject</span></a></span><span> </span><span class="annot"><span class="annottext">[Unlinked]
</span><a href="#local-6989586621681201695"><span class="hs-identifier hs-var">us</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-516"></span><span>            </span><span id="local-6989586621681201691"><span class="annot"><span class="annottext">obj_files :: [String]
</span><a href="#local-6989586621681201691"><span class="hs-identifier hs-var hs-var">obj_files</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Linkable -&gt; [String]) -&gt; [Linkable] -&gt; [String]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><a href="../../base/src/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a></span><span> </span><span class="annot"><span class="annottext">Linkable -&gt; [String]
</span><a href="#local-6989586621681201696"><span class="hs-identifier hs-var">getOfiles</span></a></span><span> </span><span class="annot"><span class="annottext">[Linkable]
</span><a href="#local-6989586621681201701"><span class="hs-identifier hs-var">linkables</span></a></span><span>
</span><span id="line-517"></span><span>
</span><span id="line-518"></span><span>            </span><span id="local-6989586621681201690"><span class="annot"><span class="annottext">exe_file :: String
</span><a href="#local-6989586621681201690"><span class="hs-identifier hs-var hs-var">exe_file</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; DynFlags -&gt; String
</span><a href="GHC.Driver.Pipeline.html#exeFileName"><span class="hs-identifier hs-var">exeFileName</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681201714"><span class="hs-identifier hs-var">staticLink</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201717"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-519"></span><span>
</span><span id="line-520"></span><span>        </span><span id="local-6989586621681201689"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681201689"><span class="hs-identifier hs-var">linking_needed</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool -&gt; [Linkable] -&gt; [UnitId] -&gt; IO Bool
</span><a href="GHC.Driver.Pipeline.html#linkingNeeded"><span class="hs-identifier hs-var">linkingNeeded</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201717"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681201714"><span class="hs-identifier hs-var">staticLink</span></a></span><span> </span><span class="annot"><span class="annottext">[Linkable]
</span><a href="#local-6989586621681201701"><span class="hs-identifier hs-var">linkables</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681201709"><span class="hs-identifier hs-var">pkg_deps</span></a></span><span>
</span><span id="line-521"></span><span>
</span><span id="line-522"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_ForceRecomp"><span class="hs-identifier hs-var">Opt_ForceRecomp</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201717"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681201689"><span class="hs-identifier hs-var">linking_needed</span></a></span><span>
</span><span id="line-523"></span><span>           </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Int -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201717"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201690"><span class="hs-identifier hs-var">exe_file</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;is up to date, linking not required.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-524"></span><span>                   </span><span class="annot"><span class="annottext">SuccessFlag -&gt; IO SuccessFlag
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">SuccessFlag
</span><a href="GHC.Types.Basic.html#Succeeded"><span class="hs-identifier hs-var">Succeeded</span></a></span><span>
</span><span id="line-525"></span><span>           </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-526"></span><span>
</span><span id="line-527"></span><span>        </span><span class="annot"><span class="annottext">DynFlags -&gt; String -&gt; IO ()
</span><a href="GHC.Utils.Error.html#compilationProgressMsg"><span class="hs-identifier hs-var">compilationProgressMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201717"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Linking &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201690"><span class="hs-identifier hs-var">exe_file</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; ...&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-528"></span><span>
</span><span id="line-529"></span><span>        </span><span class="hs-comment">-- Don't showPass in Batch mode; doLink will do that for us.</span><span>
</span><span id="line-530"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201687"><span class="annot"><span class="annottext">link :: DynFlags -&gt; [String] -&gt; [UnitId] -&gt; IO ()
</span><a href="#local-6989586621681201687"><span class="hs-identifier hs-var hs-var">link</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; GhcLink
</span><a href="GHC.Driver.Session.html#ghcLink"><span class="hs-identifier hs-var hs-var">ghcLink</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201717"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-531"></span><span>                </span><span class="annot"><span class="annottext">GhcLink
</span><a href="GHC.Driver.Session.html#LinkBinary"><span class="hs-identifier hs-var">LinkBinary</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [String] -&gt; [UnitId] -&gt; IO ()
</span><a href="GHC.Driver.Pipeline.html#linkBinary"><span class="hs-identifier hs-var">linkBinary</span></a></span><span>
</span><span id="line-532"></span><span>                </span><span class="annot"><span class="annottext">GhcLink
</span><a href="GHC.Driver.Session.html#LinkStaticLib"><span class="hs-identifier hs-var">LinkStaticLib</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [String] -&gt; [UnitId] -&gt; IO ()
</span><a href="GHC.Driver.Pipeline.html#linkStaticLib"><span class="hs-identifier hs-var">linkStaticLib</span></a></span><span>
</span><span id="line-533"></span><span>                </span><span class="annot"><span class="annottext">GhcLink
</span><a href="GHC.Driver.Session.html#LinkDynLib"><span class="hs-identifier hs-var">LinkDynLib</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [String] -&gt; [UnitId] -&gt; IO ()
</span><a href="GHC.Driver.Pipeline.html#linkDynLibCheck"><span class="hs-identifier hs-var">linkDynLibCheck</span></a></span><span>
</span><span id="line-534"></span><span>                </span><span id="local-6989586621681201684"><span class="annot"><span class="annottext">GhcLink
</span><a href="#local-6989586621681201684"><span class="hs-identifier hs-var">other</span></a></span></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GhcLink -&gt; DynFlags -&gt; [String] -&gt; [UnitId] -&gt; IO ()
forall a. GhcLink -&gt; a
</span><a href="GHC.Driver.Pipeline.html#panicBadLink"><span class="hs-identifier hs-var">panicBadLink</span></a></span><span> </span><span class="annot"><span class="annottext">GhcLink
</span><a href="#local-6989586621681201684"><span class="hs-identifier hs-var">other</span></a></span><span>
</span><span id="line-535"></span><span>        </span><span class="annot"><span class="annottext">DynFlags -&gt; [String] -&gt; [UnitId] -&gt; IO ()
</span><a href="#local-6989586621681201687"><span class="hs-identifier hs-var">link</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201717"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201691"><span class="hs-identifier hs-var">obj_files</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681201709"><span class="hs-identifier hs-var">pkg_deps</span></a></span><span>
</span><span id="line-536"></span><span>
</span><span id="line-537"></span><span>        </span><span class="annot"><span class="annottext">DynFlags -&gt; Int -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201717"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;link: done&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-538"></span><span>
</span><span id="line-539"></span><span>        </span><span class="hs-comment">-- linkBinary only returns if it succeeds</span><span>
</span><span id="line-540"></span><span>        </span><span class="annot"><span class="annottext">SuccessFlag -&gt; IO SuccessFlag
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">SuccessFlag
</span><a href="GHC.Types.Basic.html#Succeeded"><span class="hs-identifier hs-var">Succeeded</span></a></span><span>
</span><span id="line-541"></span><span>
</span><span id="line-542"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-543"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Int -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201717"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;link(batch): upsweep (partially) failed OR&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-544"></span><span>                                </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;   Main.main not exported; not linking.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-545"></span><span>        </span><span class="annot"><span class="annottext">SuccessFlag -&gt; IO SuccessFlag
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">SuccessFlag
</span><a href="GHC.Types.Basic.html#Succeeded"><span class="hs-identifier hs-var">Succeeded</span></a></span><span>
</span><span id="line-546"></span><span>
</span><span id="line-547"></span><span>
</span><span id="line-548"></span><span class="annot"><a href="GHC.Driver.Pipeline.html#linkingNeeded"><span class="hs-identifier hs-type">linkingNeeded</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Runtime.Linker.Types.html#Linkable"><span class="hs-identifier hs-type">Linkable</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-549"></span><span id="linkingNeeded"><span class="annot"><span class="annottext">linkingNeeded :: DynFlags -&gt; Bool -&gt; [Linkable] -&gt; [UnitId] -&gt; IO Bool
</span><a href="GHC.Driver.Pipeline.html#linkingNeeded"><span class="hs-identifier hs-var hs-var">linkingNeeded</span></a></span></span><span> </span><span id="local-6989586621681201683"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201683"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621681201682"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681201682"><span class="hs-identifier hs-var">staticLink</span></a></span></span><span> </span><span id="local-6989586621681201681"><span class="annot"><span class="annottext">[Linkable]
</span><a href="#local-6989586621681201681"><span class="hs-identifier hs-var">linkables</span></a></span></span><span> </span><span id="local-6989586621681201680"><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681201680"><span class="hs-identifier hs-var">pkg_deps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-550"></span><span>        </span><span class="hs-comment">-- if the modification time on the executable is later than the</span><span>
</span><span id="line-551"></span><span>        </span><span class="hs-comment">-- modification times on all of the objects and libraries, then omit</span><span>
</span><span id="line-552"></span><span>        </span><span class="hs-comment">-- linking (unless the -fforce-recomp flag was given).</span><span>
</span><span id="line-553"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201679"><span class="annot"><span class="annottext">exe_file :: String
</span><a href="#local-6989586621681201679"><span class="hs-identifier hs-var hs-var">exe_file</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; DynFlags -&gt; String
</span><a href="GHC.Driver.Pipeline.html#exeFileName"><span class="hs-identifier hs-var">exeFileName</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681201682"><span class="hs-identifier hs-var">staticLink</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201683"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-554"></span><span>  </span><span id="local-6989586621681201678"><span class="annot"><span class="annottext">Either IOException UTCTime
</span><a href="#local-6989586621681201678"><span class="hs-identifier hs-var">e_exe_time</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO UTCTime -&gt; IO (Either IOException UTCTime)
forall a. IO a -&gt; IO (Either IOException a)
</span><a href="GHC.Utils.Exception.html#tryIO"><span class="hs-identifier hs-var">tryIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO UTCTime -&gt; IO (Either IOException UTCTime))
-&gt; IO UTCTime -&gt; IO (Either IOException UTCTime)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO UTCTime
</span><a href="GHC.Utils.Misc.html#getModificationUTCTime"><span class="hs-identifier hs-var">getModificationUTCTime</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201679"><span class="hs-identifier hs-var">exe_file</span></a></span><span>
</span><span id="line-555"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either IOException UTCTime
</span><a href="#local-6989586621681201678"><span class="hs-identifier hs-var">e_exe_time</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-556"></span><span>    </span><span class="annot"><a href="../../base/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span class="annot"><span class="annottext">IOException
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; IO Bool
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-557"></span><span>    </span><span class="annot"><a href="../../base/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621681201676"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621681201676"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-558"></span><span>        </span><span class="hs-comment">-- first check object files and extra_ld_inputs</span><span>
</span><span id="line-559"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201675"><span class="annot"><span class="annottext">extra_ld_inputs :: [String]
</span><a href="#local-6989586621681201675"><span class="hs-identifier hs-var hs-var">extra_ld_inputs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201674"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Utils.CliOption.html#FileOption"><span class="hs-identifier hs-type">FileOption</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681201674"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201674"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [Option]
</span><a href="GHC.Driver.Session.html#ldInputs"><span class="hs-identifier hs-var hs-var">ldInputs</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201683"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-560"></span><span>        </span><span id="local-6989586621681201671"><span class="annot"><span class="annottext">[Either IOException UTCTime]
</span><a href="#local-6989586621681201671"><span class="hs-identifier hs-var">e_extra_times</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO (Either IOException UTCTime))
-&gt; [String] -&gt; IO [Either IOException UTCTime]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO UTCTime -&gt; IO (Either IOException UTCTime)
forall a. IO a -&gt; IO (Either IOException a)
</span><a href="GHC.Utils.Exception.html#tryIO"><span class="hs-identifier hs-var">tryIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO UTCTime -&gt; IO (Either IOException UTCTime))
-&gt; (String -&gt; IO UTCTime)
-&gt; String
-&gt; IO (Either IOException UTCTime)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO UTCTime
</span><a href="GHC.Utils.Misc.html#getModificationUTCTime"><span class="hs-identifier hs-var">getModificationUTCTime</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201675"><span class="hs-identifier hs-var">extra_ld_inputs</span></a></span><span>
</span><span id="line-561"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681201669"><span class="annot"><span class="annottext">[IOException]
</span><a href="#local-6989586621681201669"><span class="hs-identifier hs-var">errs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681201668"><span class="annot"><span class="annottext">[UTCTime]
</span><a href="#local-6989586621681201668"><span class="hs-identifier hs-var">extra_times</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Either IOException UTCTime] -&gt; ([IOException], [UTCTime])
forall a b. [Either a b] -&gt; ([a], [b])
</span><a href="../../base/src/Data.Either.html#partitionEithers"><span class="hs-identifier hs-var">partitionEithers</span></a></span><span> </span><span class="annot"><span class="annottext">[Either IOException UTCTime]
</span><a href="#local-6989586621681201671"><span class="hs-identifier hs-var">e_extra_times</span></a></span><span>
</span><span id="line-562"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201667"><span class="annot"><span class="annottext">obj_times :: [UTCTime]
</span><a href="#local-6989586621681201667"><span class="hs-identifier hs-var hs-var">obj_times</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">(Linkable -&gt; UTCTime) -&gt; [Linkable] -&gt; [UTCTime]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Linkable -&gt; UTCTime
</span><a href="GHC.Runtime.Linker.Types.html#linkableTime"><span class="hs-identifier hs-var hs-var">linkableTime</span></a></span><span> </span><span class="annot"><span class="annottext">[Linkable]
</span><a href="#local-6989586621681201681"><span class="hs-identifier hs-var">linkables</span></a></span><span> </span><span class="annot"><span class="annottext">[UTCTime] -&gt; [UTCTime] -&gt; [UTCTime]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[UTCTime]
</span><a href="#local-6989586621681201668"><span class="hs-identifier hs-var">extra_times</span></a></span><span>
</span><span id="line-563"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[IOException] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[IOException]
</span><a href="#local-6989586621681201669"><span class="hs-identifier hs-var">errs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">(UTCTime -&gt; Bool) -&gt; [UTCTime] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621681201676"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime -&gt; UTCTime -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[UTCTime]
</span><a href="#local-6989586621681201667"><span class="hs-identifier hs-var">obj_times</span></a></span><span>
</span><span id="line-564"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; IO Bool
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-565"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-566"></span><span>
</span><span id="line-567"></span><span>        </span><span class="hs-comment">-- next, check libraries. XXX this only checks Haskell libraries,</span><span>
</span><span id="line-568"></span><span>        </span><span class="hs-comment">-- not extra_libraries or -l things from the command line.</span><span>
</span><span id="line-569"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201663"><span class="annot"><span class="annottext">pkgstate :: UnitState
</span><a href="#local-6989586621681201663"><span class="hs-identifier hs-var hs-var">pkgstate</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; UnitState
</span><a href="GHC.Driver.Session.html#unitState"><span class="hs-identifier hs-var hs-var">unitState</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201683"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-570"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201661"><span class="annot"><span class="annottext">pkg_hslibs :: [([String], String)]
</span><a href="#local-6989586621681201661"><span class="hs-identifier hs-var hs-var">pkg_hslibs</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; [UnitInfo] -&gt; [String]
</span><a href="GHC.Unit.State.html#collectLibraryPaths"><span class="hs-identifier hs-var">collectLibraryPaths</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201683"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681201659"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201658"><span class="hs-identifier hs-var">lib</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-571"></span><span>                          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681201659"><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681201659"><span class="hs-identifier hs-var">c</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(UnitId -&gt; Maybe UnitInfo) -&gt; [UnitId] -&gt; [Maybe UnitInfo]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitState -&gt; UnitId -&gt; Maybe UnitInfo
</span><a href="GHC.Unit.State.html#lookupUnitId"><span class="hs-identifier hs-var">lookupUnitId</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681201663"><span class="hs-identifier hs-var">pkgstate</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681201680"><span class="hs-identifier hs-var">pkg_deps</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-572"></span><span>                            </span><span id="local-6989586621681201658"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201658"><span class="hs-identifier hs-var">lib</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; UnitInfo -&gt; [String]
</span><a href="GHC.Unit.State.html#packageHsLibs"><span class="hs-identifier hs-var">packageHsLibs</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201683"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681201659"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-573"></span><span>
</span><span id="line-574"></span><span>        </span><span id="local-6989586621681201655"><span class="annot"><span class="annottext">[Maybe String]
</span><a href="#local-6989586621681201655"><span class="hs-identifier hs-var">pkg_libfiles</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(([String], String) -&gt; IO (Maybe String))
-&gt; [([String], String)] -&gt; IO [Maybe String]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([String] -&gt; String -&gt; IO (Maybe String))
-&gt; ([String], String) -&gt; IO (Maybe String)
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><a href="../../base/src/Data.Tuple.html#uncurry"><span class="hs-identifier hs-var">uncurry</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; [String] -&gt; String -&gt; IO (Maybe String)
</span><a href="GHC.Driver.Pipeline.html#findHSLib"><span class="hs-identifier hs-var">findHSLib</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201683"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[([String], String)]
</span><a href="#local-6989586621681201661"><span class="hs-identifier hs-var">pkg_hslibs</span></a></span><span>
</span><span id="line-575"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">(Maybe String -&gt; Bool) -&gt; [Maybe String] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe String -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../../base/src/Data.Maybe.html#isNothing"><span class="hs-identifier hs-var">isNothing</span></a></span><span> </span><span class="annot"><span class="annottext">[Maybe String]
</span><a href="#local-6989586621681201655"><span class="hs-identifier hs-var">pkg_libfiles</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; IO Bool
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-576"></span><span>        </span><span id="local-6989586621681201652"><span class="annot"><span class="annottext">[Either IOException UTCTime]
</span><a href="#local-6989586621681201652"><span class="hs-identifier hs-var">e_lib_times</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO (Either IOException UTCTime))
-&gt; [String] -&gt; IO [Either IOException UTCTime]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO UTCTime -&gt; IO (Either IOException UTCTime)
forall a. IO a -&gt; IO (Either IOException a)
</span><a href="GHC.Utils.Exception.html#tryIO"><span class="hs-identifier hs-var">tryIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO UTCTime -&gt; IO (Either IOException UTCTime))
-&gt; (String -&gt; IO UTCTime)
-&gt; String
-&gt; IO (Either IOException UTCTime)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO UTCTime
</span><a href="GHC.Utils.Misc.html#getModificationUTCTime"><span class="hs-identifier hs-var">getModificationUTCTime</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-577"></span><span>                          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Maybe String] -&gt; [String]
forall a. [Maybe a] -&gt; [a]
</span><a href="../../base/src/Data.Maybe.html#catMaybes"><span class="hs-identifier hs-var">catMaybes</span></a></span><span> </span><span class="annot"><span class="annottext">[Maybe String]
</span><a href="#local-6989586621681201655"><span class="hs-identifier hs-var">pkg_libfiles</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-578"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681201650"><span class="annot"><span class="annottext">[IOException]
</span><a href="#local-6989586621681201650"><span class="hs-identifier hs-var">lib_errs</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681201649"><span class="annot"><span class="annottext">[UTCTime]
</span><a href="#local-6989586621681201649"><span class="hs-identifier hs-var">lib_times</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Either IOException UTCTime] -&gt; ([IOException], [UTCTime])
forall a b. [Either a b] -&gt; ([a], [b])
</span><a href="../../base/src/Data.Either.html#partitionEithers"><span class="hs-identifier hs-var">partitionEithers</span></a></span><span> </span><span class="annot"><span class="annottext">[Either IOException UTCTime]
</span><a href="#local-6989586621681201652"><span class="hs-identifier hs-var">e_lib_times</span></a></span><span>
</span><span id="line-579"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[IOException] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[IOException]
</span><a href="#local-6989586621681201650"><span class="hs-identifier hs-var">lib_errs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">(UTCTime -&gt; Bool) -&gt; [UTCTime] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621681201676"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime -&gt; UTCTime -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[UTCTime]
</span><a href="#local-6989586621681201649"><span class="hs-identifier hs-var">lib_times</span></a></span><span>
</span><span id="line-580"></span><span>           </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; IO Bool
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-581"></span><span>           </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [UnitId] -&gt; String -&gt; IO Bool
</span><a href="GHC.SysTools.ExtraObj.html#checkLinkInfo"><span class="hs-identifier hs-var">checkLinkInfo</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201683"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681201680"><span class="hs-identifier hs-var">pkg_deps</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201679"><span class="hs-identifier hs-var">exe_file</span></a></span><span>
</span><span id="line-582"></span><span>
</span><span id="line-583"></span><span class="annot"><a href="GHC.Driver.Pipeline.html#findHSLib"><span class="hs-identifier hs-type">findHSLib</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../base/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../base/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-584"></span><span id="findHSLib"><span class="annot"><span class="annottext">findHSLib :: DynFlags -&gt; [String] -&gt; String -&gt; IO (Maybe String)
</span><a href="GHC.Driver.Pipeline.html#findHSLib"><span class="hs-identifier hs-var hs-var">findHSLib</span></a></span></span><span> </span><span id="local-6989586621681201648"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201648"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621681201647"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201647"><span class="hs-identifier hs-var">dirs</span></a></span></span><span> </span><span id="local-6989586621681201646"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201646"><span class="hs-identifier hs-var">lib</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-585"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201643"><span class="annot"><span class="annottext">batch_lib_file :: String
</span><a href="#local-6989586621681201643"><span class="hs-identifier hs-var hs-var">batch_lib_file</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Way
</span><a href="GHC.Driver.Ways.html#WayDyn"><span class="hs-identifier hs-var">WayDyn</span></a></span><span> </span><span class="annot"><span class="annottext">Way -&gt; Set Way -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#notElem"><span class="hs-operator hs-var">`notElem`</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Set Way
</span><a href="GHC.Driver.Session.html#ways"><span class="hs-identifier hs-var hs-var">ways</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201648"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-586"></span><span>                      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;lib&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201646"><span class="hs-identifier hs-var">lib</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><a href="../../filepath/src/System.FilePath.Windows.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;a&quot;</span></span><span>
</span><span id="line-587"></span><span>                      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; String -&gt; String
</span><a href="GHC.Driver.Types.html#mkSOName"><span class="hs-identifier hs-var">mkSOName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.Session.html#targetPlatform"><span class="hs-identifier hs-var hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201648"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201646"><span class="hs-identifier hs-var">lib</span></a></span><span>
</span><span id="line-588"></span><span>  </span><span id="local-6989586621681201638"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201638"><span class="hs-identifier hs-var">found</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO Bool) -&gt; [String] -&gt; IO [String]
forall (m :: * -&gt; *) a.
Applicative m =&gt;
(a -&gt; m Bool) -&gt; [a] -&gt; m [a]
</span><a href="../../base/src/Control.Monad.html#filterM"><span class="hs-identifier hs-var">filterM</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO Bool
</span><a href="../../directory/src/System.Directory.html#doesFileExist"><span class="hs-identifier hs-var">doesFileExist</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String -&gt; String) -&gt; [String] -&gt; [String]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><a href="../../filepath/src/System.FilePath.Windows.html#%3C%2F%3E"><span class="hs-operator hs-var">&lt;/&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201643"><span class="hs-identifier hs-var">batch_lib_file</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201647"><span class="hs-identifier hs-var">dirs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-589"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201638"><span class="hs-identifier hs-var">found</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-590"></span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe String -&gt; IO (Maybe String)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-591"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681201634"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201634"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[String]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe String -&gt; IO (Maybe String)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Maybe String
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201634"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-592"></span><span>
</span><span id="line-593"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-594"></span><span class="hs-comment">-- Compile files in one-shot mode.</span><span>
</span><span id="line-595"></span><span>
</span><span id="line-596"></span><span class="annot"><a href="GHC.Driver.Pipeline.html#oneShot"><span class="hs-identifier hs-type">oneShot</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Phases.html#Phase"><span class="hs-identifier hs-type">Phase</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Phases.html#Phase"><span class="hs-identifier hs-type">Phase</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-597"></span><span id="oneShot"><span class="annot"><span class="annottext">oneShot :: HscEnv -&gt; Phase -&gt; [(String, Maybe Phase)] -&gt; IO ()
</span><a href="GHC.Driver.Pipeline.html#oneShot"><span class="hs-identifier hs-var hs-var">oneShot</span></a></span></span><span> </span><span id="local-6989586621681201633"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681201633"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681201632"><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201632"><span class="hs-identifier hs-var">stop_phase</span></a></span></span><span> </span><span id="local-6989586621681201631"><span class="annot"><span class="annottext">[(String, Maybe Phase)]
</span><a href="#local-6989586621681201631"><span class="hs-identifier hs-var">srcs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-598"></span><span>  </span><span id="local-6989586621681201630"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201630"><span class="hs-identifier hs-var">o_files</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((String, Maybe Phase) -&gt; IO String)
-&gt; [(String, Maybe Phase)] -&gt; IO [String]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; Phase -&gt; (String, Maybe Phase) -&gt; IO String
</span><a href="GHC.Driver.Pipeline.html#compileFile"><span class="hs-identifier hs-var">compileFile</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681201633"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201632"><span class="hs-identifier hs-var">stop_phase</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(String, Maybe Phase)]
</span><a href="#local-6989586621681201631"><span class="hs-identifier hs-var">srcs</span></a></span><span>
</span><span id="line-599"></span><span>  </span><span class="annot"><span class="annottext">DynFlags -&gt; Phase -&gt; [String] -&gt; IO ()
</span><a href="GHC.Driver.Pipeline.html#doLink"><span class="hs-identifier hs-var">doLink</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681201633"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201632"><span class="hs-identifier hs-var">stop_phase</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201630"><span class="hs-identifier hs-var">o_files</span></a></span><span>
</span><span id="line-600"></span><span>
</span><span id="line-601"></span><span class="annot"><a href="GHC.Driver.Pipeline.html#compileFile"><span class="hs-identifier hs-type">compileFile</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Phases.html#Phase"><span class="hs-identifier hs-type">Phase</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Phases.html#Phase"><span class="hs-identifier hs-type">Phase</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="../../base/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>
</span><span id="line-602"></span><span id="compileFile"><span class="annot"><span class="annottext">compileFile :: HscEnv -&gt; Phase -&gt; (String, Maybe Phase) -&gt; IO String
</span><a href="GHC.Driver.Pipeline.html#compileFile"><span class="hs-identifier hs-var hs-var">compileFile</span></a></span></span><span> </span><span id="local-6989586621681201628"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681201628"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681201627"><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201627"><span class="hs-identifier hs-var">stop_phase</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681201626"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201626"><span class="hs-identifier hs-var">src</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681201625"><span class="annot"><span class="annottext">Maybe Phase
</span><a href="#local-6989586621681201625"><span class="hs-identifier hs-var">mb_phase</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-603"></span><span>   </span><span id="local-6989586621681201624"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681201624"><span class="hs-identifier hs-var">exists</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO Bool
</span><a href="../../directory/src/System.Directory.html#doesFileExist"><span class="hs-identifier hs-var">doesFileExist</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201626"><span class="hs-identifier hs-var">src</span></a></span><span>
</span><span id="line-604"></span><span>   </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681201624"><span class="hs-identifier hs-var">exists</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-605"></span><span>        </span><span class="annot"><span class="annottext">GhcException -&gt; IO ()
forall a. GhcException -&gt; IO a
</span><a href="GHC.Utils.Panic.html#throwGhcExceptionIO"><span class="hs-identifier hs-var">throwGhcExceptionIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; GhcException
</span><a href="GHC.Utils.Panic.html#CmdLineError"><span class="hs-identifier hs-var">CmdLineError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;does not exist: &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201626"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-606"></span><span>
</span><span id="line-607"></span><span>   </span><span class="hs-keyword">let</span><span>
</span><span id="line-608"></span><span>        </span><span id="local-6989586621681201621"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621681201621"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681201628"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-609"></span><span>        </span><span id="local-6989586621681201620"><span class="annot"><span class="annottext">mb_o_file :: Maybe String
</span><a href="#local-6989586621681201620"><span class="hs-identifier hs-var hs-var">mb_o_file</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Maybe String
</span><a href="GHC.Driver.Session.html#outputFile"><span class="hs-identifier hs-var hs-var">outputFile</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201621"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-610"></span><span>        </span><span id="local-6989586621681201618"><span class="annot"><span class="annottext">ghc_link :: GhcLink
</span><a href="#local-6989586621681201618"><span class="hs-identifier hs-var hs-var">ghc_link</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; GhcLink
</span><a href="GHC.Driver.Session.html#ghcLink"><span class="hs-identifier hs-var hs-var">ghcLink</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201621"><span class="hs-identifier hs-var">dflags</span></a></span><span>      </span><span class="hs-comment">-- Set by -c or -no-link</span><span>
</span><span id="line-611"></span><span>
</span><span id="line-612"></span><span>        </span><span class="hs-comment">-- When linking, the -o argument refers to the linker's output.</span><span>
</span><span id="line-613"></span><span>        </span><span class="hs-comment">-- otherwise, we use it as the name for the pipeline's output.</span><span>
</span><span id="line-614"></span><span>        </span><span id="local-6989586621681201617"><span class="annot"><span class="annottext">output :: PipelineOutput
</span><a href="#local-6989586621681201617"><span class="hs-identifier hs-var hs-var">output</span></a></span></span><span>
</span><span id="line-615"></span><span>         </span><span class="hs-comment">-- If we are doing -fno-code, then act as if the output is</span><span>
</span><span id="line-616"></span><span>         </span><span class="hs-comment">-- 'Temporary'. This stops GHC trying to copy files to their</span><span>
</span><span id="line-617"></span><span>         </span><span class="hs-comment">-- final location.</span><span>
</span><span id="line-618"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">HscTarget
</span><a href="GHC.Driver.Session.html#HscNothing"><span class="hs-identifier hs-var">HscNothing</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; HscTarget
</span><a href="GHC.Driver.Session.html#hscTarget"><span class="hs-identifier hs-var hs-var">hscTarget</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201621"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TempFileLifetime -&gt; PipelineOutput
</span><a href="GHC.Driver.Pipeline.Monad.html#Temporary"><span class="hs-identifier hs-var">Temporary</span></a></span><span> </span><span class="annot"><span class="annottext">TempFileLifetime
</span><a href="GHC.SysTools.FileCleanup.html#TFL_CurrentModule"><span class="hs-identifier hs-var">TFL_CurrentModule</span></a></span><span>
</span><span id="line-619"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#StopLn"><span class="hs-identifier hs-var">StopLn</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201627"><span class="hs-identifier hs-var">stop_phase</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GhcLink -&gt; Bool
</span><a href="GHC.Driver.Session.html#isNoLink"><span class="hs-identifier hs-var">isNoLink</span></a></span><span> </span><span class="annot"><span class="annottext">GhcLink
</span><a href="#local-6989586621681201618"><span class="hs-identifier hs-var">ghc_link</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PipelineOutput
</span><a href="GHC.Driver.Pipeline.Monad.html#Persistent"><span class="hs-identifier hs-var">Persistent</span></a></span><span>
</span><span id="line-620"></span><span>                </span><span class="hs-comment">-- -o foo applies to linker</span><span>
</span><span id="line-621"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Maybe String -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../../base/src/Data.Maybe.html#isJust"><span class="hs-identifier hs-var">isJust</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621681201620"><span class="hs-identifier hs-var">mb_o_file</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PipelineOutput
</span><a href="GHC.Driver.Pipeline.Monad.html#SpecificFile"><span class="hs-identifier hs-var">SpecificFile</span></a></span><span>
</span><span id="line-622"></span><span>                </span><span class="hs-comment">-- -o foo applies to the file we are compiling now</span><span>
</span><span id="line-623"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PipelineOutput
</span><a href="GHC.Driver.Pipeline.Monad.html#Persistent"><span class="hs-identifier hs-var">Persistent</span></a></span><span>
</span><span id="line-624"></span><span>
</span><span id="line-625"></span><span>   </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681201615"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201615"><span class="hs-identifier hs-var">out_file</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe ModIface
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Phase
-&gt; HscEnv
-&gt; (String, Maybe InputFileBuffer, Maybe PhasePlus)
-&gt; Maybe String
-&gt; PipelineOutput
-&gt; Maybe ModLocation
-&gt; [String]
-&gt; IO (DynFlags, String, Maybe ModIface)
</span><a href="GHC.Driver.Pipeline.html#runPipeline"><span class="hs-identifier hs-var">runPipeline</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201627"><span class="hs-identifier hs-var">stop_phase</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681201628"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-626"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201626"><span class="hs-identifier hs-var">src</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe InputFileBuffer
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Phase -&gt; PhasePlus) -&gt; Maybe Phase -&gt; Maybe PhasePlus
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Phase -&gt; PhasePlus
</span><a href="GHC.Driver.Pipeline.Monad.html#RealPhase"><span class="hs-identifier hs-var">RealPhase</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Phase
</span><a href="#local-6989586621681201625"><span class="hs-identifier hs-var">mb_phase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-627"></span><span>                            </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-628"></span><span>                            </span><span class="annot"><span class="annottext">PipelineOutput
</span><a href="#local-6989586621681201617"><span class="hs-identifier hs-var">output</span></a></span><span>
</span><span id="line-629"></span><span>                            </span><span class="annot"><span class="annottext">Maybe ModLocation
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-comment">{-no ModLocation-}</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-630"></span><span>   </span><span class="annot"><span class="annottext">String -&gt; IO String
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201615"><span class="hs-identifier hs-var">out_file</span></a></span><span>
</span><span id="line-631"></span><span>
</span><span id="line-632"></span><span>
</span><span id="line-633"></span><span class="annot"><a href="GHC.Driver.Pipeline.html#doLink"><span class="hs-identifier hs-type">doLink</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Phases.html#Phase"><span class="hs-identifier hs-type">Phase</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../base/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-634"></span><span id="doLink"><span class="annot"><span class="annottext">doLink :: DynFlags -&gt; Phase -&gt; [String] -&gt; IO ()
</span><a href="GHC.Driver.Pipeline.html#doLink"><span class="hs-identifier hs-var hs-var">doLink</span></a></span></span><span> </span><span id="local-6989586621681201614"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201614"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621681201613"><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201613"><span class="hs-identifier hs-var">stop_phase</span></a></span></span><span> </span><span id="local-6989586621681201612"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201612"><span class="hs-identifier hs-var">o_files</span></a></span></span><span>
</span><span id="line-635"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Phase -&gt; Bool
</span><a href="GHC.Driver.Phases.html#isStopLn"><span class="hs-identifier hs-var">isStopLn</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201613"><span class="hs-identifier hs-var">stop_phase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-636"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>           </span><span class="hs-comment">-- We stopped before the linking phase</span><span>
</span><span id="line-637"></span><span>
</span><span id="line-638"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-639"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; GhcLink
</span><a href="GHC.Driver.Session.html#ghcLink"><span class="hs-identifier hs-var hs-var">ghcLink</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201614"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-640"></span><span>        </span><span class="annot"><span class="annottext">GhcLink
</span><a href="GHC.Driver.Session.html#NoLink"><span class="hs-identifier hs-var">NoLink</span></a></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-641"></span><span>        </span><span class="annot"><span class="annottext">GhcLink
</span><a href="GHC.Driver.Session.html#LinkBinary"><span class="hs-identifier hs-var">LinkBinary</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [String] -&gt; [UnitId] -&gt; IO ()
</span><a href="GHC.Driver.Pipeline.html#linkBinary"><span class="hs-identifier hs-var">linkBinary</span></a></span><span>         </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201614"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201612"><span class="hs-identifier hs-var">o_files</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-642"></span><span>        </span><span class="annot"><span class="annottext">GhcLink
</span><a href="GHC.Driver.Session.html#LinkStaticLib"><span class="hs-identifier hs-var">LinkStaticLib</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [String] -&gt; [UnitId] -&gt; IO ()
</span><a href="GHC.Driver.Pipeline.html#linkStaticLib"><span class="hs-identifier hs-var">linkStaticLib</span></a></span><span>      </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201614"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201612"><span class="hs-identifier hs-var">o_files</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-643"></span><span>        </span><span class="annot"><span class="annottext">GhcLink
</span><a href="GHC.Driver.Session.html#LinkDynLib"><span class="hs-identifier hs-var">LinkDynLib</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [String] -&gt; [UnitId] -&gt; IO ()
</span><a href="GHC.Driver.Pipeline.html#linkDynLibCheck"><span class="hs-identifier hs-var">linkDynLibCheck</span></a></span><span>    </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201614"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201612"><span class="hs-identifier hs-var">o_files</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-644"></span><span>        </span><span id="local-6989586621681201610"><span class="annot"><span class="annottext">GhcLink
</span><a href="#local-6989586621681201610"><span class="hs-identifier hs-var">other</span></a></span></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GhcLink -&gt; IO ()
forall a. GhcLink -&gt; a
</span><a href="GHC.Driver.Pipeline.html#panicBadLink"><span class="hs-identifier hs-var">panicBadLink</span></a></span><span> </span><span class="annot"><span class="annottext">GhcLink
</span><a href="#local-6989586621681201610"><span class="hs-identifier hs-var">other</span></a></span><span>
</span><span id="line-645"></span><span>
</span><span id="line-646"></span><span>
</span><span id="line-647"></span><span class="hs-comment">-- ---------------------------------------------------------------------------</span><span>
</span><span id="line-648"></span><span>
</span><span id="line-649"></span><span class="hs-comment">-- | Run a compilation pipeline, consisting of multiple phases.</span><span>
</span><span id="line-650"></span><span class="hs-comment">--</span><span>
</span><span id="line-651"></span><span class="hs-comment">-- This is the interface to the compilation pipeline, which runs</span><span>
</span><span id="line-652"></span><span class="hs-comment">-- a series of compilation steps on a single source file, specifying</span><span>
</span><span id="line-653"></span><span class="hs-comment">-- at which stage to stop.</span><span>
</span><span id="line-654"></span><span class="hs-comment">--</span><span>
</span><span id="line-655"></span><span class="hs-comment">-- The DynFlags can be modified by phases in the pipeline (eg. by</span><span>
</span><span id="line-656"></span><span class="hs-comment">-- OPTIONS_GHC pragmas), and the changes affect later phases in the</span><span>
</span><span id="line-657"></span><span class="hs-comment">-- pipeline.</span><span>
</span><span id="line-658"></span><span class="annot"><a href="GHC.Driver.Pipeline.html#runPipeline"><span class="hs-identifier hs-type">runPipeline</span></a></span><span>
</span><span id="line-659"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Phases.html#Phase"><span class="hs-identifier hs-type">Phase</span></a></span><span>                      </span><span class="hs-comment">-- ^ When to stop</span><span>
</span><span id="line-660"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>                     </span><span class="hs-comment">-- ^ Compilation environment</span><span>
</span><span id="line-661"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#InputFileBuffer"><span class="hs-identifier hs-type">InputFileBuffer</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#PhasePlus"><span class="hs-identifier hs-type">PhasePlus</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-662"></span><span>                                </span><span class="hs-comment">-- ^ Pipeline input file name, optional</span><span>
</span><span id="line-663"></span><span>                                </span><span class="hs-comment">-- buffer and maybe -x suffix</span><span>
</span><span id="line-664"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../base/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>             </span><span class="hs-comment">-- ^ original basename (if different from ^^^)</span><span>
</span><span id="line-665"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#PipelineOutput"><span class="hs-identifier hs-type">PipelineOutput</span></a></span><span>             </span><span class="hs-comment">-- ^ Output filename</span><span>
</span><span id="line-666"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Location.html#ModLocation"><span class="hs-identifier hs-type">ModLocation</span></a></span><span>          </span><span class="hs-comment">-- ^ A ModLocation, if this is a Haskell module</span><span>
</span><span id="line-667"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../base/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span class="hs-special">]</span><span>                 </span><span class="hs-comment">-- ^ foreign objects</span><span>
</span><span id="line-668"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-669"></span><span>                                </span><span class="hs-comment">-- ^ (final flags, output filename, interface)</span><span>
</span><span id="line-670"></span><span id="runPipeline"><span class="annot"><span class="annottext">runPipeline :: Phase
-&gt; HscEnv
-&gt; (String, Maybe InputFileBuffer, Maybe PhasePlus)
-&gt; Maybe String
-&gt; PipelineOutput
-&gt; Maybe ModLocation
-&gt; [String]
-&gt; IO (DynFlags, String, Maybe ModIface)
</span><a href="GHC.Driver.Pipeline.html#runPipeline"><span class="hs-identifier hs-var hs-var">runPipeline</span></a></span></span><span> </span><span id="local-6989586621681201609"><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201609"><span class="hs-identifier hs-var">stop_phase</span></a></span></span><span> </span><span id="local-6989586621681201608"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681201608"><span class="hs-identifier hs-var">hsc_env0</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681201607"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201607"><span class="hs-identifier hs-var">input_fn</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681201606"><span class="annot"><span class="annottext">Maybe InputFileBuffer
</span><a href="#local-6989586621681201606"><span class="hs-identifier hs-var">mb_input_buf</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681201605"><span class="annot"><span class="annottext">Maybe PhasePlus
</span><a href="#local-6989586621681201605"><span class="hs-identifier hs-var">mb_phase</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-671"></span><span>             </span><span id="local-6989586621681201604"><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621681201604"><span class="hs-identifier hs-var">mb_basename</span></a></span></span><span> </span><span id="local-6989586621681201603"><span class="annot"><span class="annottext">PipelineOutput
</span><a href="#local-6989586621681201603"><span class="hs-identifier hs-var">output</span></a></span></span><span> </span><span id="local-6989586621681201602"><span class="annot"><span class="annottext">Maybe ModLocation
</span><a href="#local-6989586621681201602"><span class="hs-identifier hs-var">maybe_loc</span></a></span></span><span> </span><span id="local-6989586621681201601"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201601"><span class="hs-identifier hs-var">foreign_os</span></a></span></span><span>
</span><span id="line-672"></span><span>
</span><span id="line-673"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span>
</span><span id="line-674"></span><span>             </span><span id="local-6989586621681201600"><span class="annot"><span class="annottext">dflags0 :: DynFlags
</span><a href="#local-6989586621681201600"><span class="hs-identifier hs-var hs-var">dflags0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681201608"><span class="hs-identifier hs-var">hsc_env0</span></a></span><span>
</span><span id="line-675"></span><span>
</span><span id="line-676"></span><span>             </span><span class="hs-comment">-- Decide where dump files should go based on the pipeline output</span><span>
</span><span id="line-677"></span><span>             </span><span id="local-6989586621681201599"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621681201599"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201600"><span class="hs-identifier hs-var">dflags0</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">dumpPrefix :: Maybe String
</span><a href="GHC.Driver.Session.html#dumpPrefix"><span class="hs-identifier hs-var">dumpPrefix</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe String
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201597"><span class="hs-identifier hs-var">basename</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;.&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-678"></span><span>             </span><span id="local-6989586621681201596"><span class="annot"><span class="annottext">hsc_env :: HscEnv
</span><a href="#local-6989586621681201596"><span class="hs-identifier hs-var hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681201608"><span class="hs-identifier hs-var">hsc_env0</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">hsc_dflags :: DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201599"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-679"></span><span>
</span><span id="line-680"></span><span>             </span><span class="hs-special">(</span><span id="local-6989586621681201595"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201595"><span class="hs-identifier hs-var">input_basename</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681201594"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201594"><span class="hs-identifier hs-var">suffix</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; (String, String)
</span><a href="../../filepath/src/System.FilePath.Windows.html#splitExtension"><span class="hs-identifier hs-var">splitExtension</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201607"><span class="hs-identifier hs-var">input_fn</span></a></span><span>
</span><span id="line-681"></span><span>             </span><span id="local-6989586621681201592"><span class="annot"><span class="annottext">suffix' :: String
</span><a href="#local-6989586621681201592"><span class="hs-identifier hs-var hs-var">suffix'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; String -&gt; String
forall a. Int -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.List.html#drop"><span class="hs-identifier hs-var">drop</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201594"><span class="hs-identifier hs-var">suffix</span></a></span><span> </span><span class="hs-comment">-- strip off the .</span><span>
</span><span id="line-682"></span><span>             </span><span id="local-6989586621681201597"><span class="annot"><span class="annottext">basename :: String
</span><a href="#local-6989586621681201597"><span class="hs-identifier hs-var hs-var">basename</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681201590"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201590"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621681201604"><span class="hs-identifier hs-var">mb_basename</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201590"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-683"></span><span>                      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201595"><span class="hs-identifier hs-var">input_basename</span></a></span><span>
</span><span id="line-684"></span><span>
</span><span id="line-685"></span><span>             </span><span class="hs-comment">-- If we were given a -x flag, then use that phase to start from</span><span>
</span><span id="line-686"></span><span>             </span><span id="local-6989586621681201589"><span class="annot"><span class="annottext">start_phase :: PhasePlus
</span><a href="#local-6989586621681201589"><span class="hs-identifier hs-var hs-var">start_phase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PhasePlus -&gt; Maybe PhasePlus -&gt; PhasePlus
forall a. a -&gt; Maybe a -&gt; a
</span><a href="../../base/src/Data.Maybe.html#fromMaybe"><span class="hs-identifier hs-var">fromMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Phase -&gt; PhasePlus
</span><a href="GHC.Driver.Pipeline.Monad.html#RealPhase"><span class="hs-identifier hs-var">RealPhase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Phase
</span><a href="GHC.Driver.Phases.html#startPhase"><span class="hs-identifier hs-var">startPhase</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201592"><span class="hs-identifier hs-var">suffix'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe PhasePlus
</span><a href="#local-6989586621681201605"><span class="hs-identifier hs-var">mb_phase</span></a></span><span>
</span><span id="line-687"></span><span>
</span><span id="line-688"></span><span>             </span><span id="local-6989586621681201586"><span class="annot"><span class="annottext">isHaskell :: PhasePlus -&gt; Bool
</span><a href="#local-6989586621681201586"><span class="hs-identifier hs-var hs-var">isHaskell</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#RealPhase"><span class="hs-identifier hs-type">RealPhase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Phases.html#Unlit"><span class="hs-identifier hs-type">Unlit</span></a></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-689"></span><span>             </span><span class="annot"><a href="#local-6989586621681201586"><span class="hs-identifier hs-var">isHaskell</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#RealPhase"><span class="hs-identifier hs-type">RealPhase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Phases.html#Cpp"><span class="hs-identifier hs-type">Cpp</span></a></span><span>   </span><span class="annot"><span class="annottext">HscSource
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-690"></span><span>             </span><span class="annot"><a href="#local-6989586621681201586"><span class="hs-identifier hs-var">isHaskell</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#RealPhase"><span class="hs-identifier hs-type">RealPhase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Phases.html#HsPp"><span class="hs-identifier hs-type">HsPp</span></a></span><span>  </span><span class="annot"><span class="annottext">HscSource
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-691"></span><span>             </span><span class="annot"><a href="#local-6989586621681201586"><span class="hs-identifier hs-var">isHaskell</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#RealPhase"><span class="hs-identifier hs-type">RealPhase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Phases.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span>   </span><span class="annot"><span class="annottext">HscSource
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-692"></span><span>             </span><span class="annot"><a href="#local-6989586621681201586"><span class="hs-identifier hs-var">isHaskell</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#HscOut"><span class="hs-identifier hs-type">HscOut</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-693"></span><span>             </span><span class="annot"><a href="#local-6989586621681201586"><span class="hs-identifier hs-var">isHaskell</span></a></span><span> </span><span class="annot"><span class="annottext">PhasePlus
</span><span class="hs-identifier">_</span></span><span>                     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-694"></span><span>
</span><span id="line-695"></span><span>             </span><span id="local-6989586621681201581"><span class="annot"><span class="annottext">isHaskellishFile :: Bool
</span><a href="#local-6989586621681201581"><span class="hs-identifier hs-var hs-var">isHaskellishFile</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PhasePlus -&gt; Bool
</span><a href="#local-6989586621681201586"><span class="hs-identifier hs-var">isHaskell</span></a></span><span> </span><span class="annot"><span class="annottext">PhasePlus
</span><a href="#local-6989586621681201589"><span class="hs-identifier hs-var">start_phase</span></a></span><span>
</span><span id="line-696"></span><span>
</span><span id="line-697"></span><span>             </span><span id="local-6989586621681201580"><span class="annot"><span class="annottext">env :: PipeEnv
</span><a href="#local-6989586621681201580"><span class="hs-identifier hs-var hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PipeEnv :: Phase -&gt; String -&gt; String -&gt; String -&gt; PipelineOutput -&gt; PipeEnv
</span><a href="GHC.Driver.Pipeline.Monad.html#PipeEnv"><span class="hs-identifier hs-type">PipeEnv</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Phase
stop_phase :: Phase
stop_phase :: Phase
</span><a href="GHC.Driver.Pipeline.Monad.html#stop_phase"><span class="hs-identifier hs-var hs-var">stop_phase</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-698"></span><span>                            </span><span class="annot"><span class="annottext">src_filename :: String
</span><a href="GHC.Driver.Pipeline.Monad.html#src_filename"><span class="hs-identifier hs-var">src_filename</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201607"><span class="hs-identifier hs-var">input_fn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-699"></span><span>                            </span><span class="annot"><span class="annottext">src_basename :: String
</span><a href="GHC.Driver.Pipeline.Monad.html#src_basename"><span class="hs-identifier hs-var">src_basename</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201597"><span class="hs-identifier hs-var">basename</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-700"></span><span>                            </span><span class="annot"><span class="annottext">src_suffix :: String
</span><a href="GHC.Driver.Pipeline.Monad.html#src_suffix"><span class="hs-identifier hs-var">src_suffix</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201592"><span class="hs-identifier hs-var">suffix'</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-701"></span><span>                            </span><span class="annot"><span class="annottext">output_spec :: PipelineOutput
</span><a href="GHC.Driver.Pipeline.Monad.html#output_spec"><span class="hs-identifier hs-var">output_spec</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PipelineOutput
</span><a href="#local-6989586621681201603"><span class="hs-identifier hs-var">output</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-702"></span><span>
</span><span id="line-703"></span><span>         </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Bool
</span><a href="GHC.Driver.Phases.html#isBackpackishSuffix"><span class="hs-identifier hs-var">isBackpackishSuffix</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201592"><span class="hs-identifier hs-var">suffix'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-704"></span><span>           </span><span class="annot"><span class="annottext">GhcException -&gt; IO ()
forall a. GhcException -&gt; IO a
</span><a href="GHC.Utils.Panic.html#throwGhcExceptionIO"><span class="hs-identifier hs-var">throwGhcExceptionIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; GhcException
</span><a href="GHC.Utils.Panic.html#UsageError"><span class="hs-identifier hs-var">UsageError</span></a></span><span>
</span><span id="line-705"></span><span>                       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;use --backpack to process &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201607"><span class="hs-identifier hs-var">input_fn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-706"></span><span>
</span><span id="line-707"></span><span>         </span><span class="hs-comment">-- We want to catch cases of &quot;you can't get there from here&quot; before</span><span>
</span><span id="line-708"></span><span>         </span><span class="hs-comment">-- we start the pipeline, because otherwise it will just run off the</span><span>
</span><span id="line-709"></span><span>         </span><span class="hs-comment">-- end.</span><span>
</span><span id="line-710"></span><span>         </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201571"><span class="annot"><span class="annottext">happensBefore' :: Phase -&gt; Phase -&gt; Bool
</span><a href="#local-6989586621681201571"><span class="hs-identifier hs-var hs-var">happensBefore'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Phase -&gt; Phase -&gt; Bool
</span><a href="GHC.Driver.Phases.html#happensBefore"><span class="hs-identifier hs-var">happensBefore</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.Session.html#targetPlatform"><span class="hs-identifier hs-var hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201599"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-711"></span><span>         </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PhasePlus
</span><a href="#local-6989586621681201589"><span class="hs-identifier hs-var">start_phase</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-712"></span><span>             </span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#RealPhase"><span class="hs-identifier hs-type">RealPhase</span></a></span><span> </span><span id="local-6989586621681201569"><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201569"><span class="hs-identifier hs-var">start_phase'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-713"></span><span>                 </span><span class="hs-comment">-- See Note [Partial ordering on phases]</span><span>
</span><span id="line-714"></span><span>                 </span><span class="hs-comment">-- Not the same as: (stop_phase `happensBefore` start_phase')</span><span>
</span><span id="line-715"></span><span>                 </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201569"><span class="hs-identifier hs-var">start_phase'</span></a></span><span> </span><span class="annot"><span class="annottext">Phase -&gt; Phase -&gt; Bool
</span><a href="#local-6989586621681201571"><span class="hs-operator hs-var">`happensBefore'`</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201609"><span class="hs-identifier hs-var">stop_phase</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span>
</span><span id="line-716"></span><span>                            </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201569"><span class="hs-identifier hs-var">start_phase'</span></a></span><span> </span><span class="annot"><span class="annottext">Phase -&gt; Phase -&gt; Bool
</span><a href="GHC.Driver.Phases.html#eqPhase"><span class="hs-operator hs-var">`eqPhase`</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201609"><span class="hs-identifier hs-var">stop_phase</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-717"></span><span>                       </span><span class="annot"><span class="annottext">GhcException -&gt; IO ()
forall a. GhcException -&gt; IO a
</span><a href="GHC.Utils.Panic.html#throwGhcExceptionIO"><span class="hs-identifier hs-var">throwGhcExceptionIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; GhcException
</span><a href="GHC.Utils.Panic.html#UsageError"><span class="hs-identifier hs-var">UsageError</span></a></span><span>
</span><span id="line-718"></span><span>                                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;cannot compile this file to desired target: &quot;</span></span><span>
</span><span id="line-719"></span><span>                                      </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201607"><span class="hs-identifier hs-var">input_fn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-720"></span><span>             </span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#HscOut"><span class="hs-identifier hs-type">HscOut</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-721"></span><span>
</span><span id="line-722"></span><span>         </span><span class="hs-comment">-- Write input buffer to temp file if requested</span><span>
</span><span id="line-723"></span><span>         </span><span id="local-6989586621681201567"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201567"><span class="hs-identifier hs-var">input_fn'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PhasePlus
</span><a href="#local-6989586621681201589"><span class="hs-identifier hs-var">start_phase</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe InputFileBuffer
</span><a href="#local-6989586621681201606"><span class="hs-identifier hs-var">mb_input_buf</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-724"></span><span>             </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#RealPhase"><span class="hs-identifier hs-type">RealPhase</span></a></span><span> </span><span id="local-6989586621681201566"><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201566"><span class="hs-identifier hs-var">real_start_phase</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681201565"><span class="annot"><span class="annottext">InputFileBuffer
</span><a href="#local-6989586621681201565"><span class="hs-identifier hs-var">input_buf</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-725"></span><span>                 </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201564"><span class="annot"><span class="annottext">suffix :: String
</span><a href="#local-6989586621681201564"><span class="hs-identifier hs-var hs-var">suffix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Phase -&gt; String
</span><a href="GHC.Driver.Phases.html#phaseInputExt"><span class="hs-identifier hs-var">phaseInputExt</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201566"><span class="hs-identifier hs-var">real_start_phase</span></a></span><span>
</span><span id="line-726"></span><span>                 </span><span id="local-6989586621681201562"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201562"><span class="hs-identifier hs-var">fn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; TempFileLifetime -&gt; String -&gt; IO String
</span><a href="GHC.SysTools.FileCleanup.html#newTempName"><span class="hs-identifier hs-var">newTempName</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201599"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">TempFileLifetime
</span><a href="GHC.SysTools.FileCleanup.html#TFL_CurrentModule"><span class="hs-identifier hs-var">TFL_CurrentModule</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201564"><span class="hs-identifier hs-var">suffix</span></a></span><span>
</span><span id="line-727"></span><span>                 </span><span id="local-6989586621681201561"><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621681201561"><span class="hs-identifier hs-var">hdl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IOMode -&gt; IO Handle
</span><a href="../../base/src/GHC.IO.StdHandles.html#openBinaryFile"><span class="hs-identifier hs-var">openBinaryFile</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201562"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="annot"><span class="annottext">IOMode
</span><a href="../../base/src/GHC.IO.IOMode.html#WriteMode"><span class="hs-identifier hs-var">WriteMode</span></a></span><span>
</span><span id="line-728"></span><span>                 </span><span class="hs-comment">-- Add a LINE pragma so reported source locations will</span><span>
</span><span id="line-729"></span><span>                 </span><span class="hs-comment">-- mention the real input file, not this temp file.</span><span>
</span><span id="line-730"></span><span>                 </span><span class="annot"><span class="annottext">Handle -&gt; String -&gt; IO ()
</span><a href="../../base/src/GHC.IO.Handle.Text.html#hPutStrLn"><span class="hs-identifier hs-var">hPutStrLn</span></a></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621681201561"><span class="hs-identifier hs-var">hdl</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ()) -&gt; String -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;{-# LINE 1 \&quot;&quot;</span></span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201607"><span class="hs-identifier hs-var">input_fn</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\&quot;#-}&quot;</span></span><span>
</span><span id="line-731"></span><span>                 </span><span class="annot"><span class="annottext">Handle -&gt; InputFileBuffer -&gt; IO ()
</span><a href="GHC.Data.StringBuffer.html#hPutStringBuffer"><span class="hs-identifier hs-var">hPutStringBuffer</span></a></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621681201561"><span class="hs-identifier hs-var">hdl</span></a></span><span> </span><span class="annot"><span class="annottext">InputFileBuffer
</span><a href="#local-6989586621681201565"><span class="hs-identifier hs-var">input_buf</span></a></span><span>
</span><span id="line-732"></span><span>                 </span><span class="annot"><span class="annottext">Handle -&gt; IO ()
</span><a href="../../base/src/GHC.IO.Handle.html#hClose"><span class="hs-identifier hs-var">hClose</span></a></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621681201561"><span class="hs-identifier hs-var">hdl</span></a></span><span>
</span><span id="line-733"></span><span>                 </span><span class="annot"><span class="annottext">String -&gt; IO String
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201562"><span class="hs-identifier hs-var">fn</span></a></span><span>
</span><span id="line-734"></span><span>             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PhasePlus
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe InputFileBuffer
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO String
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201607"><span class="hs-identifier hs-var">input_fn</span></a></span><span>
</span><span id="line-735"></span><span>
</span><span id="line-736"></span><span>         </span><span class="annot"><span class="annottext">DynFlags -&gt; Int -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201599"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Running the pipeline&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-737"></span><span>         </span><span id="local-6989586621681201556"><span class="annot"><span class="annottext">(DynFlags, String, Maybe ModIface)
</span><a href="#local-6989586621681201556"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PhasePlus
-&gt; HscEnv
-&gt; PipeEnv
-&gt; String
-&gt; Maybe ModLocation
-&gt; [String]
-&gt; IO (DynFlags, String, Maybe ModIface)
</span><a href="GHC.Driver.Pipeline.html#runPipeline%27"><span class="hs-identifier hs-var">runPipeline'</span></a></span><span> </span><span class="annot"><span class="annottext">PhasePlus
</span><a href="#local-6989586621681201589"><span class="hs-identifier hs-var">start_phase</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681201596"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621681201580"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201567"><span class="hs-identifier hs-var">input_fn'</span></a></span><span>
</span><span id="line-738"></span><span>                           </span><span class="annot"><span class="annottext">Maybe ModLocation
</span><a href="#local-6989586621681201602"><span class="hs-identifier hs-var">maybe_loc</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201601"><span class="hs-identifier hs-var">foreign_os</span></a></span><span>
</span><span id="line-739"></span><span>
</span><span id="line-740"></span><span>         </span><span class="hs-comment">-- If we are compiling a Haskell module, and doing</span><span>
</span><span id="line-741"></span><span>         </span><span class="hs-comment">-- -dynamic-too, but couldn't do the -dynamic-too fast</span><span>
</span><span id="line-742"></span><span>         </span><span class="hs-comment">-- path, then rerun the pipeline for the dyn way</span><span>
</span><span id="line-743"></span><span>         </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201554"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621681201554"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681201596"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-744"></span><span>         </span><span class="hs-comment">-- NB: Currently disabled on Windows (ref #7134, #8228, and #5987)</span><span>
</span><span id="line-745"></span><span>         </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; OS
</span><a href="../../ghc-boot/src/GHC.Platform.html#platformOS"><span class="hs-identifier hs-var">platformOS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.Session.html#targetPlatform"><span class="hs-identifier hs-var hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201554"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OS -&gt; OS -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="../../ghc-boot/src/GHC.Platform.html#OSMinGW32"><span class="hs-identifier hs-var">OSMinGW32</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-746"></span><span>           </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681201581"><span class="hs-identifier hs-var">isHaskellishFile</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; IO () -&gt; IO ()
forall (m :: * -&gt; *). MonadIO m =&gt; DynFlags -&gt; m () -&gt; m ()
</span><a href="GHC.Driver.Session.html#whenCannotGenerateDynamicToo"><span class="hs-identifier hs-var">whenCannotGenerateDynamicToo</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201554"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-747"></span><span>               </span><span class="annot"><span class="annottext">DynFlags -&gt; Int -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201554"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span>
</span><span id="line-748"></span><span>                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Running the pipeline again for -dynamic-too&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-749"></span><span>               </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201550"><span class="annot"><span class="annottext">dflags' :: DynFlags
</span><a href="#local-6989586621681201550"><span class="hs-identifier hs-var hs-var">dflags'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; DynFlags
</span><a href="GHC.Driver.Session.html#dynamicTooMkDynamicDynFlags"><span class="hs-identifier hs-var">dynamicTooMkDynamicDynFlags</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201554"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-750"></span><span>               </span><span id="local-6989586621681201548"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681201548"><span class="hs-identifier hs-var">hsc_env'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; IO HscEnv
</span><a href="GHC.Driver.Main.html#newHscEnv"><span class="hs-identifier hs-var">newHscEnv</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201550"><span class="hs-identifier hs-var">dflags'</span></a></span><span>
</span><span id="line-751"></span><span>               </span><span class="annot"><span class="annottext">(DynFlags, String, Maybe ModIface)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PhasePlus
-&gt; HscEnv
-&gt; PipeEnv
-&gt; String
-&gt; Maybe ModLocation
-&gt; [String]
-&gt; IO (DynFlags, String, Maybe ModIface)
</span><a href="GHC.Driver.Pipeline.html#runPipeline%27"><span class="hs-identifier hs-var">runPipeline'</span></a></span><span> </span><span class="annot"><span class="annottext">PhasePlus
</span><a href="#local-6989586621681201589"><span class="hs-identifier hs-var">start_phase</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681201548"><span class="hs-identifier hs-var">hsc_env'</span></a></span><span> </span><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621681201580"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201567"><span class="hs-identifier hs-var">input_fn'</span></a></span><span>
</span><span id="line-752"></span><span>                                 </span><span class="annot"><span class="annottext">Maybe ModLocation
</span><a href="#local-6989586621681201602"><span class="hs-identifier hs-var">maybe_loc</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201601"><span class="hs-identifier hs-var">foreign_os</span></a></span><span>
</span><span id="line-753"></span><span>               </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-754"></span><span>         </span><span class="annot"><span class="annottext">(DynFlags, String, Maybe ModIface)
-&gt; IO (DynFlags, String, Maybe ModIface)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(DynFlags, String, Maybe ModIface)
</span><a href="#local-6989586621681201556"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-755"></span><span>
</span><span id="line-756"></span><span class="annot"><a href="GHC.Driver.Pipeline.html#runPipeline%27"><span class="hs-identifier hs-type">runPipeline'</span></a></span><span>
</span><span id="line-757"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#PhasePlus"><span class="hs-identifier hs-type">PhasePlus</span></a></span><span>                  </span><span class="hs-comment">-- ^ When to start</span><span>
</span><span id="line-758"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>                     </span><span class="hs-comment">-- ^ Compilation environment</span><span>
</span><span id="line-759"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#PipeEnv"><span class="hs-identifier hs-type">PipeEnv</span></a></span><span>
</span><span id="line-760"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>                   </span><span class="hs-comment">-- ^ Input filename</span><span>
</span><span id="line-761"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Location.html#ModLocation"><span class="hs-identifier hs-type">ModLocation</span></a></span><span>          </span><span class="hs-comment">-- ^ A ModLocation, if this is a Haskell module</span><span>
</span><span id="line-762"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../base/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span class="hs-special">]</span><span>                 </span><span class="hs-comment">-- ^ foreign objects, if we have one</span><span>
</span><span id="line-763"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-764"></span><span>                                </span><span class="hs-comment">-- ^ (final flags, output filename, interface)</span><span>
</span><span id="line-765"></span><span id="runPipeline%27"><span class="annot"><span class="annottext">runPipeline' :: PhasePlus
-&gt; HscEnv
-&gt; PipeEnv
-&gt; String
-&gt; Maybe ModLocation
-&gt; [String]
-&gt; IO (DynFlags, String, Maybe ModIface)
</span><a href="GHC.Driver.Pipeline.html#runPipeline%27"><span class="hs-identifier hs-var hs-var">runPipeline'</span></a></span></span><span> </span><span id="local-6989586621681201546"><span class="annot"><span class="annottext">PhasePlus
</span><a href="#local-6989586621681201546"><span class="hs-identifier hs-var">start_phase</span></a></span></span><span> </span><span id="local-6989586621681201545"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681201545"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681201544"><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621681201544"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621681201543"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201543"><span class="hs-identifier hs-var">input_fn</span></a></span></span><span>
</span><span id="line-766"></span><span>             </span><span id="local-6989586621681201542"><span class="annot"><span class="annottext">Maybe ModLocation
</span><a href="#local-6989586621681201542"><span class="hs-identifier hs-var">maybe_loc</span></a></span></span><span> </span><span id="local-6989586621681201541"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201541"><span class="hs-identifier hs-var">foreign_os</span></a></span></span><span>
</span><span id="line-767"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-768"></span><span>  </span><span class="hs-comment">-- Execute the pipeline...</span><span>
</span><span id="line-769"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201540"><span class="annot"><span class="annottext">state :: PipeState
</span><a href="#local-6989586621681201540"><span class="hs-identifier hs-var hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PipeState :: HscEnv
-&gt; Maybe ModLocation -&gt; [String] -&gt; Maybe ModIface -&gt; PipeState
</span><a href="GHC.Driver.Pipeline.Monad.html#PipeState"><span class="hs-identifier hs-type">PipeState</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">HscEnv
hsc_env :: HscEnv
hsc_env :: HscEnv
</span><a href="GHC.Driver.Pipeline.Monad.html#hsc_env"><span class="hs-identifier hs-var hs-var">hsc_env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe ModLocation
maybe_loc :: Maybe ModLocation
maybe_loc :: Maybe ModLocation
</span><a href="GHC.Driver.Pipeline.Monad.html#maybe_loc"><span class="hs-identifier hs-var hs-var">maybe_loc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">foreign_os :: [String]
</span><a href="GHC.Driver.Pipeline.Monad.html#foreign_os"><span class="hs-identifier hs-var">foreign_os</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201541"><span class="hs-identifier hs-var">foreign_os</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">iface :: Maybe ModIface
</span><a href="GHC.Driver.Pipeline.Monad.html#iface"><span class="hs-identifier hs-var">iface</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ModIface
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-770"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621681201534"><span class="annot"><span class="annottext">PipeState
</span><a href="#local-6989586621681201534"><span class="hs-identifier hs-var">pipe_state</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681201533"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201533"><span class="hs-identifier hs-var">fp</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CompPipeline String
-&gt; PipeEnv -&gt; PipeState -&gt; IO (PipeState, String)
forall a.
CompPipeline a -&gt; PipeEnv -&gt; PipeState -&gt; IO (PipeState, a)
</span><a href="GHC.Driver.Pipeline.Monad.html#evalP"><span class="hs-identifier hs-var">evalP</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PhasePlus -&gt; String -&gt; CompPipeline String
</span><a href="GHC.Driver.Pipeline.html#pipeLoop"><span class="hs-identifier hs-var">pipeLoop</span></a></span><span> </span><span class="annot"><span class="annottext">PhasePlus
</span><a href="#local-6989586621681201546"><span class="hs-identifier hs-var">start_phase</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201543"><span class="hs-identifier hs-var">input_fn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621681201544"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState
</span><a href="#local-6989586621681201540"><span class="hs-identifier hs-var">state</span></a></span><span>
</span><span id="line-771"></span><span>  </span><span class="annot"><span class="annottext">(DynFlags, String, Maybe ModIface)
-&gt; IO (DynFlags, String, Maybe ModIface)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PipeState -&gt; DynFlags
</span><a href="GHC.Driver.Pipeline.Monad.html#pipeStateDynFlags"><span class="hs-identifier hs-var">pipeStateDynFlags</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState
</span><a href="#local-6989586621681201534"><span class="hs-identifier hs-var">pipe_state</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201533"><span class="hs-identifier hs-var">fp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PipeState -&gt; Maybe ModIface
</span><a href="GHC.Driver.Pipeline.Monad.html#pipeStateModIface"><span class="hs-identifier hs-var">pipeStateModIface</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState
</span><a href="#local-6989586621681201534"><span class="hs-identifier hs-var">pipe_state</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-772"></span><span>
</span><span id="line-773"></span><span class="hs-comment">-- ---------------------------------------------------------------------------</span><span>
</span><span id="line-774"></span><span class="hs-comment">-- outer pipeline loop</span><span>
</span><span id="line-775"></span><span>
</span><span id="line-776"></span><span class="hs-comment">-- | pipeLoop runs phases until we reach the stop phase</span><span>
</span><span id="line-777"></span><span class="annot"><a href="GHC.Driver.Pipeline.html#pipeLoop"><span class="hs-identifier hs-type">pipeLoop</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#PhasePlus"><span class="hs-identifier hs-type">PhasePlus</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#CompPipeline"><span class="hs-identifier hs-type">CompPipeline</span></a></span><span> </span><span class="annot"><a href="../../base/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>
</span><span id="line-778"></span><span id="pipeLoop"><span class="annot"><span class="annottext">pipeLoop :: PhasePlus -&gt; String -&gt; CompPipeline String
</span><a href="GHC.Driver.Pipeline.html#pipeLoop"><span class="hs-identifier hs-var hs-var">pipeLoop</span></a></span></span><span> </span><span id="local-6989586621681201528"><span class="annot"><span class="annottext">PhasePlus
</span><a href="#local-6989586621681201528"><span class="hs-identifier hs-var">phase</span></a></span></span><span> </span><span id="local-6989586621681201527"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201527"><span class="hs-identifier hs-var">input_fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-779"></span><span>  </span><span id="local-6989586621681201526"><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621681201526"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CompPipeline PipeEnv
</span><a href="GHC.Driver.Pipeline.Monad.html#getPipeEnv"><span class="hs-identifier hs-var">getPipeEnv</span></a></span><span>
</span><span id="line-780"></span><span>  </span><span id="local-6989586621681201525"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201525"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CompPipeline DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-781"></span><span>  </span><span class="hs-comment">-- See Note [Partial ordering on phases]</span><span>
</span><span id="line-782"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201523"><span class="annot"><span class="annottext">happensBefore' :: Phase -&gt; Phase -&gt; Bool
</span><a href="#local-6989586621681201523"><span class="hs-identifier hs-var hs-var">happensBefore'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Phase -&gt; Phase -&gt; Bool
</span><a href="GHC.Driver.Phases.html#happensBefore"><span class="hs-identifier hs-var">happensBefore</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.Session.html#targetPlatform"><span class="hs-identifier hs-var hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201525"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-783"></span><span>      </span><span id="local-6989586621681201522"><span class="annot"><span class="annottext">stopPhase :: Phase
</span><a href="#local-6989586621681201522"><span class="hs-identifier hs-var hs-var">stopPhase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PipeEnv -&gt; Phase
</span><a href="GHC.Driver.Pipeline.Monad.html#stop_phase"><span class="hs-identifier hs-var hs-var">stop_phase</span></a></span><span> </span><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621681201526"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-784"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PhasePlus
</span><a href="#local-6989586621681201528"><span class="hs-identifier hs-var">phase</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-785"></span><span>   </span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#RealPhase"><span class="hs-identifier hs-type">RealPhase</span></a></span><span> </span><span id="local-6989586621681201521"><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201521"><span class="hs-identifier hs-var">realPhase</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201521"><span class="hs-identifier hs-var">realPhase</span></a></span><span> </span><span class="annot"><span class="annottext">Phase -&gt; Phase -&gt; Bool
</span><a href="GHC.Driver.Phases.html#eqPhase"><span class="hs-operator hs-var">`eqPhase`</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201522"><span class="hs-identifier hs-var">stopPhase</span></a></span><span>            </span><span class="hs-comment">-- All done</span><span>
</span><span id="line-786"></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-comment">-- Sometimes, a compilation phase doesn't actually generate any output</span><span>
</span><span id="line-787"></span><span>        </span><span class="hs-comment">-- (eg. the CPP phase when -fcpp is not turned on).  If we end on this</span><span>
</span><span id="line-788"></span><span>        </span><span class="hs-comment">-- stage, but we wanted to keep the output, then we have to explicitly</span><span>
</span><span id="line-789"></span><span>        </span><span class="hs-comment">-- copy the file, remembering to prepend a {-# LINE #-} pragma so that</span><span>
</span><span id="line-790"></span><span>        </span><span class="hs-comment">-- further compilation stages can tell what the original filename was.</span><span>
</span><span id="line-791"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PipeEnv -&gt; PipelineOutput
</span><a href="GHC.Driver.Pipeline.Monad.html#output_spec"><span class="hs-identifier hs-var hs-var">output_spec</span></a></span><span> </span><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621681201526"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-792"></span><span>        </span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#Temporary"><span class="hs-identifier hs-type">Temporary</span></a></span><span> </span><span class="annot"><span class="annottext">TempFileLifetime
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-793"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; CompPipeline String
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201527"><span class="hs-identifier hs-var">input_fn</span></a></span><span>
</span><span id="line-794"></span><span>        </span><span id="local-6989586621681201520"><span class="annot"><span class="annottext">PipelineOutput
</span><a href="#local-6989586621681201520"><span class="hs-identifier hs-var">output</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-795"></span><span>            </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621681201519"><span class="annot"><span class="annottext">PipeState
</span><a href="#local-6989586621681201519"><span class="hs-identifier hs-var">pst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CompPipeline PipeState
</span><a href="GHC.Driver.Pipeline.Monad.html#getPipeState"><span class="hs-identifier hs-var">getPipeState</span></a></span><span>
</span><span id="line-796"></span><span>               </span><span id="local-6989586621681201518"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201518"><span class="hs-identifier hs-var">final_fn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO String -&gt; CompPipeline String
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO String -&gt; CompPipeline String)
-&gt; IO String -&gt; CompPipeline String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
-&gt; PipelineOutput
-&gt; String
-&gt; DynFlags
-&gt; Phase
-&gt; Maybe ModLocation
-&gt; IO String
</span><a href="GHC.Driver.Pipeline.html#getOutputFilename"><span class="hs-identifier hs-var">getOutputFilename</span></a></span><span>
</span><span id="line-797"></span><span>                                        </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201522"><span class="hs-identifier hs-var">stopPhase</span></a></span><span> </span><span class="annot"><span class="annottext">PipelineOutput
</span><a href="#local-6989586621681201520"><span class="hs-identifier hs-var">output</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PipeEnv -&gt; String
</span><a href="GHC.Driver.Pipeline.Monad.html#src_basename"><span class="hs-identifier hs-var hs-var">src_basename</span></a></span><span> </span><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621681201526"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-798"></span><span>                                        </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201525"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201522"><span class="hs-identifier hs-var">stopPhase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PipeState -&gt; Maybe ModLocation
</span><a href="GHC.Driver.Pipeline.Monad.html#maybe_loc"><span class="hs-identifier hs-var hs-var">maybe_loc</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState
</span><a href="#local-6989586621681201519"><span class="hs-identifier hs-var">pst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-799"></span><span>               </span><span class="annot"><span class="annottext">Bool -&gt; CompPipeline () -&gt; CompPipeline ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201518"><span class="hs-identifier hs-var">final_fn</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201527"><span class="hs-identifier hs-var">input_fn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(CompPipeline () -&gt; CompPipeline ())
-&gt; CompPipeline () -&gt; CompPipeline ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-800"></span><span>                  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201516"><span class="annot"><span class="annottext">msg :: String
</span><a href="#local-6989586621681201516"><span class="hs-identifier hs-var hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Copying `&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201527"><span class="hs-identifier hs-var">input_fn</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;' to `&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201518"><span class="hs-identifier hs-var">final_fn</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;'&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-801"></span><span>                      </span><span id="local-6989586621681201515"><span class="annot"><span class="annottext">line_prag :: Maybe String
</span><a href="#local-6989586621681201515"><span class="hs-identifier hs-var hs-var">line_prag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe String
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;{-# LINE 1 \&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">PipeEnv -&gt; String
</span><a href="GHC.Driver.Pipeline.Monad.html#src_filename"><span class="hs-identifier hs-var hs-var">src_filename</span></a></span><span> </span><span class="annot"><span class="annottext">PipeEnv
</span><a href="#local-6989586621681201526"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\&quot; #-}\n&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-802"></span><span>                  </span><span class="annot"><span class="annottext">IO () -&gt; CompPipeline ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; CompPipeline ()) -&gt; IO () -&gt; CompPipeline ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; String -&gt; Maybe String -&gt; String -&gt; String -&gt; IO ()
</span><a href="GHC.SysTools.html#copyWithHeader"><span class="hs-identifier hs-var">copyWithHeader</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201525"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201516"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621681201515"><span class="hs-identifier hs-var">line_prag</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201527"><span class="hs-identifier hs-var">input_fn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201518"><span class="hs-identifier hs-var">final_fn</span></a></span><span>
</span><span id="line-803"></span><span>               </span><span class="annot"><span class="annottext">String -&gt; CompPipeline String
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201518"><span class="hs-identifier hs-var">final_fn</span></a></span><span>
</span><span id="line-804"></span><span>
</span><span id="line-805"></span><span>
</span><span id="line-806"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201521"><span class="hs-identifier hs-var">realPhase</span></a></span><span> </span><span class="annot"><span class="annottext">Phase -&gt; Phase -&gt; Bool
</span><a href="#local-6989586621681201523"><span class="hs-operator hs-var">`happensBefore'`</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201522"><span class="hs-identifier hs-var">stopPhase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-807"></span><span>        </span><span class="hs-comment">-- Something has gone wrong.  We'll try to cover all the cases when</span><span>
</span><span id="line-808"></span><span>        </span><span class="hs-comment">-- this could happen, so if we reach here it is a panic.</span><span>
</span><span id="line-809"></span><span>        </span><span class="hs-comment">-- eg. it might happen if the -C flag is used on a source file that</span><span>
</span><span id="line-810"></span><span>        </span><span class="hs-comment">-- has {-# OPTIONS -fasm #-}.</span><span>
</span><span id="line-811"></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; CompPipeline String
forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;pipeLoop: at phase &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Phase -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../base/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201521"><span class="hs-identifier hs-var">realPhase</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-812"></span><span>           </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; but I wanted to stop at phase &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Phase -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../base/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201522"><span class="hs-identifier hs-var">stopPhase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-813"></span><span>
</span><span id="line-814"></span><span>   </span><span class="annot"><span class="annottext">PhasePlus
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-815"></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; CompPipeline ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; CompPipeline ()) -&gt; IO () -&gt; CompPipeline ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Int -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201525"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span>
</span><span id="line-816"></span><span>                                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Running phase&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">PhasePlus -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">PhasePlus
</span><a href="#local-6989586621681201528"><span class="hs-identifier hs-var">phase</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-817"></span><span>           </span><span class="hs-special">(</span><span id="local-6989586621681201513"><span class="annot"><span class="annottext">PhasePlus
</span><a href="#local-6989586621681201513"><span class="hs-identifier hs-var">next_phase</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681201512"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201512"><span class="hs-identifier hs-var">output_fn</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PhasePlus -&gt; String -&gt; DynFlags -&gt; CompPipeline (PhasePlus, String)
</span><a href="GHC.Driver.Pipeline.html#runHookedPhase"><span class="hs-identifier hs-var">runHookedPhase</span></a></span><span> </span><span class="annot"><span class="annottext">PhasePlus
</span><a href="#local-6989586621681201528"><span class="hs-identifier hs-var">phase</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201527"><span class="hs-identifier hs-var">input_fn</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201525"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-818"></span><span>           </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PhasePlus
</span><a href="#local-6989586621681201528"><span class="hs-identifier hs-var">phase</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-819"></span><span>               </span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#HscOut"><span class="hs-identifier hs-type">HscOut</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-820"></span><span>                   </span><span class="hs-comment">-- We don't pass Opt_BuildDynamicToo to the backend</span><span>
</span><span id="line-821"></span><span>                   </span><span class="hs-comment">-- in DynFlags.</span><span>
</span><span id="line-822"></span><span>                   </span><span class="hs-comment">-- Instead it's run twice with flags accordingly set</span><span>
</span><span id="line-823"></span><span>                   </span><span class="hs-comment">-- per run.</span><span>
</span><span id="line-824"></span><span>                   </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201510"><span class="annot"><span class="annottext">noDynToo :: CompPipeline String
</span><a href="#local-6989586621681201510"><span class="hs-identifier hs-var hs-var">noDynToo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PhasePlus -&gt; String -&gt; CompPipeline String
</span><a href="GHC.Driver.Pipeline.html#pipeLoop"><span class="hs-identifier hs-var">pipeLoop</span></a></span><span> </span><span class="annot"><span class="annottext">PhasePlus
</span><a href="#local-6989586621681201513"><span class="hs-identifier hs-var">next_phase</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201512"><span class="hs-identifier hs-var">output_fn</span></a></span><span>
</span><span id="line-825"></span><span>                   </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201504"><span class="annot"><span class="annottext">dynToo :: CompPipeline String
</span><a href="#local-6989586621681201504"><span class="hs-identifier hs-var hs-var">dynToo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-826"></span><span>                          </span><span class="annot"><span class="annottext">DynFlags -&gt; CompPipeline ()
</span><a href="GHC.Driver.Pipeline.Monad.html#setDynFlags"><span class="hs-identifier hs-var">setDynFlags</span></a></span><span> </span><span class="annot"><span class="annottext">(DynFlags -&gt; CompPipeline ()) -&gt; DynFlags -&gt; CompPipeline ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; GeneralFlag -&gt; DynFlags
</span><a href="GHC.Driver.Session.html#gopt_unset"><span class="hs-identifier hs-var">gopt_unset</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201525"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_BuildDynamicToo"><span class="hs-identifier hs-var">Opt_BuildDynamicToo</span></a></span><span>
</span><span id="line-827"></span><span>                          </span><span id="local-6989586621681201502"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201502"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PhasePlus -&gt; String -&gt; CompPipeline String
</span><a href="GHC.Driver.Pipeline.html#pipeLoop"><span class="hs-identifier hs-var">pipeLoop</span></a></span><span> </span><span class="annot"><span class="annottext">PhasePlus
</span><a href="#local-6989586621681201513"><span class="hs-identifier hs-var">next_phase</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201512"><span class="hs-identifier hs-var">output_fn</span></a></span><span>
</span><span id="line-828"></span><span>                          </span><span class="annot"><span class="annottext">DynFlags -&gt; CompPipeline ()
</span><a href="GHC.Driver.Pipeline.Monad.html#setDynFlags"><span class="hs-identifier hs-var">setDynFlags</span></a></span><span> </span><span class="annot"><span class="annottext">(DynFlags -&gt; CompPipeline ()) -&gt; DynFlags -&gt; CompPipeline ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; DynFlags
</span><a href="GHC.Driver.Session.html#dynamicTooMkDynamicDynFlags"><span class="hs-identifier hs-var">dynamicTooMkDynamicDynFlags</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201525"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-829"></span><span>                          </span><span class="hs-comment">-- TODO shouldn't ignore result:</span><span>
</span><span id="line-830"></span><span>                          </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PhasePlus -&gt; String -&gt; CompPipeline String
</span><a href="GHC.Driver.Pipeline.html#pipeLoop"><span class="hs-identifier hs-var">pipeLoop</span></a></span><span> </span><span class="annot"><span class="annottext">PhasePlus
</span><a href="#local-6989586621681201528"><span class="hs-identifier hs-var">phase</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201527"><span class="hs-identifier hs-var">input_fn</span></a></span><span>
</span><span id="line-831"></span><span>                          </span><span class="annot"><span class="annottext">String -&gt; CompPipeline String
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201502"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-832"></span><span>                   </span><span class="annot"><span class="annottext">DynFlags
-&gt; CompPipeline String
-&gt; CompPipeline String
-&gt; CompPipeline String
forall (m :: * -&gt; *) a. MonadIO m =&gt; DynFlags -&gt; m a -&gt; m a -&gt; m a
</span><a href="GHC.Driver.Session.html#ifGeneratingDynamicToo"><span class="hs-identifier hs-var">ifGeneratingDynamicToo</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201525"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">CompPipeline String
</span><a href="#local-6989586621681201504"><span class="hs-identifier hs-var">dynToo</span></a></span><span> </span><span class="annot"><span class="annottext">CompPipeline String
</span><a href="#local-6989586621681201510"><span class="hs-identifier hs-var">noDynToo</span></a></span><span>
</span><span id="line-833"></span><span>               </span><span class="annot"><span class="annottext">PhasePlus
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PhasePlus -&gt; String -&gt; CompPipeline String
</span><a href="GHC.Driver.Pipeline.html#pipeLoop"><span class="hs-identifier hs-var">pipeLoop</span></a></span><span> </span><span class="annot"><span class="annottext">PhasePlus
</span><a href="#local-6989586621681201513"><span class="hs-identifier hs-var">next_phase</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201512"><span class="hs-identifier hs-var">output_fn</span></a></span><span>
</span><span id="line-834"></span><span>
</span><span id="line-835"></span><span class="annot"><a href="GHC.Driver.Pipeline.html#runHookedPhase"><span class="hs-identifier hs-type">runHookedPhase</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#PhasePlus"><span class="hs-identifier hs-type">PhasePlus</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span>
</span><span id="line-836"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#CompPipeline"><span class="hs-identifier hs-type">CompPipeline</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#PhasePlus"><span class="hs-identifier hs-type">PhasePlus</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-837"></span><span id="runHookedPhase"><span class="annot"><span class="annottext">runHookedPhase :: PhasePlus -&gt; String -&gt; DynFlags -&gt; CompPipeline (PhasePlus, String)
</span><a href="GHC.Driver.Pipeline.html#runHookedPhase"><span class="hs-identifier hs-var hs-var">runHookedPhase</span></a></span></span><span> </span><span id="local-6989586621681201500"><span class="annot"><span class="annottext">PhasePlus
</span><a href="#local-6989586621681201500"><span class="hs-identifier hs-var">pp</span></a></span></span><span> </span><span id="local-6989586621681201499"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201499"><span class="hs-identifier hs-var">input</span></a></span></span><span> </span><span id="local-6989586621681201498"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201498"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-838"></span><span>  </span><span class="annot"><span class="annottext">(Hooks
 -&gt; Maybe
      (PhasePlus
       -&gt; String -&gt; DynFlags -&gt; CompPipeline (PhasePlus, String)))
-&gt; (PhasePlus
    -&gt; String -&gt; DynFlags -&gt; CompPipeline (PhasePlus, String))
-&gt; DynFlags
-&gt; PhasePlus
-&gt; String
-&gt; DynFlags
-&gt; CompPipeline (PhasePlus, String)
forall a. (Hooks -&gt; Maybe a) -&gt; a -&gt; DynFlags -&gt; a
</span><a href="GHC.Driver.Hooks.html#lookupHook"><span class="hs-identifier hs-var">lookupHook</span></a></span><span> </span><span class="annot"><span class="annottext">Hooks
-&gt; Maybe
     (PhasePlus
      -&gt; String -&gt; DynFlags -&gt; CompPipeline (PhasePlus, String))
</span><a href="GHC.Driver.Hooks.html#runPhaseHook"><span class="hs-identifier hs-var hs-var">runPhaseHook</span></a></span><span> </span><span class="annot"><span class="annottext">PhasePlus -&gt; String -&gt; DynFlags -&gt; CompPipeline (PhasePlus, String)
</span><a href="GHC.Driver.Pipeline.html#runPhase"><span class="hs-identifier hs-var">runPhase</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201498"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">PhasePlus
</span><a href="#local-6989586621681201500"><span class="hs-identifier hs-var">pp</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201499"><span class="hs-identifier hs-var">input</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201498"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-839"></span><span>
</span><span id="line-840"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-841"></span><span class="hs-comment">-- In each phase, we need to know into what filename to generate the</span><span>
</span><span id="line-842"></span><span class="hs-comment">-- output.  All the logic about which filenames we generate output</span><span>
</span><span id="line-843"></span><span class="hs-comment">-- into is embodied in the following function.</span><span>
</span><span id="line-844"></span><span>
</span><span id="line-845"></span><span class="hs-comment">-- | Computes the next output filename after we run @next_phase@.</span><span>
</span><span id="line-846"></span><span class="hs-comment">-- Like 'getOutputFilename', but it operates in the 'CompPipeline' monad</span><span>
</span><span id="line-847"></span><span class="hs-comment">-- (which specifies all of the ambient information.)</span><span>
</span><span id="line-848"></span><span class="annot"><a href="GHC.Driver.Pipeline.html#phaseOutputFilename"><span class="hs-identifier hs-type">phaseOutputFilename</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Phases.html#Phase"><span class="hs-identifier hs-type">Phase</span></a></span><span class="hs-comment">{-next phase-}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#CompPipeline"><span class="hs-identifier hs-type">CompPipeline</span></a></span><span> </span><span class="annot"><a href="../../base/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>
</span><span id="line-849"></span><span id="phaseOutputFilename"><span class="annot"><span class="annottext">phaseOutputFilename :: Phase -&gt; CompPipeline String
</span><a href="GHC.Driver.Pipeline.html#phaseOutputFilename"><span class="hs-identifier hs-var hs-var">phaseOutputFilename</span></a></span></span><span> </span><span id="local-6989586621681201496"><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201496"><span class="hs-identifier hs-var">next_phase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-850"></span><span>  </span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#PipeEnv"><span class="hs-identifier hs-type">PipeEnv</span></a></span><span class="hs-special">{</span><span id="local-6989586621681201495"><span class="annot"><span class="annottext">Phase
stop_phase :: Phase
stop_phase :: PipeEnv -&gt; Phase
</span><a href="#local-6989586621681201495"><span class="hs-identifier hs-var hs-var">stop_phase</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681201494"><span class="annot"><span class="annottext">String
src_basename :: String
src_basename :: PipeEnv -&gt; String
</span><a href="#local-6989586621681201494"><span class="hs-identifier hs-var hs-var">src_basename</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681201493"><span class="annot"><span class="annottext">PipelineOutput
output_spec :: PipelineOutput
output_spec :: PipeEnv -&gt; PipelineOutput
</span><a href="#local-6989586621681201493"><span class="hs-identifier hs-var hs-var">output_spec</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CompPipeline PipeEnv
</span><a href="GHC.Driver.Pipeline.Monad.html#getPipeEnv"><span class="hs-identifier hs-var">getPipeEnv</span></a></span><span>
</span><span id="line-851"></span><span>  </span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#PipeState"><span class="hs-identifier hs-type">PipeState</span></a></span><span class="hs-special">{</span><span id="local-6989586621681201492"><span class="annot"><span class="annottext">Maybe ModLocation
maybe_loc :: Maybe ModLocation
maybe_loc :: PipeState -&gt; Maybe ModLocation
</span><a href="#local-6989586621681201492"><span class="hs-identifier hs-var hs-var">maybe_loc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681201491"><span class="annot"><span class="annottext">HscEnv
hsc_env :: HscEnv
hsc_env :: PipeState -&gt; HscEnv
</span><a href="#local-6989586621681201491"><span class="hs-identifier hs-var hs-var">hsc_env</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CompPipeline PipeState
</span><a href="GHC.Driver.Pipeline.Monad.html#getPipeState"><span class="hs-identifier hs-var">getPipeState</span></a></span><span>
</span><span id="line-852"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201490"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621681201490"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681201491"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-853"></span><span>  </span><span class="annot"><span class="annottext">IO String -&gt; CompPipeline String
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO String -&gt; CompPipeline String)
-&gt; IO String -&gt; CompPipeline String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
-&gt; PipelineOutput
-&gt; String
-&gt; DynFlags
-&gt; Phase
-&gt; Maybe ModLocation
-&gt; IO String
</span><a href="GHC.Driver.Pipeline.html#getOutputFilename"><span class="hs-identifier hs-var">getOutputFilename</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201495"><span class="hs-identifier hs-var">stop_phase</span></a></span><span> </span><span class="annot"><span class="annottext">PipelineOutput
</span><a href="#local-6989586621681201493"><span class="hs-identifier hs-var">output_spec</span></a></span><span>
</span><span id="line-854"></span><span>                             </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201494"><span class="hs-identifier hs-var">src_basename</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201490"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201496"><span class="hs-identifier hs-var">next_phase</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ModLocation
</span><a href="#local-6989586621681201492"><span class="hs-identifier hs-var">maybe_loc</span></a></span><span>
</span><span id="line-855"></span><span>
</span><span id="line-856"></span><span class="hs-comment">-- | Computes the next output filename for something in the compilation</span><span>
</span><span id="line-857"></span><span class="hs-comment">-- pipeline.  This is controlled by several variables:</span><span>
</span><span id="line-858"></span><span class="hs-comment">--</span><span>
</span><span id="line-859"></span><span class="hs-comment">--      1. 'Phase': the last phase to be run (e.g. 'stopPhase').  This</span><span>
</span><span id="line-860"></span><span class="hs-comment">--         is used to tell if we're in the last phase or not, because</span><span>
</span><span id="line-861"></span><span class="hs-comment">--         in that case flags like @-o@ may be important.</span><span>
</span><span id="line-862"></span><span class="hs-comment">--      2. 'PipelineOutput': is this intended to be a 'Temporary' or</span><span>
</span><span id="line-863"></span><span class="hs-comment">--         'Persistent' build output?  Temporary files just go in</span><span>
</span><span id="line-864"></span><span class="hs-comment">--         a fresh temporary name.</span><span>
</span><span id="line-865"></span><span class="hs-comment">--      3. 'String': what was the basename of the original input file?</span><span>
</span><span id="line-866"></span><span class="hs-comment">--      4. 'DynFlags': the obvious thing</span><span>
</span><span id="line-867"></span><span class="hs-comment">--      5. 'Phase': the phase we want to determine the output filename of.</span><span>
</span><span id="line-868"></span><span class="hs-comment">--      6. @Maybe ModLocation@: the 'ModLocation' of the module we're</span><span>
</span><span id="line-869"></span><span class="hs-comment">--         compiling; this can be used to override the default output</span><span>
</span><span id="line-870"></span><span class="hs-comment">--         of an object file.  (TODO: do we actually need this?)</span><span>
</span><span id="line-871"></span><span class="annot"><a href="GHC.Driver.Pipeline.html#getOutputFilename"><span class="hs-identifier hs-type">getOutputFilename</span></a></span><span>
</span><span id="line-872"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Phases.html#Phase"><span class="hs-identifier hs-type">Phase</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#PipelineOutput"><span class="hs-identifier hs-type">PipelineOutput</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span>
</span><span id="line-873"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Phases.html#Phase"><span class="hs-identifier hs-type">Phase</span></a></span><span class="hs-comment">{-next phase-}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Location.html#ModLocation"><span class="hs-identifier hs-type">ModLocation</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="../../base/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>
</span><span id="line-874"></span><span id="getOutputFilename"><span class="annot"><span class="annottext">getOutputFilename :: Phase
-&gt; PipelineOutput
-&gt; String
-&gt; DynFlags
-&gt; Phase
-&gt; Maybe ModLocation
-&gt; IO String
</span><a href="GHC.Driver.Pipeline.html#getOutputFilename"><span class="hs-identifier hs-var hs-var">getOutputFilename</span></a></span></span><span> </span><span id="local-6989586621681201489"><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201489"><span class="hs-identifier hs-var">stop_phase</span></a></span></span><span> </span><span id="local-6989586621681201488"><span class="annot"><span class="annottext">PipelineOutput
</span><a href="#local-6989586621681201488"><span class="hs-identifier hs-var">output</span></a></span></span><span> </span><span id="local-6989586621681201487"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201487"><span class="hs-identifier hs-var">basename</span></a></span></span><span> </span><span id="local-6989586621681201486"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201486"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621681201485"><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201485"><span class="hs-identifier hs-var">next_phase</span></a></span></span><span> </span><span id="local-6989586621681201484"><span class="annot"><span class="annottext">Maybe ModLocation
</span><a href="#local-6989586621681201484"><span class="hs-identifier hs-var">maybe_location</span></a></span></span><span>
</span><span id="line-875"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681201483"><span class="hs-identifier hs-var">is_last_phase</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PipelineOutput
</span><a href="GHC.Driver.Pipeline.Monad.html#Persistent"><span class="hs-identifier hs-var">Persistent</span></a></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PipelineOutput
</span><a href="#local-6989586621681201488"><span class="hs-identifier hs-var">output</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO String
</span><a href="#local-6989586621681201482"><span class="hs-identifier hs-var">persistent_fn</span></a></span><span>
</span><span id="line-876"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681201483"><span class="hs-identifier hs-var">is_last_phase</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PipelineOutput
</span><a href="GHC.Driver.Pipeline.Monad.html#SpecificFile"><span class="hs-identifier hs-var">SpecificFile</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PipelineOutput
</span><a href="#local-6989586621681201488"><span class="hs-identifier hs-var">output</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Maybe String
</span><a href="GHC.Driver.Session.html#outputFile"><span class="hs-identifier hs-var hs-var">outputFile</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201486"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-877"></span><span>                                           </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681201481"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201481"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO String
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201481"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-878"></span><span>                                           </span><span class="annot"><span class="annottext">Maybe String
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-879"></span><span>                                               </span><span class="annot"><span class="annottext">String -&gt; IO String
forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;SpecificFile: No filename&quot;</span></span><span>
</span><span id="line-880"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681201480"><span class="hs-identifier hs-var">keep_this_output</span></a></span><span>                      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO String
</span><a href="#local-6989586621681201482"><span class="hs-identifier hs-var">persistent_fn</span></a></span><span>
</span><span id="line-881"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#Temporary"><span class="hs-identifier hs-type">Temporary</span></a></span><span> </span><span id="local-6989586621681201479"><span class="annot"><span class="annottext">TempFileLifetime
</span><a href="#local-6989586621681201479"><span class="hs-identifier hs-var">lifetime</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PipelineOutput
</span><a href="#local-6989586621681201488"><span class="hs-identifier hs-var">output</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; TempFileLifetime -&gt; String -&gt; IO String
</span><a href="GHC.SysTools.FileCleanup.html#newTempName"><span class="hs-identifier hs-var">newTempName</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201486"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">TempFileLifetime
</span><a href="#local-6989586621681201479"><span class="hs-identifier hs-var">lifetime</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201478"><span class="hs-identifier hs-var">suffix</span></a></span><span>
</span><span id="line-882"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>                             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; TempFileLifetime -&gt; String -&gt; IO String
</span><a href="GHC.SysTools.FileCleanup.html#newTempName"><span class="hs-identifier hs-var">newTempName</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201486"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">TempFileLifetime
</span><a href="GHC.SysTools.FileCleanup.html#TFL_CurrentModule"><span class="hs-identifier hs-var">TFL_CurrentModule</span></a></span><span>
</span><span id="line-883"></span><span>   </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201478"><span class="hs-identifier hs-var">suffix</span></a></span><span>
</span><span id="line-884"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-885"></span><span>          </span><span id="local-6989586621681201477"><span class="annot"><span class="annottext">hcsuf :: String
</span><a href="#local-6989586621681201477"><span class="hs-identifier hs-var hs-var">hcsuf</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; String
</span><a href="GHC.Driver.Session.html#hcSuf"><span class="hs-identifier hs-var hs-var">hcSuf</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201486"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-886"></span><span>          </span><span id="local-6989586621681201475"><span class="annot"><span class="annottext">odir :: Maybe String
</span><a href="#local-6989586621681201475"><span class="hs-identifier hs-var hs-var">odir</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Maybe String
</span><a href="GHC.Driver.Session.html#objectDir"><span class="hs-identifier hs-var hs-var">objectDir</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201486"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-887"></span><span>          </span><span id="local-6989586621681201473"><span class="annot"><span class="annottext">osuf :: String
</span><a href="#local-6989586621681201473"><span class="hs-identifier hs-var hs-var">osuf</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; String
</span><a href="GHC.Driver.Session.html#objectSuf"><span class="hs-identifier hs-var hs-var">objectSuf</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201486"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-888"></span><span>          </span><span id="local-6989586621681201471"><span class="annot"><span class="annottext">keep_hc :: Bool
</span><a href="#local-6989586621681201471"><span class="hs-identifier hs-var hs-var">keep_hc</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_KeepHcFiles"><span class="hs-identifier hs-var">Opt_KeepHcFiles</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201486"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-889"></span><span>          </span><span id="local-6989586621681201469"><span class="annot"><span class="annottext">keep_hscpp :: Bool
</span><a href="#local-6989586621681201469"><span class="hs-identifier hs-var hs-var">keep_hscpp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_KeepHscppFiles"><span class="hs-identifier hs-var">Opt_KeepHscppFiles</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201486"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-890"></span><span>          </span><span id="local-6989586621681201467"><span class="annot"><span class="annottext">keep_s :: Bool
</span><a href="#local-6989586621681201467"><span class="hs-identifier hs-var hs-var">keep_s</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_KeepSFiles"><span class="hs-identifier hs-var">Opt_KeepSFiles</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201486"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-891"></span><span>          </span><span id="local-6989586621681201465"><span class="annot"><span class="annottext">keep_bc :: Bool
</span><a href="#local-6989586621681201465"><span class="hs-identifier hs-var hs-var">keep_bc</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_KeepLlvmFiles"><span class="hs-identifier hs-var">Opt_KeepLlvmFiles</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201486"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-892"></span><span>
</span><span id="line-893"></span><span>          </span><span id="local-6989586621681201463"><span class="annot"><span class="annottext">myPhaseInputExt :: Phase -&gt; String
</span><a href="#local-6989586621681201463"><span class="hs-identifier hs-var hs-var">myPhaseInputExt</span></a></span></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#HCc"><span class="hs-identifier hs-var">HCc</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201477"><span class="hs-identifier hs-var">hcsuf</span></a></span><span>
</span><span id="line-894"></span><span>          </span><span class="annot"><a href="#local-6989586621681201463"><span class="hs-identifier hs-var">myPhaseInputExt</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#MergeForeign"><span class="hs-identifier hs-var">MergeForeign</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201473"><span class="hs-identifier hs-var">osuf</span></a></span><span>
</span><span id="line-895"></span><span>          </span><span class="annot"><a href="#local-6989586621681201463"><span class="hs-identifier hs-var">myPhaseInputExt</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#StopLn"><span class="hs-identifier hs-var">StopLn</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201473"><span class="hs-identifier hs-var">osuf</span></a></span><span>
</span><span id="line-896"></span><span>          </span><span class="annot"><a href="#local-6989586621681201463"><span class="hs-identifier hs-var">myPhaseInputExt</span></a></span><span> </span><span id="local-6989586621681201460"><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201460"><span class="hs-identifier hs-var">other</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Phase -&gt; String
</span><a href="GHC.Driver.Phases.html#phaseInputExt"><span class="hs-identifier hs-var">phaseInputExt</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201460"><span class="hs-identifier hs-var">other</span></a></span><span>
</span><span id="line-897"></span><span>
</span><span id="line-898"></span><span>          </span><span id="local-6989586621681201483"><span class="annot"><span class="annottext">is_last_phase :: Bool
</span><a href="#local-6989586621681201483"><span class="hs-identifier hs-var hs-var">is_last_phase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201485"><span class="hs-identifier hs-var">next_phase</span></a></span><span> </span><span class="annot"><span class="annottext">Phase -&gt; Phase -&gt; Bool
</span><a href="GHC.Driver.Phases.html#eqPhase"><span class="hs-operator hs-var">`eqPhase`</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201489"><span class="hs-identifier hs-var">stop_phase</span></a></span><span>
</span><span id="line-899"></span><span>
</span><span id="line-900"></span><span>          </span><span class="hs-comment">-- sometimes, we keep output from intermediate stages</span><span>
</span><span id="line-901"></span><span>          </span><span id="local-6989586621681201480"><span class="annot"><span class="annottext">keep_this_output :: Bool
</span><a href="#local-6989586621681201480"><span class="hs-identifier hs-var hs-var">keep_this_output</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-902"></span><span>               </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201485"><span class="hs-identifier hs-var">next_phase</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-903"></span><span>                       </span><span class="annot"><a href="GHC.Driver.Phases.html#As"><span class="hs-identifier hs-type">As</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681201467"><span class="hs-identifier hs-var">keep_s</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-904"></span><span>                       </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#LlvmOpt"><span class="hs-identifier hs-var">LlvmOpt</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681201465"><span class="hs-identifier hs-var">keep_bc</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-905"></span><span>                       </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#HCc"><span class="hs-identifier hs-var">HCc</span></a></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681201471"><span class="hs-identifier hs-var">keep_hc</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-906"></span><span>                       </span><span class="annot"><a href="GHC.Driver.Phases.html#HsPp"><span class="hs-identifier hs-type">HsPp</span></a></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681201469"><span class="hs-identifier hs-var">keep_hscpp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>   </span><span class="hs-comment">-- See #10869</span><span>
</span><span id="line-907"></span><span>                       </span><span id="local-6989586621681201458"><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201458"><span class="hs-identifier hs-var">_other</span></a></span></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-908"></span><span>
</span><span id="line-909"></span><span>          </span><span id="local-6989586621681201478"><span class="annot"><span class="annottext">suffix :: String
</span><a href="#local-6989586621681201478"><span class="hs-identifier hs-var hs-var">suffix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Phase -&gt; String
</span><a href="#local-6989586621681201463"><span class="hs-identifier hs-var">myPhaseInputExt</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201485"><span class="hs-identifier hs-var">next_phase</span></a></span><span>
</span><span id="line-910"></span><span>
</span><span id="line-911"></span><span>          </span><span class="hs-comment">-- persistent object files get put in odir</span><span>
</span><span id="line-912"></span><span>          </span><span id="local-6989586621681201482"><span class="annot"><span class="annottext">persistent_fn :: IO String
</span><a href="#local-6989586621681201482"><span class="hs-identifier hs-var hs-var">persistent_fn</span></a></span></span><span>
</span><span id="line-913"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#StopLn"><span class="hs-identifier hs-var">StopLn</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201485"><span class="hs-identifier hs-var">next_phase</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO String
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201455"><span class="hs-identifier hs-var">odir_persistent</span></a></span><span>
</span><span id="line-914"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO String
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201454"><span class="hs-identifier hs-var">persistent</span></a></span><span>
</span><span id="line-915"></span><span>
</span><span id="line-916"></span><span>          </span><span id="local-6989586621681201454"><span class="annot"><span class="annottext">persistent :: String
</span><a href="#local-6989586621681201454"><span class="hs-identifier hs-var hs-var">persistent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201487"><span class="hs-identifier hs-var">basename</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><a href="../../filepath/src/System.FilePath.Windows.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201478"><span class="hs-identifier hs-var">suffix</span></a></span><span>
</span><span id="line-917"></span><span>
</span><span id="line-918"></span><span>          </span><span id="local-6989586621681201455"><span class="annot"><span class="annottext">odir_persistent :: String
</span><a href="#local-6989586621681201455"><span class="hs-identifier hs-var hs-var">odir_persistent</span></a></span></span><span>
</span><span id="line-919"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681201453"><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681201453"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe ModLocation
</span><a href="#local-6989586621681201484"><span class="hs-identifier hs-var">maybe_location</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModLocation -&gt; String
</span><a href="GHC.Unit.Module.Location.html#ml_obj_file"><span class="hs-identifier hs-var hs-var">ml_obj_file</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681201453"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-920"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681201452"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201452"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621681201475"><span class="hs-identifier hs-var">odir</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201452"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><a href="../../filepath/src/System.FilePath.Windows.html#%3C%2F%3E"><span class="hs-operator hs-var">&lt;/&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201454"><span class="hs-identifier hs-var">persistent</span></a></span><span>
</span><span id="line-921"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201454"><span class="hs-identifier hs-var">persistent</span></a></span><span>
</span><span id="line-922"></span><span>
</span><span id="line-923"></span><span>
</span><span id="line-924"></span><span class="hs-comment">-- | LLVM Options. These are flags to be passed to opt and llc, to ensure</span><span>
</span><span id="line-925"></span><span class="hs-comment">-- consistency we list them in pairs, so that they form groups.</span><span>
</span><span id="line-926"></span><span class="annot"><a href="GHC.Driver.Pipeline.html#llvmOptions"><span class="hs-identifier hs-type">llvmOptions</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span>
</span><span id="line-927"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- ^ pairs of (opt, llc) arguments</span><span>
</span><span id="line-928"></span><span id="llvmOptions"><span class="annot"><span class="annottext">llvmOptions :: DynFlags -&gt; [(String, String)]
</span><a href="GHC.Driver.Pipeline.html#llvmOptions"><span class="hs-identifier hs-var hs-var">llvmOptions</span></a></span></span><span> </span><span id="local-6989586621681201450"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201450"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-929"></span><span>       </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-enable-tbaa -tbaa&quot;</span></span><span class="hs-special">,</span><span>  </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-enable-tbaa&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_LlvmTBAA"><span class="hs-identifier hs-var">Opt_LlvmTBAA</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201450"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-930"></span><span>    </span><span class="annot"><span class="annottext">[(String, String)] -&gt; [(String, String)] -&gt; [(String, String)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-relocation-model=&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201448"><span class="hs-identifier hs-var">rmodel</span></a></span><span>
</span><span id="line-931"></span><span>        </span><span class="hs-special">,</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-relocation-model=&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201448"><span class="hs-identifier hs-var">rmodel</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201448"><span class="hs-identifier hs-var">rmodel</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-932"></span><span>    </span><span class="annot"><span class="annottext">[(String, String)] -&gt; [(String, String)] -&gt; [(String, String)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-stack-alignment=&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../base/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681201447"><span class="hs-identifier hs-var">align</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-933"></span><span>        </span><span class="hs-special">,</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-stack-alignment=&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../base/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681201447"><span class="hs-identifier hs-var">align</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681201447"><span class="hs-identifier hs-var">align</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-934"></span><span>
</span><span id="line-935"></span><span>    </span><span class="hs-comment">-- Additional llc flags</span><span>
</span><span id="line-936"></span><span>    </span><span class="annot"><span class="annottext">[(String, String)] -&gt; [(String, String)] -&gt; [(String, String)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-mcpu=&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201445"><span class="hs-identifier hs-var">mcpu</span></a></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201445"><span class="hs-identifier hs-var">mcpu</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-937"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String -&gt; Bool) -&gt; [String] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; String -&gt; Bool
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; Bool
</span><a href="../../base/src/Data.OldList.html#isInfixOf"><span class="hs-identifier hs-var">isInfixOf</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-mcpu&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; (DynFlags -&gt; [String]) -&gt; [String]
forall a. DynFlags -&gt; (DynFlags -&gt; [a]) -&gt; [a]
</span><a href="GHC.Driver.Session.html#getOpts"><span class="hs-identifier hs-var">getOpts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201450"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [String]
</span><a href="GHC.Driver.Session.html#opt_lc"><span class="hs-identifier hs-var">opt_lc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-938"></span><span>    </span><span class="annot"><span class="annottext">[(String, String)] -&gt; [(String, String)] -&gt; [(String, String)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-mattr=&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201442"><span class="hs-identifier hs-var">attrs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201442"><span class="hs-identifier hs-var">attrs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-939"></span><span>
</span><span id="line-940"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681201441"><span class="annot"><span class="annottext">target :: String
</span><a href="#local-6989586621681201441"><span class="hs-identifier hs-var hs-var">target</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PlatformMisc -&gt; String
</span><a href="../../ghc-boot/src/GHC.Platform.html#platformMisc_llvmTarget"><span class="hs-identifier hs-var hs-var">platformMisc_llvmTarget</span></a></span><span> </span><span class="annot"><span class="annottext">(PlatformMisc -&gt; String) -&gt; PlatformMisc -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; PlatformMisc
</span><a href="GHC.Driver.Session.html#platformMisc"><span class="hs-identifier hs-var hs-var">platformMisc</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201450"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-941"></span><span>        </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Session.html#LlvmTarget"><span class="hs-identifier hs-type">LlvmTarget</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681201445"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201445"><span class="hs-identifier hs-var">mcpu</span></a></span></span><span> </span><span id="local-6989586621681201436"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201436"><span class="hs-identifier hs-var">mattr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; [(String, LlvmTarget)] -&gt; Maybe LlvmTarget
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><a href="../../base/src/GHC.List.html#lookup"><span class="hs-identifier hs-var">lookup</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201441"><span class="hs-identifier hs-var">target</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LlvmConfig -&gt; [(String, LlvmTarget)]
</span><a href="GHC.Driver.Session.html#llvmTargets"><span class="hs-identifier hs-var hs-var">llvmTargets</span></a></span><span> </span><span class="annot"><span class="annottext">(LlvmConfig -&gt; [(String, LlvmTarget)])
-&gt; LlvmConfig -&gt; [(String, LlvmTarget)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; LlvmConfig
</span><a href="GHC.Driver.Session.html#llvmConfig"><span class="hs-identifier hs-var hs-var">llvmConfig</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201450"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-942"></span><span>
</span><span id="line-943"></span><span>        </span><span class="hs-comment">-- Relocation models</span><span>
</span><span id="line-944"></span><span>        </span><span id="local-6989586621681201448"><span class="annot"><span class="annottext">rmodel :: String
</span><a href="#local-6989586621681201448"><span class="hs-identifier hs-var hs-var">rmodel</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_PIC"><span class="hs-identifier hs-var">Opt_PIC</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201450"><span class="hs-identifier hs-var">dflags</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;pic&quot;</span></span><span>
</span><span id="line-945"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#positionIndependent"><span class="hs-identifier hs-var">positionIndependent</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201450"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;pic&quot;</span></span><span>
</span><span id="line-946"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Way
</span><a href="GHC.Driver.Ways.html#WayDyn"><span class="hs-identifier hs-var">WayDyn</span></a></span><span> </span><span class="annot"><span class="annottext">Way -&gt; Set Way -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#elem"><span class="hs-operator hs-var">`elem`</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Set Way
</span><a href="GHC.Driver.Session.html#ways"><span class="hs-identifier hs-var hs-var">ways</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201450"><span class="hs-identifier hs-var">dflags</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;dynamic-no-pic&quot;</span></span><span>
</span><span id="line-947"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;static&quot;</span></span><span>
</span><span id="line-948"></span><span>
</span><span id="line-949"></span><span>        </span><span class="annot"><a href="#local-6989586621681201447"><span class="hs-identifier hs-type">align</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-950"></span><span>        </span><span id="local-6989586621681201447"><span class="annot"><span class="annottext">align :: Int
</span><a href="#local-6989586621681201447"><span class="hs-identifier hs-var hs-var">align</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Arch
</span><a href="../../ghc-boot/src/GHC.Platform.html#platformArch"><span class="hs-identifier hs-var">platformArch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.Session.html#targetPlatform"><span class="hs-identifier hs-var hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201450"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-951"></span><span>                  </span><span class="annot"><span class="annottext">Arch
</span><a href="../../ghc-boot/src/GHC.Platform.html#ArchX86_64"><span class="hs-identifier hs-var">ArchX86_64</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#isAvxEnabled"><span class="hs-identifier hs-var">isAvxEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201450"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">32</span></span><span>
</span><span id="line-952"></span><span>                  </span><span class="annot"><span class="annottext">Arch
</span><span class="hs-identifier">_</span></span><span>                                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span>
</span><span id="line-953"></span><span>
</span><span id="line-954"></span><span>        </span><span class="annot"><a href="#local-6989586621681201442"><span class="hs-identifier hs-type">attrs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span>
</span><span id="line-955"></span><span>        </span><span id="local-6989586621681201442"><span class="annot"><span class="annottext">attrs :: String
</span><a href="#local-6989586621681201442"><span class="hs-identifier hs-var hs-var">attrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; String
forall a. [a] -&gt; [[a]] -&gt; [a]
</span><a href="../../base/src/Data.OldList.html#intercalate"><span class="hs-identifier hs-var">intercalate</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;,&quot;</span></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; String) -&gt; [String] -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201436"><span class="hs-identifier hs-var">mattr</span></a></span><span>
</span><span id="line-956"></span><span>              </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;+sse42&quot;</span></span><span>   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#isSse4_2Enabled"><span class="hs-identifier hs-var">isSse4_2Enabled</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201450"><span class="hs-identifier hs-var">dflags</span></a></span><span>   </span><span class="hs-special">]</span><span>
</span><span id="line-957"></span><span>              </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;+sse2&quot;</span></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#isSse2Enabled"><span class="hs-identifier hs-var">isSse2Enabled</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201450"><span class="hs-identifier hs-var">dflags</span></a></span><span>     </span><span class="hs-special">]</span><span>
</span><span id="line-958"></span><span>              </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;+sse&quot;</span></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#isSseEnabled"><span class="hs-identifier hs-var">isSseEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201450"><span class="hs-identifier hs-var">dflags</span></a></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-959"></span><span>              </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;+avx512f&quot;</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#isAvx512fEnabled"><span class="hs-identifier hs-var">isAvx512fEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201450"><span class="hs-identifier hs-var">dflags</span></a></span><span>  </span><span class="hs-special">]</span><span>
</span><span id="line-960"></span><span>              </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;+avx2&quot;</span></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#isAvx2Enabled"><span class="hs-identifier hs-var">isAvx2Enabled</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201450"><span class="hs-identifier hs-var">dflags</span></a></span><span>     </span><span class="hs-special">]</span><span>
</span><span id="line-961"></span><span>              </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;+avx&quot;</span></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#isAvxEnabled"><span class="hs-identifier hs-var">isAvxEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201450"><span class="hs-identifier hs-var">dflags</span></a></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-962"></span><span>              </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;+avx512cd&quot;</span></span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#isAvx512cdEnabled"><span class="hs-identifier hs-var">isAvx512cdEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201450"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-963"></span><span>              </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;+avx512er&quot;</span></span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#isAvx512erEnabled"><span class="hs-identifier hs-var">isAvx512erEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201450"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-964"></span><span>              </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;+avx512pf&quot;</span></span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#isAvx512pfEnabled"><span class="hs-identifier hs-var">isAvx512pfEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201450"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-965"></span><span>              </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;+bmi&quot;</span></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#isBmiEnabled"><span class="hs-identifier hs-var">isBmiEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201450"><span class="hs-identifier hs-var">dflags</span></a></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-966"></span><span>              </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;+bmi2&quot;</span></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#isBmi2Enabled"><span class="hs-identifier hs-var">isBmi2Enabled</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201450"><span class="hs-identifier hs-var">dflags</span></a></span><span>     </span><span class="hs-special">]</span><span>
</span><span id="line-967"></span><span>
</span><span id="line-968"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-969"></span><span class="hs-comment">-- | Each phase in the pipeline returns the next phase to execute, and the</span><span>
</span><span id="line-970"></span><span class="hs-comment">-- name of the file in which the output was placed.</span><span>
</span><span id="line-971"></span><span class="hs-comment">--</span><span>
</span><span id="line-972"></span><span class="hs-comment">-- We must do things dynamically this way, because we often don't know</span><span>
</span><span id="line-973"></span><span class="hs-comment">-- what the rest of the phases will be until part-way through the</span><span>
</span><span id="line-974"></span><span class="hs-comment">-- compilation: for example, an {-# OPTIONS -fasm #-} at the beginning</span><span>
</span><span id="line-975"></span><span class="hs-comment">-- of a source file can change the latter stages of the pipeline from</span><span>
</span><span id="line-976"></span><span class="hs-comment">-- taking the LLVM route to using the native code generator.</span><span>
</span><span id="line-977"></span><span class="hs-comment">--</span><span>
</span><span id="line-978"></span><span class="annot"><a href="GHC.Driver.Pipeline.html#runPhase"><span class="hs-identifier hs-type">runPhase</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#PhasePlus"><span class="hs-identifier hs-type">PhasePlus</span></a></span><span>   </span><span class="hs-comment">-- ^ Run this phase</span><span>
</span><span id="line-979"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>    </span><span class="hs-comment">-- ^ name of the input file</span><span>
</span><span id="line-980"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span>    </span><span class="hs-comment">-- ^ for convenience, we pass the current dflags in</span><span>
</span><span id="line-981"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#CompPipeline"><span class="hs-identifier hs-type">CompPipeline</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#PhasePlus"><span class="hs-identifier hs-type">PhasePlus</span></a></span><span class="hs-special">,</span><span>           </span><span class="hs-comment">-- next phase to run</span><span>
</span><span id="line-982"></span><span>                          </span><span class="annot"><a href="../../base/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span class="hs-special">)</span><span>            </span><span class="hs-comment">-- output filename</span><span>
</span><span id="line-983"></span><span>
</span><span id="line-984"></span><span>        </span><span class="hs-comment">-- Invariant: the output filename always contains the output</span><span>
</span><span id="line-985"></span><span>        </span><span class="hs-comment">-- Interesting case: Hsc when there is no recompilation to do</span><span>
</span><span id="line-986"></span><span>        </span><span class="hs-comment">--                   Then the output filename is still a .o file</span><span>
</span><span id="line-987"></span><span>
</span><span id="line-988"></span><span>
</span><span id="line-989"></span><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><span id="line-990"></span><span class="hs-comment">-- Unlit phase</span><span>
</span><span id="line-991"></span><span>
</span><span id="line-992"></span><span id="runPhase"><span class="annot"><span class="annottext">runPhase :: PhasePlus -&gt; String -&gt; DynFlags -&gt; CompPipeline (PhasePlus, String)
</span><a href="GHC.Driver.Pipeline.html#runPhase"><span class="hs-identifier hs-var hs-var">runPhase</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#RealPhase"><span class="hs-identifier hs-type">RealPhase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Phases.html#Unlit"><span class="hs-identifier hs-type">Unlit</span></a></span><span> </span><span id="local-6989586621681201414"><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621681201414"><span class="hs-identifier hs-var">sf</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621681201413"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201413"><span class="hs-identifier hs-var">input_fn</span></a></span></span><span> </span><span id="local-6989586621681201412"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201412"><span class="hs-identifier hs-var">dflags</span></a></span></span><span>
</span><span id="line-993"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-994"></span><span>       </span><span id="local-6989586621681201411"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201411"><span class="hs-identifier hs-var">output_fn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Phase -&gt; CompPipeline String
</span><a href="GHC.Driver.Pipeline.html#phaseOutputFilename"><span class="hs-identifier hs-var">phaseOutputFilename</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscSource -&gt; Phase
</span><a href="GHC.Driver.Phases.html#Cpp"><span class="hs-identifier hs-var">Cpp</span></a></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621681201414"><span class="hs-identifier hs-var">sf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-995"></span><span>
</span><span id="line-996"></span><span>       </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201410"><span class="annot"><span class="annottext">flags :: [Option]
</span><a href="#local-6989586621681201410"><span class="hs-identifier hs-var hs-var">flags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-comment">-- The -h option passes the file name for unlit to</span><span>
</span><span id="line-997"></span><span>                     </span><span class="hs-comment">-- put in a #line directive</span><span>
</span><span id="line-998"></span><span>                     </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span>     </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-h&quot;</span></span><span>
</span><span id="line-999"></span><span>                     </span><span class="hs-comment">-- See Note [Don't normalise input filenames].</span><span>
</span><span id="line-1000"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Option) -&gt; String -&gt; Option
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String
</span><a href="#local-6989586621681201408"><span class="hs-identifier hs-var">escape</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201413"><span class="hs-identifier hs-var">input_fn</span></a></span><span>
</span><span id="line-1001"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#FileOption"><span class="hs-identifier hs-var">GHC.SysTools.FileOption</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201413"><span class="hs-identifier hs-var">input_fn</span></a></span><span>
</span><span id="line-1002"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#FileOption"><span class="hs-identifier hs-var">GHC.SysTools.FileOption</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201411"><span class="hs-identifier hs-var">output_fn</span></a></span><span>
</span><span id="line-1003"></span><span>                   </span><span class="hs-special">]</span><span>
</span><span id="line-1004"></span><span>
</span><span id="line-1005"></span><span>       </span><span class="annot"><span class="annottext">IO () -&gt; CompPipeline ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; CompPipeline ()) -&gt; IO () -&gt; CompPipeline ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [Option] -&gt; IO ()
</span><a href="GHC.SysTools.Tasks.html#runUnlit"><span class="hs-identifier hs-var">GHC.SysTools.runUnlit</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201412"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">[Option]
</span><a href="#local-6989586621681201410"><span class="hs-identifier hs-var">flags</span></a></span><span>
</span><span id="line-1006"></span><span>
</span><span id="line-1007"></span><span>       </span><span class="annot"><span class="annottext">(PhasePlus, String) -&gt; CompPipeline (PhasePlus, String)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Phase -&gt; PhasePlus
</span><a href="GHC.Driver.Pipeline.Monad.html#RealPhase"><span class="hs-identifier hs-var">RealPhase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscSource -&gt; Phase
</span><a href="GHC.Driver.Phases.html#Cpp"><span class="hs-identifier hs-var">Cpp</span></a></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621681201414"><span class="hs-identifier hs-var">sf</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201411"><span class="hs-identifier hs-var">output_fn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1008"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1009"></span><span>       </span><span class="hs-comment">-- escape the characters \, &quot;, and ', but don't try to escape</span><span>
</span><span id="line-1010"></span><span>       </span><span class="hs-comment">-- Unicode or anything else (so we don't use Util.charToC</span><span>
</span><span id="line-1011"></span><span>       </span><span class="hs-comment">-- here).  If we get this wrong, then in</span><span>
</span><span id="line-1012"></span><span>       </span><span class="hs-comment">-- GHC.HsToCore.Coverage.isGoodTickSrcSpan where we check that the filename in</span><span>
</span><span id="line-1013"></span><span>       </span><span class="hs-comment">-- a SrcLoc is the same as the source filenaame, the two will</span><span>
</span><span id="line-1014"></span><span>       </span><span class="hs-comment">-- look bogusly different. See test:</span><span>
</span><span id="line-1015"></span><span>       </span><span class="hs-comment">-- libraries/hpc/tests/function/subdir/tough2.hs</span><span>
</span><span id="line-1016"></span><span>       </span><span id="local-6989586621681201408"><span class="annot"><span class="annottext">escape :: String -&gt; String
</span><a href="#local-6989586621681201408"><span class="hs-identifier hs-var hs-var">escape</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'\\'</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681201406"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201406"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'\\'</span></span><span class="annot"><span class="annottext">Char -&gt; String -&gt; String
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'\\'</span></span><span class="annot"><span class="annottext">Char -&gt; String -&gt; String
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String
</span><a href="#local-6989586621681201408"><span class="hs-identifier hs-var">escape</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201406"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-1017"></span><span>       </span><span class="annot"><a href="#local-6989586621681201408"><span class="hs-identifier hs-var">escape</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'\&quot;'</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681201405"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201405"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'\\'</span></span><span class="annot"><span class="annottext">Char -&gt; String -&gt; String
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'\&quot;'</span></span><span class="annot"><span class="annottext">Char -&gt; String -&gt; String
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String
</span><a href="#local-6989586621681201408"><span class="hs-identifier hs-var">escape</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201405"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-1018"></span><span>       </span><span class="annot"><a href="#local-6989586621681201408"><span class="hs-identifier hs-var">escape</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'\''</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681201404"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201404"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'\\'</span></span><span class="annot"><span class="annottext">Char -&gt; String -&gt; String
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'\''</span></span><span class="annot"><span class="annottext">Char -&gt; String -&gt; String
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String
</span><a href="#local-6989586621681201408"><span class="hs-identifier hs-var">escape</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201404"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-1019"></span><span>       </span><span class="annot"><a href="#local-6989586621681201408"><span class="hs-identifier hs-var">escape</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681201403"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621681201403"><span class="hs-identifier hs-var">c</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681201402"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201402"><span class="hs-identifier hs-var">cs</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621681201403"><span class="hs-identifier hs-var">c</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; String -&gt; String
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String
</span><a href="#local-6989586621681201408"><span class="hs-identifier hs-var">escape</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201402"><span class="hs-identifier hs-var">cs</span></a></span><span>
</span><span id="line-1020"></span><span>       </span><span class="annot"><a href="#local-6989586621681201408"><span class="hs-identifier hs-var">escape</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1021"></span><span>
</span><span id="line-1022"></span><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><span id="line-1023"></span><span class="hs-comment">-- Cpp phase : (a) gets OPTIONS out of file</span><span>
</span><span id="line-1024"></span><span class="hs-comment">--             (b) runs cpp if necessary</span><span>
</span><span id="line-1025"></span><span>
</span><span id="line-1026"></span><span class="annot"><a href="GHC.Driver.Pipeline.html#runPhase"><span class="hs-identifier hs-var">runPhase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#RealPhase"><span class="hs-identifier hs-type">RealPhase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Phases.html#Cpp"><span class="hs-identifier hs-type">Cpp</span></a></span><span> </span><span id="local-6989586621681201401"><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621681201401"><span class="hs-identifier hs-var">sf</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621681201400"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201400"><span class="hs-identifier hs-var">input_fn</span></a></span></span><span> </span><span id="local-6989586621681201399"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201399"><span class="hs-identifier hs-var">dflags0</span></a></span></span><span>
</span><span id="line-1027"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1028"></span><span>       </span><span id="local-6989586621681201398"><span class="annot"><span class="annottext">[Located String]
</span><a href="#local-6989586621681201398"><span class="hs-identifier hs-var">src_opts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO [Located String] -&gt; CompPipeline [Located String]
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO [Located String] -&gt; CompPipeline [Located String])
-&gt; IO [Located String] -&gt; CompPipeline [Located String]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; String -&gt; IO [Located String]
</span><a href="GHC.Parser.Header.html#getOptionsFromFile"><span class="hs-identifier hs-var">getOptionsFromFile</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201399"><span class="hs-identifier hs-var">dflags0</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201400"><span class="hs-identifier hs-var">input_fn</span></a></span><span>
</span><span id="line-1029"></span><span>       </span><span class="hs-special">(</span><span id="local-6989586621681201396"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201396"><span class="hs-identifier hs-var">dflags1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681201395"><span class="annot"><span class="annottext">[Located String]
</span><a href="#local-6989586621681201395"><span class="hs-identifier hs-var">unhandled_flags</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681201394"><span class="annot"><span class="annottext">[Warn]
</span><a href="#local-6989586621681201394"><span class="hs-identifier hs-var">warns</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1030"></span><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (DynFlags, [Located String], [Warn])
-&gt; CompPipeline (DynFlags, [Located String], [Warn])
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (DynFlags, [Located String], [Warn])
 -&gt; CompPipeline (DynFlags, [Located String], [Warn]))
-&gt; IO (DynFlags, [Located String], [Warn])
-&gt; CompPipeline (DynFlags, [Located String], [Warn])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
-&gt; [Located String] -&gt; IO (DynFlags, [Located String], [Warn])
forall (m :: * -&gt; *).
MonadIO m =&gt;
DynFlags
-&gt; [Located String] -&gt; m (DynFlags, [Located String], [Warn])
</span><a href="GHC.Driver.Session.html#parseDynamicFilePragma"><span class="hs-identifier hs-var">parseDynamicFilePragma</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201399"><span class="hs-identifier hs-var">dflags0</span></a></span><span> </span><span class="annot"><span class="annottext">[Located String]
</span><a href="#local-6989586621681201398"><span class="hs-identifier hs-var">src_opts</span></a></span><span>
</span><span id="line-1031"></span><span>       </span><span class="annot"><span class="annottext">DynFlags -&gt; CompPipeline ()
</span><a href="GHC.Driver.Pipeline.Monad.html#setDynFlags"><span class="hs-identifier hs-var">setDynFlags</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201396"><span class="hs-identifier hs-var">dflags1</span></a></span><span>
</span><span id="line-1032"></span><span>       </span><span class="annot"><span class="annottext">IO () -&gt; CompPipeline ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; CompPipeline ()) -&gt; IO () -&gt; CompPipeline ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [Located String] -&gt; IO ()
forall (m :: * -&gt; *).
MonadIO m =&gt;
DynFlags -&gt; [Located String] -&gt; m ()
</span><a href="GHC.Parser.Header.html#checkProcessArgsResult"><span class="hs-identifier hs-var">checkProcessArgsResult</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201396"><span class="hs-identifier hs-var">dflags1</span></a></span><span> </span><span class="annot"><span class="annottext">[Located String]
</span><a href="#local-6989586621681201395"><span class="hs-identifier hs-var">unhandled_flags</span></a></span><span>
</span><span id="line-1033"></span><span>
</span><span id="line-1034"></span><span>       </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Extension -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#xopt"><span class="hs-identifier hs-var">xopt</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><a href="../../ghc-boot-th/src/GHC.LanguageExtensions.Type.html#Cpp"><span class="hs-identifier hs-var">LangExt.Cpp</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201396"><span class="hs-identifier hs-var">dflags1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1035"></span><span>           </span><span class="hs-comment">-- we have to be careful to emit warnings only once.</span><span>
</span><span id="line-1036"></span><span>           </span><span class="annot"><span class="annottext">Bool -&gt; CompPipeline () -&gt; CompPipeline ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base/src/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_Pp"><span class="hs-identifier hs-var">Opt_Pp</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201396"><span class="hs-identifier hs-var">dflags1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(CompPipeline () -&gt; CompPipeline ())
-&gt; CompPipeline () -&gt; CompPipeline ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1037"></span><span>               </span><span class="annot"><span class="annottext">IO () -&gt; CompPipeline ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; CompPipeline ()) -&gt; IO () -&gt; CompPipeline ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [Warn] -&gt; IO ()
</span><a href="GHC.Driver.Types.html#handleFlagWarnings"><span class="hs-identifier hs-var">handleFlagWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201396"><span class="hs-identifier hs-var">dflags1</span></a></span><span> </span><span class="annot"><span class="annottext">[Warn]
</span><a href="#local-6989586621681201394"><span class="hs-identifier hs-var">warns</span></a></span><span>
</span><span id="line-1038"></span><span>
</span><span id="line-1039"></span><span>           </span><span class="hs-comment">-- no need to preprocess CPP, just pass input file along</span><span>
</span><span id="line-1040"></span><span>           </span><span class="hs-comment">-- to the next phase of the pipeline.</span><span>
</span><span id="line-1041"></span><span>           </span><span class="annot"><span class="annottext">(PhasePlus, String) -&gt; CompPipeline (PhasePlus, String)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Phase -&gt; PhasePlus
</span><a href="GHC.Driver.Pipeline.Monad.html#RealPhase"><span class="hs-identifier hs-var">RealPhase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscSource -&gt; Phase
</span><a href="GHC.Driver.Phases.html#HsPp"><span class="hs-identifier hs-var">HsPp</span></a></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621681201401"><span class="hs-identifier hs-var">sf</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201400"><span class="hs-identifier hs-var">input_fn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1042"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1043"></span><span>            </span><span id="local-6989586621681201387"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201387"><span class="hs-identifier hs-var">output_fn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Phase -&gt; CompPipeline String
</span><a href="GHC.Driver.Pipeline.html#phaseOutputFilename"><span class="hs-identifier hs-var">phaseOutputFilename</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscSource -&gt; Phase
</span><a href="GHC.Driver.Phases.html#HsPp"><span class="hs-identifier hs-var">HsPp</span></a></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621681201401"><span class="hs-identifier hs-var">sf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1044"></span><span>            </span><span class="annot"><span class="annottext">IO () -&gt; CompPipeline ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; CompPipeline ()) -&gt; IO () -&gt; CompPipeline ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool -&gt; String -&gt; String -&gt; IO ()
</span><a href="GHC.Driver.Pipeline.html#doCpp"><span class="hs-identifier hs-var">doCpp</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201396"><span class="hs-identifier hs-var">dflags1</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-comment">{-raw-}</span><span>
</span><span id="line-1045"></span><span>                           </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201400"><span class="hs-identifier hs-var">input_fn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201387"><span class="hs-identifier hs-var">output_fn</span></a></span><span>
</span><span id="line-1046"></span><span>            </span><span class="hs-comment">-- re-read the pragmas now that we've preprocessed the file</span><span>
</span><span id="line-1047"></span><span>            </span><span class="hs-comment">-- See #2464,#3457</span><span>
</span><span id="line-1048"></span><span>            </span><span id="local-6989586621681201386"><span class="annot"><span class="annottext">[Located String]
</span><a href="#local-6989586621681201386"><span class="hs-identifier hs-var">src_opts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO [Located String] -&gt; CompPipeline [Located String]
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO [Located String] -&gt; CompPipeline [Located String])
-&gt; IO [Located String] -&gt; CompPipeline [Located String]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; String -&gt; IO [Located String]
</span><a href="GHC.Parser.Header.html#getOptionsFromFile"><span class="hs-identifier hs-var">getOptionsFromFile</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201399"><span class="hs-identifier hs-var">dflags0</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201387"><span class="hs-identifier hs-var">output_fn</span></a></span><span>
</span><span id="line-1049"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621681201385"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201385"><span class="hs-identifier hs-var">dflags2</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681201384"><span class="annot"><span class="annottext">[Located String]
</span><a href="#local-6989586621681201384"><span class="hs-identifier hs-var">unhandled_flags</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681201383"><span class="annot"><span class="annottext">[Warn]
</span><a href="#local-6989586621681201383"><span class="hs-identifier hs-var">warns</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1050"></span><span>                </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (DynFlags, [Located String], [Warn])
-&gt; CompPipeline (DynFlags, [Located String], [Warn])
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (DynFlags, [Located String], [Warn])
 -&gt; CompPipeline (DynFlags, [Located String], [Warn]))
-&gt; IO (DynFlags, [Located String], [Warn])
-&gt; CompPipeline (DynFlags, [Located String], [Warn])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
-&gt; [Located String] -&gt; IO (DynFlags, [Located String], [Warn])
forall (m :: * -&gt; *).
MonadIO m =&gt;
DynFlags
-&gt; [Located String] -&gt; m (DynFlags, [Located String], [Warn])
</span><a href="GHC.Driver.Session.html#parseDynamicFilePragma"><span class="hs-identifier hs-var">parseDynamicFilePragma</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201399"><span class="hs-identifier hs-var">dflags0</span></a></span><span> </span><span class="annot"><span class="annottext">[Located String]
</span><a href="#local-6989586621681201386"><span class="hs-identifier hs-var">src_opts</span></a></span><span>
</span><span id="line-1051"></span><span>            </span><span class="annot"><span class="annottext">IO () -&gt; CompPipeline ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; CompPipeline ()) -&gt; IO () -&gt; CompPipeline ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [Located String] -&gt; IO ()
forall (m :: * -&gt; *).
MonadIO m =&gt;
DynFlags -&gt; [Located String] -&gt; m ()
</span><a href="GHC.Parser.Header.html#checkProcessArgsResult"><span class="hs-identifier hs-var">checkProcessArgsResult</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201385"><span class="hs-identifier hs-var">dflags2</span></a></span><span> </span><span class="annot"><span class="annottext">[Located String]
</span><a href="#local-6989586621681201384"><span class="hs-identifier hs-var">unhandled_flags</span></a></span><span>
</span><span id="line-1052"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; CompPipeline () -&gt; CompPipeline ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base/src/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_Pp"><span class="hs-identifier hs-var">Opt_Pp</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201385"><span class="hs-identifier hs-var">dflags2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(CompPipeline () -&gt; CompPipeline ())
-&gt; CompPipeline () -&gt; CompPipeline ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1053"></span><span>                </span><span class="annot"><span class="annottext">IO () -&gt; CompPipeline ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; CompPipeline ()) -&gt; IO () -&gt; CompPipeline ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [Warn] -&gt; IO ()
</span><a href="GHC.Driver.Types.html#handleFlagWarnings"><span class="hs-identifier hs-var">handleFlagWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201385"><span class="hs-identifier hs-var">dflags2</span></a></span><span> </span><span class="annot"><span class="annottext">[Warn]
</span><a href="#local-6989586621681201383"><span class="hs-identifier hs-var">warns</span></a></span><span>
</span><span id="line-1054"></span><span>            </span><span class="hs-comment">-- the HsPp pass below will emit warnings</span><span>
</span><span id="line-1055"></span><span>
</span><span id="line-1056"></span><span>            </span><span class="annot"><span class="annottext">DynFlags -&gt; CompPipeline ()
</span><a href="GHC.Driver.Pipeline.Monad.html#setDynFlags"><span class="hs-identifier hs-var">setDynFlags</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201385"><span class="hs-identifier hs-var">dflags2</span></a></span><span>
</span><span id="line-1057"></span><span>
</span><span id="line-1058"></span><span>            </span><span class="annot"><span class="annottext">(PhasePlus, String) -&gt; CompPipeline (PhasePlus, String)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Phase -&gt; PhasePlus
</span><a href="GHC.Driver.Pipeline.Monad.html#RealPhase"><span class="hs-identifier hs-var">RealPhase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscSource -&gt; Phase
</span><a href="GHC.Driver.Phases.html#HsPp"><span class="hs-identifier hs-var">HsPp</span></a></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621681201401"><span class="hs-identifier hs-var">sf</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201387"><span class="hs-identifier hs-var">output_fn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1059"></span><span>
</span><span id="line-1060"></span><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><span id="line-1061"></span><span class="hs-comment">-- HsPp phase</span><span>
</span><span id="line-1062"></span><span>
</span><span id="line-1063"></span><span class="annot"><a href="GHC.Driver.Pipeline.html#runPhase"><span class="hs-identifier hs-var">runPhase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#RealPhase"><span class="hs-identifier hs-type">RealPhase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Phases.html#HsPp"><span class="hs-identifier hs-type">HsPp</span></a></span><span> </span><span id="local-6989586621681201382"><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621681201382"><span class="hs-identifier hs-var">sf</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621681201381"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201381"><span class="hs-identifier hs-var">input_fn</span></a></span></span><span> </span><span id="local-6989586621681201380"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201380"><span class="hs-identifier hs-var">dflags</span></a></span></span><span>
</span><span id="line-1064"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1065"></span><span>       </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_Pp"><span class="hs-identifier hs-var">Opt_Pp</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201380"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-1066"></span><span>           </span><span class="hs-comment">-- no need to preprocess, just pass input file along</span><span>
</span><span id="line-1067"></span><span>           </span><span class="hs-comment">-- to the next phase of the pipeline.</span><span>
</span><span id="line-1068"></span><span>          </span><span class="annot"><span class="annottext">(PhasePlus, String) -&gt; CompPipeline (PhasePlus, String)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Phase -&gt; PhasePlus
</span><a href="GHC.Driver.Pipeline.Monad.html#RealPhase"><span class="hs-identifier hs-var">RealPhase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscSource -&gt; Phase
</span><a href="GHC.Driver.Phases.html#Hsc"><span class="hs-identifier hs-var">Hsc</span></a></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621681201382"><span class="hs-identifier hs-var">sf</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201381"><span class="hs-identifier hs-var">input_fn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1069"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1070"></span><span>            </span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#PipeEnv"><span class="hs-identifier hs-type">PipeEnv</span></a></span><span class="hs-special">{</span><span id="local-6989586621681201379"><span class="annot"><span class="annottext">String
src_basename :: String
src_basename :: PipeEnv -&gt; String
</span><a href="#local-6989586621681201379"><span class="hs-identifier hs-var hs-var">src_basename</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681201378"><span class="annot"><span class="annottext">String
src_suffix :: String
src_suffix :: PipeEnv -&gt; String
</span><a href="#local-6989586621681201378"><span class="hs-identifier hs-var hs-var">src_suffix</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CompPipeline PipeEnv
</span><a href="GHC.Driver.Pipeline.Monad.html#getPipeEnv"><span class="hs-identifier hs-var">getPipeEnv</span></a></span><span>
</span><span id="line-1071"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201377"><span class="annot"><span class="annottext">orig_fn :: String
</span><a href="#local-6989586621681201377"><span class="hs-identifier hs-var hs-var">orig_fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201379"><span class="hs-identifier hs-var">src_basename</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><a href="../../filepath/src/System.FilePath.Windows.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201378"><span class="hs-identifier hs-var">src_suffix</span></a></span><span>
</span><span id="line-1072"></span><span>            </span><span id="local-6989586621681201376"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201376"><span class="hs-identifier hs-var">output_fn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Phase -&gt; CompPipeline String
</span><a href="GHC.Driver.Pipeline.html#phaseOutputFilename"><span class="hs-identifier hs-var">phaseOutputFilename</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscSource -&gt; Phase
</span><a href="GHC.Driver.Phases.html#Hsc"><span class="hs-identifier hs-var">Hsc</span></a></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621681201382"><span class="hs-identifier hs-var">sf</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1073"></span><span>            </span><span class="annot"><span class="annottext">IO () -&gt; CompPipeline ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; CompPipeline ()) -&gt; IO () -&gt; CompPipeline ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [Option] -&gt; IO ()
</span><a href="GHC.SysTools.Tasks.html#runPp"><span class="hs-identifier hs-var">GHC.SysTools.runPp</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201380"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1074"></span><span>                           </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span>     </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201377"><span class="hs-identifier hs-var">orig_fn</span></a></span><span>
</span><span id="line-1075"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span>     </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201381"><span class="hs-identifier hs-var">input_fn</span></a></span><span>
</span><span id="line-1076"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#FileOption"><span class="hs-identifier hs-var">GHC.SysTools.FileOption</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201376"><span class="hs-identifier hs-var">output_fn</span></a></span><span>
</span><span id="line-1077"></span><span>                             </span><span class="hs-special">]</span><span>
</span><span id="line-1078"></span><span>                           </span><span class="hs-special">)</span><span>
</span><span id="line-1079"></span><span>
</span><span id="line-1080"></span><span>            </span><span class="hs-comment">-- re-read pragmas now that we've parsed the file (see #3674)</span><span>
</span><span id="line-1081"></span><span>            </span><span id="local-6989586621681201374"><span class="annot"><span class="annottext">[Located String]
</span><a href="#local-6989586621681201374"><span class="hs-identifier hs-var">src_opts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO [Located String] -&gt; CompPipeline [Located String]
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO [Located String] -&gt; CompPipeline [Located String])
-&gt; IO [Located String] -&gt; CompPipeline [Located String]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; String -&gt; IO [Located String]
</span><a href="GHC.Parser.Header.html#getOptionsFromFile"><span class="hs-identifier hs-var">getOptionsFromFile</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201380"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201376"><span class="hs-identifier hs-var">output_fn</span></a></span><span>
</span><span id="line-1082"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621681201373"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201373"><span class="hs-identifier hs-var">dflags1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681201372"><span class="annot"><span class="annottext">[Located String]
</span><a href="#local-6989586621681201372"><span class="hs-identifier hs-var">unhandled_flags</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681201371"><span class="annot"><span class="annottext">[Warn]
</span><a href="#local-6989586621681201371"><span class="hs-identifier hs-var">warns</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1083"></span><span>                </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (DynFlags, [Located String], [Warn])
-&gt; CompPipeline (DynFlags, [Located String], [Warn])
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (DynFlags, [Located String], [Warn])
 -&gt; CompPipeline (DynFlags, [Located String], [Warn]))
-&gt; IO (DynFlags, [Located String], [Warn])
-&gt; CompPipeline (DynFlags, [Located String], [Warn])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
-&gt; [Located String] -&gt; IO (DynFlags, [Located String], [Warn])
forall (m :: * -&gt; *).
MonadIO m =&gt;
DynFlags
-&gt; [Located String] -&gt; m (DynFlags, [Located String], [Warn])
</span><a href="GHC.Driver.Session.html#parseDynamicFilePragma"><span class="hs-identifier hs-var">parseDynamicFilePragma</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201380"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">[Located String]
</span><a href="#local-6989586621681201374"><span class="hs-identifier hs-var">src_opts</span></a></span><span>
</span><span id="line-1084"></span><span>            </span><span class="annot"><span class="annottext">DynFlags -&gt; CompPipeline ()
</span><a href="GHC.Driver.Pipeline.Monad.html#setDynFlags"><span class="hs-identifier hs-var">setDynFlags</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201373"><span class="hs-identifier hs-var">dflags1</span></a></span><span>
</span><span id="line-1085"></span><span>            </span><span class="annot"><span class="annottext">IO () -&gt; CompPipeline ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; CompPipeline ()) -&gt; IO () -&gt; CompPipeline ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [Located String] -&gt; IO ()
forall (m :: * -&gt; *).
MonadIO m =&gt;
DynFlags -&gt; [Located String] -&gt; m ()
</span><a href="GHC.Parser.Header.html#checkProcessArgsResult"><span class="hs-identifier hs-var">checkProcessArgsResult</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201373"><span class="hs-identifier hs-var">dflags1</span></a></span><span> </span><span class="annot"><span class="annottext">[Located String]
</span><a href="#local-6989586621681201372"><span class="hs-identifier hs-var">unhandled_flags</span></a></span><span>
</span><span id="line-1086"></span><span>            </span><span class="annot"><span class="annottext">IO () -&gt; CompPipeline ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; CompPipeline ()) -&gt; IO () -&gt; CompPipeline ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [Warn] -&gt; IO ()
</span><a href="GHC.Driver.Types.html#handleFlagWarnings"><span class="hs-identifier hs-var">handleFlagWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201373"><span class="hs-identifier hs-var">dflags1</span></a></span><span> </span><span class="annot"><span class="annottext">[Warn]
</span><a href="#local-6989586621681201371"><span class="hs-identifier hs-var">warns</span></a></span><span>
</span><span id="line-1087"></span><span>
</span><span id="line-1088"></span><span>            </span><span class="annot"><span class="annottext">(PhasePlus, String) -&gt; CompPipeline (PhasePlus, String)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Phase -&gt; PhasePlus
</span><a href="GHC.Driver.Pipeline.Monad.html#RealPhase"><span class="hs-identifier hs-var">RealPhase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscSource -&gt; Phase
</span><a href="GHC.Driver.Phases.html#Hsc"><span class="hs-identifier hs-var">Hsc</span></a></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621681201382"><span class="hs-identifier hs-var">sf</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201376"><span class="hs-identifier hs-var">output_fn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1089"></span><span>
</span><span id="line-1090"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-1091"></span><span class="hs-comment">-- Hsc phase</span><span>
</span><span id="line-1092"></span><span>
</span><span id="line-1093"></span><span class="hs-comment">-- Compilation of a single module, in &quot;legacy&quot; mode (_not_ under</span><span>
</span><span id="line-1094"></span><span class="hs-comment">-- the direction of the compilation manager).</span><span>
</span><span id="line-1095"></span><span class="annot"><a href="GHC.Driver.Pipeline.html#runPhase"><span class="hs-identifier hs-var">runPhase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#RealPhase"><span class="hs-identifier hs-type">RealPhase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Phases.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span id="local-6989586621681201370"><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621681201370"><span class="hs-identifier hs-var">src_flavour</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621681201369"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201369"><span class="hs-identifier hs-var">input_fn</span></a></span></span><span> </span><span id="local-6989586621681201368"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201368"><span class="hs-identifier hs-var">dflags0</span></a></span></span><span>
</span><span id="line-1096"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>   </span><span class="hs-comment">-- normal Hsc mode, not mkdependHS</span><span>
</span><span id="line-1097"></span><span>
</span><span id="line-1098"></span><span>        </span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#PipeEnv"><span class="hs-identifier hs-type">PipeEnv</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">stop_phase :: PipeEnv -&gt; Phase
</span><a href="GHC.Driver.Pipeline.Monad.html#stop_phase"><span class="hs-identifier hs-var">stop_phase</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621681201367"><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201367"><span class="hs-identifier hs-var">stop</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-1099"></span><span>                 </span><span class="annot"><span class="annottext">src_basename :: PipeEnv -&gt; String
</span><a href="GHC.Driver.Pipeline.Monad.html#src_basename"><span class="hs-identifier hs-var">src_basename</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621681201366"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201366"><span class="hs-identifier hs-var">basename</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-1100"></span><span>                 </span><span class="annot"><span class="annottext">src_suffix :: PipeEnv -&gt; String
</span><a href="GHC.Driver.Pipeline.Monad.html#src_suffix"><span class="hs-identifier hs-var">src_suffix</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621681201365"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201365"><span class="hs-identifier hs-var">suff</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CompPipeline PipeEnv
</span><a href="GHC.Driver.Pipeline.Monad.html#getPipeEnv"><span class="hs-identifier hs-var">getPipeEnv</span></a></span><span>
</span><span id="line-1101"></span><span>
</span><span id="line-1102"></span><span>  </span><span class="hs-comment">-- we add the current directory (i.e. the directory in which</span><span>
</span><span id="line-1103"></span><span>  </span><span class="hs-comment">-- the .hs files resides) to the include path, since this is</span><span>
</span><span id="line-1104"></span><span>  </span><span class="hs-comment">-- what gcc does, and it's probably what you want.</span><span>
</span><span id="line-1105"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201364"><span class="annot"><span class="annottext">current_dir :: String
</span><a href="#local-6989586621681201364"><span class="hs-identifier hs-var hs-var">current_dir</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String
</span><a href="../../filepath/src/System.FilePath.Windows.html#takeDirectory"><span class="hs-identifier hs-var">takeDirectory</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201366"><span class="hs-identifier hs-var">basename</span></a></span><span>
</span><span id="line-1106"></span><span>            </span><span id="local-6989586621681201363"><span class="annot"><span class="annottext">new_includes :: IncludeSpecs
</span><a href="#local-6989586621681201363"><span class="hs-identifier hs-var hs-var">new_includes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IncludeSpecs -&gt; [String] -&gt; IncludeSpecs
</span><a href="GHC.Driver.Session.html#addImplicitQuoteInclude"><span class="hs-identifier hs-var">addImplicitQuoteInclude</span></a></span><span> </span><span class="annot"><span class="annottext">IncludeSpecs
</span><a href="#local-6989586621681201362"><span class="hs-identifier hs-var">paths</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201364"><span class="hs-identifier hs-var">current_dir</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1107"></span><span>            </span><span id="local-6989586621681201362"><span class="annot"><span class="annottext">paths :: IncludeSpecs
</span><a href="#local-6989586621681201362"><span class="hs-identifier hs-var hs-var">paths</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; IncludeSpecs
</span><a href="GHC.Driver.Session.html#includePaths"><span class="hs-identifier hs-var hs-var">includePaths</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201368"><span class="hs-identifier hs-var">dflags0</span></a></span><span>
</span><span id="line-1108"></span><span>            </span><span id="local-6989586621681201361"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621681201361"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201368"><span class="hs-identifier hs-var">dflags0</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">includePaths :: IncludeSpecs
</span><a href="GHC.Driver.Session.html#includePaths"><span class="hs-identifier hs-var">includePaths</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IncludeSpecs
</span><a href="#local-6989586621681201363"><span class="hs-identifier hs-var">new_includes</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1109"></span><span>
</span><span id="line-1110"></span><span>        </span><span class="annot"><span class="annottext">DynFlags -&gt; CompPipeline ()
</span><a href="GHC.Driver.Pipeline.Monad.html#setDynFlags"><span class="hs-identifier hs-var">setDynFlags</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201361"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1111"></span><span>
</span><span id="line-1112"></span><span>  </span><span class="hs-comment">-- gather the imports and module name</span><span>
</span><span id="line-1113"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621681201360"><span class="annot"><span class="annottext">Maybe InputFileBuffer
</span><a href="#local-6989586621681201360"><span class="hs-identifier hs-var">hspp_buf</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681201359"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681201359"><span class="hs-identifier hs-var">mod_name</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681201358"><span class="annot"><span class="annottext">[(Maybe FastString, Located ModuleName)]
</span><a href="#local-6989586621681201358"><span class="hs-identifier hs-var">imps</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681201357"><span class="annot"><span class="annottext">[(Maybe FastString, Located ModuleName)]
</span><a href="#local-6989586621681201357"><span class="hs-identifier hs-var">src_imps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO
  (Maybe InputFileBuffer, ModuleName,
   [(Maybe FastString, Located ModuleName)],
   [(Maybe FastString, Located ModuleName)])
-&gt; CompPipeline
     (Maybe InputFileBuffer, ModuleName,
      [(Maybe FastString, Located ModuleName)],
      [(Maybe FastString, Located ModuleName)])
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO
   (Maybe InputFileBuffer, ModuleName,
    [(Maybe FastString, Located ModuleName)],
    [(Maybe FastString, Located ModuleName)])
 -&gt; CompPipeline
      (Maybe InputFileBuffer, ModuleName,
       [(Maybe FastString, Located ModuleName)],
       [(Maybe FastString, Located ModuleName)]))
-&gt; IO
     (Maybe InputFileBuffer, ModuleName,
      [(Maybe FastString, Located ModuleName)],
      [(Maybe FastString, Located ModuleName)])
-&gt; CompPipeline
     (Maybe InputFileBuffer, ModuleName,
      [(Maybe FastString, Located ModuleName)],
      [(Maybe FastString, Located ModuleName)])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1114"></span><span>          </span><span class="hs-keyword">do</span><span>
</span><span id="line-1115"></span><span>            </span><span id="local-6989586621681201356"><span class="annot"><span class="annottext">InputFileBuffer
</span><a href="#local-6989586621681201356"><span class="hs-identifier hs-var">buf</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO InputFileBuffer
</span><a href="GHC.Data.StringBuffer.html#hGetStringBuffer"><span class="hs-identifier hs-var">hGetStringBuffer</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201369"><span class="hs-identifier hs-var">input_fn</span></a></span><span>
</span><span id="line-1116"></span><span>            </span><span id="local-6989586621681201355"><span class="annot"><span class="annottext">Either
  ErrorMessages
  ([(Maybe FastString, Located ModuleName)],
   [(Maybe FastString, Located ModuleName)], Located ModuleName)
</span><a href="#local-6989586621681201355"><span class="hs-identifier hs-var">eimps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags
-&gt; InputFileBuffer
-&gt; String
-&gt; String
-&gt; IO
     (Either
        ErrorMessages
        ([(Maybe FastString, Located ModuleName)],
         [(Maybe FastString, Located ModuleName)], Located ModuleName))
</span><a href="GHC.Parser.Header.html#getImports"><span class="hs-identifier hs-var">getImports</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201361"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">InputFileBuffer
</span><a href="#local-6989586621681201356"><span class="hs-identifier hs-var">buf</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201369"><span class="hs-identifier hs-var">input_fn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201366"><span class="hs-identifier hs-var">basename</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><a href="../../filepath/src/System.FilePath.Windows.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201365"><span class="hs-identifier hs-var">suff</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1117"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either
  ErrorMessages
  ([(Maybe FastString, Located ModuleName)],
   [(Maybe FastString, Located ModuleName)], Located ModuleName)
</span><a href="#local-6989586621681201355"><span class="hs-identifier hs-var">eimps</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1118"></span><span>              </span><span class="annot"><a href="../../base/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621681201353"><span class="annot"><span class="annottext">ErrorMessages
</span><a href="#local-6989586621681201353"><span class="hs-identifier hs-var">errs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrorMessages
-&gt; IO
     (Maybe InputFileBuffer, ModuleName,
      [(Maybe FastString, Located ModuleName)],
      [(Maybe FastString, Located ModuleName)])
forall (io :: * -&gt; *) a. MonadIO io =&gt; ErrorMessages -&gt; io a
</span><a href="GHC.Driver.Types.html#throwErrors"><span class="hs-identifier hs-var">throwErrors</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorMessages
</span><a href="#local-6989586621681201353"><span class="hs-identifier hs-var">errs</span></a></span><span>
</span><span id="line-1119"></span><span>              </span><span class="annot"><a href="../../base/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681201351"><span class="annot"><span class="annottext">[(Maybe FastString, Located ModuleName)]
</span><a href="#local-6989586621681201351"><span class="hs-identifier hs-var">src_imps</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681201350"><span class="annot"><span class="annottext">[(Maybe FastString, Located ModuleName)]
</span><a href="#local-6989586621681201350"><span class="hs-identifier hs-var">imps</span></a></span></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681201348"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681201348"><span class="hs-identifier hs-var">mod_name</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Maybe InputFileBuffer, ModuleName,
 [(Maybe FastString, Located ModuleName)],
 [(Maybe FastString, Located ModuleName)])
-&gt; IO
     (Maybe InputFileBuffer, ModuleName,
      [(Maybe FastString, Located ModuleName)],
      [(Maybe FastString, Located ModuleName)])
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span>
</span><span id="line-1120"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InputFileBuffer -&gt; Maybe InputFileBuffer
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">InputFileBuffer
</span><a href="#local-6989586621681201356"><span class="hs-identifier hs-var">buf</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681201348"><span class="hs-identifier hs-var">mod_name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Maybe FastString, Located ModuleName)]
</span><a href="#local-6989586621681201350"><span class="hs-identifier hs-var">imps</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Maybe FastString, Located ModuleName)]
</span><a href="#local-6989586621681201351"><span class="hs-identifier hs-var">src_imps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1121"></span><span>
</span><span id="line-1122"></span><span>  </span><span class="hs-comment">-- Take -o into account if present</span><span>
</span><span id="line-1123"></span><span>  </span><span class="hs-comment">-- Very like -ohi, but we must *only* do this if we aren't linking</span><span>
</span><span id="line-1124"></span><span>  </span><span class="hs-comment">-- (If we're linking then the -o applies to the linked thing, not to</span><span>
</span><span id="line-1125"></span><span>  </span><span class="hs-comment">-- the object file for one module.)</span><span>
</span><span id="line-1126"></span><span>  </span><span class="hs-comment">-- Note the nasty duplication with the same computation in compileFile above</span><span>
</span><span id="line-1127"></span><span>        </span><span id="local-6989586621681201347"><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681201347"><span class="hs-identifier hs-var">location</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscSource -&gt; ModuleName -&gt; CompPipeline ModLocation
</span><a href="GHC.Driver.Pipeline.html#getLocation"><span class="hs-identifier hs-var">getLocation</span></a></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621681201370"><span class="hs-identifier hs-var">src_flavour</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681201359"><span class="hs-identifier hs-var">mod_name</span></a></span><span>
</span><span id="line-1128"></span><span>
</span><span id="line-1129"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201346"><span class="annot"><span class="annottext">o_file :: String
</span><a href="#local-6989586621681201346"><span class="hs-identifier hs-var hs-var">o_file</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModLocation -&gt; String
</span><a href="GHC.Unit.Module.Location.html#ml_obj_file"><span class="hs-identifier hs-var hs-var">ml_obj_file</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681201347"><span class="hs-identifier hs-var">location</span></a></span><span> </span><span class="hs-comment">-- The real object file</span><span>
</span><span id="line-1130"></span><span>            </span><span id="local-6989586621681201345"><span class="annot"><span class="annottext">hi_file :: String
</span><a href="#local-6989586621681201345"><span class="hs-identifier hs-var hs-var">hi_file</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModLocation -&gt; String
</span><a href="GHC.Unit.Module.Location.html#ml_hi_file"><span class="hs-identifier hs-var hs-var">ml_hi_file</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681201347"><span class="hs-identifier hs-var">location</span></a></span><span>
</span><span id="line-1131"></span><span>            </span><span id="local-6989586621681201344"><span class="annot"><span class="annottext">hie_file :: String
</span><a href="#local-6989586621681201344"><span class="hs-identifier hs-var hs-var">hie_file</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModLocation -&gt; String
</span><a href="GHC.Unit.Module.Location.html#ml_hie_file"><span class="hs-identifier hs-var hs-var">ml_hie_file</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681201347"><span class="hs-identifier hs-var">location</span></a></span><span>
</span><span id="line-1132"></span><span>            </span><span id="local-6989586621681201342"><span class="annot"><span class="annottext">dest_file :: String
</span><a href="#local-6989586621681201342"><span class="hs-identifier hs-var hs-var">dest_file</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Driver.Pipeline.html#writeInterfaceOnlyMode"><span class="hs-identifier hs-var">writeInterfaceOnlyMode</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201361"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1133"></span><span>                            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201345"><span class="hs-identifier hs-var">hi_file</span></a></span><span>
</span><span id="line-1134"></span><span>                      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1135"></span><span>                            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201346"><span class="hs-identifier hs-var">o_file</span></a></span><span>
</span><span id="line-1136"></span><span>
</span><span id="line-1137"></span><span>  </span><span class="hs-comment">-- Figure out if the source has changed, for recompilation avoidance.</span><span>
</span><span id="line-1138"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-1139"></span><span>  </span><span class="hs-comment">-- Setting source_unchanged to True means that M.o (or M.hie) seems</span><span>
</span><span id="line-1140"></span><span>  </span><span class="hs-comment">-- to be up to date wrt M.hs; so no need to recompile unless imports have</span><span>
</span><span id="line-1141"></span><span>  </span><span class="hs-comment">-- changed (which the compiler itself figures out).</span><span>
</span><span id="line-1142"></span><span>  </span><span class="hs-comment">-- Setting source_unchanged to False tells the compiler that M.o is out of</span><span>
</span><span id="line-1143"></span><span>  </span><span class="hs-comment">-- date wrt M.hs (or M.o doesn't exist) so we must recompile regardless.</span><span>
</span><span id="line-1144"></span><span>        </span><span id="local-6989586621681201341"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621681201341"><span class="hs-identifier hs-var">src_timestamp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO UTCTime -&gt; CompPipeline UTCTime
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO UTCTime -&gt; CompPipeline UTCTime)
-&gt; IO UTCTime -&gt; CompPipeline UTCTime
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO UTCTime
</span><a href="GHC.Utils.Misc.html#getModificationUTCTime"><span class="hs-identifier hs-var">getModificationUTCTime</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201366"><span class="hs-identifier hs-var">basename</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><a href="../../filepath/src/System.FilePath.Windows.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201365"><span class="hs-identifier hs-var">suff</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1145"></span><span>
</span><span id="line-1146"></span><span>        </span><span id="local-6989586621681201340"><span class="annot"><span class="annottext">SourceModified
</span><a href="#local-6989586621681201340"><span class="hs-identifier hs-var">source_unchanged</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO SourceModified -&gt; CompPipeline SourceModified
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO SourceModified -&gt; CompPipeline SourceModified)
-&gt; IO SourceModified -&gt; CompPipeline SourceModified
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1147"></span><span>          </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Phase -&gt; Bool
</span><a href="GHC.Driver.Phases.html#isStopLn"><span class="hs-identifier hs-var">isStopLn</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201367"><span class="hs-identifier hs-var">stop</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1148"></span><span>                </span><span class="hs-comment">-- SourceModified unconditionally if</span><span>
</span><span id="line-1149"></span><span>                </span><span class="hs-comment">--      (a) recompilation checker is off, or</span><span>
</span><span id="line-1150"></span><span>                </span><span class="hs-comment">--      (b) we aren't going all the way to .o file (e.g. ghc -S)</span><span>
</span><span id="line-1151"></span><span>             </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">SourceModified -&gt; IO SourceModified
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">SourceModified
</span><a href="GHC.Driver.Types.html#SourceModified"><span class="hs-identifier hs-var">SourceModified</span></a></span><span>
</span><span id="line-1152"></span><span>                </span><span class="hs-comment">-- Otherwise look at file modification dates</span><span>
</span><span id="line-1153"></span><span>             </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621681201339"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681201339"><span class="hs-identifier hs-var">dest_file_mod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; UTCTime -&gt; IO Bool
</span><a href="GHC.Driver.Pipeline.html#sourceModified"><span class="hs-identifier hs-var">sourceModified</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201342"><span class="hs-identifier hs-var">dest_file</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621681201341"><span class="hs-identifier hs-var">src_timestamp</span></a></span><span>
</span><span id="line-1154"></span><span>                     </span><span id="local-6989586621681201337"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681201337"><span class="hs-identifier hs-var">hie_file_mod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_WriteHie"><span class="hs-identifier hs-var">Opt_WriteHie</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201361"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1155"></span><span>                                        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String -&gt; UTCTime -&gt; IO Bool
</span><a href="GHC.Driver.Pipeline.html#sourceModified"><span class="hs-identifier hs-var">sourceModified</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201344"><span class="hs-identifier hs-var">hie_file</span></a></span><span>
</span><span id="line-1156"></span><span>                                                            </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621681201341"><span class="hs-identifier hs-var">src_timestamp</span></a></span><span>
</span><span id="line-1157"></span><span>                                        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; IO Bool
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1158"></span><span>                     </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681201339"><span class="hs-identifier hs-var">dest_file_mod</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681201337"><span class="hs-identifier hs-var">hie_file_mod</span></a></span><span>
</span><span id="line-1159"></span><span>                        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">SourceModified -&gt; IO SourceModified
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">SourceModified
</span><a href="GHC.Driver.Types.html#SourceModified"><span class="hs-identifier hs-var">SourceModified</span></a></span><span>
</span><span id="line-1160"></span><span>                        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">SourceModified -&gt; IO SourceModified
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">SourceModified
</span><a href="GHC.Driver.Types.html#SourceUnmodified"><span class="hs-identifier hs-var">SourceUnmodified</span></a></span><span>
</span><span id="line-1161"></span><span>
</span><span id="line-1162"></span><span>        </span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#PipeState"><span class="hs-identifier hs-type">PipeState</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">hsc_env :: PipeState -&gt; HscEnv
</span><a href="GHC.Driver.Pipeline.Monad.html#hsc_env"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621681201334"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681201334"><span class="hs-identifier hs-var">hsc_env'</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CompPipeline PipeState
</span><a href="GHC.Driver.Pipeline.Monad.html#getPipeState"><span class="hs-identifier hs-var">getPipeState</span></a></span><span>
</span><span id="line-1163"></span><span>
</span><span id="line-1164"></span><span>  </span><span class="hs-comment">-- Tell the finder cache about this module</span><span>
</span><span id="line-1165"></span><span>        </span><span id="local-6989586621681201333"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681201333"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Module -&gt; CompPipeline Module
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO Module -&gt; CompPipeline Module)
-&gt; IO Module -&gt; CompPipeline Module
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; ModuleName -&gt; ModLocation -&gt; IO Module
</span><a href="GHC.Driver.Finder.html#addHomeModuleToFinder"><span class="hs-identifier hs-var">addHomeModuleToFinder</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681201334"><span class="hs-identifier hs-var">hsc_env'</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681201359"><span class="hs-identifier hs-var">mod_name</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681201347"><span class="hs-identifier hs-var">location</span></a></span><span>
</span><span id="line-1166"></span><span>
</span><span id="line-1167"></span><span>  </span><span class="hs-comment">-- Make the ModSummary to hand to hscMain</span><span>
</span><span id="line-1168"></span><span>        </span><span class="hs-keyword">let</span><span>
</span><span id="line-1169"></span><span>            </span><span id="local-6989586621681201331"><span class="annot"><span class="annottext">mod_summary :: ModSummary
</span><a href="#local-6989586621681201331"><span class="hs-identifier hs-var hs-var">mod_summary</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary :: Module
-&gt; HscSource
-&gt; ModLocation
-&gt; UTCTime
-&gt; Maybe UTCTime
-&gt; Maybe UTCTime
-&gt; Maybe UTCTime
-&gt; [(Maybe FastString, Located ModuleName)]
-&gt; [(Maybe FastString, Located ModuleName)]
-&gt; Maybe HsParsedModule
-&gt; String
-&gt; DynFlags
-&gt; Maybe InputFileBuffer
-&gt; ModSummary
</span><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span> </span><span class="hs-special">{</span><span>  </span><span class="annot"><span class="annottext">ms_mod :: Module
</span><a href="GHC.Driver.Types.html#ms_mod"><span class="hs-identifier hs-var">ms_mod</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681201333"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1170"></span><span>                                        </span><span class="annot"><span class="annottext">ms_hsc_src :: HscSource
</span><a href="GHC.Driver.Types.html#ms_hsc_src"><span class="hs-identifier hs-var">ms_hsc_src</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621681201370"><span class="hs-identifier hs-var">src_flavour</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1171"></span><span>                                        </span><span class="annot"><span class="annottext">ms_hspp_file :: String
</span><a href="GHC.Driver.Types.html#ms_hspp_file"><span class="hs-identifier hs-var">ms_hspp_file</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201369"><span class="hs-identifier hs-var">input_fn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1172"></span><span>                                        </span><span class="annot"><span class="annottext">ms_hspp_opts :: DynFlags
</span><a href="GHC.Driver.Types.html#ms_hspp_opts"><span class="hs-identifier hs-var">ms_hspp_opts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201361"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1173"></span><span>                                        </span><span class="annot"><span class="annottext">ms_hspp_buf :: Maybe InputFileBuffer
</span><a href="GHC.Driver.Types.html#ms_hspp_buf"><span class="hs-identifier hs-var">ms_hspp_buf</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe InputFileBuffer
</span><a href="#local-6989586621681201360"><span class="hs-identifier hs-var">hspp_buf</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1174"></span><span>                                        </span><span class="annot"><span class="annottext">ms_location :: ModLocation
</span><a href="GHC.Driver.Types.html#ms_location"><span class="hs-identifier hs-var">ms_location</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681201347"><span class="hs-identifier hs-var">location</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1175"></span><span>                                        </span><span class="annot"><span class="annottext">ms_hs_date :: UTCTime
</span><a href="GHC.Driver.Types.html#ms_hs_date"><span class="hs-identifier hs-var">ms_hs_date</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621681201341"><span class="hs-identifier hs-var">src_timestamp</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1176"></span><span>                                        </span><span class="annot"><span class="annottext">ms_obj_date :: Maybe UTCTime
</span><a href="GHC.Driver.Types.html#ms_obj_date"><span class="hs-identifier hs-var">ms_obj_date</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe UTCTime
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1177"></span><span>                                        </span><span class="annot"><span class="annottext">ms_parsed_mod :: Maybe HsParsedModule
</span><a href="GHC.Driver.Types.html#ms_parsed_mod"><span class="hs-identifier hs-var">ms_parsed_mod</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe HsParsedModule
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1178"></span><span>                                        </span><span class="annot"><span class="annottext">ms_iface_date :: Maybe UTCTime
</span><a href="GHC.Driver.Types.html#ms_iface_date"><span class="hs-identifier hs-var">ms_iface_date</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe UTCTime
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1179"></span><span>                                        </span><span class="annot"><span class="annottext">ms_hie_date :: Maybe UTCTime
</span><a href="GHC.Driver.Types.html#ms_hie_date"><span class="hs-identifier hs-var">ms_hie_date</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe UTCTime
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1180"></span><span>                                        </span><span class="annot"><span class="annottext">ms_textual_imps :: [(Maybe FastString, Located ModuleName)]
</span><a href="GHC.Driver.Types.html#ms_textual_imps"><span class="hs-identifier hs-var">ms_textual_imps</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Maybe FastString, Located ModuleName)]
</span><a href="#local-6989586621681201358"><span class="hs-identifier hs-var">imps</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1181"></span><span>                                        </span><span class="annot"><span class="annottext">ms_srcimps :: [(Maybe FastString, Located ModuleName)]
</span><a href="GHC.Driver.Types.html#ms_srcimps"><span class="hs-identifier hs-var">ms_srcimps</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Maybe FastString, Located ModuleName)]
</span><a href="#local-6989586621681201357"><span class="hs-identifier hs-var">src_imps</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1182"></span><span>
</span><span id="line-1183"></span><span>  </span><span class="hs-comment">-- run the compiler!</span><span>
</span><span id="line-1184"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201322"><span class="annot"><span class="annottext">msg :: HscEnv -&gt; p -&gt; RecompileRequired -&gt; p -&gt; IO ()
</span><a href="#local-6989586621681201322"><span class="hs-identifier hs-var hs-var">msg</span></a></span></span><span> </span><span id="local-6989586621681201321"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681201321"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681201320"><span class="annot"><span class="annottext">RecompileRequired
</span><a href="#local-6989586621681201320"><span class="hs-identifier hs-var">what</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; RecompileRequired -&gt; IO ()
</span><a href="GHC.Driver.Main.html#oneShotMsg"><span class="hs-identifier hs-var">oneShotMsg</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681201321"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">RecompileRequired
</span><a href="#local-6989586621681201320"><span class="hs-identifier hs-var">what</span></a></span><span>
</span><span id="line-1185"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621681201318"><span class="annot"><span class="annottext">HscStatus
</span><a href="#local-6989586621681201318"><span class="hs-identifier hs-var">result</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681201317"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201317"><span class="hs-identifier hs-var">plugin_dflags</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1186"></span><span>          </span><span class="annot"><span class="annottext">IO (HscStatus, DynFlags) -&gt; CompPipeline (HscStatus, DynFlags)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (HscStatus, DynFlags) -&gt; CompPipeline (HscStatus, DynFlags))
-&gt; IO (HscStatus, DynFlags) -&gt; CompPipeline (HscStatus, DynFlags)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; Maybe TcGblEnv
-&gt; Maybe Messager
-&gt; HscEnv
-&gt; ModSummary
-&gt; SourceModified
-&gt; Maybe ModIface
-&gt; (Int, Int)
-&gt; IO (HscStatus, DynFlags)
</span><a href="GHC.Driver.Main.html#hscIncrementalCompile"><span class="hs-identifier hs-var">hscIncrementalCompile</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">Maybe TcGblEnv
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Messager -&gt; Maybe Messager
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Messager
forall {p} {p}. HscEnv -&gt; p -&gt; RecompileRequired -&gt; p -&gt; IO ()
</span><a href="#local-6989586621681201322"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681201334"><span class="hs-identifier hs-var">hsc_env'</span></a></span><span>
</span><span id="line-1187"></span><span>                            </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681201331"><span class="hs-identifier hs-var">mod_summary</span></a></span><span> </span><span class="annot"><span class="annottext">SourceModified
</span><a href="#local-6989586621681201340"><span class="hs-identifier hs-var">source_unchanged</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ModIface
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span>
</span><span id="line-1188"></span><span>
</span><span id="line-1189"></span><span>        </span><span class="hs-comment">-- In the rest of the pipeline use the dflags with plugin info</span><span>
</span><span id="line-1190"></span><span>        </span><span class="annot"><span class="annottext">DynFlags -&gt; CompPipeline ()
</span><a href="GHC.Driver.Pipeline.Monad.html#setDynFlags"><span class="hs-identifier hs-var">setDynFlags</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201317"><span class="hs-identifier hs-var">plugin_dflags</span></a></span><span>
</span><span id="line-1191"></span><span>
</span><span id="line-1192"></span><span>        </span><span class="annot"><span class="annottext">(PhasePlus, String) -&gt; CompPipeline (PhasePlus, String)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscSource -&gt; ModuleName -&gt; HscStatus -&gt; PhasePlus
</span><a href="GHC.Driver.Pipeline.Monad.html#HscOut"><span class="hs-identifier hs-var">HscOut</span></a></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621681201370"><span class="hs-identifier hs-var">src_flavour</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681201359"><span class="hs-identifier hs-var">mod_name</span></a></span><span> </span><span class="annot"><span class="annottext">HscStatus
</span><a href="#local-6989586621681201318"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1193"></span><span>                </span><span class="annot"><span class="annottext">String -&gt; String
forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;HscOut doesn't have an input filename&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1194"></span><span>
</span><span id="line-1195"></span><span class="annot"><a href="GHC.Driver.Pipeline.html#runPhase"><span class="hs-identifier hs-var">runPhase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#HscOut"><span class="hs-identifier hs-type">HscOut</span></a></span><span> </span><span id="local-6989586621681201316"><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621681201316"><span class="hs-identifier hs-var">src_flavour</span></a></span></span><span> </span><span id="local-6989586621681201315"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681201315"><span class="hs-identifier hs-var">mod_name</span></a></span></span><span> </span><span id="local-6989586621681201314"><span class="annot"><span class="annottext">HscStatus
</span><a href="#local-6989586621681201314"><span class="hs-identifier hs-var">result</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681201313"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201313"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1196"></span><span>        </span><span id="local-6989586621681201312"><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681201312"><span class="hs-identifier hs-var">location</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscSource -&gt; ModuleName -&gt; CompPipeline ModLocation
</span><a href="GHC.Driver.Pipeline.html#getLocation"><span class="hs-identifier hs-var">getLocation</span></a></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621681201316"><span class="hs-identifier hs-var">src_flavour</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681201315"><span class="hs-identifier hs-var">mod_name</span></a></span><span>
</span><span id="line-1197"></span><span>        </span><span class="annot"><span class="annottext">ModLocation -&gt; CompPipeline ()
</span><a href="GHC.Driver.Pipeline.Monad.html#setModLocation"><span class="hs-identifier hs-var">setModLocation</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681201312"><span class="hs-identifier hs-var">location</span></a></span><span>
</span><span id="line-1198"></span><span>
</span><span id="line-1199"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201311"><span class="annot"><span class="annottext">o_file :: String
</span><a href="#local-6989586621681201311"><span class="hs-identifier hs-var hs-var">o_file</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModLocation -&gt; String
</span><a href="GHC.Unit.Module.Location.html#ml_obj_file"><span class="hs-identifier hs-var hs-var">ml_obj_file</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681201312"><span class="hs-identifier hs-var">location</span></a></span><span> </span><span class="hs-comment">-- The real object file</span><span>
</span><span id="line-1200"></span><span>            </span><span id="local-6989586621681201310"><span class="annot"><span class="annottext">hsc_lang :: HscTarget
</span><a href="#local-6989586621681201310"><span class="hs-identifier hs-var hs-var">hsc_lang</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; HscTarget
</span><a href="GHC.Driver.Session.html#hscTarget"><span class="hs-identifier hs-var hs-var">hscTarget</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201313"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1201"></span><span>            </span><span id="local-6989586621681201309"><span class="annot"><span class="annottext">next_phase :: Phase
</span><a href="#local-6989586621681201309"><span class="hs-identifier hs-var hs-var">next_phase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscSource -&gt; HscTarget -&gt; Phase
</span><a href="GHC.Driver.Pipeline.html#hscPostBackendPhase"><span class="hs-identifier hs-var">hscPostBackendPhase</span></a></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621681201316"><span class="hs-identifier hs-var">src_flavour</span></a></span><span> </span><span class="annot"><span class="annottext">HscTarget
</span><a href="#local-6989586621681201310"><span class="hs-identifier hs-var">hsc_lang</span></a></span><span>
</span><span id="line-1202"></span><span>
</span><span id="line-1203"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HscStatus
</span><a href="#local-6989586621681201314"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1204"></span><span>            </span><span class="annot"><a href="GHC.Driver.Types.html#HscNotGeneratingCode"><span class="hs-identifier hs-type">HscNotGeneratingCode</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ModDetails
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1205"></span><span>                </span><span class="annot"><span class="annottext">(PhasePlus, String) -&gt; CompPipeline (PhasePlus, String)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Phase -&gt; PhasePlus
</span><a href="GHC.Driver.Pipeline.Monad.html#RealPhase"><span class="hs-identifier hs-var">RealPhase</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#StopLn"><span class="hs-identifier hs-var">StopLn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1206"></span><span>                        </span><span class="annot"><span class="annottext">String -&gt; String
forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;No output filename from Hsc when no-code&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1207"></span><span>            </span><span class="annot"><a href="GHC.Driver.Types.html#HscUpToDate"><span class="hs-identifier hs-type">HscUpToDate</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ModDetails
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1208"></span><span>                </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; CompPipeline ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; CompPipeline ()) -&gt; IO () -&gt; CompPipeline ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; String -&gt; IO ()
</span><a href="GHC.Driver.Pipeline.html#touchObjectFile"><span class="hs-identifier hs-var">touchObjectFile</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201313"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201311"><span class="hs-identifier hs-var">o_file</span></a></span><span>
</span><span id="line-1209"></span><span>                   </span><span class="hs-comment">-- The .o file must have a later modification date</span><span>
</span><span id="line-1210"></span><span>                   </span><span class="hs-comment">-- than the source file (else we wouldn't get Nothing)</span><span>
</span><span id="line-1211"></span><span>                   </span><span class="hs-comment">-- but we touch it anyway, to keep 'make' happy (we think).</span><span>
</span><span id="line-1212"></span><span>                   </span><span class="annot"><span class="annottext">(PhasePlus, String) -&gt; CompPipeline (PhasePlus, String)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Phase -&gt; PhasePlus
</span><a href="GHC.Driver.Pipeline.Monad.html#RealPhase"><span class="hs-identifier hs-var">RealPhase</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#StopLn"><span class="hs-identifier hs-var">StopLn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201311"><span class="hs-identifier hs-var">o_file</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1213"></span><span>            </span><span class="annot"><a href="GHC.Driver.Types.html#HscUpdateBoot"><span class="hs-identifier hs-type">HscUpdateBoot</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ModDetails
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1214"></span><span>                </span><span class="hs-keyword">do</span><span> </span><span class="hs-comment">-- In the case of hs-boot files, generate a dummy .o-boot</span><span>
</span><span id="line-1215"></span><span>                   </span><span class="hs-comment">-- stamp file for the benefit of Make</span><span>
</span><span id="line-1216"></span><span>                   </span><span class="annot"><span class="annottext">IO () -&gt; CompPipeline ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; CompPipeline ()) -&gt; IO () -&gt; CompPipeline ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; String -&gt; IO ()
</span><a href="GHC.Driver.Pipeline.html#touchObjectFile"><span class="hs-identifier hs-var">touchObjectFile</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201313"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201311"><span class="hs-identifier hs-var">o_file</span></a></span><span>
</span><span id="line-1217"></span><span>                   </span><span class="annot"><span class="annottext">(PhasePlus, String) -&gt; CompPipeline (PhasePlus, String)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Phase -&gt; PhasePlus
</span><a href="GHC.Driver.Pipeline.Monad.html#RealPhase"><span class="hs-identifier hs-var">RealPhase</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#StopLn"><span class="hs-identifier hs-var">StopLn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201311"><span class="hs-identifier hs-var">o_file</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1218"></span><span>            </span><span class="annot"><a href="GHC.Driver.Types.html#HscUpdateSig"><span class="hs-identifier hs-type">HscUpdateSig</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ModDetails
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1219"></span><span>                </span><span class="hs-keyword">do</span><span> </span><span class="hs-comment">-- We need to create a REAL but empty .o file</span><span>
</span><span id="line-1220"></span><span>                   </span><span class="hs-comment">-- because we are going to attempt to put it in a library</span><span>
</span><span id="line-1221"></span><span>                   </span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#PipeState"><span class="hs-identifier hs-type">PipeState</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">hsc_env :: PipeState -&gt; HscEnv
</span><a href="GHC.Driver.Pipeline.Monad.html#hsc_env"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621681201308"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681201308"><span class="hs-identifier hs-var">hsc_env'</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CompPipeline PipeState
</span><a href="GHC.Driver.Pipeline.Monad.html#getPipeState"><span class="hs-identifier hs-var">getPipeState</span></a></span><span>
</span><span id="line-1222"></span><span>                   </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201305"><span class="annot"><span class="annottext">input_fn :: String
</span><a href="#local-6989586621681201305"><span class="hs-identifier hs-var hs-var">input_fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe String -&gt; String
forall a. HasCallStack =&gt; String -&gt; Maybe a -&gt; a
</span><a href="GHC.Data.Maybe.html#expectJust"><span class="hs-identifier hs-var">expectJust</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;runPhase&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModLocation -&gt; Maybe String
</span><a href="GHC.Unit.Module.Location.html#ml_hs_file"><span class="hs-identifier hs-var hs-var">ml_hs_file</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681201312"><span class="hs-identifier hs-var">location</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1223"></span><span>                       </span><span id="local-6989586621681201304"><span class="annot"><span class="annottext">basename :: String
</span><a href="#local-6989586621681201304"><span class="hs-identifier hs-var hs-var">basename</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String
</span><a href="../../filepath/src/System.FilePath.Windows.html#dropExtension"><span class="hs-identifier hs-var">dropExtension</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201305"><span class="hs-identifier hs-var">input_fn</span></a></span><span>
</span><span id="line-1224"></span><span>                   </span><span class="annot"><span class="annottext">IO () -&gt; CompPipeline ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; CompPipeline ()) -&gt; IO () -&gt; CompPipeline ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; HscEnv -&gt; String -&gt; ModLocation -&gt; ModuleName -&gt; IO ()
</span><a href="GHC.Driver.Pipeline.html#compileEmptyStub"><span class="hs-identifier hs-var">compileEmptyStub</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201313"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681201308"><span class="hs-identifier hs-var">hsc_env'</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201304"><span class="hs-identifier hs-var">basename</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681201312"><span class="hs-identifier hs-var">location</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681201315"><span class="hs-identifier hs-var">mod_name</span></a></span><span>
</span><span id="line-1225"></span><span>                   </span><span class="annot"><span class="annottext">(PhasePlus, String) -&gt; CompPipeline (PhasePlus, String)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Phase -&gt; PhasePlus
</span><a href="GHC.Driver.Pipeline.Monad.html#RealPhase"><span class="hs-identifier hs-var">RealPhase</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#StopLn"><span class="hs-identifier hs-var">StopLn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201311"><span class="hs-identifier hs-var">o_file</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1226"></span><span>            </span><span class="annot"><a href="GHC.Driver.Types.html#HscRecomp"><span class="hs-identifier hs-type">HscRecomp</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hscs_guts :: HscStatus -&gt; CgGuts
</span><a href="GHC.Driver.Types.html#hscs_guts"><span class="hs-identifier hs-var">hscs_guts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681201303"><span class="annot"><span class="annottext">CgGuts
</span><a href="#local-6989586621681201303"><span class="hs-identifier hs-var">cgguts</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-1227"></span><span>                        </span><span class="annot"><span class="annottext">hscs_mod_location :: HscStatus -&gt; ModLocation
</span><a href="GHC.Driver.Types.html#hscs_mod_location"><span class="hs-identifier hs-var">hscs_mod_location</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681201302"><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681201302"><span class="hs-identifier hs-var">mod_location</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-1228"></span><span>                        </span><span class="annot"><span class="annottext">hscs_partial_iface :: HscStatus -&gt; PartialModIface
</span><a href="GHC.Driver.Types.html#hscs_partial_iface"><span class="hs-identifier hs-var">hscs_partial_iface</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681201301"><span class="annot"><span class="annottext">PartialModIface
</span><a href="#local-6989586621681201301"><span class="hs-identifier hs-var">partial_iface</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-1229"></span><span>                        </span><span class="annot"><span class="annottext">hscs_old_iface_hash :: HscStatus -&gt; Maybe Fingerprint
</span><a href="GHC.Driver.Types.html#hscs_old_iface_hash"><span class="hs-identifier hs-var">hscs_old_iface_hash</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681201300"><span class="annot"><span class="annottext">Maybe Fingerprint
</span><a href="#local-6989586621681201300"><span class="hs-identifier hs-var">mb_old_iface_hash</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-1230"></span><span>                        </span><span class="annot"><span class="annottext">hscs_iface_dflags :: HscStatus -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hscs_iface_dflags"><span class="hs-identifier hs-var">hscs_iface_dflags</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681201299"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201299"><span class="hs-identifier hs-var">iface_dflags</span></a></span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1231"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621681201298"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201298"><span class="hs-identifier hs-var">output_fn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Phase -&gt; CompPipeline String
</span><a href="GHC.Driver.Pipeline.html#phaseOutputFilename"><span class="hs-identifier hs-var">phaseOutputFilename</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201309"><span class="hs-identifier hs-var">next_phase</span></a></span><span>
</span><span id="line-1232"></span><span>
</span><span id="line-1233"></span><span>                    </span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#PipeState"><span class="hs-identifier hs-type">PipeState</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">hsc_env :: PipeState -&gt; HscEnv
</span><a href="GHC.Driver.Pipeline.Monad.html#hsc_env"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621681201297"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681201297"><span class="hs-identifier hs-var">hsc_env'</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CompPipeline PipeState
</span><a href="GHC.Driver.Pipeline.Monad.html#getPipeState"><span class="hs-identifier hs-var">getPipeState</span></a></span><span>
</span><span id="line-1234"></span><span>
</span><span id="line-1235"></span><span>                    </span><span class="hs-special">(</span><span id="local-6989586621681201296"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201296"><span class="hs-identifier hs-var">outputFilename</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681201295"><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621681201295"><span class="hs-identifier hs-var">mStub</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681201294"><span class="annot"><span class="annottext">[(ForeignSrcLang, String)]
</span><a href="#local-6989586621681201294"><span class="hs-identifier hs-var">foreign_files</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681201293"><span class="annot"><span class="annottext">CgInfos
</span><a href="#local-6989586621681201293"><span class="hs-identifier hs-var">cg_infos</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (String, Maybe String, [(ForeignSrcLang, String)], CgInfos)
-&gt; CompPipeline
     (String, Maybe String, [(ForeignSrcLang, String)], CgInfos)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (String, Maybe String, [(ForeignSrcLang, String)], CgInfos)
 -&gt; CompPipeline
      (String, Maybe String, [(ForeignSrcLang, String)], CgInfos))
-&gt; IO (String, Maybe String, [(ForeignSrcLang, String)], CgInfos)
-&gt; CompPipeline
     (String, Maybe String, [(ForeignSrcLang, String)], CgInfos)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1236"></span><span>                      </span><span class="annot"><span class="annottext">HscEnv
-&gt; CgGuts
-&gt; ModLocation
-&gt; String
-&gt; IO (String, Maybe String, [(ForeignSrcLang, String)], CgInfos)
</span><a href="GHC.Driver.Main.html#hscGenHardCode"><span class="hs-identifier hs-var">hscGenHardCode</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681201297"><span class="hs-identifier hs-var">hsc_env'</span></a></span><span> </span><span class="annot"><span class="annottext">CgGuts
</span><a href="#local-6989586621681201303"><span class="hs-identifier hs-var">cgguts</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681201302"><span class="hs-identifier hs-var">mod_location</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201298"><span class="hs-identifier hs-var">output_fn</span></a></span><span>
</span><span id="line-1237"></span><span>
</span><span id="line-1238"></span><span>                    </span><span id="local-6989586621681201291"><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621681201291"><span class="hs-identifier hs-var">final_iface</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ModIface -&gt; CompPipeline ModIface
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; PartialModIface -&gt; Maybe CgInfos -&gt; IO ModIface
</span><a href="GHC.Iface.Make.html#mkFullIface"><span class="hs-identifier hs-var">mkFullIface</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681201297"><span class="hs-identifier hs-var">hsc_env'</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">hsc_dflags :: DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201299"><span class="hs-identifier hs-var">iface_dflags</span></a></span><span class="hs-special">}</span><span> </span><span class="annot"><span class="annottext">PartialModIface
</span><a href="#local-6989586621681201301"><span class="hs-identifier hs-var">partial_iface</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CgInfos -&gt; Maybe CgInfos
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">CgInfos
</span><a href="#local-6989586621681201293"><span class="hs-identifier hs-var">cg_infos</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1239"></span><span>                    </span><span class="annot"><span class="annottext">ModIface -&gt; CompPipeline ()
</span><a href="GHC.Driver.Pipeline.Monad.html#setIface"><span class="hs-identifier hs-var">setIface</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621681201291"><span class="hs-identifier hs-var">final_iface</span></a></span><span>
</span><span id="line-1240"></span><span>
</span><span id="line-1241"></span><span>                    </span><span class="hs-comment">-- See Note [Writing interface files]</span><span>
</span><span id="line-1242"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201289"><span class="annot"><span class="annottext">if_dflags :: DynFlags
</span><a href="#local-6989586621681201289"><span class="hs-identifier hs-var hs-var">if_dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201313"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; GeneralFlag -&gt; DynFlags
</span><a href="GHC.Driver.Session.html#gopt_unset"><span class="hs-operator hs-var">`gopt_unset`</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_BuildDynamicToo"><span class="hs-identifier hs-var">Opt_BuildDynamicToo</span></a></span><span>
</span><span id="line-1243"></span><span>                    </span><span class="annot"><span class="annottext">IO () -&gt; CompPipeline ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; CompPipeline ()) -&gt; IO () -&gt; CompPipeline ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; ModIface -&gt; Maybe Fingerprint -&gt; ModLocation -&gt; IO ()
</span><a href="GHC.Driver.Main.html#hscMaybeWriteIface"><span class="hs-identifier hs-var">hscMaybeWriteIface</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201289"><span class="hs-identifier hs-var">if_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621681201291"><span class="hs-identifier hs-var">final_iface</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Fingerprint
</span><a href="#local-6989586621681201300"><span class="hs-identifier hs-var">mb_old_iface_hash</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681201302"><span class="hs-identifier hs-var">mod_location</span></a></span><span>
</span><span id="line-1244"></span><span>
</span><span id="line-1245"></span><span>                    </span><span id="local-6989586621681201288"><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621681201288"><span class="hs-identifier hs-var">stub_o</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Maybe String) -&gt; CompPipeline (Maybe String)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String -&gt; IO String) -&gt; Maybe String -&gt; IO (Maybe String)
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; String -&gt; IO String
</span><a href="GHC.Driver.Pipeline.html#compileStub"><span class="hs-identifier hs-var">compileStub</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681201297"><span class="hs-identifier hs-var">hsc_env'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621681201295"><span class="hs-identifier hs-var">mStub</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1246"></span><span>                    </span><span id="local-6989586621681201287"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201287"><span class="hs-identifier hs-var">foreign_os</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO [String] -&gt; CompPipeline [String]
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO [String] -&gt; CompPipeline [String])
-&gt; IO [String] -&gt; CompPipeline [String]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1247"></span><span>                      </span><span class="annot"><span class="annottext">((ForeignSrcLang, String) -&gt; IO String)
-&gt; [(ForeignSrcLang, String)] -&gt; IO [String]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ForeignSrcLang -&gt; String -&gt; IO String)
-&gt; (ForeignSrcLang, String) -&gt; IO String
forall a b c. (a -&gt; b -&gt; c) -&gt; (a, b) -&gt; c
</span><a href="../../base/src/Data.Tuple.html#uncurry"><span class="hs-identifier hs-var">uncurry</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; ForeignSrcLang -&gt; String -&gt; IO String
</span><a href="GHC.Driver.Pipeline.html#compileForeign"><span class="hs-identifier hs-var">compileForeign</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681201297"><span class="hs-identifier hs-var">hsc_env'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(ForeignSrcLang, String)]
</span><a href="#local-6989586621681201294"><span class="hs-identifier hs-var">foreign_files</span></a></span><span>
</span><span id="line-1248"></span><span>                    </span><span class="annot"><span class="annottext">[String] -&gt; CompPipeline ()
</span><a href="GHC.Driver.Pipeline.Monad.html#setForeignOs"><span class="hs-identifier hs-var">setForeignOs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[String] -&gt; (String -&gt; [String]) -&gt; Maybe String -&gt; [String]
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../base/src/Data.Maybe.html#maybe"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">String -&gt; [String]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621681201288"><span class="hs-identifier hs-var">stub_o</span></a></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201287"><span class="hs-identifier hs-var">foreign_os</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1249"></span><span>
</span><span id="line-1250"></span><span>                    </span><span class="annot"><span class="annottext">(PhasePlus, String) -&gt; CompPipeline (PhasePlus, String)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Phase -&gt; PhasePlus
</span><a href="GHC.Driver.Pipeline.Monad.html#RealPhase"><span class="hs-identifier hs-var">RealPhase</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201309"><span class="hs-identifier hs-var">next_phase</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201296"><span class="hs-identifier hs-var">outputFilename</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1251"></span><span>
</span><span id="line-1252"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-1253"></span><span class="hs-comment">-- Cmm phase</span><span>
</span><span id="line-1254"></span><span>
</span><span id="line-1255"></span><span class="annot"><a href="GHC.Driver.Pipeline.html#runPhase"><span class="hs-identifier hs-var">runPhase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#RealPhase"><span class="hs-identifier hs-type">RealPhase</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#CmmCpp"><span class="hs-identifier hs-var">CmmCpp</span></a></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681201283"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201283"><span class="hs-identifier hs-var">input_fn</span></a></span></span><span> </span><span id="local-6989586621681201282"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201282"><span class="hs-identifier hs-var">dflags</span></a></span></span><span>
</span><span id="line-1256"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621681201281"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201281"><span class="hs-identifier hs-var">output_fn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Phase -&gt; CompPipeline String
</span><a href="GHC.Driver.Pipeline.html#phaseOutputFilename"><span class="hs-identifier hs-var">phaseOutputFilename</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#Cmm"><span class="hs-identifier hs-var">Cmm</span></a></span><span>
</span><span id="line-1257"></span><span>       </span><span class="annot"><span class="annottext">IO () -&gt; CompPipeline ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; CompPipeline ()) -&gt; IO () -&gt; CompPipeline ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool -&gt; String -&gt; String -&gt; IO ()
</span><a href="GHC.Driver.Pipeline.html#doCpp"><span class="hs-identifier hs-var">doCpp</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201282"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-comment">{-not raw-}</span><span>
</span><span id="line-1258"></span><span>                      </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201283"><span class="hs-identifier hs-var">input_fn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201281"><span class="hs-identifier hs-var">output_fn</span></a></span><span>
</span><span id="line-1259"></span><span>       </span><span class="annot"><span class="annottext">(PhasePlus, String) -&gt; CompPipeline (PhasePlus, String)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Phase -&gt; PhasePlus
</span><a href="GHC.Driver.Pipeline.Monad.html#RealPhase"><span class="hs-identifier hs-var">RealPhase</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#Cmm"><span class="hs-identifier hs-var">Cmm</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201281"><span class="hs-identifier hs-var">output_fn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1260"></span><span>
</span><span id="line-1261"></span><span class="annot"><a href="GHC.Driver.Pipeline.html#runPhase"><span class="hs-identifier hs-var">runPhase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#RealPhase"><span class="hs-identifier hs-type">RealPhase</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#Cmm"><span class="hs-identifier hs-var">Cmm</span></a></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681201279"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201279"><span class="hs-identifier hs-var">input_fn</span></a></span></span><span> </span><span id="local-6989586621681201278"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201278"><span class="hs-identifier hs-var">dflags</span></a></span></span><span>
</span><span id="line-1262"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201277"><span class="annot"><span class="annottext">hsc_lang :: HscTarget
</span><a href="#local-6989586621681201277"><span class="hs-identifier hs-var hs-var">hsc_lang</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; HscTarget
</span><a href="GHC.Driver.Session.html#hscTarget"><span class="hs-identifier hs-var hs-var">hscTarget</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201278"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1263"></span><span>       </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201276"><span class="annot"><span class="annottext">next_phase :: Phase
</span><a href="#local-6989586621681201276"><span class="hs-identifier hs-var hs-var">next_phase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscSource -&gt; HscTarget -&gt; Phase
</span><a href="GHC.Driver.Pipeline.html#hscPostBackendPhase"><span class="hs-identifier hs-var">hscPostBackendPhase</span></a></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="GHC.Driver.Phases.html#HsSrcFile"><span class="hs-identifier hs-var">HsSrcFile</span></a></span><span> </span><span class="annot"><span class="annottext">HscTarget
</span><a href="#local-6989586621681201277"><span class="hs-identifier hs-var">hsc_lang</span></a></span><span>
</span><span id="line-1264"></span><span>       </span><span id="local-6989586621681201274"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201274"><span class="hs-identifier hs-var">output_fn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Phase -&gt; CompPipeline String
</span><a href="GHC.Driver.Pipeline.html#phaseOutputFilename"><span class="hs-identifier hs-var">phaseOutputFilename</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201276"><span class="hs-identifier hs-var">next_phase</span></a></span><span>
</span><span id="line-1265"></span><span>       </span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#PipeState"><span class="hs-identifier hs-type">PipeState</span></a></span><span class="hs-special">{</span><span id="local-6989586621681201273"><span class="annot"><span class="annottext">HscEnv
hsc_env :: HscEnv
hsc_env :: PipeState -&gt; HscEnv
</span><a href="#local-6989586621681201273"><span class="hs-identifier hs-var hs-var">hsc_env</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CompPipeline PipeState
</span><a href="GHC.Driver.Pipeline.Monad.html#getPipeState"><span class="hs-identifier hs-var">getPipeState</span></a></span><span>
</span><span id="line-1266"></span><span>       </span><span class="annot"><span class="annottext">IO () -&gt; CompPipeline ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; CompPipeline ()) -&gt; IO () -&gt; CompPipeline ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; String -&gt; String -&gt; IO ()
</span><a href="GHC.Driver.Main.html#hscCompileCmmFile"><span class="hs-identifier hs-var">hscCompileCmmFile</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681201273"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201279"><span class="hs-identifier hs-var">input_fn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201274"><span class="hs-identifier hs-var">output_fn</span></a></span><span>
</span><span id="line-1267"></span><span>       </span><span class="annot"><span class="annottext">(PhasePlus, String) -&gt; CompPipeline (PhasePlus, String)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Phase -&gt; PhasePlus
</span><a href="GHC.Driver.Pipeline.Monad.html#RealPhase"><span class="hs-identifier hs-var">RealPhase</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201276"><span class="hs-identifier hs-var">next_phase</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201274"><span class="hs-identifier hs-var">output_fn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1268"></span><span>
</span><span id="line-1269"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-1270"></span><span class="hs-comment">-- Cc phase</span><span>
</span><span id="line-1271"></span><span>
</span><span id="line-1272"></span><span class="annot"><a href="GHC.Driver.Pipeline.html#runPhase"><span class="hs-identifier hs-var">runPhase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#RealPhase"><span class="hs-identifier hs-type">RealPhase</span></a></span><span> </span><span id="local-6989586621681201271"><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201271"><span class="hs-identifier hs-var">cc_phase</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681201270"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201270"><span class="hs-identifier hs-var">input_fn</span></a></span></span><span> </span><span id="local-6989586621681201269"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201269"><span class="hs-identifier hs-var">dflags</span></a></span></span><span>
</span><span id="line-1273"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(Phase -&gt; Bool) -&gt; [Phase] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201271"><span class="hs-identifier hs-var">cc_phase</span></a></span><span> </span><span class="annot"><span class="annottext">Phase -&gt; Phase -&gt; Bool
</span><a href="GHC.Driver.Phases.html#eqPhase"><span class="hs-operator hs-var">`eqPhase`</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#Cc"><span class="hs-identifier hs-var">Cc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#Ccxx"><span class="hs-identifier hs-var">Ccxx</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#HCc"><span class="hs-identifier hs-var">HCc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#Cobjc"><span class="hs-identifier hs-var">Cobjc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#Cobjcxx"><span class="hs-identifier hs-var">Cobjcxx</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1274"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1275"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201268"><span class="annot"><span class="annottext">platform :: Platform
</span><a href="#local-6989586621681201268"><span class="hs-identifier hs-var hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.Session.html#targetPlatform"><span class="hs-identifier hs-var hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201269"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1276"></span><span>            </span><span id="local-6989586621681201267"><span class="annot"><span class="annottext">hcc :: Bool
</span><a href="#local-6989586621681201267"><span class="hs-identifier hs-var hs-var">hcc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201271"><span class="hs-identifier hs-var">cc_phase</span></a></span><span> </span><span class="annot"><span class="annottext">Phase -&gt; Phase -&gt; Bool
</span><a href="GHC.Driver.Phases.html#eqPhase"><span class="hs-operator hs-var">`eqPhase`</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#HCc"><span class="hs-identifier hs-var">HCc</span></a></span><span>
</span><span id="line-1277"></span><span>
</span><span id="line-1278"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201266"><span class="annot"><span class="annottext">cmdline_include_paths :: IncludeSpecs
</span><a href="#local-6989586621681201266"><span class="hs-identifier hs-var hs-var">cmdline_include_paths</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; IncludeSpecs
</span><a href="GHC.Driver.Session.html#includePaths"><span class="hs-identifier hs-var hs-var">includePaths</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201269"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1279"></span><span>
</span><span id="line-1280"></span><span>        </span><span class="hs-comment">-- HC files have the dependent packages stamped into them</span><span>
</span><span id="line-1281"></span><span>        </span><span id="local-6989586621681201265"><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681201265"><span class="hs-identifier hs-var">pkgs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681201267"><span class="hs-identifier hs-var">hcc</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">IO [UnitId] -&gt; CompPipeline [UnitId]
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO [UnitId] -&gt; CompPipeline [UnitId])
-&gt; IO [UnitId] -&gt; CompPipeline [UnitId]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO [UnitId]
</span><a href="GHC.Driver.Pipeline.html#getHCFilePackages"><span class="hs-identifier hs-var">getHCFilePackages</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201270"><span class="hs-identifier hs-var">input_fn</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[UnitId] -&gt; CompPipeline [UnitId]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1282"></span><span>
</span><span id="line-1283"></span><span>        </span><span class="hs-comment">-- add package include paths even if we're just compiling .c</span><span>
</span><span id="line-1284"></span><span>        </span><span class="hs-comment">-- files; this is the Value Add(TM) that using ghc instead of</span><span>
</span><span id="line-1285"></span><span>        </span><span class="hs-comment">-- gcc gives you :)</span><span>
</span><span id="line-1286"></span><span>        </span><span id="local-6989586621681201263"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201263"><span class="hs-identifier hs-var">pkg_include_dirs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO [String] -&gt; CompPipeline [String]
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO [String] -&gt; CompPipeline [String])
-&gt; IO [String] -&gt; CompPipeline [String]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [UnitId] -&gt; IO [String]
</span><a href="GHC.Unit.State.html#getUnitIncludePath"><span class="hs-identifier hs-var">getUnitIncludePath</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201269"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681201265"><span class="hs-identifier hs-var">pkgs</span></a></span><span>
</span><span id="line-1287"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201260"><span class="annot"><span class="annottext">include_paths_global :: [String]
</span><a href="#local-6989586621681201260"><span class="hs-identifier hs-var hs-var">include_paths_global</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(String -&gt; [String] -&gt; [String])
-&gt; [String] -&gt; [String] -&gt; [String]
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681201258"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201258"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681201257"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201257"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-I&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201258"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; [String]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201257"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1288"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IncludeSpecs -&gt; [String]
</span><a href="GHC.Driver.Session.html#includePathsGlobal"><span class="hs-identifier hs-var hs-var">includePathsGlobal</span></a></span><span> </span><span class="annot"><span class="annottext">IncludeSpecs
</span><a href="#local-6989586621681201266"><span class="hs-identifier hs-var">cmdline_include_paths</span></a></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201263"><span class="hs-identifier hs-var">pkg_include_dirs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1289"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201254"><span class="annot"><span class="annottext">include_paths_quote :: [String]
</span><a href="#local-6989586621681201254"><span class="hs-identifier hs-var hs-var">include_paths_quote</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(String -&gt; [String] -&gt; [String])
-&gt; [String] -&gt; [String] -&gt; [String]
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681201253"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201253"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681201252"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201252"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-iquote&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201253"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; [String]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201252"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1290"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IncludeSpecs -&gt; [String]
</span><a href="GHC.Driver.Session.html#includePathsQuote"><span class="hs-identifier hs-var hs-var">includePathsQuote</span></a></span><span> </span><span class="annot"><span class="annottext">IncludeSpecs
</span><a href="#local-6989586621681201266"><span class="hs-identifier hs-var">cmdline_include_paths</span></a></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-1291"></span><span>               </span><span class="annot"><span class="annottext">IncludeSpecs -&gt; [String]
</span><a href="GHC.Driver.Session.html#includePathsQuoteImplicit"><span class="hs-identifier hs-var hs-var">includePathsQuoteImplicit</span></a></span><span> </span><span class="annot"><span class="annottext">IncludeSpecs
</span><a href="#local-6989586621681201266"><span class="hs-identifier hs-var">cmdline_include_paths</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1292"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201249"><span class="annot"><span class="annottext">include_paths :: [String]
</span><a href="#local-6989586621681201249"><span class="hs-identifier hs-var hs-var">include_paths</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201254"><span class="hs-identifier hs-var">include_paths_quote</span></a></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201260"><span class="hs-identifier hs-var">include_paths_global</span></a></span><span>
</span><span id="line-1293"></span><span>
</span><span id="line-1294"></span><span>        </span><span class="hs-comment">-- pass -D or -optP to preprocessor when compiling foreign C files</span><span>
</span><span id="line-1295"></span><span>        </span><span class="hs-comment">-- (#16737). Doing it in this way is simpler and also enable the C</span><span>
</span><span id="line-1296"></span><span>        </span><span class="hs-comment">-- compiler to perform preprocessing and parsing in a single pass,</span><span>
</span><span id="line-1297"></span><span>        </span><span class="hs-comment">-- but it may introduce inconsistency if a different pgm_P is specified.</span><span>
</span><span id="line-1298"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201247"><span class="annot"><span class="annottext">more_preprocessor_opts :: [String]
</span><a href="#local-6989586621681201247"><span class="hs-identifier hs-var hs-var">more_preprocessor_opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[String]] -&gt; [String]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><a href="../../base/src/Data.Foldable.html#concat"><span class="hs-identifier hs-var">concat</span></a></span><span>
</span><span id="line-1299"></span><span>              </span><span class="hs-special">[</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-Xpreprocessor&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201245"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1300"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681201267"><span class="hs-identifier hs-var">hcc</span></a></span><span>
</span><span id="line-1301"></span><span>              </span><span class="hs-special">,</span><span> </span><span id="local-6989586621681201245"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201245"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; (DynFlags -&gt; [String]) -&gt; [String]
forall a. DynFlags -&gt; (DynFlags -&gt; [a]) -&gt; [a]
</span><a href="GHC.Driver.Session.html#getOpts"><span class="hs-identifier hs-var">getOpts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201269"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [String]
</span><a href="GHC.Driver.Session.html#opt_P"><span class="hs-identifier hs-var">opt_P</span></a></span><span>
</span><span id="line-1302"></span><span>              </span><span class="hs-special">]</span><span>
</span><span id="line-1303"></span><span>
</span><span id="line-1304"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201243"><span class="annot"><span class="annottext">gcc_extra_viac_flags :: [String]
</span><a href="#local-6989586621681201243"><span class="hs-identifier hs-var hs-var">gcc_extra_viac_flags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [String]
</span><a href="GHC.Driver.Session.html#extraGccViaCFlags"><span class="hs-identifier hs-var">extraGccViaCFlags</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201269"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1305"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201241"><span class="annot"><span class="annottext">pic_c_flags :: [String]
</span><a href="#local-6989586621681201241"><span class="hs-identifier hs-var hs-var">pic_c_flags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [String]
</span><a href="GHC.Driver.Session.html#picCCOpts"><span class="hs-identifier hs-var">picCCOpts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201269"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1306"></span><span>
</span><span id="line-1307"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201239"><span class="annot"><span class="annottext">verbFlags :: [String]
</span><a href="#local-6989586621681201239"><span class="hs-identifier hs-var hs-var">verbFlags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [String]
</span><a href="GHC.Driver.Session.html#getVerbFlags"><span class="hs-identifier hs-var">getVerbFlags</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201269"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1308"></span><span>
</span><span id="line-1309"></span><span>        </span><span class="hs-comment">-- cc-options are not passed when compiling .hc files.  Our</span><span>
</span><span id="line-1310"></span><span>        </span><span class="hs-comment">-- hc code doesn't not #include any header files anyway, so these</span><span>
</span><span id="line-1311"></span><span>        </span><span class="hs-comment">-- options aren't necessary.</span><span>
</span><span id="line-1312"></span><span>        </span><span id="local-6989586621681201237"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201237"><span class="hs-identifier hs-var">pkg_extra_cc_opts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO [String] -&gt; CompPipeline [String]
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO [String] -&gt; CompPipeline [String])
-&gt; IO [String] -&gt; CompPipeline [String]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1313"></span><span>          </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681201267"><span class="hs-identifier hs-var">hcc</span></a></span><span>
</span><span id="line-1314"></span><span>             </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; IO [String]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1315"></span><span>             </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [UnitId] -&gt; IO [String]
</span><a href="GHC.Unit.State.html#getUnitExtraCcOpts"><span class="hs-identifier hs-var">getUnitExtraCcOpts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201269"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681201265"><span class="hs-identifier hs-var">pkgs</span></a></span><span>
</span><span id="line-1316"></span><span>
</span><span id="line-1317"></span><span>        </span><span id="local-6989586621681201235"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201235"><span class="hs-identifier hs-var">framework_paths</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1318"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Bool
</span><a href="../../ghc-boot/src/GHC.Platform.html#platformUsesFrameworks"><span class="hs-identifier hs-var">platformUsesFrameworks</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681201268"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-1319"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621681201233"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201233"><span class="hs-identifier hs-var">pkgFrameworkPaths</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO [String] -&gt; CompPipeline [String]
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO [String] -&gt; CompPipeline [String])
-&gt; IO [String] -&gt; CompPipeline [String]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [UnitId] -&gt; IO [String]
</span><a href="GHC.Unit.State.html#getUnitFrameworkPath"><span class="hs-identifier hs-var">getUnitFrameworkPath</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201269"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681201265"><span class="hs-identifier hs-var">pkgs</span></a></span><span>
</span><span id="line-1320"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201231"><span class="annot"><span class="annottext">cmdlineFrameworkPaths :: [String]
</span><a href="#local-6989586621681201231"><span class="hs-identifier hs-var hs-var">cmdlineFrameworkPaths</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [String]
</span><a href="GHC.Driver.Session.html#frameworkPaths"><span class="hs-identifier hs-var hs-var">frameworkPaths</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201269"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1321"></span><span>                    </span><span class="annot"><span class="annottext">[String] -&gt; CompPipeline [String]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; CompPipeline [String])
-&gt; [String] -&gt; CompPipeline [String]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; String) -&gt; [String] -&gt; [String]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-F&quot;</span></span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1322"></span><span>                                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201231"><span class="hs-identifier hs-var">cmdlineFrameworkPaths</span></a></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201233"><span class="hs-identifier hs-var">pkgFrameworkPaths</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1323"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; CompPipeline [String]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1324"></span><span>
</span><span id="line-1325"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201225"><span class="annot"><span class="annottext">cc_opt :: [String]
</span><a href="#local-6989586621681201225"><span class="hs-identifier hs-var hs-var">cc_opt</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Int
</span><a href="GHC.Driver.Session.html#optLevel"><span class="hs-identifier hs-var hs-var">optLevel</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201269"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-O2&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1326"></span><span>                   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Int
</span><a href="GHC.Driver.Session.html#optLevel"><span class="hs-identifier hs-var hs-var">optLevel</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201269"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-O&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1327"></span><span>                   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1328"></span><span>
</span><span id="line-1329"></span><span>        </span><span class="hs-comment">-- Decide next phase</span><span>
</span><span id="line-1330"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201223"><span class="annot"><span class="annottext">next_phase :: Phase
</span><a href="#local-6989586621681201223"><span class="hs-identifier hs-var hs-var">next_phase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Phase
</span><a href="GHC.Driver.Phases.html#As"><span class="hs-identifier hs-var">As</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1331"></span><span>        </span><span id="local-6989586621681201222"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201222"><span class="hs-identifier hs-var">output_fn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Phase -&gt; CompPipeline String
</span><a href="GHC.Driver.Pipeline.html#phaseOutputFilename"><span class="hs-identifier hs-var">phaseOutputFilename</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201223"><span class="hs-identifier hs-var">next_phase</span></a></span><span>
</span><span id="line-1332"></span><span>
</span><span id="line-1333"></span><span>        </span><span class="hs-keyword">let</span><span>
</span><span id="line-1334"></span><span>          </span><span id="local-6989586621681201220"><span class="annot"><span class="annottext">more_hcc_opts :: [String]
</span><a href="#local-6989586621681201220"><span class="hs-identifier hs-var hs-var">more_hcc_opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1335"></span><span>                </span><span class="hs-comment">-- on x86 the floating point regs have greater precision</span><span>
</span><span id="line-1336"></span><span>                </span><span class="hs-comment">-- than a double, which leads to unpredictable results.</span><span>
</span><span id="line-1337"></span><span>                </span><span class="hs-comment">-- By default, we turn this off with -ffloat-store unless</span><span>
</span><span id="line-1338"></span><span>                </span><span class="hs-comment">-- the user specified -fexcess-precision.</span><span>
</span><span id="line-1339"></span><span>                </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Arch
</span><a href="../../ghc-boot/src/GHC.Platform.html#platformArch"><span class="hs-identifier hs-var">platformArch</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681201268"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">Arch -&gt; Arch -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Arch
</span><a href="../../ghc-boot/src/GHC.Platform.html#ArchX86"><span class="hs-identifier hs-var">ArchX86</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-1340"></span><span>                    </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_ExcessPrecision"><span class="hs-identifier hs-var">Opt_ExcessPrecision</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201269"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1341"></span><span>                        </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-ffloat-store&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1342"></span><span>                        </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-1343"></span><span>
</span><span id="line-1344"></span><span>                </span><span class="hs-comment">-- gcc's -fstrict-aliasing allows two accesses to memory</span><span>
</span><span id="line-1345"></span><span>                </span><span class="hs-comment">-- to be considered non-aliasing if they have different types.</span><span>
</span><span id="line-1346"></span><span>                </span><span class="hs-comment">-- This interacts badly with the C code we generate, which is</span><span>
</span><span id="line-1347"></span><span>                </span><span class="hs-comment">-- very weakly typed, being derived from C--.</span><span>
</span><span id="line-1348"></span><span>                </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-fno-strict-aliasing&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-1349"></span><span>
</span><span id="line-1350"></span><span>        </span><span id="local-6989586621681201217"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201217"><span class="hs-identifier hs-var">ghcVersionH</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO String -&gt; CompPipeline String
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO String -&gt; CompPipeline String)
-&gt; IO String -&gt; CompPipeline String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; IO String
</span><a href="GHC.Driver.Pipeline.html#getGhcVersionPathName"><span class="hs-identifier hs-var">getGhcVersionPathName</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201269"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1351"></span><span>
</span><span id="line-1352"></span><span>        </span><span class="annot"><span class="annottext">IO () -&gt; CompPipeline ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; CompPipeline ()) -&gt; IO () -&gt; CompPipeline ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ForeignSrcLang -&gt; DynFlags -&gt; [Option] -&gt; IO ()
</span><a href="GHC.SysTools.Tasks.html#runCc"><span class="hs-identifier hs-var">GHC.SysTools.runCc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Phase -&gt; Maybe ForeignSrcLang
</span><a href="GHC.Driver.Types.html#phaseForeignLanguage"><span class="hs-identifier hs-var">phaseForeignLanguage</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201271"><span class="hs-identifier hs-var">cc_phase</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201269"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-1353"></span><span>                        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#FileOption"><span class="hs-identifier hs-var">GHC.SysTools.FileOption</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201270"><span class="hs-identifier hs-var">input_fn</span></a></span><span>
</span><span id="line-1354"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-o&quot;</span></span><span>
</span><span id="line-1355"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#FileOption"><span class="hs-identifier hs-var">GHC.SysTools.FileOption</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201222"><span class="hs-identifier hs-var">output_fn</span></a></span><span>
</span><span id="line-1356"></span><span>                        </span><span class="hs-special">]</span><span>
</span><span id="line-1357"></span><span>                       </span><span class="annot"><span class="annottext">[Option] -&gt; [Option] -&gt; [Option]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Option) -&gt; [String] -&gt; [Option]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-1358"></span><span>                          </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201241"><span class="hs-identifier hs-var">pic_c_flags</span></a></span><span>
</span><span id="line-1359"></span><span>
</span><span id="line-1360"></span><span>                </span><span class="hs-comment">-- Stub files generated for foreign exports references the runIO_closure</span><span>
</span><span id="line-1361"></span><span>                </span><span class="hs-comment">-- and runNonIO_closure symbols, which are defined in the base package.</span><span>
</span><span id="line-1362"></span><span>                </span><span class="hs-comment">-- These symbols are imported into the stub.c file via RtsAPI.h, and the</span><span>
</span><span id="line-1363"></span><span>                </span><span class="hs-comment">-- way we do the import depends on whether we're currently compiling</span><span>
</span><span id="line-1364"></span><span>                </span><span class="hs-comment">-- the base package or not.</span><span>
</span><span id="line-1365"></span><span>                       </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; OS
</span><a href="../../ghc-boot/src/GHC.Platform.html#platformOS"><span class="hs-identifier hs-var">platformOS</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681201268"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">OS -&gt; OS -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="../../ghc-boot/src/GHC.Platform.html#OSMinGW32"><span class="hs-identifier hs-var">OSMinGW32</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-1366"></span><span>                              </span><span class="annot"><span class="annottext">DynFlags -&gt; UnitId
</span><a href="GHC.Driver.Session.html#homeUnitId"><span class="hs-identifier hs-var hs-var">homeUnitId</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201269"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; UnitId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="GHC.Unit.Types.html#baseUnitId"><span class="hs-identifier hs-var">baseUnitId</span></a></span><span>
</span><span id="line-1367"></span><span>                                </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-DCOMPILING_BASE_PACKAGE&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1368"></span><span>                                </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1369"></span><span>
</span><span id="line-1370"></span><span>        </span><span class="hs-comment">-- We only support SparcV9 and better because V8 lacks an atomic CAS</span><span>
</span><span id="line-1371"></span><span>        </span><span class="hs-comment">-- instruction. Note that the user can still override this</span><span>
</span><span id="line-1372"></span><span>        </span><span class="hs-comment">-- (e.g., -mcpu=ultrasparc) as GCC picks the &quot;best&quot; -mcpu flag</span><span>
</span><span id="line-1373"></span><span>        </span><span class="hs-comment">-- regardless of the ordering.</span><span>
</span><span id="line-1374"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-1375"></span><span>        </span><span class="hs-comment">-- This is a temporary hack. See #2872, commit</span><span>
</span><span id="line-1376"></span><span>        </span><span class="hs-comment">-- 5bd3072ac30216a505151601884ac88bf404c9f2</span><span>
</span><span id="line-1377"></span><span>                       </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Arch
</span><a href="../../ghc-boot/src/GHC.Platform.html#platformArch"><span class="hs-identifier hs-var">platformArch</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681201268"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">Arch -&gt; Arch -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Arch
</span><a href="../../ghc-boot/src/GHC.Platform.html#ArchSPARC"><span class="hs-identifier hs-var">ArchSPARC</span></a></span><span>
</span><span id="line-1378"></span><span>                           </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-mcpu=v9&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-1379"></span><span>                           </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1380"></span><span>
</span><span id="line-1381"></span><span>                       </span><span class="hs-comment">-- GCC 4.6+ doesn't like -Wimplicit when compiling C++.</span><span>
</span><span id="line-1382"></span><span>                       </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201271"><span class="hs-identifier hs-var">cc_phase</span></a></span><span> </span><span class="annot"><span class="annottext">Phase -&gt; Phase -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#Ccxx"><span class="hs-identifier hs-var">Ccxx</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201271"><span class="hs-identifier hs-var">cc_phase</span></a></span><span> </span><span class="annot"><span class="annottext">Phase -&gt; Phase -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#Cobjcxx"><span class="hs-identifier hs-var">Cobjcxx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1383"></span><span>                             </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-Wimplicit&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-1384"></span><span>                             </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1385"></span><span>
</span><span id="line-1386"></span><span>                       </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681201267"><span class="hs-identifier hs-var">hcc</span></a></span><span>
</span><span id="line-1387"></span><span>                             </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201243"><span class="hs-identifier hs-var">gcc_extra_viac_flags</span></a></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201220"><span class="hs-identifier hs-var">more_hcc_opts</span></a></span><span>
</span><span id="line-1388"></span><span>                             </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1389"></span><span>                       </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201239"><span class="hs-identifier hs-var">verbFlags</span></a></span><span>
</span><span id="line-1390"></span><span>                       </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-S&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1391"></span><span>                       </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201225"><span class="hs-identifier hs-var">cc_opt</span></a></span><span>
</span><span id="line-1392"></span><span>                       </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-include&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201217"><span class="hs-identifier hs-var">ghcVersionH</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1393"></span><span>                       </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201235"><span class="hs-identifier hs-var">framework_paths</span></a></span><span>
</span><span id="line-1394"></span><span>                       </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201249"><span class="hs-identifier hs-var">include_paths</span></a></span><span>
</span><span id="line-1395"></span><span>                       </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201247"><span class="hs-identifier hs-var">more_preprocessor_opts</span></a></span><span>
</span><span id="line-1396"></span><span>                       </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201237"><span class="hs-identifier hs-var">pkg_extra_cc_opts</span></a></span><span>
</span><span id="line-1397"></span><span>                       </span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1398"></span><span>
</span><span id="line-1399"></span><span>        </span><span class="annot"><span class="annottext">(PhasePlus, String) -&gt; CompPipeline (PhasePlus, String)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Phase -&gt; PhasePlus
</span><a href="GHC.Driver.Pipeline.Monad.html#RealPhase"><span class="hs-identifier hs-var">RealPhase</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201223"><span class="hs-identifier hs-var">next_phase</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201222"><span class="hs-identifier hs-var">output_fn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1400"></span><span>
</span><span id="line-1401"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-1402"></span><span class="hs-comment">-- As, SpitAs phase : Assembler</span><span>
</span><span id="line-1403"></span><span>
</span><span id="line-1404"></span><span class="hs-comment">-- This is for calling the assembler on a regular assembly file</span><span>
</span><span id="line-1405"></span><span class="annot"><a href="GHC.Driver.Pipeline.html#runPhase"><span class="hs-identifier hs-var">runPhase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#RealPhase"><span class="hs-identifier hs-type">RealPhase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Phases.html#As"><span class="hs-identifier hs-type">As</span></a></span><span> </span><span id="local-6989586621681201210"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681201210"><span class="hs-identifier hs-var">with_cpp</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621681201209"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201209"><span class="hs-identifier hs-var">input_fn</span></a></span></span><span> </span><span id="local-6989586621681201208"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201208"><span class="hs-identifier hs-var">dflags</span></a></span></span><span>
</span><span id="line-1406"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1407"></span><span>        </span><span class="hs-comment">-- LLVM from version 3.0 onwards doesn't support the OS X system</span><span>
</span><span id="line-1408"></span><span>        </span><span class="hs-comment">-- assembler, so we use clang as the assembler instead. (#5636)</span><span>
</span><span id="line-1409"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201205"><span class="annot"><span class="annottext">as_prog :: DynFlags -&gt; [Option] -&gt; IO ()
</span><a href="#local-6989586621681201205"><span class="hs-identifier hs-var hs-var">as_prog</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; HscTarget
</span><a href="GHC.Driver.Session.html#hscTarget"><span class="hs-identifier hs-var hs-var">hscTarget</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201208"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscTarget -&gt; HscTarget -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">HscTarget
</span><a href="GHC.Driver.Session.html#HscLlvm"><span class="hs-identifier hs-var">HscLlvm</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-1410"></span><span>                      </span><span class="annot"><span class="annottext">Platform -&gt; OS
</span><a href="../../ghc-boot/src/GHC.Platform.html#platformOS"><span class="hs-identifier hs-var">platformOS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.Session.html#targetPlatform"><span class="hs-identifier hs-var hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201208"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OS -&gt; OS -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="../../ghc-boot/src/GHC.Platform.html#OSDarwin"><span class="hs-identifier hs-var">OSDarwin</span></a></span><span>
</span><span id="line-1411"></span><span>                    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [Option] -&gt; IO ()
</span><a href="GHC.SysTools.Tasks.html#runClang"><span class="hs-identifier hs-var">GHC.SysTools.runClang</span></a></span><span>
</span><span id="line-1412"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [Option] -&gt; IO ()
</span><a href="GHC.SysTools.Tasks.html#runAs"><span class="hs-identifier hs-var">GHC.SysTools.runAs</span></a></span><span>
</span><span id="line-1413"></span><span>
</span><span id="line-1414"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201200"><span class="annot"><span class="annottext">cmdline_include_paths :: IncludeSpecs
</span><a href="#local-6989586621681201200"><span class="hs-identifier hs-var hs-var">cmdline_include_paths</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; IncludeSpecs
</span><a href="GHC.Driver.Session.html#includePaths"><span class="hs-identifier hs-var hs-var">includePaths</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201208"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1415"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201199"><span class="annot"><span class="annottext">pic_c_flags :: [String]
</span><a href="#local-6989586621681201199"><span class="hs-identifier hs-var hs-var">pic_c_flags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [String]
</span><a href="GHC.Driver.Session.html#picCCOpts"><span class="hs-identifier hs-var">picCCOpts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201208"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1416"></span><span>
</span><span id="line-1417"></span><span>        </span><span id="local-6989586621681201198"><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201198"><span class="hs-identifier hs-var">next_phase</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CompPipeline Phase
</span><a href="GHC.Driver.Pipeline.html#maybeMergeForeign"><span class="hs-identifier hs-var">maybeMergeForeign</span></a></span><span>
</span><span id="line-1418"></span><span>        </span><span id="local-6989586621681201196"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201196"><span class="hs-identifier hs-var">output_fn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Phase -&gt; CompPipeline String
</span><a href="GHC.Driver.Pipeline.html#phaseOutputFilename"><span class="hs-identifier hs-var">phaseOutputFilename</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201198"><span class="hs-identifier hs-var">next_phase</span></a></span><span>
</span><span id="line-1419"></span><span>
</span><span id="line-1420"></span><span>        </span><span class="hs-comment">-- we create directories for the object file, because it</span><span>
</span><span id="line-1421"></span><span>        </span><span class="hs-comment">-- might be a hierarchical module.</span><span>
</span><span id="line-1422"></span><span>        </span><span class="annot"><span class="annottext">IO () -&gt; CompPipeline ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; CompPipeline ()) -&gt; IO () -&gt; CompPipeline ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; String -&gt; IO ()
</span><a href="../../directory/src/System.Directory.html#createDirectoryIfMissing"><span class="hs-identifier hs-var">createDirectoryIfMissing</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; String
</span><a href="../../filepath/src/System.FilePath.Windows.html#takeDirectory"><span class="hs-identifier hs-var">takeDirectory</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201196"><span class="hs-identifier hs-var">output_fn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1423"></span><span>
</span><span id="line-1424"></span><span>        </span><span id="local-6989586621681201194"><span class="annot"><span class="annottext">CompilerInfo
</span><a href="#local-6989586621681201194"><span class="hs-identifier hs-var">ccInfo</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO CompilerInfo -&gt; CompPipeline CompilerInfo
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO CompilerInfo -&gt; CompPipeline CompilerInfo)
-&gt; IO CompilerInfo -&gt; CompPipeline CompilerInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; IO CompilerInfo
</span><a href="GHC.SysTools.Info.html#getCompilerInfo"><span class="hs-identifier hs-var">getCompilerInfo</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201208"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1425"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201192"><span class="annot"><span class="annottext">global_includes :: [Option]
</span><a href="#local-6989586621681201192"><span class="hs-identifier hs-var hs-var">global_includes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-I&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201191"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1426"></span><span>                              </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681201191"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201191"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IncludeSpecs -&gt; [String]
</span><a href="GHC.Driver.Session.html#includePathsGlobal"><span class="hs-identifier hs-var hs-var">includePathsGlobal</span></a></span><span> </span><span class="annot"><span class="annottext">IncludeSpecs
</span><a href="#local-6989586621681201200"><span class="hs-identifier hs-var">cmdline_include_paths</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1427"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201190"><span class="annot"><span class="annottext">local_includes :: [Option]
</span><a href="#local-6989586621681201190"><span class="hs-identifier hs-var hs-var">local_includes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-iquote&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201189"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1428"></span><span>                             </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681201189"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201189"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IncludeSpecs -&gt; [String]
</span><a href="GHC.Driver.Session.html#includePathsQuote"><span class="hs-identifier hs-var hs-var">includePathsQuote</span></a></span><span> </span><span class="annot"><span class="annottext">IncludeSpecs
</span><a href="#local-6989586621681201200"><span class="hs-identifier hs-var">cmdline_include_paths</span></a></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-1429"></span><span>                                </span><span class="annot"><span class="annottext">IncludeSpecs -&gt; [String]
</span><a href="GHC.Driver.Session.html#includePathsQuoteImplicit"><span class="hs-identifier hs-var hs-var">includePathsQuoteImplicit</span></a></span><span> </span><span class="annot"><span class="annottext">IncludeSpecs
</span><a href="#local-6989586621681201200"><span class="hs-identifier hs-var">cmdline_include_paths</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1430"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201180"><span class="annot"><span class="annottext">runAssembler :: String -&gt; String -&gt; m ()
</span><a href="#local-6989586621681201180"><span class="hs-identifier hs-var hs-var">runAssembler</span></a></span></span><span> </span><span id="local-6989586621681201179"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201179"><span class="hs-identifier hs-var">inputFilename</span></a></span></span><span> </span><span id="local-6989586621681201178"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201178"><span class="hs-identifier hs-var">outputFilename</span></a></span></span><span>
</span><span id="line-1431"></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1432"></span><span>                  </span><span class="annot"><span class="annottext">String -&gt; (String -&gt; IO ()) -&gt; IO ()
forall (m :: * -&gt; *) a.
MonadIO m =&gt;
String -&gt; (String -&gt; m a) -&gt; m a
</span><a href="GHC.Utils.Misc.html#withAtomicRename"><span class="hs-identifier hs-var">withAtomicRename</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201178"><span class="hs-identifier hs-var">outputFilename</span></a></span><span> </span><span class="annot"><span class="annottext">((String -&gt; IO ()) -&gt; IO ()) -&gt; (String -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681201176"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201176"><span class="hs-identifier hs-var">temp_outputFilename</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1433"></span><span>                    </span><span class="annot"><span class="annottext">DynFlags -&gt; [Option] -&gt; IO ()
</span><a href="#local-6989586621681201205"><span class="hs-identifier hs-var">as_prog</span></a></span><span>
</span><span id="line-1434"></span><span>                       </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201208"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1435"></span><span>                       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Option]
</span><a href="#local-6989586621681201190"><span class="hs-identifier hs-var">local_includes</span></a></span><span> </span><span class="annot"><span class="annottext">[Option] -&gt; [Option] -&gt; [Option]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Option]
</span><a href="#local-6989586621681201192"><span class="hs-identifier hs-var">global_includes</span></a></span><span>
</span><span id="line-1436"></span><span>                       </span><span class="hs-comment">-- See Note [-fPIC for assembler]</span><span>
</span><span id="line-1437"></span><span>                       </span><span class="annot"><span class="annottext">[Option] -&gt; [Option] -&gt; [Option]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Option) -&gt; [String] -&gt; [Option]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201199"><span class="hs-identifier hs-var">pic_c_flags</span></a></span><span>
</span><span id="line-1438"></span><span>                       </span><span class="hs-comment">-- See Note [Produce big objects on Windows]</span><span>
</span><span id="line-1439"></span><span>                       </span><span class="annot"><span class="annottext">[Option] -&gt; [Option] -&gt; [Option]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-Wa,-mbig-obj&quot;</span></span><span>
</span><span id="line-1440"></span><span>                          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; OS
</span><a href="../../ghc-boot/src/GHC.Platform.html#platformOS"><span class="hs-identifier hs-var">platformOS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.Session.html#targetPlatform"><span class="hs-identifier hs-var hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201208"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OS -&gt; OS -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="../../ghc-boot/src/GHC.Platform.html#OSMinGW32"><span class="hs-identifier hs-var">OSMinGW32</span></a></span><span>
</span><span id="line-1441"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Bool
</span><a href="../../ghc-boot/src/GHC.Platform.html#target32Bit"><span class="hs-identifier hs-var">target32Bit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.Session.html#targetPlatform"><span class="hs-identifier hs-var hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201208"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1442"></span><span>                          </span><span class="hs-special">]</span><span>
</span><span id="line-1443"></span><span>
</span><span id="line-1444"></span><span>        </span><span class="hs-comment">-- We only support SparcV9 and better because V8 lacks an atomic CAS</span><span>
</span><span id="line-1445"></span><span>        </span><span class="hs-comment">-- instruction so we have to make sure that the assembler accepts the</span><span>
</span><span id="line-1446"></span><span>        </span><span class="hs-comment">-- instruction set. Note that the user can still override this</span><span>
</span><span id="line-1447"></span><span>        </span><span class="hs-comment">-- (e.g., -mcpu=ultrasparc). GCC picks the &quot;best&quot; -mcpu flag</span><span>
</span><span id="line-1448"></span><span>        </span><span class="hs-comment">-- regardless of the ordering.</span><span>
</span><span id="line-1449"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-1450"></span><span>        </span><span class="hs-comment">-- This is a temporary hack.</span><span>
</span><span id="line-1451"></span><span>                       </span><span class="annot"><span class="annottext">[Option] -&gt; [Option] -&gt; [Option]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Arch
</span><a href="../../ghc-boot/src/GHC.Platform.html#platformArch"><span class="hs-identifier hs-var">platformArch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.Session.html#targetPlatform"><span class="hs-identifier hs-var hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201208"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Arch -&gt; Arch -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Arch
</span><a href="../../ghc-boot/src/GHC.Platform.html#ArchSPARC"><span class="hs-identifier hs-var">ArchSPARC</span></a></span><span>
</span><span id="line-1452"></span><span>                           </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-mcpu=v9&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-1453"></span><span>                           </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1454"></span><span>                       </span><span class="annot"><span class="annottext">[Option] -&gt; [Option] -&gt; [Option]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">(CompilerInfo -&gt; Bool) -&gt; [CompilerInfo] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CompilerInfo
</span><a href="#local-6989586621681201194"><span class="hs-identifier hs-var">ccInfo</span></a></span><span> </span><span class="annot"><span class="annottext">CompilerInfo -&gt; CompilerInfo -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">CompilerInfo
</span><a href="GHC.Driver.Session.html#Clang"><span class="hs-identifier hs-var">Clang</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CompilerInfo
</span><a href="GHC.Driver.Session.html#AppleClang"><span class="hs-identifier hs-var">AppleClang</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CompilerInfo
</span><a href="GHC.Driver.Session.html#AppleClang51"><span class="hs-identifier hs-var">AppleClang51</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1455"></span><span>                            </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-Qunused-arguments&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-1456"></span><span>                            </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1457"></span><span>                       </span><span class="annot"><span class="annottext">[Option] -&gt; [Option] -&gt; [Option]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-x&quot;</span></span><span>
</span><span id="line-1458"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681201210"><span class="hs-identifier hs-var">with_cpp</span></a></span><span>
</span><span id="line-1459"></span><span>                              </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;assembler-with-cpp&quot;</span></span><span>
</span><span id="line-1460"></span><span>                              </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;assembler&quot;</span></span><span>
</span><span id="line-1461"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-c&quot;</span></span><span>
</span><span id="line-1462"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#FileOption"><span class="hs-identifier hs-var">GHC.SysTools.FileOption</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201179"><span class="hs-identifier hs-var">inputFilename</span></a></span><span>
</span><span id="line-1463"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-o&quot;</span></span><span>
</span><span id="line-1464"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#FileOption"><span class="hs-identifier hs-var">GHC.SysTools.FileOption</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201176"><span class="hs-identifier hs-var">temp_outputFilename</span></a></span><span>
</span><span id="line-1465"></span><span>                          </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1466"></span><span>
</span><span id="line-1467"></span><span>        </span><span class="annot"><span class="annottext">IO () -&gt; CompPipeline ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; CompPipeline ()) -&gt; IO () -&gt; CompPipeline ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Int -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201208"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Running the assembler&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1468"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; String -&gt; CompPipeline ()
forall {m :: * -&gt; *}. MonadIO m =&gt; String -&gt; String -&gt; m ()
</span><a href="#local-6989586621681201180"><span class="hs-identifier hs-var">runAssembler</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201209"><span class="hs-identifier hs-var">input_fn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201196"><span class="hs-identifier hs-var">output_fn</span></a></span><span>
</span><span id="line-1469"></span><span>
</span><span id="line-1470"></span><span>        </span><span class="annot"><span class="annottext">(PhasePlus, String) -&gt; CompPipeline (PhasePlus, String)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Phase -&gt; PhasePlus
</span><a href="GHC.Driver.Pipeline.Monad.html#RealPhase"><span class="hs-identifier hs-var">RealPhase</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201198"><span class="hs-identifier hs-var">next_phase</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201196"><span class="hs-identifier hs-var">output_fn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1471"></span><span>
</span><span id="line-1472"></span><span>
</span><span id="line-1473"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-1474"></span><span class="hs-comment">-- LlvmOpt phase</span><span>
</span><span id="line-1475"></span><span class="annot"><a href="GHC.Driver.Pipeline.html#runPhase"><span class="hs-identifier hs-var">runPhase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#RealPhase"><span class="hs-identifier hs-type">RealPhase</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#LlvmOpt"><span class="hs-identifier hs-var">LlvmOpt</span></a></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681201171"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201171"><span class="hs-identifier hs-var">input_fn</span></a></span></span><span> </span><span id="local-6989586621681201170"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201170"><span class="hs-identifier hs-var">dflags</span></a></span></span><span>
</span><span id="line-1476"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1477"></span><span>    </span><span id="local-6989586621681201169"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201169"><span class="hs-identifier hs-var">output_fn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Phase -&gt; CompPipeline String
</span><a href="GHC.Driver.Pipeline.html#phaseOutputFilename"><span class="hs-identifier hs-var">phaseOutputFilename</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#LlvmLlc"><span class="hs-identifier hs-var">LlvmLlc</span></a></span><span>
</span><span id="line-1478"></span><span>
</span><span id="line-1479"></span><span>    </span><span class="annot"><span class="annottext">IO () -&gt; CompPipeline ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; CompPipeline ()) -&gt; IO () -&gt; CompPipeline ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [Option] -&gt; IO ()
</span><a href="GHC.SysTools.Tasks.html#runLlvmOpt"><span class="hs-identifier hs-var">GHC.SysTools.runLlvmOpt</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201170"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1480"></span><span>               </span><span class="hs-special">(</span><span>   </span><span class="annot"><span class="annottext">[Option]
</span><a href="#local-6989586621681201166"><span class="hs-identifier hs-var">optFlag</span></a></span><span>
</span><span id="line-1481"></span><span>                </span><span class="annot"><span class="annottext">[Option] -&gt; [Option] -&gt; [Option]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Option]
</span><a href="#local-6989586621681201165"><span class="hs-identifier hs-var">defaultOptions</span></a></span><span> </span><span class="annot"><span class="annottext">[Option] -&gt; [Option] -&gt; [Option]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-1482"></span><span>                </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#FileOption"><span class="hs-identifier hs-var">GHC.SysTools.FileOption</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201171"><span class="hs-identifier hs-var">input_fn</span></a></span><span>
</span><span id="line-1483"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-o&quot;</span></span><span>
</span><span id="line-1484"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#FileOption"><span class="hs-identifier hs-var">GHC.SysTools.FileOption</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201169"><span class="hs-identifier hs-var">output_fn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1485"></span><span>                </span><span class="hs-special">)</span><span>
</span><span id="line-1486"></span><span>
</span><span id="line-1487"></span><span>    </span><span class="annot"><span class="annottext">(PhasePlus, String) -&gt; CompPipeline (PhasePlus, String)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Phase -&gt; PhasePlus
</span><a href="GHC.Driver.Pipeline.Monad.html#RealPhase"><span class="hs-identifier hs-var">RealPhase</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#LlvmLlc"><span class="hs-identifier hs-var">LlvmLlc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201169"><span class="hs-identifier hs-var">output_fn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1488"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1489"></span><span>        </span><span class="hs-comment">-- we always (unless -optlo specified) run Opt since we rely on it to</span><span>
</span><span id="line-1490"></span><span>        </span><span class="hs-comment">-- fix up some pretty big deficiencies in the code we generate</span><span>
</span><span id="line-1491"></span><span>        </span><span id="local-6989586621681201160"><span class="annot"><span class="annottext">optIdx :: Int
</span><a href="#local-6989586621681201160"><span class="hs-identifier hs-var hs-var">optIdx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">max</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int) -&gt; Int -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">min</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; Int) -&gt; Int -&gt; Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Int
</span><a href="GHC.Driver.Session.html#optLevel"><span class="hs-identifier hs-var hs-var">optLevel</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201170"><span class="hs-identifier hs-var">dflags</span></a></span><span>  </span><span class="hs-comment">-- ensure we're in [0,2]</span><span>
</span><span id="line-1492"></span><span>        </span><span id="local-6989586621681201154"><span class="annot"><span class="annottext">llvmOpts :: String
</span><a href="#local-6989586621681201154"><span class="hs-identifier hs-var hs-var">llvmOpts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [(Int, String)] -&gt; Maybe String
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><a href="../../base/src/GHC.List.html#lookup"><span class="hs-identifier hs-var">lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681201160"><span class="hs-identifier hs-var">optIdx</span></a></span><span> </span><span class="annot"><span class="annottext">([(Int, String)] -&gt; Maybe String)
-&gt; [(Int, String)] -&gt; Maybe String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LlvmConfig -&gt; [(Int, String)]
</span><a href="GHC.Driver.Session.html#llvmPasses"><span class="hs-identifier hs-var hs-var">llvmPasses</span></a></span><span> </span><span class="annot"><span class="annottext">(LlvmConfig -&gt; [(Int, String)]) -&gt; LlvmConfig -&gt; [(Int, String)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; LlvmConfig
</span><a href="GHC.Driver.Session.html#llvmConfig"><span class="hs-identifier hs-var hs-var">llvmConfig</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201170"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1493"></span><span>                    </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681201152"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201152"><span class="hs-identifier hs-var">passes</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201152"><span class="hs-identifier hs-var">passes</span></a></span><span>
</span><span id="line-1494"></span><span>                    </span><span class="annot"><span class="annottext">Maybe String
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; String
forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;runPhase LlvmOpt: llvm-passes file &quot;</span></span><span>
</span><span id="line-1495"></span><span>                                      </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;is missing passes for level &quot;</span></span><span>
</span><span id="line-1496"></span><span>                                      </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../base/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681201160"><span class="hs-identifier hs-var">optIdx</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1497"></span><span>
</span><span id="line-1498"></span><span>        </span><span class="hs-comment">-- don't specify anything if user has specified commands. We do this</span><span>
</span><span id="line-1499"></span><span>        </span><span class="hs-comment">-- for opt but not llc since opt is very specifically for optimisation</span><span>
</span><span id="line-1500"></span><span>        </span><span class="hs-comment">-- passes only, so if the user is passing us extra options we assume</span><span>
</span><span id="line-1501"></span><span>        </span><span class="hs-comment">-- they know what they are doing and don't get in the way.</span><span>
</span><span id="line-1502"></span><span>        </span><span id="local-6989586621681201166"><span class="annot"><span class="annottext">optFlag :: [Option]
</span><a href="#local-6989586621681201166"><span class="hs-identifier hs-var hs-var">optFlag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; (DynFlags -&gt; [String]) -&gt; [String]
forall a. DynFlags -&gt; (DynFlags -&gt; [a]) -&gt; [a]
</span><a href="GHC.Driver.Session.html#getOpts"><span class="hs-identifier hs-var">getOpts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201170"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [String]
</span><a href="GHC.Driver.Session.html#opt_lo"><span class="hs-identifier hs-var">opt_lo</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1503"></span><span>                  </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">(String -&gt; Option) -&gt; [String] -&gt; [Option]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; [Option]) -&gt; [String] -&gt; [Option]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String]
</span><a href="../../base/src/Data.OldList.html#words"><span class="hs-identifier hs-var">words</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201154"><span class="hs-identifier hs-var">llvmOpts</span></a></span><span>
</span><span id="line-1504"></span><span>                  </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1505"></span><span>
</span><span id="line-1506"></span><span>        </span><span id="local-6989586621681201165"><span class="annot"><span class="annottext">defaultOptions :: [Option]
</span><a href="#local-6989586621681201165"><span class="hs-identifier hs-var hs-var">defaultOptions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(String -&gt; Option) -&gt; [String] -&gt; [Option]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; [Option])
-&gt; (([String], [String]) -&gt; [String])
-&gt; ([String], [String])
-&gt; [Option]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[[String]] -&gt; [String]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><a href="../../base/src/Data.Foldable.html#concat"><span class="hs-identifier hs-var">concat</span></a></span><span> </span><span class="annot"><span class="annottext">([[String]] -&gt; [String])
-&gt; (([String], [String]) -&gt; [[String]])
-&gt; ([String], [String])
-&gt; [String]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; [String]) -&gt; [String] -&gt; [[String]]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String]
</span><a href="../../base/src/Data.OldList.html#words"><span class="hs-identifier hs-var">words</span></a></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; [[String]])
-&gt; (([String], [String]) -&gt; [String])
-&gt; ([String], [String])
-&gt; [[String]]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">([String], [String]) -&gt; [String]
forall a b. (a, b) -&gt; a
</span><a href="../../base/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span>
</span><span id="line-1507"></span><span>                       </span><span class="annot"><span class="annottext">(([String], [String]) -&gt; [Option])
-&gt; ([String], [String]) -&gt; [Option]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(String, String)] -&gt; ([String], [String])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><a href="../../base/src/GHC.List.html#unzip"><span class="hs-identifier hs-var">unzip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; [(String, String)]
</span><a href="GHC.Driver.Pipeline.html#llvmOptions"><span class="hs-identifier hs-var">llvmOptions</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201170"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1508"></span><span>
</span><span id="line-1509"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-1510"></span><span class="hs-comment">-- LlvmLlc phase</span><span>
</span><span id="line-1511"></span><span>
</span><span id="line-1512"></span><span class="annot"><a href="GHC.Driver.Pipeline.html#runPhase"><span class="hs-identifier hs-var">runPhase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#RealPhase"><span class="hs-identifier hs-type">RealPhase</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#LlvmLlc"><span class="hs-identifier hs-var">LlvmLlc</span></a></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681201144"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201144"><span class="hs-identifier hs-var">input_fn</span></a></span></span><span> </span><span id="local-6989586621681201143"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201143"><span class="hs-identifier hs-var">dflags</span></a></span></span><span>
</span><span id="line-1513"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1514"></span><span>    </span><span id="local-6989586621681201142"><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201142"><span class="hs-identifier hs-var">next_phase</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-comment">-- hidden debugging flag '-dno-llvm-mangler' to skip mangling</span><span>
</span><span id="line-1515"></span><span>                     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_NoLlvmMangler"><span class="hs-identifier hs-var">Opt_NoLlvmMangler</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201143"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Phase -&gt; CompPipeline Phase
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Phase
</span><a href="GHC.Driver.Phases.html#As"><span class="hs-identifier hs-var">As</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span>
</span><span id="line-1516"></span><span>                     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Phase -&gt; CompPipeline Phase
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#LlvmMangle"><span class="hs-identifier hs-var">LlvmMangle</span></a></span><span>
</span><span id="line-1517"></span><span>
</span><span id="line-1518"></span><span>    </span><span id="local-6989586621681201139"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201139"><span class="hs-identifier hs-var">output_fn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Phase -&gt; CompPipeline String
</span><a href="GHC.Driver.Pipeline.html#phaseOutputFilename"><span class="hs-identifier hs-var">phaseOutputFilename</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201142"><span class="hs-identifier hs-var">next_phase</span></a></span><span>
</span><span id="line-1519"></span><span>
</span><span id="line-1520"></span><span>    </span><span class="annot"><span class="annottext">IO () -&gt; CompPipeline ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; CompPipeline ()) -&gt; IO () -&gt; CompPipeline ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [Option] -&gt; IO ()
</span><a href="GHC.SysTools.Tasks.html#runLlvmLlc"><span class="hs-identifier hs-var">GHC.SysTools.runLlvmLlc</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201143"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1521"></span><span>                </span><span class="hs-special">(</span><span>  </span><span class="annot"><span class="annottext">[Option]
</span><a href="#local-6989586621681201137"><span class="hs-identifier hs-var">optFlag</span></a></span><span>
</span><span id="line-1522"></span><span>                </span><span class="annot"><span class="annottext">[Option] -&gt; [Option] -&gt; [Option]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Option]
</span><a href="#local-6989586621681201136"><span class="hs-identifier hs-var">defaultOptions</span></a></span><span>
</span><span id="line-1523"></span><span>                </span><span class="annot"><span class="annottext">[Option] -&gt; [Option] -&gt; [Option]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#FileOption"><span class="hs-identifier hs-var">GHC.SysTools.FileOption</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201144"><span class="hs-identifier hs-var">input_fn</span></a></span><span>
</span><span id="line-1524"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-o&quot;</span></span><span>
</span><span id="line-1525"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#FileOption"><span class="hs-identifier hs-var">GHC.SysTools.FileOption</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201139"><span class="hs-identifier hs-var">output_fn</span></a></span><span>
</span><span id="line-1526"></span><span>                   </span><span class="hs-special">]</span><span>
</span><span id="line-1527"></span><span>                </span><span class="hs-special">)</span><span>
</span><span id="line-1528"></span><span>
</span><span id="line-1529"></span><span>    </span><span class="annot"><span class="annottext">(PhasePlus, String) -&gt; CompPipeline (PhasePlus, String)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Phase -&gt; PhasePlus
</span><a href="GHC.Driver.Pipeline.Monad.html#RealPhase"><span class="hs-identifier hs-var">RealPhase</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201142"><span class="hs-identifier hs-var">next_phase</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201139"><span class="hs-identifier hs-var">output_fn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1530"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1531"></span><span>    </span><span class="hs-comment">-- Note [Clamping of llc optimizations]</span><span>
</span><span id="line-1532"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1533"></span><span>    </span><span class="hs-comment">-- See #13724</span><span>
</span><span id="line-1534"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1535"></span><span>    </span><span class="hs-comment">-- we clamp the llc optimization between [1,2]. This is because passing -O0</span><span>
</span><span id="line-1536"></span><span>    </span><span class="hs-comment">-- to llc 3.9 or llc 4.0, the naive register allocator can fail with</span><span>
</span><span id="line-1537"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1538"></span><span>    </span><span class="hs-comment">--   Error while trying to spill R1 from class GPR: Cannot scavenge register</span><span>
</span><span id="line-1539"></span><span>    </span><span class="hs-comment">--   without an emergency spill slot!</span><span>
</span><span id="line-1540"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1541"></span><span>    </span><span class="hs-comment">-- Observed at least with target 'arm-unknown-linux-gnueabihf'.</span><span>
</span><span id="line-1542"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1543"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1544"></span><span>    </span><span class="hs-comment">-- With LLVM4, llc -O3 crashes when ghc-stage1 tries to compile</span><span>
</span><span id="line-1545"></span><span>    </span><span class="hs-comment">--   rts/HeapStackCheck.cmm</span><span>
</span><span id="line-1546"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1547"></span><span>    </span><span class="hs-comment">-- llc -O3 '-mtriple=arm-unknown-linux-gnueabihf' -enable-tbaa /var/folders/fv/xqjrpfj516n5xq_m_ljpsjx00000gn/T/ghc33674_0/ghc_6.bc -o /var/folders/fv/xqjrpfj516n5xq_m_ljpsjx00000gn/T/ghc33674_0/ghc_7.lm_s</span><span>
</span><span id="line-1548"></span><span>    </span><span class="hs-comment">-- 0  llc                      0x0000000102ae63e8 llvm::sys::PrintStackTrace(llvm::raw_ostream&amp;) + 40</span><span>
</span><span id="line-1549"></span><span>    </span><span class="hs-comment">-- 1  llc                      0x0000000102ae69a6 SignalHandler(int) + 358</span><span>
</span><span id="line-1550"></span><span>    </span><span class="hs-comment">-- 2  libsystem_platform.dylib 0x00007fffc23f4b3a _sigtramp + 26</span><span>
</span><span id="line-1551"></span><span>    </span><span class="hs-comment">-- 3  libsystem_c.dylib        0x00007fffc226498b __vfprintf + 17876</span><span>
</span><span id="line-1552"></span><span>    </span><span class="hs-comment">-- 4  llc                      0x00000001029d5123 llvm::SelectionDAGISel::LowerArguments(llvm::Function const&amp;) + 5699</span><span>
</span><span id="line-1553"></span><span>    </span><span class="hs-comment">-- 5  llc                      0x0000000102a21a35 llvm::SelectionDAGISel::SelectAllBasicBlocks(llvm::Function const&amp;) + 3381</span><span>
</span><span id="line-1554"></span><span>    </span><span class="hs-comment">-- 6  llc                      0x0000000102a202b1 llvm::SelectionDAGISel::runOnMachineFunction(llvm::MachineFunction&amp;) + 1457</span><span>
</span><span id="line-1555"></span><span>    </span><span class="hs-comment">-- 7  llc                      0x0000000101bdc474 (anonymous namespace)::ARMDAGToDAGISel::runOnMachineFunction(llvm::MachineFunction&amp;) + 20</span><span>
</span><span id="line-1556"></span><span>    </span><span class="hs-comment">-- 8  llc                      0x00000001025573a6 llvm::MachineFunctionPass::runOnFunction(llvm::Function&amp;) + 134</span><span>
</span><span id="line-1557"></span><span>    </span><span class="hs-comment">-- 9  llc                      0x000000010274fb12 llvm::FPPassManager::runOnFunction(llvm::Function&amp;) + 498</span><span>
</span><span id="line-1558"></span><span>    </span><span class="hs-comment">-- 10 llc                      0x000000010274fd23 llvm::FPPassManager::runOnModule(llvm::Module&amp;) + 67</span><span>
</span><span id="line-1559"></span><span>    </span><span class="hs-comment">-- 11 llc                      0x00000001027501b8 llvm::legacy::PassManagerImpl::run(llvm::Module&amp;) + 920</span><span>
</span><span id="line-1560"></span><span>    </span><span class="hs-comment">-- 12 llc                      0x000000010195f075 compileModule(char**, llvm::LLVMContext&amp;) + 12133</span><span>
</span><span id="line-1561"></span><span>    </span><span class="hs-comment">-- 13 llc                      0x000000010195bf0b main + 491</span><span>
</span><span id="line-1562"></span><span>    </span><span class="hs-comment">-- 14 libdyld.dylib            0x00007fffc21e5235 start + 1</span><span>
</span><span id="line-1563"></span><span>    </span><span class="hs-comment">-- Stack dump:</span><span>
</span><span id="line-1564"></span><span>    </span><span class="hs-comment">-- 0.  Program arguments: llc -O3 -mtriple=arm-unknown-linux-gnueabihf -enable-tbaa /var/folders/fv/xqjrpfj516n5xq_m_ljpsjx00000gn/T/ghc33674_0/ghc_6.bc -o /var/folders/fv/xqjrpfj516n5xq_m_ljpsjx00000gn/T/ghc33674_0/ghc_7.lm_s</span><span>
</span><span id="line-1565"></span><span>    </span><span class="hs-comment">-- 1.  Running pass 'Function Pass Manager' on module '/var/folders/fv/xqjrpfj516n5xq_m_ljpsjx00000gn/T/ghc33674_0/ghc_6.bc'.</span><span>
</span><span id="line-1566"></span><span>    </span><span class="hs-comment">-- 2.  Running pass 'ARM Instruction Selection' on function '@&quot;stg_gc_f1$def&quot;'</span><span>
</span><span id="line-1567"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1568"></span><span>    </span><span class="hs-comment">-- Observed at least with -mtriple=arm-unknown-linux-gnueabihf -enable-tbaa</span><span>
</span><span id="line-1569"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1570"></span><span>    </span><span id="local-6989586621681201131"><span class="annot"><span class="annottext">llvmOpts :: String
</span><a href="#local-6989586621681201131"><span class="hs-identifier hs-var hs-var">llvmOpts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Int
</span><a href="GHC.Driver.Session.html#optLevel"><span class="hs-identifier hs-var hs-var">optLevel</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201143"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1571"></span><span>      </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-O1&quot;</span></span><span> </span><span class="hs-comment">-- required to get the non-naive reg allocator. Passing -regalloc=greedy is not sufficient.</span><span>
</span><span id="line-1572"></span><span>      </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-O1&quot;</span></span><span>
</span><span id="line-1573"></span><span>      </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-O2&quot;</span></span><span>
</span><span id="line-1574"></span><span>
</span><span id="line-1575"></span><span>    </span><span id="local-6989586621681201137"><span class="annot"><span class="annottext">optFlag :: [Option]
</span><a href="#local-6989586621681201137"><span class="hs-identifier hs-var hs-var">optFlag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; (DynFlags -&gt; [String]) -&gt; [String]
forall a. DynFlags -&gt; (DynFlags -&gt; [a]) -&gt; [a]
</span><a href="GHC.Driver.Session.html#getOpts"><span class="hs-identifier hs-var">getOpts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201143"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [String]
</span><a href="GHC.Driver.Session.html#opt_lc"><span class="hs-identifier hs-var">opt_lc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1576"></span><span>              </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">(String -&gt; Option) -&gt; [String] -&gt; [Option]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; [Option]) -&gt; [String] -&gt; [Option]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String]
</span><a href="../../base/src/Data.OldList.html#words"><span class="hs-identifier hs-var">words</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201131"><span class="hs-identifier hs-var">llvmOpts</span></a></span><span>
</span><span id="line-1577"></span><span>              </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1578"></span><span>
</span><span id="line-1579"></span><span>    </span><span id="local-6989586621681201136"><span class="annot"><span class="annottext">defaultOptions :: [Option]
</span><a href="#local-6989586621681201136"><span class="hs-identifier hs-var hs-var">defaultOptions</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(String -&gt; Option) -&gt; [String] -&gt; [Option]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; [Option])
-&gt; (([String], [String]) -&gt; [String])
-&gt; ([String], [String])
-&gt; [Option]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; [String]) -&gt; [String] -&gt; [String]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><a href="../../base/src/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String]
</span><a href="../../base/src/Data.OldList.html#words"><span class="hs-identifier hs-var">words</span></a></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; [String])
-&gt; (([String], [String]) -&gt; [String])
-&gt; ([String], [String])
-&gt; [String]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">([String], [String]) -&gt; [String]
forall a b. (a, b) -&gt; b
</span><a href="../../base/src/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span>
</span><span id="line-1580"></span><span>                   </span><span class="annot"><span class="annottext">(([String], [String]) -&gt; [Option])
-&gt; ([String], [String]) -&gt; [Option]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(String, String)] -&gt; ([String], [String])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><a href="../../base/src/GHC.List.html#unzip"><span class="hs-identifier hs-var">unzip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; [(String, String)]
</span><a href="GHC.Driver.Pipeline.html#llvmOptions"><span class="hs-identifier hs-var">llvmOptions</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201143"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1581"></span><span>
</span><span id="line-1582"></span><span>
</span><span id="line-1583"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-1584"></span><span class="hs-comment">-- LlvmMangle phase</span><span>
</span><span id="line-1585"></span><span>
</span><span id="line-1586"></span><span class="annot"><a href="GHC.Driver.Pipeline.html#runPhase"><span class="hs-identifier hs-var">runPhase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#RealPhase"><span class="hs-identifier hs-type">RealPhase</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#LlvmMangle"><span class="hs-identifier hs-var">LlvmMangle</span></a></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681201128"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201128"><span class="hs-identifier hs-var">input_fn</span></a></span></span><span> </span><span id="local-6989586621681201127"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201127"><span class="hs-identifier hs-var">dflags</span></a></span></span><span>
</span><span id="line-1587"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1588"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201126"><span class="annot"><span class="annottext">next_phase :: Phase
</span><a href="#local-6989586621681201126"><span class="hs-identifier hs-var hs-var">next_phase</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Phase
</span><a href="GHC.Driver.Phases.html#As"><span class="hs-identifier hs-var">As</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1589"></span><span>      </span><span id="local-6989586621681201125"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201125"><span class="hs-identifier hs-var">output_fn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Phase -&gt; CompPipeline String
</span><a href="GHC.Driver.Pipeline.html#phaseOutputFilename"><span class="hs-identifier hs-var">phaseOutputFilename</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201126"><span class="hs-identifier hs-var">next_phase</span></a></span><span>
</span><span id="line-1590"></span><span>      </span><span class="annot"><span class="annottext">IO () -&gt; CompPipeline ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; CompPipeline ()) -&gt; IO () -&gt; CompPipeline ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; String -&gt; String -&gt; IO ()
</span><a href="GHC.CmmToLlvm.Mangler.html#llvmFixupAsm"><span class="hs-identifier hs-var">llvmFixupAsm</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201127"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201128"><span class="hs-identifier hs-var">input_fn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201125"><span class="hs-identifier hs-var">output_fn</span></a></span><span>
</span><span id="line-1591"></span><span>      </span><span class="annot"><span class="annottext">(PhasePlus, String) -&gt; CompPipeline (PhasePlus, String)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Phase -&gt; PhasePlus
</span><a href="GHC.Driver.Pipeline.Monad.html#RealPhase"><span class="hs-identifier hs-var">RealPhase</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201126"><span class="hs-identifier hs-var">next_phase</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201125"><span class="hs-identifier hs-var">output_fn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1592"></span><span>
</span><span id="line-1593"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-1594"></span><span class="hs-comment">-- merge in stub objects</span><span>
</span><span id="line-1595"></span><span>
</span><span id="line-1596"></span><span class="annot"><a href="GHC.Driver.Pipeline.html#runPhase"><span class="hs-identifier hs-var">runPhase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#RealPhase"><span class="hs-identifier hs-type">RealPhase</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#MergeForeign"><span class="hs-identifier hs-var">MergeForeign</span></a></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681201124"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201124"><span class="hs-identifier hs-var">input_fn</span></a></span></span><span> </span><span id="local-6989586621681201123"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201123"><span class="hs-identifier hs-var">dflags</span></a></span></span><span>
</span><span id="line-1597"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1598"></span><span>     </span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#PipeState"><span class="hs-identifier hs-type">PipeState</span></a></span><span class="hs-special">{</span><span id="local-6989586621681201122"><span class="annot"><span class="annottext">[String]
foreign_os :: [String]
foreign_os :: PipeState -&gt; [String]
</span><a href="#local-6989586621681201122"><span class="hs-identifier hs-var hs-var">foreign_os</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CompPipeline PipeState
</span><a href="GHC.Driver.Pipeline.Monad.html#getPipeState"><span class="hs-identifier hs-var">getPipeState</span></a></span><span>
</span><span id="line-1599"></span><span>     </span><span id="local-6989586621681201121"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201121"><span class="hs-identifier hs-var">output_fn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Phase -&gt; CompPipeline String
</span><a href="GHC.Driver.Pipeline.html#phaseOutputFilename"><span class="hs-identifier hs-var">phaseOutputFilename</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#StopLn"><span class="hs-identifier hs-var">StopLn</span></a></span><span>
</span><span id="line-1600"></span><span>     </span><span class="annot"><span class="annottext">IO () -&gt; CompPipeline ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; CompPipeline ()) -&gt; IO () -&gt; CompPipeline ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; String -&gt; IO ()
</span><a href="../../directory/src/System.Directory.html#createDirectoryIfMissing"><span class="hs-identifier hs-var">createDirectoryIfMissing</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; String
</span><a href="../../filepath/src/System.FilePath.Windows.html#takeDirectory"><span class="hs-identifier hs-var">takeDirectory</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201121"><span class="hs-identifier hs-var">output_fn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1601"></span><span>     </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201122"><span class="hs-identifier hs-var">foreign_os</span></a></span><span>
</span><span id="line-1602"></span><span>       </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String -&gt; CompPipeline (PhasePlus, String)
forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;runPhase(MergeForeign): no foreign objects&quot;</span></span><span>
</span><span id="line-1603"></span><span>       </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1604"></span><span>         </span><span class="annot"><span class="annottext">IO () -&gt; CompPipeline ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; CompPipeline ()) -&gt; IO () -&gt; CompPipeline ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [String] -&gt; String -&gt; IO ()
</span><a href="GHC.Driver.Pipeline.html#joinObjectFiles"><span class="hs-identifier hs-var">joinObjectFiles</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201123"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201124"><span class="hs-identifier hs-var">input_fn</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; [String]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201122"><span class="hs-identifier hs-var">foreign_os</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201121"><span class="hs-identifier hs-var">output_fn</span></a></span><span>
</span><span id="line-1605"></span><span>         </span><span class="annot"><span class="annottext">(PhasePlus, String) -&gt; CompPipeline (PhasePlus, String)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Phase -&gt; PhasePlus
</span><a href="GHC.Driver.Pipeline.Monad.html#RealPhase"><span class="hs-identifier hs-var">RealPhase</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#StopLn"><span class="hs-identifier hs-var">StopLn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201121"><span class="hs-identifier hs-var">output_fn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1606"></span><span>
</span><span id="line-1607"></span><span class="hs-comment">-- warning suppression</span><span>
</span><span id="line-1608"></span><span class="annot"><a href="GHC.Driver.Pipeline.html#runPhase"><span class="hs-identifier hs-var">runPhase</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#RealPhase"><span class="hs-identifier hs-type">RealPhase</span></a></span><span> </span><span id="local-6989586621681201119"><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201119"><span class="hs-identifier hs-var">other</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681201118"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201118"><span class="hs-identifier hs-var">_input_fn</span></a></span></span><span> </span><span id="local-6989586621681201117"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201117"><span class="hs-identifier hs-var">_dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1609"></span><span>   </span><span class="annot"><span class="annottext">String -&gt; CompPipeline (PhasePlus, String)
forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;runPhase: don't know how to run phase &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Phase -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../base/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="#local-6989586621681201119"><span class="hs-identifier hs-var">other</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1610"></span><span>
</span><span id="line-1611"></span><span class="annot"><a href="GHC.Driver.Pipeline.html#maybeMergeForeign"><span class="hs-identifier hs-type">maybeMergeForeign</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#CompPipeline"><span class="hs-identifier hs-type">CompPipeline</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Phases.html#Phase"><span class="hs-identifier hs-type">Phase</span></a></span><span>
</span><span id="line-1612"></span><span id="maybeMergeForeign"><span class="annot"><span class="annottext">maybeMergeForeign :: CompPipeline Phase
</span><a href="GHC.Driver.Pipeline.html#maybeMergeForeign"><span class="hs-identifier hs-var hs-var">maybeMergeForeign</span></a></span></span><span>
</span><span id="line-1613"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1614"></span><span>     </span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#PipeState"><span class="hs-identifier hs-type">PipeState</span></a></span><span class="hs-special">{</span><span id="local-6989586621681201116"><span class="annot"><span class="annottext">[String]
foreign_os :: [String]
foreign_os :: PipeState -&gt; [String]
</span><a href="#local-6989586621681201116"><span class="hs-identifier hs-var hs-var">foreign_os</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CompPipeline PipeState
</span><a href="GHC.Driver.Pipeline.Monad.html#getPipeState"><span class="hs-identifier hs-var">getPipeState</span></a></span><span>
</span><span id="line-1615"></span><span>     </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201116"><span class="hs-identifier hs-var">foreign_os</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Phase -&gt; CompPipeline Phase
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#StopLn"><span class="hs-identifier hs-var">StopLn</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Phase -&gt; CompPipeline Phase
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#MergeForeign"><span class="hs-identifier hs-var">MergeForeign</span></a></span><span>
</span><span id="line-1616"></span><span>
</span><span id="line-1617"></span><span class="annot"><a href="GHC.Driver.Pipeline.html#getLocation"><span class="hs-identifier hs-type">getLocation</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Phases.html#HscSource"><span class="hs-identifier hs-type">HscSource</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#CompPipeline"><span class="hs-identifier hs-type">CompPipeline</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Location.html#ModLocation"><span class="hs-identifier hs-type">ModLocation</span></a></span><span>
</span><span id="line-1618"></span><span id="getLocation"><span class="annot"><span class="annottext">getLocation :: HscSource -&gt; ModuleName -&gt; CompPipeline ModLocation
</span><a href="GHC.Driver.Pipeline.html#getLocation"><span class="hs-identifier hs-var hs-var">getLocation</span></a></span></span><span> </span><span id="local-6989586621681201115"><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621681201115"><span class="hs-identifier hs-var">src_flavour</span></a></span></span><span> </span><span id="local-6989586621681201114"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681201114"><span class="hs-identifier hs-var">mod_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1619"></span><span>    </span><span id="local-6989586621681201113"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201113"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CompPipeline DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-1620"></span><span>
</span><span id="line-1621"></span><span>    </span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#PipeEnv"><span class="hs-identifier hs-type">PipeEnv</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">src_basename :: PipeEnv -&gt; String
</span><a href="GHC.Driver.Pipeline.Monad.html#src_basename"><span class="hs-identifier hs-var">src_basename</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621681201112"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201112"><span class="hs-identifier hs-var">basename</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-1622"></span><span>             </span><span class="annot"><span class="annottext">src_suffix :: PipeEnv -&gt; String
</span><a href="GHC.Driver.Pipeline.Monad.html#src_suffix"><span class="hs-identifier hs-var">src_suffix</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621681201111"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201111"><span class="hs-identifier hs-var">suff</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CompPipeline PipeEnv
</span><a href="GHC.Driver.Pipeline.Monad.html#getPipeEnv"><span class="hs-identifier hs-var">getPipeEnv</span></a></span><span>
</span><span id="line-1623"></span><span>    </span><span class="annot"><a href="GHC.Driver.Pipeline.Monad.html#PipeState"><span class="hs-identifier hs-type">PipeState</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">maybe_loc :: PipeState -&gt; Maybe ModLocation
</span><a href="GHC.Driver.Pipeline.Monad.html#maybe_loc"><span class="hs-identifier hs-var">maybe_loc</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621681201110"><span class="annot"><span class="annottext">Maybe ModLocation
</span><a href="#local-6989586621681201110"><span class="hs-identifier hs-var">maybe_loc</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CompPipeline PipeState
</span><a href="GHC.Driver.Pipeline.Monad.html#getPipeState"><span class="hs-identifier hs-var">getPipeState</span></a></span><span>
</span><span id="line-1624"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe ModLocation
</span><a href="#local-6989586621681201110"><span class="hs-identifier hs-var">maybe_loc</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1625"></span><span>        </span><span class="hs-comment">-- Build a ModLocation to pass to hscMain.</span><span>
</span><span id="line-1626"></span><span>        </span><span class="hs-comment">-- The source filename is rather irrelevant by now, but it's used</span><span>
</span><span id="line-1627"></span><span>        </span><span class="hs-comment">-- by hscMain for messages.  hscMain also needs</span><span>
</span><span id="line-1628"></span><span>        </span><span class="hs-comment">-- the .hi and .o filenames. If we already have a ModLocation</span><span>
</span><span id="line-1629"></span><span>        </span><span class="hs-comment">-- then simply update the extensions of the interface and object</span><span>
</span><span id="line-1630"></span><span>        </span><span class="hs-comment">-- files to match the DynFlags, otherwise use the logic in Finder.</span><span>
</span><span id="line-1631"></span><span>      </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681201109"><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681201109"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModLocation -&gt; CompPipeline ModLocation
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(ModLocation -&gt; CompPipeline ModLocation)
-&gt; ModLocation -&gt; CompPipeline ModLocation
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681201109"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-1632"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ml_hs_file :: Maybe String
</span><a href="GHC.Unit.Module.Location.html#ml_hs_file"><span class="hs-identifier hs-var">ml_hs_file</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe String
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Maybe String) -&gt; String -&gt; Maybe String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201112"><span class="hs-identifier hs-var">basename</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><a href="../../filepath/src/System.FilePath.Windows.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201111"><span class="hs-identifier hs-var">suff</span></a></span><span>
</span><span id="line-1633"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ml_hi_file :: String
</span><a href="GHC.Unit.Module.Location.html#ml_hi_file"><span class="hs-identifier hs-var">ml_hi_file</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModLocation -&gt; String
</span><a href="GHC.Unit.Module.Location.html#ml_hi_file"><span class="hs-identifier hs-var hs-var">ml_hi_file</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681201109"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><a href="../../filepath/src/System.FilePath.Windows.html#-%3C.%3E"><span class="hs-operator hs-var">-&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; String
</span><a href="GHC.Driver.Session.html#hiSuf"><span class="hs-identifier hs-var hs-var">hiSuf</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201113"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1634"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ml_obj_file :: String
</span><a href="GHC.Unit.Module.Location.html#ml_obj_file"><span class="hs-identifier hs-var">ml_obj_file</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModLocation -&gt; String
</span><a href="GHC.Unit.Module.Location.html#ml_obj_file"><span class="hs-identifier hs-var hs-var">ml_obj_file</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681201109"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><a href="../../filepath/src/System.FilePath.Windows.html#-%3C.%3E"><span class="hs-operator hs-var">-&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; String
</span><a href="GHC.Driver.Session.html#objectSuf"><span class="hs-identifier hs-var hs-var">objectSuf</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201113"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1635"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-1636"></span><span>      </span><span class="annot"><span class="annottext">Maybe ModLocation
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1637"></span><span>        </span><span id="local-6989586621681201106"><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681201106"><span class="hs-identifier hs-var">location1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ModLocation -&gt; CompPipeline ModLocation
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ModLocation -&gt; CompPipeline ModLocation)
-&gt; IO ModLocation -&gt; CompPipeline ModLocation
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; ModuleName -&gt; String -&gt; String -&gt; IO ModLocation
</span><a href="GHC.Driver.Finder.html#mkHomeModLocation2"><span class="hs-identifier hs-var">mkHomeModLocation2</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201113"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681201114"><span class="hs-identifier hs-var">mod_name</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201112"><span class="hs-identifier hs-var">basename</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201111"><span class="hs-identifier hs-var">suff</span></a></span><span>
</span><span id="line-1638"></span><span>
</span><span id="line-1639"></span><span>        </span><span class="hs-comment">-- Boot-ify it if necessary</span><span>
</span><span id="line-1640"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201104"><span class="annot"><span class="annottext">location2 :: ModLocation
</span><a href="#local-6989586621681201104"><span class="hs-identifier hs-var hs-var">location2</span></a></span></span><span>
</span><span id="line-1641"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="GHC.Driver.Phases.html#HsBootFile"><span class="hs-identifier hs-var">HsBootFile</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621681201115"><span class="hs-identifier hs-var">src_flavour</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModLocation -&gt; ModLocation
</span><a href="GHC.Unit.Module.Location.html#addBootSuffixLocnOut"><span class="hs-identifier hs-var">addBootSuffixLocnOut</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681201106"><span class="hs-identifier hs-var">location1</span></a></span><span>
</span><span id="line-1642"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681201106"><span class="hs-identifier hs-var">location1</span></a></span><span>
</span><span id="line-1643"></span><span>
</span><span id="line-1644"></span><span>
</span><span id="line-1645"></span><span>        </span><span class="hs-comment">-- Take -ohi into account if present</span><span>
</span><span id="line-1646"></span><span>        </span><span class="hs-comment">-- This can't be done in mkHomeModuleLocation because</span><span>
</span><span id="line-1647"></span><span>        </span><span class="hs-comment">-- it only applies to the module being compiles</span><span>
</span><span id="line-1648"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201101"><span class="annot"><span class="annottext">ohi :: Maybe String
</span><a href="#local-6989586621681201101"><span class="hs-identifier hs-var hs-var">ohi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Maybe String
</span><a href="GHC.Driver.Session.html#outputHi"><span class="hs-identifier hs-var hs-var">outputHi</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201113"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1649"></span><span>            </span><span id="local-6989586621681201099"><span class="annot"><span class="annottext">location3 :: ModLocation
</span><a href="#local-6989586621681201099"><span class="hs-identifier hs-var hs-var">location3</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681201098"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201098"><span class="hs-identifier hs-var">fn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621681201101"><span class="hs-identifier hs-var">ohi</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681201104"><span class="hs-identifier hs-var">location2</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ml_hi_file :: String
</span><a href="GHC.Unit.Module.Location.html#ml_hi_file"><span class="hs-identifier hs-var">ml_hi_file</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201098"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1650"></span><span>                      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681201104"><span class="hs-identifier hs-var">location2</span></a></span><span>
</span><span id="line-1651"></span><span>
</span><span id="line-1652"></span><span>        </span><span class="hs-comment">-- Take -o into account if present</span><span>
</span><span id="line-1653"></span><span>        </span><span class="hs-comment">-- Very like -ohi, but we must *only* do this if we aren't linking</span><span>
</span><span id="line-1654"></span><span>        </span><span class="hs-comment">-- (If we're linking then the -o applies to the linked thing, not to</span><span>
</span><span id="line-1655"></span><span>        </span><span class="hs-comment">-- the object file for one module.)</span><span>
</span><span id="line-1656"></span><span>        </span><span class="hs-comment">-- Note the nasty duplication with the same computation in compileFile</span><span>
</span><span id="line-1657"></span><span>        </span><span class="hs-comment">-- above</span><span>
</span><span id="line-1658"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201097"><span class="annot"><span class="annottext">expl_o_file :: Maybe String
</span><a href="#local-6989586621681201097"><span class="hs-identifier hs-var hs-var">expl_o_file</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Maybe String
</span><a href="GHC.Driver.Session.html#outputFile"><span class="hs-identifier hs-var hs-var">outputFile</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201113"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1659"></span><span>            </span><span id="local-6989586621681201096"><span class="annot"><span class="annottext">location4 :: ModLocation
</span><a href="#local-6989586621681201096"><span class="hs-identifier hs-var hs-var">location4</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681201095"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201095"><span class="hs-identifier hs-var">ofile</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621681201097"><span class="hs-identifier hs-var">expl_o_file</span></a></span><span>
</span><span id="line-1660"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GhcLink -&gt; Bool
</span><a href="GHC.Driver.Session.html#isNoLink"><span class="hs-identifier hs-var">isNoLink</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; GhcLink
</span><a href="GHC.Driver.Session.html#ghcLink"><span class="hs-identifier hs-var hs-var">ghcLink</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201113"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1661"></span><span>                      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681201099"><span class="hs-identifier hs-var">location3</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ml_obj_file :: String
</span><a href="GHC.Unit.Module.Location.html#ml_obj_file"><span class="hs-identifier hs-var">ml_obj_file</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201095"><span class="hs-identifier hs-var">ofile</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1662"></span><span>                      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681201099"><span class="hs-identifier hs-var">location3</span></a></span><span>
</span><span id="line-1663"></span><span>        </span><span class="annot"><span class="annottext">ModLocation -&gt; CompPipeline ModLocation
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681201096"><span class="hs-identifier hs-var">location4</span></a></span><span>
</span><span id="line-1664"></span><span>
</span><span id="line-1665"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-1666"></span><span class="hs-comment">-- Look for the /* GHC_PACKAGES ... */ comment at the top of a .hc file</span><span>
</span><span id="line-1667"></span><span>
</span><span id="line-1668"></span><span class="annot"><a href="GHC.Driver.Pipeline.html#getHCFilePackages"><span class="hs-identifier hs-type">getHCFilePackages</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1669"></span><span id="getHCFilePackages"><span class="annot"><span class="annottext">getHCFilePackages :: String -&gt; IO [UnitId]
</span><a href="GHC.Driver.Pipeline.html#getHCFilePackages"><span class="hs-identifier hs-var hs-var">getHCFilePackages</span></a></span></span><span> </span><span id="local-6989586621681201094"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201094"><span class="hs-identifier hs-var">filename</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1670"></span><span>  </span><span class="annot"><span class="annottext">IO Handle
-&gt; (Handle -&gt; IO ()) -&gt; (Handle -&gt; IO [UnitId]) -&gt; IO [UnitId]
forall a b c. IO a -&gt; (a -&gt; IO b) -&gt; (a -&gt; IO c) -&gt; IO c
</span><a href="../../base/src/Control.Exception.Base.html#bracket"><span class="hs-identifier hs-var">Exception.bracket</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; IOMode -&gt; IO Handle
</span><a href="../../base/src/GHC.IO.StdHandles.html#openFile"><span class="hs-identifier hs-var">openFile</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201094"><span class="hs-identifier hs-var">filename</span></a></span><span> </span><span class="annot"><span class="annottext">IOMode
</span><a href="../../base/src/GHC.IO.IOMode.html#ReadMode"><span class="hs-identifier hs-var">ReadMode</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Handle -&gt; IO ()
</span><a href="../../base/src/GHC.IO.Handle.html#hClose"><span class="hs-identifier hs-var">hClose</span></a></span><span> </span><span class="annot"><span class="annottext">((Handle -&gt; IO [UnitId]) -&gt; IO [UnitId])
-&gt; (Handle -&gt; IO [UnitId]) -&gt; IO [UnitId]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681201090"><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621681201090"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1671"></span><span>    </span><span id="local-6989586621681201089"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201089"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Handle -&gt; IO String
</span><a href="../../base/src/GHC.IO.Handle.Text.html#hGetLine"><span class="hs-identifier hs-var">hGetLine</span></a></span><span> </span><span class="annot"><span class="annottext">Handle
</span><a href="#local-6989586621681201090"><span class="hs-identifier hs-var">h</span></a></span><span>
</span><span id="line-1672"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201089"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1673"></span><span>      </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'/'</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'*'</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">' '</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'G'</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'H'</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'C'</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'_'</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'P'</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'A'</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'C'</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'K'</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'A'</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'G'</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'E'</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'S'</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681201087"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201087"><span class="hs-identifier hs-var">rest</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1674"></span><span>          </span><span class="annot"><span class="annottext">[UnitId] -&gt; IO [UnitId]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String -&gt; UnitId) -&gt; [String] -&gt; [UnitId]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; UnitId
</span><a href="GHC.Unit.Types.html#stringToUnitId"><span class="hs-identifier hs-var">stringToUnitId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; [String]
</span><a href="../../base/src/Data.OldList.html#words"><span class="hs-identifier hs-var">words</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201087"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1675"></span><span>      </span><span id="local-6989586621681201085"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201085"><span class="hs-identifier hs-var">_other</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1676"></span><span>          </span><span class="annot"><span class="annottext">[UnitId] -&gt; IO [UnitId]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1677"></span><span>
</span><span id="line-1678"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-1679"></span><span class="hs-comment">-- Static linking, of .o files</span><span>
</span><span id="line-1680"></span><span>
</span><span id="line-1681"></span><span class="hs-comment">-- The list of packages passed to link is the list of packages on</span><span>
</span><span id="line-1682"></span><span class="hs-comment">-- which this program depends, as discovered by the compilation</span><span>
</span><span id="line-1683"></span><span class="hs-comment">-- manager.  It is combined with the list of packages that the user</span><span>
</span><span id="line-1684"></span><span class="hs-comment">-- specifies on the command line with -package flags.</span><span>
</span><span id="line-1685"></span><span class="hs-comment">--</span><span>
</span><span id="line-1686"></span><span class="hs-comment">-- In one-shot linking mode, we can't discover the package</span><span>
</span><span id="line-1687"></span><span class="hs-comment">-- dependencies (because we haven't actually done any compilation or</span><span>
</span><span id="line-1688"></span><span class="hs-comment">-- read any interface files), so the user must explicitly specify all</span><span>
</span><span id="line-1689"></span><span class="hs-comment">-- the packages.</span><span>
</span><span id="line-1690"></span><span>
</span><span id="line-1691"></span><span class="hs-comment">{-
Note [-Xlinker -rpath vs -Wl,-rpath]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

-Wl takes a comma-separated list of options which in the case of
-Wl,-rpath -Wl,some,path,with,commas parses the path with commas
as separate options.
Buck, the build system, produces paths with commas in them.

-Xlinker doesn't have this disadvantage and as far as I can tell
it is supported by both gcc and clang. Anecdotally nvcc supports
-Xlinker, but not -Wl.
-}</span><span>
</span><span id="line-1704"></span><span>
</span><span id="line-1705"></span><span class="annot"><a href="GHC.Driver.Pipeline.html#linkBinary"><span class="hs-identifier hs-type">linkBinary</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../base/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1706"></span><span id="linkBinary"><span class="annot"><span class="annottext">linkBinary :: DynFlags -&gt; [String] -&gt; [UnitId] -&gt; IO ()
</span><a href="GHC.Driver.Pipeline.html#linkBinary"><span class="hs-identifier hs-var hs-var">linkBinary</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; DynFlags -&gt; [String] -&gt; [UnitId] -&gt; IO ()
</span><a href="GHC.Driver.Pipeline.html#linkBinary%27"><span class="hs-identifier hs-var">linkBinary'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1707"></span><span>
</span><span id="line-1708"></span><span class="annot"><a href="GHC.Driver.Pipeline.html#linkBinary%27"><span class="hs-identifier hs-type">linkBinary'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../base/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1709"></span><span id="linkBinary%27"><span class="annot"><span class="annottext">linkBinary' :: Bool -&gt; DynFlags -&gt; [String] -&gt; [UnitId] -&gt; IO ()
</span><a href="GHC.Driver.Pipeline.html#linkBinary%27"><span class="hs-identifier hs-var hs-var">linkBinary'</span></a></span></span><span> </span><span id="local-6989586621681201083"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681201083"><span class="hs-identifier hs-var">staticLink</span></a></span></span><span> </span><span id="local-6989586621681201082"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201082"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621681201081"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201081"><span class="hs-identifier hs-var">o_files</span></a></span></span><span> </span><span id="local-6989586621681201080"><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681201080"><span class="hs-identifier hs-var">dep_units</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1710"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201079"><span class="annot"><span class="annottext">platform :: Platform
</span><a href="#local-6989586621681201079"><span class="hs-identifier hs-var hs-var">platform</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.Session.html#targetPlatform"><span class="hs-identifier hs-var hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201082"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1711"></span><span>        </span><span id="local-6989586621681201078"><span class="annot"><span class="annottext">toolSettings' :: ToolSettings
</span><a href="#local-6989586621681201078"><span class="hs-identifier hs-var hs-var">toolSettings'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; ToolSettings
</span><a href="GHC.Driver.Session.html#toolSettings"><span class="hs-identifier hs-var hs-var">toolSettings</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201082"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1712"></span><span>        </span><span id="local-6989586621681201076"><span class="annot"><span class="annottext">verbFlags :: [String]
</span><a href="#local-6989586621681201076"><span class="hs-identifier hs-var hs-var">verbFlags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [String]
</span><a href="GHC.Driver.Session.html#getVerbFlags"><span class="hs-identifier hs-var">getVerbFlags</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201082"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1713"></span><span>        </span><span id="local-6989586621681201075"><span class="annot"><span class="annottext">output_fn :: String
</span><a href="#local-6989586621681201075"><span class="hs-identifier hs-var hs-var">output_fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; DynFlags -&gt; String
</span><a href="GHC.Driver.Pipeline.html#exeFileName"><span class="hs-identifier hs-var">exeFileName</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681201083"><span class="hs-identifier hs-var">staticLink</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201082"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1714"></span><span>
</span><span id="line-1715"></span><span>    </span><span class="hs-comment">-- get the full list of packages to link with, by combining the</span><span>
</span><span id="line-1716"></span><span>    </span><span class="hs-comment">-- explicit packages with the auto packages and all of their</span><span>
</span><span id="line-1717"></span><span>    </span><span class="hs-comment">-- dependencies, and eliminating duplicates.</span><span>
</span><span id="line-1718"></span><span>
</span><span id="line-1719"></span><span>    </span><span id="local-6989586621681201074"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201074"><span class="hs-identifier hs-var">full_output_fn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">String -&gt; Bool
</span><a href="../../filepath/src/System.FilePath.Windows.html#isAbsolute"><span class="hs-identifier hs-var">isAbsolute</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201075"><span class="hs-identifier hs-var">output_fn</span></a></span><span>
</span><span id="line-1720"></span><span>                      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO String
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201075"><span class="hs-identifier hs-var">output_fn</span></a></span><span>
</span><span id="line-1721"></span><span>                      </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621681201072"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201072"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO String
</span><a href="../../directory/src/System.Directory.html#getCurrentDirectory"><span class="hs-identifier hs-var">getCurrentDirectory</span></a></span><span>
</span><span id="line-1722"></span><span>                              </span><span class="annot"><span class="annottext">String -&gt; IO String
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO String) -&gt; String -&gt; IO String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String
</span><a href="../../filepath/src/System.FilePath.Windows.html#normalise"><span class="hs-identifier hs-var">normalise</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201072"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><a href="../../filepath/src/System.FilePath.Windows.html#%3C%2F%3E"><span class="hs-operator hs-var">&lt;/&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201075"><span class="hs-identifier hs-var">output_fn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1723"></span><span>    </span><span id="local-6989586621681201069"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201069"><span class="hs-identifier hs-var">pkg_lib_paths</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [UnitId] -&gt; IO [String]
</span><a href="GHC.Unit.State.html#getUnitLibraryPath"><span class="hs-identifier hs-var">getUnitLibraryPath</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201082"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681201080"><span class="hs-identifier hs-var">dep_units</span></a></span><span>
</span><span id="line-1724"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201066"><span class="annot"><span class="annottext">pkg_lib_path_opts :: [String]
</span><a href="#local-6989586621681201066"><span class="hs-identifier hs-var hs-var">pkg_lib_path_opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(String -&gt; [String]) -&gt; [String] -&gt; [String]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><a href="../../base/src/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String]
</span><a href="#local-6989586621681201065"><span class="hs-identifier hs-var">get_pkg_lib_path_opts</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201069"><span class="hs-identifier hs-var">pkg_lib_paths</span></a></span><span>
</span><span id="line-1725"></span><span>        </span><span id="local-6989586621681201065"><span class="annot"><span class="annottext">get_pkg_lib_path_opts :: String -&gt; [String]
</span><a href="#local-6989586621681201065"><span class="hs-identifier hs-var hs-var">get_pkg_lib_path_opts</span></a></span></span><span> </span><span id="local-6989586621681201057"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201057"><span class="hs-identifier hs-var">l</span></a></span></span><span>
</span><span id="line-1726"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">OS -&gt; Bool
</span><a href="../../ghc-boot/src/GHC.Platform.html#osElfTarget"><span class="hs-identifier hs-var">osElfTarget</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; OS
</span><a href="../../ghc-boot/src/GHC.Platform.html#platformOS"><span class="hs-identifier hs-var">platformOS</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681201079"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-1727"></span><span>           </span><span class="annot"><span class="annottext">DynFlags -&gt; DynLibLoader
</span><a href="GHC.Driver.Session.html#dynLibLoader"><span class="hs-identifier hs-var hs-var">dynLibLoader</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201082"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">DynLibLoader -&gt; DynLibLoader -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">DynLibLoader
</span><a href="GHC.Driver.Session.html#SystemDependent"><span class="hs-identifier hs-var">SystemDependent</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-1728"></span><span>           </span><span class="annot"><span class="annottext">Way
</span><a href="GHC.Driver.Ways.html#WayDyn"><span class="hs-identifier hs-var">WayDyn</span></a></span><span> </span><span class="annot"><span class="annottext">Way -&gt; Set Way -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#elem"><span class="hs-operator hs-var">`elem`</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Set Way
</span><a href="GHC.Driver.Session.html#ways"><span class="hs-identifier hs-var hs-var">ways</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201082"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1729"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201053"><span class="annot"><span class="annottext">libpath :: String
</span><a href="#local-6989586621681201053"><span class="hs-identifier hs-var hs-var">libpath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_RelativeDynlibPaths"><span class="hs-identifier hs-var">Opt_RelativeDynlibPaths</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201082"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1730"></span><span>                            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;$ORIGIN&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><a href="../../filepath/src/System.FilePath.Windows.html#%3C%2F%3E"><span class="hs-operator hs-var">&lt;/&gt;</span></a></span><span>
</span><span id="line-1731"></span><span>                                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201057"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><a href="GHC.Utils.Misc.html#makeRelativeTo"><span class="hs-operator hs-var">`makeRelativeTo`</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201074"><span class="hs-identifier hs-var">full_output_fn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1732"></span><span>                            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201057"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-1733"></span><span>                  </span><span class="hs-comment">-- See Note [-Xlinker -rpath vs -Wl,-rpath]</span><span>
</span><span id="line-1734"></span><span>                  </span><span id="local-6989586621681201050"><span class="annot"><span class="annottext">rpath :: [String]
</span><a href="#local-6989586621681201050"><span class="hs-identifier hs-var hs-var">rpath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; OS -&gt; Bool
</span><a href="GHC.Driver.Session.html#useXLinkerRPath"><span class="hs-identifier hs-var">useXLinkerRPath</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201082"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; OS
</span><a href="../../ghc-boot/src/GHC.Platform.html#platformOS"><span class="hs-identifier hs-var">platformOS</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681201079"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1735"></span><span>                          </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-Xlinker&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-rpath&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-Xlinker&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201053"><span class="hs-identifier hs-var">libpath</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1736"></span><span>                          </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1737"></span><span>                  </span><span class="hs-comment">-- Solaris 11's linker does not support -rpath-link option. It silently</span><span>
</span><span id="line-1738"></span><span>                  </span><span class="hs-comment">-- ignores it and then complains about next option which is -l&lt;some</span><span>
</span><span id="line-1739"></span><span>                  </span><span class="hs-comment">-- dir&gt; as being a directory and not expected object file, E.g</span><span>
</span><span id="line-1740"></span><span>                  </span><span class="hs-comment">-- ld: elf error: file</span><span>
</span><span id="line-1741"></span><span>                  </span><span class="hs-comment">-- /tmp/ghc-src/libraries/base/dist-install/build:</span><span>
</span><span id="line-1742"></span><span>                  </span><span class="hs-comment">-- elf_begin: I/O error: region read: Is a directory</span><span>
</span><span id="line-1743"></span><span>                  </span><span id="local-6989586621681201047"><span class="annot"><span class="annottext">rpathlink :: [String]
</span><a href="#local-6989586621681201047"><span class="hs-identifier hs-var hs-var">rpathlink</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; OS
</span><a href="../../ghc-boot/src/GHC.Platform.html#platformOS"><span class="hs-identifier hs-var">platformOS</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681201079"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OS -&gt; OS -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="../../ghc-boot/src/GHC.Platform.html#OSSolaris2"><span class="hs-identifier hs-var">OSSolaris2</span></a></span><span>
</span><span id="line-1744"></span><span>                              </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1745"></span><span>                              </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-Xlinker&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-rpath-link&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-Xlinker&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201057"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1746"></span><span>              </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-L&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201057"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201047"><span class="hs-identifier hs-var">rpathlink</span></a></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201050"><span class="hs-identifier hs-var">rpath</span></a></span><span>
</span><span id="line-1747"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">OS -&gt; Bool
</span><a href="../../ghc-boot/src/GHC.Platform.html#osMachOTarget"><span class="hs-identifier hs-var">osMachOTarget</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; OS
</span><a href="../../ghc-boot/src/GHC.Platform.html#platformOS"><span class="hs-identifier hs-var">platformOS</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681201079"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-1748"></span><span>           </span><span class="annot"><span class="annottext">DynFlags -&gt; DynLibLoader
</span><a href="GHC.Driver.Session.html#dynLibLoader"><span class="hs-identifier hs-var hs-var">dynLibLoader</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201082"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">DynLibLoader -&gt; DynLibLoader -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">DynLibLoader
</span><a href="GHC.Driver.Session.html#SystemDependent"><span class="hs-identifier hs-var">SystemDependent</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-1749"></span><span>           </span><span class="annot"><span class="annottext">Way
</span><a href="GHC.Driver.Ways.html#WayDyn"><span class="hs-identifier hs-var">WayDyn</span></a></span><span> </span><span class="annot"><span class="annottext">Way -&gt; Set Way -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#elem"><span class="hs-operator hs-var">`elem`</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Set Way
</span><a href="GHC.Driver.Session.html#ways"><span class="hs-identifier hs-var hs-var">ways</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201082"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-1750"></span><span>           </span><span class="annot"><span class="annottext">DynFlags -&gt; OS -&gt; Bool
</span><a href="GHC.Driver.Session.html#useXLinkerRPath"><span class="hs-identifier hs-var">useXLinkerRPath</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201082"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; OS
</span><a href="../../ghc-boot/src/GHC.Platform.html#platformOS"><span class="hs-identifier hs-var">platformOS</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681201079"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1751"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201044"><span class="annot"><span class="annottext">libpath :: String
</span><a href="#local-6989586621681201044"><span class="hs-identifier hs-var hs-var">libpath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_RelativeDynlibPaths"><span class="hs-identifier hs-var">Opt_RelativeDynlibPaths</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201082"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1752"></span><span>                            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;@loader_path&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><a href="../../filepath/src/System.FilePath.Windows.html#%3C%2F%3E"><span class="hs-operator hs-var">&lt;/&gt;</span></a></span><span>
</span><span id="line-1753"></span><span>                                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201057"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><a href="GHC.Utils.Misc.html#makeRelativeTo"><span class="hs-operator hs-var">`makeRelativeTo`</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201074"><span class="hs-identifier hs-var">full_output_fn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1754"></span><span>                            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201057"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-1755"></span><span>              </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-L&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201057"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-Xlinker&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-rpath&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-Xlinker&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201044"><span class="hs-identifier hs-var">libpath</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1756"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-L&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201057"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1757"></span><span>
</span><span id="line-1758"></span><span>    </span><span id="local-6989586621681201043"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201043"><span class="hs-identifier hs-var">pkg_lib_path_opts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1759"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_SingleLibFolder"><span class="hs-identifier hs-var">Opt_SingleLibFolder</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201082"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1760"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1761"></span><span>        </span><span id="local-6989586621681201041"><span class="annot"><span class="annottext">[(String, String)]
</span><a href="#local-6989586621681201041"><span class="hs-identifier hs-var">libs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [UnitId] -&gt; IO [(String, String)]
</span><a href="GHC.Unit.State.html#getLibs"><span class="hs-identifier hs-var">getLibs</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201082"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681201080"><span class="hs-identifier hs-var">dep_units</span></a></span><span>
</span><span id="line-1762"></span><span>        </span><span id="local-6989586621681201039"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201039"><span class="hs-identifier hs-var">tmpDir</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; IO String
</span><a href="GHC.SysTools.FileCleanup.html#newTempDir"><span class="hs-identifier hs-var">newTempDir</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201082"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1763"></span><span>        </span><span class="annot"><span class="annottext">[IO ()] -&gt; IO ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Foldable t, Monad m) =&gt;
t (m a) -&gt; m ()
</span><a href="../../base/src/Data.Foldable.html#sequence_"><span class="hs-identifier hs-var">sequence_</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; IO ()
</span><a href="../../directory/src/System.Directory.html#copyFile"><span class="hs-identifier hs-var">copyFile</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201035"><span class="hs-identifier hs-var">lib</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201039"><span class="hs-identifier hs-var">tmpDir</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><a href="../../filepath/src/System.FilePath.Windows.html#%3C%2F%3E"><span class="hs-operator hs-var">&lt;/&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201034"><span class="hs-identifier hs-var">basename</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1764"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681201035"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201035"><span class="hs-identifier hs-var">lib</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681201034"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201034"><span class="hs-identifier hs-var">basename</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(String, String)]
</span><a href="#local-6989586621681201041"><span class="hs-identifier hs-var">libs</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1765"></span><span>        </span><span class="annot"><span class="annottext">[String] -&gt; IO [String]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-L&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201039"><span class="hs-identifier hs-var">tmpDir</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1766"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; IO [String]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201066"><span class="hs-identifier hs-var">pkg_lib_path_opts</span></a></span><span>
</span><span id="line-1767"></span><span>
</span><span id="line-1768"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-1769"></span><span>      </span><span id="local-6989586621681201033"><span class="annot"><span class="annottext">dead_strip :: [String]
</span><a href="#local-6989586621681201033"><span class="hs-identifier hs-var hs-var">dead_strip</span></a></span></span><span>
</span><span id="line-1770"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_WholeArchiveHsLibs"><span class="hs-identifier hs-var">Opt_WholeArchiveHsLibs</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201082"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1771"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">OS -&gt; Bool
</span><a href="../../ghc-boot/src/GHC.Platform.html#osSubsectionsViaSymbols"><span class="hs-identifier hs-var">osSubsectionsViaSymbols</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; OS
</span><a href="../../ghc-boot/src/GHC.Platform.html#platformOS"><span class="hs-identifier hs-var">platformOS</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681201079"><span class="hs-identifier hs-var">platform</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1772"></span><span>                        </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-Wl,-dead_strip&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-1773"></span><span>                        </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1774"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201030"><span class="annot"><span class="annottext">lib_paths :: [String]
</span><a href="#local-6989586621681201030"><span class="hs-identifier hs-var hs-var">lib_paths</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [String]
</span><a href="GHC.Driver.Session.html#libraryPaths"><span class="hs-identifier hs-var hs-var">libraryPaths</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201082"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1775"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201028"><span class="annot"><span class="annottext">lib_path_opts :: [String]
</span><a href="#local-6989586621681201028"><span class="hs-identifier hs-var hs-var">lib_path_opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(String -&gt; String) -&gt; [String] -&gt; [String]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-L&quot;</span></span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201030"><span class="hs-identifier hs-var">lib_paths</span></a></span><span>
</span><span id="line-1776"></span><span>
</span><span id="line-1777"></span><span>    </span><span id="local-6989586621681201027"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201027"><span class="hs-identifier hs-var">extraLinkObj</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; IO String
</span><a href="GHC.SysTools.ExtraObj.html#mkExtraObjToLinkIntoBinary"><span class="hs-identifier hs-var">mkExtraObjToLinkIntoBinary</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201082"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1778"></span><span>    </span><span id="local-6989586621681201025"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201025"><span class="hs-identifier hs-var">noteLinkObjs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [UnitId] -&gt; IO [String]
</span><a href="GHC.SysTools.ExtraObj.html#mkNoteObjsToLinkIntoBinary"><span class="hs-identifier hs-var">mkNoteObjsToLinkIntoBinary</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201082"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681201080"><span class="hs-identifier hs-var">dep_units</span></a></span><span>
</span><span id="line-1779"></span><span>
</span><span id="line-1780"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-1781"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621681201022"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201022"><span class="hs-identifier hs-var">pre_hs_libs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681201021"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201021"><span class="hs-identifier hs-var">post_hs_libs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1782"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_WholeArchiveHsLibs"><span class="hs-identifier hs-var">Opt_WholeArchiveHsLibs</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201082"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1783"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; OS
</span><a href="../../ghc-boot/src/GHC.Platform.html#platformOS"><span class="hs-identifier hs-var">platformOS</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681201079"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">OS -&gt; OS -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="../../ghc-boot/src/GHC.Platform.html#OSDarwin"><span class="hs-identifier hs-var">OSDarwin</span></a></span><span>
</span><span id="line-1784"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-Wl,-all_load&quot;</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1785"></span><span>              </span><span class="hs-comment">-- OS X does not have a flag to turn off -all_load</span><span>
</span><span id="line-1786"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-Wl,--whole-archive&quot;</span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-Wl,--no-whole-archive&quot;</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1787"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1788"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1789"></span><span>
</span><span id="line-1790"></span><span>    </span><span id="local-6989586621681201020"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201020"><span class="hs-identifier hs-var">pkg_link_opts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1791"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621681201019"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201019"><span class="hs-identifier hs-var">package_hs_libs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681201018"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201018"><span class="hs-identifier hs-var">extra_libs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681201017"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201017"><span class="hs-identifier hs-var">other_flags</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [UnitId] -&gt; IO ([String], [String], [String])
</span><a href="GHC.Unit.State.html#getUnitLinkOpts"><span class="hs-identifier hs-var">getUnitLinkOpts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201082"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681201080"><span class="hs-identifier hs-var">dep_units</span></a></span><span>
</span><span id="line-1792"></span><span>        </span><span class="annot"><span class="annottext">[String] -&gt; IO [String]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; IO [String]) -&gt; [String] -&gt; IO [String]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681201083"><span class="hs-identifier hs-var">staticLink</span></a></span><span>
</span><span id="line-1793"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201019"><span class="hs-identifier hs-var">package_hs_libs</span></a></span><span> </span><span class="hs-comment">-- If building an executable really means making a static</span><span>
</span><span id="line-1794"></span><span>                                 </span><span class="hs-comment">-- library (e.g. iOS), then we only keep the -l options for</span><span>
</span><span id="line-1795"></span><span>                                 </span><span class="hs-comment">-- HS packages, because libtool doesn't accept other options.</span><span>
</span><span id="line-1796"></span><span>                                 </span><span class="hs-comment">-- In the case of iOS these need to be added by hand to the</span><span>
</span><span id="line-1797"></span><span>                                 </span><span class="hs-comment">-- final link in Xcode.</span><span>
</span><span id="line-1798"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201017"><span class="hs-identifier hs-var">other_flags</span></a></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201033"><span class="hs-identifier hs-var">dead_strip</span></a></span><span>
</span><span id="line-1799"></span><span>                  </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201022"><span class="hs-identifier hs-var">pre_hs_libs</span></a></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201019"><span class="hs-identifier hs-var">package_hs_libs</span></a></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201021"><span class="hs-identifier hs-var">post_hs_libs</span></a></span><span>
</span><span id="line-1800"></span><span>                  </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201018"><span class="hs-identifier hs-var">extra_libs</span></a></span><span>
</span><span id="line-1801"></span><span>                 </span><span class="hs-comment">-- -Wl,-u,&lt;sym&gt; contained in other_flags</span><span>
</span><span id="line-1802"></span><span>                 </span><span class="hs-comment">-- needs to be put before -l&lt;package&gt;,</span><span>
</span><span id="line-1803"></span><span>                 </span><span class="hs-comment">-- otherwise Solaris linker fails linking</span><span>
</span><span id="line-1804"></span><span>                 </span><span class="hs-comment">-- a binary with unresolved symbols in RTS</span><span>
</span><span id="line-1805"></span><span>                 </span><span class="hs-comment">-- which are defined in base package</span><span>
</span><span id="line-1806"></span><span>                 </span><span class="hs-comment">-- the reason for this is a note in ld(1) about</span><span>
</span><span id="line-1807"></span><span>                 </span><span class="hs-comment">-- '-u' option: &quot;The placement of this option</span><span>
</span><span id="line-1808"></span><span>                 </span><span class="hs-comment">-- on the command line is significant.</span><span>
</span><span id="line-1809"></span><span>                 </span><span class="hs-comment">-- This option must be placed before the library</span><span>
</span><span id="line-1810"></span><span>                 </span><span class="hs-comment">-- that defines the symbol.&quot;</span><span>
</span><span id="line-1811"></span><span>
</span><span id="line-1812"></span><span>    </span><span class="hs-comment">-- frameworks</span><span>
</span><span id="line-1813"></span><span>    </span><span id="local-6989586621681201015"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201015"><span class="hs-identifier hs-var">pkg_framework_opts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Platform -&gt; [UnitId] -&gt; IO [String]
</span><a href="GHC.SysTools.html#getUnitFrameworkOpts"><span class="hs-identifier hs-var">getUnitFrameworkOpts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201082"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681201079"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681201080"><span class="hs-identifier hs-var">dep_units</span></a></span><span>
</span><span id="line-1814"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201013"><span class="annot"><span class="annottext">framework_opts :: [String]
</span><a href="#local-6989586621681201013"><span class="hs-identifier hs-var hs-var">framework_opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Platform -&gt; [String]
</span><a href="GHC.SysTools.html#getFrameworkOpts"><span class="hs-identifier hs-var">getFrameworkOpts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201082"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681201079"><span class="hs-identifier hs-var">platform</span></a></span><span>
</span><span id="line-1815"></span><span>
</span><span id="line-1816"></span><span>        </span><span class="hs-comment">-- probably _stub.o files</span><span>
</span><span id="line-1817"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201011"><span class="annot"><span class="annottext">extra_ld_inputs :: [Option]
</span><a href="#local-6989586621681201011"><span class="hs-identifier hs-var hs-var">extra_ld_inputs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [Option]
</span><a href="GHC.Driver.Session.html#ldInputs"><span class="hs-identifier hs-var hs-var">ldInputs</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201082"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1818"></span><span>
</span><span id="line-1819"></span><span>    </span><span id="local-6989586621681201010"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201010"><span class="hs-identifier hs-var">rc_objs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; String -&gt; IO [String]
</span><a href="GHC.Driver.Pipeline.html#maybeCreateManifest"><span class="hs-identifier hs-var">maybeCreateManifest</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201082"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201075"><span class="hs-identifier hs-var">output_fn</span></a></span><span>
</span><span id="line-1820"></span><span>
</span><span id="line-1821"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681201007"><span class="annot"><span class="annottext">link :: DynFlags -&gt; [Option] -&gt; IO ()
</span><a href="#local-6989586621681201007"><span class="hs-identifier hs-var hs-var">link</span></a></span></span><span> </span><span id="local-6989586621681201006"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201006"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621681201005"><span class="annot"><span class="annottext">[Option]
</span><a href="#local-6989586621681201005"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681201083"><span class="hs-identifier hs-var">staticLink</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [Option] -&gt; IO ()
</span><a href="GHC.SysTools.Tasks.html#runLibtool"><span class="hs-identifier hs-var">GHC.SysTools.runLibtool</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201006"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">[Option]
</span><a href="#local-6989586621681201005"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1822"></span><span>                         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; OS
</span><a href="../../ghc-boot/src/GHC.Platform.html#platformOS"><span class="hs-identifier hs-var">platformOS</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681201079"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">OS -&gt; OS -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="../../ghc-boot/src/GHC.Platform.html#OSDarwin"><span class="hs-identifier hs-var">OSDarwin</span></a></span><span>
</span><span id="line-1823"></span><span>                            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [Option] -&gt; IO ()
</span><a href="GHC.SysTools.Tasks.html#runLink"><span class="hs-identifier hs-var">GHC.SysTools.runLink</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201006"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">[Option]
</span><a href="#local-6989586621681201005"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO () -&gt; IO ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><a href="../../base/src/GHC.Base.html#%3E%3E"><span class="hs-operator hs-var">&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [String] -&gt; String -&gt; IO ()
</span><a href="GHC.SysTools.Tasks.html#runInjectRPaths"><span class="hs-identifier hs-var">GHC.SysTools.runInjectRPaths</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201006"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201069"><span class="hs-identifier hs-var">pkg_lib_paths</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201075"><span class="hs-identifier hs-var">output_fn</span></a></span><span>
</span><span id="line-1824"></span><span>                         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1825"></span><span>                            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [Option] -&gt; IO ()
</span><a href="GHC.SysTools.Tasks.html#runLink"><span class="hs-identifier hs-var">GHC.SysTools.runLink</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201006"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">[Option]
</span><a href="#local-6989586621681201005"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1826"></span><span>
</span><span id="line-1827"></span><span>    </span><span class="annot"><span class="annottext">DynFlags -&gt; [Option] -&gt; IO ()
</span><a href="#local-6989586621681201007"><span class="hs-identifier hs-var">link</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201082"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-1828"></span><span>                       </span><span class="annot"><span class="annottext">(String -&gt; Option) -&gt; [String] -&gt; [Option]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201076"><span class="hs-identifier hs-var">verbFlags</span></a></span><span>
</span><span id="line-1829"></span><span>                      </span><span class="annot"><span class="annottext">[Option] -&gt; [Option] -&gt; [Option]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-o&quot;</span></span><span>
</span><span id="line-1830"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#FileOption"><span class="hs-identifier hs-var">GHC.SysTools.FileOption</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201075"><span class="hs-identifier hs-var">output_fn</span></a></span><span>
</span><span id="line-1831"></span><span>                         </span><span class="hs-special">]</span><span>
</span><span id="line-1832"></span><span>                      </span><span class="annot"><span class="annottext">[Option] -&gt; [Option] -&gt; [Option]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Option]
</span><a href="GHC.SysTools.html#libmLinkOpts"><span class="hs-identifier hs-var">libmLinkOpts</span></a></span><span>
</span><span id="line-1833"></span><span>                      </span><span class="annot"><span class="annottext">[Option] -&gt; [Option] -&gt; [Option]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Option) -&gt; [String] -&gt; [Option]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-1834"></span><span>                         </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1835"></span><span>
</span><span id="line-1836"></span><span>                      </span><span class="hs-comment">-- See Note [No PIE when linking]</span><span>
</span><span id="line-1837"></span><span>                      </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [String]
</span><a href="GHC.Driver.Session.html#picCCOpts"><span class="hs-identifier hs-var">picCCOpts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201082"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1838"></span><span>
</span><span id="line-1839"></span><span>                      </span><span class="hs-comment">-- Permit the linker to auto link _symbol to _imp_symbol.</span><span>
</span><span id="line-1840"></span><span>                      </span><span class="hs-comment">-- This lets us link against DLLs without needing an &quot;import library&quot;.</span><span>
</span><span id="line-1841"></span><span>                      </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; OS
</span><a href="../../ghc-boot/src/GHC.Platform.html#platformOS"><span class="hs-identifier hs-var">platformOS</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681201079"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">OS -&gt; OS -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="../../ghc-boot/src/GHC.Platform.html#OSMinGW32"><span class="hs-identifier hs-var">OSMinGW32</span></a></span><span>
</span><span id="line-1842"></span><span>                          </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-Wl,--enable-auto-import&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-1843"></span><span>                          </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1844"></span><span>
</span><span id="line-1845"></span><span>                      </span><span class="hs-comment">-- '-no_compact_unwind'</span><span>
</span><span id="line-1846"></span><span>                      </span><span class="hs-comment">-- C++/Objective-C exceptions cannot use optimised</span><span>
</span><span id="line-1847"></span><span>                      </span><span class="hs-comment">-- stack unwinding code. The optimised form is the</span><span>
</span><span id="line-1848"></span><span>                      </span><span class="hs-comment">-- default in Xcode 4 on at least x86_64, and</span><span>
</span><span id="line-1849"></span><span>                      </span><span class="hs-comment">-- without this flag we're also seeing warnings</span><span>
</span><span id="line-1850"></span><span>                      </span><span class="hs-comment">-- like</span><span>
</span><span id="line-1851"></span><span>                      </span><span class="hs-comment">--     ld: warning: could not create compact unwind for .LFB3: non-standard register 5 being saved in prolog</span><span>
</span><span id="line-1852"></span><span>                      </span><span class="hs-comment">-- on x86.</span><span>
</span><span id="line-1853"></span><span>                      </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">ToolSettings -&gt; Bool
</span><a href="GHC.Settings.html#toolSettings_ldSupportsCompactUnwind"><span class="hs-identifier hs-var hs-var">toolSettings_ldSupportsCompactUnwind</span></a></span><span> </span><span class="annot"><span class="annottext">ToolSettings
</span><a href="#local-6989586621681201078"><span class="hs-identifier hs-var">toolSettings'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-1854"></span><span>                             </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681201083"><span class="hs-identifier hs-var">staticLink</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-1855"></span><span>                             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; OS
</span><a href="../../ghc-boot/src/GHC.Platform.html#platformOS"><span class="hs-identifier hs-var">platformOS</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681201079"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">OS -&gt; OS -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="../../ghc-boot/src/GHC.Platform.html#OSDarwin"><span class="hs-identifier hs-var">OSDarwin</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-1856"></span><span>                             </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Arch
</span><a href="../../ghc-boot/src/GHC.Platform.html#platformArch"><span class="hs-identifier hs-var">platformArch</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681201079"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1857"></span><span>                               </span><span class="annot"><span class="annottext">Arch
</span><a href="../../ghc-boot/src/GHC.Platform.html#ArchX86"><span class="hs-identifier hs-var">ArchX86</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1858"></span><span>                               </span><span class="annot"><span class="annottext">Arch
</span><a href="../../ghc-boot/src/GHC.Platform.html#ArchX86_64"><span class="hs-identifier hs-var">ArchX86_64</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1859"></span><span>                               </span><span class="annot"><a href="../../ghc-boot/src/GHC.Platform.html#ArchARM"><span class="hs-identifier hs-type">ArchARM</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1860"></span><span>                               </span><span class="annot"><span class="annottext">Arch
</span><a href="../../ghc-boot/src/GHC.Platform.html#ArchAArch64"><span class="hs-identifier hs-var">ArchAArch64</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1861"></span><span>                               </span><span class="annot"><span class="annottext">Arch
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1862"></span><span>                          </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-Wl,-no_compact_unwind&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-1863"></span><span>                          </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1864"></span><span>
</span><span id="line-1865"></span><span>                      </span><span class="hs-comment">-- '-Wl,-read_only_relocs,suppress'</span><span>
</span><span id="line-1866"></span><span>                      </span><span class="hs-comment">-- ld gives loads of warnings like:</span><span>
</span><span id="line-1867"></span><span>                      </span><span class="hs-comment">--     ld: warning: text reloc in _base_GHCziArr_unsafeArray_info to _base_GHCziArr_unsafeArray_closure</span><span>
</span><span id="line-1868"></span><span>                      </span><span class="hs-comment">-- when linking any program. We're not sure</span><span>
</span><span id="line-1869"></span><span>                      </span><span class="hs-comment">-- whether this is something we ought to fix, but</span><span>
</span><span id="line-1870"></span><span>                      </span><span class="hs-comment">-- for now this flags silences them.</span><span>
</span><span id="line-1871"></span><span>                      </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; OS
</span><a href="../../ghc-boot/src/GHC.Platform.html#platformOS"><span class="hs-identifier hs-var">platformOS</span></a></span><span>   </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681201079"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">OS -&gt; OS -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="../../ghc-boot/src/GHC.Platform.html#OSDarwin"><span class="hs-identifier hs-var">OSDarwin</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-1872"></span><span>                             </span><span class="annot"><span class="annottext">Platform -&gt; Arch
</span><a href="../../ghc-boot/src/GHC.Platform.html#platformArch"><span class="hs-identifier hs-var">platformArch</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681201079"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">Arch -&gt; Arch -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Arch
</span><a href="../../ghc-boot/src/GHC.Platform.html#ArchX86"><span class="hs-identifier hs-var">ArchX86</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-1873"></span><span>                             </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681201083"><span class="hs-identifier hs-var">staticLink</span></a></span><span>
</span><span id="line-1874"></span><span>                          </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-Wl,-read_only_relocs,suppress&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-1875"></span><span>                          </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1876"></span><span>
</span><span id="line-1877"></span><span>                      </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">ToolSettings -&gt; Bool
</span><a href="GHC.Settings.html#toolSettings_ldIsGnuLd"><span class="hs-identifier hs-var hs-var">toolSettings_ldIsGnuLd</span></a></span><span> </span><span class="annot"><span class="annottext">ToolSettings
</span><a href="#local-6989586621681201078"><span class="hs-identifier hs-var">toolSettings'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-1878"></span><span>                             </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_WholeArchiveHsLibs"><span class="hs-identifier hs-var">Opt_WholeArchiveHsLibs</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681201082"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1879"></span><span>                          </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-Wl,--gc-sections&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-1880"></span><span>                          </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1881"></span><span>
</span><span id="line-1882"></span><span>                      </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201081"><span class="hs-identifier hs-var">o_files</span></a></span><span>
</span><span id="line-1883"></span><span>                      </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201028"><span class="hs-identifier hs-var">lib_path_opts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1884"></span><span>                      </span><span class="annot"><span class="annottext">[Option] -&gt; [Option] -&gt; [Option]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Option]
</span><a href="#local-6989586621681201011"><span class="hs-identifier hs-var">extra_ld_inputs</span></a></span><span>
</span><span id="line-1885"></span><span>                      </span><span class="annot"><span class="annottext">[Option] -&gt; [Option] -&gt; [Option]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Option) -&gt; [String] -&gt; [Option]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-1886"></span><span>                         </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201010"><span class="hs-identifier hs-var">rc_objs</span></a></span><span>
</span><span id="line-1887"></span><span>                      </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201013"><span class="hs-identifier hs-var">framework_opts</span></a></span><span>
</span><span id="line-1888"></span><span>                      </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201043"><span class="hs-identifier hs-var">pkg_lib_path_opts</span></a></span><span>
</span><span id="line-1889"></span><span>                      </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681201027"><span class="hs-identifier hs-var">extraLinkObj</span></a></span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; [String]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201025"><span class="hs-identifier hs-var">noteLinkObjs</span></a></span><span>
</span><span id="line-1890"></span><span>                      </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201020"><span class="hs-identifier hs-var">pkg_link_opts</span></a></span><span>
</span><span id="line-1891"></span><span>                      </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681201015"><span class="hs-identifier hs-var">pkg_framework_opts</span></a></span><span>
</span><span id="line-1892"></span><span>                      </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; OS
</span><a href="../../ghc-boot/src/GHC.Platform.html#platformOS"><span class="hs-identifier hs-var">platformOS</span></a></span><span> </span><span class="annot"><span class="annottext">Platform
</span><a href="#local-6989586621681201079"><span class="hs-identifier hs-var">platform</span></a></span><span> </span><span class="annot"><span class="annottext">OS -&gt; OS -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="../../ghc-boot/src/GHC.Platform.html#OSDarwin"><span class="hs-identifier hs-var">OSDarwin</span></a></span><span>
</span><span id="line-1893"></span><span>                          </span><span class="hs-comment">--  dead_strip_dylibs, will remove unused dylibs, and thus save</span><span>
</span><span id="line-1894"></span><span>                          </span><span class="hs-comment">--  space in the load commands. The -headerpad is necessary so</span><span>
</span><span id="line-1895"></span><span>                          </span><span class="hs-comment">--  that we can inject more @rpath's later for the left over</span><span>
</span><span id="line-1896"></span><span>                          </span><span class="hs-comment">--  libraries during runInjectRpaths phase.</span><span>
</span><span id="line-1897"></span><span>                          </span><span class="hs-comment">--</span><span>
</span><span id="line-1898"></span><span>                          </span><span class="hs-comment">--  See Note [Dynamic linking on macOS].</span><span>
</span><span id="line-1899"></span><span>                          </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-Wl,-dead_strip_dylibs&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-Wl,-headerpad,8000&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1900"></span><span>                          </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1901"></span><span>                    </span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1902"></span><span>
</span><span id="line-1903"></span><span class="annot"><a href="GHC.Driver.Pipeline.html#exeFileName"><span class="hs-identifier hs-type">exeFileName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>
</span><span id="line-1904"></span><span id="exeFileName"><span class="annot"><span class="annottext">exeFileName :: Bool -&gt; DynFlags -&gt; String
</span><a href="GHC.Driver.Pipeline.html#exeFileName"><span class="hs-identifier hs-var hs-var">exeFileName</span></a></span></span><span> </span><span id="local-6989586621681200996"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681200996"><span class="hs-identifier hs-var">staticLink</span></a></span></span><span> </span><span id="local-6989586621681200995"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200995"><span class="hs-identifier hs-var">dflags</span></a></span></span><span>
</span><span id="line-1905"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681200994"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200994"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Maybe String
</span><a href="GHC.Driver.Session.html#outputFile"><span class="hs-identifier hs-var hs-var">outputFile</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200995"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1906"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; OS
</span><a href="../../ghc-boot/src/GHC.Platform.html#platformOS"><span class="hs-identifier hs-var">platformOS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.Session.html#targetPlatform"><span class="hs-identifier hs-var hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200995"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1907"></span><span>          </span><span class="annot"><span class="annottext">OS
</span><a href="../../ghc-boot/src/GHC.Platform.html#OSMinGW32"><span class="hs-identifier hs-var">OSMinGW32</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200994"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><a href="#local-6989586621681200993"><span class="hs-operator hs-var">&lt;?.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;exe&quot;</span></span><span>
</span><span id="line-1908"></span><span>          </span><span class="annot"><span class="annottext">OS
</span><span class="hs-identifier">_</span></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681200996"><span class="hs-identifier hs-var">staticLink</span></a></span><span>
</span><span id="line-1909"></span><span>                         </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200994"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><a href="#local-6989586621681200993"><span class="hs-operator hs-var">&lt;?.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;a&quot;</span></span><span>
</span><span id="line-1910"></span><span>                         </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200994"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-1911"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1912"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; OS
</span><a href="../../ghc-boot/src/GHC.Platform.html#platformOS"><span class="hs-identifier hs-var">platformOS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.Session.html#targetPlatform"><span class="hs-identifier hs-var hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200995"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OS -&gt; OS -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="../../ghc-boot/src/GHC.Platform.html#OSMinGW32"><span class="hs-identifier hs-var">OSMinGW32</span></a></span><span>
</span><span id="line-1913"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;main.exe&quot;</span></span><span>
</span><span id="line-1914"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681200996"><span class="hs-identifier hs-var">staticLink</span></a></span><span>
</span><span id="line-1915"></span><span>           </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;liba.a&quot;</span></span><span>
</span><span id="line-1916"></span><span>           </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;a.out&quot;</span></span><span>
</span><span id="line-1917"></span><span> </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681200991"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200991"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621681200993"><span class="annot"><span class="annottext">&lt;?.&gt; :: String -&gt; String -&gt; String
</span><a href="#local-6989586621681200993"><span class="hs-operator hs-var hs-var">&lt;?.&gt;</span></a></span></span><span> </span><span id="local-6989586621681200990"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200990"><span class="hs-identifier hs-var">ext</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">String -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; String
</span><a href="../../filepath/src/System.FilePath.Windows.html#takeExtension"><span class="hs-identifier hs-var">takeExtension</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200991"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200991"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><a href="../../filepath/src/System.FilePath.Windows.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200990"><span class="hs-identifier hs-var">ext</span></a></span><span>
</span><span id="line-1918"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200991"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-1919"></span><span>
</span><span id="line-1920"></span><span class="annot"><a href="GHC.Driver.Pipeline.html#maybeCreateManifest"><span class="hs-identifier hs-type">maybeCreateManifest</span></a></span><span>
</span><span id="line-1921"></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span>
</span><span id="line-1922"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>                          </span><span class="hs-comment">-- filename of executable</span><span>
</span><span id="line-1923"></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../base/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span class="hs-special">]</span><span>                     </span><span class="hs-comment">-- extra objects to embed, maybe</span><span>
</span><span id="line-1924"></span><span id="maybeCreateManifest"><span class="annot"><span class="annottext">maybeCreateManifest :: DynFlags -&gt; String -&gt; IO [String]
</span><a href="GHC.Driver.Pipeline.html#maybeCreateManifest"><span class="hs-identifier hs-var hs-var">maybeCreateManifest</span></a></span></span><span> </span><span id="local-6989586621681200988"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200988"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621681200987"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200987"><span class="hs-identifier hs-var">exe_filename</span></a></span></span><span>
</span><span id="line-1925"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; OS
</span><a href="../../ghc-boot/src/GHC.Platform.html#platformOS"><span class="hs-identifier hs-var">platformOS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.Session.html#targetPlatform"><span class="hs-identifier hs-var hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200988"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OS -&gt; OS -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="../../ghc-boot/src/GHC.Platform.html#OSMinGW32"><span class="hs-identifier hs-var">OSMinGW32</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-1926"></span><span>   </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_GenManifest"><span class="hs-identifier hs-var">Opt_GenManifest</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200988"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1927"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681200985"><span class="annot"><span class="annottext">manifest_filename :: String
</span><a href="#local-6989586621681200985"><span class="hs-identifier hs-var hs-var">manifest_filename</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200987"><span class="hs-identifier hs-var">exe_filename</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><a href="../../filepath/src/System.FilePath.Windows.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;manifest&quot;</span></span><span>
</span><span id="line-1928"></span><span>
</span><span id="line-1929"></span><span>         </span><span class="annot"><span class="annottext">String -&gt; String -&gt; IO ()
</span><a href="../../base/src/System.IO.html#writeFile"><span class="hs-identifier hs-var">writeFile</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200985"><span class="hs-identifier hs-var">manifest_filename</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ()) -&gt; String -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1930"></span><span>             </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&lt;?xml version=\&quot;1.0\&quot; encoding=\&quot;UTF-8\&quot; standalone=\&quot;yes\&quot;?&gt;\n&quot;</span></span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-1931"></span><span>             </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;  &lt;assembly xmlns=\&quot;urn:schemas-microsoft-com:asm.v1\&quot; manifestVersion=\&quot;1.0\&quot;&gt;\n&quot;</span></span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-1932"></span><span>             </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;  &lt;assemblyIdentity version=\&quot;1.0.0.0\&quot;\n&quot;</span></span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-1933"></span><span>             </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;     processorArchitecture=\&quot;X86\&quot;\n&quot;</span></span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-1934"></span><span>             </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;     name=\&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String
</span><a href="../../filepath/src/System.FilePath.Windows.html#dropExtension"><span class="hs-identifier hs-var">dropExtension</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200987"><span class="hs-identifier hs-var">exe_filename</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\&quot;\n&quot;</span></span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-1935"></span><span>             </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;     type=\&quot;win32\&quot;/&gt;\n\n&quot;</span></span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-1936"></span><span>             </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;  &lt;trustInfo xmlns=\&quot;urn:schemas-microsoft-com:asm.v3\&quot;&gt;\n&quot;</span></span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-1937"></span><span>             </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;    &lt;security&gt;\n&quot;</span></span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-1938"></span><span>             </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;      &lt;requestedPrivileges&gt;\n&quot;</span></span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-1939"></span><span>             </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;        &lt;requestedExecutionLevel level=\&quot;asInvoker\&quot; uiAccess=\&quot;false\&quot;/&gt;\n&quot;</span></span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-1940"></span><span>             </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;        &lt;/requestedPrivileges&gt;\n&quot;</span></span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-1941"></span><span>             </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;       &lt;/security&gt;\n&quot;</span></span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-1942"></span><span>             </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;  &lt;/trustInfo&gt;\n&quot;</span></span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-1943"></span><span>             </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&lt;/assembly&gt;\n&quot;</span></span><span>
</span><span id="line-1944"></span><span>
</span><span id="line-1945"></span><span>         </span><span class="hs-comment">-- Windows will find the manifest file if it is named</span><span>
</span><span id="line-1946"></span><span>         </span><span class="hs-comment">-- foo.exe.manifest. However, for extra robustness, and so that</span><span>
</span><span id="line-1947"></span><span>         </span><span class="hs-comment">-- we can move the binary around, we can embed the manifest in</span><span>
</span><span id="line-1948"></span><span>         </span><span class="hs-comment">-- the binary itself using windres:</span><span>
</span><span id="line-1949"></span><span>         </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_EmbedManifest"><span class="hs-identifier hs-var">Opt_EmbedManifest</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200988"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; IO [String]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1950"></span><span>
</span><span id="line-1951"></span><span>         </span><span id="local-6989586621681200983"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200983"><span class="hs-identifier hs-var">rc_filename</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; TempFileLifetime -&gt; String -&gt; IO String
</span><a href="GHC.SysTools.FileCleanup.html#newTempName"><span class="hs-identifier hs-var">newTempName</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200988"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">TempFileLifetime
</span><a href="GHC.SysTools.FileCleanup.html#TFL_CurrentModule"><span class="hs-identifier hs-var">TFL_CurrentModule</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;rc&quot;</span></span><span>
</span><span id="line-1952"></span><span>         </span><span id="local-6989586621681200982"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200982"><span class="hs-identifier hs-var">rc_obj_filename</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1953"></span><span>           </span><span class="annot"><span class="annottext">DynFlags -&gt; TempFileLifetime -&gt; String -&gt; IO String
</span><a href="GHC.SysTools.FileCleanup.html#newTempName"><span class="hs-identifier hs-var">newTempName</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200988"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">TempFileLifetime
</span><a href="GHC.SysTools.FileCleanup.html#TFL_GhcSession"><span class="hs-identifier hs-var">TFL_GhcSession</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; String
</span><a href="GHC.Driver.Session.html#objectSuf"><span class="hs-identifier hs-var hs-var">objectSuf</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200988"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1954"></span><span>
</span><span id="line-1955"></span><span>         </span><span class="annot"><span class="annottext">String -&gt; String -&gt; IO ()
</span><a href="../../base/src/System.IO.html#writeFile"><span class="hs-identifier hs-var">writeFile</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200983"><span class="hs-identifier hs-var">rc_filename</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ()) -&gt; String -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1956"></span><span>             </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;1 24 MOVEABLE PURE &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../base/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200985"><span class="hs-identifier hs-var">manifest_filename</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n&quot;</span></span><span>
</span><span id="line-1957"></span><span>               </span><span class="hs-comment">-- magic numbers :-)</span><span>
</span><span id="line-1958"></span><span>               </span><span class="hs-comment">-- show is a bit hackish above, but we need to escape the</span><span>
</span><span id="line-1959"></span><span>               </span><span class="hs-comment">-- backslashes in the path.</span><span>
</span><span id="line-1960"></span><span>
</span><span id="line-1961"></span><span>         </span><span class="annot"><span class="annottext">DynFlags -&gt; [Option] -&gt; IO ()
</span><a href="GHC.SysTools.Tasks.html#runWindres"><span class="hs-identifier hs-var">runWindres</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200988"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">([Option] -&gt; IO ()) -&gt; [Option] -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Option) -&gt; [String] -&gt; [Option]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; [Option]) -&gt; [String] -&gt; [Option]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1962"></span><span>               </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;--input=&quot;</span></span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200983"><span class="hs-identifier hs-var">rc_filename</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1963"></span><span>                </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;--output=&quot;</span></span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200982"><span class="hs-identifier hs-var">rc_obj_filename</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1964"></span><span>                </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;--output-format=coff&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-1965"></span><span>               </span><span class="hs-comment">-- no FileOptions here: windres doesn't like seeing</span><span>
</span><span id="line-1966"></span><span>               </span><span class="hs-comment">-- backslashes, apparently</span><span>
</span><span id="line-1967"></span><span>
</span><span id="line-1968"></span><span>         </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><a href="../../directory/src/System.Directory.html#removeFile"><span class="hs-identifier hs-var">removeFile</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200985"><span class="hs-identifier hs-var">manifest_filename</span></a></span><span>
</span><span id="line-1969"></span><span>
</span><span id="line-1970"></span><span>         </span><span class="annot"><span class="annottext">[String] -&gt; IO [String]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200982"><span class="hs-identifier hs-var">rc_obj_filename</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1971"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; IO [String]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1972"></span><span>
</span><span id="line-1973"></span><span>
</span><span id="line-1974"></span><span class="annot"><a href="GHC.Driver.Pipeline.html#linkDynLibCheck"><span class="hs-identifier hs-type">linkDynLibCheck</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../base/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1975"></span><span id="linkDynLibCheck"><span class="annot"><span class="annottext">linkDynLibCheck :: DynFlags -&gt; [String] -&gt; [UnitId] -&gt; IO ()
</span><a href="GHC.Driver.Pipeline.html#linkDynLibCheck"><span class="hs-identifier hs-var hs-var">linkDynLibCheck</span></a></span></span><span> </span><span id="local-6989586621681200979"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200979"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621681200978"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681200978"><span class="hs-identifier hs-var">o_files</span></a></span></span><span> </span><span id="local-6989586621681200977"><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681200977"><span class="hs-identifier hs-var">dep_units</span></a></span></span><span>
</span><span id="line-1976"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1977"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.SysTools.ExtraObj.html#haveRtsOptsFlags"><span class="hs-identifier hs-var">haveRtsOptsFlags</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200979"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1978"></span><span>      </span><span class="annot"><span class="annottext">LogAction
</span><a href="GHC.Driver.Session.html#putLogMsg"><span class="hs-identifier hs-var">putLogMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200979"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">WarnReason
</span><a href="GHC.Driver.Flags.html#NoReason"><span class="hs-identifier hs-var">NoReason</span></a></span><span> </span><span class="annot"><span class="annottext">Severity
</span><a href="GHC.Utils.Error.html#SevInfo"><span class="hs-identifier hs-var">SevInfo</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="GHC.Types.SrcLoc.html#noSrcSpan"><span class="hs-identifier hs-var">noSrcSpan</span></a></span><span>
</span><span id="line-1979"></span><span>          </span><span class="annot"><span class="annottext">(SDoc -&gt; IO ()) -&gt; SDoc -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PprStyle -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#withPprStyle"><span class="hs-identifier hs-var">withPprStyle</span></a></span><span> </span><span class="annot"><span class="annottext">PprStyle
</span><a href="GHC.Utils.Outputable.html#defaultUserStyle"><span class="hs-identifier hs-var">defaultUserStyle</span></a></span><span>
</span><span id="line-1980"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Warning: -rtsopts and -with-rtsopts have no effect with -shared.&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-1981"></span><span>           </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;    Call hs_init_ghc() from your main() function to set these options.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1982"></span><span>
</span><span id="line-1983"></span><span>    </span><span class="annot"><span class="annottext">DynFlags -&gt; [String] -&gt; [UnitId] -&gt; IO ()
</span><a href="GHC.SysTools.html#linkDynLib"><span class="hs-identifier hs-var">linkDynLib</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200979"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681200978"><span class="hs-identifier hs-var">o_files</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681200977"><span class="hs-identifier hs-var">dep_units</span></a></span><span>
</span><span id="line-1984"></span><span>
</span><span id="line-1985"></span><span class="hs-comment">-- | Linking a static lib will not really link anything. It will merely produce</span><span>
</span><span id="line-1986"></span><span class="hs-comment">-- a static archive of all dependent static libraries. The resulting library</span><span>
</span><span id="line-1987"></span><span class="hs-comment">-- will still need to be linked with any remaining link flags.</span><span>
</span><span id="line-1988"></span><span class="annot"><a href="GHC.Driver.Pipeline.html#linkStaticLib"><span class="hs-identifier hs-type">linkStaticLib</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../base/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1989"></span><span id="linkStaticLib"><span class="annot"><span class="annottext">linkStaticLib :: DynFlags -&gt; [String] -&gt; [UnitId] -&gt; IO ()
</span><a href="GHC.Driver.Pipeline.html#linkStaticLib"><span class="hs-identifier hs-var hs-var">linkStaticLib</span></a></span></span><span> </span><span id="local-6989586621681200968"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200968"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621681200967"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681200967"><span class="hs-identifier hs-var">o_files</span></a></span></span><span> </span><span id="local-6989586621681200966"><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681200966"><span class="hs-identifier hs-var">dep_units</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1990"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681200965"><span class="annot"><span class="annottext">extra_ld_inputs :: [String]
</span><a href="#local-6989586621681200965"><span class="hs-identifier hs-var hs-var">extra_ld_inputs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200964"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Utils.CliOption.html#FileOption"><span class="hs-identifier hs-type">FileOption</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681200964"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200964"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [Option]
</span><a href="GHC.Driver.Session.html#ldInputs"><span class="hs-identifier hs-var hs-var">ldInputs</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200968"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1991"></span><span>      </span><span id="local-6989586621681200963"><span class="annot"><span class="annottext">modules :: [String]
</span><a href="#local-6989586621681200963"><span class="hs-identifier hs-var hs-var">modules</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681200967"><span class="hs-identifier hs-var">o_files</span></a></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681200965"><span class="hs-identifier hs-var">extra_ld_inputs</span></a></span><span>
</span><span id="line-1992"></span><span>      </span><span id="local-6989586621681200962"><span class="annot"><span class="annottext">output_fn :: String
</span><a href="#local-6989586621681200962"><span class="hs-identifier hs-var hs-var">output_fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; DynFlags -&gt; String
</span><a href="GHC.Driver.Pipeline.html#exeFileName"><span class="hs-identifier hs-var">exeFileName</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200968"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1993"></span><span>
</span><span id="line-1994"></span><span>  </span><span id="local-6989586621681200961"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200961"><span class="hs-identifier hs-var">full_output_fn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">String -&gt; Bool
</span><a href="../../filepath/src/System.FilePath.Windows.html#isAbsolute"><span class="hs-identifier hs-var">isAbsolute</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200962"><span class="hs-identifier hs-var">output_fn</span></a></span><span>
</span><span id="line-1995"></span><span>                    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO String
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200962"><span class="hs-identifier hs-var">output_fn</span></a></span><span>
</span><span id="line-1996"></span><span>                    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621681200960"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200960"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO String
</span><a href="../../directory/src/System.Directory.html#getCurrentDirectory"><span class="hs-identifier hs-var">getCurrentDirectory</span></a></span><span>
</span><span id="line-1997"></span><span>                            </span><span class="annot"><span class="annottext">String -&gt; IO String
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO String) -&gt; String -&gt; IO String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String
</span><a href="../../filepath/src/System.FilePath.Windows.html#normalise"><span class="hs-identifier hs-var">normalise</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200960"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><a href="../../filepath/src/System.FilePath.Windows.html#%3C%2F%3E"><span class="hs-operator hs-var">&lt;/&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200962"><span class="hs-identifier hs-var">output_fn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1998"></span><span>  </span><span id="local-6989586621681200959"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681200959"><span class="hs-identifier hs-var">output_exists</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO Bool
</span><a href="../../directory/src/System.Directory.html#doesFileExist"><span class="hs-identifier hs-var">doesFileExist</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200961"><span class="hs-identifier hs-var">full_output_fn</span></a></span><span>
</span><span id="line-1999"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681200959"><span class="hs-identifier hs-var">output_exists</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO ()
</span><a href="../../directory/src/System.Directory.html#removeFile"><span class="hs-identifier hs-var">removeFile</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200961"><span class="hs-identifier hs-var">full_output_fn</span></a></span><span>
</span><span id="line-2000"></span><span>
</span><span id="line-2001"></span><span>  </span><span id="local-6989586621681200958"><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681200958"><span class="hs-identifier hs-var">pkg_cfgs_init</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [UnitId] -&gt; IO [UnitInfo]
</span><a href="GHC.Unit.State.html#getPreloadUnitsAnd"><span class="hs-identifier hs-var">getPreloadUnitsAnd</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200968"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681200966"><span class="hs-identifier hs-var">dep_units</span></a></span><span>
</span><span id="line-2002"></span><span>
</span><span id="line-2003"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681200955"><span class="annot"><span class="annottext">pkg_cfgs :: [UnitInfo]
</span><a href="#local-6989586621681200955"><span class="hs-identifier hs-var hs-var">pkg_cfgs</span></a></span></span><span>
</span><span id="line-2004"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_LinkRts"><span class="hs-identifier hs-var">Opt_LinkRts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200968"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-2005"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681200958"><span class="hs-identifier hs-var">pkg_cfgs_init</span></a></span><span>
</span><span id="line-2006"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-2007"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UnitInfo -&gt; Bool) -&gt; [UnitInfo] -&gt; [UnitInfo]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitId -&gt; UnitId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="GHC.Unit.Types.html#rtsUnitId"><span class="hs-identifier hs-var">rtsUnitId</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(UnitId -&gt; Bool) -&gt; (UnitInfo -&gt; UnitId) -&gt; UnitInfo -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; UnitId
forall compid srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo compid srcpkgid srcpkgname uid modulename mod
-&gt; uid
</span><a href="../../ghc-boot/src/GHC.Unit.Database.html#unitId"><span class="hs-identifier hs-var hs-var">unitId</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681200958"><span class="hs-identifier hs-var">pkg_cfgs_init</span></a></span><span>
</span><span id="line-2008"></span><span>
</span><span id="line-2009"></span><span>  </span><span id="local-6989586621681200951"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681200951"><span class="hs-identifier hs-var">archives</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(UnitInfo -&gt; IO [String]) -&gt; [UnitInfo] -&gt; IO [String]
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m [b]) -&gt; [a] -&gt; m [b]
</span><a href="GHC.Utils.Monad.html#concatMapM"><span class="hs-identifier hs-var">concatMapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; UnitInfo -&gt; IO [String]
</span><a href="GHC.Unit.State.html#collectArchives"><span class="hs-identifier hs-var">collectArchives</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200968"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681200955"><span class="hs-identifier hs-var">pkg_cfgs</span></a></span><span>
</span><span id="line-2010"></span><span>
</span><span id="line-2011"></span><span>  </span><span id="local-6989586621681200948"><span class="annot"><span class="annottext">Archive
</span><a href="#local-6989586621681200948"><span class="hs-identifier hs-var">ar</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Archive -&gt; Archive -&gt; Archive) -&gt; Archive -&gt; [Archive] -&gt; Archive
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base/src/Data.Foldable.html#foldl"><span class="hs-identifier hs-var">foldl</span></a></span><span> </span><span class="annot"><span class="annottext">Archive -&gt; Archive -&gt; Archive
forall a. Monoid a =&gt; a -&gt; a -&gt; a
</span><a href="../../base/src/GHC.Base.html#mappend"><span class="hs-identifier hs-var">mappend</span></a></span><span>
</span><span id="line-2012"></span><span>        </span><span class="annot"><span class="annottext">(Archive -&gt; [Archive] -&gt; Archive)
-&gt; IO Archive -&gt; IO ([Archive] -&gt; Archive)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ArchiveEntry] -&gt; Archive
</span><a href="GHC.SysTools.Ar.html#Archive"><span class="hs-identifier hs-var">Archive</span></a></span><span> </span><span class="annot"><span class="annottext">([ArchiveEntry] -&gt; Archive) -&gt; IO [ArchiveEntry] -&gt; IO Archive
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ArchiveEntry) -&gt; [String] -&gt; IO [ArchiveEntry]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO ArchiveEntry
</span><a href="GHC.SysTools.Ar.html#loadObj"><span class="hs-identifier hs-var">loadObj</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681200963"><span class="hs-identifier hs-var">modules</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2013"></span><span>        </span><span class="annot"><span class="annottext">IO ([Archive] -&gt; Archive) -&gt; IO [Archive] -&gt; IO Archive
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO Archive) -&gt; [String] -&gt; IO [Archive]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO Archive
</span><a href="GHC.SysTools.Ar.html#loadAr"><span class="hs-identifier hs-var">loadAr</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681200951"><span class="hs-identifier hs-var">archives</span></a></span><span>
</span><span id="line-2014"></span><span>
</span><span id="line-2015"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">ToolSettings -&gt; Bool
</span><a href="GHC.Settings.html#toolSettings_ldIsGnuLd"><span class="hs-identifier hs-var hs-var">toolSettings_ldIsGnuLd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; ToolSettings
</span><a href="GHC.Driver.Session.html#toolSettings"><span class="hs-identifier hs-var hs-var">toolSettings</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200968"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2016"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String -&gt; Archive -&gt; IO ()
</span><a href="GHC.SysTools.Ar.html#writeGNUAr"><span class="hs-identifier hs-var">writeGNUAr</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200962"><span class="hs-identifier hs-var">output_fn</span></a></span><span> </span><span class="annot"><span class="annottext">(Archive -&gt; IO ()) -&gt; Archive -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(ArchiveEntry -&gt; Bool) -&gt; Archive -&gt; Archive
</span><a href="GHC.SysTools.Ar.html#afilter"><span class="hs-identifier hs-var">afilter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (ArchiveEntry -&gt; Bool) -&gt; ArchiveEntry -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ArchiveEntry -&gt; Bool
</span><a href="GHC.SysTools.Ar.html#isGNUSymdef"><span class="hs-identifier hs-var">isGNUSymdef</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Archive
</span><a href="#local-6989586621681200948"><span class="hs-identifier hs-var">ar</span></a></span><span>
</span><span id="line-2017"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">String -&gt; Archive -&gt; IO ()
</span><a href="GHC.SysTools.Ar.html#writeBSDAr"><span class="hs-identifier hs-var">writeBSDAr</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200962"><span class="hs-identifier hs-var">output_fn</span></a></span><span> </span><span class="annot"><span class="annottext">(Archive -&gt; IO ()) -&gt; Archive -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(ArchiveEntry -&gt; Bool) -&gt; Archive -&gt; Archive
</span><a href="GHC.SysTools.Ar.html#afilter"><span class="hs-identifier hs-var">afilter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (ArchiveEntry -&gt; Bool) -&gt; ArchiveEntry -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ArchiveEntry -&gt; Bool
</span><a href="GHC.SysTools.Ar.html#isBSDSymdef"><span class="hs-identifier hs-var">isBSDSymdef</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Archive
</span><a href="#local-6989586621681200948"><span class="hs-identifier hs-var">ar</span></a></span><span>
</span><span id="line-2018"></span><span>
</span><span id="line-2019"></span><span>  </span><span class="hs-comment">-- run ranlib over the archive. write*Ar does *not* create the symbol index.</span><span>
</span><span id="line-2020"></span><span>  </span><span class="annot"><span class="annottext">DynFlags -&gt; [Option] -&gt; IO ()
</span><a href="GHC.SysTools.Tasks.html#runRanlib"><span class="hs-identifier hs-var">runRanlib</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200968"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String -&gt; String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#FileOption"><span class="hs-identifier hs-var">GHC.SysTools.FileOption</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200962"><span class="hs-identifier hs-var">output_fn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2021"></span><span>
</span><span id="line-2022"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-2023"></span><span class="hs-comment">-- Running CPP</span><span>
</span><span id="line-2024"></span><span>
</span><span id="line-2025"></span><span class="annot"><a href="GHC.Driver.Pipeline.html#doCpp"><span class="hs-identifier hs-type">doCpp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2026"></span><span id="doCpp"><span class="annot"><span class="annottext">doCpp :: DynFlags -&gt; Bool -&gt; String -&gt; String -&gt; IO ()
</span><a href="GHC.Driver.Pipeline.html#doCpp"><span class="hs-identifier hs-var hs-var">doCpp</span></a></span></span><span> </span><span id="local-6989586621681200936"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200936"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621681200935"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681200935"><span class="hs-identifier hs-var">raw</span></a></span></span><span> </span><span id="local-6989586621681200934"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200934"><span class="hs-identifier hs-var">input_fn</span></a></span></span><span> </span><span id="local-6989586621681200933"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200933"><span class="hs-identifier hs-var">output_fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2027"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681200932"><span class="annot"><span class="annottext">hscpp_opts :: [String]
</span><a href="#local-6989586621681200932"><span class="hs-identifier hs-var hs-var">hscpp_opts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [String]
</span><a href="GHC.Driver.Session.html#picPOpts"><span class="hs-identifier hs-var">picPOpts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200936"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-2028"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681200930"><span class="annot"><span class="annottext">cmdline_include_paths :: IncludeSpecs
</span><a href="#local-6989586621681200930"><span class="hs-identifier hs-var hs-var">cmdline_include_paths</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; IncludeSpecs
</span><a href="GHC.Driver.Session.html#includePaths"><span class="hs-identifier hs-var hs-var">includePaths</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200936"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-2029"></span><span>
</span><span id="line-2030"></span><span>    </span><span id="local-6989586621681200929"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681200929"><span class="hs-identifier hs-var">pkg_include_dirs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [UnitId] -&gt; IO [String]
</span><a href="GHC.Unit.State.html#getUnitIncludePath"><span class="hs-identifier hs-var">getUnitIncludePath</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200936"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2031"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681200927"><span class="annot"><span class="annottext">include_paths_global :: [String]
</span><a href="#local-6989586621681200927"><span class="hs-identifier hs-var hs-var">include_paths_global</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(String -&gt; [String] -&gt; [String])
-&gt; [String] -&gt; [String] -&gt; [String]
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681200926"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200926"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681200925"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681200925"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-I&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200926"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; [String]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681200925"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2032"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IncludeSpecs -&gt; [String]
</span><a href="GHC.Driver.Session.html#includePathsGlobal"><span class="hs-identifier hs-var hs-var">includePathsGlobal</span></a></span><span> </span><span class="annot"><span class="annottext">IncludeSpecs
</span><a href="#local-6989586621681200930"><span class="hs-identifier hs-var">cmdline_include_paths</span></a></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681200929"><span class="hs-identifier hs-var">pkg_include_dirs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2033"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681200923"><span class="annot"><span class="annottext">include_paths_quote :: [String]
</span><a href="#local-6989586621681200923"><span class="hs-identifier hs-var hs-var">include_paths_quote</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(String -&gt; [String] -&gt; [String])
-&gt; [String] -&gt; [String] -&gt; [String]
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681200922"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200922"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681200921"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681200921"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-iquote&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200922"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; [String]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681200921"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2034"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IncludeSpecs -&gt; [String]
</span><a href="GHC.Driver.Session.html#includePathsQuote"><span class="hs-identifier hs-var hs-var">includePathsQuote</span></a></span><span> </span><span class="annot"><span class="annottext">IncludeSpecs
</span><a href="#local-6989586621681200930"><span class="hs-identifier hs-var">cmdline_include_paths</span></a></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-2035"></span><span>           </span><span class="annot"><span class="annottext">IncludeSpecs -&gt; [String]
</span><a href="GHC.Driver.Session.html#includePathsQuoteImplicit"><span class="hs-identifier hs-var hs-var">includePathsQuoteImplicit</span></a></span><span> </span><span class="annot"><span class="annottext">IncludeSpecs
</span><a href="#local-6989586621681200930"><span class="hs-identifier hs-var">cmdline_include_paths</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2036"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681200920"><span class="annot"><span class="annottext">include_paths :: [String]
</span><a href="#local-6989586621681200920"><span class="hs-identifier hs-var hs-var">include_paths</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681200923"><span class="hs-identifier hs-var">include_paths_quote</span></a></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681200927"><span class="hs-identifier hs-var">include_paths_global</span></a></span><span>
</span><span id="line-2037"></span><span>
</span><span id="line-2038"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681200919"><span class="annot"><span class="annottext">verbFlags :: [String]
</span><a href="#local-6989586621681200919"><span class="hs-identifier hs-var hs-var">verbFlags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [String]
</span><a href="GHC.Driver.Session.html#getVerbFlags"><span class="hs-identifier hs-var">getVerbFlags</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200936"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-2039"></span><span>
</span><span id="line-2040"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681200918"><span class="annot"><span class="annottext">cpp_prog :: [Option] -&gt; IO ()
</span><a href="#local-6989586621681200918"><span class="hs-identifier hs-var hs-var">cpp_prog</span></a></span></span><span> </span><span id="local-6989586621681200917"><span class="annot"><span class="annottext">[Option]
</span><a href="#local-6989586621681200917"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681200935"><span class="hs-identifier hs-var">raw</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [Option] -&gt; IO ()
</span><a href="GHC.SysTools.Tasks.html#runCpp"><span class="hs-identifier hs-var">GHC.SysTools.runCpp</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200936"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">[Option]
</span><a href="#local-6989586621681200917"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-2041"></span><span>                      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ForeignSrcLang -&gt; DynFlags -&gt; [Option] -&gt; IO ()
</span><a href="GHC.SysTools.Tasks.html#runCc"><span class="hs-identifier hs-var">GHC.SysTools.runCc</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ForeignSrcLang
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200936"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-E&quot;</span></span><span> </span><span class="annot"><span class="annottext">Option -&gt; [Option] -&gt; [Option]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Option]
</span><a href="#local-6989586621681200917"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2042"></span><span>
</span><span id="line-2043"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681200915"><span class="annot"><span class="annottext">targetArch :: String
</span><a href="#local-6989586621681200915"><span class="hs-identifier hs-var hs-var">targetArch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Arch -&gt; String
</span><a href="../../ghc-boot/src/GHC.Platform.html#stringEncodeArch"><span class="hs-identifier hs-var">stringEncodeArch</span></a></span><span> </span><span class="annot"><span class="annottext">(Arch -&gt; String) -&gt; Arch -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Arch
</span><a href="../../ghc-boot/src/GHC.Platform.html#platformArch"><span class="hs-identifier hs-var">platformArch</span></a></span><span> </span><span class="annot"><span class="annottext">(Platform -&gt; Arch) -&gt; Platform -&gt; Arch
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.Session.html#targetPlatform"><span class="hs-identifier hs-var hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200936"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-2044"></span><span>        </span><span id="local-6989586621681200913"><span class="annot"><span class="annottext">targetOS :: String
</span><a href="#local-6989586621681200913"><span class="hs-identifier hs-var hs-var">targetOS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OS -&gt; String
</span><a href="../../ghc-boot/src/GHC.Platform.html#stringEncodeOS"><span class="hs-identifier hs-var">stringEncodeOS</span></a></span><span> </span><span class="annot"><span class="annottext">(OS -&gt; String) -&gt; OS -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; OS
</span><a href="../../ghc-boot/src/GHC.Platform.html#platformOS"><span class="hs-identifier hs-var">platformOS</span></a></span><span> </span><span class="annot"><span class="annottext">(Platform -&gt; OS) -&gt; Platform -&gt; OS
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.Session.html#targetPlatform"><span class="hs-identifier hs-var hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200936"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-2045"></span><span>        </span><span id="local-6989586621681200910"><span class="annot"><span class="annottext">isWindows :: Bool
</span><a href="#local-6989586621681200910"><span class="hs-identifier hs-var hs-var">isWindows</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Platform -&gt; OS
</span><a href="../../ghc-boot/src/GHC.Platform.html#platformOS"><span class="hs-identifier hs-var">platformOS</span></a></span><span> </span><span class="annot"><span class="annottext">(Platform -&gt; OS) -&gt; Platform -&gt; OS
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.Session.html#targetPlatform"><span class="hs-identifier hs-var hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200936"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OS -&gt; OS -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="../../ghc-boot/src/GHC.Platform.html#OSMinGW32"><span class="hs-identifier hs-var">OSMinGW32</span></a></span><span>
</span><span id="line-2046"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681200909"><span class="annot"><span class="annottext">target_defs :: [String]
</span><a href="#local-6989586621681200909"><span class="hs-identifier hs-var hs-var">target_defs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2047"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-D&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-identifier">HOST_OS</span><span>     </span><span class="hs-operator">++</span><span> </span><span class="hs-string">&quot;_BUILD_OS&quot;</span><span class="hs-special">,</span><span>
</span><span id="line-2048"></span><span>            </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-D&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-identifier">HOST_ARCH</span><span>   </span><span class="hs-operator">++</span><span> </span><span class="hs-string">&quot;_BUILD_ARCH&quot;</span><span class="hs-special">,</span><span>
</span><span id="line-2049"></span><span>            </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-D&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200913"><span class="hs-identifier hs-var">targetOS</span></a></span><span>    </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;_HOST_OS&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-2050"></span><span>            </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-D&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200915"><span class="hs-identifier hs-var">targetArch</span></a></span><span>  </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;_HOST_ARCH&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2051"></span><span>        </span><span class="hs-comment">-- remember, in code we *compile*, the HOST is the same our TARGET,</span><span>
</span><span id="line-2052"></span><span>        </span><span class="hs-comment">-- and BUILD is the same as our HOST.</span><span>
</span><span id="line-2053"></span><span>
</span><span id="line-2054"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681200908"><span class="annot"><span class="annottext">io_manager_defs :: [String]
</span><a href="#local-6989586621681200908"><span class="hs-identifier hs-var hs-var">io_manager_defs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2055"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-D__IO_MANAGER_WINIO__=1&quot;</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681200910"><span class="hs-identifier hs-var">isWindows</span></a></span><span> </span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-2056"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-D__IO_MANAGER_MIO__=1&quot;</span></span><span>               </span><span class="hs-special">]</span><span>
</span><span id="line-2057"></span><span>
</span><span id="line-2058"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681200907"><span class="annot"><span class="annottext">sse_defs :: [String]
</span><a href="#local-6989586621681200907"><span class="hs-identifier hs-var hs-var">sse_defs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2059"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-D__SSE__&quot;</span></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#isSseEnabled"><span class="hs-identifier hs-var">isSseEnabled</span></a></span><span>      </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200936"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-2060"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-D__SSE2__&quot;</span></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#isSse2Enabled"><span class="hs-identifier hs-var">isSse2Enabled</span></a></span><span>     </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200936"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-2061"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-D__SSE4_2__&quot;</span></span><span>   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#isSse4_2Enabled"><span class="hs-identifier hs-var">isSse4_2Enabled</span></a></span><span>   </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200936"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2062"></span><span>
</span><span id="line-2063"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681200906"><span class="annot"><span class="annottext">avx_defs :: [String]
</span><a href="#local-6989586621681200906"><span class="hs-identifier hs-var hs-var">avx_defs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2064"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-D__AVX__&quot;</span></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#isAvxEnabled"><span class="hs-identifier hs-var">isAvxEnabled</span></a></span><span>      </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200936"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-2065"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-D__AVX2__&quot;</span></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#isAvx2Enabled"><span class="hs-identifier hs-var">isAvx2Enabled</span></a></span><span>     </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200936"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-2066"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-D__AVX512CD__&quot;</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#isAvx512cdEnabled"><span class="hs-identifier hs-var">isAvx512cdEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200936"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-2067"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-D__AVX512ER__&quot;</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#isAvx512erEnabled"><span class="hs-identifier hs-var">isAvx512erEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200936"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-2068"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-D__AVX512F__&quot;</span></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#isAvx512fEnabled"><span class="hs-identifier hs-var">isAvx512fEnabled</span></a></span><span>  </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200936"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; [String] -&gt; [String]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-2069"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-D__AVX512PF__&quot;</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#isAvx512pfEnabled"><span class="hs-identifier hs-var">isAvx512pfEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200936"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2070"></span><span>
</span><span id="line-2071"></span><span>    </span><span id="local-6989586621681200905"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681200905"><span class="hs-identifier hs-var">backend_defs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; IO [String]
</span><a href="GHC.Driver.Pipeline.html#getBackendDefs"><span class="hs-identifier hs-var">getBackendDefs</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200936"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-2072"></span><span>
</span><span id="line-2073"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681200903"><span class="annot"><span class="annottext">th_defs :: [String]
</span><a href="#local-6989586621681200903"><span class="hs-identifier hs-var hs-var">th_defs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-D__GLASGOW_HASKELL_TH__&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2074"></span><span>    </span><span class="hs-comment">-- Default CPP defines in Haskell source</span><span>
</span><span id="line-2075"></span><span>    </span><span id="local-6989586621681200902"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200902"><span class="hs-identifier hs-var">ghcVersionH</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; IO String
</span><a href="GHC.Driver.Pipeline.html#getGhcVersionPathName"><span class="hs-identifier hs-var">getGhcVersionPathName</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200936"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-2076"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681200901"><span class="annot"><span class="annottext">hsSourceCppOpts :: [String]
</span><a href="#local-6989586621681200901"><span class="hs-identifier hs-var hs-var">hsSourceCppOpts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-include&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200902"><span class="hs-identifier hs-var">ghcVersionH</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2077"></span><span>
</span><span id="line-2078"></span><span>    </span><span class="hs-comment">-- MIN_VERSION macros</span><span>
</span><span id="line-2079"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681200900"><span class="annot"><span class="annottext">state :: UnitState
</span><a href="#local-6989586621681200900"><span class="hs-identifier hs-var hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; UnitState
</span><a href="GHC.Driver.Session.html#unitState"><span class="hs-identifier hs-var hs-var">unitState</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200936"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-2080"></span><span>        </span><span id="local-6989586621681200899"><span class="annot"><span class="annottext">uids :: [Unit]
</span><a href="#local-6989586621681200899"><span class="hs-identifier hs-var hs-var">uids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitState -&gt; [Unit]
</span><a href="GHC.Unit.State.html#explicitUnits"><span class="hs-identifier hs-var hs-var">explicitUnits</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681200900"><span class="hs-identifier hs-var">state</span></a></span><span>
</span><span id="line-2081"></span><span>        </span><span id="local-6989586621681200897"><span class="annot"><span class="annottext">pkgs :: [UnitInfo]
</span><a href="#local-6989586621681200897"><span class="hs-identifier hs-var hs-var">pkgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Maybe UnitInfo] -&gt; [UnitInfo]
forall a. [Maybe a] -&gt; [a]
</span><a href="../../base/src/Data.Maybe.html#catMaybes"><span class="hs-identifier hs-var">catMaybes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Unit -&gt; Maybe UnitInfo) -&gt; [Unit] -&gt; [Maybe UnitInfo]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitState -&gt; Unit -&gt; Maybe UnitInfo
</span><a href="GHC.Unit.State.html#lookupUnit"><span class="hs-identifier hs-var">lookupUnit</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681200900"><span class="hs-identifier hs-var">state</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Unit]
</span><a href="#local-6989586621681200899"><span class="hs-identifier hs-var">uids</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2082"></span><span>    </span><span id="local-6989586621681200895"><span class="annot"><span class="annottext">[Option]
</span><a href="#local-6989586621681200895"><span class="hs-identifier hs-var">mb_macro_include</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-2083"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UnitInfo] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681200897"><span class="hs-identifier hs-var">pkgs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_VersionMacros"><span class="hs-identifier hs-var">Opt_VersionMacros</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200936"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-2084"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621681200893"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200893"><span class="hs-identifier hs-var">macro_stub</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; TempFileLifetime -&gt; String -&gt; IO String
</span><a href="GHC.SysTools.FileCleanup.html#newTempName"><span class="hs-identifier hs-var">newTempName</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200936"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">TempFileLifetime
</span><a href="GHC.SysTools.FileCleanup.html#TFL_CurrentModule"><span class="hs-identifier hs-var">TFL_CurrentModule</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;h&quot;</span></span><span>
</span><span id="line-2085"></span><span>                    </span><span class="annot"><span class="annottext">String -&gt; String -&gt; IO ()
</span><a href="../../base/src/System.IO.html#writeFile"><span class="hs-identifier hs-var">writeFile</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200893"><span class="hs-identifier hs-var">macro_stub</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[UnitInfo] -&gt; String
</span><a href="GHC.Driver.Pipeline.html#generatePackageVersionMacros"><span class="hs-identifier hs-var">generatePackageVersionMacros</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681200897"><span class="hs-identifier hs-var">pkgs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2086"></span><span>                    </span><span class="hs-comment">-- Include version macros for every *exposed* package.</span><span>
</span><span id="line-2087"></span><span>                    </span><span class="hs-comment">-- Without -hide-all-packages and with a package database</span><span>
</span><span id="line-2088"></span><span>                    </span><span class="hs-comment">-- size of 1000 packages, it takes cpp an estimated 2</span><span>
</span><span id="line-2089"></span><span>                    </span><span class="hs-comment">-- milliseconds to process this file. See #10970</span><span>
</span><span id="line-2090"></span><span>                    </span><span class="hs-comment">-- comment 8.</span><span>
</span><span id="line-2091"></span><span>                    </span><span class="annot"><span class="annottext">[Option] -&gt; IO [Option]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String -&gt; String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#FileOption"><span class="hs-identifier hs-var">GHC.SysTools.FileOption</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-include&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200893"><span class="hs-identifier hs-var">macro_stub</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2092"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[Option] -&gt; IO [Option]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2093"></span><span>
</span><span id="line-2094"></span><span>    </span><span class="annot"><span class="annottext">[Option] -&gt; IO ()
</span><a href="#local-6989586621681200918"><span class="hs-identifier hs-var">cpp_prog</span></a></span><span>       </span><span class="hs-special">(</span><span>   </span><span class="annot"><span class="annottext">(String -&gt; Option) -&gt; [String] -&gt; [Option]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681200919"><span class="hs-identifier hs-var">verbFlags</span></a></span><span>
</span><span id="line-2095"></span><span>                    </span><span class="annot"><span class="annottext">[Option] -&gt; [Option] -&gt; [Option]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Option) -&gt; [String] -&gt; [Option]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681200920"><span class="hs-identifier hs-var">include_paths</span></a></span><span>
</span><span id="line-2096"></span><span>                    </span><span class="annot"><span class="annottext">[Option] -&gt; [Option] -&gt; [Option]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Option) -&gt; [String] -&gt; [Option]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681200901"><span class="hs-identifier hs-var">hsSourceCppOpts</span></a></span><span>
</span><span id="line-2097"></span><span>                    </span><span class="annot"><span class="annottext">[Option] -&gt; [Option] -&gt; [Option]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Option) -&gt; [String] -&gt; [Option]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681200909"><span class="hs-identifier hs-var">target_defs</span></a></span><span>
</span><span id="line-2098"></span><span>                    </span><span class="annot"><span class="annottext">[Option] -&gt; [Option] -&gt; [Option]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Option) -&gt; [String] -&gt; [Option]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681200905"><span class="hs-identifier hs-var">backend_defs</span></a></span><span>
</span><span id="line-2099"></span><span>                    </span><span class="annot"><span class="annottext">[Option] -&gt; [Option] -&gt; [Option]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Option) -&gt; [String] -&gt; [Option]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681200903"><span class="hs-identifier hs-var">th_defs</span></a></span><span>
</span><span id="line-2100"></span><span>                    </span><span class="annot"><span class="annottext">[Option] -&gt; [Option] -&gt; [Option]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Option) -&gt; [String] -&gt; [Option]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681200932"><span class="hs-identifier hs-var">hscpp_opts</span></a></span><span>
</span><span id="line-2101"></span><span>                    </span><span class="annot"><span class="annottext">[Option] -&gt; [Option] -&gt; [Option]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Option) -&gt; [String] -&gt; [Option]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681200907"><span class="hs-identifier hs-var">sse_defs</span></a></span><span>
</span><span id="line-2102"></span><span>                    </span><span class="annot"><span class="annottext">[Option] -&gt; [Option] -&gt; [Option]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Option) -&gt; [String] -&gt; [Option]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681200906"><span class="hs-identifier hs-var">avx_defs</span></a></span><span>
</span><span id="line-2103"></span><span>                    </span><span class="annot"><span class="annottext">[Option] -&gt; [Option] -&gt; [Option]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Option) -&gt; [String] -&gt; [Option]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681200908"><span class="hs-identifier hs-var">io_manager_defs</span></a></span><span>
</span><span id="line-2104"></span><span>                    </span><span class="annot"><span class="annottext">[Option] -&gt; [Option] -&gt; [Option]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Option]
</span><a href="#local-6989586621681200895"><span class="hs-identifier hs-var">mb_macro_include</span></a></span><span>
</span><span id="line-2105"></span><span>        </span><span class="hs-comment">-- Set the language mode to assembler-with-cpp when preprocessing. This</span><span>
</span><span id="line-2106"></span><span>        </span><span class="hs-comment">-- alleviates some of the C99 macro rules relating to whitespace and the hash</span><span>
</span><span id="line-2107"></span><span>        </span><span class="hs-comment">-- operator, which we tend to abuse. Clang in particular is not very happy</span><span>
</span><span id="line-2108"></span><span>        </span><span class="hs-comment">-- about this.</span><span>
</span><span id="line-2109"></span><span>                    </span><span class="annot"><span class="annottext">[Option] -&gt; [Option] -&gt; [Option]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span>     </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-x&quot;</span></span><span>
</span><span id="line-2110"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span>     </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;assembler-with-cpp&quot;</span></span><span>
</span><span id="line-2111"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span>     </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200934"><span class="hs-identifier hs-var">input_fn</span></a></span><span>
</span><span id="line-2112"></span><span>        </span><span class="hs-comment">-- We hackily use Option instead of FileOption here, so that the file</span><span>
</span><span id="line-2113"></span><span>        </span><span class="hs-comment">-- name is not back-slashed on Windows.  cpp is capable of</span><span>
</span><span id="line-2114"></span><span>        </span><span class="hs-comment">-- dealing with / in filenames, so it works fine.  Furthermore</span><span>
</span><span id="line-2115"></span><span>        </span><span class="hs-comment">-- if we put in backslashes, cpp outputs #line directives</span><span>
</span><span id="line-2116"></span><span>        </span><span class="hs-comment">-- with *double* backslashes.   And that in turn means that</span><span>
</span><span id="line-2117"></span><span>        </span><span class="hs-comment">-- our error messages get double backslashes in them.</span><span>
</span><span id="line-2118"></span><span>        </span><span class="hs-comment">-- In due course we should arrange that the lexer deals</span><span>
</span><span id="line-2119"></span><span>        </span><span class="hs-comment">-- with these \\ escapes properly.</span><span>
</span><span id="line-2120"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span>     </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-o&quot;</span></span><span>
</span><span id="line-2121"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#FileOption"><span class="hs-identifier hs-var">GHC.SysTools.FileOption</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200933"><span class="hs-identifier hs-var">output_fn</span></a></span><span>
</span><span id="line-2122"></span><span>                       </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2123"></span><span>
</span><span id="line-2124"></span><span class="annot"><a href="GHC.Driver.Pipeline.html#getBackendDefs"><span class="hs-identifier hs-type">getBackendDefs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../base/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2125"></span><span id="getBackendDefs"><span class="annot"><span class="annottext">getBackendDefs :: DynFlags -&gt; IO [String]
</span><a href="GHC.Driver.Pipeline.html#getBackendDefs"><span class="hs-identifier hs-var hs-var">getBackendDefs</span></a></span></span><span> </span><span id="local-6989586621681200891"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200891"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; HscTarget
</span><a href="GHC.Driver.Session.html#hscTarget"><span class="hs-identifier hs-var hs-var">hscTarget</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200891"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscTarget -&gt; HscTarget -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">HscTarget
</span><a href="GHC.Driver.Session.html#HscLlvm"><span class="hs-identifier hs-var">HscLlvm</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2126"></span><span>    </span><span id="local-6989586621681200890"><span class="annot"><span class="annottext">Maybe LlvmVersion
</span><a href="#local-6989586621681200890"><span class="hs-identifier hs-var">llvmVer</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; IO (Maybe LlvmVersion)
</span><a href="GHC.SysTools.Tasks.html#figureLlvmVersion"><span class="hs-identifier hs-var">figureLlvmVersion</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200891"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-2127"></span><span>    </span><span class="annot"><span class="annottext">[String] -&gt; IO [String]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; IO [String]) -&gt; [String] -&gt; IO [String]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(LlvmVersion -&gt; [Int]) -&gt; Maybe LlvmVersion -&gt; Maybe [Int]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">LlvmVersion -&gt; [Int]
</span><a href="GHC.CmmToLlvm.Base.html#llvmVersionList"><span class="hs-identifier hs-var">llvmVersionList</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe LlvmVersion
</span><a href="#local-6989586621681200890"><span class="hs-identifier hs-var">llvmVer</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2128"></span><span>               </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">[</span><span id="local-6989586621681200888"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681200888"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-D__GLASGOW_HASKELL_LLVM__=&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; String
</span><a href="#local-6989586621681200887"><span class="hs-identifier hs-var">format</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681200888"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2129"></span><span>               </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681200886"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681200886"><span class="hs-identifier hs-var">m</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681200885"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681200885"><span class="hs-identifier hs-var">n</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[Int]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-D__GLASGOW_HASKELL_LLVM__=&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">(Int, Int) -&gt; String
</span><a href="#local-6989586621681200887"><span class="hs-identifier hs-var">format</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681200886"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681200885"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2130"></span><span>               </span><span class="annot"><span class="annottext">Maybe [Int]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2131"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2132"></span><span>    </span><span id="local-6989586621681200887"><span class="annot"><span class="annottext">format :: (Int, Int) -&gt; String
</span><a href="#local-6989586621681200887"><span class="hs-identifier hs-var hs-var">format</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681200876"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681200876"><span class="hs-identifier hs-var">major</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681200875"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681200875"><span class="hs-identifier hs-var">minor</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2133"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681200875"><span class="hs-identifier hs-var">minor</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">100</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String
forall a. HasCallStack =&gt; String -&gt; a
</span><a href="../../base/src/GHC.Err.html#error"><span class="hs-identifier hs-var">error</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;getBackendDefs: Unsupported minor version&quot;</span></span><span>
</span><span id="line-2134"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../base/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">(Int -&gt; String) -&gt; Int -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">100</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base/src/GHC.Num.html#%2A"><span class="hs-operator hs-var">*</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681200876"><span class="hs-identifier hs-var">major</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681200875"><span class="hs-identifier hs-var">minor</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Contract is Int</span><span>
</span><span id="line-2135"></span><span>
</span><span id="line-2136"></span><span class="annot"><a href="GHC.Driver.Pipeline.html#getBackendDefs"><span class="hs-identifier hs-var">getBackendDefs</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2137"></span><span>    </span><span class="annot"><span class="annottext">[String] -&gt; IO [String]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2138"></span><span>
</span><span id="line-2139"></span><span class="hs-comment">-- ---------------------------------------------------------------------------</span><span>
</span><span id="line-2140"></span><span class="hs-comment">-- Macros (cribbed from Cabal)</span><span>
</span><span id="line-2141"></span><span>
</span><span id="line-2142"></span><span class="annot"><a href="GHC.Driver.Pipeline.html#generatePackageVersionMacros"><span class="hs-identifier hs-type">generatePackageVersionMacros</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span>
</span><span id="line-2143"></span><span id="generatePackageVersionMacros"><span class="annot"><span class="annottext">generatePackageVersionMacros :: [UnitInfo] -&gt; String
</span><a href="GHC.Driver.Pipeline.html#generatePackageVersionMacros"><span class="hs-identifier hs-var hs-var">generatePackageVersionMacros</span></a></span></span><span> </span><span id="local-6989586621681200871"><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681200871"><span class="hs-identifier hs-var">pkgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; String
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><a href="../../base/src/Data.Foldable.html#concat"><span class="hs-identifier hs-var">concat</span></a></span><span>
</span><span id="line-2144"></span><span>  </span><span class="hs-comment">-- Do not add any C-style comments. See #3389.</span><span>
</span><span id="line-2145"></span><span>  </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Version -&gt; String
</span><a href="GHC.Driver.Pipeline.html#generateMacros"><span class="hs-identifier hs-var">generateMacros</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200869"><span class="hs-identifier hs-var">pkgname</span></a></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621681200868"><span class="hs-identifier hs-var">version</span></a></span><span>
</span><span id="line-2146"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681200867"><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681200867"><span class="hs-identifier hs-var">pkg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681200871"><span class="hs-identifier hs-var">pkgs</span></a></span><span>
</span><span id="line-2147"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681200868"><span class="annot"><span class="annottext">version :: Version
</span><a href="#local-6989586621681200868"><span class="hs-identifier hs-var hs-var">version</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; Version
forall compid srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo compid srcpkgid srcpkgname uid modulename mod
-&gt; Version
</span><a href="../../ghc-boot/src/GHC.Unit.Database.html#unitPackageVersion"><span class="hs-identifier hs-var hs-var">unitPackageVersion</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681200867"><span class="hs-identifier hs-var">pkg</span></a></span><span>
</span><span id="line-2148"></span><span>        </span><span id="local-6989586621681200869"><span class="annot"><span class="annottext">pkgname :: String
</span><a href="#local-6989586621681200869"><span class="hs-identifier hs-var hs-var">pkgname</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Char -&gt; Char) -&gt; String -&gt; String
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; Char
</span><a href="GHC.Driver.Pipeline.html#fixchar"><span class="hs-identifier hs-var">fixchar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitInfo -&gt; String
forall u. GenUnitInfo u -&gt; String
</span><a href="GHC.Unit.Info.html#unitPackageNameString"><span class="hs-identifier hs-var">unitPackageNameString</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681200867"><span class="hs-identifier hs-var">pkg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2149"></span><span>  </span><span class="hs-special">]</span><span>
</span><span id="line-2150"></span><span>
</span><span id="line-2151"></span><span class="annot"><a href="GHC.Driver.Pipeline.html#fixchar"><span class="hs-identifier hs-type">fixchar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span>
</span><span id="line-2152"></span><span id="fixchar"><span class="annot"><span class="annottext">fixchar :: Char -&gt; Char
</span><a href="GHC.Driver.Pipeline.html#fixchar"><span class="hs-identifier hs-var hs-var">fixchar</span></a></span></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'-'</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'_'</span></span><span>
</span><span id="line-2153"></span><span class="annot"><a href="GHC.Driver.Pipeline.html#fixchar"><span class="hs-identifier hs-var">fixchar</span></a></span><span> </span><span id="local-6989586621681200863"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621681200863"><span class="hs-identifier hs-var">c</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621681200863"><span class="hs-identifier hs-var">c</span></a></span><span>
</span><span id="line-2154"></span><span>
</span><span id="line-2155"></span><span class="annot"><a href="GHC.Driver.Pipeline.html#generateMacros"><span class="hs-identifier hs-type">generateMacros</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/Data.Version.html#Version"><span class="hs-identifier hs-type">Version</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span>
</span><span id="line-2156"></span><span id="generateMacros"><span class="annot"><span class="annottext">generateMacros :: String -&gt; String -&gt; Version -&gt; String
</span><a href="GHC.Driver.Pipeline.html#generateMacros"><span class="hs-identifier hs-var hs-var">generateMacros</span></a></span></span><span> </span><span id="local-6989586621681200862"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200862"><span class="hs-identifier hs-var">prefix</span></a></span></span><span> </span><span id="local-6989586621681200861"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200861"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621681200860"><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621681200860"><span class="hs-identifier hs-var">version</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2157"></span><span>  </span><span class="annot"><span class="annottext">[String] -&gt; String
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><a href="../../base/src/Data.Foldable.html#concat"><span class="hs-identifier hs-var">concat</span></a></span><span>
</span><span id="line-2158"></span><span>  </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;#define &quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200862"><span class="hs-identifier hs-var">prefix</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;VERSION_&quot;</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200861"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; &quot;</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">String -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../base/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Version -&gt; String
</span><a href="../../base/src/Data.Version.html#showVersion"><span class="hs-identifier hs-var">showVersion</span></a></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621681200860"><span class="hs-identifier hs-var">version</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n&quot;</span></span><span>
</span><span id="line-2159"></span><span>  </span><span class="hs-special">,</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;#define MIN_&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200862"><span class="hs-identifier hs-var">prefix</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;VERSION_&quot;</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200861"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;(major1,major2,minor) (\\\n&quot;</span></span><span>
</span><span id="line-2160"></span><span>  </span><span class="hs-special">,</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;  (major1) &lt;  &quot;</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200858"><span class="hs-identifier hs-var">major1</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; || \\\n&quot;</span></span><span>
</span><span id="line-2161"></span><span>  </span><span class="hs-special">,</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;  (major1) == &quot;</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200858"><span class="hs-identifier hs-var">major1</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; &amp;&amp; (major2) &lt;  &quot;</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200857"><span class="hs-identifier hs-var">major2</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; || \\\n&quot;</span></span><span>
</span><span id="line-2162"></span><span>  </span><span class="hs-special">,</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;  (major1) == &quot;</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200858"><span class="hs-identifier hs-var">major1</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; &amp;&amp; (major2) == &quot;</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200857"><span class="hs-identifier hs-var">major2</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; &amp;&amp; (minor) &lt;= &quot;</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200856"><span class="hs-identifier hs-var">minor</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;)&quot;</span></span><span>
</span><span id="line-2163"></span><span>  </span><span class="hs-special">,</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\n\n&quot;</span></span><span>
</span><span id="line-2164"></span><span>  </span><span class="hs-special">]</span><span>
</span><span id="line-2165"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2166"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681200858"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200858"><span class="hs-identifier hs-var">major1</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681200857"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200857"><span class="hs-identifier hs-var">major2</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681200856"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200856"><span class="hs-identifier hs-var">minor</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[String]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Int -&gt; String) -&gt; [Int] -&gt; [String]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../base/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Version -&gt; [Int]
</span><a href="../../base/src/Data.Version.html#versionBranch"><span class="hs-identifier hs-var hs-var">versionBranch</span></a></span><span> </span><span class="annot"><span class="annottext">Version
</span><a href="#local-6989586621681200860"><span class="hs-identifier hs-var">version</span></a></span><span> </span><span class="annot"><span class="annottext">[Int] -&gt; [Int] -&gt; [Int]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; [Int]
forall a. a -&gt; [a]
</span><a href="../../base/src/GHC.List.html#repeat"><span class="hs-identifier hs-var">repeat</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span>
</span><span id="line-2167"></span><span>
</span><span id="line-2168"></span><span class="hs-comment">-- ---------------------------------------------------------------------------</span><span>
</span><span id="line-2169"></span><span class="hs-comment">-- join object files into a single relocatable object file, using ld -r</span><span>
</span><span id="line-2170"></span><span>
</span><span id="line-2171"></span><span class="hs-comment">{-
Note [Produce big objects on Windows]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The Windows Portable Executable object format has a limit of 32k sections, which
we tend to blow through pretty easily. Thankfully, there is a &quot;big object&quot;
extension, which raises this limit to 2^32. However, it must be explicitly
enabled in the toolchain:

 * the assembler accepts the -mbig-obj flag, which causes it to produce a
   bigobj-enabled COFF object.

 * the linker accepts the --oformat pe-bigobj-x86-64 flag. Despite what the name
   suggests, this tells the linker to produce a bigobj-enabled COFF object, no a
   PE executable.

We must enable bigobj output in a few places:

 * When merging object files (GHC.Driver.Pipeline.joinObjectFiles)

 * When assembling (GHC.Driver.Pipeline.runPhase (RealPhase As ...))

Unfortunately the big object format is not supported on 32-bit targets so
none of this can be used in that case.


Note [Merging object files for GHCi]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
GHCi can usually loads standard linkable object files using GHC's linker
implementation. However, most users build their projects with -split-sections,
meaning that such object files can have an extremely high number of sections.
As the linker must map each of these sections individually, loading such object
files is very inefficient.

To avoid this inefficiency, we use the linker's `-r` flag and a linker script
to produce a merged relocatable object file. This file will contain a singe
text section section and can consequently be mapped far more efficiently. As
gcc tends to do unpredictable things to our linker command line, we opt to
invoke ld directly in this case, in contrast to our usual strategy of linking
via gcc.

-}</span><span>
</span><span id="line-2213"></span><span>
</span><span id="line-2214"></span><span class="annot"><a href="GHC.Driver.Pipeline.html#joinObjectFiles"><span class="hs-identifier hs-type">joinObjectFiles</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../base/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2215"></span><span id="joinObjectFiles"><span class="annot"><span class="annottext">joinObjectFiles :: DynFlags -&gt; [String] -&gt; String -&gt; IO ()
</span><a href="GHC.Driver.Pipeline.html#joinObjectFiles"><span class="hs-identifier hs-var hs-var">joinObjectFiles</span></a></span></span><span> </span><span id="local-6989586621681200851"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200851"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621681200850"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681200850"><span class="hs-identifier hs-var">o_files</span></a></span></span><span> </span><span id="local-6989586621681200849"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200849"><span class="hs-identifier hs-var">output_fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2216"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681200848"><span class="annot"><span class="annottext">toolSettings' :: ToolSettings
</span><a href="#local-6989586621681200848"><span class="hs-identifier hs-var hs-var">toolSettings'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; ToolSettings
</span><a href="GHC.Driver.Session.html#toolSettings"><span class="hs-identifier hs-var hs-var">toolSettings</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200851"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-2217"></span><span>      </span><span id="local-6989586621681200847"><span class="annot"><span class="annottext">ldIsGnuLd :: Bool
</span><a href="#local-6989586621681200847"><span class="hs-identifier hs-var hs-var">ldIsGnuLd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ToolSettings -&gt; Bool
</span><a href="GHC.Settings.html#toolSettings_ldIsGnuLd"><span class="hs-identifier hs-var hs-var">toolSettings_ldIsGnuLd</span></a></span><span> </span><span class="annot"><span class="annottext">ToolSettings
</span><a href="#local-6989586621681200848"><span class="hs-identifier hs-var">toolSettings'</span></a></span><span>
</span><span id="line-2218"></span><span>      </span><span id="local-6989586621681200846"><span class="annot"><span class="annottext">osInfo :: OS
</span><a href="#local-6989586621681200846"><span class="hs-identifier hs-var hs-var">osInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Platform -&gt; OS
</span><a href="../../ghc-boot/src/GHC.Platform.html#platformOS"><span class="hs-identifier hs-var">platformOS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.Session.html#targetPlatform"><span class="hs-identifier hs-var hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200851"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2219"></span><span>      </span><span id="local-6989586621681200843"><span class="annot"><span class="annottext">ld_r :: [Option] -&gt; IO ()
</span><a href="#local-6989586621681200843"><span class="hs-identifier hs-var hs-var">ld_r</span></a></span></span><span> </span><span id="local-6989586621681200842"><span class="annot"><span class="annottext">[Option]
</span><a href="#local-6989586621681200842"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [Option] -&gt; IO ()
</span><a href="GHC.SysTools.Tasks.html#runMergeObjects"><span class="hs-identifier hs-var">GHC.SysTools.runMergeObjects</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200851"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-2220"></span><span>                        </span><span class="hs-comment">-- See Note [Produce big objects on Windows]</span><span>
</span><span id="line-2221"></span><span>                        </span><span class="annot"><span class="annottext">[[Option]] -&gt; [Option]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><a href="../../base/src/Data.Foldable.html#concat"><span class="hs-identifier hs-var">concat</span></a></span><span>
</span><span id="line-2222"></span><span>                          </span><span class="hs-special">[</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;--oformat&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;pe-bigobj-x86-64&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-2223"></span><span>                          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="../../ghc-boot/src/GHC.Platform.html#OSMinGW32"><span class="hs-identifier hs-var">OSMinGW32</span></a></span><span> </span><span class="annot"><span class="annottext">OS -&gt; OS -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">OS
</span><a href="#local-6989586621681200846"><span class="hs-identifier hs-var">osInfo</span></a></span><span>
</span><span id="line-2224"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Platform -&gt; Bool
</span><a href="../../ghc-boot/src/GHC.Platform.html#target32Bit"><span class="hs-identifier hs-var">target32Bit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Platform
</span><a href="GHC.Driver.Session.html#targetPlatform"><span class="hs-identifier hs-var hs-var">targetPlatform</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200851"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2225"></span><span>                          </span><span class="hs-special">]</span><span>
</span><span id="line-2226"></span><span>                     </span><span class="annot"><span class="annottext">[Option] -&gt; [Option] -&gt; [Option]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Option) -&gt; [String] -&gt; [Option]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681200840"><span class="hs-identifier hs-var">ld_build_id</span></a></span><span>
</span><span id="line-2227"></span><span>                     </span><span class="annot"><span class="annottext">[Option] -&gt; [Option] -&gt; [Option]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-o&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-2228"></span><span>                          </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#FileOption"><span class="hs-identifier hs-var">GHC.SysTools.FileOption</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200849"><span class="hs-identifier hs-var">output_fn</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2229"></span><span>                     </span><span class="annot"><span class="annottext">[Option] -&gt; [Option] -&gt; [Option]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Option]
</span><a href="#local-6989586621681200842"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2230"></span><span>
</span><span id="line-2231"></span><span>      </span><span class="hs-comment">-- suppress the generation of the .note.gnu.build-id section,</span><span>
</span><span id="line-2232"></span><span>      </span><span class="hs-comment">-- which we don't need and sometimes causes ld to emit a</span><span>
</span><span id="line-2233"></span><span>      </span><span class="hs-comment">-- warning:</span><span>
</span><span id="line-2234"></span><span>      </span><span id="local-6989586621681200840"><span class="annot"><span class="annottext">ld_build_id :: [String]
</span><a href="#local-6989586621681200840"><span class="hs-identifier hs-var hs-var">ld_build_id</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ToolSettings -&gt; Bool
</span><a href="GHC.Settings.html#toolSettings_ldSupportsBuildId"><span class="hs-identifier hs-var hs-var">toolSettings_ldSupportsBuildId</span></a></span><span> </span><span class="annot"><span class="annottext">ToolSettings
</span><a href="#local-6989586621681200848"><span class="hs-identifier hs-var">toolSettings'</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;--build-id=none&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-2235"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>                     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2236"></span><span>
</span><span id="line-2237"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681200847"><span class="hs-identifier hs-var">ldIsGnuLd</span></a></span><span>
</span><span id="line-2238"></span><span>     </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2239"></span><span>          </span><span id="local-6989586621681200838"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200838"><span class="hs-identifier hs-var">script</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; TempFileLifetime -&gt; String -&gt; IO String
</span><a href="GHC.SysTools.FileCleanup.html#newTempName"><span class="hs-identifier hs-var">newTempName</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200851"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">TempFileLifetime
</span><a href="GHC.SysTools.FileCleanup.html#TFL_CurrentModule"><span class="hs-identifier hs-var">TFL_CurrentModule</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ldscript&quot;</span></span><span>
</span><span id="line-2240"></span><span>          </span><span id="local-6989586621681200837"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200837"><span class="hs-identifier hs-var">cwd</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO String
</span><a href="../../directory/src/System.Directory.html#getCurrentDirectory"><span class="hs-identifier hs-var">getCurrentDirectory</span></a></span><span>
</span><span id="line-2241"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681200836"><span class="annot"><span class="annottext">o_files_abs :: [String]
</span><a href="#local-6989586621681200836"><span class="hs-identifier hs-var hs-var">o_files_abs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(String -&gt; String) -&gt; [String] -&gt; [String]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681200835"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200835"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200837"><span class="hs-identifier hs-var">cwd</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><a href="../../filepath/src/System.FilePath.Windows.html#%3C%2F%3E"><span class="hs-operator hs-var">&lt;/&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200835"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\&quot;&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681200850"><span class="hs-identifier hs-var">o_files</span></a></span><span>
</span><span id="line-2242"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; String -&gt; IO ()
</span><a href="../../base/src/System.IO.html#writeFile"><span class="hs-identifier hs-var">writeFile</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200838"><span class="hs-identifier hs-var">script</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ()) -&gt; String -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;INPUT(&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; String
</span><a href="../../base/src/Data.OldList.html#unwords"><span class="hs-identifier hs-var">unwords</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681200836"><span class="hs-identifier hs-var">o_files_abs</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;)&quot;</span></span><span>
</span><span id="line-2243"></span><span>          </span><span class="annot"><span class="annottext">[Option] -&gt; IO ()
</span><a href="#local-6989586621681200843"><span class="hs-identifier hs-var">ld_r</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String -&gt; String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#FileOption"><span class="hs-identifier hs-var">GHC.SysTools.FileOption</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200838"><span class="hs-identifier hs-var">script</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2244"></span><span>     </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">ToolSettings -&gt; Bool
</span><a href="GHC.Settings.html#toolSettings_ldSupportsFilelist"><span class="hs-identifier hs-var hs-var">toolSettings_ldSupportsFilelist</span></a></span><span> </span><span class="annot"><span class="annottext">ToolSettings
</span><a href="#local-6989586621681200848"><span class="hs-identifier hs-var">toolSettings'</span></a></span><span>
</span><span id="line-2245"></span><span>     </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2246"></span><span>          </span><span id="local-6989586621681200832"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200832"><span class="hs-identifier hs-var">filelist</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; TempFileLifetime -&gt; String -&gt; IO String
</span><a href="GHC.SysTools.FileCleanup.html#newTempName"><span class="hs-identifier hs-var">newTempName</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200851"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">TempFileLifetime
</span><a href="GHC.SysTools.FileCleanup.html#TFL_CurrentModule"><span class="hs-identifier hs-var">TFL_CurrentModule</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;filelist&quot;</span></span><span>
</span><span id="line-2247"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; String -&gt; IO ()
</span><a href="../../base/src/System.IO.html#writeFile"><span class="hs-identifier hs-var">writeFile</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200832"><span class="hs-identifier hs-var">filelist</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ()) -&gt; String -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; String
</span><a href="../../base/src/Data.OldList.html#unlines"><span class="hs-identifier hs-var">unlines</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681200850"><span class="hs-identifier hs-var">o_files</span></a></span><span>
</span><span id="line-2248"></span><span>          </span><span class="annot"><span class="annottext">[Option] -&gt; IO ()
</span><a href="#local-6989586621681200843"><span class="hs-identifier hs-var">ld_r</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#Option"><span class="hs-identifier hs-var">GHC.SysTools.Option</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;-filelist&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-2249"></span><span>                </span><span class="annot"><span class="annottext">String -&gt; String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#FileOption"><span class="hs-identifier hs-var">GHC.SysTools.FileOption</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200832"><span class="hs-identifier hs-var">filelist</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2250"></span><span>     </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2251"></span><span>          </span><span class="annot"><span class="annottext">[Option] -&gt; IO ()
</span><a href="#local-6989586621681200843"><span class="hs-identifier hs-var">ld_r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String -&gt; Option) -&gt; [String] -&gt; [Option]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; String -&gt; Option
</span><a href="GHC.Utils.CliOption.html#FileOption"><span class="hs-identifier hs-var">GHC.SysTools.FileOption</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681200850"><span class="hs-identifier hs-var">o_files</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2252"></span><span>
</span><span id="line-2253"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-2254"></span><span class="hs-comment">-- Misc.</span><span>
</span><span id="line-2255"></span><span>
</span><span id="line-2256"></span><span class="annot"><a href="GHC.Driver.Pipeline.html#writeInterfaceOnlyMode"><span class="hs-identifier hs-type">writeInterfaceOnlyMode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2257"></span><span id="writeInterfaceOnlyMode"><span class="annot"><span class="annottext">writeInterfaceOnlyMode :: DynFlags -&gt; Bool
</span><a href="GHC.Driver.Pipeline.html#writeInterfaceOnlyMode"><span class="hs-identifier hs-var hs-var">writeInterfaceOnlyMode</span></a></span></span><span> </span><span id="local-6989586621681200830"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200830"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2258"></span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_WriteInterface"><span class="hs-identifier hs-var">Opt_WriteInterface</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200830"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-2259"></span><span> </span><span class="annot"><span class="annottext">HscTarget
</span><a href="GHC.Driver.Session.html#HscNothing"><span class="hs-identifier hs-var">HscNothing</span></a></span><span> </span><span class="annot"><span class="annottext">HscTarget -&gt; HscTarget -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; HscTarget
</span><a href="GHC.Driver.Session.html#hscTarget"><span class="hs-identifier hs-var hs-var">hscTarget</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200830"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-2260"></span><span>
</span><span id="line-2261"></span><span class="hs-comment">-- | Figure out if a source file was modified after an output file (or if we</span><span>
</span><span id="line-2262"></span><span class="hs-comment">-- anyways need to consider the source file modified since the output is gone).</span><span>
</span><span id="line-2263"></span><span class="annot"><a href="GHC.Driver.Pipeline.html#sourceModified"><span class="hs-identifier hs-type">sourceModified</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-comment">-- ^ destination file we are looking for</span><span>
</span><span id="line-2264"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../time/src/Data.Time.Clock.Internal.UTCTime.html#UTCTime"><span class="hs-identifier hs-type">UTCTime</span></a></span><span>  </span><span class="hs-comment">-- ^ last time of modification of source file</span><span>
</span><span id="line-2265"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>  </span><span class="hs-comment">-- ^ do we need to regenerate the output?</span><span>
</span><span id="line-2266"></span><span id="sourceModified"><span class="annot"><span class="annottext">sourceModified :: String -&gt; UTCTime -&gt; IO Bool
</span><a href="GHC.Driver.Pipeline.html#sourceModified"><span class="hs-identifier hs-var hs-var">sourceModified</span></a></span></span><span> </span><span id="local-6989586621681200828"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200828"><span class="hs-identifier hs-var">dest_file</span></a></span></span><span> </span><span id="local-6989586621681200827"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621681200827"><span class="hs-identifier hs-var">src_timestamp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2267"></span><span>  </span><span id="local-6989586621681200826"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681200826"><span class="hs-identifier hs-var">dest_file_exists</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO Bool
</span><a href="../../directory/src/System.Directory.html#doesFileExist"><span class="hs-identifier hs-var">doesFileExist</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200828"><span class="hs-identifier hs-var">dest_file</span></a></span><span>
</span><span id="line-2268"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681200826"><span class="hs-identifier hs-var">dest_file_exists</span></a></span><span>
</span><span id="line-2269"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; IO Bool
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>       </span><span class="hs-comment">-- Need to recompile</span><span>
</span><span id="line-2270"></span><span>     </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621681200825"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621681200825"><span class="hs-identifier hs-var">t2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO UTCTime
</span><a href="GHC.Utils.Misc.html#getModificationUTCTime"><span class="hs-identifier hs-var">getModificationUTCTime</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200828"><span class="hs-identifier hs-var">dest_file</span></a></span><span>
</span><span id="line-2271"></span><span>             </span><span class="annot"><span class="annottext">Bool -&gt; IO Bool
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621681200825"><span class="hs-identifier hs-var">t2</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime -&gt; UTCTime -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;=</span></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621681200827"><span class="hs-identifier hs-var">src_timestamp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2272"></span><span>
</span><span id="line-2273"></span><span class="hs-comment">-- | What phase to run after one of the backend code generators has run</span><span>
</span><span id="line-2274"></span><span class="annot"><a href="GHC.Driver.Pipeline.html#hscPostBackendPhase"><span class="hs-identifier hs-type">hscPostBackendPhase</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Phases.html#HscSource"><span class="hs-identifier hs-type">HscSource</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#HscTarget"><span class="hs-identifier hs-type">HscTarget</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Phases.html#Phase"><span class="hs-identifier hs-type">Phase</span></a></span><span>
</span><span id="line-2275"></span><span id="hscPostBackendPhase"><span class="annot"><span class="annottext">hscPostBackendPhase :: HscSource -&gt; HscTarget -&gt; Phase
</span><a href="GHC.Driver.Pipeline.html#hscPostBackendPhase"><span class="hs-identifier hs-var hs-var">hscPostBackendPhase</span></a></span></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="GHC.Driver.Phases.html#HsBootFile"><span class="hs-identifier hs-var">HsBootFile</span></a></span><span> </span><span class="annot"><span class="annottext">HscTarget
</span><span class="hs-identifier">_</span></span><span>    </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#StopLn"><span class="hs-identifier hs-var">StopLn</span></a></span><span>
</span><span id="line-2276"></span><span class="annot"><a href="GHC.Driver.Pipeline.html#hscPostBackendPhase"><span class="hs-identifier hs-var">hscPostBackendPhase</span></a></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="GHC.Driver.Phases.html#HsigFile"><span class="hs-identifier hs-var">HsigFile</span></a></span><span> </span><span class="annot"><span class="annottext">HscTarget
</span><span class="hs-identifier">_</span></span><span>      </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#StopLn"><span class="hs-identifier hs-var">StopLn</span></a></span><span>
</span><span id="line-2277"></span><span class="annot"><a href="GHC.Driver.Pipeline.html#hscPostBackendPhase"><span class="hs-identifier hs-var">hscPostBackendPhase</span></a></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681200822"><span class="annot"><span class="annottext">HscTarget
</span><a href="#local-6989586621681200822"><span class="hs-identifier hs-var">hsc_lang</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2278"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HscTarget
</span><a href="#local-6989586621681200822"><span class="hs-identifier hs-var">hsc_lang</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2279"></span><span>        </span><span class="annot"><span class="annottext">HscTarget
</span><a href="GHC.Driver.Session.html#HscC"><span class="hs-identifier hs-var">HscC</span></a></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#HCc"><span class="hs-identifier hs-var">HCc</span></a></span><span>
</span><span id="line-2280"></span><span>        </span><span class="annot"><span class="annottext">HscTarget
</span><a href="GHC.Driver.Session.html#HscAsm"><span class="hs-identifier hs-var">HscAsm</span></a></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Phase
</span><a href="GHC.Driver.Phases.html#As"><span class="hs-identifier hs-var">As</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2281"></span><span>        </span><span class="annot"><span class="annottext">HscTarget
</span><a href="GHC.Driver.Session.html#HscLlvm"><span class="hs-identifier hs-var">HscLlvm</span></a></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#LlvmOpt"><span class="hs-identifier hs-var">LlvmOpt</span></a></span><span>
</span><span id="line-2282"></span><span>        </span><span class="annot"><span class="annottext">HscTarget
</span><a href="GHC.Driver.Session.html#HscNothing"><span class="hs-identifier hs-var">HscNothing</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#StopLn"><span class="hs-identifier hs-var">StopLn</span></a></span><span>
</span><span id="line-2283"></span><span>        </span><span class="annot"><span class="annottext">HscTarget
</span><a href="GHC.Driver.Session.html#HscInterpreted"><span class="hs-identifier hs-var">HscInterpreted</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Phase
</span><a href="GHC.Driver.Phases.html#StopLn"><span class="hs-identifier hs-var">StopLn</span></a></span><span>
</span><span id="line-2284"></span><span>
</span><span id="line-2285"></span><span class="annot"><a href="GHC.Driver.Pipeline.html#touchObjectFile"><span class="hs-identifier hs-type">touchObjectFile</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2286"></span><span id="touchObjectFile"><span class="annot"><span class="annottext">touchObjectFile :: DynFlags -&gt; String -&gt; IO ()
</span><a href="GHC.Driver.Pipeline.html#touchObjectFile"><span class="hs-identifier hs-var hs-var">touchObjectFile</span></a></span></span><span> </span><span id="local-6989586621681200819"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200819"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621681200818"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200818"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2287"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; String -&gt; IO ()
</span><a href="../../directory/src/System.Directory.html#createDirectoryIfMissing"><span class="hs-identifier hs-var">createDirectoryIfMissing</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ()) -&gt; String -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String
</span><a href="../../filepath/src/System.FilePath.Windows.html#takeDirectory"><span class="hs-identifier hs-var">takeDirectory</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200818"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-2288"></span><span>  </span><span class="annot"><span class="annottext">DynFlags -&gt; String -&gt; String -&gt; IO ()
</span><a href="GHC.SysTools.Tasks.html#touch"><span class="hs-identifier hs-var">GHC.SysTools.touch</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200819"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Touching object file&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200818"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-2289"></span><span>
</span><span id="line-2290"></span><span class="hs-comment">-- | Find out path to @ghcversion.h@ file</span><span>
</span><span id="line-2291"></span><span class="annot"><a href="GHC.Driver.Pipeline.html#getGhcVersionPathName"><span class="hs-identifier hs-type">getGhcVersionPathName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="../../base/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>
</span><span id="line-2292"></span><span id="getGhcVersionPathName"><span class="annot"><span class="annottext">getGhcVersionPathName :: DynFlags -&gt; IO String
</span><a href="GHC.Driver.Pipeline.html#getGhcVersionPathName"><span class="hs-identifier hs-var hs-var">getGhcVersionPathName</span></a></span></span><span> </span><span id="local-6989586621681200816"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200816"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2293"></span><span>  </span><span id="local-6989586621681200815"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681200815"><span class="hs-identifier hs-var">candidates</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Maybe String
</span><a href="GHC.Driver.Session.html#ghcVersionFile"><span class="hs-identifier hs-var hs-var">ghcVersionFile</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200816"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2294"></span><span>    </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681200813"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200813"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; IO [String]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200813"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2295"></span><span>    </span><span class="annot"><span class="annottext">Maybe String
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(String -&gt; String) -&gt; [String] -&gt; [String]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><a href="../../filepath/src/System.FilePath.Windows.html#%3C%2F%3E"><span class="hs-operator hs-var">&lt;/&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ghcversion.h&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([String] -&gt; [String]) -&gt; IO [String] -&gt; IO [String]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span>
</span><span id="line-2296"></span><span>               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; [UnitId] -&gt; IO [String]
</span><a href="GHC.Unit.State.html#getUnitIncludePath"><span class="hs-identifier hs-var">getUnitIncludePath</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681200816"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">UnitId
</span><a href="GHC.Unit.Types.html#rtsUnitId"><span class="hs-identifier hs-var">rtsUnitId</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2297"></span><span>
</span><span id="line-2298"></span><span>  </span><span id="local-6989586621681200812"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681200812"><span class="hs-identifier hs-var">found</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO Bool) -&gt; [String] -&gt; IO [String]
forall (m :: * -&gt; *) a.
Applicative m =&gt;
(a -&gt; m Bool) -&gt; [a] -&gt; m [a]
</span><a href="../../base/src/Control.Monad.html#filterM"><span class="hs-identifier hs-var">filterM</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO Bool
</span><a href="../../directory/src/System.Directory.html#doesFileExist"><span class="hs-identifier hs-var">doesFileExist</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681200815"><span class="hs-identifier hs-var">candidates</span></a></span><span>
</span><span id="line-2299"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681200812"><span class="hs-identifier hs-var">found</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2300"></span><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">GhcException -&gt; IO String
forall a. GhcException -&gt; IO a
</span><a href="GHC.Utils.Panic.html#throwGhcExceptionIO"><span class="hs-identifier hs-var">throwGhcExceptionIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; GhcException
</span><a href="GHC.Utils.Panic.html#InstallationError"><span class="hs-identifier hs-var">InstallationError</span></a></span><span>
</span><span id="line-2301"></span><span>                                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ghcversion.h missing; tried: &quot;</span></span><span>
</span><span id="line-2302"></span><span>                                      </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; String
forall a. [a] -&gt; [[a]] -&gt; [a]
</span><a href="../../base/src/Data.OldList.html#intercalate"><span class="hs-identifier hs-var">intercalate</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;, &quot;</span></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681200815"><span class="hs-identifier hs-var">candidates</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2303"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621681200810"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200810"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[String]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; IO String
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681200810"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-2304"></span><span>
</span><span id="line-2305"></span><span class="hs-comment">-- Note [-fPIC for assembler]</span><span>
</span><span id="line-2306"></span><span class="hs-comment">-- When compiling .c source file GHC's driver pipeline basically</span><span>
</span><span id="line-2307"></span><span class="hs-comment">-- does the following two things:</span><span>
</span><span id="line-2308"></span><span class="hs-comment">--   1. ${CC}              -S 'PIC_CFLAGS' source.c</span><span>
</span><span id="line-2309"></span><span class="hs-comment">--   2. ${CC} -x assembler -c 'PIC_CFLAGS' source.S</span><span>
</span><span id="line-2310"></span><span class="hs-comment">--</span><span>
</span><span id="line-2311"></span><span class="hs-comment">-- Why do we need to pass 'PIC_CFLAGS' both to C compiler and assembler?</span><span>
</span><span id="line-2312"></span><span class="hs-comment">-- Because on some architectures (at least sparc32) assembler also chooses</span><span>
</span><span id="line-2313"></span><span class="hs-comment">-- the relocation type!</span><span>
</span><span id="line-2314"></span><span class="hs-comment">-- Consider the following C module:</span><span>
</span><span id="line-2315"></span><span class="hs-comment">--</span><span>
</span><span id="line-2316"></span><span class="hs-comment">--     /* pic-sample.c */</span><span>
</span><span id="line-2317"></span><span class="hs-comment">--     int v;</span><span>
</span><span id="line-2318"></span><span class="hs-comment">--     void set_v (int n) { v = n; }</span><span>
</span><span id="line-2319"></span><span class="hs-comment">--     int  get_v (void)  { return v; }</span><span>
</span><span id="line-2320"></span><span class="hs-comment">--</span><span>
</span><span id="line-2321"></span><span class="hs-comment">--     $ gcc -S -fPIC pic-sample.c</span><span>
</span><span id="line-2322"></span><span class="hs-comment">--     $ gcc -c       pic-sample.s -o pic-sample.no-pic.o # incorrect binary</span><span>
</span><span id="line-2323"></span><span class="hs-comment">--     $ gcc -c -fPIC pic-sample.s -o pic-sample.pic.o    # correct binary</span><span>
</span><span id="line-2324"></span><span class="hs-comment">--</span><span>
</span><span id="line-2325"></span><span class="hs-comment">--     $ objdump -r -d pic-sample.pic.o    &gt; pic-sample.pic.o.od</span><span>
</span><span id="line-2326"></span><span class="hs-comment">--     $ objdump -r -d pic-sample.no-pic.o &gt; pic-sample.no-pic.o.od</span><span>
</span><span id="line-2327"></span><span class="hs-comment">--     $ diff -u pic-sample.pic.o.od pic-sample.no-pic.o.od</span><span>
</span><span id="line-2328"></span><span class="hs-comment">--</span><span>
</span><span id="line-2329"></span><span class="hs-comment">-- Most of architectures won't show any difference in this test, but on sparc32</span><span>
</span><span id="line-2330"></span><span class="hs-comment">-- the following assembly snippet:</span><span>
</span><span id="line-2331"></span><span class="hs-comment">--</span><span>
</span><span id="line-2332"></span><span class="hs-comment">--    sethi   %hi(_GLOBAL_OFFSET_TABLE_-8), %l7</span><span>
</span><span id="line-2333"></span><span class="hs-comment">--</span><span>
</span><span id="line-2334"></span><span class="hs-comment">-- generates two kinds or relocations, only 'R_SPARC_PC22' is correct:</span><span>
</span><span id="line-2335"></span><span class="hs-comment">--</span><span>
</span><span id="line-2336"></span><span class="hs-comment">--       3c:  2f 00 00 00     sethi  %hi(0), %l7</span><span>
</span><span id="line-2337"></span><span class="hs-comment">--    -                       3c: R_SPARC_PC22        _GLOBAL_OFFSET_TABLE_-0x8</span><span>
</span><span id="line-2338"></span><span class="hs-comment">--    +                       3c: R_SPARC_HI22        _GLOBAL_OFFSET_TABLE_-0x8</span><span>
</span><span id="line-2339"></span><span>
</span><span id="line-2340"></span><span class="hs-comment">{- Note [Don't normalise input filenames]

Summary
  We used to normalise input filenames when starting the unlit phase. This
  broke hpc in `--make` mode with imported literate modules (#2991).

Introduction
  1) --main
  When compiling a module with --main, GHC scans its imports to find out which
  other modules it needs to compile too. It turns out that there is a small
  difference between saying `ghc --make A.hs`, when `A` imports `B`, and
  specifying both modules on the command line with `ghc --make A.hs B.hs`. In
  the former case, the filename for B is inferred to be './B.hs' instead of
  'B.hs'.

  2) unlit
  When GHC compiles a literate haskell file, the source code first needs to go
  through unlit, which turns it into normal Haskell source code. At the start
  of the unlit phase, in `Driver.Pipeline.runPhase`, we call unlit with the
  option `-h` and the name of the original file. We used to normalise this
  filename using System.FilePath.normalise, which among other things removes
  an initial './'. unlit then uses that filename in #line directives that it
  inserts in the transformed source code.

  3) SrcSpan
  A SrcSpan represents a portion of a source code file. It has fields
  linenumber, start column, end column, and also a reference to the file it
  originated from. The SrcSpans for a literate haskell file refer to the
  filename that was passed to unlit -h.

  4) -fhpc
  At some point during compilation with -fhpc, in the function
  `GHC.HsToCore.Coverage.isGoodTickSrcSpan`, we compare the filename that a
  `SrcSpan` refers to with the name of the file we are currently compiling.
  For some reason I don't yet understand, they can sometimes legitimally be
  different, and then hpc ignores that SrcSpan.

Problem
  When running `ghc --make -fhpc A.hs`, where `A.hs` imports the literate
  module `B.lhs`, `B` is inferred to be in the file `./B.lhs` (1). At the
  start of the unlit phase, the name `./B.lhs` is normalised to `B.lhs` (2).
  Therefore the SrcSpans of `B` refer to the file `B.lhs` (3), but we are
  still compiling `./B.lhs`. Hpc thinks these two filenames are different (4),
  doesn't include ticks for B, and we have unhappy customers (#2991).

Solution
  Do not normalise `input_fn` when starting the unlit phase.

Alternative solution
  Another option would be to not compare the two filenames on equality, but to
  use System.FilePath.equalFilePath. That function first normalises its
  arguments. The problem is that by the time we need to do the comparison, the
  filenames have been turned into FastStrings, probably for performance
  reasons, so System.FilePath.equalFilePath can not be used directly.

Archeology
  The call to `normalise` was added in a commit called &quot;Fix slash
  direction on Windows with the new filePath code&quot; (c9b6b5e8). The problem
  that commit was addressing has since been solved in a different manner, in a
  commit called &quot;Fix the filename passed to unlit&quot; (1eedbc6b). So the
  `normalise` is no longer necessary.
-}</span><span>
</span><span id="line-2402"></span></pre></body></html>