<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-
(c) The University of Glasgow 2006
(c) The AQUA Project, Glasgow University, 1996-1998

-}</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE CPP, TupleSections, ScopedTypeVariables, MultiWayIf #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE ViewPatterns #-}</span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-incomplete-uni-patterns #-}</span><span>
</span><span id="line-12"></span><span>
</span><span id="line-13"></span><span class="hs-comment">-- | Typecheck type and class declarations</span><span>
</span><span id="line-14"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">GHC.Tc.TyCl</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-15"></span><span>        </span><span class="annot"><a href="GHC.Tc.TyCl.html#tcTyAndClassDecls"><span class="hs-identifier">tcTyAndClassDecls</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>
</span><span id="line-17"></span><span>        </span><span class="hs-comment">-- Functions used by GHC.Tc.TyCl.Instance to check</span><span>
</span><span id="line-18"></span><span>        </span><span class="hs-comment">-- data/type family instance declarations</span><span>
</span><span id="line-19"></span><span>        </span><span class="annot"><a href="GHC.Tc.TyCl.html#kcConDecls"><span class="hs-identifier">kcConDecls</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.TyCl.html#tcConDecls"><span class="hs-identifier">tcConDecls</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.TyCl.html#dataDeclChecks"><span class="hs-identifier">dataDeclChecks</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.TyCl.html#checkValidTyCon"><span class="hs-identifier">checkValidTyCon</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>        </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#tcFamTyPats"><span class="hs-identifier">tcFamTyPats</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.TyCl.html#tcTyFamInstEqn"><span class="hs-identifier">tcTyFamInstEqn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>        </span><span class="annot"><a href="GHC.Tc.TyCl.html#tcAddTyFamInstCtxt"><span class="hs-identifier">tcAddTyFamInstCtxt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.TyCl.html#tcMkDataFamInstCtxt"><span class="hs-identifier">tcMkDataFamInstCtxt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.TyCl.html#tcAddDataFamInstCtxt"><span class="hs-identifier">tcAddDataFamInstCtxt</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>        </span><span class="annot"><a href="GHC.Tc.TyCl.html#unravelFamInstPats"><span class="hs-identifier">unravelFamInstPats</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.TyCl.html#addConsistencyConstraints"><span class="hs-identifier">addConsistencyConstraints</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>        </span><span class="annot"><a href="GHC.Tc.TyCl.html#wrongKindOfFamily"><span class="hs-identifier">wrongKindOfFamily</span></a></span><span>
</span><span id="line-24"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span class="hs-cpp">

#include &quot;HsVersions.h&quot;
</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Hs.html"><span class="hs-identifier">GHC.Hs</span></a></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html"><span class="hs-identifier">GHC.Driver.Types</span></a></span><span>
</span><span id="line-32"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.TyCl.Build.html"><span class="hs-identifier">GHC.Tc.TyCl.Build</span></a></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html"><span class="hs-identifier">GHC.Tc.Utils.Monad</span></a></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html"><span class="hs-identifier">GHC.Tc.Utils.Env</span></a></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Validity.html"><span class="hs-identifier">GHC.Tc.Validity</span></a></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Zonk.html"><span class="hs-identifier">GHC.Tc.Utils.Zonk</span></a></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.TyCl.Utils.html"><span class="hs-identifier">GHC.Tc.TyCl.Utils</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.TyCl.Class.html"><span class="hs-identifier">GHC.Tc.TyCl.Class</span></a></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><a href="GHC.Tc.TyCl.Instance.html"><span class="hs-identifier">GHC.Tc.TyCl.Instance</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.TyCl.Instance.html#tcInstDecls1"><span class="hs-identifier">tcInstDecls1</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Deriv.html"><span class="hs-identifier">GHC.Tc.Deriv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Deriv.html#DerivInfo"><span class="hs-identifier">DerivInfo</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html"><span class="hs-identifier">GHC.Tc.Utils.Unify</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html#checkTvConstraints"><span class="hs-identifier">checkTvConstraints</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html"><span class="hs-identifier">GHC.Tc.Gen.HsType</span></a></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html"><span class="hs-identifier">GHC.Tc.Instance.Class</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#AssocInstInfo"><span class="hs-identifier">AssocInstInfo</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html"><span class="hs-identifier">GHC.Tc.Utils.TcMType</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html"><span class="hs-identifier">GHC.Builtin.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Builtin.Types.html#oneDataConTy"><span class="hs-identifier">oneDataConTy</span></a></span><span class="hs-special">,</span><span>  </span><span class="annot"><a href="GHC.Builtin.Types.html#unitTy"><span class="hs-identifier">unitTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html#makeRecoveryTyCon"><span class="hs-identifier">makeRecoveryTyCon</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html"><span class="hs-identifier">GHC.Tc.Utils.TcType</span></a></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Multiplicity.html"><span class="hs-identifier">GHC.Core.Multiplicity</span></a></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html"><span class="hs-identifier">GHC.Rename.Env</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#lookupConstructorFields"><span class="hs-identifier">lookupConstructorFields</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Family.html"><span class="hs-identifier">GHC.Tc.Instance.Family</span></a></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html"><span class="hs-identifier">GHC.Core.FamInstEnv</span></a></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html"><span class="hs-identifier">GHC.Core.Coercion</span></a></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html"><span class="hs-identifier">GHC.Tc.Types.Origin</span></a></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Type.html"><span class="hs-identifier">GHC.Core.Type</span></a></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html"><span class="hs-identifier">GHC.Core.TyCo.Rep</span></a></span><span>   </span><span class="hs-comment">-- for checkValidRoles</span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Ppr.html"><span class="hs-identifier">GHC.Core.TyCo.Ppr</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Ppr.html#pprTyVars"><span class="hs-identifier">pprTyVars</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Class.html"><span class="hs-identifier">GHC.Core.Class</span></a></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html"><span class="hs-identifier">GHC.Core.Coercion.Axiom</span></a></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html"><span class="hs-identifier">GHC.Core.TyCon</span></a></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html"><span class="hs-identifier">GHC.Core.DataCon</span></a></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.html"><span class="hs-identifier">GHC.Types.Id</span></a></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.html"><span class="hs-identifier">GHC.Types.Var</span></a></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html"><span class="hs-identifier">GHC.Types.Var.Env</span></a></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html"><span class="hs-identifier">GHC.Types.Var.Set</span></a></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.html"><span class="hs-identifier">GHC.Unit.Module</span></a></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.State.html"><span class="hs-identifier">GHC.Unit.State</span></a></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.html"><span class="hs-identifier">GHC.Types.Name</span></a></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html"><span class="hs-identifier">GHC.Types.Name.Set</span></a></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Env.html"><span class="hs-identifier">GHC.Types.Name.Env</span></a></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html"><span class="hs-identifier">GHC.Data.Maybe</span></a></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Unify.html"><span class="hs-identifier">GHC.Core.Unify</span></a></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html"><span class="hs-identifier">GHC.Types.SrcLoc</span></a></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.List.SetOps.html"><span class="hs-identifier">GHC.Data.List.SetOps</span></a></span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html"><span class="hs-identifier">GHC.Driver.Session</span></a></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.html"><span class="hs-identifier">GHC.Types.Unique</span></a></span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.ConLike.html"><span class="hs-identifier">GHC.Core.ConLike</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.ConLike.html#ConLike"><span class="hs-identifier">ConLike</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html"><span class="hs-identifier">GHC.Types.Basic</span></a></span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../ghc-boot/src/GHC.LanguageExtensions.html#"><span class="hs-identifier">GHC.LanguageExtensions</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LangExt</span></span><span>
</span><span id="line-80"></span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base/src/Control.Monad.html#"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base/src/Data.Function.html#"><span class="hs-identifier">Data.Function</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../base/src/Data.Function.html#on"><span class="hs-identifier">on</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base/src/Data.Functor.Identity.html#"><span class="hs-identifier">Data.Functor.Identity</span></a></span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base/src/Data.List.html#"><span class="hs-identifier">Data.List</span></a></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base/src/Data.List.NonEmpty.html#"><span class="hs-identifier">Data.List.NonEmpty</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../base/src/GHC.Base.html#NonEmpty"><span class="hs-identifier">NonEmpty</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../containers/src/Data.Set.html#"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base/src/Data.Tuple.html#"><span class="hs-identifier">Data.Tuple</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../base/src/Data.Tuple.html#swap"><span class="hs-identifier">swap</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Type checking for type and class declarations}
*                                                                      *
************************************************************************

Note [Grouping of type and class declarations]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
tcTyAndClassDecls is called on a list of `TyClGroup`s. Each group is a strongly
connected component of mutually dependent types and classes. We kind check and
type check each group separately to enhance kind polymorphism. Take the
following example:

  type Id a = a
  data X = X (Id Int)

If we were to kind check the two declarations together, we would give Id the
kind * -&gt; *, since we apply it to an Int in the definition of X. But we can do
better than that, since Id really is kind polymorphic, and should get kind
forall (k::*). k -&gt; k. Since it does not depend on anything else, it can be
kind-checked by itself, hence getting the most general kind. We then kind check
X, which works fine because we then know the polymorphic kind of Id, and simply
instantiate k to *.

Note [Check role annotations in a second pass]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Role inference potentially depends on the types of all of the datacons declared
in a mutually recursive group. The validity of a role annotation, in turn,
depends on the result of role inference. Because the types of datacons might
be ill-formed (see #7175 and Note [Checking GADT return types]) we must check
*all* the tycons in a group for validity before checking *any* of the roles.
Thus, we take two passes over the resulting tycons, first checking for general
validity and then checking for valid role annotations.
-}</span><span>
</span><span id="line-124"></span><span>
</span><span id="line-125"></span><span class="annot"><a href="GHC.Tc.TyCl.html#tcTyAndClassDecls"><span class="hs-identifier hs-type">tcTyAndClassDecls</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Hs.Decls.html#TyClGroup"><span class="hs-identifier hs-type">TyClGroup</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span>      </span><span class="hs-comment">-- Mutually-recursive groups in</span><span>
</span><span id="line-126"></span><span>                                            </span><span class="hs-comment">-- dependency order</span><span>
</span><span id="line-127"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span>         </span><span class="hs-comment">-- Input env extended by types and</span><span>
</span><span id="line-128"></span><span>                                            </span><span class="hs-comment">-- classes</span><span>
</span><span id="line-129"></span><span>                                            </span><span class="hs-comment">-- and their implicit Ids,DataCons</span><span>
</span><span id="line-130"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.Env.html#InstInfo"><span class="hs-identifier hs-type">InstInfo</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- Source-code instance decls info</span><span>
</span><span id="line-131"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Deriv.html#DerivInfo"><span class="hs-identifier hs-type">DerivInfo</span></a></span><span class="hs-special">]</span><span>      </span><span class="hs-comment">-- Deriving info</span><span>
</span><span id="line-132"></span><span>                         </span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span class="hs-comment">-- Fails if there are any errors</span><span>
</span><span id="line-134"></span><span id="tcTyAndClassDecls"><span class="annot"><span class="annottext">tcTyAndClassDecls :: [TyClGroup GhcRn] -&gt; TcM (TcGblEnv, [InstInfo GhcRn], [DerivInfo])
</span><a href="GHC.Tc.TyCl.html#tcTyAndClassDecls"><span class="hs-identifier hs-var hs-var">tcTyAndClassDecls</span></a></span></span><span> </span><span id="local-6989586621681166754"><span class="annot"><span class="annottext">[TyClGroup GhcRn]
</span><a href="#local-6989586621681166754"><span class="hs-identifier hs-var">tyclds_s</span></a></span></span><span>
</span><span id="line-135"></span><span>  </span><span class="hs-comment">-- The code recovers internally, but if anything gave rise to</span><span>
</span><span id="line-136"></span><span>  </span><span class="hs-comment">-- an error we'd better stop now, to avoid a cascade</span><span>
</span><span id="line-137"></span><span>  </span><span class="hs-comment">-- Type check each group in dependency order folding the global env</span><span>
</span><span id="line-138"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM (TcGblEnv, [InstInfo GhcRn], [DerivInfo])
-&gt; TcM (TcGblEnv, [InstInfo GhcRn], [DerivInfo])
forall r. TcM r -&gt; TcM r
</span><a href="GHC.Tc.Utils.Monad.html#checkNoErrs"><span class="hs-identifier hs-var">checkNoErrs</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (TcGblEnv, [InstInfo GhcRn], [DerivInfo])
 -&gt; TcM (TcGblEnv, [InstInfo GhcRn], [DerivInfo]))
-&gt; TcM (TcGblEnv, [InstInfo GhcRn], [DerivInfo])
-&gt; TcM (TcGblEnv, [InstInfo GhcRn], [DerivInfo])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[InstInfo GhcRn]
-&gt; [DerivInfo]
-&gt; [TyClGroup GhcRn]
-&gt; TcM (TcGblEnv, [InstInfo GhcRn], [DerivInfo])
</span><a href="#local-6989586621681166752"><span class="hs-identifier hs-var">fold_env</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[TyClGroup GhcRn]
</span><a href="#local-6989586621681166754"><span class="hs-identifier hs-var">tyclds_s</span></a></span><span>
</span><span id="line-139"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-140"></span><span>    </span><span class="annot"><a href="#local-6989586621681166752"><span class="hs-identifier hs-type">fold_env</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.Env.html#InstInfo"><span class="hs-identifier hs-type">InstInfo</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-141"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Deriv.html#DerivInfo"><span class="hs-identifier hs-type">DerivInfo</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-142"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Hs.Decls.html#TyClGroup"><span class="hs-identifier hs-type">TyClGroup</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-143"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.Env.html#InstInfo"><span class="hs-identifier hs-type">InstInfo</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Deriv.html#DerivInfo"><span class="hs-identifier hs-type">DerivInfo</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-144"></span><span>    </span><span id="local-6989586621681166752"><span class="annot"><span class="annottext">fold_env :: [InstInfo GhcRn]
-&gt; [DerivInfo]
-&gt; [TyClGroup GhcRn]
-&gt; TcM (TcGblEnv, [InstInfo GhcRn], [DerivInfo])
</span><a href="#local-6989586621681166752"><span class="hs-identifier hs-var hs-var">fold_env</span></a></span></span><span> </span><span id="local-6989586621681166751"><span class="annot"><span class="annottext">[InstInfo GhcRn]
</span><a href="#local-6989586621681166751"><span class="hs-identifier hs-var">inst_info</span></a></span></span><span> </span><span id="local-6989586621681166750"><span class="annot"><span class="annottext">[DerivInfo]
</span><a href="#local-6989586621681166750"><span class="hs-identifier hs-var">deriv_info</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-145"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681166749"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681166749"><span class="hs-identifier hs-var">gbl_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-146"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(TcGblEnv, [InstInfo GhcRn], [DerivInfo])
-&gt; TcM (TcGblEnv, [InstInfo GhcRn], [DerivInfo])
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681166749"><span class="hs-identifier hs-var">gbl_env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[InstInfo GhcRn]
</span><a href="#local-6989586621681166751"><span class="hs-identifier hs-var">inst_info</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[DerivInfo]
</span><a href="#local-6989586621681166750"><span class="hs-identifier hs-var">deriv_info</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-147"></span><span>    </span><span class="annot"><a href="#local-6989586621681166752"><span class="hs-identifier hs-var">fold_env</span></a></span><span> </span><span id="local-6989586621681166747"><span class="annot"><span class="annottext">[InstInfo GhcRn]
</span><a href="#local-6989586621681166747"><span class="hs-identifier hs-var">inst_info</span></a></span></span><span> </span><span id="local-6989586621681166746"><span class="annot"><span class="annottext">[DerivInfo]
</span><a href="#local-6989586621681166746"><span class="hs-identifier hs-var">deriv_info</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681166745"><span class="annot"><span class="annottext">TyClGroup GhcRn
</span><a href="#local-6989586621681166745"><span class="hs-identifier hs-var">tyclds</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681166744"><span class="annot"><span class="annottext">[TyClGroup GhcRn]
</span><a href="#local-6989586621681166744"><span class="hs-identifier hs-var">tyclds_s</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-148"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681166743"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681166743"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681166742"><span class="annot"><span class="annottext">[InstInfo GhcRn]
</span><a href="#local-6989586621681166742"><span class="hs-identifier hs-var">inst_info'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681166741"><span class="annot"><span class="annottext">[DerivInfo]
</span><a href="#local-6989586621681166741"><span class="hs-identifier hs-var">deriv_info'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyClGroup GhcRn -&gt; TcM (TcGblEnv, [InstInfo GhcRn], [DerivInfo])
</span><a href="GHC.Tc.TyCl.html#tcTyClGroup"><span class="hs-identifier hs-var">tcTyClGroup</span></a></span><span> </span><span class="annot"><span class="annottext">TyClGroup GhcRn
</span><a href="#local-6989586621681166745"><span class="hs-identifier hs-var">tyclds</span></a></span><span>
</span><span id="line-149"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcGblEnv
-&gt; TcM (TcGblEnv, [InstInfo GhcRn], [DerivInfo])
-&gt; TcM (TcGblEnv, [InstInfo GhcRn], [DerivInfo])
forall gbl lcl a. gbl -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#setGblEnv"><span class="hs-identifier hs-var">setGblEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681166743"><span class="hs-identifier hs-var">tcg_env</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (TcGblEnv, [InstInfo GhcRn], [DerivInfo])
 -&gt; TcM (TcGblEnv, [InstInfo GhcRn], [DerivInfo]))
-&gt; TcM (TcGblEnv, [InstInfo GhcRn], [DerivInfo])
-&gt; TcM (TcGblEnv, [InstInfo GhcRn], [DerivInfo])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-150"></span><span>               </span><span class="hs-comment">-- remaining groups are typechecked in the extended global env.</span><span>
</span><span id="line-151"></span><span>             </span><span class="annot"><span class="annottext">[InstInfo GhcRn]
-&gt; [DerivInfo]
-&gt; [TyClGroup GhcRn]
-&gt; TcM (TcGblEnv, [InstInfo GhcRn], [DerivInfo])
</span><a href="#local-6989586621681166752"><span class="hs-identifier hs-var">fold_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[InstInfo GhcRn]
</span><a href="#local-6989586621681166742"><span class="hs-identifier hs-var">inst_info'</span></a></span><span> </span><span class="annot"><span class="annottext">[InstInfo GhcRn] -&gt; [InstInfo GhcRn] -&gt; [InstInfo GhcRn]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[InstInfo GhcRn]
</span><a href="#local-6989586621681166747"><span class="hs-identifier hs-var">inst_info</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-152"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[DerivInfo]
</span><a href="#local-6989586621681166741"><span class="hs-identifier hs-var">deriv_info'</span></a></span><span> </span><span class="annot"><span class="annottext">[DerivInfo] -&gt; [DerivInfo] -&gt; [DerivInfo]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[DerivInfo]
</span><a href="#local-6989586621681166746"><span class="hs-identifier hs-var">deriv_info</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-153"></span><span>                      </span><span class="annot"><span class="annottext">[TyClGroup GhcRn]
</span><a href="#local-6989586621681166744"><span class="hs-identifier hs-var">tyclds_s</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span class="annot"><a href="GHC.Tc.TyCl.html#tcTyClGroup"><span class="hs-identifier hs-type">tcTyClGroup</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Decls.html#TyClGroup"><span class="hs-identifier hs-type">TyClGroup</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-156"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.Env.html#InstInfo"><span class="hs-identifier hs-type">InstInfo</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Deriv.html#DerivInfo"><span class="hs-identifier hs-type">DerivInfo</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-157"></span><span class="hs-comment">-- Typecheck one strongly-connected component of type, class, and instance decls</span><span>
</span><span id="line-158"></span><span class="hs-comment">-- See Note [TyClGroups and dependency analysis] in GHC.Hs.Decls</span><span>
</span><span id="line-159"></span><span id="tcTyClGroup"><span class="annot"><span class="annottext">tcTyClGroup :: TyClGroup GhcRn -&gt; TcM (TcGblEnv, [InstInfo GhcRn], [DerivInfo])
</span><a href="GHC.Tc.TyCl.html#tcTyClGroup"><span class="hs-identifier hs-var hs-var">tcTyClGroup</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Decls.html#TyClGroup"><span class="hs-identifier hs-type">TyClGroup</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">group_tyclds :: forall pass. TyClGroup pass -&gt; [LTyClDecl pass]
</span><a href="GHC.Hs.Decls.html#group_tyclds"><span class="hs-identifier hs-var">group_tyclds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681166736"><span class="annot"><span class="annottext">[LTyClDecl GhcRn]
</span><a href="#local-6989586621681166736"><span class="hs-identifier hs-var">tyclds</span></a></span></span><span>
</span><span id="line-160"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">group_roles :: forall pass. TyClGroup pass -&gt; [LRoleAnnotDecl pass]
</span><a href="GHC.Hs.Decls.html#group_roles"><span class="hs-identifier hs-var">group_roles</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681166734"><span class="annot"><span class="annottext">[LRoleAnnotDecl GhcRn]
</span><a href="#local-6989586621681166734"><span class="hs-identifier hs-var">roles</span></a></span></span><span>
</span><span id="line-161"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">group_kisigs :: forall pass. TyClGroup pass -&gt; [LStandaloneKindSig pass]
</span><a href="GHC.Hs.Decls.html#group_kisigs"><span class="hs-identifier hs-var">group_kisigs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681166732"><span class="annot"><span class="annottext">[LStandaloneKindSig GhcRn]
</span><a href="#local-6989586621681166732"><span class="hs-identifier hs-var">kisigs</span></a></span></span><span>
</span><span id="line-162"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">group_instds :: forall pass. TyClGroup pass -&gt; [LInstDecl pass]
</span><a href="GHC.Hs.Decls.html#group_instds"><span class="hs-identifier hs-var">group_instds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681166730"><span class="annot"><span class="annottext">[LInstDecl GhcRn]
</span><a href="#local-6989586621681166730"><span class="hs-identifier hs-var">instds</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-163"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681166729"><span class="annot"><span class="annottext">role_annots :: RoleAnnotEnv
</span><a href="#local-6989586621681166729"><span class="hs-identifier hs-var hs-var">role_annots</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[LRoleAnnotDecl GhcRn] -&gt; RoleAnnotEnv
</span><a href="GHC.Tc.Types.html#mkRoleAnnotEnv"><span class="hs-identifier hs-var">mkRoleAnnotEnv</span></a></span><span> </span><span class="annot"><span class="annottext">[LRoleAnnotDecl GhcRn]
</span><a href="#local-6989586621681166734"><span class="hs-identifier hs-var">roles</span></a></span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span>           </span><span class="hs-comment">-- Step 1: Typecheck the standalone kind signatures and type/class declarations</span><span>
</span><span id="line-166"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;---- tcTyClGroup ---- {&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-167"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Decls for&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Name] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(LTyClDecl GhcRn -&gt; Name) -&gt; [LTyClDecl GhcRn] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyClDecl GhcRn -&gt; Name
forall (p :: Pass). TyClDecl (GhcPass p) -&gt; IdP (GhcPass p)
</span><a href="GHC.Hs.Decls.html#tcdName"><span class="hs-identifier hs-var">tcdName</span></a></span><span> </span><span class="annot"><span class="annottext">(TyClDecl GhcRn -&gt; Name)
-&gt; (LTyClDecl GhcRn -&gt; TyClDecl GhcRn) -&gt; LTyClDecl GhcRn -&gt; Name
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">LTyClDecl GhcRn -&gt; TyClDecl GhcRn
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LTyClDecl GhcRn]
</span><a href="#local-6989586621681166736"><span class="hs-identifier hs-var">tyclds</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-168"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681166721"><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681166721"><span class="hs-identifier hs-var">tyclss</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681166720"><span class="annot"><span class="annottext">[DerivInfo]
</span><a href="#local-6989586621681166720"><span class="hs-identifier hs-var">data_deriv_info</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-169"></span><span>           </span><span class="annot"><span class="annottext">TcTypeEnv
-&gt; TcM ([TyCon], [DerivInfo]) -&gt; TcM ([TyCon], [DerivInfo])
forall r. TcTypeEnv -&gt; TcM r -&gt; TcM r
</span><a href="GHC.Tc.Utils.Env.html#tcExtendKindEnv"><span class="hs-identifier hs-var">tcExtendKindEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[LTyClDecl GhcRn] -&gt; TcTypeEnv
</span><a href="GHC.Tc.TyCl.html#mkPromotionErrorEnv"><span class="hs-identifier hs-var">mkPromotionErrorEnv</span></a></span><span> </span><span class="annot"><span class="annottext">[LTyClDecl GhcRn]
</span><a href="#local-6989586621681166736"><span class="hs-identifier hs-var">tyclds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM ([TyCon], [DerivInfo]) -&gt; TcM ([TyCon], [DerivInfo]))
-&gt; TcM ([TyCon], [DerivInfo]) -&gt; TcM ([TyCon], [DerivInfo])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-comment">-- See Note [Type environment evolution]</span><span>
</span><span id="line-170"></span><span>           </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681166717"><span class="annot"><span class="annottext">NameEnv Type
</span><a href="#local-6989586621681166717"><span class="hs-identifier hs-var">kisig_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Name, Type)] -&gt; NameEnv Type
forall a. [(Name, a)] -&gt; NameEnv a
</span><a href="GHC.Types.Name.Env.html#mkNameEnv"><span class="hs-identifier hs-var">mkNameEnv</span></a></span><span> </span><span class="annot"><span class="annottext">([(Name, Type)] -&gt; NameEnv Type)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [(Name, Type)]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (NameEnv Type)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(LStandaloneKindSig GhcRn
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Name, Type))
-&gt; [LStandaloneKindSig GhcRn]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [(Name, Type)]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><a href="../../base/src/Data.Traversable.html#traverse"><span class="hs-identifier hs-var">traverse</span></a></span><span> </span><span class="annot"><span class="annottext">LStandaloneKindSig GhcRn
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Name, Type)
</span><a href="GHC.Tc.Gen.HsType.html#tcStandaloneKindSig"><span class="hs-identifier hs-var">tcStandaloneKindSig</span></a></span><span> </span><span class="annot"><span class="annottext">[LStandaloneKindSig GhcRn]
</span><a href="#local-6989586621681166732"><span class="hs-identifier hs-var">kisigs</span></a></span><span>
</span><span id="line-171"></span><span>              </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">[LTyClDecl GhcRn]
-&gt; NameEnv Type -&gt; RoleAnnotEnv -&gt; TcM ([TyCon], [DerivInfo])
</span><a href="GHC.Tc.TyCl.html#tcTyClDecls"><span class="hs-identifier hs-var">tcTyClDecls</span></a></span><span> </span><span class="annot"><span class="annottext">[LTyClDecl GhcRn]
</span><a href="#local-6989586621681166736"><span class="hs-identifier hs-var">tyclds</span></a></span><span> </span><span class="annot"><span class="annottext">NameEnv Type
</span><a href="#local-6989586621681166717"><span class="hs-identifier hs-var">kisig_env</span></a></span><span> </span><span class="annot"><span class="annottext">RoleAnnotEnv
</span><a href="#local-6989586621681166729"><span class="hs-identifier hs-var">role_annots</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-172"></span><span>
</span><span id="line-173"></span><span>           </span><span class="hs-comment">-- Step 1.5: Make sure we don't have any type synonym cycles</span><span>
</span><span id="line-174"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Starting synonym cycle check&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyCon] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681166721"><span class="hs-identifier hs-var">tyclss</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-175"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681166711"><span class="annot"><span class="annottext">Unit
</span><a href="#local-6989586621681166711"><span class="hs-identifier hs-var">this_uid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(DynFlags -&gt; Unit)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) DynFlags
-&gt; IOEnv (Env TcGblEnv TcLclEnv) Unit
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Unit
</span><a href="GHC.Driver.Session.html#homeUnit"><span class="hs-identifier hs-var">homeUnit</span></a></span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-176"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Unit -&gt; [TyCon] -&gt; [LTyClDecl GhcRn] -&gt; TcRn ()
</span><a href="GHC.Tc.TyCl.Utils.html#checkSynCycles"><span class="hs-identifier hs-var">checkSynCycles</span></a></span><span> </span><span class="annot"><span class="annottext">Unit
</span><a href="#local-6989586621681166711"><span class="hs-identifier hs-var">this_uid</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681166721"><span class="hs-identifier hs-var">tyclss</span></a></span><span> </span><span class="annot"><span class="annottext">[LTyClDecl GhcRn]
</span><a href="#local-6989586621681166736"><span class="hs-identifier hs-var">tyclds</span></a></span><span>
</span><span id="line-177"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Done synonym cycle check&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyCon] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681166721"><span class="hs-identifier hs-var">tyclss</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-178"></span><span>
</span><span id="line-179"></span><span>           </span><span class="hs-comment">-- Step 2: Perform the validity check on those types/classes</span><span>
</span><span id="line-180"></span><span>           </span><span class="hs-comment">-- We can do this now because we are done with the recursive knot</span><span>
</span><span id="line-181"></span><span>           </span><span class="hs-comment">-- Do it before Step 3 (adding implicit things) because the latter</span><span>
</span><span id="line-182"></span><span>           </span><span class="hs-comment">-- expects well-formed TyCons</span><span>
</span><span id="line-183"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Starting validity check&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyCon] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681166721"><span class="hs-identifier hs-var">tyclss</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-184"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681166707"><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681166707"><span class="hs-identifier hs-var">tyclss</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TyCon -&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon])
-&gt; [TyCon] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m [b]) -&gt; [a] -&gt; m [b]
</span><a href="GHC.Utils.Monad.html#concatMapM"><span class="hs-identifier hs-var">concatMapM</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
</span><a href="GHC.Tc.TyCl.html#checkValidTyCl"><span class="hs-identifier hs-var">checkValidTyCl</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681166721"><span class="hs-identifier hs-var">tyclss</span></a></span><span>
</span><span id="line-185"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Done validity check&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyCon] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681166707"><span class="hs-identifier hs-var">tyclss</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-186"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(TyCon -&gt; TcRn ()) -&gt; [TyCon] -&gt; TcRn ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><a href="../../base/src/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcRn () -&gt; TcRn () -&gt; TcRn ()
forall r. TcRn r -&gt; TcRn r -&gt; TcRn r
</span><a href="GHC.Tc.Utils.Monad.html#recoverM"><span class="hs-identifier hs-var">recoverM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcRn ()) -&gt; (TyCon -&gt; TcRn ()) -&gt; TyCon -&gt; TcRn ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">RoleAnnotEnv -&gt; TyCon -&gt; TcRn ()
</span><a href="GHC.Tc.TyCl.html#checkValidRoleAnnots"><span class="hs-identifier hs-var">checkValidRoleAnnots</span></a></span><span> </span><span class="annot"><span class="annottext">RoleAnnotEnv
</span><a href="#local-6989586621681166729"><span class="hs-identifier hs-var">role_annots</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681166707"><span class="hs-identifier hs-var">tyclss</span></a></span><span>
</span><span id="line-187"></span><span>           </span><span class="hs-comment">-- See Note [Check role annotations in a second pass]</span><span>
</span><span id="line-188"></span><span>
</span><span id="line-189"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;---- end tcTyClGroup ---- }&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-190"></span><span>
</span><span id="line-191"></span><span>           </span><span class="hs-comment">-- Step 3: Add the implicit things;</span><span>
</span><span id="line-192"></span><span>           </span><span class="hs-comment">-- we want them in the environment because</span><span>
</span><span id="line-193"></span><span>           </span><span class="hs-comment">-- they may be mentioned in interface files</span><span>
</span><span id="line-194"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681166701"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681166701"><span class="hs-identifier hs-var">gbl_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TyCon] -&gt; TcRnIf TcGblEnv TcLclEnv TcGblEnv
</span><a href="GHC.Tc.TyCl.Utils.html#addTyConsToGblEnv"><span class="hs-identifier hs-var">addTyConsToGblEnv</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681166707"><span class="hs-identifier hs-var">tyclss</span></a></span><span>
</span><span id="line-195"></span><span>
</span><span id="line-196"></span><span>           </span><span class="hs-comment">-- Step 4: check instance declarations</span><span>
</span><span id="line-197"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681166699"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681166699"><span class="hs-identifier hs-var">gbl_env'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681166698"><span class="annot"><span class="annottext">[InstInfo GhcRn]
</span><a href="#local-6989586621681166698"><span class="hs-identifier hs-var">inst_info</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681166697"><span class="annot"><span class="annottext">[DerivInfo]
</span><a href="#local-6989586621681166697"><span class="hs-identifier hs-var">datafam_deriv_info</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-198"></span><span>         </span><span class="annot"><span class="annottext">TcGblEnv
-&gt; TcM (TcGblEnv, [InstInfo GhcRn], [DerivInfo])
-&gt; TcM (TcGblEnv, [InstInfo GhcRn], [DerivInfo])
forall gbl lcl a. gbl -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#setGblEnv"><span class="hs-identifier hs-var">setGblEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681166701"><span class="hs-identifier hs-var">gbl_env</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (TcGblEnv, [InstInfo GhcRn], [DerivInfo])
 -&gt; TcM (TcGblEnv, [InstInfo GhcRn], [DerivInfo]))
-&gt; TcM (TcGblEnv, [InstInfo GhcRn], [DerivInfo])
-&gt; TcM (TcGblEnv, [InstInfo GhcRn], [DerivInfo])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-199"></span><span>         </span><span class="annot"><span class="annottext">[LInstDecl GhcRn] -&gt; TcM (TcGblEnv, [InstInfo GhcRn], [DerivInfo])
</span><a href="GHC.Tc.TyCl.Instance.html#tcInstDecls1"><span class="hs-identifier hs-var">tcInstDecls1</span></a></span><span> </span><span class="annot"><span class="annottext">[LInstDecl GhcRn]
</span><a href="#local-6989586621681166730"><span class="hs-identifier hs-var">instds</span></a></span><span>
</span><span id="line-200"></span><span>
</span><span id="line-201"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681166696"><span class="annot"><span class="annottext">deriv_info :: [DerivInfo]
</span><a href="#local-6989586621681166696"><span class="hs-identifier hs-var hs-var">deriv_info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[DerivInfo]
</span><a href="#local-6989586621681166697"><span class="hs-identifier hs-var">datafam_deriv_info</span></a></span><span> </span><span class="annot"><span class="annottext">[DerivInfo] -&gt; [DerivInfo] -&gt; [DerivInfo]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[DerivInfo]
</span><a href="#local-6989586621681166720"><span class="hs-identifier hs-var">data_deriv_info</span></a></span><span>
</span><span id="line-202"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(TcGblEnv, [InstInfo GhcRn], [DerivInfo])
-&gt; TcM (TcGblEnv, [InstInfo GhcRn], [DerivInfo])
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681166699"><span class="hs-identifier hs-var">gbl_env'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[InstInfo GhcRn]
</span><a href="#local-6989586621681166698"><span class="hs-identifier hs-var">inst_info</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[DerivInfo]
</span><a href="#local-6989586621681166696"><span class="hs-identifier hs-var">deriv_info</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-203"></span><span>
</span><span id="line-204"></span><span class="hs-comment">-- Gives the kind for every TyCon that has a standalone kind signature</span><span>
</span><span id="line-205"></span><span class="hs-keyword">type</span><span> </span><span id="KindSigEnv"><span class="annot"><a href="GHC.Tc.TyCl.html#KindSigEnv"><span class="hs-identifier hs-var">KindSigEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.Name.Env.html#NameEnv"><span class="hs-identifier hs-type">NameEnv</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span>
</span><span id="line-206"></span><span>
</span><span id="line-207"></span><span class="annot"><a href="GHC.Tc.TyCl.html#tcTyClDecls"><span class="hs-identifier hs-type">tcTyClDecls</span></a></span><span>
</span><span id="line-208"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Hs.Decls.html#LTyClDecl"><span class="hs-identifier hs-type">LTyClDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-209"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.TyCl.html#KindSigEnv"><span class="hs-identifier hs-type">KindSigEnv</span></a></span><span>
</span><span id="line-210"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RoleAnnotEnv"><span class="hs-identifier hs-type">RoleAnnotEnv</span></a></span><span>
</span><span id="line-211"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Deriv.html#DerivInfo"><span class="hs-identifier hs-type">DerivInfo</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-212"></span><span id="tcTyClDecls"><span class="annot"><span class="annottext">tcTyClDecls :: [LTyClDecl GhcRn]
-&gt; NameEnv Type -&gt; RoleAnnotEnv -&gt; TcM ([TyCon], [DerivInfo])
</span><a href="GHC.Tc.TyCl.html#tcTyClDecls"><span class="hs-identifier hs-var hs-var">tcTyClDecls</span></a></span></span><span> </span><span id="local-6989586621681166693"><span class="annot"><span class="annottext">[LTyClDecl GhcRn]
</span><a href="#local-6989586621681166693"><span class="hs-identifier hs-var">tyclds</span></a></span></span><span> </span><span id="local-6989586621681166692"><span class="annot"><span class="annottext">NameEnv Type
</span><a href="#local-6989586621681166692"><span class="hs-identifier hs-var">kisig_env</span></a></span></span><span> </span><span id="local-6989586621681166691"><span class="annot"><span class="annottext">RoleAnnotEnv
</span><a href="#local-6989586621681166691"><span class="hs-identifier hs-var">role_annots</span></a></span></span><span>
</span><span id="line-213"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>    </span><span class="hs-comment">-- Step 1: kind-check this group and returns the final</span><span>
</span><span id="line-214"></span><span>            </span><span class="hs-comment">-- (possibly-polymorphic) kind of each TyCon and Class</span><span>
</span><span id="line-215"></span><span>            </span><span class="hs-comment">-- See Note [Kind checking for type and class decls]</span><span>
</span><span id="line-216"></span><span>         </span><span id="local-6989586621681166690"><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681166690"><span class="hs-identifier hs-var">tc_tycons</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NameEnv Type
-&gt; [LTyClDecl GhcRn] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
</span><a href="GHC.Tc.TyCl.html#kcTyClGroup"><span class="hs-identifier hs-var">kcTyClGroup</span></a></span><span> </span><span class="annot"><span class="annottext">NameEnv Type
</span><a href="#local-6989586621681166692"><span class="hs-identifier hs-var">kisig_env</span></a></span><span> </span><span class="annot"><span class="annottext">[LTyClDecl GhcRn]
</span><a href="#local-6989586621681166693"><span class="hs-identifier hs-var">tyclds</span></a></span><span>
</span><span id="line-217"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcTyAndCl generalized kinds&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TyCon -&gt; SDoc) -&gt; [TyCon] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; SDoc
</span><a href="#local-6989586621681166687"><span class="hs-identifier hs-var">ppr_tc_tycon</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681166690"><span class="hs-identifier hs-var">tc_tycons</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span>            </span><span class="hs-comment">-- Step 2: type-check all groups together, returning</span><span>
</span><span id="line-220"></span><span>            </span><span class="hs-comment">-- the final TyCons and Classes</span><span>
</span><span id="line-221"></span><span>            </span><span class="hs-comment">--</span><span>
</span><span id="line-222"></span><span>            </span><span class="hs-comment">-- NB: We have to be careful here to NOT eagerly unfold</span><span>
</span><span id="line-223"></span><span>            </span><span class="hs-comment">-- type synonyms, as we have not tested for type synonym</span><span>
</span><span id="line-224"></span><span>            </span><span class="hs-comment">-- loops yet and could fall into a black hole.</span><span>
</span><span id="line-225"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(([TyCon], [DerivInfo]) -&gt; TcM ([TyCon], [DerivInfo]))
-&gt; TcM ([TyCon], [DerivInfo])
forall a env. (a -&gt; IOEnv env a) -&gt; IOEnv env a
</span><a href="GHC.Data.IOEnv.html#fixM"><span class="hs-identifier hs-var">fixM</span></a></span><span> </span><span class="annot"><span class="annottext">((([TyCon], [DerivInfo]) -&gt; TcM ([TyCon], [DerivInfo]))
 -&gt; TcM ([TyCon], [DerivInfo]))
-&gt; (([TyCon], [DerivInfo]) -&gt; TcM ([TyCon], [DerivInfo]))
-&gt; TcM ([TyCon], [DerivInfo])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-glyph">~</span><span class="hs-special">(</span><span id="local-6989586621681166685"><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681166685"><span class="hs-identifier hs-var">rec_tyclss</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[DerivInfo]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-226"></span><span>           </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681166684"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681166684"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-227"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681166683"><span class="annot"><span class="annottext">roles :: Name -&gt; [Role]
</span><a href="#local-6989586621681166683"><span class="hs-identifier hs-var hs-var">roles</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscSource -&gt; RoleAnnotEnv -&gt; [TyCon] -&gt; Name -&gt; [Role]
</span><a href="GHC.Tc.TyCl.Utils.html#inferRoles"><span class="hs-identifier hs-var">inferRoles</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; HscSource
</span><a href="GHC.Tc.Types.html#tcg_src"><span class="hs-identifier hs-var hs-var">tcg_src</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681166684"><span class="hs-identifier hs-var">tcg_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RoleAnnotEnv
</span><a href="#local-6989586621681166691"><span class="hs-identifier hs-var">role_annots</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681166685"><span class="hs-identifier hs-var">rec_tyclss</span></a></span><span>
</span><span id="line-228"></span><span>
</span><span id="line-229"></span><span>                 </span><span class="hs-comment">-- Populate environment with knot-tied ATyCon for TyCons</span><span>
</span><span id="line-230"></span><span>                 </span><span class="hs-comment">-- NB: if the decls mention any ill-staged data cons</span><span>
</span><span id="line-231"></span><span>                 </span><span class="hs-comment">-- (see Note [Recursion and promoting data constructors])</span><span>
</span><span id="line-232"></span><span>                 </span><span class="hs-comment">-- we will have failed already in kcTyClGroup, so no worries here</span><span>
</span><span id="line-233"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681166680"><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681166680"><span class="hs-identifier hs-var">tycons</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681166679"><span class="annot"><span class="annottext">[[DerivInfo]]
</span><a href="#local-6989586621681166679"><span class="hs-identifier hs-var">data_deriv_infos</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-234"></span><span>             </span><span class="annot"><span class="annottext">[(Name, TyThing)]
-&gt; TcM ([TyCon], [[DerivInfo]]) -&gt; TcM ([TyCon], [[DerivInfo]])
forall r. [(Name, TyThing)] -&gt; TcM r -&gt; TcM r
</span><a href="GHC.Tc.Utils.Env.html#tcExtendRecEnv"><span class="hs-identifier hs-var">tcExtendRecEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyCon] -&gt; [TyCon] -&gt; [(Name, TyThing)]
</span><a href="GHC.Tc.TyCl.html#zipRecTyClss"><span class="hs-identifier hs-var">zipRecTyClss</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681166690"><span class="hs-identifier hs-var">tc_tycons</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681166685"><span class="hs-identifier hs-var">rec_tyclss</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM ([TyCon], [[DerivInfo]]) -&gt; TcM ([TyCon], [[DerivInfo]]))
-&gt; TcM ([TyCon], [[DerivInfo]]) -&gt; TcM ([TyCon], [[DerivInfo]])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-235"></span><span>
</span><span id="line-236"></span><span>                 </span><span class="hs-comment">-- Also extend the local type envt with bindings giving</span><span>
</span><span id="line-237"></span><span>                 </span><span class="hs-comment">-- a TcTyCon for each knot-tied TyCon or Class</span><span>
</span><span id="line-238"></span><span>                 </span><span class="hs-comment">-- See Note [Type checking recursive type and class declarations]</span><span>
</span><span id="line-239"></span><span>                 </span><span class="hs-comment">-- and Note [Type environment evolution]</span><span>
</span><span id="line-240"></span><span>             </span><span class="annot"><span class="annottext">[TyCon]
-&gt; TcM ([TyCon], [[DerivInfo]]) -&gt; TcM ([TyCon], [[DerivInfo]])
forall a. [TyCon] -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.TyCl.html#tcExtendKindEnvWithTyCons"><span class="hs-identifier hs-var">tcExtendKindEnvWithTyCons</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681166690"><span class="hs-identifier hs-var">tc_tycons</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM ([TyCon], [[DerivInfo]]) -&gt; TcM ([TyCon], [[DerivInfo]]))
-&gt; TcM ([TyCon], [[DerivInfo]]) -&gt; TcM ([TyCon], [[DerivInfo]])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-241"></span><span>
</span><span id="line-242"></span><span>                 </span><span class="hs-comment">-- Kind and type check declarations for this group</span><span>
</span><span id="line-243"></span><span>               </span><span class="annot"><span class="annottext">(LTyClDecl GhcRn
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) (TyCon, [DerivInfo]))
-&gt; [LTyClDecl GhcRn] -&gt; TcM ([TyCon], [[DerivInfo]])
forall (m :: * -&gt; *) a b c.
Applicative m =&gt;
(a -&gt; m (b, c)) -&gt; [a] -&gt; m ([b], [c])
</span><a href="../../base/src/Control.Monad.html#mapAndUnzipM"><span class="hs-identifier hs-var">mapAndUnzipM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Name -&gt; [Role])
-&gt; LTyClDecl GhcRn
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (TyCon, [DerivInfo])
</span><a href="GHC.Tc.TyCl.html#tcTyClDecl"><span class="hs-identifier hs-var">tcTyClDecl</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Role]
</span><a href="#local-6989586621681166683"><span class="hs-identifier hs-var">roles</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LTyClDecl GhcRn]
</span><a href="#local-6989586621681166693"><span class="hs-identifier hs-var">tyclds</span></a></span><span>
</span><span id="line-244"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">([TyCon], [DerivInfo]) -&gt; TcM ([TyCon], [DerivInfo])
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681166680"><span class="hs-identifier hs-var">tycons</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[[DerivInfo]] -&gt; [DerivInfo]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><a href="../../base/src/Data.Foldable.html#concat"><span class="hs-identifier hs-var">concat</span></a></span><span> </span><span class="annot"><span class="annottext">[[DerivInfo]]
</span><a href="#local-6989586621681166679"><span class="hs-identifier hs-var">data_deriv_infos</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-245"></span><span>           </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-246"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-247"></span><span>    </span><span id="local-6989586621681166687"><span class="annot"><span class="annottext">ppr_tc_tycon :: TyCon -&gt; SDoc
</span><a href="#local-6989586621681166687"><span class="hs-identifier hs-var hs-var">ppr_tc_tycon</span></a></span></span><span> </span><span id="local-6989586621681166666"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166666"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Name
</span><a href="GHC.Core.TyCon.html#tyConName"><span class="hs-identifier hs-var hs-var">tyConName</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166666"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a></span><span>
</span><span id="line-248"></span><span>                                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TyConBinder] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [TyConBinder]
</span><a href="GHC.Core.TyCon.html#tyConBinders"><span class="hs-identifier hs-var hs-var">tyConBinders</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166666"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a></span><span>
</span><span id="line-249"></span><span>                                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Type
</span><a href="GHC.Core.TyCon.html#tyConResKind"><span class="hs-identifier hs-var hs-var">tyConResKind</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166666"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-250"></span><span>                                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isTcTyCon"><span class="hs-identifier hs-var">isTcTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166666"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-251"></span><span>
</span><span id="line-252"></span><span class="annot"><a href="GHC.Tc.TyCl.html#zipRecTyClss"><span class="hs-identifier hs-type">zipRecTyClss</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyCon"><span class="hs-identifier hs-type">TcTyCon</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-253"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span class="hs-special">]</span><span>           </span><span class="hs-comment">-- Knot-tied</span><span>
</span><span id="line-254"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-255"></span><span class="hs-comment">-- Build a name-TyThing mapping for the TyCons bound by decls</span><span>
</span><span id="line-256"></span><span class="hs-comment">-- being careful not to look at the knot-tied [TyThing]</span><span>
</span><span id="line-257"></span><span class="hs-comment">-- The TyThings in the result list must have a visible ATyCon,</span><span>
</span><span id="line-258"></span><span class="hs-comment">-- because typechecking types (in, say, tcTyClDecl) looks at</span><span>
</span><span id="line-259"></span><span class="hs-comment">-- this outer constructor</span><span>
</span><span id="line-260"></span><span id="zipRecTyClss"><span class="annot"><span class="annottext">zipRecTyClss :: [TyCon] -&gt; [TyCon] -&gt; [(Name, TyThing)]
</span><a href="GHC.Tc.TyCl.html#zipRecTyClss"><span class="hs-identifier hs-var hs-var">zipRecTyClss</span></a></span></span><span> </span><span id="local-6989586621681166656"><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681166656"><span class="hs-identifier hs-var">tc_tycons</span></a></span></span><span> </span><span id="local-6989586621681166655"><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681166655"><span class="hs-identifier hs-var">rec_tycons</span></a></span></span><span>
</span><span id="line-261"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681166654"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyThing
</span><a href="GHC.Core.TyCo.Rep.html#ATyCon"><span class="hs-identifier hs-var">ATyCon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; TyCon
</span><a href="#local-6989586621681166652"><span class="hs-identifier hs-var">get</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681166654"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681166651"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166651"><span class="hs-identifier hs-var">tc_tycon</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681166656"><span class="hs-identifier hs-var">tc_tycons</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681166654"><span class="annot"><span class="annottext">name :: Name
</span><a href="#local-6989586621681166654"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Name
forall a. NamedThing a =&gt; a -&gt; Name
</span><a href="GHC.Types.Name.html#getName"><span class="hs-identifier hs-var">getName</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166651"><span class="hs-identifier hs-var">tc_tycon</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-262"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-263"></span><span>    </span><span class="annot"><a href="#local-6989586621681166649"><span class="hs-identifier hs-type">rec_tc_env</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Env.html#NameEnv"><span class="hs-identifier hs-type">NameEnv</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span>
</span><span id="line-264"></span><span>    </span><span id="local-6989586621681166649"><span class="annot"><span class="annottext">rec_tc_env :: NameEnv TyCon
</span><a href="#local-6989586621681166649"><span class="hs-identifier hs-var hs-var">rec_tc_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TyCon -&gt; NameEnv TyCon -&gt; NameEnv TyCon)
-&gt; NameEnv TyCon -&gt; [TyCon] -&gt; NameEnv TyCon
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; NameEnv TyCon -&gt; NameEnv TyCon
</span><a href="#local-6989586621681166647"><span class="hs-identifier hs-var">add_tc</span></a></span><span> </span><span class="annot"><span class="annottext">NameEnv TyCon
forall a. NameEnv a
</span><a href="GHC.Types.Name.Env.html#emptyNameEnv"><span class="hs-identifier hs-var">emptyNameEnv</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681166655"><span class="hs-identifier hs-var">rec_tycons</span></a></span><span>
</span><span id="line-265"></span><span>
</span><span id="line-266"></span><span>    </span><span class="annot"><a href="#local-6989586621681166647"><span class="hs-identifier hs-type">add_tc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Env.html#NameEnv"><span class="hs-identifier hs-type">NameEnv</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Env.html#NameEnv"><span class="hs-identifier hs-type">NameEnv</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span>
</span><span id="line-267"></span><span>    </span><span id="local-6989586621681166647"><span class="annot"><span class="annottext">add_tc :: TyCon -&gt; NameEnv TyCon -&gt; NameEnv TyCon
</span><a href="#local-6989586621681166647"><span class="hs-identifier hs-var hs-var">add_tc</span></a></span></span><span> </span><span id="local-6989586621681166645"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166645"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621681166644"><span class="annot"><span class="annottext">NameEnv TyCon
</span><a href="#local-6989586621681166644"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TyCon -&gt; NameEnv TyCon -&gt; NameEnv TyCon)
-&gt; NameEnv TyCon -&gt; [TyCon] -&gt; NameEnv TyCon
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; NameEnv TyCon -&gt; NameEnv TyCon
</span><a href="#local-6989586621681166643"><span class="hs-identifier hs-var">add_one_tc</span></a></span><span> </span><span class="annot"><span class="annottext">NameEnv TyCon
</span><a href="#local-6989586621681166644"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166645"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [TyCon] -&gt; [TyCon]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [TyCon]
</span><a href="GHC.Core.TyCon.html#tyConATs"><span class="hs-identifier hs-var">tyConATs</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166645"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-268"></span><span>
</span><span id="line-269"></span><span>    </span><span class="annot"><a href="#local-6989586621681166643"><span class="hs-identifier hs-type">add_one_tc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Env.html#NameEnv"><span class="hs-identifier hs-type">NameEnv</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Env.html#NameEnv"><span class="hs-identifier hs-type">NameEnv</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span>
</span><span id="line-270"></span><span>    </span><span id="local-6989586621681166643"><span class="annot"><span class="annottext">add_one_tc :: TyCon -&gt; NameEnv TyCon -&gt; NameEnv TyCon
</span><a href="#local-6989586621681166643"><span class="hs-identifier hs-var hs-var">add_one_tc</span></a></span></span><span> </span><span id="local-6989586621681166641"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166641"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621681166640"><span class="annot"><span class="annottext">NameEnv TyCon
</span><a href="#local-6989586621681166640"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NameEnv TyCon -&gt; Name -&gt; TyCon -&gt; NameEnv TyCon
forall a. NameEnv a -&gt; Name -&gt; a -&gt; NameEnv a
</span><a href="GHC.Types.Name.Env.html#extendNameEnv"><span class="hs-identifier hs-var">extendNameEnv</span></a></span><span> </span><span class="annot"><span class="annottext">NameEnv TyCon
</span><a href="#local-6989586621681166640"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Name
</span><a href="GHC.Core.TyCon.html#tyConName"><span class="hs-identifier hs-var hs-var">tyConName</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166641"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166641"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-271"></span><span>
</span><span id="line-272"></span><span>    </span><span id="local-6989586621681166652"><span class="annot"><span class="annottext">get :: Name -&gt; TyCon
</span><a href="#local-6989586621681166652"><span class="hs-identifier hs-var hs-var">get</span></a></span></span><span> </span><span id="local-6989586621681166633"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681166633"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">NameEnv TyCon -&gt; Name -&gt; Maybe TyCon
forall a. NameEnv a -&gt; Name -&gt; Maybe a
</span><a href="GHC.Types.Name.Env.html#lookupNameEnv"><span class="hs-identifier hs-var">lookupNameEnv</span></a></span><span> </span><span class="annot"><span class="annottext">NameEnv TyCon
</span><a href="#local-6989586621681166649"><span class="hs-identifier hs-var">rec_tc_env</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681166633"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-273"></span><span>                 </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681166631"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166631"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166631"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-274"></span><span>                 </span><span id="local-6989586621681166630"><span class="annot"><span class="annottext">Maybe TyCon
</span><a href="#local-6989586621681166630"><span class="hs-identifier hs-var">other</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TyCon
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;zipRecTyClss&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681166633"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TyCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TyCon
</span><a href="#local-6989586621681166630"><span class="hs-identifier hs-var">other</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-275"></span><span>
</span><span id="line-276"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Kind checking
*                                                                      *
************************************************************************

Note [Kind checking for type and class decls]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Kind checking is done thus:

   1. Make up a kind variable for each parameter of the declarations,
      and extend the kind environment (which is in the TcLclEnv)

   2. Kind check the declarations

We need to kind check all types in the mutually recursive group
before we know the kind of the type variables.  For example:

  class C a where
     op :: D b =&gt; a -&gt; b -&gt; b

  class D c where
     bop :: (Monad c) =&gt; ...

Here, the kind of the locally-polymorphic type variable &quot;b&quot;
depends on *all the uses of class D*.  For example, the use of
Monad c in bop's type signature means that D must have kind Type-&gt;Type.

Note: we don't treat type synonyms specially (we used to, in the past);
in particular, even if we have a type synonym cycle, we still kind check
it normally, and test for cycles later (checkSynCycles).  The reason
we can get away with this is because we have more systematic TYPE r
inference, which means that we can do unification between kinds that
aren't lifted (this historically was not true.)

The downside of not directly reading off the kinds of the RHS of
type synonyms in topological order is that we don't transparently
support making synonyms of types with higher-rank kinds.  But
you can always specify a CUSK directly to make this work out.
See tc269 for an example.

Note [CUSKs and PolyKinds]
~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider

    data T (a :: *) = MkT (S a)   -- Has CUSK
    data S a = MkS (T Int) (S a)  -- No CUSK

Via inferInitialKinds we get
  T :: * -&gt; *
  S :: kappa -&gt; *

Then we call kcTyClDecl on each decl in the group, to constrain the
kind unification variables.  BUT we /skip/ the RHS of any decl with
a CUSK.  Here we skip the RHS of T, so we eventually get
  S :: forall k. k -&gt; *

This gets us more polymorphism than we would otherwise get, similar
(but implemented strangely differently from) the treatment of type
signatures in value declarations.

However, we only want to do so when we have PolyKinds.
When we have NoPolyKinds, we don't skip those decls, because we have defaulting
(#16609). Skipping won't bring us more polymorphism when we have defaulting.
Consider

  data T1 a = MkT1 T2        -- No CUSK
  data T2 = MkT2 (T1 Maybe)  -- Has CUSK

If we skip the rhs of T2 during kind-checking, the kind of a remains unsolved.
With PolyKinds, we do generalization to get T1 :: forall a. a -&gt; *. And the
program type-checks.
But with NoPolyKinds, we do defaulting to get T1 :: * -&gt; *. Defaulting happens
in quantifyTyVars, which is called from generaliseTcTyCon. Then type-checking
(T1 Maybe) will throw a type error.

Summary: with PolyKinds, we must skip; with NoPolyKinds, we must /not/ skip.

Open type families
~~~~~~~~~~~~~~~~~~
This treatment of type synonyms only applies to Haskell 98-style synonyms.
General type functions can be recursive, and hence, appear in `alg_decls'.

The kind of an open type family is solely determinded by its kind signature;
hence, only kind signatures participate in the construction of the initial
kind environment (as constructed by `inferInitialKind'). In fact, we ignore
instances of families altogether in the following. However, we need to include
the kinds of *associated* families into the construction of the initial kind
environment. (This is handled by `allDecls').

See also Note [Kind checking recursive type and class declarations]

Note [How TcTyCons work]
~~~~~~~~~~~~~~~~~~~~~~~~
TcTyCons are used for two distinct purposes

1.  When recovering from a type error in a type declaration,
    we want to put the erroneous TyCon in the environment in a
    way that won't lead to more errors.  We use a TcTyCon for this;
    see makeRecoveryTyCon.

2.  When checking a type/class declaration (in module GHC.Tc.TyCl), we come
    upon knowledge of the eventual tycon in bits and pieces.

      S1) First, we use inferInitialKinds to look over the user-provided
          kind signature of a tycon (including, for example, the number
          of parameters written to the tycon) to get an initial shape of
          the tycon's kind.  We record that shape in a TcTyCon.

          For CUSK tycons, the TcTyCon has the final, generalised kind.
          For non-CUSK tycons, the TcTyCon has as its tyConBinders only
          the explicit arguments given -- no kind variables, etc.

      S2) Then, using these initial kinds, we kind-check the body of the
          tycon (class methods, data constructors, etc.), filling in the
          metavariables in the tycon's initial kind.

      S3) We then generalize to get the (non-CUSK) tycon's final, fixed
          kind. Finally, once this has happened for all tycons in a
          mutually recursive group, we can desugar the lot.

    For convenience, we store partially-known tycons in TcTyCons, which
    might store meta-variables. These TcTyCons are stored in the local
    environment in GHC.Tc.TyCl, until the real full TyCons can be created
    during desugaring. A desugared program should never have a TcTyCon.

3.  In a TcTyCon, everything is zonked after the kind-checking pass (S2).

4.  tyConScopedTyVars.  A challenging piece in all of this is that we
    end up taking three separate passes over every declaration:
      - one in inferInitialKind (this pass look only at the head, not the body)
      - one in kcTyClDecls (to kind-check the body)
      - a final one in tcTyClDecls (to desugar)

    In the latter two passes, we need to connect the user-written type
    variables in an LHsQTyVars with the variables in the tycon's
    inferred kind. Because the tycon might not have a CUSK, this
    matching up is, in general, quite hard to do.  (Look through the
    git history between Dec 2015 and Apr 2016 for
    GHC.Tc.Gen.HsType.splitTelescopeTvs!)

    Instead of trying, we just store the list of type variables to
    bring into scope, in the tyConScopedTyVars field of the TcTyCon.
    These tyvars are brought into scope in GHC.Tc.Gen.HsType.bindTyClTyVars.

    In a TcTyCon, why is tyConScopedTyVars :: [(Name,TcTyVar)] rather
    than just [TcTyVar]?  Consider these mutually-recursive decls
       data T (a :: k1) b = MkT (S a b)
       data S (c :: k2) d = MkS (T c d)
    We start with k1 bound to kappa1, and k2 to kappa2; so initially
    in the (Name,TcTyVar) pairs the Name is that of the TcTyVar. But
    then kappa1 and kappa2 get unified; so after the zonking in
    'generalise' in 'kcTyClGroup' the Name and TcTyVar may differ.

See also Note [Type checking recursive type and class declarations].

Note [Swizzling the tyvars before generaliseTcTyCon]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
This Note only applies when /inferring/ the kind of a TyCon.
If there is a separate kind signature, or a CUSK, we take an entirely
different code path.

For inference, consider
   class C (f :: k) x where
      type T f
      op :: D f =&gt; blah
   class D (g :: j) y where
      op :: C g =&gt; y -&gt; blah

Here C and D are considered mutually recursive.  Neither has a CUSK.
Just before generalisation we have the (un-quantified) kinds
   C :: k1 -&gt; k2 -&gt; Constraint
   T :: k1 -&gt; Type
   D :: k1 -&gt; Type -&gt; Constraint
Notice that f's kind and g's kind have been unified to 'k1'. We say
that k1 is the &quot;representative&quot; of k in C's decl, and of j in D's decl.

Now when quantifying, we'd like to end up with
   C :: forall {k2}. forall k. k -&gt; k2 -&gt; Constraint
   T :: forall k. k -&gt; Type
   D :: forall j. j -&gt; Type -&gt; Constraint

That is, we want to swizzle the representative to have the Name given
by the user. Partly this is to improve error messages and the output of
:info in GHCi.  But it is /also/ important because the code for a
default method may mention the class variable(s), but at that point
(tcClassDecl2), we only have the final class tyvars available.
(Alternatively, we could record the scoped type variables in the
TyCon, but it's a nuisance to do so.)

Notes:

* On the input to generaliseTyClDecl, the mapping between the
  user-specified Name and the representative TyVar is recorded in the
  tyConScopedTyVars of the TcTyCon.  NB: you first need to zonk to see
  this representative TyVar.

* The swizzling is actually performed by swizzleTcTyConBndrs

* We must do the swizzling across the whole class decl. Consider
     class C f where
       type S (f :: k)
       type T f
  Here f's kind k is a parameter of C, and its identity is shared
  with S and T.  So if we swizzle the representative k at all, we
  must do so consistently for the entire declaration.

  Hence the call to check_duplicate_tc_binders is in generaliseTyClDecl,
  rather than in generaliseTcTyCon.

There are errors to catch here.  Suppose we had
   class E (f :: j) (g :: k) where
     op :: SameKind f g -&gt; blah

Then, just before generalisation we will have the (unquantified)
   E :: k1 -&gt; k1 -&gt; Constraint

That's bad!  Two distinctly-named tyvars (j and k) have ended up with
the same representative k1.  So when swizzling, we check (in
check_duplicate_tc_binders) that two distinct source names map
to the same representative.

Here's an interesting case:
    class C1 f where
      type S (f :: k1)
      type T (f :: k2)
Here k1 and k2 are different Names, but they end up mapped to the
same representative TyVar.  To make the swizzling consistent (remember
we must have a single k across C1, S and T) we reject the program.

Another interesting case
    class C2 f where
      type S (f :: k) (p::Type)
      type T (f :: k) (p::Type-&gt;Type)

Here the two k's (and the two p's) get distinct Uniques, because they
are seen by the renamer as locally bound in S and T resp.  But again
the two (distinct) k's end up bound to the same representative TyVar.
You might argue that this should be accepted, but it's definitely
rejected (via an entirely different code path) if you add a kind sig:
    type C2' :: j -&gt; Constraint
    class C2' f where
      type S (f :: k) (p::Type)
We get
    &#8226; Expected kind &#8216;j&#8217;, but &#8216;f&#8217; has kind &#8216;k&#8217;
    &#8226; In the associated type family declaration for &#8216;S&#8217;

So we reject C2 too, even without the kind signature.  We have
to do a bit of work to get a good error message, since both k's
look the same to the user.

Another case
    class C3 (f :: k1) where
      type S (f :: k2)

This will be rejected too.


Note [Type environment evolution]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
As we typecheck a group of declarations the type environment evolves.
Consider for example:
  data B (a :: Type) = MkB (Proxy 'MkB)

We do the following steps:

  1. Start of tcTyClDecls: use mkPromotionErrorEnv to initialise the
     type env with promotion errors
            B   :-&gt; TyConPE
            MkB :-&gt; DataConPE

  2. kcTyCLGroup
      - Do inferInitialKinds, which will signal a promotion
        error if B is used in any of the kinds needed to initialise
        B's kind (e.g. (a :: Type)) here

      - Extend the type env with these initial kinds (monomorphic for
        decls that lack a CUSK)
            B :-&gt; TcTyCon &lt;initial kind&gt;
        (thereby overriding the B :-&gt; TyConPE binding)
        and do kcLTyClDecl on each decl to get equality constraints on
        all those initial kinds

      - Generalise the initial kind, making a poly-kinded TcTyCon

  3. Back in tcTyDecls, extend the envt with bindings of the poly-kinded
     TcTyCons, again overriding the promotion-error bindings.

     But note that the data constructor promotion errors are still in place
     so that (in our example) a use of MkB will still be signalled as
     an error.

  4. Typecheck the decls.

  5. In tcTyClGroup, extend the envt with bindings for TyCon and DataCons


Note [Missed opportunity to retain higher-rank kinds]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
In 'kcTyClGroup', there is a missed opportunity to make kind
inference work in a few more cases.  The idea is analogous
to Note [Single function non-recursive binding special-case]:

     * If we have an SCC with a single decl, which is non-recursive,
       instead of creating a unification variable representing the
       kind of the decl and unifying it with the rhs, we can just
       read the type directly of the rhs.

     * Furthermore, we can update our SCC analysis to ignore
       dependencies on declarations which have CUSKs: we don't
       have to kind-check these all at once, since we can use
       the CUSK to initialize the kind environment.

Unfortunately this requires reworking a bit of the code in
'kcLTyClDecl' so I've decided to punt unless someone shouts about it.

Note [Don't process associated types in getInitialKind]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Previously, we processed associated types in the thing_inside in getInitialKind,
but this was wrong -- we want to do ATs sepearately.
The consequence for not doing it this way is #15142:

  class ListTuple (tuple :: Type) (as :: [(k, Type)]) where
    type ListToTuple as :: Type

We assign k a kind kappa[1]. When checking the tuple (k, Type), we try to unify
kappa ~ Type, but this gets deferred because we bumped the TcLevel as we bring
`tuple` into scope. Thus, when we check ListToTuple, kappa[1] still hasn't
unified with Type. And then, when we generalize the kind of ListToTuple (which
indeed has a CUSK, according to the rules), we skolemize the free metavariable
kappa. Note that we wouldn't skolemize kappa when generalizing the kind of ListTuple,
because the solveEqualities in kcInferDeclHeader is at TcLevel 1 and so kappa[1]
will unify with Type.

Bottom line: as associated types should have no effect on a CUSK enclosing class,
we move processing them to a separate action, run after the outer kind has
been generalized.

-}</span><span>
</span><span id="line-616"></span><span>
</span><span id="line-617"></span><span class="annot"><a href="GHC.Tc.TyCl.html#kcTyClGroup"><span class="hs-identifier hs-type">kcTyClGroup</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.TyCl.html#KindSigEnv"><span class="hs-identifier hs-type">KindSigEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Hs.Decls.html#LTyClDecl"><span class="hs-identifier hs-type">LTyClDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyCon"><span class="hs-identifier hs-type">TcTyCon</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-618"></span><span>
</span><span id="line-619"></span><span class="hs-comment">-- Kind check this group, kind generalize, and return the resulting local env</span><span>
</span><span id="line-620"></span><span class="hs-comment">-- This binds the TyCons and Classes of the group, but not the DataCons</span><span>
</span><span id="line-621"></span><span class="hs-comment">-- See Note [Kind checking for type and class decls]</span><span>
</span><span id="line-622"></span><span class="hs-comment">-- and Note [Inferring kinds for type declarations]</span><span>
</span><span id="line-623"></span><span id="kcTyClGroup"><span class="annot"><span class="annottext">kcTyClGroup :: NameEnv Type
-&gt; [LTyClDecl GhcRn] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
</span><a href="GHC.Tc.TyCl.html#kcTyClGroup"><span class="hs-identifier hs-var hs-var">kcTyClGroup</span></a></span></span><span> </span><span id="local-6989586621681166627"><span class="annot"><span class="annottext">NameEnv Type
</span><a href="#local-6989586621681166627"><span class="hs-identifier hs-var">kisig_env</span></a></span></span><span> </span><span id="local-6989586621681166626"><span class="annot"><span class="annottext">[LTyClDecl GhcRn]
</span><a href="#local-6989586621681166626"><span class="hs-identifier hs-var">decls</span></a></span></span><span>
</span><span id="line-624"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681166625"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681166625"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) Module
forall (m :: * -&gt; *). HasModule m =&gt; m Module
</span><a href="GHC.Unit.Module.html#getModule"><span class="hs-identifier hs-var">getModule</span></a></span><span>
</span><span id="line-625"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;---- kcTyClGroup ---- {&quot;</span></span><span>
</span><span id="line-626"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;module&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Module -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681166625"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(LTyClDecl GhcRn -&gt; SDoc) -&gt; [LTyClDecl GhcRn] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">LTyClDecl GhcRn -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[LTyClDecl GhcRn]
</span><a href="#local-6989586621681166626"><span class="hs-identifier hs-var">decls</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-627"></span><span>
</span><span id="line-628"></span><span>          </span><span class="hs-comment">-- Kind checking;</span><span>
</span><span id="line-629"></span><span>          </span><span class="hs-comment">--    1. Bind kind variables for decls</span><span>
</span><span id="line-630"></span><span>          </span><span class="hs-comment">--    2. Kind-check decls</span><span>
</span><span id="line-631"></span><span>          </span><span class="hs-comment">--    3. Generalise the inferred kinds</span><span>
</span><span id="line-632"></span><span>          </span><span class="hs-comment">-- See Note [Kind checking for type and class decls]</span><span>
</span><span id="line-633"></span><span>
</span><span id="line-634"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681166621"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681166621"><span class="hs-identifier hs-var">cusks_enabled</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall gbl lcl. Extension -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><a href="../../ghc-boot-th/src/GHC.LanguageExtensions.Type.html#CUSKs"><span class="hs-identifier hs-var">LangExt.CUSKs</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv Bool
-&gt; TcRnIf TcGblEnv TcLclEnv Bool -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall (f :: * -&gt; *). Applicative f =&gt; f Bool -&gt; f Bool -&gt; f Bool
</span><a href="GHC.Utils.Misc.html#%3C%26%26%3E"><span class="hs-operator hs-var">&lt;&amp;&amp;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Extension -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall gbl lcl. Extension -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><a href="../../ghc-boot-th/src/GHC.LanguageExtensions.Type.html#PolyKinds"><span class="hs-identifier hs-var">LangExt.PolyKinds</span></a></span><span>
</span><span id="line-635"></span><span>                    </span><span class="hs-comment">-- See Note [CUSKs and PolyKinds]</span><span>
</span><span id="line-636"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681166616"><span class="annot"><span class="annottext">[LTyClDecl GhcRn]
</span><a href="#local-6989586621681166616"><span class="hs-identifier hs-var">kindless_decls</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681166615"><span class="annot"><span class="annottext">[(LTyClDecl GhcRn, SAKS_or_CUSK)]
</span><a href="#local-6989586621681166615"><span class="hs-identifier hs-var">kinded_decls</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LTyClDecl GhcRn
 -&gt; Either (LTyClDecl GhcRn) (LTyClDecl GhcRn, SAKS_or_CUSK))
-&gt; [LTyClDecl GhcRn]
-&gt; ([LTyClDecl GhcRn], [(LTyClDecl GhcRn, SAKS_or_CUSK)])
forall a b c. (a -&gt; Either b c) -&gt; [a] -&gt; ([b], [c])
</span><a href="GHC.Utils.Misc.html#partitionWith"><span class="hs-identifier hs-var">partitionWith</span></a></span><span> </span><span class="annot"><span class="annottext">LTyClDecl GhcRn
-&gt; Either (LTyClDecl GhcRn) (LTyClDecl GhcRn, SAKS_or_CUSK)
</span><a href="#local-6989586621681166613"><span class="hs-identifier hs-var">get_kind</span></a></span><span> </span><span class="annot"><span class="annottext">[LTyClDecl GhcRn]
</span><a href="#local-6989586621681166626"><span class="hs-identifier hs-var">decls</span></a></span><span>
</span><span id="line-637"></span><span>
</span><span id="line-638"></span><span>              </span><span id="local-6989586621681166613"><span class="annot"><span class="annottext">get_kind :: LTyClDecl GhcRn
-&gt; Either (LTyClDecl GhcRn) (LTyClDecl GhcRn, SAKS_or_CUSK)
</span><a href="#local-6989586621681166613"><span class="hs-identifier hs-var hs-var">get_kind</span></a></span></span><span> </span><span id="local-6989586621681166612"><span class="annot"><span class="annottext">LTyClDecl GhcRn
</span><a href="#local-6989586621681166612"><span class="hs-identifier hs-var">d</span></a></span></span><span>
</span><span id="line-639"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681166611"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681166611"><span class="hs-identifier hs-var">ki</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NameEnv Type -&gt; Name -&gt; Maybe Type
forall a. NameEnv a -&gt; Name -&gt; Maybe a
</span><a href="GHC.Types.Name.Env.html#lookupNameEnv"><span class="hs-identifier hs-var">lookupNameEnv</span></a></span><span> </span><span class="annot"><span class="annottext">NameEnv Type
</span><a href="#local-6989586621681166627"><span class="hs-identifier hs-var">kisig_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyClDecl GhcRn -&gt; IdP GhcRn
forall (p :: Pass). TyClDecl (GhcPass p) -&gt; IdP (GhcPass p)
</span><a href="GHC.Hs.Decls.html#tcdName"><span class="hs-identifier hs-var">tcdName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LTyClDecl GhcRn -&gt; TyClDecl GhcRn
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LTyClDecl GhcRn
</span><a href="#local-6989586621681166612"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-640"></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LTyClDecl GhcRn, SAKS_or_CUSK)
-&gt; Either (LTyClDecl GhcRn) (LTyClDecl GhcRn, SAKS_or_CUSK)
forall a b. b -&gt; Either a b
</span><a href="../../base/src/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LTyClDecl GhcRn
</span><a href="#local-6989586621681166612"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; SAKS_or_CUSK
</span><a href="GHC.Tc.Gen.HsType.html#SAKS"><span class="hs-identifier hs-var">SAKS</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681166611"><span class="hs-identifier hs-var">ki</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-641"></span><span>
</span><span id="line-642"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681166621"><span class="hs-identifier hs-var">cusks_enabled</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">TyClDecl GhcRn -&gt; Bool
</span><a href="GHC.Hs.Decls.html#hsDeclHasCusk"><span class="hs-identifier hs-var">hsDeclHasCusk</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LTyClDecl GhcRn -&gt; TyClDecl GhcRn
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LTyClDecl GhcRn
</span><a href="#local-6989586621681166612"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-643"></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LTyClDecl GhcRn, SAKS_or_CUSK)
-&gt; Either (LTyClDecl GhcRn) (LTyClDecl GhcRn, SAKS_or_CUSK)
forall a b. b -&gt; Either a b
</span><a href="../../base/src/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LTyClDecl GhcRn
</span><a href="#local-6989586621681166612"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SAKS_or_CUSK
</span><a href="GHC.Tc.Gen.HsType.html#CUSK"><span class="hs-identifier hs-var">CUSK</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-644"></span><span>
</span><span id="line-645"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LTyClDecl GhcRn
-&gt; Either (LTyClDecl GhcRn) (LTyClDecl GhcRn, SAKS_or_CUSK)
forall a b. a -&gt; Either a b
</span><a href="../../base/src/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">LTyClDecl GhcRn
</span><a href="#local-6989586621681166612"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-646"></span><span>
</span><span id="line-647"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681166606"><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681166606"><span class="hs-identifier hs-var">checked_tcs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(LTyClDecl GhcRn, SAKS_or_CUSK)]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
</span><a href="GHC.Tc.TyCl.html#checkInitialKinds"><span class="hs-identifier hs-var">checkInitialKinds</span></a></span><span> </span><span class="annot"><span class="annottext">[(LTyClDecl GhcRn, SAKS_or_CUSK)]
</span><a href="#local-6989586621681166615"><span class="hs-identifier hs-var">kinded_decls</span></a></span><span>
</span><span id="line-648"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681166604"><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681166604"><span class="hs-identifier hs-var">inferred_tcs</span></a></span></span><span>
</span><span id="line-649"></span><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TyCon]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
forall a. [TyCon] -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.TyCl.html#tcExtendKindEnvWithTyCons"><span class="hs-identifier hs-var">tcExtendKindEnvWithTyCons</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681166606"><span class="hs-identifier hs-var">checked_tcs</span></a></span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon])
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-650"></span><span>               </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
forall r. TcM r -&gt; TcM r
</span><a href="GHC.Tc.Utils.Monad.html#pushTcLevelM_"><span class="hs-identifier hs-var">pushTcLevelM_</span></a></span><span>   </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon])
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>  </span><span class="hs-comment">-- We are going to kind-generalise, so</span><span>
</span><span id="line-651"></span><span>                                  </span><span class="hs-comment">-- unification variables in here must</span><span>
</span><span id="line-652"></span><span>                                  </span><span class="hs-comment">-- be one level in</span><span>
</span><span id="line-653"></span><span>               </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
forall r. TcM r -&gt; TcM r
</span><a href="GHC.Tc.Solver.html#solveEqualities"><span class="hs-identifier hs-var">solveEqualities</span></a></span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon])
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-654"></span><span>               </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>  </span><span class="hs-comment">-- Step 1: Bind kind variables for all decls</span><span>
</span><span id="line-655"></span><span>                    </span><span id="local-6989586621681166601"><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681166601"><span class="hs-identifier hs-var">mono_tcs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[LTyClDecl GhcRn] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
</span><a href="GHC.Tc.TyCl.html#inferInitialKinds"><span class="hs-identifier hs-var">inferInitialKinds</span></a></span><span> </span><span class="annot"><span class="annottext">[LTyClDecl GhcRn]
</span><a href="#local-6989586621681166616"><span class="hs-identifier hs-var">kindless_decls</span></a></span><span>
</span><span id="line-656"></span><span>
</span><span id="line-657"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;kcTyClGroup: initial kinds&quot;</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; TcRn ()) -&gt; SDoc -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-658"></span><span>                    </span><span class="annot"><span class="annottext">[TyCon] -&gt; SDoc
</span><a href="#local-6989586621681166599"><span class="hs-identifier hs-var">ppr_tc_kinds</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681166601"><span class="hs-identifier hs-var">mono_tcs</span></a></span><span>
</span><span id="line-659"></span><span>
</span><span id="line-660"></span><span>                    </span><span class="hs-comment">-- Step 2: Set extended envt, kind-check the decls</span><span>
</span><span id="line-661"></span><span>                    </span><span class="hs-comment">-- NB: the environment extension overrides the tycon</span><span>
</span><span id="line-662"></span><span>                    </span><span class="hs-comment">--     promotion-errors bindings</span><span>
</span><span id="line-663"></span><span>                    </span><span class="hs-comment">--     See Note [Type environment evolution]</span><span>
</span><span id="line-664"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">[TyCon] -&gt; TcRn () -&gt; TcRn ()
forall a. [TyCon] -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.TyCl.html#tcExtendKindEnvWithTyCons"><span class="hs-identifier hs-var">tcExtendKindEnvWithTyCons</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681166601"><span class="hs-identifier hs-var">mono_tcs</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcRn ()) -&gt; TcRn () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-665"></span><span>                    </span><span class="annot"><span class="annottext">(LTyClDecl GhcRn -&gt; TcRn ()) -&gt; [LTyClDecl GhcRn] -&gt; TcRn ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><a href="../../base/src/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a></span><span> </span><span class="annot"><span class="annottext">LTyClDecl GhcRn -&gt; TcRn ()
</span><a href="GHC.Tc.TyCl.html#kcLTyClDecl"><span class="hs-identifier hs-var">kcLTyClDecl</span></a></span><span> </span><span class="annot"><span class="annottext">[LTyClDecl GhcRn]
</span><a href="#local-6989586621681166616"><span class="hs-identifier hs-var">kindless_decls</span></a></span><span>
</span><span id="line-666"></span><span>
</span><span id="line-667"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">[TyCon] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681166601"><span class="hs-identifier hs-var">mono_tcs</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-668"></span><span>
</span><span id="line-669"></span><span>        </span><span class="hs-comment">-- Step 3: generalisation</span><span>
</span><span id="line-670"></span><span>        </span><span class="hs-comment">-- Finally, go through each tycon and give it its final kind,</span><span>
</span><span id="line-671"></span><span>        </span><span class="hs-comment">-- with all the required, specified, and inferred variables</span><span>
</span><span id="line-672"></span><span>        </span><span class="hs-comment">-- in order.</span><span>
</span><span id="line-673"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681166597"><span class="annot"><span class="annottext">inferred_tc_env :: NameEnv TyCon
</span><a href="#local-6989586621681166597"><span class="hs-identifier hs-var hs-var">inferred_tc_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Name, TyCon)] -&gt; NameEnv TyCon
forall a. [(Name, a)] -&gt; NameEnv a
</span><a href="GHC.Types.Name.Env.html#mkNameEnv"><span class="hs-identifier hs-var">mkNameEnv</span></a></span><span> </span><span class="annot"><span class="annottext">([(Name, TyCon)] -&gt; NameEnv TyCon)
-&gt; [(Name, TyCon)] -&gt; NameEnv TyCon
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-674"></span><span>                                </span><span class="annot"><span class="annottext">(TyCon -&gt; (Name, TyCon)) -&gt; [TyCon] -&gt; [(Name, TyCon)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681166596"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166596"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Name
</span><a href="GHC.Core.TyCon.html#tyConName"><span class="hs-identifier hs-var hs-var">tyConName</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166596"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166596"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681166604"><span class="hs-identifier hs-var">inferred_tcs</span></a></span><span>
</span><span id="line-675"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681166595"><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681166595"><span class="hs-identifier hs-var">generalized_tcs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(LTyClDecl GhcRn -&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon])
-&gt; [LTyClDecl GhcRn] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m [b]) -&gt; [a] -&gt; m [b]
</span><a href="GHC.Utils.Monad.html#concatMapM"><span class="hs-identifier hs-var">concatMapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NameEnv TyCon
-&gt; LTyClDecl GhcRn -&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
</span><a href="GHC.Tc.TyCl.html#generaliseTyClDecl"><span class="hs-identifier hs-var">generaliseTyClDecl</span></a></span><span> </span><span class="annot"><span class="annottext">NameEnv TyCon
</span><a href="#local-6989586621681166597"><span class="hs-identifier hs-var">inferred_tc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-676"></span><span>                                        </span><span class="annot"><span class="annottext">[LTyClDecl GhcRn]
</span><a href="#local-6989586621681166616"><span class="hs-identifier hs-var">kindless_decls</span></a></span><span>
</span><span id="line-677"></span><span>
</span><span id="line-678"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681166593"><span class="annot"><span class="annottext">poly_tcs :: [TyCon]
</span><a href="#local-6989586621681166593"><span class="hs-identifier hs-var hs-var">poly_tcs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681166606"><span class="hs-identifier hs-var">checked_tcs</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCon] -&gt; [TyCon] -&gt; [TyCon]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681166595"><span class="hs-identifier hs-var">generalized_tcs</span></a></span><span>
</span><span id="line-679"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;---- kcTyClGroup end ---- }&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyCon] -&gt; SDoc
</span><a href="#local-6989586621681166599"><span class="hs-identifier hs-var">ppr_tc_kinds</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681166593"><span class="hs-identifier hs-var">poly_tcs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-680"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">[TyCon] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681166593"><span class="hs-identifier hs-var">poly_tcs</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-681"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-682"></span><span>    </span><span id="local-6989586621681166599"><span class="annot"><span class="annottext">ppr_tc_kinds :: [TyCon] -&gt; SDoc
</span><a href="#local-6989586621681166599"><span class="hs-identifier hs-var hs-var">ppr_tc_kinds</span></a></span></span><span> </span><span id="local-6989586621681166592"><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681166592"><span class="hs-identifier hs-var">tcs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TyCon -&gt; SDoc) -&gt; [TyCon] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; SDoc
</span><a href="#local-6989586621681166591"><span class="hs-identifier hs-var">pp_tc</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681166592"><span class="hs-identifier hs-var">tcs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-683"></span><span>    </span><span id="local-6989586621681166591"><span class="annot"><span class="annottext">pp_tc :: TyCon -&gt; SDoc
</span><a href="#local-6989586621681166591"><span class="hs-identifier hs-var hs-var">pp_tc</span></a></span></span><span> </span><span id="local-6989586621681166588"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166588"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Name
</span><a href="GHC.Core.TyCon.html#tyConName"><span class="hs-identifier hs-var hs-var">tyConName</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166588"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Type
</span><a href="GHC.Core.TyCon.html#tyConKind"><span class="hs-identifier hs-var hs-var">tyConKind</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166588"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-684"></span><span>
</span><span id="line-685"></span><span class="hs-keyword">type</span><span> </span><span id="ScopedPairs"><span class="annot"><a href="GHC.Tc.TyCl.html#ScopedPairs"><span class="hs-identifier hs-var">ScopedPairs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-686"></span><span>  </span><span class="hs-comment">-- The ScopedPairs for a TcTyCon are precisely</span><span>
</span><span id="line-687"></span><span>  </span><span class="hs-comment">--    specified-tvs ++ required-tvs</span><span>
</span><span id="line-688"></span><span>  </span><span class="hs-comment">-- You can distinguish them because there are tyConArity required-tvs</span><span>
</span><span id="line-689"></span><span>
</span><span id="line-690"></span><span class="annot"><a href="GHC.Tc.TyCl.html#generaliseTyClDecl"><span class="hs-identifier hs-type">generaliseTyClDecl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Env.html#NameEnv"><span class="hs-identifier hs-type">NameEnv</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyCon"><span class="hs-identifier hs-type">TcTyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Decls.html#LTyClDecl"><span class="hs-identifier hs-type">LTyClDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyCon"><span class="hs-identifier hs-type">TcTyCon</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-691"></span><span class="hs-comment">-- See Note [Swizzling the tyvars before generaliseTcTyCon]</span><span>
</span><span id="line-692"></span><span id="generaliseTyClDecl"><span class="annot"><span class="annottext">generaliseTyClDecl :: NameEnv TyCon
-&gt; LTyClDecl GhcRn -&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
</span><a href="GHC.Tc.TyCl.html#generaliseTyClDecl"><span class="hs-identifier hs-var hs-var">generaliseTyClDecl</span></a></span></span><span> </span><span id="local-6989586621681166583"><span class="annot"><span class="annottext">NameEnv TyCon
</span><a href="#local-6989586621681166583"><span class="hs-identifier hs-var">inferred_tc_env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681166581"><span class="annot"><span class="annottext">TyClDecl GhcRn
</span><a href="#local-6989586621681166581"><span class="hs-identifier hs-var">decl</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-693"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621681166580"><span class="hs-identifier hs-type">names_in_this_decl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-694"></span><span>             </span><span id="local-6989586621681166580"><span class="annot"><span class="annottext">names_in_this_decl :: [Name]
</span><a href="#local-6989586621681166580"><span class="hs-identifier hs-var hs-var">names_in_this_decl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyClDecl GhcRn -&gt; [Name]
</span><a href="#local-6989586621681166579"><span class="hs-identifier hs-var">tycld_names</span></a></span><span> </span><span class="annot"><span class="annottext">TyClDecl GhcRn
</span><a href="#local-6989586621681166581"><span class="hs-identifier hs-var">decl</span></a></span><span>
</span><span id="line-695"></span><span>
</span><span id="line-696"></span><span>       </span><span class="hs-comment">-- Extract the specified/required binders and skolemise them</span><span>
</span><span id="line-697"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681166578"><span class="annot"><span class="annottext">[(TyCon, [(Name, TyVar)])]
</span><a href="#local-6989586621681166578"><span class="hs-identifier hs-var">tc_with_tvs</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) (TyCon, [(Name, TyVar)]))
-&gt; [Name]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [(TyCon, [(Name, TyVar)])]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) (TyCon, [(Name, TyVar)])
</span><a href="#local-6989586621681166576"><span class="hs-identifier hs-var">skolemise_tc_tycon</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621681166580"><span class="hs-identifier hs-var">names_in_this_decl</span></a></span><span>
</span><span id="line-698"></span><span>
</span><span id="line-699"></span><span>       </span><span class="hs-comment">-- Zonk, to manifest the side-effects of skolemisation to the swizzler</span><span>
</span><span id="line-700"></span><span>       </span><span class="hs-comment">-- NB: it's important to skolemise them all before this step. E.g.</span><span>
</span><span id="line-701"></span><span>       </span><span class="hs-comment">--         class C f where { type T (f :: k) }</span><span>
</span><span id="line-702"></span><span>       </span><span class="hs-comment">--     We only skolemise k when looking at T's binders,</span><span>
</span><span id="line-703"></span><span>       </span><span class="hs-comment">--     but k appears in f's kind in C's binders.</span><span>
</span><span id="line-704"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681166575"><span class="annot"><span class="annottext">[(TyCon, [(Name, TyVar)], Type)]
</span><a href="#local-6989586621681166575"><span class="hs-identifier hs-var">tc_infos</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((TyCon, [(Name, TyVar)])
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) (TyCon, [(Name, TyVar)], Type))
-&gt; [(TyCon, [(Name, TyVar)])]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [(TyCon, [(Name, TyVar)], Type)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">(TyCon, [(Name, TyVar)])
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (TyCon, [(Name, TyVar)], Type)
</span><a href="#local-6989586621681166574"><span class="hs-identifier hs-var">zonk_tc_tycon</span></a></span><span> </span><span class="annot"><span class="annottext">[(TyCon, [(Name, TyVar)])]
</span><a href="#local-6989586621681166578"><span class="hs-identifier hs-var">tc_with_tvs</span></a></span><span>
</span><span id="line-705"></span><span>
</span><span id="line-706"></span><span>       </span><span class="hs-comment">-- Swizzle</span><span>
</span><span id="line-707"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681166573"><span class="annot"><span class="annottext">[(TyCon, [(Name, TyVar)], Type)]
</span><a href="#local-6989586621681166573"><span class="hs-identifier hs-var">swizzled_infos</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyClDecl GhcRn
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [(TyCon, [(Name, TyVar)], Type)]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [(TyCon, [(Name, TyVar)], Type)]
forall a. TyClDecl GhcRn -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.TyCl.html#tcAddDeclCtxt"><span class="hs-identifier hs-var">tcAddDeclCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">TyClDecl GhcRn
</span><a href="#local-6989586621681166581"><span class="hs-identifier hs-var">decl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(TyCon, [(Name, TyVar)], Type)]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [(TyCon, [(Name, TyVar)], Type)]
</span><a href="GHC.Tc.TyCl.html#swizzleTcTyConBndrs"><span class="hs-identifier hs-var">swizzleTcTyConBndrs</span></a></span><span> </span><span class="annot"><span class="annottext">[(TyCon, [(Name, TyVar)], Type)]
</span><a href="#local-6989586621681166575"><span class="hs-identifier hs-var">tc_infos</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-708"></span><span>
</span><span id="line-709"></span><span>       </span><span class="hs-comment">-- And finally generalise</span><span>
</span><span id="line-710"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">((TyCon, [(Name, TyVar)], Type) -&gt; TcRn TyCon)
-&gt; [(TyCon, [(Name, TyVar)], Type)]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
forall a b. (a -&gt; TcRn b) -&gt; [a] -&gt; TcRn [b]
</span><a href="GHC.Tc.Utils.Monad.html#mapAndReportM"><span class="hs-identifier hs-var">mapAndReportM</span></a></span><span> </span><span class="annot"><span class="annottext">(TyCon, [(Name, TyVar)], Type) -&gt; TcRn TyCon
</span><a href="GHC.Tc.TyCl.html#generaliseTcTyCon"><span class="hs-identifier hs-var">generaliseTcTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">[(TyCon, [(Name, TyVar)], Type)]
</span><a href="#local-6989586621681166573"><span class="hs-identifier hs-var">swizzled_infos</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-711"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-712"></span><span>    </span><span class="annot"><a href="#local-6989586621681166579"><span class="hs-identifier hs-type">tycld_names</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Decls.html#TyClDecl"><span class="hs-identifier hs-type">TyClDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-713"></span><span>    </span><span id="local-6989586621681166579"><span class="annot"><span class="annottext">tycld_names :: TyClDecl GhcRn -&gt; [Name]
</span><a href="#local-6989586621681166579"><span class="hs-identifier hs-var hs-var">tycld_names</span></a></span></span><span> </span><span id="local-6989586621681166568"><span class="annot"><span class="annottext">TyClDecl GhcRn
</span><a href="#local-6989586621681166568"><span class="hs-identifier hs-var">decl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyClDecl GhcRn -&gt; IdP GhcRn
forall (p :: Pass). TyClDecl (GhcPass p) -&gt; IdP (GhcPass p)
</span><a href="GHC.Hs.Decls.html#tcdName"><span class="hs-identifier hs-var">tcdName</span></a></span><span> </span><span class="annot"><span class="annottext">TyClDecl GhcRn
</span><a href="#local-6989586621681166568"><span class="hs-identifier hs-var">decl</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Name] -&gt; [Name]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">TyClDecl GhcRn -&gt; [Name]
</span><a href="#local-6989586621681166567"><span class="hs-identifier hs-var">at_names</span></a></span><span> </span><span class="annot"><span class="annottext">TyClDecl GhcRn
</span><a href="#local-6989586621681166568"><span class="hs-identifier hs-var">decl</span></a></span><span>
</span><span id="line-714"></span><span>
</span><span id="line-715"></span><span>    </span><span class="annot"><a href="#local-6989586621681166567"><span class="hs-identifier hs-type">at_names</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Decls.html#TyClDecl"><span class="hs-identifier hs-type">TyClDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-716"></span><span>    </span><span id="local-6989586621681166567"><span class="annot"><span class="annottext">at_names :: TyClDecl GhcRn -&gt; [Name]
</span><a href="#local-6989586621681166567"><span class="hs-identifier hs-var hs-var">at_names</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Decls.html#ClassDecl"><span class="hs-identifier hs-type">ClassDecl</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcdATs :: forall pass. TyClDecl pass -&gt; [LFamilyDecl pass]
</span><a href="GHC.Hs.Decls.html#tcdATs"><span class="hs-identifier hs-var">tcdATs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681166564"><span class="annot"><span class="annottext">[LFamilyDecl GhcRn]
</span><a href="#local-6989586621681166564"><span class="hs-identifier hs-var">ats</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LFamilyDecl GhcRn -&gt; Name) -&gt; [LFamilyDecl GhcRn] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FamilyDecl GhcRn -&gt; Name
forall (p :: Pass). FamilyDecl (GhcPass p) -&gt; IdP (GhcPass p)
</span><a href="GHC.Hs.Decls.html#familyDeclName"><span class="hs-identifier hs-var">familyDeclName</span></a></span><span> </span><span class="annot"><span class="annottext">(FamilyDecl GhcRn -&gt; Name)
-&gt; (LFamilyDecl GhcRn -&gt; FamilyDecl GhcRn)
-&gt; LFamilyDecl GhcRn
-&gt; Name
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">LFamilyDecl GhcRn -&gt; FamilyDecl GhcRn
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LFamilyDecl GhcRn]
</span><a href="#local-6989586621681166564"><span class="hs-identifier hs-var">ats</span></a></span><span>
</span><span id="line-717"></span><span>    </span><span class="annot"><a href="#local-6989586621681166567"><span class="hs-identifier hs-var">at_names</span></a></span><span> </span><span class="annot"><span class="annottext">TyClDecl GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- Only class decls have associated types</span><span>
</span><span id="line-718"></span><span>
</span><span id="line-719"></span><span>    </span><span class="annot"><a href="#local-6989586621681166576"><span class="hs-identifier hs-type">skolemise_tc_tycon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyCon"><span class="hs-identifier hs-type">TcTyCon</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.TyCl.html#ScopedPairs"><span class="hs-identifier hs-type">ScopedPairs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-720"></span><span>    </span><span class="hs-comment">-- Zonk and skolemise the Specified and Required binders</span><span>
</span><span id="line-721"></span><span>    </span><span id="local-6989586621681166576"><span class="annot"><span class="annottext">skolemise_tc_tycon :: Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) (TyCon, [(Name, TyVar)])
</span><a href="#local-6989586621681166576"><span class="hs-identifier hs-var hs-var">skolemise_tc_tycon</span></a></span></span><span> </span><span id="local-6989586621681166562"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681166562"><span class="hs-identifier hs-var">tc_name</span></a></span></span><span>
</span><span id="line-722"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681166561"><span class="annot"><span class="annottext">tc :: TyCon
</span><a href="#local-6989586621681166561"><span class="hs-identifier hs-var hs-var">tc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NameEnv TyCon -&gt; Name -&gt; TyCon
forall a. NameEnv a -&gt; Name -&gt; a
</span><a href="GHC.Types.Name.Env.html#lookupNameEnv_NF"><span class="hs-identifier hs-var">lookupNameEnv_NF</span></a></span><span> </span><span class="annot"><span class="annottext">NameEnv TyCon
</span><a href="#local-6989586621681166583"><span class="hs-identifier hs-var">inferred_tc_env</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681166562"><span class="hs-identifier hs-var">tc_name</span></a></span><span>
</span><span id="line-723"></span><span>                      </span><span class="hs-comment">-- This lookup should not fail</span><span>
</span><span id="line-724"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681166559"><span class="annot"><span class="annottext">[(Name, TyVar)]
</span><a href="#local-6989586621681166559"><span class="hs-identifier hs-var">scoped_prs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TyVar -&gt; IOEnv (Env TcGblEnv TcLclEnv) TyVar)
-&gt; [(Name, TyVar)] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [(Name, TyVar)]
forall (m :: * -&gt; *) b c a.
Monad m =&gt;
(b -&gt; m c) -&gt; [(a, b)] -&gt; m [(a, c)]
</span><a href="GHC.Utils.Monad.html#mapSndM"><span class="hs-identifier hs-var">mapSndM</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar -&gt; IOEnv (Env TcGblEnv TcLclEnv) TyVar
</span><a href="GHC.Tc.Utils.TcMType.html#zonkAndSkolemise"><span class="hs-identifier hs-var">zonkAndSkolemise</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [(Name, TyVar)]
</span><a href="GHC.Core.TyCon.html#tcTyConScopedTyVars"><span class="hs-identifier hs-var hs-var">tcTyConScopedTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166561"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-725"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(TyCon, [(Name, TyVar)])
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (TyCon, [(Name, TyVar)])
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166561"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Name, TyVar)]
</span><a href="#local-6989586621681166559"><span class="hs-identifier hs-var">scoped_prs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-726"></span><span>
</span><span id="line-727"></span><span>    </span><span class="annot"><a href="#local-6989586621681166574"><span class="hs-identifier hs-type">zonk_tc_tycon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyCon"><span class="hs-identifier hs-type">TcTyCon</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.TyCl.html#ScopedPairs"><span class="hs-identifier hs-type">ScopedPairs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyCon"><span class="hs-identifier hs-type">TcTyCon</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.TyCl.html#ScopedPairs"><span class="hs-identifier hs-type">ScopedPairs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-728"></span><span>    </span><span id="local-6989586621681166574"><span class="annot"><span class="annottext">zonk_tc_tycon :: (TyCon, [(Name, TyVar)])
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (TyCon, [(Name, TyVar)], Type)
</span><a href="#local-6989586621681166574"><span class="hs-identifier hs-var hs-var">zonk_tc_tycon</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681166554"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166554"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681166553"><span class="annot"><span class="annottext">[(Name, TyVar)]
</span><a href="#local-6989586621681166553"><span class="hs-identifier hs-var">scoped_prs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-729"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681166552"><span class="annot"><span class="annottext">[(Name, TyVar)]
</span><a href="#local-6989586621681166552"><span class="hs-identifier hs-var">scoped_prs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TyVar -&gt; IOEnv (Env TcGblEnv TcLclEnv) TyVar)
-&gt; [(Name, TyVar)] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [(Name, TyVar)]
forall (m :: * -&gt; *) b c a.
Monad m =&gt;
(b -&gt; m c) -&gt; [(a, b)] -&gt; m [(a, c)]
</span><a href="GHC.Utils.Monad.html#mapSndM"><span class="hs-identifier hs-var">mapSndM</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; TyVar -&gt; IOEnv (Env TcGblEnv TcLclEnv) TyVar
TyVar -&gt; IOEnv (Env TcGblEnv TcLclEnv) TyVar
</span><a href="GHC.Tc.Utils.TcMType.html#zonkTcTyVarToTyVar"><span class="hs-identifier hs-var">zonkTcTyVarToTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, TyVar)]
</span><a href="#local-6989586621681166553"><span class="hs-identifier hs-var">scoped_prs</span></a></span><span>
</span><span id="line-730"></span><span>                           </span><span class="hs-comment">-- We really have to do this again, even though</span><span>
</span><span id="line-731"></span><span>                           </span><span class="hs-comment">-- we have just done zonkAndSkolemise</span><span>
</span><span id="line-732"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681166550"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681166550"><span class="hs-identifier hs-var">res_kind</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Utils.TcMType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Type
</span><a href="GHC.Core.TyCon.html#tyConResKind"><span class="hs-identifier hs-var hs-var">tyConResKind</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166554"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-733"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(TyCon, [(Name, TyVar)], Type)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (TyCon, [(Name, TyVar)], Type)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166554"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(Name, TyVar)]
</span><a href="#local-6989586621681166552"><span class="hs-identifier hs-var">scoped_prs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681166550"><span class="hs-identifier hs-var">res_kind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-734"></span><span>
</span><span id="line-735"></span><span class="annot"><a href="GHC.Tc.TyCl.html#swizzleTcTyConBndrs"><span class="hs-identifier hs-type">swizzleTcTyConBndrs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyCon"><span class="hs-identifier hs-type">TcTyCon</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.TyCl.html#ScopedPairs"><span class="hs-identifier hs-type">ScopedPairs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-736"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyCon"><span class="hs-identifier hs-type">TcTyCon</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.TyCl.html#ScopedPairs"><span class="hs-identifier hs-type">ScopedPairs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-737"></span><span id="swizzleTcTyConBndrs"><span class="annot"><span class="annottext">swizzleTcTyConBndrs :: [(TyCon, [(Name, TyVar)], Type)]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [(TyCon, [(Name, TyVar)], Type)]
</span><a href="GHC.Tc.TyCl.html#swizzleTcTyConBndrs"><span class="hs-identifier hs-var hs-var">swizzleTcTyConBndrs</span></a></span></span><span> </span><span id="local-6989586621681166548"><span class="annot"><span class="annottext">[(TyCon, [(Name, TyVar)], Type)]
</span><a href="#local-6989586621681166548"><span class="hs-identifier hs-var">tc_infos</span></a></span></span><span>
</span><span id="line-738"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">((Name, TyVar) -&gt; Bool) -&gt; [(Name, TyVar)] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#all"><span class="hs-identifier hs-var">all</span></a></span><span> </span><span class="annot"><span class="annottext">(Name, TyVar) -&gt; Bool
</span><a href="#local-6989586621681166546"><span class="hs-identifier hs-var">no_swizzle</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, TyVar)]
</span><a href="#local-6989586621681166545"><span class="hs-identifier hs-var">swizzle_prs</span></a></span><span>
</span><span id="line-739"></span><span>    </span><span class="hs-comment">-- This fast path happens almost all the time</span><span>
</span><span id="line-740"></span><span>    </span><span class="hs-comment">-- See Note [Non-cloning for tyvar binders] in GHC.Tc.Gen.HsType</span><span>
</span><span id="line-741"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Skipping swizzleTcTyConBndrs for&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyCon] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((TyCon, [(Name, TyVar)], Type) -&gt; TyCon)
-&gt; [(TyCon, [(Name, TyVar)], Type)] -&gt; [TyCon]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">(TyCon, [(Name, TyVar)], Type) -&gt; TyCon
forall a b c. (a, b, c) -&gt; a
</span><a href="GHC.Utils.Misc.html#fstOf3"><span class="hs-identifier hs-var">fstOf3</span></a></span><span> </span><span class="annot"><span class="annottext">[(TyCon, [(Name, TyVar)], Type)]
</span><a href="#local-6989586621681166548"><span class="hs-identifier hs-var">tc_infos</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-742"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">[(TyCon, [(Name, TyVar)], Type)]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [(TyCon, [(Name, TyVar)], Type)]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">[(TyCon, [(Name, TyVar)], Type)]
</span><a href="#local-6989586621681166548"><span class="hs-identifier hs-var">tc_infos</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-743"></span><span>
</span><span id="line-744"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-745"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">TcRn ()
</span><a href="#local-6989586621681166543"><span class="hs-identifier hs-var">check_duplicate_tc_binders</span></a></span><span>
</span><span id="line-746"></span><span>
</span><span id="line-747"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;swizzleTcTyConBndrs&quot;</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; TcRn ()) -&gt; SDoc -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-748"></span><span>         </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;before&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[(TyCon, [(Name, TyVar)], Type)] -&gt; SDoc
forall {a} {a} {c}. Outputable a =&gt; [(a, [(a, TyVar)], c)] -&gt; SDoc
</span><a href="#local-6989586621681166542"><span class="hs-identifier hs-var">ppr_infos</span></a></span><span> </span><span class="annot"><span class="annottext">[(TyCon, [(Name, TyVar)], Type)]
</span><a href="#local-6989586621681166548"><span class="hs-identifier hs-var">tc_infos</span></a></span><span>
</span><span id="line-749"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;swizzle_prs&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, TyVar)] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, TyVar)]
</span><a href="#local-6989586621681166545"><span class="hs-identifier hs-var">swizzle_prs</span></a></span><span>
</span><span id="line-750"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;after&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[(TyCon, [(Name, TyVar)], Type)] -&gt; SDoc
forall {a} {a} {c}. Outputable a =&gt; [(a, [(a, TyVar)], c)] -&gt; SDoc
</span><a href="#local-6989586621681166542"><span class="hs-identifier hs-var">ppr_infos</span></a></span><span> </span><span class="annot"><span class="annottext">[(TyCon, [(Name, TyVar)], Type)]
</span><a href="#local-6989586621681166541"><span class="hs-identifier hs-var">swizzled_infos</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-751"></span><span>
</span><span id="line-752"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">[(TyCon, [(Name, TyVar)], Type)]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [(TyCon, [(Name, TyVar)], Type)]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">[(TyCon, [(Name, TyVar)], Type)]
</span><a href="#local-6989586621681166541"><span class="hs-identifier hs-var">swizzled_infos</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-753"></span><span>
</span><span id="line-754"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-755"></span><span>    </span><span id="local-6989586621681166541"><span class="annot"><span class="annottext">swizzled_infos :: [(TyCon, [(Name, TyVar)], Type)]
</span><a href="#local-6989586621681166541"><span class="hs-identifier hs-var hs-var">swizzled_infos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166540"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(TyVar -&gt; TyVar) -&gt; [(Name, TyVar)] -&gt; [(Name, TyVar)]
forall b c a. (b -&gt; c) -&gt; [(a, b)] -&gt; [(a, c)]
</span><a href="GHC.Utils.Misc.html#mapSnd"><span class="hs-identifier hs-var">mapSnd</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar -&gt; TyVar
</span><a href="#local-6989586621681166538"><span class="hs-identifier hs-var">swizzle_var</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, TyVar)]
</span><a href="#local-6989586621681166537"><span class="hs-identifier hs-var">scoped_prs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type
</span><a href="#local-6989586621681166536"><span class="hs-identifier hs-var">swizzle_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681166535"><span class="hs-identifier hs-var">kind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-756"></span><span>                      </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681166540"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166540"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681166537"><span class="annot"><span class="annottext">[(Name, TyVar)]
</span><a href="#local-6989586621681166537"><span class="hs-identifier hs-var">scoped_prs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681166535"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681166535"><span class="hs-identifier hs-var">kind</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(TyCon, [(Name, TyVar)], Type)]
</span><a href="#local-6989586621681166548"><span class="hs-identifier hs-var">tc_infos</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-757"></span><span>
</span><span id="line-758"></span><span>    </span><span class="annot"><a href="#local-6989586621681166545"><span class="hs-identifier hs-type">swizzle_prs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-759"></span><span>    </span><span class="hs-comment">-- Pairs the user-specifed Name with its representative TyVar</span><span>
</span><span id="line-760"></span><span>    </span><span class="hs-comment">-- See Note [Swizzling the tyvars before generaliseTcTyCon]</span><span>
</span><span id="line-761"></span><span>    </span><span id="local-6989586621681166545"><span class="annot"><span class="annottext">swizzle_prs :: [(Name, TyVar)]
</span><a href="#local-6989586621681166545"><span class="hs-identifier hs-var hs-var">swizzle_prs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(Name, TyVar)
</span><a href="#local-6989586621681166534"><span class="hs-identifier hs-var">pr</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681166533"><span class="annot"><span class="annottext">[(Name, TyVar)]
</span><a href="#local-6989586621681166533"><span class="hs-identifier hs-var">prs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(TyCon, [(Name, TyVar)], Type)]
</span><a href="#local-6989586621681166548"><span class="hs-identifier hs-var">tc_infos</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681166534"><span class="annot"><span class="annottext">(Name, TyVar)
</span><a href="#local-6989586621681166534"><span class="hs-identifier hs-var">pr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Name, TyVar)]
</span><a href="#local-6989586621681166533"><span class="hs-identifier hs-var">prs</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-762"></span><span>
</span><span id="line-763"></span><span>    </span><span class="annot"><a href="#local-6989586621681166546"><span class="hs-identifier hs-type">no_swizzle</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-764"></span><span>    </span><span id="local-6989586621681166546"><span class="annot"><span class="annottext">no_swizzle :: (Name, TyVar) -&gt; Bool
</span><a href="#local-6989586621681166546"><span class="hs-identifier hs-var hs-var">no_swizzle</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681166532"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681166532"><span class="hs-identifier hs-var">nm</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681166531"><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681166531"><span class="hs-identifier hs-var">tv</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681166532"><span class="hs-identifier hs-var">nm</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">TyVar -&gt; Name
</span><a href="GHC.Types.Var.html#tyVarName"><span class="hs-identifier hs-var">tyVarName</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681166531"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-765"></span><span>
</span><span id="line-766"></span><span>    </span><span id="local-6989586621681166542"><span class="annot"><span class="annottext">ppr_infos :: [(a, [(a, TyVar)], c)] -&gt; SDoc
</span><a href="#local-6989586621681166542"><span class="hs-identifier hs-var hs-var">ppr_infos</span></a></span></span><span> </span><span id="local-6989586621681166527"><span class="annot"><span class="annottext">[(a, [(a, TyVar)], c)]
</span><a href="#local-6989586621681166527"><span class="hs-identifier hs-var">infos</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">a -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681166526"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; SDoc
</span><a href="GHC.Core.TyCo.Ppr.html#pprTyVars"><span class="hs-identifier hs-var">pprTyVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((a, TyVar) -&gt; TyVar) -&gt; [(a, TyVar)] -&gt; [TyVar]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">(a, TyVar) -&gt; TyVar
forall a b. (a, b) -&gt; b
</span><a href="../../base/src/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">[(a, TyVar)]
</span><a href="#local-6989586621681166525"><span class="hs-identifier hs-var">prs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-767"></span><span>                           </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681166526"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681166526"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681166525"><span class="annot"><span class="annottext">[(a, TyVar)]
</span><a href="#local-6989586621681166525"><span class="hs-identifier hs-var">prs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">c
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(a, [(a, TyVar)], c)]
</span><a href="#local-6989586621681166527"><span class="hs-identifier hs-var">infos</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-768"></span><span>
</span><span id="line-769"></span><span>    </span><span class="hs-comment">-- Check for duplicates</span><span>
</span><span id="line-770"></span><span>    </span><span class="hs-comment">-- E.g. data SameKind (a::k) (b::k)</span><span>
</span><span id="line-771"></span><span>    </span><span class="hs-comment">--      data T (a::k1) (b::k2) = MkT (SameKind a b)</span><span>
</span><span id="line-772"></span><span>    </span><span class="hs-comment">-- Here k1 and k2 start as TyVarTvs, and get unified with each other</span><span>
</span><span id="line-773"></span><span>    </span><span class="hs-comment">-- If this happens, things get very confused later, so fail fast</span><span>
</span><span id="line-774"></span><span>    </span><span class="annot"><a href="#local-6989586621681166543"><span class="hs-identifier hs-type">check_duplicate_tc_binders</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-775"></span><span>    </span><span id="local-6989586621681166543"><span class="annot"><span class="annottext">check_duplicate_tc_binders :: TcRn ()
</span><a href="#local-6989586621681166543"><span class="hs-identifier hs-var hs-var">check_duplicate_tc_binders</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRn () -&gt; TcRn ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base/src/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Name, Name)] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, Name)]
</span><a href="#local-6989586621681166522"><span class="hs-identifier hs-var">err_prs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcRn ()) -&gt; TcRn () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-776"></span><span>                                 </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">((Name, Name) -&gt; TcRn ()) -&gt; [(Name, Name)] -&gt; TcRn ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><a href="../../base/src/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a></span><span> </span><span class="annot"><span class="annottext">(Name, Name) -&gt; TcRn ()
</span><a href="#local-6989586621681166521"><span class="hs-identifier hs-var">report_dup</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, Name)]
</span><a href="#local-6989586621681166522"><span class="hs-identifier hs-var">err_prs</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcRn ()
forall env a. IOEnv env a
</span><a href="GHC.Data.IOEnv.html#failM"><span class="hs-identifier hs-var">failM</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-777"></span><span>
</span><span id="line-778"></span><span>    </span><span class="hs-comment">-------------- Error reporting ------------</span><span>
</span><span id="line-779"></span><span>    </span><span class="annot"><a href="#local-6989586621681166522"><span class="hs-identifier hs-type">err_prs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-780"></span><span>    </span><span id="local-6989586621681166522"><span class="annot"><span class="annottext">err_prs :: [(Name, Name)]
</span><a href="#local-6989586621681166522"><span class="hs-identifier hs-var hs-var">err_prs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681166519"><span class="hs-identifier hs-var">n1</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681166518"><span class="hs-identifier hs-var">n2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-781"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681166517"><span class="annot"><span class="annottext">(Name, TyVar)
</span><a href="#local-6989586621681166517"><span class="hs-identifier hs-var">pr</span></a></span></span><span> </span><span class="annot"><a href="../../base/src/GHC.Base.html#%3A%7C"><span class="hs-operator hs-type">:|</span></a></span><span> </span><span id="local-6989586621681166515"><span class="annot"><span class="annottext">[(Name, TyVar)]
</span><a href="#local-6989586621681166515"><span class="hs-identifier hs-var">prs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((Name, TyVar) -&gt; (Name, TyVar) -&gt; Bool)
-&gt; [(Name, TyVar)] -&gt; [NonEmpty (Name, TyVar)]
forall a. (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [NonEmpty a]
</span><a href="GHC.Data.List.SetOps.html#findDupsEq"><span class="hs-identifier hs-var">findDupsEq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyVar -&gt; TyVar -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">(==)</span></span><span> </span><span class="annot"><span class="annottext">(TyVar -&gt; TyVar -&gt; Bool)
-&gt; ((Name, TyVar) -&gt; TyVar)
-&gt; (Name, TyVar)
-&gt; (Name, TyVar)
-&gt; Bool
forall b c a. (b -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; a -&gt; c
</span><a href="../../base/src/Data.Function.html#on"><span class="hs-operator hs-var">`on`</span></a></span><span> </span><span class="annot"><span class="annottext">(Name, TyVar) -&gt; TyVar
forall a b. (a, b) -&gt; b
</span><a href="../../base/src/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Name, TyVar)]
</span><a href="#local-6989586621681166545"><span class="hs-identifier hs-var">swizzle_prs</span></a></span><span>
</span><span id="line-782"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681166519"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681166519"><span class="hs-identifier hs-var">n1</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">TyVar
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="hs-special">(</span><span id="local-6989586621681166518"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681166518"><span class="hs-identifier hs-var">n2</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">TyVar
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[(Name, TyVar)]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">((Name, TyVar) -&gt; (Name, TyVar) -&gt; Bool)
-&gt; [(Name, TyVar)] -&gt; [(Name, TyVar)]
forall a. (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../base/src/Data.OldList.html#nubBy"><span class="hs-identifier hs-var">nubBy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">(==)</span></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Name -&gt; Bool)
-&gt; ((Name, TyVar) -&gt; Name)
-&gt; (Name, TyVar)
-&gt; (Name, TyVar)
-&gt; Bool
forall b c a. (b -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; a -&gt; c
</span><a href="../../base/src/Data.Function.html#on"><span class="hs-operator hs-var">`on`</span></a></span><span> </span><span class="annot"><span class="annottext">(Name, TyVar) -&gt; Name
forall a b. (a, b) -&gt; a
</span><a href="../../base/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Name, TyVar)
</span><a href="#local-6989586621681166517"><span class="hs-identifier hs-var">pr</span></a></span><span class="annot"><span class="annottext">(Name, TyVar) -&gt; [(Name, TyVar)] -&gt; [(Name, TyVar)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[(Name, TyVar)]
</span><a href="#local-6989586621681166515"><span class="hs-identifier hs-var">prs</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-783"></span><span>              </span><span class="hs-comment">-- This nubBy avoids bogus error reports when we have</span><span>
</span><span id="line-784"></span><span>              </span><span class="hs-comment">--    [(&quot;f&quot;, f), ..., (&quot;f&quot;,f)....] in swizzle_prs</span><span>
</span><span id="line-785"></span><span>              </span><span class="hs-comment">-- which happens with  class C f where { type T f }</span><span>
</span><span id="line-786"></span><span>
</span><span id="line-787"></span><span>    </span><span class="annot"><a href="#local-6989586621681166521"><span class="hs-identifier hs-type">report_dup</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-788"></span><span>    </span><span id="local-6989586621681166521"><span class="annot"><span class="annottext">report_dup :: (Name, Name) -&gt; TcRn ()
</span><a href="#local-6989586621681166521"><span class="hs-identifier hs-var hs-var">report_dup</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681166512"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681166512"><span class="hs-identifier hs-var">n1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681166511"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681166511"><span class="hs-identifier hs-var">n2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-789"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcRn () -&gt; TcRn ()
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SrcSpan
forall a. NamedThing a =&gt; a -&gt; SrcSpan
</span><a href="GHC.Types.Name.html#getSrcSpan"><span class="hs-identifier hs-var">getSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681166511"><span class="hs-identifier hs-var">n2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcRn ()) -&gt; TcRn () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrTc"><span class="hs-identifier hs-var">addErrTc</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; TcRn ()) -&gt; SDoc -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-790"></span><span>        </span><span class="annot"><span class="annottext">SDoc -&gt; Arity -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Different names for the same type variable:&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681166506"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-791"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-792"></span><span>        </span><span id="local-6989586621681166506"><span class="annot"><span class="annottext">info :: SDoc
</span><a href="#local-6989586621681166506"><span class="hs-identifier hs-var hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name -&gt; OccName
</span><a href="GHC.Types.Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681166512"><span class="hs-identifier hs-var">n1</span></a></span><span> </span><span class="annot"><span class="annottext">OccName -&gt; OccName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Name -&gt; OccName
</span><a href="GHC.Types.Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681166511"><span class="hs-identifier hs-var">n2</span></a></span><span>
</span><span id="line-793"></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681166512"><span class="hs-identifier hs-var">n1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;and&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681166511"><span class="hs-identifier hs-var">n2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-794"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-comment">-- Same OccNames! See C2 in</span><span>
</span><span id="line-795"></span><span>                         </span><span class="hs-comment">-- Note [Swizzling the tyvars before generaliseTcTyCon]</span><span>
</span><span id="line-796"></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681166512"><span class="hs-identifier hs-var">n1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;bound at&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SrcLoc
forall a. NamedThing a =&gt; a -&gt; SrcLoc
</span><a href="GHC.Types.Name.html#getSrcLoc"><span class="hs-identifier hs-var">getSrcLoc</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681166512"><span class="hs-identifier hs-var">n1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-797"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681166511"><span class="hs-identifier hs-var">n2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;bound at&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SrcLoc
forall a. NamedThing a =&gt; a -&gt; SrcLoc
</span><a href="GHC.Types.Name.html#getSrcLoc"><span class="hs-identifier hs-var">getSrcLoc</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681166511"><span class="hs-identifier hs-var">n2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-798"></span><span>
</span><span id="line-799"></span><span>    </span><span class="hs-comment">-------------- The swizzler ------------</span><span>
</span><span id="line-800"></span><span>    </span><span class="hs-comment">-- This does a deep traverse, simply doing a</span><span>
</span><span id="line-801"></span><span>    </span><span class="hs-comment">-- Name-to-Name change, governed by swizzle_env</span><span>
</span><span id="line-802"></span><span>    </span><span class="hs-comment">-- The 'swap' is what gets from the representative TyVar</span><span>
</span><span id="line-803"></span><span>    </span><span class="hs-comment">-- back to the original user-specified Name</span><span>
</span><span id="line-804"></span><span>    </span><span id="local-6989586621681166501"><span class="annot"><span class="annottext">swizzle_env :: VarEnv Name
</span><a href="#local-6989586621681166501"><span class="hs-identifier hs-var hs-var">swizzle_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(TyVar, Name)] -&gt; VarEnv Name
forall a. [(TyVar, a)] -&gt; VarEnv a
</span><a href="GHC.Types.Var.Env.html#mkVarEnv"><span class="hs-identifier hs-var">mkVarEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((Name, TyVar) -&gt; (TyVar, Name))
-&gt; [(Name, TyVar)] -&gt; [(TyVar, Name)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">(Name, TyVar) -&gt; (TyVar, Name)
forall a b. (a, b) -&gt; (b, a)
</span><a href="../../base/src/Data.Tuple.html#swap"><span class="hs-identifier hs-var">swap</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, TyVar)]
</span><a href="#local-6989586621681166545"><span class="hs-identifier hs-var">swizzle_prs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-805"></span><span>
</span><span id="line-806"></span><span>    </span><span class="annot"><a href="#local-6989586621681166499"><span class="hs-identifier hs-type">swizzleMapper</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Type.html#TyCoMapper"><span class="hs-identifier hs-type">TyCoMapper</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="../../base/src/Data.Functor.Identity.html#Identity"><span class="hs-identifier hs-type">Identity</span></a></span><span>
</span><span id="line-807"></span><span>    </span><span id="local-6989586621681166499"><span class="annot"><span class="annottext">swizzleMapper :: TyCoMapper () Identity
</span><a href="#local-6989586621681166499"><span class="hs-identifier hs-var hs-var">swizzleMapper</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCoMapper :: forall env (m :: * -&gt; *).
(env -&gt; TyVar -&gt; m Type)
-&gt; (env -&gt; TyVar -&gt; m Coercion)
-&gt; (env -&gt; CoercionHole -&gt; m Coercion)
-&gt; (env -&gt; TyVar -&gt; ArgFlag -&gt; m (env, TyVar))
-&gt; (TyCon -&gt; m TyCon)
-&gt; TyCoMapper env m
</span><a href="GHC.Core.Type.html#TyCoMapper"><span class="hs-identifier hs-type">TyCoMapper</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcm_tyvar :: () -&gt; TyVar -&gt; Identity Type
</span><a href="GHC.Core.Type.html#tcm_tyvar"><span class="hs-identifier hs-var">tcm_tyvar</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TyVar -&gt; Identity Type
forall {m :: * -&gt; *} {p}. Monad m =&gt; p -&gt; TyVar -&gt; m Type
</span><a href="#local-6989586621681166496"><span class="hs-identifier hs-var">swizzle_tv</span></a></span><span>
</span><span id="line-808"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcm_covar :: () -&gt; TyVar -&gt; Identity Coercion
</span><a href="GHC.Core.Type.html#tcm_covar"><span class="hs-identifier hs-var">tcm_covar</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TyVar -&gt; Identity Coercion
forall {m :: * -&gt; *} {p}. Monad m =&gt; p -&gt; TyVar -&gt; m Coercion
</span><a href="#local-6989586621681166494"><span class="hs-identifier hs-var">swizzle_cv</span></a></span><span>
</span><span id="line-809"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcm_hole :: () -&gt; CoercionHole -&gt; Identity Coercion
</span><a href="GHC.Core.Type.html#tcm_hole"><span class="hs-identifier hs-var">tcm_hole</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; CoercionHole -&gt; Identity Coercion
forall {a} {p} {a}. Outputable a =&gt; p -&gt; a -&gt; a
</span><a href="#local-6989586621681166492"><span class="hs-identifier hs-var">swizzle_hole</span></a></span><span>
</span><span id="line-810"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcm_tycobinder :: () -&gt; TyVar -&gt; ArgFlag -&gt; Identity ((), TyVar)
</span><a href="GHC.Core.Type.html#tcm_tycobinder"><span class="hs-identifier hs-var">tcm_tycobinder</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TyVar -&gt; ArgFlag -&gt; Identity ((), TyVar)
forall {m :: * -&gt; *} {p} {p}.
Monad m =&gt;
p -&gt; TyVar -&gt; p -&gt; m ((), TyVar)
</span><a href="#local-6989586621681166490"><span class="hs-identifier hs-var">swizzle_bndr</span></a></span><span>
</span><span id="line-811"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcm_tycon :: TyCon -&gt; Identity TyCon
</span><a href="GHC.Core.Type.html#tcm_tycon"><span class="hs-identifier hs-var">tcm_tycon</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Identity TyCon
forall {a} {a}. Outputable a =&gt; a -&gt; a
</span><a href="#local-6989586621681166488"><span class="hs-identifier hs-var">swizzle_tycon</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-812"></span><span>    </span><span id="local-6989586621681166492"><span class="annot"><span class="annottext">swizzle_hole :: p -&gt; a -&gt; a
</span><a href="#local-6989586621681166492"><span class="hs-identifier hs-var hs-var">swizzle_hole</span></a></span></span><span>  </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681166483"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681166483"><span class="hs-identifier hs-var">hole</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; a
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;swizzle_hole&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681166483"><span class="hs-identifier hs-var">hole</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-813"></span><span>       </span><span class="hs-comment">-- These types are pre-zonked</span><span>
</span><span id="line-814"></span><span>    </span><span id="local-6989586621681166488"><span class="annot"><span class="annottext">swizzle_tycon :: a -&gt; a
</span><a href="#local-6989586621681166488"><span class="hs-identifier hs-var hs-var">swizzle_tycon</span></a></span></span><span> </span><span id="local-6989586621681166478"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681166478"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; a
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;swizzle_tc&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681166478"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-815"></span><span>       </span><span class="hs-comment">-- TcTyCons can't appear in kinds (yet)</span><span>
</span><span id="line-816"></span><span>    </span><span id="local-6989586621681166496"><span class="annot"><span class="annottext">swizzle_tv :: p -&gt; TyVar -&gt; m Type
</span><a href="#local-6989586621681166496"><span class="hs-identifier hs-var hs-var">swizzle_tv</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681166475"><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681166475"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; m Type
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyVar -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyVar -&gt; TyVar
</span><a href="#local-6989586621681166538"><span class="hs-identifier hs-var">swizzle_var</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681166475"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-817"></span><span>    </span><span id="local-6989586621681166494"><span class="annot"><span class="annottext">swizzle_cv :: p -&gt; TyVar -&gt; m Coercion
</span><a href="#local-6989586621681166494"><span class="hs-identifier hs-var hs-var">swizzle_cv</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681166471"><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681166471"><span class="hs-identifier hs-var">cv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; m Coercion
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyVar -&gt; Coercion
</span><a href="GHC.Core.Coercion.html#mkCoVarCo"><span class="hs-identifier hs-var">mkCoVarCo</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyVar -&gt; TyVar
</span><a href="#local-6989586621681166538"><span class="hs-identifier hs-var">swizzle_var</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681166471"><span class="hs-identifier hs-var">cv</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-818"></span><span>
</span><span id="line-819"></span><span>    </span><span id="local-6989586621681166490"><span class="annot"><span class="annottext">swizzle_bndr :: p -&gt; TyVar -&gt; p -&gt; m ((), TyVar)
</span><a href="#local-6989586621681166490"><span class="hs-identifier hs-var hs-var">swizzle_bndr</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681166467"><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681166467"><span class="hs-identifier hs-var">tcv</span></a></span></span><span> </span><span class="annot"><span class="annottext">p
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-820"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((), TyVar) -&gt; m ((), TyVar)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyVar -&gt; TyVar
</span><a href="#local-6989586621681166538"><span class="hs-identifier hs-var">swizzle_var</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681166467"><span class="hs-identifier hs-var">tcv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-821"></span><span>
</span><span id="line-822"></span><span>    </span><span class="annot"><a href="#local-6989586621681166538"><span class="hs-identifier hs-type">swizzle_var</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span>
</span><span id="line-823"></span><span>    </span><span id="local-6989586621681166538"><span class="annot"><span class="annottext">swizzle_var :: TyVar -&gt; TyVar
</span><a href="#local-6989586621681166538"><span class="hs-identifier hs-var hs-var">swizzle_var</span></a></span></span><span> </span><span id="local-6989586621681166465"><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681166465"><span class="hs-identifier hs-var">v</span></a></span></span><span>
</span><span id="line-824"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681166464"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681166464"><span class="hs-identifier hs-var">nm</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VarEnv Name -&gt; TyVar -&gt; Maybe Name
forall a. VarEnv a -&gt; TyVar -&gt; Maybe a
</span><a href="GHC.Types.Var.Env.html#lookupVarEnv"><span class="hs-identifier hs-var">lookupVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv Name
</span><a href="#local-6989586621681166501"><span class="hs-identifier hs-var">swizzle_env</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681166465"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-825"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type) -&gt; TyVar -&gt; TyVar
</span><a href="GHC.Types.Var.html#updateVarType"><span class="hs-identifier hs-var">updateVarType</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type
</span><a href="#local-6989586621681166536"><span class="hs-identifier hs-var">swizzle_ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681166465"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar -&gt; Name -&gt; TyVar
</span><a href="GHC.Types.Var.html#setVarName"><span class="hs-operator hs-var">`setVarName`</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681166464"><span class="hs-identifier hs-var">nm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-826"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-827"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type) -&gt; TyVar -&gt; TyVar
</span><a href="GHC.Types.Var.html#updateVarType"><span class="hs-identifier hs-var">updateVarType</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type
</span><a href="#local-6989586621681166536"><span class="hs-identifier hs-var">swizzle_ty</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681166465"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-828"></span><span>
</span><span id="line-829"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681166459"><span class="annot"><span class="annottext">Type -&gt; Identity Type
</span><a href="#local-6989586621681166459"><span class="hs-identifier hs-var">map_type</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; Identity [Type]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; Identity Coercion
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Coercion] -&gt; Identity [Coercion]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCoMapper () Identity
-&gt; (Type -&gt; Identity Type, [Type] -&gt; Identity [Type],
    Coercion -&gt; Identity Coercion, [Coercion] -&gt; Identity [Coercion])
forall (m :: * -&gt; *).
Monad m =&gt;
TyCoMapper () m
-&gt; (Type -&gt; m Type, [Type] -&gt; m [Type], Coercion -&gt; m Coercion,
    [Coercion] -&gt; m [Coercion])
</span><a href="GHC.Core.Type.html#mapTyCo"><span class="hs-identifier hs-var">mapTyCo</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoMapper () Identity
</span><a href="#local-6989586621681166499"><span class="hs-identifier hs-var">swizzleMapper</span></a></span><span>
</span><span id="line-830"></span><span>    </span><span id="local-6989586621681166536"><span class="annot"><span class="annottext">swizzle_ty :: Type -&gt; Type
</span><a href="#local-6989586621681166536"><span class="hs-identifier hs-var hs-var">swizzle_ty</span></a></span></span><span> </span><span id="local-6989586621681166457"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681166457"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Identity Type -&gt; Type
forall a. Identity a -&gt; a
</span><a href="../../base/src/Data.Functor.Identity.html#runIdentity"><span class="hs-identifier hs-var hs-var">runIdentity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Identity Type
</span><a href="#local-6989586621681166459"><span class="hs-identifier hs-var">map_type</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681166457"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-831"></span><span>
</span><span id="line-832"></span><span>
</span><span id="line-833"></span><span class="annot"><a href="GHC.Tc.TyCl.html#generaliseTcTyCon"><span class="hs-identifier hs-type">generaliseTcTyCon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyCon"><span class="hs-identifier hs-type">TcTyCon</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.TyCl.html#ScopedPairs"><span class="hs-identifier hs-type">ScopedPairs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyCon"><span class="hs-identifier hs-type">TcTyCon</span></a></span><span>
</span><span id="line-834"></span><span id="generaliseTcTyCon"><span class="annot"><span class="annottext">generaliseTcTyCon :: (TyCon, [(Name, TyVar)], Type) -&gt; TcRn TyCon
</span><a href="GHC.Tc.TyCl.html#generaliseTcTyCon"><span class="hs-identifier hs-var hs-var">generaliseTcTyCon</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681166455"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166455"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681166454"><span class="annot"><span class="annottext">[(Name, TyVar)]
</span><a href="#local-6989586621681166454"><span class="hs-identifier hs-var">scoped_prs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681166453"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681166453"><span class="hs-identifier hs-var">tc_res_kind</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-835"></span><span>  </span><span class="hs-comment">-- See Note [Required, Specified, and Inferred for types]</span><span>
</span><span id="line-836"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcRn TyCon -&gt; TcRn TyCon
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; SrcSpan
forall a. NamedThing a =&gt; a -&gt; SrcSpan
</span><a href="GHC.Types.Name.html#getSrcSpan"><span class="hs-identifier hs-var">getSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166455"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcRn TyCon -&gt; TcRn TyCon) -&gt; TcRn TyCon -&gt; TcRn TyCon
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-837"></span><span>    </span><span class="annot"><span class="annottext">TyCon -&gt; TcRn TyCon -&gt; TcRn TyCon
forall a. TyCon -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.TyCl.html#addTyConCtxt"><span class="hs-identifier hs-var">addTyConCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166455"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn TyCon -&gt; TcRn TyCon) -&gt; TcRn TyCon -&gt; TcRn TyCon
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-838"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- Step 1: Separate Specified from Required variables</span><span>
</span><span id="line-839"></span><span>         </span><span class="hs-comment">-- NB: spec_req_tvs = spec_tvs ++ req_tvs</span><span>
</span><span id="line-840"></span><span>         </span><span class="hs-comment">--     And req_tvs is 1-1 with tyConTyVars</span><span>
</span><span id="line-841"></span><span>         </span><span class="hs-comment">--     See Note [Scoped tyvars in a TcTyCon] in GHC.Core.TyCon</span><span>
</span><span id="line-842"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681166451"><span class="annot"><span class="annottext">spec_req_tvs :: [TyVar]
</span><a href="#local-6989586621681166451"><span class="hs-identifier hs-var hs-var">spec_req_tvs</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Name, TyVar) -&gt; TyVar) -&gt; [(Name, TyVar)] -&gt; [TyVar]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">(Name, TyVar) -&gt; TyVar
forall a b. (a, b) -&gt; b
</span><a href="../../base/src/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, TyVar)]
</span><a href="#local-6989586621681166454"><span class="hs-identifier hs-var">scoped_prs</span></a></span><span>
</span><span id="line-843"></span><span>             </span><span id="local-6989586621681166450"><span class="annot"><span class="annottext">n_spec :: Arity
</span><a href="#local-6989586621681166450"><span class="hs-identifier hs-var hs-var">n_spec</span></a></span></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; Arity
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Arity
</span><a href="../../base/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681166451"><span class="hs-identifier hs-var">spec_req_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">Arity -&gt; Arity -&gt; Arity
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base/src/GHC.Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Arity
</span><a href="GHC.Core.TyCon.html#tyConArity"><span class="hs-identifier hs-var hs-var">tyConArity</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166455"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-844"></span><span>             </span><span class="hs-special">(</span><span id="local-6989586621681166447"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681166447"><span class="hs-identifier hs-var">spec_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681166446"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681166446"><span class="hs-identifier hs-var">req_tvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Arity -&gt; [TyVar] -&gt; ([TyVar], [TyVar])
forall a. Arity -&gt; [a] -&gt; ([a], [a])
</span><a href="../../base/src/GHC.List.html#splitAt"><span class="hs-identifier hs-var">splitAt</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621681166450"><span class="hs-identifier hs-var">n_spec</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681166451"><span class="hs-identifier hs-var">spec_req_tvs</span></a></span><span>
</span><span id="line-845"></span><span>             </span><span id="local-6989586621681166444"><span class="annot"><span class="annottext">sorted_spec_tvs :: [TyVar]
</span><a href="#local-6989586621681166444"><span class="hs-identifier hs-var hs-var">sorted_spec_tvs</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; [TyVar]
</span><a href="GHC.Core.TyCo.FVs.html#scopedSort"><span class="hs-identifier hs-var">scopedSort</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681166447"><span class="hs-identifier hs-var">spec_tvs</span></a></span><span>
</span><span id="line-846"></span><span>                 </span><span class="hs-comment">-- NB: We can't do the sort until we've zonked</span><span>
</span><span id="line-847"></span><span>                 </span><span class="hs-comment">--     Maintain the L-R order of scoped_tvs</span><span>
</span><span id="line-848"></span><span>
</span><span id="line-849"></span><span>       </span><span class="hs-comment">-- Step 2a: find all the Inferred variables we want to quantify over</span><span>
</span><span id="line-850"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681166442"><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621681166442"><span class="hs-identifier hs-var">dvs1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; TcM CandidatesQTvs
</span><a href="GHC.Tc.Utils.TcMType.html#candidateQTyVarsOfKinds"><span class="hs-identifier hs-var">candidateQTyVarsOfKinds</span></a></span><span> </span><span class="annot"><span class="annottext">([Type] -&gt; TcM CandidatesQTvs) -&gt; [Type] -&gt; TcM CandidatesQTvs
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-851"></span><span>                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681166453"><span class="hs-identifier hs-var">tc_res_kind</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; [Type] -&gt; [Type]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">(TyVar -&gt; Type) -&gt; [TyVar] -&gt; [Type]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar -&gt; Type
</span><a href="GHC.Types.Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681166451"><span class="hs-identifier hs-var">spec_req_tvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-852"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681166439"><span class="annot"><span class="annottext">dvs2 :: CandidatesQTvs
</span><a href="#local-6989586621681166439"><span class="hs-identifier hs-var hs-var">dvs2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621681166442"><span class="hs-identifier hs-var">dvs1</span></a></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs -&gt; [TyVar] -&gt; CandidatesQTvs
</span><a href="GHC.Tc.Utils.TcMType.html#delCandidates"><span class="hs-operator hs-var">`delCandidates`</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681166451"><span class="hs-identifier hs-var">spec_req_tvs</span></a></span><span>
</span><span id="line-853"></span><span>
</span><span id="line-854"></span><span>       </span><span class="hs-comment">-- Step 2b: quantify, mainly meaning skolemise the free variables</span><span>
</span><span id="line-855"></span><span>       </span><span class="hs-comment">-- Returned 'inferred' are scope-sorted and skolemised</span><span>
</span><span id="line-856"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681166437"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681166437"><span class="hs-identifier hs-var">inferred</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs -&gt; TcM [TyVar]
</span><a href="GHC.Tc.Utils.TcMType.html#quantifyTyVars"><span class="hs-identifier hs-var">quantifyTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621681166439"><span class="hs-identifier hs-var">dvs2</span></a></span><span>
</span><span id="line-857"></span><span>
</span><span id="line-858"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;generaliseTcTyCon: pre zonk&quot;</span></span><span>
</span><span id="line-859"></span><span>           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tycon =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166455"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-860"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;spec_req_tvs =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; SDoc
</span><a href="GHC.Core.TyCo.Ppr.html#pprTyVars"><span class="hs-identifier hs-var">pprTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681166451"><span class="hs-identifier hs-var">spec_req_tvs</span></a></span><span>
</span><span id="line-861"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc_res_kind =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681166453"><span class="hs-identifier hs-var">tc_res_kind</span></a></span><span>
</span><span id="line-862"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;dvs1 =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621681166442"><span class="hs-identifier hs-var">dvs1</span></a></span><span>
</span><span id="line-863"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;inferred =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; SDoc
</span><a href="GHC.Core.TyCo.Ppr.html#pprTyVars"><span class="hs-identifier hs-var">pprTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681166437"><span class="hs-identifier hs-var">inferred</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-864"></span><span>
</span><span id="line-865"></span><span>       </span><span class="hs-comment">-- Step 3: Final zonk (following kind generalisation)</span><span>
</span><span id="line-866"></span><span>       </span><span class="hs-comment">-- See Note [Swizzling the tyvars before generaliseTcTyCon]</span><span>
</span><span id="line-867"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681166435"><span class="annot"><span class="annottext">ZonkEnv
</span><a href="#local-6989586621681166435"><span class="hs-identifier hs-var">ze</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM ZonkEnv
</span><a href="GHC.Tc.Utils.Zonk.html#emptyZonkEnv"><span class="hs-identifier hs-var">emptyZonkEnv</span></a></span><span>
</span><span id="line-868"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681166433"><span class="annot"><span class="annottext">ZonkEnv
</span><a href="#local-6989586621681166433"><span class="hs-identifier hs-var">ze</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681166432"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681166432"><span class="hs-identifier hs-var">inferred</span></a></span></span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ZonkEnv -&gt; [TyVar] -&gt; TcM (ZonkEnv, [TyVar])
</span><a href="GHC.Tc.Utils.Zonk.html#zonkTyBndrsX"><span class="hs-identifier hs-var">zonkTyBndrsX</span></a></span><span> </span><span class="annot"><span class="annottext">ZonkEnv
</span><a href="#local-6989586621681166435"><span class="hs-identifier hs-var">ze</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681166437"><span class="hs-identifier hs-var">inferred</span></a></span><span>
</span><span id="line-869"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681166430"><span class="annot"><span class="annottext">ZonkEnv
</span><a href="#local-6989586621681166430"><span class="hs-identifier hs-var">ze</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681166429"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681166429"><span class="hs-identifier hs-var">sorted_spec_tvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ZonkEnv -&gt; [TyVar] -&gt; TcM (ZonkEnv, [TyVar])
</span><a href="GHC.Tc.Utils.Zonk.html#zonkTyBndrsX"><span class="hs-identifier hs-var">zonkTyBndrsX</span></a></span><span> </span><span class="annot"><span class="annottext">ZonkEnv
</span><a href="#local-6989586621681166433"><span class="hs-identifier hs-var">ze</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681166444"><span class="hs-identifier hs-var">sorted_spec_tvs</span></a></span><span>
</span><span id="line-870"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681166428"><span class="annot"><span class="annottext">ZonkEnv
</span><a href="#local-6989586621681166428"><span class="hs-identifier hs-var">ze</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681166427"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681166427"><span class="hs-identifier hs-var">req_tvs</span></a></span></span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ZonkEnv -&gt; [TyVar] -&gt; TcM (ZonkEnv, [TyVar])
</span><a href="GHC.Tc.Utils.Zonk.html#zonkTyBndrsX"><span class="hs-identifier hs-var">zonkTyBndrsX</span></a></span><span> </span><span class="annot"><span class="annottext">ZonkEnv
</span><a href="#local-6989586621681166430"><span class="hs-identifier hs-var">ze</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681166446"><span class="hs-identifier hs-var">req_tvs</span></a></span><span>
</span><span id="line-871"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681166426"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681166426"><span class="hs-identifier hs-var">tc_res_kind</span></a></span></span><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ZonkEnv -&gt; Type -&gt; TcM Type
</span><a href="GHC.Tc.Utils.Zonk.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-var">zonkTcTypeToTypeX</span></a></span><span> </span><span class="annot"><span class="annottext">ZonkEnv
</span><a href="#local-6989586621681166428"><span class="hs-identifier hs-var">ze</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681166453"><span class="hs-identifier hs-var">tc_res_kind</span></a></span><span>
</span><span id="line-872"></span><span>
</span><span id="line-873"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;generaliseTcTyCon: post zonk&quot;</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; TcRn ()) -&gt; SDoc -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-874"></span><span>         </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tycon =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166455"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-875"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;inferred =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; SDoc
</span><a href="GHC.Core.TyCo.Ppr.html#pprTyVars"><span class="hs-identifier hs-var">pprTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681166432"><span class="hs-identifier hs-var">inferred</span></a></span><span>
</span><span id="line-876"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;spec_req_tvs =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; SDoc
</span><a href="GHC.Core.TyCo.Ppr.html#pprTyVars"><span class="hs-identifier hs-var">pprTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681166451"><span class="hs-identifier hs-var">spec_req_tvs</span></a></span><span>
</span><span id="line-877"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;sorted_spec_tvs =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; SDoc
</span><a href="GHC.Core.TyCo.Ppr.html#pprTyVars"><span class="hs-identifier hs-var">pprTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681166429"><span class="hs-identifier hs-var">sorted_spec_tvs</span></a></span><span>
</span><span id="line-878"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;req_tvs =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681166427"><span class="hs-identifier hs-var">req_tvs</span></a></span><span>
</span><span id="line-879"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;zonk-env =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ZonkEnv -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ZonkEnv
</span><a href="#local-6989586621681166428"><span class="hs-identifier hs-var">ze</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-880"></span><span>
</span><span id="line-881"></span><span>       </span><span class="hs-comment">-- Step 4: Make the TyConBinders.</span><span>
</span><span id="line-882"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681166424"><span class="annot"><span class="annottext">dep_fv_set :: VarSet
</span><a href="#local-6989586621681166424"><span class="hs-identifier hs-var hs-var">dep_fv_set</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs -&gt; VarSet
</span><a href="GHC.Tc.Utils.TcMType.html#candidateKindVars"><span class="hs-identifier hs-var">candidateKindVars</span></a></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621681166442"><span class="hs-identifier hs-var">dvs1</span></a></span><span>
</span><span id="line-883"></span><span>             </span><span id="local-6989586621681166422"><span class="annot"><span class="annottext">inferred_tcbs :: [TyConBinder]
</span><a href="#local-6989586621681166422"><span class="hs-identifier hs-var hs-var">inferred_tcbs</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArgFlag -&gt; [TyVar] -&gt; [TyConBinder]
</span><a href="GHC.Core.TyCon.html#mkNamedTyConBinders"><span class="hs-identifier hs-var">mkNamedTyConBinders</span></a></span><span> </span><span class="annot"><span class="annottext">ArgFlag
</span><a href="GHC.Types.Var.html#Inferred"><span class="hs-identifier hs-var">Inferred</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681166432"><span class="hs-identifier hs-var">inferred</span></a></span><span>
</span><span id="line-884"></span><span>             </span><span id="local-6989586621681166419"><span class="annot"><span class="annottext">specified_tcbs :: [TyConBinder]
</span><a href="#local-6989586621681166419"><span class="hs-identifier hs-var hs-var">specified_tcbs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArgFlag -&gt; [TyVar] -&gt; [TyConBinder]
</span><a href="GHC.Core.TyCon.html#mkNamedTyConBinders"><span class="hs-identifier hs-var">mkNamedTyConBinders</span></a></span><span> </span><span class="annot"><span class="annottext">ArgFlag
</span><a href="GHC.Types.Var.html#Specified"><span class="hs-identifier hs-var">Specified</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681166429"><span class="hs-identifier hs-var">sorted_spec_tvs</span></a></span><span>
</span><span id="line-885"></span><span>             </span><span id="local-6989586621681166417"><span class="annot"><span class="annottext">required_tcbs :: [TyConBinder]
</span><a href="#local-6989586621681166417"><span class="hs-identifier hs-var hs-var">required_tcbs</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TyVar -&gt; TyConBinder) -&gt; [TyVar] -&gt; [TyConBinder]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarSet -&gt; TyVar -&gt; TyConBinder
</span><a href="GHC.Core.TyCon.html#mkRequiredTyConBinder"><span class="hs-identifier hs-var">mkRequiredTyConBinder</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621681166424"><span class="hs-identifier hs-var">dep_fv_set</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681166427"><span class="hs-identifier hs-var">req_tvs</span></a></span><span>
</span><span id="line-886"></span><span>
</span><span id="line-887"></span><span>       </span><span class="hs-comment">-- Step 5: Assemble the final list.</span><span>
</span><span id="line-888"></span><span>             </span><span id="local-6989586621681166415"><span class="annot"><span class="annottext">final_tcbs :: [TyConBinder]
</span><a href="#local-6989586621681166415"><span class="hs-identifier hs-var hs-var">final_tcbs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[TyConBinder]] -&gt; [TyConBinder]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><a href="../../base/src/Data.Foldable.html#concat"><span class="hs-identifier hs-var">concat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621681166422"><span class="hs-identifier hs-var">inferred_tcbs</span></a></span><span>
</span><span id="line-889"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621681166419"><span class="hs-identifier hs-var">specified_tcbs</span></a></span><span>
</span><span id="line-890"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621681166417"><span class="hs-identifier hs-var">required_tcbs</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-891"></span><span>
</span><span id="line-892"></span><span>       </span><span class="hs-comment">-- Step 6: Make the result TcTyCon</span><span>
</span><span id="line-893"></span><span>             </span><span id="local-6989586621681166414"><span class="annot"><span class="annottext">tycon :: TyCon
</span><a href="#local-6989586621681166414"><span class="hs-identifier hs-var hs-var">tycon</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
-&gt; [TyConBinder]
-&gt; Type
-&gt; [(Name, TyVar)]
-&gt; Bool
-&gt; TyConFlavour
-&gt; TyCon
</span><a href="GHC.Core.TyCon.html#mkTcTyCon"><span class="hs-identifier hs-var">mkTcTyCon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Name
</span><a href="GHC.Core.TyCon.html#tyConName"><span class="hs-identifier hs-var hs-var">tyConName</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166455"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621681166415"><span class="hs-identifier hs-var">final_tcbs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681166426"><span class="hs-identifier hs-var">tc_res_kind</span></a></span><span>
</span><span id="line-894"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyVar] -&gt; [(Name, TyVar)]
</span><a href="GHC.Tc.Utils.TcType.html#mkTyVarNamePairs"><span class="hs-identifier hs-var">mkTyVarNamePairs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681166429"><span class="hs-identifier hs-var">sorted_spec_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; [TyVar] -&gt; [TyVar]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681166427"><span class="hs-identifier hs-var">req_tvs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-895"></span><span>                            </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-comment">{- it's generalised now -}</span><span>
</span><span id="line-896"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; TyConFlavour
</span><a href="GHC.Core.TyCon.html#tyConFlavour"><span class="hs-identifier hs-var">tyConFlavour</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166455"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-897"></span><span>
</span><span id="line-898"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;generaliseTcTyCon done&quot;</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; TcRn ()) -&gt; SDoc -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-899"></span><span>         </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tycon =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166455"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-900"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc_res_kind =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681166426"><span class="hs-identifier hs-var">tc_res_kind</span></a></span><span>
</span><span id="line-901"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;dep_fv_set =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621681166424"><span class="hs-identifier hs-var">dep_fv_set</span></a></span><span>
</span><span id="line-902"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;inferred_tcbs =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TyConBinder] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621681166422"><span class="hs-identifier hs-var">inferred_tcbs</span></a></span><span>
</span><span id="line-903"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;specified_tcbs =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TyConBinder] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621681166419"><span class="hs-identifier hs-var">specified_tcbs</span></a></span><span>
</span><span id="line-904"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;required_tcbs =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TyConBinder] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621681166417"><span class="hs-identifier hs-var">required_tcbs</span></a></span><span>
</span><span id="line-905"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;final_tcbs =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TyConBinder] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621681166415"><span class="hs-identifier hs-var">final_tcbs</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-906"></span><span>
</span><span id="line-907"></span><span>       </span><span class="hs-comment">-- Step 7: Check for validity.</span><span>
</span><span id="line-908"></span><span>       </span><span class="hs-comment">-- We do this here because we're about to put the tycon into the</span><span>
</span><span id="line-909"></span><span>       </span><span class="hs-comment">-- the environment, and we don't want anything malformed there</span><span>
</span><span id="line-910"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TcRn ()
</span><a href="GHC.Tc.Validity.html#checkTyConTelescope"><span class="hs-identifier hs-var">checkTyConTelescope</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166414"><span class="hs-identifier hs-var">tycon</span></a></span><span>
</span><span id="line-911"></span><span>
</span><span id="line-912"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TcRn TyCon
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166414"><span class="hs-identifier hs-var">tycon</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-913"></span><span>
</span><span id="line-914"></span><span class="hs-comment">{- Note [Required, Specified, and Inferred for types]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Each forall'd type variable in a type or kind is one of

  * Required: an argument must be provided at every call site

  * Specified: the argument can be inferred at call sites, but
    may be instantiated with visible type/kind application

  * Inferred: the must be inferred at call sites; it
    is unavailable for use with visible type/kind application.

Why have Inferred at all? Because we just can't make user-facing
promises about the ordering of some variables. These might swizzle
around even between minor released. By forbidding visible type
application, we ensure users aren't caught unawares.

Go read Note [VarBndrs, TyCoVarBinders, TyConBinders, and visibility] in GHC.Core.TyCo.Rep.

The question for this Note is this:
   given a TyClDecl, how are its quantified type variables classified?
Much of the debate is memorialized in #15743.

Here is our design choice. When inferring the ordering of variables
for a TyCl declaration (that is, for those variables that he user
has not specified the order with an explicit `forall`), we use the
following order:

 1. Inferred variables
 2. Specified variables; in the left-to-right order in which
    the user wrote them, modified by scopedSort (see below)
    to put them in depdendency order.
 3. Required variables before a top-level ::
 4. All variables after a top-level ::

If this ordering does not make a valid telescope, we reject the definition.

Example:
  data SameKind :: k -&gt; k -&gt; *
  data Bad a (c :: Proxy b) (d :: Proxy a) (x :: SameKind b d)

For Bad:
  - a, c, d, x are Required; they are explicitly listed by the user
    as the positional arguments of Bad
  - b is Specified; it appears explicitly in a kind signature
  - k, the kind of a, is Inferred; it is not mentioned explicitly at all

Putting variables in the order Inferred, Specified, Required
gives us this telescope:
  Inferred:  k
  Specified: b : Proxy a
  Required : (a : k) (c : Proxy b) (d : Proxy a) (x : SameKind b d)

But this order is ill-scoped, because b's kind mentions a, which occurs
after b in the telescope. So we reject Bad.

Associated types
~~~~~~~~~~~~~~~~
For associated types everything above is determined by the
associated-type declaration alone, ignoring the class header.
Here is an example (#15592)
  class C (a :: k) b where
    type F (x :: b a)

In the kind of C, 'k' is Specified.  But what about F?
In the kind of F,

 * Should k be Inferred or Specified?  It's Specified for C,
   but not mentioned in F's declaration.

 * In which order should the Specified variables a and b occur?
   It's clearly 'a' then 'b' in C's declaration, but the L-R ordering
   in F's declaration is 'b' then 'a'.

In both cases we make the choice by looking at F's declaration alone,
so it gets the kind
   F :: forall {k}. forall b a. b a -&gt; Type

How it works
~~~~~~~~~~~~
These design choices are implemented by two completely different code
paths for

  * Declarations with a standalone kind signature or a complete user-specified
    kind signature (CUSK). Handled by the kcCheckDeclHeader.

  * Declarations without a kind signature (standalone or CUSK) are handled by
    kcInferDeclHeader; see Note [Inferring kinds for type declarations].

Note that neither code path worries about point (4) above, as this
is nicely handled by not mangling the res_kind. (Mangling res_kinds is done
*after* all this stuff, in tcDataDefn's call to etaExpandAlgTyCon.)

We can tell Inferred apart from Specified by looking at the scoped
tyvars; Specified are always included there.

Design alternatives
~~~~~~~~~~~~~~~~~~~
* For associated types we considered putting the class variables
  before the local variables, in a nod to the treatment for class
  methods. But it got too compilicated; see #15592, comment:21ff.

* We rigidly require the ordering above, even though we could be much more
  permissive. Relevant musings are at
  https://gitlab.haskell.org/ghc/ghc/issues/15743#note_161623
  The bottom line conclusion is that, if the user wants a different ordering,
  then can specify it themselves, and it is better to be predictable and dumb
  than clever and capricious.

  I (Richard) conjecture we could be fully permissive, allowing all classes
  of variables to intermix. We would have to augment ScopedSort to refuse to
  reorder Required variables (or check that it wouldn't have). But this would
  allow more programs. See #15743 for examples. Interestingly, Idris seems
  to allow this intermixing. The intermixing would be fully specified, in that
  we can be sure that inference wouldn't change between versions. However,
  would users be able to predict it? That I cannot answer.

Test cases (and tickets) relevant to these design decisions
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
  T15591*
  T15592*
  T15743*

Note [Inferring kinds for type declarations]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
This note deals with /inference/ for type declarations
that do not have a CUSK.  Consider
  data T (a :: k1) k2 (x :: k2) = MkT (S a k2 x)
  data S (b :: k3) k4 (y :: k4) = MkS (T b k4 y)

We do kind inference as follows:

* Step 1: inferInitialKinds, and in particular kcInferDeclHeader.
  Make a unification variable for each of the Required and Specified
  type variables in the header.

  Record the connection between the Names the user wrote and the
  fresh unification variables in the tcTyConScopedTyVars field
  of the TcTyCon we are making
      [ (a,  aa)
      , (k1, kk1)
      , (k2, kk2)
      , (x,  xx) ]
  (I'm using the convention that double letter like 'aa' or 'kk'
  mean a unification variable.)

  These unification variables
    - Are TyVarTvs: that is, unification variables that can
      unify only with other type variables.
      See Note [Signature skolems] in GHC.Tc.Utils.TcType

    - Have complete fresh Names; see GHC.Tc.Utils.TcMType
      Note [Unification variables need fresh Names]

  Assign initial monomorphic kinds to S, T
          T :: kk1 -&gt; * -&gt; kk2 -&gt; *
          S :: kk3 -&gt; * -&gt; kk4 -&gt; *

* Step 2: kcTyClDecl. Extend the environment with a TcTyCon for S and
  T, with these monomorphic kinds.  Now kind-check the declarations,
  and solve the resulting equalities.  The goal here is to discover
  constraints on all these unification variables.

  Here we find that kk1 := kk3, and kk2 := kk4.

  This is why we can't use skolems for kk1 etc; they have to
  unify with each other.

* Step 3: generaliseTcTyCon. Generalise each TyCon in turn.
  We find the free variables of the kind, skolemise them,
  sort them out into Inferred/Required/Specified (see the above
  Note [Required, Specified, and Inferred for types]),
  and perform some validity checks.

  This makes the utterly-final TyConBinders for the TyCon.

  All this is very similar at the level of terms: see GHC.Tc.Gen.Bind
  Note [Quantified variables in partial type signatures]

  But there some tricky corners: Note [Tricky scoping in generaliseTcTyCon]

* Step 4.  Extend the type environment with a TcTyCon for S and T, now
  with their utterly-final polymorphic kinds (needed for recursive
  occurrences of S, T).  Now typecheck the declarations, and build the
  final AlgTyCon for S and T resp.

The first three steps are in kcTyClGroup; the fourth is in
tcTyClDecls.

There are some wrinkles

* Do not default TyVarTvs.  We always want to kind-generalise over
  TyVarTvs, and /not/ default them to Type. By definition a TyVarTv is
  not allowed to unify with a type; it must stand for a type
  variable. Hence the check in GHC.Tc.Solver.defaultTyVarTcS, and
  GHC.Tc.Utils.TcMType.defaultTyVar.  Here's another example (#14555):
     data Exp :: [TYPE rep] -&gt; TYPE rep -&gt; Type where
        Lam :: Exp (a:xs) b -&gt; Exp xs (a -&gt; b)
  We want to kind-generalise over the 'rep' variable.
  #14563 is another example.

* Duplicate type variables. Consider #11203
    data SameKind :: k -&gt; k -&gt; *
    data Q (a :: k1) (b :: k2) c = MkQ (SameKind a b)
  Here we will unify k1 with k2, but this time doing so is an error,
  because k1 and k2 are bound in the same declaration.

  We spot this during validity checking (findDupTyVarTvs),
  in generaliseTcTyCon.

* Required arguments.  Even the Required arguments should be made
  into TyVarTvs, not skolems.  Consider
    data T k (a :: k)
  Here, k is a Required, dependent variable. For uniformity, it is helpful
  to have k be a TyVarTv, in parallel with other dependent variables.

* Duplicate skolemisation is expected.  When generalising in Step 3,
  we may find that one of the variables we want to quantify has
  already been skolemised.  For example, suppose we have already
  generalise S. When we come to T we'll find that kk1 (now the same as
  kk3) has already been skolemised.

  That's fine -- but it means that
    a) when collecting quantification candidates, in
       candidateQTyVarsOfKind, we must collect skolems
    b) quantifyTyVars should be a no-op on such a skolem

Note [Tricky scoping in generaliseTcTyCon]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider #16342
  class C (a::ka) x where
    cop :: D a x =&gt; x -&gt; Proxy a -&gt; Proxy a
    cop _ x = x :: Proxy (a::ka)

  class D (b::kb) y where
    dop :: C b y =&gt; y -&gt; Proxy b -&gt; Proxy b
    dop _ x = x :: Proxy (b::kb)

C and D are mutually recursive, by the time we get to
generaliseTcTyCon we'll have unified kka := kkb.

But when typechecking the default declarations for 'cop' and 'dop' in
tcDlassDecl2 we need {a, ka} and {b, kb} respectively to be in scope.
But at that point all we have is the utterly-final Class itself.

Conclusion: the classTyVars of a class must have the same Name as
that originally assigned by the user.  In our example, C must have
classTyVars {a, ka, x} while D has classTyVars {a, kb, y}.  Despite
the fact that kka and kkb got unified!

We achieve this sleight of hand in generaliseTcTyCon, using
the specialised function zonkRecTyVarBndrs.  We make the call
   zonkRecTyVarBndrs [ka,a,x] [kkb,aa,xxx]
where the [ka,a,x] are the Names originally assigned by the user, and
[kkb,aa,xx] are the corresponding (post-zonking, skolemised) TcTyVars.
zonkRecTyVarBndrs builds a recursive ZonkEnv that binds
   kkb :-&gt; (ka :: &lt;zonked kind of kkb&gt;)
   aa  :-&gt; (a  :: &lt;konked kind of aa&gt;)
   etc
That is, it maps each skolemised TcTyVars to the utterly-final
TyVar to put in the class, with its correct user-specified name.
When generalising D we'll do the same thing, but the ZonkEnv will map
   kkb :-&gt; (kb :: &lt;zonked kind of kkb&gt;)
   bb  :-&gt; (b  :: &lt;konked kind of bb&gt;)
   etc
Note that 'kkb' again appears in the domain of the mapping, but this
time mapped to 'kb'.  That's how C and D end up with differently-named
final TyVars despite the fact that we unified kka:=kkb

zonkRecTyVarBndrs we need to do knot-tying because of the need to
apply this same substitution to the kind of each.

Note [Inferring visible dependent quantification]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider

  data T k :: k -&gt; Type where
    MkT1 :: T Type Int
    MkT2 :: T (Type -&gt; Type) Maybe

This looks like it should work. However, it is polymorphically recursive,
as the uses of T in the constructor types specialize the k in the kind
of T. This trips up our dear users (#17131, #17541), and so we add
a &quot;landmark&quot; context (which cannot be suppressed) whenever we
spot inferred visible dependent quantification (VDQ).

It's hard to know when we've actually been tripped up by polymorphic recursion
specifically, so we just include a note to users whenever we infer VDQ. The
testsuite did not show up a single spurious inclusion of this message.

The context is added in addVDQNote, which looks for a visible TyConBinder
that also appears in the TyCon's kind. (I first looked at the kind for
a visible, dependent quantifier, but Note [No polymorphic recursion] in
GHC.Tc.Gen.HsType defeats that approach.) addVDQNote is used in kcTyClDecl,
which is used only when inferring the kind of a tycon (never with a CUSK or
SAK).

Once upon a time, I (Richard E) thought that the tycon-kind could
not be a forall-type. But this is wrong: data T :: forall k. k -&gt; Type
(with -XNoCUSKs) could end up here. And this is all OK.


-}</span><span>
</span><span id="line-1217"></span><span>
</span><span id="line-1218"></span><span class="hs-comment">--------------</span><span>
</span><span id="line-1219"></span><span id="local-6989586621681168029"><span class="annot"><a href="GHC.Tc.TyCl.html#tcExtendKindEnvWithTyCons"><span class="hs-identifier hs-type">tcExtendKindEnvWithTyCons</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyCon"><span class="hs-identifier hs-type">TcTyCon</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681168029"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681168029"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1220"></span><span id="tcExtendKindEnvWithTyCons"><span class="annot"><span class="annottext">tcExtendKindEnvWithTyCons :: forall a. [TyCon] -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.TyCl.html#tcExtendKindEnvWithTyCons"><span class="hs-identifier hs-var hs-var">tcExtendKindEnvWithTyCons</span></a></span></span><span> </span><span id="local-6989586621681166409"><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681166409"><span class="hs-identifier hs-var">tcs</span></a></span></span><span>
</span><span id="line-1221"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Name, TcTyThing)] -&gt; TcM a -&gt; TcM a
forall r. [(Name, TcTyThing)] -&gt; TcM r -&gt; TcM r
</span><a href="GHC.Tc.Utils.Env.html#tcExtendKindEnvList"><span class="hs-identifier hs-var">tcExtendKindEnvList</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Name
</span><a href="GHC.Core.TyCon.html#tyConName"><span class="hs-identifier hs-var hs-var">tyConName</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166407"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TcTyThing
</span><a href="GHC.Tc.Types.html#ATcTyCon"><span class="hs-identifier hs-var">ATcTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166407"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681166407"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166407"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681166409"><span class="hs-identifier hs-var">tcs</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1222"></span><span>
</span><span id="line-1223"></span><span class="hs-comment">--------------</span><span>
</span><span id="line-1224"></span><span class="annot"><a href="GHC.Tc.TyCl.html#mkPromotionErrorEnv"><span class="hs-identifier hs-type">mkPromotionErrorEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Hs.Decls.html#LTyClDecl"><span class="hs-identifier hs-type">LTyClDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcTypeEnv"><span class="hs-identifier hs-type">TcTypeEnv</span></a></span><span>
</span><span id="line-1225"></span><span class="hs-comment">-- Maps each tycon/datacon to a suitable promotion error</span><span>
</span><span id="line-1226"></span><span class="hs-comment">--    tc :-&gt; APromotionErr TyConPE</span><span>
</span><span id="line-1227"></span><span class="hs-comment">--    dc :-&gt; APromotionErr RecDataConPE</span><span>
</span><span id="line-1228"></span><span class="hs-comment">--    See Note [Recursion and promoting data constructors]</span><span>
</span><span id="line-1229"></span><span>
</span><span id="line-1230"></span><span id="mkPromotionErrorEnv"><span class="annot"><span class="annottext">mkPromotionErrorEnv :: [LTyClDecl GhcRn] -&gt; TcTypeEnv
</span><a href="GHC.Tc.TyCl.html#mkPromotionErrorEnv"><span class="hs-identifier hs-var hs-var">mkPromotionErrorEnv</span></a></span></span><span> </span><span id="local-6989586621681166405"><span class="annot"><span class="annottext">[LTyClDecl GhcRn]
</span><a href="#local-6989586621681166405"><span class="hs-identifier hs-var">decls</span></a></span></span><span>
</span><span id="line-1231"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LTyClDecl GhcRn -&gt; TcTypeEnv -&gt; TcTypeEnv)
-&gt; TcTypeEnv -&gt; [LTyClDecl GhcRn] -&gt; TcTypeEnv
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTypeEnv -&gt; TcTypeEnv -&gt; TcTypeEnv
forall a. NameEnv a -&gt; NameEnv a -&gt; NameEnv a
</span><a href="GHC.Types.Name.Env.html#plusNameEnv"><span class="hs-identifier hs-var">plusNameEnv</span></a></span><span> </span><span class="annot"><span class="annottext">(TcTypeEnv -&gt; TcTypeEnv -&gt; TcTypeEnv)
-&gt; (LTyClDecl GhcRn -&gt; TcTypeEnv)
-&gt; LTyClDecl GhcRn
-&gt; TcTypeEnv
-&gt; TcTypeEnv
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">TyClDecl GhcRn -&gt; TcTypeEnv
</span><a href="GHC.Tc.TyCl.html#mk_prom_err_env"><span class="hs-identifier hs-var">mk_prom_err_env</span></a></span><span> </span><span class="annot"><span class="annottext">(TyClDecl GhcRn -&gt; TcTypeEnv)
-&gt; (LTyClDecl GhcRn -&gt; TyClDecl GhcRn)
-&gt; LTyClDecl GhcRn
-&gt; TcTypeEnv
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">LTyClDecl GhcRn -&gt; TyClDecl GhcRn
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1232"></span><span>          </span><span class="annot"><span class="annottext">TcTypeEnv
forall a. NameEnv a
</span><a href="GHC.Types.Name.Env.html#emptyNameEnv"><span class="hs-identifier hs-var">emptyNameEnv</span></a></span><span> </span><span class="annot"><span class="annottext">[LTyClDecl GhcRn]
</span><a href="#local-6989586621681166405"><span class="hs-identifier hs-var">decls</span></a></span><span>
</span><span id="line-1233"></span><span>
</span><span id="line-1234"></span><span class="annot"><a href="GHC.Tc.TyCl.html#mk_prom_err_env"><span class="hs-identifier hs-type">mk_prom_err_env</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Decls.html#TyClDecl"><span class="hs-identifier hs-type">TyClDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcTypeEnv"><span class="hs-identifier hs-type">TcTypeEnv</span></a></span><span>
</span><span id="line-1235"></span><span id="mk_prom_err_env"><span class="annot"><span class="annottext">mk_prom_err_env :: TyClDecl GhcRn -&gt; TcTypeEnv
</span><a href="GHC.Tc.TyCl.html#mk_prom_err_env"><span class="hs-identifier hs-var hs-var">mk_prom_err_env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Decls.html#ClassDecl"><span class="hs-identifier hs-type">ClassDecl</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcdLName :: forall pass. TyClDecl pass -&gt; Located (IdP pass)
</span><a href="GHC.Hs.Decls.html#tcdLName"><span class="hs-identifier hs-var">tcdLName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681166401"><span class="annot"><span class="annottext">IdP GhcRn
</span><a href="#local-6989586621681166401"><span class="hs-identifier hs-var">nm</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcdATs :: forall pass. TyClDecl pass -&gt; [LFamilyDecl pass]
</span><a href="GHC.Hs.Decls.html#tcdATs"><span class="hs-identifier hs-var">tcdATs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681166400"><span class="annot"><span class="annottext">[LFamilyDecl GhcRn]
</span><a href="#local-6989586621681166400"><span class="hs-identifier hs-var">ats</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1236"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcTyThing -&gt; TcTypeEnv
forall a. Name -&gt; a -&gt; NameEnv a
</span><a href="GHC.Types.Name.Env.html#unitNameEnv"><span class="hs-identifier hs-var">unitNameEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Name
IdP GhcRn
</span><a href="#local-6989586621681166401"><span class="hs-identifier hs-var">nm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PromotionErr -&gt; TcTyThing
</span><a href="GHC.Tc.Types.html#APromotionErr"><span class="hs-identifier hs-var">APromotionErr</span></a></span><span> </span><span class="annot"><span class="annottext">PromotionErr
</span><a href="GHC.Tc.Types.html#ClassPE"><span class="hs-identifier hs-var">ClassPE</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1237"></span><span>    </span><span class="annot"><span class="annottext">TcTypeEnv -&gt; TcTypeEnv -&gt; TcTypeEnv
forall a. NameEnv a -&gt; NameEnv a -&gt; NameEnv a
</span><a href="GHC.Types.Name.Env.html#plusNameEnv"><span class="hs-operator hs-var">`plusNameEnv`</span></a></span><span>
</span><span id="line-1238"></span><span>    </span><span class="annot"><span class="annottext">[(Name, TcTyThing)] -&gt; TcTypeEnv
forall a. [(Name, a)] -&gt; NameEnv a
</span><a href="GHC.Types.Name.Env.html#mkNameEnv"><span class="hs-identifier hs-var">mkNameEnv</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FamilyDecl GhcRn -&gt; IdP GhcRn
forall (p :: Pass). FamilyDecl (GhcPass p) -&gt; IdP (GhcPass p)
</span><a href="GHC.Hs.Decls.html#familyDeclName"><span class="hs-identifier hs-var">familyDeclName</span></a></span><span> </span><span class="annot"><span class="annottext">FamilyDecl GhcRn
</span><a href="#local-6989586621681166396"><span class="hs-identifier hs-var">at</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PromotionErr -&gt; TcTyThing
</span><a href="GHC.Tc.Types.html#APromotionErr"><span class="hs-identifier hs-var">APromotionErr</span></a></span><span> </span><span class="annot"><span class="annottext">PromotionErr
</span><a href="GHC.Tc.Types.html#TyConPE"><span class="hs-identifier hs-var">TyConPE</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1239"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681166396"><span class="annot"><span class="annottext">FamilyDecl GhcRn
</span><a href="#local-6989586621681166396"><span class="hs-identifier hs-var">at</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[LFamilyDecl GhcRn]
</span><a href="#local-6989586621681166400"><span class="hs-identifier hs-var">ats</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1240"></span><span>
</span><span id="line-1241"></span><span class="annot"><a href="GHC.Tc.TyCl.html#mk_prom_err_env"><span class="hs-identifier hs-var">mk_prom_err_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Decls.html#DataDecl"><span class="hs-identifier hs-type">DataDecl</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcdLName :: forall pass. TyClDecl pass -&gt; Located (IdP pass)
</span><a href="GHC.Hs.Decls.html#tcdLName"><span class="hs-identifier hs-var">tcdLName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681166393"><span class="annot"><span class="annottext">IdP GhcRn
</span><a href="#local-6989586621681166393"><span class="hs-identifier hs-var">name</span></a></span></span><span>
</span><span id="line-1242"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcdDataDefn :: forall pass. TyClDecl pass -&gt; HsDataDefn pass
</span><a href="GHC.Hs.Decls.html#tcdDataDefn"><span class="hs-identifier hs-var">tcdDataDefn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Hs.Decls.html#HsDataDefn"><span class="hs-identifier hs-type">HsDataDefn</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">dd_cons :: forall pass. HsDataDefn pass -&gt; [LConDecl pass]
</span><a href="GHC.Hs.Decls.html#dd_cons"><span class="hs-identifier hs-var">dd_cons</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681166389"><span class="annot"><span class="annottext">[LConDecl GhcRn]
</span><a href="#local-6989586621681166389"><span class="hs-identifier hs-var">cons</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1243"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcTyThing -&gt; TcTypeEnv
forall a. Name -&gt; a -&gt; NameEnv a
</span><a href="GHC.Types.Name.Env.html#unitNameEnv"><span class="hs-identifier hs-var">unitNameEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Name
IdP GhcRn
</span><a href="#local-6989586621681166393"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PromotionErr -&gt; TcTyThing
</span><a href="GHC.Tc.Types.html#APromotionErr"><span class="hs-identifier hs-var">APromotionErr</span></a></span><span> </span><span class="annot"><span class="annottext">PromotionErr
</span><a href="GHC.Tc.Types.html#TyConPE"><span class="hs-identifier hs-var">TyConPE</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1244"></span><span>    </span><span class="annot"><span class="annottext">TcTypeEnv -&gt; TcTypeEnv -&gt; TcTypeEnv
forall a. NameEnv a -&gt; NameEnv a -&gt; NameEnv a
</span><a href="GHC.Types.Name.Env.html#plusNameEnv"><span class="hs-operator hs-var">`plusNameEnv`</span></a></span><span>
</span><span id="line-1245"></span><span>    </span><span class="annot"><span class="annottext">[(Name, TcTyThing)] -&gt; TcTypeEnv
forall a. [(Name, a)] -&gt; NameEnv a
</span><a href="GHC.Types.Name.Env.html#mkNameEnv"><span class="hs-identifier hs-var">mkNameEnv</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681166388"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">PromotionErr -&gt; TcTyThing
</span><a href="GHC.Tc.Types.html#APromotionErr"><span class="hs-identifier hs-var">APromotionErr</span></a></span><span> </span><span class="annot"><span class="annottext">PromotionErr
</span><a href="GHC.Tc.Types.html#RecDataConPE"><span class="hs-identifier hs-var">RecDataConPE</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1246"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681166386"><span class="annot"><span class="annottext">ConDecl GhcRn
</span><a href="#local-6989586621681166386"><span class="hs-identifier hs-var">con'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[LConDecl GhcRn]
</span><a href="#local-6989586621681166389"><span class="hs-identifier hs-var">cons</span></a></span><span>
</span><span id="line-1247"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681166388"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681166388"><span class="hs-identifier hs-var">con</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ConDecl GhcRn -&gt; [Located Name]
</span><a href="GHC.Hs.Decls.html#getConNames"><span class="hs-identifier hs-var">getConNames</span></a></span><span> </span><span class="annot"><span class="annottext">ConDecl GhcRn
</span><a href="#local-6989586621681166386"><span class="hs-identifier hs-var">con'</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1248"></span><span>
</span><span id="line-1249"></span><span class="annot"><a href="GHC.Tc.TyCl.html#mk_prom_err_env"><span class="hs-identifier hs-var">mk_prom_err_env</span></a></span><span> </span><span id="local-6989586621681166384"><span class="annot"><span class="annottext">TyClDecl GhcRn
</span><a href="#local-6989586621681166384"><span class="hs-identifier hs-var">decl</span></a></span></span><span>
</span><span id="line-1250"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcTyThing -&gt; TcTypeEnv
forall a. Name -&gt; a -&gt; NameEnv a
</span><a href="GHC.Types.Name.Env.html#unitNameEnv"><span class="hs-identifier hs-var">unitNameEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyClDecl GhcRn -&gt; IdP GhcRn
forall (p :: Pass). TyClDecl (GhcPass p) -&gt; IdP (GhcPass p)
</span><a href="GHC.Hs.Decls.html#tcdName"><span class="hs-identifier hs-var">tcdName</span></a></span><span> </span><span class="annot"><span class="annottext">TyClDecl GhcRn
</span><a href="#local-6989586621681166384"><span class="hs-identifier hs-var">decl</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PromotionErr -&gt; TcTyThing
</span><a href="GHC.Tc.Types.html#APromotionErr"><span class="hs-identifier hs-var">APromotionErr</span></a></span><span> </span><span class="annot"><span class="annottext">PromotionErr
</span><a href="GHC.Tc.Types.html#TyConPE"><span class="hs-identifier hs-var">TyConPE</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1251"></span><span>    </span><span class="hs-comment">-- Works for family declarations too</span><span>
</span><span id="line-1252"></span><span>
</span><span id="line-1253"></span><span class="hs-comment">--------------</span><span>
</span><span id="line-1254"></span><span class="annot"><a href="GHC.Tc.TyCl.html#inferInitialKinds"><span class="hs-identifier hs-type">inferInitialKinds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Hs.Decls.html#LTyClDecl"><span class="hs-identifier hs-type">LTyClDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyCon"><span class="hs-identifier hs-type">TcTyCon</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1255"></span><span class="hs-comment">-- Returns a TcTyCon for each TyCon bound by the decls,</span><span>
</span><span id="line-1256"></span><span class="hs-comment">-- each with its initial kind</span><span>
</span><span id="line-1257"></span><span>
</span><span id="line-1258"></span><span id="inferInitialKinds"><span class="annot"><span class="annottext">inferInitialKinds :: [LTyClDecl GhcRn] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
</span><a href="GHC.Tc.TyCl.html#inferInitialKinds"><span class="hs-identifier hs-var hs-var">inferInitialKinds</span></a></span></span><span> </span><span id="local-6989586621681166383"><span class="annot"><span class="annottext">[LTyClDecl GhcRn]
</span><a href="#local-6989586621681166383"><span class="hs-identifier hs-var">decls</span></a></span></span><span>
</span><span id="line-1259"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;inferInitialKinds {&quot;</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; TcRn ()) -&gt; SDoc -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(LTyClDecl GhcRn -&gt; Name) -&gt; [LTyClDecl GhcRn] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyClDecl GhcRn -&gt; Name
forall (p :: Pass). TyClDecl (GhcPass p) -&gt; IdP (GhcPass p)
</span><a href="GHC.Hs.Decls.html#tcdName"><span class="hs-identifier hs-var">tcdName</span></a></span><span> </span><span class="annot"><span class="annottext">(TyClDecl GhcRn -&gt; Name)
-&gt; (LTyClDecl GhcRn -&gt; TyClDecl GhcRn) -&gt; LTyClDecl GhcRn -&gt; Name
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">LTyClDecl GhcRn -&gt; TyClDecl GhcRn
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LTyClDecl GhcRn]
</span><a href="#local-6989586621681166383"><span class="hs-identifier hs-var">decls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1260"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681166382"><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681166382"><span class="hs-identifier hs-var">tcs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(LTyClDecl GhcRn -&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon])
-&gt; [LTyClDecl GhcRn] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m [b]) -&gt; [a] -&gt; m [b]
</span><a href="GHC.Utils.Monad.html#concatMapM"><span class="hs-identifier hs-var">concatMapM</span></a></span><span> </span><span class="annot"><span class="annottext">LTyClDecl GhcRn -&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
</span><a href="#local-6989586621681166381"><span class="hs-identifier hs-var">infer_initial_kind</span></a></span><span> </span><span class="annot"><span class="annottext">[LTyClDecl GhcRn]
</span><a href="#local-6989586621681166383"><span class="hs-identifier hs-var">decls</span></a></span><span>
</span><span id="line-1261"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;inferInitialKinds done }&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-1262"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">[TyCon] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681166382"><span class="hs-identifier hs-var">tcs</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1263"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1264"></span><span>    </span><span id="local-6989586621681166381"><span class="annot"><span class="annottext">infer_initial_kind :: LTyClDecl GhcRn -&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
</span><a href="#local-6989586621681166381"><span class="hs-identifier hs-var hs-var">infer_initial_kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TyClDecl GhcRn -&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon])
-&gt; LTyClDecl GhcRn -&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
forall a b. (a -&gt; TcM b) -&gt; Located a -&gt; TcM b
</span><a href="GHC.Tc.Utils.Monad.html#addLocM"><span class="hs-identifier hs-var">addLocM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InitialKindStrategy
-&gt; TyClDecl GhcRn -&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
</span><a href="GHC.Tc.TyCl.html#getInitialKind"><span class="hs-identifier hs-var">getInitialKind</span></a></span><span> </span><span class="annot"><span class="annottext">InitialKindStrategy
</span><a href="GHC.Tc.Gen.HsType.html#InitialKindInfer"><span class="hs-identifier hs-var">InitialKindInfer</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1265"></span><span>
</span><span id="line-1266"></span><span class="hs-comment">-- Check type/class declarations against their standalone kind signatures or</span><span>
</span><span id="line-1267"></span><span class="hs-comment">-- CUSKs, producing a generalized TcTyCon for each.</span><span>
</span><span id="line-1268"></span><span class="annot"><a href="GHC.Tc.TyCl.html#checkInitialKinds"><span class="hs-identifier hs-type">checkInitialKinds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Decls.html#LTyClDecl"><span class="hs-identifier hs-type">LTyClDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#SAKS_or_CUSK"><span class="hs-identifier hs-type">SAKS_or_CUSK</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyCon"><span class="hs-identifier hs-type">TcTyCon</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1269"></span><span id="checkInitialKinds"><span class="annot"><span class="annottext">checkInitialKinds :: [(LTyClDecl GhcRn, SAKS_or_CUSK)]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
</span><a href="GHC.Tc.TyCl.html#checkInitialKinds"><span class="hs-identifier hs-var hs-var">checkInitialKinds</span></a></span></span><span> </span><span id="local-6989586621681166377"><span class="annot"><span class="annottext">[(LTyClDecl GhcRn, SAKS_or_CUSK)]
</span><a href="#local-6989586621681166377"><span class="hs-identifier hs-var">decls</span></a></span></span><span>
</span><span id="line-1270"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;checkInitialKinds {&quot;</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; TcRn ()) -&gt; SDoc -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, SAKS_or_CUSK)] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(LTyClDecl GhcRn -&gt; Name)
-&gt; [(LTyClDecl GhcRn, SAKS_or_CUSK)] -&gt; [(Name, SAKS_or_CUSK)]
forall a c b. (a -&gt; c) -&gt; [(a, b)] -&gt; [(c, b)]
</span><a href="GHC.Utils.Misc.html#mapFst"><span class="hs-identifier hs-var">mapFst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyClDecl GhcRn -&gt; Name
forall (p :: Pass). TyClDecl (GhcPass p) -&gt; IdP (GhcPass p)
</span><a href="GHC.Hs.Decls.html#tcdName"><span class="hs-identifier hs-var">tcdName</span></a></span><span> </span><span class="annot"><span class="annottext">(TyClDecl GhcRn -&gt; Name)
-&gt; (LTyClDecl GhcRn -&gt; TyClDecl GhcRn) -&gt; LTyClDecl GhcRn -&gt; Name
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">LTyClDecl GhcRn -&gt; TyClDecl GhcRn
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(LTyClDecl GhcRn, SAKS_or_CUSK)]
</span><a href="#local-6989586621681166377"><span class="hs-identifier hs-var">decls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1271"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681166375"><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681166375"><span class="hs-identifier hs-var">tcs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((LTyClDecl GhcRn, SAKS_or_CUSK)
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon])
-&gt; [(LTyClDecl GhcRn, SAKS_or_CUSK)]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m [b]) -&gt; [a] -&gt; m [b]
</span><a href="GHC.Utils.Monad.html#concatMapM"><span class="hs-identifier hs-var">concatMapM</span></a></span><span> </span><span class="annot"><span class="annottext">(LTyClDecl GhcRn, SAKS_or_CUSK)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
</span><a href="#local-6989586621681166374"><span class="hs-identifier hs-var">check_initial_kind</span></a></span><span> </span><span class="annot"><span class="annottext">[(LTyClDecl GhcRn, SAKS_or_CUSK)]
</span><a href="#local-6989586621681166377"><span class="hs-identifier hs-var">decls</span></a></span><span>
</span><span id="line-1272"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;checkInitialKinds done }&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-1273"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">[TyCon] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681166375"><span class="hs-identifier hs-var">tcs</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1274"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1275"></span><span>    </span><span id="local-6989586621681166374"><span class="annot"><span class="annottext">check_initial_kind :: (LTyClDecl GhcRn, SAKS_or_CUSK)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
</span><a href="#local-6989586621681166374"><span class="hs-identifier hs-var hs-var">check_initial_kind</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681166373"><span class="annot"><span class="annottext">LTyClDecl GhcRn
</span><a href="#local-6989586621681166373"><span class="hs-identifier hs-var">ldecl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681166372"><span class="annot"><span class="annottext">SAKS_or_CUSK
</span><a href="#local-6989586621681166372"><span class="hs-identifier hs-var">msig</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1276"></span><span>      </span><span class="annot"><span class="annottext">(TyClDecl GhcRn -&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon])
-&gt; LTyClDecl GhcRn -&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
forall a b. (a -&gt; TcM b) -&gt; Located a -&gt; TcM b
</span><a href="GHC.Tc.Utils.Monad.html#addLocM"><span class="hs-identifier hs-var">addLocM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InitialKindStrategy
-&gt; TyClDecl GhcRn -&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
</span><a href="GHC.Tc.TyCl.html#getInitialKind"><span class="hs-identifier hs-var">getInitialKind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SAKS_or_CUSK -&gt; InitialKindStrategy
</span><a href="GHC.Tc.Gen.HsType.html#InitialKindCheck"><span class="hs-identifier hs-var">InitialKindCheck</span></a></span><span> </span><span class="annot"><span class="annottext">SAKS_or_CUSK
</span><a href="#local-6989586621681166372"><span class="hs-identifier hs-var">msig</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LTyClDecl GhcRn
</span><a href="#local-6989586621681166373"><span class="hs-identifier hs-var">ldecl</span></a></span><span>
</span><span id="line-1277"></span><span>
</span><span id="line-1278"></span><span class="hs-comment">-- | Get the initial kind of a TyClDecl, either generalized or non-generalized,</span><span>
</span><span id="line-1279"></span><span class="hs-comment">-- depending on the 'InitialKindStrategy'.</span><span>
</span><span id="line-1280"></span><span class="annot"><a href="GHC.Tc.TyCl.html#getInitialKind"><span class="hs-identifier hs-type">getInitialKind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#InitialKindStrategy"><span class="hs-identifier hs-type">InitialKindStrategy</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Decls.html#TyClDecl"><span class="hs-identifier hs-type">TyClDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyCon"><span class="hs-identifier hs-type">TcTyCon</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1281"></span><span>
</span><span id="line-1282"></span><span class="hs-comment">-- Allocate a fresh kind variable for each TyCon and Class</span><span>
</span><span id="line-1283"></span><span class="hs-comment">-- For each tycon, return a TcTyCon with kind k</span><span>
</span><span id="line-1284"></span><span class="hs-comment">-- where k is the kind of tc, derived from the LHS</span><span>
</span><span id="line-1285"></span><span class="hs-comment">--         of the definition (and probably including</span><span>
</span><span id="line-1286"></span><span class="hs-comment">--         kind unification variables)</span><span>
</span><span id="line-1287"></span><span class="hs-comment">--      Example: data T a b = ...</span><span>
</span><span id="line-1288"></span><span class="hs-comment">--      return (T, kv1 -&gt; kv2 -&gt; kv3)</span><span>
</span><span id="line-1289"></span><span class="hs-comment">--</span><span>
</span><span id="line-1290"></span><span class="hs-comment">-- This pass deals with (ie incorporates into the kind it produces)</span><span>
</span><span id="line-1291"></span><span class="hs-comment">--   * The kind signatures on type-variable binders</span><span>
</span><span id="line-1292"></span><span class="hs-comment">--   * The result kinds signature on a TyClDecl</span><span>
</span><span id="line-1293"></span><span class="hs-comment">--</span><span>
</span><span id="line-1294"></span><span class="hs-comment">-- No family instances are passed to checkInitialKinds/inferInitialKinds</span><span>
</span><span id="line-1295"></span><span id="getInitialKind"><span class="annot"><span class="annottext">getInitialKind :: InitialKindStrategy
-&gt; TyClDecl GhcRn -&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
</span><a href="GHC.Tc.TyCl.html#getInitialKind"><span class="hs-identifier hs-var hs-var">getInitialKind</span></a></span></span><span> </span><span id="local-6989586621681166370"><span class="annot"><span class="annottext">InitialKindStrategy
</span><a href="#local-6989586621681166370"><span class="hs-identifier hs-var">strategy</span></a></span></span><span>
</span><span id="line-1296"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Decls.html#ClassDecl"><span class="hs-identifier hs-type">ClassDecl</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcdLName :: forall pass. TyClDecl pass -&gt; Located (IdP pass)
</span><a href="GHC.Hs.Decls.html#tcdLName"><span class="hs-identifier hs-var">tcdLName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681166369"><span class="annot"><span class="annottext">IdP GhcRn
</span><a href="#local-6989586621681166369"><span class="hs-identifier hs-var">name</span></a></span></span><span>
</span><span id="line-1297"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcdTyVars :: forall pass. TyClDecl pass -&gt; LHsQTyVars pass
</span><a href="GHC.Hs.Decls.html#tcdTyVars"><span class="hs-identifier hs-var">tcdTyVars</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681166367"><span class="annot"><span class="annottext">LHsQTyVars GhcRn
</span><a href="#local-6989586621681166367"><span class="hs-identifier hs-var">ktvs</span></a></span></span><span>
</span><span id="line-1298"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcdATs :: forall pass. TyClDecl pass -&gt; [LFamilyDecl pass]
</span><a href="GHC.Hs.Decls.html#tcdATs"><span class="hs-identifier hs-var">tcdATs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681166366"><span class="annot"><span class="annottext">[LFamilyDecl GhcRn]
</span><a href="#local-6989586621681166366"><span class="hs-identifier hs-var">ats</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1299"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681166365"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166365"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InitialKindStrategy
-&gt; Name
-&gt; TyConFlavour
-&gt; LHsQTyVars GhcRn
-&gt; TcM ContextKind
-&gt; TcRn TyCon
</span><a href="GHC.Tc.Gen.HsType.html#kcDeclHeader"><span class="hs-identifier hs-var">kcDeclHeader</span></a></span><span> </span><span class="annot"><span class="annottext">InitialKindStrategy
</span><a href="#local-6989586621681166370"><span class="hs-identifier hs-var">strategy</span></a></span><span> </span><span class="annot"><span class="annottext">Name
IdP GhcRn
</span><a href="#local-6989586621681166369"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">TyConFlavour
</span><a href="GHC.Core.TyCon.html#ClassFlavour"><span class="hs-identifier hs-var">ClassFlavour</span></a></span><span> </span><span class="annot"><span class="annottext">LHsQTyVars GhcRn
</span><a href="#local-6989586621681166367"><span class="hs-identifier hs-var">ktvs</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM ContextKind -&gt; TcRn TyCon) -&gt; TcM ContextKind -&gt; TcRn TyCon
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1300"></span><span>                </span><span class="annot"><span class="annottext">ContextKind -&gt; TcM ContextKind
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; ContextKind
</span><a href="GHC.Tc.Gen.HsType.html#TheKind"><span class="hs-identifier hs-var">TheKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#constraintKind"><span class="hs-identifier hs-var">constraintKind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1301"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681166360"><span class="annot"><span class="annottext">parent_tv_prs :: [(Name, TyVar)]
</span><a href="#local-6989586621681166360"><span class="hs-identifier hs-var hs-var">parent_tv_prs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [(Name, TyVar)]
</span><a href="GHC.Core.TyCon.html#tcTyConScopedTyVars"><span class="hs-identifier hs-var hs-var">tcTyConScopedTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166365"><span class="hs-identifier hs-var">cls</span></a></span><span>
</span><span id="line-1302"></span><span>            </span><span class="hs-comment">-- See Note [Don't process associated types in getInitialKind]</span><span>
</span><span id="line-1303"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681166359"><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681166359"><span class="hs-identifier hs-var">inner_tcs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1304"></span><span>           </span><span class="annot"><span class="annottext">[(Name, TyVar)]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
forall r. [(Name, TyVar)] -&gt; TcM r -&gt; TcM r
</span><a href="GHC.Tc.Utils.Env.html#tcExtendNameTyVarEnv"><span class="hs-identifier hs-var">tcExtendNameTyVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, TyVar)]
</span><a href="#local-6989586621681166360"><span class="hs-identifier hs-var">parent_tv_prs</span></a></span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon])
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1305"></span><span>           </span><span class="annot"><span class="annottext">(LFamilyDecl GhcRn -&gt; TcRn TyCon)
-&gt; [LFamilyDecl GhcRn] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(FamilyDecl GhcRn -&gt; TcRn TyCon) -&gt; LFamilyDecl GhcRn -&gt; TcRn TyCon
forall a b. (a -&gt; TcM b) -&gt; Located a -&gt; TcM b
</span><a href="GHC.Tc.Utils.Monad.html#addLocM"><span class="hs-identifier hs-var">addLocM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; FamilyDecl GhcRn -&gt; TcRn TyCon
</span><a href="#local-6989586621681166357"><span class="hs-identifier hs-var">getAssocFamInitialKind</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166365"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LFamilyDecl GhcRn]
</span><a href="#local-6989586621681166366"><span class="hs-identifier hs-var">ats</span></a></span><span>
</span><span id="line-1306"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">[TyCon] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166365"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [TyCon] -&gt; [TyCon]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681166359"><span class="hs-identifier hs-var">inner_tcs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1307"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1308"></span><span>    </span><span id="local-6989586621681166357"><span class="annot"><span class="annottext">getAssocFamInitialKind :: TyCon -&gt; FamilyDecl GhcRn -&gt; TcRn TyCon
</span><a href="#local-6989586621681166357"><span class="hs-identifier hs-var hs-var">getAssocFamInitialKind</span></a></span></span><span> </span><span id="local-6989586621681166356"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166356"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1309"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">InitialKindStrategy
</span><a href="#local-6989586621681166370"><span class="hs-identifier hs-var">strategy</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1310"></span><span>        </span><span class="annot"><span class="annottext">InitialKindStrategy
</span><a href="GHC.Tc.Gen.HsType.html#InitialKindInfer"><span class="hs-identifier hs-var">InitialKindInfer</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe TyCon -&gt; FamilyDecl GhcRn -&gt; TcRn TyCon
</span><a href="GHC.Tc.TyCl.html#get_fam_decl_initial_kind"><span class="hs-identifier hs-var">get_fam_decl_initial_kind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Maybe TyCon
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166356"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1311"></span><span>        </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#InitialKindCheck"><span class="hs-identifier hs-type">InitialKindCheck</span></a></span><span> </span><span class="annot"><span class="annottext">SAKS_or_CUSK
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; FamilyDecl GhcRn -&gt; TcRn TyCon
</span><a href="GHC.Tc.TyCl.html#check_initial_kind_assoc_fam"><span class="hs-identifier hs-var">check_initial_kind_assoc_fam</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166356"><span class="hs-identifier hs-var">cls</span></a></span><span>
</span><span id="line-1312"></span><span>
</span><span id="line-1313"></span><span class="annot"><a href="GHC.Tc.TyCl.html#getInitialKind"><span class="hs-identifier hs-var">getInitialKind</span></a></span><span> </span><span id="local-6989586621681166353"><span class="annot"><span class="annottext">InitialKindStrategy
</span><a href="#local-6989586621681166353"><span class="hs-identifier hs-var">strategy</span></a></span></span><span>
</span><span id="line-1314"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Decls.html#DataDecl"><span class="hs-identifier hs-type">DataDecl</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcdLName :: forall pass. TyClDecl pass -&gt; Located (IdP pass)
</span><a href="GHC.Hs.Decls.html#tcdLName"><span class="hs-identifier hs-var">tcdLName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681166352"><span class="annot"><span class="annottext">IdP GhcRn
</span><a href="#local-6989586621681166352"><span class="hs-identifier hs-var">name</span></a></span></span><span>
</span><span id="line-1315"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcdTyVars :: forall pass. TyClDecl pass -&gt; LHsQTyVars pass
</span><a href="GHC.Hs.Decls.html#tcdTyVars"><span class="hs-identifier hs-var">tcdTyVars</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681166351"><span class="annot"><span class="annottext">LHsQTyVars GhcRn
</span><a href="#local-6989586621681166351"><span class="hs-identifier hs-var">ktvs</span></a></span></span><span>
</span><span id="line-1316"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcdDataDefn :: forall pass. TyClDecl pass -&gt; HsDataDefn pass
</span><a href="GHC.Hs.Decls.html#tcdDataDefn"><span class="hs-identifier hs-var">tcdDataDefn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Hs.Decls.html#HsDataDefn"><span class="hs-identifier hs-type">HsDataDefn</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">dd_kindSig :: forall pass. HsDataDefn pass -&gt; Maybe (LHsKind pass)
</span><a href="GHC.Hs.Decls.html#dd_kindSig"><span class="hs-identifier hs-var">dd_kindSig</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681166349"><span class="annot"><span class="annottext">Maybe (LHsType GhcRn)
</span><a href="#local-6989586621681166349"><span class="hs-identifier hs-var">m_sig</span></a></span></span><span>
</span><span id="line-1317"></span><span>                                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dd_ND :: forall pass. HsDataDefn pass -&gt; NewOrData
</span><a href="GHC.Hs.Decls.html#dd_ND"><span class="hs-identifier hs-var">dd_ND</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681166347"><span class="annot"><span class="annottext">NewOrData
</span><a href="#local-6989586621681166347"><span class="hs-identifier hs-var">new_or_data</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1318"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681166346"><span class="annot"><span class="annottext">flav :: TyConFlavour
</span><a href="#local-6989586621681166346"><span class="hs-identifier hs-var hs-var">flav</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NewOrData -&gt; TyConFlavour
</span><a href="GHC.Hs.Decls.html#newOrDataToFlavour"><span class="hs-identifier hs-var">newOrDataToFlavour</span></a></span><span> </span><span class="annot"><span class="annottext">NewOrData
</span><a href="#local-6989586621681166347"><span class="hs-identifier hs-var">new_or_data</span></a></span><span>
</span><span id="line-1319"></span><span>              </span><span id="local-6989586621681166344"><span class="annot"><span class="annottext">ctxt :: UserTypeCtxt
</span><a href="#local-6989586621681166344"><span class="hs-identifier hs-var hs-var">ctxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#DataKindCtxt"><span class="hs-identifier hs-var">DataKindCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">Name
IdP GhcRn
</span><a href="#local-6989586621681166352"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-1320"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681166342"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166342"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InitialKindStrategy
-&gt; Name
-&gt; TyConFlavour
-&gt; LHsQTyVars GhcRn
-&gt; TcM ContextKind
-&gt; TcRn TyCon
</span><a href="GHC.Tc.Gen.HsType.html#kcDeclHeader"><span class="hs-identifier hs-var">kcDeclHeader</span></a></span><span> </span><span class="annot"><span class="annottext">InitialKindStrategy
</span><a href="#local-6989586621681166353"><span class="hs-identifier hs-var">strategy</span></a></span><span> </span><span class="annot"><span class="annottext">Name
IdP GhcRn
</span><a href="#local-6989586621681166352"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">TyConFlavour
</span><a href="#local-6989586621681166346"><span class="hs-identifier hs-var">flav</span></a></span><span> </span><span class="annot"><span class="annottext">LHsQTyVars GhcRn
</span><a href="#local-6989586621681166351"><span class="hs-identifier hs-var">ktvs</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM ContextKind -&gt; TcRn TyCon) -&gt; TcM ContextKind -&gt; TcRn TyCon
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1321"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (LHsType GhcRn)
</span><a href="#local-6989586621681166349"><span class="hs-identifier hs-var">m_sig</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1322"></span><span>                  </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681166341"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621681166341"><span class="hs-identifier hs-var">ksig</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ContextKind
</span><a href="GHC.Tc.Gen.HsType.html#TheKind"><span class="hs-identifier hs-var">TheKind</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; ContextKind) -&gt; TcM Type -&gt; TcM ContextKind
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt -&gt; LHsType GhcRn -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tcLHsKindSig"><span class="hs-identifier hs-var">tcLHsKindSig</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="#local-6989586621681166344"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621681166341"><span class="hs-identifier hs-var">ksig</span></a></span><span>
</span><span id="line-1323"></span><span>                  </span><span class="annot"><span class="annottext">Maybe (LHsType GhcRn)
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ContextKind -&gt; TcM ContextKind
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(ContextKind -&gt; TcM ContextKind) -&gt; ContextKind -&gt; TcM ContextKind
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NewOrData -&gt; ContextKind
</span><a href="GHC.Tc.TyCl.html#dataDeclDefaultResultKind"><span class="hs-identifier hs-var">dataDeclDefaultResultKind</span></a></span><span> </span><span class="annot"><span class="annottext">NewOrData
</span><a href="#local-6989586621681166347"><span class="hs-identifier hs-var">new_or_data</span></a></span><span>
</span><span id="line-1324"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">[TyCon] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166342"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1325"></span><span>
</span><span id="line-1326"></span><span class="annot"><a href="GHC.Tc.TyCl.html#getInitialKind"><span class="hs-identifier hs-var">getInitialKind</span></a></span><span> </span><span class="annot"><span class="annottext">InitialKindStrategy
</span><a href="GHC.Tc.Gen.HsType.html#InitialKindInfer"><span class="hs-identifier hs-var">InitialKindInfer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Decls.html#FamDecl"><span class="hs-identifier hs-type">FamDecl</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcdFam :: forall pass. TyClDecl pass -&gt; FamilyDecl pass
</span><a href="GHC.Hs.Decls.html#tcdFam"><span class="hs-identifier hs-var">tcdFam</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681166336"><span class="annot"><span class="annottext">FamilyDecl GhcRn
</span><a href="#local-6989586621681166336"><span class="hs-identifier hs-var">decl</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1327"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681166335"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166335"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe TyCon -&gt; FamilyDecl GhcRn -&gt; TcRn TyCon
</span><a href="GHC.Tc.TyCl.html#get_fam_decl_initial_kind"><span class="hs-identifier hs-var">get_fam_decl_initial_kind</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TyCon
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">FamilyDecl GhcRn
</span><a href="#local-6989586621681166336"><span class="hs-identifier hs-var">decl</span></a></span><span>
</span><span id="line-1328"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">[TyCon] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166335"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1329"></span><span>
</span><span id="line-1330"></span><span class="annot"><a href="GHC.Tc.TyCl.html#getInitialKind"><span class="hs-identifier hs-var">getInitialKind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#InitialKindCheck"><span class="hs-identifier hs-type">InitialKindCheck</span></a></span><span> </span><span id="local-6989586621681166334"><span class="annot"><span class="annottext">SAKS_or_CUSK
</span><a href="#local-6989586621681166334"><span class="hs-identifier hs-var">msig</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Decls.html#FamDecl"><span class="hs-identifier hs-type">FamDecl</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcdFam :: forall pass. TyClDecl pass -&gt; FamilyDecl pass
</span><a href="GHC.Hs.Decls.html#tcdFam"><span class="hs-identifier hs-var">tcdFam</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1331"></span><span>  </span><span class="annot"><a href="GHC.Hs.Decls.html#FamilyDecl"><span class="hs-identifier hs-type">FamilyDecl</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">fdLName :: forall pass. FamilyDecl pass -&gt; Located (IdP pass)
</span><a href="GHC.Hs.Decls.html#fdLName"><span class="hs-identifier hs-var">fdLName</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpan (IdP GhcRn) -&gt; Name
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621681166331"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681166331"><span class="hs-identifier hs-var">name</span></a></span></span><span>
</span><span id="line-1332"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fdTyVars :: forall pass. FamilyDecl pass -&gt; LHsQTyVars pass
</span><a href="GHC.Hs.Decls.html#fdTyVars"><span class="hs-identifier hs-var">fdTyVars</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681166329"><span class="annot"><span class="annottext">LHsQTyVars GhcRn
</span><a href="#local-6989586621681166329"><span class="hs-identifier hs-var">ktvs</span></a></span></span><span>
</span><span id="line-1333"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fdResultSig :: forall pass. FamilyDecl pass -&gt; LFamilyResultSig pass
</span><a href="GHC.Hs.Decls.html#fdResultSig"><span class="hs-identifier hs-var">fdResultSig</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LFamilyResultSig GhcRn -&gt; FamilyResultSig GhcRn
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621681166327"><span class="annot"><span class="annottext">FamilyResultSig GhcRn
</span><a href="#local-6989586621681166327"><span class="hs-identifier hs-var">resultSig</span></a></span></span><span>
</span><span id="line-1334"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fdInfo :: forall pass. FamilyDecl pass -&gt; FamilyInfo pass
</span><a href="GHC.Hs.Decls.html#fdInfo"><span class="hs-identifier hs-var">fdInfo</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681166325"><span class="annot"><span class="annottext">FamilyInfo GhcRn
</span><a href="#local-6989586621681166325"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-1335"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681166324"><span class="annot"><span class="annottext">flav :: TyConFlavour
</span><a href="#local-6989586621681166324"><span class="hs-identifier hs-var hs-var">flav</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe TyCon -&gt; FamilyInfo GhcRn -&gt; TyConFlavour
forall pass. Maybe TyCon -&gt; FamilyInfo pass -&gt; TyConFlavour
</span><a href="GHC.Tc.TyCl.html#getFamFlav"><span class="hs-identifier hs-var">getFamFlav</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TyCon
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">FamilyInfo GhcRn
</span><a href="#local-6989586621681166325"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-1336"></span><span>             </span><span id="local-6989586621681166322"><span class="annot"><span class="annottext">ctxt :: UserTypeCtxt
</span><a href="#local-6989586621681166322"><span class="hs-identifier hs-var hs-var">ctxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#TyFamResKindCtxt"><span class="hs-identifier hs-var">TyFamResKindCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681166331"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-1337"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681166320"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166320"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InitialKindStrategy
-&gt; Name
-&gt; TyConFlavour
-&gt; LHsQTyVars GhcRn
-&gt; TcM ContextKind
-&gt; TcRn TyCon
</span><a href="GHC.Tc.Gen.HsType.html#kcDeclHeader"><span class="hs-identifier hs-var">kcDeclHeader</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SAKS_or_CUSK -&gt; InitialKindStrategy
</span><a href="GHC.Tc.Gen.HsType.html#InitialKindCheck"><span class="hs-identifier hs-var">InitialKindCheck</span></a></span><span> </span><span class="annot"><span class="annottext">SAKS_or_CUSK
</span><a href="#local-6989586621681166334"><span class="hs-identifier hs-var">msig</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681166331"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">TyConFlavour
</span><a href="#local-6989586621681166324"><span class="hs-identifier hs-var">flav</span></a></span><span> </span><span class="annot"><span class="annottext">LHsQTyVars GhcRn
</span><a href="#local-6989586621681166329"><span class="hs-identifier hs-var">ktvs</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM ContextKind -&gt; TcRn TyCon) -&gt; TcM ContextKind -&gt; TcRn TyCon
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1338"></span><span>               </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">FamilyResultSig GhcRn -&gt; Maybe (LHsType GhcRn)
forall (p :: Pass).
FamilyResultSig (GhcPass p) -&gt; Maybe (LHsKind (GhcPass p))
</span><a href="GHC.Hs.Decls.html#famResultKindSignature"><span class="hs-identifier hs-var">famResultKindSignature</span></a></span><span> </span><span class="annot"><span class="annottext">FamilyResultSig GhcRn
</span><a href="#local-6989586621681166327"><span class="hs-identifier hs-var">resultSig</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1339"></span><span>                 </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681166318"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621681166318"><span class="hs-identifier hs-var">ksig</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ContextKind
</span><a href="GHC.Tc.Gen.HsType.html#TheKind"><span class="hs-identifier hs-var">TheKind</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; ContextKind) -&gt; TcM Type -&gt; TcM ContextKind
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt -&gt; LHsType GhcRn -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tcLHsKindSig"><span class="hs-identifier hs-var">tcLHsKindSig</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="#local-6989586621681166322"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621681166318"><span class="hs-identifier hs-var">ksig</span></a></span><span>
</span><span id="line-1340"></span><span>                 </span><span class="annot"><span class="annottext">Maybe (LHsType GhcRn)
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1341"></span><span>                   </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SAKS_or_CUSK
</span><a href="#local-6989586621681166334"><span class="hs-identifier hs-var">msig</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1342"></span><span>                     </span><span class="annot"><span class="annottext">SAKS_or_CUSK
</span><a href="GHC.Tc.Gen.HsType.html#CUSK"><span class="hs-identifier hs-var">CUSK</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ContextKind -&gt; TcM ContextKind
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; ContextKind
</span><a href="GHC.Tc.Gen.HsType.html#TheKind"><span class="hs-identifier hs-var">TheKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1343"></span><span>                     </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#SAKS"><span class="hs-identifier hs-type">SAKS</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ContextKind -&gt; TcM ContextKind
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">ContextKind
</span><a href="GHC.Tc.Gen.HsType.html#AnyKind"><span class="hs-identifier hs-var">AnyKind</span></a></span><span>
</span><span id="line-1344"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">[TyCon] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166320"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1345"></span><span>
</span><span id="line-1346"></span><span class="annot"><a href="GHC.Tc.TyCl.html#getInitialKind"><span class="hs-identifier hs-var">getInitialKind</span></a></span><span> </span><span id="local-6989586621681166315"><span class="annot"><span class="annottext">InitialKindStrategy
</span><a href="#local-6989586621681166315"><span class="hs-identifier hs-var">strategy</span></a></span></span><span>
</span><span id="line-1347"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Decls.html#SynDecl"><span class="hs-identifier hs-type">SynDecl</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcdLName :: forall pass. TyClDecl pass -&gt; Located (IdP pass)
</span><a href="GHC.Hs.Decls.html#tcdLName"><span class="hs-identifier hs-var">tcdLName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681166313"><span class="annot"><span class="annottext">IdP GhcRn
</span><a href="#local-6989586621681166313"><span class="hs-identifier hs-var">name</span></a></span></span><span>
</span><span id="line-1348"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcdTyVars :: forall pass. TyClDecl pass -&gt; LHsQTyVars pass
</span><a href="GHC.Hs.Decls.html#tcdTyVars"><span class="hs-identifier hs-var">tcdTyVars</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681166312"><span class="annot"><span class="annottext">LHsQTyVars GhcRn
</span><a href="#local-6989586621681166312"><span class="hs-identifier hs-var">ktvs</span></a></span></span><span>
</span><span id="line-1349"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcdRhs :: forall pass. TyClDecl pass -&gt; LHsType pass
</span><a href="GHC.Hs.Decls.html#tcdRhs"><span class="hs-identifier hs-var">tcdRhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681166310"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621681166310"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1350"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681166309"><span class="annot"><span class="annottext">ctxt :: UserTypeCtxt
</span><a href="#local-6989586621681166309"><span class="hs-identifier hs-var hs-var">ctxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#TySynKindCtxt"><span class="hs-identifier hs-var">TySynKindCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">Name
IdP GhcRn
</span><a href="#local-6989586621681166313"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-1351"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681166307"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166307"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InitialKindStrategy
-&gt; Name
-&gt; TyConFlavour
-&gt; LHsQTyVars GhcRn
-&gt; TcM ContextKind
-&gt; TcRn TyCon
</span><a href="GHC.Tc.Gen.HsType.html#kcDeclHeader"><span class="hs-identifier hs-var">kcDeclHeader</span></a></span><span> </span><span class="annot"><span class="annottext">InitialKindStrategy
</span><a href="#local-6989586621681166315"><span class="hs-identifier hs-var">strategy</span></a></span><span> </span><span class="annot"><span class="annottext">Name
IdP GhcRn
</span><a href="#local-6989586621681166313"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">TyConFlavour
</span><a href="GHC.Core.TyCon.html#TypeSynonymFlavour"><span class="hs-identifier hs-var">TypeSynonymFlavour</span></a></span><span> </span><span class="annot"><span class="annottext">LHsQTyVars GhcRn
</span><a href="#local-6989586621681166312"><span class="hs-identifier hs-var">ktvs</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM ContextKind -&gt; TcRn TyCon) -&gt; TcM ContextKind -&gt; TcRn TyCon
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1352"></span><span>               </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn -&gt; Maybe (LHsType GhcRn)
forall pass. LHsType pass -&gt; Maybe (LHsType pass)
</span><a href="GHC.Hs.Type.html#hsTyKindSig"><span class="hs-identifier hs-var">hsTyKindSig</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621681166310"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1353"></span><span>                 </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681166304"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621681166304"><span class="hs-identifier hs-var">rhs_sig</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ContextKind
</span><a href="GHC.Tc.Gen.HsType.html#TheKind"><span class="hs-identifier hs-var">TheKind</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; ContextKind) -&gt; TcM Type -&gt; TcM ContextKind
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt -&gt; LHsType GhcRn -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tcLHsKindSig"><span class="hs-identifier hs-var">tcLHsKindSig</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="#local-6989586621681166309"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621681166304"><span class="hs-identifier hs-var">rhs_sig</span></a></span><span>
</span><span id="line-1354"></span><span>                 </span><span class="annot"><span class="annottext">Maybe (LHsType GhcRn)
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ContextKind -&gt; TcM ContextKind
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">ContextKind
</span><a href="GHC.Tc.Gen.HsType.html#AnyKind"><span class="hs-identifier hs-var">AnyKind</span></a></span><span>
</span><span id="line-1355"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">[TyCon] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166307"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1356"></span><span>
</span><span id="line-1357"></span><span class="annot"><a href="GHC.Tc.TyCl.html#get_fam_decl_initial_kind"><span class="hs-identifier hs-type">get_fam_decl_initial_kind</span></a></span><span>
</span><span id="line-1358"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyCon"><span class="hs-identifier hs-type">TcTyCon</span></a></span><span> </span><span class="hs-comment">-- ^ Just cls &lt;=&gt; this is an associated family of class cls</span><span>
</span><span id="line-1359"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Decls.html#FamilyDecl"><span class="hs-identifier hs-type">FamilyDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-1360"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyCon"><span class="hs-identifier hs-type">TcTyCon</span></a></span><span>
</span><span id="line-1361"></span><span id="get_fam_decl_initial_kind"><span class="annot"><span class="annottext">get_fam_decl_initial_kind :: Maybe TyCon -&gt; FamilyDecl GhcRn -&gt; TcRn TyCon
</span><a href="GHC.Tc.TyCl.html#get_fam_decl_initial_kind"><span class="hs-identifier hs-var hs-var">get_fam_decl_initial_kind</span></a></span></span><span> </span><span id="local-6989586621681166303"><span class="annot"><span class="annottext">Maybe TyCon
</span><a href="#local-6989586621681166303"><span class="hs-identifier hs-var">mb_parent_tycon</span></a></span></span><span>
</span><span id="line-1362"></span><span>    </span><span class="annot"><a href="GHC.Hs.Decls.html#FamilyDecl"><span class="hs-identifier hs-type">FamilyDecl</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">fdLName :: forall pass. FamilyDecl pass -&gt; Located (IdP pass)
</span><a href="GHC.Hs.Decls.html#fdLName"><span class="hs-identifier hs-var">fdLName</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681166302"><span class="annot"><span class="annottext">IdP GhcRn
</span><a href="#local-6989586621681166302"><span class="hs-identifier hs-var">name</span></a></span></span><span>
</span><span id="line-1363"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fdTyVars :: forall pass. FamilyDecl pass -&gt; LHsQTyVars pass
</span><a href="GHC.Hs.Decls.html#fdTyVars"><span class="hs-identifier hs-var">fdTyVars</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681166301"><span class="annot"><span class="annottext">LHsQTyVars GhcRn
</span><a href="#local-6989586621681166301"><span class="hs-identifier hs-var">ktvs</span></a></span></span><span>
</span><span id="line-1364"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fdResultSig :: forall pass. FamilyDecl pass -&gt; LFamilyResultSig pass
</span><a href="GHC.Hs.Decls.html#fdResultSig"><span class="hs-identifier hs-var">fdResultSig</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681166300"><span class="annot"><span class="annottext">FamilyResultSig GhcRn
</span><a href="#local-6989586621681166300"><span class="hs-identifier hs-var">resultSig</span></a></span></span><span>
</span><span id="line-1365"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fdInfo :: forall pass. FamilyDecl pass -&gt; FamilyInfo pass
</span><a href="GHC.Hs.Decls.html#fdInfo"><span class="hs-identifier hs-var">fdInfo</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681166299"><span class="annot"><span class="annottext">FamilyInfo GhcRn
</span><a href="#local-6989586621681166299"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1366"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InitialKindStrategy
-&gt; Name
-&gt; TyConFlavour
-&gt; LHsQTyVars GhcRn
-&gt; TcM ContextKind
-&gt; TcRn TyCon
</span><a href="GHC.Tc.Gen.HsType.html#kcDeclHeader"><span class="hs-identifier hs-var">kcDeclHeader</span></a></span><span> </span><span class="annot"><span class="annottext">InitialKindStrategy
</span><a href="GHC.Tc.Gen.HsType.html#InitialKindInfer"><span class="hs-identifier hs-var">InitialKindInfer</span></a></span><span> </span><span class="annot"><span class="annottext">Name
IdP GhcRn
</span><a href="#local-6989586621681166302"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">TyConFlavour
</span><a href="#local-6989586621681166298"><span class="hs-identifier hs-var">flav</span></a></span><span> </span><span class="annot"><span class="annottext">LHsQTyVars GhcRn
</span><a href="#local-6989586621681166301"><span class="hs-identifier hs-var">ktvs</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM ContextKind -&gt; TcRn TyCon) -&gt; TcM ContextKind -&gt; TcRn TyCon
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1367"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">FamilyResultSig GhcRn
</span><a href="#local-6989586621681166300"><span class="hs-identifier hs-var">resultSig</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1368"></span><span>      </span><span class="annot"><a href="GHC.Hs.Decls.html#KindSig"><span class="hs-identifier hs-type">KindSig</span></a></span><span> </span><span class="annot"><span class="annottext">XCKindSig GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681166296"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621681166296"><span class="hs-identifier hs-var">ki</span></a></span></span><span>                            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ContextKind
</span><a href="GHC.Tc.Gen.HsType.html#TheKind"><span class="hs-identifier hs-var">TheKind</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; ContextKind) -&gt; TcM Type -&gt; TcM ContextKind
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt -&gt; LHsType GhcRn -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tcLHsKindSig"><span class="hs-identifier hs-var">tcLHsKindSig</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="#local-6989586621681166295"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621681166296"><span class="hs-identifier hs-var">ki</span></a></span><span>
</span><span id="line-1369"></span><span>      </span><span class="annot"><a href="GHC.Hs.Decls.html#TyVarSig"><span class="hs-identifier hs-type">TyVarSig</span></a></span><span> </span><span class="annot"><span class="annottext">XTyVarSig GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Type.html#KindedTyVar"><span class="hs-identifier hs-type">KindedTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">XKindedTyVar GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpan (IdP GhcRn)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681166292"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621681166292"><span class="hs-identifier hs-var">ki</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ContextKind
</span><a href="GHC.Tc.Gen.HsType.html#TheKind"><span class="hs-identifier hs-var">TheKind</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; ContextKind) -&gt; TcM Type -&gt; TcM ContextKind
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt -&gt; LHsType GhcRn -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tcLHsKindSig"><span class="hs-identifier hs-var">tcLHsKindSig</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="#local-6989586621681166295"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621681166292"><span class="hs-identifier hs-var">ki</span></a></span><span>
</span><span id="line-1370"></span><span>      </span><span class="annot"><span class="annottext">FamilyResultSig GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-comment">-- open type families have * return kind by default</span><span>
</span><span id="line-1371"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyConFlavour -&gt; Bool
</span><a href="GHC.Core.TyCon.html#tcFlavourIsOpen"><span class="hs-identifier hs-var">tcFlavourIsOpen</span></a></span><span> </span><span class="annot"><span class="annottext">TyConFlavour
</span><a href="#local-6989586621681166298"><span class="hs-identifier hs-var">flav</span></a></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ContextKind -&gt; TcM ContextKind
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; ContextKind
</span><a href="GHC.Tc.Gen.HsType.html#TheKind"><span class="hs-identifier hs-var">TheKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1372"></span><span>               </span><span class="hs-comment">-- closed type families have their return kind inferred</span><span>
</span><span id="line-1373"></span><span>               </span><span class="hs-comment">-- by default</span><span>
</span><span id="line-1374"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ContextKind -&gt; TcM ContextKind
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">ContextKind
</span><a href="GHC.Tc.Gen.HsType.html#AnyKind"><span class="hs-identifier hs-var">AnyKind</span></a></span><span>
</span><span id="line-1375"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1376"></span><span>    </span><span id="local-6989586621681166298"><span class="annot"><span class="annottext">flav :: TyConFlavour
</span><a href="#local-6989586621681166298"><span class="hs-identifier hs-var hs-var">flav</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe TyCon -&gt; FamilyInfo GhcRn -&gt; TyConFlavour
forall pass. Maybe TyCon -&gt; FamilyInfo pass -&gt; TyConFlavour
</span><a href="GHC.Tc.TyCl.html#getFamFlav"><span class="hs-identifier hs-var">getFamFlav</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TyCon
</span><a href="#local-6989586621681166303"><span class="hs-identifier hs-var">mb_parent_tycon</span></a></span><span> </span><span class="annot"><span class="annottext">FamilyInfo GhcRn
</span><a href="#local-6989586621681166299"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-1377"></span><span>    </span><span id="local-6989586621681166295"><span class="annot"><span class="annottext">ctxt :: UserTypeCtxt
</span><a href="#local-6989586621681166295"><span class="hs-identifier hs-var hs-var">ctxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#TyFamResKindCtxt"><span class="hs-identifier hs-var">TyFamResKindCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">Name
IdP GhcRn
</span><a href="#local-6989586621681166302"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-1378"></span><span>
</span><span id="line-1379"></span><span class="hs-comment">-- See Note [Standalone kind signatures for associated types]</span><span>
</span><span id="line-1380"></span><span class="annot"><a href="GHC.Tc.TyCl.html#check_initial_kind_assoc_fam"><span class="hs-identifier hs-type">check_initial_kind_assoc_fam</span></a></span><span>
</span><span id="line-1381"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyCon"><span class="hs-identifier hs-type">TcTyCon</span></a></span><span> </span><span class="hs-comment">-- parent class</span><span>
</span><span id="line-1382"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Decls.html#FamilyDecl"><span class="hs-identifier hs-type">FamilyDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-1383"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyCon"><span class="hs-identifier hs-type">TcTyCon</span></a></span><span>
</span><span id="line-1384"></span><span id="check_initial_kind_assoc_fam"><span class="annot"><span class="annottext">check_initial_kind_assoc_fam :: TyCon -&gt; FamilyDecl GhcRn -&gt; TcRn TyCon
</span><a href="GHC.Tc.TyCl.html#check_initial_kind_assoc_fam"><span class="hs-identifier hs-var hs-var">check_initial_kind_assoc_fam</span></a></span></span><span> </span><span id="local-6989586621681166290"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166290"><span class="hs-identifier hs-var">cls</span></a></span></span><span>
</span><span id="line-1385"></span><span>  </span><span class="annot"><a href="GHC.Hs.Decls.html#FamilyDecl"><span class="hs-identifier hs-type">FamilyDecl</span></a></span><span>
</span><span id="line-1386"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">fdLName :: forall pass. FamilyDecl pass -&gt; Located (IdP pass)
</span><a href="GHC.Hs.Decls.html#fdLName"><span class="hs-identifier hs-var">fdLName</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpan (IdP GhcRn) -&gt; Name
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621681166289"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681166289"><span class="hs-identifier hs-var">name</span></a></span></span><span>
</span><span id="line-1387"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fdTyVars :: forall pass. FamilyDecl pass -&gt; LHsQTyVars pass
</span><a href="GHC.Hs.Decls.html#fdTyVars"><span class="hs-identifier hs-var">fdTyVars</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681166288"><span class="annot"><span class="annottext">LHsQTyVars GhcRn
</span><a href="#local-6989586621681166288"><span class="hs-identifier hs-var">ktvs</span></a></span></span><span>
</span><span id="line-1388"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fdResultSig :: forall pass. FamilyDecl pass -&gt; LFamilyResultSig pass
</span><a href="GHC.Hs.Decls.html#fdResultSig"><span class="hs-identifier hs-var">fdResultSig</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LFamilyResultSig GhcRn -&gt; FamilyResultSig GhcRn
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span id="local-6989586621681166287"><span class="annot"><span class="annottext">FamilyResultSig GhcRn
</span><a href="#local-6989586621681166287"><span class="hs-identifier hs-var">resultSig</span></a></span></span><span>
</span><span id="line-1389"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fdInfo :: forall pass. FamilyDecl pass -&gt; FamilyInfo pass
</span><a href="GHC.Hs.Decls.html#fdInfo"><span class="hs-identifier hs-var">fdInfo</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681166286"><span class="annot"><span class="annottext">FamilyInfo GhcRn
</span><a href="#local-6989586621681166286"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1390"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InitialKindStrategy
-&gt; Name
-&gt; TyConFlavour
-&gt; LHsQTyVars GhcRn
-&gt; TcM ContextKind
-&gt; TcRn TyCon
</span><a href="GHC.Tc.Gen.HsType.html#kcDeclHeader"><span class="hs-identifier hs-var">kcDeclHeader</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SAKS_or_CUSK -&gt; InitialKindStrategy
</span><a href="GHC.Tc.Gen.HsType.html#InitialKindCheck"><span class="hs-identifier hs-var">InitialKindCheck</span></a></span><span> </span><span class="annot"><span class="annottext">SAKS_or_CUSK
</span><a href="GHC.Tc.Gen.HsType.html#CUSK"><span class="hs-identifier hs-var">CUSK</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681166289"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">TyConFlavour
</span><a href="#local-6989586621681166285"><span class="hs-identifier hs-var">flav</span></a></span><span> </span><span class="annot"><span class="annottext">LHsQTyVars GhcRn
</span><a href="#local-6989586621681166288"><span class="hs-identifier hs-var">ktvs</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM ContextKind -&gt; TcRn TyCon) -&gt; TcM ContextKind -&gt; TcRn TyCon
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1391"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">FamilyResultSig GhcRn -&gt; Maybe (LHsType GhcRn)
forall (p :: Pass).
FamilyResultSig (GhcPass p) -&gt; Maybe (LHsKind (GhcPass p))
</span><a href="GHC.Hs.Decls.html#famResultKindSignature"><span class="hs-identifier hs-var">famResultKindSignature</span></a></span><span> </span><span class="annot"><span class="annottext">FamilyResultSig GhcRn
</span><a href="#local-6989586621681166287"><span class="hs-identifier hs-var">resultSig</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1392"></span><span>      </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681166284"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621681166284"><span class="hs-identifier hs-var">ksig</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ContextKind
</span><a href="GHC.Tc.Gen.HsType.html#TheKind"><span class="hs-identifier hs-var">TheKind</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; ContextKind) -&gt; TcM Type -&gt; TcM ContextKind
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt -&gt; LHsType GhcRn -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tcLHsKindSig"><span class="hs-identifier hs-var">tcLHsKindSig</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="#local-6989586621681166283"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621681166284"><span class="hs-identifier hs-var">ksig</span></a></span><span>
</span><span id="line-1393"></span><span>      </span><span class="annot"><span class="annottext">Maybe (LHsType GhcRn)
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ContextKind -&gt; TcM ContextKind
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; ContextKind
</span><a href="GHC.Tc.Gen.HsType.html#TheKind"><span class="hs-identifier hs-var">TheKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1394"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1395"></span><span>    </span><span id="local-6989586621681166283"><span class="annot"><span class="annottext">ctxt :: UserTypeCtxt
</span><a href="#local-6989586621681166283"><span class="hs-identifier hs-var hs-var">ctxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#TyFamResKindCtxt"><span class="hs-identifier hs-var">TyFamResKindCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681166289"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-1396"></span><span>    </span><span id="local-6989586621681166285"><span class="annot"><span class="annottext">flav :: TyConFlavour
</span><a href="#local-6989586621681166285"><span class="hs-identifier hs-var hs-var">flav</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe TyCon -&gt; FamilyInfo GhcRn -&gt; TyConFlavour
forall pass. Maybe TyCon -&gt; FamilyInfo pass -&gt; TyConFlavour
</span><a href="GHC.Tc.TyCl.html#getFamFlav"><span class="hs-identifier hs-var">getFamFlav</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Maybe TyCon
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166290"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">FamilyInfo GhcRn
</span><a href="#local-6989586621681166286"><span class="hs-identifier hs-var">info</span></a></span><span>
</span><span id="line-1397"></span><span>
</span><span id="line-1398"></span><span class="hs-comment">{- Note [Standalone kind signatures for associated types]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

If associated types had standalone kind signatures, would they wear them

---------------------------+------------------------------
  like this? (OUT)         |   or like this? (IN)
---------------------------+------------------------------
  type T :: Type -&gt; Type   |   class C a where
  class C a where          |     type T :: Type -&gt; Type
    type T a               |     type T a

The (IN) variant is syntactically ambiguous:

  class C a where
    type T :: a   -- standalone kind signature?
    type T :: a   -- declaration header?

The (OUT) variant does not suffer from this issue, but it might not be the
direction in which we want to take Haskell: we seek to unify type families and
functions, and, by extension, associated types with class methods. And yet we
give class methods their signatures inside the class, not outside. Neither do
we have the counterpart of InstanceSigs for StandaloneKindSignatures.

For now, we dodge the question by using CUSKs for associated types instead of
standalone kind signatures. This is a simple addition to the rule we used to
have before standalone kind signatures:

  old rule:  associated type has a CUSK iff its parent class has a CUSK
  new rule:  associated type has a CUSK iff its parent class has a CUSK or a standalone kind signature

-}</span><span>
</span><span id="line-1430"></span><span>
</span><span id="line-1431"></span><span class="hs-comment">-- See Note [Data declaration default result kind]</span><span>
</span><span id="line-1432"></span><span class="annot"><a href="GHC.Tc.TyCl.html#dataDeclDefaultResultKind"><span class="hs-identifier hs-type">dataDeclDefaultResultKind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Decls.html#NewOrData"><span class="hs-identifier hs-type">NewOrData</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#ContextKind"><span class="hs-identifier hs-type">ContextKind</span></a></span><span>
</span><span id="line-1433"></span><span id="dataDeclDefaultResultKind"><span class="annot"><span class="annottext">dataDeclDefaultResultKind :: NewOrData -&gt; ContextKind
</span><a href="GHC.Tc.TyCl.html#dataDeclDefaultResultKind"><span class="hs-identifier hs-var hs-var">dataDeclDefaultResultKind</span></a></span></span><span> </span><span class="annot"><span class="annottext">NewOrData
</span><a href="GHC.Hs.Decls.html#NewType"><span class="hs-identifier hs-var">NewType</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ContextKind
</span><a href="GHC.Tc.Gen.HsType.html#OpenKind"><span class="hs-identifier hs-var">OpenKind</span></a></span><span>
</span><span id="line-1434"></span><span>  </span><span class="hs-comment">-- See Note [Implementation of UnliftedNewtypes], point &lt;Error Messages&gt;.</span><span>
</span><span id="line-1435"></span><span class="annot"><a href="GHC.Tc.TyCl.html#dataDeclDefaultResultKind"><span class="hs-identifier hs-var">dataDeclDefaultResultKind</span></a></span><span> </span><span class="annot"><span class="annottext">NewOrData
</span><a href="GHC.Hs.Decls.html#DataType"><span class="hs-identifier hs-var">DataType</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ContextKind
</span><a href="GHC.Tc.Gen.HsType.html#TheKind"><span class="hs-identifier hs-var">TheKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a></span><span>
</span><span id="line-1436"></span><span>
</span><span id="line-1437"></span><span class="hs-comment">{- Note [Data declaration default result kind]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

When the user has not written an inline result kind annotation on a data
declaration, we assume it to be 'Type'. That is, the following declarations
D1 and D2 are considered equivalent:

  data D1         where ...
  data D2 :: Type where ...

The consequence of this assumption is that we reject D3 even though we
accept D4:

  data D3 where
    MkD3 :: ... -&gt; D3 param

  data D4 :: Type -&gt; Type where
    MkD4 :: ... -&gt; D4 param

However, there's a twist: for newtypes, we must relax
the assumed result kind to (TYPE r):

  newtype D5 where
    MkD5 :: Int# -&gt; D5

See Note [Implementation of UnliftedNewtypes], STEP 1 and it's sub-note
&lt;Error Messages&gt;.
-}</span><span>
</span><span id="line-1465"></span><span>
</span><span id="line-1466"></span><span class="hs-comment">---------------------------------</span><span>
</span><span id="line-1467"></span><span id="local-6989586621681167898"><span class="annot"><a href="GHC.Tc.TyCl.html#getFamFlav"><span class="hs-identifier hs-type">getFamFlav</span></a></span><span>
</span><span id="line-1468"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyCon"><span class="hs-identifier hs-type">TcTyCon</span></a></span><span>    </span><span class="hs-comment">-- ^ Just cls &lt;=&gt; this is an associated family of class cls</span><span>
</span><span id="line-1469"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Decls.html#FamilyInfo"><span class="hs-identifier hs-type">FamilyInfo</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681167898"><span class="hs-identifier hs-type">pass</span></a></span><span>
</span><span id="line-1470"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyConFlavour"><span class="hs-identifier hs-type">TyConFlavour</span></a></span></span><span>
</span><span id="line-1471"></span><span id="getFamFlav"><span class="annot"><span class="annottext">getFamFlav :: forall pass. Maybe TyCon -&gt; FamilyInfo pass -&gt; TyConFlavour
</span><a href="GHC.Tc.TyCl.html#getFamFlav"><span class="hs-identifier hs-var hs-var">getFamFlav</span></a></span></span><span> </span><span id="local-6989586621681166279"><span class="annot"><span class="annottext">Maybe TyCon
</span><a href="#local-6989586621681166279"><span class="hs-identifier hs-var">mb_parent_tycon</span></a></span></span><span> </span><span id="local-6989586621681166278"><span class="annot"><span class="annottext">FamilyInfo pass
</span><a href="#local-6989586621681166278"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1472"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">FamilyInfo pass
</span><a href="#local-6989586621681166278"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1473"></span><span>    </span><span class="annot"><span class="annottext">FamilyInfo pass
</span><a href="GHC.Hs.Decls.html#DataFamily"><span class="hs-identifier hs-var">DataFamily</span></a></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe TyCon -&gt; TyConFlavour
</span><a href="GHC.Core.TyCon.html#DataFamilyFlavour"><span class="hs-identifier hs-var">DataFamilyFlavour</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TyCon
</span><a href="#local-6989586621681166279"><span class="hs-identifier hs-var">mb_parent_tycon</span></a></span><span>
</span><span id="line-1474"></span><span>    </span><span class="annot"><span class="annottext">FamilyInfo pass
</span><a href="GHC.Hs.Decls.html#OpenTypeFamily"><span class="hs-identifier hs-var">OpenTypeFamily</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe TyCon -&gt; TyConFlavour
</span><a href="GHC.Core.TyCon.html#OpenTypeFamilyFlavour"><span class="hs-identifier hs-var">OpenTypeFamilyFlavour</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TyCon
</span><a href="#local-6989586621681166279"><span class="hs-identifier hs-var">mb_parent_tycon</span></a></span><span>
</span><span id="line-1475"></span><span>    </span><span class="annot"><a href="GHC.Hs.Decls.html#ClosedTypeFamily"><span class="hs-identifier hs-type">ClosedTypeFamily</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [LTyFamInstEqn pass]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isNothing</span><span> </span><span class="hs-identifier">mb_parent_tycon</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- See Note [Closed type family mb_parent_tycon]</span><span>
</span><span id="line-1476"></span><span>                          </span><span class="annot"><span class="annottext">TyConFlavour
</span><a href="GHC.Core.TyCon.html#ClosedTypeFamilyFlavour"><span class="hs-identifier hs-var">ClosedTypeFamilyFlavour</span></a></span><span>
</span><span id="line-1477"></span><span>
</span><span id="line-1478"></span><span class="hs-comment">{- Note [Closed type family mb_parent_tycon]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
There's no way to write a closed type family inside a class declaration:

  class C a where
    type family F a where  -- error: parse error on input &#8216;where&#8217;

In fact, it is not clear what the meaning of such a declaration would be.
Therefore, 'mb_parent_tycon' of any closed type family has to be Nothing.
-}</span><span>
</span><span id="line-1488"></span><span>
</span><span id="line-1489"></span><span class="hs-comment">------------------------------------------------------------------------</span><span>
</span><span id="line-1490"></span><span class="annot"><a href="GHC.Tc.TyCl.html#kcLTyClDecl"><span class="hs-identifier hs-type">kcLTyClDecl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Decls.html#LTyClDecl"><span class="hs-identifier hs-type">LTyClDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1491"></span><span>  </span><span class="hs-comment">-- See Note [Kind checking for type and class decls]</span><span>
</span><span id="line-1492"></span><span>  </span><span class="hs-comment">-- Called only for declarations without a signature (no CUSKs or SAKs here)</span><span>
</span><span id="line-1493"></span><span id="kcLTyClDecl"><span class="annot"><span class="annottext">kcLTyClDecl :: LTyClDecl GhcRn -&gt; TcRn ()
</span><a href="GHC.Tc.TyCl.html#kcLTyClDecl"><span class="hs-identifier hs-var hs-var">kcLTyClDecl</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681166267"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681166267"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681166266"><span class="annot"><span class="annottext">TyClDecl GhcRn
</span><a href="#local-6989586621681166266"><span class="hs-identifier hs-var">decl</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1494"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcRn () -&gt; TcRn ()
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681166267"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcRn ()) -&gt; TcRn () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1495"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681166265"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166265"><span class="hs-identifier hs-var">tycon</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Name -&gt; TcRn TyCon
Name -&gt; TcRn TyCon
</span><a href="GHC.Tc.Utils.Env.html#tcLookupTcTyCon"><span class="hs-identifier hs-var">tcLookupTcTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Name
IdP GhcRn
</span><a href="#local-6989586621681166263"><span class="hs-identifier hs-var">tc_name</span></a></span><span>
</span><span id="line-1496"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;kcTyClDecl {&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
IdP GhcRn
</span><a href="#local-6989586621681166263"><span class="hs-identifier hs-var">tc_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1497"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TcRn () -&gt; TcRn ()
forall a. TyCon -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.TyCl.html#addVDQNote"><span class="hs-identifier hs-var">addVDQNote</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166265"><span class="hs-identifier hs-var">tycon</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcRn ()) -&gt; TcRn () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>   </span><span class="hs-comment">-- See Note [Inferring visible dependent quantification]</span><span>
</span><span id="line-1498"></span><span>         </span><span class="annot"><span class="annottext">SDoc -&gt; TcRn () -&gt; TcRn ()
forall a. SDoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyClDecl GhcRn -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#tcMkDeclCtxt"><span class="hs-identifier hs-var">tcMkDeclCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">TyClDecl GhcRn
</span><a href="#local-6989586621681166266"><span class="hs-identifier hs-var">decl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcRn ()) -&gt; TcRn () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1499"></span><span>         </span><span class="annot"><span class="annottext">TyClDecl GhcRn -&gt; TyCon -&gt; TcRn ()
</span><a href="GHC.Tc.TyCl.html#kcTyClDecl"><span class="hs-identifier hs-var">kcTyClDecl</span></a></span><span> </span><span class="annot"><span class="annottext">TyClDecl GhcRn
</span><a href="#local-6989586621681166266"><span class="hs-identifier hs-var">decl</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166265"><span class="hs-identifier hs-var">tycon</span></a></span><span>
</span><span id="line-1500"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;kcTyClDecl done }&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
IdP GhcRn
</span><a href="#local-6989586621681166263"><span class="hs-identifier hs-var">tc_name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1501"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1502"></span><span>    </span><span id="local-6989586621681166263"><span class="annot"><span class="annottext">tc_name :: IdP GhcRn
</span><a href="#local-6989586621681166263"><span class="hs-identifier hs-var hs-var">tc_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyClDecl GhcRn -&gt; IdP GhcRn
forall (p :: Pass). TyClDecl (GhcPass p) -&gt; IdP (GhcPass p)
</span><a href="GHC.Hs.Decls.html#tcdName"><span class="hs-identifier hs-var">tcdName</span></a></span><span> </span><span class="annot"><span class="annottext">TyClDecl GhcRn
</span><a href="#local-6989586621681166266"><span class="hs-identifier hs-var">decl</span></a></span><span>
</span><span id="line-1503"></span><span>
</span><span id="line-1504"></span><span class="annot"><a href="GHC.Tc.TyCl.html#kcTyClDecl"><span class="hs-identifier hs-type">kcTyClDecl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Decls.html#TyClDecl"><span class="hs-identifier hs-type">TyClDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyCon"><span class="hs-identifier hs-type">TcTyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1505"></span><span class="hs-comment">-- This function is used solely for its side effect on kind variables</span><span>
</span><span id="line-1506"></span><span class="hs-comment">-- NB kind signatures on the type variables and</span><span>
</span><span id="line-1507"></span><span class="hs-comment">--    result kind signature have already been dealt with</span><span>
</span><span id="line-1508"></span><span class="hs-comment">--    by inferInitialKind, so we can ignore them here.</span><span>
</span><span id="line-1509"></span><span>
</span><span id="line-1510"></span><span id="kcTyClDecl"><span class="annot"><span class="annottext">kcTyClDecl :: TyClDecl GhcRn -&gt; TyCon -&gt; TcRn ()
</span><a href="GHC.Tc.TyCl.html#kcTyClDecl"><span class="hs-identifier hs-var hs-var">kcTyClDecl</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Decls.html#DataDecl"><span class="hs-identifier hs-type">DataDecl</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcdLName :: forall pass. TyClDecl pass -&gt; Located (IdP pass)
</span><a href="GHC.Hs.Decls.html#tcdLName"><span class="hs-identifier hs-var">tcdLName</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681166258"><span class="annot"><span class="annottext">IdP GhcRn
</span><a href="#local-6989586621681166258"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1511"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcdDataDefn :: forall pass. TyClDecl pass -&gt; HsDataDefn pass
</span><a href="GHC.Hs.Decls.html#tcdDataDefn"><span class="hs-identifier hs-var">tcdDataDefn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681166257"><span class="annot"><span class="annottext">HsDataDefn GhcRn
</span><a href="#local-6989586621681166257"><span class="hs-identifier hs-var">defn</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621681166256"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166256"><span class="hs-identifier hs-var">tyCon</span></a></span></span><span>
</span><span id="line-1512"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Hs.Decls.html#HsDataDefn"><span class="hs-identifier hs-type">HsDataDefn</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">dd_cons :: forall pass. HsDataDefn pass -&gt; [LConDecl pass]
</span><a href="GHC.Hs.Decls.html#dd_cons"><span class="hs-identifier hs-var">dd_cons</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681166255"><span class="annot"><span class="annottext">cons :: [LConDecl GhcRn]
</span><a href="#local-6989586621681166255"><span class="hs-identifier hs-var">cons</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Decls.html#ConDeclGADT"><span class="hs-identifier hs-type">ConDeclGADT</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[LConDecl GhcRn]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-1513"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dd_ctxt :: forall pass. HsDataDefn pass -&gt; LHsContext pass
</span><a href="GHC.Hs.Decls.html#dd_ctxt"><span class="hs-identifier hs-var">dd_ctxt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1514"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dd_ND :: forall pass. HsDataDefn pass -&gt; NewOrData
</span><a href="GHC.Hs.Decls.html#dd_ND"><span class="hs-identifier hs-var">dd_ND</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681166252"><span class="annot"><span class="annottext">NewOrData
</span><a href="#local-6989586621681166252"><span class="hs-identifier hs-var">new_or_data</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsDataDefn GhcRn
</span><a href="#local-6989586621681166257"><span class="hs-identifier hs-var">defn</span></a></span><span>
</span><span id="line-1515"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- See Note [Implementation of UnliftedNewtypes] STEP 2</span><span>
</span><span id="line-1516"></span><span>    </span><span class="annot"><span class="annottext">NewOrData -&gt; Type -&gt; [LConDecl GhcRn] -&gt; TcRn ()
</span><a href="GHC.Tc.TyCl.html#kcConDecls"><span class="hs-identifier hs-var">kcConDecls</span></a></span><span> </span><span class="annot"><span class="annottext">NewOrData
</span><a href="#local-6989586621681166252"><span class="hs-identifier hs-var">new_or_data</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Type
</span><a href="GHC.Core.TyCon.html#tyConResKind"><span class="hs-identifier hs-var hs-var">tyConResKind</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166256"><span class="hs-identifier hs-var">tyCon</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LConDecl GhcRn]
</span><a href="#local-6989586621681166255"><span class="hs-identifier hs-var">cons</span></a></span><span>
</span><span id="line-1517"></span><span>
</span><span id="line-1518"></span><span>    </span><span class="hs-comment">-- hs_tvs and dd_kindSig already dealt with in inferInitialKind</span><span>
</span><span id="line-1519"></span><span>    </span><span class="hs-comment">-- This must be a GADT-style decl,</span><span>
</span><span id="line-1520"></span><span>    </span><span class="hs-comment">--        (see invariants of DataDefn declaration)</span><span>
</span><span id="line-1521"></span><span>    </span><span class="hs-comment">-- so (a) we don't need to bring the hs_tvs into scope, because the</span><span>
</span><span id="line-1522"></span><span>    </span><span class="hs-comment">--        ConDecls bind all their own variables</span><span>
</span><span id="line-1523"></span><span>    </span><span class="hs-comment">--    (b) dd_ctxt is not allowed for GADT-style decls, so we can ignore it</span><span>
</span><span id="line-1524"></span><span>
</span><span id="line-1525"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Hs.Decls.html#HsDataDefn"><span class="hs-identifier hs-type">HsDataDefn</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">dd_ctxt :: forall pass. HsDataDefn pass -&gt; LHsContext pass
</span><a href="GHC.Hs.Decls.html#dd_ctxt"><span class="hs-identifier hs-var">dd_ctxt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681166251"><span class="annot"><span class="annottext">GenLocated SrcSpan (HsContext GhcRn)
</span><a href="#local-6989586621681166251"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span>
</span><span id="line-1526"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dd_cons :: forall pass. HsDataDefn pass -&gt; [LConDecl pass]
</span><a href="GHC.Hs.Decls.html#dd_cons"><span class="hs-identifier hs-var">dd_cons</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681166250"><span class="annot"><span class="annottext">[LConDecl GhcRn]
</span><a href="#local-6989586621681166250"><span class="hs-identifier hs-var">cons</span></a></span></span><span>
</span><span id="line-1527"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dd_ND :: forall pass. HsDataDefn pass -&gt; NewOrData
</span><a href="GHC.Hs.Decls.html#dd_ND"><span class="hs-identifier hs-var">dd_ND</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681166249"><span class="annot"><span class="annottext">NewOrData
</span><a href="#local-6989586621681166249"><span class="hs-identifier hs-var">new_or_data</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsDataDefn GhcRn
</span><a href="#local-6989586621681166257"><span class="hs-identifier hs-var">defn</span></a></span><span>
</span><span id="line-1528"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; (TyCon -&gt; [TyConBinder] -&gt; Type -&gt; TcRn ()) -&gt; TcRn ()
forall a.
Name -&gt; (TyCon -&gt; [TyConBinder] -&gt; Type -&gt; TcM a) -&gt; TcM a
</span><a href="GHC.Tc.Gen.HsType.html#bindTyClTyVars"><span class="hs-identifier hs-var">bindTyClTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">Name
IdP GhcRn
</span><a href="#local-6989586621681166258"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">((TyCon -&gt; [TyConBinder] -&gt; Type -&gt; TcRn ()) -&gt; TcRn ())
-&gt; (TyCon -&gt; [TyConBinder] -&gt; Type -&gt; TcRn ()) -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1529"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpan (HsContext GhcRn) -&gt; TcM [Type]
</span><a href="GHC.Tc.Gen.HsType.html#tcHsContext"><span class="hs-identifier hs-var">tcHsContext</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpan (HsContext GhcRn)
</span><a href="#local-6989586621681166251"><span class="hs-identifier hs-var">ctxt</span></a></span><span>
</span><span id="line-1530"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">NewOrData -&gt; Type -&gt; [LConDecl GhcRn] -&gt; TcRn ()
</span><a href="GHC.Tc.TyCl.html#kcConDecls"><span class="hs-identifier hs-var">kcConDecls</span></a></span><span> </span><span class="annot"><span class="annottext">NewOrData
</span><a href="#local-6989586621681166249"><span class="hs-identifier hs-var">new_or_data</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Type
</span><a href="GHC.Core.TyCon.html#tyConResKind"><span class="hs-identifier hs-var hs-var">tyConResKind</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166256"><span class="hs-identifier hs-var">tyCon</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LConDecl GhcRn]
</span><a href="#local-6989586621681166250"><span class="hs-identifier hs-var">cons</span></a></span><span>
</span><span id="line-1531"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-1532"></span><span>
</span><span id="line-1533"></span><span class="annot"><a href="GHC.Tc.TyCl.html#kcTyClDecl"><span class="hs-identifier hs-var">kcTyClDecl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Decls.html#SynDecl"><span class="hs-identifier hs-type">SynDecl</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcdLName :: forall pass. TyClDecl pass -&gt; Located (IdP pass)
</span><a href="GHC.Hs.Decls.html#tcdLName"><span class="hs-identifier hs-var">tcdLName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681166246"><span class="annot"><span class="annottext">IdP GhcRn
</span><a href="#local-6989586621681166246"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcdRhs :: forall pass. TyClDecl pass -&gt; LHsType pass
</span><a href="GHC.Hs.Decls.html#tcdRhs"><span class="hs-identifier hs-var">tcdRhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681166245"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621681166245"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621681166244"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166244"><span class="hs-identifier hs-var">_tycon</span></a></span></span><span>
</span><span id="line-1534"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; (TyCon -&gt; [TyConBinder] -&gt; Type -&gt; TcRn ()) -&gt; TcRn ()
forall a.
Name -&gt; (TyCon -&gt; [TyConBinder] -&gt; Type -&gt; TcM a) -&gt; TcM a
</span><a href="GHC.Tc.Gen.HsType.html#bindTyClTyVars"><span class="hs-identifier hs-var">bindTyClTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">Name
IdP GhcRn
</span><a href="#local-6989586621681166246"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">((TyCon -&gt; [TyConBinder] -&gt; Type -&gt; TcRn ()) -&gt; TcRn ())
-&gt; (TyCon -&gt; [TyConBinder] -&gt; Type -&gt; TcRn ()) -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681166243"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681166243"><span class="hs-identifier hs-var">res_kind</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1535"></span><span>    </span><span class="annot"><span class="annottext">TcM Type -&gt; TcRn ()
forall a. TcM a -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#discardResult"><span class="hs-identifier hs-var">discardResult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM Type -&gt; TcRn ()) -&gt; TcM Type -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn -&gt; ContextKind -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tcCheckLHsType"><span class="hs-identifier hs-var">tcCheckLHsType</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621681166245"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; ContextKind
</span><a href="GHC.Tc.Gen.HsType.html#TheKind"><span class="hs-identifier hs-var">TheKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681166243"><span class="hs-identifier hs-var">res_kind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1536"></span><span>        </span><span class="hs-comment">-- NB: check against the result kind that we allocated</span><span>
</span><span id="line-1537"></span><span>        </span><span class="hs-comment">-- in inferInitialKinds.</span><span>
</span><span id="line-1538"></span><span>
</span><span id="line-1539"></span><span class="annot"><a href="GHC.Tc.TyCl.html#kcTyClDecl"><span class="hs-identifier hs-var">kcTyClDecl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Decls.html#ClassDecl"><span class="hs-identifier hs-type">ClassDecl</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcdLName :: forall pass. TyClDecl pass -&gt; Located (IdP pass)
</span><a href="GHC.Hs.Decls.html#tcdLName"><span class="hs-identifier hs-var">tcdLName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681166240"><span class="annot"><span class="annottext">IdP GhcRn
</span><a href="#local-6989586621681166240"><span class="hs-identifier hs-var">name</span></a></span></span><span>
</span><span id="line-1540"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcdCtxt :: forall pass. TyClDecl pass -&gt; LHsContext pass
</span><a href="GHC.Hs.Decls.html#tcdCtxt"><span class="hs-identifier hs-var">tcdCtxt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681166238"><span class="annot"><span class="annottext">GenLocated SrcSpan (HsContext GhcRn)
</span><a href="#local-6989586621681166238"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcdSigs :: forall pass. TyClDecl pass -&gt; [LSig pass]
</span><a href="GHC.Hs.Decls.html#tcdSigs"><span class="hs-identifier hs-var">tcdSigs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681166236"><span class="annot"><span class="annottext">[LSig GhcRn]
</span><a href="#local-6989586621681166236"><span class="hs-identifier hs-var">sigs</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621681166235"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166235"><span class="hs-identifier hs-var">_tycon</span></a></span></span><span>
</span><span id="line-1541"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; (TyCon -&gt; [TyConBinder] -&gt; Type -&gt; TcRn ()) -&gt; TcRn ()
forall a.
Name -&gt; (TyCon -&gt; [TyConBinder] -&gt; Type -&gt; TcM a) -&gt; TcM a
</span><a href="GHC.Tc.Gen.HsType.html#bindTyClTyVars"><span class="hs-identifier hs-var">bindTyClTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">Name
IdP GhcRn
</span><a href="#local-6989586621681166240"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">((TyCon -&gt; [TyConBinder] -&gt; Type -&gt; TcRn ()) -&gt; TcRn ())
-&gt; (TyCon -&gt; [TyConBinder] -&gt; Type -&gt; TcRn ()) -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1542"></span><span>    </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpan (HsContext GhcRn) -&gt; TcM [Type]
</span><a href="GHC.Tc.Gen.HsType.html#tcHsContext"><span class="hs-identifier hs-var">tcHsContext</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpan (HsContext GhcRn)
</span><a href="#local-6989586621681166238"><span class="hs-identifier hs-var">ctxt</span></a></span><span>
</span><span id="line-1543"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(LSig GhcRn -&gt; TcRn ()) -&gt; [LSig GhcRn] -&gt; TcRn ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><a href="../../base/src/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Sig GhcRn -&gt; TcRn ()) -&gt; LSig GhcRn -&gt; TcRn ()
forall a. (a -&gt; TcRn ()) -&gt; Located a -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#wrapLocM_"><span class="hs-identifier hs-var">wrapLocM_</span></a></span><span> </span><span class="annot"><span class="annottext">Sig GhcRn -&gt; TcRn ()
</span><a href="#local-6989586621681166233"><span class="hs-identifier hs-var">kc_sig</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LSig GhcRn]
</span><a href="#local-6989586621681166236"><span class="hs-identifier hs-var">sigs</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1544"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1545"></span><span>    </span><span id="local-6989586621681166233"><span class="annot"><span class="annottext">kc_sig :: Sig GhcRn -&gt; TcRn ()
</span><a href="#local-6989586621681166233"><span class="hs-identifier hs-var hs-var">kc_sig</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Binds.html#ClassOpSig"><span class="hs-identifier hs-type">ClassOpSig</span></a></span><span> </span><span class="annot"><span class="annottext">XClassOpSig GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681166231"><span class="annot"><span class="annottext">[GenLocated SrcSpan (IdP GhcRn)]
</span><a href="#local-6989586621681166231"><span class="hs-identifier hs-var">nms</span></a></span></span><span> </span><span id="local-6989586621681166230"><span class="annot"><span class="annottext">LHsSigType GhcRn
</span><a href="#local-6989586621681166230"><span class="hs-identifier hs-var">op_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SkolemInfo -&gt; [Located Name] -&gt; LHsSigType GhcRn -&gt; TcRn ()
</span><a href="GHC.Tc.Gen.HsType.html#kcClassSigType"><span class="hs-identifier hs-var">kcClassSigType</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621681166228"><span class="hs-identifier hs-var">skol_info</span></a></span><span> </span><span class="annot"><span class="annottext">[Located Name]
[GenLocated SrcSpan (IdP GhcRn)]
</span><a href="#local-6989586621681166231"><span class="hs-identifier hs-var">nms</span></a></span><span> </span><span class="annot"><span class="annottext">LHsSigType GhcRn
</span><a href="#local-6989586621681166230"><span class="hs-identifier hs-var">op_ty</span></a></span><span>
</span><span id="line-1546"></span><span>    </span><span class="annot"><a href="#local-6989586621681166233"><span class="hs-identifier hs-var">kc_sig</span></a></span><span> </span><span class="annot"><span class="annottext">Sig GhcRn
</span><span class="hs-identifier">_</span></span><span>                          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1547"></span><span>
</span><span id="line-1548"></span><span>    </span><span id="local-6989586621681166228"><span class="annot"><span class="annottext">skol_info :: SkolemInfo
</span><a href="#local-6989586621681166228"><span class="hs-identifier hs-var hs-var">skol_info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyConFlavour -&gt; Name -&gt; SkolemInfo
</span><a href="GHC.Tc.Types.Origin.html#TyConSkol"><span class="hs-identifier hs-var">TyConSkol</span></a></span><span> </span><span class="annot"><span class="annottext">TyConFlavour
</span><a href="GHC.Core.TyCon.html#ClassFlavour"><span class="hs-identifier hs-var">ClassFlavour</span></a></span><span> </span><span class="annot"><span class="annottext">Name
IdP GhcRn
</span><a href="#local-6989586621681166240"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-1549"></span><span>
</span><span id="line-1550"></span><span class="annot"><a href="GHC.Tc.TyCl.html#kcTyClDecl"><span class="hs-identifier hs-var">kcTyClDecl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Decls.html#FamDecl"><span class="hs-identifier hs-type">FamDecl</span></a></span><span> </span><span class="annot"><span class="annottext">XFamDecl GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Decls.html#FamilyDecl"><span class="hs-identifier hs-type">FamilyDecl</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">fdInfo :: forall pass. FamilyDecl pass -&gt; FamilyInfo pass
</span><a href="GHC.Hs.Decls.html#fdInfo"><span class="hs-identifier hs-var">fdInfo</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681166226"><span class="annot"><span class="annottext">FamilyInfo GhcRn
</span><a href="#local-6989586621681166226"><span class="hs-identifier hs-var">fd_info</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621681166225"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166225"><span class="hs-identifier hs-var">fam_tc</span></a></span></span><span>
</span><span id="line-1551"></span><span class="hs-comment">-- closed type families look at their equations, but other families don't</span><span>
</span><span id="line-1552"></span><span class="hs-comment">-- do anything here</span><span>
</span><span id="line-1553"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">FamilyInfo GhcRn
</span><a href="#local-6989586621681166226"><span class="hs-identifier hs-var">fd_info</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1554"></span><span>      </span><span class="annot"><a href="GHC.Hs.Decls.html#ClosedTypeFamily"><span class="hs-identifier hs-type">ClosedTypeFamily</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681166224"><span class="annot"><span class="annottext">[LTyFamInstEqn GhcRn]
</span><a href="#local-6989586621681166224"><span class="hs-identifier hs-var">eqns</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(LTyFamInstEqn GhcRn -&gt; TcRn ())
-&gt; [LTyFamInstEqn GhcRn] -&gt; TcRn ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><a href="../../base/src/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; LTyFamInstEqn GhcRn -&gt; TcRn ()
</span><a href="GHC.Tc.TyCl.html#kcTyFamInstEqn"><span class="hs-identifier hs-var">kcTyFamInstEqn</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166225"><span class="hs-identifier hs-var">fam_tc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LTyFamInstEqn GhcRn]
</span><a href="#local-6989586621681166224"><span class="hs-identifier hs-var">eqns</span></a></span><span>
</span><span id="line-1555"></span><span>      </span><span class="annot"><span class="annottext">FamilyInfo GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1556"></span><span>
</span><span id="line-1557"></span><span class="hs-comment">-------------------</span><span>
</span><span id="line-1558"></span><span>
</span><span id="line-1559"></span><span class="hs-comment">-- Type check the types of the arguments to a data constructor.</span><span>
</span><span id="line-1560"></span><span class="hs-comment">-- This includes doing kind unification if the type is a newtype.</span><span>
</span><span id="line-1561"></span><span class="hs-comment">-- See Note [Implementation of UnliftedNewtypes] for why we need</span><span>
</span><span id="line-1562"></span><span class="hs-comment">-- the first two arguments.</span><span>
</span><span id="line-1563"></span><span class="annot"><a href="GHC.Tc.TyCl.html#kcConArgTys"><span class="hs-identifier hs-type">kcConArgTys</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Decls.html#NewOrData"><span class="hs-identifier hs-type">NewOrData</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Hs.Type.html#HsScaled"><span class="hs-identifier hs-type">HsScaled</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Type.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1564"></span><span id="kcConArgTys"><span class="annot"><span class="annottext">kcConArgTys :: NewOrData -&gt; Type -&gt; [HsScaled GhcRn (LHsType GhcRn)] -&gt; TcRn ()
</span><a href="GHC.Tc.TyCl.html#kcConArgTys"><span class="hs-identifier hs-var hs-var">kcConArgTys</span></a></span></span><span> </span><span id="local-6989586621681166221"><span class="annot"><span class="annottext">NewOrData
</span><a href="#local-6989586621681166221"><span class="hs-identifier hs-var">new_or_data</span></a></span></span><span> </span><span id="local-6989586621681166220"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681166220"><span class="hs-identifier hs-var">res_kind</span></a></span></span><span> </span><span id="local-6989586621681166219"><span class="annot"><span class="annottext">[HsScaled GhcRn (LHsType GhcRn)]
</span><a href="#local-6989586621681166219"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1565"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681166218"><span class="annot"><span class="annottext">exp_kind :: ContextKind
</span><a href="#local-6989586621681166218"><span class="hs-identifier hs-var hs-var">exp_kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NewOrData -&gt; Type -&gt; ContextKind
</span><a href="GHC.Tc.TyCl.html#getArgExpKind"><span class="hs-identifier hs-var">getArgExpKind</span></a></span><span> </span><span class="annot"><span class="annottext">NewOrData
</span><a href="#local-6989586621681166221"><span class="hs-identifier hs-var">new_or_data</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681166220"><span class="hs-identifier hs-var">res_kind</span></a></span><span>
</span><span id="line-1566"></span><span>  </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">[HsScaled GhcRn (LHsType GhcRn)]
-&gt; (HsScaled GhcRn (LHsType GhcRn) -&gt; TcM Type) -&gt; TcRn ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><a href="../../base/src/Data.Foldable.html#forM_"><span class="hs-identifier hs-var">forM_</span></a></span><span> </span><span class="annot"><span class="annottext">[HsScaled GhcRn (LHsType GhcRn)]
</span><a href="#local-6989586621681166219"><span class="hs-identifier hs-var">arg_tys</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Type.html#HsScaled"><span class="hs-identifier hs-type">HsScaled</span></a></span><span> </span><span id="local-6989586621681166214"><span class="annot"><span class="annottext">HsArrow GhcRn
</span><a href="#local-6989586621681166214"><span class="hs-identifier hs-var">mult</span></a></span></span><span> </span><span id="local-6989586621681166213"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621681166213"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn -&gt; ContextKind -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tcCheckLHsType"><span class="hs-identifier hs-var">tcCheckLHsType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsType GhcRn -&gt; LHsType GhcRn
forall a. LHsType a -&gt; LHsType a
</span><a href="GHC.Hs.Type.html#getBangType"><span class="hs-identifier hs-var">getBangType</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621681166213"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ContextKind
</span><a href="#local-6989586621681166218"><span class="hs-identifier hs-var">exp_kind</span></a></span><span>
</span><span id="line-1567"></span><span>                                             </span><span class="annot"><span class="annottext">HsArrow GhcRn -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tcMult"><span class="hs-identifier hs-var">tcMult</span></a></span><span> </span><span class="annot"><span class="annottext">HsArrow GhcRn
</span><a href="#local-6989586621681166214"><span class="hs-identifier hs-var">mult</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1568"></span><span>
</span><span id="line-1569"></span><span>    </span><span class="hs-comment">-- See Note [Implementation of UnliftedNewtypes], STEP 2</span><span>
</span><span id="line-1570"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-1571"></span><span>
</span><span id="line-1572"></span><span class="annot"><a href="GHC.Tc.TyCl.html#kcConDecls"><span class="hs-identifier hs-type">kcConDecls</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Decls.html#NewOrData"><span class="hs-identifier hs-type">NewOrData</span></a></span><span>
</span><span id="line-1573"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span>             </span><span class="hs-comment">-- The result kind signature</span><span>
</span><span id="line-1574"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Hs.Decls.html#LConDecl"><span class="hs-identifier hs-type">LConDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- The data constructors</span><span>
</span><span id="line-1575"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1576"></span><span id="kcConDecls"><span class="annot"><span class="annottext">kcConDecls :: NewOrData -&gt; Type -&gt; [LConDecl GhcRn] -&gt; TcRn ()
</span><a href="GHC.Tc.TyCl.html#kcConDecls"><span class="hs-identifier hs-var hs-var">kcConDecls</span></a></span></span><span> </span><span id="local-6989586621681166210"><span class="annot"><span class="annottext">NewOrData
</span><a href="#local-6989586621681166210"><span class="hs-identifier hs-var">new_or_data</span></a></span></span><span> </span><span id="local-6989586621681166209"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681166209"><span class="hs-identifier hs-var">res_kind</span></a></span></span><span> </span><span id="local-6989586621681166208"><span class="annot"><span class="annottext">[LConDecl GhcRn]
</span><a href="#local-6989586621681166208"><span class="hs-identifier hs-var">cons</span></a></span></span><span>
</span><span id="line-1577"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LConDecl GhcRn -&gt; TcRn ()) -&gt; [LConDecl GhcRn] -&gt; TcRn ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><a href="../../base/src/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ConDecl GhcRn -&gt; TcRn ()) -&gt; LConDecl GhcRn -&gt; TcRn ()
forall a. (a -&gt; TcRn ()) -&gt; Located a -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#wrapLocM_"><span class="hs-identifier hs-var">wrapLocM_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NewOrData -&gt; Type -&gt; ConDecl GhcRn -&gt; TcRn ()
</span><a href="GHC.Tc.TyCl.html#kcConDecl"><span class="hs-identifier hs-var">kcConDecl</span></a></span><span> </span><span class="annot"><span class="annottext">NewOrData
</span><a href="#local-6989586621681166210"><span class="hs-identifier hs-var">new_or_data</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681166206"><span class="hs-identifier hs-var">final_res_kind</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LConDecl GhcRn]
</span><a href="#local-6989586621681166208"><span class="hs-identifier hs-var">cons</span></a></span><span>
</span><span id="line-1578"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1579"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyCoBinder]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681166206"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681166206"><span class="hs-identifier hs-var">final_res_kind</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ([TyCoBinder], Type)
</span><a href="GHC.Core.Type.html#splitPiTys"><span class="hs-identifier hs-var">splitPiTys</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681166209"><span class="hs-identifier hs-var">res_kind</span></a></span><span>
</span><span id="line-1580"></span><span>        </span><span class="hs-comment">-- See Note [kcConDecls result kind]</span><span>
</span><span id="line-1581"></span><span>
</span><span id="line-1582"></span><span class="hs-comment">-- Kind check a data constructor. In additional to the data constructor,</span><span>
</span><span id="line-1583"></span><span class="hs-comment">-- we also need to know about whether or not its corresponding type was</span><span>
</span><span id="line-1584"></span><span class="hs-comment">-- declared with data or newtype, and we need to know the result kind of</span><span>
</span><span id="line-1585"></span><span class="hs-comment">-- this type. See Note [Implementation of UnliftedNewtypes] for why</span><span>
</span><span id="line-1586"></span><span class="hs-comment">-- we need the first two arguments.</span><span>
</span><span id="line-1587"></span><span class="annot"><a href="GHC.Tc.TyCl.html#kcConDecl"><span class="hs-identifier hs-type">kcConDecl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Decls.html#NewOrData"><span class="hs-identifier hs-type">NewOrData</span></a></span><span>
</span><span id="line-1588"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span>  </span><span class="hs-comment">-- Result kind of the type constructor</span><span>
</span><span id="line-1589"></span><span>                   </span><span class="hs-comment">-- Usually Type but can be TYPE UnliftedRep</span><span>
</span><span id="line-1590"></span><span>                   </span><span class="hs-comment">-- or even TYPE r, in the case of unlifted newtype</span><span>
</span><span id="line-1591"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Decls.html#ConDecl"><span class="hs-identifier hs-type">ConDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-1592"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1593"></span><span id="kcConDecl"><span class="annot"><span class="annottext">kcConDecl :: NewOrData -&gt; Type -&gt; ConDecl GhcRn -&gt; TcRn ()
</span><a href="GHC.Tc.TyCl.html#kcConDecl"><span class="hs-identifier hs-var hs-var">kcConDecl</span></a></span></span><span> </span><span id="local-6989586621681166204"><span class="annot"><span class="annottext">NewOrData
</span><a href="#local-6989586621681166204"><span class="hs-identifier hs-var">new_or_data</span></a></span></span><span> </span><span id="local-6989586621681166203"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681166203"><span class="hs-identifier hs-var">res_kind</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Decls.html#ConDeclH98"><span class="hs-identifier hs-type">ConDeclH98</span></a></span><span>
</span><span id="line-1594"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">con_name :: forall pass. ConDecl pass -&gt; Located (IdP pass)
</span><a href="GHC.Hs.Decls.html#con_name"><span class="hs-identifier hs-var">con_name</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681166200"><span class="annot"><span class="annottext">GenLocated SrcSpan (IdP GhcRn)
</span><a href="#local-6989586621681166200"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">con_ex_tvs :: forall pass. ConDecl pass -&gt; [LHsTyVarBndr Specificity pass]
</span><a href="GHC.Hs.Decls.html#con_ex_tvs"><span class="hs-identifier hs-var">con_ex_tvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681166198"><span class="annot"><span class="annottext">[LHsTyVarBndr Specificity GhcRn]
</span><a href="#local-6989586621681166198"><span class="hs-identifier hs-var">ex_tvs</span></a></span></span><span>
</span><span id="line-1595"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">con_mb_cxt :: forall pass. ConDecl pass -&gt; Maybe (LHsContext pass)
</span><a href="GHC.Hs.Decls.html#con_mb_cxt"><span class="hs-identifier hs-var">con_mb_cxt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681166196"><span class="annot"><span class="annottext">Maybe (GenLocated SrcSpan (HsContext GhcRn))
</span><a href="#local-6989586621681166196"><span class="hs-identifier hs-var">ex_ctxt</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">con_args :: forall pass. ConDecl pass -&gt; HsConDeclDetails pass
</span><a href="GHC.Hs.Decls.html#con_args"><span class="hs-identifier hs-var">con_args</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681166194"><span class="annot"><span class="annottext">HsConDeclDetails GhcRn
</span><a href="#local-6989586621681166194"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1596"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcRn () -&gt; TcRn ()
forall a. SDoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Located Name] -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#dataConCtxtName"><span class="hs-identifier hs-var">dataConCtxtName</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Located Name
GenLocated SrcSpan (IdP GhcRn)
</span><a href="#local-6989586621681166200"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcRn ()) -&gt; TcRn () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1597"></span><span>    </span><span class="annot"><span class="annottext">TcM ([VarBndr TyVar Specificity], ()) -&gt; TcRn ()
forall a. TcM a -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#discardResult"><span class="hs-identifier hs-var">discardResult</span></a></span><span>                   </span><span class="annot"><span class="annottext">(TcM ([VarBndr TyVar Specificity], ()) -&gt; TcRn ())
-&gt; TcM ([VarBndr TyVar Specificity], ()) -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1598"></span><span>    </span><span class="annot"><span class="annottext">[LHsTyVarBndr Specificity GhcRn]
-&gt; TcRn () -&gt; TcM ([VarBndr TyVar Specificity], ())
forall flag a.
OutputableBndrFlag flag =&gt;
[LHsTyVarBndr flag GhcRn] -&gt; TcM a -&gt; TcM ([VarBndr TyVar flag], a)
</span><a href="GHC.Tc.Gen.HsType.html#bindExplicitTKBndrs_Tv"><span class="hs-identifier hs-var">bindExplicitTKBndrs_Tv</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsTyVarBndr Specificity GhcRn]
</span><a href="#local-6989586621681166198"><span class="hs-identifier hs-var">ex_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcM ([VarBndr TyVar Specificity], ()))
-&gt; TcRn () -&gt; TcM ([VarBndr TyVar Specificity], ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1599"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (GenLocated SrcSpan (HsContext GhcRn)) -&gt; TcM [Type]
</span><a href="GHC.Tc.Gen.HsType.html#tcHsMbContext"><span class="hs-identifier hs-var">tcHsMbContext</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (GenLocated SrcSpan (HsContext GhcRn))
</span><a href="#local-6989586621681166196"><span class="hs-identifier hs-var">ex_ctxt</span></a></span><span>
</span><span id="line-1600"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">NewOrData -&gt; Type -&gt; [HsScaled GhcRn (LHsType GhcRn)] -&gt; TcRn ()
</span><a href="GHC.Tc.TyCl.html#kcConArgTys"><span class="hs-identifier hs-var">kcConArgTys</span></a></span><span> </span><span class="annot"><span class="annottext">NewOrData
</span><a href="#local-6989586621681166204"><span class="hs-identifier hs-var">new_or_data</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681166203"><span class="hs-identifier hs-var">res_kind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsConDeclDetails GhcRn -&gt; [HsScaled GhcRn (LHsType GhcRn)]
forall pass.
HsConDeclDetails pass -&gt; [HsScaled pass (LBangType pass)]
</span><a href="GHC.Hs.Decls.html#hsConDeclArgTys"><span class="hs-identifier hs-var">hsConDeclArgTys</span></a></span><span> </span><span class="annot"><span class="annottext">HsConDeclDetails GhcRn
</span><a href="#local-6989586621681166194"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1601"></span><span>         </span><span class="hs-comment">-- We don't need to check the telescope here,</span><span>
</span><span id="line-1602"></span><span>         </span><span class="hs-comment">-- because that's done in tcConDecl</span><span>
</span><span id="line-1603"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-1604"></span><span>
</span><span id="line-1605"></span><span class="annot"><a href="GHC.Tc.TyCl.html#kcConDecl"><span class="hs-identifier hs-var">kcConDecl</span></a></span><span> </span><span id="local-6989586621681166189"><span class="annot"><span class="annottext">NewOrData
</span><a href="#local-6989586621681166189"><span class="hs-identifier hs-var">new_or_data</span></a></span></span><span> </span><span id="local-6989586621681166188"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681166188"><span class="hs-identifier hs-var">res_kind</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Decls.html#ConDeclGADT"><span class="hs-identifier hs-type">ConDeclGADT</span></a></span><span>
</span><span id="line-1606"></span><span>    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">con_names :: forall pass. ConDecl pass -&gt; [Located (IdP pass)]
</span><a href="GHC.Hs.Decls.html#con_names"><span class="hs-identifier hs-var">con_names</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681166186"><span class="annot"><span class="annottext">[GenLocated SrcSpan (IdP GhcRn)]
</span><a href="#local-6989586621681166186"><span class="hs-identifier hs-var">names</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">con_qvars :: forall pass. ConDecl pass -&gt; [LHsTyVarBndr Specificity pass]
</span><a href="GHC.Hs.Decls.html#con_qvars"><span class="hs-identifier hs-var">con_qvars</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681166184"><span class="annot"><span class="annottext">[LHsTyVarBndr Specificity GhcRn]
</span><a href="#local-6989586621681166184"><span class="hs-identifier hs-var">explicit_tkv_nms</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">con_mb_cxt :: forall pass. ConDecl pass -&gt; Maybe (LHsContext pass)
</span><a href="GHC.Hs.Decls.html#con_mb_cxt"><span class="hs-identifier hs-var">con_mb_cxt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681166183"><span class="annot"><span class="annottext">Maybe (GenLocated SrcSpan (HsContext GhcRn))
</span><a href="#local-6989586621681166183"><span class="hs-identifier hs-var">cxt</span></a></span></span><span>
</span><span id="line-1607"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">con_args :: forall pass. ConDecl pass -&gt; HsConDeclDetails pass
</span><a href="GHC.Hs.Decls.html#con_args"><span class="hs-identifier hs-var">con_args</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681166182"><span class="annot"><span class="annottext">HsConDeclDetails GhcRn
</span><a href="#local-6989586621681166182"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">con_res_ty :: forall pass. ConDecl pass -&gt; LHsType pass
</span><a href="GHC.Hs.Decls.html#con_res_ty"><span class="hs-identifier hs-var">con_res_ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681166180"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621681166180"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">con_g_ext :: forall pass. ConDecl pass -&gt; XConDeclGADT pass
</span><a href="GHC.Hs.Decls.html#con_g_ext"><span class="hs-identifier hs-var">con_g_ext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681166178"><span class="annot"><span class="annottext">XConDeclGADT GhcRn
</span><a href="#local-6989586621681166178"><span class="hs-identifier hs-var">implicit_tkv_nms</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1608"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- Even though the GADT-style data constructor's type is closed,</span><span>
</span><span id="line-1609"></span><span>    </span><span class="hs-comment">-- we must still kind-check the type, because that may influence</span><span>
</span><span id="line-1610"></span><span>    </span><span class="hs-comment">-- the inferred kind of the /type/ constructor.  Example:</span><span>
</span><span id="line-1611"></span><span>    </span><span class="hs-comment">--    data T f a where</span><span>
</span><span id="line-1612"></span><span>    </span><span class="hs-comment">--      MkT :: f a -&gt; T f a</span><span>
</span><span id="line-1613"></span><span>    </span><span class="hs-comment">-- If we don't look at MkT we won't get the correct kind</span><span>
</span><span id="line-1614"></span><span>    </span><span class="hs-comment">-- for the type constructor T</span><span>
</span><span id="line-1615"></span><span>    </span><span class="annot"><span class="annottext">SDoc -&gt; TcRn () -&gt; TcRn ()
forall a. SDoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Located Name] -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#dataConCtxtName"><span class="hs-identifier hs-var">dataConCtxtName</span></a></span><span> </span><span class="annot"><span class="annottext">[Located Name]
[GenLocated SrcSpan (IdP GhcRn)]
</span><a href="#local-6989586621681166186"><span class="hs-identifier hs-var">names</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcRn ()) -&gt; TcRn () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1616"></span><span>    </span><span class="annot"><span class="annottext">TcM ([TyVar], ([VarBndr TyVar Specificity], ())) -&gt; TcRn ()
forall a. TcM a -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#discardResult"><span class="hs-identifier hs-var">discardResult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM ([TyVar], ([VarBndr TyVar Specificity], ())) -&gt; TcRn ())
-&gt; TcM ([TyVar], ([VarBndr TyVar Specificity], ())) -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1617"></span><span>    </span><span class="annot"><span class="annottext">[Name]
-&gt; TcM ([VarBndr TyVar Specificity], ())
-&gt; TcM ([TyVar], ([VarBndr TyVar Specificity], ()))
forall a. [Name] -&gt; TcM a -&gt; TcM ([TyVar], a)
</span><a href="GHC.Tc.Gen.HsType.html#bindImplicitTKBndrs_Tv"><span class="hs-identifier hs-var">bindImplicitTKBndrs_Tv</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
XConDeclGADT GhcRn
</span><a href="#local-6989586621681166178"><span class="hs-identifier hs-var">implicit_tkv_nms</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM ([VarBndr TyVar Specificity], ())
 -&gt; TcM ([TyVar], ([VarBndr TyVar Specificity], ())))
-&gt; TcM ([VarBndr TyVar Specificity], ())
-&gt; TcM ([TyVar], ([VarBndr TyVar Specificity], ()))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1618"></span><span>    </span><span class="annot"><span class="annottext">[LHsTyVarBndr Specificity GhcRn]
-&gt; TcRn () -&gt; TcM ([VarBndr TyVar Specificity], ())
forall flag a.
OutputableBndrFlag flag =&gt;
[LHsTyVarBndr flag GhcRn] -&gt; TcM a -&gt; TcM ([VarBndr TyVar flag], a)
</span><a href="GHC.Tc.Gen.HsType.html#bindExplicitTKBndrs_Tv"><span class="hs-identifier hs-var">bindExplicitTKBndrs_Tv</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsTyVarBndr Specificity GhcRn]
</span><a href="#local-6989586621681166184"><span class="hs-identifier hs-var">explicit_tkv_nms</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcM ([VarBndr TyVar Specificity], ()))
-&gt; TcRn () -&gt; TcM ([VarBndr TyVar Specificity], ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1619"></span><span>        </span><span class="hs-comment">-- Why &quot;_Tv&quot;?  See Note [Kind-checking for GADTs]</span><span>
</span><span id="line-1620"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (GenLocated SrcSpan (HsContext GhcRn)) -&gt; TcM [Type]
</span><a href="GHC.Tc.Gen.HsType.html#tcHsMbContext"><span class="hs-identifier hs-var">tcHsMbContext</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (GenLocated SrcSpan (HsContext GhcRn))
</span><a href="#local-6989586621681166183"><span class="hs-identifier hs-var">cxt</span></a></span><span>
</span><span id="line-1621"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">NewOrData -&gt; Type -&gt; [HsScaled GhcRn (LHsType GhcRn)] -&gt; TcRn ()
</span><a href="GHC.Tc.TyCl.html#kcConArgTys"><span class="hs-identifier hs-var">kcConArgTys</span></a></span><span> </span><span class="annot"><span class="annottext">NewOrData
</span><a href="#local-6989586621681166189"><span class="hs-identifier hs-var">new_or_data</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681166188"><span class="hs-identifier hs-var">res_kind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsConDeclDetails GhcRn -&gt; [HsScaled GhcRn (LHsType GhcRn)]
forall pass.
HsConDeclDetails pass -&gt; [HsScaled pass (LBangType pass)]
</span><a href="GHC.Hs.Decls.html#hsConDeclArgTys"><span class="hs-identifier hs-var">hsConDeclArgTys</span></a></span><span> </span><span class="annot"><span class="annottext">HsConDeclDetails GhcRn
</span><a href="#local-6989586621681166182"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1622"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tcHsOpenType"><span class="hs-identifier hs-var">tcHsOpenType</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621681166180"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-1623"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1624"></span><span>
</span><span id="line-1625"></span><span class="hs-comment">{- Note [kcConDecls result kind]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We might have e.g.
    data T a :: Type -&gt; Type where ...
or
    newtype instance N a :: Type -&gt; Type  where ..
in which case, the 'res_kind' passed to kcConDecls will be
   Type-&gt;Type

We must look past those arrows, or even foralls, to the Type in the
corner, to pass to kcConDecl c.f. #16828. Hence the splitPiTys here.

I am a bit concerned about tycons with a declaration like
   data T a :: Type -&gt; forall k. k -&gt; Type  where ...

It does not have a CUSK, so kcInferDeclHeader will make a TcTyCon
with tyConResKind of Type -&gt; forall k. k -&gt; Type.  Even that is fine:
the splitPiTys will look past the forall.  But I'm bothered about
what if the type &quot;in the corner&quot; mentions k?  This is incredibly
obscure but something like this could be bad:
   data T a :: Type -&gt; foral k. k -&gt; TYPE (F k) where ...

I bet we are not quite right here, but my brain suffered a buffer
overflow and I thought it best to nail the common cases right now.

Note [Recursion and promoting data constructors]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We don't want to allow promotion in a strongly connected component
when kind checking.

Consider:
  data T f = K (f (K Any))

When kind checking the `data T' declaration the local env contains the
mappings:
  T -&gt; ATcTyCon &lt;some initial kind&gt;
  K -&gt; APromotionErr

APromotionErr is only used for DataCons, and only used during type checking
in tcTyClGroup.

Note [Kind-checking for GADTs]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider

  data Proxy a where
    MkProxy1 :: forall k (b :: k). Proxy b
    MkProxy2 :: forall j (c :: j). Proxy c

It seems reasonable that this should be accepted. But something very strange
is going on here: when we're kind-checking this declaration, we need to unify
the kind of `a` with k and j -- even though k and j's scopes are local to the type of
MkProxy{1,2}. The best approach we've come up with is to use TyVarTvs during
the kind-checking pass. First off, note that it's OK if the kind-checking pass
is too permissive: we'll snag the problems in the type-checking pass later.
(This extra permissiveness might happen with something like

  data SameKind :: k -&gt; k -&gt; Type
  data Bad a where
    MkBad :: forall k1 k2 (a :: k1) (b :: k2). Bad (SameKind a b)

which would be accepted if k1 and k2 were TyVarTvs. This is correctly rejected
in the second pass, though. Test case: polykinds/TyVarTvKinds3)
Recall that the kind-checking pass exists solely to collect constraints
on the kinds and to power unification.

To achieve the use of TyVarTvs, we must be careful to use specialized functions
that produce TyVarTvs, not ordinary skolems. This is why we need
kcExplicitTKBndrs and kcImplicitTKBndrs in GHC.Tc.Gen.HsType, separate from their
tc... variants.

The drawback of this approach is sometimes it will accept a definition that
a (hypothetical) declarative specification would likely reject. As a general
rule, we don't want to allow polymorphic recursion without a CUSK. Indeed,
the whole point of CUSKs is to allow polymorphic recursion. Yet, the TyVarTvs
approach allows a limited form of polymorphic recursion *without* a CUSK.

To wit:
  data T a = forall k (b :: k). MkT (T b) Int
  (test case: dependent/should_compile/T14066a)

Note that this is polymorphically recursive, with the recursive occurrence
of T used at a kind other than a's kind. The approach outlined here accepts
this definition, because this kind is still a kind variable (and so the
TyVarTvs unify). Stepping back, I (Richard) have a hard time envisioning a
way to describe exactly what declarations will be accepted and which will
be rejected (without a CUSK). However, the accepted definitions are indeed
well-kinded and any rejected definitions would be accepted with a CUSK,
and so this wrinkle need not cause anyone to lose sleep.

************************************************************************
*                                                                      *
\subsection{Type checking}
*                                                                      *
************************************************************************

Note [Type checking recursive type and class declarations]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
At this point we have completed *kind-checking* of a mutually
recursive group of type/class decls (done in kcTyClGroup). However,
we discarded the kind-checked types (eg RHSs of data type decls);
note that kcTyClDecl returns ().  There are two reasons:

  * It's convenient, because we don't have to rebuild a
    kinded HsDecl (a fairly elaborate type)

  * It's necessary, because after kind-generalisation, the
    TyCons/Classes may now be kind-polymorphic, and hence need
    to be given kind arguments.

Example:
       data T f a = MkT (f a) (T f a)
During kind-checking, we give T the kind T :: k1 -&gt; k2 -&gt; *
and figure out constraints on k1, k2 etc. Then we generalise
to get   T :: forall k. (k-&gt;*) -&gt; k -&gt; *
So now the (T f a) in the RHS must be elaborated to (T k f a).

However, during tcTyClDecl of T (above) we will be in a recursive
&quot;knot&quot;. So we aren't allowed to look at the TyCon T itself; we are only
allowed to put it (lazily) in the returned structures.  But when
kind-checking the RHS of T's decl, we *do* need to know T's kind (so
that we can correctly elaboarate (T k f a).  How can we get T's kind
without looking at T?  Delicate answer: during tcTyClDecl, we extend

  *Global* env with T -&gt; ATyCon (the (not yet built) final TyCon for T)
  *Local*  env with T -&gt; ATcTyCon (TcTyCon with the polymorphic kind of T)

Then:

  * During GHC.Tc.Gen.HsType.tcTyVar we look in the *local* env, to get the
    fully-known, not knot-tied TcTyCon for T.

  * Then, in GHC.Tc.Utils.Zonk.zonkTcTypeToType (and zonkTcTyCon in particular)
    we look in the *global* env to get the TyCon.

This fancy footwork (with two bindings for T) is only necessary for the
TyCons or Classes of this recursive group.  Earlier, finished groups,
live in the global env only.

See also Note [Kind checking recursive type and class declarations]

Note [Kind checking recursive type and class declarations]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Before we can type-check the decls, we must kind check them. This
is done by establishing an &quot;initial kind&quot;, which is a rather uninformed
guess at a tycon's kind (by counting arguments, mainly) and then
using this initial kind for recursive occurrences.

The initial kind is stored in exactly the same way during
kind-checking as it is during type-checking (Note [Type checking
recursive type and class declarations]): in the *local* environment,
with ATcTyCon. But we still must store *something* in the *global*
environment. Even though we discard the result of kind-checking, we
sometimes need to produce error messages. These error messages will
want to refer to the tycons being checked, except that they don't
exist yet, and it would be Terribly Annoying to get the error messages
to refer back to HsSyn. So we create a TcTyCon and put it in the
global env. This tycon can print out its name and knows its kind, but
any other action taken on it will panic. Note that TcTyCons are *not*
knot-tied, unlike the rather valid but knot-tied ones that occur
during type-checking.

Note [Declarations for wired-in things]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
For wired-in things we simply ignore the declaration
and take the wired-in information.  That avoids complications.
e.g. the need to make the data constructor worker name for
     a constraint tuple match the wired-in one

Note [Datatype return kinds]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
There are several poorly lit corners around datatype/newtype return kinds.
This Note explains these.  We cover data/newtype families and instances
in Note [Data family/instance return kinds].

data    T a :: &lt;kind&gt; where ...   -- See Point DT4
newtype T a :: &lt;kind&gt; where ...   -- See Point DT5

DT1 Where this applies: Only GADT syntax for data/newtype/instance declarations
    can have declared return kinds. This Note does not apply to Haskell98
    syntax.

DT2 Where these kinds come from: The return kind is part of the TyCon kind, gotten either
     by checkInitialKind (standalone kind signature / CUSK) or
     inferInitialKind. It is extracted by bindTyClTyVars in tcTyClDecl1. It is
     then passed to tcDataDefn.

DT3 Eta-expansion: Any forall-bound variables and function arguments in a result kind
    become parameters to the type. That is, when we say

     data T a :: Type -&gt; Type where ...

    we really mean for T to have two parameters. The second parameter
    is produced by processing the return kind in etaExpandAlgTyCon,
    called in tcDataDefn.

    See also Note [TyConBinders for the result kind signatures of a data type]
    in GHC.Tc.Gen.HsType.

DT4 Datatype return kind restriction: A data type return kind must end
    in a type that, after type-synonym expansion, yields `TYPE LiftedRep`. By
    &quot;end in&quot;, we mean we strip any foralls and function arguments off before
    checking.

    Examples:
      data T1 :: Type                          -- good
      data T2 :: Bool -&gt; Type                  -- good
      data T3 :: Bool -&gt; forall k. Type        -- strange, but still accepted
      data T4 :: forall k. k -&gt; Type           -- good
      data T5 :: Bool                          -- bad
      data T6 :: Type -&gt; Bool                  -- bad

    Exactly the same applies to data instance (but not data family)
    declarations.  Examples
      data instance D1 :: Type                 -- good
      data instance D2 :: Bool -&gt; Type         -- good

    We can &quot;look through&quot; type synonyms
      type Star = Type
      data T7 :: Bool -&gt; Star                  -- good (synonym expansion ok)
      type Arrow = (-&gt;)
      data T8 :: Arrow Bool Type               -- good (ditto)

    But we specifically do *not* do type family reduction here.
      type family ARROW where
        ARROW = (-&gt;)
      data T9 :: ARROW Bool Type               -- bad

      type family F a where
        F Int  = Bool
        F Bool = Type
      data T10 :: Bool -&gt; F Bool               -- bad

    The /principle/ here is that in the TyCon for a data type or data instance,
    we must be able to lay out all the type-variable binders, one by one, until
    we reach (TYPE xx).  There is no place for a cast here.  We could add one,
    but let's not!

    This check is done in checkDataKindSig. For data declarations, this
    call is in tcDataDefn; for data instances, this call is in tcDataFamInstDecl.

DT5 Newtype return kind restriction.
    If -XUnliftedNewtypes is not on, then newtypes are treated just
    like datatypes --- see (4) above.

    If -XUnliftedNewtypes is on, then a newtype return kind must end in
    TYPE xyz, for some xyz (after type synonym expansion). The &quot;xyz&quot;
    may include type families, but the TYPE part must be visible
    /without/ expanding type families (only synonyms).

    This kind is unified with the kind of the representation type (the
    type of the one argument to the one constructor). See also steps
    (2) and (3) of Note [Implementation of UnliftedNewtypes].

    The checks are done in the same places as for datatypes.
    Examples (assume -XUnliftedNewtypes):

      newtype N1 :: Type                       -- good
      newtype N2 :: Bool -&gt; Type               -- good
      newtype N3 :: forall r. Bool -&gt; TYPE r   -- good

      type family F (t :: Type) :: RuntimeRep
      newtype N4 :: forall t -&gt; TYPE (F t)     -- good

      type family STAR where
        STAR = Type
      newtype N5 :: Bool -&gt; STAR               -- bad

Note [Data family/instance return kinds]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Within this note, understand &quot;instance&quot; to mean data or newtype
instance, and understand &quot;family&quot; to mean data family. No type
families or classes here. Some examples:

data family T a :: &lt;kind&gt;          -- See Point DF56

data    instance T [a] :: &lt;kind&gt; where ...   -- See Point DF2
newtype instance T [a] :: &lt;kind&gt; where ...   -- See Point DF2

Here is the Plan for Data Families:

DF0 Where these kinds come from:

    Families: The return kind is either written in a standalone signature
     or extracted from a family declaration in getInitialKind.
     If a family declaration is missing a result kind, it is assumed to be
     Type. This assumption is in getInitialKind for CUSKs or
     get_fam_decl_initial_kind for non-signature &amp; non-CUSK cases.

   Instances: The data family already has a known kind. The return kind
     of an instance is then calculated by applying the data family tycon
     to the patterns provided, as computed by the typeKind lhs_ty in the
     end of tcDataFamInstHeader. In the case of an instance written in GADT
     syntax, there are potentially *two* return kinds: the one computed from
     applying the data family tycon to the patterns, and the one given by
     the user. This second kind is checked by the tc_kind_sig function within
     tcDataFamInstHeader. See also DF3, below.

DF1 In a data/newtype instance, we treat the kind of the /data family/,
    once instantiated, as the &quot;master kind&quot; for the representation
    TyCon.  For example:
        data family T1 :: Type -&gt; Type -&gt; Type
        data instance T1 Int :: F Bool -&gt; Type where ...
    The &quot;master kind&quot; for the representation TyCon R:T1Int comes
    from T1, not from the signature on the data instance.  It is as
    if we declared
        data R:T1Int :: Type -&gt; Type where ...
     See Note [Liberalising data family return kinds] for an alternative
     plan.  But this current plan is simple, and ensures that all instances
     are simple instantiations of the master, without strange casts.

     An example with non-trivial instantiation:
        data family T2 :: forall k. Type -&gt; k
        data instance T2 :: Type -&gt; Type -&gt; Type where ...
     Here 'k' gets instantiated with (Type -&gt; Type), driven by
     the signature on the 'data instance'. (See also DT3 of
     Note [Datatype return kinds] about eta-expansion, which applies here,
     too; see tcDataFamInstDecl's call of etaExpandAlgTyCon.)

     A newtype example:

       data Color = Red | Blue
       type family Interpret (x :: Color) :: RuntimeRep where
         Interpret 'Red = 'IntRep
         Interpret 'Blue = 'WordRep
       data family Foo (x :: Color) :: TYPE (Interpret x)
       newtype instance Foo 'Red :: TYPE IntRep where
         FooRedC :: Int# -&gt; Foo 'Red

    Here we get that Foo 'Red :: TYPE (Interpret Red), and our
    representation newtype looks like
         newtype R:FooRed :: TYPE (Interpret Red) where
            FooRedC :: Int# -&gt; R:FooRed
    Remember: the master kind comes from the /family/ tycon.

DF2 /After/ this instantiation, the return kind of the master kind
    must obey the usual rules for data/newtype return kinds (DT4, DT5)
    of Note [Datatype return kinds].  Examples:
        data family T3 k :: k
        data instance T3 Type where ...          -- OK
        data instance T3 (Type-&gt;Type) where ...  -- OK
        data instance T3 (F Int) where ...       -- Not OK

DF3 Any kind signatures on the data/newtype instance are checked for
    equality with the master kind (and hence may guide instantiation)
    but are otherwise ignored. So in the T1 example above, we check
    that (F Int ~ Type) by unification; but otherwise ignore the
    user-supplied signature from the /family/ not the /instance/.

    We must be sure to instantiate any trailing invisible binders
    before doing this unification.  See the call to tcInstInvisibleBinders
    in tcDataFamInstHeader. For example:
       data family D :: forall k. k
       data instance D :: Type               -- forall k. k   &lt;:  Type
       data instance D :: Type -&gt; Type       -- forall k. k   &lt;:  Type -&gt; Type
         -- NB: these do not overlap
    we must instantiate D before unifying with the signature in the
    data instance declaration

DF4 We also (redundantly) check that any user-specified return kind
    signature in the data instance also obeys DT4/DT5.  For example we
    reject
        data family T1 :: Type -&gt; Type -&gt; Type
        data instance T1 Int :: Type -&gt; F Int
    even if (F Int ~ Type).  We could omit this check, because we
    use the master kind; but it seems more uniform to check it, again
    with checkDataKindSig.

DF5 Data /family/ return kind restrictions. Consider
       data family D8 a :: F a
    where F is a type family.  No data/newtype instance can instantiate
    this so that it obeys the rules of DT4 or DT5.  So GHC proactively
    rejects the data /family/ declaration if it can never satisfy (DT4)/(DT5).
    Remember that a data family supports both data and newtype instances.

    More precisely, the return kind of a data family must be either
        * TYPE xyz (for some type xyz) or
        * a kind variable
    Only in these cases can a data/newtype instance possibly satisfy (DT4)/(DT5).
    This is checked by the call to checkDataKindSig in tcFamDecl1.  Examples:

      data family D1 :: Type              -- good
      data family D2 :: Bool -&gt; Type      -- good
      data family D3 k :: k               -- good
      data family D4 :: forall k -&gt; k     -- good
      data family D5 :: forall k. k -&gt; k  -- good
      data family D6 :: forall r. TYPE r  -- good
      data family D7 :: Bool -&gt; STAR      -- bad (see STAR from point 5)

DF6 Two return kinds for instances: If an instance has two return kinds,
    one from the family declaration and one from the instance declaration
    (see point DF3 above), they are unified. More accurately, we make sure
    that the kind of the applied data family is a subkind of the user-written
    kind. GHC.Tc.Gen.HsType.checkExpectedKind normally does this check for types, but
    that's overkill for our needs here. Instead, we just instantiate any
    invisible binders in the (instantiated) kind of the data family
    (called lhs_kind in tcDataFamInstHeader) with tcInstInvisibleTyBinders
    and then unify the resulting kind with the kind written by the user.
    This unification naturally produces a coercion, which we can drop, as
    the kind annotation on the instance is redundant (except perhaps for
    effects of unification).

    This all is Wrinkle (3) in Note [Implementation of UnliftedNewtypes].

Note [Liberalising data family return kinds]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Could we allow this?
   type family F a where { F Int = Type }
   data family T a :: F a
   data instance T Int where
      MkT :: T Int

In the 'data instance', T Int :: F Int, and F Int = Type, so all seems
well.  But there are lots of complications:

* The representation constructor R:TInt presumably has kind Type.
  So the axiom connecting the two would have to look like
       axTInt :: T Int ~ R:TInt |&gt; sym axFInt
  and that doesn't match expectation in DataFamInstTyCon
  in AlgTyConFlav

* The wrapper can't have type
     $WMkT :: Int -&gt; T Int
  because T Int has the wrong kind.  It would have to be
     $WMkT :: Int -&gt; (T Int) |&gt; axFInt

* The code for $WMkT would also be more complicated, needing
  two coherence coercions. Try it!

* Code for pattern matching would be complicated in an
  exactly dual way.

So yes, we could allow this, but we currently do not. That's
why we have DF2 in Note [Data family/instance return kinds].

Note [Implementation of UnliftedNewtypes]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Expected behavior of UnliftedNewtypes:

* Proposal: https://github.com/ghc-proposals/ghc-proposals/blob/master/proposals/0013-unlifted-newtypes.rst
* Discussion: https://github.com/ghc-proposals/ghc-proposals/pull/98

What follows is a high-level overview of the implementation of the
proposal.

STEP 1: Getting the initial kind, as done by inferInitialKind. We have
two sub-cases:

* With a SAK/CUSK: no change in kind-checking; the tycon is given the kind
  the user writes, whatever it may be.

* Without a SAK/CUSK: If there is no kind signature, the tycon is given
  a kind `TYPE r`, for a fresh unification variable `r`. We do this even
  when -XUnliftedNewtypes is not on; see &lt;Error Messages&gt;, below.

STEP 2: Kind-checking, as done by kcTyClDecl. This step is skipped for CUSKs.
The key function here is kcConDecl, which looks at an individual constructor
declaration. When we are processing a newtype (but whether or not -XUnliftedNewtypes
is enabled; see &lt;Error Messages&gt;, below), we generate a correct ContextKind
for the checking argument types: see getArgExpKind.

Examples of newtypes affected by STEP 2, assuming -XUnliftedNewtypes is
enabled (we use r0 to denote a unification variable):

newtype Foo rep = MkFoo (forall (a :: TYPE rep). a)
+ kcConDecl unifies (TYPE r0) with (TYPE rep), where (TYPE r0)
  is the kind that inferInitialKind invented for (Foo rep).

data Color = Red | Blue
type family Interpret (x :: Color) :: RuntimeRep where
  Interpret 'Red = 'IntRep
  Interpret 'Blue = 'WordRep
data family Foo (x :: Color) :: TYPE (Interpret x)
newtype instance Foo 'Red = FooRedC Int#
+ kcConDecl unifies TYPE (Interpret 'Red) with TYPE 'IntRep

Note that, in the GADT case, we might have a kind signature with arrows
(newtype XYZ a b :: Type -&gt; Type where ...). We want only the final
component of the kind for checking in kcConDecl, so we call etaExpandAlgTyCon
in kcTyClDecl.

STEP 3: Type-checking (desugaring), as done by tcTyClDecl. The key function
here is tcConDecl. Once again, we must use getArgExpKind to ensure that the
representation type's kind matches that of the newtype, for two reasons:

  A. It is possible that a GADT has a CUSK. (Note that this is *not*
     possible for H98 types.) Recall that CUSK types don't go through
     kcTyClDecl, so we might not have done this kind check.
  B. We need to produce the coercion to put on the argument type
     if the kinds are different (for both H98 and GADT).

Example of (B):

type family F a where
  F Int = LiftedRep

newtype N :: TYPE (F Int) where
  MkN :: Int -&gt; N

We really need to have the argument to MkN be (Int |&gt; TYPE (sym axF)), where
axF :: F Int ~ LiftedRep. That way, the argument kind is the same as the
newtype kind, which is the principal correctness condition for newtypes.

Wrinkle: Consider (#17021, typecheck/should_fail/T17021)

    type family Id (x :: a) :: a where
      Id x = x

    newtype T :: TYPE (Id LiftedRep) where
      MkT :: Int -&gt; T

  In the type of MkT, we must end with (Int |&gt; TYPE (sym axId)) -&gt; T,
  never Int -&gt; (T |&gt; TYPE axId); otherwise, the result type of the
  constructor wouldn't match the datatype. However, type-checking the
  HsType T might reasonably result in (T |&gt; hole). We thus must ensure
  that this cast is dropped, forcing the type-checker to add one to
  the Int instead.

  Why is it always safe to drop the cast? This result type is type-checked by
  tcHsOpenType, so its kind definitely looks like TYPE r, for some r. It is
  important that even after dropping the cast, the type's kind has the form
  TYPE r. This is guaranteed by restrictions on the kinds of datatypes.
  For example, a declaration like `newtype T :: Id Type` is rejected: a
  newtype's final kind always has the form TYPE r, just as we want.

Note that this is possible in the H98 case only for a data family, because
the H98 syntax doesn't permit a kind signature on the newtype itself.

There are also some changes for dealing with families:

1. In tcFamDecl1, we suppress a tcIsLiftedTypeKind check if
   UnliftedNewtypes is on. This allows us to write things like:
     data family Foo :: TYPE 'IntRep

2. In a newtype instance (with -XUnliftedNewtypes), if the user does
   not write a kind signature, we want to allow the possibility that
   the kind is not Type, so we use newOpenTypeKind instead of liftedTypeKind.
   This is done in tcDataFamInstHeader in GHC.Tc.TyCl.Instance. Example:

       data family Bar (a :: RuntimeRep) :: TYPE a
       newtype instance Bar 'IntRep = BarIntC Int#
       newtype instance Bar 'WordRep :: TYPE 'WordRep where
         BarWordC :: Word# -&gt; Bar 'WordRep

   The data instance corresponding to IntRep does not specify a kind signature,
   so tc_kind_sig just returns `TYPE r0` (where `r0` is a fresh metavariable).
   The data instance corresponding to WordRep does have a kind signature, so
   we use that kind signature.

3. A data family and its newtype instance may be declared with slightly
   different kinds. See point DF6 in Note [Data family/instance return kinds]

There's also a change in the renamer:

* In GHC.RenameSource.rnTyClDecl, enabling UnliftedNewtypes changes what is means
  for a newtype to have a CUSK. This is necessary since UnliftedNewtypes
  means that, for newtypes without kind signatures, we must use the field
  inside the data constructor to determine the result kind.
  See Note [Unlifted Newtypes and CUSKs] for more detail.

For completeness, it was also necessary to make coerce work on
unlifted types, resolving #13595.

&lt;Error Messages&gt;: It's tempting to think that the expected kind for a newtype
constructor argument when -XUnliftedNewtypes is *not* enabled should just be Type.
But this leads to difficulty in suggesting to enable UnliftedNewtypes. Here is
an example:

  newtype A = MkA Int#

If we expect the argument to MkA to have kind Type, then we get a kind-mismatch
error. The problem is that there is no way to connect this mismatch error to
-XUnliftedNewtypes, and suggest enabling the extension. So, instead, we allow
the A to type-check, but then find the problem when doing validity checking (and
where we get make a suitable error message). One potential worry is

  {-# LANGUAGE PolyKinds #-}
  newtype B a = MkB a

This turns out OK, because unconstrained RuntimeReps default to LiftedRep, just
as we would like. Another potential problem comes in a case like

  -- no UnliftedNewtypes

  data family D :: k
  newtype instance D = MkD Any

Here, we want inference to tell us that k should be instantiated to Type in
the instance. With the approach described here (checking for Type only in
the validity checker), that will not happen. But I cannot think of a non-contrived
example that will notice this lack of inference, so it seems better to improve
error messages than be able to infer this instantiation.

-}</span><span>
</span><span id="line-2219"></span><span>
</span><span id="line-2220"></span><span class="annot"><a href="GHC.Tc.TyCl.html#tcTyClDecl"><span class="hs-identifier hs-type">tcTyClDecl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.TyCl.Utils.html#RolesInfo"><span class="hs-identifier hs-type">RolesInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Decls.html#LTyClDecl"><span class="hs-identifier hs-type">LTyClDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Deriv.html#DerivInfo"><span class="hs-identifier hs-type">DerivInfo</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2221"></span><span id="tcTyClDecl"><span class="annot"><span class="annottext">tcTyClDecl :: (Name -&gt; [Role])
-&gt; LTyClDecl GhcRn
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (TyCon, [DerivInfo])
</span><a href="GHC.Tc.TyCl.html#tcTyClDecl"><span class="hs-identifier hs-var hs-var">tcTyClDecl</span></a></span></span><span> </span><span id="local-6989586621681166174"><span class="annot"><span class="annottext">Name -&gt; [Role]
</span><a href="#local-6989586621681166174"><span class="hs-identifier hs-var">roles_info</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681166173"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681166173"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681166172"><span class="annot"><span class="annottext">TyClDecl GhcRn
</span><a href="#local-6989586621681166172"><span class="hs-identifier hs-var">decl</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2222"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681166171"><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621681166171"><span class="hs-identifier hs-var">thing</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Maybe TyThing
</span><a href="GHC.Types.Name.html#wiredInNameTyThing_maybe"><span class="hs-identifier hs-var">wiredInNameTyThing_maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyClDecl GhcRn -&gt; IdP GhcRn
forall (p :: Pass). TyClDecl (GhcPass p) -&gt; IdP (GhcPass p)
</span><a href="GHC.Hs.Decls.html#tcdName"><span class="hs-identifier hs-var">tcdName</span></a></span><span> </span><span class="annot"><span class="annottext">TyClDecl GhcRn
</span><a href="#local-6989586621681166172"><span class="hs-identifier hs-var">decl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2223"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621681166171"><span class="hs-identifier hs-var">thing</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-comment">-- See Note [Declarations for wired-in things]</span><span>
</span><span id="line-2224"></span><span>      </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ATyCon"><span class="hs-identifier hs-type">ATyCon</span></a></span><span> </span><span id="local-6989586621681166169"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166169"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(TyCon, [DerivInfo])
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (TyCon, [DerivInfo])
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166169"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyClDecl GhcRn -&gt; [DerivInfo]
</span><a href="GHC.Tc.TyCl.html#wiredInDerivInfo"><span class="hs-identifier hs-var">wiredInDerivInfo</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166169"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">TyClDecl GhcRn
</span><a href="#local-6989586621681166172"><span class="hs-identifier hs-var">decl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2225"></span><span>      </span><span class="annot"><span class="annottext">TyThing
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String
-&gt; SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) (TyCon, [DerivInfo])
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcTyClDecl&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyThing -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621681166171"><span class="hs-identifier hs-var">thing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2226"></span><span>
</span><span id="line-2227"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-2228"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (TyCon, [DerivInfo])
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (TyCon, [DerivInfo])
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681166173"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) (TyCon, [DerivInfo])
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) (TyCon, [DerivInfo]))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (TyCon, [DerivInfo])
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (TyCon, [DerivInfo])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TyClDecl GhcRn
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (TyCon, [DerivInfo])
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (TyCon, [DerivInfo])
forall a. TyClDecl GhcRn -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.TyCl.html#tcAddDeclCtxt"><span class="hs-identifier hs-var">tcAddDeclCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">TyClDecl GhcRn
</span><a href="#local-6989586621681166172"><span class="hs-identifier hs-var">decl</span></a></span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) (TyCon, [DerivInfo])
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) (TyCon, [DerivInfo]))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (TyCon, [DerivInfo])
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (TyCon, [DerivInfo])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2229"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;---- tcTyClDecl ---- {&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyClDecl GhcRn -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TyClDecl GhcRn
</span><a href="#local-6989586621681166172"><span class="hs-identifier hs-var">decl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2230"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681166167"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166167"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681166166"><span class="annot"><span class="annottext">[DerivInfo]
</span><a href="#local-6989586621681166166"><span class="hs-identifier hs-var">deriv_infos</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Class
-&gt; (Name -&gt; [Role])
-&gt; TyClDecl GhcRn
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (TyCon, [DerivInfo])
</span><a href="GHC.Tc.TyCl.html#tcTyClDecl1"><span class="hs-identifier hs-var">tcTyClDecl1</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Class
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Role]
</span><a href="#local-6989586621681166174"><span class="hs-identifier hs-var">roles_info</span></a></span><span> </span><span class="annot"><span class="annottext">TyClDecl GhcRn
</span><a href="#local-6989586621681166172"><span class="hs-identifier hs-var">decl</span></a></span><span>
</span><span id="line-2231"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;---- tcTyClDecl end ---- }&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166167"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2232"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(TyCon, [DerivInfo])
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (TyCon, [DerivInfo])
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166167"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[DerivInfo]
</span><a href="#local-6989586621681166166"><span class="hs-identifier hs-var">deriv_infos</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2233"></span><span>
</span><span id="line-2234"></span><span id="local-6989586621681167850"><span class="annot"><a href="GHC.Tc.TyCl.html#noDerivInfos"><span class="hs-identifier hs-type">noDerivInfos</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621681167850"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681167850"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Deriv.html#DerivInfo"><span class="hs-identifier hs-type">DerivInfo</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span></span><span>
</span><span id="line-2235"></span><span id="noDerivInfos"><span class="annot"><span class="annottext">noDerivInfos :: forall a. a -&gt; (a, [DerivInfo])
</span><a href="GHC.Tc.TyCl.html#noDerivInfos"><span class="hs-identifier hs-var hs-var">noDerivInfos</span></a></span></span><span> </span><span id="local-6989586621681166163"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681166163"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681166163"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2236"></span><span>
</span><span id="line-2237"></span><span class="annot"><a href="GHC.Tc.TyCl.html#wiredInDerivInfo"><span class="hs-identifier hs-type">wiredInDerivInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Decls.html#TyClDecl"><span class="hs-identifier hs-type">TyClDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Deriv.html#DerivInfo"><span class="hs-identifier hs-type">DerivInfo</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2238"></span><span id="wiredInDerivInfo"><span class="annot"><span class="annottext">wiredInDerivInfo :: TyCon -&gt; TyClDecl GhcRn -&gt; [DerivInfo]
</span><a href="GHC.Tc.TyCl.html#wiredInDerivInfo"><span class="hs-identifier hs-var hs-var">wiredInDerivInfo</span></a></span></span><span> </span><span id="local-6989586621681166162"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166162"><span class="hs-identifier hs-var">tycon</span></a></span></span><span> </span><span id="local-6989586621681166161"><span class="annot"><span class="annottext">TyClDecl GhcRn
</span><a href="#local-6989586621681166161"><span class="hs-identifier hs-var">decl</span></a></span></span><span>
</span><span id="line-2239"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Hs.Decls.html#DataDecl"><span class="hs-identifier hs-type">DataDecl</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcdDataDefn :: forall pass. TyClDecl pass -&gt; HsDataDefn pass
</span><a href="GHC.Hs.Decls.html#tcdDataDefn"><span class="hs-identifier hs-var">tcdDataDefn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681166160"><span class="annot"><span class="annottext">HsDataDefn GhcRn
</span><a href="#local-6989586621681166160"><span class="hs-identifier hs-var">dataDefn</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyClDecl GhcRn
</span><a href="#local-6989586621681166161"><span class="hs-identifier hs-var">decl</span></a></span><span>
</span><span id="line-2240"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Hs.Decls.html#HsDataDefn"><span class="hs-identifier hs-type">HsDataDefn</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">dd_derivs :: forall pass. HsDataDefn pass -&gt; HsDeriving pass
</span><a href="GHC.Hs.Decls.html#dd_derivs"><span class="hs-identifier hs-var">dd_derivs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681166158"><span class="annot"><span class="annottext">HsDeriving GhcRn
</span><a href="#local-6989586621681166158"><span class="hs-identifier hs-var">derivs</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsDataDefn GhcRn
</span><a href="#local-6989586621681166160"><span class="hs-identifier hs-var">dataDefn</span></a></span><span>
</span><span id="line-2241"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">DerivInfo :: TyCon
-&gt; [(Name, TyVar)]
-&gt; [LHsDerivingClause GhcRn]
-&gt; SDoc
-&gt; DerivInfo
</span><a href="GHC.Tc.Deriv.html#DerivInfo"><span class="hs-identifier hs-type">DerivInfo</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">di_rep_tc :: TyCon
</span><a href="GHC.Tc.Deriv.html#di_rep_tc"><span class="hs-identifier hs-var">di_rep_tc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166162"><span class="hs-identifier hs-var">tycon</span></a></span><span>
</span><span id="line-2242"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">di_scoped_tvs :: [(Name, TyVar)]
</span><a href="GHC.Tc.Deriv.html#di_scoped_tvs"><span class="hs-identifier hs-var">di_scoped_tvs</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2243"></span><span>                    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isFunTyCon"><span class="hs-identifier hs-var">isFunTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166162"><span class="hs-identifier hs-var">tycon</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isPrimTyCon"><span class="hs-identifier hs-var">isPrimTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166162"><span class="hs-identifier hs-var">tycon</span></a></span><span>
</span><span id="line-2244"></span><span>                       </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- no tyConTyVars</span><span>
</span><span id="line-2245"></span><span>                       </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; [(Name, TyVar)]
</span><a href="GHC.Tc.Utils.TcType.html#mkTyVarNamePairs"><span class="hs-identifier hs-var">mkTyVarNamePairs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [TyVar]
</span><a href="GHC.Core.TyCon.html#tyConTyVars"><span class="hs-identifier hs-var hs-var">tyConTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166162"><span class="hs-identifier hs-var">tycon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2246"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">di_clauses :: [LHsDerivingClause GhcRn]
</span><a href="GHC.Tc.Deriv.html#di_clauses"><span class="hs-identifier hs-var">di_clauses</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsDeriving GhcRn -&gt; [LHsDerivingClause GhcRn]
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">HsDeriving GhcRn
</span><a href="#local-6989586621681166158"><span class="hs-identifier hs-var">derivs</span></a></span><span>
</span><span id="line-2247"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">di_ctxt :: SDoc
</span><a href="GHC.Tc.Deriv.html#di_ctxt"><span class="hs-identifier hs-var">di_ctxt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyClDecl GhcRn -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#tcMkDeclCtxt"><span class="hs-identifier hs-var">tcMkDeclCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">TyClDecl GhcRn
</span><a href="#local-6989586621681166161"><span class="hs-identifier hs-var">decl</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2248"></span><span class="annot"><a href="GHC.Tc.TyCl.html#wiredInDerivInfo"><span class="hs-identifier hs-var">wiredInDerivInfo</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TyClDecl GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2249"></span><span>
</span><span id="line-2250"></span><span>  </span><span class="hs-comment">-- &quot;type family&quot; declarations</span><span>
</span><span id="line-2251"></span><span class="annot"><a href="GHC.Tc.TyCl.html#tcTyClDecl1"><span class="hs-identifier hs-type">tcTyClDecl1</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.TyCl.Utils.html#RolesInfo"><span class="hs-identifier hs-type">RolesInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Decls.html#TyClDecl"><span class="hs-identifier hs-type">TyClDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Deriv.html#DerivInfo"><span class="hs-identifier hs-type">DerivInfo</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2252"></span><span id="tcTyClDecl1"><span class="annot"><span class="annottext">tcTyClDecl1 :: Maybe Class
-&gt; (Name -&gt; [Role])
-&gt; TyClDecl GhcRn
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (TyCon, [DerivInfo])
</span><a href="GHC.Tc.TyCl.html#tcTyClDecl1"><span class="hs-identifier hs-var hs-var">tcTyClDecl1</span></a></span></span><span> </span><span id="local-6989586621681166148"><span class="annot"><span class="annottext">Maybe Class
</span><a href="#local-6989586621681166148"><span class="hs-identifier hs-var">parent</span></a></span></span><span> </span><span id="local-6989586621681166147"><span class="annot"><span class="annottext">Name -&gt; [Role]
</span><a href="#local-6989586621681166147"><span class="hs-identifier hs-var">_roles_info</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Decls.html#FamDecl"><span class="hs-identifier hs-type">FamDecl</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcdFam :: forall pass. TyClDecl pass -&gt; FamilyDecl pass
</span><a href="GHC.Hs.Decls.html#tcdFam"><span class="hs-identifier hs-var">tcdFam</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681166146"><span class="annot"><span class="annottext">FamilyDecl GhcRn
</span><a href="#local-6989586621681166146"><span class="hs-identifier hs-var">fd</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-2253"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TyCon -&gt; (TyCon, [DerivInfo]))
-&gt; TcRn TyCon -&gt; IOEnv (Env TcGblEnv TcLclEnv) (TyCon, [DerivInfo])
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; (TyCon, [DerivInfo])
forall a. a -&gt; (a, [DerivInfo])
</span><a href="GHC.Tc.TyCl.html#noDerivInfos"><span class="hs-identifier hs-var">noDerivInfos</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn TyCon -&gt; IOEnv (Env TcGblEnv TcLclEnv) (TyCon, [DerivInfo]))
-&gt; TcRn TyCon -&gt; IOEnv (Env TcGblEnv TcLclEnv) (TyCon, [DerivInfo])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2254"></span><span>    </span><span class="annot"><span class="annottext">Maybe Class -&gt; FamilyDecl GhcRn -&gt; TcRn TyCon
</span><a href="GHC.Tc.TyCl.html#tcFamDecl1"><span class="hs-identifier hs-var">tcFamDecl1</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Class
</span><a href="#local-6989586621681166148"><span class="hs-identifier hs-var">parent</span></a></span><span> </span><span class="annot"><span class="annottext">FamilyDecl GhcRn
</span><a href="#local-6989586621681166146"><span class="hs-identifier hs-var">fd</span></a></span><span>
</span><span id="line-2255"></span><span>
</span><span id="line-2256"></span><span>  </span><span class="hs-comment">-- &quot;type&quot; synonym declaration</span><span>
</span><span id="line-2257"></span><span class="annot"><a href="GHC.Tc.TyCl.html#tcTyClDecl1"><span class="hs-identifier hs-var">tcTyClDecl1</span></a></span><span> </span><span id="local-6989586621681166144"><span class="annot"><span class="annottext">Maybe Class
</span><a href="#local-6989586621681166144"><span class="hs-identifier hs-var">_parent</span></a></span></span><span> </span><span id="local-6989586621681166143"><span class="annot"><span class="annottext">Name -&gt; [Role]
</span><a href="#local-6989586621681166143"><span class="hs-identifier hs-var">roles_info</span></a></span></span><span>
</span><span id="line-2258"></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Decls.html#SynDecl"><span class="hs-identifier hs-type">SynDecl</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcdLName :: forall pass. TyClDecl pass -&gt; Located (IdP pass)
</span><a href="GHC.Hs.Decls.html#tcdLName"><span class="hs-identifier hs-var">tcdLName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681166142"><span class="annot"><span class="annottext">IdP GhcRn
</span><a href="#local-6989586621681166142"><span class="hs-identifier hs-var">tc_name</span></a></span></span><span>
</span><span id="line-2259"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcdRhs :: forall pass. TyClDecl pass -&gt; LHsType pass
</span><a href="GHC.Hs.Decls.html#tcdRhs"><span class="hs-identifier hs-var">tcdRhs</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681166141"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621681166141"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-2260"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isNothing</span><span> </span><span class="hs-identifier">_parent</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-2261"></span><span>    </span><span class="annot"><span class="annottext">(TyCon -&gt; (TyCon, [DerivInfo]))
-&gt; TcRn TyCon -&gt; IOEnv (Env TcGblEnv TcLclEnv) (TyCon, [DerivInfo])
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; (TyCon, [DerivInfo])
forall a. a -&gt; (a, [DerivInfo])
</span><a href="GHC.Tc.TyCl.html#noDerivInfos"><span class="hs-identifier hs-var">noDerivInfos</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn TyCon -&gt; IOEnv (Env TcGblEnv TcLclEnv) (TyCon, [DerivInfo]))
-&gt; TcRn TyCon -&gt; IOEnv (Env TcGblEnv TcLclEnv) (TyCon, [DerivInfo])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2262"></span><span>    </span><span class="annot"><span class="annottext">(Name -&gt; [Role]) -&gt; Name -&gt; LHsType GhcRn -&gt; TcRn TyCon
</span><a href="GHC.Tc.TyCl.html#tcTySynRhs"><span class="hs-identifier hs-var">tcTySynRhs</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Role]
</span><a href="#local-6989586621681166143"><span class="hs-identifier hs-var">roles_info</span></a></span><span> </span><span class="annot"><span class="annottext">Name
IdP GhcRn
</span><a href="#local-6989586621681166142"><span class="hs-identifier hs-var">tc_name</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621681166141"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-2263"></span><span>
</span><span id="line-2264"></span><span>  </span><span class="hs-comment">-- &quot;data/newtype&quot; declaration</span><span>
</span><span id="line-2265"></span><span class="annot"><a href="GHC.Tc.TyCl.html#tcTyClDecl1"><span class="hs-identifier hs-var">tcTyClDecl1</span></a></span><span> </span><span id="local-6989586621681166139"><span class="annot"><span class="annottext">Maybe Class
</span><a href="#local-6989586621681166139"><span class="hs-identifier hs-var">_parent</span></a></span></span><span> </span><span id="local-6989586621681166138"><span class="annot"><span class="annottext">Name -&gt; [Role]
</span><a href="#local-6989586621681166138"><span class="hs-identifier hs-var">roles_info</span></a></span></span><span>
</span><span id="line-2266"></span><span>            </span><span id="local-6989586621681166137"><span class="annot"><span class="annottext">decl :: TyClDecl GhcRn
</span><a href="#local-6989586621681166137"><span class="hs-identifier hs-var">decl</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Decls.html#DataDecl"><span class="hs-identifier hs-type">DataDecl</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcdLName :: forall pass. TyClDecl pass -&gt; Located (IdP pass)
</span><a href="GHC.Hs.Decls.html#tcdLName"><span class="hs-identifier hs-var">tcdLName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681166136"><span class="annot"><span class="annottext">IdP GhcRn
</span><a href="#local-6989586621681166136"><span class="hs-identifier hs-var">tc_name</span></a></span></span><span>
</span><span id="line-2267"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcdDataDefn :: forall pass. TyClDecl pass -&gt; HsDataDefn pass
</span><a href="GHC.Hs.Decls.html#tcdDataDefn"><span class="hs-identifier hs-var">tcdDataDefn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681166135"><span class="annot"><span class="annottext">HsDataDefn GhcRn
</span><a href="#local-6989586621681166135"><span class="hs-identifier hs-var">defn</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-2268"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isNothing</span><span> </span><span class="hs-identifier">_parent</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-2269"></span><span>    </span><span class="annot"><span class="annottext">SDoc
-&gt; (Name -&gt; [Role])
-&gt; Name
-&gt; HsDataDefn GhcRn
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (TyCon, [DerivInfo])
</span><a href="GHC.Tc.TyCl.html#tcDataDefn"><span class="hs-identifier hs-var">tcDataDefn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyClDecl GhcRn -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#tcMkDeclCtxt"><span class="hs-identifier hs-var">tcMkDeclCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">TyClDecl GhcRn
</span><a href="#local-6989586621681166137"><span class="hs-identifier hs-var">decl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Role]
</span><a href="#local-6989586621681166138"><span class="hs-identifier hs-var">roles_info</span></a></span><span> </span><span class="annot"><span class="annottext">Name
IdP GhcRn
</span><a href="#local-6989586621681166136"><span class="hs-identifier hs-var">tc_name</span></a></span><span> </span><span class="annot"><span class="annottext">HsDataDefn GhcRn
</span><a href="#local-6989586621681166135"><span class="hs-identifier hs-var">defn</span></a></span><span>
</span><span id="line-2270"></span><span>
</span><span id="line-2271"></span><span class="annot"><a href="GHC.Tc.TyCl.html#tcTyClDecl1"><span class="hs-identifier hs-var">tcTyClDecl1</span></a></span><span> </span><span id="local-6989586621681166133"><span class="annot"><span class="annottext">Maybe Class
</span><a href="#local-6989586621681166133"><span class="hs-identifier hs-var">_parent</span></a></span></span><span> </span><span id="local-6989586621681166132"><span class="annot"><span class="annottext">Name -&gt; [Role]
</span><a href="#local-6989586621681166132"><span class="hs-identifier hs-var">roles_info</span></a></span></span><span>
</span><span id="line-2272"></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Decls.html#ClassDecl"><span class="hs-identifier hs-type">ClassDecl</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcdLName :: forall pass. TyClDecl pass -&gt; Located (IdP pass)
</span><a href="GHC.Hs.Decls.html#tcdLName"><span class="hs-identifier hs-var">tcdLName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681166131"><span class="annot"><span class="annottext">IdP GhcRn
</span><a href="#local-6989586621681166131"><span class="hs-identifier hs-var">class_name</span></a></span></span><span>
</span><span id="line-2273"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcdCtxt :: forall pass. TyClDecl pass -&gt; LHsContext pass
</span><a href="GHC.Hs.Decls.html#tcdCtxt"><span class="hs-identifier hs-var">tcdCtxt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681166130"><span class="annot"><span class="annottext">GenLocated SrcSpan (HsContext GhcRn)
</span><a href="#local-6989586621681166130"><span class="hs-identifier hs-var">hs_ctxt</span></a></span></span><span>
</span><span id="line-2274"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcdMeths :: forall pass. TyClDecl pass -&gt; LHsBinds pass
</span><a href="GHC.Hs.Decls.html#tcdMeths"><span class="hs-identifier hs-var">tcdMeths</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681166128"><span class="annot"><span class="annottext">LHsBinds GhcRn
</span><a href="#local-6989586621681166128"><span class="hs-identifier hs-var">meths</span></a></span></span><span>
</span><span id="line-2275"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcdFDs :: forall pass. TyClDecl pass -&gt; [LHsFunDep pass]
</span><a href="GHC.Hs.Decls.html#tcdFDs"><span class="hs-identifier hs-var">tcdFDs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681166126"><span class="annot"><span class="annottext">[LHsFunDep GhcRn]
</span><a href="#local-6989586621681166126"><span class="hs-identifier hs-var">fundeps</span></a></span></span><span>
</span><span id="line-2276"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcdSigs :: forall pass. TyClDecl pass -&gt; [LSig pass]
</span><a href="GHC.Hs.Decls.html#tcdSigs"><span class="hs-identifier hs-var">tcdSigs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681166125"><span class="annot"><span class="annottext">[LSig GhcRn]
</span><a href="#local-6989586621681166125"><span class="hs-identifier hs-var">sigs</span></a></span></span><span>
</span><span id="line-2277"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcdATs :: forall pass. TyClDecl pass -&gt; [LFamilyDecl pass]
</span><a href="GHC.Hs.Decls.html#tcdATs"><span class="hs-identifier hs-var">tcdATs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681166124"><span class="annot"><span class="annottext">[LFamilyDecl GhcRn]
</span><a href="#local-6989586621681166124"><span class="hs-identifier hs-var">ats</span></a></span></span><span>
</span><span id="line-2278"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcdATDefs :: forall pass. TyClDecl pass -&gt; [LTyFamDefltDecl pass]
</span><a href="GHC.Hs.Decls.html#tcdATDefs"><span class="hs-identifier hs-var">tcdATDefs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681166122"><span class="annot"><span class="annottext">[LTyFamDefltDecl GhcRn]
</span><a href="#local-6989586621681166122"><span class="hs-identifier hs-var">at_defs</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-2279"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isNothing</span><span> </span><span class="hs-identifier">_parent</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-2280"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681166121"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681166121"><span class="hs-identifier hs-var">clas</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; [Role])
-&gt; Name
-&gt; GenLocated SrcSpan (HsContext GhcRn)
-&gt; LHsBinds GhcRn
-&gt; [LHsFunDep GhcRn]
-&gt; [LSig GhcRn]
-&gt; [LFamilyDecl GhcRn]
-&gt; [LTyFamDefltDecl GhcRn]
-&gt; TcM Class
</span><a href="GHC.Tc.TyCl.html#tcClassDecl1"><span class="hs-identifier hs-var">tcClassDecl1</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Role]
</span><a href="#local-6989586621681166132"><span class="hs-identifier hs-var">roles_info</span></a></span><span> </span><span class="annot"><span class="annottext">Name
IdP GhcRn
</span><a href="#local-6989586621681166131"><span class="hs-identifier hs-var">class_name</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpan (HsContext GhcRn)
</span><a href="#local-6989586621681166130"><span class="hs-identifier hs-var">hs_ctxt</span></a></span><span>
</span><span id="line-2281"></span><span>                              </span><span class="annot"><span class="annottext">LHsBinds GhcRn
</span><a href="#local-6989586621681166128"><span class="hs-identifier hs-var">meths</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsFunDep GhcRn]
</span><a href="#local-6989586621681166126"><span class="hs-identifier hs-var">fundeps</span></a></span><span> </span><span class="annot"><span class="annottext">[LSig GhcRn]
</span><a href="#local-6989586621681166125"><span class="hs-identifier hs-var">sigs</span></a></span><span> </span><span class="annot"><span class="annottext">[LFamilyDecl GhcRn]
</span><a href="#local-6989586621681166124"><span class="hs-identifier hs-var">ats</span></a></span><span> </span><span class="annot"><span class="annottext">[LTyFamDefltDecl GhcRn]
</span><a href="#local-6989586621681166122"><span class="hs-identifier hs-var">at_defs</span></a></span><span>
</span><span id="line-2282"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(TyCon, [DerivInfo])
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (TyCon, [DerivInfo])
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; (TyCon, [DerivInfo])
forall a. a -&gt; (a, [DerivInfo])
</span><a href="GHC.Tc.TyCl.html#noDerivInfos"><span class="hs-identifier hs-var">noDerivInfos</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; TyCon
</span><a href="GHC.Core.Class.html#classTyCon"><span class="hs-identifier hs-var hs-var">classTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681166121"><span class="hs-identifier hs-var">clas</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2283"></span><span>
</span><span id="line-2284"></span><span>
</span><span id="line-2285"></span><span class="hs-comment">{- *********************************************************************
*                                                                      *
          Class declarations
*                                                                      *
********************************************************************* -}</span><span>
</span><span id="line-2290"></span><span>
</span><span id="line-2291"></span><span class="annot"><a href="GHC.Tc.TyCl.html#tcClassDecl1"><span class="hs-identifier hs-type">tcClassDecl1</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.TyCl.Utils.html#RolesInfo"><span class="hs-identifier hs-type">RolesInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Type.html#LHsContext"><span class="hs-identifier hs-type">LHsContext</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-2292"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Binds.html#LHsBinds"><span class="hs-identifier hs-type">LHsBinds</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Hs.Decls.html#LHsFunDep"><span class="hs-identifier hs-type">LHsFunDep</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Hs.Binds.html#LSig"><span class="hs-identifier hs-type">LSig</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2293"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Hs.Decls.html#LFamilyDecl"><span class="hs-identifier hs-type">LFamilyDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Hs.Decls.html#LTyFamDefltDecl"><span class="hs-identifier hs-type">LTyFamDefltDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2294"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span>
</span><span id="line-2295"></span><span id="tcClassDecl1"><span class="annot"><span class="annottext">tcClassDecl1 :: (Name -&gt; [Role])
-&gt; Name
-&gt; GenLocated SrcSpan (HsContext GhcRn)
-&gt; LHsBinds GhcRn
-&gt; [LHsFunDep GhcRn]
-&gt; [LSig GhcRn]
-&gt; [LFamilyDecl GhcRn]
-&gt; [LTyFamDefltDecl GhcRn]
-&gt; TcM Class
</span><a href="GHC.Tc.TyCl.html#tcClassDecl1"><span class="hs-identifier hs-var hs-var">tcClassDecl1</span></a></span></span><span> </span><span id="local-6989586621681166118"><span class="annot"><span class="annottext">Name -&gt; [Role]
</span><a href="#local-6989586621681166118"><span class="hs-identifier hs-var">roles_info</span></a></span></span><span> </span><span id="local-6989586621681166117"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681166117"><span class="hs-identifier hs-var">class_name</span></a></span></span><span> </span><span id="local-6989586621681166116"><span class="annot"><span class="annottext">GenLocated SrcSpan (HsContext GhcRn)
</span><a href="#local-6989586621681166116"><span class="hs-identifier hs-var">hs_ctxt</span></a></span></span><span> </span><span id="local-6989586621681166115"><span class="annot"><span class="annottext">LHsBinds GhcRn
</span><a href="#local-6989586621681166115"><span class="hs-identifier hs-var">meths</span></a></span></span><span> </span><span id="local-6989586621681166114"><span class="annot"><span class="annottext">[LHsFunDep GhcRn]
</span><a href="#local-6989586621681166114"><span class="hs-identifier hs-var">fundeps</span></a></span></span><span> </span><span id="local-6989586621681166113"><span class="annot"><span class="annottext">[LSig GhcRn]
</span><a href="#local-6989586621681166113"><span class="hs-identifier hs-var">sigs</span></a></span></span><span> </span><span id="local-6989586621681166112"><span class="annot"><span class="annottext">[LFamilyDecl GhcRn]
</span><a href="#local-6989586621681166112"><span class="hs-identifier hs-var">ats</span></a></span></span><span> </span><span id="local-6989586621681166111"><span class="annot"><span class="annottext">[LTyFamDefltDecl GhcRn]
</span><a href="#local-6989586621681166111"><span class="hs-identifier hs-var">at_defs</span></a></span></span><span>
</span><span id="line-2296"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Class -&gt; TcM Class) -&gt; TcM Class
forall a env. (a -&gt; IOEnv env a) -&gt; IOEnv env a
</span><a href="GHC.Data.IOEnv.html#fixM"><span class="hs-identifier hs-var">fixM</span></a></span><span> </span><span class="annot"><span class="annottext">((Class -&gt; TcM Class) -&gt; TcM Class)
-&gt; (Class -&gt; TcM Class) -&gt; TcM Class
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681166110"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681166110"><span class="hs-identifier hs-var">clas</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2297"></span><span>    </span><span class="hs-comment">-- We need the knot because 'clas' is passed into tcClassATs</span><span>
</span><span id="line-2298"></span><span>    </span><span class="annot"><span class="annottext">Name -&gt; (TyCon -&gt; [TyConBinder] -&gt; Type -&gt; TcM Class) -&gt; TcM Class
forall a.
Name -&gt; (TyCon -&gt; [TyConBinder] -&gt; Type -&gt; TcM a) -&gt; TcM a
</span><a href="GHC.Tc.Gen.HsType.html#bindTyClTyVars"><span class="hs-identifier hs-var">bindTyClTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681166117"><span class="hs-identifier hs-var">class_name</span></a></span><span> </span><span class="annot"><span class="annottext">((TyCon -&gt; [TyConBinder] -&gt; Type -&gt; TcM Class) -&gt; TcM Class)
-&gt; (TyCon -&gt; [TyConBinder] -&gt; Type -&gt; TcM Class) -&gt; TcM Class
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681166109"><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621681166109"><span class="hs-identifier hs-var">binders</span></a></span></span><span> </span><span id="local-6989586621681166108"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681166108"><span class="hs-identifier hs-var">res_kind</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2299"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcRn ()
</span><a href="GHC.Tc.Gen.HsType.html#checkClassKindSig"><span class="hs-identifier hs-var">checkClassKindSig</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681166108"><span class="hs-identifier hs-var">res_kind</span></a></span><span>
</span><span id="line-2300"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcClassDecl 1&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681166117"><span class="hs-identifier hs-var">class_name</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">[TyConBinder] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621681166109"><span class="hs-identifier hs-var">binders</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2301"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681166106"><span class="annot"><span class="annottext">tycon_name :: Name
</span><a href="#local-6989586621681166106"><span class="hs-identifier hs-var hs-var">tycon_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681166117"><span class="hs-identifier hs-var">class_name</span></a></span><span>        </span><span class="hs-comment">-- We use the same name</span><span>
</span><span id="line-2302"></span><span>             </span><span id="local-6989586621681166105"><span class="annot"><span class="annottext">roles :: [Role]
</span><a href="#local-6989586621681166105"><span class="hs-identifier hs-var hs-var">roles</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Role]
</span><a href="#local-6989586621681166118"><span class="hs-identifier hs-var">roles_info</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681166106"><span class="hs-identifier hs-var">tycon_name</span></a></span><span>  </span><span class="hs-comment">-- for TyCon and Class</span><span>
</span><span id="line-2303"></span><span>
</span><span id="line-2304"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681166104"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681166104"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681166103"><span class="annot"><span class="annottext">[([TyVar], [TyVar])]
</span><a href="#local-6989586621681166103"><span class="hs-identifier hs-var">fds</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681166102"><span class="annot"><span class="annottext">[TcMethInfo]
</span><a href="#local-6989586621681166102"><span class="hs-identifier hs-var">sig_stuff</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681166101"><span class="annot"><span class="annottext">[ClassATItem]
</span><a href="#local-6989586621681166101"><span class="hs-identifier hs-var">at_stuff</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2305"></span><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM ([Type], [([TyVar], [TyVar])], [TcMethInfo], [ClassATItem])
-&gt; TcM ([Type], [([TyVar], [TyVar])], [TcMethInfo], [ClassATItem])
forall r. TcM r -&gt; TcM r
</span><a href="GHC.Tc.Utils.Monad.html#pushTcLevelM_"><span class="hs-identifier hs-var">pushTcLevelM_</span></a></span><span>   </span><span class="annot"><span class="annottext">(TcM ([Type], [([TyVar], [TyVar])], [TcMethInfo], [ClassATItem])
 -&gt; TcM ([Type], [([TyVar], [TyVar])], [TcMethInfo], [ClassATItem]))
-&gt; TcM ([Type], [([TyVar], [TyVar])], [TcMethInfo], [ClassATItem])
-&gt; TcM ([Type], [([TyVar], [TyVar])], [TcMethInfo], [ClassATItem])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2306"></span><span>               </span><span class="annot"><span class="annottext">TcM ([Type], [([TyVar], [TyVar])], [TcMethInfo], [ClassATItem])
-&gt; TcM ([Type], [([TyVar], [TyVar])], [TcMethInfo], [ClassATItem])
forall r. TcM r -&gt; TcM r
</span><a href="GHC.Tc.Solver.html#solveEqualities"><span class="hs-identifier hs-var">solveEqualities</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM ([Type], [([TyVar], [TyVar])], [TcMethInfo], [ClassATItem])
 -&gt; TcM ([Type], [([TyVar], [TyVar])], [TcMethInfo], [ClassATItem]))
-&gt; TcM ([Type], [([TyVar], [TyVar])], [TcMethInfo], [ClassATItem])
-&gt; TcM ([Type], [([TyVar], [TyVar])], [TcMethInfo], [ClassATItem])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2307"></span><span>               </span><span class="annot"><span class="annottext">SkolemInfo
-&gt; [TyVar]
-&gt; TcM ([Type], [([TyVar], [TyVar])], [TcMethInfo], [ClassATItem])
-&gt; TcM ([Type], [([TyVar], [TyVar])], [TcMethInfo], [ClassATItem])
forall result. SkolemInfo -&gt; [TyVar] -&gt; TcM result -&gt; TcM result
</span><a href="GHC.Tc.Utils.Unify.html#checkTvConstraints"><span class="hs-identifier hs-var">checkTvConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">SkolemInfo
</span><a href="#local-6989586621681166100"><span class="hs-identifier hs-var">skol_info</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyConBinder] -&gt; [TyVar]
forall tv argf. [VarBndr tv argf] -&gt; [tv]
</span><a href="GHC.Types.Var.html#binderVars"><span class="hs-identifier hs-var">binderVars</span></a></span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621681166109"><span class="hs-identifier hs-var">binders</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM ([Type], [([TyVar], [TyVar])], [TcMethInfo], [ClassATItem])
 -&gt; TcM ([Type], [([TyVar], [TyVar])], [TcMethInfo], [ClassATItem]))
-&gt; TcM ([Type], [([TyVar], [TyVar])], [TcMethInfo], [ClassATItem])
-&gt; TcM ([Type], [([TyVar], [TyVar])], [TcMethInfo], [ClassATItem])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2308"></span><span>               </span><span class="hs-comment">-- The checkTvConstraints is needed bring into scope the</span><span>
</span><span id="line-2309"></span><span>               </span><span class="hs-comment">-- skolems bound by the class decl header (#17841)</span><span>
</span><span id="line-2310"></span><span>               </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681166098"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681166098"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpan (HsContext GhcRn) -&gt; TcM [Type]
</span><a href="GHC.Tc.Gen.HsType.html#tcHsContext"><span class="hs-identifier hs-var">tcHsContext</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpan (HsContext GhcRn)
</span><a href="#local-6989586621681166116"><span class="hs-identifier hs-var">hs_ctxt</span></a></span><span>
</span><span id="line-2311"></span><span>                  </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681166097"><span class="annot"><span class="annottext">[([TyVar], [TyVar])]
</span><a href="#local-6989586621681166097"><span class="hs-identifier hs-var">fds</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Located (FunDep (Located Name))
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) ([TyVar], [TyVar]))
-&gt; [Located (FunDep (Located Name))]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [([TyVar], [TyVar])]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(FunDep (Located Name)
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) ([TyVar], [TyVar]))
-&gt; Located (FunDep (Located Name))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ([TyVar], [TyVar])
forall a b. (a -&gt; TcM b) -&gt; Located a -&gt; TcM b
</span><a href="GHC.Tc.Utils.Monad.html#addLocM"><span class="hs-identifier hs-var">addLocM</span></a></span><span> </span><span class="annot"><span class="annottext">FunDep (Located Name)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ([TyVar], [TyVar])
forall {t :: * -&gt; *} {t :: * -&gt; *} {l} {l}.
(Traversable t, Traversable t) =&gt;
(t (GenLocated l Name), t (GenLocated l Name))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (t TyVar, t TyVar)
</span><a href="#local-6989586621681166096"><span class="hs-identifier hs-var">tc_fundep</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Located (FunDep (Located Name))]
[LHsFunDep GhcRn]
</span><a href="#local-6989586621681166114"><span class="hs-identifier hs-var">fundeps</span></a></span><span>
</span><span id="line-2312"></span><span>                  </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681166095"><span class="annot"><span class="annottext">[TcMethInfo]
</span><a href="#local-6989586621681166095"><span class="hs-identifier hs-var">sig_stuff</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [LSig GhcRn] -&gt; LHsBinds GhcRn -&gt; TcM [TcMethInfo]
</span><a href="GHC.Tc.TyCl.Class.html#tcClassSigs"><span class="hs-identifier hs-var">tcClassSigs</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681166117"><span class="hs-identifier hs-var">class_name</span></a></span><span> </span><span class="annot"><span class="annottext">[LSig GhcRn]
</span><a href="#local-6989586621681166113"><span class="hs-identifier hs-var">sigs</span></a></span><span> </span><span class="annot"><span class="annottext">LHsBinds GhcRn
</span><a href="#local-6989586621681166115"><span class="hs-identifier hs-var">meths</span></a></span><span>
</span><span id="line-2313"></span><span>                  </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681166093"><span class="annot"><span class="annottext">[ClassATItem]
</span><a href="#local-6989586621681166093"><span class="hs-identifier hs-var">at_stuff</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name
-&gt; Class
-&gt; [LFamilyDecl GhcRn]
-&gt; [LTyFamDefltDecl GhcRn]
-&gt; TcM [ClassATItem]
</span><a href="GHC.Tc.TyCl.html#tcClassATs"><span class="hs-identifier hs-var">tcClassATs</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681166117"><span class="hs-identifier hs-var">class_name</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681166110"><span class="hs-identifier hs-var">clas</span></a></span><span> </span><span class="annot"><span class="annottext">[LFamilyDecl GhcRn]
</span><a href="#local-6989586621681166112"><span class="hs-identifier hs-var">ats</span></a></span><span> </span><span class="annot"><span class="annottext">[LTyFamDefltDecl GhcRn]
</span><a href="#local-6989586621681166111"><span class="hs-identifier hs-var">at_defs</span></a></span><span>
</span><span id="line-2314"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">([Type], [([TyVar], [TyVar])], [TcMethInfo], [ClassATItem])
-&gt; TcM ([Type], [([TyVar], [TyVar])], [TcMethInfo], [ClassATItem])
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681166098"><span class="hs-identifier hs-var">ctxt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[([TyVar], [TyVar])]
</span><a href="#local-6989586621681166097"><span class="hs-identifier hs-var">fds</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TcMethInfo]
</span><a href="#local-6989586621681166095"><span class="hs-identifier hs-var">sig_stuff</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ClassATItem]
</span><a href="#local-6989586621681166093"><span class="hs-identifier hs-var">at_stuff</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2315"></span><span>
</span><span id="line-2316"></span><span>       </span><span class="hs-comment">-- The solveEqualities will report errors for any</span><span>
</span><span id="line-2317"></span><span>       </span><span class="hs-comment">-- unsolved equalities, so these zonks should not encounter</span><span>
</span><span id="line-2318"></span><span>       </span><span class="hs-comment">-- any unfilled coercion variables unless there is such an error</span><span>
</span><span id="line-2319"></span><span>       </span><span class="hs-comment">-- The zonk also squeeze out the TcTyCons, and converts</span><span>
</span><span id="line-2320"></span><span>       </span><span class="hs-comment">-- Skolems to tyvars.</span><span>
</span><span id="line-2321"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681166091"><span class="annot"><span class="annottext">ZonkEnv
</span><a href="#local-6989586621681166091"><span class="hs-identifier hs-var">ze</span></a></span></span><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM ZonkEnv
</span><a href="GHC.Tc.Utils.Zonk.html#emptyZonkEnv"><span class="hs-identifier hs-var">emptyZonkEnv</span></a></span><span>
</span><span id="line-2322"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681166090"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681166090"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ZonkEnv -&gt; [Type] -&gt; TcM [Type]
</span><a href="GHC.Tc.Utils.Zonk.html#zonkTcTypesToTypesX"><span class="hs-identifier hs-var">zonkTcTypesToTypesX</span></a></span><span> </span><span class="annot"><span class="annottext">ZonkEnv
</span><a href="#local-6989586621681166091"><span class="hs-identifier hs-var">ze</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681166104"><span class="hs-identifier hs-var">ctxt</span></a></span><span>
</span><span id="line-2323"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681166088"><span class="annot"><span class="annottext">[TcMethInfo]
</span><a href="#local-6989586621681166088"><span class="hs-identifier hs-var">sig_stuff</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TcMethInfo -&gt; IOEnv (Env TcGblEnv TcLclEnv) TcMethInfo)
-&gt; [TcMethInfo] -&gt; TcM [TcMethInfo]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ZonkEnv -&gt; TcMethInfo -&gt; IOEnv (Env TcGblEnv TcLclEnv) TcMethInfo
</span><a href="GHC.Tc.Utils.Zonk.html#zonkTcMethInfoToMethInfoX"><span class="hs-identifier hs-var">zonkTcMethInfoToMethInfoX</span></a></span><span> </span><span class="annot"><span class="annottext">ZonkEnv
</span><a href="#local-6989586621681166091"><span class="hs-identifier hs-var">ze</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TcMethInfo]
</span><a href="#local-6989586621681166102"><span class="hs-identifier hs-var">sig_stuff</span></a></span><span>
</span><span id="line-2324"></span><span>         </span><span class="hs-comment">-- ToDo: do we need to zonk at_stuff?</span><span>
</span><span id="line-2325"></span><span>
</span><span id="line-2326"></span><span>       </span><span class="hs-comment">-- TODO: Allow us to distinguish between abstract class,</span><span>
</span><span id="line-2327"></span><span>       </span><span class="hs-comment">-- and concrete class with no methods (maybe by</span><span>
</span><span id="line-2328"></span><span>       </span><span class="hs-comment">-- specifying a trailing where or not</span><span>
</span><span id="line-2329"></span><span>
</span><span id="line-2330"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681166086"><span class="annot"><span class="annottext">ClassMinimalDef
</span><a href="#local-6989586621681166086"><span class="hs-identifier hs-var">mindef</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [LSig GhcRn] -&gt; [TcMethInfo] -&gt; TcM ClassMinimalDef
</span><a href="GHC.Tc.TyCl.Class.html#tcClassMinimalDef"><span class="hs-identifier hs-var">tcClassMinimalDef</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681166117"><span class="hs-identifier hs-var">class_name</span></a></span><span> </span><span class="annot"><span class="annottext">[LSig GhcRn]
</span><a href="#local-6989586621681166113"><span class="hs-identifier hs-var">sigs</span></a></span><span> </span><span class="annot"><span class="annottext">[TcMethInfo]
</span><a href="#local-6989586621681166088"><span class="hs-identifier hs-var">sig_stuff</span></a></span><span>
</span><span id="line-2331"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681166084"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681166084"><span class="hs-identifier hs-var">is_boot</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv Bool
</span><a href="GHC.Tc.Utils.Monad.html#tcIsHsBootOrSig"><span class="hs-identifier hs-var">tcIsHsBootOrSig</span></a></span><span>
</span><span id="line-2332"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681166082"><span class="annot"><span class="annottext">body :: Maybe ([Type], [ClassATItem], [TcMethInfo], ClassMinimalDef)
</span><a href="#local-6989586621681166082"><span class="hs-identifier hs-var hs-var">body</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681166084"><span class="hs-identifier hs-var">is_boot</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681166090"><span class="hs-identifier hs-var">ctxt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ClassATItem] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[ClassATItem]
</span><a href="#local-6989586621681166101"><span class="hs-identifier hs-var">at_stuff</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TcMethInfo] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[TcMethInfo]
</span><a href="#local-6989586621681166088"><span class="hs-identifier hs-var">sig_stuff</span></a></span><span>
</span><span id="line-2333"></span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe ([Type], [ClassATItem], [TcMethInfo], ClassMinimalDef)
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-2334"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-2335"></span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Type], [ClassATItem], [TcMethInfo], ClassMinimalDef)
-&gt; Maybe ([Type], [ClassATItem], [TcMethInfo], ClassMinimalDef)
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681166090"><span class="hs-identifier hs-var">ctxt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ClassATItem]
</span><a href="#local-6989586621681166101"><span class="hs-identifier hs-var">at_stuff</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TcMethInfo]
</span><a href="#local-6989586621681166088"><span class="hs-identifier hs-var">sig_stuff</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ClassMinimalDef
</span><a href="#local-6989586621681166086"><span class="hs-identifier hs-var">mindef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2336"></span><span>
</span><span id="line-2337"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681166081"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681166081"><span class="hs-identifier hs-var">clas</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name
-&gt; [TyConBinder]
-&gt; [Role]
-&gt; [([TyVar], [TyVar])]
-&gt; Maybe ([Type], [ClassATItem], [TcMethInfo], ClassMinimalDef)
-&gt; TcM Class
forall m n.
Name
-&gt; [TyConBinder]
-&gt; [Role]
-&gt; [([TyVar], [TyVar])]
-&gt; Maybe ([Type], [ClassATItem], [TcMethInfo], ClassMinimalDef)
-&gt; TcRnIf m n Class
</span><a href="GHC.Tc.TyCl.Build.html#buildClass"><span class="hs-identifier hs-var">buildClass</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681166117"><span class="hs-identifier hs-var">class_name</span></a></span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621681166109"><span class="hs-identifier hs-var">binders</span></a></span><span> </span><span class="annot"><span class="annottext">[Role]
</span><a href="#local-6989586621681166105"><span class="hs-identifier hs-var">roles</span></a></span><span> </span><span class="annot"><span class="annottext">[([TyVar], [TyVar])]
</span><a href="#local-6989586621681166103"><span class="hs-identifier hs-var">fds</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ([Type], [ClassATItem], [TcMethInfo], ClassMinimalDef)
</span><a href="#local-6989586621681166082"><span class="hs-identifier hs-var">body</span></a></span><span>
</span><span id="line-2338"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcClassDecl&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Located (FunDep (Located Name))] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Located (FunDep (Located Name))]
[LHsFunDep GhcRn]
</span><a href="#local-6989586621681166114"><span class="hs-identifier hs-var">fundeps</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">[TyConBinder] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621681166109"><span class="hs-identifier hs-var">binders</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-2339"></span><span>                                </span><span class="annot"><span class="annottext">[([TyVar], [TyVar])] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[([TyVar], [TyVar])]
</span><a href="#local-6989586621681166103"><span class="hs-identifier hs-var">fds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2340"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Class -&gt; TcM Class
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681166081"><span class="hs-identifier hs-var">clas</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2341"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2342"></span><span>    </span><span id="local-6989586621681166100"><span class="annot"><span class="annottext">skol_info :: SkolemInfo
</span><a href="#local-6989586621681166100"><span class="hs-identifier hs-var hs-var">skol_info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyConFlavour -&gt; Name -&gt; SkolemInfo
</span><a href="GHC.Tc.Types.Origin.html#TyConSkol"><span class="hs-identifier hs-var">TyConSkol</span></a></span><span> </span><span class="annot"><span class="annottext">TyConFlavour
</span><a href="GHC.Core.TyCon.html#ClassFlavour"><span class="hs-identifier hs-var">ClassFlavour</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681166117"><span class="hs-identifier hs-var">class_name</span></a></span><span>
</span><span id="line-2343"></span><span>    </span><span id="local-6989586621681166096"><span class="annot"><span class="annottext">tc_fundep :: (t (GenLocated l Name), t (GenLocated l Name))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (t TyVar, t TyVar)
</span><a href="#local-6989586621681166096"><span class="hs-identifier hs-var hs-var">tc_fundep</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681166070"><span class="annot"><span class="annottext">t (GenLocated l Name)
</span><a href="#local-6989586621681166070"><span class="hs-identifier hs-var">tvs1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681166069"><span class="annot"><span class="annottext">t (GenLocated l Name)
</span><a href="#local-6989586621681166069"><span class="hs-identifier hs-var">tvs2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681166068"><span class="annot"><span class="annottext">t TyVar
</span><a href="#local-6989586621681166068"><span class="hs-identifier hs-var">tvs1'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(GenLocated l Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) TyVar)
-&gt; t (GenLocated l Name) -&gt; IOEnv (Env TcGblEnv TcLclEnv) (t TyVar)
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) TyVar
</span><a href="GHC.Tc.Utils.Env.html#tcLookupTyVar"><span class="hs-identifier hs-var">tcLookupTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) TyVar)
-&gt; (GenLocated l Name -&gt; Name)
-&gt; GenLocated l Name
-&gt; IOEnv (Env TcGblEnv TcLclEnv) TyVar
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated l Name -&gt; Name
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">t (GenLocated l Name)
</span><a href="#local-6989586621681166070"><span class="hs-identifier hs-var">tvs1</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-2344"></span><span>                                </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681166066"><span class="annot"><span class="annottext">t TyVar
</span><a href="#local-6989586621681166066"><span class="hs-identifier hs-var">tvs2'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(GenLocated l Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) TyVar)
-&gt; t (GenLocated l Name) -&gt; IOEnv (Env TcGblEnv TcLclEnv) (t TyVar)
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) TyVar
</span><a href="GHC.Tc.Utils.Env.html#tcLookupTyVar"><span class="hs-identifier hs-var">tcLookupTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) TyVar)
-&gt; (GenLocated l Name -&gt; Name)
-&gt; GenLocated l Name
-&gt; IOEnv (Env TcGblEnv TcLclEnv) TyVar
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated l Name -&gt; Name
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">t (GenLocated l Name)
</span><a href="#local-6989586621681166069"><span class="hs-identifier hs-var">tvs2</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-2345"></span><span>                                </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(t TyVar, t TyVar)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (t TyVar, t TyVar)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t TyVar
</span><a href="#local-6989586621681166068"><span class="hs-identifier hs-var">tvs1'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">t TyVar
</span><a href="#local-6989586621681166066"><span class="hs-identifier hs-var">tvs2'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2346"></span><span>
</span><span id="line-2347"></span><span>
</span><span id="line-2348"></span><span class="hs-comment">{- Note [Associated type defaults]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The following is an example of associated type defaults:
             class C a where
               data D a

               type F a b :: *
               type F a b = [a]        -- Default

Note that we can get default definitions only for type families, not data
families.
-}</span><span>
</span><span id="line-2361"></span><span>
</span><span id="line-2362"></span><span class="annot"><a href="GHC.Tc.TyCl.html#tcClassATs"><span class="hs-identifier hs-type">tcClassATs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>                    </span><span class="hs-comment">-- The class name (not knot-tied)</span><span>
</span><span id="line-2363"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span>                   </span><span class="hs-comment">-- The class parent of this associated type</span><span>
</span><span id="line-2364"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Hs.Decls.html#LFamilyDecl"><span class="hs-identifier hs-type">LFamilyDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span>     </span><span class="hs-comment">-- Associated types.</span><span>
</span><span id="line-2365"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Hs.Decls.html#LTyFamDefltDecl"><span class="hs-identifier hs-type">LTyFamDefltDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- Associated type defaults.</span><span>
</span><span id="line-2366"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.Class.html#ClassATItem"><span class="hs-identifier hs-type">ClassATItem</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2367"></span><span id="tcClassATs"><span class="annot"><span class="annottext">tcClassATs :: Name
-&gt; Class
-&gt; [LFamilyDecl GhcRn]
-&gt; [LTyFamDefltDecl GhcRn]
-&gt; TcM [ClassATItem]
</span><a href="GHC.Tc.TyCl.html#tcClassATs"><span class="hs-identifier hs-var hs-var">tcClassATs</span></a></span></span><span> </span><span id="local-6989586621681166065"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681166065"><span class="hs-identifier hs-var">class_name</span></a></span></span><span> </span><span id="local-6989586621681166064"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681166064"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span id="local-6989586621681166063"><span class="annot"><span class="annottext">[LFamilyDecl GhcRn]
</span><a href="#local-6989586621681166063"><span class="hs-identifier hs-var">ats</span></a></span></span><span> </span><span id="local-6989586621681166062"><span class="annot"><span class="annottext">[LTyFamDefltDecl GhcRn]
</span><a href="#local-6989586621681166062"><span class="hs-identifier hs-var">at_defs</span></a></span></span><span>
</span><span id="line-2368"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>  </span><span class="hs-comment">-- Complain about associated type defaults for non associated-types</span><span>
</span><span id="line-2369"></span><span>         </span><span class="annot"><span class="annottext">[IOEnv (Env TcGblEnv TcLclEnv) Any] -&gt; TcRn ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Foldable t, Monad m) =&gt;
t (m a) -&gt; m ()
</span><a href="../../base/src/Data.Foldable.html#sequence_"><span class="hs-identifier hs-var">sequence_</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) Any
forall a. SDoc -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; SDoc
</span><a href="GHC.Tc.Validity.html#badATErr"><span class="hs-identifier hs-var">badATErr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681166065"><span class="hs-identifier hs-var">class_name</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681166058"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2370"></span><span>                   </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681166058"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681166058"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(LTyFamDefltDecl GhcRn -&gt; Name)
-&gt; [LTyFamDefltDecl GhcRn] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">LTyFamDefltDecl GhcRn -&gt; Name
</span><a href="#local-6989586621681166057"><span class="hs-identifier hs-var">at_def_tycon</span></a></span><span> </span><span class="annot"><span class="annottext">[LTyFamDefltDecl GhcRn]
</span><a href="#local-6989586621681166062"><span class="hs-identifier hs-var">at_defs</span></a></span><span>
</span><span id="line-2371"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681166058"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; NameSet -&gt; Bool
</span><a href="GHC.Types.Name.Set.html#elemNameSet"><span class="hs-operator hs-var">`elemNameSet`</span></a></span><span> </span><span class="annot"><span class="annottext">NameSet
</span><a href="#local-6989586621681166055"><span class="hs-identifier hs-var">at_names</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2372"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(LFamilyDecl GhcRn -&gt; IOEnv (Env TcGblEnv TcLclEnv) ClassATItem)
-&gt; [LFamilyDecl GhcRn] -&gt; TcM [ClassATItem]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">LFamilyDecl GhcRn -&gt; IOEnv (Env TcGblEnv TcLclEnv) ClassATItem
</span><a href="#local-6989586621681166054"><span class="hs-identifier hs-var">tc_at</span></a></span><span> </span><span class="annot"><span class="annottext">[LFamilyDecl GhcRn]
</span><a href="#local-6989586621681166063"><span class="hs-identifier hs-var">ats</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2373"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2374"></span><span>    </span><span class="annot"><a href="#local-6989586621681166057"><span class="hs-identifier hs-type">at_def_tycon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Decls.html#LTyFamDefltDecl"><span class="hs-identifier hs-type">LTyFamDefltDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-2375"></span><span>    </span><span id="local-6989586621681166057"><span class="annot"><span class="annottext">at_def_tycon :: LTyFamDefltDecl GhcRn -&gt; Name
</span><a href="#local-6989586621681166057"><span class="hs-identifier hs-var hs-var">at_def_tycon</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyFamInstDecl GhcRn -&gt; Name
forall (p :: Pass). TyFamInstDecl (GhcPass p) -&gt; IdP (GhcPass p)
</span><a href="GHC.Hs.Decls.html#tyFamInstDeclName"><span class="hs-identifier hs-var">tyFamInstDeclName</span></a></span><span> </span><span class="annot"><span class="annottext">(TyFamInstDecl GhcRn -&gt; Name)
-&gt; (LTyFamDefltDecl GhcRn -&gt; TyFamInstDecl GhcRn)
-&gt; LTyFamDefltDecl GhcRn
-&gt; Name
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">LTyFamDefltDecl GhcRn -&gt; TyFamInstDecl GhcRn
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span>
</span><span id="line-2376"></span><span>
</span><span id="line-2377"></span><span>    </span><span class="annot"><a href="#local-6989586621681166052"><span class="hs-identifier hs-type">at_fam_name</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Decls.html#LFamilyDecl"><span class="hs-identifier hs-type">LFamilyDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-2378"></span><span>    </span><span id="local-6989586621681166052"><span class="annot"><span class="annottext">at_fam_name :: LFamilyDecl GhcRn -&gt; Name
</span><a href="#local-6989586621681166052"><span class="hs-identifier hs-var hs-var">at_fam_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FamilyDecl GhcRn -&gt; Name
forall (p :: Pass). FamilyDecl (GhcPass p) -&gt; IdP (GhcPass p)
</span><a href="GHC.Hs.Decls.html#familyDeclName"><span class="hs-identifier hs-var">familyDeclName</span></a></span><span> </span><span class="annot"><span class="annottext">(FamilyDecl GhcRn -&gt; Name)
-&gt; (LFamilyDecl GhcRn -&gt; FamilyDecl GhcRn)
-&gt; LFamilyDecl GhcRn
-&gt; Name
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">LFamilyDecl GhcRn -&gt; FamilyDecl GhcRn
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span>
</span><span id="line-2379"></span><span>
</span><span id="line-2380"></span><span>    </span><span id="local-6989586621681166055"><span class="annot"><span class="annottext">at_names :: NameSet
</span><a href="#local-6989586621681166055"><span class="hs-identifier hs-var hs-var">at_names</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; NameSet
</span><a href="GHC.Types.Name.Set.html#mkNameSet"><span class="hs-identifier hs-var">mkNameSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(LFamilyDecl GhcRn -&gt; Name) -&gt; [LFamilyDecl GhcRn] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">LFamilyDecl GhcRn -&gt; Name
</span><a href="#local-6989586621681166052"><span class="hs-identifier hs-var">at_fam_name</span></a></span><span> </span><span class="annot"><span class="annottext">[LFamilyDecl GhcRn]
</span><a href="#local-6989586621681166063"><span class="hs-identifier hs-var">ats</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2381"></span><span>
</span><span id="line-2382"></span><span>    </span><span class="annot"><a href="#local-6989586621681166050"><span class="hs-identifier hs-type">at_defs_map</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Env.html#NameEnv"><span class="hs-identifier hs-type">NameEnv</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Hs.Decls.html#LTyFamDefltDecl"><span class="hs-identifier hs-type">LTyFamDefltDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2383"></span><span>    </span><span class="hs-comment">-- Maps an AT in 'ats' to a list of all its default defs in 'at_defs'</span><span>
</span><span id="line-2384"></span><span>    </span><span id="local-6989586621681166050"><span class="annot"><span class="annottext">at_defs_map :: NameEnv [LTyFamDefltDecl GhcRn]
</span><a href="#local-6989586621681166050"><span class="hs-identifier hs-var hs-var">at_defs_map</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LTyFamDefltDecl GhcRn
 -&gt; NameEnv [LTyFamDefltDecl GhcRn]
 -&gt; NameEnv [LTyFamDefltDecl GhcRn])
-&gt; NameEnv [LTyFamDefltDecl GhcRn]
-&gt; [LTyFamDefltDecl GhcRn]
-&gt; NameEnv [LTyFamDefltDecl GhcRn]
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681166049"><span class="annot"><span class="annottext">LTyFamDefltDecl GhcRn
</span><a href="#local-6989586621681166049"><span class="hs-identifier hs-var">at_def</span></a></span></span><span> </span><span id="local-6989586621681166048"><span class="annot"><span class="annottext">NameEnv [LTyFamDefltDecl GhcRn]
</span><a href="#local-6989586621681166048"><span class="hs-identifier hs-var">nenv</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">([LTyFamDefltDecl GhcRn]
 -&gt; [LTyFamDefltDecl GhcRn] -&gt; [LTyFamDefltDecl GhcRn])
-&gt; NameEnv [LTyFamDefltDecl GhcRn]
-&gt; Name
-&gt; [LTyFamDefltDecl GhcRn]
-&gt; NameEnv [LTyFamDefltDecl GhcRn]
forall a. (a -&gt; a -&gt; a) -&gt; NameEnv a -&gt; Name -&gt; a -&gt; NameEnv a
</span><a href="GHC.Types.Name.Env.html#extendNameEnv_C"><span class="hs-identifier hs-var">extendNameEnv_C</span></a></span><span> </span><span class="annot"><span class="annottext">[LTyFamDefltDecl GhcRn]
-&gt; [LTyFamDefltDecl GhcRn] -&gt; [LTyFamDefltDecl GhcRn]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">(++)</span></a></span><span> </span><span class="annot"><span class="annottext">NameEnv [LTyFamDefltDecl GhcRn]
</span><a href="#local-6989586621681166048"><span class="hs-identifier hs-var">nenv</span></a></span><span>
</span><span id="line-2385"></span><span>                                          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LTyFamDefltDecl GhcRn -&gt; Name
</span><a href="#local-6989586621681166057"><span class="hs-identifier hs-var">at_def_tycon</span></a></span><span> </span><span class="annot"><span class="annottext">LTyFamDefltDecl GhcRn
</span><a href="#local-6989586621681166049"><span class="hs-identifier hs-var">at_def</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">LTyFamDefltDecl GhcRn
</span><a href="#local-6989586621681166049"><span class="hs-identifier hs-var">at_def</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2386"></span><span>                        </span><span class="annot"><span class="annottext">NameEnv [LTyFamDefltDecl GhcRn]
forall a. NameEnv a
</span><a href="GHC.Types.Name.Env.html#emptyNameEnv"><span class="hs-identifier hs-var">emptyNameEnv</span></a></span><span> </span><span class="annot"><span class="annottext">[LTyFamDefltDecl GhcRn]
</span><a href="#local-6989586621681166062"><span class="hs-identifier hs-var">at_defs</span></a></span><span>
</span><span id="line-2387"></span><span>
</span><span id="line-2388"></span><span>    </span><span id="local-6989586621681166054"><span class="annot"><span class="annottext">tc_at :: LFamilyDecl GhcRn -&gt; IOEnv (Env TcGblEnv TcLclEnv) ClassATItem
</span><a href="#local-6989586621681166054"><span class="hs-identifier hs-var hs-var">tc_at</span></a></span></span><span> </span><span id="local-6989586621681166046"><span class="annot"><span class="annottext">LFamilyDecl GhcRn
</span><a href="#local-6989586621681166046"><span class="hs-identifier hs-var">at</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681166045"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166045"><span class="hs-identifier hs-var">fam_tc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(FamilyDecl GhcRn -&gt; TcRn TyCon) -&gt; LFamilyDecl GhcRn -&gt; TcRn TyCon
forall a b. (a -&gt; TcM b) -&gt; Located a -&gt; TcM b
</span><a href="GHC.Tc.Utils.Monad.html#addLocM"><span class="hs-identifier hs-var">addLocM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Class -&gt; FamilyDecl GhcRn -&gt; TcRn TyCon
</span><a href="GHC.Tc.TyCl.html#tcFamDecl1"><span class="hs-identifier hs-var">tcFamDecl1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; Maybe Class
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681166064"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LFamilyDecl GhcRn
</span><a href="#local-6989586621681166046"><span class="hs-identifier hs-var">at</span></a></span><span>
</span><span id="line-2389"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681166044"><span class="annot"><span class="annottext">at_defs :: [LTyFamDefltDecl GhcRn]
</span><a href="#local-6989586621681166044"><span class="hs-identifier hs-var hs-var">at_defs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NameEnv [LTyFamDefltDecl GhcRn]
-&gt; Name -&gt; Maybe [LTyFamDefltDecl GhcRn]
forall a. NameEnv a -&gt; Name -&gt; Maybe a
</span><a href="GHC.Types.Name.Env.html#lookupNameEnv"><span class="hs-identifier hs-var">lookupNameEnv</span></a></span><span> </span><span class="annot"><span class="annottext">NameEnv [LTyFamDefltDecl GhcRn]
</span><a href="#local-6989586621681166050"><span class="hs-identifier hs-var">at_defs_map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LFamilyDecl GhcRn -&gt; Name
</span><a href="#local-6989586621681166052"><span class="hs-identifier hs-var">at_fam_name</span></a></span><span> </span><span class="annot"><span class="annottext">LFamilyDecl GhcRn
</span><a href="#local-6989586621681166046"><span class="hs-identifier hs-var">at</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2390"></span><span>                                  </span><span class="annot"><span class="annottext">Maybe [LTyFamDefltDecl GhcRn]
-&gt; [LTyFamDefltDecl GhcRn] -&gt; [LTyFamDefltDecl GhcRn]
forall a. Maybe a -&gt; a -&gt; a
</span><a href="GHC.Data.Maybe.html#orElse"><span class="hs-operator hs-var">`orElse`</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2391"></span><span>                  </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681166042"><span class="annot"><span class="annottext">Maybe (Type, ATValidityInfo)
</span><a href="#local-6989586621681166042"><span class="hs-identifier hs-var">atd</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon
-&gt; [LTyFamDefltDecl GhcRn] -&gt; TcM (Maybe (Type, ATValidityInfo))
</span><a href="GHC.Tc.TyCl.html#tcDefaultAssocDecl"><span class="hs-identifier hs-var">tcDefaultAssocDecl</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166045"><span class="hs-identifier hs-var">fam_tc</span></a></span><span> </span><span class="annot"><span class="annottext">[LTyFamDefltDecl GhcRn]
</span><a href="#local-6989586621681166044"><span class="hs-identifier hs-var">at_defs</span></a></span><span>
</span><span id="line-2392"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">ClassATItem -&gt; IOEnv (Env TcGblEnv TcLclEnv) ClassATItem
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Maybe (Type, ATValidityInfo) -&gt; ClassATItem
</span><a href="GHC.Core.Class.html#ATI"><span class="hs-identifier hs-var">ATI</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166045"><span class="hs-identifier hs-var">fam_tc</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Type, ATValidityInfo)
</span><a href="#local-6989586621681166042"><span class="hs-identifier hs-var">atd</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2393"></span><span>
</span><span id="line-2394"></span><span class="hs-comment">-------------------------</span><span>
</span><span id="line-2395"></span><span class="annot"><a href="GHC.Tc.TyCl.html#tcDefaultAssocDecl"><span class="hs-identifier hs-type">tcDefaultAssocDecl</span></a></span><span> </span><span class="hs-glyph">::</span><span>
</span><span id="line-2396"></span><span>     </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span>                                       </span><span class="hs-comment">-- ^ Family TyCon (not knot-tied)</span><span>
</span><span id="line-2397"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Hs.Decls.html#LTyFamDefltDecl"><span class="hs-identifier hs-type">LTyFamDefltDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span>                     </span><span class="hs-comment">-- ^ Defaults</span><span>
</span><span id="line-2398"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#KnotTied"><span class="hs-identifier hs-type">KnotTied</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#ATValidityInfo"><span class="hs-identifier hs-type">ATValidityInfo</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Type checked RHS</span><span>
</span><span id="line-2399"></span><span id="tcDefaultAssocDecl"><span class="annot"><span class="annottext">tcDefaultAssocDecl :: TyCon
-&gt; [LTyFamDefltDecl GhcRn] -&gt; TcM (Maybe (Type, ATValidityInfo))
</span><a href="GHC.Tc.TyCl.html#tcDefaultAssocDecl"><span class="hs-identifier hs-var hs-var">tcDefaultAssocDecl</span></a></span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2400"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Type, ATValidityInfo) -&gt; TcM (Maybe (Type, ATValidityInfo))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Type, ATValidityInfo)
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>  </span><span class="hs-comment">-- No default declaration</span><span>
</span><span id="line-2401"></span><span>
</span><span id="line-2402"></span><span class="annot"><a href="GHC.Tc.TyCl.html#tcDefaultAssocDecl"><span class="hs-identifier hs-var">tcDefaultAssocDecl</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681166039"><span class="annot"><span class="annottext">LTyFamDefltDecl GhcRn
</span><a href="#local-6989586621681166039"><span class="hs-identifier hs-var">d1</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">LTyFamDefltDecl GhcRn
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[LTyFamDefltDecl GhcRn]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-2403"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcM (Maybe (Type, ATValidityInfo))
forall a. SDoc -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;More than one default declaration for&quot;</span></span><span>
</span><span id="line-2404"></span><span>                </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyFamInstDecl GhcRn -&gt; IdP GhcRn
forall (p :: Pass). TyFamInstDecl (GhcPass p) -&gt; IdP (GhcPass p)
</span><a href="GHC.Hs.Decls.html#tyFamInstDeclName"><span class="hs-identifier hs-var">tyFamInstDeclName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LTyFamDefltDecl GhcRn -&gt; TyFamInstDecl GhcRn
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LTyFamDefltDecl GhcRn
</span><a href="#local-6989586621681166039"><span class="hs-identifier hs-var">d1</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2405"></span><span>
</span><span id="line-2406"></span><span class="annot"><a href="GHC.Tc.TyCl.html#tcDefaultAssocDecl"><span class="hs-identifier hs-var">tcDefaultAssocDecl</span></a></span><span> </span><span id="local-6989586621681166038"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166038"><span class="hs-identifier hs-var">fam_tc</span></a></span></span><span>
</span><span id="line-2407"></span><span>  </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681166037"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681166037"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Decls.html#TyFamInstDecl"><span class="hs-identifier hs-type">TyFamInstDecl</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tfid_eqn :: forall pass. TyFamInstDecl pass -&gt; TyFamInstEqn pass
</span><a href="GHC.Hs.Decls.html#tfid_eqn"><span class="hs-identifier hs-var">tfid_eqn</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2408"></span><span>         </span><span class="annot"><a href="GHC.Hs.Type.html#HsIB"><span class="hs-identifier hs-type">HsIB</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hsib_ext :: forall pass thing. HsImplicitBndrs pass thing -&gt; XHsIB pass thing
</span><a href="GHC.Hs.Type.html#hsib_ext"><span class="hs-identifier hs-var">hsib_ext</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681166032"><span class="annot"><span class="annottext">XHsIB GhcRn (FamEqn GhcRn (LHsType GhcRn))
</span><a href="#local-6989586621681166032"><span class="hs-identifier hs-var">imp_vars</span></a></span></span><span>
</span><span id="line-2409"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hsib_body :: forall pass thing. HsImplicitBndrs pass thing -&gt; thing
</span><a href="GHC.Hs.Type.html#hsib_body"><span class="hs-identifier hs-var">hsib_body</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Hs.Decls.html#FamEqn"><span class="hs-identifier hs-type">FamEqn</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">feqn_tycon :: forall pass rhs. FamEqn pass rhs -&gt; Located (IdP pass)
</span><a href="GHC.Hs.Decls.html#feqn_tycon"><span class="hs-identifier hs-var">feqn_tycon</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681166028"><span class="annot"><span class="annottext">IdP GhcRn
</span><a href="#local-6989586621681166028"><span class="hs-identifier hs-var">tc_name</span></a></span></span><span>
</span><span id="line-2410"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">feqn_bndrs :: forall pass rhs. FamEqn pass rhs -&gt; Maybe [LHsTyVarBndr () pass]
</span><a href="GHC.Hs.Decls.html#feqn_bndrs"><span class="hs-identifier hs-var">feqn_bndrs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681166026"><span class="annot"><span class="annottext">Maybe [LHsTyVarBndr () GhcRn]
</span><a href="#local-6989586621681166026"><span class="hs-identifier hs-var">mb_expl_bndrs</span></a></span></span><span>
</span><span id="line-2411"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">feqn_pats :: forall pass rhs. FamEqn pass rhs -&gt; HsTyPats pass
</span><a href="GHC.Hs.Decls.html#feqn_pats"><span class="hs-identifier hs-var">feqn_pats</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681166024"><span class="annot"><span class="annottext">HsTyPats GhcRn
</span><a href="#local-6989586621681166024"><span class="hs-identifier hs-var">hs_pats</span></a></span></span><span>
</span><span id="line-2412"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">feqn_rhs :: forall pass rhs. FamEqn pass rhs -&gt; rhs
</span><a href="GHC.Hs.Decls.html#feqn_rhs"><span class="hs-identifier hs-var">feqn_rhs</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681166022"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621681166022"><span class="hs-identifier hs-var">hs_rhs_ty</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-2413"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- See Note [Type-checking default assoc decls]</span><span>
</span><span id="line-2414"></span><span>    </span><span class="annot"><span class="annottext">SrcSpan
-&gt; TcM (Maybe (Type, ATValidityInfo))
-&gt; TcM (Maybe (Type, ATValidityInfo))
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681166037"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (Maybe (Type, ATValidityInfo))
 -&gt; TcM (Maybe (Type, ATValidityInfo)))
-&gt; TcM (Maybe (Type, ATValidityInfo))
-&gt; TcM (Maybe (Type, ATValidityInfo))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2415"></span><span>    </span><span class="annot"><span class="annottext">SDoc
-&gt; Name
-&gt; TcM (Maybe (Type, ATValidityInfo))
-&gt; TcM (Maybe (Type, ATValidityInfo))
forall a. SDoc -&gt; Name -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.TyCl.html#tcAddFamInstCtxt"><span class="hs-identifier hs-var">tcAddFamInstCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;default type instance&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
IdP GhcRn
</span><a href="#local-6989586621681166028"><span class="hs-identifier hs-var">tc_name</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (Maybe (Type, ATValidityInfo))
 -&gt; TcM (Maybe (Type, ATValidityInfo)))
-&gt; TcM (Maybe (Type, ATValidityInfo))
-&gt; TcM (Maybe (Type, ATValidityInfo))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2416"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcDefaultAssocDecl 1&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
IdP GhcRn
</span><a href="#local-6989586621681166028"><span class="hs-identifier hs-var">tc_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2417"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681166020"><span class="annot"><span class="annottext">fam_tc_name :: Name
</span><a href="#local-6989586621681166020"><span class="hs-identifier hs-var hs-var">fam_tc_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Name
</span><a href="GHC.Core.TyCon.html#tyConName"><span class="hs-identifier hs-var hs-var">tyConName</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166038"><span class="hs-identifier hs-var">fam_tc</span></a></span><span>
</span><span id="line-2418"></span><span>             </span><span id="local-6989586621681166019"><span class="annot"><span class="annottext">vis_arity :: Arity
</span><a href="#local-6989586621681166019"><span class="hs-identifier hs-var hs-var">vis_arity</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; Arity
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Arity
</span><a href="../../base/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [TyVar]
</span><a href="GHC.Core.TyCon.html#tyConVisibleTyVars"><span class="hs-identifier hs-var">tyConVisibleTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166038"><span class="hs-identifier hs-var">fam_tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2419"></span><span>             </span><span id="local-6989586621681166017"><span class="annot"><span class="annottext">vis_pats :: Arity
</span><a href="#local-6989586621681166017"><span class="hs-identifier hs-var hs-var">vis_pats</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsTyPats GhcRn -&gt; Arity
forall tm ty. [HsArg tm ty] -&gt; Arity
</span><a href="GHC.Hs.Type.html#numVisibleArgs"><span class="hs-identifier hs-var">numVisibleArgs</span></a></span><span> </span><span class="annot"><span class="annottext">HsTyPats GhcRn
</span><a href="#local-6989586621681166024"><span class="hs-identifier hs-var">hs_pats</span></a></span><span>
</span><span id="line-2420"></span><span>
</span><span id="line-2421"></span><span>       </span><span class="hs-comment">-- Kind of family check</span><span>
</span><span id="line-2422"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">fam_tc_name</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">tc_name</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-2423"></span><span>         </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isTypeFamilyTyCon"><span class="hs-identifier hs-var">isTypeFamilyTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166038"><span class="hs-identifier hs-var">fam_tc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#wrongKindOfFamily"><span class="hs-identifier hs-var">wrongKindOfFamily</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166038"><span class="hs-identifier hs-var">fam_tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2424"></span><span>
</span><span id="line-2425"></span><span>       </span><span class="hs-comment">-- Arity check</span><span>
</span><span id="line-2426"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621681166017"><span class="hs-identifier hs-var">vis_pats</span></a></span><span> </span><span class="annot"><span class="annottext">Arity -&gt; Arity -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621681166019"><span class="hs-identifier hs-var">vis_arity</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2427"></span><span>                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arity -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#wrongNumberOfParmsErr"><span class="hs-identifier hs-var">wrongNumberOfParmsErr</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621681166019"><span class="hs-identifier hs-var">vis_arity</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2428"></span><span>
</span><span id="line-2429"></span><span>       </span><span class="hs-comment">-- Typecheck RHS</span><span>
</span><span id="line-2430"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-2431"></span><span>       </span><span class="hs-comment">-- You might think we should pass in some AssocInstInfo, as we're looking</span><span>
</span><span id="line-2432"></span><span>       </span><span class="hs-comment">-- at an associated type. But this would be wrong, because an associated</span><span>
</span><span id="line-2433"></span><span>       </span><span class="hs-comment">-- type default LHS can mention *different* type variables than the</span><span>
</span><span id="line-2434"></span><span>       </span><span class="hs-comment">-- enclosing class. So it's treated more as a freestanding beast.</span><span>
</span><span id="line-2435"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681166012"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681166012"><span class="hs-identifier hs-var">qtvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681166011"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681166011"><span class="hs-identifier hs-var">pats</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681166010"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681166010"><span class="hs-identifier hs-var">rhs_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon
-&gt; AssocInstInfo
-&gt; [Name]
-&gt; [LHsTyVarBndr () GhcRn]
-&gt; HsTyPats GhcRn
-&gt; LHsType GhcRn
-&gt; TcM ([TyVar], [Type], Type)
</span><a href="GHC.Tc.TyCl.html#tcTyFamInstEqnGuts"><span class="hs-identifier hs-var">tcTyFamInstEqnGuts</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166038"><span class="hs-identifier hs-var">fam_tc</span></a></span><span> </span><span class="annot"><span class="annottext">AssocInstInfo
</span><a href="GHC.Tc.Instance.Class.html#NotAssociated"><span class="hs-identifier hs-var">NotAssociated</span></a></span><span>
</span><span id="line-2436"></span><span>                                                    </span><span class="annot"><span class="annottext">[Name]
XHsIB GhcRn (FamEqn GhcRn (LHsType GhcRn))
</span><a href="#local-6989586621681166032"><span class="hs-identifier hs-var">imp_vars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe [LHsTyVarBndr () GhcRn]
</span><a href="#local-6989586621681166026"><span class="hs-identifier hs-var">mb_expl_bndrs</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [LHsTyVarBndr () GhcRn]
-&gt; [LHsTyVarBndr () GhcRn] -&gt; [LHsTyVarBndr () GhcRn]
forall a. Maybe a -&gt; a -&gt; a
</span><a href="GHC.Data.Maybe.html#orElse"><span class="hs-operator hs-var">`orElse`</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2437"></span><span>                                                    </span><span class="annot"><span class="annottext">HsTyPats GhcRn
</span><a href="#local-6989586621681166024"><span class="hs-identifier hs-var">hs_pats</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621681166022"><span class="hs-identifier hs-var">hs_rhs_ty</span></a></span><span>
</span><span id="line-2438"></span><span>
</span><span id="line-2439"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681166007"><span class="annot"><span class="annottext">fam_tvs :: [TyVar]
</span><a href="#local-6989586621681166007"><span class="hs-identifier hs-var hs-var">fam_tvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [TyVar]
</span><a href="GHC.Core.TyCon.html#tyConTyVars"><span class="hs-identifier hs-var hs-var">tyConTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681166038"><span class="hs-identifier hs-var">fam_tc</span></a></span><span>
</span><span id="line-2440"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcDefaultAssocDecl 2&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-2441"></span><span>           </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;hs_pats&quot;</span></span><span>   </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HsTyPats GhcRn -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsTyPats GhcRn
</span><a href="#local-6989586621681166024"><span class="hs-identifier hs-var">hs_pats</span></a></span><span>
</span><span id="line-2442"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;hs_rhs_ty&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621681166022"><span class="hs-identifier hs-var">hs_rhs_ty</span></a></span><span>
</span><span id="line-2443"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;fam_tvs&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681166007"><span class="hs-identifier hs-var">fam_tvs</span></a></span><span>
</span><span id="line-2444"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;qtvs&quot;</span></span><span>    </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681166012"><span class="hs-identifier hs-var">qtvs</span></a></span><span>
</span><span id="line-2445"></span><span>             </span><span class="hs-comment">-- NB: Do *not* print `pats` or rhs_ty here, as they can mention</span><span>
</span><span id="line-2446"></span><span>             </span><span class="hs-comment">-- knot-tied TyCons. See #18648.</span><span>
</span><span id="line-2447"></span><span>           </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2448"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681166006"><span class="annot"><span class="annottext">subst :: TCvSubst
</span><a href="#local-6989586621681166006"><span class="hs-identifier hs-var hs-var">subst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Maybe TyVar) -&gt; [Type] -&gt; Maybe [TyVar]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><a href="../../base/src/Data.Traversable.html#traverse"><span class="hs-identifier hs-var">traverse</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe TyVar
</span><a href="GHC.Core.Type.html#getTyVar_maybe"><span class="hs-identifier hs-var">getTyVar_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681166011"><span class="hs-identifier hs-var">pats</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2449"></span><span>                       </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681166004"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681166004"><span class="hs-identifier hs-var">cpt_tvs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; [Type] -&gt; TCvSubst
HasDebugCallStack =&gt; [TyVar] -&gt; [Type] -&gt; TCvSubst
</span><a href="GHC.Core.TyCo.Subst.html#zipTvSubst"><span class="hs-identifier hs-var">zipTvSubst</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681166004"><span class="hs-identifier hs-var">cpt_tvs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyVar] -&gt; [Type]
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681166007"><span class="hs-identifier hs-var">fam_tvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2450"></span><span>                       </span><span class="annot"><span class="annottext">Maybe [TyVar]
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="GHC.Core.TyCo.Subst.html#emptyTCvSubst"><span class="hs-identifier hs-var">emptyTCvSubst</span></a></span><span>
</span><span id="line-2451"></span><span>                       </span><span class="hs-comment">-- The Nothing case can only be reached in invalid</span><span>
</span><span id="line-2452"></span><span>                       </span><span class="hs-comment">-- associated type family defaults. In such cases, we</span><span>
</span><span id="line-2453"></span><span>                       </span><span class="hs-comment">-- simply create an empty substitution and let GHC fall</span><span>
</span><span id="line-2454"></span><span>                       </span><span class="hs-comment">-- over later, in GHC.Tc.Validity.checkValidAssocTyFamDeflt.</span><span>
</span><span id="line-2455"></span><span>                       </span><span class="hs-comment">-- See Note [Type-checking default assoc decls].</span><span>
</span><span id="line-2456"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Maybe (Type, ATValidityInfo) -&gt; TcM (Maybe (Type, ATValidityInfo))
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (Type, ATValidityInfo)
 -&gt; TcM (Maybe (Type, ATValidityInfo)))
-&gt; Maybe (Type, ATValidityInfo)
-&gt; TcM (Maybe (Type, ATValidityInfo))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Type, ATValidityInfo) -&gt; Maybe (Type, ATValidityInfo)
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCvSubst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTyUnchecked"><span class="hs-identifier hs-var">substTyUnchecked</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681166006"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681166010"><span class="hs-identifier hs-var">rhs_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; [Type] -&gt; ATValidityInfo
</span><a href="GHC.Core.Class.html#ATVI"><span class="hs-identifier hs-var">ATVI</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681166037"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681166011"><span class="hs-identifier hs-var">pats</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2457"></span><span>           </span><span class="hs-comment">-- We perform checks for well-formedness and validity later, in</span><span>
</span><span id="line-2458"></span><span>           </span><span class="hs-comment">-- GHC.Tc.Validity.checkValidAssocTyFamDeflt.</span><span>
</span><span id="line-2459"></span><span>     </span><span class="hs-special">}</span><span>
</span><span id="line-2460"></span><span>
</span><span id="line-2461"></span><span class="hs-comment">{- Note [Type-checking default assoc decls]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider this default declaration for an associated type

   class C a where
      type F (a :: k) b :: Type
      type F (x :: j) y = Proxy x -&gt; y

Note that the class variable 'a' doesn't scope over the default assoc
decl, nor do the type variables `k` and `b`. Instead, the default decl is
treated more like a top-level type instance. However, we store the default rhs
(Proxy x -&gt; y) in F's TyCon, using F's own type variables, so we need to
convert it to (Proxy a -&gt; b). We do this in the tcDefaultAssocDecl function by
creating a substitution [j |-&gt; k, x |-&gt; a, b |-&gt; y] and applying this
substitution to the RHS.

In order to create this substitution, we must first ensure that all of
the arguments in the default instance consist of distinct type variables.
Checking for this property proves surprisingly tricky. Three potential places
where GHC could check for this property include:

1. Before typechecking (in the parser or renamer)
2. During typechecking (in tcDefaultAssocDecl)
3. After typechecking (using GHC.Tc.Validity)

Currently, GHC picks option (3) and implements this check using
GHC.Tc.Validity.checkValidAssocTyFamDeflt. GHC previously used options (1) and
(2), but neither option quite worked out for reasons that we will explain
shortly.

The first thing that checkValidAssocTyFamDeflt does is check that all arguments
in an associated type family default are type variables. As a motivating
example, consider this erroneous program (inspired by #11361):

   class C a where
      type F (a :: k) b :: Type
      type F x        b = x

If you squint, you'll notice that the kind of `x` is actually Type. However,
we cannot substitute from [Type |-&gt; k], so we reject this default. This also
explains why GHC no longer implements option (1) above, since figuring out that
`x`'s kind is Type would be much more difficult without the knowledge that the
typechecker provides.

Next, checkValidAssocTyFamDeflt checks that all arguments are distinct. Here is
another offending example, this time taken from #13971:

   class C2 (a :: j) where
      type F2 (a :: j) (b :: k)
      type F2 (x :: z) y = SameKind x y
   data SameKind :: k -&gt; k -&gt; Type

All of the arguments in the default equation for `F2` are type variables, so
that passes the first check. However, if we were to build this substitution,
then both `j` and `k` map to `z`! In terms of visible kind application, it's as
if we had written `type F2 @z @z x y = SameKind @z x y`, which makes it clear
that we have duplicated a use of `z` on the LHS. Therefore, `F2`'s default is
also rejected.

There is one more design consideration in play here: what error message should
checkValidAssocTyFamDeflt produce if one of its checks fails? Ideally, it would
be something like this:

  Illegal duplicate variable &#8216;z&#8217; in:
    &#8216;type F2 @z @z x y = ...&#8217;
    The arguments to &#8216;F2&#8217; must all be distinct type variables

This requires printing out the arguments to the associated type family. This
can be dangerous, however. Consider this example, adapted from #18648:

  class C3 a where
     type F3 a
     type F3 (F3 a) = a

F3's default is illegal, since its argument is not a bare type variable. But
note that when we typecheck F3's default, the F3 type constructor is knot-tied.
Therefore, if we print the type `F3 a` in an error message, GHC will diverge!
This is the reason why GHC no longer implements option (2) above and instead
waits until /after/ typechecking has finished, at which point the typechecker
knot has been worked out.

As one final point, one might worry that the typechecker knot could cause the
substitution that tcDefaultAssocDecl creates to diverge, but this is not the
case. Since the LHS of a valid associated type family default is always just
variables, it won't contain any tycons. Accordingly, the patterns used in the
substitution won't actually be knot-tied, even though we're in the knot. (This
is too delicate for my taste, but it works.) If we're dealing with /invalid/
default, such as F3's above, then we simply create an empty substitution and
rely on checkValidAssocTyFamDeflt throwing an error message afterwards before
any damage is done.
-}</span><span>
</span><span id="line-2552"></span><span>
</span><span id="line-2553"></span><span class="hs-comment">{- *********************************************************************
*                                                                      *
          Type family declarations
*                                                                      *
********************************************************************* -}</span><span>
</span><span id="line-2558"></span><span>
</span><span id="line-2559"></span><span class="annot"><a href="GHC.Tc.TyCl.html#tcFamDecl1"><span class="hs-identifier hs-type">tcFamDecl1</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Decls.html#FamilyDecl"><span class="hs-identifier hs-type">FamilyDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span>
</span><span id="line-2560"></span><span id="tcFamDecl1"><span class="annot"><span class="annottext">tcFamDecl1 :: Maybe Class -&gt; FamilyDecl GhcRn -&gt; TcRn TyCon
</span><a href="GHC.Tc.TyCl.html#tcFamDecl1"><span class="hs-identifier hs-var hs-var">tcFamDecl1</span></a></span></span><span> </span><span id="local-6989586621681165998"><span class="annot"><span class="annottext">Maybe Class
</span><a href="#local-6989586621681165998"><span class="hs-identifier hs-var">parent</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Decls.html#FamilyDecl"><span class="hs-identifier hs-type">FamilyDecl</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">fdInfo :: forall pass. FamilyDecl pass -&gt; FamilyInfo pass
</span><a href="GHC.Hs.Decls.html#fdInfo"><span class="hs-identifier hs-var">fdInfo</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681165997"><span class="annot"><span class="annottext">FamilyInfo GhcRn
</span><a href="#local-6989586621681165997"><span class="hs-identifier hs-var">fam_info</span></a></span></span><span>
</span><span id="line-2561"></span><span>                              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fdLName :: forall pass. FamilyDecl pass -&gt; Located (IdP pass)
</span><a href="GHC.Hs.Decls.html#fdLName"><span class="hs-identifier hs-var">fdLName</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681165996"><span class="annot"><span class="annottext">tc_lname :: GenLocated SrcSpan (IdP GhcRn)
</span><a href="#local-6989586621681165996"><span class="hs-identifier hs-var">tc_lname</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681165995"><span class="annot"><span class="annottext">IdP GhcRn
</span><a href="#local-6989586621681165995"><span class="hs-identifier hs-var">tc_name</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2562"></span><span>                              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fdResultSig :: forall pass. FamilyDecl pass -&gt; LFamilyResultSig pass
</span><a href="GHC.Hs.Decls.html#fdResultSig"><span class="hs-identifier hs-var">fdResultSig</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681165994"><span class="annot"><span class="annottext">FamilyResultSig GhcRn
</span><a href="#local-6989586621681165994"><span class="hs-identifier hs-var">sig</span></a></span></span><span>
</span><span id="line-2563"></span><span>                              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fdInjectivityAnn :: forall pass. FamilyDecl pass -&gt; Maybe (LInjectivityAnn pass)
</span><a href="GHC.Hs.Decls.html#fdInjectivityAnn"><span class="hs-identifier hs-var">fdInjectivityAnn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681165992"><span class="annot"><span class="annottext">Maybe (LInjectivityAnn GhcRn)
</span><a href="#local-6989586621681165992"><span class="hs-identifier hs-var">inj</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-2564"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">FamilyInfo GhcRn
</span><a href="GHC.Hs.Decls.html#DataFamily"><span class="hs-identifier hs-var">DataFamily</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FamilyInfo GhcRn
</span><a href="#local-6989586621681165997"><span class="hs-identifier hs-var">fam_info</span></a></span><span>
</span><span id="line-2565"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
-&gt; (TyCon -&gt; [TyConBinder] -&gt; Type -&gt; TcRn TyCon) -&gt; TcRn TyCon
forall a.
Name -&gt; (TyCon -&gt; [TyConBinder] -&gt; Type -&gt; TcM a) -&gt; TcM a
</span><a href="GHC.Tc.Gen.HsType.html#bindTyClTyVars"><span class="hs-identifier hs-var">bindTyClTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">Name
IdP GhcRn
</span><a href="#local-6989586621681165995"><span class="hs-identifier hs-var">tc_name</span></a></span><span> </span><span class="annot"><span class="annottext">((TyCon -&gt; [TyConBinder] -&gt; Type -&gt; TcRn TyCon) -&gt; TcRn TyCon)
-&gt; (TyCon -&gt; [TyConBinder] -&gt; Type -&gt; TcRn TyCon) -&gt; TcRn TyCon
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681165991"><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621681165991"><span class="hs-identifier hs-var">binders</span></a></span></span><span> </span><span id="local-6989586621681165990"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165990"><span class="hs-identifier hs-var">res_kind</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2566"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;data family:&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
IdP GhcRn
</span><a href="#local-6989586621681165995"><span class="hs-identifier hs-var">tc_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2567"></span><span>  </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcRn ()
</span><a href="GHC.Tc.TyCl.html#checkFamFlag"><span class="hs-identifier hs-var">checkFamFlag</span></a></span><span> </span><span class="annot"><span class="annottext">Name
IdP GhcRn
</span><a href="#local-6989586621681165995"><span class="hs-identifier hs-var">tc_name</span></a></span><span>
</span><span id="line-2568"></span><span>
</span><span id="line-2569"></span><span>  </span><span class="hs-comment">-- Check that the result kind is OK</span><span>
</span><span id="line-2570"></span><span>  </span><span class="hs-comment">-- We allow things like</span><span>
</span><span id="line-2571"></span><span>  </span><span class="hs-comment">--   data family T (a :: Type) :: forall k. k -&gt; Type</span><span>
</span><span id="line-2572"></span><span>  </span><span class="hs-comment">-- We treat T as having arity 1, but result kind forall k. k -&gt; Type</span><span>
</span><span id="line-2573"></span><span>  </span><span class="hs-comment">-- But we want to check that the result kind finishes in</span><span>
</span><span id="line-2574"></span><span>  </span><span class="hs-comment">--   Type or a kind-variable</span><span>
</span><span id="line-2575"></span><span>  </span><span class="hs-comment">-- For the latter, consider</span><span>
</span><span id="line-2576"></span><span>  </span><span class="hs-comment">--   data family D a :: forall k. Type -&gt; k</span><span>
</span><span id="line-2577"></span><span>  </span><span class="hs-comment">-- When UnliftedNewtypes is enabled, we loosen this restriction</span><span>
</span><span id="line-2578"></span><span>  </span><span class="hs-comment">-- on the return kind. See Note [Implementation of UnliftedNewtypes], wrinkle (1).</span><span>
</span><span id="line-2579"></span><span>  </span><span class="hs-comment">-- See also Note [Datatype return kinds]</span><span>
</span><span id="line-2580"></span><span>  </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">DataSort -&gt; Type -&gt; TcRn ()
</span><a href="GHC.Tc.Gen.HsType.html#checkDataKindSig"><span class="hs-identifier hs-var">checkDataKindSig</span></a></span><span> </span><span class="annot"><span class="annottext">DataSort
</span><a href="GHC.Tc.Gen.HsType.html#DataFamilySort"><span class="hs-identifier hs-var">DataFamilySort</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165990"><span class="hs-identifier hs-var">res_kind</span></a></span><span>
</span><span id="line-2581"></span><span>  </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681165986"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165986"><span class="hs-identifier hs-var">tc_rep_name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcRnIf TcGblEnv TcLclEnv Name
forall gbl lcl. Name -&gt; TcRnIf gbl lcl Name
</span><a href="GHC.Tc.TyCl.Build.html#newTyConRepName"><span class="hs-identifier hs-var">newTyConRepName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
IdP GhcRn
</span><a href="#local-6989586621681165995"><span class="hs-identifier hs-var">tc_name</span></a></span><span>
</span><span id="line-2582"></span><span>  </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681165984"><span class="annot"><span class="annottext">inj :: Injectivity
</span><a href="#local-6989586621681165984"><span class="hs-identifier hs-var hs-var">inj</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Bool] -&gt; Injectivity
</span><a href="GHC.Core.TyCon.html#Injective"><span class="hs-identifier hs-var">Injective</span></a></span><span> </span><span class="annot"><span class="annottext">([Bool] -&gt; Injectivity) -&gt; [Bool] -&gt; Injectivity
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Arity -&gt; Bool -&gt; [Bool]
forall a. Arity -&gt; a -&gt; [a]
</span><a href="../../base/src/GHC.List.html#replicate"><span class="hs-identifier hs-var">replicate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyConBinder] -&gt; Arity
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Arity
</span><a href="../../base/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621681165991"><span class="hs-identifier hs-var">binders</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-2583"></span><span>        </span><span id="local-6989586621681165981"><span class="annot"><span class="annottext">tycon :: TyCon
</span><a href="#local-6989586621681165981"><span class="hs-identifier hs-var hs-var">tycon</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
-&gt; [TyConBinder]
-&gt; Type
-&gt; Maybe Name
-&gt; FamTyConFlav
-&gt; Maybe Class
-&gt; Injectivity
-&gt; TyCon
</span><a href="GHC.Core.TyCon.html#mkFamilyTyCon"><span class="hs-identifier hs-var">mkFamilyTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Name
IdP GhcRn
</span><a href="#local-6989586621681165995"><span class="hs-identifier hs-var">tc_name</span></a></span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621681165991"><span class="hs-identifier hs-var">binders</span></a></span><span>
</span><span id="line-2584"></span><span>                              </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165990"><span class="hs-identifier hs-var">res_kind</span></a></span><span>
</span><span id="line-2585"></span><span>                              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FamilyResultSig GhcRn -&gt; Maybe (IdP GhcRn)
forall (a :: Pass).
FamilyResultSig (GhcPass a) -&gt; Maybe (IdP (GhcPass a))
</span><a href="GHC.Hs.Decls.html#resultVariableName"><span class="hs-identifier hs-var">resultVariableName</span></a></span><span> </span><span class="annot"><span class="annottext">FamilyResultSig GhcRn
</span><a href="#local-6989586621681165994"><span class="hs-identifier hs-var">sig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2586"></span><span>                              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; FamTyConFlav
</span><a href="GHC.Core.TyCon.html#DataFamilyTyCon"><span class="hs-identifier hs-var">DataFamilyTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165986"><span class="hs-identifier hs-var">tc_rep_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2587"></span><span>                              </span><span class="annot"><span class="annottext">Maybe Class
</span><a href="#local-6989586621681165998"><span class="hs-identifier hs-var">parent</span></a></span><span> </span><span class="annot"><span class="annottext">Injectivity
</span><a href="#local-6989586621681165984"><span class="hs-identifier hs-var">inj</span></a></span><span>
</span><span id="line-2588"></span><span>  </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TcRn TyCon
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165981"><span class="hs-identifier hs-var">tycon</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2589"></span><span>
</span><span id="line-2590"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">FamilyInfo GhcRn
</span><a href="GHC.Hs.Decls.html#OpenTypeFamily"><span class="hs-identifier hs-var">OpenTypeFamily</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FamilyInfo GhcRn
</span><a href="#local-6989586621681165997"><span class="hs-identifier hs-var">fam_info</span></a></span><span>
</span><span id="line-2591"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
-&gt; (TyCon -&gt; [TyConBinder] -&gt; Type -&gt; TcRn TyCon) -&gt; TcRn TyCon
forall a.
Name -&gt; (TyCon -&gt; [TyConBinder] -&gt; Type -&gt; TcM a) -&gt; TcM a
</span><a href="GHC.Tc.Gen.HsType.html#bindTyClTyVars"><span class="hs-identifier hs-var">bindTyClTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">Name
IdP GhcRn
</span><a href="#local-6989586621681165995"><span class="hs-identifier hs-var">tc_name</span></a></span><span> </span><span class="annot"><span class="annottext">((TyCon -&gt; [TyConBinder] -&gt; Type -&gt; TcRn TyCon) -&gt; TcRn TyCon)
-&gt; (TyCon -&gt; [TyConBinder] -&gt; Type -&gt; TcRn TyCon) -&gt; TcRn TyCon
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681165977"><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621681165977"><span class="hs-identifier hs-var">binders</span></a></span></span><span> </span><span id="local-6989586621681165976"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165976"><span class="hs-identifier hs-var">res_kind</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2592"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;open type family:&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
IdP GhcRn
</span><a href="#local-6989586621681165995"><span class="hs-identifier hs-var">tc_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2593"></span><span>  </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcRn ()
</span><a href="GHC.Tc.TyCl.html#checkFamFlag"><span class="hs-identifier hs-var">checkFamFlag</span></a></span><span> </span><span class="annot"><span class="annottext">Name
IdP GhcRn
</span><a href="#local-6989586621681165995"><span class="hs-identifier hs-var">tc_name</span></a></span><span>
</span><span id="line-2594"></span><span>  </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681165975"><span class="annot"><span class="annottext">Injectivity
</span><a href="#local-6989586621681165975"><span class="hs-identifier hs-var">inj'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TyConBinder] -&gt; Maybe (LInjectivityAnn GhcRn) -&gt; TcM Injectivity
</span><a href="GHC.Tc.TyCl.html#tcInjectivity"><span class="hs-identifier hs-var">tcInjectivity</span></a></span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621681165977"><span class="hs-identifier hs-var">binders</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (LInjectivityAnn GhcRn)
</span><a href="#local-6989586621681165992"><span class="hs-identifier hs-var">inj</span></a></span><span>
</span><span id="line-2595"></span><span>  </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; FamilyResultSig GhcRn -&gt; TcRn ()
</span><a href="GHC.Tc.TyCl.html#checkResultSigFlag"><span class="hs-identifier hs-var">checkResultSigFlag</span></a></span><span> </span><span class="annot"><span class="annottext">Name
IdP GhcRn
</span><a href="#local-6989586621681165995"><span class="hs-identifier hs-var">tc_name</span></a></span><span> </span><span class="annot"><span class="annottext">FamilyResultSig GhcRn
</span><a href="#local-6989586621681165994"><span class="hs-identifier hs-var">sig</span></a></span><span>  </span><span class="hs-comment">-- check after injectivity for better errors</span><span>
</span><span id="line-2596"></span><span>  </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681165972"><span class="annot"><span class="annottext">tycon :: TyCon
</span><a href="#local-6989586621681165972"><span class="hs-identifier hs-var hs-var">tycon</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
-&gt; [TyConBinder]
-&gt; Type
-&gt; Maybe Name
-&gt; FamTyConFlav
-&gt; Maybe Class
-&gt; Injectivity
-&gt; TyCon
</span><a href="GHC.Core.TyCon.html#mkFamilyTyCon"><span class="hs-identifier hs-var">mkFamilyTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Name
IdP GhcRn
</span><a href="#local-6989586621681165995"><span class="hs-identifier hs-var">tc_name</span></a></span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621681165977"><span class="hs-identifier hs-var">binders</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165976"><span class="hs-identifier hs-var">res_kind</span></a></span><span>
</span><span id="line-2597"></span><span>                               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FamilyResultSig GhcRn -&gt; Maybe (IdP GhcRn)
forall (a :: Pass).
FamilyResultSig (GhcPass a) -&gt; Maybe (IdP (GhcPass a))
</span><a href="GHC.Hs.Decls.html#resultVariableName"><span class="hs-identifier hs-var">resultVariableName</span></a></span><span> </span><span class="annot"><span class="annottext">FamilyResultSig GhcRn
</span><a href="#local-6989586621681165994"><span class="hs-identifier hs-var">sig</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">FamTyConFlav
</span><a href="GHC.Core.TyCon.html#OpenSynFamilyTyCon"><span class="hs-identifier hs-var">OpenSynFamilyTyCon</span></a></span><span>
</span><span id="line-2598"></span><span>                               </span><span class="annot"><span class="annottext">Maybe Class
</span><a href="#local-6989586621681165998"><span class="hs-identifier hs-var">parent</span></a></span><span> </span><span class="annot"><span class="annottext">Injectivity
</span><a href="#local-6989586621681165975"><span class="hs-identifier hs-var">inj'</span></a></span><span>
</span><span id="line-2599"></span><span>  </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TcRn TyCon
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165972"><span class="hs-identifier hs-var">tycon</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2600"></span><span>
</span><span id="line-2601"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Hs.Decls.html#ClosedTypeFamily"><span class="hs-identifier hs-type">ClosedTypeFamily</span></a></span><span> </span><span id="local-6989586621681165970"><span class="annot"><span class="annottext">Maybe [LTyFamInstEqn GhcRn]
</span><a href="#local-6989586621681165970"><span class="hs-identifier hs-var">mb_eqns</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FamilyInfo GhcRn
</span><a href="#local-6989586621681165997"><span class="hs-identifier hs-var">fam_info</span></a></span><span>
</span><span id="line-2602"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- Closed type families are a little tricky, because they contain the definition</span><span>
</span><span id="line-2603"></span><span>    </span><span class="hs-comment">-- of both the type family and the equations for a CoAxiom.</span><span>
</span><span id="line-2604"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Closed type family:&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
IdP GhcRn
</span><a href="#local-6989586621681165995"><span class="hs-identifier hs-var">tc_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2605"></span><span>         </span><span class="hs-comment">-- the variables in the header scope only over the injectivity</span><span>
</span><span id="line-2606"></span><span>         </span><span class="hs-comment">-- declaration but this is not involved here</span><span>
</span><span id="line-2607"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681165969"><span class="annot"><span class="annottext">Injectivity
</span><a href="#local-6989586621681165969"><span class="hs-identifier hs-var">inj'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681165968"><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621681165968"><span class="hs-identifier hs-var">binders</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681165967"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165967"><span class="hs-identifier hs-var">res_kind</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2608"></span><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name
-&gt; (TyCon
    -&gt; [TyConBinder] -&gt; Type -&gt; TcM (Injectivity, [TyConBinder], Type))
-&gt; TcM (Injectivity, [TyConBinder], Type)
forall a.
Name -&gt; (TyCon -&gt; [TyConBinder] -&gt; Type -&gt; TcM a) -&gt; TcM a
</span><a href="GHC.Tc.Gen.HsType.html#bindTyClTyVars"><span class="hs-identifier hs-var">bindTyClTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">Name
IdP GhcRn
</span><a href="#local-6989586621681165995"><span class="hs-identifier hs-var">tc_name</span></a></span><span> </span><span class="annot"><span class="annottext">((TyCon
  -&gt; [TyConBinder] -&gt; Type -&gt; TcM (Injectivity, [TyConBinder], Type))
 -&gt; TcM (Injectivity, [TyConBinder], Type))
-&gt; (TyCon
    -&gt; [TyConBinder] -&gt; Type -&gt; TcM (Injectivity, [TyConBinder], Type))
-&gt; TcM (Injectivity, [TyConBinder], Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681165966"><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621681165966"><span class="hs-identifier hs-var">binders</span></a></span></span><span> </span><span id="local-6989586621681165965"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165965"><span class="hs-identifier hs-var">res_kind</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2609"></span><span>               </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681165964"><span class="annot"><span class="annottext">Injectivity
</span><a href="#local-6989586621681165964"><span class="hs-identifier hs-var">inj'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TyConBinder] -&gt; Maybe (LInjectivityAnn GhcRn) -&gt; TcM Injectivity
</span><a href="GHC.Tc.TyCl.html#tcInjectivity"><span class="hs-identifier hs-var">tcInjectivity</span></a></span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621681165966"><span class="hs-identifier hs-var">binders</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (LInjectivityAnn GhcRn)
</span><a href="#local-6989586621681165992"><span class="hs-identifier hs-var">inj</span></a></span><span>
</span><span id="line-2610"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(Injectivity, [TyConBinder], Type)
-&gt; TcM (Injectivity, [TyConBinder], Type)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Injectivity
</span><a href="#local-6989586621681165964"><span class="hs-identifier hs-var">inj'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621681165966"><span class="hs-identifier hs-var">binders</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165965"><span class="hs-identifier hs-var">res_kind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2611"></span><span>
</span><span id="line-2612"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcRn ()
</span><a href="GHC.Tc.TyCl.html#checkFamFlag"><span class="hs-identifier hs-var">checkFamFlag</span></a></span><span> </span><span class="annot"><span class="annottext">Name
IdP GhcRn
</span><a href="#local-6989586621681165995"><span class="hs-identifier hs-var">tc_name</span></a></span><span> </span><span class="hs-comment">-- make sure we have -XTypeFamilies</span><span>
</span><span id="line-2613"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; FamilyResultSig GhcRn -&gt; TcRn ()
</span><a href="GHC.Tc.TyCl.html#checkResultSigFlag"><span class="hs-identifier hs-var">checkResultSigFlag</span></a></span><span> </span><span class="annot"><span class="annottext">Name
IdP GhcRn
</span><a href="#local-6989586621681165995"><span class="hs-identifier hs-var">tc_name</span></a></span><span> </span><span class="annot"><span class="annottext">FamilyResultSig GhcRn
</span><a href="#local-6989586621681165994"><span class="hs-identifier hs-var">sig</span></a></span><span>
</span><span id="line-2614"></span><span>
</span><span id="line-2615"></span><span>         </span><span class="hs-comment">-- If Nothing, this is an abstract family in a hs-boot file;</span><span>
</span><span id="line-2616"></span><span>         </span><span class="hs-comment">-- but eqns might be empty in the Just case as well</span><span>
</span><span id="line-2617"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe [LTyFamInstEqn GhcRn]
</span><a href="#local-6989586621681165970"><span class="hs-identifier hs-var">mb_eqns</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2618"></span><span>           </span><span class="annot"><span class="annottext">Maybe [LTyFamInstEqn GhcRn]
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2619"></span><span>               </span><span class="annot"><span class="annottext">TyCon -&gt; TcRn TyCon
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(TyCon -&gt; TcRn TyCon) -&gt; TyCon -&gt; TcRn TyCon
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Name
-&gt; [TyConBinder]
-&gt; Type
-&gt; Maybe Name
-&gt; FamTyConFlav
-&gt; Maybe Class
-&gt; Injectivity
-&gt; TyCon
</span><a href="GHC.Core.TyCon.html#mkFamilyTyCon"><span class="hs-identifier hs-var">mkFamilyTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Name
IdP GhcRn
</span><a href="#local-6989586621681165995"><span class="hs-identifier hs-var">tc_name</span></a></span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621681165968"><span class="hs-identifier hs-var">binders</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165967"><span class="hs-identifier hs-var">res_kind</span></a></span><span>
</span><span id="line-2620"></span><span>                                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FamilyResultSig GhcRn -&gt; Maybe (IdP GhcRn)
forall (a :: Pass).
FamilyResultSig (GhcPass a) -&gt; Maybe (IdP (GhcPass a))
</span><a href="GHC.Hs.Decls.html#resultVariableName"><span class="hs-identifier hs-var">resultVariableName</span></a></span><span> </span><span class="annot"><span class="annottext">FamilyResultSig GhcRn
</span><a href="#local-6989586621681165994"><span class="hs-identifier hs-var">sig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2621"></span><span>                                      </span><span class="annot"><span class="annottext">FamTyConFlav
</span><a href="GHC.Core.TyCon.html#AbstractClosedSynFamilyTyCon"><span class="hs-identifier hs-var">AbstractClosedSynFamilyTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Class
</span><a href="#local-6989586621681165998"><span class="hs-identifier hs-var">parent</span></a></span><span>
</span><span id="line-2622"></span><span>                                      </span><span class="annot"><span class="annottext">Injectivity
</span><a href="#local-6989586621681165969"><span class="hs-identifier hs-var">inj'</span></a></span><span>
</span><span id="line-2623"></span><span>           </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681165962"><span class="annot"><span class="annottext">[LTyFamInstEqn GhcRn]
</span><a href="#local-6989586621681165962"><span class="hs-identifier hs-var">eqns</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-2624"></span><span>
</span><span id="line-2625"></span><span>         </span><span class="hs-comment">-- Process the equations, creating CoAxBranches</span><span>
</span><span id="line-2626"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681165961"><span class="annot"><span class="annottext">tc_fam_tc :: TyCon
</span><a href="#local-6989586621681165961"><span class="hs-identifier hs-var hs-var">tc_fam_tc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
-&gt; [TyConBinder]
-&gt; Type
-&gt; [(Name, TyVar)]
-&gt; Bool
-&gt; TyConFlavour
-&gt; TyCon
</span><a href="GHC.Core.TyCon.html#mkTcTyCon"><span class="hs-identifier hs-var">mkTcTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Name
IdP GhcRn
</span><a href="#local-6989586621681165995"><span class="hs-identifier hs-var">tc_name</span></a></span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621681165968"><span class="hs-identifier hs-var">binders</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165967"><span class="hs-identifier hs-var">res_kind</span></a></span><span>
</span><span id="line-2627"></span><span>                                   </span><span class="annot"><span class="annottext">[(Name, TyVar)]
</span><a href="GHC.Core.TyCon.html#noTcTyConScopedTyVars"><span class="hs-identifier hs-var">noTcTyConScopedTyVars</span></a></span><span>
</span><span id="line-2628"></span><span>                                   </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-comment">{- this doesn't matter here -}</span><span>
</span><span id="line-2629"></span><span>                                   </span><span class="annot"><span class="annottext">TyConFlavour
</span><a href="GHC.Core.TyCon.html#ClosedTypeFamilyFlavour"><span class="hs-identifier hs-var">ClosedTypeFamilyFlavour</span></a></span><span>
</span><span id="line-2630"></span><span>
</span><span id="line-2631"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681165959"><span class="annot"><span class="annottext">[KnotTied CoAxBranch]
</span><a href="#local-6989586621681165959"><span class="hs-identifier hs-var">branches</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(LTyFamInstEqn GhcRn -&gt; TcRn (KnotTied CoAxBranch))
-&gt; [LTyFamInstEqn GhcRn] -&gt; TcRn [KnotTied CoAxBranch]
forall a b. (a -&gt; TcRn b) -&gt; [a] -&gt; TcRn [b]
</span><a href="GHC.Tc.Utils.Monad.html#mapAndReportM"><span class="hs-identifier hs-var">mapAndReportM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon
-&gt; AssocInstInfo
-&gt; LTyFamInstEqn GhcRn
-&gt; TcRn (KnotTied CoAxBranch)
</span><a href="GHC.Tc.TyCl.html#tcTyFamInstEqn"><span class="hs-identifier hs-var">tcTyFamInstEqn</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165961"><span class="hs-identifier hs-var">tc_fam_tc</span></a></span><span> </span><span class="annot"><span class="annottext">AssocInstInfo
</span><a href="GHC.Tc.Instance.Class.html#NotAssociated"><span class="hs-identifier hs-var">NotAssociated</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LTyFamInstEqn GhcRn]
</span><a href="#local-6989586621681165962"><span class="hs-identifier hs-var">eqns</span></a></span><span>
</span><span id="line-2632"></span><span>         </span><span class="hs-comment">-- Do not attempt to drop equations dominated by earlier</span><span>
</span><span id="line-2633"></span><span>         </span><span class="hs-comment">-- ones here; in the case of mutual recursion with a data</span><span>
</span><span id="line-2634"></span><span>         </span><span class="hs-comment">-- type, we get a knot-tying failure.  Instead we check</span><span>
</span><span id="line-2635"></span><span>         </span><span class="hs-comment">-- for this afterwards, in GHC.Tc.Validity.checkValidCoAxiom</span><span>
</span><span id="line-2636"></span><span>         </span><span class="hs-comment">-- Example: tc265</span><span>
</span><span id="line-2637"></span><span>
</span><span id="line-2638"></span><span>         </span><span class="hs-comment">-- Create a CoAxiom, with the correct src location.</span><span>
</span><span id="line-2639"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681165958"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165958"><span class="hs-identifier hs-var">co_ax_name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Located Name -&gt; [[Type]] -&gt; TcRnIf TcGblEnv TcLclEnv Name
</span><a href="GHC.Tc.Utils.Env.html#newFamInstAxiomName"><span class="hs-identifier hs-var">newFamInstAxiomName</span></a></span><span> </span><span class="annot"><span class="annottext">Located Name
GenLocated SrcSpan (IdP GhcRn)
</span><a href="#local-6989586621681165996"><span class="hs-identifier hs-var">tc_lname</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2640"></span><span>
</span><span id="line-2641"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681165956"><span class="annot"><span class="annottext">mb_co_ax :: Maybe (CoAxiom Branched)
</span><a href="#local-6989586621681165956"><span class="hs-identifier hs-var hs-var">mb_co_ax</span></a></span></span><span>
</span><span id="line-2642"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[LTyFamInstEqn GhcRn] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[LTyFamInstEqn GhcRn]
</span><a href="#local-6989586621681165962"><span class="hs-identifier hs-var">eqns</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (CoAxiom Branched)
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>   </span><span class="hs-comment">-- mkBranchedCoAxiom fails on empty list</span><span>
</span><span id="line-2643"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoAxiom Branched -&gt; Maybe (CoAxiom Branched)
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; TyCon -&gt; [KnotTied CoAxBranch] -&gt; CoAxiom Branched
</span><a href="GHC.Core.FamInstEnv.html#mkBranchedCoAxiom"><span class="hs-identifier hs-var">mkBranchedCoAxiom</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165958"><span class="hs-identifier hs-var">co_ax_name</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165954"><span class="hs-identifier hs-var">fam_tc</span></a></span><span> </span><span class="annot"><span class="annottext">[KnotTied CoAxBranch]
</span><a href="#local-6989586621681165959"><span class="hs-identifier hs-var">branches</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2644"></span><span>
</span><span id="line-2645"></span><span>             </span><span id="local-6989586621681165954"><span class="annot"><span class="annottext">fam_tc :: TyCon
</span><a href="#local-6989586621681165954"><span class="hs-identifier hs-var hs-var">fam_tc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
-&gt; [TyConBinder]
-&gt; Type
-&gt; Maybe Name
-&gt; FamTyConFlav
-&gt; Maybe Class
-&gt; Injectivity
-&gt; TyCon
</span><a href="GHC.Core.TyCon.html#mkFamilyTyCon"><span class="hs-identifier hs-var">mkFamilyTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Name
IdP GhcRn
</span><a href="#local-6989586621681165995"><span class="hs-identifier hs-var">tc_name</span></a></span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621681165968"><span class="hs-identifier hs-var">binders</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165967"><span class="hs-identifier hs-var">res_kind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FamilyResultSig GhcRn -&gt; Maybe (IdP GhcRn)
forall (a :: Pass).
FamilyResultSig (GhcPass a) -&gt; Maybe (IdP (GhcPass a))
</span><a href="GHC.Hs.Decls.html#resultVariableName"><span class="hs-identifier hs-var">resultVariableName</span></a></span><span> </span><span class="annot"><span class="annottext">FamilyResultSig GhcRn
</span><a href="#local-6989586621681165994"><span class="hs-identifier hs-var">sig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2646"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (CoAxiom Branched) -&gt; FamTyConFlav
</span><a href="GHC.Core.TyCon.html#ClosedSynFamilyTyCon"><span class="hs-identifier hs-var">ClosedSynFamilyTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (CoAxiom Branched)
</span><a href="#local-6989586621681165956"><span class="hs-identifier hs-var">mb_co_ax</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Class
</span><a href="#local-6989586621681165998"><span class="hs-identifier hs-var">parent</span></a></span><span> </span><span class="annot"><span class="annottext">Injectivity
</span><a href="#local-6989586621681165969"><span class="hs-identifier hs-var">inj'</span></a></span><span>
</span><span id="line-2647"></span><span>
</span><span id="line-2648"></span><span>         </span><span class="hs-comment">-- We check for instance validity later, when doing validity</span><span>
</span><span id="line-2649"></span><span>         </span><span class="hs-comment">-- checking for the tycon. Exception: checking equations</span><span>
</span><span id="line-2650"></span><span>         </span><span class="hs-comment">-- overlap done by dropDominatedAxioms</span><span>
</span><span id="line-2651"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TcRn TyCon
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165954"><span class="hs-identifier hs-var">fam_tc</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span class="hs-cpp">

#if __GLASGOW_HASKELL__ &lt;= 810
</span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">panic</span><span> </span><span class="hs-string">&quot;tcFamInst1&quot;</span><span>  </span><span class="hs-comment">-- Silence pattern-exhaustiveness checker</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-2657"></span><span class="hs-comment">-- | Maybe return a list of Bools that say whether a type family was declared</span><span>
</span><span id="line-2658"></span><span class="hs-comment">-- injective in the corresponding type arguments. Length of the list is equal to</span><span>
</span><span id="line-2659"></span><span class="hs-comment">-- the number of arguments (including implicit kind/coercion arguments).</span><span>
</span><span id="line-2660"></span><span class="hs-comment">-- True on position</span><span>
</span><span id="line-2661"></span><span class="hs-comment">-- N means that a function is injective in its Nth argument. False means it is</span><span>
</span><span id="line-2662"></span><span class="hs-comment">-- not.</span><span>
</span><span id="line-2663"></span><span class="annot"><a href="GHC.Tc.TyCl.html#tcInjectivity"><span class="hs-identifier hs-type">tcInjectivity</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCon.html#TyConBinder"><span class="hs-identifier hs-type">TyConBinder</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Decls.html#LInjectivityAnn"><span class="hs-identifier hs-type">LInjectivityAnn</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2664"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#Injectivity"><span class="hs-identifier hs-type">Injectivity</span></a></span><span>
</span><span id="line-2665"></span><span id="tcInjectivity"><span class="annot"><span class="annottext">tcInjectivity :: [TyConBinder] -&gt; Maybe (LInjectivityAnn GhcRn) -&gt; TcM Injectivity
</span><a href="GHC.Tc.TyCl.html#tcInjectivity"><span class="hs-identifier hs-var hs-var">tcInjectivity</span></a></span></span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe (LInjectivityAnn GhcRn)
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-2666"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Injectivity -&gt; TcM Injectivity
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Injectivity
</span><a href="GHC.Core.TyCon.html#NotInjective"><span class="hs-identifier hs-var">NotInjective</span></a></span><span>
</span><span id="line-2667"></span><span>
</span><span id="line-2668"></span><span>  </span><span class="hs-comment">-- User provided an injectivity annotation, so for each tyvar argument we</span><span>
</span><span id="line-2669"></span><span>  </span><span class="hs-comment">-- check whether a type family was declared injective in that argument. We</span><span>
</span><span id="line-2670"></span><span>  </span><span class="hs-comment">-- return a list of Bools, where True means that corresponding type variable</span><span>
</span><span id="line-2671"></span><span>  </span><span class="hs-comment">-- was mentioned in lInjNames (type family is injective in that argument) and</span><span>
</span><span id="line-2672"></span><span>  </span><span class="hs-comment">-- False means that it was not mentioned in lInjNames (type family is not</span><span>
</span><span id="line-2673"></span><span>  </span><span class="hs-comment">-- injective in that type variable). We also extend injectivity information to</span><span>
</span><span id="line-2674"></span><span>  </span><span class="hs-comment">-- kind variables, so if a user declares:</span><span>
</span><span id="line-2675"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-2676"></span><span>  </span><span class="hs-comment">--   type family F (a :: k1) (b :: k2) = (r :: k3) | r -&gt; a</span><span>
</span><span id="line-2677"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-2678"></span><span>  </span><span class="hs-comment">-- then we mark both `a` and `k1` as injective.</span><span>
</span><span id="line-2679"></span><span>  </span><span class="hs-comment">-- NB: the return kind is considered to be *input* argument to a type family.</span><span>
</span><span id="line-2680"></span><span>  </span><span class="hs-comment">-- Since injectivity allows to infer input arguments from the result in theory</span><span>
</span><span id="line-2681"></span><span>  </span><span class="hs-comment">-- we should always mark the result kind variable (`k3` in this example) as</span><span>
</span><span id="line-2682"></span><span>  </span><span class="hs-comment">-- injective.  The reason is that result type has always an assigned kind and</span><span>
</span><span id="line-2683"></span><span>  </span><span class="hs-comment">-- therefore we can always infer the result kind if we know the result type.</span><span>
</span><span id="line-2684"></span><span>  </span><span class="hs-comment">-- But this does not seem to be useful in any way so we don't do it.  (Another</span><span>
</span><span id="line-2685"></span><span>  </span><span class="hs-comment">-- reason is that the implementation would not be straightforward.)</span><span>
</span><span id="line-2686"></span><span class="annot"><a href="GHC.Tc.TyCl.html#tcInjectivity"><span class="hs-identifier hs-var">tcInjectivity</span></a></span><span> </span><span id="local-6989586621681165951"><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621681165951"><span class="hs-identifier hs-var">tcbs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681165950"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681165950"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Decls.html#InjectivityAnn"><span class="hs-identifier hs-type">InjectivityAnn</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpan (IdP GhcRn)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681165948"><span class="annot"><span class="annottext">[GenLocated SrcSpan (IdP GhcRn)]
</span><a href="#local-6989586621681165948"><span class="hs-identifier hs-var">lInjNames</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2687"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcM Injectivity -&gt; TcM Injectivity
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681165950"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM Injectivity -&gt; TcM Injectivity)
-&gt; TcM Injectivity -&gt; TcM Injectivity
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2688"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681165947"><span class="annot"><span class="annottext">tvs :: [TyVar]
</span><a href="#local-6989586621681165947"><span class="hs-identifier hs-var hs-var">tvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyConBinder] -&gt; [TyVar]
forall tv argf. [VarBndr tv argf] -&gt; [tv]
</span><a href="GHC.Types.Var.html#binderVars"><span class="hs-identifier hs-var">binderVars</span></a></span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621681165951"><span class="hs-identifier hs-var">tcbs</span></a></span><span>
</span><span id="line-2689"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681165946"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681165946"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-2690"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Extension -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#xopt"><span class="hs-identifier hs-var">xopt</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><a href="../../ghc-boot-th/src/GHC.LanguageExtensions.Type.html#TypeFamilyDependencies"><span class="hs-identifier hs-var">LangExt.TypeFamilyDependencies</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681165946"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2691"></span><span>                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Illegal injectivity annotation&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-2692"></span><span>                  </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Use TypeFamilyDependencies to allow this&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-2693"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681165943"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165943"><span class="hs-identifier hs-var">inj_tvs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Located Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) TyVar)
-&gt; [Located Name] -&gt; TcM [TyVar]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) TyVar
</span><a href="GHC.Tc.Utils.Env.html#tcLookupTyVar"><span class="hs-identifier hs-var">tcLookupTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) TyVar)
-&gt; (Located Name -&gt; Name)
-&gt; Located Name
-&gt; IOEnv (Env TcGblEnv TcLclEnv) TyVar
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Located Name -&gt; Name
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Located Name]
[GenLocated SrcSpan (IdP GhcRn)]
</span><a href="#local-6989586621681165948"><span class="hs-identifier hs-var">lInjNames</span></a></span><span>
</span><span id="line-2694"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681165942"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165942"><span class="hs-identifier hs-var">inj_tvs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TyVar -&gt; IOEnv (Env TcGblEnv TcLclEnv) TyVar)
-&gt; [TyVar] -&gt; TcM [TyVar]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; TyVar -&gt; IOEnv (Env TcGblEnv TcLclEnv) TyVar
TyVar -&gt; IOEnv (Env TcGblEnv TcLclEnv) TyVar
</span><a href="GHC.Tc.Utils.TcMType.html#zonkTcTyVarToTyVar"><span class="hs-identifier hs-var">zonkTcTyVarToTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165943"><span class="hs-identifier hs-var">inj_tvs</span></a></span><span> </span><span class="hs-comment">-- zonk the kinds</span><span>
</span><span id="line-2695"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681165941"><span class="annot"><span class="annottext">inj_ktvs :: VarSet
</span><a href="#local-6989586621681165941"><span class="hs-identifier hs-var hs-var">inj_ktvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TyVar -&gt; Bool) -&gt; VarSet -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#filterVarSet"><span class="hs-identifier hs-var">filterVarSet</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar -&gt; Bool
</span><a href="GHC.Types.Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">(VarSet -&gt; VarSet) -&gt; VarSet -&gt; VarSet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>  </span><span class="hs-comment">-- no injective coercion vars</span><span>
</span><span id="line-2696"></span><span>                        </span><span class="annot"><span class="annottext">VarSet -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#closeOverKinds"><span class="hs-identifier hs-var">closeOverKinds</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyVar] -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#mkVarSet"><span class="hs-identifier hs-var">mkVarSet</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165942"><span class="hs-identifier hs-var">inj_tvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2697"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681165936"><span class="annot"><span class="annottext">inj_bools :: [Bool]
</span><a href="#local-6989586621681165936"><span class="hs-identifier hs-var hs-var">inj_bools</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TyVar -&gt; Bool) -&gt; [TyVar] -&gt; [Bool]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyVar -&gt; VarSet -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#elemVarSet"><span class="hs-operator hs-var">`elemVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621681165941"><span class="hs-identifier hs-var">inj_ktvs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165947"><span class="hs-identifier hs-var">tvs</span></a></span><span>
</span><span id="line-2698"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcInjectivity&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165947"><span class="hs-identifier hs-var">tvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Located Name] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Located Name]
[GenLocated SrcSpan (IdP GhcRn)]
</span><a href="#local-6989586621681165948"><span class="hs-identifier hs-var">lInjNames</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165942"><span class="hs-identifier hs-var">inj_tvs</span></a></span><span>
</span><span id="line-2699"></span><span>                                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621681165941"><span class="hs-identifier hs-var">inj_ktvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Bool] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621681165936"><span class="hs-identifier hs-var">inj_bools</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2700"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Injectivity -&gt; TcM Injectivity
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Injectivity -&gt; TcM Injectivity) -&gt; Injectivity -&gt; TcM Injectivity
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Bool] -&gt; Injectivity
</span><a href="GHC.Core.TyCon.html#Injective"><span class="hs-identifier hs-var">Injective</span></a></span><span> </span><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621681165936"><span class="hs-identifier hs-var">inj_bools</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2701"></span><span>
</span><span id="line-2702"></span><span class="annot"><a href="GHC.Tc.TyCl.html#tcTySynRhs"><span class="hs-identifier hs-type">tcTySynRhs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.TyCl.Utils.html#RolesInfo"><span class="hs-identifier hs-type">RolesInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-2703"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Type.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span>
</span><span id="line-2704"></span><span id="tcTySynRhs"><span class="annot"><span class="annottext">tcTySynRhs :: (Name -&gt; [Role]) -&gt; Name -&gt; LHsType GhcRn -&gt; TcRn TyCon
</span><a href="GHC.Tc.TyCl.html#tcTySynRhs"><span class="hs-identifier hs-var hs-var">tcTySynRhs</span></a></span></span><span> </span><span id="local-6989586621681165934"><span class="annot"><span class="annottext">Name -&gt; [Role]
</span><a href="#local-6989586621681165934"><span class="hs-identifier hs-var">roles_info</span></a></span></span><span> </span><span id="local-6989586621681165933"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165933"><span class="hs-identifier hs-var">tc_name</span></a></span></span><span> </span><span id="local-6989586621681165932"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621681165932"><span class="hs-identifier hs-var">hs_ty</span></a></span></span><span>
</span><span id="line-2705"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
-&gt; (TyCon -&gt; [TyConBinder] -&gt; Type -&gt; TcRn TyCon) -&gt; TcRn TyCon
forall a.
Name -&gt; (TyCon -&gt; [TyConBinder] -&gt; Type -&gt; TcM a) -&gt; TcM a
</span><a href="GHC.Tc.Gen.HsType.html#bindTyClTyVars"><span class="hs-identifier hs-var">bindTyClTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165933"><span class="hs-identifier hs-var">tc_name</span></a></span><span> </span><span class="annot"><span class="annottext">((TyCon -&gt; [TyConBinder] -&gt; Type -&gt; TcRn TyCon) -&gt; TcRn TyCon)
-&gt; (TyCon -&gt; [TyConBinder] -&gt; Type -&gt; TcRn TyCon) -&gt; TcRn TyCon
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681165931"><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621681165931"><span class="hs-identifier hs-var">binders</span></a></span></span><span> </span><span id="local-6989586621681165930"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165930"><span class="hs-identifier hs-var">res_kind</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2706"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681165929"><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681165929"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcLclEnv
forall gbl lcl. TcRnIf gbl lcl lcl
</span><a href="GHC.Tc.Utils.Monad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a></span><span>
</span><span id="line-2707"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc-syn&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165933"><span class="hs-identifier hs-var">tc_name</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">TcTypeEnv -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcLclEnv -&gt; TcTypeEnv
</span><a href="GHC.Tc.Types.html#tcl_env"><span class="hs-identifier hs-var hs-var">tcl_env</span></a></span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681165929"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2708"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681165926"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165926"><span class="hs-identifier hs-var">rhs_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM Type -&gt; TcM Type
forall r. TcM r -&gt; TcM r
</span><a href="GHC.Tc.Utils.Monad.html#pushTcLevelM_"><span class="hs-identifier hs-var">pushTcLevelM_</span></a></span><span>   </span><span class="annot"><span class="annottext">(TcM Type -&gt; TcM Type) -&gt; TcM Type -&gt; TcM Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2709"></span><span>                   </span><span class="annot"><span class="annottext">TcM Type -&gt; TcM Type
forall r. TcM r -&gt; TcM r
</span><a href="GHC.Tc.Solver.html#solveEqualities"><span class="hs-identifier hs-var">solveEqualities</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM Type -&gt; TcM Type) -&gt; TcM Type -&gt; TcM Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2710"></span><span>                   </span><span class="annot"><span class="annottext">LHsType GhcRn -&gt; ContextKind -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tcCheckLHsType"><span class="hs-identifier hs-var">tcCheckLHsType</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621681165932"><span class="hs-identifier hs-var">hs_ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; ContextKind
</span><a href="GHC.Tc.Gen.HsType.html#TheKind"><span class="hs-identifier hs-var">TheKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165930"><span class="hs-identifier hs-var">res_kind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2711"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681165925"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165925"><span class="hs-identifier hs-var">rhs_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Utils.Zonk.html#zonkTcTypeToType"><span class="hs-identifier hs-var">zonkTcTypeToType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165926"><span class="hs-identifier hs-var">rhs_ty</span></a></span><span>
</span><span id="line-2712"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681165923"><span class="annot"><span class="annottext">roles :: [Role]
</span><a href="#local-6989586621681165923"><span class="hs-identifier hs-var hs-var">roles</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Role]
</span><a href="#local-6989586621681165934"><span class="hs-identifier hs-var">roles_info</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165933"><span class="hs-identifier hs-var">tc_name</span></a></span><span>
</span><span id="line-2713"></span><span>             </span><span id="local-6989586621681165922"><span class="annot"><span class="annottext">tycon :: TyCon
</span><a href="#local-6989586621681165922"><span class="hs-identifier hs-var hs-var">tycon</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [TyConBinder] -&gt; Type -&gt; [Role] -&gt; Type -&gt; TyCon
</span><a href="GHC.Core.Type.html#buildSynTyCon"><span class="hs-identifier hs-var">buildSynTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165933"><span class="hs-identifier hs-var">tc_name</span></a></span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621681165931"><span class="hs-identifier hs-var">binders</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165930"><span class="hs-identifier hs-var">res_kind</span></a></span><span> </span><span class="annot"><span class="annottext">[Role]
</span><a href="#local-6989586621681165923"><span class="hs-identifier hs-var">roles</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165925"><span class="hs-identifier hs-var">rhs_ty</span></a></span><span>
</span><span id="line-2714"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TcRn TyCon
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165922"><span class="hs-identifier hs-var">tycon</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2715"></span><span>
</span><span id="line-2716"></span><span class="annot"><a href="GHC.Tc.TyCl.html#tcDataDefn"><span class="hs-identifier hs-type">tcDataDefn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.TyCl.Utils.html#RolesInfo"><span class="hs-identifier hs-type">RolesInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-2717"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Decls.html#HsDataDefn"><span class="hs-identifier hs-type">HsDataDefn</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Deriv.html#DerivInfo"><span class="hs-identifier hs-type">DerivInfo</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2718"></span><span>  </span><span class="hs-comment">-- NB: not used for newtype/data instances (whether associated or not)</span><span>
</span><span id="line-2719"></span><span id="tcDataDefn"><span class="annot"><span class="annottext">tcDataDefn :: SDoc
-&gt; (Name -&gt; [Role])
-&gt; Name
-&gt; HsDataDefn GhcRn
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (TyCon, [DerivInfo])
</span><a href="GHC.Tc.TyCl.html#tcDataDefn"><span class="hs-identifier hs-var hs-var">tcDataDefn</span></a></span></span><span> </span><span id="local-6989586621681165920"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681165920"><span class="hs-identifier hs-var">err_ctxt</span></a></span></span><span> </span><span id="local-6989586621681165919"><span class="annot"><span class="annottext">Name -&gt; [Role]
</span><a href="#local-6989586621681165919"><span class="hs-identifier hs-var">roles_info</span></a></span></span><span> </span><span id="local-6989586621681165918"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165918"><span class="hs-identifier hs-var">tc_name</span></a></span></span><span>
</span><span id="line-2720"></span><span>           </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Decls.html#HsDataDefn"><span class="hs-identifier hs-type">HsDataDefn</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">dd_ND :: forall pass. HsDataDefn pass -&gt; NewOrData
</span><a href="GHC.Hs.Decls.html#dd_ND"><span class="hs-identifier hs-var">dd_ND</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681165917"><span class="annot"><span class="annottext">NewOrData
</span><a href="#local-6989586621681165917"><span class="hs-identifier hs-var">new_or_data</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dd_cType :: forall pass. HsDataDefn pass -&gt; Maybe (Located CType)
</span><a href="GHC.Hs.Decls.html#dd_cType"><span class="hs-identifier hs-var">dd_cType</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681165915"><span class="annot"><span class="annottext">Maybe (Located CType)
</span><a href="#local-6989586621681165915"><span class="hs-identifier hs-var">cType</span></a></span></span><span>
</span><span id="line-2721"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dd_ctxt :: forall pass. HsDataDefn pass -&gt; LHsContext pass
</span><a href="GHC.Hs.Decls.html#dd_ctxt"><span class="hs-identifier hs-var">dd_ctxt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681165914"><span class="annot"><span class="annottext">GenLocated SrcSpan (HsContext GhcRn)
</span><a href="#local-6989586621681165914"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span>
</span><span id="line-2722"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dd_kindSig :: forall pass. HsDataDefn pass -&gt; Maybe (LHsKind pass)
</span><a href="GHC.Hs.Decls.html#dd_kindSig"><span class="hs-identifier hs-var">dd_kindSig</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681165913"><span class="annot"><span class="annottext">Maybe (LHsType GhcRn)
</span><a href="#local-6989586621681165913"><span class="hs-identifier hs-var">mb_ksig</span></a></span></span><span>  </span><span class="hs-comment">-- Already in tc's kind</span><span>
</span><span id="line-2723"></span><span>                                               </span><span class="hs-comment">-- via inferInitialKinds</span><span>
</span><span id="line-2724"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dd_cons :: forall pass. HsDataDefn pass -&gt; [LConDecl pass]
</span><a href="GHC.Hs.Decls.html#dd_cons"><span class="hs-identifier hs-var">dd_cons</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681165912"><span class="annot"><span class="annottext">[LConDecl GhcRn]
</span><a href="#local-6989586621681165912"><span class="hs-identifier hs-var">cons</span></a></span></span><span>
</span><span id="line-2725"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">dd_derivs :: forall pass. HsDataDefn pass -&gt; HsDeriving pass
</span><a href="GHC.Hs.Decls.html#dd_derivs"><span class="hs-identifier hs-var">dd_derivs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681165911"><span class="annot"><span class="annottext">HsDeriving GhcRn
</span><a href="#local-6989586621681165911"><span class="hs-identifier hs-var">derivs</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-2726"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
-&gt; (TyCon
    -&gt; [TyConBinder]
    -&gt; Type
    -&gt; IOEnv (Env TcGblEnv TcLclEnv) (TyCon, [DerivInfo]))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (TyCon, [DerivInfo])
forall a.
Name -&gt; (TyCon -&gt; [TyConBinder] -&gt; Type -&gt; TcM a) -&gt; TcM a
</span><a href="GHC.Tc.Gen.HsType.html#bindTyClTyVars"><span class="hs-identifier hs-var">bindTyClTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165918"><span class="hs-identifier hs-var">tc_name</span></a></span><span> </span><span class="annot"><span class="annottext">((TyCon
  -&gt; [TyConBinder]
  -&gt; Type
  -&gt; IOEnv (Env TcGblEnv TcLclEnv) (TyCon, [DerivInfo]))
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) (TyCon, [DerivInfo]))
-&gt; (TyCon
    -&gt; [TyConBinder]
    -&gt; Type
    -&gt; IOEnv (Env TcGblEnv TcLclEnv) (TyCon, [DerivInfo]))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (TyCon, [DerivInfo])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681165910"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165910"><span class="hs-identifier hs-var">tctc</span></a></span></span><span> </span><span id="local-6989586621681165909"><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621681165909"><span class="hs-identifier hs-var">tycon_binders</span></a></span></span><span> </span><span id="local-6989586621681165908"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165908"><span class="hs-identifier hs-var">res_kind</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2727"></span><span>       </span><span class="hs-comment">-- 'tctc' is a 'TcTyCon' and has the 'tcTyConScopedTyVars' that we need</span><span>
</span><span id="line-2728"></span><span>       </span><span class="hs-comment">-- unlike the finalized 'tycon' defined above which is an 'AlgTyCon'</span><span>
</span><span id="line-2729"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-2730"></span><span>       </span><span class="hs-comment">-- The TyCon tyvars must scope over</span><span>
</span><span id="line-2731"></span><span>       </span><span class="hs-comment">--    - the stupid theta (dd_ctxt)</span><span>
</span><span id="line-2732"></span><span>       </span><span class="hs-comment">--    - for H98 constructors only, the ConDecl</span><span>
</span><span id="line-2733"></span><span>       </span><span class="hs-comment">-- But it does no harm to bring them into scope</span><span>
</span><span id="line-2734"></span><span>       </span><span class="hs-comment">-- over GADT ConDecls as well; and it's awkward not to</span><span>
</span><span id="line-2735"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681165907"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681165907"><span class="hs-identifier hs-var">gadt_syntax</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name
-&gt; NewOrData
-&gt; GenLocated SrcSpan (HsContext GhcRn)
-&gt; [LConDecl GhcRn]
-&gt; TcRnIf TcGblEnv TcLclEnv Bool
</span><a href="GHC.Tc.TyCl.html#dataDeclChecks"><span class="hs-identifier hs-var">dataDeclChecks</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165918"><span class="hs-identifier hs-var">tc_name</span></a></span><span> </span><span class="annot"><span class="annottext">NewOrData
</span><a href="#local-6989586621681165917"><span class="hs-identifier hs-var">new_or_data</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpan (HsContext GhcRn)
</span><a href="#local-6989586621681165914"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">[LConDecl GhcRn]
</span><a href="#local-6989586621681165912"><span class="hs-identifier hs-var">cons</span></a></span><span>
</span><span id="line-2736"></span><span>         </span><span class="hs-comment">-- see Note [Datatype return kinds]</span><span>
</span><span id="line-2737"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681165906"><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621681165906"><span class="hs-identifier hs-var">extra_bndrs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681165905"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165905"><span class="hs-identifier hs-var">final_res_kind</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TyConBinder] -&gt; Type -&gt; TcM ([TyConBinder], Type)
</span><a href="GHC.Tc.Gen.HsType.html#etaExpandAlgTyCon"><span class="hs-identifier hs-var">etaExpandAlgTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621681165909"><span class="hs-identifier hs-var">tycon_binders</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165908"><span class="hs-identifier hs-var">res_kind</span></a></span><span>
</span><span id="line-2738"></span><span>
</span><span id="line-2739"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681165903"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681165903"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-2740"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681165902"><span class="annot"><span class="annottext">hsc_src :: HscSource
</span><a href="#local-6989586621681165902"><span class="hs-identifier hs-var hs-var">hsc_src</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; HscSource
</span><a href="GHC.Tc.Types.html#tcg_src"><span class="hs-identifier hs-var hs-var">tcg_src</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681165903"><span class="hs-identifier hs-var">tcg_env</span></a></span><span>
</span><span id="line-2741"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRn () -&gt; TcRn ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base/src/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscSource -&gt; [LConDecl GhcRn] -&gt; Bool
forall {a}. HscSource -&gt; [a] -&gt; Bool
</span><a href="#local-6989586621681165901"><span class="hs-identifier hs-var">mk_permissive_kind</span></a></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621681165902"><span class="hs-identifier hs-var">hsc_src</span></a></span><span> </span><span class="annot"><span class="annottext">[LConDecl GhcRn]
</span><a href="#local-6989586621681165912"><span class="hs-identifier hs-var">cons</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcRn ()) -&gt; TcRn () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2742"></span><span>         </span><span class="annot"><span class="annottext">DataSort -&gt; Type -&gt; TcRn ()
</span><a href="GHC.Tc.Gen.HsType.html#checkDataKindSig"><span class="hs-identifier hs-var">checkDataKindSig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NewOrData -&gt; DataSort
</span><a href="GHC.Tc.Gen.HsType.html#DataDeclSort"><span class="hs-identifier hs-var">DataDeclSort</span></a></span><span> </span><span class="annot"><span class="annottext">NewOrData
</span><a href="#local-6989586621681165917"><span class="hs-identifier hs-var">new_or_data</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165905"><span class="hs-identifier hs-var">final_res_kind</span></a></span><span>
</span><span id="line-2743"></span><span>
</span><span id="line-2744"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681165899"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681165899"><span class="hs-identifier hs-var">stupid_tc_theta</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM [Type] -&gt; TcM [Type]
forall r. TcM r -&gt; TcM r
</span><a href="GHC.Tc.Utils.Monad.html#pushTcLevelM_"><span class="hs-identifier hs-var">pushTcLevelM_</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM [Type] -&gt; TcM [Type]) -&gt; TcM [Type] -&gt; TcM [Type]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TcM [Type] -&gt; TcM [Type]
forall r. TcM r -&gt; TcM r
</span><a href="GHC.Tc.Solver.html#solveEqualities"><span class="hs-identifier hs-var">solveEqualities</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM [Type] -&gt; TcM [Type]) -&gt; TcM [Type] -&gt; TcM [Type]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpan (HsContext GhcRn) -&gt; TcM [Type]
</span><a href="GHC.Tc.Gen.HsType.html#tcHsContext"><span class="hs-identifier hs-var">tcHsContext</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpan (HsContext GhcRn)
</span><a href="#local-6989586621681165914"><span class="hs-identifier hs-var">ctxt</span></a></span><span>
</span><span id="line-2745"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681165898"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681165898"><span class="hs-identifier hs-var">stupid_theta</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; TcM [Type]
</span><a href="GHC.Tc.Utils.Zonk.html#zonkTcTypesToTypes"><span class="hs-identifier hs-var">zonkTcTypesToTypes</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681165899"><span class="hs-identifier hs-var">stupid_tc_theta</span></a></span><span>
</span><span id="line-2746"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681165896"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681165896"><span class="hs-identifier hs-var">kind_signatures</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall gbl lcl. Extension -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><a href="../../ghc-boot-th/src/GHC.LanguageExtensions.Type.html#KindSignatures"><span class="hs-identifier hs-var">LangExt.KindSignatures</span></a></span><span>
</span><span id="line-2747"></span><span>
</span><span id="line-2748"></span><span>             </span><span class="hs-comment">-- Check that we don't use kind signatures without Glasgow extensions</span><span>
</span><span id="line-2749"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRn () -&gt; TcRn ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (LHsType GhcRn) -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../../base/src/Data.Maybe.html#isJust"><span class="hs-identifier hs-var">isJust</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (LHsType GhcRn)
</span><a href="#local-6989586621681165913"><span class="hs-identifier hs-var">mb_ksig</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcRn ()) -&gt; TcRn () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2750"></span><span>         </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681165896"><span class="hs-identifier hs-var">kind_signatures</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#badSigTyDecl"><span class="hs-identifier hs-var">badSigTyDecl</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165918"><span class="hs-identifier hs-var">tc_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2751"></span><span>
</span><span id="line-2752"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681165891"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165891"><span class="hs-identifier hs-var">tycon</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TyCon -&gt; TcRn TyCon) -&gt; TcRn TyCon
forall a env. (a -&gt; IOEnv env a) -&gt; IOEnv env a
</span><a href="GHC.Data.IOEnv.html#fixM"><span class="hs-identifier hs-var">fixM</span></a></span><span> </span><span class="annot"><span class="annottext">((TyCon -&gt; TcRn TyCon) -&gt; TcRn TyCon)
-&gt; (TyCon -&gt; TcRn TyCon) -&gt; TcRn TyCon
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681165890"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165890"><span class="hs-identifier hs-var">tycon</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2753"></span><span>             </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681165889"><span class="annot"><span class="annottext">final_bndrs :: [TyConBinder]
</span><a href="#local-6989586621681165889"><span class="hs-identifier hs-var hs-var">final_bndrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621681165909"><span class="hs-identifier hs-var">tycon_binders</span></a></span><span> </span><span class="annot"><span class="annottext">[TyConBinder] -&gt; [TyConBinder] -&gt; [TyConBinder]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="GHC.Utils.Misc.html#chkAppend"><span class="hs-operator hs-var">`chkAppend`</span></a></span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621681165906"><span class="hs-identifier hs-var">extra_bndrs</span></a></span><span>
</span><span id="line-2754"></span><span>                   </span><span id="local-6989586621681165887"><span class="annot"><span class="annottext">res_ty :: Type
</span><a href="#local-6989586621681165887"><span class="hs-identifier hs-var hs-var">res_ty</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165890"><span class="hs-identifier hs-var">tycon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyVar] -&gt; [Type]
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyConBinder] -&gt; [TyVar]
forall tv argf. [VarBndr tv argf] -&gt; [tv]
</span><a href="GHC.Types.Var.html#binderVars"><span class="hs-identifier hs-var">binderVars</span></a></span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621681165889"><span class="hs-identifier hs-var">final_bndrs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2755"></span><span>                   </span><span id="local-6989586621681165885"><span class="annot"><span class="annottext">roles :: [Role]
</span><a href="#local-6989586621681165885"><span class="hs-identifier hs-var hs-var">roles</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Role]
</span><a href="#local-6989586621681165919"><span class="hs-identifier hs-var">roles_info</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165918"><span class="hs-identifier hs-var">tc_name</span></a></span><span>
</span><span id="line-2756"></span><span>             </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681165884"><span class="annot"><span class="annottext">[DataCon]
</span><a href="#local-6989586621681165884"><span class="hs-identifier hs-var">data_cons</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon
-&gt; NewOrData
-&gt; [TyConBinder]
-&gt; Type
-&gt; Type
-&gt; [LConDecl GhcRn]
-&gt; TcM [DataCon]
</span><a href="GHC.Tc.TyCl.html#tcConDecls"><span class="hs-identifier hs-var">tcConDecls</span></a></span><span>
</span><span id="line-2757"></span><span>                              </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165890"><span class="hs-identifier hs-var">tycon</span></a></span><span>
</span><span id="line-2758"></span><span>                              </span><span class="annot"><span class="annottext">NewOrData
</span><a href="#local-6989586621681165917"><span class="hs-identifier hs-var">new_or_data</span></a></span><span>
</span><span id="line-2759"></span><span>                              </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621681165889"><span class="hs-identifier hs-var">final_bndrs</span></a></span><span>
</span><span id="line-2760"></span><span>                              </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165905"><span class="hs-identifier hs-var">final_res_kind</span></a></span><span>
</span><span id="line-2761"></span><span>                              </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165887"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-2762"></span><span>                              </span><span class="annot"><span class="annottext">[LConDecl GhcRn]
</span><a href="#local-6989586621681165912"><span class="hs-identifier hs-var">cons</span></a></span><span>
</span><span id="line-2763"></span><span>             </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681165883"><span class="annot"><span class="annottext">AlgTyConRhs
</span><a href="#local-6989586621681165883"><span class="hs-identifier hs-var">tc_rhs</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscSource
-&gt; TyCon -&gt; [DataCon] -&gt; IOEnv (Env TcGblEnv TcLclEnv) AlgTyConRhs
</span><a href="#local-6989586621681165882"><span class="hs-identifier hs-var">mk_tc_rhs</span></a></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621681165902"><span class="hs-identifier hs-var">hsc_src</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165890"><span class="hs-identifier hs-var">tycon</span></a></span><span> </span><span class="annot"><span class="annottext">[DataCon]
</span><a href="#local-6989586621681165884"><span class="hs-identifier hs-var">data_cons</span></a></span><span>
</span><span id="line-2764"></span><span>             </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681165881"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165881"><span class="hs-identifier hs-var">tc_rep_nm</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcRnIf TcGblEnv TcLclEnv Name
forall gbl lcl. Name -&gt; TcRnIf gbl lcl Name
</span><a href="GHC.Tc.TyCl.Build.html#newTyConRepName"><span class="hs-identifier hs-var">newTyConRepName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165918"><span class="hs-identifier hs-var">tc_name</span></a></span><span>
</span><span id="line-2765"></span><span>             </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TcRn TyCon
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
-&gt; [TyConBinder]
-&gt; Type
-&gt; [Role]
-&gt; Maybe CType
-&gt; [Type]
-&gt; AlgTyConRhs
-&gt; AlgTyConFlav
-&gt; Bool
-&gt; TyCon
</span><a href="GHC.Core.TyCon.html#mkAlgTyCon"><span class="hs-identifier hs-var">mkAlgTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165918"><span class="hs-identifier hs-var">tc_name</span></a></span><span>
</span><span id="line-2766"></span><span>                                  </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621681165889"><span class="hs-identifier hs-var">final_bndrs</span></a></span><span>
</span><span id="line-2767"></span><span>                                  </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165905"><span class="hs-identifier hs-var">final_res_kind</span></a></span><span>
</span><span id="line-2768"></span><span>                                  </span><span class="annot"><span class="annottext">[Role]
</span><a href="#local-6989586621681165885"><span class="hs-identifier hs-var">roles</span></a></span><span>
</span><span id="line-2769"></span><span>                                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Located CType -&gt; CType) -&gt; Maybe (Located CType) -&gt; Maybe CType
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Located CType -&gt; CType
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Located CType)
</span><a href="#local-6989586621681165915"><span class="hs-identifier hs-var">cType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2770"></span><span>                                  </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681165898"><span class="hs-identifier hs-var">stupid_theta</span></a></span><span> </span><span class="annot"><span class="annottext">AlgTyConRhs
</span><a href="#local-6989586621681165883"><span class="hs-identifier hs-var">tc_rhs</span></a></span><span>
</span><span id="line-2771"></span><span>                                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; AlgTyConFlav
</span><a href="GHC.Core.TyCon.html#VanillaAlgTyCon"><span class="hs-identifier hs-var">VanillaAlgTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165881"><span class="hs-identifier hs-var">tc_rep_nm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2772"></span><span>                                  </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681165907"><span class="hs-identifier hs-var">gadt_syntax</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2773"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681165878"><span class="annot"><span class="annottext">deriv_info :: DerivInfo
</span><a href="#local-6989586621681165878"><span class="hs-identifier hs-var hs-var">deriv_info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DerivInfo :: TyCon
-&gt; [(Name, TyVar)]
-&gt; [LHsDerivingClause GhcRn]
-&gt; SDoc
-&gt; DerivInfo
</span><a href="GHC.Tc.Deriv.html#DerivInfo"><span class="hs-identifier hs-type">DerivInfo</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">di_rep_tc :: TyCon
</span><a href="GHC.Tc.Deriv.html#di_rep_tc"><span class="hs-identifier hs-var">di_rep_tc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165891"><span class="hs-identifier hs-var">tycon</span></a></span><span>
</span><span id="line-2774"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">di_scoped_tvs :: [(Name, TyVar)]
</span><a href="GHC.Tc.Deriv.html#di_scoped_tvs"><span class="hs-identifier hs-var">di_scoped_tvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [(Name, TyVar)]
</span><a href="GHC.Core.TyCon.html#tcTyConScopedTyVars"><span class="hs-identifier hs-var hs-var">tcTyConScopedTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165910"><span class="hs-identifier hs-var">tctc</span></a></span><span>
</span><span id="line-2775"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">di_clauses :: [LHsDerivingClause GhcRn]
</span><a href="GHC.Tc.Deriv.html#di_clauses"><span class="hs-identifier hs-var">di_clauses</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsDeriving GhcRn -&gt; [LHsDerivingClause GhcRn]
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">HsDeriving GhcRn
</span><a href="#local-6989586621681165911"><span class="hs-identifier hs-var">derivs</span></a></span><span>
</span><span id="line-2776"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">di_ctxt :: SDoc
</span><a href="GHC.Tc.Deriv.html#di_ctxt"><span class="hs-identifier hs-var">di_ctxt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681165920"><span class="hs-identifier hs-var">err_ctxt</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2777"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcDataDefn&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165918"><span class="hs-identifier hs-var">tc_name</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">[TyConBinder] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621681165909"><span class="hs-identifier hs-var">tycon_binders</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">[TyConBinder] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621681165906"><span class="hs-identifier hs-var">extra_bndrs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2778"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(TyCon, [DerivInfo])
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (TyCon, [DerivInfo])
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165891"><span class="hs-identifier hs-var">tycon</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">DerivInfo
</span><a href="#local-6989586621681165878"><span class="hs-identifier hs-var">deriv_info</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2779"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2780"></span><span>    </span><span class="hs-comment">-- Abstract data types in hsig files can have arbitrary kinds,</span><span>
</span><span id="line-2781"></span><span>    </span><span class="hs-comment">-- because they may be implemented by type synonyms</span><span>
</span><span id="line-2782"></span><span>    </span><span class="hs-comment">-- (which themselves can have arbitrary kinds, not just *). See #13955.</span><span>
</span><span id="line-2783"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-2784"></span><span>    </span><span class="hs-comment">-- Note that this is only a property that data type declarations possess,</span><span>
</span><span id="line-2785"></span><span>    </span><span class="hs-comment">-- so one could not have, say, a data family instance in an hsig file that</span><span>
</span><span id="line-2786"></span><span>    </span><span class="hs-comment">-- has kind `Bool`. Therefore, this check need only occur in the code that</span><span>
</span><span id="line-2787"></span><span>    </span><span class="hs-comment">-- typechecks data type declarations.</span><span>
</span><span id="line-2788"></span><span>    </span><span id="local-6989586621681165901"><span class="annot"><span class="annottext">mk_permissive_kind :: HscSource -&gt; [a] -&gt; Bool
</span><a href="#local-6989586621681165901"><span class="hs-identifier hs-var hs-var">mk_permissive_kind</span></a></span></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="GHC.Driver.Phases.html#HsigFile"><span class="hs-identifier hs-var">HsigFile</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-2789"></span><span>    </span><span class="annot"><a href="#local-6989586621681165901"><span class="hs-identifier hs-var">mk_permissive_kind</span></a></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2790"></span><span>
</span><span id="line-2791"></span><span>    </span><span class="hs-comment">-- In hs-boot, a 'data' declaration with no constructors</span><span>
</span><span id="line-2792"></span><span>    </span><span class="hs-comment">-- indicates a nominally distinct abstract data type.</span><span>
</span><span id="line-2793"></span><span>    </span><span id="local-6989586621681165882"><span class="annot"><span class="annottext">mk_tc_rhs :: HscSource
-&gt; TyCon -&gt; [DataCon] -&gt; IOEnv (Env TcGblEnv TcLclEnv) AlgTyConRhs
</span><a href="#local-6989586621681165882"><span class="hs-identifier hs-var hs-var">mk_tc_rhs</span></a></span></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="GHC.Driver.Phases.html#HsBootFile"><span class="hs-identifier hs-var">HsBootFile</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2794"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AlgTyConRhs -&gt; IOEnv (Env TcGblEnv TcLclEnv) AlgTyConRhs
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">AlgTyConRhs
</span><a href="GHC.Core.TyCon.html#AbstractTyCon"><span class="hs-identifier hs-var">AbstractTyCon</span></a></span><span>
</span><span id="line-2795"></span><span>
</span><span id="line-2796"></span><span>    </span><span class="annot"><a href="#local-6989586621681165882"><span class="hs-identifier hs-var">mk_tc_rhs</span></a></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="GHC.Driver.Phases.html#HsigFile"><span class="hs-identifier hs-var">HsigFile</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ditto</span><span>
</span><span id="line-2797"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AlgTyConRhs -&gt; IOEnv (Env TcGblEnv TcLclEnv) AlgTyConRhs
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">AlgTyConRhs
</span><a href="GHC.Core.TyCon.html#AbstractTyCon"><span class="hs-identifier hs-var">AbstractTyCon</span></a></span><span>
</span><span id="line-2798"></span><span>
</span><span id="line-2799"></span><span>    </span><span class="annot"><a href="#local-6989586621681165882"><span class="hs-identifier hs-var">mk_tc_rhs</span></a></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681165874"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165874"><span class="hs-identifier hs-var">tycon</span></a></span></span><span> </span><span id="local-6989586621681165873"><span class="annot"><span class="annottext">[DataCon]
</span><a href="#local-6989586621681165873"><span class="hs-identifier hs-var">data_cons</span></a></span></span><span>
</span><span id="line-2800"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">NewOrData
</span><a href="#local-6989586621681165917"><span class="hs-identifier hs-var">new_or_data</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2801"></span><span>          </span><span class="annot"><span class="annottext">NewOrData
</span><a href="GHC.Hs.Decls.html#DataType"><span class="hs-identifier hs-var">DataType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AlgTyConRhs -&gt; IOEnv (Env TcGblEnv TcLclEnv) AlgTyConRhs
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[DataCon] -&gt; AlgTyConRhs
</span><a href="GHC.Core.TyCon.html#mkDataTyConRhs"><span class="hs-identifier hs-var">mkDataTyConRhs</span></a></span><span> </span><span class="annot"><span class="annottext">[DataCon]
</span><a href="#local-6989586621681165873"><span class="hs-identifier hs-var">data_cons</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2802"></span><span>          </span><span class="annot"><span class="annottext">NewOrData
</span><a href="GHC.Hs.Decls.html#NewType"><span class="hs-identifier hs-var">NewType</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">null</span><span> </span><span class="hs-identifier">data_cons</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-2803"></span><span>                      </span><span class="annot"><span class="annottext">Name
-&gt; TyCon -&gt; DataCon -&gt; IOEnv (Env TcGblEnv TcLclEnv) AlgTyConRhs
forall m n. Name -&gt; TyCon -&gt; DataCon -&gt; TcRnIf m n AlgTyConRhs
</span><a href="GHC.Tc.TyCl.Build.html#mkNewTyConRhs"><span class="hs-identifier hs-var">mkNewTyConRhs</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165918"><span class="hs-identifier hs-var">tc_name</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165874"><span class="hs-identifier hs-var">tycon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[DataCon] -&gt; DataCon
forall a. [a] -&gt; a
</span><a href="../../base/src/GHC.List.html#head"><span class="hs-identifier hs-var">head</span></a></span><span> </span><span class="annot"><span class="annottext">[DataCon]
</span><a href="#local-6989586621681165873"><span class="hs-identifier hs-var">data_cons</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2804"></span><span>
</span><span id="line-2805"></span><span>
</span><span id="line-2806"></span><span class="hs-comment">-------------------------</span><span>
</span><span id="line-2807"></span><span class="annot"><a href="GHC.Tc.TyCl.html#kcTyFamInstEqn"><span class="hs-identifier hs-type">kcTyFamInstEqn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyCon"><span class="hs-identifier hs-type">TcTyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Decls.html#LTyFamInstEqn"><span class="hs-identifier hs-type">LTyFamInstEqn</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2808"></span><span class="hs-comment">-- Used for the equations of a closed type family only</span><span>
</span><span id="line-2809"></span><span class="hs-comment">-- Not used for data/type instances</span><span>
</span><span id="line-2810"></span><span id="kcTyFamInstEqn"><span class="annot"><span class="annottext">kcTyFamInstEqn :: TyCon -&gt; LTyFamInstEqn GhcRn -&gt; TcRn ()
</span><a href="GHC.Tc.TyCl.html#kcTyFamInstEqn"><span class="hs-identifier hs-var hs-var">kcTyFamInstEqn</span></a></span></span><span> </span><span id="local-6989586621681165869"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165869"><span class="hs-identifier hs-var">tc_fam_tc</span></a></span></span><span>
</span><span id="line-2811"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681165868"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681165868"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Type.html#HsIB"><span class="hs-identifier hs-type">HsIB</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hsib_ext :: forall pass thing. HsImplicitBndrs pass thing -&gt; XHsIB pass thing
</span><a href="GHC.Hs.Type.html#hsib_ext"><span class="hs-identifier hs-var">hsib_ext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681165867"><span class="annot"><span class="annottext">XHsIB GhcRn (FamEqn GhcRn (LHsType GhcRn))
</span><a href="#local-6989586621681165867"><span class="hs-identifier hs-var">imp_vars</span></a></span></span><span>
</span><span id="line-2812"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hsib_body :: forall pass thing. HsImplicitBndrs pass thing -&gt; thing
</span><a href="GHC.Hs.Type.html#hsib_body"><span class="hs-identifier hs-var">hsib_body</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Hs.Decls.html#FamEqn"><span class="hs-identifier hs-type">FamEqn</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">feqn_tycon :: forall pass rhs. FamEqn pass rhs -&gt; Located (IdP pass)
</span><a href="GHC.Hs.Decls.html#feqn_tycon"><span class="hs-identifier hs-var">feqn_tycon</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681165866"><span class="annot"><span class="annottext">IdP GhcRn
</span><a href="#local-6989586621681165866"><span class="hs-identifier hs-var">eqn_tc_name</span></a></span></span><span>
</span><span id="line-2813"></span><span>                                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">feqn_bndrs :: forall pass rhs. FamEqn pass rhs -&gt; Maybe [LHsTyVarBndr () pass]
</span><a href="GHC.Hs.Decls.html#feqn_bndrs"><span class="hs-identifier hs-var">feqn_bndrs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681165865"><span class="annot"><span class="annottext">Maybe [LHsTyVarBndr () GhcRn]
</span><a href="#local-6989586621681165865"><span class="hs-identifier hs-var">mb_expl_bndrs</span></a></span></span><span>
</span><span id="line-2814"></span><span>                                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">feqn_pats :: forall pass rhs. FamEqn pass rhs -&gt; HsTyPats pass
</span><a href="GHC.Hs.Decls.html#feqn_pats"><span class="hs-identifier hs-var">feqn_pats</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681165864"><span class="annot"><span class="annottext">HsTyPats GhcRn
</span><a href="#local-6989586621681165864"><span class="hs-identifier hs-var">hs_pats</span></a></span></span><span>
</span><span id="line-2815"></span><span>                                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">feqn_rhs :: forall pass rhs. FamEqn pass rhs -&gt; rhs
</span><a href="GHC.Hs.Decls.html#feqn_rhs"><span class="hs-identifier hs-var">feqn_rhs</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681165863"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621681165863"><span class="hs-identifier hs-var">hs_rhs_ty</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2816"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcRn () -&gt; TcRn ()
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681165868"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcRn ()) -&gt; TcRn () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2817"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;kcTyFamInstEqn&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-2818"></span><span>           </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc_name =&quot;</span></span><span>    </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
IdP GhcRn
</span><a href="#local-6989586621681165866"><span class="hs-identifier hs-var">eqn_tc_name</span></a></span><span>
</span><span id="line-2819"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;fam_tc =&quot;</span></span><span>     </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165869"><span class="hs-identifier hs-var">tc_fam_tc</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Type
</span><a href="GHC.Core.TyCon.html#tyConKind"><span class="hs-identifier hs-var hs-var">tyConKind</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165869"><span class="hs-identifier hs-var">tc_fam_tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2820"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;hsib_vars =&quot;</span></span><span>  </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
XHsIB GhcRn (FamEqn GhcRn (LHsType GhcRn))
</span><a href="#local-6989586621681165867"><span class="hs-identifier hs-var">imp_vars</span></a></span><span>
</span><span id="line-2821"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;feqn_bndrs =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [LHsTyVarBndr () GhcRn] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [LHsTyVarBndr () GhcRn]
</span><a href="#local-6989586621681165865"><span class="hs-identifier hs-var">mb_expl_bndrs</span></a></span><span>
</span><span id="line-2822"></span><span>           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;feqn_pats =&quot;</span></span><span>  </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HsTyPats GhcRn -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsTyPats GhcRn
</span><a href="#local-6989586621681165864"><span class="hs-identifier hs-var">hs_pats</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2823"></span><span>          </span><span class="hs-comment">-- this check reports an arity error instead of a kind error; easier for user</span><span>
</span><span id="line-2824"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681165862"><span class="annot"><span class="annottext">vis_pats :: Arity
</span><a href="#local-6989586621681165862"><span class="hs-identifier hs-var hs-var">vis_pats</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsTyPats GhcRn -&gt; Arity
forall tm ty. [HsArg tm ty] -&gt; Arity
</span><a href="GHC.Hs.Type.html#numVisibleArgs"><span class="hs-identifier hs-var">numVisibleArgs</span></a></span><span> </span><span class="annot"><span class="annottext">HsTyPats GhcRn
</span><a href="#local-6989586621681165864"><span class="hs-identifier hs-var">hs_pats</span></a></span><span>
</span><span id="line-2825"></span><span>
</span><span id="line-2826"></span><span>       </span><span class="hs-comment">-- First, check if we're dealing with a closed type family equation, and</span><span>
</span><span id="line-2827"></span><span>       </span><span class="hs-comment">-- if so, ensure that each equation's type constructor is for the right</span><span>
</span><span id="line-2828"></span><span>       </span><span class="hs-comment">-- type family.  E.g. barf on</span><span>
</span><span id="line-2829"></span><span>       </span><span class="hs-comment">--    type family F a where { G Int = Bool }</span><span>
</span><span id="line-2830"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165861"><span class="hs-identifier hs-var">tc_fam_tc_name</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Name
IdP GhcRn
</span><a href="#local-6989586621681165866"><span class="hs-identifier hs-var">eqn_tc_name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; TcRn ()) -&gt; SDoc -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2831"></span><span>         </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#wrongTyFamName"><span class="hs-identifier hs-var">wrongTyFamName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165861"><span class="hs-identifier hs-var">tc_fam_tc_name</span></a></span><span> </span><span class="annot"><span class="annottext">Name
IdP GhcRn
</span><a href="#local-6989586621681165866"><span class="hs-identifier hs-var">eqn_tc_name</span></a></span><span>
</span><span id="line-2832"></span><span>
</span><span id="line-2833"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621681165862"><span class="hs-identifier hs-var">vis_pats</span></a></span><span> </span><span class="annot"><span class="annottext">Arity -&gt; Arity -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621681165859"><span class="hs-identifier hs-var">vis_arity</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; TcRn ()) -&gt; SDoc -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2834"></span><span>                  </span><span class="annot"><span class="annottext">Arity -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#wrongNumberOfParmsErr"><span class="hs-identifier hs-var">wrongNumberOfParmsErr</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621681165859"><span class="hs-identifier hs-var">vis_arity</span></a></span><span>
</span><span id="line-2835"></span><span>
</span><span id="line-2836"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcM ([TyVar], ([TyVar], Type)) -&gt; TcRn ()
forall a. TcM a -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#discardResult"><span class="hs-identifier hs-var">discardResult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM ([TyVar], ([TyVar], Type)) -&gt; TcRn ())
-&gt; TcM ([TyVar], ([TyVar], Type)) -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2837"></span><span>         </span><span class="annot"><span class="annottext">[Name] -&gt; TcM ([TyVar], Type) -&gt; TcM ([TyVar], ([TyVar], Type))
forall a. [Name] -&gt; TcM a -&gt; TcM ([TyVar], a)
</span><a href="GHC.Tc.Gen.HsType.html#bindImplicitTKBndrs_Q_Tv"><span class="hs-identifier hs-var">bindImplicitTKBndrs_Q_Tv</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
XHsIB GhcRn (FamEqn GhcRn (LHsType GhcRn))
</span><a href="#local-6989586621681165867"><span class="hs-identifier hs-var">imp_vars</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM ([TyVar], Type) -&gt; TcM ([TyVar], ([TyVar], Type)))
-&gt; TcM ([TyVar], Type) -&gt; TcM ([TyVar], ([TyVar], Type))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2838"></span><span>         </span><span class="annot"><span class="annottext">ContextKind
-&gt; [LHsTyVarBndr () GhcRn] -&gt; TcM Type -&gt; TcM ([TyVar], Type)
forall a.
ContextKind -&gt; [LHsTyVarBndr () GhcRn] -&gt; TcM a -&gt; TcM ([TyVar], a)
</span><a href="GHC.Tc.Gen.HsType.html#bindExplicitTKBndrs_Q_Tv"><span class="hs-identifier hs-var">bindExplicitTKBndrs_Q_Tv</span></a></span><span> </span><span class="annot"><span class="annottext">ContextKind
</span><a href="GHC.Tc.Gen.HsType.html#AnyKind"><span class="hs-identifier hs-var">AnyKind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe [LHsTyVarBndr () GhcRn]
</span><a href="#local-6989586621681165865"><span class="hs-identifier hs-var">mb_expl_bndrs</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [LHsTyVarBndr () GhcRn]
-&gt; [LHsTyVarBndr () GhcRn] -&gt; [LHsTyVarBndr () GhcRn]
forall a. Maybe a -&gt; a -&gt; a
</span><a href="GHC.Data.Maybe.html#orElse"><span class="hs-operator hs-var">`orElse`</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM Type -&gt; TcM ([TyVar], Type))
-&gt; TcM Type -&gt; TcM ([TyVar], Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2839"></span><span>         </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681165856"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165856"><span class="hs-identifier hs-var">_fam_app</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681165855"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165855"><span class="hs-identifier hs-var">res_kind</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; HsTyPats GhcRn -&gt; TcM (Type, Type)
</span><a href="GHC.Tc.Gen.HsType.html#tcFamTyPats"><span class="hs-identifier hs-var">tcFamTyPats</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165869"><span class="hs-identifier hs-var">tc_fam_tc</span></a></span><span> </span><span class="annot"><span class="annottext">HsTyPats GhcRn
</span><a href="#local-6989586621681165864"><span class="hs-identifier hs-var">hs_pats</span></a></span><span>
</span><span id="line-2840"></span><span>            </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn -&gt; ContextKind -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tcCheckLHsType"><span class="hs-identifier hs-var">tcCheckLHsType</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621681165863"><span class="hs-identifier hs-var">hs_rhs_ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; ContextKind
</span><a href="GHC.Tc.Gen.HsType.html#TheKind"><span class="hs-identifier hs-var">TheKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165855"><span class="hs-identifier hs-var">res_kind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2841"></span><span>             </span><span class="hs-comment">-- Why &quot;_Tv&quot; here?  Consider (#14066</span><span>
</span><span id="line-2842"></span><span>             </span><span class="hs-comment">--  type family Bar x y where</span><span>
</span><span id="line-2843"></span><span>             </span><span class="hs-comment">--      Bar (x :: a) (y :: b) = Int</span><span>
</span><span id="line-2844"></span><span>             </span><span class="hs-comment">--      Bar (x :: c) (y :: d) = Bool</span><span>
</span><span id="line-2845"></span><span>             </span><span class="hs-comment">-- During kind-checking, a,b,c,d should be TyVarTvs and unify appropriately</span><span>
</span><span id="line-2846"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-2847"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2848"></span><span>    </span><span id="local-6989586621681165859"><span class="annot"><span class="annottext">vis_arity :: Arity
</span><a href="#local-6989586621681165859"><span class="hs-identifier hs-var hs-var">vis_arity</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; Arity
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Arity
</span><a href="../../base/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [TyVar]
</span><a href="GHC.Core.TyCon.html#tyConVisibleTyVars"><span class="hs-identifier hs-var">tyConVisibleTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165869"><span class="hs-identifier hs-var">tc_fam_tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2849"></span><span>    </span><span id="local-6989586621681165861"><span class="annot"><span class="annottext">tc_fam_tc_name :: Name
</span><a href="#local-6989586621681165861"><span class="hs-identifier hs-var hs-var">tc_fam_tc_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Name
forall a. NamedThing a =&gt; a -&gt; Name
</span><a href="GHC.Types.Name.html#getName"><span class="hs-identifier hs-var">getName</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165869"><span class="hs-identifier hs-var">tc_fam_tc</span></a></span><span>
</span><span id="line-2850"></span><span>
</span><span id="line-2851"></span><span class="hs-comment">--------------------------</span><span>
</span><span id="line-2852"></span><span class="annot"><a href="GHC.Tc.TyCl.html#tcTyFamInstEqn"><span class="hs-identifier hs-type">tcTyFamInstEqn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyCon"><span class="hs-identifier hs-type">TcTyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#AssocInstInfo"><span class="hs-identifier hs-type">AssocInstInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Decls.html#LTyFamInstEqn"><span class="hs-identifier hs-type">LTyFamInstEqn</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-2853"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#KnotTied"><span class="hs-identifier hs-type">KnotTied</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#CoAxBranch"><span class="hs-identifier hs-type">CoAxBranch</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2854"></span><span class="hs-comment">-- Needs to be here, not in GHC.Tc.TyCl.Instance, because closed families</span><span>
</span><span id="line-2855"></span><span class="hs-comment">-- (typechecked here) have TyFamInstEqns</span><span>
</span><span id="line-2856"></span><span>
</span><span id="line-2857"></span><span id="tcTyFamInstEqn"><span class="annot"><span class="annottext">tcTyFamInstEqn :: TyCon
-&gt; AssocInstInfo
-&gt; LTyFamInstEqn GhcRn
-&gt; TcRn (KnotTied CoAxBranch)
</span><a href="GHC.Tc.TyCl.html#tcTyFamInstEqn"><span class="hs-identifier hs-var hs-var">tcTyFamInstEqn</span></a></span></span><span> </span><span id="local-6989586621681165854"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165854"><span class="hs-identifier hs-var">fam_tc</span></a></span></span><span> </span><span id="local-6989586621681165853"><span class="annot"><span class="annottext">AssocInstInfo
</span><a href="#local-6989586621681165853"><span class="hs-identifier hs-var">mb_clsinfo</span></a></span></span><span>
</span><span id="line-2858"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681165852"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681165852"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Type.html#HsIB"><span class="hs-identifier hs-type">HsIB</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hsib_ext :: forall pass thing. HsImplicitBndrs pass thing -&gt; XHsIB pass thing
</span><a href="GHC.Hs.Type.html#hsib_ext"><span class="hs-identifier hs-var">hsib_ext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681165851"><span class="annot"><span class="annottext">XHsIB GhcRn (FamEqn GhcRn (LHsType GhcRn))
</span><a href="#local-6989586621681165851"><span class="hs-identifier hs-var">imp_vars</span></a></span></span><span>
</span><span id="line-2859"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hsib_body :: forall pass thing. HsImplicitBndrs pass thing -&gt; thing
</span><a href="GHC.Hs.Type.html#hsib_body"><span class="hs-identifier hs-var">hsib_body</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Hs.Decls.html#FamEqn"><span class="hs-identifier hs-type">FamEqn</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">feqn_bndrs :: forall pass rhs. FamEqn pass rhs -&gt; Maybe [LHsTyVarBndr () pass]
</span><a href="GHC.Hs.Decls.html#feqn_bndrs"><span class="hs-identifier hs-var">feqn_bndrs</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681165850"><span class="annot"><span class="annottext">Maybe [LHsTyVarBndr () GhcRn]
</span><a href="#local-6989586621681165850"><span class="hs-identifier hs-var">mb_expl_bndrs</span></a></span></span><span>
</span><span id="line-2860"></span><span>                                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">feqn_pats :: forall pass rhs. FamEqn pass rhs -&gt; HsTyPats pass
</span><a href="GHC.Hs.Decls.html#feqn_pats"><span class="hs-identifier hs-var">feqn_pats</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681165849"><span class="annot"><span class="annottext">HsTyPats GhcRn
</span><a href="#local-6989586621681165849"><span class="hs-identifier hs-var">hs_pats</span></a></span></span><span>
</span><span id="line-2861"></span><span>                                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">feqn_rhs :: forall pass rhs. FamEqn pass rhs -&gt; rhs
</span><a href="GHC.Hs.Decls.html#feqn_rhs"><span class="hs-identifier hs-var">feqn_rhs</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681165848"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621681165848"><span class="hs-identifier hs-var">hs_rhs_ty</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2862"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcRn (KnotTied CoAxBranch) -&gt; TcRn (KnotTied CoAxBranch)
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681165852"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn (KnotTied CoAxBranch) -&gt; TcRn (KnotTied CoAxBranch))
-&gt; TcRn (KnotTied CoAxBranch) -&gt; TcRn (KnotTied CoAxBranch)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2863"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcTyFamInstEqn&quot;</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; TcRn ()) -&gt; SDoc -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2864"></span><span>         </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165854"><span class="hs-identifier hs-var">fam_tc</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HsTyPats GhcRn -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsTyPats GhcRn
</span><a href="#local-6989586621681165849"><span class="hs-identifier hs-var">hs_pats</span></a></span><span>
</span><span id="line-2865"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;fam tc bndrs&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; SDoc
</span><a href="GHC.Core.TyCo.Ppr.html#pprTyVars"><span class="hs-identifier hs-var">pprTyVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [TyVar]
</span><a href="GHC.Core.TyCon.html#tyConTyVars"><span class="hs-identifier hs-var hs-var">tyConTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165854"><span class="hs-identifier hs-var">fam_tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2866"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">AssocInstInfo
</span><a href="#local-6989586621681165853"><span class="hs-identifier hs-var">mb_clsinfo</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2867"></span><span>                  </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#NotAssociated"><span class="hs-identifier hs-type">NotAssociated</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-2868"></span><span>                  </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#InClsInst"><span class="hs-identifier hs-type">InClsInst</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ai_class :: AssocInstInfo -&gt; Class
</span><a href="GHC.Tc.Instance.Class.html#ai_class"><span class="hs-identifier hs-var">ai_class</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681165845"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681165845"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;class&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Class -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681165845"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; SDoc
</span><a href="GHC.Core.TyCo.Ppr.html#pprTyVars"><span class="hs-identifier hs-var">pprTyVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; [TyVar]
</span><a href="GHC.Core.Class.html#classTyVars"><span class="hs-identifier hs-var hs-var">classTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681165845"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2869"></span><span>
</span><span id="line-2870"></span><span>       </span><span class="hs-comment">-- First, check the arity of visible arguments</span><span>
</span><span id="line-2871"></span><span>       </span><span class="hs-comment">-- If we wait until validity checking, we'll get kind errors</span><span>
</span><span id="line-2872"></span><span>       </span><span class="hs-comment">-- below when an arity error will be much easier to understand.</span><span>
</span><span id="line-2873"></span><span>       </span><span class="hs-comment">-- Note that for closed type families, kcTyFamInstEqn has already</span><span>
</span><span id="line-2874"></span><span>       </span><span class="hs-comment">-- checked the arity previously.</span><span>
</span><span id="line-2875"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681165843"><span class="annot"><span class="annottext">vis_arity :: Arity
</span><a href="#local-6989586621681165843"><span class="hs-identifier hs-var hs-var">vis_arity</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; Arity
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Arity
</span><a href="../../base/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [TyVar]
</span><a href="GHC.Core.TyCon.html#tyConVisibleTyVars"><span class="hs-identifier hs-var">tyConVisibleTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165854"><span class="hs-identifier hs-var">fam_tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2876"></span><span>             </span><span id="local-6989586621681165842"><span class="annot"><span class="annottext">vis_pats :: Arity
</span><a href="#local-6989586621681165842"><span class="hs-identifier hs-var hs-var">vis_pats</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsTyPats GhcRn -&gt; Arity
forall tm ty. [HsArg tm ty] -&gt; Arity
</span><a href="GHC.Hs.Type.html#numVisibleArgs"><span class="hs-identifier hs-var">numVisibleArgs</span></a></span><span> </span><span class="annot"><span class="annottext">HsTyPats GhcRn
</span><a href="#local-6989586621681165849"><span class="hs-identifier hs-var">hs_pats</span></a></span><span>
</span><span id="line-2877"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621681165842"><span class="hs-identifier hs-var">vis_pats</span></a></span><span> </span><span class="annot"><span class="annottext">Arity -&gt; Arity -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621681165843"><span class="hs-identifier hs-var">vis_arity</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; TcRn ()) -&gt; SDoc -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2878"></span><span>         </span><span class="annot"><span class="annottext">Arity -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#wrongNumberOfParmsErr"><span class="hs-identifier hs-var">wrongNumberOfParmsErr</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621681165843"><span class="hs-identifier hs-var">vis_arity</span></a></span><span>
</span><span id="line-2879"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681165841"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165841"><span class="hs-identifier hs-var">qtvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681165840"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681165840"><span class="hs-identifier hs-var">pats</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681165839"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165839"><span class="hs-identifier hs-var">rhs_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon
-&gt; AssocInstInfo
-&gt; [Name]
-&gt; [LHsTyVarBndr () GhcRn]
-&gt; HsTyPats GhcRn
-&gt; LHsType GhcRn
-&gt; TcM ([TyVar], [Type], Type)
</span><a href="GHC.Tc.TyCl.html#tcTyFamInstEqnGuts"><span class="hs-identifier hs-var">tcTyFamInstEqnGuts</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165854"><span class="hs-identifier hs-var">fam_tc</span></a></span><span> </span><span class="annot"><span class="annottext">AssocInstInfo
</span><a href="#local-6989586621681165853"><span class="hs-identifier hs-var">mb_clsinfo</span></a></span><span>
</span><span id="line-2880"></span><span>                                      </span><span class="annot"><span class="annottext">[Name]
XHsIB GhcRn (FamEqn GhcRn (LHsType GhcRn))
</span><a href="#local-6989586621681165851"><span class="hs-identifier hs-var">imp_vars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe [LHsTyVarBndr () GhcRn]
</span><a href="#local-6989586621681165850"><span class="hs-identifier hs-var">mb_expl_bndrs</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [LHsTyVarBndr () GhcRn]
-&gt; [LHsTyVarBndr () GhcRn] -&gt; [LHsTyVarBndr () GhcRn]
forall a. Maybe a -&gt; a -&gt; a
</span><a href="GHC.Data.Maybe.html#orElse"><span class="hs-operator hs-var">`orElse`</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2881"></span><span>                                      </span><span class="annot"><span class="annottext">HsTyPats GhcRn
</span><a href="#local-6989586621681165849"><span class="hs-identifier hs-var">hs_pats</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621681165848"><span class="hs-identifier hs-var">hs_rhs_ty</span></a></span><span>
</span><span id="line-2882"></span><span>       </span><span class="hs-comment">-- Don't print results they may be knot-tied</span><span>
</span><span id="line-2883"></span><span>       </span><span class="hs-comment">-- (tcFamInstEqnGuts zonks to Type)</span><span>
</span><span id="line-2884"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">KnotTied CoAxBranch -&gt; TcRn (KnotTied CoAxBranch)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyVar]
-&gt; [TyVar]
-&gt; [TyVar]
-&gt; [Type]
-&gt; Type
-&gt; [Role]
-&gt; SrcSpan
-&gt; KnotTied CoAxBranch
</span><a href="GHC.Core.FamInstEnv.html#mkCoAxBranch"><span class="hs-identifier hs-var">mkCoAxBranch</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165841"><span class="hs-identifier hs-var">qtvs</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681165840"><span class="hs-identifier hs-var">pats</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165839"><span class="hs-identifier hs-var">rhs_ty</span></a></span><span>
</span><span id="line-2885"></span><span>                              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TyVar -&gt; Role) -&gt; [TyVar] -&gt; [Role]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; TyVar -&gt; Role
forall a b. a -&gt; b -&gt; a
</span><a href="../../base/src/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165841"><span class="hs-identifier hs-var">qtvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2886"></span><span>                              </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681165852"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2887"></span><span>
</span><span id="line-2888"></span><span class="hs-comment">{-
Kind check type patterns and kind annotate the embedded type variables.
     type instance F [a] = rhs

 * Here we check that a type instance matches its kind signature, but we do
   not check whether there is a pattern for each type index; the latter
   check is only required for type synonym instances.

Note [Instantiating a family tycon]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
It's possible that kind-checking the result of a family tycon applied to
its patterns will instantiate the tycon further. For example, we might
have

  type family F :: k where
    F = Int
    F = Maybe

After checking (F :: forall k. k) (with no visible patterns), we still need
to instantiate the k. With data family instances, this problem can be even
more intricate, due to Note [Arity of data families] in GHC.Core.FamInstEnv. See
indexed-types/should_compile/T12369 for an example.

So, the kind-checker must return the new skolems and args (that is, Type
or (Type -&gt; Type) for the equations above) and the instantiated kind.

Note [Generalising in tcTyFamInstEqnGuts]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Suppose we have something like
  type instance forall (a::k) b. F t1 t2 = rhs

Then  imp_vars = [k], exp_bndrs = [a::k, b]

We want to quantify over
  * k, a, and b  (all user-specified)
  * and any inferred free kind vars from
      - the kinds of k, a, b
      - the types t1, t2

However, unlike a type signature like
  f :: forall (a::k). blah

we do /not/ care about the Inferred/Specified designation
or order for the final quantified tyvars.  Type-family
instances are not invoked directly in Haskell source code,
so visible type application etc plays no role.

So, the simple thing is
   - gather candidates from [k, a, b] and pats
   - quantify over them

Hence the slightly mysterious call:
    candidateQTyVarsOfTypes (pats ++ mkTyVarTys scoped_tvs)

Simple, neat, but a little non-obvious!

See also Note [Re-quantify type variables in rules] in GHC.Tc.Gen.Rule, which explains
a very similar design when generalising over the type of a rewrite rule.
-}</span><span>
</span><span id="line-2947"></span><span>
</span><span id="line-2948"></span><span class="hs-comment">--------------------------</span><span>
</span><span id="line-2949"></span><span class="annot"><a href="GHC.Tc.TyCl.html#tcTyFamInstEqnGuts"><span class="hs-identifier hs-type">tcTyFamInstEqnGuts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#AssocInstInfo"><span class="hs-identifier hs-type">AssocInstInfo</span></a></span><span>
</span><span id="line-2950"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Hs.Type.html#LHsTyVarBndr"><span class="hs-identifier hs-type">LHsTyVarBndr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- Implicit and explicicit binder</span><span>
</span><span id="line-2951"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Decls.html#HsTyPats"><span class="hs-identifier hs-type">HsTyPats</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>                    </span><span class="hs-comment">-- Patterns</span><span>
</span><span id="line-2952"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Type.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>                     </span><span class="hs-comment">-- RHS</span><span>
</span><span id="line-2953"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- (tyvars, pats, rhs)</span><span>
</span><span id="line-2954"></span><span class="hs-comment">-- Used only for type families, not data families</span><span>
</span><span id="line-2955"></span><span id="tcTyFamInstEqnGuts"><span class="annot"><span class="annottext">tcTyFamInstEqnGuts :: TyCon
-&gt; AssocInstInfo
-&gt; [Name]
-&gt; [LHsTyVarBndr () GhcRn]
-&gt; HsTyPats GhcRn
-&gt; LHsType GhcRn
-&gt; TcM ([TyVar], [Type], Type)
</span><a href="GHC.Tc.TyCl.html#tcTyFamInstEqnGuts"><span class="hs-identifier hs-var hs-var">tcTyFamInstEqnGuts</span></a></span></span><span> </span><span id="local-6989586621681165834"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165834"><span class="hs-identifier hs-var">fam_tc</span></a></span></span><span> </span><span id="local-6989586621681165833"><span class="annot"><span class="annottext">AssocInstInfo
</span><a href="#local-6989586621681165833"><span class="hs-identifier hs-var">mb_clsinfo</span></a></span></span><span> </span><span id="local-6989586621681165832"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621681165832"><span class="hs-identifier hs-var">imp_vars</span></a></span></span><span> </span><span id="local-6989586621681165831"><span class="annot"><span class="annottext">[LHsTyVarBndr () GhcRn]
</span><a href="#local-6989586621681165831"><span class="hs-identifier hs-var">exp_bndrs</span></a></span></span><span> </span><span id="local-6989586621681165830"><span class="annot"><span class="annottext">HsTyPats GhcRn
</span><a href="#local-6989586621681165830"><span class="hs-identifier hs-var">hs_pats</span></a></span></span><span> </span><span id="local-6989586621681165829"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621681165829"><span class="hs-identifier hs-var">hs_rhs_ty</span></a></span></span><span>
</span><span id="line-2956"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcTyFamInstEqnGuts {&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165834"><span class="hs-identifier hs-var">fam_tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2957"></span><span>
</span><span id="line-2958"></span><span>       </span><span class="hs-comment">-- By now, for type families (but not data families) we should</span><span>
</span><span id="line-2959"></span><span>       </span><span class="hs-comment">-- have checked that the number of patterns matches tyConArity</span><span>
</span><span id="line-2960"></span><span>
</span><span id="line-2961"></span><span>       </span><span class="hs-comment">-- This code is closely related to the code</span><span>
</span><span id="line-2962"></span><span>       </span><span class="hs-comment">-- in GHC.Tc.Gen.HsType.kcCheckDeclHeader_cusk</span><span>
</span><span id="line-2963"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681165828"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165828"><span class="hs-identifier hs-var">imp_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681165827"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165827"><span class="hs-identifier hs-var">exp_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681165826"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165826"><span class="hs-identifier hs-var">lhs_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681165825"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165825"><span class="hs-identifier hs-var">rhs_ty</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2964"></span><span>               </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM ([TyVar], ([TyVar], (Type, Type)))
-&gt; TcM ([TyVar], ([TyVar], (Type, Type)))
forall r. TcM r -&gt; TcM r
</span><a href="GHC.Tc.Utils.Monad.html#pushTcLevelM_"><span class="hs-identifier hs-var">pushTcLevelM_</span></a></span><span>                                </span><span class="annot"><span class="annottext">(TcM ([TyVar], ([TyVar], (Type, Type)))
 -&gt; TcM ([TyVar], ([TyVar], (Type, Type))))
-&gt; TcM ([TyVar], ([TyVar], (Type, Type)))
-&gt; TcM ([TyVar], ([TyVar], (Type, Type)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2965"></span><span>                  </span><span class="annot"><span class="annottext">TcM ([TyVar], ([TyVar], (Type, Type)))
-&gt; TcM ([TyVar], ([TyVar], (Type, Type)))
forall r. TcM r -&gt; TcM r
</span><a href="GHC.Tc.Solver.html#solveEqualities"><span class="hs-identifier hs-var">solveEqualities</span></a></span><span>                              </span><span class="annot"><span class="annottext">(TcM ([TyVar], ([TyVar], (Type, Type)))
 -&gt; TcM ([TyVar], ([TyVar], (Type, Type))))
-&gt; TcM ([TyVar], ([TyVar], (Type, Type)))
-&gt; TcM ([TyVar], ([TyVar], (Type, Type)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2966"></span><span>                  </span><span class="annot"><span class="annottext">[Name]
-&gt; TcM ([TyVar], (Type, Type))
-&gt; TcM ([TyVar], ([TyVar], (Type, Type)))
forall a. [Name] -&gt; TcM a -&gt; TcM ([TyVar], a)
</span><a href="GHC.Tc.Gen.HsType.html#bindImplicitTKBndrs_Q_Skol"><span class="hs-identifier hs-var">bindImplicitTKBndrs_Q_Skol</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621681165832"><span class="hs-identifier hs-var">imp_vars</span></a></span><span>          </span><span class="annot"><span class="annottext">(TcM ([TyVar], (Type, Type))
 -&gt; TcM ([TyVar], ([TyVar], (Type, Type))))
-&gt; TcM ([TyVar], (Type, Type))
-&gt; TcM ([TyVar], ([TyVar], (Type, Type)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2967"></span><span>                  </span><span class="annot"><span class="annottext">ContextKind
-&gt; [LHsTyVarBndr () GhcRn]
-&gt; TcM (Type, Type)
-&gt; TcM ([TyVar], (Type, Type))
forall a.
ContextKind -&gt; [LHsTyVarBndr () GhcRn] -&gt; TcM a -&gt; TcM ([TyVar], a)
</span><a href="GHC.Tc.Gen.HsType.html#bindExplicitTKBndrs_Q_Skol"><span class="hs-identifier hs-var">bindExplicitTKBndrs_Q_Skol</span></a></span><span> </span><span class="annot"><span class="annottext">ContextKind
</span><a href="GHC.Tc.Gen.HsType.html#AnyKind"><span class="hs-identifier hs-var">AnyKind</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsTyVarBndr () GhcRn]
</span><a href="#local-6989586621681165831"><span class="hs-identifier hs-var">exp_bndrs</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (Type, Type) -&gt; TcM ([TyVar], (Type, Type)))
-&gt; TcM (Type, Type) -&gt; TcM ([TyVar], (Type, Type))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2968"></span><span>                  </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681165822"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165822"><span class="hs-identifier hs-var">lhs_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681165821"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165821"><span class="hs-identifier hs-var">rhs_kind</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; HsTyPats GhcRn -&gt; TcM (Type, Type)
</span><a href="GHC.Tc.Gen.HsType.html#tcFamTyPats"><span class="hs-identifier hs-var">tcFamTyPats</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165834"><span class="hs-identifier hs-var">fam_tc</span></a></span><span> </span><span class="annot"><span class="annottext">HsTyPats GhcRn
</span><a href="#local-6989586621681165830"><span class="hs-identifier hs-var">hs_pats</span></a></span><span>
</span><span id="line-2969"></span><span>                       </span><span class="hs-comment">-- Ensure that the instance is consistent with its</span><span>
</span><span id="line-2970"></span><span>                       </span><span class="hs-comment">-- parent class (#16008)</span><span>
</span><span id="line-2971"></span><span>                     </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">AssocInstInfo -&gt; Type -&gt; TcRn ()
</span><a href="GHC.Tc.TyCl.html#addConsistencyConstraints"><span class="hs-identifier hs-var">addConsistencyConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">AssocInstInfo
</span><a href="#local-6989586621681165833"><span class="hs-identifier hs-var">mb_clsinfo</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165822"><span class="hs-identifier hs-var">lhs_ty</span></a></span><span>
</span><span id="line-2972"></span><span>                     </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681165820"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165820"><span class="hs-identifier hs-var">rhs_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn -&gt; ContextKind -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tcCheckLHsType"><span class="hs-identifier hs-var">tcCheckLHsType</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621681165829"><span class="hs-identifier hs-var">hs_rhs_ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; ContextKind
</span><a href="GHC.Tc.Gen.HsType.html#TheKind"><span class="hs-identifier hs-var">TheKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165821"><span class="hs-identifier hs-var">rhs_kind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2973"></span><span>                     </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(Type, Type) -&gt; TcM (Type, Type)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165822"><span class="hs-identifier hs-var">lhs_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165820"><span class="hs-identifier hs-var">rhs_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2974"></span><span>
</span><span id="line-2975"></span><span>       </span><span class="hs-comment">-- See Note [Generalising in tcTyFamInstEqnGuts]</span><span>
</span><span id="line-2976"></span><span>       </span><span class="hs-comment">-- This code (and the stuff immediately above) is very similar</span><span>
</span><span id="line-2977"></span><span>       </span><span class="hs-comment">-- to that in tcDataFamInstHeader.  Maybe we should abstract the</span><span>
</span><span id="line-2978"></span><span>       </span><span class="hs-comment">-- common code; but for the moment I concluded that it's</span><span>
</span><span id="line-2979"></span><span>       </span><span class="hs-comment">-- clearer to duplicate it.  Still, if you fix a bug here,</span><span>
</span><span id="line-2980"></span><span>       </span><span class="hs-comment">-- check there too!</span><span>
</span><span id="line-2981"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681165819"><span class="annot"><span class="annottext">scoped_tvs :: [TyVar]
</span><a href="#local-6989586621681165819"><span class="hs-identifier hs-var hs-var">scoped_tvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165828"><span class="hs-identifier hs-var">imp_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; [TyVar] -&gt; [TyVar]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165827"><span class="hs-identifier hs-var">exp_tvs</span></a></span><span>
</span><span id="line-2982"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681165818"><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621681165818"><span class="hs-identifier hs-var">dvs</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; TcM CandidatesQTvs
</span><a href="GHC.Tc.Utils.TcMType.html#candidateQTyVarsOfTypes"><span class="hs-identifier hs-var">candidateQTyVarsOfTypes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165826"><span class="hs-identifier hs-var">lhs_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; [Type] -&gt; [Type]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; [Type]
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165819"><span class="hs-identifier hs-var">scoped_tvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2983"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681165816"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165816"><span class="hs-identifier hs-var">qtvs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs -&gt; TcM [TyVar]
</span><a href="GHC.Tc.Utils.TcMType.html#quantifyTyVars"><span class="hs-identifier hs-var">quantifyTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621681165818"><span class="hs-identifier hs-var">dvs</span></a></span><span>
</span><span id="line-2984"></span><span>
</span><span id="line-2985"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcTyFamInstEqnGuts 2&quot;</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; TcRn ()) -&gt; SDoc -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2986"></span><span>         </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165834"><span class="hs-identifier hs-var">fam_tc</span></a></span><span>
</span><span id="line-2987"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;scoped_tvs&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; SDoc
</span><a href="GHC.Core.TyCo.Ppr.html#pprTyVars"><span class="hs-identifier hs-var">pprTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165819"><span class="hs-identifier hs-var">scoped_tvs</span></a></span><span>
</span><span id="line-2988"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;lhs_ty&quot;</span></span><span>     </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165826"><span class="hs-identifier hs-var">lhs_ty</span></a></span><span>
</span><span id="line-2989"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;dvs&quot;</span></span><span>        </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CandidatesQTvs
</span><a href="#local-6989586621681165818"><span class="hs-identifier hs-var">dvs</span></a></span><span>
</span><span id="line-2990"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;qtvs&quot;</span></span><span>       </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; SDoc
</span><a href="GHC.Core.TyCo.Ppr.html#pprTyVars"><span class="hs-identifier hs-var">pprTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165816"><span class="hs-identifier hs-var">qtvs</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2991"></span><span>
</span><span id="line-2992"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681165815"><span class="annot"><span class="annottext">ZonkEnv
</span><a href="#local-6989586621681165815"><span class="hs-identifier hs-var">ze</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681165814"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165814"><span class="hs-identifier hs-var">qtvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; TcM (ZonkEnv, [TyVar])
</span><a href="GHC.Tc.Utils.Zonk.html#zonkTyBndrs"><span class="hs-identifier hs-var">zonkTyBndrs</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165816"><span class="hs-identifier hs-var">qtvs</span></a></span><span>
</span><span id="line-2993"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681165812"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165812"><span class="hs-identifier hs-var">lhs_ty</span></a></span></span><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ZonkEnv -&gt; Type -&gt; TcM Type
</span><a href="GHC.Tc.Utils.Zonk.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-var">zonkTcTypeToTypeX</span></a></span><span> </span><span class="annot"><span class="annottext">ZonkEnv
</span><a href="#local-6989586621681165815"><span class="hs-identifier hs-var">ze</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165826"><span class="hs-identifier hs-var">lhs_ty</span></a></span><span>
</span><span id="line-2994"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681165811"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165811"><span class="hs-identifier hs-var">rhs_ty</span></a></span></span><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ZonkEnv -&gt; Type -&gt; TcM Type
</span><a href="GHC.Tc.Utils.Zonk.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-var">zonkTcTypeToTypeX</span></a></span><span> </span><span class="annot"><span class="annottext">ZonkEnv
</span><a href="#local-6989586621681165815"><span class="hs-identifier hs-var">ze</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165825"><span class="hs-identifier hs-var">rhs_ty</span></a></span><span>
</span><span id="line-2995"></span><span>
</span><span id="line-2996"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681165810"><span class="annot"><span class="annottext">pats :: [Type]
</span><a href="#local-6989586621681165810"><span class="hs-identifier hs-var hs-var">pats</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; [Type]
</span><a href="GHC.Tc.TyCl.html#unravelFamInstPats"><span class="hs-identifier hs-var">unravelFamInstPats</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165812"><span class="hs-identifier hs-var">lhs_ty</span></a></span><span>
</span><span id="line-2997"></span><span>             </span><span class="hs-comment">-- Note that we do this after solveEqualities</span><span>
</span><span id="line-2998"></span><span>             </span><span class="hs-comment">-- so that any strange coercions inside lhs_ty</span><span>
</span><span id="line-2999"></span><span>             </span><span class="hs-comment">-- have been solved before we attempt to unravel it</span><span>
</span><span id="line-3000"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcTyFamInstEqnGuts }&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165834"><span class="hs-identifier hs-var">fam_tc</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; SDoc
</span><a href="GHC.Core.TyCo.Ppr.html#pprTyVars"><span class="hs-identifier hs-var">pprTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165814"><span class="hs-identifier hs-var">qtvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3001"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">([TyVar], [Type], Type) -&gt; TcM ([TyVar], [Type], Type)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165814"><span class="hs-identifier hs-var">qtvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681165810"><span class="hs-identifier hs-var">pats</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165811"><span class="hs-identifier hs-var">rhs_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3002"></span><span>
</span><span id="line-3003"></span><span class="hs-comment">-----------------</span><span>
</span><span id="line-3004"></span><span class="annot"><a href="GHC.Tc.TyCl.html#unravelFamInstPats"><span class="hs-identifier hs-type">unravelFamInstPats</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-3005"></span><span class="hs-comment">-- Decompose fam_app to get the argument patterns</span><span>
</span><span id="line-3006"></span><span class="hs-comment">--</span><span>
</span><span id="line-3007"></span><span class="hs-comment">-- We expect fam_app to look like (F t1 .. tn)</span><span>
</span><span id="line-3008"></span><span class="hs-comment">-- tcFamTyPats is capable of returning ((F ty1 |&gt; co) ty2),</span><span>
</span><span id="line-3009"></span><span class="hs-comment">-- but that can't happen here because we already checked the</span><span>
</span><span id="line-3010"></span><span class="hs-comment">-- arity of F matches the number of pattern</span><span>
</span><span id="line-3011"></span><span id="unravelFamInstPats"><span class="annot"><span class="annottext">unravelFamInstPats :: Type -&gt; [Type]
</span><a href="GHC.Tc.TyCl.html#unravelFamInstPats"><span class="hs-identifier hs-var hs-var">unravelFamInstPats</span></a></span></span><span> </span><span id="local-6989586621681165809"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165809"><span class="hs-identifier hs-var">fam_app</span></a></span></span><span>
</span><span id="line-3012"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Maybe (TyCon, [Type])
Type -&gt; Maybe (TyCon, [Type])
</span><a href="GHC.Core.Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165809"><span class="hs-identifier hs-var">fam_app</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3013"></span><span>      </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681165807"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681165807"><span class="hs-identifier hs-var">pats</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681165807"><span class="hs-identifier hs-var">pats</span></a></span><span>
</span><span id="line-3014"></span><span>      </span><span class="annot"><span class="annottext">Maybe (TyCon, [Type])
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; [Type]
forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;unravelFamInstPats: Ill-typed LHS of family instance&quot;</span></span><span>
</span><span id="line-3015"></span><span>        </span><span class="hs-comment">-- The Nothing case cannot happen for type families, because</span><span>
</span><span id="line-3016"></span><span>        </span><span class="hs-comment">-- we don't call unravelFamInstPats until we've solved the</span><span>
</span><span id="line-3017"></span><span>        </span><span class="hs-comment">-- equalities. For data families, it shouldn't happen either,</span><span>
</span><span id="line-3018"></span><span>        </span><span class="hs-comment">-- we need to fail hard and early if it does. See trac issue #15905</span><span>
</span><span id="line-3019"></span><span>        </span><span class="hs-comment">-- for an example of this happening.</span><span>
</span><span id="line-3020"></span><span>
</span><span id="line-3021"></span><span class="annot"><a href="GHC.Tc.TyCl.html#addConsistencyConstraints"><span class="hs-identifier hs-type">addConsistencyConstraints</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#AssocInstInfo"><span class="hs-identifier hs-type">AssocInstInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3022"></span><span class="hs-comment">-- In the corresponding positions of the class and type-family,</span><span>
</span><span id="line-3023"></span><span class="hs-comment">-- ensure the family argument is the same as the class argument</span><span>
</span><span id="line-3024"></span><span class="hs-comment">--   E.g    class C a b c d where</span><span>
</span><span id="line-3025"></span><span class="hs-comment">--             F c x y a :: Type</span><span>
</span><span id="line-3026"></span><span class="hs-comment">-- Here the first  arg of F should be the same as the third of C</span><span>
</span><span id="line-3027"></span><span class="hs-comment">--  and the fourth arg of F should be the same as the first of C</span><span>
</span><span id="line-3028"></span><span class="hs-comment">--</span><span>
</span><span id="line-3029"></span><span class="hs-comment">-- We emit /Derived/ constraints (a bit like fundeps) to encourage</span><span>
</span><span id="line-3030"></span><span class="hs-comment">-- unification to happen, but without actually reporting errors.</span><span>
</span><span id="line-3031"></span><span class="hs-comment">-- If, despite the efforts, corresponding positions do not match,</span><span>
</span><span id="line-3032"></span><span class="hs-comment">-- checkConsistentFamInst will complain</span><span>
</span><span id="line-3033"></span><span id="addConsistencyConstraints"><span class="annot"><span class="annottext">addConsistencyConstraints :: AssocInstInfo -&gt; Type -&gt; TcRn ()
</span><a href="GHC.Tc.TyCl.html#addConsistencyConstraints"><span class="hs-identifier hs-var hs-var">addConsistencyConstraints</span></a></span></span><span> </span><span id="local-6989586621681165805"><span class="annot"><span class="annottext">AssocInstInfo
</span><a href="#local-6989586621681165805"><span class="hs-identifier hs-var">mb_clsinfo</span></a></span></span><span> </span><span id="local-6989586621681165804"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165804"><span class="hs-identifier hs-var">fam_app</span></a></span></span><span>
</span><span id="line-3034"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Class.html#InClsInst"><span class="hs-identifier hs-type">InClsInst</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ai_inst_env :: AssocInstInfo -&gt; VarEnv Type
</span><a href="GHC.Tc.Instance.Class.html#ai_inst_env"><span class="hs-identifier hs-var">ai_inst_env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681165802"><span class="annot"><span class="annottext">VarEnv Type
</span><a href="#local-6989586621681165802"><span class="hs-identifier hs-var">inst_env</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">AssocInstInfo
</span><a href="#local-6989586621681165805"><span class="hs-identifier hs-var">mb_clsinfo</span></a></span><span>
</span><span id="line-3035"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681165801"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165801"><span class="hs-identifier hs-var">fam_tc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681165800"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681165800"><span class="hs-identifier hs-var">pats</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; Type -&gt; Maybe (TyCon, [Type])
Type -&gt; Maybe (TyCon, [Type])
</span><a href="GHC.Core.Type.html#tcSplitTyConApp_maybe"><span class="hs-identifier hs-var">tcSplitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165804"><span class="hs-identifier hs-var">fam_app</span></a></span><span>
</span><span id="line-3036"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681165798"><span class="annot"><span class="annottext">eqs :: [(Type, Type)]
</span><a href="#local-6989586621681165798"><span class="hs-identifier hs-var hs-var">eqs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165797"><span class="hs-identifier hs-var">cls_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165796"><span class="hs-identifier hs-var">pat</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3037"></span><span>                   </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681165795"><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681165795"><span class="hs-identifier hs-var">fam_tc_tv</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681165796"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165796"><span class="hs-identifier hs-var">pat</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [TyVar]
</span><a href="GHC.Core.TyCon.html#tyConTyVars"><span class="hs-identifier hs-var hs-var">tyConTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165801"><span class="hs-identifier hs-var">fam_tc</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; [Type] -&gt; [(TyVar, Type)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../../base/src/GHC.List.html#zip"><span class="hs-operator hs-var">`zip`</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681165800"><span class="hs-identifier hs-var">pats</span></a></span><span>
</span><span id="line-3038"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681165797"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165797"><span class="hs-identifier hs-var">cls_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">VarEnv Type -&gt; TyVar -&gt; Maybe Type
forall a. VarEnv a -&gt; TyVar -&gt; Maybe a
</span><a href="GHC.Types.Var.Env.html#lookupVarEnv"><span class="hs-identifier hs-var">lookupVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv Type
</span><a href="#local-6989586621681165802"><span class="hs-identifier hs-var">inst_env</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681165795"><span class="hs-identifier hs-var">fam_tc_tv</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-3039"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;addConsistencyConstraints&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(Type, Type)] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[(Type, Type)]
</span><a href="#local-6989586621681165798"><span class="hs-identifier hs-var">eqs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3040"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; [(Type, Type)] -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.TcMType.html#emitDerivedEqs"><span class="hs-identifier hs-var">emitDerivedEqs</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#AssocFamPatOrigin"><span class="hs-identifier hs-var">AssocFamPatOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">[(Type, Type)]
</span><a href="#local-6989586621681165798"><span class="hs-identifier hs-var">eqs</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3041"></span><span>    </span><span class="hs-comment">-- Improve inference</span><span>
</span><span id="line-3042"></span><span>    </span><span class="hs-comment">-- Any mis-match is reports by checkConsistentFamInst</span><span>
</span><span id="line-3043"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-3044"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3045"></span><span>
</span><span id="line-3046"></span><span class="hs-comment">{- Note [Constraints in patterns]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
NB: This isn't the whole story. See comment in tcFamTyPats.

At first glance, it seems there is a complicated story to tell in tcFamTyPats
around constraint solving. After all, type family patterns can now do
GADT pattern-matching, which is jolly complicated. But, there's a key fact
which makes this all simple: everything is at top level! There cannot
be untouchable type variables. There can't be weird interaction between
case branches. There can't be global skolems.

This means that the semantics of type-level GADT matching is a little
different than term level. If we have

  data G a where
    MkGBool :: G Bool

And then

  type family F (a :: G k) :: k
  type instance F MkGBool = True

we get

  axF : F Bool (MkGBool &lt;Bool&gt;) ~ True

Simple! No casting on the RHS, because we can affect the kind parameter
to F.

If we ever introduce local type families, this all gets a lot more
complicated, and will end up looking awfully like term-level GADT
pattern-matching.


** The new story **

Here is really what we want:

The matcher really can't deal with covars in arbitrary spots in coercions.
But it can deal with covars that are arguments to GADT data constructors.
So we somehow want to allow covars only in precisely those spots, then use
them as givens when checking the RHS. TODO (RAE): Implement plan.

Note [Quantified kind variables of a family pattern]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider   type family KindFam (p :: k1) (q :: k1)
           data T :: Maybe k1 -&gt; k2 -&gt; *
           type instance KindFam (a :: Maybe k) b = T a b -&gt; Int
The HsBSig for the family patterns will be ([k], [a])

Then in the family instance we want to
  * Bring into scope [ &quot;k&quot; -&gt; k:*, &quot;a&quot; -&gt; a:k ]
  * Kind-check the RHS
  * Quantify the type instance over k and k', as well as a,b, thus
       type instance [k, k', a:Maybe k, b:k']
                     KindFam (Maybe k) k' a b = T k k' a b -&gt; Int

Notice that in the third step we quantify over all the visibly-mentioned
type variables (a,b), but also over the implicitly mentioned kind variables
(k, k').  In this case one is bound explicitly but often there will be
none. The role of the kind signature (a :: Maybe k) is to add a constraint
that 'a' must have that kind, and to bring 'k' into scope.



************************************************************************
*                                                                      *
               Data types
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-3117"></span><span>
</span><span id="line-3118"></span><span class="annot"><a href="GHC.Tc.TyCl.html#dataDeclChecks"><span class="hs-identifier hs-type">dataDeclChecks</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Decls.html#NewOrData"><span class="hs-identifier hs-type">NewOrData</span></a></span><span>
</span><span id="line-3119"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Type.html#LHsContext"><span class="hs-identifier hs-type">LHsContext</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Hs.Decls.html#LConDecl"><span class="hs-identifier hs-type">LConDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-3120"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-3121"></span><span id="dataDeclChecks"><span class="annot"><span class="annottext">dataDeclChecks :: Name
-&gt; NewOrData
-&gt; GenLocated SrcSpan (HsContext GhcRn)
-&gt; [LConDecl GhcRn]
-&gt; TcRnIf TcGblEnv TcLclEnv Bool
</span><a href="GHC.Tc.TyCl.html#dataDeclChecks"><span class="hs-identifier hs-var hs-var">dataDeclChecks</span></a></span></span><span> </span><span id="local-6989586621681165792"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165792"><span class="hs-identifier hs-var">tc_name</span></a></span></span><span> </span><span id="local-6989586621681165791"><span class="annot"><span class="annottext">NewOrData
</span><a href="#local-6989586621681165791"><span class="hs-identifier hs-var">new_or_data</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681165790"><span class="annot"><span class="annottext">HsContext GhcRn
</span><a href="#local-6989586621681165790"><span class="hs-identifier hs-var">stupid_theta</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681165789"><span class="annot"><span class="annottext">[LConDecl GhcRn]
</span><a href="#local-6989586621681165789"><span class="hs-identifier hs-var">cons</span></a></span></span><span>
</span><span id="line-3122"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>   </span><span class="hs-comment">-- Check that we don't use GADT syntax in H98 world</span><span>
</span><span id="line-3123"></span><span>         </span><span id="local-6989586621681165788"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681165788"><span class="hs-identifier hs-var">gadtSyntax_ok</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall gbl lcl. Extension -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><a href="../../ghc-boot-th/src/GHC.LanguageExtensions.Type.html#GADTSyntax"><span class="hs-identifier hs-var">LangExt.GADTSyntax</span></a></span><span>
</span><span id="line-3124"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681165786"><span class="annot"><span class="annottext">gadt_syntax :: Bool
</span><a href="#local-6989586621681165786"><span class="hs-identifier hs-var hs-var">gadt_syntax</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[LConDecl GhcRn] -&gt; Bool
</span><a href="GHC.Tc.TyCl.html#consUseGadtSyntax"><span class="hs-identifier hs-var">consUseGadtSyntax</span></a></span><span> </span><span class="annot"><span class="annottext">[LConDecl GhcRn]
</span><a href="#local-6989586621681165789"><span class="hs-identifier hs-var">cons</span></a></span><span>
</span><span id="line-3125"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681165788"><span class="hs-identifier hs-var">gadtSyntax_ok</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681165786"><span class="hs-identifier hs-var">gadt_syntax</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#badGadtDecl"><span class="hs-identifier hs-var">badGadtDecl</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165792"><span class="hs-identifier hs-var">tc_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3126"></span><span>
</span><span id="line-3127"></span><span>           </span><span class="hs-comment">-- Check that the stupid theta is empty for a GADT-style declaration</span><span>
</span><span id="line-3128"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsContext GhcRn -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">HsContext GhcRn
</span><a href="#local-6989586621681165790"><span class="hs-identifier hs-var">stupid_theta</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681165786"><span class="hs-identifier hs-var">gadt_syntax</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#badStupidTheta"><span class="hs-identifier hs-var">badStupidTheta</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165792"><span class="hs-identifier hs-var">tc_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3129"></span><span>
</span><span id="line-3130"></span><span>         </span><span class="hs-comment">-- Check that a newtype has exactly one constructor</span><span>
</span><span id="line-3131"></span><span>         </span><span class="hs-comment">-- Do this before checking for empty data decls, so that</span><span>
</span><span id="line-3132"></span><span>         </span><span class="hs-comment">-- we don't suggest -XEmptyDataDecls for newtypes</span><span>
</span><span id="line-3133"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NewOrData
</span><a href="#local-6989586621681165791"><span class="hs-identifier hs-var">new_or_data</span></a></span><span> </span><span class="annot"><span class="annottext">NewOrData -&gt; NewOrData -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">NewOrData
</span><a href="GHC.Hs.Decls.html#DataType"><span class="hs-identifier hs-var">DataType</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">[LConDecl GhcRn] -&gt; Bool
forall a. [a] -&gt; Bool
</span><a href="GHC.Utils.Misc.html#isSingleton"><span class="hs-identifier hs-var">isSingleton</span></a></span><span> </span><span class="annot"><span class="annottext">[LConDecl GhcRn]
</span><a href="#local-6989586621681165789"><span class="hs-identifier hs-var">cons</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3134"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Arity -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#newtypeConError"><span class="hs-identifier hs-var">newtypeConError</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165792"><span class="hs-identifier hs-var">tc_name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[LConDecl GhcRn] -&gt; Arity
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Arity
</span><a href="../../base/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[LConDecl GhcRn]
</span><a href="#local-6989586621681165789"><span class="hs-identifier hs-var">cons</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3135"></span><span>
</span><span id="line-3136"></span><span>         </span><span class="hs-comment">-- Check that there's at least one condecl,</span><span>
</span><span id="line-3137"></span><span>         </span><span class="hs-comment">-- or else we're reading an hs-boot file, or -XEmptyDataDecls</span><span>
</span><span id="line-3138"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681165780"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681165780"><span class="hs-identifier hs-var">empty_data_decls</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall gbl lcl. Extension -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><a href="../../ghc-boot-th/src/GHC.LanguageExtensions.Type.html#EmptyDataDecls"><span class="hs-identifier hs-var">LangExt.EmptyDataDecls</span></a></span><span>
</span><span id="line-3139"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681165778"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681165778"><span class="hs-identifier hs-var">is_boot</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv Bool
</span><a href="GHC.Tc.Utils.Monad.html#tcIsHsBootOrSig"><span class="hs-identifier hs-var">tcIsHsBootOrSig</span></a></span><span>  </span><span class="hs-comment">-- Are we compiling an hs-boot file?</span><span>
</span><span id="line-3140"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[LConDecl GhcRn] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[LConDecl GhcRn]
</span><a href="#local-6989586621681165789"><span class="hs-identifier hs-var">cons</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681165780"><span class="hs-identifier hs-var">empty_data_decls</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681165778"><span class="hs-identifier hs-var">is_boot</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3141"></span><span>                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#emptyConDeclsErr"><span class="hs-identifier hs-var">emptyConDeclsErr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165792"><span class="hs-identifier hs-var">tc_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3142"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681165786"><span class="hs-identifier hs-var">gadt_syntax</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3143"></span><span>
</span><span id="line-3144"></span><span>
</span><span id="line-3145"></span><span class="hs-comment">-----------------------------------</span><span>
</span><span id="line-3146"></span><span class="annot"><a href="GHC.Tc.TyCl.html#consUseGadtSyntax"><span class="hs-identifier hs-type">consUseGadtSyntax</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Hs.Decls.html#LConDecl"><span class="hs-identifier hs-type">LConDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-3147"></span><span id="consUseGadtSyntax"><span class="annot"><span class="annottext">consUseGadtSyntax :: [LConDecl GhcRn] -&gt; Bool
</span><a href="GHC.Tc.TyCl.html#consUseGadtSyntax"><span class="hs-identifier hs-var hs-var">consUseGadtSyntax</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Decls.html#ConDeclGADT"><span class="hs-identifier hs-type">ConDeclGADT</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[LConDecl GhcRn]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-3148"></span><span class="annot"><a href="GHC.Tc.TyCl.html#consUseGadtSyntax"><span class="hs-identifier hs-var">consUseGadtSyntax</span></a></span><span> </span><span class="annot"><span class="annottext">[LConDecl GhcRn]
</span><span class="hs-identifier">_</span></span><span>                          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-3149"></span><span>                 </span><span class="hs-comment">-- All constructors have same shape</span><span>
</span><span id="line-3150"></span><span>
</span><span id="line-3151"></span><span class="hs-comment">-----------------------------------</span><span>
</span><span id="line-3152"></span><span class="annot"><a href="GHC.Tc.TyCl.html#tcConDecls"><span class="hs-identifier hs-type">tcConDecls</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#KnotTied"><span class="hs-identifier hs-type">KnotTied</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Decls.html#NewOrData"><span class="hs-identifier hs-type">NewOrData</span></a></span><span>
</span><span id="line-3153"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCon.html#TyConBinder"><span class="hs-identifier hs-type">TyConBinder</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a></span><span>   </span><span class="hs-comment">-- binders and result kind of tycon</span><span>
</span><span id="line-3154"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#KnotTied"><span class="hs-identifier hs-type">KnotTied</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Hs.Decls.html#LConDecl"><span class="hs-identifier hs-type">LConDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-3155"></span><span id="tcConDecls"><span class="annot"><span class="annottext">tcConDecls :: TyCon
-&gt; NewOrData
-&gt; [TyConBinder]
-&gt; Type
-&gt; Type
-&gt; [LConDecl GhcRn]
-&gt; TcM [DataCon]
</span><a href="GHC.Tc.TyCl.html#tcConDecls"><span class="hs-identifier hs-var hs-var">tcConDecls</span></a></span></span><span> </span><span id="local-6989586621681165776"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165776"><span class="hs-identifier hs-var">rep_tycon</span></a></span></span><span> </span><span id="local-6989586621681165775"><span class="annot"><span class="annottext">NewOrData
</span><a href="#local-6989586621681165775"><span class="hs-identifier hs-var">new_or_data</span></a></span></span><span> </span><span id="local-6989586621681165774"><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621681165774"><span class="hs-identifier hs-var">tmpl_bndrs</span></a></span></span><span> </span><span id="local-6989586621681165773"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165773"><span class="hs-identifier hs-var">res_kind</span></a></span></span><span> </span><span id="local-6989586621681165772"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165772"><span class="hs-identifier hs-var">res_tmpl</span></a></span></span><span>
</span><span id="line-3156"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LConDecl GhcRn -&gt; TcM [DataCon])
-&gt; [LConDecl GhcRn] -&gt; TcM [DataCon]
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m [b]) -&gt; [a] -&gt; m [b]
</span><a href="GHC.Utils.Monad.html#concatMapM"><span class="hs-identifier hs-var">concatMapM</span></a></span><span> </span><span class="annot"><span class="annottext">((LConDecl GhcRn -&gt; TcM [DataCon])
 -&gt; [LConDecl GhcRn] -&gt; TcM [DataCon])
-&gt; (LConDecl GhcRn -&gt; TcM [DataCon])
-&gt; [LConDecl GhcRn]
-&gt; TcM [DataCon]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(ConDecl GhcRn -&gt; TcM [DataCon]) -&gt; LConDecl GhcRn -&gt; TcM [DataCon]
forall a b. (a -&gt; TcM b) -&gt; Located a -&gt; TcM b
</span><a href="GHC.Tc.Utils.Monad.html#addLocM"><span class="hs-identifier hs-var">addLocM</span></a></span><span> </span><span class="annot"><span class="annottext">((ConDecl GhcRn -&gt; TcM [DataCon])
 -&gt; LConDecl GhcRn -&gt; TcM [DataCon])
-&gt; (ConDecl GhcRn -&gt; TcM [DataCon])
-&gt; LConDecl GhcRn
-&gt; TcM [DataCon]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3157"></span><span>    </span><span class="annot"><span class="annottext">TyCon
-&gt; NameEnv Arity
-&gt; [TyConBinder]
-&gt; Type
-&gt; Type
-&gt; NewOrData
-&gt; ConDecl GhcRn
-&gt; TcM [DataCon]
</span><a href="GHC.Tc.TyCl.html#tcConDecl"><span class="hs-identifier hs-var">tcConDecl</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165776"><span class="hs-identifier hs-var">rep_tycon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; NameEnv Arity
</span><a href="GHC.Core.TyCon.html#mkTyConTagMap"><span class="hs-identifier hs-var">mkTyConTagMap</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165776"><span class="hs-identifier hs-var">rep_tycon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3158"></span><span>              </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621681165774"><span class="hs-identifier hs-var">tmpl_bndrs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165773"><span class="hs-identifier hs-var">res_kind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165772"><span class="hs-identifier hs-var">res_tmpl</span></a></span><span> </span><span class="annot"><span class="annottext">NewOrData
</span><a href="#local-6989586621681165775"><span class="hs-identifier hs-var">new_or_data</span></a></span><span>
</span><span id="line-3159"></span><span>    </span><span class="hs-comment">-- It's important that we pay for tag allocation here, once per TyCon,</span><span>
</span><span id="line-3160"></span><span>    </span><span class="hs-comment">-- See Note [Constructor tag allocation], fixes #14657</span><span>
</span><span id="line-3161"></span><span>
</span><span id="line-3162"></span><span class="annot"><a href="GHC.Tc.TyCl.html#tcConDecl"><span class="hs-identifier hs-type">tcConDecl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#KnotTied"><span class="hs-identifier hs-type">KnotTied</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span>          </span><span class="hs-comment">-- Representation tycon. Knot-tied!</span><span>
</span><span id="line-3163"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Env.html#NameEnv"><span class="hs-identifier hs-type">NameEnv</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#ConTag"><span class="hs-identifier hs-type">ConTag</span></a></span><span>
</span><span id="line-3164"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCon.html#TyConBinder"><span class="hs-identifier hs-type">TyConBinder</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcKind"><span class="hs-identifier hs-type">TcKind</span></a></span><span>   </span><span class="hs-comment">-- tycon binders and result kind</span><span>
</span><span id="line-3165"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#KnotTied"><span class="hs-identifier hs-type">KnotTied</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-3166"></span><span>                 </span><span class="hs-comment">-- Return type template (T tys), where T is the family TyCon</span><span>
</span><span id="line-3167"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Decls.html#NewOrData"><span class="hs-identifier hs-type">NewOrData</span></a></span><span>
</span><span id="line-3168"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Decls.html#ConDecl"><span class="hs-identifier hs-type">ConDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-3169"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-3170"></span><span>
</span><span id="line-3171"></span><span id="tcConDecl"><span class="annot"><span class="annottext">tcConDecl :: TyCon
-&gt; NameEnv Arity
-&gt; [TyConBinder]
-&gt; Type
-&gt; Type
-&gt; NewOrData
-&gt; ConDecl GhcRn
-&gt; TcM [DataCon]
</span><a href="GHC.Tc.TyCl.html#tcConDecl"><span class="hs-identifier hs-var hs-var">tcConDecl</span></a></span></span><span> </span><span id="local-6989586621681165768"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165768"><span class="hs-identifier hs-var">rep_tycon</span></a></span></span><span> </span><span id="local-6989586621681165767"><span class="annot"><span class="annottext">NameEnv Arity
</span><a href="#local-6989586621681165767"><span class="hs-identifier hs-var">tag_map</span></a></span></span><span> </span><span id="local-6989586621681165766"><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621681165766"><span class="hs-identifier hs-var">tmpl_bndrs</span></a></span></span><span> </span><span id="local-6989586621681165765"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165765"><span class="hs-identifier hs-var">res_kind</span></a></span></span><span> </span><span id="local-6989586621681165764"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165764"><span class="hs-identifier hs-var">res_tmpl</span></a></span></span><span> </span><span id="local-6989586621681165763"><span class="annot"><span class="annottext">NewOrData
</span><a href="#local-6989586621681165763"><span class="hs-identifier hs-var">new_or_data</span></a></span></span><span>
</span><span id="line-3172"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Decls.html#ConDeclH98"><span class="hs-identifier hs-type">ConDeclH98</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">con_name :: forall pass. ConDecl pass -&gt; Located (IdP pass)
</span><a href="GHC.Hs.Decls.html#con_name"><span class="hs-identifier hs-var">con_name</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681165762"><span class="annot"><span class="annottext">GenLocated SrcSpan (IdP GhcRn)
</span><a href="#local-6989586621681165762"><span class="hs-identifier hs-var">name</span></a></span></span><span>
</span><span id="line-3173"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">con_ex_tvs :: forall pass. ConDecl pass -&gt; [LHsTyVarBndr Specificity pass]
</span><a href="GHC.Hs.Decls.html#con_ex_tvs"><span class="hs-identifier hs-var">con_ex_tvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681165761"><span class="annot"><span class="annottext">[LHsTyVarBndr Specificity GhcRn]
</span><a href="#local-6989586621681165761"><span class="hs-identifier hs-var">explicit_tkv_nms</span></a></span></span><span>
</span><span id="line-3174"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">con_mb_cxt :: forall pass. ConDecl pass -&gt; Maybe (LHsContext pass)
</span><a href="GHC.Hs.Decls.html#con_mb_cxt"><span class="hs-identifier hs-var">con_mb_cxt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681165760"><span class="annot"><span class="annottext">Maybe (GenLocated SrcSpan (HsContext GhcRn))
</span><a href="#local-6989586621681165760"><span class="hs-identifier hs-var">hs_ctxt</span></a></span></span><span>
</span><span id="line-3175"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">con_args :: forall pass. ConDecl pass -&gt; HsConDeclDetails pass
</span><a href="GHC.Hs.Decls.html#con_args"><span class="hs-identifier hs-var">con_args</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681165759"><span class="annot"><span class="annottext">HsConDeclDetails GhcRn
</span><a href="#local-6989586621681165759"><span class="hs-identifier hs-var">hs_args</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-3176"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcM [DataCon] -&gt; TcM [DataCon]
forall a. SDoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Located Name] -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#dataConCtxtName"><span class="hs-identifier hs-var">dataConCtxtName</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Located Name
GenLocated SrcSpan (IdP GhcRn)
</span><a href="#local-6989586621681165762"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM [DataCon] -&gt; TcM [DataCon]) -&gt; TcM [DataCon] -&gt; TcM [DataCon]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3177"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- NB: the tyvars from the declaration header are in scope</span><span>
</span><span id="line-3178"></span><span>
</span><span id="line-3179"></span><span>         </span><span class="hs-comment">-- Get hold of the existential type variables</span><span>
</span><span id="line-3180"></span><span>         </span><span class="hs-comment">-- e.g. data T a = forall k (b::k) f. MkT a (f b)</span><span>
</span><span id="line-3181"></span><span>         </span><span class="hs-comment">-- Here tmpl_bndrs = {a}</span><span>
</span><span id="line-3182"></span><span>         </span><span class="hs-comment">--      hs_qvars = HsQTvs { hsq_implicit = {k}</span><span>
</span><span id="line-3183"></span><span>         </span><span class="hs-comment">--                        , hsq_explicit = {f,b} }</span><span>
</span><span id="line-3184"></span><span>
</span><span id="line-3185"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcConDecl 1&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Located Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Located Name
GenLocated SrcSpan (IdP GhcRn)
</span><a href="#local-6989586621681165762"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[LHsTyVarBndr Specificity GhcRn] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsTyVarBndr Specificity GhcRn]
</span><a href="#local-6989586621681165761"><span class="hs-identifier hs-var">explicit_tkv_nms</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-3186"></span><span>
</span><span id="line-3187"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681165758"><span class="annot"><span class="annottext">[VarBndr TyVar Specificity]
</span><a href="#local-6989586621681165758"><span class="hs-identifier hs-var">exp_tvbndrs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681165757"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681165757"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681165756"><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621681165756"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681165755"><span class="annot"><span class="annottext">[FieldLabel]
</span><a href="#local-6989586621681165755"><span class="hs-identifier hs-var">field_lbls</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681165754"><span class="annot"><span class="annottext">[HsSrcBang]
</span><a href="#local-6989586621681165754"><span class="hs-identifier hs-var">stricts</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3188"></span><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM
  ([VarBndr TyVar Specificity],
   ([Type], [Scaled Type], [FieldLabel], [HsSrcBang]))
-&gt; TcM
     ([VarBndr TyVar Specificity],
      ([Type], [Scaled Type], [FieldLabel], [HsSrcBang]))
forall r. TcM r -&gt; TcM r
</span><a href="GHC.Tc.Utils.Monad.html#pushTcLevelM_"><span class="hs-identifier hs-var">pushTcLevelM_</span></a></span><span>                             </span><span class="annot"><span class="annottext">(TcM
   ([VarBndr TyVar Specificity],
    ([Type], [Scaled Type], [FieldLabel], [HsSrcBang]))
 -&gt; TcM
      ([VarBndr TyVar Specificity],
       ([Type], [Scaled Type], [FieldLabel], [HsSrcBang])))
-&gt; TcM
     ([VarBndr TyVar Specificity],
      ([Type], [Scaled Type], [FieldLabel], [HsSrcBang]))
-&gt; TcM
     ([VarBndr TyVar Specificity],
      ([Type], [Scaled Type], [FieldLabel], [HsSrcBang]))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3189"></span><span>              </span><span class="annot"><span class="annottext">TcM
  ([VarBndr TyVar Specificity],
   ([Type], [Scaled Type], [FieldLabel], [HsSrcBang]))
-&gt; TcM
     ([VarBndr TyVar Specificity],
      ([Type], [Scaled Type], [FieldLabel], [HsSrcBang]))
forall r. TcM r -&gt; TcM r
</span><a href="GHC.Tc.Solver.html#solveEqualities"><span class="hs-identifier hs-var">solveEqualities</span></a></span><span>                           </span><span class="annot"><span class="annottext">(TcM
   ([VarBndr TyVar Specificity],
    ([Type], [Scaled Type], [FieldLabel], [HsSrcBang]))
 -&gt; TcM
      ([VarBndr TyVar Specificity],
       ([Type], [Scaled Type], [FieldLabel], [HsSrcBang])))
-&gt; TcM
     ([VarBndr TyVar Specificity],
      ([Type], [Scaled Type], [FieldLabel], [HsSrcBang]))
-&gt; TcM
     ([VarBndr TyVar Specificity],
      ([Type], [Scaled Type], [FieldLabel], [HsSrcBang]))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3190"></span><span>              </span><span class="annot"><span class="annottext">[LHsTyVarBndr Specificity GhcRn]
-&gt; TcM ([Type], [Scaled Type], [FieldLabel], [HsSrcBang])
-&gt; TcM
     ([VarBndr TyVar Specificity],
      ([Type], [Scaled Type], [FieldLabel], [HsSrcBang]))
forall flag a.
OutputableBndrFlag flag =&gt;
[LHsTyVarBndr flag GhcRn] -&gt; TcM a -&gt; TcM ([VarBndr TyVar flag], a)
</span><a href="GHC.Tc.Gen.HsType.html#bindExplicitTKBndrs_Skol"><span class="hs-identifier hs-var">bindExplicitTKBndrs_Skol</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsTyVarBndr Specificity GhcRn]
</span><a href="#local-6989586621681165761"><span class="hs-identifier hs-var">explicit_tkv_nms</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM ([Type], [Scaled Type], [FieldLabel], [HsSrcBang])
 -&gt; TcM
      ([VarBndr TyVar Specificity],
       ([Type], [Scaled Type], [FieldLabel], [HsSrcBang])))
-&gt; TcM ([Type], [Scaled Type], [FieldLabel], [HsSrcBang])
-&gt; TcM
     ([VarBndr TyVar Specificity],
      ([Type], [Scaled Type], [FieldLabel], [HsSrcBang]))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3191"></span><span>              </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681165752"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681165752"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (GenLocated SrcSpan (HsContext GhcRn)) -&gt; TcM [Type]
</span><a href="GHC.Tc.Gen.HsType.html#tcHsMbContext"><span class="hs-identifier hs-var">tcHsMbContext</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (GenLocated SrcSpan (HsContext GhcRn))
</span><a href="#local-6989586621681165760"><span class="hs-identifier hs-var">hs_ctxt</span></a></span><span>
</span><span id="line-3192"></span><span>                 </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681165751"><span class="annot"><span class="annottext">exp_kind :: ContextKind
</span><a href="#local-6989586621681165751"><span class="hs-identifier hs-var hs-var">exp_kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NewOrData -&gt; Type -&gt; ContextKind
</span><a href="GHC.Tc.TyCl.html#getArgExpKind"><span class="hs-identifier hs-var">getArgExpKind</span></a></span><span> </span><span class="annot"><span class="annottext">NewOrData
</span><a href="#local-6989586621681165763"><span class="hs-identifier hs-var">new_or_data</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165765"><span class="hs-identifier hs-var">res_kind</span></a></span><span>
</span><span id="line-3193"></span><span>                 </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681165750"><span class="annot"><span class="annottext">[(Scaled Type, HsSrcBang)]
</span><a href="#local-6989586621681165750"><span class="hs-identifier hs-var">btys</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ContextKind
-&gt; HsConDeclDetails GhcRn -&gt; TcM [(Scaled Type, HsSrcBang)]
</span><a href="GHC.Tc.TyCl.html#tcConArgs"><span class="hs-identifier hs-var">tcConArgs</span></a></span><span> </span><span class="annot"><span class="annottext">ContextKind
</span><a href="#local-6989586621681165751"><span class="hs-identifier hs-var">exp_kind</span></a></span><span> </span><span class="annot"><span class="annottext">HsConDeclDetails GhcRn
</span><a href="#local-6989586621681165759"><span class="hs-identifier hs-var">hs_args</span></a></span><span>
</span><span id="line-3194"></span><span>                 </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681165748"><span class="annot"><span class="annottext">[FieldLabel]
</span><a href="#local-6989586621681165748"><span class="hs-identifier hs-var">field_lbls</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; RnM [FieldLabel]
</span><a href="GHC.Rename.Env.html#lookupConstructorFields"><span class="hs-identifier hs-var">lookupConstructorFields</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Located Name -&gt; Name
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">Located Name
GenLocated SrcSpan (IdP GhcRn)
</span><a href="#local-6989586621681165762"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3195"></span><span>                 </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681165747"><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621681165747"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681165746"><span class="annot"><span class="annottext">[HsSrcBang]
</span><a href="#local-6989586621681165746"><span class="hs-identifier hs-var">stricts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Scaled Type, HsSrcBang)] -&gt; ([Scaled Type], [HsSrcBang])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><a href="../../base/src/GHC.List.html#unzip"><span class="hs-identifier hs-var">unzip</span></a></span><span> </span><span class="annot"><span class="annottext">[(Scaled Type, HsSrcBang)]
</span><a href="#local-6989586621681165750"><span class="hs-identifier hs-var">btys</span></a></span><span>
</span><span id="line-3196"></span><span>                 </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">([Type], [Scaled Type], [FieldLabel], [HsSrcBang])
-&gt; TcM ([Type], [Scaled Type], [FieldLabel], [HsSrcBang])
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681165752"><span class="hs-identifier hs-var">ctxt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621681165747"><span class="hs-identifier hs-var">arg_tys</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[FieldLabel]
</span><a href="#local-6989586621681165748"><span class="hs-identifier hs-var">field_lbls</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[HsSrcBang]
</span><a href="#local-6989586621681165746"><span class="hs-identifier hs-var">stricts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3197"></span><span>                 </span><span class="hs-special">}</span><span>
</span><span id="line-3198"></span><span>
</span><span id="line-3199"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681165744"><span class="annot"><span class="annottext">tmpl_tvs :: [TyVar]
</span><a href="#local-6989586621681165744"><span class="hs-identifier hs-var hs-var">tmpl_tvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyConBinder] -&gt; [TyVar]
forall tv argf. [VarBndr tv argf] -&gt; [tv]
</span><a href="GHC.Types.Var.html#binderVars"><span class="hs-identifier hs-var">binderVars</span></a></span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621681165766"><span class="hs-identifier hs-var">tmpl_bndrs</span></a></span><span>
</span><span id="line-3200"></span><span>
</span><span id="line-3201"></span><span>         </span><span class="hs-comment">-- exp_tvs have explicit, user-written binding sites</span><span>
</span><span id="line-3202"></span><span>         </span><span class="hs-comment">-- the kvs below are those kind variables entirely unmentioned by the user</span><span>
</span><span id="line-3203"></span><span>         </span><span class="hs-comment">--   and discovered only by generalization</span><span>
</span><span id="line-3204"></span><span>
</span><span id="line-3205"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681165743"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165743"><span class="hs-identifier hs-var">kvs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM [TyVar]
</span><a href="GHC.Tc.Gen.HsType.html#kindGeneralizeAll"><span class="hs-identifier hs-var">kindGeneralizeAll</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyVar] -&gt; Type -&gt; Type
</span><a href="GHC.Core.Type.html#mkSpecForAllTys"><span class="hs-identifier hs-var">mkSpecForAllTys</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165744"><span class="hs-identifier hs-var">tmpl_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type) -&gt; Type -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3206"></span><span>                                   </span><span class="annot"><span class="annottext">[VarBndr TyVar Specificity] -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkInvisForAllTys"><span class="hs-identifier hs-var">mkInvisForAllTys</span></a></span><span> </span><span class="annot"><span class="annottext">[VarBndr TyVar Specificity]
</span><a href="#local-6989586621681165758"><span class="hs-identifier hs-var">exp_tvbndrs</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type) -&gt; Type -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3207"></span><span>                                   </span><span class="annot"><span class="annottext">[Type] -&gt; Type -&gt; Type
</span><a href="GHC.Tc.Utils.TcType.html#mkPhiTy"><span class="hs-identifier hs-var">mkPhiTy</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681165757"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type) -&gt; Type -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3208"></span><span>                                   </span><span class="annot"><span class="annottext">[Scaled Type] -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkVisFunTys"><span class="hs-identifier hs-var">mkVisFunTys</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621681165756"><span class="hs-identifier hs-var">arg_tys</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type) -&gt; Type -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3209"></span><span>                                   </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#unitTy"><span class="hs-identifier hs-var">unitTy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3210"></span><span>                 </span><span class="hs-comment">-- That type is a lie, of course. (It shouldn't end in ()!)</span><span>
</span><span id="line-3211"></span><span>                 </span><span class="hs-comment">-- And we could construct a proper result type from the info</span><span>
</span><span id="line-3212"></span><span>                 </span><span class="hs-comment">-- at hand. But the result would mention only the tmpl_tvs,</span><span>
</span><span id="line-3213"></span><span>                 </span><span class="hs-comment">-- and so it just creates more work to do it right. Really,</span><span>
</span><span id="line-3214"></span><span>                 </span><span class="hs-comment">-- we're only doing this to find the right kind variables to</span><span>
</span><span id="line-3215"></span><span>                 </span><span class="hs-comment">-- quantify over, and this type is fine for that purpose.</span><span>
</span><span id="line-3216"></span><span>
</span><span id="line-3217"></span><span>             </span><span class="hs-comment">-- Zonk to Types</span><span>
</span><span id="line-3218"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681165737"><span class="annot"><span class="annottext">ZonkEnv
</span><a href="#local-6989586621681165737"><span class="hs-identifier hs-var">ze</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681165736"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165736"><span class="hs-identifier hs-var">qkvs</span></a></span></span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; TcM (ZonkEnv, [TyVar])
</span><a href="GHC.Tc.Utils.Zonk.html#zonkTyBndrs"><span class="hs-identifier hs-var">zonkTyBndrs</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165743"><span class="hs-identifier hs-var">kvs</span></a></span><span>
</span><span id="line-3219"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681165735"><span class="annot"><span class="annottext">ZonkEnv
</span><a href="#local-6989586621681165735"><span class="hs-identifier hs-var">ze</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681165734"><span class="annot"><span class="annottext">[VarBndr TyVar Specificity]
</span><a href="#local-6989586621681165734"><span class="hs-identifier hs-var">user_qtvbndrs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ZonkEnv
-&gt; [VarBndr TyVar Specificity]
-&gt; TcM (ZonkEnv, [VarBndr TyVar Specificity])
forall vis.
ZonkEnv
-&gt; [VarBndr TyVar vis] -&gt; TcM (ZonkEnv, [VarBndr TyVar vis])
</span><a href="GHC.Tc.Utils.Zonk.html#zonkTyVarBindersX"><span class="hs-identifier hs-var">zonkTyVarBindersX</span></a></span><span> </span><span class="annot"><span class="annottext">ZonkEnv
</span><a href="#local-6989586621681165737"><span class="hs-identifier hs-var">ze</span></a></span><span> </span><span class="annot"><span class="annottext">[VarBndr TyVar Specificity]
</span><a href="#local-6989586621681165758"><span class="hs-identifier hs-var">exp_tvbndrs</span></a></span><span>
</span><span id="line-3220"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681165732"><span class="annot"><span class="annottext">user_qtvs :: [TyVar]
</span><a href="#local-6989586621681165732"><span class="hs-identifier hs-var hs-var">user_qtvs</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[VarBndr TyVar Specificity] -&gt; [TyVar]
forall tv argf. [VarBndr tv argf] -&gt; [tv]
</span><a href="GHC.Types.Var.html#binderVars"><span class="hs-identifier hs-var">binderVars</span></a></span><span> </span><span class="annot"><span class="annottext">[VarBndr TyVar Specificity]
</span><a href="#local-6989586621681165734"><span class="hs-identifier hs-var">user_qtvbndrs</span></a></span><span>
</span><span id="line-3221"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681165731"><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621681165731"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span>             </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ZonkEnv -&gt; [Scaled Type] -&gt; TcM [Scaled Type]
</span><a href="GHC.Tc.Utils.Zonk.html#zonkScaledTcTypesToTypesX"><span class="hs-identifier hs-var">zonkScaledTcTypesToTypesX</span></a></span><span> </span><span class="annot"><span class="annottext">ZonkEnv
</span><a href="#local-6989586621681165735"><span class="hs-identifier hs-var">ze</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621681165756"><span class="hs-identifier hs-var">arg_tys</span></a></span><span>
</span><span id="line-3222"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681165729"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681165729"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span>                </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ZonkEnv -&gt; [Type] -&gt; TcM [Type]
</span><a href="GHC.Tc.Utils.Zonk.html#zonkTcTypesToTypesX"><span class="hs-identifier hs-var">zonkTcTypesToTypesX</span></a></span><span> </span><span class="annot"><span class="annottext">ZonkEnv
</span><a href="#local-6989586621681165735"><span class="hs-identifier hs-var">ze</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681165757"><span class="hs-identifier hs-var">ctxt</span></a></span><span>
</span><span id="line-3223"></span><span>
</span><span id="line-3224"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681165728"><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621681165728"><span class="hs-identifier hs-var">fam_envs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM FamInstEnvs
</span><a href="GHC.Tc.Instance.Family.html#tcGetFamInstEnvs"><span class="hs-identifier hs-var">tcGetFamInstEnvs</span></a></span><span>
</span><span id="line-3225"></span><span>
</span><span id="line-3226"></span><span>       </span><span class="hs-comment">-- Can't print univ_tvs, arg_tys etc, because we are inside the knot here</span><span>
</span><span id="line-3227"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcConDecl 2&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Located Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Located Name
GenLocated SrcSpan (IdP GhcRn)
</span><a href="#local-6989586621681165762"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldLabel] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldLabel]
</span><a href="#local-6989586621681165755"><span class="hs-identifier hs-var">field_lbls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3228"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span>
</span><span id="line-3229"></span><span>           </span><span id="local-6989586621681165726"><span class="annot"><span class="annottext">univ_tvbs :: [VarBndr TyVar Specificity]
</span><a href="#local-6989586621681165726"><span class="hs-identifier hs-var hs-var">univ_tvbs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyConBinder] -&gt; [VarBndr TyVar Specificity]
</span><a href="GHC.Core.TyCon.html#tyConInvisTVBinders"><span class="hs-identifier hs-var">tyConInvisTVBinders</span></a></span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621681165766"><span class="hs-identifier hs-var">tmpl_bndrs</span></a></span><span>
</span><span id="line-3230"></span><span>           </span><span id="local-6989586621681165724"><span class="annot"><span class="annottext">univ_tvs :: [TyVar]
</span><a href="#local-6989586621681165724"><span class="hs-identifier hs-var hs-var">univ_tvs</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[VarBndr TyVar Specificity] -&gt; [TyVar]
forall tv argf. [VarBndr tv argf] -&gt; [tv]
</span><a href="GHC.Types.Var.html#binderVars"><span class="hs-identifier hs-var">binderVars</span></a></span><span> </span><span class="annot"><span class="annottext">[VarBndr TyVar Specificity]
</span><a href="#local-6989586621681165726"><span class="hs-identifier hs-var">univ_tvbs</span></a></span><span>
</span><span id="line-3231"></span><span>           </span><span id="local-6989586621681165723"><span class="annot"><span class="annottext">ex_tvbs :: [VarBndr TyVar Specificity]
</span><a href="#local-6989586621681165723"><span class="hs-identifier hs-var hs-var">ex_tvbs</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Specificity -&gt; [TyVar] -&gt; [VarBndr TyVar Specificity]
forall vis. vis -&gt; [TyVar] -&gt; [VarBndr TyVar vis]
</span><a href="GHC.Types.Var.html#mkTyVarBinders"><span class="hs-identifier hs-var">mkTyVarBinders</span></a></span><span> </span><span class="annot"><span class="annottext">Specificity
</span><a href="GHC.Types.Var.html#InferredSpec"><span class="hs-identifier hs-var">InferredSpec</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165736"><span class="hs-identifier hs-var">qkvs</span></a></span><span> </span><span class="annot"><span class="annottext">[VarBndr TyVar Specificity]
-&gt; [VarBndr TyVar Specificity] -&gt; [VarBndr TyVar Specificity]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-3232"></span><span>                       </span><span class="annot"><span class="annottext">[VarBndr TyVar Specificity]
</span><a href="#local-6989586621681165734"><span class="hs-identifier hs-var">user_qtvbndrs</span></a></span><span>
</span><span id="line-3233"></span><span>           </span><span id="local-6989586621681165720"><span class="annot"><span class="annottext">ex_tvs :: [TyVar]
</span><a href="#local-6989586621681165720"><span class="hs-identifier hs-var hs-var">ex_tvs</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165736"><span class="hs-identifier hs-var">qkvs</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; [TyVar] -&gt; [TyVar]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165732"><span class="hs-identifier hs-var">user_qtvs</span></a></span><span>
</span><span id="line-3234"></span><span>           </span><span class="hs-comment">-- For H98 datatypes, the user-written tyvar binders are precisely</span><span>
</span><span id="line-3235"></span><span>           </span><span class="hs-comment">-- the universals followed by the existentials.</span><span>
</span><span id="line-3236"></span><span>           </span><span class="hs-comment">-- See Note [DataCon user type variable binders] in GHC.Core.DataCon.</span><span>
</span><span id="line-3237"></span><span>           </span><span id="local-6989586621681165719"><span class="annot"><span class="annottext">user_tvbs :: [VarBndr TyVar Specificity]
</span><a href="#local-6989586621681165719"><span class="hs-identifier hs-var hs-var">user_tvbs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[VarBndr TyVar Specificity]
</span><a href="#local-6989586621681165726"><span class="hs-identifier hs-var">univ_tvbs</span></a></span><span> </span><span class="annot"><span class="annottext">[VarBndr TyVar Specificity]
-&gt; [VarBndr TyVar Specificity] -&gt; [VarBndr TyVar Specificity]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[VarBndr TyVar Specificity]
</span><a href="#local-6989586621681165723"><span class="hs-identifier hs-var">ex_tvbs</span></a></span><span>
</span><span id="line-3238"></span><span>           </span><span id="local-6989586621681165718"><span class="annot"><span class="annottext">buildOneDataCon :: Located Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) DataCon
</span><a href="#local-6989586621681165718"><span class="hs-identifier hs-var hs-var">buildOneDataCon</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681165717"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165717"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3239"></span><span>             </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681165716"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681165716"><span class="hs-identifier hs-var">is_infix</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; HsConDeclDetails GhcRn -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall a b.
Name -&gt; HsConDetails a b -&gt; TcRnIf TcGblEnv TcLclEnv Bool
</span><a href="GHC.Tc.TyCl.html#tcConIsInfixH98"><span class="hs-identifier hs-var">tcConIsInfixH98</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165717"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">HsConDeclDetails GhcRn
</span><a href="#local-6989586621681165759"><span class="hs-identifier hs-var">hs_args</span></a></span><span>
</span><span id="line-3240"></span><span>             </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681165714"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165714"><span class="hs-identifier hs-var">rep_nm</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcRnIf TcGblEnv TcLclEnv Name
forall gbl lcl. Name -&gt; TcRnIf gbl lcl Name
</span><a href="GHC.Tc.TyCl.Build.html#newTyConRepName"><span class="hs-identifier hs-var">newTyConRepName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165717"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-3241"></span><span>
</span><span id="line-3242"></span><span>             </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">FamInstEnvs
-&gt; Name
-&gt; Bool
-&gt; Name
-&gt; [HsSrcBang]
-&gt; Maybe [HsImplBang]
-&gt; [FieldLabel]
-&gt; [TyVar]
-&gt; [TyVar]
-&gt; [VarBndr TyVar Specificity]
-&gt; [EqSpec]
-&gt; [Type]
-&gt; [Scaled Type]
-&gt; Type
-&gt; TyCon
-&gt; NameEnv Arity
-&gt; IOEnv (Env TcGblEnv TcLclEnv) DataCon
forall m n.
FamInstEnvs
-&gt; Name
-&gt; Bool
-&gt; Name
-&gt; [HsSrcBang]
-&gt; Maybe [HsImplBang]
-&gt; [FieldLabel]
-&gt; [TyVar]
-&gt; [TyVar]
-&gt; [VarBndr TyVar Specificity]
-&gt; [EqSpec]
-&gt; [Type]
-&gt; [Scaled Type]
-&gt; Type
-&gt; TyCon
-&gt; NameEnv Arity
-&gt; TcRnIf m n DataCon
</span><a href="GHC.Tc.TyCl.Build.html#buildDataCon"><span class="hs-identifier hs-var">buildDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621681165728"><span class="hs-identifier hs-var">fam_envs</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165717"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681165716"><span class="hs-identifier hs-var">is_infix</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165714"><span class="hs-identifier hs-var">rep_nm</span></a></span><span>
</span><span id="line-3243"></span><span>                            </span><span class="annot"><span class="annottext">[HsSrcBang]
</span><a href="#local-6989586621681165754"><span class="hs-identifier hs-var">stricts</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [HsImplBang]
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldLabel]
</span><a href="#local-6989586621681165755"><span class="hs-identifier hs-var">field_lbls</span></a></span><span>
</span><span id="line-3244"></span><span>                            </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165724"><span class="hs-identifier hs-var">univ_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165720"><span class="hs-identifier hs-var">ex_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[VarBndr TyVar Specificity]
</span><a href="#local-6989586621681165719"><span class="hs-identifier hs-var">user_tvbs</span></a></span><span>
</span><span id="line-3245"></span><span>                            </span><span class="hs-special">[</span><span class="hs-comment">{- no eq_preds -}</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681165729"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621681165731"><span class="hs-identifier hs-var">arg_tys</span></a></span><span>
</span><span id="line-3246"></span><span>                            </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165764"><span class="hs-identifier hs-var">res_tmpl</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165768"><span class="hs-identifier hs-var">rep_tycon</span></a></span><span> </span><span class="annot"><span class="annottext">NameEnv Arity
</span><a href="#local-6989586621681165767"><span class="hs-identifier hs-var">tag_map</span></a></span><span>
</span><span id="line-3247"></span><span>                  </span><span class="hs-comment">-- NB:  we put data_tc, the type constructor gotten from the</span><span>
</span><span id="line-3248"></span><span>                  </span><span class="hs-comment">--      constructor type signature into the data constructor;</span><span>
</span><span id="line-3249"></span><span>                  </span><span class="hs-comment">--      that way checkValidDataCon can complain if it's wrong.</span><span>
</span><span id="line-3250"></span><span>             </span><span class="hs-special">}</span><span>
</span><span id="line-3251"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcConDecl 2&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Located Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Located Name
GenLocated SrcSpan (IdP GhcRn)
</span><a href="#local-6989586621681165762"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3252"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(Located Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) DataCon)
-&gt; [Located Name] -&gt; TcM [DataCon]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">Located Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) DataCon
</span><a href="#local-6989586621681165718"><span class="hs-identifier hs-var">buildOneDataCon</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Located Name
GenLocated SrcSpan (IdP GhcRn)
</span><a href="#local-6989586621681165762"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-3253"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-3254"></span><span>
</span><span id="line-3255"></span><span class="annot"><a href="GHC.Tc.TyCl.html#tcConDecl"><span class="hs-identifier hs-var">tcConDecl</span></a></span><span> </span><span id="local-6989586621681165712"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165712"><span class="hs-identifier hs-var">rep_tycon</span></a></span></span><span> </span><span id="local-6989586621681165711"><span class="annot"><span class="annottext">NameEnv Arity
</span><a href="#local-6989586621681165711"><span class="hs-identifier hs-var">tag_map</span></a></span></span><span> </span><span id="local-6989586621681165710"><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621681165710"><span class="hs-identifier hs-var">tmpl_bndrs</span></a></span></span><span> </span><span id="local-6989586621681165709"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165709"><span class="hs-identifier hs-var">_res_kind</span></a></span></span><span> </span><span id="local-6989586621681165708"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165708"><span class="hs-identifier hs-var">res_tmpl</span></a></span></span><span> </span><span id="local-6989586621681165707"><span class="annot"><span class="annottext">NewOrData
</span><a href="#local-6989586621681165707"><span class="hs-identifier hs-var">new_or_data</span></a></span></span><span>
</span><span id="line-3256"></span><span>  </span><span class="hs-comment">-- NB: don't use res_kind here, as it's ill-scoped. Instead,</span><span>
</span><span id="line-3257"></span><span>  </span><span class="hs-comment">-- we get the res_kind by typechecking the result type.</span><span>
</span><span id="line-3258"></span><span>          </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Decls.html#ConDeclGADT"><span class="hs-identifier hs-type">ConDeclGADT</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">con_g_ext :: forall pass. ConDecl pass -&gt; XConDeclGADT pass
</span><a href="GHC.Hs.Decls.html#con_g_ext"><span class="hs-identifier hs-var">con_g_ext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681165706"><span class="annot"><span class="annottext">XConDeclGADT GhcRn
</span><a href="#local-6989586621681165706"><span class="hs-identifier hs-var">implicit_tkv_nms</span></a></span></span><span>
</span><span id="line-3259"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">con_names :: forall pass. ConDecl pass -&gt; [Located (IdP pass)]
</span><a href="GHC.Hs.Decls.html#con_names"><span class="hs-identifier hs-var">con_names</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681165705"><span class="annot"><span class="annottext">[GenLocated SrcSpan (IdP GhcRn)]
</span><a href="#local-6989586621681165705"><span class="hs-identifier hs-var">names</span></a></span></span><span>
</span><span id="line-3260"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">con_qvars :: forall pass. ConDecl pass -&gt; [LHsTyVarBndr Specificity pass]
</span><a href="GHC.Hs.Decls.html#con_qvars"><span class="hs-identifier hs-var">con_qvars</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681165704"><span class="annot"><span class="annottext">[LHsTyVarBndr Specificity GhcRn]
</span><a href="#local-6989586621681165704"><span class="hs-identifier hs-var">explicit_tkv_nms</span></a></span></span><span>
</span><span id="line-3261"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">con_mb_cxt :: forall pass. ConDecl pass -&gt; Maybe (LHsContext pass)
</span><a href="GHC.Hs.Decls.html#con_mb_cxt"><span class="hs-identifier hs-var">con_mb_cxt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681165703"><span class="annot"><span class="annottext">Maybe (GenLocated SrcSpan (HsContext GhcRn))
</span><a href="#local-6989586621681165703"><span class="hs-identifier hs-var">cxt</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">con_args :: forall pass. ConDecl pass -&gt; HsConDeclDetails pass
</span><a href="GHC.Hs.Decls.html#con_args"><span class="hs-identifier hs-var">con_args</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681165702"><span class="annot"><span class="annottext">HsConDeclDetails GhcRn
</span><a href="#local-6989586621681165702"><span class="hs-identifier hs-var">hs_args</span></a></span></span><span>
</span><span id="line-3262"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">con_res_ty :: forall pass. ConDecl pass -&gt; LHsType pass
</span><a href="GHC.Hs.Decls.html#con_res_ty"><span class="hs-identifier hs-var">con_res_ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681165701"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621681165701"><span class="hs-identifier hs-var">hs_res_ty</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-3263"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcM [DataCon] -&gt; TcM [DataCon]
forall a. SDoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Located Name] -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#dataConCtxtName"><span class="hs-identifier hs-var">dataConCtxtName</span></a></span><span> </span><span class="annot"><span class="annottext">[Located Name]
[GenLocated SrcSpan (IdP GhcRn)]
</span><a href="#local-6989586621681165705"><span class="hs-identifier hs-var">names</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM [DataCon] -&gt; TcM [DataCon]) -&gt; TcM [DataCon] -&gt; TcM [DataCon]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3264"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcConDecl 1 gadt&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Located Name] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Located Name]
[GenLocated SrcSpan (IdP GhcRn)]
</span><a href="#local-6989586621681165705"><span class="hs-identifier hs-var">names</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3265"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681165700"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165700"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[Located Name]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Located Name]
[GenLocated SrcSpan (IdP GhcRn)]
</span><a href="#local-6989586621681165705"><span class="hs-identifier hs-var">names</span></a></span><span>
</span><span id="line-3266"></span><span>
</span><span id="line-3267"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681165699"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165699"><span class="hs-identifier hs-var">imp_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681165698"><span class="annot"><span class="annottext">[VarBndr TyVar Specificity]
</span><a href="#local-6989586621681165698"><span class="hs-identifier hs-var">exp_tvbndrs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681165697"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681165697"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681165696"><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621681165696"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681165695"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165695"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681165694"><span class="annot"><span class="annottext">[FieldLabel]
</span><a href="#local-6989586621681165694"><span class="hs-identifier hs-var">field_lbls</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681165693"><span class="annot"><span class="annottext">[HsSrcBang]
</span><a href="#local-6989586621681165693"><span class="hs-identifier hs-var">stricts</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3268"></span><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM
  ([TyVar],
   ([VarBndr TyVar Specificity],
    ([Type], [Scaled Type], Type, [FieldLabel], [HsSrcBang])))
-&gt; TcM
     ([TyVar],
      ([VarBndr TyVar Specificity],
       ([Type], [Scaled Type], Type, [FieldLabel], [HsSrcBang])))
forall r. TcM r -&gt; TcM r
</span><a href="GHC.Tc.Utils.Monad.html#pushTcLevelM_"><span class="hs-identifier hs-var">pushTcLevelM_</span></a></span><span>    </span><span class="annot"><span class="annottext">(TcM
   ([TyVar],
    ([VarBndr TyVar Specificity],
     ([Type], [Scaled Type], Type, [FieldLabel], [HsSrcBang])))
 -&gt; TcM
      ([TyVar],
       ([VarBndr TyVar Specificity],
        ([Type], [Scaled Type], Type, [FieldLabel], [HsSrcBang]))))
-&gt; TcM
     ([TyVar],
      ([VarBndr TyVar Specificity],
       ([Type], [Scaled Type], Type, [FieldLabel], [HsSrcBang])))
-&gt; TcM
     ([TyVar],
      ([VarBndr TyVar Specificity],
       ([Type], [Scaled Type], Type, [FieldLabel], [HsSrcBang])))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>  </span><span class="hs-comment">-- We are going to generalise</span><span>
</span><span id="line-3269"></span><span>              </span><span class="annot"><span class="annottext">TcM
  ([TyVar],
   ([VarBndr TyVar Specificity],
    ([Type], [Scaled Type], Type, [FieldLabel], [HsSrcBang])))
-&gt; TcM
     ([TyVar],
      ([VarBndr TyVar Specificity],
       ([Type], [Scaled Type], Type, [FieldLabel], [HsSrcBang])))
forall r. TcM r -&gt; TcM r
</span><a href="GHC.Tc.Solver.html#solveEqualities"><span class="hs-identifier hs-var">solveEqualities</span></a></span><span>  </span><span class="annot"><span class="annottext">(TcM
   ([TyVar],
    ([VarBndr TyVar Specificity],
     ([Type], [Scaled Type], Type, [FieldLabel], [HsSrcBang])))
 -&gt; TcM
      ([TyVar],
       ([VarBndr TyVar Specificity],
        ([Type], [Scaled Type], Type, [FieldLabel], [HsSrcBang]))))
-&gt; TcM
     ([TyVar],
      ([VarBndr TyVar Specificity],
       ([Type], [Scaled Type], Type, [FieldLabel], [HsSrcBang])))
-&gt; TcM
     ([TyVar],
      ([VarBndr TyVar Specificity],
       ([Type], [Scaled Type], Type, [FieldLabel], [HsSrcBang])))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>  </span><span class="hs-comment">-- We won't get another crack, and we don't</span><span>
</span><span id="line-3270"></span><span>                                  </span><span class="hs-comment">-- want an error cascade</span><span>
</span><span id="line-3271"></span><span>              </span><span class="annot"><span class="annottext">[Name]
-&gt; TcM
     ([VarBndr TyVar Specificity],
      ([Type], [Scaled Type], Type, [FieldLabel], [HsSrcBang]))
-&gt; TcM
     ([TyVar],
      ([VarBndr TyVar Specificity],
       ([Type], [Scaled Type], Type, [FieldLabel], [HsSrcBang])))
forall a. [Name] -&gt; TcM a -&gt; TcM ([TyVar], a)
</span><a href="GHC.Tc.Gen.HsType.html#bindImplicitTKBndrs_Skol"><span class="hs-identifier hs-var">bindImplicitTKBndrs_Skol</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
XConDeclGADT GhcRn
</span><a href="#local-6989586621681165706"><span class="hs-identifier hs-var">implicit_tkv_nms</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM
   ([VarBndr TyVar Specificity],
    ([Type], [Scaled Type], Type, [FieldLabel], [HsSrcBang]))
 -&gt; TcM
      ([TyVar],
       ([VarBndr TyVar Specificity],
        ([Type], [Scaled Type], Type, [FieldLabel], [HsSrcBang]))))
-&gt; TcM
     ([VarBndr TyVar Specificity],
      ([Type], [Scaled Type], Type, [FieldLabel], [HsSrcBang]))
-&gt; TcM
     ([TyVar],
      ([VarBndr TyVar Specificity],
       ([Type], [Scaled Type], Type, [FieldLabel], [HsSrcBang])))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3272"></span><span>              </span><span class="annot"><span class="annottext">[LHsTyVarBndr Specificity GhcRn]
-&gt; TcM ([Type], [Scaled Type], Type, [FieldLabel], [HsSrcBang])
-&gt; TcM
     ([VarBndr TyVar Specificity],
      ([Type], [Scaled Type], Type, [FieldLabel], [HsSrcBang]))
forall flag a.
OutputableBndrFlag flag =&gt;
[LHsTyVarBndr flag GhcRn] -&gt; TcM a -&gt; TcM ([VarBndr TyVar flag], a)
</span><a href="GHC.Tc.Gen.HsType.html#bindExplicitTKBndrs_Skol"><span class="hs-identifier hs-var">bindExplicitTKBndrs_Skol</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsTyVarBndr Specificity GhcRn]
</span><a href="#local-6989586621681165704"><span class="hs-identifier hs-var">explicit_tkv_nms</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM ([Type], [Scaled Type], Type, [FieldLabel], [HsSrcBang])
 -&gt; TcM
      ([VarBndr TyVar Specificity],
       ([Type], [Scaled Type], Type, [FieldLabel], [HsSrcBang])))
-&gt; TcM ([Type], [Scaled Type], Type, [FieldLabel], [HsSrcBang])
-&gt; TcM
     ([VarBndr TyVar Specificity],
      ([Type], [Scaled Type], Type, [FieldLabel], [HsSrcBang]))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3273"></span><span>              </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681165691"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681165691"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (GenLocated SrcSpan (HsContext GhcRn)) -&gt; TcM [Type]
</span><a href="GHC.Tc.Gen.HsType.html#tcHsMbContext"><span class="hs-identifier hs-var">tcHsMbContext</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (GenLocated SrcSpan (HsContext GhcRn))
</span><a href="#local-6989586621681165703"><span class="hs-identifier hs-var">cxt</span></a></span><span>
</span><span id="line-3274"></span><span>                 </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681165690"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165690"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681165689"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165689"><span class="hs-identifier hs-var">res_kind</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn -&gt; TcM (Type, Type)
</span><a href="GHC.Tc.Gen.HsType.html#tcInferLHsTypeKind"><span class="hs-identifier hs-var">tcInferLHsTypeKind</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621681165701"><span class="hs-identifier hs-var">hs_res_ty</span></a></span><span>
</span><span id="line-3275"></span><span>                         </span><span class="hs-comment">-- See Note [GADT return kinds]</span><span>
</span><span id="line-3276"></span><span>
</span><span id="line-3277"></span><span>                   </span><span class="hs-comment">-- See Note [Datatype return kinds]</span><span>
</span><span id="line-3278"></span><span>                 </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681165687"><span class="annot"><span class="annottext">exp_kind :: ContextKind
</span><a href="#local-6989586621681165687"><span class="hs-identifier hs-var hs-var">exp_kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NewOrData -&gt; Type -&gt; ContextKind
</span><a href="GHC.Tc.TyCl.html#getArgExpKind"><span class="hs-identifier hs-var">getArgExpKind</span></a></span><span> </span><span class="annot"><span class="annottext">NewOrData
</span><a href="#local-6989586621681165707"><span class="hs-identifier hs-var">new_or_data</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165689"><span class="hs-identifier hs-var">res_kind</span></a></span><span>
</span><span id="line-3279"></span><span>
</span><span id="line-3280"></span><span>                 </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681165686"><span class="annot"><span class="annottext">[(Scaled Type, HsSrcBang)]
</span><a href="#local-6989586621681165686"><span class="hs-identifier hs-var">btys</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ContextKind
-&gt; HsConDeclDetails GhcRn -&gt; TcM [(Scaled Type, HsSrcBang)]
</span><a href="GHC.Tc.TyCl.html#tcConArgs"><span class="hs-identifier hs-var">tcConArgs</span></a></span><span> </span><span class="annot"><span class="annottext">ContextKind
</span><a href="#local-6989586621681165687"><span class="hs-identifier hs-var">exp_kind</span></a></span><span> </span><span class="annot"><span class="annottext">HsConDeclDetails GhcRn
</span><a href="#local-6989586621681165702"><span class="hs-identifier hs-var">hs_args</span></a></span><span>
</span><span id="line-3281"></span><span>                 </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681165685"><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621681165685"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681165684"><span class="annot"><span class="annottext">[HsSrcBang]
</span><a href="#local-6989586621681165684"><span class="hs-identifier hs-var">stricts</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Scaled Type, HsSrcBang)] -&gt; ([Scaled Type], [HsSrcBang])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><a href="../../base/src/GHC.List.html#unzip"><span class="hs-identifier hs-var">unzip</span></a></span><span> </span><span class="annot"><span class="annottext">[(Scaled Type, HsSrcBang)]
</span><a href="#local-6989586621681165686"><span class="hs-identifier hs-var">btys</span></a></span><span>
</span><span id="line-3282"></span><span>                 </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681165683"><span class="annot"><span class="annottext">[FieldLabel]
</span><a href="#local-6989586621681165683"><span class="hs-identifier hs-var">field_lbls</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; RnM [FieldLabel]
</span><a href="GHC.Rename.Env.html#lookupConstructorFields"><span class="hs-identifier hs-var">lookupConstructorFields</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165700"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-3283"></span><span>                 </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">([Type], [Scaled Type], Type, [FieldLabel], [HsSrcBang])
-&gt; TcM ([Type], [Scaled Type], Type, [FieldLabel], [HsSrcBang])
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681165691"><span class="hs-identifier hs-var">ctxt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621681165685"><span class="hs-identifier hs-var">arg_tys</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165690"><span class="hs-identifier hs-var">res_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[FieldLabel]
</span><a href="#local-6989586621681165683"><span class="hs-identifier hs-var">field_lbls</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[HsSrcBang]
</span><a href="#local-6989586621681165684"><span class="hs-identifier hs-var">stricts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3284"></span><span>                 </span><span class="hs-special">}</span><span>
</span><span id="line-3285"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681165682"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165682"><span class="hs-identifier hs-var">imp_tvs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; TcM [TyVar]
</span><a href="GHC.Tc.Gen.HsType.html#zonkAndScopedSort"><span class="hs-identifier hs-var">zonkAndScopedSort</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165699"><span class="hs-identifier hs-var">imp_tvs</span></a></span><span>
</span><span id="line-3286"></span><span>
</span><span id="line-3287"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681165680"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165680"><span class="hs-identifier hs-var">tkvs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM [TyVar]
</span><a href="GHC.Tc.Gen.HsType.html#kindGeneralizeAll"><span class="hs-identifier hs-var">kindGeneralizeAll</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyVar] -&gt; Type -&gt; Type
</span><a href="GHC.Core.Type.html#mkSpecForAllTys"><span class="hs-identifier hs-var">mkSpecForAllTys</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165682"><span class="hs-identifier hs-var">imp_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type) -&gt; Type -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3288"></span><span>                                    </span><span class="annot"><span class="annottext">[VarBndr TyVar Specificity] -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkInvisForAllTys"><span class="hs-identifier hs-var">mkInvisForAllTys</span></a></span><span> </span><span class="annot"><span class="annottext">[VarBndr TyVar Specificity]
</span><a href="#local-6989586621681165698"><span class="hs-identifier hs-var">exp_tvbndrs</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type) -&gt; Type -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3289"></span><span>                                    </span><span class="annot"><span class="annottext">[Type] -&gt; Type -&gt; Type
</span><a href="GHC.Tc.Utils.TcType.html#mkPhiTy"><span class="hs-identifier hs-var">mkPhiTy</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681165697"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type) -&gt; Type -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3290"></span><span>                                    </span><span class="annot"><span class="annottext">[Scaled Type] -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkVisFunTys"><span class="hs-identifier hs-var">mkVisFunTys</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621681165696"><span class="hs-identifier hs-var">arg_tys</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type) -&gt; Type -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3291"></span><span>                                    </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165695"><span class="hs-identifier hs-var">res_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3292"></span><span>
</span><span id="line-3293"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681165679"><span class="annot"><span class="annottext">tvbndrs :: [VarBndr TyVar Specificity]
</span><a href="#local-6989586621681165679"><span class="hs-identifier hs-var hs-var">tvbndrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Specificity -&gt; [TyVar] -&gt; [VarBndr TyVar Specificity]
forall vis. vis -&gt; [TyVar] -&gt; [VarBndr TyVar vis]
</span><a href="GHC.Types.Var.html#mkTyVarBinders"><span class="hs-identifier hs-var">mkTyVarBinders</span></a></span><span> </span><span class="annot"><span class="annottext">Specificity
</span><a href="GHC.Types.Var.html#InferredSpec"><span class="hs-identifier hs-var">InferredSpec</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165680"><span class="hs-identifier hs-var">tkvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3294"></span><span>                     </span><span class="annot"><span class="annottext">[VarBndr TyVar Specificity]
-&gt; [VarBndr TyVar Specificity] -&gt; [VarBndr TyVar Specificity]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Specificity -&gt; [TyVar] -&gt; [VarBndr TyVar Specificity]
forall vis. vis -&gt; [TyVar] -&gt; [VarBndr TyVar vis]
</span><a href="GHC.Types.Var.html#mkTyVarBinders"><span class="hs-identifier hs-var">mkTyVarBinders</span></a></span><span> </span><span class="annot"><span class="annottext">Specificity
</span><a href="GHC.Types.Var.html#SpecifiedSpec"><span class="hs-identifier hs-var">SpecifiedSpec</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165682"><span class="hs-identifier hs-var">imp_tvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3295"></span><span>                     </span><span class="annot"><span class="annottext">[VarBndr TyVar Specificity]
-&gt; [VarBndr TyVar Specificity] -&gt; [VarBndr TyVar Specificity]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[VarBndr TyVar Specificity]
</span><a href="#local-6989586621681165698"><span class="hs-identifier hs-var">exp_tvbndrs</span></a></span><span>
</span><span id="line-3296"></span><span>
</span><span id="line-3297"></span><span>             </span><span class="hs-comment">-- Zonk to Types</span><span>
</span><span id="line-3298"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681165677"><span class="annot"><span class="annottext">ZonkEnv
</span><a href="#local-6989586621681165677"><span class="hs-identifier hs-var">ze</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681165676"><span class="annot"><span class="annottext">[VarBndr TyVar Specificity]
</span><a href="#local-6989586621681165676"><span class="hs-identifier hs-var">tvbndrs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[VarBndr TyVar Specificity]
-&gt; TcM (ZonkEnv, [VarBndr TyVar Specificity])
forall vis.
[VarBndr TyVar vis] -&gt; TcM (ZonkEnv, [VarBndr TyVar vis])
</span><a href="GHC.Tc.Utils.Zonk.html#zonkTyVarBinders"><span class="hs-identifier hs-var">zonkTyVarBinders</span></a></span><span>       </span><span class="annot"><span class="annottext">[VarBndr TyVar Specificity]
</span><a href="#local-6989586621681165679"><span class="hs-identifier hs-var">tvbndrs</span></a></span><span>
</span><span id="line-3299"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681165674"><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621681165674"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span>       </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ZonkEnv -&gt; [Scaled Type] -&gt; TcM [Scaled Type]
</span><a href="GHC.Tc.Utils.Zonk.html#zonkScaledTcTypesToTypesX"><span class="hs-identifier hs-var">zonkScaledTcTypesToTypesX</span></a></span><span> </span><span class="annot"><span class="annottext">ZonkEnv
</span><a href="#local-6989586621681165677"><span class="hs-identifier hs-var">ze</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621681165696"><span class="hs-identifier hs-var">arg_tys</span></a></span><span>
</span><span id="line-3300"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681165673"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681165673"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span>          </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ZonkEnv -&gt; [Type] -&gt; TcM [Type]
</span><a href="GHC.Tc.Utils.Zonk.html#zonkTcTypesToTypesX"><span class="hs-identifier hs-var">zonkTcTypesToTypesX</span></a></span><span> </span><span class="annot"><span class="annottext">ZonkEnv
</span><a href="#local-6989586621681165677"><span class="hs-identifier hs-var">ze</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681165697"><span class="hs-identifier hs-var">ctxt</span></a></span><span>
</span><span id="line-3301"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681165672"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165672"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ZonkEnv -&gt; Type -&gt; TcM Type
</span><a href="GHC.Tc.Utils.Zonk.html#zonkTcTypeToTypeX"><span class="hs-identifier hs-var">zonkTcTypeToTypeX</span></a></span><span>   </span><span class="annot"><span class="annottext">ZonkEnv
</span><a href="#local-6989586621681165677"><span class="hs-identifier hs-var">ze</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165695"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-3302"></span><span>
</span><span id="line-3303"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681165671"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165671"><span class="hs-identifier hs-var">univ_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681165670"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165670"><span class="hs-identifier hs-var">ex_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681165669"><span class="annot"><span class="annottext">[VarBndr TyVar Specificity]
</span><a href="#local-6989586621681165669"><span class="hs-identifier hs-var">tvbndrs'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681165668"><span class="annot"><span class="annottext">[EqSpec]
</span><a href="#local-6989586621681165668"><span class="hs-identifier hs-var">eq_preds</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681165667"><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681165667"><span class="hs-identifier hs-var">arg_subst</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-3304"></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
-&gt; Type
-&gt; [VarBndr TyVar Specificity]
-&gt; Type
-&gt; ([TyVar], [TyVar], [VarBndr TyVar Specificity], [EqSpec],
    TCvSubst)
</span><a href="GHC.Tc.TyCl.html#rejigConRes"><span class="hs-identifier hs-var">rejigConRes</span></a></span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621681165710"><span class="hs-identifier hs-var">tmpl_bndrs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165708"><span class="hs-identifier hs-var">res_tmpl</span></a></span><span> </span><span class="annot"><span class="annottext">[VarBndr TyVar Specificity]
</span><a href="#local-6989586621681165676"><span class="hs-identifier hs-var">tvbndrs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165672"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-3305"></span><span>             </span><span class="hs-comment">-- See Note [Checking GADT return types]</span><span>
</span><span id="line-3306"></span><span>
</span><span id="line-3307"></span><span>             </span><span id="local-6989586621681165665"><span class="annot"><span class="annottext">ctxt' :: [Type]
</span><a href="#local-6989586621681165665"><span class="hs-identifier hs-var hs-var">ctxt'</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; TCvSubst -&gt; [Type] -&gt; [Type]
TCvSubst -&gt; [Type] -&gt; [Type]
</span><a href="GHC.Core.TyCo.Subst.html#substTys"><span class="hs-identifier hs-var">substTys</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681165667"><span class="hs-identifier hs-var">arg_subst</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681165673"><span class="hs-identifier hs-var">ctxt</span></a></span><span>
</span><span id="line-3308"></span><span>             </span><span id="local-6989586621681165663"><span class="annot"><span class="annottext">arg_tys' :: [Scaled Type]
</span><a href="#local-6989586621681165663"><span class="hs-identifier hs-var hs-var">arg_tys'</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; TCvSubst -&gt; [Scaled Type] -&gt; [Scaled Type]
TCvSubst -&gt; [Scaled Type] -&gt; [Scaled Type]
</span><a href="GHC.Core.TyCo.Subst.html#substScaledTys"><span class="hs-identifier hs-var">substScaledTys</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681165667"><span class="hs-identifier hs-var">arg_subst</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621681165674"><span class="hs-identifier hs-var">arg_tys</span></a></span><span>
</span><span id="line-3309"></span><span>             </span><span id="local-6989586621681165661"><span class="annot"><span class="annottext">res_ty' :: Type
</span><a href="#local-6989586621681165661"><span class="hs-identifier hs-var hs-var">res_ty'</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; TCvSubst -&gt; Type -&gt; Type
TCvSubst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">substTy</span></a></span><span>  </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681165667"><span class="hs-identifier hs-var">arg_subst</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165672"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-3310"></span><span>
</span><span id="line-3311"></span><span>
</span><span id="line-3312"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681165659"><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621681165659"><span class="hs-identifier hs-var">fam_envs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM FamInstEnvs
</span><a href="GHC.Tc.Instance.Family.html#tcGetFamInstEnvs"><span class="hs-identifier hs-var">tcGetFamInstEnvs</span></a></span><span>
</span><span id="line-3313"></span><span>
</span><span id="line-3314"></span><span>       </span><span class="hs-comment">-- Can't print univ_tvs, arg_tys etc, because we are inside the knot here</span><span>
</span><span id="line-3315"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcConDecl 2&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Located Name] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Located Name]
[GenLocated SrcSpan (IdP GhcRn)]
</span><a href="#local-6989586621681165705"><span class="hs-identifier hs-var">names</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldLabel] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldLabel]
</span><a href="#local-6989586621681165694"><span class="hs-identifier hs-var">field_lbls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3316"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span>
</span><span id="line-3317"></span><span>           </span><span id="local-6989586621681165658"><span class="annot"><span class="annottext">buildOneDataCon :: Located Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) DataCon
</span><a href="#local-6989586621681165658"><span class="hs-identifier hs-var hs-var">buildOneDataCon</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681165657"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165657"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3318"></span><span>             </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681165656"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681165656"><span class="hs-identifier hs-var">is_infix</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; HsConDeclDetails GhcRn -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall r.
Name
-&gt; HsConDetails (HsScaled GhcRn (LHsType GhcRn)) r
-&gt; TcRnIf TcGblEnv TcLclEnv Bool
</span><a href="GHC.Tc.TyCl.html#tcConIsInfixGADT"><span class="hs-identifier hs-var">tcConIsInfixGADT</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165657"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">HsConDeclDetails GhcRn
</span><a href="#local-6989586621681165702"><span class="hs-identifier hs-var">hs_args</span></a></span><span>
</span><span id="line-3319"></span><span>             </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681165654"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165654"><span class="hs-identifier hs-var">rep_nm</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcRnIf TcGblEnv TcLclEnv Name
forall gbl lcl. Name -&gt; TcRnIf gbl lcl Name
</span><a href="GHC.Tc.TyCl.Build.html#newTyConRepName"><span class="hs-identifier hs-var">newTyConRepName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165657"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-3320"></span><span>
</span><span id="line-3321"></span><span>             </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">FamInstEnvs
-&gt; Name
-&gt; Bool
-&gt; Name
-&gt; [HsSrcBang]
-&gt; Maybe [HsImplBang]
-&gt; [FieldLabel]
-&gt; [TyVar]
-&gt; [TyVar]
-&gt; [VarBndr TyVar Specificity]
-&gt; [EqSpec]
-&gt; [Type]
-&gt; [Scaled Type]
-&gt; Type
-&gt; TyCon
-&gt; NameEnv Arity
-&gt; IOEnv (Env TcGblEnv TcLclEnv) DataCon
forall m n.
FamInstEnvs
-&gt; Name
-&gt; Bool
-&gt; Name
-&gt; [HsSrcBang]
-&gt; Maybe [HsImplBang]
-&gt; [FieldLabel]
-&gt; [TyVar]
-&gt; [TyVar]
-&gt; [VarBndr TyVar Specificity]
-&gt; [EqSpec]
-&gt; [Type]
-&gt; [Scaled Type]
-&gt; Type
-&gt; TyCon
-&gt; NameEnv Arity
-&gt; TcRnIf m n DataCon
</span><a href="GHC.Tc.TyCl.Build.html#buildDataCon"><span class="hs-identifier hs-var">buildDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621681165659"><span class="hs-identifier hs-var">fam_envs</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165657"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681165656"><span class="hs-identifier hs-var">is_infix</span></a></span><span>
</span><span id="line-3322"></span><span>                            </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165654"><span class="hs-identifier hs-var">rep_nm</span></a></span><span>
</span><span id="line-3323"></span><span>                            </span><span class="annot"><span class="annottext">[HsSrcBang]
</span><a href="#local-6989586621681165693"><span class="hs-identifier hs-var">stricts</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [HsImplBang]
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldLabel]
</span><a href="#local-6989586621681165694"><span class="hs-identifier hs-var">field_lbls</span></a></span><span>
</span><span id="line-3324"></span><span>                            </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165671"><span class="hs-identifier hs-var">univ_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165670"><span class="hs-identifier hs-var">ex_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[VarBndr TyVar Specificity]
</span><a href="#local-6989586621681165669"><span class="hs-identifier hs-var">tvbndrs'</span></a></span><span> </span><span class="annot"><span class="annottext">[EqSpec]
</span><a href="#local-6989586621681165668"><span class="hs-identifier hs-var">eq_preds</span></a></span><span>
</span><span id="line-3325"></span><span>                            </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681165665"><span class="hs-identifier hs-var">ctxt'</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621681165663"><span class="hs-identifier hs-var">arg_tys'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165661"><span class="hs-identifier hs-var">res_ty'</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165712"><span class="hs-identifier hs-var">rep_tycon</span></a></span><span> </span><span class="annot"><span class="annottext">NameEnv Arity
</span><a href="#local-6989586621681165711"><span class="hs-identifier hs-var">tag_map</span></a></span><span>
</span><span id="line-3326"></span><span>                  </span><span class="hs-comment">-- NB:  we put data_tc, the type constructor gotten from the</span><span>
</span><span id="line-3327"></span><span>                  </span><span class="hs-comment">--      constructor type signature into the data constructor;</span><span>
</span><span id="line-3328"></span><span>                  </span><span class="hs-comment">--      that way checkValidDataCon can complain if it's wrong.</span><span>
</span><span id="line-3329"></span><span>             </span><span class="hs-special">}</span><span>
</span><span id="line-3330"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcConDecl 2&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Located Name] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Located Name]
[GenLocated SrcSpan (IdP GhcRn)]
</span><a href="#local-6989586621681165705"><span class="hs-identifier hs-var">names</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3331"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(Located Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) DataCon)
-&gt; [Located Name] -&gt; TcM [DataCon]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">Located Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) DataCon
</span><a href="#local-6989586621681165658"><span class="hs-identifier hs-var">buildOneDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">[Located Name]
[GenLocated SrcSpan (IdP GhcRn)]
</span><a href="#local-6989586621681165705"><span class="hs-identifier hs-var">names</span></a></span><span>
</span><span id="line-3332"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-3333"></span><span>
</span><span id="line-3334"></span><span class="hs-comment">{- Note [GADT return kinds]
~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider
   type family Star where Star = Type
   data T :: Type where
      MkT :: Int -&gt; T

If, for some stupid reason, tcInferLHsTypeKind on the return type of
MkT returned (T |&gt; ax, Star), then the return-type check in
checkValidDataCon would reject the decl (although of course there is
nothing wrong with it).  We are implicitly requiring tha
tcInferLHsTypeKind doesn't any gratuitous top-level casts.
-}</span><span>
</span><span id="line-3347"></span><span>
</span><span id="line-3348"></span><span class="hs-comment">-- | Produce an &quot;expected kind&quot; for the arguments of a data/newtype.</span><span>
</span><span id="line-3349"></span><span class="hs-comment">-- If the declaration is indeed for a newtype,</span><span>
</span><span id="line-3350"></span><span class="hs-comment">-- then this expected kind will be the kind provided. Otherwise,</span><span>
</span><span id="line-3351"></span><span class="hs-comment">-- it is OpenKind for datatypes and liftedTypeKind.</span><span>
</span><span id="line-3352"></span><span class="hs-comment">-- Why do we not check for -XUnliftedNewtypes? See point &lt;Error Messages&gt;</span><span>
</span><span id="line-3353"></span><span class="hs-comment">-- in Note [Implementation of UnliftedNewtypes]</span><span>
</span><span id="line-3354"></span><span class="annot"><a href="GHC.Tc.TyCl.html#getArgExpKind"><span class="hs-identifier hs-type">getArgExpKind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Decls.html#NewOrData"><span class="hs-identifier hs-type">NewOrData</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#ContextKind"><span class="hs-identifier hs-type">ContextKind</span></a></span><span>
</span><span id="line-3355"></span><span id="getArgExpKind"><span class="annot"><span class="annottext">getArgExpKind :: NewOrData -&gt; Type -&gt; ContextKind
</span><a href="GHC.Tc.TyCl.html#getArgExpKind"><span class="hs-identifier hs-var hs-var">getArgExpKind</span></a></span></span><span> </span><span class="annot"><span class="annottext">NewOrData
</span><a href="GHC.Hs.Decls.html#NewType"><span class="hs-identifier hs-var">NewType</span></a></span><span> </span><span id="local-6989586621681165653"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165653"><span class="hs-identifier hs-var">res_ki</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ContextKind
</span><a href="GHC.Tc.Gen.HsType.html#TheKind"><span class="hs-identifier hs-var">TheKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165653"><span class="hs-identifier hs-var">res_ki</span></a></span><span>
</span><span id="line-3356"></span><span class="annot"><a href="GHC.Tc.TyCl.html#getArgExpKind"><span class="hs-identifier hs-var">getArgExpKind</span></a></span><span> </span><span class="annot"><span class="annottext">NewOrData
</span><a href="GHC.Hs.Decls.html#DataType"><span class="hs-identifier hs-var">DataType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ContextKind
</span><a href="GHC.Tc.Gen.HsType.html#OpenKind"><span class="hs-identifier hs-var">OpenKind</span></a></span><span>
</span><span id="line-3357"></span><span>
</span><span id="line-3358"></span><span id="local-6989586621681167753"><span id="local-6989586621681167754"><span class="annot"><a href="GHC.Tc.TyCl.html#tcConIsInfixH98"><span class="hs-identifier hs-type">tcConIsInfixH98</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-3359"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Type.html#HsConDetails"><span class="hs-identifier hs-type">HsConDetails</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681167754"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681167753"><span class="hs-identifier hs-type">b</span></a></span><span>
</span><span id="line-3360"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span></span><span>
</span><span id="line-3361"></span><span id="tcConIsInfixH98"><span class="annot"><span class="annottext">tcConIsInfixH98 :: forall a b.
Name -&gt; HsConDetails a b -&gt; TcRnIf TcGblEnv TcLclEnv Bool
</span><a href="GHC.Tc.TyCl.html#tcConIsInfixH98"><span class="hs-identifier hs-var hs-var">tcConIsInfixH98</span></a></span></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span>   </span><span id="local-6989586621681165650"><span class="annot"><span class="annottext">HsConDetails a b
</span><a href="#local-6989586621681165650"><span class="hs-identifier hs-var">details</span></a></span></span><span>
</span><span id="line-3362"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HsConDetails a b
</span><a href="#local-6989586621681165650"><span class="hs-identifier hs-var">details</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3363"></span><span>           </span><span class="annot"><a href="GHC.Hs.Type.html#InfixCon"><span class="hs-identifier hs-type">InfixCon</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-3364"></span><span>           </span><span class="annot"><span class="annottext">HsConDetails a b
</span><span class="hs-identifier">_</span></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-3365"></span><span>
</span><span id="line-3366"></span><span id="local-6989586621681167747"><span class="annot"><a href="GHC.Tc.TyCl.html#tcConIsInfixGADT"><span class="hs-identifier hs-type">tcConIsInfixGADT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-3367"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Type.html#HsConDetails"><span class="hs-identifier hs-type">HsConDetails</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Type.html#HsScaled"><span class="hs-identifier hs-type">HsScaled</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Type.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621681167747"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-3368"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-3369"></span><span id="tcConIsInfixGADT"><span class="annot"><span class="annottext">tcConIsInfixGADT :: forall r.
Name
-&gt; HsConDetails (HsScaled GhcRn (LHsType GhcRn)) r
-&gt; TcRnIf TcGblEnv TcLclEnv Bool
</span><a href="GHC.Tc.TyCl.html#tcConIsInfixGADT"><span class="hs-identifier hs-var hs-var">tcConIsInfixGADT</span></a></span></span><span> </span><span id="local-6989586621681165642"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165642"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span id="local-6989586621681165641"><span class="annot"><span class="annottext">HsConDetails (HsScaled GhcRn (LHsType GhcRn)) r
</span><a href="#local-6989586621681165641"><span class="hs-identifier hs-var">details</span></a></span></span><span>
</span><span id="line-3370"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HsConDetails (HsScaled GhcRn (LHsType GhcRn)) r
</span><a href="#local-6989586621681165641"><span class="hs-identifier hs-var">details</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3371"></span><span>           </span><span class="annot"><a href="GHC.Hs.Type.html#InfixCon"><span class="hs-identifier hs-type">InfixCon</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-3372"></span><span>           </span><span class="annot"><a href="GHC.Hs.Type.html#RecCon"><span class="hs-identifier hs-type">RecCon</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-3373"></span><span>           </span><span class="annot"><a href="GHC.Hs.Type.html#PrefixCon"><span class="hs-identifier hs-type">PrefixCon</span></a></span><span> </span><span id="local-6989586621681165638"><span class="annot"><span class="annottext">[HsScaled GhcRn (LHsType GhcRn)]
</span><a href="#local-6989586621681165638"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span>           </span><span class="hs-comment">-- See Note [Infix GADT constructors]</span><span>
</span><span id="line-3374"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; Bool
</span><a href="GHC.Types.Name.Occurrence.html#isSymOcc"><span class="hs-identifier hs-var">isSymOcc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; OccName
forall a. NamedThing a =&gt; a -&gt; OccName
</span><a href="GHC.Types.Name.html#getOccName"><span class="hs-identifier hs-var">getOccName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165642"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3375"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621681165635"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621681165635"><span class="hs-identifier hs-var">_ty1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681165634"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621681165634"><span class="hs-identifier hs-var">_ty2</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HsScaled GhcRn (LHsType GhcRn) -&gt; LHsType GhcRn)
-&gt; [HsScaled GhcRn (LHsType GhcRn)] -&gt; HsContext GhcRn
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">HsScaled GhcRn (LHsType GhcRn) -&gt; LHsType GhcRn
forall pass a. HsScaled pass a -&gt; a
</span><a href="GHC.Hs.Type.html#hsScaledThing"><span class="hs-identifier hs-var">hsScaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">[HsScaled GhcRn (LHsType GhcRn)]
</span><a href="#local-6989586621681165638"><span class="hs-identifier hs-var">arg_tys</span></a></span><span>
</span><span id="line-3376"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681165632"><span class="annot"><span class="annottext">FixityEnv
</span><a href="#local-6989586621681165632"><span class="hs-identifier hs-var">fix_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn FixityEnv
</span><a href="GHC.Tc.Utils.Monad.html#getFixityEnv"><span class="hs-identifier hs-var">getFixityEnv</span></a></span><span>
</span><span id="line-3377"></span><span>                        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165642"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; FixityEnv -&gt; Bool
forall a. Name -&gt; NameEnv a -&gt; Bool
</span><a href="GHC.Types.Name.Env.html#elemNameEnv"><span class="hs-operator hs-var">`elemNameEnv`</span></a></span><span> </span><span class="annot"><span class="annottext">FixityEnv
</span><a href="#local-6989586621681165632"><span class="hs-identifier hs-var">fix_env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3378"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-3379"></span><span>
</span><span id="line-3380"></span><span class="annot"><a href="GHC.Tc.TyCl.html#tcConArgs"><span class="hs-identifier hs-type">tcConArgs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#ContextKind"><span class="hs-identifier hs-type">ContextKind</span></a></span><span>  </span><span class="hs-comment">-- expected kind of arguments</span><span>
</span><span id="line-3381"></span><span>                          </span><span class="hs-comment">-- always OpenKind for datatypes, but unlifted newtypes</span><span>
</span><span id="line-3382"></span><span>                          </span><span class="hs-comment">-- might have a specific kind</span><span>
</span><span id="line-3383"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Decls.html#HsConDeclDetails"><span class="hs-identifier hs-type">HsConDeclDetails</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-3384"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#HsSrcBang"><span class="hs-identifier hs-type">HsSrcBang</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-3385"></span><span id="tcConArgs"><span class="annot"><span class="annottext">tcConArgs :: ContextKind
-&gt; HsConDeclDetails GhcRn -&gt; TcM [(Scaled Type, HsSrcBang)]
</span><a href="GHC.Tc.TyCl.html#tcConArgs"><span class="hs-identifier hs-var hs-var">tcConArgs</span></a></span></span><span> </span><span id="local-6989586621681165629"><span class="annot"><span class="annottext">ContextKind
</span><a href="#local-6989586621681165629"><span class="hs-identifier hs-var">exp_kind</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Type.html#PrefixCon"><span class="hs-identifier hs-type">PrefixCon</span></a></span><span> </span><span id="local-6989586621681165628"><span class="annot"><span class="annottext">[HsScaled GhcRn (LHsType GhcRn)]
</span><a href="#local-6989586621681165628"><span class="hs-identifier hs-var">btys</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-3386"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HsScaled GhcRn (LHsType GhcRn)
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Scaled Type, HsSrcBang))
-&gt; [HsScaled GhcRn (LHsType GhcRn)]
-&gt; TcM [(Scaled Type, HsSrcBang)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ContextKind
-&gt; HsScaled GhcRn (LHsType GhcRn)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Scaled Type, HsSrcBang)
</span><a href="GHC.Tc.TyCl.html#tcConArg"><span class="hs-identifier hs-var">tcConArg</span></a></span><span> </span><span class="annot"><span class="annottext">ContextKind
</span><a href="#local-6989586621681165629"><span class="hs-identifier hs-var">exp_kind</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[HsScaled GhcRn (LHsType GhcRn)]
</span><a href="#local-6989586621681165628"><span class="hs-identifier hs-var">btys</span></a></span><span>
</span><span id="line-3387"></span><span class="annot"><a href="GHC.Tc.TyCl.html#tcConArgs"><span class="hs-identifier hs-var">tcConArgs</span></a></span><span> </span><span id="local-6989586621681165626"><span class="annot"><span class="annottext">ContextKind
</span><a href="#local-6989586621681165626"><span class="hs-identifier hs-var">exp_kind</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Type.html#InfixCon"><span class="hs-identifier hs-type">InfixCon</span></a></span><span> </span><span id="local-6989586621681165625"><span class="annot"><span class="annottext">HsScaled GhcRn (LHsType GhcRn)
</span><a href="#local-6989586621681165625"><span class="hs-identifier hs-var">bty1</span></a></span></span><span> </span><span id="local-6989586621681165624"><span class="annot"><span class="annottext">HsScaled GhcRn (LHsType GhcRn)
</span><a href="#local-6989586621681165624"><span class="hs-identifier hs-var">bty2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-3388"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681165623"><span class="annot"><span class="annottext">(Scaled Type, HsSrcBang)
</span><a href="#local-6989586621681165623"><span class="hs-identifier hs-var">bty1'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ContextKind
-&gt; HsScaled GhcRn (LHsType GhcRn)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Scaled Type, HsSrcBang)
</span><a href="GHC.Tc.TyCl.html#tcConArg"><span class="hs-identifier hs-var">tcConArg</span></a></span><span> </span><span class="annot"><span class="annottext">ContextKind
</span><a href="#local-6989586621681165626"><span class="hs-identifier hs-var">exp_kind</span></a></span><span> </span><span class="annot"><span class="annottext">HsScaled GhcRn (LHsType GhcRn)
</span><a href="#local-6989586621681165625"><span class="hs-identifier hs-var">bty1</span></a></span><span>
</span><span id="line-3389"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681165622"><span class="annot"><span class="annottext">(Scaled Type, HsSrcBang)
</span><a href="#local-6989586621681165622"><span class="hs-identifier hs-var">bty2'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ContextKind
-&gt; HsScaled GhcRn (LHsType GhcRn)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Scaled Type, HsSrcBang)
</span><a href="GHC.Tc.TyCl.html#tcConArg"><span class="hs-identifier hs-var">tcConArg</span></a></span><span> </span><span class="annot"><span class="annottext">ContextKind
</span><a href="#local-6989586621681165626"><span class="hs-identifier hs-var">exp_kind</span></a></span><span> </span><span class="annot"><span class="annottext">HsScaled GhcRn (LHsType GhcRn)
</span><a href="#local-6989586621681165624"><span class="hs-identifier hs-var">bty2</span></a></span><span>
</span><span id="line-3390"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">[(Scaled Type, HsSrcBang)] -&gt; TcM [(Scaled Type, HsSrcBang)]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">(Scaled Type, HsSrcBang)
</span><a href="#local-6989586621681165623"><span class="hs-identifier hs-var">bty1'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Scaled Type, HsSrcBang)
</span><a href="#local-6989586621681165622"><span class="hs-identifier hs-var">bty2'</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3391"></span><span class="annot"><a href="GHC.Tc.TyCl.html#tcConArgs"><span class="hs-identifier hs-var">tcConArgs</span></a></span><span> </span><span id="local-6989586621681165621"><span class="annot"><span class="annottext">ContextKind
</span><a href="#local-6989586621681165621"><span class="hs-identifier hs-var">exp_kind</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Type.html#RecCon"><span class="hs-identifier hs-type">RecCon</span></a></span><span> </span><span id="local-6989586621681165620"><span class="annot"><span class="annottext">Located [LConDeclField GhcRn]
</span><a href="#local-6989586621681165620"><span class="hs-identifier hs-var">fields</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-3392"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HsScaled GhcRn (LHsType GhcRn)
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Scaled Type, HsSrcBang))
-&gt; [HsScaled GhcRn (LHsType GhcRn)]
-&gt; TcM [(Scaled Type, HsSrcBang)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ContextKind
-&gt; HsScaled GhcRn (LHsType GhcRn)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Scaled Type, HsSrcBang)
</span><a href="GHC.Tc.TyCl.html#tcConArg"><span class="hs-identifier hs-var">tcConArg</span></a></span><span> </span><span class="annot"><span class="annottext">ContextKind
</span><a href="#local-6989586621681165621"><span class="hs-identifier hs-var">exp_kind</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[HsScaled GhcRn (LHsType GhcRn)]
</span><a href="#local-6989586621681165619"><span class="hs-identifier hs-var">btys</span></a></span><span>
</span><span id="line-3393"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3394"></span><span>    </span><span class="hs-comment">-- We need a one-to-one mapping from field_names to btys</span><span>
</span><span id="line-3395"></span><span>    </span><span id="local-6989586621681165618"><span class="annot"><span class="annottext">combined :: [([LFieldOcc GhcRn], HsScaled GhcRn (LHsType GhcRn))]
</span><a href="#local-6989586621681165618"><span class="hs-identifier hs-var hs-var">combined</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LConDeclField GhcRn
 -&gt; ([LFieldOcc GhcRn], HsScaled GhcRn (LHsType GhcRn)))
-&gt; [LConDeclField GhcRn]
-&gt; [([LFieldOcc GhcRn], HsScaled GhcRn (LHsType GhcRn))]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681165617"><span class="annot"><span class="annottext">ConDeclField GhcRn
</span><a href="#local-6989586621681165617"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConDeclField GhcRn -&gt; [LFieldOcc GhcRn]
forall pass. ConDeclField pass -&gt; [LFieldOcc pass]
</span><a href="GHC.Hs.Type.html#cd_fld_names"><span class="hs-identifier hs-var hs-var">cd_fld_names</span></a></span><span> </span><span class="annot"><span class="annottext">ConDeclField GhcRn
</span><a href="#local-6989586621681165617"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">LHsType GhcRn -&gt; HsScaled GhcRn (LHsType GhcRn)
forall a pass. a -&gt; HsScaled pass a
</span><a href="GHC.Hs.Type.html#hsLinear"><span class="hs-identifier hs-var">hsLinear</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConDeclField GhcRn -&gt; LHsType GhcRn
forall pass. ConDeclField pass -&gt; LBangType pass
</span><a href="GHC.Hs.Type.html#cd_fld_type"><span class="hs-identifier hs-var hs-var">cd_fld_type</span></a></span><span> </span><span class="annot"><span class="annottext">ConDeclField GhcRn
</span><a href="#local-6989586621681165617"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3396"></span><span>                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Located [LConDeclField GhcRn] -&gt; [LConDeclField GhcRn]
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">Located [LConDeclField GhcRn]
</span><a href="#local-6989586621681165620"><span class="hs-identifier hs-var">fields</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3397"></span><span>    </span><span id="local-6989586621681165613"><span class="annot"><span class="annottext">explode :: ([a], b) -&gt; [(a, b)]
</span><a href="#local-6989586621681165613"><span class="hs-identifier hs-var hs-var">explode</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681165612"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621681165612"><span class="hs-identifier hs-var">ns</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681165611"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621681165611"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; [b] -&gt; [(a, b)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../../base/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621681165612"><span class="hs-identifier hs-var">ns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b -&gt; [b]
forall a. a -&gt; [a]
</span><a href="../../base/src/GHC.List.html#repeat"><span class="hs-identifier hs-var">repeat</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621681165611"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3398"></span><span>    </span><span id="local-6989586621681165609"><span class="annot"><span class="annottext">exploded :: [(LFieldOcc GhcRn, HsScaled GhcRn (LHsType GhcRn))]
</span><a href="#local-6989586621681165609"><span class="hs-identifier hs-var hs-var">exploded</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(([LFieldOcc GhcRn], HsScaled GhcRn (LHsType GhcRn))
 -&gt; [(LFieldOcc GhcRn, HsScaled GhcRn (LHsType GhcRn))])
-&gt; [([LFieldOcc GhcRn], HsScaled GhcRn (LHsType GhcRn))]
-&gt; [(LFieldOcc GhcRn, HsScaled GhcRn (LHsType GhcRn))]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><a href="../../base/src/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a></span><span> </span><span class="annot"><span class="annottext">([LFieldOcc GhcRn], HsScaled GhcRn (LHsType GhcRn))
-&gt; [(LFieldOcc GhcRn, HsScaled GhcRn (LHsType GhcRn))]
forall {a} {b}. ([a], b) -&gt; [(a, b)]
</span><a href="#local-6989586621681165613"><span class="hs-identifier hs-var">explode</span></a></span><span> </span><span class="annot"><span class="annottext">[([LFieldOcc GhcRn], HsScaled GhcRn (LHsType GhcRn))]
</span><a href="#local-6989586621681165618"><span class="hs-identifier hs-var">combined</span></a></span><span>
</span><span id="line-3399"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[LFieldOcc GhcRn]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621681165619"><span class="annot"><span class="annottext">[HsScaled GhcRn (LHsType GhcRn)]
</span><a href="#local-6989586621681165619"><span class="hs-identifier hs-var">btys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(LFieldOcc GhcRn, HsScaled GhcRn (LHsType GhcRn))]
-&gt; ([LFieldOcc GhcRn], [HsScaled GhcRn (LHsType GhcRn)])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><a href="../../base/src/GHC.List.html#unzip"><span class="hs-identifier hs-var">unzip</span></a></span><span> </span><span class="annot"><span class="annottext">[(LFieldOcc GhcRn, HsScaled GhcRn (LHsType GhcRn))]
</span><a href="#local-6989586621681165609"><span class="hs-identifier hs-var">exploded</span></a></span><span>
</span><span id="line-3400"></span><span>
</span><span id="line-3401"></span><span>
</span><span id="line-3402"></span><span class="annot"><a href="GHC.Tc.TyCl.html#tcConArg"><span class="hs-identifier hs-type">tcConArg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html#ContextKind"><span class="hs-identifier hs-type">ContextKind</span></a></span><span>  </span><span class="hs-comment">-- expected kind for args; always OpenKind for datatypes,</span><span>
</span><span id="line-3403"></span><span>                         </span><span class="hs-comment">-- but might be an unlifted type with UnliftedNewtypes</span><span>
</span><span id="line-3404"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Type.html#HsScaled"><span class="hs-identifier hs-type">HsScaled</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Type.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#HsSrcBang"><span class="hs-identifier hs-type">HsSrcBang</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3405"></span><span id="tcConArg"><span class="annot"><span class="annottext">tcConArg :: ContextKind
-&gt; HsScaled GhcRn (LHsType GhcRn)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Scaled Type, HsSrcBang)
</span><a href="GHC.Tc.TyCl.html#tcConArg"><span class="hs-identifier hs-var hs-var">tcConArg</span></a></span></span><span> </span><span id="local-6989586621681165607"><span class="annot"><span class="annottext">ContextKind
</span><a href="#local-6989586621681165607"><span class="hs-identifier hs-var">exp_kind</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Type.html#HsScaled"><span class="hs-identifier hs-type">HsScaled</span></a></span><span> </span><span id="local-6989586621681165606"><span class="annot"><span class="annottext">HsArrow GhcRn
</span><a href="#local-6989586621681165606"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621681165605"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621681165605"><span class="hs-identifier hs-var">bty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-3406"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcConArg 1&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsType GhcRn -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621681165605"><span class="hs-identifier hs-var">bty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3407"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681165604"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165604"><span class="hs-identifier hs-var">arg_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn -&gt; ContextKind -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tcCheckLHsType"><span class="hs-identifier hs-var">tcCheckLHsType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsType GhcRn -&gt; LHsType GhcRn
forall a. LHsType a -&gt; LHsType a
</span><a href="GHC.Hs.Type.html#getBangType"><span class="hs-identifier hs-var">getBangType</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621681165605"><span class="hs-identifier hs-var">bty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ContextKind
</span><a href="#local-6989586621681165607"><span class="hs-identifier hs-var">exp_kind</span></a></span><span>
</span><span id="line-3408"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681165603"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165603"><span class="hs-identifier hs-var">w'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsArrow GhcRn -&gt; TcM Type
</span><a href="GHC.Tc.TyCl.html#tcDataConMult"><span class="hs-identifier hs-var">tcDataConMult</span></a></span><span> </span><span class="annot"><span class="annottext">HsArrow GhcRn
</span><a href="#local-6989586621681165606"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-3409"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcConArg 2&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsType GhcRn -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621681165605"><span class="hs-identifier hs-var">bty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3410"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(Scaled Type, HsSrcBang)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Scaled Type, HsSrcBang)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Scaled Type
forall a. Type -&gt; a -&gt; Scaled a
</span><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-var">Scaled</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165603"><span class="hs-identifier hs-var">w'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165604"><span class="hs-identifier hs-var">arg_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn -&gt; HsSrcBang
forall a. LHsType a -&gt; HsSrcBang
</span><a href="GHC.Hs.Type.html#getBangStrictness"><span class="hs-identifier hs-var">getBangStrictness</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621681165605"><span class="hs-identifier hs-var">bty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3411"></span><span>
</span><span id="line-3412"></span><span class="annot"><a href="GHC.Tc.TyCl.html#tcDataConMult"><span class="hs-identifier hs-type">tcDataConMult</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Type.html#HsArrow"><span class="hs-identifier hs-type">HsArrow</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Mult"><span class="hs-identifier hs-type">Mult</span></a></span><span>
</span><span id="line-3413"></span><span id="tcDataConMult"><span class="annot"><span class="annottext">tcDataConMult :: HsArrow GhcRn -&gt; TcM Type
</span><a href="GHC.Tc.TyCl.html#tcDataConMult"><span class="hs-identifier hs-var hs-var">tcDataConMult</span></a></span></span><span> </span><span id="local-6989586621681165598"><span class="annot"><span class="annottext">arr :: HsArrow GhcRn
</span><a href="#local-6989586621681165598"><span class="hs-identifier hs-var">arr</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Type.html#HsUnrestrictedArrow"><span class="hs-identifier hs-type">HsUnrestrictedArrow</span></a></span><span> </span><span class="annot"><span class="annottext">IsUnicodeSyntax
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3414"></span><span>  </span><span class="hs-comment">-- See Note [Function arrows in GADT constructors]</span><span>
</span><span id="line-3415"></span><span>  </span><span id="local-6989586621681165596"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681165596"><span class="hs-identifier hs-var">linearEnabled</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall gbl lcl. Extension -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><a href="../../ghc-boot-th/src/GHC.LanguageExtensions.Type.html#LinearTypes"><span class="hs-identifier hs-var">LangExt.LinearTypes</span></a></span><span>
</span><span id="line-3416"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681165596"><span class="hs-identifier hs-var">linearEnabled</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">HsArrow GhcRn -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tcMult"><span class="hs-identifier hs-var">tcMult</span></a></span><span> </span><span class="annot"><span class="annottext">HsArrow GhcRn
</span><a href="#local-6989586621681165598"><span class="hs-identifier hs-var">arr</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#oneDataConTy"><span class="hs-identifier hs-var">oneDataConTy</span></a></span><span>
</span><span id="line-3417"></span><span class="annot"><a href="GHC.Tc.TyCl.html#tcDataConMult"><span class="hs-identifier hs-var">tcDataConMult</span></a></span><span> </span><span id="local-6989586621681165594"><span class="annot"><span class="annottext">HsArrow GhcRn
</span><a href="#local-6989586621681165594"><span class="hs-identifier hs-var">arr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsArrow GhcRn -&gt; TcM Type
</span><a href="GHC.Tc.Gen.HsType.html#tcMult"><span class="hs-identifier hs-var">tcMult</span></a></span><span> </span><span class="annot"><span class="annottext">HsArrow GhcRn
</span><a href="#local-6989586621681165594"><span class="hs-identifier hs-var">arr</span></a></span><span>
</span><span id="line-3418"></span><span>
</span><span id="line-3419"></span><span class="hs-comment">{-
Note [Function arrows in GADT constructors]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
In the absence of -XLinearTypes, we always interpret function arrows
in GADT constructor types as linear, even if the user wrote an
unrestricted arrow. See the &quot;Without -XLinearTypes&quot; section of the
linear types GHC proposal (#111). We opt to do this in the
typechecker, and not in an earlier pass, to ensure that the AST
matches what the user wrote (#18791).

Note [Infix GADT constructors]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We do not currently have syntax to declare an infix constructor in GADT syntax,
but it makes a (small) difference to the Show instance.  So as a slightly
ad-hoc solution, we regard a GADT data constructor as infix if
  a) it is an operator symbol
  b) it has two arguments
  c) there is a fixity declaration for it
For example:
   infix 6 (:--:)
   data T a where
     (:--:) :: t1 -&gt; t2 -&gt; T Int


Note [Checking GADT return types]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
There is a delicacy around checking the return types of a datacon. The
central problem is dealing with a declaration like

  data T a where
    MkT :: T a -&gt; Q a

Note that the return type of MkT is totally bogus. When creating the T
tycon, we also need to create the MkT datacon, which must have a &quot;rejigged&quot;
return type. That is, the MkT datacon's type must be transformed to have
a uniform return type with explicit coercions for GADT-like type parameters.
This rejigging is what rejigConRes does. The problem is, though, that checking
that the return type is appropriate is much easier when done over *Type*,
not *HsType*, and doing a call to tcMatchTy will loop because T isn't fully
defined yet.

So, we want to make rejigConRes lazy and then check the validity of
the return type in checkValidDataCon.  To do this we /always/ return a
6-tuple from rejigConRes (so that we can compute the return type from it, which
checkValidDataCon needs), but the first three fields may be bogus if
the return type isn't valid (the last equation for rejigConRes).

This is better than an earlier solution which reduced the number of
errors reported in one pass.  See #7175, and #10836.
-}</span><span>
</span><span id="line-3469"></span><span>
</span><span id="line-3470"></span><span class="hs-comment">-- Example</span><span>
</span><span id="line-3471"></span><span class="hs-comment">--   data instance T (b,c) where</span><span>
</span><span id="line-3472"></span><span class="hs-comment">--      TI :: forall e. e -&gt; T (e,e)</span><span>
</span><span id="line-3473"></span><span class="hs-comment">--</span><span>
</span><span id="line-3474"></span><span class="hs-comment">-- The representation tycon looks like this:</span><span>
</span><span id="line-3475"></span><span class="hs-comment">--   data :R7T b c where</span><span>
</span><span id="line-3476"></span><span class="hs-comment">--      TI :: forall b1 c1. (b1 ~ c1) =&gt; b1 -&gt; :R7T b1 c1</span><span>
</span><span id="line-3477"></span><span class="hs-comment">-- In this case orig_res_ty = T (e,e)</span><span>
</span><span id="line-3478"></span><span>
</span><span id="line-3479"></span><span class="annot"><a href="GHC.Tc.TyCl.html#rejigConRes"><span class="hs-identifier hs-type">rejigConRes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#KnotTied"><span class="hs-identifier hs-type">KnotTied</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyConBinder"><span class="hs-identifier hs-type">TyConBinder</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#KnotTied"><span class="hs-identifier hs-type">KnotTied</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>    </span><span class="hs-comment">-- Template for result type; e.g.</span><span>
</span><span id="line-3480"></span><span>                                  </span><span class="hs-comment">-- data instance T [a] b c ...</span><span>
</span><span id="line-3481"></span><span>                                  </span><span class="hs-comment">--      gives template ([a,b,c], T [a] b c)</span><span>
</span><span id="line-3482"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#InvisTVBinder"><span class="hs-identifier hs-type">InvisTVBinder</span></a></span><span class="hs-special">]</span><span>    </span><span class="hs-comment">-- The constructor's type variables (both inferred and user-written)</span><span>
</span><span id="line-3483"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#KnotTied"><span class="hs-identifier hs-type">KnotTied</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>      </span><span class="hs-comment">-- res_ty</span><span>
</span><span id="line-3484"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>          </span><span class="hs-comment">-- Universal</span><span>
</span><span id="line-3485"></span><span>                </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>          </span><span class="hs-comment">-- Existential (distinct OccNames from univs)</span><span>
</span><span id="line-3486"></span><span>                </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#InvisTVBinder"><span class="hs-identifier hs-type">InvisTVBinder</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>  </span><span class="hs-comment">-- The constructor's rejigged, user-written</span><span>
</span><span id="line-3487"></span><span>                                  </span><span class="hs-comment">-- type variables</span><span>
</span><span id="line-3488"></span><span>                </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.DataCon.html#EqSpec"><span class="hs-identifier hs-type">EqSpec</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>         </span><span class="hs-comment">-- Equality predicates</span><span>
</span><span id="line-3489"></span><span>                </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a></span><span class="hs-special">)</span><span>         </span><span class="hs-comment">-- Substitution to apply to argument types</span><span>
</span><span id="line-3490"></span><span>        </span><span class="hs-comment">-- We don't check that the TyCon given in the ResTy is</span><span>
</span><span id="line-3491"></span><span>        </span><span class="hs-comment">-- the same as the parent tycon, because checkValidDataCon will do it</span><span>
</span><span id="line-3492"></span><span class="hs-comment">-- NB: All arguments may potentially be knot-tied</span><span>
</span><span id="line-3493"></span><span id="rejigConRes"><span class="annot"><span class="annottext">rejigConRes :: [TyConBinder]
-&gt; Type
-&gt; [VarBndr TyVar Specificity]
-&gt; Type
-&gt; ([TyVar], [TyVar], [VarBndr TyVar Specificity], [EqSpec],
    TCvSubst)
</span><a href="GHC.Tc.TyCl.html#rejigConRes"><span class="hs-identifier hs-var hs-var">rejigConRes</span></a></span></span><span> </span><span id="local-6989586621681165592"><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621681165592"><span class="hs-identifier hs-var">tmpl_bndrs</span></a></span></span><span> </span><span id="local-6989586621681165591"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165591"><span class="hs-identifier hs-var">res_tmpl</span></a></span></span><span> </span><span id="local-6989586621681165590"><span class="annot"><span class="annottext">[VarBndr TyVar Specificity]
</span><a href="#local-6989586621681165590"><span class="hs-identifier hs-var">dc_tvbndrs</span></a></span></span><span> </span><span id="local-6989586621681165589"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165589"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-3494"></span><span>        </span><span class="hs-comment">-- E.g.  data T [a] b c where</span><span>
</span><span id="line-3495"></span><span>        </span><span class="hs-comment">--         MkT :: forall x y z. T [(x,y)] z z</span><span>
</span><span id="line-3496"></span><span>        </span><span class="hs-comment">-- The {a,b,c} are the tmpl_tvs, and the {x,y,z} are the dc_tvs</span><span>
</span><span id="line-3497"></span><span>        </span><span class="hs-comment">--     (NB: unlike the H98 case, the dc_tvs are not all existential)</span><span>
</span><span id="line-3498"></span><span>        </span><span class="hs-comment">-- Then we generate</span><span>
</span><span id="line-3499"></span><span>        </span><span class="hs-comment">--      Univ tyvars     Eq-spec</span><span>
</span><span id="line-3500"></span><span>        </span><span class="hs-comment">--          a              a~(x,y)</span><span>
</span><span id="line-3501"></span><span>        </span><span class="hs-comment">--          b              b~z</span><span>
</span><span id="line-3502"></span><span>        </span><span class="hs-comment">--          z</span><span>
</span><span id="line-3503"></span><span>        </span><span class="hs-comment">-- Existentials are the leftover type vars: [x,y]</span><span>
</span><span id="line-3504"></span><span>        </span><span class="hs-comment">-- The user-written type variables are what is listed in the forall:</span><span>
</span><span id="line-3505"></span><span>        </span><span class="hs-comment">--   [x, y, z] (all specified). We must rejig these as well.</span><span>
</span><span id="line-3506"></span><span>        </span><span class="hs-comment">--   See Note [DataCon user type variable binders] in GHC.Core.DataCon.</span><span>
</span><span id="line-3507"></span><span>        </span><span class="hs-comment">-- So we return ( [a,b,z], [x,y]</span><span>
</span><span id="line-3508"></span><span>        </span><span class="hs-comment">--              , [], [x,y,z]</span><span>
</span><span id="line-3509"></span><span>        </span><span class="hs-comment">--              , [a~(x,y),b~z], &lt;arg-subst&gt; )</span><span>
</span><span id="line-3510"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681165588"><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681165588"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Maybe TCvSubst
</span><a href="GHC.Core.Unify.html#tcMatchTy"><span class="hs-identifier hs-var">tcMatchTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165591"><span class="hs-identifier hs-var">res_tmpl</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165589"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-3511"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681165586"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165586"><span class="hs-identifier hs-var">univ_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681165585"><span class="annot"><span class="annottext">[EqSpec]
</span><a href="#local-6989586621681165585"><span class="hs-identifier hs-var">raw_eqs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681165584"><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681165584"><span class="hs-identifier hs-var">kind_subst</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; [TyVar] -&gt; TCvSubst -&gt; ([TyVar], [EqSpec], TCvSubst)
</span><a href="GHC.Tc.TyCl.html#mkGADTVars"><span class="hs-identifier hs-var">mkGADTVars</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165582"><span class="hs-identifier hs-var">tmpl_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165581"><span class="hs-identifier hs-var">dc_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681165588"><span class="hs-identifier hs-var">subst</span></a></span><span>
</span><span id="line-3512"></span><span>        </span><span id="local-6989586621681165580"><span class="annot"><span class="annottext">raw_ex_tvs :: [TyVar]
</span><a href="#local-6989586621681165580"><span class="hs-identifier hs-var hs-var">raw_ex_tvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165581"><span class="hs-identifier hs-var">dc_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; [TyVar] -&gt; [TyVar]
forall a. Ord a =&gt; [a] -&gt; [a] -&gt; [a]
</span><a href="GHC.Data.List.SetOps.html#minusList"><span class="hs-operator hs-var">`minusList`</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165586"><span class="hs-identifier hs-var">univ_tvs</span></a></span><span>
</span><span id="line-3513"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621681165578"><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681165578"><span class="hs-identifier hs-var">arg_subst</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681165577"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165577"><span class="hs-identifier hs-var">substed_ex_tvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; TCvSubst -&gt; [TyVar] -&gt; (TCvSubst, [TyVar])
TCvSubst -&gt; [TyVar] -&gt; (TCvSubst, [TyVar])
</span><a href="GHC.Core.TyCo.Subst.html#substTyVarBndrs"><span class="hs-identifier hs-var">substTyVarBndrs</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681165584"><span class="hs-identifier hs-var">kind_subst</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165580"><span class="hs-identifier hs-var">raw_ex_tvs</span></a></span><span>
</span><span id="line-3514"></span><span>
</span><span id="line-3515"></span><span>        </span><span class="hs-comment">-- After rejigging the existential tyvars, the resulting substitution</span><span>
</span><span id="line-3516"></span><span>        </span><span class="hs-comment">-- gives us exactly what we need to rejig the user-written tyvars,</span><span>
</span><span id="line-3517"></span><span>        </span><span class="hs-comment">-- since the dcUserTyVarBinders invariant guarantees that the</span><span>
</span><span id="line-3518"></span><span>        </span><span class="hs-comment">-- substitution has *all* the tyvars in its domain.</span><span>
</span><span id="line-3519"></span><span>        </span><span class="hs-comment">-- See Note [DataCon user type variable binders] in GHC.Core.DataCon.</span><span>
</span><span id="line-3520"></span><span>        </span><span id="local-6989586621681165575"><span class="annot"><span class="annottext">subst_user_tvs :: [VarBndr TyVar Specificity] -&gt; [VarBndr TyVar Specificity]
</span><a href="#local-6989586621681165575"><span class="hs-identifier hs-var hs-var">subst_user_tvs</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TyVar -&gt; TyVar)
-&gt; [VarBndr TyVar Specificity] -&gt; [VarBndr TyVar Specificity]
forall var var' flag.
(var -&gt; var') -&gt; [VarBndr var flag] -&gt; [VarBndr var' flag]
</span><a href="GHC.Types.Var.html#mapVarBndrs"><span class="hs-identifier hs-var">mapVarBndrs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Type -&gt; TyVar
</span><a href="GHC.Core.Type.html#getTyVar"><span class="hs-identifier hs-var">getTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;rejigConRes&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; TyVar) -&gt; (TyVar -&gt; Type) -&gt; TyVar -&gt; TyVar
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst -&gt; TyVar -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTyVar"><span class="hs-identifier hs-var">substTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681165578"><span class="hs-identifier hs-var">arg_subst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3521"></span><span>        </span><span id="local-6989586621681165571"><span class="annot"><span class="annottext">substed_tvbndrs :: [VarBndr TyVar Specificity]
</span><a href="#local-6989586621681165571"><span class="hs-identifier hs-var hs-var">substed_tvbndrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[VarBndr TyVar Specificity] -&gt; [VarBndr TyVar Specificity]
</span><a href="#local-6989586621681165575"><span class="hs-identifier hs-var">subst_user_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[VarBndr TyVar Specificity]
</span><a href="#local-6989586621681165590"><span class="hs-identifier hs-var">dc_tvbndrs</span></a></span><span>
</span><span id="line-3522"></span><span>
</span><span id="line-3523"></span><span>        </span><span id="local-6989586621681165570"><span class="annot"><span class="annottext">substed_eqs :: [EqSpec]
</span><a href="#local-6989586621681165570"><span class="hs-identifier hs-var hs-var">substed_eqs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(EqSpec -&gt; EqSpec) -&gt; [EqSpec] -&gt; [EqSpec]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCvSubst -&gt; EqSpec -&gt; EqSpec
</span><a href="GHC.Core.DataCon.html#substEqSpec"><span class="hs-identifier hs-var">substEqSpec</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681165578"><span class="hs-identifier hs-var">arg_subst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[EqSpec]
</span><a href="#local-6989586621681165585"><span class="hs-identifier hs-var">raw_eqs</span></a></span><span>
</span><span id="line-3524"></span><span>    </span><span class="hs-keyword">in</span><span>
</span><span id="line-3525"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165586"><span class="hs-identifier hs-var">univ_tvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165577"><span class="hs-identifier hs-var">substed_ex_tvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[VarBndr TyVar Specificity]
</span><a href="#local-6989586621681165571"><span class="hs-identifier hs-var">substed_tvbndrs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EqSpec]
</span><a href="#local-6989586621681165570"><span class="hs-identifier hs-var">substed_eqs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681165578"><span class="hs-identifier hs-var">arg_subst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3526"></span><span>
</span><span id="line-3527"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-3528"></span><span>        </span><span class="hs-comment">-- If the return type of the data constructor doesn't match the parent</span><span>
</span><span id="line-3529"></span><span>        </span><span class="hs-comment">-- type constructor, or the arity is wrong, the tcMatchTy will fail</span><span>
</span><span id="line-3530"></span><span>        </span><span class="hs-comment">--    e.g   data T a b where</span><span>
</span><span id="line-3531"></span><span>        </span><span class="hs-comment">--            T1 :: Maybe a   -- Wrong tycon</span><span>
</span><span id="line-3532"></span><span>        </span><span class="hs-comment">--            T2 :: T [a]     -- Wrong arity</span><span>
</span><span id="line-3533"></span><span>        </span><span class="hs-comment">-- We are detect that later, in checkValidDataCon, but meanwhile</span><span>
</span><span id="line-3534"></span><span>        </span><span class="hs-comment">-- we must do *something*, not just crash.  So we do something simple</span><span>
</span><span id="line-3535"></span><span>        </span><span class="hs-comment">-- albeit bogus, relying on checkValidDataCon to check the</span><span>
</span><span id="line-3536"></span><span>        </span><span class="hs-comment">--  bad-result-type error before seeing that the other fields look odd</span><span>
</span><span id="line-3537"></span><span>        </span><span class="hs-comment">-- See Note [Checking GADT return types]</span><span>
</span><span id="line-3538"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165582"><span class="hs-identifier hs-var">tmpl_tvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165581"><span class="hs-identifier hs-var">dc_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; [TyVar] -&gt; [TyVar]
forall a. Ord a =&gt; [a] -&gt; [a] -&gt; [a]
</span><a href="GHC.Data.List.SetOps.html#minusList"><span class="hs-operator hs-var">`minusList`</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165582"><span class="hs-identifier hs-var">tmpl_tvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[VarBndr TyVar Specificity]
</span><a href="#local-6989586621681165590"><span class="hs-identifier hs-var">dc_tvbndrs</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="GHC.Core.TyCo.Subst.html#emptyTCvSubst"><span class="hs-identifier hs-var">emptyTCvSubst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3539"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3540"></span><span>    </span><span id="local-6989586621681165581"><span class="annot"><span class="annottext">dc_tvs :: [TyVar]
</span><a href="#local-6989586621681165581"><span class="hs-identifier hs-var hs-var">dc_tvs</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[VarBndr TyVar Specificity] -&gt; [TyVar]
forall tv argf. [VarBndr tv argf] -&gt; [tv]
</span><a href="GHC.Types.Var.html#binderVars"><span class="hs-identifier hs-var">binderVars</span></a></span><span> </span><span class="annot"><span class="annottext">[VarBndr TyVar Specificity]
</span><a href="#local-6989586621681165590"><span class="hs-identifier hs-var">dc_tvbndrs</span></a></span><span>
</span><span id="line-3541"></span><span>    </span><span id="local-6989586621681165582"><span class="annot"><span class="annottext">tmpl_tvs :: [TyVar]
</span><a href="#local-6989586621681165582"><span class="hs-identifier hs-var hs-var">tmpl_tvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyConBinder] -&gt; [TyVar]
forall tv argf. [VarBndr tv argf] -&gt; [tv]
</span><a href="GHC.Types.Var.html#binderVars"><span class="hs-identifier hs-var">binderVars</span></a></span><span> </span><span class="annot"><span class="annottext">[TyConBinder]
</span><a href="#local-6989586621681165592"><span class="hs-identifier hs-var">tmpl_bndrs</span></a></span><span>
</span><span id="line-3542"></span><span>
</span><span id="line-3543"></span><span class="hs-comment">{- Note [mkGADTVars]
~~~~~~~~~~~~~~~~~~~~
Running example:

data T (k1 :: *) (k2 :: *) (a :: k2) (b :: k2) where
  MkT :: forall (x1 : *) (y :: x1) (z :: *).
         T x1 * (Proxy (y :: x1), z) z

We need the rejigged type to be

  MkT :: forall (x1 :: *) (k2 :: *) (a :: k2) (b :: k2).
         forall (y :: x1) (z :: *).
         (k2 ~ *, a ~ (Proxy x1 y, z), b ~ z)
      =&gt; T x1 k2 a b

You might naively expect that z should become a universal tyvar,
not an existential. (After all, x1 becomes a universal tyvar.)
But z has kind * while b has kind k2, so the return type
   T x1 k2 a z
is ill-kinded.  Another way to say it is this: the universal
tyvars must have exactly the same kinds as the tyConTyVars.

So we need an existential tyvar and a heterogeneous equality
constraint. (The b ~ z is a bit redundant with the k2 ~ * that
comes before in that b ~ z implies k2 ~ *. I'm sure we could do
some analysis that could eliminate k2 ~ *. But we don't do this
yet.)

The data con signature has already been fully kind-checked.
The return type

  T x1 * (Proxy (y :: x1), z) z
becomes
  qtkvs    = [x1 :: *, y :: x1, z :: *]
  res_tmpl = T x1 * (Proxy x1 y, z) z

We start off by matching (T k1 k2 a b) with (T x1 * (Proxy x1 y, z) z). We
know this match will succeed because of the validity check (actually done
later, but laziness saves us -- see Note [Checking GADT return types]).
Thus, we get

  subst := { k1 |-&gt; x1, k2 |-&gt; *, a |-&gt; (Proxy x1 y, z), b |-&gt; z }

Now, we need to figure out what the GADT equalities should be. In this case,
we *don't* want (k1 ~ x1) to be a GADT equality: it should just be a
renaming. The others should be GADT equalities. We also need to make
sure that the universally-quantified variables of the datacon match up
with the tyvars of the tycon, as required for Core context well-formedness.
(This last bit is why we have to rejig at all!)

`choose` walks down the tycon tyvars, figuring out what to do with each one.
It carries two substitutions:
  - t_sub's domain is *template* or *tycon* tyvars, mapping them to variables
    mentioned in the datacon signature.
  - r_sub's domain is *result* tyvars, names written by the programmer in
    the datacon signature. The final rejigged type will use these names, but
    the subst is still needed because sometimes the printed name of these variables
    is different. (See choose_tv_name, below.)

Before explaining the details of `choose`, let's just look at its operation
on our example:

  choose [] [] {} {} [k1, k2, a, b]
  --&gt;          -- first branch of `case` statement
  choose
    univs:    [x1 :: *]
    eq_spec:  []
    t_sub:    {k1 |-&gt; x1}
    r_sub:    {x1 |-&gt; x1}
    t_tvs:    [k2, a, b]
  --&gt;          -- second branch of `case` statement
  choose
    univs:    [k2 :: *, x1 :: *]
    eq_spec:  [k2 ~ *]
    t_sub:    {k1 |-&gt; x1, k2 |-&gt; k2}
    r_sub:    {x1 |-&gt; x1}
    t_tvs:    [a, b]
  --&gt;          -- second branch of `case` statement
  choose
    univs:    [a :: k2, k2 :: *, x1 :: *]
    eq_spec:  [ a ~ (Proxy x1 y, z)
              , k2 ~ * ]
    t_sub:    {k1 |-&gt; x1, k2 |-&gt; k2, a |-&gt; a}
    r_sub:    {x1 |-&gt; x1}
    t_tvs:    [b]
  --&gt;          -- second branch of `case` statement
  choose
    univs:    [b :: k2, a :: k2, k2 :: *, x1 :: *]
    eq_spec:  [ b ~ z
              , a ~ (Proxy x1 y, z)
              , k2 ~ * ]
    t_sub:    {k1 |-&gt; x1, k2 |-&gt; k2, a |-&gt; a, b |-&gt; z}
    r_sub:    {x1 |-&gt; x1}
    t_tvs:    []
  --&gt;          -- end of recursion
  ( [x1 :: *, k2 :: *, a :: k2, b :: k2]
  , [k2 ~ *, a ~ (Proxy x1 y, z), b ~ z]
  , {x1 |-&gt; x1} )

`choose` looks up each tycon tyvar in the matching (it *must* be matched!).

* If it finds a bare result tyvar (the first branch of the `case`
  statement), it checks to make sure that the result tyvar isn't yet
  in the list of univ_tvs.  If it is in that list, then we have a
  repeated variable in the return type, and we in fact need a GADT
  equality.

* It then checks to make sure that the kind of the result tyvar
  matches the kind of the template tyvar. This check is what forces
  `z` to be existential, as it should be, explained above.

* Assuming no repeated variables or kind-changing, we wish to use the
  variable name given in the datacon signature (that is, `x1` not
  `k1`), not the tycon signature (which may have been made up by
  GHC). So, we add a mapping from the tycon tyvar to the result tyvar
  to t_sub.

* If we discover that a mapping in `subst` gives us a non-tyvar (the
  second branch of the `case` statement), then we have a GADT equality
  to create.  We create a fresh equality, but we don't extend any
  substitutions. The template variable substitution is meant for use
  in universal tyvar kinds, and these shouldn't be affected by any
  GADT equalities.

This whole algorithm is quite delicate, indeed. I (Richard E.) see two ways
of simplifying it:

1) The first branch of the `case` statement is really an optimization, used
in order to get fewer GADT equalities. It might be possible to make a GADT
equality for *every* univ. tyvar, even if the equality is trivial, and then
either deal with the bigger type or somehow reduce it later.

2) This algorithm strives to use the names for type variables as specified
by the user in the datacon signature. If we always used the tycon tyvar
names, for example, this would be simplified. This change would almost
certainly degrade error messages a bit, though.
-}</span><span>
</span><span id="line-3680"></span><span>
</span><span id="line-3681"></span><span class="hs-comment">-- ^ From information about a source datacon definition, extract out</span><span>
</span><span id="line-3682"></span><span class="hs-comment">-- what the universal variables and the GADT equalities should be.</span><span>
</span><span id="line-3683"></span><span class="hs-comment">-- See Note [mkGADTVars].</span><span>
</span><span id="line-3684"></span><span class="annot"><a href="GHC.Tc.TyCl.html#mkGADTVars"><span class="hs-identifier hs-type">mkGADTVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span>    </span><span class="hs-comment">-- ^ The tycon vars</span><span>
</span><span id="line-3685"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span>    </span><span class="hs-comment">-- ^ The datacon vars</span><span>
</span><span id="line-3686"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a></span><span>   </span><span class="hs-comment">-- ^ The matching between the template result type</span><span>
</span><span id="line-3687"></span><span>                         </span><span class="hs-comment">-- and the actual result type</span><span>
</span><span id="line-3688"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-3689"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.DataCon.html#EqSpec"><span class="hs-identifier hs-type">EqSpec</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-3690"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ The univ. variables, the GADT equalities,</span><span>
</span><span id="line-3691"></span><span>                           </span><span class="hs-comment">-- and a subst to apply to the GADT equalities</span><span>
</span><span id="line-3692"></span><span>                           </span><span class="hs-comment">-- and existentials.</span><span>
</span><span id="line-3693"></span><span id="mkGADTVars"><span class="annot"><span class="annottext">mkGADTVars :: [TyVar] -&gt; [TyVar] -&gt; TCvSubst -&gt; ([TyVar], [EqSpec], TCvSubst)
</span><a href="GHC.Tc.TyCl.html#mkGADTVars"><span class="hs-identifier hs-var hs-var">mkGADTVars</span></a></span></span><span> </span><span id="local-6989586621681165568"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165568"><span class="hs-identifier hs-var">tmpl_tvs</span></a></span></span><span> </span><span id="local-6989586621681165567"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165567"><span class="hs-identifier hs-var">dc_tvs</span></a></span></span><span> </span><span id="local-6989586621681165566"><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681165566"><span class="hs-identifier hs-var">subst</span></a></span></span><span>
</span><span id="line-3694"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyVar]
-&gt; [EqSpec]
-&gt; TCvSubst
-&gt; TCvSubst
-&gt; [TyVar]
-&gt; ([TyVar], [EqSpec], TCvSubst)
</span><a href="#local-6989586621681165565"><span class="hs-identifier hs-var">choose</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681165564"><span class="hs-identifier hs-var">empty_subst</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681165564"><span class="hs-identifier hs-var">empty_subst</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165568"><span class="hs-identifier hs-var">tmpl_tvs</span></a></span><span>
</span><span id="line-3695"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3696"></span><span>    </span><span id="local-6989586621681165563"><span class="annot"><span class="annottext">in_scope :: InScopeSet
</span><a href="#local-6989586621681165563"><span class="hs-identifier hs-var hs-var">in_scope</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; InScopeSet
</span><a href="GHC.Types.Var.Env.html#mkInScopeSet"><span class="hs-identifier hs-var">mkInScopeSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyVar] -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#mkVarSet"><span class="hs-identifier hs-var">mkVarSet</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165568"><span class="hs-identifier hs-var">tmpl_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; VarSet -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#unionVarSet"><span class="hs-operator hs-var">`unionVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#mkVarSet"><span class="hs-identifier hs-var">mkVarSet</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165567"><span class="hs-identifier hs-var">dc_tvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3697"></span><span>               </span><span class="annot"><span class="annottext">InScopeSet -&gt; InScopeSet -&gt; InScopeSet
</span><a href="GHC.Types.Var.Env.html#unionInScope"><span class="hs-operator hs-var">`unionInScope`</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst -&gt; InScopeSet
</span><a href="GHC.Core.TyCo.Subst.html#getTCvInScope"><span class="hs-identifier hs-var">getTCvInScope</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681165566"><span class="hs-identifier hs-var">subst</span></a></span><span>
</span><span id="line-3698"></span><span>    </span><span id="local-6989586621681165564"><span class="annot"><span class="annottext">empty_subst :: TCvSubst
</span><a href="#local-6989586621681165564"><span class="hs-identifier hs-var hs-var">empty_subst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InScopeSet -&gt; TCvSubst
</span><a href="GHC.Core.TyCo.Subst.html#mkEmptyTCvSubst"><span class="hs-identifier hs-var">mkEmptyTCvSubst</span></a></span><span> </span><span class="annot"><span class="annottext">InScopeSet
</span><a href="#local-6989586621681165563"><span class="hs-identifier hs-var">in_scope</span></a></span><span>
</span><span id="line-3699"></span><span>
</span><span id="line-3700"></span><span>    </span><span class="annot"><a href="#local-6989586621681165565"><span class="hs-identifier hs-type">choose</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span>           </span><span class="hs-comment">-- accumulator of univ tvs, reversed</span><span>
</span><span id="line-3701"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.DataCon.html#EqSpec"><span class="hs-identifier hs-type">EqSpec</span></a></span><span class="hs-special">]</span><span>          </span><span class="hs-comment">-- accumulator of GADT equalities, reversed</span><span>
</span><span id="line-3702"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a></span><span>          </span><span class="hs-comment">-- template substitution</span><span>
</span><span id="line-3703"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a></span><span>          </span><span class="hs-comment">-- res. substitution</span><span>
</span><span id="line-3704"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span>           </span><span class="hs-comment">-- template tvs (the univ tvs passed in)</span><span>
</span><span id="line-3705"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span>         </span><span class="hs-comment">-- the univ_tvs</span><span>
</span><span id="line-3706"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.DataCon.html#EqSpec"><span class="hs-identifier hs-type">EqSpec</span></a></span><span class="hs-special">]</span><span>        </span><span class="hs-comment">-- GADT equalities</span><span>
</span><span id="line-3707"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a></span><span> </span><span class="hs-special">)</span><span>       </span><span class="hs-comment">-- a substitution to fix kinds in ex_tvs</span><span>
</span><span id="line-3708"></span><span>
</span><span id="line-3709"></span><span>    </span><span id="local-6989586621681165565"><span class="annot"><span class="annottext">choose :: [TyVar]
-&gt; [EqSpec]
-&gt; TCvSubst
-&gt; TCvSubst
-&gt; [TyVar]
-&gt; ([TyVar], [EqSpec], TCvSubst)
</span><a href="#local-6989586621681165565"><span class="hs-identifier hs-var hs-var">choose</span></a></span></span><span> </span><span id="local-6989586621681165557"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165557"><span class="hs-identifier hs-var">univs</span></a></span></span><span> </span><span id="local-6989586621681165556"><span class="annot"><span class="annottext">[EqSpec]
</span><a href="#local-6989586621681165556"><span class="hs-identifier hs-var">eqs</span></a></span></span><span> </span><span id="local-6989586621681165555"><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681165555"><span class="hs-identifier hs-var">_t_sub</span></a></span></span><span> </span><span id="local-6989586621681165554"><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681165554"><span class="hs-identifier hs-var">r_sub</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-3710"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyVar] -&gt; [TyVar]
forall a. [a] -&gt; [a]
</span><a href="../../base/src/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165557"><span class="hs-identifier hs-var">univs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EqSpec] -&gt; [EqSpec]
forall a. [a] -&gt; [a]
</span><a href="../../base/src/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="annot"><span class="annottext">[EqSpec]
</span><a href="#local-6989586621681165556"><span class="hs-identifier hs-var">eqs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681165554"><span class="hs-identifier hs-var">r_sub</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3711"></span><span>    </span><span class="annot"><a href="#local-6989586621681165565"><span class="hs-identifier hs-var">choose</span></a></span><span> </span><span id="local-6989586621681165552"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165552"><span class="hs-identifier hs-var">univs</span></a></span></span><span> </span><span id="local-6989586621681165551"><span class="annot"><span class="annottext">[EqSpec]
</span><a href="#local-6989586621681165551"><span class="hs-identifier hs-var">eqs</span></a></span></span><span> </span><span id="local-6989586621681165550"><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681165550"><span class="hs-identifier hs-var">t_sub</span></a></span></span><span> </span><span id="local-6989586621681165549"><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681165549"><span class="hs-identifier hs-var">r_sub</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681165548"><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681165548"><span class="hs-identifier hs-var">t_tv</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681165547"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165547"><span class="hs-identifier hs-var">t_tvs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-3712"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681165546"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165546"><span class="hs-identifier hs-var">r_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCvSubst -&gt; TyVar -&gt; Maybe Type
</span><a href="GHC.Core.TyCo.Subst.html#lookupTyVar"><span class="hs-identifier hs-var">lookupTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681165566"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681165548"><span class="hs-identifier hs-var">t_tv</span></a></span><span>
</span><span id="line-3713"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe TyVar
</span><a href="GHC.Core.Type.html#getTyVar_maybe"><span class="hs-identifier hs-var">getTyVar_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165546"><span class="hs-identifier hs-var">r_ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3714"></span><span>          </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681165544"><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681165544"><span class="hs-identifier hs-var">r_tv</span></a></span></span><span>
</span><span id="line-3715"></span><span>            </span><span class="hs-glyph">|</span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681165544"><span class="hs-identifier hs-var">r_tv</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar -&gt; [TyVar] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#elem"><span class="hs-operator hs-var">`elem`</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165552"><span class="hs-identifier hs-var">univs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3716"></span><span>            </span><span class="hs-special">,</span><span>  </span><span class="annot"><span class="annottext">TyVar -&gt; Type
</span><a href="GHC.Types.Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681165544"><span class="hs-identifier hs-var">r_tv</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Bool
</span><a href="GHC.Core.Type.html#eqType"><span class="hs-operator hs-var">`eqType`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasCallStack =&gt; TCvSubst -&gt; Type -&gt; Type
TCvSubst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">substTy</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681165550"><span class="hs-identifier hs-var">t_sub</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyVar -&gt; Type
</span><a href="GHC.Types.Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681165548"><span class="hs-identifier hs-var">t_tv</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3717"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-comment">-- simple, well-kinded variable substitution.</span><span>
</span><span id="line-3718"></span><span>               </span><span class="annot"><span class="annottext">[TyVar]
-&gt; [EqSpec]
-&gt; TCvSubst
-&gt; TCvSubst
-&gt; [TyVar]
-&gt; ([TyVar], [EqSpec], TCvSubst)
</span><a href="#local-6989586621681165565"><span class="hs-identifier hs-var">choose</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681165544"><span class="hs-identifier hs-var">r_tv</span></a></span><span class="annot"><span class="annottext">TyVar -&gt; [TyVar] -&gt; [TyVar]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165552"><span class="hs-identifier hs-var">univs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[EqSpec]
</span><a href="#local-6989586621681165551"><span class="hs-identifier hs-var">eqs</span></a></span><span>
</span><span id="line-3719"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCvSubst -&gt; TyVar -&gt; Type -&gt; TCvSubst
</span><a href="GHC.Core.TyCo.Subst.html#extendTvSubst"><span class="hs-identifier hs-var">extendTvSubst</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681165550"><span class="hs-identifier hs-var">t_sub</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681165548"><span class="hs-identifier hs-var">t_tv</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165540"><span class="hs-identifier hs-var">r_ty'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3720"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCvSubst -&gt; TyVar -&gt; Type -&gt; TCvSubst
</span><a href="GHC.Core.TyCo.Subst.html#extendTvSubst"><span class="hs-identifier hs-var">extendTvSubst</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681165549"><span class="hs-identifier hs-var">r_sub</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681165544"><span class="hs-identifier hs-var">r_tv</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165540"><span class="hs-identifier hs-var">r_ty'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3721"></span><span>                      </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165547"><span class="hs-identifier hs-var">t_tvs</span></a></span><span>
</span><span id="line-3722"></span><span>            </span><span class="hs-keyword">where</span><span>
</span><span id="line-3723"></span><span>              </span><span id="local-6989586621681165539"><span class="annot"><span class="annottext">r_tv1 :: TyVar
</span><a href="#local-6989586621681165539"><span class="hs-identifier hs-var hs-var">r_tv1</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyVar -&gt; Name -&gt; TyVar
</span><a href="GHC.Types.Var.html#setTyVarName"><span class="hs-identifier hs-var">setTyVarName</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681165544"><span class="hs-identifier hs-var">r_tv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyVar -&gt; TyVar -&gt; Name
</span><a href="#local-6989586621681165537"><span class="hs-identifier hs-var">choose_tv_name</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681165544"><span class="hs-identifier hs-var">r_tv</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681165548"><span class="hs-identifier hs-var">t_tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3724"></span><span>              </span><span id="local-6989586621681165540"><span class="annot"><span class="annottext">r_ty' :: Type
</span><a href="#local-6989586621681165540"><span class="hs-identifier hs-var hs-var">r_ty'</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyVar -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681165539"><span class="hs-identifier hs-var">r_tv1</span></a></span><span>
</span><span id="line-3725"></span><span>
</span><span id="line-3726"></span><span>               </span><span class="hs-comment">-- Not a simple substitution: make an equality predicate</span><span>
</span><span id="line-3727"></span><span>          </span><span class="annot"><span class="annottext">Maybe TyVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[TyVar]
-&gt; [EqSpec]
-&gt; TCvSubst
-&gt; TCvSubst
-&gt; [TyVar]
-&gt; ([TyVar], [EqSpec], TCvSubst)
</span><a href="#local-6989586621681165565"><span class="hs-identifier hs-var">choose</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681165536"><span class="hs-identifier hs-var">t_tv'</span></a></span><span class="annot"><span class="annottext">TyVar -&gt; [TyVar] -&gt; [TyVar]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165552"><span class="hs-identifier hs-var">univs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyVar -&gt; Type -&gt; EqSpec
</span><a href="GHC.Core.DataCon.html#mkEqSpec"><span class="hs-identifier hs-var">mkEqSpec</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681165536"><span class="hs-identifier hs-var">t_tv'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165546"><span class="hs-identifier hs-var">r_ty</span></a></span><span> </span><span class="annot"><span class="annottext">EqSpec -&gt; [EqSpec] -&gt; [EqSpec]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[EqSpec]
</span><a href="#local-6989586621681165551"><span class="hs-identifier hs-var">eqs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3728"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCvSubst -&gt; TyVar -&gt; Type -&gt; TCvSubst
</span><a href="GHC.Core.TyCo.Subst.html#extendTvSubst"><span class="hs-identifier hs-var">extendTvSubst</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681165550"><span class="hs-identifier hs-var">t_sub</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681165548"><span class="hs-identifier hs-var">t_tv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyVar -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681165536"><span class="hs-identifier hs-var">t_tv'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3729"></span><span>                         </span><span class="hs-comment">-- We've updated the kind of t_tv,</span><span>
</span><span id="line-3730"></span><span>                         </span><span class="hs-comment">-- so add it to t_sub (#14162)</span><span>
</span><span id="line-3731"></span><span>                      </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681165549"><span class="hs-identifier hs-var">r_sub</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165547"><span class="hs-identifier hs-var">t_tvs</span></a></span><span>
</span><span id="line-3732"></span><span>            </span><span class="hs-keyword">where</span><span>
</span><span id="line-3733"></span><span>              </span><span id="local-6989586621681165536"><span class="annot"><span class="annottext">t_tv' :: TyVar
</span><a href="#local-6989586621681165536"><span class="hs-identifier hs-var hs-var">t_tv'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type) -&gt; TyVar -&gt; TyVar
</span><a href="GHC.Types.Var.html#updateTyVarKind"><span class="hs-identifier hs-var">updateTyVarKind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasCallStack =&gt; TCvSubst -&gt; Type -&gt; Type
TCvSubst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">substTy</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681165550"><span class="hs-identifier hs-var">t_sub</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681165548"><span class="hs-identifier hs-var">t_tv</span></a></span><span>
</span><span id="line-3734"></span><span>
</span><span id="line-3735"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-3736"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; ([TyVar], [EqSpec], TCvSubst)
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mkGADTVars&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyVar] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165568"><span class="hs-identifier hs-var">tmpl_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681165566"><span class="hs-identifier hs-var">subst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3737"></span><span>
</span><span id="line-3738"></span><span>      </span><span class="hs-comment">-- choose an appropriate name for a univ tyvar.</span><span>
</span><span id="line-3739"></span><span>      </span><span class="hs-comment">-- This *must* preserve the Unique of the result tv, so that we</span><span>
</span><span id="line-3740"></span><span>      </span><span class="hs-comment">-- can detect repeated variables. It prefers user-specified names</span><span>
</span><span id="line-3741"></span><span>      </span><span class="hs-comment">-- over system names. A result variable with a system name can</span><span>
</span><span id="line-3742"></span><span>      </span><span class="hs-comment">-- happen with GHC-generated implicit kind variables.</span><span>
</span><span id="line-3743"></span><span>    </span><span class="annot"><a href="#local-6989586621681165537"><span class="hs-identifier hs-type">choose_tv_name</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-3744"></span><span>    </span><span id="local-6989586621681165537"><span class="annot"><span class="annottext">choose_tv_name :: TyVar -&gt; TyVar -&gt; Name
</span><a href="#local-6989586621681165537"><span class="hs-identifier hs-var hs-var">choose_tv_name</span></a></span></span><span> </span><span id="local-6989586621681165533"><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681165533"><span class="hs-identifier hs-var">r_tv</span></a></span></span><span> </span><span id="local-6989586621681165532"><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681165532"><span class="hs-identifier hs-var">t_tv</span></a></span></span><span>
</span><span id="line-3745"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="GHC.Types.Name.html#isSystemName"><span class="hs-identifier hs-var">isSystemName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165530"><span class="hs-identifier hs-var">r_tv_name</span></a></span><span>
</span><span id="line-3746"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Unique -&gt; Name
</span><a href="GHC.Types.Name.html#setNameUnique"><span class="hs-identifier hs-var">setNameUnique</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165528"><span class="hs-identifier hs-var">t_tv_name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Unique
forall a. Uniquable a =&gt; a -&gt; Unique
</span><a href="GHC.Types.Unique.html#getUnique"><span class="hs-identifier hs-var">getUnique</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165530"><span class="hs-identifier hs-var">r_tv_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3747"></span><span>
</span><span id="line-3748"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-3749"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165530"><span class="hs-identifier hs-var">r_tv_name</span></a></span><span>
</span><span id="line-3750"></span><span>
</span><span id="line-3751"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-3752"></span><span>        </span><span id="local-6989586621681165530"><span class="annot"><span class="annottext">r_tv_name :: Name
</span><a href="#local-6989586621681165530"><span class="hs-identifier hs-var hs-var">r_tv_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyVar -&gt; Name
forall a. NamedThing a =&gt; a -&gt; Name
</span><a href="GHC.Types.Name.html#getName"><span class="hs-identifier hs-var">getName</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681165533"><span class="hs-identifier hs-var">r_tv</span></a></span><span>
</span><span id="line-3753"></span><span>        </span><span id="local-6989586621681165528"><span class="annot"><span class="annottext">t_tv_name :: Name
</span><a href="#local-6989586621681165528"><span class="hs-identifier hs-var hs-var">t_tv_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyVar -&gt; Name
forall a. NamedThing a =&gt; a -&gt; Name
</span><a href="GHC.Types.Name.html#getName"><span class="hs-identifier hs-var">getName</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681165532"><span class="hs-identifier hs-var">t_tv</span></a></span><span>
</span><span id="line-3754"></span><span>
</span><span id="line-3755"></span><span class="hs-comment">{-
Note [Substitution in template variables kinds]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

data G (a :: Maybe k) where
  MkG :: G Nothing

With explicit kind variables

data G k (a :: Maybe k) where
  MkG :: G k1 (Nothing k1)

Note how k1 is distinct from k. So, when we match the template
`G k a` against `G k1 (Nothing k1)`, we get a subst
[ k |-&gt; k1, a |-&gt; Nothing k1 ]. Even though this subst has two
mappings, we surely don't want to add (k, k1) to the list of
GADT equalities -- that would be overly complex and would create
more untouchable variables than we need. So, when figuring out
which tyvars are GADT-like and which aren't (the fundamental
job of `choose`), we want to treat `k` as *not* GADT-like.
Instead, we wish to substitute in `a`'s kind, to get (a :: Maybe k1)
instead of (a :: Maybe k). This is the reason for dealing
with a substitution in here.

However, we do not *always* want to substitute. Consider

data H (a :: k) where
  MkH :: H Int

With explicit kind variables:

data H k (a :: k) where
  MkH :: H * Int

Here, we have a kind-indexed GADT. The subst in question is
[ k |-&gt; *, a |-&gt; Int ]. Now, we *don't* want to substitute in `a`'s
kind, because that would give a constructor with the type

MkH :: forall (k :: *) (a :: *). (k ~ *) -&gt; (a ~ Int) -&gt; H k a

The problem here is that a's kind is wrong -- it needs to be k, not *!
So, if the matching for a variable is anything but another bare variable,
we drop the mapping from the substitution before proceeding. This
was not an issue before kind-indexed GADTs because this case could
never happen.

************************************************************************
*                                                                      *
                Validity checking
*                                                                      *
************************************************************************

Validity checking is done once the mutually-recursive knot has been
tied, so we can look at things freely.
-}</span><span>
</span><span id="line-3810"></span><span>
</span><span id="line-3811"></span><span class="annot"><a href="GHC.Tc.TyCl.html#checkValidTyCl"><span class="hs-identifier hs-type">checkValidTyCl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-3812"></span><span class="hs-comment">-- The returned list is either a singleton (if valid)</span><span>
</span><span id="line-3813"></span><span class="hs-comment">-- or a list of &quot;fake tycons&quot; (if not); the fake tycons</span><span>
</span><span id="line-3814"></span><span class="hs-comment">-- include any implicits, like promoted data constructors</span><span>
</span><span id="line-3815"></span><span class="hs-comment">-- See Note [Recover from validity error]</span><span>
</span><span id="line-3816"></span><span id="checkValidTyCl"><span class="annot"><span class="annottext">checkValidTyCl :: TyCon -&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
</span><a href="GHC.Tc.TyCl.html#checkValidTyCl"><span class="hs-identifier hs-var hs-var">checkValidTyCl</span></a></span></span><span> </span><span id="local-6989586621681165526"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165526"><span class="hs-identifier hs-var">tc</span></a></span></span><span>
</span><span id="line-3817"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; SrcSpan
forall a. NamedThing a =&gt; a -&gt; SrcSpan
</span><a href="GHC.Types.Name.html#getSrcSpan"><span class="hs-identifier hs-var">getSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165526"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon])
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3818"></span><span>    </span><span class="annot"><span class="annottext">TyCon
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
forall a. TyCon -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.TyCl.html#addTyConCtxt"><span class="hs-identifier hs-var">addTyConCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165526"><span class="hs-identifier hs-var">tc</span></a></span><span>            </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon])
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3819"></span><span>    </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
forall r. TcRn r -&gt; TcRn r -&gt; TcRn r
</span><a href="GHC.Tc.Utils.Monad.html#recoverM"><span class="hs-identifier hs-var">recoverM</span></a></span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
</span><a href="#local-6989586621681165525"><span class="hs-identifier hs-var">recovery_code</span></a></span><span>     </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon])
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3820"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Starting validity for tycon&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165526"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3821"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TcRn ()
</span><a href="GHC.Tc.TyCl.html#checkValidTyCon"><span class="hs-identifier hs-var">checkValidTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165526"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-3822"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Done validity for tycon&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165526"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3823"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">[TyCon] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165526"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3824"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3825"></span><span>    </span><span id="local-6989586621681165525"><span class="annot"><span class="annottext">recovery_code :: IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
</span><a href="#local-6989586621681165525"><span class="hs-identifier hs-var hs-var">recovery_code</span></a></span></span><span> </span><span class="hs-comment">-- See Note [Recover from validity error]</span><span>
</span><span id="line-3826"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Aborted validity for tycon&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165526"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3827"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">[TyCon] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyCon]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TyThing -&gt; [TyCon]) -&gt; [TyThing] -&gt; [TyCon]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><a href="../../base/src/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a></span><span> </span><span class="annot"><span class="annottext">TyThing -&gt; [TyCon]
</span><a href="#local-6989586621681165524"><span class="hs-identifier hs-var">mk_fake_tc</span></a></span><span> </span><span class="annot"><span class="annottext">([TyThing] -&gt; [TyCon]) -&gt; [TyThing] -&gt; [TyCon]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3828"></span><span>                     </span><span class="annot"><span class="annottext">TyCon -&gt; TyThing
</span><a href="GHC.Core.TyCo.Rep.html#ATyCon"><span class="hs-identifier hs-var">ATyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165526"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">TyThing -&gt; [TyThing] -&gt; [TyThing]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [TyThing]
</span><a href="GHC.Driver.Types.html#implicitTyConThings"><span class="hs-identifier hs-var">implicitTyConThings</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165526"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3829"></span><span>
</span><span id="line-3830"></span><span>    </span><span id="local-6989586621681165524"><span class="annot"><span class="annottext">mk_fake_tc :: TyThing -&gt; [TyCon]
</span><a href="#local-6989586621681165524"><span class="hs-identifier hs-var hs-var">mk_fake_tc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ATyCon"><span class="hs-identifier hs-type">ATyCon</span></a></span><span> </span><span id="local-6989586621681165522"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165522"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-3831"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isClassTyCon"><span class="hs-identifier hs-var">isClassTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165522"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165522"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">]</span><span>   </span><span class="hs-comment">-- Ugh! Note [Recover from validity error]</span><span>
</span><span id="line-3832"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TyCon -&gt; TyCon
</span><a href="GHC.Builtin.Types.html#makeRecoveryTyCon"><span class="hs-identifier hs-var">makeRecoveryTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165522"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-3833"></span><span>    </span><span class="annot"><a href="#local-6989586621681165524"><span class="hs-identifier hs-var">mk_fake_tc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AConLike"><span class="hs-identifier hs-type">AConLike</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.ConLike.html#RealDataCon"><span class="hs-identifier hs-type">RealDataCon</span></a></span><span> </span><span id="local-6989586621681165518"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165518"><span class="hs-identifier hs-var">dc</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3834"></span><span>                        </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TyCon -&gt; TyCon
</span><a href="GHC.Builtin.Types.html#makeRecoveryTyCon"><span class="hs-identifier hs-var">makeRecoveryTyCon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; TyCon
</span><a href="GHC.Core.DataCon.html#promoteDataCon"><span class="hs-identifier hs-var">promoteDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165518"><span class="hs-identifier hs-var">dc</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-3835"></span><span>    </span><span class="annot"><a href="#local-6989586621681165524"><span class="hs-identifier hs-var">mk_fake_tc</span></a></span><span> </span><span class="annot"><span class="annottext">TyThing
</span><span class="hs-identifier">_</span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-3836"></span><span>
</span><span id="line-3837"></span><span class="hs-comment">{- Note [Recover from validity error]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We recover from a validity error in a type or class, which allows us
to report multiple validity errors. In the failure case we return a
TyCon of the right kind, but with no interesting behaviour
(makeRecoveryTyCon). Why?  Suppose we have
   type T a = Fun
where Fun is a type family of arity 1.  The RHS is invalid, but we
want to go on checking validity of subsequent type declarations.
So we replace T with an abstract TyCon which will do no harm.
See indexed-types/should_fail/BadSock and #10896

Some notes:

* We must make fakes for promoted DataCons too. Consider (#15215)
      data T a = MkT ...
      data S a = ...T...MkT....
  If there is an error in the definition of 'T' we add a &quot;fake type
  constructor&quot; to the type environment, so that we can continue to
  typecheck 'S'.  But we /were not/ adding a fake anything for 'MkT'
  and so there was an internal error when we met 'MkT' in the body of
  'S'.

* Painfully, we *don't* want to do this for classes.
  Consider tcfail041:
     class (?x::Int) =&gt; C a where ...
     instance C Int
  The class is invalid because of the superclass constraint.  But
  we still want it to look like a /class/, else the instance bleats
  that the instance is mal-formed because it hasn't got a class in
  the head.

  This is really bogus; now we have in scope a Class that is invalid
  in some way, with unknown downstream consequences.  A better
  alternative might be to make a fake class TyCon.  A job for another day.
-}</span><span>
</span><span id="line-3873"></span><span>
</span><span id="line-3874"></span><span class="hs-comment">-------------------------</span><span>
</span><span id="line-3875"></span><span class="hs-comment">-- For data types declared with record syntax, we require</span><span>
</span><span id="line-3876"></span><span class="hs-comment">-- that each constructor that has a field 'f'</span><span>
</span><span id="line-3877"></span><span class="hs-comment">--      (a) has the same result type</span><span>
</span><span id="line-3878"></span><span class="hs-comment">--      (b) has the same type for 'f'</span><span>
</span><span id="line-3879"></span><span class="hs-comment">-- module alpha conversion of the quantified type variables</span><span>
</span><span id="line-3880"></span><span class="hs-comment">-- of the constructor.</span><span>
</span><span id="line-3881"></span><span class="hs-comment">--</span><span>
</span><span id="line-3882"></span><span class="hs-comment">-- Note that we allow existentials to match because the</span><span>
</span><span id="line-3883"></span><span class="hs-comment">-- fields can never meet. E.g</span><span>
</span><span id="line-3884"></span><span class="hs-comment">--      data T where</span><span>
</span><span id="line-3885"></span><span class="hs-comment">--        T1 { f1 :: b, f2 :: a, f3 ::Int } :: T</span><span>
</span><span id="line-3886"></span><span class="hs-comment">--        T2 { f1 :: c, f2 :: c, f3 ::Int } :: T</span><span>
</span><span id="line-3887"></span><span class="hs-comment">-- Here we do not complain about f1,f2 because they are existential</span><span>
</span><span id="line-3888"></span><span>
</span><span id="line-3889"></span><span class="annot"><a href="GHC.Tc.TyCl.html#checkValidTyCon"><span class="hs-identifier hs-type">checkValidTyCon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3890"></span><span id="checkValidTyCon"><span class="annot"><span class="annottext">checkValidTyCon :: TyCon -&gt; TcRn ()
</span><a href="GHC.Tc.TyCl.html#checkValidTyCon"><span class="hs-identifier hs-var hs-var">checkValidTyCon</span></a></span></span><span> </span><span id="local-6989586621681165516"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165516"><span class="hs-identifier hs-var">tc</span></a></span></span><span>
</span><span id="line-3891"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isPrimTyCon"><span class="hs-identifier hs-var">isPrimTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165516"><span class="hs-identifier hs-var">tc</span></a></span><span>   </span><span class="hs-comment">-- Happens when Haddock'ing GHC.Prim</span><span>
</span><span id="line-3892"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3893"></span><span>
</span><span id="line-3894"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
forall thing. NamedThing thing =&gt; thing -&gt; Bool
</span><a href="GHC.Types.Name.html#isWiredIn"><span class="hs-identifier hs-var">isWiredIn</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165516"><span class="hs-identifier hs-var">tc</span></a></span><span>     </span><span class="hs-comment">-- validity-checking wired-in tycons is a waste of</span><span>
</span><span id="line-3895"></span><span>                     </span><span class="hs-comment">-- time. More importantly, a wired-in tycon might</span><span>
</span><span id="line-3896"></span><span>                     </span><span class="hs-comment">-- violate assumptions. Example: (~) has a superclass</span><span>
</span><span id="line-3897"></span><span>                     </span><span class="hs-comment">-- mentioning (~#), which is ill-kinded in source Haskell</span><span>
</span><span id="line-3898"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Skipping validity check for wired-in&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165516"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3899"></span><span>
</span><span id="line-3900"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-3901"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;checkValidTyCon&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165516"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Class -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Maybe Class
</span><a href="GHC.Core.TyCon.html#tyConClass_maybe"><span class="hs-identifier hs-var">tyConClass_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165516"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3902"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681165513"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681165513"><span class="hs-identifier hs-var">cl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Maybe Class
</span><a href="GHC.Core.TyCon.html#tyConClass_maybe"><span class="hs-identifier hs-var">tyConClass_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165516"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-3903"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Class -&gt; TcRn ()
</span><a href="GHC.Tc.TyCl.html#checkValidClass"><span class="hs-identifier hs-var">checkValidClass</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681165513"><span class="hs-identifier hs-var">cl</span></a></span><span>
</span><span id="line-3904"></span><span>
</span><span id="line-3905"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681165511"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165511"><span class="hs-identifier hs-var">syn_rhs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Maybe Type
</span><a href="GHC.Core.TyCon.html#synTyConRhs_maybe"><span class="hs-identifier hs-var">synTyConRhs_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165516"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-3906"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt -&gt; Type -&gt; TcRn ()
</span><a href="GHC.Tc.Validity.html#checkValidType"><span class="hs-identifier hs-var">checkValidType</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="#local-6989586621681165508"><span class="hs-identifier hs-var">syn_ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165511"><span class="hs-identifier hs-var">syn_rhs</span></a></span><span>
</span><span id="line-3907"></span><span>                    </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt -&gt; Type -&gt; TcRn ()
</span><a href="GHC.Tc.Validity.html#checkTySynRhs"><span class="hs-identifier hs-var">checkTySynRhs</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="#local-6989586621681165508"><span class="hs-identifier hs-var">syn_ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165511"><span class="hs-identifier hs-var">syn_rhs</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3908"></span><span>
</span><span id="line-3909"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681165506"><span class="annot"><span class="annottext">FamTyConFlav
</span><a href="#local-6989586621681165506"><span class="hs-identifier hs-var">fam_flav</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Maybe FamTyConFlav
</span><a href="GHC.Core.TyCon.html#famTyConFlav_maybe"><span class="hs-identifier hs-var">famTyConFlav_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165516"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-3910"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">FamTyConFlav
</span><a href="#local-6989586621681165506"><span class="hs-identifier hs-var">fam_flav</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3911"></span><span>               </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#ClosedSynFamilyTyCon"><span class="hs-identifier hs-type">ClosedSynFamilyTyCon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681165504"><span class="annot"><span class="annottext">CoAxiom Branched
</span><a href="#local-6989586621681165504"><span class="hs-identifier hs-var">ax</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-3912"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TcRn () -&gt; TcRn ()
forall a. TyCon -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.TyCl.html#tcAddClosedTypeFamilyDeclCtxt"><span class="hs-identifier hs-var">tcAddClosedTypeFamilyDeclCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165516"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcRn ()) -&gt; TcRn () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3913"></span><span>                      </span><span class="annot"><span class="annottext">CoAxiom Branched -&gt; TcRn ()
</span><a href="GHC.Tc.Validity.html#checkValidCoAxiom"><span class="hs-identifier hs-var">checkValidCoAxiom</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiom Branched
</span><a href="#local-6989586621681165504"><span class="hs-identifier hs-var">ax</span></a></span><span>
</span><span id="line-3914"></span><span>               </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#ClosedSynFamilyTyCon"><span class="hs-identifier hs-type">ClosedSynFamilyTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (CoAxiom Branched)
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3915"></span><span>               </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">FamTyConFlav
</span><a href="GHC.Core.TyCon.html#AbstractClosedSynFamilyTyCon"><span class="hs-identifier hs-var">AbstractClosedSynFamilyTyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-3916"></span><span>                 </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681165501"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681165501"><span class="hs-identifier hs-var">hsBoot</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv Bool
</span><a href="GHC.Tc.Utils.Monad.html#tcIsHsBootOrSig"><span class="hs-identifier hs-var">tcIsHsBootOrSig</span></a></span><span>
</span><span id="line-3917"></span><span>                    </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681165501"><span class="hs-identifier hs-var">hsBoot</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; TcRn ()) -&gt; SDoc -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3918"></span><span>                      </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;You may define an abstract closed type family&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-3919"></span><span>                      </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;only in a .hs-boot file&quot;</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3920"></span><span>               </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#DataFamilyTyCon"><span class="hs-identifier hs-type">DataFamilyTyCon</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3921"></span><span>               </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">FamTyConFlav
</span><a href="GHC.Core.TyCon.html#OpenSynFamilyTyCon"><span class="hs-identifier hs-var">OpenSynFamilyTyCon</span></a></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3922"></span><span>               </span><span class="hs-special">;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#BuiltInSynFamTyCon"><span class="hs-identifier hs-type">BuiltInSynFamTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">BuiltInSynFamily
</span><span class="hs-identifier">_</span></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3923"></span><span>
</span><span id="line-3924"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-3925"></span><span>               </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- Check the context on the data decl</span><span>
</span><span id="line-3926"></span><span>                 </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;cvtc1&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165516"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3927"></span><span>               </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt -&gt; [Type] -&gt; TcRn ()
</span><a href="GHC.Tc.Validity.html#checkValidTheta"><span class="hs-identifier hs-var">checkValidTheta</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#DataTyCtxt"><span class="hs-identifier hs-var">DataTyCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165497"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Type]
</span><a href="GHC.Core.TyCon.html#tyConStupidTheta"><span class="hs-identifier hs-var">tyConStupidTheta</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165516"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3928"></span><span>
</span><span id="line-3929"></span><span>               </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;cvtc2&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165516"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3930"></span><span>
</span><span id="line-3931"></span><span>               </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681165495"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681165495"><span class="hs-identifier hs-var">dflags</span></a></span></span><span>          </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-3932"></span><span>               </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681165494"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681165494"><span class="hs-identifier hs-var">existential_ok</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall gbl lcl. Extension -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><a href="../../ghc-boot-th/src/GHC.LanguageExtensions.Type.html#ExistentialQuantification"><span class="hs-identifier hs-var">LangExt.ExistentialQuantification</span></a></span><span>
</span><span id="line-3933"></span><span>               </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681165492"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681165492"><span class="hs-identifier hs-var">gadt_ok</span></a></span></span><span>         </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall gbl lcl. Extension -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><a href="../../ghc-boot-th/src/GHC.LanguageExtensions.Type.html#GADTs"><span class="hs-identifier hs-var">LangExt.GADTs</span></a></span><span>
</span><span id="line-3934"></span><span>               </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681165490"><span class="annot"><span class="annottext">ex_ok :: Bool
</span><a href="#local-6989586621681165490"><span class="hs-identifier hs-var hs-var">ex_ok</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681165494"><span class="hs-identifier hs-var">existential_ok</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681165492"><span class="hs-identifier hs-var">gadt_ok</span></a></span><span>
</span><span id="line-3935"></span><span>                     </span><span class="hs-comment">-- Data cons can have existential context</span><span>
</span><span id="line-3936"></span><span>               </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(DataCon -&gt; TcRn ()) -&gt; [DataCon] -&gt; TcRn ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><a href="../../base/src/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Bool -&gt; TyCon -&gt; DataCon -&gt; TcRn ()
</span><a href="GHC.Tc.TyCl.html#checkValidDataCon"><span class="hs-identifier hs-var">checkValidDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681165495"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681165490"><span class="hs-identifier hs-var">ex_ok</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165516"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[DataCon]
</span><a href="#local-6989586621681165488"><span class="hs-identifier hs-var">data_cons</span></a></span><span>
</span><span id="line-3937"></span><span>               </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(FieldLabel -&gt; TcRn ()) -&gt; [FieldLabel] -&gt; TcRn ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><a href="../../base/src/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[DataCon] -&gt; FieldLabel -&gt; TcRn ()
</span><a href="GHC.Tc.TyCl.html#checkPartialRecordField"><span class="hs-identifier hs-var">checkPartialRecordField</span></a></span><span> </span><span class="annot"><span class="annottext">[DataCon]
</span><a href="#local-6989586621681165488"><span class="hs-identifier hs-var">data_cons</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [FieldLabel]
</span><a href="GHC.Core.TyCon.html#tyConFieldLabels"><span class="hs-identifier hs-var">tyConFieldLabels</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165516"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3938"></span><span>
</span><span id="line-3939"></span><span>                </span><span class="hs-comment">-- Check that fields with the same name share a type</span><span>
</span><span id="line-3940"></span><span>               </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(NonEmpty (FieldLabel, DataCon) -&gt; TcRn ())
-&gt; [NonEmpty (FieldLabel, DataCon)] -&gt; TcRn ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><a href="../../base/src/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a></span><span> </span><span class="annot"><span class="annottext">NonEmpty (FieldLabel, DataCon) -&gt; TcRn ()
forall {a}. NonEmpty (FieldLbl a, DataCon) -&gt; TcRn ()
</span><a href="#local-6989586621681165485"><span class="hs-identifier hs-var">check_fields</span></a></span><span> </span><span class="annot"><span class="annottext">[NonEmpty (FieldLabel, DataCon)]
</span><a href="#local-6989586621681165484"><span class="hs-identifier hs-var">groups</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><span id="line-3941"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3942"></span><span>    </span><span id="local-6989586621681165508"><span class="annot"><span class="annottext">syn_ctxt :: UserTypeCtxt
</span><a href="#local-6989586621681165508"><span class="hs-identifier hs-var hs-var">syn_ctxt</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#TySynCtxt"><span class="hs-identifier hs-var">TySynCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165497"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-3943"></span><span>    </span><span id="local-6989586621681165497"><span class="annot"><span class="annottext">name :: Name
</span><a href="#local-6989586621681165497"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Name
</span><a href="GHC.Core.TyCon.html#tyConName"><span class="hs-identifier hs-var hs-var">tyConName</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165516"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-3944"></span><span>    </span><span id="local-6989586621681165488"><span class="annot"><span class="annottext">data_cons :: [DataCon]
</span><a href="#local-6989586621681165488"><span class="hs-identifier hs-var hs-var">data_cons</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [DataCon]
</span><a href="GHC.Core.TyCon.html#tyConDataCons"><span class="hs-identifier hs-var">tyConDataCons</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165516"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-3945"></span><span>
</span><span id="line-3946"></span><span>    </span><span id="local-6989586621681165484"><span class="annot"><span class="annottext">groups :: [NonEmpty (FieldLabel, DataCon)]
</span><a href="#local-6989586621681165484"><span class="hs-identifier hs-var hs-var">groups</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((FieldLabel, DataCon) -&gt; (FieldLabel, DataCon) -&gt; Ordering)
-&gt; [(FieldLabel, DataCon)] -&gt; [NonEmpty (FieldLabel, DataCon)]
forall a. (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; [NonEmpty a]
</span><a href="GHC.Data.List.SetOps.html#equivClasses"><span class="hs-identifier hs-var">equivClasses</span></a></span><span> </span><span class="annot"><span class="annottext">(FieldLabel, DataCon) -&gt; (FieldLabel, DataCon) -&gt; Ordering
forall {a} {b} {a} {b}.
(FieldLbl a, b) -&gt; (FieldLbl a, b) -&gt; Ordering
</span><a href="#local-6989586621681165480"><span class="hs-identifier hs-var">cmp_fld</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(DataCon -&gt; [(FieldLabel, DataCon)])
-&gt; [DataCon] -&gt; [(FieldLabel, DataCon)]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><a href="../../base/src/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; [(FieldLabel, DataCon)]
</span><a href="#local-6989586621681165479"><span class="hs-identifier hs-var">get_fields</span></a></span><span> </span><span class="annot"><span class="annottext">[DataCon]
</span><a href="#local-6989586621681165488"><span class="hs-identifier hs-var">data_cons</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3947"></span><span>    </span><span id="local-6989586621681165480"><span class="annot"><span class="annottext">cmp_fld :: (FieldLbl a, b) -&gt; (FieldLbl a, b) -&gt; Ordering
</span><a href="#local-6989586621681165480"><span class="hs-identifier hs-var hs-var">cmp_fld</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681165476"><span class="annot"><span class="annottext">FieldLbl a
</span><a href="#local-6989586621681165476"><span class="hs-identifier hs-var">f1</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681165475"><span class="annot"><span class="annottext">FieldLbl a
</span><a href="#local-6989586621681165475"><span class="hs-identifier hs-var">f2</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FieldLbl a -&gt; FieldLabelString
forall a. FieldLbl a -&gt; FieldLabelString
</span><a href="GHC.Types.FieldLabel.html#flLabel"><span class="hs-identifier hs-var hs-var">flLabel</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLbl a
</span><a href="#local-6989586621681165476"><span class="hs-identifier hs-var">f1</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabelString -&gt; FieldLabelString -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-operator hs-var">`compare`</span></span><span> </span><span class="annot"><span class="annottext">FieldLbl a -&gt; FieldLabelString
forall a. FieldLbl a -&gt; FieldLabelString
</span><a href="GHC.Types.FieldLabel.html#flLabel"><span class="hs-identifier hs-var hs-var">flLabel</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLbl a
</span><a href="#local-6989586621681165475"><span class="hs-identifier hs-var">f2</span></a></span><span>
</span><span id="line-3948"></span><span>    </span><span id="local-6989586621681165479"><span class="annot"><span class="annottext">get_fields :: DataCon -&gt; [(FieldLabel, DataCon)]
</span><a href="#local-6989586621681165479"><span class="hs-identifier hs-var hs-var">get_fields</span></a></span></span><span> </span><span id="local-6989586621681165472"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165472"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; [FieldLabel]
</span><a href="GHC.Core.DataCon.html#dataConFieldLabels"><span class="hs-identifier hs-var">dataConFieldLabels</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165472"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldLabel] -&gt; [DataCon] -&gt; [(FieldLabel, DataCon)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../../base/src/GHC.List.html#zip"><span class="hs-operator hs-var">`zip`</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; [DataCon]
forall a. a -&gt; [a]
</span><a href="../../base/src/GHC.List.html#repeat"><span class="hs-identifier hs-var">repeat</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165472"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-3949"></span><span>        </span><span class="hs-comment">-- dataConFieldLabels may return the empty list, which is fine</span><span>
</span><span id="line-3950"></span><span>
</span><span id="line-3951"></span><span>    </span><span class="hs-comment">-- See Note [GADT record selectors] in GHC.Tc.TyCl.Utils</span><span>
</span><span id="line-3952"></span><span>    </span><span class="hs-comment">-- We must check (a) that the named field has the same</span><span>
</span><span id="line-3953"></span><span>    </span><span class="hs-comment">--                   type in each constructor</span><span>
</span><span id="line-3954"></span><span>    </span><span class="hs-comment">--               (b) that those constructors have the same result type</span><span>
</span><span id="line-3955"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-3956"></span><span>    </span><span class="hs-comment">-- However, the constructors may have differently named type variable</span><span>
</span><span id="line-3957"></span><span>    </span><span class="hs-comment">-- and (worse) we don't know how the correspond to each other.  E.g.</span><span>
</span><span id="line-3958"></span><span>    </span><span class="hs-comment">--     C1 :: forall a b. { f :: a, g :: b } -&gt; T a b</span><span>
</span><span id="line-3959"></span><span>    </span><span class="hs-comment">--     C2 :: forall d c. { f :: c, g :: c } -&gt; T c d</span><span>
</span><span id="line-3960"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-3961"></span><span>    </span><span class="hs-comment">-- So what we do is to ust Unify.tcMatchTys to compare the first candidate's</span><span>
</span><span id="line-3962"></span><span>    </span><span class="hs-comment">-- result type against other candidates' types BOTH WAYS ROUND.</span><span>
</span><span id="line-3963"></span><span>    </span><span class="hs-comment">-- If they magically agrees, take the substitution and</span><span>
</span><span id="line-3964"></span><span>    </span><span class="hs-comment">-- apply them to the latter ones, and see if they match perfectly.</span><span>
</span><span id="line-3965"></span><span>    </span><span id="local-6989586621681165485"><span class="annot"><span class="annottext">check_fields :: NonEmpty (FieldLbl a, DataCon) -&gt; TcRn ()
</span><a href="#local-6989586621681165485"><span class="hs-identifier hs-var hs-var">check_fields</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621681165466"><span class="annot"><span class="annottext">FieldLbl a
</span><a href="#local-6989586621681165466"><span class="hs-keyword hs-var">label</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681165465"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165465"><span class="hs-identifier hs-var">con1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="../../base/src/GHC.Base.html#%3A%7C"><span class="hs-operator hs-type">:|</span></a></span><span> </span><span id="local-6989586621681165464"><span class="annot"><span class="annottext">[(FieldLbl a, DataCon)]
</span><a href="#local-6989586621681165464"><span class="hs-identifier hs-var">other_fields</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-3966"></span><span>        </span><span class="hs-comment">-- These fields all have the same name, but are from</span><span>
</span><span id="line-3967"></span><span>        </span><span class="hs-comment">-- different constructors in the data type</span><span>
</span><span id="line-3968"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRn () -&gt; TcRn () -&gt; TcRn ()
forall r. TcRn r -&gt; TcRn r -&gt; TcRn r
</span><a href="GHC.Tc.Utils.Monad.html#recoverM"><span class="hs-identifier hs-var">recoverM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcRn ()) -&gt; TcRn () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">((FieldLbl a, DataCon) -&gt; TcRn ())
-&gt; [(FieldLbl a, DataCon)] -&gt; TcRn ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><a href="../../base/src/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a></span><span> </span><span class="annot"><span class="annottext">(FieldLbl a, DataCon) -&gt; TcRn ()
</span><a href="#local-6989586621681165463"><span class="hs-identifier hs-var">checkOne</span></a></span><span> </span><span class="annot"><span class="annottext">[(FieldLbl a, DataCon)]
</span><a href="#local-6989586621681165464"><span class="hs-identifier hs-var">other_fields</span></a></span><span>
</span><span id="line-3969"></span><span>                </span><span class="hs-comment">-- Check that all the fields in the group have the same type</span><span>
</span><span id="line-3970"></span><span>                </span><span class="hs-comment">-- NB: this check assumes that all the constructors of a given</span><span>
</span><span id="line-3971"></span><span>                </span><span class="hs-comment">-- data type use the same type variables</span><span>
</span><span id="line-3972"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-3973"></span><span>        </span><span id="local-6989586621681165462"><span class="annot"><span class="annottext">res1 :: Type
</span><a href="#local-6989586621681165462"><span class="hs-identifier hs-var hs-var">res1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Type
</span><a href="GHC.Core.DataCon.html#dataConOrigResTy"><span class="hs-identifier hs-var">dataConOrigResTy</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165465"><span class="hs-identifier hs-var">con1</span></a></span><span>
</span><span id="line-3974"></span><span>        </span><span id="local-6989586621681165460"><span class="annot"><span class="annottext">fty1 :: Type
</span><a href="#local-6989586621681165460"><span class="hs-identifier hs-var hs-var">fty1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; FieldLabelString -&gt; Type
</span><a href="GHC.Core.DataCon.html#dataConFieldType"><span class="hs-identifier hs-var">dataConFieldType</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165465"><span class="hs-identifier hs-var">con1</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621681165458"><span class="hs-identifier hs-var">lbl</span></a></span><span>
</span><span id="line-3975"></span><span>        </span><span id="local-6989586621681165458"><span class="annot"><span class="annottext">lbl :: FieldLabelString
</span><a href="#local-6989586621681165458"><span class="hs-identifier hs-var hs-var">lbl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FieldLbl a -&gt; FieldLabelString
forall a. FieldLbl a -&gt; FieldLabelString
</span><a href="GHC.Types.FieldLabel.html#flLabel"><span class="hs-identifier hs-var hs-var">flLabel</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLbl a
</span><a href="#local-6989586621681165466"><span class="hs-keyword hs-var">label</span></a></span><span>
</span><span id="line-3976"></span><span>
</span><span id="line-3977"></span><span>        </span><span id="local-6989586621681165463"><span class="annot"><span class="annottext">checkOne :: (FieldLbl a, DataCon) -&gt; TcRn ()
</span><a href="#local-6989586621681165463"><span class="hs-identifier hs-var hs-var">checkOne</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldLbl a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681165457"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165457"><span class="hs-identifier hs-var">con2</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-comment">-- Do it both ways to ensure they are structurally identical</span><span>
</span><span id="line-3978"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">FieldLabelString
-&gt; DataCon -&gt; DataCon -&gt; Type -&gt; Type -&gt; Type -&gt; Type -&gt; TcRn ()
</span><a href="GHC.Tc.TyCl.html#checkFieldCompat"><span class="hs-identifier hs-var">checkFieldCompat</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621681165458"><span class="hs-identifier hs-var">lbl</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165465"><span class="hs-identifier hs-var">con1</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165457"><span class="hs-identifier hs-var">con2</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165462"><span class="hs-identifier hs-var">res1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165455"><span class="hs-identifier hs-var">res2</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165460"><span class="hs-identifier hs-var">fty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165454"><span class="hs-identifier hs-var">fty2</span></a></span><span>
</span><span id="line-3979"></span><span>                 </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">FieldLabelString
-&gt; DataCon -&gt; DataCon -&gt; Type -&gt; Type -&gt; Type -&gt; Type -&gt; TcRn ()
</span><a href="GHC.Tc.TyCl.html#checkFieldCompat"><span class="hs-identifier hs-var">checkFieldCompat</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621681165458"><span class="hs-identifier hs-var">lbl</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165457"><span class="hs-identifier hs-var">con2</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165465"><span class="hs-identifier hs-var">con1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165455"><span class="hs-identifier hs-var">res2</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165462"><span class="hs-identifier hs-var">res1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165454"><span class="hs-identifier hs-var">fty2</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165460"><span class="hs-identifier hs-var">fty1</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-3980"></span><span>            </span><span class="hs-keyword">where</span><span>
</span><span id="line-3981"></span><span>                </span><span id="local-6989586621681165455"><span class="annot"><span class="annottext">res2 :: Type
</span><a href="#local-6989586621681165455"><span class="hs-identifier hs-var hs-var">res2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Type
</span><a href="GHC.Core.DataCon.html#dataConOrigResTy"><span class="hs-identifier hs-var">dataConOrigResTy</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165457"><span class="hs-identifier hs-var">con2</span></a></span><span>
</span><span id="line-3982"></span><span>                </span><span id="local-6989586621681165454"><span class="annot"><span class="annottext">fty2 :: Type
</span><a href="#local-6989586621681165454"><span class="hs-identifier hs-var hs-var">fty2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; FieldLabelString -&gt; Type
</span><a href="GHC.Core.DataCon.html#dataConFieldType"><span class="hs-identifier hs-var">dataConFieldType</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165457"><span class="hs-identifier hs-var">con2</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621681165458"><span class="hs-identifier hs-var">lbl</span></a></span><span>
</span><span id="line-3983"></span><span>
</span><span id="line-3984"></span><span class="annot"><a href="GHC.Tc.TyCl.html#checkPartialRecordField"><span class="hs-identifier hs-type">checkPartialRecordField</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.FieldLabel.html#FieldLabel"><span class="hs-identifier hs-type">FieldLabel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-3985"></span><span class="hs-comment">-- Checks the partial record field selector, and warns.</span><span>
</span><span id="line-3986"></span><span class="hs-comment">-- See Note [Checking partial record field]</span><span>
</span><span id="line-3987"></span><span id="checkPartialRecordField"><span class="annot"><span class="annottext">checkPartialRecordField :: [DataCon] -&gt; FieldLabel -&gt; TcRn ()
</span><a href="GHC.Tc.TyCl.html#checkPartialRecordField"><span class="hs-identifier hs-var hs-var">checkPartialRecordField</span></a></span></span><span> </span><span id="local-6989586621681165453"><span class="annot"><span class="annottext">[DataCon]
</span><a href="#local-6989586621681165453"><span class="hs-identifier hs-var">all_cons</span></a></span></span><span> </span><span id="local-6989586621681165452"><span class="annot"><span class="annottext">FieldLabel
</span><a href="#local-6989586621681165452"><span class="hs-identifier hs-var">fld</span></a></span></span><span>
</span><span id="line-3988"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcRn () -&gt; TcRn ()
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681165451"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcRn ()) -&gt; TcRn () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-3989"></span><span>      </span><span class="annot"><span class="annottext">WarningFlag -&gt; Bool -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#warnIfFlag"><span class="hs-identifier hs-var">warnIfFlag</span></a></span><span> </span><span class="annot"><span class="annottext">WarningFlag
</span><a href="GHC.Driver.Flags.html#Opt_WarnPartialFields"><span class="hs-identifier hs-var">Opt_WarnPartialFields</span></a></span><span>
</span><span id="line-3990"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681165448"><span class="hs-identifier hs-var">is_exhaustive</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OccName -&gt; Bool
</span><a href="GHC.Types.Name.Occurrence.html#startsWithUnderscore"><span class="hs-identifier hs-var">startsWithUnderscore</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621681165446"><span class="hs-identifier hs-var">occ_name</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3991"></span><span>        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Use of partial record field selector&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#colon"><span class="hs-identifier hs-var">colon</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-3992"></span><span>              </span><span class="annot"><span class="annottext">Arity -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc) -&gt; SDoc -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OccName -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621681165446"><span class="hs-identifier hs-var">occ_name</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-3993"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-3994"></span><span>    </span><span id="local-6989586621681165443"><span class="annot"><span class="annottext">sel_name :: Name
</span><a href="#local-6989586621681165443"><span class="hs-identifier hs-var hs-var">sel_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FieldLabel -&gt; Name
forall a. FieldLbl a -&gt; a
</span><a href="GHC.Types.FieldLabel.html#flSelector"><span class="hs-identifier hs-var hs-var">flSelector</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabel
</span><a href="#local-6989586621681165452"><span class="hs-identifier hs-var">fld</span></a></span><span>
</span><span id="line-3995"></span><span>    </span><span id="local-6989586621681165451"><span class="annot"><span class="annottext">loc :: SrcSpan
</span><a href="#local-6989586621681165451"><span class="hs-identifier hs-var hs-var">loc</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; SrcSpan
forall a. NamedThing a =&gt; a -&gt; SrcSpan
</span><a href="GHC.Types.Name.html#getSrcSpan"><span class="hs-identifier hs-var">getSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165443"><span class="hs-identifier hs-var">sel_name</span></a></span><span>
</span><span id="line-3996"></span><span>    </span><span id="local-6989586621681165446"><span class="annot"><span class="annottext">occ_name :: OccName
</span><a href="#local-6989586621681165446"><span class="hs-identifier hs-var hs-var">occ_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; OccName
forall a. NamedThing a =&gt; a -&gt; OccName
</span><a href="GHC.Types.Name.html#getOccName"><span class="hs-identifier hs-var">getOccName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165443"><span class="hs-identifier hs-var">sel_name</span></a></span><span>
</span><span id="line-3997"></span><span>
</span><span id="line-3998"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681165441"><span class="annot"><span class="annottext">[DataCon]
</span><a href="#local-6989586621681165441"><span class="hs-identifier hs-var">cons_with_field</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681165440"><span class="annot"><span class="annottext">[DataCon]
</span><a href="#local-6989586621681165440"><span class="hs-identifier hs-var">cons_without_field</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DataCon -&gt; Bool) -&gt; [DataCon] -&gt; ([DataCon], [DataCon])
forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><a href="../../base/src/Data.OldList.html#partition"><span class="hs-identifier hs-var">partition</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Bool
</span><a href="#local-6989586621681165438"><span class="hs-identifier hs-var">has_field</span></a></span><span> </span><span class="annot"><span class="annottext">[DataCon]
</span><a href="#local-6989586621681165453"><span class="hs-identifier hs-var">all_cons</span></a></span><span>
</span><span id="line-3999"></span><span>    </span><span id="local-6989586621681165438"><span class="annot"><span class="annottext">has_field :: DataCon -&gt; Bool
</span><a href="#local-6989586621681165438"><span class="hs-identifier hs-var hs-var">has_field</span></a></span></span><span> </span><span id="local-6989586621681165437"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165437"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FieldLabel
</span><a href="#local-6989586621681165452"><span class="hs-identifier hs-var">fld</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabel -&gt; [FieldLabel] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#elem"><span class="hs-operator hs-var">`elem`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; [FieldLabel]
</span><a href="GHC.Core.DataCon.html#dataConFieldLabels"><span class="hs-identifier hs-var">dataConFieldLabels</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165437"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4000"></span><span>    </span><span id="local-6989586621681165448"><span class="annot"><span class="annottext">is_exhaustive :: Bool
</span><a href="#local-6989586621681165448"><span class="hs-identifier hs-var hs-var">is_exhaustive</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DataCon -&gt; Bool) -&gt; [DataCon] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#all"><span class="hs-identifier hs-var">all</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Type] -&gt; DataCon -&gt; Bool
</span><a href="GHC.Core.DataCon.html#dataConCannotMatch"><span class="hs-identifier hs-var">dataConCannotMatch</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681165435"><span class="hs-identifier hs-var">inst_tys</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[DataCon]
</span><a href="#local-6989586621681165440"><span class="hs-identifier hs-var">cons_without_field</span></a></span><span>
</span><span id="line-4001"></span><span>
</span><span id="line-4002"></span><span>    </span><span id="local-6989586621681165434"><span class="annot"><span class="annottext">con1 :: DataCon
</span><a href="#local-6989586621681165434"><span class="hs-identifier hs-var hs-var">con1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">null</span><span> </span><span class="hs-identifier">cons_with_field</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-identifier">head</span><span> </span><span class="hs-identifier">cons_with_field</span><span>
</span><span id="line-4003"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681165433"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165433"><span class="hs-identifier hs-var">univ_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681165432"><span class="annot"><span class="annottext">[EqSpec]
</span><a href="#local-6989586621681165432"><span class="hs-identifier hs-var">eq_spec</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon
-&gt; ([TyVar], [TyVar], [EqSpec], [Type], [Scaled Type], Type)
</span><a href="GHC.Core.DataCon.html#dataConFullSig"><span class="hs-identifier hs-var">dataConFullSig</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165434"><span class="hs-identifier hs-var">con1</span></a></span><span>
</span><span id="line-4004"></span><span>    </span><span id="local-6989586621681165430"><span class="annot"><span class="annottext">eq_subst :: TCvSubst
</span><a href="#local-6989586621681165430"><span class="hs-identifier hs-var hs-var">eq_subst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(TyVar, Type)] -&gt; TCvSubst
</span><a href="GHC.Core.TyCo.Subst.html#mkTvSubstPrs"><span class="hs-identifier hs-var">mkTvSubstPrs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(EqSpec -&gt; (TyVar, Type)) -&gt; [EqSpec] -&gt; [(TyVar, Type)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">EqSpec -&gt; (TyVar, Type)
</span><a href="GHC.Core.DataCon.html#eqSpecPair"><span class="hs-identifier hs-var">eqSpecPair</span></a></span><span> </span><span class="annot"><span class="annottext">[EqSpec]
</span><a href="#local-6989586621681165432"><span class="hs-identifier hs-var">eq_spec</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4005"></span><span>    </span><span id="local-6989586621681165435"><span class="annot"><span class="annottext">inst_tys :: [Type]
</span><a href="#local-6989586621681165435"><span class="hs-identifier hs-var hs-var">inst_tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCvSubst -&gt; [TyVar] -&gt; [Type]
</span><a href="GHC.Core.TyCo.Subst.html#substTyVars"><span class="hs-identifier hs-var">substTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681165430"><span class="hs-identifier hs-var">eq_subst</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165433"><span class="hs-identifier hs-var">univ_tvs</span></a></span><span>
</span><span id="line-4006"></span><span>
</span><span id="line-4007"></span><span class="annot"><a href="GHC.Tc.TyCl.html#checkFieldCompat"><span class="hs-identifier hs-type">checkFieldCompat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.FieldLabel.html#FieldLabelString"><span class="hs-identifier hs-type">FieldLabelString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span>
</span><span id="line-4008"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-4009"></span><span id="checkFieldCompat"><span class="annot"><span class="annottext">checkFieldCompat :: FieldLabelString
-&gt; DataCon -&gt; DataCon -&gt; Type -&gt; Type -&gt; Type -&gt; Type -&gt; TcRn ()
</span><a href="GHC.Tc.TyCl.html#checkFieldCompat"><span class="hs-identifier hs-var hs-var">checkFieldCompat</span></a></span></span><span> </span><span id="local-6989586621681165426"><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621681165426"><span class="hs-identifier hs-var">fld</span></a></span></span><span> </span><span id="local-6989586621681165425"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165425"><span class="hs-identifier hs-var">con1</span></a></span></span><span> </span><span id="local-6989586621681165424"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165424"><span class="hs-identifier hs-var">con2</span></a></span></span><span> </span><span id="local-6989586621681165423"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165423"><span class="hs-identifier hs-var">res1</span></a></span></span><span> </span><span id="local-6989586621681165422"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165422"><span class="hs-identifier hs-var">res2</span></a></span></span><span> </span><span id="local-6989586621681165421"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165421"><span class="hs-identifier hs-var">fty1</span></a></span></span><span> </span><span id="local-6989586621681165420"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165420"><span class="hs-identifier hs-var">fty2</span></a></span></span><span>
</span><span id="line-4010"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe TCvSubst -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../../base/src/Data.Maybe.html#isJust"><span class="hs-identifier hs-var">isJust</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TCvSubst
</span><a href="#local-6989586621681165419"><span class="hs-identifier hs-var">mb_subst1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldLabelString -&gt; DataCon -&gt; DataCon -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#resultTypeMisMatch"><span class="hs-identifier hs-var">resultTypeMisMatch</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621681165426"><span class="hs-identifier hs-var">fld</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165425"><span class="hs-identifier hs-var">con1</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165424"><span class="hs-identifier hs-var">con2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4011"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe TCvSubst -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../../base/src/Data.Maybe.html#isJust"><span class="hs-identifier hs-var">isJust</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TCvSubst
</span><a href="#local-6989586621681165417"><span class="hs-identifier hs-var">mb_subst2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldLabelString -&gt; DataCon -&gt; DataCon -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#fieldTypeMisMatch"><span class="hs-identifier hs-var">fieldTypeMisMatch</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621681165426"><span class="hs-identifier hs-var">fld</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165425"><span class="hs-identifier hs-var">con1</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165424"><span class="hs-identifier hs-var">con2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-4012"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-4013"></span><span>    </span><span id="local-6989586621681165419"><span class="annot"><span class="annottext">mb_subst1 :: Maybe TCvSubst
</span><a href="#local-6989586621681165419"><span class="hs-identifier hs-var hs-var">mb_subst1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Maybe TCvSubst
</span><a href="GHC.Core.Unify.html#tcMatchTy"><span class="hs-identifier hs-var">tcMatchTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165423"><span class="hs-identifier hs-var">res1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165422"><span class="hs-identifier hs-var">res2</span></a></span><span>
</span><span id="line-4014"></span><span>    </span><span id="local-6989586621681165417"><span class="annot"><span class="annottext">mb_subst2 :: Maybe TCvSubst
</span><a href="#local-6989586621681165417"><span class="hs-identifier hs-var hs-var">mb_subst2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCvSubst -&gt; Type -&gt; Type -&gt; Maybe TCvSubst
</span><a href="GHC.Core.Unify.html#tcMatchTyX"><span class="hs-identifier hs-var">tcMatchTyX</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Maybe TCvSubst -&gt; TCvSubst
forall a. HasCallStack =&gt; String -&gt; Maybe a -&gt; a
</span><a href="GHC.Data.Maybe.html#expectJust"><span class="hs-identifier hs-var">expectJust</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;checkFieldCompat&quot;</span></span><span> </span><span class="annot"><span class="annottext">Maybe TCvSubst
</span><a href="#local-6989586621681165419"><span class="hs-identifier hs-var">mb_subst1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165421"><span class="hs-identifier hs-var">fty1</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165420"><span class="hs-identifier hs-var">fty2</span></a></span><span>
</span><span id="line-4015"></span><span>
</span><span id="line-4016"></span><span class="hs-comment">-------------------------------</span><span>
</span><span id="line-4017"></span><span class="annot"><a href="GHC.Tc.TyCl.html#checkValidDataCon"><span class="hs-identifier hs-type">checkValidDataCon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-4018"></span><span id="checkValidDataCon"><span class="annot"><span class="annottext">checkValidDataCon :: DynFlags -&gt; Bool -&gt; TyCon -&gt; DataCon -&gt; TcRn ()
</span><a href="GHC.Tc.TyCl.html#checkValidDataCon"><span class="hs-identifier hs-var hs-var">checkValidDataCon</span></a></span></span><span> </span><span id="local-6989586621681165413"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681165413"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621681165412"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681165412"><span class="hs-identifier hs-var">existential_ok</span></a></span></span><span> </span><span id="local-6989586621681165411"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165411"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621681165410"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165410"><span class="hs-identifier hs-var">con</span></a></span></span><span>
</span><span id="line-4019"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcRn () -&gt; TcRn ()
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; SrcSpan
forall a. NamedThing a =&gt; a -&gt; SrcSpan
</span><a href="GHC.Types.Name.html#getSrcSpan"><span class="hs-identifier hs-var">getSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165410"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span>  </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcRn ()) -&gt; TcRn () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-4020"></span><span>    </span><span class="annot"><span class="annottext">SDoc -&gt; TcRn () -&gt; TcRn ()
forall a. SDoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#dataConCtxt"><span class="hs-identifier hs-var">dataConCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165410"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcRn ()) -&gt; TcRn () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-4021"></span><span>    </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- Check that the return type of the data constructor</span><span>
</span><span id="line-4022"></span><span>          </span><span class="hs-comment">-- matches the type constructor; eg reject this:</span><span>
</span><span id="line-4023"></span><span>          </span><span class="hs-comment">--   data T a where { MkT :: Bogus a }</span><span>
</span><span id="line-4024"></span><span>          </span><span class="hs-comment">-- It's important to do this first:</span><span>
</span><span id="line-4025"></span><span>          </span><span class="hs-comment">--  see Note [Checking GADT return types]</span><span>
</span><span id="line-4026"></span><span>          </span><span class="hs-comment">--  and c.f. Note [Check role annotations in a second pass]</span><span>
</span><span id="line-4027"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681165408"><span class="annot"><span class="annottext">tc_tvs :: [TyVar]
</span><a href="#local-6989586621681165408"><span class="hs-identifier hs-var hs-var">tc_tvs</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [TyVar]
</span><a href="GHC.Core.TyCon.html#tyConTyVars"><span class="hs-identifier hs-var hs-var">tyConTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165411"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-4028"></span><span>              </span><span id="local-6989586621681165407"><span class="annot"><span class="annottext">res_ty_tmpl :: Type
</span><a href="#local-6989586621681165407"><span class="hs-identifier hs-var hs-var">res_ty_tmpl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Type.html#mkFamilyTyConApp"><span class="hs-identifier hs-var">mkFamilyTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165411"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyVar] -&gt; [Type]
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165408"><span class="hs-identifier hs-var">tc_tvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4029"></span><span>              </span><span id="local-6989586621681165405"><span class="annot"><span class="annottext">orig_res_ty :: Type
</span><a href="#local-6989586621681165405"><span class="hs-identifier hs-var hs-var">orig_res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Type
</span><a href="GHC.Core.DataCon.html#dataConOrigResTy"><span class="hs-identifier hs-var">dataConOrigResTy</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165410"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-4030"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;checkValidDataCon&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-4031"></span><span>              </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165410"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165411"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165408"><span class="hs-identifier hs-var">tc_tvs</span></a></span><span>
</span><span id="line-4032"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165407"><span class="hs-identifier hs-var">res_ty_tmpl</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
Type -&gt; Type
</span><a href="GHC.Core.Type.html#tcTypeKind"><span class="hs-identifier hs-var">tcTypeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165407"><span class="hs-identifier hs-var">res_ty_tmpl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4033"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165405"><span class="hs-identifier hs-var">orig_res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
Type -&gt; Type
</span><a href="GHC.Core.Type.html#tcTypeKind"><span class="hs-identifier hs-var">tcTypeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165405"><span class="hs-identifier hs-var">orig_res_ty</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-4034"></span><span>
</span><span id="line-4035"></span><span>
</span><span id="line-4036"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe TCvSubst -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../../base/src/Data.Maybe.html#isJust"><span class="hs-identifier hs-var">isJust</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Maybe TCvSubst
</span><a href="GHC.Core.Unify.html#tcMatchTyKi"><span class="hs-identifier hs-var">tcMatchTyKi</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165407"><span class="hs-identifier hs-var">res_ty_tmpl</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165405"><span class="hs-identifier hs-var">orig_res_ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-4037"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; Type -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#badDataConTyCon"><span class="hs-identifier hs-var">badDataConTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165410"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165407"><span class="hs-identifier hs-var">res_ty_tmpl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4038"></span><span>            </span><span class="hs-comment">-- Note that checkTc aborts if it finds an error. This is</span><span>
</span><span id="line-4039"></span><span>            </span><span class="hs-comment">-- critical to avoid panicking when we call dataConDisplayType</span><span>
</span><span id="line-4040"></span><span>            </span><span class="hs-comment">-- on an un-rejiggable datacon!</span><span>
</span><span id="line-4041"></span><span>            </span><span class="hs-comment">-- Also NB that we match the *kind* as well as the *type* (#18357)</span><span>
</span><span id="line-4042"></span><span>            </span><span class="hs-comment">-- However, if the kind is the only thing that doesn't match, the</span><span>
</span><span id="line-4043"></span><span>            </span><span class="hs-comment">-- error message is terrible.  E.g. test T18357b</span><span>
</span><span id="line-4044"></span><span>            </span><span class="hs-comment">--    type family Star where Star = Type</span><span>
</span><span id="line-4045"></span><span>            </span><span class="hs-comment">--    newtype T :: Type where MkT :: Int -&gt; (T :: Star)</span><span>
</span><span id="line-4046"></span><span>
</span><span id="line-4047"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;checkValidDataCon 2&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165401"><span class="hs-identifier hs-var">data_con_display_type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4048"></span><span>
</span><span id="line-4049"></span><span>          </span><span class="hs-comment">-- Check that the result type is a *monotype*</span><span>
</span><span id="line-4050"></span><span>          </span><span class="hs-comment">--  e.g. reject this:   MkT :: T (forall a. a-&gt;a)</span><span>
</span><span id="line-4051"></span><span>          </span><span class="hs-comment">-- Reason: it's really the argument of an equality constraint</span><span>
</span><span id="line-4052"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcRn ()
</span><a href="GHC.Tc.Validity.html#checkValidMonoType"><span class="hs-identifier hs-var">checkValidMonoType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165405"><span class="hs-identifier hs-var">orig_res_ty</span></a></span><span>
</span><span id="line-4053"></span><span>
</span><span id="line-4054"></span><span>          </span><span class="hs-comment">-- If we are dealing with a newtype, we allow levity polymorphism</span><span>
</span><span id="line-4055"></span><span>          </span><span class="hs-comment">-- regardless of whether or not UnliftedNewtypes is enabled. A</span><span>
</span><span id="line-4056"></span><span>          </span><span class="hs-comment">-- later check in checkNewDataCon handles this, producing a</span><span>
</span><span id="line-4057"></span><span>          </span><span class="hs-comment">-- better error message than checkForLevPoly would.</span><span>
</span><span id="line-4058"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRn () -&gt; TcRn ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base/src/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isNewTyCon"><span class="hs-identifier hs-var">isNewTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165411"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4059"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Type -&gt; TcRn ()) -&gt; [Type] -&gt; TcRn ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><a href="../../base/src/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; Type -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.TcMType.html#checkForLevPoly"><span class="hs-identifier hs-var">checkForLevPoly</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Scaled Type -&gt; Type) -&gt; [Scaled Type] -&gt; [Type]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled Type -&gt; Type
forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">([Scaled Type] -&gt; [Type]) -&gt; [Scaled Type] -&gt; [Type]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; [Scaled Type]
</span><a href="GHC.Core.DataCon.html#dataConOrigArgTys"><span class="hs-identifier hs-var">dataConOrigArgTys</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165410"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-4060"></span><span>
</span><span id="line-4061"></span><span>          </span><span class="hs-comment">-- Extra checks for newtype data constructors. Importantly, these</span><span>
</span><span id="line-4062"></span><span>          </span><span class="hs-comment">-- checks /must/ come before the call to checkValidType below. This</span><span>
</span><span id="line-4063"></span><span>          </span><span class="hs-comment">-- is because checkValidType invokes the constraint solver, and</span><span>
</span><span id="line-4064"></span><span>          </span><span class="hs-comment">-- invoking the solver on an ill formed newtype constructor can</span><span>
</span><span id="line-4065"></span><span>          </span><span class="hs-comment">-- confuse GHC to the point of panicking. See #17955 for an example.</span><span>
</span><span id="line-4066"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRn () -&gt; TcRn ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isNewTyCon"><span class="hs-identifier hs-var">isNewTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165411"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; TcRn ()
</span><a href="GHC.Tc.TyCl.html#checkNewDataCon"><span class="hs-identifier hs-var">checkNewDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165410"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4067"></span><span>
</span><span id="line-4068"></span><span>          </span><span class="hs-comment">-- Check all argument types for validity</span><span>
</span><span id="line-4069"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt -&gt; Type -&gt; TcRn ()
</span><a href="GHC.Tc.Validity.html#checkValidType"><span class="hs-identifier hs-var">checkValidType</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="#local-6989586621681165394"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165401"><span class="hs-identifier hs-var">data_con_display_type</span></a></span><span>
</span><span id="line-4070"></span><span>
</span><span id="line-4071"></span><span>          </span><span class="hs-comment">-- Check that existentials are allowed if they are used</span><span>
</span><span id="line-4072"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681165412"><span class="hs-identifier hs-var">existential_ok</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Bool
</span><a href="GHC.Core.DataCon.html#isVanillaDataCon"><span class="hs-identifier hs-var">isVanillaDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165410"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4073"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#badExistential"><span class="hs-identifier hs-var">badExistential</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165410"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4074"></span><span>
</span><span id="line-4075"></span><span>          </span><span class="hs-comment">-- Check that UNPACK pragmas and bangs work out</span><span>
</span><span id="line-4076"></span><span>          </span><span class="hs-comment">-- E.g.  reject   data T = MkT {-# UNPACK #-} Int     -- No &quot;!&quot;</span><span>
</span><span id="line-4077"></span><span>          </span><span class="hs-comment">--                data T = MkT {-# UNPACK #-} !a      -- Can't unpack</span><span>
</span><span id="line-4078"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(HsSrcBang -&gt; HsImplBang -&gt; Arity -&gt; TcRn ())
-&gt; [HsSrcBang] -&gt; [HsImplBang] -&gt; [Arity] -&gt; TcRn ()
forall (m :: * -&gt; *) a b c d.
Monad m =&gt;
(a -&gt; b -&gt; c -&gt; m d) -&gt; [a] -&gt; [b] -&gt; [c] -&gt; m ()
</span><a href="GHC.Utils.Monad.html#zipWith3M_"><span class="hs-identifier hs-var">zipWith3M_</span></a></span><span> </span><span class="annot"><span class="annottext">HsSrcBang -&gt; HsImplBang -&gt; Arity -&gt; TcRn ()
</span><a href="#local-6989586621681165390"><span class="hs-identifier hs-var">check_bang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; [HsSrcBang]
</span><a href="GHC.Core.DataCon.html#dataConSrcBangs"><span class="hs-identifier hs-var">dataConSrcBangs</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165410"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; [HsImplBang]
</span><a href="GHC.Core.DataCon.html#dataConImplBangs"><span class="hs-identifier hs-var">dataConImplBangs</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165410"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">1</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span>
</span><span id="line-4079"></span><span>
</span><span id="line-4080"></span><span>          </span><span class="hs-comment">-- Check the dcUserTyVarBinders invariant</span><span>
</span><span id="line-4081"></span><span>          </span><span class="hs-comment">-- See Note [DataCon user type variable binders] in GHC.Core.DataCon</span><span>
</span><span id="line-4082"></span><span>          </span><span class="hs-comment">-- checked here because we sometimes build invalid DataCons before</span><span>
</span><span id="line-4083"></span><span>          </span><span class="hs-comment">-- erroring above here</span><span>
</span><span id="line-4084"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRn () -&gt; TcRn ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="GHC.Utils.Misc.html#debugIsOn"><span class="hs-identifier hs-var">debugIsOn</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcRn ()) -&gt; TcRn () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-4085"></span><span>          </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681165387"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165387"><span class="hs-identifier hs-var">univs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681165386"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165386"><span class="hs-identifier hs-var">exs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681165385"><span class="annot"><span class="annottext">[EqSpec]
</span><a href="#local-6989586621681165385"><span class="hs-identifier hs-var">eq_spec</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon
-&gt; ([TyVar], [TyVar], [EqSpec], [Type], [Scaled Type], Type)
</span><a href="GHC.Core.DataCon.html#dataConFullSig"><span class="hs-identifier hs-var">dataConFullSig</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165410"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-4086"></span><span>                   </span><span id="local-6989586621681165384"><span class="annot"><span class="annottext">user_tvs :: [TyVar]
</span><a href="#local-6989586621681165384"><span class="hs-identifier hs-var hs-var">user_tvs</span></a></span></span><span>                       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; [TyVar]
</span><a href="GHC.Core.DataCon.html#dataConUserTyVars"><span class="hs-identifier hs-var">dataConUserTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165410"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-4087"></span><span>                   </span><span id="local-6989586621681165382"><span class="annot"><span class="annottext">user_tvbs_invariant :: Bool
</span><a href="#local-6989586621681165382"><span class="hs-identifier hs-var hs-var">user_tvbs_invariant</span></a></span></span><span>
</span><span id="line-4088"></span><span>                     </span><span class="hs-glyph">=</span><span>    </span><span class="annot"><span class="annottext">[TyVar] -&gt; Set TyVar
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="../../containers/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">Set.fromList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[EqSpec] -&gt; [TyVar] -&gt; [TyVar]
</span><a href="GHC.Core.DataCon.html#filterEqSpec"><span class="hs-identifier hs-var">filterEqSpec</span></a></span><span> </span><span class="annot"><span class="annottext">[EqSpec]
</span><a href="#local-6989586621681165385"><span class="hs-identifier hs-var">eq_spec</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165387"><span class="hs-identifier hs-var">univs</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; [TyVar] -&gt; [TyVar]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165386"><span class="hs-identifier hs-var">exs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4089"></span><span>                       </span><span class="annot"><span class="annottext">Set TyVar -&gt; Set TyVar -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; Set TyVar
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="../../containers/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">Set.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165384"><span class="hs-identifier hs-var">user_tvs</span></a></span><span>
</span><span id="line-4090"></span><span>             </span><span class="hs-special">;</span><span> </span><span class="hs-identifier">MASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">user_tvbs_invariant</span><span>
</span><span id="line-4091"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">vcat</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">con</span><span>
</span><span id="line-4092"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">univs</span><span>
</span><span id="line-4093"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">exs</span><span>
</span><span id="line-4094"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">eq_spec</span><span>
</span><span id="line-4095"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">user_tvs</span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-4096"></span><span>
</span><span id="line-4097"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Done validity of data con&quot;</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; TcRn ()) -&gt; SDoc -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-4098"></span><span>          </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165410"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-4099"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Datacon wrapper type:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; Type
</span><a href="GHC.Core.DataCon.html#dataConWrapperType"><span class="hs-identifier hs-var">dataConWrapperType</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165410"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4100"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Datacon rep type:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; Type
</span><a href="GHC.Core.DataCon.html#dataConRepType"><span class="hs-identifier hs-var">dataConRepType</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165410"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4101"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Datacon display type:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165401"><span class="hs-identifier hs-var">data_con_display_type</span></a></span><span>
</span><span id="line-4102"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Rep typcon binders:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TyConBinder] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [TyConBinder]
</span><a href="GHC.Core.TyCon.html#tyConBinders"><span class="hs-identifier hs-var hs-var">tyConBinders</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; TyCon
</span><a href="GHC.Core.DataCon.html#dataConTyCon"><span class="hs-identifier hs-var">dataConTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165410"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-4103"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Maybe (TyCon, [Type])
</span><a href="GHC.Core.TyCon.html#tyConFamInst_maybe"><span class="hs-identifier hs-var">tyConFamInst_maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; TyCon
</span><a href="GHC.Core.DataCon.html#dataConTyCon"><span class="hs-identifier hs-var">dataConTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165410"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-4104"></span><span>                   </span><span class="annot"><span class="annottext">Maybe (TyCon, [Type])
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;not family&quot;</span></span><span>
</span><span id="line-4105"></span><span>                   </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681165374"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165374"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[TyConBinder] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [TyConBinder]
</span><a href="GHC.Core.TyCon.html#tyConBinders"><span class="hs-identifier hs-var hs-var">tyConBinders</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165374"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4106"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-4107"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-4108"></span><span>    </span><span id="local-6989586621681165394"><span class="annot"><span class="annottext">ctxt :: UserTypeCtxt
</span><a href="#local-6989586621681165394"><span class="hs-identifier hs-var hs-var">ctxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#ConArgCtxt"><span class="hs-identifier hs-var">ConArgCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; Name
</span><a href="GHC.Core.DataCon.html#dataConName"><span class="hs-identifier hs-var">dataConName</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165410"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4109"></span><span>
</span><span id="line-4110"></span><span>    </span><span class="annot"><a href="#local-6989586621681165390"><span class="hs-identifier hs-type">check_bang</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#HsSrcBang"><span class="hs-identifier hs-type">HsSrcBang</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#HsImplBang"><span class="hs-identifier hs-type">HsImplBang</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-4111"></span><span>    </span><span id="local-6989586621681165390"><span class="annot"><span class="annottext">check_bang :: HsSrcBang -&gt; HsImplBang -&gt; Arity -&gt; TcRn ()
</span><a href="#local-6989586621681165390"><span class="hs-identifier hs-var hs-var">check_bang</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.DataCon.html#HsSrcBang"><span class="hs-identifier hs-type">HsSrcBang</span></a></span><span> </span><span class="annot"><span class="annottext">SourceText
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SrcUnpackedness
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SrcStrictness
</span><a href="GHC.Core.DataCon.html#SrcLazy"><span class="hs-identifier hs-var">SrcLazy</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HsImplBang
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681165369"><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621681165369"><span class="hs-identifier hs-var">n</span></a></span></span><span>
</span><span id="line-4112"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Extension -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#xopt"><span class="hs-identifier hs-var">xopt</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><a href="../../ghc-boot-th/src/GHC.LanguageExtensions.Type.html#StrictData"><span class="hs-identifier hs-var">LangExt.StrictData</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681165413"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4113"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrTc"><span class="hs-identifier hs-var">addErrTc</span></a></span><span>
</span><span id="line-4114"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arity -&gt; SDoc -&gt; SDoc
</span><a href="#local-6989586621681165367"><span class="hs-identifier hs-var">bad_bang</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621681165369"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Lazy annotation (~) without StrictData&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-4115"></span><span>    </span><span class="annot"><a href="#local-6989586621681165390"><span class="hs-identifier hs-var">check_bang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.DataCon.html#HsSrcBang"><span class="hs-identifier hs-type">HsSrcBang</span></a></span><span> </span><span class="annot"><span class="annottext">SourceText
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681165366"><span class="annot"><span class="annottext">SrcUnpackedness
</span><a href="#local-6989586621681165366"><span class="hs-identifier hs-var">want_unpack</span></a></span></span><span> </span><span id="local-6989586621681165365"><span class="annot"><span class="annottext">SrcStrictness
</span><a href="#local-6989586621681165365"><span class="hs-identifier hs-var">strict_mark</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681165364"><span class="annot"><span class="annottext">HsImplBang
</span><a href="#local-6989586621681165364"><span class="hs-identifier hs-var">rep_bang</span></a></span></span><span> </span><span id="local-6989586621681165363"><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621681165363"><span class="hs-identifier hs-var">n</span></a></span></span><span>
</span><span id="line-4116"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">SrcUnpackedness -&gt; Bool
</span><a href="GHC.Core.DataCon.html#isSrcUnpacked"><span class="hs-identifier hs-var">isSrcUnpacked</span></a></span><span> </span><span class="annot"><span class="annottext">SrcUnpackedness
</span><a href="#local-6989586621681165366"><span class="hs-identifier hs-var">want_unpack</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681165361"><span class="hs-identifier hs-var">is_strict</span></a></span><span>
</span><span id="line-4117"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WarnReason -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addWarnTc"><span class="hs-identifier hs-var">addWarnTc</span></a></span><span> </span><span class="annot"><span class="annottext">WarnReason
</span><a href="GHC.Driver.Flags.html#NoReason"><span class="hs-identifier hs-var">NoReason</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arity -&gt; SDoc -&gt; SDoc
</span><a href="#local-6989586621681165367"><span class="hs-identifier hs-var">bad_bang</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621681165363"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;UNPACK pragma lacks '!'&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-4118"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">SrcUnpackedness -&gt; Bool
</span><a href="GHC.Core.DataCon.html#isSrcUnpacked"><span class="hs-identifier hs-var">isSrcUnpacked</span></a></span><span> </span><span class="annot"><span class="annottext">SrcUnpackedness
</span><a href="#local-6989586621681165366"><span class="hs-identifier hs-var">want_unpack</span></a></span><span>
</span><span id="line-4119"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HsImplBang
</span><a href="#local-6989586621681165364"><span class="hs-identifier hs-var">rep_bang</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#HsUnpack"><span class="hs-identifier hs-type">HsUnpack</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsImplBang
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-4120"></span><span>      </span><span class="hs-comment">-- If not optimising, we don't unpack (rep_bang is never</span><span>
</span><span id="line-4121"></span><span>      </span><span class="hs-comment">-- HsUnpack), so don't complain!  This happens, e.g., in Haddock.</span><span>
</span><span id="line-4122"></span><span>      </span><span class="hs-comment">-- See dataConSrcToImplBang.</span><span>
</span><span id="line-4123"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_OmitInterfacePragmas"><span class="hs-identifier hs-var">Opt_OmitInterfacePragmas</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681165413"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4124"></span><span>      </span><span class="hs-comment">-- When typechecking an indefinite package in Backpack, we</span><span>
</span><span id="line-4125"></span><span>      </span><span class="hs-comment">-- may attempt to UNPACK an abstract type.  The test here will</span><span>
</span><span id="line-4126"></span><span>      </span><span class="hs-comment">-- conclude that this is unusable, but it might become usable</span><span>
</span><span id="line-4127"></span><span>      </span><span class="hs-comment">-- when we actually fill in the abstract type.  As such, don't</span><span>
</span><span id="line-4128"></span><span>      </span><span class="hs-comment">-- warn in this case (it gives users the wrong idea about whether</span><span>
</span><span id="line-4129"></span><span>      </span><span class="hs-comment">-- or not UNPACK on abstract types is supported; it is!)</span><span>
</span><span id="line-4130"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Unit.State.html#homeUnitIsDefinite"><span class="hs-identifier hs-var">homeUnitIsDefinite</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681165413"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-4131"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WarnReason -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addWarnTc"><span class="hs-identifier hs-var">addWarnTc</span></a></span><span> </span><span class="annot"><span class="annottext">WarnReason
</span><a href="GHC.Driver.Flags.html#NoReason"><span class="hs-identifier hs-var">NoReason</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arity -&gt; SDoc -&gt; SDoc
</span><a href="#local-6989586621681165367"><span class="hs-identifier hs-var">bad_bang</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621681165363"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Ignoring unusable UNPACK pragma&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-4132"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-4133"></span><span>        </span><span id="local-6989586621681165361"><span class="annot"><span class="annottext">is_strict :: Bool
</span><a href="#local-6989586621681165361"><span class="hs-identifier hs-var hs-var">is_strict</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SrcStrictness
</span><a href="#local-6989586621681165365"><span class="hs-identifier hs-var">strict_mark</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-4134"></span><span>                      </span><span class="annot"><span class="annottext">SrcStrictness
</span><a href="GHC.Core.DataCon.html#NoSrcStrict"><span class="hs-identifier hs-var">NoSrcStrict</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#xopt"><span class="hs-identifier hs-var">xopt</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><a href="../../ghc-boot-th/src/GHC.LanguageExtensions.Type.html#StrictData"><span class="hs-identifier hs-var">LangExt.StrictData</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681165413"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-4135"></span><span>                      </span><span id="local-6989586621681165353"><span class="annot"><span class="annottext">SrcStrictness
</span><a href="#local-6989586621681165353"><span class="hs-identifier hs-var">bang</span></a></span></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SrcStrictness -&gt; Bool
</span><a href="GHC.Core.DataCon.html#isSrcStrict"><span class="hs-identifier hs-var">isSrcStrict</span></a></span><span> </span><span class="annot"><span class="annottext">SrcStrictness
</span><a href="#local-6989586621681165353"><span class="hs-identifier hs-var">bang</span></a></span><span>
</span><span id="line-4136"></span><span>
</span><span id="line-4137"></span><span>    </span><span class="annot"><a href="#local-6989586621681165390"><span class="hs-identifier hs-var">check_bang</span></a></span><span> </span><span class="annot"><span class="annottext">HsSrcBang
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">HsImplBang
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-4138"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-4139"></span><span>
</span><span id="line-4140"></span><span>    </span><span id="local-6989586621681165367"><span class="annot"><span class="annottext">bad_bang :: Arity -&gt; SDoc -&gt; SDoc
</span><a href="#local-6989586621681165367"><span class="hs-identifier hs-var hs-var">bad_bang</span></a></span></span><span> </span><span id="local-6989586621681165351"><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621681165351"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681165350"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681165350"><span class="hs-identifier hs-var">herald</span></a></span></span><span>
</span><span id="line-4141"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; Arity -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681165350"><span class="hs-identifier hs-var">herald</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;on the&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Arity -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#speakNth"><span class="hs-identifier hs-var">speakNth</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621681165351"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-4142"></span><span>                       </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;argument of&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165410"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-4143"></span><span>
</span><span id="line-4144"></span><span>    </span><span id="local-6989586621681165401"><span class="annot"><span class="annottext">data_con_display_type :: Type
</span><a href="#local-6989586621681165401"><span class="hs-identifier hs-var hs-var">data_con_display_type</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; DataCon -&gt; Type
</span><a href="GHC.Core.DataCon.html#dataConDisplayType"><span class="hs-identifier hs-var">dataConDisplayType</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681165413"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165410"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-4145"></span><span>
</span><span id="line-4146"></span><span class="hs-comment">-------------------------------</span><span>
</span><span id="line-4147"></span><span class="annot"><a href="GHC.Tc.TyCl.html#checkNewDataCon"><span class="hs-identifier hs-type">checkNewDataCon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-4148"></span><span class="hs-comment">-- Further checks for the data constructor of a newtype</span><span>
</span><span id="line-4149"></span><span id="checkNewDataCon"><span class="annot"><span class="annottext">checkNewDataCon :: DataCon -&gt; TcRn ()
</span><a href="GHC.Tc.TyCl.html#checkNewDataCon"><span class="hs-identifier hs-var hs-var">checkNewDataCon</span></a></span></span><span> </span><span id="local-6989586621681165347"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165347"><span class="hs-identifier hs-var">con</span></a></span></span><span>
</span><span id="line-4150"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Scaled Type] -&gt; Bool
forall a. [a] -&gt; Bool
</span><a href="GHC.Utils.Misc.html#isSingleton"><span class="hs-identifier hs-var">isSingleton</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621681165346"><span class="hs-identifier hs-var">arg_tys</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; Arity -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#newtypeFieldErr"><span class="hs-identifier hs-var">newtypeFieldErr</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165347"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Scaled Type] -&gt; Arity
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Arity
</span><a href="../../base/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621681165346"><span class="hs-identifier hs-var">arg_tys</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-4151"></span><span>              </span><span class="hs-comment">-- One argument</span><span>
</span><span id="line-4152"></span><span>
</span><span id="line-4153"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681165344"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681165344"><span class="hs-identifier hs-var">unlifted_newtypes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall gbl lcl. Extension -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><a href="../../ghc-boot-th/src/GHC.LanguageExtensions.Type.html#UnliftedNewtypes"><span class="hs-identifier hs-var">LangExt.UnliftedNewtypes</span></a></span><span>
</span><span id="line-4154"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681165342"><span class="annot"><span class="annottext">allowedArgType :: Bool
</span><a href="#local-6989586621681165342"><span class="hs-identifier hs-var hs-var">allowedArgType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4155"></span><span>                </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681165344"><span class="hs-identifier hs-var">unlifted_newtypes</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Maybe Bool
Type -&gt; Maybe Bool
</span><a href="GHC.Core.Type.html#isLiftedType_maybe"><span class="hs-identifier hs-var">isLiftedType_maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scaled Type -&gt; Type
forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled Type
</span><a href="#local-6989586621681165340"><span class="hs-identifier hs-var">arg_ty1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Bool -&gt; Maybe Bool -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Maybe Bool
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-4156"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681165342"><span class="hs-identifier hs-var">allowedArgType</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; TcRn ()) -&gt; SDoc -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-4157"></span><span>          </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;A newtype cannot have an unlifted argument type&quot;</span></span><span>
</span><span id="line-4158"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Perhaps you intended to use UnliftedNewtypes&quot;</span></span><span>
</span><span id="line-4159"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-4160"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681165339"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681165339"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-4161"></span><span>
</span><span id="line-4162"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681165338"><span class="annot"><span class="annottext">check_con :: Bool -&gt; SDoc -&gt; TcRn ()
</span><a href="#local-6989586621681165338"><span class="hs-identifier hs-var hs-var">check_con</span></a></span></span><span> </span><span id="local-6989586621681165337"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681165337"><span class="hs-identifier hs-var">what</span></a></span></span><span> </span><span id="local-6989586621681165336"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681165336"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4163"></span><span>               </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681165337"><span class="hs-identifier hs-var">what</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681165336"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165347"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; DataCon -&gt; Type
</span><a href="GHC.Core.DataCon.html#dataConDisplayType"><span class="hs-identifier hs-var">dataConDisplayType</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681165339"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165347"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-4164"></span><span>
</span><span id="line-4165"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="#local-6989586621681165335"><span class="hs-identifier hs-var">ok_mult</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scaled Type -&gt; Type
forall a. Scaled a -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#scaledMult"><span class="hs-identifier hs-var">scaledMult</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled Type
</span><a href="#local-6989586621681165340"><span class="hs-identifier hs-var">arg_ty1</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; TcRn ()) -&gt; SDoc -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-4166"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;A newtype constructor must be linear&quot;</span></span><span>
</span><span id="line-4167"></span><span>
</span><span id="line-4168"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; TcRn ()
</span><a href="#local-6989586621681165338"><span class="hs-identifier hs-var">check_con</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[EqSpec] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[EqSpec]
</span><a href="#local-6989586621681165333"><span class="hs-identifier hs-var">eq_spec</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; TcRn ()) -&gt; SDoc -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-4169"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;A newtype constructor must have a return type of form T a1 ... an&quot;</span></span><span>
</span><span id="line-4170"></span><span>                </span><span class="hs-comment">-- Return type is (T a b c)</span><span>
</span><span id="line-4171"></span><span>
</span><span id="line-4172"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; TcRn ()
</span><a href="#local-6989586621681165338"><span class="hs-identifier hs-var">check_con</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Type] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681165332"><span class="hs-identifier hs-var">theta</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; TcRn ()) -&gt; SDoc -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-4173"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;A newtype constructor cannot have a context in its type&quot;</span></span><span>
</span><span id="line-4174"></span><span>
</span><span id="line-4175"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; TcRn ()
</span><a href="#local-6989586621681165338"><span class="hs-identifier hs-var">check_con</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyVar] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165331"><span class="hs-identifier hs-var">ex_tvs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; TcRn ()) -&gt; SDoc -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-4176"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;A newtype constructor cannot have existential type variables&quot;</span></span><span>
</span><span id="line-4177"></span><span>                </span><span class="hs-comment">-- No existentials</span><span>
</span><span id="line-4178"></span><span>
</span><span id="line-4179"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(HsSrcBang -&gt; Bool) -&gt; [HsSrcBang] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#all"><span class="hs-identifier hs-var">all</span></a></span><span> </span><span class="annot"><span class="annottext">HsSrcBang -&gt; Bool
</span><a href="#local-6989586621681165330"><span class="hs-identifier hs-var">ok_bang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; [HsSrcBang]
</span><a href="GHC.Core.DataCon.html#dataConSrcBangs"><span class="hs-identifier hs-var">dataConSrcBangs</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165347"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-4180"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#newtypeStrictError"><span class="hs-identifier hs-var">newtypeStrictError</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165347"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4181"></span><span>                </span><span class="hs-comment">-- No strictness annotations</span><span>
</span><span id="line-4182"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-4183"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-4184"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681165328"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165328"><span class="hs-identifier hs-var">_univ_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681165331"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165331"><span class="hs-identifier hs-var">ex_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681165333"><span class="annot"><span class="annottext">[EqSpec]
</span><a href="#local-6989586621681165333"><span class="hs-identifier hs-var">eq_spec</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681165332"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681165332"><span class="hs-identifier hs-var">theta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681165346"><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621681165346"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681165327"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165327"><span class="hs-identifier hs-var">_res_ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-4185"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon
-&gt; ([TyVar], [TyVar], [EqSpec], [Type], [Scaled Type], Type)
</span><a href="GHC.Core.DataCon.html#dataConFullSig"><span class="hs-identifier hs-var">dataConFullSig</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165347"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-4186"></span><span>
</span><span id="line-4187"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681165340"><span class="annot"><span class="annottext">Scaled Type
</span><a href="#local-6989586621681165340"><span class="hs-identifier hs-var">arg_ty1</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621681165346"><span class="hs-identifier hs-var">arg_tys</span></a></span><span>
</span><span id="line-4188"></span><span>
</span><span id="line-4189"></span><span>    </span><span id="local-6989586621681165330"><span class="annot"><span class="annottext">ok_bang :: HsSrcBang -&gt; Bool
</span><a href="#local-6989586621681165330"><span class="hs-identifier hs-var hs-var">ok_bang</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.DataCon.html#HsSrcBang"><span class="hs-identifier hs-type">HsSrcBang</span></a></span><span> </span><span class="annot"><span class="annottext">SourceText
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SrcUnpackedness
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SrcStrictness
</span><a href="GHC.Core.DataCon.html#SrcStrict"><span class="hs-identifier hs-var">SrcStrict</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-4190"></span><span>    </span><span class="annot"><a href="#local-6989586621681165330"><span class="hs-identifier hs-var">ok_bang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.DataCon.html#HsSrcBang"><span class="hs-identifier hs-type">HsSrcBang</span></a></span><span> </span><span class="annot"><span class="annottext">SourceText
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SrcUnpackedness
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SrcStrictness
</span><a href="GHC.Core.DataCon.html#SrcLazy"><span class="hs-identifier hs-var">SrcLazy</span></a></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-4191"></span><span>    </span><span class="annot"><a href="#local-6989586621681165330"><span class="hs-identifier hs-var">ok_bang</span></a></span><span> </span><span class="annot"><span class="annottext">HsSrcBang
</span><span class="hs-identifier">_</span></span><span>                         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-4192"></span><span>
</span><span id="line-4193"></span><span>    </span><span id="local-6989586621681165335"><span class="annot"><span class="annottext">ok_mult :: Type -&gt; Bool
</span><a href="#local-6989586621681165335"><span class="hs-identifier hs-var hs-var">ok_mult</span></a></span></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Core.Type.html#One"><span class="hs-identifier hs-var">One</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-4194"></span><span>    </span><span class="annot"><a href="#local-6989586621681165335"><span class="hs-identifier hs-var">ok_mult</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-4195"></span><span>
</span><span id="line-4196"></span><span class="hs-comment">-------------------------------</span><span>
</span><span id="line-4197"></span><span class="annot"><a href="GHC.Tc.TyCl.html#checkValidClass"><span class="hs-identifier hs-type">checkValidClass</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-4198"></span><span id="checkValidClass"><span class="annot"><span class="annottext">checkValidClass :: Class -&gt; TcRn ()
</span><a href="GHC.Tc.TyCl.html#checkValidClass"><span class="hs-identifier hs-var hs-var">checkValidClass</span></a></span></span><span> </span><span id="local-6989586621681165324"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681165324"><span class="hs-identifier hs-var">cls</span></a></span></span><span>
</span><span id="line-4199"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681165323"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681165323"><span class="hs-identifier hs-var">constrained_class_methods</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall gbl lcl. Extension -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><a href="../../ghc-boot-th/src/GHC.LanguageExtensions.Type.html#ConstrainedClassMethods"><span class="hs-identifier hs-var">LangExt.ConstrainedClassMethods</span></a></span><span>
</span><span id="line-4200"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681165321"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681165321"><span class="hs-identifier hs-var">multi_param_type_classes</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall gbl lcl. Extension -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><a href="../../ghc-boot-th/src/GHC.LanguageExtensions.Type.html#MultiParamTypeClasses"><span class="hs-identifier hs-var">LangExt.MultiParamTypeClasses</span></a></span><span>
</span><span id="line-4201"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681165319"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681165319"><span class="hs-identifier hs-var">nullary_type_classes</span></a></span></span><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall gbl lcl. Extension -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><a href="../../ghc-boot-th/src/GHC.LanguageExtensions.Type.html#NullaryTypeClasses"><span class="hs-identifier hs-var">LangExt.NullaryTypeClasses</span></a></span><span>
</span><span id="line-4202"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681165317"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681165317"><span class="hs-identifier hs-var">fundep_classes</span></a></span></span><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall gbl lcl. Extension -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><a href="../../ghc-boot-th/src/GHC.LanguageExtensions.Type.html#FunctionalDependencies"><span class="hs-identifier hs-var">LangExt.FunctionalDependencies</span></a></span><span>
</span><span id="line-4203"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681165315"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681165315"><span class="hs-identifier hs-var">undecidable_super_classes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall gbl lcl. Extension -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><a href="../../ghc-boot-th/src/GHC.LanguageExtensions.Type.html#UndecidableSuperClasses"><span class="hs-identifier hs-var">LangExt.UndecidableSuperClasses</span></a></span><span>
</span><span id="line-4204"></span><span>
</span><span id="line-4205"></span><span>        </span><span class="hs-comment">-- Check that the class is unary, unless multiparameter type classes</span><span>
</span><span id="line-4206"></span><span>        </span><span class="hs-comment">-- are enabled; also recognize deprecated nullary type classes</span><span>
</span><span id="line-4207"></span><span>        </span><span class="hs-comment">-- extension (subsumed by multiparameter type classes, #8993)</span><span>
</span><span id="line-4208"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681165321"><span class="hs-identifier hs-var">multi_param_type_classes</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621681165313"><span class="hs-identifier hs-var">cls_arity</span></a></span><span> </span><span class="annot"><span class="annottext">Arity -&gt; Arity -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span>
</span><span id="line-4209"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681165319"><span class="hs-identifier hs-var">nullary_type_classes</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621681165313"><span class="hs-identifier hs-var">cls_arity</span></a></span><span> </span><span class="annot"><span class="annottext">Arity -&gt; Arity -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-4210"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arity -&gt; Class -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#classArityErr"><span class="hs-identifier hs-var">classArityErr</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621681165313"><span class="hs-identifier hs-var">cls_arity</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681165324"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4211"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681165317"><span class="hs-identifier hs-var">fundep_classes</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">[([TyVar], [TyVar])] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[([TyVar], [TyVar])]
</span><a href="#local-6989586621681165311"><span class="hs-identifier hs-var">fundeps</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#classFunDepsErr"><span class="hs-identifier hs-var">classFunDepsErr</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681165324"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4212"></span><span>
</span><span id="line-4213"></span><span>        </span><span class="hs-comment">-- Check the super-classes</span><span>
</span><span id="line-4214"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt -&gt; [Type] -&gt; TcRn ()
</span><a href="GHC.Tc.Validity.html#checkValidTheta"><span class="hs-identifier hs-var">checkValidTheta</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#ClassSCCtxt"><span class="hs-identifier hs-var">ClassSCCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; Name
</span><a href="GHC.Core.Class.html#className"><span class="hs-identifier hs-var hs-var">className</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681165324"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681165307"><span class="hs-identifier hs-var">theta</span></a></span><span>
</span><span id="line-4215"></span><span>
</span><span id="line-4216"></span><span>          </span><span class="hs-comment">-- Now check for cyclic superclasses</span><span>
</span><span id="line-4217"></span><span>          </span><span class="hs-comment">-- If there are superclass cycles, checkClassCycleErrs bails.</span><span>
</span><span id="line-4218"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRn () -&gt; TcRn ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base/src/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681165315"><span class="hs-identifier hs-var">undecidable_super_classes</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcRn ()) -&gt; TcRn () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-4219"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Class -&gt; Maybe SDoc
</span><a href="GHC.Tc.TyCl.Utils.html#checkClassCycles"><span class="hs-identifier hs-var">checkClassCycles</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681165324"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-4220"></span><span>             </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681165305"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681165305"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcRn () -&gt; TcRn ()
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; SrcSpan
forall a. NamedThing a =&gt; a -&gt; SrcSpan
</span><a href="GHC.Types.Name.html#getSrcSpan"><span class="hs-identifier hs-var">getSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681165324"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcRn ()) -&gt; TcRn () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-4221"></span><span>                         </span><span class="annot"><span class="annottext">SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrTc"><span class="hs-identifier hs-var">addErrTc</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681165305"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-4222"></span><span>             </span><span class="annot"><span class="annottext">Maybe SDoc
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-4223"></span><span>
</span><span id="line-4224"></span><span>        </span><span class="hs-comment">-- Check the class operations.</span><span>
</span><span id="line-4225"></span><span>        </span><span class="hs-comment">-- But only if there have been no earlier errors</span><span>
</span><span id="line-4226"></span><span>        </span><span class="hs-comment">-- See Note [Abort when superclass cycle is detected]</span><span>
</span><span id="line-4227"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcRn () -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#whenNoErrs"><span class="hs-identifier hs-var">whenNoErrs</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcRn ()) -&gt; TcRn () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-4228"></span><span>          </span><span class="annot"><span class="annottext">((TyVar, DefMethInfo) -&gt; TcRn ())
-&gt; [(TyVar, DefMethInfo)] -&gt; TcRn ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><a href="../../base/src/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; (TyVar, DefMethInfo) -&gt; TcRn ()
</span><a href="#local-6989586621681165303"><span class="hs-identifier hs-var">check_op</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681165323"><span class="hs-identifier hs-var">constrained_class_methods</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(TyVar, DefMethInfo)]
</span><a href="#local-6989586621681165302"><span class="hs-identifier hs-var">op_stuff</span></a></span><span>
</span><span id="line-4229"></span><span>
</span><span id="line-4230"></span><span>        </span><span class="hs-comment">-- Check the associated type defaults are well-formed and instantiated</span><span>
</span><span id="line-4231"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(ClassATItem -&gt; TcRn ()) -&gt; [ClassATItem] -&gt; TcRn ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><a href="../../base/src/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a></span><span> </span><span class="annot"><span class="annottext">ClassATItem -&gt; TcRn ()
</span><a href="#local-6989586621681165301"><span class="hs-identifier hs-var">check_at</span></a></span><span> </span><span class="annot"><span class="annottext">[ClassATItem]
</span><a href="#local-6989586621681165300"><span class="hs-identifier hs-var">at_stuff</span></a></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-4232"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-4233"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681165299"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165299"><span class="hs-identifier hs-var">tyvars</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681165311"><span class="annot"><span class="annottext">[([TyVar], [TyVar])]
</span><a href="#local-6989586621681165311"><span class="hs-identifier hs-var">fundeps</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681165307"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681165307"><span class="hs-identifier hs-var">theta</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681165300"><span class="annot"><span class="annottext">[ClassATItem]
</span><a href="#local-6989586621681165300"><span class="hs-identifier hs-var">at_stuff</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681165302"><span class="annot"><span class="annottext">[(TyVar, DefMethInfo)]
</span><a href="#local-6989586621681165302"><span class="hs-identifier hs-var">op_stuff</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Class
-&gt; ([TyVar], [([TyVar], [TyVar])], [Type], [TyVar], [ClassATItem],
    [(TyVar, DefMethInfo)])
</span><a href="GHC.Core.Class.html#classExtraBigSig"><span class="hs-identifier hs-var">classExtraBigSig</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681165324"><span class="hs-identifier hs-var">cls</span></a></span><span>
</span><span id="line-4234"></span><span>    </span><span id="local-6989586621681165313"><span class="annot"><span class="annottext">cls_arity :: Arity
</span><a href="#local-6989586621681165313"><span class="hs-identifier hs-var hs-var">cls_arity</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; Arity
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Arity
</span><a href="../../base/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [TyVar]
</span><a href="GHC.Core.TyCon.html#tyConVisibleTyVars"><span class="hs-identifier hs-var">tyConVisibleTyVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; TyCon
</span><a href="GHC.Core.Class.html#classTyCon"><span class="hs-identifier hs-var hs-var">classTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681165324"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-4235"></span><span>       </span><span class="hs-comment">-- Ignore invisible variables</span><span>
</span><span id="line-4236"></span><span>    </span><span id="local-6989586621681165297"><span class="annot"><span class="annottext">cls_tv_set :: VarSet
</span><a href="#local-6989586621681165297"><span class="hs-identifier hs-var hs-var">cls_tv_set</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#mkVarSet"><span class="hs-identifier hs-var">mkVarSet</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165299"><span class="hs-identifier hs-var">tyvars</span></a></span><span>
</span><span id="line-4237"></span><span>
</span><span id="line-4238"></span><span>    </span><span id="local-6989586621681165303"><span class="annot"><span class="annottext">check_op :: Bool -&gt; (TyVar, DefMethInfo) -&gt; TcRn ()
</span><a href="#local-6989586621681165303"><span class="hs-identifier hs-var hs-var">check_op</span></a></span></span><span> </span><span id="local-6989586621681165296"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681165296"><span class="hs-identifier hs-var">constrained_class_methods</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681165295"><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681165295"><span class="hs-identifier hs-var">sel_id</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681165294"><span class="annot"><span class="annottext">DefMethInfo
</span><a href="#local-6989586621681165294"><span class="hs-identifier hs-var">dm</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-4239"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcRn () -&gt; TcRn ()
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyVar -&gt; SrcSpan
forall a. NamedThing a =&gt; a -&gt; SrcSpan
</span><a href="GHC.Types.Name.html#getSrcSpan"><span class="hs-identifier hs-var">getSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681165295"><span class="hs-identifier hs-var">sel_id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcRn ()) -&gt; TcRn () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-4240"></span><span>        </span><span class="annot"><span class="annottext">SDoc -&gt; TcRn () -&gt; TcRn ()
forall a. SDoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyVar -&gt; Type -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#classOpCtxt"><span class="hs-identifier hs-var">classOpCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681165295"><span class="hs-identifier hs-var">sel_id</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165292"><span class="hs-identifier hs-var">op_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcRn ()) -&gt; TcRn () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-4241"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;class op type&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165292"><span class="hs-identifier hs-var">op_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4242"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt -&gt; Type -&gt; TcRn ()
</span><a href="GHC.Tc.Validity.html#checkValidType"><span class="hs-identifier hs-var">checkValidType</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="#local-6989586621681165291"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165292"><span class="hs-identifier hs-var">op_ty</span></a></span><span>
</span><span id="line-4243"></span><span>                </span><span class="hs-comment">-- This implements the ambiguity check, among other things</span><span>
</span><span id="line-4244"></span><span>                </span><span class="hs-comment">-- Example: tc223</span><span>
</span><span id="line-4245"></span><span>                </span><span class="hs-comment">--   class Error e =&gt; Game b mv e | b -&gt; mv e where</span><span>
</span><span id="line-4246"></span><span>                </span><span class="hs-comment">--      newBoard :: MonadState b m =&gt; m ()</span><span>
</span><span id="line-4247"></span><span>                </span><span class="hs-comment">-- Here, MonadState has a fundep m-&gt;b, so newBoard is fine</span><span>
</span><span id="line-4248"></span><span>
</span><span id="line-4249"></span><span>           </span><span class="hs-comment">-- a method cannot be levity polymorphic, as we have to store the</span><span>
</span><span id="line-4250"></span><span>           </span><span class="hs-comment">-- method in a dictionary</span><span>
</span><span id="line-4251"></span><span>           </span><span class="hs-comment">-- example of what this prevents:</span><span>
</span><span id="line-4252"></span><span>           </span><span class="hs-comment">--   class BoundedX (a :: TYPE r) where minBound :: a</span><span>
</span><span id="line-4253"></span><span>           </span><span class="hs-comment">-- See Note [Levity polymorphism checking] in GHC.HsToCore.Monad</span><span>
</span><span id="line-4254"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; Type -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.TcMType.html#checkForLevPoly"><span class="hs-identifier hs-var">checkForLevPoly</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165290"><span class="hs-identifier hs-var">tau1</span></a></span><span>
</span><span id="line-4255"></span><span>
</span><span id="line-4256"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRn () -&gt; TcRn ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base/src/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681165296"><span class="hs-identifier hs-var">constrained_class_methods</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcRn ()) -&gt; TcRn () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-4257"></span><span>          </span><span class="annot"><span class="annottext">(Type -&gt; TcRn ()) -&gt; [Type] -&gt; TcRn ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><a href="../../base/src/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcRn ()
</span><a href="#local-6989586621681165289"><span class="hs-identifier hs-var">check_constraint</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Type] -&gt; [Type]
forall a. [a] -&gt; [a]
</span><a href="../../base/src/GHC.List.html#tail"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165287"><span class="hs-identifier hs-var">cls_pred</span></a></span><span class="annot"><span class="annottext">Type -&gt; [Type] -&gt; [Type]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681165286"><span class="hs-identifier hs-var">op_theta</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-4258"></span><span>
</span><span id="line-4259"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt -&gt; TyVar -&gt; Type -&gt; Type -&gt; DefMethInfo -&gt; TcRn ()
</span><a href="#local-6989586621681165285"><span class="hs-identifier hs-var">check_dm</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="#local-6989586621681165291"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681165295"><span class="hs-identifier hs-var">sel_id</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165287"><span class="hs-identifier hs-var">cls_pred</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165284"><span class="hs-identifier hs-var">tau2</span></a></span><span> </span><span class="annot"><span class="annottext">DefMethInfo
</span><a href="#local-6989586621681165294"><span class="hs-identifier hs-var">dm</span></a></span><span>
</span><span id="line-4260"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-4261"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-4262"></span><span>          </span><span id="local-6989586621681165291"><span class="annot"><span class="annottext">ctxt :: UserTypeCtxt
</span><a href="#local-6989586621681165291"><span class="hs-identifier hs-var hs-var">ctxt</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Bool -&gt; UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#FunSigCtxt"><span class="hs-identifier hs-var">FunSigCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165282"><span class="hs-identifier hs-var">op_name</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-comment">-- Report redundant class constraints</span><span>
</span><span id="line-4263"></span><span>          </span><span id="local-6989586621681165282"><span class="annot"><span class="annottext">op_name :: Name
</span><a href="#local-6989586621681165282"><span class="hs-identifier hs-var hs-var">op_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyVar -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681165295"><span class="hs-identifier hs-var">sel_id</span></a></span><span>
</span><span id="line-4264"></span><span>          </span><span id="local-6989586621681165292"><span class="annot"><span class="annottext">op_ty :: Type
</span><a href="#local-6989586621681165292"><span class="hs-identifier hs-var hs-var">op_ty</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyVar -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681165295"><span class="hs-identifier hs-var">sel_id</span></a></span><span>
</span><span id="line-4265"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyVar]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621681165287"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165287"><span class="hs-identifier hs-var">cls_pred</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681165290"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165290"><span class="hs-identifier hs-var">tau1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ([TyVar], Type, Type)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitMethodTy"><span class="hs-identifier hs-var">tcSplitMethodTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165292"><span class="hs-identifier hs-var">op_ty</span></a></span><span>
</span><span id="line-4266"></span><span>          </span><span class="hs-comment">-- See Note [Splitting nested sigma types in class type signatures]</span><span>
</span><span id="line-4267"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyVar]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621681165286"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681165286"><span class="hs-identifier hs-var">op_theta</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681165284"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165284"><span class="hs-identifier hs-var">tau2</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ([TyVar], [Type], Type)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitNestedSigmaTys"><span class="hs-identifier hs-var">tcSplitNestedSigmaTys</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165290"><span class="hs-identifier hs-var">tau1</span></a></span><span>
</span><span id="line-4268"></span><span>
</span><span id="line-4269"></span><span>          </span><span class="annot"><a href="#local-6989586621681165289"><span class="hs-identifier hs-type">check_constraint</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcPredType"><span class="hs-identifier hs-type">TcPredType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-4270"></span><span>          </span><span id="local-6989586621681165289"><span class="annot"><span class="annottext">check_constraint :: Type -&gt; TcRn ()
</span><a href="#local-6989586621681165289"><span class="hs-identifier hs-var hs-var">check_constraint</span></a></span></span><span> </span><span id="local-6989586621681165276"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165276"><span class="hs-identifier hs-var">pred</span></a></span></span><span> </span><span class="hs-comment">-- See Note [Class method constraints]</span><span>
</span><span id="line-4271"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRn () -&gt; TcRn ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarSet -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#isEmptyVarSet"><span class="hs-identifier hs-var">isEmptyVarSet</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621681165274"><span class="hs-identifier hs-var">pred_tvs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-4272"></span><span>                    </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621681165274"><span class="hs-identifier hs-var">pred_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; VarSet -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#subVarSet"><span class="hs-operator hs-var">`subVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621681165297"><span class="hs-identifier hs-var">cls_tv_set</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4273"></span><span>                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrTc"><span class="hs-identifier hs-var">addErrTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyVar -&gt; Type -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#badMethPred"><span class="hs-identifier hs-var">badMethPred</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681165295"><span class="hs-identifier hs-var">sel_id</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165276"><span class="hs-identifier hs-var">pred</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-4274"></span><span>            </span><span class="hs-keyword">where</span><span>
</span><span id="line-4275"></span><span>              </span><span id="local-6989586621681165274"><span class="annot"><span class="annottext">pred_tvs :: VarSet
</span><a href="#local-6989586621681165274"><span class="hs-identifier hs-var hs-var">pred_tvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165276"><span class="hs-identifier hs-var">pred</span></a></span><span>
</span><span id="line-4276"></span><span>
</span><span id="line-4277"></span><span>    </span><span id="local-6989586621681165301"><span class="annot"><span class="annottext">check_at :: ClassATItem -&gt; TcRn ()
</span><a href="#local-6989586621681165301"><span class="hs-identifier hs-var hs-var">check_at</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Class.html#ATI"><span class="hs-identifier hs-type">ATI</span></a></span><span> </span><span id="local-6989586621681165270"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165270"><span class="hs-identifier hs-var">fam_tc</span></a></span></span><span> </span><span id="local-6989586621681165269"><span class="annot"><span class="annottext">Maybe (Type, ATValidityInfo)
</span><a href="#local-6989586621681165269"><span class="hs-identifier hs-var">m_dflt_rhs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-4278"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621681165313"><span class="hs-identifier hs-var">cls_arity</span></a></span><span> </span><span class="annot"><span class="annottext">Arity -&gt; Arity -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">(TyVar -&gt; Bool) -&gt; [TyVar] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyVar -&gt; VarSet -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#elemVarSet"><span class="hs-operator hs-var">`elemVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621681165297"><span class="hs-identifier hs-var">cls_tv_set</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165267"><span class="hs-identifier hs-var">fam_tvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4279"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; TyCon -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#noClassTyVarErr"><span class="hs-identifier hs-var">noClassTyVarErr</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681165324"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165270"><span class="hs-identifier hs-var">fam_tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4280"></span><span>                        </span><span class="hs-comment">-- Check that the associated type mentions at least</span><span>
</span><span id="line-4281"></span><span>                        </span><span class="hs-comment">-- one of the class type variables</span><span>
</span><span id="line-4282"></span><span>                        </span><span class="hs-comment">-- The check is disabled for nullary type classes,</span><span>
</span><span id="line-4283"></span><span>                        </span><span class="hs-comment">-- since there is no possible ambiguity (#10020)</span><span>
</span><span id="line-4284"></span><span>
</span><span id="line-4285"></span><span>             </span><span class="hs-comment">-- Check that any default declarations for associated types are valid</span><span>
</span><span id="line-4286"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Maybe (Type, ATValidityInfo)
-&gt; ((Type, ATValidityInfo) -&gt; TcRn ()) -&gt; TcRn ()
forall (m :: * -&gt; *) a. Monad m =&gt; Maybe a -&gt; (a -&gt; m ()) -&gt; m ()
</span><a href="GHC.Data.Maybe.html#whenIsJust"><span class="hs-identifier hs-var">whenIsJust</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Type, ATValidityInfo)
</span><a href="#local-6989586621681165269"><span class="hs-identifier hs-var">m_dflt_rhs</span></a></span><span> </span><span class="annot"><span class="annottext">(((Type, ATValidityInfo) -&gt; TcRn ()) -&gt; TcRn ())
-&gt; ((Type, ATValidityInfo) -&gt; TcRn ()) -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681165264"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165264"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681165263"><span class="annot"><span class="annottext">ATValidityInfo
</span><a href="#local-6989586621681165263"><span class="hs-identifier hs-var">at_validity_info</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4287"></span><span>             </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ATValidityInfo
</span><a href="#local-6989586621681165263"><span class="hs-identifier hs-var">at_validity_info</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-4288"></span><span>               </span><span class="annot"><span class="annottext">ATValidityInfo
</span><a href="GHC.Core.Class.html#NoATVI"><span class="hs-identifier hs-var">NoATVI</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-4289"></span><span>               </span><span class="annot"><a href="GHC.Core.Class.html#ATVI"><span class="hs-identifier hs-type">ATVI</span></a></span><span> </span><span id="local-6989586621681165261"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681165261"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681165260"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681165260"><span class="hs-identifier hs-var">pats</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4290"></span><span>                 </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcRn () -&gt; TcRn ()
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681165261"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcRn ()) -&gt; TcRn () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-4291"></span><span>                 </span><span class="annot"><span class="annottext">SDoc -&gt; Name -&gt; TcRn () -&gt; TcRn ()
forall a. SDoc -&gt; Name -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.TyCl.html#tcAddFamInstCtxt"><span class="hs-identifier hs-var">tcAddFamInstCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;default type instance&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Name
forall a. NamedThing a =&gt; a -&gt; Name
</span><a href="GHC.Types.Name.html#getName"><span class="hs-identifier hs-var">getName</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165270"><span class="hs-identifier hs-var">fam_tc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcRn ()) -&gt; TcRn () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-4292"></span><span>                 </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; TcRn ()
</span><a href="GHC.Tc.Validity.html#checkValidAssocTyFamDeflt"><span class="hs-identifier hs-var">checkValidAssocTyFamDeflt</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165270"><span class="hs-identifier hs-var">fam_tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681165260"><span class="hs-identifier hs-var">pats</span></a></span><span>
</span><span id="line-4293"></span><span>                    </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [TyVar] -&gt; [Type] -&gt; Type -&gt; TcRn ()
</span><a href="GHC.Tc.Validity.html#checkValidTyFamEqn"><span class="hs-identifier hs-var">checkValidTyFamEqn</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165270"><span class="hs-identifier hs-var">fam_tc</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165267"><span class="hs-identifier hs-var">fam_tvs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyVar] -&gt; [Type]
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165267"><span class="hs-identifier hs-var">fam_tvs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165264"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><span id="line-4294"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-4295"></span><span>          </span><span id="local-6989586621681165267"><span class="annot"><span class="annottext">fam_tvs :: [TyVar]
</span><a href="#local-6989586621681165267"><span class="hs-identifier hs-var hs-var">fam_tvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [TyVar]
</span><a href="GHC.Core.TyCon.html#tyConTyVars"><span class="hs-identifier hs-var hs-var">tyConTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165270"><span class="hs-identifier hs-var">fam_tc</span></a></span><span>
</span><span id="line-4296"></span><span>
</span><span id="line-4297"></span><span>    </span><span class="annot"><a href="#local-6989586621681165285"><span class="hs-identifier hs-type">check_dm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#UserTypeCtxt"><span class="hs-identifier hs-type">UserTypeCtxt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#DefMethInfo"><span class="hs-identifier hs-type">DefMethInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-4298"></span><span>    </span><span class="hs-comment">-- Check validity of the /top-level/ generic-default type</span><span>
</span><span id="line-4299"></span><span>    </span><span class="hs-comment">-- E.g for   class C a where</span><span>
</span><span id="line-4300"></span><span>    </span><span class="hs-comment">--             default op :: forall b. (a~b) =&gt; blah</span><span>
</span><span id="line-4301"></span><span>    </span><span class="hs-comment">-- we do not want to do an ambiguity check on a type with</span><span>
</span><span id="line-4302"></span><span>    </span><span class="hs-comment">-- a free TyVar 'a' (#11608).  See TcType</span><span>
</span><span id="line-4303"></span><span>    </span><span class="hs-comment">-- Note [TyVars and TcTyVars during type checking] in GHC.Tc.Utils.TcType</span><span>
</span><span id="line-4304"></span><span>    </span><span class="hs-comment">-- Hence the mkDefaultMethodType to close the type.</span><span>
</span><span id="line-4305"></span><span>    </span><span id="local-6989586621681165285"><span class="annot"><span class="annottext">check_dm :: UserTypeCtxt -&gt; TyVar -&gt; Type -&gt; Type -&gt; DefMethInfo -&gt; TcRn ()
</span><a href="#local-6989586621681165285"><span class="hs-identifier hs-var hs-var">check_dm</span></a></span></span><span> </span><span id="local-6989586621681165255"><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="#local-6989586621681165255"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621681165254"><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681165254"><span class="hs-identifier hs-var">sel_id</span></a></span></span><span> </span><span id="local-6989586621681165253"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165253"><span class="hs-identifier hs-var">vanilla_cls_pred</span></a></span></span><span> </span><span id="local-6989586621681165252"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165252"><span class="hs-identifier hs-var">vanilla_tau</span></a></span></span><span>
</span><span id="line-4306"></span><span>             </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681165251"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165251"><span class="hs-identifier hs-var">dm_name</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681165250"><span class="annot"><span class="annottext">dm_spec :: DefMethSpec Type
</span><a href="#local-6989586621681165250"><span class="hs-identifier hs-var">dm_spec</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Basic.html#GenericDM"><span class="hs-identifier hs-type">GenericDM</span></a></span><span> </span><span id="local-6989586621681165248"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165248"><span class="hs-identifier hs-var">dm_ty</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-4307"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcRn () -&gt; TcRn ()
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SrcSpan
forall a. NamedThing a =&gt; a -&gt; SrcSpan
</span><a href="GHC.Types.Name.html#getSrcSpan"><span class="hs-identifier hs-var">getSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165251"><span class="hs-identifier hs-var">dm_name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcRn ()) -&gt; TcRn () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-4308"></span><span>            </span><span class="hs-comment">-- We have carefully set the SrcSpan on the generic</span><span>
</span><span id="line-4309"></span><span>            </span><span class="hs-comment">-- default-method Name to be that of the generic</span><span>
</span><span id="line-4310"></span><span>            </span><span class="hs-comment">-- default type signature</span><span>
</span><span id="line-4311"></span><span>
</span><span id="line-4312"></span><span>          </span><span class="hs-comment">-- First, we check that the method's default type signature</span><span>
</span><span id="line-4313"></span><span>          </span><span class="hs-comment">-- aligns with the non-default type signature.</span><span>
</span><span id="line-4314"></span><span>          </span><span class="hs-comment">-- See Note [Default method type signatures must align]</span><span>
</span><span id="line-4315"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681165247"><span class="annot"><span class="annottext">cls_pred :: Type
</span><a href="#local-6989586621681165247"><span class="hs-identifier hs-var hs-var">cls_pred</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Class -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Predicate.html#mkClassPred"><span class="hs-identifier hs-var">mkClassPred</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681165324"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">([Type] -&gt; Type) -&gt; [Type] -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; [Type]
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a></span><span> </span><span class="annot"><span class="annottext">([TyVar] -&gt; [Type]) -&gt; [TyVar] -&gt; [Type]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Class -&gt; [TyVar]
</span><a href="GHC.Core.Class.html#classTyVars"><span class="hs-identifier hs-var hs-var">classTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681165324"><span class="hs-identifier hs-var">cls</span></a></span><span>
</span><span id="line-4316"></span><span>              </span><span class="hs-comment">-- Note that the second field of this tuple contains the context</span><span>
</span><span id="line-4317"></span><span>              </span><span class="hs-comment">-- of the default type signature, making it apparent that we</span><span>
</span><span id="line-4318"></span><span>              </span><span class="hs-comment">-- ignore method contexts completely when validity-checking</span><span>
</span><span id="line-4319"></span><span>              </span><span class="hs-comment">-- default type signatures. See the end of</span><span>
</span><span id="line-4320"></span><span>              </span><span class="hs-comment">-- Note [Default method type signatures must align]</span><span>
</span><span id="line-4321"></span><span>              </span><span class="hs-comment">-- to learn why this is OK.</span><span>
</span><span id="line-4322"></span><span>              </span><span class="hs-comment">--</span><span>
</span><span id="line-4323"></span><span>              </span><span class="hs-comment">-- See also</span><span>
</span><span id="line-4324"></span><span>              </span><span class="hs-comment">-- Note [Splitting nested sigma types in class type signatures]</span><span>
</span><span id="line-4325"></span><span>              </span><span class="hs-comment">-- for an explanation of why we don't use tcSplitSigmaTy here.</span><span>
</span><span id="line-4326"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyVar]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681165245"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165245"><span class="hs-identifier hs-var">dm_tau</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ([TyVar], [Type], Type)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitNestedSigmaTys"><span class="hs-identifier hs-var">tcSplitNestedSigmaTys</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165248"><span class="hs-identifier hs-var">dm_ty</span></a></span><span>
</span><span id="line-4327"></span><span>
</span><span id="line-4328"></span><span>              </span><span class="hs-comment">-- Given this class definition:</span><span>
</span><span id="line-4329"></span><span>              </span><span class="hs-comment">--</span><span>
</span><span id="line-4330"></span><span>              </span><span class="hs-comment">--  class C a b where</span><span>
</span><span id="line-4331"></span><span>              </span><span class="hs-comment">--    op         :: forall p q. (Ord a, D p q)</span><span>
</span><span id="line-4332"></span><span>              </span><span class="hs-comment">--               =&gt; a -&gt; b -&gt; p -&gt; (a, b)</span><span>
</span><span id="line-4333"></span><span>              </span><span class="hs-comment">--    default op :: forall r s. E r</span><span>
</span><span id="line-4334"></span><span>              </span><span class="hs-comment">--               =&gt; a -&gt; b -&gt; s -&gt; (a, b)</span><span>
</span><span id="line-4335"></span><span>              </span><span class="hs-comment">--</span><span>
</span><span id="line-4336"></span><span>              </span><span class="hs-comment">-- We want to match up two types of the form:</span><span>
</span><span id="line-4337"></span><span>              </span><span class="hs-comment">--</span><span>
</span><span id="line-4338"></span><span>              </span><span class="hs-comment">--   Vanilla type sig: C aa bb =&gt; aa -&gt; bb -&gt; p -&gt; (aa, bb)</span><span>
</span><span id="line-4339"></span><span>              </span><span class="hs-comment">--   Default type sig: C a  b  =&gt; a  -&gt; b  -&gt; s -&gt; (a,  b)</span><span>
</span><span id="line-4340"></span><span>              </span><span class="hs-comment">--</span><span>
</span><span id="line-4341"></span><span>              </span><span class="hs-comment">-- Notice that the two type signatures can be quantified over</span><span>
</span><span id="line-4342"></span><span>              </span><span class="hs-comment">-- different class type variables! Therefore, it's important that</span><span>
</span><span id="line-4343"></span><span>              </span><span class="hs-comment">-- we include the class predicate parts to match up a with aa and</span><span>
</span><span id="line-4344"></span><span>              </span><span class="hs-comment">-- b with bb.</span><span>
</span><span id="line-4345"></span><span>              </span><span id="local-6989586621681165244"><span class="annot"><span class="annottext">vanilla_phi_ty :: Type
</span><a href="#local-6989586621681165244"><span class="hs-identifier hs-var hs-var">vanilla_phi_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; Type -&gt; Type
</span><a href="GHC.Tc.Utils.TcType.html#mkPhiTy"><span class="hs-identifier hs-var">mkPhiTy</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165253"><span class="hs-identifier hs-var">vanilla_cls_pred</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165252"><span class="hs-identifier hs-var">vanilla_tau</span></a></span><span>
</span><span id="line-4346"></span><span>              </span><span id="local-6989586621681165243"><span class="annot"><span class="annottext">dm_phi_ty :: Type
</span><a href="#local-6989586621681165243"><span class="hs-identifier hs-var hs-var">dm_phi_ty</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; Type -&gt; Type
</span><a href="GHC.Tc.Utils.TcType.html#mkPhiTy"><span class="hs-identifier hs-var">mkPhiTy</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165247"><span class="hs-identifier hs-var">cls_pred</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165245"><span class="hs-identifier hs-var">dm_tau</span></a></span><span>
</span><span id="line-4347"></span><span>
</span><span id="line-4348"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;check_dm&quot;</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; TcRn ()) -&gt; SDoc -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-4349"></span><span>              </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;vanilla_phi_ty&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165244"><span class="hs-identifier hs-var">vanilla_phi_ty</span></a></span><span>
</span><span id="line-4350"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;dm_phi_ty&quot;</span></span><span>      </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165243"><span class="hs-identifier hs-var">dm_phi_ty</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4351"></span><span>
</span><span id="line-4352"></span><span>          </span><span class="hs-comment">-- Actually checking that the types align is done with a call to</span><span>
</span><span id="line-4353"></span><span>          </span><span class="hs-comment">-- tcMatchTys. We need to get a match in both directions to rule</span><span>
</span><span id="line-4354"></span><span>          </span><span class="hs-comment">-- out degenerate cases like these:</span><span>
</span><span id="line-4355"></span><span>          </span><span class="hs-comment">--</span><span>
</span><span id="line-4356"></span><span>          </span><span class="hs-comment">--  class Foo a where</span><span>
</span><span id="line-4357"></span><span>          </span><span class="hs-comment">--    foo1         :: a -&gt; b</span><span>
</span><span id="line-4358"></span><span>          </span><span class="hs-comment">--    default foo1 :: a -&gt; Int</span><span>
</span><span id="line-4359"></span><span>          </span><span class="hs-comment">--</span><span>
</span><span id="line-4360"></span><span>          </span><span class="hs-comment">--    foo2         :: a -&gt; Int</span><span>
</span><span id="line-4361"></span><span>          </span><span class="hs-comment">--    default foo2 :: a -&gt; b</span><span>
</span><span id="line-4362"></span><span>          </span><span class="annot"><span class="annottext">Bool -&gt; TcRn () -&gt; TcRn ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base/src/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe TCvSubst -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../../base/src/Data.Maybe.html#isJust"><span class="hs-identifier hs-var">isJust</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe TCvSubst -&gt; Bool) -&gt; Maybe TCvSubst -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; [Type] -&gt; Maybe TCvSubst
</span><a href="GHC.Core.Unify.html#tcMatchTys"><span class="hs-identifier hs-var">tcMatchTys</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165243"><span class="hs-identifier hs-var">dm_phi_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165244"><span class="hs-identifier hs-var">vanilla_phi_ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-4363"></span><span>                                      </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165244"><span class="hs-identifier hs-var">vanilla_phi_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165243"><span class="hs-identifier hs-var">dm_phi_ty</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcRn ()) -&gt; TcRn () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrTc"><span class="hs-identifier hs-var">addErrTc</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; TcRn ()) -&gt; SDoc -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-4364"></span><span>               </span><span class="annot"><span class="annottext">SDoc -&gt; Arity -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;The default type signature for&quot;</span></span><span>
</span><span id="line-4365"></span><span>                     </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681165254"><span class="hs-identifier hs-var">sel_id</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#colon"><span class="hs-identifier hs-var">colon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4366"></span><span>                 </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165248"><span class="hs-identifier hs-var">dm_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4367"></span><span>            </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;does not match its corresponding&quot;</span></span><span>
</span><span id="line-4368"></span><span>                </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;non-default type signature&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-4369"></span><span>
</span><span id="line-4370"></span><span>          </span><span class="hs-comment">-- Now do an ambiguity check on the default type signature.</span><span>
</span><span id="line-4371"></span><span>          </span><span class="annot"><span class="annottext">UserTypeCtxt -&gt; Type -&gt; TcRn ()
</span><a href="GHC.Tc.Validity.html#checkValidType"><span class="hs-identifier hs-var">checkValidType</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="#local-6989586621681165255"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; TyVar -&gt; DefMethSpec Type -&gt; Type
</span><a href="GHC.Tc.TyCl.Utils.html#mkDefaultMethodType"><span class="hs-identifier hs-var">mkDefaultMethodType</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681165324"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681165254"><span class="hs-identifier hs-var">sel_id</span></a></span><span> </span><span class="annot"><span class="annottext">DefMethSpec Type
</span><a href="#local-6989586621681165250"><span class="hs-identifier hs-var">dm_spec</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4372"></span><span>    </span><span class="annot"><a href="#local-6989586621681165285"><span class="hs-identifier hs-var">check_dm</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">DefMethInfo
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-4373"></span><span>
</span><span id="line-4374"></span><span class="annot"><a href="GHC.Tc.TyCl.html#checkFamFlag"><span class="hs-identifier hs-type">checkFamFlag</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-4375"></span><span class="hs-comment">-- Check that we don't use families without -XTypeFamilies</span><span>
</span><span id="line-4376"></span><span class="hs-comment">-- The parser won't even parse them, but I suppose a GHC API</span><span>
</span><span id="line-4377"></span><span class="hs-comment">-- client might have a go!</span><span>
</span><span id="line-4378"></span><span id="checkFamFlag"><span class="annot"><span class="annottext">checkFamFlag :: Name -&gt; TcRn ()
</span><a href="GHC.Tc.TyCl.html#checkFamFlag"><span class="hs-identifier hs-var hs-var">checkFamFlag</span></a></span></span><span> </span><span id="local-6989586621681165240"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165240"><span class="hs-identifier hs-var">tc_name</span></a></span></span><span>
</span><span id="line-4379"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681165239"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681165239"><span class="hs-identifier hs-var">idx_tys</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall gbl lcl. Extension -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><a href="../../ghc-boot-th/src/GHC.LanguageExtensions.Type.html#TypeFamilies"><span class="hs-identifier hs-var">LangExt.TypeFamilies</span></a></span><span>
</span><span id="line-4380"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681165239"><span class="hs-identifier hs-var">idx_tys</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681165237"><span class="hs-identifier hs-var">err_msg</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-4381"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-4382"></span><span>    </span><span id="local-6989586621681165237"><span class="annot"><span class="annottext">err_msg :: SDoc
</span><a href="#local-6989586621681165237"><span class="hs-identifier hs-var hs-var">err_msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; Arity -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Illegal family declaration for&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165240"><span class="hs-identifier hs-var">tc_name</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-4383"></span><span>                 </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Enable TypeFamilies to allow indexed type families&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-4384"></span><span>
</span><span id="line-4385"></span><span class="annot"><a href="GHC.Tc.TyCl.html#checkResultSigFlag"><span class="hs-identifier hs-type">checkResultSigFlag</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Decls.html#FamilyResultSig"><span class="hs-identifier hs-type">FamilyResultSig</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-4386"></span><span id="checkResultSigFlag"><span class="annot"><span class="annottext">checkResultSigFlag :: Name -&gt; FamilyResultSig GhcRn -&gt; TcRn ()
</span><a href="GHC.Tc.TyCl.html#checkResultSigFlag"><span class="hs-identifier hs-var hs-var">checkResultSigFlag</span></a></span></span><span> </span><span id="local-6989586621681165236"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165236"><span class="hs-identifier hs-var">tc_name</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Decls.html#TyVarSig"><span class="hs-identifier hs-type">TyVarSig</span></a></span><span> </span><span class="annot"><span class="annottext">XTyVarSig GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681165235"><span class="annot"><span class="annottext">LHsTyVarBndr () GhcRn
</span><a href="#local-6989586621681165235"><span class="hs-identifier hs-var">tvb</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-4387"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681165234"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681165234"><span class="hs-identifier hs-var">ty_fam_deps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall gbl lcl. Extension -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><a href="../../ghc-boot-th/src/GHC.LanguageExtensions.Type.html#TypeFamilyDependencies"><span class="hs-identifier hs-var">LangExt.TypeFamilyDependencies</span></a></span><span>
</span><span id="line-4388"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681165234"><span class="hs-identifier hs-var">ty_fam_deps</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; TcRn ()) -&gt; SDoc -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-4389"></span><span>         </span><span class="annot"><span class="annottext">SDoc -&gt; Arity -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Illegal result type variable&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">LHsTyVarBndr () GhcRn -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsTyVarBndr () GhcRn
</span><a href="#local-6989586621681165235"><span class="hs-identifier hs-var">tvb</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;for&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165236"><span class="hs-identifier hs-var">tc_name</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-4390"></span><span>            </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Enable TypeFamilyDependencies to allow result variable names&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-4391"></span><span class="annot"><a href="GHC.Tc.TyCl.html#checkResultSigFlag"><span class="hs-identifier hs-var">checkResultSigFlag</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">FamilyResultSig GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- other cases OK</span><span>
</span><span id="line-4392"></span><span>
</span><span id="line-4393"></span><span class="hs-comment">{- Note [Class method constraints]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Haskell 2010 is supposed to reject
  class C a where
    op :: Eq a =&gt; a -&gt; a
where the method type constrains only the class variable(s).  (The extension
-XConstrainedClassMethods switches off this check.)  But regardless
we should not reject
  class C a where
    op :: (?x::Int) =&gt; a -&gt; a
as pointed out in #11793. So the test here rejects the program if
  * -XConstrainedClassMethods is off
  * the tyvars of the constraint are non-empty
  * all the tyvars are class tyvars, none are locally quantified

Note [Abort when superclass cycle is detected]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We must avoid doing the ambiguity check for the methods (in
checkValidClass.check_op) when there are already errors accumulated.
This is because one of the errors may be a superclass cycle, and
superclass cycles cause canonicalization to loop. Here is a
representative example:

  class D a =&gt; C a where
    meth :: D a =&gt; ()
  class C a =&gt; D a

This fixes #9415, #9739

Note [Default method type signatures must align]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
GHC enforces the invariant that a class method's default type signature
must &quot;align&quot; with that of the method's non-default type signature, as per
GHC #12918. For instance, if you have:

  class Foo a where
    bar :: forall b. Context =&gt; a -&gt; b

Then a default type signature for bar must be alpha equivalent to
(forall b. a -&gt; b). That is, the types must be the same modulo differences in
contexts. So the following would be acceptable default type signatures:

    default bar :: forall b. Context1 =&gt; a -&gt; b
    default bar :: forall x. Context2 =&gt; a -&gt; x

But the following are NOT acceptable default type signatures:

    default bar :: forall b. b -&gt; a
    default bar :: forall x. x
    default bar :: a -&gt; Int

Note that a is bound by the class declaration for Foo itself, so it is
not allowed to differ in the default type signature.

The default type signature (default bar :: a -&gt; Int) deserves special mention,
since (a -&gt; Int) is a straightforward instantiation of (forall b. a -&gt; b). To
write this, you need to declare the default type signature like so:

    default bar :: forall b. (b ~ Int). a -&gt; b

As noted in #12918, there are several reasons to do this:

1. It would make no sense to have a type that was flat-out incompatible with
   the non-default type signature. For instance, if you had:

     class Foo a where
       bar :: a -&gt; Int
       default bar :: a -&gt; Bool

   Then that would always fail in an instance declaration. So this check
   nips such cases in the bud before they have the chance to produce
   confusing error messages.

2. Internally, GHC uses TypeApplications to instantiate the default method in
   an instance. See Note [Default methods in instances] in GHC.Tc.TyCl.Instance.
   Thus, GHC needs to know exactly what the universally quantified type
   variables are, and when instantiated that way, the default method's type
   must match the expected type.

3. Aesthetically, by only allowing the default type signature to differ in its
   context, we are making it more explicit the ways in which the default type
   signature is less polymorphic than the non-default type signature.

You might be wondering: why are the contexts allowed to be different, but not
the rest of the type signature? That's because default implementations often
rely on assumptions that the more general, non-default type signatures do not.
For instance, in the Enum class declaration:

    class Enum a where
      enum :: [a]
      default enum :: (Generic a, GEnum (Rep a)) =&gt; [a]
      enum = map to genum

    class GEnum f where
      genum :: [f a]

The default implementation for enum only works for types that are instances of
Generic, and for which their generic Rep type is an instance of GEnum. But
clearly enum doesn't _have_ to use this implementation, so naturally, the
context for enum is allowed to be different to accommodate this. As a result,
when we validity-check default type signatures, we ignore contexts completely.

Note that when checking whether two type signatures match, we must take care to
split as many foralls as it takes to retrieve the tau types we which to check.
See Note [Splitting nested sigma types in class type signatures].

Note [Splitting nested sigma types in class type signatures]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider this type synonym and class definition:

  type Traversal s t a b = forall f. Applicative f =&gt; (a -&gt; f b) -&gt; s -&gt; f t

  class Each s t a b where
    each         ::                                      Traversal s t a b
    default each :: (Traversable g, s ~ g a, t ~ g b) =&gt; Traversal s t a b

It might seem obvious that the tau types in both type signatures for `each`
are the same, but actually getting GHC to conclude this is surprisingly tricky.
That is because in general, the form of a class method's non-default type
signature is:

  forall a. C a =&gt; forall d. D d =&gt; E a b

And the general form of a default type signature is:

  forall f. F f =&gt; E a f -- The variable `a` comes from the class

So it you want to get the tau types in each type signature, you might find it
reasonable to call tcSplitSigmaTy twice on the non-default type signature, and
call it once on the default type signature. For most classes and methods, this
will work, but Each is a bit of an exceptional case. The way `each` is written,
it doesn't quantify any additional type variables besides those of the Each
class itself, so the non-default type signature for `each` is actually this:

  forall s t a b. Each s t a b =&gt; Traversal s t a b

Notice that there _appears_ to only be one forall. But there's actually another
forall lurking in the Traversal type synonym, so if you call tcSplitSigmaTy
twice, you'll also go under the forall in Traversal! That is, you'll end up
with:

  (a -&gt; f b) -&gt; s -&gt; f t

A problem arises because you only call tcSplitSigmaTy once on the default type
signature for `each`, which gives you

  Traversal s t a b

Or, equivalently:

  forall f. Applicative f =&gt; (a -&gt; f b) -&gt; s -&gt; f t

This is _not_ the same thing as (a -&gt; f b) -&gt; s -&gt; f t! So now tcMatchTy will
say that the tau types for `each` are not equal.

A solution to this problem is to use tcSplitNestedSigmaTys instead of
tcSplitSigmaTy. tcSplitNestedSigmaTys will always split any foralls that it
sees until it can't go any further, so if you called it on the default type
signature for `each`, it would return (a -&gt; f b) -&gt; s -&gt; f t like we desired.

Note [Checking partial record field]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
This check checks the partial record field selector, and warns (#7169).

For example:

  data T a = A { m1 :: a, m2 :: a } | B { m1 :: a }

The function 'm2' is partial record field, and will fail when it is applied to
'B'. The warning identifies such partial fields. The check is performed at the
declaration of T, not at the call-sites of m2.

The warning can be suppressed by prefixing the field-name with an underscore.
For example:

  data T a = A { m1 :: a, _m2 :: a } | B { m1 :: a }

************************************************************************
*                                                                      *
                Checking role validity
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-4576"></span><span>
</span><span id="line-4577"></span><span class="annot"><a href="GHC.Tc.TyCl.html#checkValidRoleAnnots"><span class="hs-identifier hs-type">checkValidRoleAnnots</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RoleAnnotEnv"><span class="hs-identifier hs-type">RoleAnnotEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-4578"></span><span id="checkValidRoleAnnots"><span class="annot"><span class="annottext">checkValidRoleAnnots :: RoleAnnotEnv -&gt; TyCon -&gt; TcRn ()
</span><a href="GHC.Tc.TyCl.html#checkValidRoleAnnots"><span class="hs-identifier hs-var hs-var">checkValidRoleAnnots</span></a></span></span><span> </span><span id="local-6989586621681165233"><span class="annot"><span class="annottext">RoleAnnotEnv
</span><a href="#local-6989586621681165233"><span class="hs-identifier hs-var">role_annots</span></a></span></span><span> </span><span id="local-6989586621681165232"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165232"><span class="hs-identifier hs-var">tc</span></a></span></span><span>
</span><span id="line-4579"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isTypeSynonymTyCon"><span class="hs-identifier hs-var">isTypeSynonymTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165232"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRn ()
</span><a href="#local-6989586621681165230"><span class="hs-identifier hs-var">check_no_roles</span></a></span><span>
</span><span id="line-4580"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isFamilyTyCon"><span class="hs-identifier hs-var">isFamilyTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165232"><span class="hs-identifier hs-var">tc</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRn ()
</span><a href="#local-6989586621681165230"><span class="hs-identifier hs-var">check_no_roles</span></a></span><span>
</span><span id="line-4581"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isAlgTyCon"><span class="hs-identifier hs-var">isAlgTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165232"><span class="hs-identifier hs-var">tc</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRn ()
</span><a href="#local-6989586621681165227"><span class="hs-identifier hs-var">check_roles</span></a></span><span>
</span><span id="line-4582"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-4583"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-4584"></span><span>    </span><span class="hs-comment">-- Role annotations are given only on *explicit* variables,</span><span>
</span><span id="line-4585"></span><span>    </span><span class="hs-comment">-- but a tycon stores roles for all variables.</span><span>
</span><span id="line-4586"></span><span>    </span><span class="hs-comment">-- So, we drop the implicit roles (which are all Nominal, anyway).</span><span>
</span><span id="line-4587"></span><span>    </span><span id="local-6989586621681165226"><span class="annot"><span class="annottext">name :: Name
</span><a href="#local-6989586621681165226"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Name
</span><a href="GHC.Core.TyCon.html#tyConName"><span class="hs-identifier hs-var hs-var">tyConName</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165232"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-4588"></span><span>    </span><span id="local-6989586621681165225"><span class="annot"><span class="annottext">roles :: [Role]
</span><a href="#local-6989586621681165225"><span class="hs-identifier hs-var hs-var">roles</span></a></span></span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Role]
</span><a href="GHC.Core.TyCon.html#tyConRoles"><span class="hs-identifier hs-var">tyConRoles</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165232"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-4589"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681165223"><span class="annot"><span class="annottext">[Role]
</span><a href="#local-6989586621681165223"><span class="hs-identifier hs-var">vis_roles</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681165222"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165222"><span class="hs-identifier hs-var">vis_vars</span></a></span></span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Role, TyVar)] -&gt; ([Role], [TyVar])
forall a b. [(a, b)] -&gt; ([a], [b])
</span><a href="../../base/src/GHC.List.html#unzip"><span class="hs-identifier hs-var">unzip</span></a></span><span> </span><span class="annot"><span class="annottext">([(Role, TyVar)] -&gt; ([Role], [TyVar]))
-&gt; [(Role, TyVar)] -&gt; ([Role], [TyVar])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">((Role, TyConBinder) -&gt; Maybe (Role, TyVar))
-&gt; [(Role, TyConBinder)] -&gt; [(Role, TyVar)]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/Data.Maybe.html#mapMaybe"><span class="hs-identifier hs-var">mapMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">(Role, TyConBinder) -&gt; Maybe (Role, TyVar)
</span><a href="#local-6989586621681165220"><span class="hs-identifier hs-var">pick_vis</span></a></span><span> </span><span class="annot"><span class="annottext">([(Role, TyConBinder)] -&gt; [(Role, TyVar)])
-&gt; [(Role, TyConBinder)] -&gt; [(Role, TyVar)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-4590"></span><span>                             </span><span class="annot"><span class="annottext">[Role] -&gt; [TyConBinder] -&gt; [(Role, TyConBinder)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../../base/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[Role]
</span><a href="#local-6989586621681165225"><span class="hs-identifier hs-var">roles</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [TyConBinder]
</span><a href="GHC.Core.TyCon.html#tyConBinders"><span class="hs-identifier hs-var hs-var">tyConBinders</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165232"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4591"></span><span>    </span><span id="local-6989586621681165219"><span class="annot"><span class="annottext">role_annot_decl_maybe :: Maybe (LRoleAnnotDecl GhcRn)
</span><a href="#local-6989586621681165219"><span class="hs-identifier hs-var hs-var">role_annot_decl_maybe</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RoleAnnotEnv -&gt; Name -&gt; Maybe (LRoleAnnotDecl GhcRn)
</span><a href="GHC.Tc.Types.html#lookupRoleAnnot"><span class="hs-identifier hs-var">lookupRoleAnnot</span></a></span><span> </span><span class="annot"><span class="annottext">RoleAnnotEnv
</span><a href="#local-6989586621681165233"><span class="hs-identifier hs-var">role_annots</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165226"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-4592"></span><span>
</span><span id="line-4593"></span><span>    </span><span class="annot"><a href="#local-6989586621681165220"><span class="hs-identifier hs-type">pick_vis</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyConBinder"><span class="hs-identifier hs-type">TyConBinder</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4594"></span><span>    </span><span id="local-6989586621681165220"><span class="annot"><span class="annottext">pick_vis :: (Role, TyConBinder) -&gt; Maybe (Role, TyVar)
</span><a href="#local-6989586621681165220"><span class="hs-identifier hs-var hs-var">pick_vis</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681165217"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681165217"><span class="hs-keyword hs-var">role</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681165216"><span class="annot"><span class="annottext">TyConBinder
</span><a href="#local-6989586621681165216"><span class="hs-identifier hs-var">tvb</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-4595"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyConBinder -&gt; Bool
forall tv. VarBndr tv TyConBndrVis -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isVisibleTyConBinder"><span class="hs-identifier hs-var">isVisibleTyConBinder</span></a></span><span> </span><span class="annot"><span class="annottext">TyConBinder
</span><a href="#local-6989586621681165216"><span class="hs-identifier hs-var">tvb</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Role, TyVar) -&gt; Maybe (Role, TyVar)
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681165217"><span class="hs-keyword hs-var">role</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyConBinder -&gt; TyVar
forall tv argf. VarBndr tv argf -&gt; tv
</span><a href="GHC.Types.Var.html#binderVar"><span class="hs-identifier hs-var">binderVar</span></a></span><span> </span><span class="annot"><span class="annottext">TyConBinder
</span><a href="#local-6989586621681165216"><span class="hs-identifier hs-var">tvb</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4596"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Role, TyVar)
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-4597"></span><span>
</span><span id="line-4598"></span><span>    </span><span id="local-6989586621681165227"><span class="annot"><span class="annottext">check_roles :: TcRn ()
</span><a href="#local-6989586621681165227"><span class="hs-identifier hs-var hs-var">check_roles</span></a></span></span><span>
</span><span id="line-4599"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (LRoleAnnotDecl GhcRn)
-&gt; (LRoleAnnotDecl GhcRn -&gt; TcRn ()) -&gt; TcRn ()
forall (m :: * -&gt; *) a. Monad m =&gt; Maybe a -&gt; (a -&gt; m ()) -&gt; m ()
</span><a href="GHC.Data.Maybe.html#whenIsJust"><span class="hs-identifier hs-var">whenIsJust</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (LRoleAnnotDecl GhcRn)
</span><a href="#local-6989586621681165219"><span class="hs-identifier hs-var">role_annot_decl_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">((LRoleAnnotDecl GhcRn -&gt; TcRn ()) -&gt; TcRn ())
-&gt; (LRoleAnnotDecl GhcRn -&gt; TcRn ()) -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-4600"></span><span>          </span><span class="hs-glyph">\</span><span id="local-6989586621681165213"><span class="annot"><span class="annottext">decl :: LRoleAnnotDecl GhcRn
</span><a href="#local-6989586621681165213"><span class="hs-identifier hs-var">decl</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681165212"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681165212"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Decls.html#RoleAnnotDecl"><span class="hs-identifier hs-type">RoleAnnotDecl</span></a></span><span> </span><span class="annot"><span class="annottext">XCRoleAnnotDecl GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpan (IdP GhcRn)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681165210"><span class="annot"><span class="annottext">[Located (Maybe Role)]
</span><a href="#local-6989586621681165210"><span class="hs-identifier hs-var">the_role_annots</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4601"></span><span>          </span><span class="annot"><span class="annottext">Name -&gt; TcRn () -&gt; TcRn ()
forall a. Name -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.TyCl.html#addRoleAnnotCtxt"><span class="hs-identifier hs-var">addRoleAnnotCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165226"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcRn ()) -&gt; TcRn () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-4602"></span><span>          </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcRn () -&gt; TcRn ()
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681165212"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcRn ()) -&gt; TcRn () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-4603"></span><span>          </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681165208"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681165208"><span class="hs-identifier hs-var">role_annots_ok</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall gbl lcl. Extension -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><a href="../../ghc-boot-th/src/GHC.LanguageExtensions.Type.html#RoleAnnotations"><span class="hs-identifier hs-var">LangExt.RoleAnnotations</span></a></span><span>
</span><span id="line-4604"></span><span>          </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681165208"><span class="hs-identifier hs-var">role_annots_ok</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; TcRn ()) -&gt; SDoc -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#needXRoleAnnotations"><span class="hs-identifier hs-var">needXRoleAnnotations</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165232"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-4605"></span><span>          </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165222"><span class="hs-identifier hs-var">vis_vars</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; [Located (Maybe Role)] -&gt; Bool
forall a b. [a] -&gt; [b] -&gt; Bool
</span><a href="GHC.Utils.Misc.html#equalLength"><span class="hs-operator hs-var">`equalLength`</span></a></span><span> </span><span class="annot"><span class="annottext">[Located (Maybe Role)]
</span><a href="#local-6989586621681165210"><span class="hs-identifier hs-var">the_role_annots</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4606"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyVar] -&gt; LRoleAnnotDecl GhcRn -&gt; SDoc
forall a. [a] -&gt; LRoleAnnotDecl GhcRn -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#wrongNumberOfRoles"><span class="hs-identifier hs-var">wrongNumberOfRoles</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165222"><span class="hs-identifier hs-var">vis_vars</span></a></span><span> </span><span class="annot"><span class="annottext">LRoleAnnotDecl GhcRn
</span><a href="#local-6989586621681165213"><span class="hs-identifier hs-var">decl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4607"></span><span>          </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">[()]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TyVar -&gt; Located (Maybe Role) -&gt; Role -&gt; TcRn ())
-&gt; [TyVar]
-&gt; [Located (Maybe Role)]
-&gt; [Role]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [()]
forall (m :: * -&gt; *) a b c d.
Monad m =&gt;
(a -&gt; b -&gt; c -&gt; m d) -&gt; [a] -&gt; [b] -&gt; [c] -&gt; m [d]
</span><a href="GHC.Utils.Monad.html#zipWith3M"><span class="hs-identifier hs-var">zipWith3M</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar -&gt; Located (Maybe Role) -&gt; Role -&gt; TcRn ()
</span><a href="GHC.Tc.TyCl.html#checkRoleAnnot"><span class="hs-identifier hs-var">checkRoleAnnot</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165222"><span class="hs-identifier hs-var">vis_vars</span></a></span><span> </span><span class="annot"><span class="annottext">[Located (Maybe Role)]
</span><a href="#local-6989586621681165210"><span class="hs-identifier hs-var">the_role_annots</span></a></span><span> </span><span class="annot"><span class="annottext">[Role]
</span><a href="#local-6989586621681165223"><span class="hs-identifier hs-var">vis_roles</span></a></span><span>
</span><span id="line-4608"></span><span>          </span><span class="hs-comment">-- Representational or phantom roles for class parameters</span><span>
</span><span id="line-4609"></span><span>          </span><span class="hs-comment">-- quickly lead to incoherence. So, we require</span><span>
</span><span id="line-4610"></span><span>          </span><span class="hs-comment">-- IncoherentInstances to have them. See #8773, #14292</span><span>
</span><span id="line-4611"></span><span>          </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681165201"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681165201"><span class="hs-identifier hs-var">incoherent_roles_ok</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall gbl lcl. Extension -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><a href="../../ghc-boot-th/src/GHC.LanguageExtensions.Type.html#IncoherentInstances"><span class="hs-identifier hs-var">LangExt.IncoherentInstances</span></a></span><span>
</span><span id="line-4612"></span><span>          </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a></span><span> </span><span class="hs-special">(</span><span>  </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681165201"><span class="hs-identifier hs-var">incoherent_roles_ok</span></a></span><span>
</span><span id="line-4613"></span><span>                    </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isClassTyCon"><span class="hs-identifier hs-var">isClassTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165232"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4614"></span><span>                    </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Role -&gt; Bool) -&gt; [Role] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#all"><span class="hs-identifier hs-var">all</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role -&gt; Role -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Role]
</span><a href="#local-6989586621681165223"><span class="hs-identifier hs-var">vis_roles</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-4615"></span><span>                    </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Tc.TyCl.html#incoherentRoles"><span class="hs-identifier hs-var">incoherentRoles</span></a></span><span>
</span><span id="line-4616"></span><span>
</span><span id="line-4617"></span><span>          </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681165198"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681165198"><span class="hs-identifier hs-var">lint</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall gbl lcl. GeneralFlag -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#goptM"><span class="hs-identifier hs-var">goptM</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_DoCoreLinting"><span class="hs-identifier hs-var">Opt_DoCoreLinting</span></a></span><span>
</span><span id="line-4618"></span><span>          </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRn () -&gt; TcRn ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681165198"><span class="hs-identifier hs-var">lint</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcRn ()) -&gt; TcRn () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TcRn ()
</span><a href="GHC.Tc.TyCl.html#checkValidRoles"><span class="hs-identifier hs-var">checkValidRoles</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165232"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-4619"></span><span>
</span><span id="line-4620"></span><span>    </span><span id="local-6989586621681165230"><span class="annot"><span class="annottext">check_no_roles :: TcRn ()
</span><a href="#local-6989586621681165230"><span class="hs-identifier hs-var hs-var">check_no_roles</span></a></span></span><span>
</span><span id="line-4621"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (LRoleAnnotDecl GhcRn)
-&gt; (LRoleAnnotDecl GhcRn -&gt; TcRn ()) -&gt; TcRn ()
forall (m :: * -&gt; *) a. Monad m =&gt; Maybe a -&gt; (a -&gt; m ()) -&gt; m ()
</span><a href="GHC.Data.Maybe.html#whenIsJust"><span class="hs-identifier hs-var">whenIsJust</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (LRoleAnnotDecl GhcRn)
</span><a href="#local-6989586621681165219"><span class="hs-identifier hs-var">role_annot_decl_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">LRoleAnnotDecl GhcRn -&gt; TcRn ()
</span><a href="GHC.Tc.TyCl.html#illegalRoleAnnotDecl"><span class="hs-identifier hs-var">illegalRoleAnnotDecl</span></a></span><span>
</span><span id="line-4622"></span><span>
</span><span id="line-4623"></span><span class="annot"><a href="GHC.Tc.TyCl.html#checkRoleAnnot"><span class="hs-identifier hs-type">checkRoleAnnot</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-4624"></span><span id="checkRoleAnnot"><span class="annot"><span class="annottext">checkRoleAnnot :: TyVar -&gt; Located (Maybe Role) -&gt; Role -&gt; TcRn ()
</span><a href="GHC.Tc.TyCl.html#checkRoleAnnot"><span class="hs-identifier hs-var hs-var">checkRoleAnnot</span></a></span></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe Role
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span>   </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-4625"></span><span class="annot"><a href="GHC.Tc.TyCl.html#checkRoleAnnot"><span class="hs-identifier hs-var">checkRoleAnnot</span></a></span><span> </span><span id="local-6989586621681165193"><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681165193"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681165192"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681165192"><span class="hs-identifier hs-var">r1</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621681165191"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681165191"><span class="hs-identifier hs-var">r2</span></a></span></span><span>
</span><span id="line-4626"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRn () -&gt; TcRn ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681165192"><span class="hs-identifier hs-var">r1</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; Role -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681165191"><span class="hs-identifier hs-var">r2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcRn ()) -&gt; TcRn () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-4627"></span><span>    </span><span class="annot"><span class="annottext">SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrTc"><span class="hs-identifier hs-var">addErrTc</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; TcRn ()) -&gt; SDoc -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Role -&gt; Role -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#badRoleAnnot"><span class="hs-identifier hs-var">badRoleAnnot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyVar -&gt; Name
</span><a href="GHC.Types.Var.html#tyVarName"><span class="hs-identifier hs-var">tyVarName</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681165193"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681165192"><span class="hs-identifier hs-var">r1</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681165191"><span class="hs-identifier hs-var">r2</span></a></span><span>
</span><span id="line-4628"></span><span>
</span><span id="line-4629"></span><span class="hs-comment">-- This is a double-check on the role inference algorithm. It is only run when</span><span>
</span><span id="line-4630"></span><span class="hs-comment">-- -dcore-lint is enabled. See Note [Role inference] in GHC.Tc.TyCl.Utils</span><span>
</span><span id="line-4631"></span><span class="annot"><a href="GHC.Tc.TyCl.html#checkValidRoles"><span class="hs-identifier hs-type">checkValidRoles</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-4632"></span><span class="hs-comment">-- If you edit this function, you may need to update the GHC formalism</span><span>
</span><span id="line-4633"></span><span class="hs-comment">-- See Note [GHC Formalism] in GHC.Core.Lint</span><span>
</span><span id="line-4634"></span><span id="checkValidRoles"><span class="annot"><span class="annottext">checkValidRoles :: TyCon -&gt; TcRn ()
</span><a href="GHC.Tc.TyCl.html#checkValidRoles"><span class="hs-identifier hs-var hs-var">checkValidRoles</span></a></span></span><span> </span><span id="local-6989586621681165189"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165189"><span class="hs-identifier hs-var">tc</span></a></span></span><span>
</span><span id="line-4635"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isAlgTyCon"><span class="hs-identifier hs-var">isAlgTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165189"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-4636"></span><span>    </span><span class="hs-comment">-- tyConDataCons returns an empty list for data families</span><span>
</span><span id="line-4637"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DataCon -&gt; TcRn ()) -&gt; [DataCon] -&gt; TcRn ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><a href="../../base/src/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; TcRn ()
</span><a href="#local-6989586621681165188"><span class="hs-identifier hs-var">check_dc_roles</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [DataCon]
</span><a href="GHC.Core.TyCon.html#tyConDataCons"><span class="hs-identifier hs-var">tyConDataCons</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165189"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4638"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681165187"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165187"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Maybe Type
</span><a href="GHC.Core.TyCon.html#synTyConRhs_maybe"><span class="hs-identifier hs-var">synTyConRhs_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165189"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-4639"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarEnv Role -&gt; Role -&gt; Type -&gt; TcRn ()
</span><a href="#local-6989586621681165186"><span class="hs-identifier hs-var">check_ty_roles</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyVar] -&gt; [Role] -&gt; VarEnv Role
forall a. [TyVar] -&gt; [a] -&gt; VarEnv a
</span><a href="GHC.Types.Var.Env.html#zipVarEnv"><span class="hs-identifier hs-var">zipVarEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [TyVar]
</span><a href="GHC.Core.TyCon.html#tyConTyVars"><span class="hs-identifier hs-var hs-var">tyConTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165189"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Role]
</span><a href="GHC.Core.TyCon.html#tyConRoles"><span class="hs-identifier hs-var">tyConRoles</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165189"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165187"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-4640"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-4641"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-4642"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-4643"></span><span>    </span><span id="local-6989586621681165188"><span class="annot"><span class="annottext">check_dc_roles :: DataCon -&gt; TcRn ()
</span><a href="#local-6989586621681165188"><span class="hs-identifier hs-var hs-var">check_dc_roles</span></a></span></span><span> </span><span id="local-6989586621681165183"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165183"><span class="hs-identifier hs-var">datacon</span></a></span></span><span>
</span><span id="line-4644"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;check_dc_roles&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165183"><span class="hs-identifier hs-var">datacon</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Role] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Role]
</span><a href="GHC.Core.TyCon.html#tyConRoles"><span class="hs-identifier hs-var">tyConRoles</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165189"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-4645"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; TcRn ()) -&gt; [Type] -&gt; TcRn ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><a href="../../base/src/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarEnv Role -&gt; Role -&gt; Type -&gt; TcRn ()
</span><a href="#local-6989586621681165186"><span class="hs-identifier hs-var">check_ty_roles</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv Role
</span><a href="#local-6989586621681165182"><span class="hs-identifier hs-var">role_env</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Type] -&gt; TcRn ()) -&gt; [Type] -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-4646"></span><span>                    </span><span class="annot"><span class="annottext">[EqSpec] -&gt; [Type]
</span><a href="GHC.Core.DataCon.html#eqSpecPreds"><span class="hs-identifier hs-var">eqSpecPreds</span></a></span><span> </span><span class="annot"><span class="annottext">[EqSpec]
</span><a href="#local-6989586621681165180"><span class="hs-identifier hs-var">eq_spec</span></a></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; [Type] -&gt; [Type]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681165179"><span class="hs-identifier hs-var">theta</span></a></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; [Type] -&gt; [Type]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Scaled Type -&gt; Type) -&gt; [Scaled Type] -&gt; [Type]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled Type -&gt; Type
forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621681165178"><span class="hs-identifier hs-var">arg_tys</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-4647"></span><span>                    </span><span class="hs-comment">-- See Note [Role-checking data constructor arguments] in GHC.Tc.TyCl.Utils</span><span>
</span><span id="line-4648"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-4649"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621681165177"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165177"><span class="hs-identifier hs-var">univ_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681165176"><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165176"><span class="hs-identifier hs-var">ex_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681165180"><span class="annot"><span class="annottext">[EqSpec]
</span><a href="#local-6989586621681165180"><span class="hs-identifier hs-var">eq_spec</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681165179"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681165179"><span class="hs-identifier hs-var">theta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681165178"><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621681165178"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681165175"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165175"><span class="hs-identifier hs-var">_res_ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-4650"></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon
-&gt; ([TyVar], [TyVar], [EqSpec], [Type], [Scaled Type], Type)
</span><a href="GHC.Core.DataCon.html#dataConFullSig"><span class="hs-identifier hs-var">dataConFullSig</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165183"><span class="hs-identifier hs-var">datacon</span></a></span><span>
</span><span id="line-4651"></span><span>        </span><span id="local-6989586621681165174"><span class="annot"><span class="annottext">univ_roles :: VarEnv Role
</span><a href="#local-6989586621681165174"><span class="hs-identifier hs-var hs-var">univ_roles</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyVar] -&gt; [Role] -&gt; VarEnv Role
forall a. [TyVar] -&gt; [a] -&gt; VarEnv a
</span><a href="GHC.Types.Var.Env.html#zipVarEnv"><span class="hs-identifier hs-var">zipVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165177"><span class="hs-identifier hs-var">univ_tvs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Role]
</span><a href="GHC.Core.TyCon.html#tyConRoles"><span class="hs-identifier hs-var">tyConRoles</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165189"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4652"></span><span>              </span><span class="hs-comment">-- zipVarEnv uses zipEqual, but we don't want that for ex_tvs</span><span>
</span><span id="line-4653"></span><span>        </span><span id="local-6989586621681165173"><span class="annot"><span class="annottext">ex_roles :: VarEnv Role
</span><a href="#local-6989586621681165173"><span class="hs-identifier hs-var hs-var">ex_roles</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(TyVar, Role)] -&gt; VarEnv Role
forall a. [(TyVar, a)] -&gt; VarEnv a
</span><a href="GHC.Types.Var.Env.html#mkVarEnv"><span class="hs-identifier hs-var">mkVarEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TyVar -&gt; (TyVar, Role)) -&gt; [TyVar] -&gt; [(TyVar, Role)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-special">,</span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TyVar]
</span><a href="#local-6989586621681165176"><span class="hs-identifier hs-var">ex_tvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4654"></span><span>        </span><span id="local-6989586621681165182"><span class="annot"><span class="annottext">role_env :: VarEnv Role
</span><a href="#local-6989586621681165182"><span class="hs-identifier hs-var hs-var">role_env</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarEnv Role
</span><a href="#local-6989586621681165174"><span class="hs-identifier hs-var">univ_roles</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv Role -&gt; VarEnv Role -&gt; VarEnv Role
forall a. VarEnv a -&gt; VarEnv a -&gt; VarEnv a
</span><a href="GHC.Types.Var.Env.html#plusVarEnv"><span class="hs-operator hs-var">`plusVarEnv`</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv Role
</span><a href="#local-6989586621681165173"><span class="hs-identifier hs-var">ex_roles</span></a></span><span>
</span><span id="line-4655"></span><span>
</span><span id="line-4656"></span><span>    </span><span id="local-6989586621681165186"><span class="annot"><span class="annottext">check_ty_roles :: VarEnv Role -&gt; Role -&gt; Type -&gt; TcRn ()
</span><a href="#local-6989586621681165186"><span class="hs-identifier hs-var hs-var">check_ty_roles</span></a></span></span><span> </span><span id="local-6989586621681165146"><span class="annot"><span class="annottext">VarEnv Role
</span><a href="#local-6989586621681165146"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621681165145"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681165145"><span class="hs-keyword hs-var">role</span></a></span></span><span> </span><span id="local-6989586621681165144"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165144"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-4657"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681165143"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165143"><span class="hs-identifier hs-var">ty'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe Type
</span><a href="GHC.Core.Type.html#coreView"><span class="hs-identifier hs-var">coreView</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165144"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-comment">-- #14101</span><span>
</span><span id="line-4658"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarEnv Role -&gt; Role -&gt; Type -&gt; TcRn ()
</span><a href="#local-6989586621681165186"><span class="hs-identifier hs-var">check_ty_roles</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv Role
</span><a href="#local-6989586621681165146"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681165145"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165143"><span class="hs-identifier hs-var">ty'</span></a></span><span>
</span><span id="line-4659"></span><span>
</span><span id="line-4660"></span><span>    </span><span class="annot"><a href="#local-6989586621681165186"><span class="hs-identifier hs-var">check_ty_roles</span></a></span><span> </span><span id="local-6989586621681165141"><span class="annot"><span class="annottext">VarEnv Role
</span><a href="#local-6989586621681165141"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621681165140"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681165140"><span class="hs-keyword hs-var">role</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyVarTy"><span class="hs-identifier hs-type">TyVarTy</span></a></span><span> </span><span id="local-6989586621681165138"><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681165138"><span class="hs-identifier hs-var">tv</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-4661"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">VarEnv Role -&gt; TyVar -&gt; Maybe Role
forall a. VarEnv a -&gt; TyVar -&gt; Maybe a
</span><a href="GHC.Types.Var.Env.html#lookupVarEnv"><span class="hs-identifier hs-var">lookupVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv Role
</span><a href="#local-6989586621681165141"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681165138"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-4662"></span><span>          </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681165137"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681165137"><span class="hs-identifier hs-var">role'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRn () -&gt; TcRn ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base/src/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681165137"><span class="hs-identifier hs-var">role'</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; Role -&gt; Bool
</span><a href="GHC.Core.Coercion.html#ltRole"><span class="hs-operator hs-var">`ltRole`</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681165140"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681165137"><span class="hs-identifier hs-var">role'</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; Role -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681165140"><span class="hs-keyword hs-var">role</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcRn ()) -&gt; TcRn () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-4663"></span><span>                        </span><span class="annot"><span class="annottext">SDoc -&gt; TcRn ()
</span><a href="#local-6989586621681165135"><span class="hs-identifier hs-var">report_error</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; TcRn ()) -&gt; SDoc -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;type variable&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyVar -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681165138"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-4664"></span><span>                                       </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;cannot have role&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681165140"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-4665"></span><span>                                       </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;because it was assigned role&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681165137"><span class="hs-identifier hs-var">role'</span></a></span><span>
</span><span id="line-4666"></span><span>          </span><span class="annot"><span class="annottext">Maybe Role
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcRn ()
</span><a href="#local-6989586621681165135"><span class="hs-identifier hs-var">report_error</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; TcRn ()) -&gt; SDoc -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;type variable&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyVar -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681165138"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-4667"></span><span>                                       </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;missing in environment&quot;</span></span><span>
</span><span id="line-4668"></span><span>
</span><span id="line-4669"></span><span>    </span><span class="annot"><a href="#local-6989586621681165186"><span class="hs-identifier hs-var">check_ty_roles</span></a></span><span> </span><span id="local-6989586621681165134"><span class="annot"><span class="annottext">VarEnv Role
</span><a href="#local-6989586621681165134"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyConApp"><span class="hs-identifier hs-type">TyConApp</span></a></span><span> </span><span id="local-6989586621681165132"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165132"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621681165131"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681165131"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-4670"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681165130"><span class="annot"><span class="annottext">roles' :: [Role]
</span><a href="#local-6989586621681165130"><span class="hs-identifier hs-var hs-var">roles'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Role]
</span><a href="GHC.Core.TyCon.html#tyConRoles"><span class="hs-identifier hs-var">tyConRoles</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165132"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-4671"></span><span>        </span><span class="annot"><span class="annottext">(Role -&gt; Type -&gt; TcRn ()) -&gt; [Role] -&gt; [Type] -&gt; TcRn ()
forall (m :: * -&gt; *) a b c.
Applicative m =&gt;
(a -&gt; b -&gt; m c) -&gt; [a] -&gt; [b] -&gt; m ()
</span><a href="../../base/src/Control.Monad.html#zipWithM_"><span class="hs-identifier hs-var">zipWithM_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarEnv Role -&gt; Role -&gt; Type -&gt; TcRn ()
</span><a href="#local-6989586621681165128"><span class="hs-identifier hs-var">maybe_check_ty_roles</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv Role
</span><a href="#local-6989586621681165134"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Role]
</span><a href="#local-6989586621681165130"><span class="hs-identifier hs-var">roles'</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681165131"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-4672"></span><span>
</span><span id="line-4673"></span><span>    </span><span class="annot"><a href="#local-6989586621681165186"><span class="hs-identifier hs-var">check_ty_roles</span></a></span><span> </span><span id="local-6989586621681165127"><span class="annot"><span class="annottext">VarEnv Role
</span><a href="#local-6989586621681165127"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyConApp"><span class="hs-identifier hs-type">TyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681165126"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681165126"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-4674"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; TcRn ()) -&gt; [Type] -&gt; TcRn ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><a href="../../base/src/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarEnv Role -&gt; Role -&gt; Type -&gt; TcRn ()
</span><a href="#local-6989586621681165186"><span class="hs-identifier hs-var">check_ty_roles</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv Role
</span><a href="#local-6989586621681165127"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681165126"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-4675"></span><span>
</span><span id="line-4676"></span><span>    </span><span class="annot"><a href="#local-6989586621681165186"><span class="hs-identifier hs-var">check_ty_roles</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv Role
</span><span class="hs-identifier">_</span></span><span>   </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Phantom"><span class="hs-identifier hs-var">Phantom</span></a></span><span> </span><span id="local-6989586621681165124"><span class="annot"><span class="annottext">ty :: Type
</span><a href="#local-6989586621681165124"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyConApp"><span class="hs-identifier hs-type">TyConApp</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-4677"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;check_ty_roles&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165124"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4678"></span><span>
</span><span id="line-4679"></span><span>    </span><span class="annot"><a href="#local-6989586621681165186"><span class="hs-identifier hs-var">check_ty_roles</span></a></span><span> </span><span id="local-6989586621681165123"><span class="annot"><span class="annottext">VarEnv Role
</span><a href="#local-6989586621681165123"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621681165122"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681165122"><span class="hs-keyword hs-var">role</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AppTy"><span class="hs-identifier hs-type">AppTy</span></a></span><span> </span><span id="local-6989586621681165120"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165120"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621681165119"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165119"><span class="hs-identifier hs-var">ty2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-4680"></span><span>      </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">VarEnv Role -&gt; Role -&gt; Type -&gt; TcRn ()
</span><a href="#local-6989586621681165186"><span class="hs-identifier hs-var">check_ty_roles</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv Role
</span><a href="#local-6989586621681165123"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681165122"><span class="hs-keyword hs-var">role</span></a></span><span>    </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165120"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-4681"></span><span>      </span><span class="annot"><span class="annottext">TcRn () -&gt; TcRn () -&gt; TcRn ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><a href="../../base/src/GHC.Base.html#%3E%3E"><span class="hs-operator hs-var">&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv Role -&gt; Role -&gt; Type -&gt; TcRn ()
</span><a href="#local-6989586621681165186"><span class="hs-identifier hs-var">check_ty_roles</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv Role
</span><a href="#local-6989586621681165123"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165119"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-4682"></span><span>
</span><span id="line-4683"></span><span>    </span><span class="annot"><a href="#local-6989586621681165186"><span class="hs-identifier hs-var">check_ty_roles</span></a></span><span> </span><span id="local-6989586621681165118"><span class="annot"><span class="annottext">VarEnv Role
</span><a href="#local-6989586621681165118"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621681165117"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681165117"><span class="hs-keyword hs-var">role</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#FunTy"><span class="hs-identifier hs-type">FunTy</span></a></span><span> </span><span class="annot"><span class="annottext">AnonArgFlag
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681165115"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165115"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621681165114"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165114"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span id="local-6989586621681165113"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165113"><span class="hs-identifier hs-var">ty2</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-4684"></span><span>      </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">VarEnv Role -&gt; Role -&gt; Type -&gt; TcRn ()
</span><a href="#local-6989586621681165186"><span class="hs-identifier hs-var">check_ty_roles</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv Role
</span><a href="#local-6989586621681165118"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165115"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-4685"></span><span>      </span><span class="annot"><span class="annottext">TcRn () -&gt; TcRn () -&gt; TcRn ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><a href="../../base/src/GHC.Base.html#%3E%3E"><span class="hs-operator hs-var">&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv Role -&gt; Role -&gt; Type -&gt; TcRn ()
</span><a href="#local-6989586621681165186"><span class="hs-identifier hs-var">check_ty_roles</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv Role
</span><a href="#local-6989586621681165118"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681165117"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165114"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-4686"></span><span>      </span><span class="annot"><span class="annottext">TcRn () -&gt; TcRn () -&gt; TcRn ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><a href="../../base/src/GHC.Base.html#%3E%3E"><span class="hs-operator hs-var">&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv Role -&gt; Role -&gt; Type -&gt; TcRn ()
</span><a href="#local-6989586621681165186"><span class="hs-identifier hs-var">check_ty_roles</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv Role
</span><a href="#local-6989586621681165118"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681165117"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165113"><span class="hs-identifier hs-var">ty2</span></a></span><span>
</span><span id="line-4687"></span><span>
</span><span id="line-4688"></span><span>    </span><span class="annot"><a href="#local-6989586621681165186"><span class="hs-identifier hs-var">check_ty_roles</span></a></span><span> </span><span id="local-6989586621681165112"><span class="annot"><span class="annottext">VarEnv Role
</span><a href="#local-6989586621681165112"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621681165111"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681165111"><span class="hs-keyword hs-var">role</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ForAllTy"><span class="hs-identifier hs-type">ForAllTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-type">Bndr</span></a></span><span> </span><span id="local-6989586621681165108"><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681165108"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="annot"><span class="annottext">ArgFlag
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681165107"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165107"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-4689"></span><span>      </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">VarEnv Role -&gt; Role -&gt; Type -&gt; TcRn ()
</span><a href="#local-6989586621681165186"><span class="hs-identifier hs-var">check_ty_roles</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv Role
</span><a href="#local-6989586621681165112"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyVar -&gt; Type
</span><a href="GHC.Types.Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681165108"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4690"></span><span>      </span><span class="annot"><span class="annottext">TcRn () -&gt; TcRn () -&gt; TcRn ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><a href="../../base/src/GHC.Base.html#%3E%3E"><span class="hs-operator hs-var">&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv Role -&gt; Role -&gt; Type -&gt; TcRn ()
</span><a href="#local-6989586621681165186"><span class="hs-identifier hs-var">check_ty_roles</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">VarEnv Role -&gt; TyVar -&gt; Role -&gt; VarEnv Role
forall a. VarEnv a -&gt; TyVar -&gt; a -&gt; VarEnv a
</span><a href="GHC.Types.Var.Env.html#extendVarEnv"><span class="hs-identifier hs-var">extendVarEnv</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv Role
</span><a href="#local-6989586621681165112"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681165108"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681165111"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165107"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-4691"></span><span>
</span><span id="line-4692"></span><span>    </span><span class="annot"><a href="#local-6989586621681165186"><span class="hs-identifier hs-var">check_ty_roles</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv Role
</span><span class="hs-identifier">_</span></span><span>   </span><span class="annot"><span class="annottext">Role
</span><span class="hs-identifier">_</span></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#LitTy"><span class="hs-identifier hs-type">LitTy</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-4693"></span><span>
</span><span id="line-4694"></span><span>    </span><span class="annot"><a href="#local-6989586621681165186"><span class="hs-identifier hs-var">check_ty_roles</span></a></span><span> </span><span id="local-6989586621681165104"><span class="annot"><span class="annottext">VarEnv Role
</span><a href="#local-6989586621681165104"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621681165103"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681165103"><span class="hs-keyword hs-var">role</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CastTy"><span class="hs-identifier hs-type">CastTy</span></a></span><span> </span><span id="local-6989586621681165101"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165101"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-4695"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarEnv Role -&gt; Role -&gt; Type -&gt; TcRn ()
</span><a href="#local-6989586621681165186"><span class="hs-identifier hs-var">check_ty_roles</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv Role
</span><a href="#local-6989586621681165104"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681165103"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165101"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-4696"></span><span>
</span><span id="line-4697"></span><span>    </span><span class="annot"><a href="#local-6989586621681165186"><span class="hs-identifier hs-var">check_ty_roles</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv Role
</span><span class="hs-identifier">_</span></span><span>   </span><span id="local-6989586621681165100"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681165100"><span class="hs-keyword hs-var">role</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionTy"><span class="hs-identifier hs-type">CoercionTy</span></a></span><span> </span><span id="local-6989586621681165098"><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681165098"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-4698"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRn () -&gt; TcRn ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base/src/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681165100"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; Role -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Phantom"><span class="hs-identifier hs-var">Phantom</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcRn ()) -&gt; TcRn () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-4699"></span><span>        </span><span class="annot"><span class="annottext">SDoc -&gt; TcRn ()
</span><a href="#local-6989586621681165135"><span class="hs-identifier hs-var">report_error</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; TcRn ()) -&gt; SDoc -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;coercion&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Coercion
</span><a href="#local-6989586621681165098"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;has bad role&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681165100"><span class="hs-keyword hs-var">role</span></a></span><span>
</span><span id="line-4700"></span><span>
</span><span id="line-4701"></span><span>    </span><span id="local-6989586621681165128"><span class="annot"><span class="annottext">maybe_check_ty_roles :: VarEnv Role -&gt; Role -&gt; Type -&gt; TcRn ()
</span><a href="#local-6989586621681165128"><span class="hs-identifier hs-var hs-var">maybe_check_ty_roles</span></a></span></span><span> </span><span id="local-6989586621681165097"><span class="annot"><span class="annottext">VarEnv Role
</span><a href="#local-6989586621681165097"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621681165096"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681165096"><span class="hs-keyword hs-var">role</span></a></span></span><span> </span><span id="local-6989586621681165095"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165095"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-4702"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRn () -&gt; TcRn ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681165096"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; Role -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681165096"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; Role -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcRn ()) -&gt; TcRn () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-4703"></span><span>        </span><span class="annot"><span class="annottext">VarEnv Role -&gt; Role -&gt; Type -&gt; TcRn ()
</span><a href="#local-6989586621681165186"><span class="hs-identifier hs-var">check_ty_roles</span></a></span><span> </span><span class="annot"><span class="annottext">VarEnv Role
</span><a href="#local-6989586621681165097"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681165096"><span class="hs-keyword hs-var">role</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165095"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-4704"></span><span>
</span><span id="line-4705"></span><span>    </span><span id="local-6989586621681165135"><span class="annot"><span class="annottext">report_error :: SDoc -&gt; TcRn ()
</span><a href="#local-6989586621681165135"><span class="hs-identifier hs-var hs-var">report_error</span></a></span></span><span> </span><span id="local-6989586621681165094"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681165094"><span class="hs-identifier hs-var">doc</span></a></span></span><span>
</span><span id="line-4706"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrTc"><span class="hs-identifier hs-var">addErrTc</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; TcRn ()) -&gt; SDoc -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Internal error in role inference:&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-4707"></span><span>                         </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681165094"><span class="hs-identifier hs-var">doc</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-4708"></span><span>                         </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Please report this as a GHC bug:  https://www.haskell.org/ghc/reportabug&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-4709"></span><span>
</span><span id="line-4710"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Error messages
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-4717"></span><span>
</span><span id="line-4718"></span><span class="annot"><a href="GHC.Tc.TyCl.html#tcMkDeclCtxt"><span class="hs-identifier hs-type">tcMkDeclCtxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Decls.html#TyClDecl"><span class="hs-identifier hs-type">TyClDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-4719"></span><span id="tcMkDeclCtxt"><span class="annot"><span class="annottext">tcMkDeclCtxt :: TyClDecl GhcRn -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#tcMkDeclCtxt"><span class="hs-identifier hs-var hs-var">tcMkDeclCtxt</span></a></span></span><span> </span><span id="local-6989586621681165093"><span class="annot"><span class="annottext">TyClDecl GhcRn
</span><a href="#local-6989586621681165093"><span class="hs-identifier hs-var">decl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hsep"><span class="hs-identifier hs-var">hsep</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;In the&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TyClDecl GhcRn -&gt; SDoc
forall (p :: Pass). TyClDecl (GhcPass p) -&gt; SDoc
</span><a href="GHC.Hs.Decls.html#pprTyClDeclFlavour"><span class="hs-identifier hs-var">pprTyClDeclFlavour</span></a></span><span> </span><span class="annot"><span class="annottext">TyClDecl GhcRn
</span><a href="#local-6989586621681165093"><span class="hs-identifier hs-var">decl</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-4720"></span><span>                      </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;declaration for&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyClDecl GhcRn -&gt; IdP GhcRn
forall (p :: Pass). TyClDecl (GhcPass p) -&gt; IdP (GhcPass p)
</span><a href="GHC.Hs.Decls.html#tcdName"><span class="hs-identifier hs-var">tcdName</span></a></span><span> </span><span class="annot"><span class="annottext">TyClDecl GhcRn
</span><a href="#local-6989586621681165093"><span class="hs-identifier hs-var">decl</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-4721"></span><span>
</span><span id="line-4722"></span><span id="local-6989586621681165090"><span class="annot"><a href="GHC.Tc.TyCl.html#addVDQNote"><span class="hs-identifier hs-type">addVDQNote</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcTyCon"><span class="hs-identifier hs-type">TcTyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681165090"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681165090"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-4723"></span><span class="hs-comment">-- See Note [Inferring visible dependent quantification]</span><span>
</span><span id="line-4724"></span><span class="hs-comment">-- Only types without a signature (CUSK or SAK) here</span><span>
</span><span id="line-4725"></span><span id="addVDQNote"><span class="annot"><span class="annottext">addVDQNote :: forall a. TyCon -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.TyCl.html#addVDQNote"><span class="hs-identifier hs-var hs-var">addVDQNote</span></a></span></span><span> </span><span id="local-6989586621681165080"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165080"><span class="hs-identifier hs-var">tycon</span></a></span></span><span> </span><span id="local-6989586621681165079"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681165079"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-4726"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isTcTyCon</span><span> </span><span class="hs-identifier">tycon</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">tycon</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-4727"></span><span>    </span><span class="hs-identifier">ASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">tcTyConIsPoly</span><span> </span><span class="hs-identifier">tycon</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">tycon</span><span> </span><span class="hs-operator">$$</span><span> </span><span class="hs-identifier">ppr</span><span> </span><span class="hs-identifier">tc_kind</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-4728"></span><span>    </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681165076"><span class="hs-identifier hs-var">has_vdq</span></a></span><span>
</span><span id="line-4729"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcM a -&gt; TcM a
forall a. SDoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addLandmarkErrCtxt"><span class="hs-identifier hs-var">addLandmarkErrCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681165074"><span class="hs-identifier hs-var">vdq_warning</span></a></span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681165079"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-4730"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-4731"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681165079"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-4732"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-4733"></span><span>      </span><span class="hs-comment">-- Check whether a tycon has visible dependent quantification.</span><span>
</span><span id="line-4734"></span><span>      </span><span class="hs-comment">-- This will *always* be a TcTyCon. Furthermore, it will *always*</span><span>
</span><span id="line-4735"></span><span>      </span><span class="hs-comment">-- be an ungeneralised TcTyCon, straight out of kcInferDeclHeader.</span><span>
</span><span id="line-4736"></span><span>      </span><span class="hs-comment">-- Thus, all the TyConBinders will be anonymous. Thus, the</span><span>
</span><span id="line-4737"></span><span>      </span><span class="hs-comment">-- free variables of the tycon's kind will be the same as the free</span><span>
</span><span id="line-4738"></span><span>      </span><span class="hs-comment">-- variables from all the binders.</span><span>
</span><span id="line-4739"></span><span>    </span><span id="local-6989586621681165076"><span class="annot"><span class="annottext">has_vdq :: Bool
</span><a href="#local-6989586621681165076"><span class="hs-identifier hs-var hs-var">has_vdq</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TyConBinder -&gt; Bool) -&gt; [TyConBinder] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a></span><span> </span><span class="annot"><span class="annottext">TyConBinder -&gt; Bool
</span><a href="#local-6989586621681165073"><span class="hs-identifier hs-var">is_vdq_tcb</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [TyConBinder]
</span><a href="GHC.Core.TyCon.html#tyConBinders"><span class="hs-identifier hs-var hs-var">tyConBinders</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165080"><span class="hs-identifier hs-var">tycon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4740"></span><span>    </span><span id="local-6989586621681165077"><span class="annot"><span class="annottext">tc_kind :: Type
</span><a href="#local-6989586621681165077"><span class="hs-identifier hs-var hs-var">tc_kind</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Type
</span><a href="GHC.Core.TyCon.html#tyConKind"><span class="hs-identifier hs-var hs-var">tyConKind</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165080"><span class="hs-identifier hs-var">tycon</span></a></span><span>
</span><span id="line-4741"></span><span>    </span><span id="local-6989586621681165072"><span class="annot"><span class="annottext">kind_fvs :: VarSet
</span><a href="#local-6989586621681165072"><span class="hs-identifier hs-var hs-var">kind_fvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165077"><span class="hs-identifier hs-var">tc_kind</span></a></span><span>
</span><span id="line-4742"></span><span>
</span><span id="line-4743"></span><span>    </span><span id="local-6989586621681165073"><span class="annot"><span class="annottext">is_vdq_tcb :: TyConBinder -&gt; Bool
</span><a href="#local-6989586621681165073"><span class="hs-identifier hs-var hs-var">is_vdq_tcb</span></a></span></span><span> </span><span id="local-6989586621681165071"><span class="annot"><span class="annottext">TyConBinder
</span><a href="#local-6989586621681165071"><span class="hs-identifier hs-var">tcb</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyConBinder -&gt; TyVar
forall tv argf. VarBndr tv argf -&gt; tv
</span><a href="GHC.Types.Var.html#binderVar"><span class="hs-identifier hs-var">binderVar</span></a></span><span> </span><span class="annot"><span class="annottext">TyConBinder
</span><a href="#local-6989586621681165071"><span class="hs-identifier hs-var">tcb</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar -&gt; VarSet -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#elemVarSet"><span class="hs-operator hs-var">`elemVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621681165072"><span class="hs-identifier hs-var">kind_fvs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-4744"></span><span>                     </span><span class="annot"><span class="annottext">TyConBinder -&gt; Bool
forall tv. VarBndr tv TyConBndrVis -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isVisibleTyConBinder"><span class="hs-identifier hs-var">isVisibleTyConBinder</span></a></span><span> </span><span class="annot"><span class="annottext">TyConBinder
</span><a href="#local-6989586621681165071"><span class="hs-identifier hs-var">tcb</span></a></span><span>
</span><span id="line-4745"></span><span>
</span><span id="line-4746"></span><span>    </span><span id="local-6989586621681165074"><span class="annot"><span class="annottext">vdq_warning :: SDoc
</span><a href="#local-6989586621681165074"><span class="hs-identifier hs-var hs-var">vdq_warning</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span>
</span><span id="line-4747"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;NB: Type&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165080"><span class="hs-identifier hs-var">tycon</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-4748"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;was inferred to use visible dependent quantification.&quot;</span></span><span>
</span><span id="line-4749"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Most types with visible dependent quantification are&quot;</span></span><span>
</span><span id="line-4750"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;polymorphically recursive and need a standalone kind&quot;</span></span><span>
</span><span id="line-4751"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;signature. Perhaps supply one, with StandaloneKindSignatures.&quot;</span></span><span>
</span><span id="line-4752"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-4753"></span><span>
</span><span id="line-4754"></span><span id="local-6989586621681168001"><span class="annot"><a href="GHC.Tc.TyCl.html#tcAddDeclCtxt"><span class="hs-identifier hs-type">tcAddDeclCtxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Decls.html#TyClDecl"><span class="hs-identifier hs-type">TyClDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681168001"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681168001"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-4755"></span><span id="tcAddDeclCtxt"><span class="annot"><span class="annottext">tcAddDeclCtxt :: forall a. TyClDecl GhcRn -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.TyCl.html#tcAddDeclCtxt"><span class="hs-identifier hs-var hs-var">tcAddDeclCtxt</span></a></span></span><span> </span><span id="local-6989586621681165070"><span class="annot"><span class="annottext">TyClDecl GhcRn
</span><a href="#local-6989586621681165070"><span class="hs-identifier hs-var">decl</span></a></span></span><span> </span><span id="local-6989586621681165069"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681165069"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-4756"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcM a -&gt; TcM a
forall a. SDoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyClDecl GhcRn -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#tcMkDeclCtxt"><span class="hs-identifier hs-var">tcMkDeclCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">TyClDecl GhcRn
</span><a href="#local-6989586621681165070"><span class="hs-identifier hs-var">decl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681165069"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-4757"></span><span>
</span><span id="line-4758"></span><span id="local-6989586621681167650"><span class="annot"><a href="GHC.Tc.TyCl.html#tcAddTyFamInstCtxt"><span class="hs-identifier hs-type">tcAddTyFamInstCtxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Decls.html#TyFamInstDecl"><span class="hs-identifier hs-type">TyFamInstDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681167650"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681167650"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-4759"></span><span id="tcAddTyFamInstCtxt"><span class="annot"><span class="annottext">tcAddTyFamInstCtxt :: forall a. TyFamInstDecl GhcRn -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.TyCl.html#tcAddTyFamInstCtxt"><span class="hs-identifier hs-var hs-var">tcAddTyFamInstCtxt</span></a></span></span><span> </span><span id="local-6989586621681165068"><span class="annot"><span class="annottext">TyFamInstDecl GhcRn
</span><a href="#local-6989586621681165068"><span class="hs-identifier hs-var">decl</span></a></span></span><span>
</span><span id="line-4760"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; Name -&gt; TcM a -&gt; TcM a
forall a. SDoc -&gt; Name -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.TyCl.html#tcAddFamInstCtxt"><span class="hs-identifier hs-var">tcAddFamInstCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;type instance&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyFamInstDecl GhcRn -&gt; IdP GhcRn
forall (p :: Pass). TyFamInstDecl (GhcPass p) -&gt; IdP (GhcPass p)
</span><a href="GHC.Hs.Decls.html#tyFamInstDeclName"><span class="hs-identifier hs-var">tyFamInstDeclName</span></a></span><span> </span><span class="annot"><span class="annottext">TyFamInstDecl GhcRn
</span><a href="#local-6989586621681165068"><span class="hs-identifier hs-var">decl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4761"></span><span>
</span><span id="line-4762"></span><span class="annot"><a href="GHC.Tc.TyCl.html#tcMkDataFamInstCtxt"><span class="hs-identifier hs-type">tcMkDataFamInstCtxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Decls.html#DataFamInstDecl"><span class="hs-identifier hs-type">DataFamInstDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-4763"></span><span id="tcMkDataFamInstCtxt"><span class="annot"><span class="annottext">tcMkDataFamInstCtxt :: DataFamInstDecl GhcRn -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#tcMkDataFamInstCtxt"><span class="hs-identifier hs-var hs-var">tcMkDataFamInstCtxt</span></a></span></span><span> </span><span id="local-6989586621681165067"><span class="annot"><span class="annottext">decl :: DataFamInstDecl GhcRn
</span><a href="#local-6989586621681165067"><span class="hs-identifier hs-var">decl</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Decls.html#DataFamInstDecl"><span class="hs-identifier hs-type">DataFamInstDecl</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">dfid_eqn :: forall pass.
DataFamInstDecl pass -&gt; FamInstEqn pass (HsDataDefn pass)
</span><a href="GHC.Hs.Decls.html#dfid_eqn"><span class="hs-identifier hs-var">dfid_eqn</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4764"></span><span>                            </span><span class="annot"><a href="GHC.Hs.Type.html#HsIB"><span class="hs-identifier hs-type">HsIB</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hsib_body :: forall pass thing. HsImplicitBndrs pass thing -&gt; thing
</span><a href="GHC.Hs.Type.html#hsib_body"><span class="hs-identifier hs-var">hsib_body</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681165064"><span class="annot"><span class="annottext">FamEqn GhcRn (HsDataDefn GhcRn)
</span><a href="#local-6989586621681165064"><span class="hs-identifier hs-var">eqn</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-4765"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; Name -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#tcMkFamInstCtxt"><span class="hs-identifier hs-var">tcMkFamInstCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataFamInstDecl GhcRn -&gt; SDoc
forall (p :: Pass). DataFamInstDecl (GhcPass p) -&gt; SDoc
</span><a href="GHC.Hs.Decls.html#pprDataFamInstFlavour"><span class="hs-identifier hs-var">pprDataFamInstFlavour</span></a></span><span> </span><span class="annot"><span class="annottext">DataFamInstDecl GhcRn
</span><a href="#local-6989586621681165067"><span class="hs-identifier hs-var">decl</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;instance&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-4766"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Located Name -&gt; Name
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FamEqn GhcRn (HsDataDefn GhcRn) -&gt; GenLocated SrcSpan (IdP GhcRn)
forall pass rhs. FamEqn pass rhs -&gt; Located (IdP pass)
</span><a href="GHC.Hs.Decls.html#feqn_tycon"><span class="hs-identifier hs-var hs-var">feqn_tycon</span></a></span><span> </span><span class="annot"><span class="annottext">FamEqn GhcRn (HsDataDefn GhcRn)
</span><a href="#local-6989586621681165064"><span class="hs-identifier hs-var">eqn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-4767"></span><span>
</span><span id="line-4768"></span><span id="local-6989586621681167644"><span class="annot"><a href="GHC.Tc.TyCl.html#tcAddDataFamInstCtxt"><span class="hs-identifier hs-type">tcAddDataFamInstCtxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Decls.html#DataFamInstDecl"><span class="hs-identifier hs-type">DataFamInstDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681167644"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681167644"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-4769"></span><span id="tcAddDataFamInstCtxt"><span class="annot"><span class="annottext">tcAddDataFamInstCtxt :: forall a. DataFamInstDecl GhcRn -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.TyCl.html#tcAddDataFamInstCtxt"><span class="hs-identifier hs-var hs-var">tcAddDataFamInstCtxt</span></a></span></span><span> </span><span id="local-6989586621681165061"><span class="annot"><span class="annottext">DataFamInstDecl GhcRn
</span><a href="#local-6989586621681165061"><span class="hs-identifier hs-var">decl</span></a></span></span><span>
</span><span id="line-4770"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcM a -&gt; TcM a
forall a. SDoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataFamInstDecl GhcRn -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#tcMkDataFamInstCtxt"><span class="hs-identifier hs-var">tcMkDataFamInstCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">DataFamInstDecl GhcRn
</span><a href="#local-6989586621681165061"><span class="hs-identifier hs-var">decl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4771"></span><span>
</span><span id="line-4772"></span><span class="annot"><a href="GHC.Tc.TyCl.html#tcMkFamInstCtxt"><span class="hs-identifier hs-type">tcMkFamInstCtxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-4773"></span><span id="tcMkFamInstCtxt"><span class="annot"><span class="annottext">tcMkFamInstCtxt :: SDoc -&gt; Name -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#tcMkFamInstCtxt"><span class="hs-identifier hs-var hs-var">tcMkFamInstCtxt</span></a></span></span><span> </span><span id="local-6989586621681165060"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681165060"><span class="hs-identifier hs-var">flavour</span></a></span></span><span> </span><span id="local-6989586621681165059"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165059"><span class="hs-identifier hs-var">tycon</span></a></span></span><span>
</span><span id="line-4774"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hsep"><span class="hs-identifier hs-var">hsep</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;In the&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681165060"><span class="hs-identifier hs-var">flavour</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;declaration for&quot;</span></span><span>
</span><span id="line-4775"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165059"><span class="hs-identifier hs-var">tycon</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4776"></span><span>
</span><span id="line-4777"></span><span id="local-6989586621681167800"><span class="annot"><a href="GHC.Tc.TyCl.html#tcAddFamInstCtxt"><span class="hs-identifier hs-type">tcAddFamInstCtxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681167800"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681167800"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-4778"></span><span id="tcAddFamInstCtxt"><span class="annot"><span class="annottext">tcAddFamInstCtxt :: forall a. SDoc -&gt; Name -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.TyCl.html#tcAddFamInstCtxt"><span class="hs-identifier hs-var hs-var">tcAddFamInstCtxt</span></a></span></span><span> </span><span id="local-6989586621681165058"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681165058"><span class="hs-identifier hs-var">flavour</span></a></span></span><span> </span><span id="local-6989586621681165057"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165057"><span class="hs-identifier hs-var">tycon</span></a></span></span><span> </span><span id="local-6989586621681165056"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681165056"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-4779"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcM a -&gt; TcM a
forall a. SDoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; Name -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#tcMkFamInstCtxt"><span class="hs-identifier hs-var">tcMkFamInstCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681165058"><span class="hs-identifier hs-var">flavour</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165057"><span class="hs-identifier hs-var">tycon</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681165056"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-4780"></span><span>
</span><span id="line-4781"></span><span id="local-6989586621681165055"><span class="annot"><a href="GHC.Tc.TyCl.html#tcAddClosedTypeFamilyDeclCtxt"><span class="hs-identifier hs-type">tcAddClosedTypeFamilyDeclCtxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681165055"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681165055"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-4782"></span><span id="tcAddClosedTypeFamilyDeclCtxt"><span class="annot"><span class="annottext">tcAddClosedTypeFamilyDeclCtxt :: forall a. TyCon -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.TyCl.html#tcAddClosedTypeFamilyDeclCtxt"><span class="hs-identifier hs-var hs-var">tcAddClosedTypeFamilyDeclCtxt</span></a></span></span><span> </span><span id="local-6989586621681165053"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165053"><span class="hs-identifier hs-var">tc</span></a></span></span><span>
</span><span id="line-4783"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcM a -&gt; TcM a
forall a. SDoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681165052"><span class="hs-identifier hs-var">ctxt</span></a></span><span>
</span><span id="line-4784"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-4785"></span><span>    </span><span id="local-6989586621681165052"><span class="annot"><span class="annottext">ctxt :: SDoc
</span><a href="#local-6989586621681165052"><span class="hs-identifier hs-var hs-var">ctxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;In the equations for closed type family&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-4786"></span><span>           </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165053"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4787"></span><span>
</span><span id="line-4788"></span><span class="annot"><a href="GHC.Tc.TyCl.html#resultTypeMisMatch"><span class="hs-identifier hs-type">resultTypeMisMatch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.FieldLabel.html#FieldLabelString"><span class="hs-identifier hs-type">FieldLabelString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-4789"></span><span id="resultTypeMisMatch"><span class="annot"><span class="annottext">resultTypeMisMatch :: FieldLabelString -&gt; DataCon -&gt; DataCon -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#resultTypeMisMatch"><span class="hs-identifier hs-var hs-var">resultTypeMisMatch</span></a></span></span><span> </span><span id="local-6989586621681165051"><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621681165051"><span class="hs-identifier hs-var">field_name</span></a></span></span><span> </span><span id="local-6989586621681165050"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165050"><span class="hs-identifier hs-var">con1</span></a></span></span><span> </span><span id="local-6989586621681165049"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165049"><span class="hs-identifier hs-var">con2</span></a></span></span><span>
</span><span id="line-4790"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Constructors&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165050"><span class="hs-identifier hs-var">con1</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;and&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165049"><span class="hs-identifier hs-var">con2</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-4791"></span><span>                </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;have a common field&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldLabelString -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621681165051"><span class="hs-identifier hs-var">field_name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-4792"></span><span>          </span><span class="annot"><span class="annottext">Arity -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc) -&gt; SDoc -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;but have different result types&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-4793"></span><span>
</span><span id="line-4794"></span><span class="annot"><a href="GHC.Tc.TyCl.html#fieldTypeMisMatch"><span class="hs-identifier hs-type">fieldTypeMisMatch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.FieldLabel.html#FieldLabelString"><span class="hs-identifier hs-type">FieldLabelString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-4795"></span><span id="fieldTypeMisMatch"><span class="annot"><span class="annottext">fieldTypeMisMatch :: FieldLabelString -&gt; DataCon -&gt; DataCon -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#fieldTypeMisMatch"><span class="hs-identifier hs-var hs-var">fieldTypeMisMatch</span></a></span></span><span> </span><span id="local-6989586621681165048"><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621681165048"><span class="hs-identifier hs-var">field_name</span></a></span></span><span> </span><span id="local-6989586621681165047"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165047"><span class="hs-identifier hs-var">con1</span></a></span></span><span> </span><span id="local-6989586621681165046"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165046"><span class="hs-identifier hs-var">con2</span></a></span></span><span>
</span><span id="line-4796"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Constructors&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165047"><span class="hs-identifier hs-var">con1</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;and&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165046"><span class="hs-identifier hs-var">con2</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-4797"></span><span>         </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;give different types for field&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldLabelString -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621681165048"><span class="hs-identifier hs-var">field_name</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-4798"></span><span>
</span><span id="line-4799"></span><span class="annot"><a href="GHC.Tc.TyCl.html#dataConCtxtName"><span class="hs-identifier hs-type">dataConCtxtName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-4800"></span><span id="dataConCtxtName"><span class="annot"><span class="annottext">dataConCtxtName :: [Located Name] -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#dataConCtxtName"><span class="hs-identifier hs-var hs-var">dataConCtxtName</span></a></span></span><span> </span><span class="hs-special">[</span><span id="local-6989586621681165045"><span class="annot"><span class="annottext">Located Name
</span><a href="#local-6989586621681165045"><span class="hs-identifier hs-var">con</span></a></span></span><span class="hs-special">]</span><span>
</span><span id="line-4801"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;In the definition of data constructor&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Located Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Located Name
</span><a href="#local-6989586621681165045"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4802"></span><span class="annot"><a href="GHC.Tc.TyCl.html#dataConCtxtName"><span class="hs-identifier hs-var">dataConCtxtName</span></a></span><span> </span><span id="local-6989586621681165044"><span class="annot"><span class="annottext">[Located Name]
</span><a href="#local-6989586621681165044"><span class="hs-identifier hs-var">con</span></a></span></span><span>
</span><span id="line-4803"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;In the definition of data constructors&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Located Name] -&gt; SDoc
forall a. Outputable a =&gt; [a] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#interpp%27SP"><span class="hs-identifier hs-var">interpp'SP</span></a></span><span> </span><span class="annot"><span class="annottext">[Located Name]
</span><a href="#local-6989586621681165044"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-4804"></span><span>
</span><span id="line-4805"></span><span id="local-6989586621681165042"><span class="annot"><a href="GHC.Tc.TyCl.html#dataConCtxt"><span class="hs-identifier hs-type">dataConCtxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681165042"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681165042"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span></span><span>
</span><span id="line-4806"></span><span id="dataConCtxt"><span class="annot"><span class="annottext">dataConCtxt :: forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#dataConCtxt"><span class="hs-identifier hs-var hs-var">dataConCtxt</span></a></span></span><span> </span><span id="local-6989586621681165039"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681165039"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;In the definition of data constructor&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681165039"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4807"></span><span>
</span><span id="line-4808"></span><span class="annot"><a href="GHC.Tc.TyCl.html#classOpCtxt"><span class="hs-identifier hs-type">classOpCtxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Var"><span class="hs-identifier hs-type">Var</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-4809"></span><span id="classOpCtxt"><span class="annot"><span class="annottext">classOpCtxt :: TyVar -&gt; Type -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#classOpCtxt"><span class="hs-identifier hs-var hs-var">classOpCtxt</span></a></span></span><span> </span><span id="local-6989586621681165038"><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681165038"><span class="hs-identifier hs-var">sel_id</span></a></span></span><span> </span><span id="local-6989586621681165037"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165037"><span class="hs-identifier hs-var">tau</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;When checking the class method:&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-4810"></span><span>                              </span><span class="annot"><span class="annottext">Arity -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyVar -&gt; SDoc
forall a. OutputableBndr a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pprPrefixOcc"><span class="hs-identifier hs-var">pprPrefixOcc</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681165038"><span class="hs-identifier hs-var">sel_id</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165037"><span class="hs-identifier hs-var">tau</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-4811"></span><span>
</span><span id="line-4812"></span><span class="annot"><a href="GHC.Tc.TyCl.html#classArityErr"><span class="hs-identifier hs-type">classArityErr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-4813"></span><span id="classArityErr"><span class="annot"><span class="annottext">classArityErr :: Arity -&gt; Class -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#classArityErr"><span class="hs-identifier hs-var hs-var">classArityErr</span></a></span></span><span> </span><span id="local-6989586621681165035"><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621681165035"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681165034"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681165034"><span class="hs-identifier hs-var">cls</span></a></span></span><span>
</span><span id="line-4814"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621681165035"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Arity -&gt; Arity -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">0</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; SDoc
</span><a href="#local-6989586621681165033"><span class="hs-identifier hs-var">mkErr</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;No&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;no-parameter&quot;</span></span><span>
</span><span id="line-4815"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; SDoc
</span><a href="#local-6989586621681165033"><span class="hs-identifier hs-var">mkErr</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Too many&quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;multi-parameter&quot;</span></span><span>
</span><span id="line-4816"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-4817"></span><span>    </span><span id="local-6989586621681165033"><span class="annot"><span class="annottext">mkErr :: String -&gt; String -&gt; SDoc
</span><a href="#local-6989586621681165033"><span class="hs-identifier hs-var hs-var">mkErr</span></a></span></span><span> </span><span id="local-6989586621681165032"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681165032"><span class="hs-identifier hs-var">howMany</span></a></span></span><span> </span><span id="local-6989586621681165031"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681165031"><span class="hs-identifier hs-var">allowWhat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-4818"></span><span>        </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681165032"><span class="hs-identifier hs-var">howMany</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; parameters for class&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681165034"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-4819"></span><span>              </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Enable MultiParamTypeClasses to allow &quot;</span></span><span>
</span><span id="line-4820"></span><span>                                    </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681165031"><span class="hs-identifier hs-var">allowWhat</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; classes&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-4821"></span><span>
</span><span id="line-4822"></span><span class="annot"><a href="GHC.Tc.TyCl.html#classFunDepsErr"><span class="hs-identifier hs-type">classFunDepsErr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-4823"></span><span id="classFunDepsErr"><span class="annot"><span class="annottext">classFunDepsErr :: Class -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#classFunDepsErr"><span class="hs-identifier hs-var hs-var">classFunDepsErr</span></a></span></span><span> </span><span id="local-6989586621681165030"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681165030"><span class="hs-identifier hs-var">cls</span></a></span></span><span>
</span><span id="line-4824"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Fundeps in class&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681165030"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-4825"></span><span>          </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Enable FunctionalDependencies to allow fundeps&quot;</span></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-4826"></span><span>
</span><span id="line-4827"></span><span class="annot"><a href="GHC.Tc.TyCl.html#badMethPred"><span class="hs-identifier hs-type">badMethPred</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcPredType"><span class="hs-identifier hs-type">TcPredType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-4828"></span><span id="badMethPred"><span class="annot"><span class="annottext">badMethPred :: TyVar -&gt; Type -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#badMethPred"><span class="hs-identifier hs-var hs-var">badMethPred</span></a></span></span><span> </span><span id="local-6989586621681165029"><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681165029"><span class="hs-identifier hs-var">sel_id</span></a></span></span><span> </span><span id="local-6989586621681165028"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165028"><span class="hs-identifier hs-var">pred</span></a></span></span><span>
</span><span id="line-4829"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; Arity -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Constraint&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165028"><span class="hs-identifier hs-var">pred</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4830"></span><span>                 </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;in the type of&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyVar -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar
</span><a href="#local-6989586621681165029"><span class="hs-identifier hs-var">sel_id</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-4831"></span><span>              </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;constrains only the class type variables&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-4832"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Enable ConstrainedClassMethods to allow it&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4833"></span><span>
</span><span id="line-4834"></span><span class="annot"><a href="GHC.Tc.TyCl.html#noClassTyVarErr"><span class="hs-identifier hs-type">noClassTyVarErr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-4835"></span><span id="noClassTyVarErr"><span class="annot"><span class="annottext">noClassTyVarErr :: Class -&gt; TyCon -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#noClassTyVarErr"><span class="hs-identifier hs-var hs-var">noClassTyVarErr</span></a></span></span><span> </span><span id="local-6989586621681165027"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681165027"><span class="hs-identifier hs-var">clas</span></a></span></span><span> </span><span id="local-6989586621681165026"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165026"><span class="hs-identifier hs-var">fam_tc</span></a></span></span><span>
</span><span id="line-4836"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;The associated type&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165026"><span class="hs-identifier hs-var">fam_tc</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hsep"><span class="hs-identifier hs-var">hsep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TyVar -&gt; SDoc) -&gt; [TyVar] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [TyVar]
</span><a href="GHC.Core.TyCon.html#tyConTyVars"><span class="hs-identifier hs-var hs-var">tyConTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165026"><span class="hs-identifier hs-var">fam_tc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-4837"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;mentions none of the type or kind variables of the class&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-4838"></span><span>                </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681165027"><span class="hs-identifier hs-var">clas</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hsep"><span class="hs-identifier hs-var">hsep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TyVar -&gt; SDoc) -&gt; [TyVar] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">TyVar -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; [TyVar]
</span><a href="GHC.Core.Class.html#classTyVars"><span class="hs-identifier hs-var hs-var">classTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681165027"><span class="hs-identifier hs-var">clas</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-4839"></span><span>
</span><span id="line-4840"></span><span class="annot"><a href="GHC.Tc.TyCl.html#badDataConTyCon"><span class="hs-identifier hs-type">badDataConTyCon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-4841"></span><span id="badDataConTyCon"><span class="annot"><span class="annottext">badDataConTyCon :: DataCon -&gt; Type -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#badDataConTyCon"><span class="hs-identifier hs-var hs-var">badDataConTyCon</span></a></span></span><span> </span><span id="local-6989586621681165025"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165025"><span class="hs-identifier hs-var">data_con</span></a></span></span><span> </span><span id="local-6989586621681165024"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165024"><span class="hs-identifier hs-var">res_ty_tmpl</span></a></span></span><span>
</span><span id="line-4842"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; Arity -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Data constructor&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165025"><span class="hs-identifier hs-var">data_con</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-4843"></span><span>                </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;returns type&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165023"><span class="hs-identifier hs-var">actual_res_ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-4844"></span><span>       </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;instead of an instance of its parent type&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681165024"><span class="hs-identifier hs-var">res_ty_tmpl</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-4845"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-4846"></span><span>    </span><span id="local-6989586621681165023"><span class="annot"><span class="annottext">actual_res_ty :: Type
</span><a href="#local-6989586621681165023"><span class="hs-identifier hs-var hs-var">actual_res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Type
</span><a href="GHC.Core.DataCon.html#dataConOrigResTy"><span class="hs-identifier hs-var">dataConOrigResTy</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165025"><span class="hs-identifier hs-var">data_con</span></a></span><span>
</span><span id="line-4847"></span><span>
</span><span id="line-4848"></span><span class="annot"><a href="GHC.Tc.TyCl.html#badGadtDecl"><span class="hs-identifier hs-type">badGadtDecl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-4849"></span><span id="badGadtDecl"><span class="annot"><span class="annottext">badGadtDecl :: Name -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#badGadtDecl"><span class="hs-identifier hs-var hs-var">badGadtDecl</span></a></span></span><span> </span><span id="local-6989586621681165022"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165022"><span class="hs-identifier hs-var">tc_name</span></a></span></span><span>
</span><span id="line-4850"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Illegal generalised algebraic data declaration for&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165022"><span class="hs-identifier hs-var">tc_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4851"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Arity -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc) -&gt; SDoc -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Enable the GADTs extension to allow this&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4852"></span><span>
</span><span id="line-4853"></span><span class="annot"><a href="GHC.Tc.TyCl.html#badExistential"><span class="hs-identifier hs-type">badExistential</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-4854"></span><span id="badExistential"><span class="annot"><span class="annottext">badExistential :: DataCon -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#badExistential"><span class="hs-identifier hs-var hs-var">badExistential</span></a></span></span><span> </span><span id="local-6989586621681165021"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165021"><span class="hs-identifier hs-var">con</span></a></span></span><span>
</span><span id="line-4855"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(DynFlags -&gt; SDoc) -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#sdocWithDynFlags"><span class="hs-identifier hs-var">sdocWithDynFlags</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681165019"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681165019"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-4856"></span><span>      </span><span class="annot"><span class="annottext">SDoc -&gt; Arity -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Data constructor&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165021"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-4857"></span><span>                  </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;has existential type variables, a context, or a specialised result type&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-4858"></span><span>         </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165021"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; DataCon -&gt; Type
</span><a href="GHC.Core.DataCon.html#dataConDisplayType"><span class="hs-identifier hs-var">dataConDisplayType</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681165019"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165021"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4859"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc) -&gt; SDoc -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Enable ExistentialQuantification or GADTs to allow this&quot;</span></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-4860"></span><span>
</span><span id="line-4861"></span><span class="annot"><a href="GHC.Tc.TyCl.html#badStupidTheta"><span class="hs-identifier hs-type">badStupidTheta</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-4862"></span><span id="badStupidTheta"><span class="annot"><span class="annottext">badStupidTheta :: Name -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#badStupidTheta"><span class="hs-identifier hs-var hs-var">badStupidTheta</span></a></span></span><span> </span><span id="local-6989586621681165018"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165018"><span class="hs-identifier hs-var">tc_name</span></a></span></span><span>
</span><span id="line-4863"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;A data type declared in GADT style cannot have a context:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165018"><span class="hs-identifier hs-var">tc_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4864"></span><span>
</span><span id="line-4865"></span><span class="annot"><a href="GHC.Tc.TyCl.html#newtypeConError"><span class="hs-identifier hs-type">newtypeConError</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-4866"></span><span id="newtypeConError"><span class="annot"><span class="annottext">newtypeConError :: Name -&gt; Arity -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#newtypeConError"><span class="hs-identifier hs-var hs-var">newtypeConError</span></a></span></span><span> </span><span id="local-6989586621681165017"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165017"><span class="hs-identifier hs-var">tycon</span></a></span></span><span> </span><span id="local-6989586621681165016"><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621681165016"><span class="hs-identifier hs-var">n</span></a></span></span><span>
</span><span id="line-4867"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;A newtype must have exactly one constructor,&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-4868"></span><span>         </span><span class="annot"><span class="annottext">Arity -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc) -&gt; SDoc -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;but&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165017"><span class="hs-identifier hs-var">tycon</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;has&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Arity -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#speakN"><span class="hs-identifier hs-var">speakN</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621681165016"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4869"></span><span>
</span><span id="line-4870"></span><span class="annot"><a href="GHC.Tc.TyCl.html#newtypeStrictError"><span class="hs-identifier hs-type">newtypeStrictError</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-4871"></span><span id="newtypeStrictError"><span class="annot"><span class="annottext">newtypeStrictError :: DataCon -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#newtypeStrictError"><span class="hs-identifier hs-var hs-var">newtypeStrictError</span></a></span></span><span> </span><span id="local-6989586621681165014"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165014"><span class="hs-identifier hs-var">con</span></a></span></span><span>
</span><span id="line-4872"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;A newtype constructor cannot have a strictness annotation,&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-4873"></span><span>         </span><span class="annot"><span class="annottext">Arity -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc) -&gt; SDoc -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;but&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165014"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;does&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-4874"></span><span>
</span><span id="line-4875"></span><span class="annot"><a href="GHC.Tc.TyCl.html#newtypeFieldErr"><span class="hs-identifier hs-type">newtypeFieldErr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-4876"></span><span id="newtypeFieldErr"><span class="annot"><span class="annottext">newtypeFieldErr :: DataCon -&gt; Arity -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#newtypeFieldErr"><span class="hs-identifier hs-var hs-var">newtypeFieldErr</span></a></span></span><span> </span><span id="local-6989586621681165013"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165013"><span class="hs-identifier hs-var">con_name</span></a></span></span><span> </span><span id="local-6989586621681165012"><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621681165012"><span class="hs-identifier hs-var">n_flds</span></a></span></span><span>
</span><span id="line-4877"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;The constructor of a newtype must have exactly one field&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-4878"></span><span>         </span><span class="annot"><span class="annottext">Arity -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc) -&gt; SDoc -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;but&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681165013"><span class="hs-identifier hs-var">con_name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;has&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Arity -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#speakN"><span class="hs-identifier hs-var">speakN</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621681165012"><span class="hs-identifier hs-var">n_flds</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-4879"></span><span>
</span><span id="line-4880"></span><span class="annot"><a href="GHC.Tc.TyCl.html#badSigTyDecl"><span class="hs-identifier hs-type">badSigTyDecl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-4881"></span><span id="badSigTyDecl"><span class="annot"><span class="annottext">badSigTyDecl :: Name -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#badSigTyDecl"><span class="hs-identifier hs-var hs-var">badSigTyDecl</span></a></span></span><span> </span><span id="local-6989586621681165011"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165011"><span class="hs-identifier hs-var">tc_name</span></a></span></span><span>
</span><span id="line-4882"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Illegal kind signature&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-4883"></span><span>           </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165011"><span class="hs-identifier hs-var">tc_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4884"></span><span>         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Arity -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc) -&gt; SDoc -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Use KindSignatures to allow kind signatures&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-4885"></span><span>
</span><span id="line-4886"></span><span class="annot"><a href="GHC.Tc.TyCl.html#emptyConDeclsErr"><span class="hs-identifier hs-type">emptyConDeclsErr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-4887"></span><span id="emptyConDeclsErr"><span class="annot"><span class="annottext">emptyConDeclsErr :: Name -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#emptyConDeclsErr"><span class="hs-identifier hs-var hs-var">emptyConDeclsErr</span></a></span></span><span> </span><span id="local-6989586621681165010"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165010"><span class="hs-identifier hs-var">tycon</span></a></span></span><span>
</span><span id="line-4888"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165010"><span class="hs-identifier hs-var">tycon</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;has no constructors&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-4889"></span><span>         </span><span class="annot"><span class="annottext">Arity -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc) -&gt; SDoc -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;(EmptyDataDecls permits this)&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-4890"></span><span>
</span><span id="line-4891"></span><span class="annot"><a href="GHC.Tc.TyCl.html#wrongKindOfFamily"><span class="hs-identifier hs-type">wrongKindOfFamily</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-4892"></span><span id="wrongKindOfFamily"><span class="annot"><span class="annottext">wrongKindOfFamily :: TyCon -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#wrongKindOfFamily"><span class="hs-identifier hs-var hs-var">wrongKindOfFamily</span></a></span></span><span> </span><span id="local-6989586621681165009"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165009"><span class="hs-keyword hs-var">family</span></a></span></span><span>
</span><span id="line-4893"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Wrong category of family instance; declaration was for a&quot;</span></span><span>
</span><span id="line-4894"></span><span>    </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681165008"><span class="hs-identifier hs-var">kindOfFamily</span></a></span><span>
</span><span id="line-4895"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-4896"></span><span>    </span><span id="local-6989586621681165008"><span class="annot"><span class="annottext">kindOfFamily :: SDoc
</span><a href="#local-6989586621681165008"><span class="hs-identifier hs-var hs-var">kindOfFamily</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isTypeFamilyTyCon"><span class="hs-identifier hs-var">isTypeFamilyTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165009"><span class="hs-keyword hs-var">family</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;type family&quot;</span></span><span>
</span><span id="line-4897"></span><span>                 </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isDataFamilyTyCon"><span class="hs-identifier hs-var">isDataFamilyTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165009"><span class="hs-keyword hs-var">family</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;data family&quot;</span></span><span>
</span><span id="line-4898"></span><span>                 </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; SDoc
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;wrongKindOfFamily&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681165009"><span class="hs-keyword hs-var">family</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4899"></span><span>
</span><span id="line-4900"></span><span class="hs-comment">-- | Produce an error for oversaturated type family equations with too many</span><span>
</span><span id="line-4901"></span><span class="hs-comment">-- required arguments.</span><span>
</span><span id="line-4902"></span><span class="hs-comment">-- See Note [Oversaturated type family equations] in &quot;GHC.Tc.Validity&quot;.</span><span>
</span><span id="line-4903"></span><span class="annot"><a href="GHC.Tc.TyCl.html#wrongNumberOfParmsErr"><span class="hs-identifier hs-type">wrongNumberOfParmsErr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#Arity"><span class="hs-identifier hs-type">Arity</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-4904"></span><span id="wrongNumberOfParmsErr"><span class="annot"><span class="annottext">wrongNumberOfParmsErr :: Arity -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#wrongNumberOfParmsErr"><span class="hs-identifier hs-var hs-var">wrongNumberOfParmsErr</span></a></span></span><span> </span><span id="local-6989586621681165006"><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621681165006"><span class="hs-identifier hs-var">max_args</span></a></span></span><span>
</span><span id="line-4905"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Number of parameters must match family declaration; expected&quot;</span></span><span>
</span><span id="line-4906"></span><span>    </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Arity -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621681165006"><span class="hs-identifier hs-var">max_args</span></a></span><span>
</span><span id="line-4907"></span><span>
</span><span id="line-4908"></span><span class="annot"><a href="GHC.Tc.TyCl.html#badRoleAnnot"><span class="hs-identifier hs-type">badRoleAnnot</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#Role"><span class="hs-identifier hs-type">Role</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-4909"></span><span id="badRoleAnnot"><span class="annot"><span class="annottext">badRoleAnnot :: Name -&gt; Role -&gt; Role -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#badRoleAnnot"><span class="hs-identifier hs-var hs-var">badRoleAnnot</span></a></span></span><span> </span><span id="local-6989586621681165005"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165005"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span id="local-6989586621681165004"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681165004"><span class="hs-identifier hs-var">annot</span></a></span></span><span> </span><span id="local-6989586621681165003"><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681165003"><span class="hs-identifier hs-var">inferred</span></a></span></span><span>
</span><span id="line-4910"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; Arity -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Role mismatch on variable&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681165005"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#colon"><span class="hs-identifier hs-var">colon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4911"></span><span>       </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Annotation says&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Role -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681165004"><span class="hs-identifier hs-var">annot</span></a></span><span>
</span><span id="line-4912"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;but role&quot;</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Role -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="#local-6989586621681165003"><span class="hs-identifier hs-var">inferred</span></a></span><span>
</span><span id="line-4913"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;is required&quot;</span></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-4914"></span><span>
</span><span id="line-4915"></span><span id="local-6989586621681167671"><span class="annot"><a href="GHC.Tc.TyCl.html#wrongNumberOfRoles"><span class="hs-identifier hs-type">wrongNumberOfRoles</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621681167671"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Decls.html#LRoleAnnotDecl"><span class="hs-identifier hs-type">LRoleAnnotDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span></span><span>
</span><span id="line-4916"></span><span id="wrongNumberOfRoles"><span class="annot"><span class="annottext">wrongNumberOfRoles :: forall a. [a] -&gt; LRoleAnnotDecl GhcRn -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#wrongNumberOfRoles"><span class="hs-identifier hs-var hs-var">wrongNumberOfRoles</span></a></span></span><span> </span><span id="local-6989586621681164994"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621681164994"><span class="hs-identifier hs-var">tyvars</span></a></span></span><span> </span><span id="local-6989586621681164993"><span class="annot"><span class="annottext">d :: LRoleAnnotDecl GhcRn
</span><a href="#local-6989586621681164993"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Decls.html#RoleAnnotDecl"><span class="hs-identifier hs-type">RoleAnnotDecl</span></a></span><span> </span><span class="annot"><span class="annottext">XCRoleAnnotDecl GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpan (IdP GhcRn)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681164992"><span class="annot"><span class="annottext">[Located (Maybe Role)]
</span><a href="#local-6989586621681164992"><span class="hs-identifier hs-var">annots</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-4917"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; Arity -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Wrong number of roles listed in role annotation;&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-4918"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Expected&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arity -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">(Arity -&gt; SDoc) -&gt; Arity -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[a] -&gt; Arity
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Arity
</span><a href="../../base/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621681164994"><span class="hs-identifier hs-var">tyvars</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-4919"></span><span>          </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;got&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arity -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">(Arity -&gt; SDoc) -&gt; Arity -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Located (Maybe Role)] -&gt; Arity
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Arity
</span><a href="../../base/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[Located (Maybe Role)]
</span><a href="#local-6989586621681164992"><span class="hs-identifier hs-var">annots</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#colon"><span class="hs-identifier hs-var">colon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4920"></span><span>       </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LRoleAnnotDecl GhcRn -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">LRoleAnnotDecl GhcRn
</span><a href="#local-6989586621681164993"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4921"></span><span>
</span><span id="line-4922"></span><span>
</span><span id="line-4923"></span><span class="annot"><a href="GHC.Tc.TyCl.html#illegalRoleAnnotDecl"><span class="hs-identifier hs-type">illegalRoleAnnotDecl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Decls.html#LRoleAnnotDecl"><span class="hs-identifier hs-type">LRoleAnnotDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-4924"></span><span id="illegalRoleAnnotDecl"><span class="annot"><span class="annottext">illegalRoleAnnotDecl :: LRoleAnnotDecl GhcRn -&gt; TcRn ()
</span><a href="GHC.Tc.TyCl.html#illegalRoleAnnotDecl"><span class="hs-identifier hs-var hs-var">illegalRoleAnnotDecl</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681164991"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681164991"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Decls.html#RoleAnnotDecl"><span class="hs-identifier hs-type">RoleAnnotDecl</span></a></span><span> </span><span class="annot"><span class="annottext">XCRoleAnnotDecl GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681164990"><span class="annot"><span class="annottext">GenLocated SrcSpan (IdP GhcRn)
</span><a href="#local-6989586621681164990"><span class="hs-identifier hs-var">tycon</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Located (Maybe Role)]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-4925"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ErrCtxt] -&gt; TcRn () -&gt; TcRn ()
forall a. [ErrCtxt] -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#setErrCtxt"><span class="hs-identifier hs-var">setErrCtxt</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcRn ()) -&gt; TcRn () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-4926"></span><span>    </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcRn () -&gt; TcRn ()
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681164991"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcRn ()) -&gt; TcRn () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-4927"></span><span>    </span><span class="annot"><span class="annottext">SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrTc"><span class="hs-identifier hs-var">addErrTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Illegal role annotation for&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Located Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Located Name
GenLocated SrcSpan (IdP GhcRn)
</span><a href="#local-6989586621681164990"><span class="hs-identifier hs-var">tycon</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">';'</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-4928"></span><span>              </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;they are allowed only for datatypes and classes.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-4929"></span><span>
</span><span id="line-4930"></span><span class="annot"><a href="GHC.Tc.TyCl.html#needXRoleAnnotations"><span class="hs-identifier hs-type">needXRoleAnnotations</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-4931"></span><span id="needXRoleAnnotations"><span class="annot"><span class="annottext">needXRoleAnnotations :: TyCon -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#needXRoleAnnotations"><span class="hs-identifier hs-var hs-var">needXRoleAnnotations</span></a></span></span><span> </span><span id="local-6989586621681164987"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681164987"><span class="hs-identifier hs-var">tc</span></a></span></span><span>
</span><span id="line-4932"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Illegal role annotation for&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681164987"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">';'</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-4933"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;did you intend to use RoleAnnotations?&quot;</span></span><span>
</span><span id="line-4934"></span><span>
</span><span id="line-4935"></span><span class="annot"><a href="GHC.Tc.TyCl.html#incoherentRoles"><span class="hs-identifier hs-type">incoherentRoles</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-4936"></span><span id="incoherentRoles"><span class="annot"><span class="annottext">incoherentRoles :: SDoc
</span><a href="GHC.Tc.TyCl.html#incoherentRoles"><span class="hs-identifier hs-var hs-var">incoherentRoles</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Roles other than&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;nominal&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-4937"></span><span>                   </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;for class parameters can lead to incoherence.&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-4938"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Use IncoherentInstances to allow this; bad role found&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-4939"></span><span>
</span><span id="line-4940"></span><span class="annot"><a href="GHC.Tc.TyCl.html#wrongTyFamName"><span class="hs-identifier hs-type">wrongTyFamName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-4941"></span><span id="wrongTyFamName"><span class="annot"><span class="annottext">wrongTyFamName :: Name -&gt; Name -&gt; SDoc
</span><a href="GHC.Tc.TyCl.html#wrongTyFamName"><span class="hs-identifier hs-var hs-var">wrongTyFamName</span></a></span></span><span> </span><span id="local-6989586621681164986"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681164986"><span class="hs-identifier hs-var">fam_tc_name</span></a></span></span><span> </span><span id="local-6989586621681164985"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681164985"><span class="hs-identifier hs-var">eqn_tc_name</span></a></span></span><span>
</span><span id="line-4942"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; Arity -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Mismatched type name in type family instance.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-4943"></span><span>       </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Expected:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681164986"><span class="hs-identifier hs-var">fam_tc_name</span></a></span><span>
</span><span id="line-4944"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;  Actual:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681164985"><span class="hs-identifier hs-var">eqn_tc_name</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-4945"></span><span>
</span><span id="line-4946"></span><span id="local-6989586621681167936"><span class="annot"><a href="GHC.Tc.TyCl.html#addTyConCtxt"><span class="hs-identifier hs-type">addTyConCtxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681167936"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681167936"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-4947"></span><span id="addTyConCtxt"><span class="annot"><span class="annottext">addTyConCtxt :: forall a. TyCon -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.TyCl.html#addTyConCtxt"><span class="hs-identifier hs-var hs-var">addTyConCtxt</span></a></span></span><span> </span><span id="local-6989586621681164983"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681164983"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TyConFlavour -&gt; TcM a -&gt; TcM a
forall a. Name -&gt; TyConFlavour -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Gen.HsType.html#addTyConFlavCtxt"><span class="hs-identifier hs-var">addTyConFlavCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681164981"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">TyConFlavour
</span><a href="#local-6989586621681164980"><span class="hs-identifier hs-var">flav</span></a></span><span>
</span><span id="line-4948"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-4949"></span><span>    </span><span id="local-6989586621681164981"><span class="annot"><span class="annottext">name :: Name
</span><a href="#local-6989586621681164981"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Name
forall a. NamedThing a =&gt; a -&gt; Name
</span><a href="GHC.Types.Name.html#getName"><span class="hs-identifier hs-var">getName</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681164983"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-4950"></span><span>    </span><span id="local-6989586621681164980"><span class="annot"><span class="annottext">flav :: TyConFlavour
</span><a href="#local-6989586621681164980"><span class="hs-identifier hs-var hs-var">flav</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyConFlavour
</span><a href="GHC.Core.TyCon.html#tyConFlavour"><span class="hs-identifier hs-var">tyConFlavour</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681164983"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-4951"></span><span>
</span><span id="line-4952"></span><span id="local-6989586621681167674"><span class="annot"><a href="GHC.Tc.TyCl.html#addRoleAnnotCtxt"><span class="hs-identifier hs-type">addRoleAnnotCtxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681167674"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681167674"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-4953"></span><span id="addRoleAnnotCtxt"><span class="annot"><span class="annottext">addRoleAnnotCtxt :: forall a. Name -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.TyCl.html#addRoleAnnotCtxt"><span class="hs-identifier hs-var hs-var">addRoleAnnotCtxt</span></a></span></span><span> </span><span id="local-6989586621681164978"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681164978"><span class="hs-identifier hs-var">name</span></a></span></span><span>
</span><span id="line-4954"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcM a -&gt; TcM a
forall a. SDoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; TcM a -&gt; TcM a) -&gt; SDoc -&gt; TcM a -&gt; TcM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-4955"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;while checking a role annotation for&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681164978"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-4956"></span></pre></body></html>