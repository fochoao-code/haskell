<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-
(c) The University of Glasgow 2006

-}</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-pragma">{-# LANGUAGE CPP, ExplicitForAll, FlexibleInstances, BangPatterns #-}</span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# OPTIONS_GHC -fno-warn-orphans #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-incomplete-record-updates #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE ViewPatterns #-}</span><span>
</span><span id="line-11"></span><span>
</span><span id="line-12"></span><span>
</span><span id="line-13"></span><span class="hs-comment">-- | Functions for working with the typechecker environment (setters,</span><span>
</span><span id="line-14"></span><span class="hs-comment">-- getters...).</span><span>
</span><span id="line-15"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">GHC.Tc.Utils.Monad</span><span class="hs-special">(</span><span>
</span><span id="line-16"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Initialisation</span></span><span>
</span><span id="line-17"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#initTc"><span class="hs-identifier">initTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#initTcWithGbl"><span class="hs-identifier">initTcWithGbl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#initTcInteractive"><span class="hs-identifier">initTcInteractive</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#initTcRnIf"><span class="hs-identifier">initTcRnIf</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>
</span><span id="line-19"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Simple accessors</span></span><span>
</span><span id="line-20"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#discardResult"><span class="hs-identifier">discardResult</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier">getTopEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#updTopEnv"><span class="hs-identifier">updTopEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier">getGblEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#updGblEnv"><span class="hs-identifier">updGblEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setGblEnv"><span class="hs-identifier">setGblEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getLclEnv"><span class="hs-identifier">getLclEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#updLclEnv"><span class="hs-identifier">updLclEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setLclEnv"><span class="hs-identifier">setLclEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getEnvs"><span class="hs-identifier">getEnvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setEnvs"><span class="hs-identifier">setEnvs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier">xoptM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#doptM"><span class="hs-identifier">doptM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#goptM"><span class="hs-identifier">goptM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#woptM"><span class="hs-identifier">woptM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setXOptM"><span class="hs-identifier">setXOptM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#unsetXOptM"><span class="hs-identifier">unsetXOptM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#unsetGOptM"><span class="hs-identifier">unsetGOptM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#unsetWOptM"><span class="hs-identifier">unsetWOptM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#whenDOptM"><span class="hs-identifier">whenDOptM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#whenGOptM"><span class="hs-identifier">whenGOptM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#whenWOptM"><span class="hs-identifier">whenWOptM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#whenXOptM"><span class="hs-identifier">whenXOptM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#unlessXOptM"><span class="hs-identifier">unlessXOptM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getGhcMode"><span class="hs-identifier">getGhcMode</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-29"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#withDoDynamicToo"><span class="hs-identifier">withDoDynamicToo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getEpsVar"><span class="hs-identifier">getEpsVar</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getEps"><span class="hs-identifier">getEps</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#updateEps"><span class="hs-identifier">updateEps</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#updateEps_"><span class="hs-identifier">updateEps_</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getHpt"><span class="hs-identifier">getHpt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getEpsAndHpt"><span class="hs-identifier">getEpsAndHpt</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>
</span><span id="line-35"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Arrow scopes</span></span><span>
</span><span id="line-36"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newArrowScope"><span class="hs-identifier">newArrowScope</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#escapeArrowScope"><span class="hs-identifier">escapeArrowScope</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span>
</span><span id="line-38"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Unique supply</span></span><span>
</span><span id="line-39"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newUnique"><span class="hs-identifier">newUnique</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newUniqueSupply"><span class="hs-identifier">newUniqueSupply</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newName"><span class="hs-identifier">newName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newNameAt"><span class="hs-identifier">newNameAt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#cloneLocalName"><span class="hs-identifier">cloneLocalName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-40"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newSysName"><span class="hs-identifier">newSysName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newSysLocalId"><span class="hs-identifier">newSysLocalId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newSysLocalIds"><span class="hs-identifier">newSysLocalIds</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-41"></span><span>
</span><span id="line-42"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Accessing input/output</span></span><span>
</span><span id="line-43"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newTcRef"><span class="hs-identifier">newTcRef</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#readTcRef"><span class="hs-identifier">readTcRef</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#writeTcRef"><span class="hs-identifier">writeTcRef</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#updTcRef"><span class="hs-identifier">updTcRef</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-44"></span><span>
</span><span id="line-45"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Debugging</span></span><span>
</span><span id="line-46"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier">traceTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceRn"><span class="hs-identifier">traceRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceOptTcRn"><span class="hs-identifier">traceOptTcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#dumpOptTcRn"><span class="hs-identifier">dumpOptTcRn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-47"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#dumpTcRn"><span class="hs-identifier">dumpTcRn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-48"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getPrintUnqualified"><span class="hs-identifier">getPrintUnqualified</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-49"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#printForUserTcRn"><span class="hs-identifier">printForUserTcRn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-50"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceIf"><span class="hs-identifier">traceIf</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceHiDiffs"><span class="hs-identifier">traceHiDiffs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceOptIf"><span class="hs-identifier">traceOptIf</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-51"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#debugTc"><span class="hs-identifier">debugTc</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Typechecker global environment</span></span><span>
</span><span id="line-54"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getIsGHCi"><span class="hs-identifier">getIsGHCi</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getGHCiMonad"><span class="hs-identifier">getGHCiMonad</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getInteractivePrintName"><span class="hs-identifier">getInteractivePrintName</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-55"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#tcIsHsBootOrSig"><span class="hs-identifier">tcIsHsBootOrSig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#tcIsHsig"><span class="hs-identifier">tcIsHsig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#tcSelfBootInfo"><span class="hs-identifier">tcSelfBootInfo</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getGlobalRdrEnv"><span class="hs-identifier">getGlobalRdrEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-56"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getRdrEnvs"><span class="hs-identifier">getRdrEnvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getImports"><span class="hs-identifier">getImports</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-57"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getFixityEnv"><span class="hs-identifier">getFixityEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#extendFixityEnv"><span class="hs-identifier">extendFixityEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getRecFieldEnv"><span class="hs-identifier">getRecFieldEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-58"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getDeclaredDefaultTys"><span class="hs-identifier">getDeclaredDefaultTys</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-59"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addDependentFiles"><span class="hs-identifier">addDependentFiles</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Error management</span></span><span>
</span><span id="line-62"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getSrcSpanM"><span class="hs-identifier">getSrcSpanM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier">setSrcSpan</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addLocM"><span class="hs-identifier">addLocM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#inGeneratedCode"><span class="hs-identifier">inGeneratedCode</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-63"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#wrapLocM"><span class="hs-identifier">wrapLocM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#wrapLocFstM"><span class="hs-identifier">wrapLocFstM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#wrapLocSndM"><span class="hs-identifier">wrapLocSndM</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#wrapLocM_"><span class="hs-identifier">wrapLocM_</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-64"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getErrsVar"><span class="hs-identifier">getErrsVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setErrsVar"><span class="hs-identifier">setErrsVar</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-65"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addErr"><span class="hs-identifier">addErr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-66"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#failWith"><span class="hs-identifier">failWith</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#failAt"><span class="hs-identifier">failAt</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-67"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addErrAt"><span class="hs-identifier">addErrAt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addErrs"><span class="hs-identifier">addErrs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-68"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#checkErr"><span class="hs-identifier">checkErr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-69"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addMessages"><span class="hs-identifier">addMessages</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-70"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#discardWarnings"><span class="hs-identifier">discardWarnings</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-71"></span><span>
</span><span id="line-72"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Usage environment</span></span><span>
</span><span id="line-73"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#tcCollectingUsage"><span class="hs-identifier">tcCollectingUsage</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier">tcScalingUsage</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#tcEmitBindingUsage"><span class="hs-identifier">tcEmitBindingUsage</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-74"></span><span>
</span><span id="line-75"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Shared error message stuff: renamer and typechecker</span></span><span>
</span><span id="line-76"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#mkLongErrAt"><span class="hs-identifier">mkLongErrAt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#mkErrDocAt"><span class="hs-identifier">mkErrDocAt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addLongErrAt"><span class="hs-identifier">addLongErrAt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#reportErrors"><span class="hs-identifier">reportErrors</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#reportError"><span class="hs-identifier">reportError</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-77"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#reportWarning"><span class="hs-identifier">reportWarning</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#recoverM"><span class="hs-identifier">recoverM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#mapAndRecoverM"><span class="hs-identifier">mapAndRecoverM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#mapAndReportM"><span class="hs-identifier">mapAndReportM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#foldAndRecoverM"><span class="hs-identifier">foldAndRecoverM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-78"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#attemptM"><span class="hs-identifier">attemptM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#tryTc"><span class="hs-identifier">tryTc</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-79"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#askNoErrs"><span class="hs-identifier">askNoErrs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#discardErrs"><span class="hs-identifier">discardErrs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#tryTcDiscardingErrs"><span class="hs-identifier">tryTcDiscardingErrs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-80"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#checkNoErrs"><span class="hs-identifier">checkNoErrs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#whenNoErrs"><span class="hs-identifier">whenNoErrs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-81"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#ifErrsM"><span class="hs-identifier">ifErrsM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#failIfErrsM"><span class="hs-identifier">failIfErrsM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-82"></span><span>
</span><span id="line-83"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Context management for the type checker</span></span><span>
</span><span id="line-84"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getErrCtxt"><span class="hs-identifier">getErrCtxt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setErrCtxt"><span class="hs-identifier">setErrCtxt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-identifier">addErrCtxt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addErrCtxtM"><span class="hs-identifier">addErrCtxtM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addLandmarkErrCtxt"><span class="hs-identifier">addLandmarkErrCtxt</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-85"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addLandmarkErrCtxtM"><span class="hs-identifier">addLandmarkErrCtxtM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#popErrCtxt"><span class="hs-identifier">popErrCtxt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getCtLocM"><span class="hs-identifier">getCtLocM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setCtLocM"><span class="hs-identifier">setCtLocM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-86"></span><span>
</span><span id="line-87"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Error message generation (type checker)</span></span><span>
</span><span id="line-88"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addErrTc"><span class="hs-identifier">addErrTc</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-89"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addErrTcM"><span class="hs-identifier">addErrTcM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-90"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier">failWithTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#failWithTcM"><span class="hs-identifier">failWithTcM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-91"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier">checkTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#checkTcM"><span class="hs-identifier">checkTcM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-92"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#failIfTc"><span class="hs-identifier">failIfTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#failIfTcM"><span class="hs-identifier">failIfTcM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-93"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#warnIfFlag"><span class="hs-identifier">warnIfFlag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#warnIf"><span class="hs-identifier">warnIf</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#warnTc"><span class="hs-identifier">warnTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#warnTcM"><span class="hs-identifier">warnTcM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-94"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addWarnTc"><span class="hs-identifier">addWarnTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addWarnTcM"><span class="hs-identifier">addWarnTcM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addWarn"><span class="hs-identifier">addWarn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addWarnAt"><span class="hs-identifier">addWarnAt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#add_warn"><span class="hs-identifier">add_warn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-95"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#mkErrInfo"><span class="hs-identifier">mkErrInfo</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-96"></span><span>
</span><span id="line-97"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Type constraints</span></span><span>
</span><span id="line-98"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newTcEvBinds"><span class="hs-identifier">newTcEvBinds</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newNoTcEvBinds"><span class="hs-identifier">newNoTcEvBinds</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#cloneEvBindsVar"><span class="hs-identifier">cloneEvBindsVar</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-99"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addTcEvBind"><span class="hs-identifier">addTcEvBind</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addTopEvBinds"><span class="hs-identifier">addTopEvBinds</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-100"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getTcEvTyCoVars"><span class="hs-identifier">getTcEvTyCoVars</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getTcEvBindsMap"><span class="hs-identifier">getTcEvBindsMap</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setTcEvBindsMap"><span class="hs-identifier">setTcEvBindsMap</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-101"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#chooseUniqueOccTc"><span class="hs-identifier">chooseUniqueOccTc</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-102"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getConstraintVar"><span class="hs-identifier">getConstraintVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setConstraintVar"><span class="hs-identifier">setConstraintVar</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-103"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitConstraints"><span class="hs-identifier">emitConstraints</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitStaticConstraints"><span class="hs-identifier">emitStaticConstraints</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitSimple"><span class="hs-identifier">emitSimple</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitSimples"><span class="hs-identifier">emitSimples</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-104"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitImplication"><span class="hs-identifier">emitImplication</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitImplications"><span class="hs-identifier">emitImplications</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitInsoluble"><span class="hs-identifier">emitInsoluble</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-105"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitHole"><span class="hs-identifier">emitHole</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitHoles"><span class="hs-identifier">emitHoles</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-106"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#discardConstraints"><span class="hs-identifier">discardConstraints</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#captureConstraints"><span class="hs-identifier">captureConstraints</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#tryCaptureConstraints"><span class="hs-identifier">tryCaptureConstraints</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-107"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#pushLevelAndCaptureConstraints"><span class="hs-identifier">pushLevelAndCaptureConstraints</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-108"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#pushTcLevelM_"><span class="hs-identifier">pushTcLevelM_</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#pushTcLevelM"><span class="hs-identifier">pushTcLevelM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#pushTcLevelsM"><span class="hs-identifier">pushTcLevelsM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-109"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getTcLevel"><span class="hs-identifier">getTcLevel</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setTcLevel"><span class="hs-identifier">setTcLevel</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#isTouchableTcM"><span class="hs-identifier">isTouchableTcM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-110"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getLclTypeEnv"><span class="hs-identifier">getLclTypeEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setLclTypeEnv"><span class="hs-identifier">setLclTypeEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-111"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTcConstraints"><span class="hs-identifier">traceTcConstraints</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-112"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitNamedTypeHole"><span class="hs-identifier">emitNamedTypeHole</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitAnonTypeHole"><span class="hs-identifier">emitAnonTypeHole</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-113"></span><span>
</span><span id="line-114"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Template Haskell context</span></span><span>
</span><span id="line-115"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#recordThUse"><span class="hs-identifier">recordThUse</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#recordThSpliceUse"><span class="hs-identifier">recordThSpliceUse</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-116"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#keepAlive"><span class="hs-identifier">keepAlive</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getStage"><span class="hs-identifier">getStage</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getStageAndBindLevel"><span class="hs-identifier">getStageAndBindLevel</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setStage"><span class="hs-identifier">setStage</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-117"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addModFinalizersWithLclEnv"><span class="hs-identifier">addModFinalizersWithLclEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-118"></span><span>
</span><span id="line-119"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Safe Haskell context</span></span><span>
</span><span id="line-120"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#recordUnsafeInfer"><span class="hs-identifier">recordUnsafeInfer</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#finalSafeMode"><span class="hs-identifier">finalSafeMode</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#fixSafeInstances"><span class="hs-identifier">fixSafeInstances</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-121"></span><span>
</span><span id="line-122"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Stuff for the renamer's local env</span></span><span>
</span><span id="line-123"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getLocalRdrEnv"><span class="hs-identifier">getLocalRdrEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setLocalRdrEnv"><span class="hs-identifier">setLocalRdrEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-124"></span><span>
</span><span id="line-125"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Stuff for interface decls</span></span><span>
</span><span id="line-126"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#mkIfLclEnv"><span class="hs-identifier">mkIfLclEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-127"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#initIfaceTcRn"><span class="hs-identifier">initIfaceTcRn</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-128"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#initIfaceCheck"><span class="hs-identifier">initIfaceCheck</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-129"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#initIfaceLcl"><span class="hs-identifier">initIfaceLcl</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-130"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#initIfaceLclWithSubst"><span class="hs-identifier">initIfaceLclWithSubst</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-131"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#initIfaceLoad"><span class="hs-identifier">initIfaceLoad</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-132"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getIfModule"><span class="hs-identifier">getIfModule</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-133"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#failIfM"><span class="hs-identifier">failIfM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-134"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#forkM_maybe"><span class="hs-identifier">forkM_maybe</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-135"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#forkM"><span class="hs-identifier">forkM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-136"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setImplicitEnvM"><span class="hs-identifier">setImplicitEnvM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-137"></span><span>
</span><span id="line-138"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#withException"><span class="hs-identifier">withException</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Stuff for cost centres.</span></span><span>
</span><span id="line-141"></span><span>  </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#ContainsCostCentreState"><span class="hs-identifier">ContainsCostCentreState</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getCCIndexM"><span class="hs-identifier">getCCIndexM</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-142"></span><span>
</span><span id="line-143"></span><span>  </span><span class="annot"><span class="hs-comment">-- * Types etc.</span></span><span>
</span><span id="line-144"></span><span>  </span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html"><span class="hs-identifier">GHC.Tc.Types</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-145"></span><span>  </span><span class="hs-keyword">module</span><span> </span><span class="annot"><a href="GHC.Data.IOEnv.html"><span class="hs-identifier">GHC.Data.IOEnv</span></a></span><span>
</span><span id="line-146"></span><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span class="hs-cpp">

#include &quot;HsVersions.h&quot;
</span><span>
</span><span id="line-150"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html"><span class="hs-identifier">GHC.Tc.Types</span></a></span><span>     </span><span class="hs-comment">-- Re-export all</span><span>
</span><span id="line-153"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.IOEnv.html"><span class="hs-identifier">GHC.Data.IOEnv</span></a></span><span> </span><span class="hs-comment">-- Re-export all</span><span>
</span><span id="line-154"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html"><span class="hs-identifier">GHC.Tc.Types.Constraint</span></a></span><span>
</span><span id="line-155"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html"><span class="hs-identifier">GHC.Tc.Types.Evidence</span></a></span><span>
</span><span id="line-156"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html"><span class="hs-identifier">GHC.Tc.Types.Origin</span></a></span><span>
</span><span id="line-157"></span><span>
</span><span id="line-158"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Hs.html"><span class="hs-identifier">GHC.Hs</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.ImpExp.html#LIE"><span class="hs-identifier">LIE</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-159"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html"><span class="hs-identifier">GHC.Driver.Types</span></a></span><span>
</span><span id="line-160"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.html"><span class="hs-identifier">GHC.Unit</span></a></span><span>
</span><span id="line-161"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html"><span class="hs-identifier">GHC.Types.Name.Reader</span></a></span><span>
</span><span id="line-162"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.html"><span class="hs-identifier">GHC.Types.Name</span></a></span><span>
</span><span id="line-163"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.UsageEnv.html"><span class="hs-identifier">GHC.Core.UsageEnv</span></a></span><span>
</span><span id="line-164"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Multiplicity.html"><span class="hs-identifier">GHC.Core.Multiplicity</span></a></span><span>
</span><span id="line-165"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Type.html"><span class="hs-identifier">GHC.Core.Type</span></a></span><span>
</span><span id="line-166"></span><span>
</span><span id="line-167"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html"><span class="hs-identifier">GHC.Tc.Utils.TcType</span></a></span><span>
</span><span id="line-168"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html"><span class="hs-identifier">GHC.Core.InstEnv</span></a></span><span>
</span><span id="line-169"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html"><span class="hs-identifier">GHC.Core.FamInstEnv</span></a></span><span>
</span><span id="line-170"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html"><span class="hs-identifier">GHC.Builtin.Names</span></a></span><span>
</span><span id="line-171"></span><span>
</span><span id="line-172"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.html"><span class="hs-identifier">GHC.Types.Id</span></a></span><span>
</span><span id="line-173"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html"><span class="hs-identifier">GHC.Types.Var.Set</span></a></span><span>
</span><span id="line-174"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html"><span class="hs-identifier">GHC.Types.Var.Env</span></a></span><span>
</span><span id="line-175"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html"><span class="hs-identifier">GHC.Utils.Error</span></a></span><span>
</span><span id="line-176"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html"><span class="hs-identifier">GHC.Types.SrcLoc</span></a></span><span>
</span><span id="line-177"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Env.html"><span class="hs-identifier">GHC.Types.Name.Env</span></a></span><span>
</span><span id="line-178"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html"><span class="hs-identifier">GHC.Types.Name.Set</span></a></span><span>
</span><span id="line-179"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html"><span class="hs-identifier">GHC.Data.Bag</span></a></span><span>
</span><span id="line-180"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Outputable</span></span><span>
</span><span id="line-181"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html"><span class="hs-identifier">GHC.Types.Unique.Supply</span></a></span><span>
</span><span id="line-182"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html"><span class="hs-identifier">GHC.Driver.Session</span></a></span><span>
</span><span id="line-183"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html"><span class="hs-identifier">GHC.Data.FastString</span></a></span><span>
</span><span id="line-184"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-185"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-186"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Annotations.html"><span class="hs-identifier">GHC.Types.Annotations</span></a></span><span>
</span><span id="line-187"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html"><span class="hs-identifier">GHC.Types.Basic</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#TopLevelFlag"><span class="hs-identifier">TopLevelFlag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#TypeOrKind"><span class="hs-identifier">TypeOrKind</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-188"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html"><span class="hs-identifier">GHC.Data.Maybe</span></a></span><span>
</span><span id="line-189"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.CostCentre.State.html"><span class="hs-identifier">GHC.Types.CostCentre.State</span></a></span><span>
</span><span id="line-190"></span><span>
</span><span id="line-191"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../ghc-boot/src/GHC.LanguageExtensions.html#"><span class="hs-identifier">GHC.LanguageExtensions</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LangExt</span></span><span>
</span><span id="line-192"></span><span>
</span><span id="line-193"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base/src/Data.IORef.html#"><span class="hs-identifier">Data.IORef</span></a></span><span>
</span><span id="line-194"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base/src/Control.Monad.html#"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-195"></span><span>
</span><span id="line-196"></span><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html"><span class="hs-identifier">GHC.Tc.Utils.Env</span></a></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html#tcInitTidyEnv"><span class="hs-identifier">tcInitTidyEnv</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../containers/src/Data.Map.html#"><span class="hs-identifier">Data.Map</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                        initTc
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-207"></span><span>
</span><span id="line-208"></span><span class="hs-comment">-- | Setup the initial typechecking environment</span><span>
</span><span id="line-209"></span><span id="local-6989586621681082970"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#initTc"><span class="hs-identifier hs-type">initTc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-210"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Phases.html#HscSource"><span class="hs-identifier hs-type">HscSource</span></a></span><span>
</span><span id="line-211"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>          </span><span class="hs-comment">-- True &lt;=&gt; retain renamed syntax trees</span><span>
</span><span id="line-212"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span>
</span><span id="line-213"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#RealSrcSpan"><span class="hs-identifier hs-type">RealSrcSpan</span></a></span><span>
</span><span id="line-214"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082970"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-215"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082970"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-216"></span><span>                </span><span class="hs-comment">-- Nothing =&gt; error thrown by the thing inside</span><span>
</span><span id="line-217"></span><span>                </span><span class="hs-comment">-- (error messages should have been printed already)</span><span>
</span><span id="line-218"></span><span>
</span><span id="line-219"></span><span id="initTc"><span class="annot"><span class="annottext">initTc :: forall r.
HscEnv
-&gt; HscSource
-&gt; Bool
-&gt; Module
-&gt; RealSrcSpan
-&gt; TcM r
-&gt; IO (Messages, Maybe r)
</span><a href="GHC.Tc.Utils.Monad.html#initTc"><span class="hs-identifier hs-var hs-var">initTc</span></a></span></span><span> </span><span id="local-6989586621681081928"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681081928"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681081927"><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621681081927"><span class="hs-identifier hs-var">hsc_src</span></a></span></span><span> </span><span id="local-6989586621681081926"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681081926"><span class="hs-identifier hs-var">keep_rn_syntax</span></a></span></span><span> </span><span id="local-6989586621681081925"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681081925"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span id="local-6989586621681081924"><span class="annot"><span class="annottext">RealSrcSpan
</span><a href="#local-6989586621681081924"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681081923"><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621681081923"><span class="hs-identifier hs-var">do_this</span></a></span></span><span>
</span><span id="line-220"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081922"><span class="annot"><span class="annottext">IORef NameSet
</span><a href="#local-6989586621681081922"><span class="hs-identifier hs-var">keep_var</span></a></span></span><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NameSet -&gt; IO (IORef NameSet)
forall a. a -&gt; IO (IORef a)
</span><a href="../../base/src/GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a></span><span> </span><span class="annot"><span class="annottext">NameSet
</span><a href="GHC.Types.Name.Set.html#emptyNameSet"><span class="hs-identifier hs-var">emptyNameSet</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-221"></span><span>        </span><span id="local-6989586621681081919"><span class="annot"><span class="annottext">IORef [GlobalRdrElt]
</span><a href="#local-6989586621681081919"><span class="hs-identifier hs-var">used_gre_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt] -&gt; IO (IORef [GlobalRdrElt])
forall a. a -&gt; IO (IORef a)
</span><a href="../../base/src/GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-222"></span><span>        </span><span id="local-6989586621681081918"><span class="annot"><span class="annottext">IORef Bool
</span><a href="#local-6989586621681081918"><span class="hs-identifier hs-var">th_var</span></a></span></span><span>       </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; IO (IORef Bool)
forall a. a -&gt; IO (IORef a)
</span><a href="../../base/src/GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-223"></span><span>        </span><span id="local-6989586621681081917"><span class="annot"><span class="annottext">IORef Bool
</span><a href="#local-6989586621681081917"><span class="hs-identifier hs-var">th_splice_var</span></a></span></span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; IO (IORef Bool)
forall a. a -&gt; IO (IORef a)
</span><a href="../../base/src/GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-224"></span><span>        </span><span id="local-6989586621681081916"><span class="annot"><span class="annottext">IORef (Bool, Bag WarnMsg)
</span><a href="#local-6989586621681081916"><span class="hs-identifier hs-var">infer_var</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Bool, Bag WarnMsg) -&gt; IO (IORef (Bool, Bag WarnMsg))
forall a. a -&gt; IO (IORef a)
</span><a href="../../base/src/GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bag WarnMsg
forall a. Bag a
</span><a href="GHC.Data.Bag.html#emptyBag"><span class="hs-identifier hs-var">emptyBag</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-225"></span><span>        </span><span id="local-6989586621681081914"><span class="annot"><span class="annottext">IORef OccSet
</span><a href="#local-6989586621681081914"><span class="hs-identifier hs-var">dfun_n_var</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">OccSet -&gt; IO (IORef OccSet)
forall a. a -&gt; IO (IORef a)
</span><a href="../../base/src/GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a></span><span> </span><span class="annot"><span class="annottext">OccSet
</span><a href="GHC.Types.Name.Occurrence.html#emptyOccSet"><span class="hs-identifier hs-var">emptyOccSet</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-226"></span><span>        </span><span id="local-6989586621681081912"><span class="annot"><span class="annottext">IORef TypeEnv
</span><a href="#local-6989586621681081912"><span class="hs-identifier hs-var">type_env_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Maybe (Module, IORef TypeEnv)
</span><a href="GHC.Driver.Types.html#hsc_type_env_var"><span class="hs-identifier hs-var hs-var">hsc_type_env_var</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681081928"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-227"></span><span>                           </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681081910"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681081910"><span class="hs-identifier hs-var">_mod</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681081909"><span class="annot"><span class="annottext">IORef TypeEnv
</span><a href="#local-6989586621681081909"><span class="hs-identifier hs-var">te_var</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IORef TypeEnv -&gt; IO (IORef TypeEnv)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">IORef TypeEnv
</span><a href="#local-6989586621681081909"><span class="hs-identifier hs-var">te_var</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-228"></span><span>                           </span><span class="annot"><span class="annottext">Maybe (Module, IORef TypeEnv)
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeEnv -&gt; IO (IORef TypeEnv)
forall a. a -&gt; IO (IORef a)
</span><a href="../../base/src/GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a></span><span> </span><span class="annot"><span class="annottext">TypeEnv
forall a. NameEnv a
</span><a href="GHC.Types.Name.Env.html#emptyNameEnv"><span class="hs-identifier hs-var">emptyNameEnv</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-229"></span><span>
</span><span id="line-230"></span><span>        </span><span id="local-6989586621681081907"><span class="annot"><span class="annottext">IORef [FilePath]
</span><a href="#local-6989586621681081907"><span class="hs-identifier hs-var">dependent_files_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[FilePath] -&gt; IO (IORef [FilePath])
forall a. a -&gt; IO (IORef a)
</span><a href="../../base/src/GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-231"></span><span>        </span><span id="local-6989586621681081906"><span class="annot"><span class="annottext">IORef WantedConstraints
</span><a href="#local-6989586621681081906"><span class="hs-identifier hs-var">static_wc_var</span></a></span></span><span>       </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">WantedConstraints -&gt; IO (IORef WantedConstraints)
forall a. a -&gt; IO (IORef a)
</span><a href="../../base/src/GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a></span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="GHC.Tc.Types.Constraint.html#emptyWC"><span class="hs-identifier hs-var">emptyWC</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-232"></span><span>        </span><span id="local-6989586621681081904"><span class="annot"><span class="annottext">IORef CostCentreState
</span><a href="#local-6989586621681081904"><span class="hs-identifier hs-var">cc_st_var</span></a></span></span><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CostCentreState -&gt; IO (IORef CostCentreState)
forall a. a -&gt; IO (IORef a)
</span><a href="../../base/src/GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a></span><span> </span><span class="annot"><span class="annottext">CostCentreState
</span><a href="GHC.Types.CostCentre.State.html#newCostCentreState"><span class="hs-identifier hs-var">newCostCentreState</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-233"></span><span>        </span><span id="local-6989586621681081902"><span class="annot"><span class="annottext">IORef [LHsDecl GhcPs]
</span><a href="#local-6989586621681081902"><span class="hs-identifier hs-var">th_topdecls_var</span></a></span></span><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[LHsDecl GhcPs] -&gt; IO (IORef [LHsDecl GhcPs])
forall a. a -&gt; IO (IORef a)
</span><a href="../../base/src/GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-234"></span><span>        </span><span id="local-6989586621681081901"><span class="annot"><span class="annottext">IORef [(ForeignSrcLang, FilePath)]
</span><a href="#local-6989586621681081901"><span class="hs-identifier hs-var">th_foreign_files_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(ForeignSrcLang, FilePath)]
-&gt; IO (IORef [(ForeignSrcLang, FilePath)])
forall a. a -&gt; IO (IORef a)
</span><a href="../../base/src/GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-235"></span><span>        </span><span id="local-6989586621681081900"><span class="annot"><span class="annottext">IORef NameSet
</span><a href="#local-6989586621681081900"><span class="hs-identifier hs-var">th_topnames_var</span></a></span></span><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NameSet -&gt; IO (IORef NameSet)
forall a. a -&gt; IO (IORef a)
</span><a href="../../base/src/GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a></span><span> </span><span class="annot"><span class="annottext">NameSet
</span><a href="GHC.Types.Name.Set.html#emptyNameSet"><span class="hs-identifier hs-var">emptyNameSet</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-236"></span><span>        </span><span id="local-6989586621681081899"><span class="annot"><span class="annottext">IORef [(TcLclEnv, ThModFinalizers)]
</span><a href="#local-6989586621681081899"><span class="hs-identifier hs-var">th_modfinalizers_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(TcLclEnv, ThModFinalizers)]
-&gt; IO (IORef [(TcLclEnv, ThModFinalizers)])
forall a. a -&gt; IO (IORef a)
</span><a href="../../base/src/GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-237"></span><span>        </span><span id="local-6989586621681081898"><span class="annot"><span class="annottext">IORef [FilePath]
</span><a href="#local-6989586621681081898"><span class="hs-identifier hs-var">th_coreplugins_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[FilePath] -&gt; IO (IORef [FilePath])
forall a. a -&gt; IO (IORef a)
</span><a href="../../base/src/GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-238"></span><span>        </span><span id="local-6989586621681081897"><span class="annot"><span class="annottext">IORef (Map TypeRep Dynamic)
</span><a href="#local-6989586621681081897"><span class="hs-identifier hs-var">th_state_var</span></a></span></span><span>         </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Map TypeRep Dynamic -&gt; IO (IORef (Map TypeRep Dynamic))
forall a. a -&gt; IO (IORef a)
</span><a href="../../base/src/GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a></span><span> </span><span class="annot"><span class="annottext">Map TypeRep Dynamic
forall k a. Map k a
</span><a href="../../containers/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">Map.empty</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-239"></span><span>        </span><span id="local-6989586621681081895"><span class="annot"><span class="annottext">IORef (Maybe (ForeignRef (IORef QState)))
</span><a href="#local-6989586621681081895"><span class="hs-identifier hs-var">th_remote_state_var</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (ForeignRef (IORef QState))
-&gt; IO (IORef (Maybe (ForeignRef (IORef QState))))
forall a. a -&gt; IO (IORef a)
</span><a href="../../base/src/GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (ForeignRef (IORef QState))
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-240"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-241"></span><span>             </span><span id="local-6989586621681081894"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621681081894"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681081928"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-242"></span><span>
</span><span id="line-243"></span><span>             </span><span class="annot"><a href="#local-6989586621681081892"><span class="hs-identifier hs-type">maybe_rn_syntax</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681082939"><span class="annot"><a href="#local-6989586621681082939"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="#local-6989586621681082939"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082939"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-244"></span><span>             </span><span id="local-6989586621681081892"><span class="annot"><span class="annottext">maybe_rn_syntax :: forall a. a -&gt; Maybe a
</span><a href="#local-6989586621681081892"><span class="hs-identifier hs-var hs-var">maybe_rn_syntax</span></a></span></span><span> </span><span id="local-6989586621681081891"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681081891"><span class="hs-identifier hs-var">empty_val</span></a></span></span><span>
</span><span id="line-245"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DumpFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#dopt"><span class="hs-identifier hs-var">dopt</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_rn_ast"><span class="hs-identifier hs-var">Opt_D_dump_rn_ast</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681081894"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681081891"><span class="hs-identifier hs-var">empty_val</span></a></span><span>
</span><span id="line-246"></span><span>
</span><span id="line-247"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_WriteHie"><span class="hs-identifier hs-var">Opt_WriteHie</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681081894"><span class="hs-identifier hs-var">dflags</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681081891"><span class="hs-identifier hs-var">empty_val</span></a></span><span>
</span><span id="line-248"></span><span>
</span><span id="line-249"></span><span>                  </span><span class="hs-comment">-- We want to serialize the documentation in the .hi-files,</span><span>
</span><span id="line-250"></span><span>                  </span><span class="hs-comment">-- and need to extract it from the renamed syntax first.</span><span>
</span><span id="line-251"></span><span>                  </span><span class="hs-comment">-- See 'GHC.HsToCore.Docs.extractDocs'.</span><span>
</span><span id="line-252"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_Haddock"><span class="hs-identifier hs-var">Opt_Haddock</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681081894"><span class="hs-identifier hs-var">dflags</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681081891"><span class="hs-identifier hs-var">empty_val</span></a></span><span>
</span><span id="line-253"></span><span>
</span><span id="line-254"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681081926"><span class="hs-identifier hs-var">keep_rn_syntax</span></a></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681081891"><span class="hs-identifier hs-var">empty_val</span></a></span><span>
</span><span id="line-255"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>                     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-256"></span><span>
</span><span id="line-257"></span><span>             </span><span id="local-6989586621681081880"><span class="annot"><span class="annottext">gbl_env :: TcGblEnv
</span><a href="#local-6989586621681081880"><span class="hs-identifier hs-var hs-var">gbl_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv :: Module
-&gt; Module
-&gt; HscSource
-&gt; GlobalRdrEnv
-&gt; Maybe [Type]
-&gt; FixityEnv
-&gt; RecFieldEnv
-&gt; TypeEnv
-&gt; IORef TypeEnv
-&gt; InstEnv
-&gt; FamInstEnv
-&gt; AnnEnv
-&gt; [AvailInfo]
-&gt; ImportAvails
-&gt; DefUses
-&gt; IORef [GlobalRdrElt]
-&gt; IORef NameSet
-&gt; IORef Bool
-&gt; IORef Bool
-&gt; IORef OccSet
-&gt; [(Module, Fingerprint)]
-&gt; Maybe [(Located (IE GhcRn), [AvailInfo])]
-&gt; [LImportDecl GhcRn]
-&gt; Maybe (HsGroup GhcRn)
-&gt; IORef [FilePath]
-&gt; IORef [LHsDecl GhcPs]
-&gt; IORef [(ForeignSrcLang, FilePath)]
-&gt; IORef NameSet
-&gt; IORef [(TcLclEnv, ThModFinalizers)]
-&gt; IORef [FilePath]
-&gt; IORef (Map TypeRep Dynamic)
-&gt; IORef (Maybe (ForeignRef (IORef QState)))
-&gt; Bag EvBind
-&gt; Maybe Id
-&gt; LHsBinds GhcTc
-&gt; NameSet
-&gt; [LTcSpecPrag]
-&gt; Warnings
-&gt; [Annotation]
-&gt; [TyCon]
-&gt; [ClsInst]
-&gt; [FamInst]
-&gt; [LRuleDecl GhcTc]
-&gt; [LForeignDecl GhcTc]
-&gt; [PatSyn]
-&gt; Maybe LHsDocString
-&gt; Bool
-&gt; SelfBootInfo
-&gt; Maybe Name
-&gt; IORef (Bool, Bag WarnMsg)
-&gt; [TcPluginSolver]
-&gt; [HoleFitPlugin]
-&gt; RealSrcSpan
-&gt; IORef WantedConstraints
-&gt; [CompleteMatch]
-&gt; IORef CostCentreState
-&gt; TcGblEnv
</span><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-258"></span><span>                </span><span class="annot"><span class="annottext">tcg_th_topdecls :: IORef [LHsDecl GhcPs]
</span><a href="GHC.Tc.Types.html#tcg_th_topdecls"><span class="hs-identifier hs-var">tcg_th_topdecls</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef [LHsDecl GhcPs]
</span><a href="#local-6989586621681081902"><span class="hs-identifier hs-var">th_topdecls_var</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-259"></span><span>                </span><span class="annot"><span class="annottext">tcg_th_foreign_files :: IORef [(ForeignSrcLang, FilePath)]
</span><a href="GHC.Tc.Types.html#tcg_th_foreign_files"><span class="hs-identifier hs-var">tcg_th_foreign_files</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef [(ForeignSrcLang, FilePath)]
</span><a href="#local-6989586621681081901"><span class="hs-identifier hs-var">th_foreign_files_var</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-260"></span><span>                </span><span class="annot"><span class="annottext">tcg_th_topnames :: IORef NameSet
</span><a href="GHC.Tc.Types.html#tcg_th_topnames"><span class="hs-identifier hs-var">tcg_th_topnames</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef NameSet
</span><a href="#local-6989586621681081900"><span class="hs-identifier hs-var">th_topnames_var</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-261"></span><span>                </span><span class="annot"><span class="annottext">tcg_th_modfinalizers :: IORef [(TcLclEnv, ThModFinalizers)]
</span><a href="GHC.Tc.Types.html#tcg_th_modfinalizers"><span class="hs-identifier hs-var">tcg_th_modfinalizers</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef [(TcLclEnv, ThModFinalizers)]
</span><a href="#local-6989586621681081899"><span class="hs-identifier hs-var">th_modfinalizers_var</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-262"></span><span>                </span><span class="annot"><span class="annottext">tcg_th_coreplugins :: IORef [FilePath]
</span><a href="GHC.Tc.Types.html#tcg_th_coreplugins"><span class="hs-identifier hs-var">tcg_th_coreplugins</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef [FilePath]
</span><a href="#local-6989586621681081898"><span class="hs-identifier hs-var">th_coreplugins_var</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-263"></span><span>                </span><span class="annot"><span class="annottext">tcg_th_state :: IORef (Map TypeRep Dynamic)
</span><a href="GHC.Tc.Types.html#tcg_th_state"><span class="hs-identifier hs-var">tcg_th_state</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef (Map TypeRep Dynamic)
</span><a href="#local-6989586621681081897"><span class="hs-identifier hs-var">th_state_var</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-264"></span><span>                </span><span class="annot"><span class="annottext">tcg_th_remote_state :: IORef (Maybe (ForeignRef (IORef QState)))
</span><a href="GHC.Tc.Types.html#tcg_th_remote_state"><span class="hs-identifier hs-var">tcg_th_remote_state</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef (Maybe (ForeignRef (IORef QState)))
</span><a href="#local-6989586621681081895"><span class="hs-identifier hs-var">th_remote_state_var</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-265"></span><span>
</span><span id="line-266"></span><span>                </span><span class="annot"><span class="annottext">tcg_mod :: Module
</span><a href="GHC.Tc.Types.html#tcg_mod"><span class="hs-identifier hs-var">tcg_mod</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681081925"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-267"></span><span>                </span><span class="annot"><span class="annottext">tcg_semantic_mod :: Module
</span><a href="GHC.Tc.Types.html#tcg_semantic_mod"><span class="hs-identifier hs-var">tcg_semantic_mod</span></a></span><span>   </span><span class="hs-glyph">=</span><span>
</span><span id="line-268"></span><span>                    </span><span class="annot"><span class="annottext">DynFlags -&gt; Module -&gt; Module
</span><a href="GHC.Driver.Session.html#canonicalizeModuleIfHome"><span class="hs-identifier hs-var">canonicalizeModuleIfHome</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681081894"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681081925"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-269"></span><span>                </span><span class="annot"><span class="annottext">tcg_src :: HscSource
</span><a href="GHC.Tc.Types.html#tcg_src"><span class="hs-identifier hs-var">tcg_src</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621681081927"><span class="hs-identifier hs-var">hsc_src</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-270"></span><span>                </span><span class="annot"><span class="annottext">tcg_rdr_env :: GlobalRdrEnv
</span><a href="GHC.Tc.Types.html#tcg_rdr_env"><span class="hs-identifier hs-var">tcg_rdr_env</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="GHC.Types.Name.Reader.html#emptyGlobalRdrEnv"><span class="hs-identifier hs-var">emptyGlobalRdrEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-271"></span><span>                </span><span class="annot"><span class="annottext">tcg_fix_env :: FixityEnv
</span><a href="GHC.Tc.Types.html#tcg_fix_env"><span class="hs-identifier hs-var">tcg_fix_env</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FixityEnv
forall a. NameEnv a
</span><a href="GHC.Types.Name.Env.html#emptyNameEnv"><span class="hs-identifier hs-var">emptyNameEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-272"></span><span>                </span><span class="annot"><span class="annottext">tcg_field_env :: RecFieldEnv
</span><a href="GHC.Tc.Types.html#tcg_field_env"><span class="hs-identifier hs-var">tcg_field_env</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RecFieldEnv
forall a. NameEnv a
</span><a href="GHC.Types.Name.Env.html#emptyNameEnv"><span class="hs-identifier hs-var">emptyNameEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-273"></span><span>                </span><span class="annot"><span class="annottext">tcg_default :: Maybe [Type]
</span><a href="GHC.Tc.Types.html#tcg_default"><span class="hs-identifier hs-var">tcg_default</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Module -&gt; Unit
forall unit. GenModule unit -&gt; unit
</span><a href="GHC.Unit.Types.html#moduleUnit"><span class="hs-identifier hs-var hs-var">moduleUnit</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681081925"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">Unit -&gt; Unit -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Unit
</span><a href="GHC.Unit.Types.html#primUnit"><span class="hs-identifier hs-var">primUnit</span></a></span><span>
</span><span id="line-274"></span><span>                                     </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Module -&gt; Unit
forall unit. GenModule unit -&gt; unit
</span><a href="GHC.Unit.Types.html#moduleUnit"><span class="hs-identifier hs-var hs-var">moduleUnit</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681081925"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">Unit -&gt; Unit -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Unit
</span><a href="GHC.Unit.Types.html#bignumUnit"><span class="hs-identifier hs-var">bignumUnit</span></a></span><span>
</span><span id="line-275"></span><span>                                     </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; Maybe [Type]
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- See Note [Default types]</span><span>
</span><span id="line-276"></span><span>                                     </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe [Type]
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-277"></span><span>                </span><span class="annot"><span class="annottext">tcg_type_env :: TypeEnv
</span><a href="GHC.Tc.Types.html#tcg_type_env"><span class="hs-identifier hs-var">tcg_type_env</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeEnv
forall a. NameEnv a
</span><a href="GHC.Types.Name.Env.html#emptyNameEnv"><span class="hs-identifier hs-var">emptyNameEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-278"></span><span>                </span><span class="annot"><span class="annottext">tcg_type_env_var :: IORef TypeEnv
</span><a href="GHC.Tc.Types.html#tcg_type_env_var"><span class="hs-identifier hs-var">tcg_type_env_var</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef TypeEnv
</span><a href="#local-6989586621681081912"><span class="hs-identifier hs-var">type_env_var</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-279"></span><span>                </span><span class="annot"><span class="annottext">tcg_inst_env :: InstEnv
</span><a href="GHC.Tc.Types.html#tcg_inst_env"><span class="hs-identifier hs-var">tcg_inst_env</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InstEnv
</span><a href="GHC.Core.InstEnv.html#emptyInstEnv"><span class="hs-identifier hs-var">emptyInstEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-280"></span><span>                </span><span class="annot"><span class="annottext">tcg_fam_inst_env :: FamInstEnv
</span><a href="GHC.Tc.Types.html#tcg_fam_inst_env"><span class="hs-identifier hs-var">tcg_fam_inst_env</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FamInstEnv
</span><a href="GHC.Core.FamInstEnv.html#emptyFamInstEnv"><span class="hs-identifier hs-var">emptyFamInstEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-281"></span><span>                </span><span class="annot"><span class="annottext">tcg_ann_env :: AnnEnv
</span><a href="GHC.Tc.Types.html#tcg_ann_env"><span class="hs-identifier hs-var">tcg_ann_env</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AnnEnv
</span><a href="GHC.Types.Annotations.html#emptyAnnEnv"><span class="hs-identifier hs-var">emptyAnnEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-282"></span><span>                </span><span class="annot"><span class="annottext">tcg_th_used :: IORef Bool
</span><a href="GHC.Tc.Types.html#tcg_th_used"><span class="hs-identifier hs-var">tcg_th_used</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef Bool
</span><a href="#local-6989586621681081918"><span class="hs-identifier hs-var">th_var</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-283"></span><span>                </span><span class="annot"><span class="annottext">tcg_th_splice_used :: IORef Bool
</span><a href="GHC.Tc.Types.html#tcg_th_splice_used"><span class="hs-identifier hs-var">tcg_th_splice_used</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef Bool
</span><a href="#local-6989586621681081917"><span class="hs-identifier hs-var">th_splice_var</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-284"></span><span>                </span><span class="annot"><span class="annottext">tcg_exports :: [AvailInfo]
</span><a href="GHC.Tc.Types.html#tcg_exports"><span class="hs-identifier hs-var">tcg_exports</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-285"></span><span>                </span><span class="annot"><span class="annottext">tcg_imports :: ImportAvails
</span><a href="GHC.Tc.Types.html#tcg_imports"><span class="hs-identifier hs-var">tcg_imports</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImportAvails
</span><a href="GHC.Tc.Types.html#emptyImportAvails"><span class="hs-identifier hs-var">emptyImportAvails</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-286"></span><span>                </span><span class="annot"><span class="annottext">tcg_used_gres :: IORef [GlobalRdrElt]
</span><a href="GHC.Tc.Types.html#tcg_used_gres"><span class="hs-identifier hs-var">tcg_used_gres</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef [GlobalRdrElt]
</span><a href="#local-6989586621681081919"><span class="hs-identifier hs-var">used_gre_var</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-287"></span><span>                </span><span class="annot"><span class="annottext">tcg_dus :: DefUses
</span><a href="GHC.Tc.Types.html#tcg_dus"><span class="hs-identifier hs-var">tcg_dus</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DefUses
</span><a href="GHC.Types.Name.Set.html#emptyDUs"><span class="hs-identifier hs-var">emptyDUs</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-288"></span><span>
</span><span id="line-289"></span><span>                </span><span class="annot"><span class="annottext">tcg_rn_imports :: [LImportDecl GhcRn]
</span><a href="GHC.Tc.Types.html#tcg_rn_imports"><span class="hs-identifier hs-var">tcg_rn_imports</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-290"></span><span>                </span><span class="annot"><span class="annottext">tcg_rn_exports :: Maybe [(Located (IE GhcRn), [AvailInfo])]
</span><a href="GHC.Tc.Types.html#tcg_rn_exports"><span class="hs-identifier hs-var">tcg_rn_exports</span></a></span><span>     </span><span class="hs-glyph">=</span><span>
</span><span id="line-291"></span><span>                    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621681081927"><span class="hs-identifier hs-var">hsc_src</span></a></span><span> </span><span class="annot"><span class="annottext">HscSource -&gt; HscSource -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="GHC.Driver.Phases.html#HsigFile"><span class="hs-identifier hs-var">HsigFile</span></a></span><span>
</span><span id="line-292"></span><span>                        </span><span class="hs-comment">-- Always retain renamed syntax, so that we can give</span><span>
</span><span id="line-293"></span><span>                        </span><span class="hs-comment">-- better errors.  (TODO: how?)</span><span>
</span><span id="line-294"></span><span>                        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[(Located (IE GhcRn), [AvailInfo])]
-&gt; Maybe [(Located (IE GhcRn), [AvailInfo])]
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-295"></span><span>                        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[(Located (IE GhcRn), [AvailInfo])]
-&gt; Maybe [(Located (IE GhcRn), [AvailInfo])]
forall a. a -&gt; Maybe a
</span><a href="#local-6989586621681081892"><span class="hs-identifier hs-var">maybe_rn_syntax</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-296"></span><span>                </span><span class="annot"><span class="annottext">tcg_rn_decls :: Maybe (HsGroup GhcRn)
</span><a href="GHC.Tc.Types.html#tcg_rn_decls"><span class="hs-identifier hs-var">tcg_rn_decls</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsGroup GhcRn -&gt; Maybe (HsGroup GhcRn)
forall a. a -&gt; Maybe a
</span><a href="#local-6989586621681081892"><span class="hs-identifier hs-var">maybe_rn_syntax</span></a></span><span> </span><span class="annot"><span class="annottext">HsGroup GhcRn
forall (p :: Pass). HsGroup (GhcPass p)
</span><a href="GHC.Hs.Decls.html#emptyRnGroup"><span class="hs-identifier hs-var">emptyRnGroup</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-297"></span><span>                </span><span class="annot"><span class="annottext">tcg_tr_module :: Maybe Id
</span><a href="GHC.Tc.Types.html#tcg_tr_module"><span class="hs-identifier hs-var">tcg_tr_module</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Id
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-298"></span><span>                </span><span class="annot"><span class="annottext">tcg_binds :: LHsBinds GhcTc
</span><a href="GHC.Tc.Types.html#tcg_binds"><span class="hs-identifier hs-var">tcg_binds</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsBinds GhcTc
forall idL idR. LHsBindsLR idL idR
</span><a href="GHC.Hs.Binds.html#emptyLHsBinds"><span class="hs-identifier hs-var">emptyLHsBinds</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-299"></span><span>                </span><span class="annot"><span class="annottext">tcg_imp_specs :: [LTcSpecPrag]
</span><a href="GHC.Tc.Types.html#tcg_imp_specs"><span class="hs-identifier hs-var">tcg_imp_specs</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-300"></span><span>                </span><span class="annot"><span class="annottext">tcg_sigs :: NameSet
</span><a href="GHC.Tc.Types.html#tcg_sigs"><span class="hs-identifier hs-var">tcg_sigs</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NameSet
</span><a href="GHC.Types.Name.Set.html#emptyNameSet"><span class="hs-identifier hs-var">emptyNameSet</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-301"></span><span>                </span><span class="annot"><span class="annottext">tcg_ev_binds :: Bag EvBind
</span><a href="GHC.Tc.Types.html#tcg_ev_binds"><span class="hs-identifier hs-var">tcg_ev_binds</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bag EvBind
forall a. Bag a
</span><a href="GHC.Data.Bag.html#emptyBag"><span class="hs-identifier hs-var">emptyBag</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-302"></span><span>                </span><span class="annot"><span class="annottext">tcg_warns :: Warnings
</span><a href="GHC.Tc.Types.html#tcg_warns"><span class="hs-identifier hs-var">tcg_warns</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Warnings
</span><a href="GHC.Driver.Types.html#NoWarnings"><span class="hs-identifier hs-var">NoWarnings</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-303"></span><span>                </span><span class="annot"><span class="annottext">tcg_anns :: [Annotation]
</span><a href="GHC.Tc.Types.html#tcg_anns"><span class="hs-identifier hs-var">tcg_anns</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-304"></span><span>                </span><span class="annot"><span class="annottext">tcg_tcs :: [TyCon]
</span><a href="GHC.Tc.Types.html#tcg_tcs"><span class="hs-identifier hs-var">tcg_tcs</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-305"></span><span>                </span><span class="annot"><span class="annottext">tcg_insts :: [ClsInst]
</span><a href="GHC.Tc.Types.html#tcg_insts"><span class="hs-identifier hs-var">tcg_insts</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-306"></span><span>                </span><span class="annot"><span class="annottext">tcg_fam_insts :: [FamInst]
</span><a href="GHC.Tc.Types.html#tcg_fam_insts"><span class="hs-identifier hs-var">tcg_fam_insts</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-307"></span><span>                </span><span class="annot"><span class="annottext">tcg_rules :: [LRuleDecl GhcTc]
</span><a href="GHC.Tc.Types.html#tcg_rules"><span class="hs-identifier hs-var">tcg_rules</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-308"></span><span>                </span><span class="annot"><span class="annottext">tcg_fords :: [LForeignDecl GhcTc]
</span><a href="GHC.Tc.Types.html#tcg_fords"><span class="hs-identifier hs-var">tcg_fords</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-309"></span><span>                </span><span class="annot"><span class="annottext">tcg_patsyns :: [PatSyn]
</span><a href="GHC.Tc.Types.html#tcg_patsyns"><span class="hs-identifier hs-var">tcg_patsyns</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-310"></span><span>                </span><span class="annot"><span class="annottext">tcg_merged :: [(Module, Fingerprint)]
</span><a href="GHC.Tc.Types.html#tcg_merged"><span class="hs-identifier hs-var">tcg_merged</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-311"></span><span>                </span><span class="annot"><span class="annottext">tcg_dfun_n :: IORef OccSet
</span><a href="GHC.Tc.Types.html#tcg_dfun_n"><span class="hs-identifier hs-var">tcg_dfun_n</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef OccSet
</span><a href="#local-6989586621681081914"><span class="hs-identifier hs-var">dfun_n_var</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-312"></span><span>                </span><span class="annot"><span class="annottext">tcg_keep :: IORef NameSet
</span><a href="GHC.Tc.Types.html#tcg_keep"><span class="hs-identifier hs-var">tcg_keep</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef NameSet
</span><a href="#local-6989586621681081922"><span class="hs-identifier hs-var">keep_var</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-313"></span><span>                </span><span class="annot"><span class="annottext">tcg_doc_hdr :: Maybe LHsDocString
</span><a href="GHC.Tc.Types.html#tcg_doc_hdr"><span class="hs-identifier hs-var">tcg_doc_hdr</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe LHsDocString
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-314"></span><span>                </span><span class="annot"><span class="annottext">tcg_hpc :: Bool
</span><a href="GHC.Tc.Types.html#tcg_hpc"><span class="hs-identifier hs-var">tcg_hpc</span></a></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span>
</span><span id="line-315"></span><span>                </span><span class="annot"><span class="annottext">tcg_main :: Maybe Name
</span><a href="GHC.Tc.Types.html#tcg_main"><span class="hs-identifier hs-var">tcg_main</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Name
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-316"></span><span>                </span><span class="annot"><span class="annottext">tcg_self_boot :: SelfBootInfo
</span><a href="GHC.Tc.Types.html#tcg_self_boot"><span class="hs-identifier hs-var">tcg_self_boot</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SelfBootInfo
</span><a href="GHC.Tc.Types.html#NoSelfBoot"><span class="hs-identifier hs-var">NoSelfBoot</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-317"></span><span>                </span><span class="annot"><span class="annottext">tcg_safeInfer :: IORef (Bool, Bag WarnMsg)
</span><a href="GHC.Tc.Types.html#tcg_safeInfer"><span class="hs-identifier hs-var">tcg_safeInfer</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef (Bool, Bag WarnMsg)
</span><a href="#local-6989586621681081916"><span class="hs-identifier hs-var">infer_var</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-318"></span><span>                </span><span class="annot"><span class="annottext">tcg_dependent_files :: IORef [FilePath]
</span><a href="GHC.Tc.Types.html#tcg_dependent_files"><span class="hs-identifier hs-var">tcg_dependent_files</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef [FilePath]
</span><a href="#local-6989586621681081907"><span class="hs-identifier hs-var">dependent_files_var</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-319"></span><span>                </span><span class="annot"><span class="annottext">tcg_tc_plugins :: [TcPluginSolver]
</span><a href="GHC.Tc.Types.html#tcg_tc_plugins"><span class="hs-identifier hs-var">tcg_tc_plugins</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-320"></span><span>                </span><span class="annot"><span class="annottext">tcg_hf_plugins :: [HoleFitPlugin]
</span><a href="GHC.Tc.Types.html#tcg_hf_plugins"><span class="hs-identifier hs-var">tcg_hf_plugins</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-321"></span><span>                </span><span class="annot"><span class="annottext">tcg_top_loc :: RealSrcSpan
</span><a href="GHC.Tc.Types.html#tcg_top_loc"><span class="hs-identifier hs-var">tcg_top_loc</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RealSrcSpan
</span><a href="#local-6989586621681081924"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-322"></span><span>                </span><span class="annot"><span class="annottext">tcg_static_wc :: IORef WantedConstraints
</span><a href="GHC.Tc.Types.html#tcg_static_wc"><span class="hs-identifier hs-var">tcg_static_wc</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef WantedConstraints
</span><a href="#local-6989586621681081906"><span class="hs-identifier hs-var">static_wc_var</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-323"></span><span>                </span><span class="annot"><span class="annottext">tcg_complete_matches :: [CompleteMatch]
</span><a href="GHC.Tc.Types.html#tcg_complete_matches"><span class="hs-identifier hs-var">tcg_complete_matches</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-324"></span><span>                </span><span class="annot"><span class="annottext">tcg_cc_st :: IORef CostCentreState
</span><a href="GHC.Tc.Types.html#tcg_cc_st"><span class="hs-identifier hs-var">tcg_cc_st</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef CostCentreState
</span><a href="#local-6989586621681081904"><span class="hs-identifier hs-var">cc_st_var</span></a></span><span>
</span><span id="line-325"></span><span>             </span><span class="hs-special">}</span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-326"></span><span>        </span><span class="hs-special">}</span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-327"></span><span>
</span><span id="line-328"></span><span>        </span><span class="hs-comment">-- OK, here's the business end!</span><span>
</span><span id="line-329"></span><span>        </span><span class="annot"><span class="annottext">HscEnv
-&gt; TcGblEnv -&gt; RealSrcSpan -&gt; TcM r -&gt; IO (Messages, Maybe r)
forall r.
HscEnv
-&gt; TcGblEnv -&gt; RealSrcSpan -&gt; TcM r -&gt; IO (Messages, Maybe r)
</span><a href="GHC.Tc.Utils.Monad.html#initTcWithGbl"><span class="hs-identifier hs-var">initTcWithGbl</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681081928"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681081880"><span class="hs-identifier hs-var">gbl_env</span></a></span><span> </span><span class="annot"><span class="annottext">RealSrcSpan
</span><a href="#local-6989586621681081924"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621681081923"><span class="hs-identifier hs-var">do_this</span></a></span><span>
</span><span id="line-330"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-331"></span><span>
</span><span id="line-332"></span><span class="hs-comment">-- | Run a 'TcM' action in the context of an existing 'GblEnv'.</span><span>
</span><span id="line-333"></span><span id="local-6989586621681082892"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#initTcWithGbl"><span class="hs-identifier hs-type">initTcWithGbl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-334"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span>
</span><span id="line-335"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#RealSrcSpan"><span class="hs-identifier hs-type">RealSrcSpan</span></a></span><span>
</span><span id="line-336"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082892"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-337"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082892"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-338"></span><span id="initTcWithGbl"><span class="annot"><span class="annottext">initTcWithGbl :: forall r.
HscEnv
-&gt; TcGblEnv -&gt; RealSrcSpan -&gt; TcM r -&gt; IO (Messages, Maybe r)
</span><a href="GHC.Tc.Utils.Monad.html#initTcWithGbl"><span class="hs-identifier hs-var hs-var">initTcWithGbl</span></a></span></span><span> </span><span id="local-6989586621681081790"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681081790"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681081789"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681081789"><span class="hs-identifier hs-var">gbl_env</span></a></span></span><span> </span><span id="local-6989586621681081788"><span class="annot"><span class="annottext">RealSrcSpan
</span><a href="#local-6989586621681081788"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681081787"><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621681081787"><span class="hs-identifier hs-var">do_this</span></a></span></span><span>
</span><span id="line-339"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081786"><span class="annot"><span class="annottext">IORef WantedConstraints
</span><a href="#local-6989586621681081786"><span class="hs-identifier hs-var">lie_var</span></a></span></span><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">WantedConstraints -&gt; IO (IORef WantedConstraints)
forall a. a -&gt; IO (IORef a)
</span><a href="../../base/src/GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a></span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="GHC.Tc.Types.Constraint.html#emptyWC"><span class="hs-identifier hs-var">emptyWC</span></a></span><span>
</span><span id="line-340"></span><span>      </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681081785"><span class="annot"><span class="annottext">IORef Messages
</span><a href="#local-6989586621681081785"><span class="hs-identifier hs-var">errs_var</span></a></span></span><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Messages -&gt; IO (IORef Messages)
forall a. a -&gt; IO (IORef a)
</span><a href="../../base/src/GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bag WarnMsg
forall a. Bag a
</span><a href="GHC.Data.Bag.html#emptyBag"><span class="hs-identifier hs-var">emptyBag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bag WarnMsg
forall a. Bag a
</span><a href="GHC.Data.Bag.html#emptyBag"><span class="hs-identifier hs-var">emptyBag</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-341"></span><span>      </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681081784"><span class="annot"><span class="annottext">IORef UsageEnv
</span><a href="#local-6989586621681081784"><span class="hs-identifier hs-var">usage_var</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UsageEnv -&gt; IO (IORef UsageEnv)
forall a. a -&gt; IO (IORef a)
</span><a href="../../base/src/GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a></span><span> </span><span class="annot"><span class="annottext">UsageEnv
</span><a href="GHC.Core.UsageEnv.html#zeroUE"><span class="hs-identifier hs-var">zeroUE</span></a></span><span>
</span><span id="line-342"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681081782"><span class="annot"><span class="annottext">lcl_env :: TcLclEnv
</span><a href="#local-6989586621681081782"><span class="hs-identifier hs-var hs-var">lcl_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLclEnv :: RealSrcSpan
-&gt; [ErrCtxt]
-&gt; Bool
-&gt; TcLevel
-&gt; ThStage
-&gt; ThBindEnv
-&gt; ArrowCtxt
-&gt; LocalRdrEnv
-&gt; TcTypeEnv
-&gt; IORef UsageEnv
-&gt; TcBinderStack
-&gt; IORef WantedConstraints
-&gt; IORef Messages
-&gt; TcLclEnv
</span><a href="GHC.Tc.Types.html#TcLclEnv"><span class="hs-identifier hs-type">TcLclEnv</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-343"></span><span>                </span><span class="annot"><span class="annottext">tcl_errs :: IORef Messages
</span><a href="GHC.Tc.Types.html#tcl_errs"><span class="hs-identifier hs-var">tcl_errs</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef Messages
</span><a href="#local-6989586621681081785"><span class="hs-identifier hs-var">errs_var</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-344"></span><span>                </span><span class="annot"><span class="annottext">tcl_loc :: RealSrcSpan
</span><a href="GHC.Tc.Types.html#tcl_loc"><span class="hs-identifier hs-var">tcl_loc</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RealSrcSpan
</span><a href="#local-6989586621681081788"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-345"></span><span>                </span><span class="hs-comment">-- tcl_loc should be over-ridden very soon!</span><span>
</span><span id="line-346"></span><span>                </span><span class="annot"><span class="annottext">tcl_in_gen_code :: Bool
</span><a href="GHC.Tc.Types.html#tcl_in_gen_code"><span class="hs-identifier hs-var">tcl_in_gen_code</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span>
</span><span id="line-347"></span><span>                </span><span class="annot"><span class="annottext">tcl_ctxt :: [ErrCtxt]
</span><a href="GHC.Tc.Types.html#tcl_ctxt"><span class="hs-identifier hs-var">tcl_ctxt</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-348"></span><span>                </span><span class="annot"><span class="annottext">tcl_rdr :: LocalRdrEnv
</span><a href="GHC.Tc.Types.html#tcl_rdr"><span class="hs-identifier hs-var">tcl_rdr</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LocalRdrEnv
</span><a href="GHC.Types.Name.Reader.html#emptyLocalRdrEnv"><span class="hs-identifier hs-var">emptyLocalRdrEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-349"></span><span>                </span><span class="annot"><span class="annottext">tcl_th_ctxt :: ThStage
</span><a href="GHC.Tc.Types.html#tcl_th_ctxt"><span class="hs-identifier hs-var">tcl_th_ctxt</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ThStage
</span><a href="GHC.Tc.Types.html#topStage"><span class="hs-identifier hs-var">topStage</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-350"></span><span>                </span><span class="annot"><span class="annottext">tcl_th_bndrs :: ThBindEnv
</span><a href="GHC.Tc.Types.html#tcl_th_bndrs"><span class="hs-identifier hs-var">tcl_th_bndrs</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ThBindEnv
forall a. NameEnv a
</span><a href="GHC.Types.Name.Env.html#emptyNameEnv"><span class="hs-identifier hs-var">emptyNameEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-351"></span><span>                </span><span class="annot"><span class="annottext">tcl_arrow_ctxt :: ArrowCtxt
</span><a href="GHC.Tc.Types.html#tcl_arrow_ctxt"><span class="hs-identifier hs-var">tcl_arrow_ctxt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArrowCtxt
</span><a href="GHC.Tc.Types.html#NoArrowCtxt"><span class="hs-identifier hs-var">NoArrowCtxt</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-352"></span><span>                </span><span class="annot"><span class="annottext">tcl_env :: TcTypeEnv
</span><a href="GHC.Tc.Types.html#tcl_env"><span class="hs-identifier hs-var">tcl_env</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTypeEnv
forall a. NameEnv a
</span><a href="GHC.Types.Name.Env.html#emptyNameEnv"><span class="hs-identifier hs-var">emptyNameEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-353"></span><span>                </span><span class="annot"><span class="annottext">tcl_usage :: IORef UsageEnv
</span><a href="GHC.Tc.Types.html#tcl_usage"><span class="hs-identifier hs-var">tcl_usage</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef UsageEnv
</span><a href="#local-6989586621681081784"><span class="hs-identifier hs-var">usage_var</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-354"></span><span>                </span><span class="annot"><span class="annottext">tcl_bndrs :: TcBinderStack
</span><a href="GHC.Tc.Types.html#tcl_bndrs"><span class="hs-identifier hs-var">tcl_bndrs</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-355"></span><span>                </span><span class="annot"><span class="annottext">tcl_lie :: IORef WantedConstraints
</span><a href="GHC.Tc.Types.html#tcl_lie"><span class="hs-identifier hs-var">tcl_lie</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef WantedConstraints
</span><a href="#local-6989586621681081786"><span class="hs-identifier hs-var">lie_var</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-356"></span><span>                </span><span class="annot"><span class="annottext">tcl_tclvl :: TcLevel
</span><a href="GHC.Tc.Types.html#tcl_tclvl"><span class="hs-identifier hs-var">tcl_tclvl</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="GHC.Tc.Utils.TcType.html#topTcLevel"><span class="hs-identifier hs-var">topTcLevel</span></a></span><span>
</span><span id="line-357"></span><span>                </span><span class="hs-special">}</span><span>
</span><span id="line-358"></span><span>
</span><span id="line-359"></span><span>      </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681081763"><span class="annot"><span class="annottext">Maybe r
</span><a href="#local-6989586621681081763"><span class="hs-identifier hs-var">maybe_res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Char
-&gt; HscEnv
-&gt; TcGblEnv
-&gt; TcLclEnv
-&gt; TcRnIf TcGblEnv TcLclEnv (Maybe r)
-&gt; IO (Maybe r)
forall gbl lcl a.
Char -&gt; HscEnv -&gt; gbl -&gt; lcl -&gt; TcRnIf gbl lcl a -&gt; IO a
</span><a href="GHC.Tc.Utils.Monad.html#initTcRnIf"><span class="hs-identifier hs-var">initTcRnIf</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'a'</span></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681081790"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681081789"><span class="hs-identifier hs-var">gbl_env</span></a></span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681081782"><span class="hs-identifier hs-var">lcl_env</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRnIf TcGblEnv TcLclEnv (Maybe r) -&gt; IO (Maybe r))
-&gt; TcRnIf TcGblEnv TcLclEnv (Maybe r) -&gt; IO (Maybe r)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-360"></span><span>                     </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081762"><span class="annot"><span class="annottext">Either IOEnvFailure r
</span><a href="#local-6989586621681081762"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM r -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Either IOEnvFailure r)
forall env r. IOEnv env r -&gt; IOEnv env (Either IOEnvFailure r)
</span><a href="GHC.Data.IOEnv.html#tryM"><span class="hs-identifier hs-var">tryM</span></a></span><span> </span><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621681081787"><span class="hs-identifier hs-var">do_this</span></a></span><span>
</span><span id="line-361"></span><span>                        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either IOEnvFailure r
</span><a href="#local-6989586621681081762"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-362"></span><span>                          </span><span class="annot"><a href="../../base/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621681081760"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681081760"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe r -&gt; TcRnIf TcGblEnv TcLclEnv (Maybe r)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">r -&gt; Maybe r
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681081760"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-363"></span><span>                          </span><span class="annot"><a href="../../base/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span class="annot"><span class="annottext">IOEnvFailure
</span><span class="hs-identifier">_</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe r -&gt; TcRnIf TcGblEnv TcLclEnv (Maybe r)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe r
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-364"></span><span>
</span><span id="line-365"></span><span>      </span><span class="hs-comment">-- Check for unsolved constraints</span><span>
</span><span id="line-366"></span><span>      </span><span class="hs-comment">-- If we succeed (maybe_res = Just r), there should be</span><span>
</span><span id="line-367"></span><span>      </span><span class="hs-comment">-- no unsolved constraints.  But if we exit via an</span><span>
</span><span id="line-368"></span><span>      </span><span class="hs-comment">-- exception (maybe_res = Nothing), we may have skipped</span><span>
</span><span id="line-369"></span><span>      </span><span class="hs-comment">-- solving, so don't panic then (#13466)</span><span>
</span><span id="line-370"></span><span>      </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681081759"><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621681081759"><span class="hs-identifier hs-var">lie</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef WantedConstraints -&gt; IO WantedConstraints
forall a. IORef a -&gt; IO a
</span><a href="../../base/src/GHC.IORef.html#readIORef"><span class="hs-identifier hs-var">readIORef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcLclEnv -&gt; IORef WantedConstraints
</span><a href="GHC.Tc.Types.html#tcl_lie"><span class="hs-identifier hs-var hs-var">tcl_lie</span></a></span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681081782"><span class="hs-identifier hs-var">lcl_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-371"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe r -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../../base/src/Data.Maybe.html#isJust"><span class="hs-identifier hs-var">isJust</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe r
</span><a href="#local-6989586621681081763"><span class="hs-identifier hs-var">maybe_res</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WantedConstraints -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#isEmptyWC"><span class="hs-identifier hs-var">isEmptyWC</span></a></span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621681081759"><span class="hs-identifier hs-var">lie</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-372"></span><span>        </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc -&gt; IO ()
forall a. HasCallStack =&gt; FilePath -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;initTc: unsolved constraints&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WantedConstraints -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621681081759"><span class="hs-identifier hs-var">lie</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-373"></span><span>
</span><span id="line-374"></span><span>        </span><span class="hs-comment">-- Collect any error messages</span><span>
</span><span id="line-375"></span><span>      </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681081750"><span class="annot"><span class="annottext">Messages
</span><a href="#local-6989586621681081750"><span class="hs-identifier hs-var">msgs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef Messages -&gt; IO Messages
forall a. IORef a -&gt; IO a
</span><a href="../../base/src/GHC.IORef.html#readIORef"><span class="hs-identifier hs-var">readIORef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcLclEnv -&gt; IORef Messages
</span><a href="GHC.Tc.Types.html#tcl_errs"><span class="hs-identifier hs-var hs-var">tcl_errs</span></a></span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681081782"><span class="hs-identifier hs-var">lcl_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-376"></span><span>
</span><span id="line-377"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081749"><span class="annot"><span class="annottext">final_res :: Maybe r
</span><a href="#local-6989586621681081749"><span class="hs-identifier hs-var hs-var">final_res</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Messages -&gt; Bool
</span><a href="GHC.Utils.Error.html#errorsFound"><span class="hs-identifier hs-var">errorsFound</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681081747"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Messages
</span><a href="#local-6989586621681081750"><span class="hs-identifier hs-var">msgs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe r
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-378"></span><span>                        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>               </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe r
</span><a href="#local-6989586621681081763"><span class="hs-identifier hs-var">maybe_res</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-379"></span><span>
</span><span id="line-380"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(Messages, Maybe r) -&gt; IO (Messages, Maybe r)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Messages
</span><a href="#local-6989586621681081750"><span class="hs-identifier hs-var">msgs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe r
</span><a href="#local-6989586621681081749"><span class="hs-identifier hs-var">final_res</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-381"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-382"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681081747"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621681081747"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681081790"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-383"></span><span>
</span><span id="line-384"></span><span id="local-6989586621681082865"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#initTcInteractive"><span class="hs-identifier hs-type">initTcInteractive</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082865"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082865"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-385"></span><span class="hs-comment">-- Initialise the type checker monad for use in GHCi</span><span>
</span><span id="line-386"></span><span id="initTcInteractive"><span class="annot"><span class="annottext">initTcInteractive :: forall a. HscEnv -&gt; TcM a -&gt; IO (Messages, Maybe a)
</span><a href="GHC.Tc.Utils.Monad.html#initTcInteractive"><span class="hs-identifier hs-var hs-var">initTcInteractive</span></a></span></span><span> </span><span id="local-6989586621681081746"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681081746"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681081745"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681081745"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-387"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; HscSource
-&gt; Bool
-&gt; Module
-&gt; RealSrcSpan
-&gt; TcM a
-&gt; IO (Messages, Maybe a)
forall r.
HscEnv
-&gt; HscSource
-&gt; Bool
-&gt; Module
-&gt; RealSrcSpan
-&gt; TcM r
-&gt; IO (Messages, Maybe r)
</span><a href="GHC.Tc.Utils.Monad.html#initTc"><span class="hs-identifier hs-var">initTc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681081746"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="GHC.Driver.Phases.html#HsSrcFile"><span class="hs-identifier hs-var">HsSrcFile</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-388"></span><span>           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InteractiveContext -&gt; Module
</span><a href="GHC.Driver.Types.html#icInteractiveModule"><span class="hs-identifier hs-var">icInteractiveModule</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; InteractiveContext
</span><a href="GHC.Driver.Types.html#hsc_IC"><span class="hs-identifier hs-var hs-var">hsc_IC</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681081746"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-389"></span><span>           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RealSrcLoc -&gt; RealSrcSpan
</span><a href="GHC.Types.SrcLoc.html#realSrcLocSpan"><span class="hs-identifier hs-var">realSrcLocSpan</span></a></span><span> </span><span class="annot"><span class="annottext">RealSrcLoc
</span><a href="#local-6989586621681081740"><span class="hs-identifier hs-var">interactive_src_loc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-390"></span><span>           </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681081745"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-391"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-392"></span><span>    </span><span id="local-6989586621681081740"><span class="annot"><span class="annottext">interactive_src_loc :: RealSrcLoc
</span><a href="#local-6989586621681081740"><span class="hs-identifier hs-var hs-var">interactive_src_loc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; Int -&gt; Int -&gt; RealSrcLoc
</span><a href="GHC.Types.SrcLoc.html#mkRealSrcLoc"><span class="hs-identifier hs-var">mkRealSrcLoc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;&lt;interactive&gt;&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-393"></span><span>
</span><span id="line-394"></span><span class="hs-comment">{- Note [Default types]
~~~~~~~~~~~~~~~~~~~~~~~
The Integer type is simply not available in ghc-prim and ghc-bignum packages (it
is declared in ghc-bignum). So we set the defaulting types to (Just []), meaning
there are no default types, rather than Nothing, which means &quot;use the default
default types of Integer, Double&quot;.

If you don't do this, attempted defaulting in package ghc-prim causes
an actual crash (attempting to look up the Integer type).


************************************************************************
*                                                                      *
                Initialisation
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-411"></span><span>
</span><span id="line-412"></span><span id="local-6989586621681082878"><span id="local-6989586621681082879"><span id="local-6989586621681082880"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#initTcRnIf"><span class="hs-identifier hs-type">initTcRnIf</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span>              </span><span class="hs-comment">-- ^ Mask for unique supply</span><span>
</span><span id="line-413"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-414"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681082880"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681082879"><span class="hs-identifier hs-type">lcl</span></a></span><span>
</span><span id="line-415"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082880"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082879"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082878"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-416"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621681082878"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-417"></span><span id="initTcRnIf"><span class="annot"><span class="annottext">initTcRnIf :: forall gbl lcl a.
Char -&gt; HscEnv -&gt; gbl -&gt; lcl -&gt; TcRnIf gbl lcl a -&gt; IO a
</span><a href="GHC.Tc.Utils.Monad.html#initTcRnIf"><span class="hs-identifier hs-var hs-var">initTcRnIf</span></a></span></span><span> </span><span id="local-6989586621681081737"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621681081737"><span class="hs-identifier hs-var">uniq_mask</span></a></span></span><span> </span><span id="local-6989586621681081736"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681081736"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681081735"><span class="annot"><span class="annottext">gbl
</span><a href="#local-6989586621681081735"><span class="hs-identifier hs-var">gbl_env</span></a></span></span><span> </span><span id="local-6989586621681081734"><span class="annot"><span class="annottext">lcl
</span><a href="#local-6989586621681081734"><span class="hs-identifier hs-var">lcl_env</span></a></span></span><span> </span><span id="local-6989586621681081733"><span class="annot"><span class="annottext">TcRnIf gbl lcl a
</span><a href="#local-6989586621681081733"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-418"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081732"><span class="annot"><span class="annottext">env :: Env gbl lcl
</span><a href="#local-6989586621681081732"><span class="hs-identifier hs-var hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Env :: forall gbl lcl. HscEnv -&gt; Char -&gt; gbl -&gt; lcl -&gt; Env gbl lcl
</span><a href="GHC.Tc.Types.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">env_top :: HscEnv
</span><a href="GHC.Tc.Types.html#env_top"><span class="hs-identifier hs-var">env_top</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681081736"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-419"></span><span>                            </span><span class="annot"><span class="annottext">env_um :: Char
</span><a href="GHC.Tc.Types.html#env_um"><span class="hs-identifier hs-var">env_um</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621681081737"><span class="hs-identifier hs-var">uniq_mask</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-420"></span><span>                            </span><span class="annot"><span class="annottext">env_gbl :: gbl
</span><a href="GHC.Tc.Types.html#env_gbl"><span class="hs-identifier hs-var">env_gbl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">gbl
</span><a href="#local-6989586621681081735"><span class="hs-identifier hs-var">gbl_env</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-421"></span><span>                            </span><span class="annot"><span class="annottext">env_lcl :: lcl
</span><a href="GHC.Tc.Types.html#env_lcl"><span class="hs-identifier hs-var">env_lcl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">lcl
</span><a href="#local-6989586621681081734"><span class="hs-identifier hs-var">lcl_env</span></a></span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-422"></span><span>
</span><span id="line-423"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Env gbl lcl -&gt; TcRnIf gbl lcl a -&gt; IO a
forall env a. env -&gt; IOEnv env a -&gt; IO a
</span><a href="GHC.Data.IOEnv.html#runIOEnv"><span class="hs-identifier hs-var">runIOEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Env gbl lcl
</span><a href="#local-6989586621681081732"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnIf gbl lcl a
</span><a href="#local-6989586621681081733"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-424"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-425"></span><span>
</span><span id="line-426"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Simple accessors
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-433"></span><span>
</span><span id="line-434"></span><span id="local-6989586621681082853"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#discardResult"><span class="hs-identifier hs-type">discardResult</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082853"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-435"></span><span id="discardResult"><span class="annot"><span class="annottext">discardResult :: forall a. TcM a -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#discardResult"><span class="hs-identifier hs-var hs-var">discardResult</span></a></span></span><span> </span><span id="local-6989586621681081723"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681081723"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681081723"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">TcM a -&gt; TcM () -&gt; TcM ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><a href="../../base/src/GHC.Base.html#%3E%3E"><span class="hs-operator hs-var">&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">() -&gt; TcM ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-436"></span><span>
</span><span id="line-437"></span><span id="local-6989586621681082848"><span id="local-6989586621681082849"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-type">getTopEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082849"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082848"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span></span></span><span>
</span><span id="line-438"></span><span id="getTopEnv"><span class="annot"><span class="annottext">getTopEnv :: forall gbl lcl. TcRnIf gbl lcl HscEnv
</span><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-var hs-var">getTopEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081720"><span class="annot"><span class="annottext">Env gbl lcl
</span><a href="#local-6989586621681081720"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env gbl lcl) (Env gbl lcl)
forall env. IOEnv env env
</span><a href="GHC.Data.IOEnv.html#getEnv"><span class="hs-identifier hs-var">getEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; TcRnIf gbl lcl HscEnv
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Env gbl lcl -&gt; HscEnv
forall gbl lcl. Env gbl lcl -&gt; HscEnv
</span><a href="GHC.Tc.Types.html#env_top"><span class="hs-identifier hs-var hs-var">env_top</span></a></span><span> </span><span class="annot"><span class="annottext">Env gbl lcl
</span><a href="#local-6989586621681081720"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-439"></span><span>
</span><span id="line-440"></span><span id="local-6989586621681082840"><span id="local-6989586621681082841"><span id="local-6989586621681082842"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#updTopEnv"><span class="hs-identifier hs-type">updTopEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082842"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082841"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082840"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082842"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082841"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082840"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-441"></span><span id="updTopEnv"><span class="annot"><span class="annottext">updTopEnv :: forall gbl lcl a.
(HscEnv -&gt; HscEnv) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updTopEnv"><span class="hs-identifier hs-var hs-var">updTopEnv</span></a></span></span><span> </span><span id="local-6989586621681081718"><span class="annot"><span class="annottext">HscEnv -&gt; HscEnv
</span><a href="#local-6989586621681081718"><span class="hs-identifier hs-var">upd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Env gbl lcl -&gt; Env gbl lcl)
-&gt; IOEnv (Env gbl lcl) a -&gt; IOEnv (Env gbl lcl) a
forall env env' a. (env -&gt; env') -&gt; IOEnv env' a -&gt; IOEnv env a
</span><a href="GHC.Data.IOEnv.html#updEnv"><span class="hs-identifier hs-var">updEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681081716"><span class="annot"><span class="annottext">env :: Env gbl lcl
</span><a href="#local-6989586621681081716"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">env_top :: forall gbl lcl. Env gbl lcl -&gt; HscEnv
</span><a href="GHC.Tc.Types.html#env_top"><span class="hs-identifier hs-var">env_top</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681081715"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681081715"><span class="hs-identifier hs-var">top</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-442"></span><span>                          </span><span class="annot"><span class="annottext">Env gbl lcl
</span><a href="#local-6989586621681081716"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">env_top :: HscEnv
</span><a href="GHC.Tc.Types.html#env_top"><span class="hs-identifier hs-var">env_top</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; HscEnv
</span><a href="#local-6989586621681081718"><span class="hs-identifier hs-var">upd</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681081715"><span class="hs-identifier hs-var">top</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-443"></span><span>
</span><span id="line-444"></span><span id="local-6989586621681082832"><span id="local-6989586621681082833"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-type">getGblEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082833"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082832"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082833"><span class="hs-identifier hs-type">gbl</span></a></span></span></span><span>
</span><span id="line-445"></span><span id="getGblEnv"><span class="annot"><span class="annottext">getGblEnv :: forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var hs-var">getGblEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span class="hs-special">{</span><span id="local-6989586621681081709"><span id="local-6989586621681081710"><span id="local-6989586621681081711"><span id="local-6989586621681081712"><span class="annot"><span class="annottext">gbl
lcl
Char
HscEnv
env_lcl :: lcl
env_gbl :: gbl
env_um :: Char
env_top :: HscEnv
env_lcl :: forall gbl lcl. Env gbl lcl -&gt; lcl
env_gbl :: forall gbl lcl. Env gbl lcl -&gt; gbl
env_um :: forall gbl lcl. Env gbl lcl -&gt; Char
env_top :: forall gbl lcl. Env gbl lcl -&gt; HscEnv
</span><a href="#local-6989586621681081709"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env gbl lcl) (Env gbl lcl)
forall env. IOEnv env env
</span><a href="GHC.Data.IOEnv.html#getEnv"><span class="hs-identifier hs-var">getEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">gbl -&gt; TcRnIf gbl lcl gbl
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">gbl
</span><a href="#local-6989586621681081710"><span class="hs-identifier hs-var">env_gbl</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-446"></span><span>
</span><span id="line-447"></span><span id="local-6989586621681082821"><span id="local-6989586621681082822"><span id="local-6989586621681082823"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#updGblEnv"><span class="hs-identifier hs-type">updGblEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681082823"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681082823"><span class="hs-identifier hs-type">gbl</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082823"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082822"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082821"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082823"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082822"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082821"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-448"></span><span id="updGblEnv"><span class="annot"><span class="annottext">updGblEnv :: forall gbl lcl a.
(gbl -&gt; gbl) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updGblEnv"><span class="hs-identifier hs-var hs-var">updGblEnv</span></a></span></span><span> </span><span id="local-6989586621681081708"><span class="annot"><span class="annottext">gbl -&gt; gbl
</span><a href="#local-6989586621681081708"><span class="hs-identifier hs-var">upd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Env gbl lcl -&gt; Env gbl lcl)
-&gt; IOEnv (Env gbl lcl) a -&gt; IOEnv (Env gbl lcl) a
forall env env' a. (env -&gt; env') -&gt; IOEnv env' a -&gt; IOEnv env a
</span><a href="GHC.Data.IOEnv.html#updEnv"><span class="hs-identifier hs-var">updEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681081707"><span class="annot"><span class="annottext">env :: Env gbl lcl
</span><a href="#local-6989586621681081707"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">env_gbl :: forall gbl lcl. Env gbl lcl -&gt; gbl
</span><a href="GHC.Tc.Types.html#env_gbl"><span class="hs-identifier hs-var">env_gbl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681081706"><span class="annot"><span class="annottext">gbl
</span><a href="#local-6989586621681081706"><span class="hs-identifier hs-var">gbl</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-449"></span><span>                          </span><span class="annot"><span class="annottext">Env gbl lcl
</span><a href="#local-6989586621681081707"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">env_gbl :: gbl
</span><a href="GHC.Tc.Types.html#env_gbl"><span class="hs-identifier hs-var">env_gbl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">gbl -&gt; gbl
</span><a href="#local-6989586621681081708"><span class="hs-identifier hs-var">upd</span></a></span><span> </span><span class="annot"><span class="annottext">gbl
</span><a href="#local-6989586621681081706"><span class="hs-identifier hs-var">gbl</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-450"></span><span>
</span><span id="line-451"></span><span id="local-6989586621681082815"><span id="local-6989586621681082816"><span id="local-6989586621681082817"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setGblEnv"><span class="hs-identifier hs-type">setGblEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621681082817"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082817"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082816"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082815"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082817"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082816"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082815"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-452"></span><span id="setGblEnv"><span class="annot"><span class="annottext">setGblEnv :: forall gbl lcl a. gbl -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#setGblEnv"><span class="hs-identifier hs-var hs-var">setGblEnv</span></a></span></span><span> </span><span id="local-6989586621681081705"><span class="annot"><span class="annottext">gbl
</span><a href="#local-6989586621681081705"><span class="hs-identifier hs-var">gbl_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Env gbl lcl -&gt; Env gbl lcl)
-&gt; IOEnv (Env gbl lcl) a -&gt; IOEnv (Env gbl lcl) a
forall env env' a. (env -&gt; env') -&gt; IOEnv env' a -&gt; IOEnv env a
</span><a href="GHC.Data.IOEnv.html#updEnv"><span class="hs-identifier hs-var">updEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681081704"><span class="annot"><span class="annottext">Env gbl lcl
</span><a href="#local-6989586621681081704"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Env gbl lcl
</span><a href="#local-6989586621681081704"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">env_gbl :: gbl
</span><a href="GHC.Tc.Types.html#env_gbl"><span class="hs-identifier hs-var">env_gbl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">gbl
</span><a href="#local-6989586621681081705"><span class="hs-identifier hs-var">gbl_env</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-453"></span><span>
</span><span id="line-454"></span><span id="local-6989586621681082810"><span id="local-6989586621681082811"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getLclEnv"><span class="hs-identifier hs-type">getLclEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082811"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082810"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082810"><span class="hs-identifier hs-type">lcl</span></a></span></span></span><span>
</span><span id="line-455"></span><span id="getLclEnv"><span class="annot"><span class="annottext">getLclEnv :: forall gbl lcl. TcRnIf gbl lcl lcl
</span><a href="GHC.Tc.Utils.Monad.html#getLclEnv"><span class="hs-identifier hs-var hs-var">getLclEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span class="hs-special">{</span><span id="local-6989586621681081698"><span id="local-6989586621681081699"><span id="local-6989586621681081700"><span id="local-6989586621681081701"><span class="annot"><span class="annottext">gbl
lcl
Char
HscEnv
env_lcl :: lcl
env_gbl :: gbl
env_um :: Char
env_top :: HscEnv
env_lcl :: forall gbl lcl. Env gbl lcl -&gt; lcl
env_gbl :: forall gbl lcl. Env gbl lcl -&gt; gbl
env_um :: forall gbl lcl. Env gbl lcl -&gt; Char
env_top :: forall gbl lcl. Env gbl lcl -&gt; HscEnv
</span><a href="#local-6989586621681081698"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env gbl lcl) (Env gbl lcl)
forall env. IOEnv env env
</span><a href="GHC.Data.IOEnv.html#getEnv"><span class="hs-identifier hs-var">getEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">lcl -&gt; TcRnIf gbl lcl lcl
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">lcl
</span><a href="#local-6989586621681081698"><span class="hs-identifier hs-var">env_lcl</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-456"></span><span>
</span><span id="line-457"></span><span id="local-6989586621681082805"><span id="local-6989586621681082806"><span id="local-6989586621681082807"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#updLclEnv"><span class="hs-identifier hs-type">updLclEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681082807"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681082807"><span class="hs-identifier hs-type">lcl</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082806"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082807"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082805"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082806"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082807"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082805"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-458"></span><span id="updLclEnv"><span class="annot"><span class="annottext">updLclEnv :: forall lcl gbl a.
(lcl -&gt; lcl) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updLclEnv"><span class="hs-identifier hs-var hs-var">updLclEnv</span></a></span></span><span> </span><span id="local-6989586621681081697"><span class="annot"><span class="annottext">lcl -&gt; lcl
</span><a href="#local-6989586621681081697"><span class="hs-identifier hs-var">upd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Env gbl lcl -&gt; Env gbl lcl)
-&gt; IOEnv (Env gbl lcl) a -&gt; IOEnv (Env gbl lcl) a
forall env env' a. (env -&gt; env') -&gt; IOEnv env' a -&gt; IOEnv env a
</span><a href="GHC.Data.IOEnv.html#updEnv"><span class="hs-identifier hs-var">updEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681081696"><span class="annot"><span class="annottext">env :: Env gbl lcl
</span><a href="#local-6989586621681081696"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">env_lcl :: forall gbl lcl. Env gbl lcl -&gt; lcl
</span><a href="GHC.Tc.Types.html#env_lcl"><span class="hs-identifier hs-var">env_lcl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681081695"><span class="annot"><span class="annottext">lcl
</span><a href="#local-6989586621681081695"><span class="hs-identifier hs-var">lcl</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-459"></span><span>                          </span><span class="annot"><span class="annottext">Env gbl lcl
</span><a href="#local-6989586621681081696"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">env_lcl :: lcl
</span><a href="GHC.Tc.Types.html#env_lcl"><span class="hs-identifier hs-var">env_lcl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">lcl -&gt; lcl
</span><a href="#local-6989586621681081697"><span class="hs-identifier hs-var">upd</span></a></span><span> </span><span class="annot"><span class="annottext">lcl
</span><a href="#local-6989586621681081695"><span class="hs-identifier hs-var">lcl</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-460"></span><span>
</span><span id="line-461"></span><span id="local-6989586621681082798"><span id="local-6989586621681082799"><span id="local-6989586621681082800"><span id="local-6989586621681082801"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setLclEnv"><span class="hs-identifier hs-type">setLclEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621681082801"><span class="hs-identifier hs-type">lcl'</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082800"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082801"><span class="hs-identifier hs-type">lcl'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082799"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082800"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082798"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082799"><span class="hs-identifier hs-type">a</span></a></span></span></span></span></span><span>
</span><span id="line-462"></span><span id="setLclEnv"><span class="annot"><span class="annottext">setLclEnv :: forall lcl' gbl a lcl.
lcl' -&gt; TcRnIf gbl lcl' a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#setLclEnv"><span class="hs-identifier hs-var hs-var">setLclEnv</span></a></span></span><span> </span><span id="local-6989586621681081694"><span class="annot"><span class="annottext">lcl'
</span><a href="#local-6989586621681081694"><span class="hs-identifier hs-var">lcl_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Env gbl lcl -&gt; Env gbl lcl')
-&gt; IOEnv (Env gbl lcl') a -&gt; IOEnv (Env gbl lcl) a
forall env env' a. (env -&gt; env') -&gt; IOEnv env' a -&gt; IOEnv env a
</span><a href="GHC.Data.IOEnv.html#updEnv"><span class="hs-identifier hs-var">updEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681081693"><span class="annot"><span class="annottext">Env gbl lcl
</span><a href="#local-6989586621681081693"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Env gbl lcl
</span><a href="#local-6989586621681081693"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">env_lcl :: lcl'
</span><a href="GHC.Tc.Types.html#env_lcl"><span class="hs-identifier hs-var">env_lcl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">lcl'
</span><a href="#local-6989586621681081694"><span class="hs-identifier hs-var">lcl_env</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-463"></span><span>
</span><span id="line-464"></span><span id="local-6989586621681082792"><span id="local-6989586621681082793"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getEnvs"><span class="hs-identifier hs-type">getEnvs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082793"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082792"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681082793"><span class="hs-identifier hs-type">gbl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621681082792"><span class="hs-identifier hs-type">lcl</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-465"></span><span id="getEnvs"><span class="annot"><span class="annottext">getEnvs :: forall gbl lcl. TcRnIf gbl lcl (gbl, lcl)
</span><a href="GHC.Tc.Utils.Monad.html#getEnvs"><span class="hs-identifier hs-var hs-var">getEnvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081690"><span class="annot"><span class="annottext">Env gbl lcl
</span><a href="#local-6989586621681081690"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env gbl lcl) (Env gbl lcl)
forall env. IOEnv env env
</span><a href="GHC.Data.IOEnv.html#getEnv"><span class="hs-identifier hs-var">getEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(gbl, lcl) -&gt; TcRnIf gbl lcl (gbl, lcl)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Env gbl lcl -&gt; gbl
forall gbl lcl. Env gbl lcl -&gt; gbl
</span><a href="GHC.Tc.Types.html#env_gbl"><span class="hs-identifier hs-var hs-var">env_gbl</span></a></span><span> </span><span class="annot"><span class="annottext">Env gbl lcl
</span><a href="#local-6989586621681081690"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Env gbl lcl -&gt; lcl
forall gbl lcl. Env gbl lcl -&gt; lcl
</span><a href="GHC.Tc.Types.html#env_lcl"><span class="hs-identifier hs-var hs-var">env_lcl</span></a></span><span> </span><span class="annot"><span class="annottext">Env gbl lcl
</span><a href="#local-6989586621681081690"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-466"></span><span>
</span><span id="line-467"></span><span id="local-6989586621681082785"><span id="local-6989586621681082786"><span id="local-6989586621681082787"><span id="local-6989586621681082788"><span id="local-6989586621681082789"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setEnvs"><span class="hs-identifier hs-type">setEnvs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681082789"><span class="hs-identifier hs-type">gbl'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621681082788"><span class="hs-identifier hs-type">lcl'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082789"><span class="hs-identifier hs-type">gbl'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082788"><span class="hs-identifier hs-type">lcl'</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082787"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082786"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082785"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082787"><span class="hs-identifier hs-type">a</span></a></span></span></span></span></span></span><span>
</span><span id="line-468"></span><span id="setEnvs"><span class="annot"><span class="annottext">setEnvs :: forall gbl' lcl' a gbl lcl.
(gbl', lcl') -&gt; TcRnIf gbl' lcl' a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#setEnvs"><span class="hs-identifier hs-var hs-var">setEnvs</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681081689"><span class="annot"><span class="annottext">gbl'
</span><a href="#local-6989586621681081689"><span class="hs-identifier hs-var">gbl_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681081688"><span class="annot"><span class="annottext">lcl'
</span><a href="#local-6989586621681081688"><span class="hs-identifier hs-var">lcl_env</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Env gbl lcl -&gt; Env gbl' lcl')
-&gt; IOEnv (Env gbl' lcl') a -&gt; IOEnv (Env gbl lcl) a
forall env env' a. (env -&gt; env') -&gt; IOEnv env' a -&gt; IOEnv env a
</span><a href="GHC.Data.IOEnv.html#updEnv"><span class="hs-identifier hs-var">updEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681081687"><span class="annot"><span class="annottext">Env gbl lcl
</span><a href="#local-6989586621681081687"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Env gbl lcl
</span><a href="#local-6989586621681081687"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">env_gbl :: gbl'
</span><a href="GHC.Tc.Types.html#env_gbl"><span class="hs-identifier hs-var">env_gbl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">gbl'
</span><a href="#local-6989586621681081689"><span class="hs-identifier hs-var">gbl_env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">env_lcl :: lcl'
</span><a href="GHC.Tc.Types.html#env_lcl"><span class="hs-identifier hs-var">env_lcl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">lcl'
</span><a href="#local-6989586621681081688"><span class="hs-identifier hs-var">lcl_env</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-469"></span><span>
</span><span id="line-470"></span><span class="hs-comment">-- Command-line flags</span><span>
</span><span id="line-471"></span><span>
</span><span id="line-472"></span><span id="local-6989586621681082777"><span id="local-6989586621681082778"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-type">xoptM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../ghc-boot-th/src/GHC.LanguageExtensions.Type.html#Extension"><span class="hs-identifier hs-type">LangExt.Extension</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082778"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082777"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span></span><span>
</span><span id="line-473"></span><span id="xoptM"><span class="annot"><span class="annottext">xoptM :: forall gbl lcl. Extension -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-var hs-var">xoptM</span></a></span></span><span> </span><span id="local-6989586621681081682"><span class="annot"><span class="annottext">Extension
</span><a href="#local-6989586621681081682"><span class="hs-identifier hs-var">flag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081681"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681081681"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env gbl lcl) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRnIf gbl lcl Bool
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Extension -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#xopt"><span class="hs-identifier hs-var">xopt</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><a href="#local-6989586621681081682"><span class="hs-identifier hs-var">flag</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681081681"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-474"></span><span>
</span><span id="line-475"></span><span id="local-6989586621681082772"><span id="local-6989586621681082773"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#doptM"><span class="hs-identifier hs-type">doptM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#DumpFlag"><span class="hs-identifier hs-type">DumpFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082773"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082772"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span></span><span>
</span><span id="line-476"></span><span id="doptM"><span class="annot"><span class="annottext">doptM :: forall gbl lcl. DumpFlag -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#doptM"><span class="hs-identifier hs-var hs-var">doptM</span></a></span></span><span> </span><span id="local-6989586621681081674"><span class="annot"><span class="annottext">DumpFlag
</span><a href="#local-6989586621681081674"><span class="hs-identifier hs-var">flag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081673"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681081673"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env gbl lcl) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRnIf gbl lcl Bool
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DumpFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#dopt"><span class="hs-identifier hs-var">dopt</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="#local-6989586621681081674"><span class="hs-identifier hs-var">flag</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681081673"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-477"></span><span>
</span><span id="line-478"></span><span id="local-6989586621681082768"><span id="local-6989586621681082769"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#goptM"><span class="hs-identifier hs-type">goptM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#GeneralFlag"><span class="hs-identifier hs-type">GeneralFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082769"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082768"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span></span><span>
</span><span id="line-479"></span><span id="goptM"><span class="annot"><span class="annottext">goptM :: forall gbl lcl. GeneralFlag -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#goptM"><span class="hs-identifier hs-var hs-var">goptM</span></a></span></span><span> </span><span id="local-6989586621681081668"><span class="annot"><span class="annottext">GeneralFlag
</span><a href="#local-6989586621681081668"><span class="hs-identifier hs-var">flag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081667"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681081667"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env gbl lcl) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRnIf gbl lcl Bool
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="#local-6989586621681081668"><span class="hs-identifier hs-var">flag</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681081667"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-480"></span><span>
</span><span id="line-481"></span><span id="local-6989586621681082763"><span id="local-6989586621681082764"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#woptM"><span class="hs-identifier hs-type">woptM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#WarningFlag"><span class="hs-identifier hs-type">WarningFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082764"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082763"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span></span><span>
</span><span id="line-482"></span><span id="woptM"><span class="annot"><span class="annottext">woptM :: forall gbl lcl. WarningFlag -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#woptM"><span class="hs-identifier hs-var hs-var">woptM</span></a></span></span><span> </span><span id="local-6989586621681081662"><span class="annot"><span class="annottext">WarningFlag
</span><a href="#local-6989586621681081662"><span class="hs-identifier hs-var">flag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081661"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681081661"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env gbl lcl) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRnIf gbl lcl Bool
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WarningFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#wopt"><span class="hs-identifier hs-var">wopt</span></a></span><span> </span><span class="annot"><span class="annottext">WarningFlag
</span><a href="#local-6989586621681081662"><span class="hs-identifier hs-var">flag</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681081661"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-483"></span><span>
</span><span id="line-484"></span><span id="local-6989586621681082758"><span id="local-6989586621681082759"><span id="local-6989586621681082760"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setXOptM"><span class="hs-identifier hs-type">setXOptM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../ghc-boot-th/src/GHC.LanguageExtensions.Type.html#Extension"><span class="hs-identifier hs-type">LangExt.Extension</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082760"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082759"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082758"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082760"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082759"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082758"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-485"></span><span id="setXOptM"><span class="annot"><span class="annottext">setXOptM :: forall gbl lcl a. Extension -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#setXOptM"><span class="hs-identifier hs-var hs-var">setXOptM</span></a></span></span><span> </span><span id="local-6989586621681081659"><span class="annot"><span class="annottext">Extension
</span><a href="#local-6989586621681081659"><span class="hs-identifier hs-var">flag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-486"></span><span>  </span><span class="annot"><span class="annottext">(HscEnv -&gt; HscEnv) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
forall gbl lcl a.
(HscEnv -&gt; HscEnv) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updTopEnv"><span class="hs-identifier hs-var">updTopEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681081658"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681081658"><span class="hs-identifier hs-var">top</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681081658"><span class="hs-identifier hs-var">top</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hsc_dflags :: DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Extension -&gt; DynFlags
</span><a href="GHC.Driver.Session.html#xopt_set"><span class="hs-identifier hs-var">xopt_set</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681081658"><span class="hs-identifier hs-var">top</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Extension
</span><a href="#local-6989586621681081659"><span class="hs-identifier hs-var">flag</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-487"></span><span>
</span><span id="line-488"></span><span id="local-6989586621681081654"><span id="local-6989586621681081655"><span id="local-6989586621681081656"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#unsetXOptM"><span class="hs-identifier hs-type">unsetXOptM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../ghc-boot-th/src/GHC.LanguageExtensions.Type.html#Extension"><span class="hs-identifier hs-type">LangExt.Extension</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681081656"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681081655"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681081654"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681081656"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681081655"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681081654"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-489"></span><span id="unsetXOptM"><span class="annot"><span class="annottext">unsetXOptM :: forall gbl lcl a. Extension -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#unsetXOptM"><span class="hs-identifier hs-var hs-var">unsetXOptM</span></a></span></span><span> </span><span id="local-6989586621681081653"><span class="annot"><span class="annottext">Extension
</span><a href="#local-6989586621681081653"><span class="hs-identifier hs-var">flag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-490"></span><span>  </span><span class="annot"><span class="annottext">(HscEnv -&gt; HscEnv) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
forall gbl lcl a.
(HscEnv -&gt; HscEnv) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updTopEnv"><span class="hs-identifier hs-var">updTopEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681081652"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681081652"><span class="hs-identifier hs-var">top</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681081652"><span class="hs-identifier hs-var">top</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hsc_dflags :: DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Extension -&gt; DynFlags
</span><a href="GHC.Driver.Session.html#xopt_unset"><span class="hs-identifier hs-var">xopt_unset</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681081652"><span class="hs-identifier hs-var">top</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Extension
</span><a href="#local-6989586621681081653"><span class="hs-identifier hs-var">flag</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-491"></span><span>
</span><span id="line-492"></span><span id="local-6989586621681082749"><span id="local-6989586621681082750"><span id="local-6989586621681082751"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#unsetGOptM"><span class="hs-identifier hs-type">unsetGOptM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#GeneralFlag"><span class="hs-identifier hs-type">GeneralFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082751"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082750"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082749"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082751"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082750"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082749"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-493"></span><span id="unsetGOptM"><span class="annot"><span class="annottext">unsetGOptM :: forall gbl lcl a.
GeneralFlag -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#unsetGOptM"><span class="hs-identifier hs-var hs-var">unsetGOptM</span></a></span></span><span> </span><span id="local-6989586621681081650"><span class="annot"><span class="annottext">GeneralFlag
</span><a href="#local-6989586621681081650"><span class="hs-identifier hs-var">flag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-494"></span><span>  </span><span class="annot"><span class="annottext">(HscEnv -&gt; HscEnv) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
forall gbl lcl a.
(HscEnv -&gt; HscEnv) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updTopEnv"><span class="hs-identifier hs-var">updTopEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681081649"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681081649"><span class="hs-identifier hs-var">top</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681081649"><span class="hs-identifier hs-var">top</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hsc_dflags :: DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; GeneralFlag -&gt; DynFlags
</span><a href="GHC.Driver.Session.html#gopt_unset"><span class="hs-identifier hs-var">gopt_unset</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681081649"><span class="hs-identifier hs-var">top</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="#local-6989586621681081650"><span class="hs-identifier hs-var">flag</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-495"></span><span>
</span><span id="line-496"></span><span id="local-6989586621681082743"><span id="local-6989586621681082744"><span id="local-6989586621681082745"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#unsetWOptM"><span class="hs-identifier hs-type">unsetWOptM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#WarningFlag"><span class="hs-identifier hs-type">WarningFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082745"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082744"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082743"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082745"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082744"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082743"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-497"></span><span id="unsetWOptM"><span class="annot"><span class="annottext">unsetWOptM :: forall gbl lcl a.
WarningFlag -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#unsetWOptM"><span class="hs-identifier hs-var hs-var">unsetWOptM</span></a></span></span><span> </span><span id="local-6989586621681081647"><span class="annot"><span class="annottext">WarningFlag
</span><a href="#local-6989586621681081647"><span class="hs-identifier hs-var">flag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-498"></span><span>  </span><span class="annot"><span class="annottext">(HscEnv -&gt; HscEnv) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
forall gbl lcl a.
(HscEnv -&gt; HscEnv) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updTopEnv"><span class="hs-identifier hs-var">updTopEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681081646"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681081646"><span class="hs-identifier hs-var">top</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681081646"><span class="hs-identifier hs-var">top</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hsc_dflags :: DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; WarningFlag -&gt; DynFlags
</span><a href="GHC.Driver.Session.html#wopt_unset"><span class="hs-identifier hs-var">wopt_unset</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681081646"><span class="hs-identifier hs-var">top</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">WarningFlag
</span><a href="#local-6989586621681081647"><span class="hs-identifier hs-var">flag</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-499"></span><span>
</span><span id="line-500"></span><span class="hs-comment">-- | Do it flag is true</span><span>
</span><span id="line-501"></span><span id="local-6989586621681082738"><span id="local-6989586621681082739"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#whenDOptM"><span class="hs-identifier hs-type">whenDOptM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#DumpFlag"><span class="hs-identifier hs-type">DumpFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082739"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082738"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082739"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082738"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-502"></span><span id="whenDOptM"><span class="annot"><span class="annottext">whenDOptM :: forall gbl lcl. DumpFlag -&gt; TcRnIf gbl lcl () -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#whenDOptM"><span class="hs-identifier hs-var hs-var">whenDOptM</span></a></span></span><span> </span><span id="local-6989586621681081642"><span class="annot"><span class="annottext">DumpFlag
</span><a href="#local-6989586621681081642"><span class="hs-identifier hs-var">flag</span></a></span></span><span> </span><span id="local-6989586621681081641"><span class="annot"><span class="annottext">TcRnIf gbl lcl ()
</span><a href="#local-6989586621681081641"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621681081640"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681081640"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DumpFlag -&gt; TcRnIf gbl lcl Bool
forall gbl lcl. DumpFlag -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#doptM"><span class="hs-identifier hs-var">doptM</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="#local-6989586621681081642"><span class="hs-identifier hs-var">flag</span></a></span><span>
</span><span id="line-503"></span><span>                                 </span><span class="annot"><span class="annottext">Bool -&gt; TcRnIf gbl lcl () -&gt; TcRnIf gbl lcl ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681081640"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnIf gbl lcl ()
</span><a href="#local-6989586621681081641"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-504"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#whenDOptM"><span class="hs-pragma hs-type">whenDOptM</span></a></span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-comment">-- see Note [INLINE conditional tracing utilities]</span><span>
</span><span id="line-505"></span><span>
</span><span id="line-506"></span><span>
</span><span id="line-507"></span><span id="local-6989586621681082734"><span id="local-6989586621681082735"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#whenGOptM"><span class="hs-identifier hs-type">whenGOptM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#GeneralFlag"><span class="hs-identifier hs-type">GeneralFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082735"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082734"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082735"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082734"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-508"></span><span id="whenGOptM"><span class="annot"><span class="annottext">whenGOptM :: forall gbl lcl.
GeneralFlag -&gt; TcRnIf gbl lcl () -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#whenGOptM"><span class="hs-identifier hs-var hs-var">whenGOptM</span></a></span></span><span> </span><span id="local-6989586621681081637"><span class="annot"><span class="annottext">GeneralFlag
</span><a href="#local-6989586621681081637"><span class="hs-identifier hs-var">flag</span></a></span></span><span> </span><span id="local-6989586621681081636"><span class="annot"><span class="annottext">TcRnIf gbl lcl ()
</span><a href="#local-6989586621681081636"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621681081635"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681081635"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; TcRnIf gbl lcl Bool
forall gbl lcl. GeneralFlag -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#goptM"><span class="hs-identifier hs-var">goptM</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="#local-6989586621681081637"><span class="hs-identifier hs-var">flag</span></a></span><span>
</span><span id="line-509"></span><span>                                 </span><span class="annot"><span class="annottext">Bool -&gt; TcRnIf gbl lcl () -&gt; TcRnIf gbl lcl ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681081635"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnIf gbl lcl ()
</span><a href="#local-6989586621681081636"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-510"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#whenGOptM"><span class="hs-pragma hs-type">whenGOptM</span></a></span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-comment">-- see Note [INLINE conditional tracing utilities]</span><span>
</span><span id="line-511"></span><span>
</span><span id="line-512"></span><span id="local-6989586621681082730"><span id="local-6989586621681082731"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#whenWOptM"><span class="hs-identifier hs-type">whenWOptM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#WarningFlag"><span class="hs-identifier hs-type">WarningFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082731"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082730"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082731"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082730"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-513"></span><span id="whenWOptM"><span class="annot"><span class="annottext">whenWOptM :: forall gbl lcl.
WarningFlag -&gt; TcRnIf gbl lcl () -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#whenWOptM"><span class="hs-identifier hs-var hs-var">whenWOptM</span></a></span></span><span> </span><span id="local-6989586621681081632"><span class="annot"><span class="annottext">WarningFlag
</span><a href="#local-6989586621681081632"><span class="hs-identifier hs-var">flag</span></a></span></span><span> </span><span id="local-6989586621681081631"><span class="annot"><span class="annottext">TcRnIf gbl lcl ()
</span><a href="#local-6989586621681081631"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621681081630"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681081630"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">WarningFlag -&gt; TcRnIf gbl lcl Bool
forall gbl lcl. WarningFlag -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#woptM"><span class="hs-identifier hs-var">woptM</span></a></span><span> </span><span class="annot"><span class="annottext">WarningFlag
</span><a href="#local-6989586621681081632"><span class="hs-identifier hs-var">flag</span></a></span><span>
</span><span id="line-514"></span><span>                                 </span><span class="annot"><span class="annottext">Bool -&gt; TcRnIf gbl lcl () -&gt; TcRnIf gbl lcl ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681081630"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnIf gbl lcl ()
</span><a href="#local-6989586621681081631"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-515"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#whenWOptM"><span class="hs-pragma hs-type">whenWOptM</span></a></span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-comment">-- see Note [INLINE conditional tracing utilities]</span><span>
</span><span id="line-516"></span><span>
</span><span id="line-517"></span><span id="local-6989586621681082726"><span id="local-6989586621681082727"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#whenXOptM"><span class="hs-identifier hs-type">whenXOptM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../ghc-boot-th/src/GHC.LanguageExtensions.Type.html#Extension"><span class="hs-identifier hs-type">LangExt.Extension</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082727"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082726"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082727"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082726"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-518"></span><span id="whenXOptM"><span class="annot"><span class="annottext">whenXOptM :: forall gbl lcl. Extension -&gt; TcRnIf gbl lcl () -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#whenXOptM"><span class="hs-identifier hs-var hs-var">whenXOptM</span></a></span></span><span> </span><span id="local-6989586621681081627"><span class="annot"><span class="annottext">Extension
</span><a href="#local-6989586621681081627"><span class="hs-identifier hs-var">flag</span></a></span></span><span> </span><span id="local-6989586621681081626"><span class="annot"><span class="annottext">TcRnIf gbl lcl ()
</span><a href="#local-6989586621681081626"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621681081625"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681081625"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; TcRnIf gbl lcl Bool
forall gbl lcl. Extension -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><a href="#local-6989586621681081627"><span class="hs-identifier hs-var">flag</span></a></span><span>
</span><span id="line-519"></span><span>                                 </span><span class="annot"><span class="annottext">Bool -&gt; TcRnIf gbl lcl () -&gt; TcRnIf gbl lcl ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681081625"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnIf gbl lcl ()
</span><a href="#local-6989586621681081626"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-520"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#whenXOptM"><span class="hs-pragma hs-type">whenXOptM</span></a></span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-comment">-- see Note [INLINE conditional tracing utilities]</span><span>
</span><span id="line-521"></span><span>
</span><span id="line-522"></span><span id="local-6989586621681081623"><span id="local-6989586621681081624"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#unlessXOptM"><span class="hs-identifier hs-type">unlessXOptM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../ghc-boot-th/src/GHC.LanguageExtensions.Type.html#Extension"><span class="hs-identifier hs-type">LangExt.Extension</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681081624"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681081623"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681081624"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681081623"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-523"></span><span id="unlessXOptM"><span class="annot"><span class="annottext">unlessXOptM :: forall gbl lcl. Extension -&gt; TcRnIf gbl lcl () -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#unlessXOptM"><span class="hs-identifier hs-var hs-var">unlessXOptM</span></a></span></span><span> </span><span id="local-6989586621681081620"><span class="annot"><span class="annottext">Extension
</span><a href="#local-6989586621681081620"><span class="hs-identifier hs-var">flag</span></a></span></span><span> </span><span id="local-6989586621681081619"><span class="annot"><span class="annottext">TcRnIf gbl lcl ()
</span><a href="#local-6989586621681081619"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621681081618"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681081618"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; TcRnIf gbl lcl Bool
forall gbl lcl. Extension -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><a href="#local-6989586621681081620"><span class="hs-identifier hs-var">flag</span></a></span><span>
</span><span id="line-524"></span><span>                                   </span><span class="annot"><span class="annottext">Bool -&gt; TcRnIf gbl lcl () -&gt; TcRnIf gbl lcl ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base/src/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681081618"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnIf gbl lcl ()
</span><a href="#local-6989586621681081619"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-525"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#unlessXOptM"><span class="hs-pragma hs-type">unlessXOptM</span></a></span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-comment">-- see Note [INLINE conditional tracing utilities]</span><span>
</span><span id="line-526"></span><span>
</span><span id="line-527"></span><span id="local-6989586621681082720"><span id="local-6989586621681082721"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getGhcMode"><span class="hs-identifier hs-type">getGhcMode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082721"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082720"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#GhcMode"><span class="hs-identifier hs-type">GhcMode</span></a></span></span></span><span>
</span><span id="line-528"></span><span id="getGhcMode"><span class="annot"><span class="annottext">getGhcMode :: forall gbl lcl. TcRnIf gbl lcl GhcMode
</span><a href="GHC.Tc.Utils.Monad.html#getGhcMode"><span class="hs-identifier hs-var hs-var">getGhcMode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081614"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681081614"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf gbl lcl HscEnv
forall gbl lcl. TcRnIf gbl lcl HscEnv
</span><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-var">getTopEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">GhcMode -&gt; TcRnIf gbl lcl GhcMode
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; GhcMode
</span><a href="GHC.Driver.Session.html#ghcMode"><span class="hs-identifier hs-var hs-var">ghcMode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681081614"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-529"></span><span>
</span><span id="line-530"></span><span id="local-6989586621681082714"><span id="local-6989586621681082715"><span id="local-6989586621681082716"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#withDoDynamicToo"><span class="hs-identifier hs-type">withDoDynamicToo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082716"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082715"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082714"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082716"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082715"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082714"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-531"></span><span id="withDoDynamicToo"><span class="annot"><span class="annottext">withDoDynamicToo :: forall gbl lcl a. TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#withDoDynamicToo"><span class="hs-identifier hs-var hs-var">withDoDynamicToo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-532"></span><span>  </span><span class="annot"><span class="annottext">(HscEnv -&gt; HscEnv) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
forall gbl lcl a.
(HscEnv -&gt; HscEnv) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updTopEnv"><span class="hs-identifier hs-var">updTopEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681081612"><span class="annot"><span class="annottext">top :: HscEnv
</span><a href="#local-6989586621681081612"><span class="hs-identifier hs-var">top</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hsc_dflags :: HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681081610"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681081610"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-533"></span><span>              </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681081612"><span class="hs-identifier hs-var">top</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hsc_dflags :: DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; DynFlags
</span><a href="GHC.Driver.Session.html#dynamicTooMkDynamicDynFlags"><span class="hs-identifier hs-var">dynamicTooMkDynamicDynFlags</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681081610"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-534"></span><span>
</span><span id="line-535"></span><span id="local-6989586621681082709"><span id="local-6989586621681082710"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getEpsVar"><span class="hs-identifier hs-type">getEpsVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082710"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082709"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#TcRef"><span class="hs-identifier hs-type">TcRef</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ExternalPackageState"><span class="hs-identifier hs-type">ExternalPackageState</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-536"></span><span id="getEpsVar"><span class="annot"><span class="annottext">getEpsVar :: forall gbl lcl. TcRnIf gbl lcl (TcRef ExternalPackageState)
</span><a href="GHC.Tc.Utils.Monad.html#getEpsVar"><span class="hs-identifier hs-var hs-var">getEpsVar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081606"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681081606"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf gbl lcl HscEnv
forall gbl lcl. TcRnIf gbl lcl HscEnv
</span><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-var">getTopEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcRef ExternalPackageState
-&gt; TcRnIf gbl lcl (TcRef ExternalPackageState)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; TcRef ExternalPackageState
</span><a href="GHC.Driver.Types.html#hsc_EPS"><span class="hs-identifier hs-var hs-var">hsc_EPS</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681081606"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-537"></span><span>
</span><span id="line-538"></span><span id="local-6989586621681082703"><span id="local-6989586621681082704"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getEps"><span class="hs-identifier hs-type">getEps</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082704"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082703"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ExternalPackageState"><span class="hs-identifier hs-type">ExternalPackageState</span></a></span></span></span><span>
</span><span id="line-539"></span><span id="getEps"><span class="annot"><span class="annottext">getEps :: forall gbl lcl. TcRnIf gbl lcl ExternalPackageState
</span><a href="GHC.Tc.Utils.Monad.html#getEps"><span class="hs-identifier hs-var hs-var">getEps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081603"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681081603"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf gbl lcl HscEnv
forall gbl lcl. TcRnIf gbl lcl HscEnv
</span><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-var">getTopEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcRef ExternalPackageState -&gt; TcRnIf gbl lcl ExternalPackageState
forall a env. IORef a -&gt; IOEnv env a
</span><a href="GHC.Data.IOEnv.html#readMutVar"><span class="hs-identifier hs-var">readMutVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; TcRef ExternalPackageState
</span><a href="GHC.Driver.Types.html#hsc_EPS"><span class="hs-identifier hs-var hs-var">hsc_EPS</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681081603"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-540"></span><span>
</span><span id="line-541"></span><span class="hs-comment">-- | Update the external package state.  Returns the second result of the</span><span>
</span><span id="line-542"></span><span class="hs-comment">-- modifier function.</span><span>
</span><span id="line-543"></span><span class="hs-comment">--</span><span>
</span><span id="line-544"></span><span class="hs-comment">-- This is an atomic operation and forces evaluation of the modified EPS in</span><span>
</span><span id="line-545"></span><span class="hs-comment">-- order to avoid space leaks.</span><span>
</span><span id="line-546"></span><span id="local-6989586621681082696"><span id="local-6989586621681082697"><span id="local-6989586621681082698"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#updateEps"><span class="hs-identifier hs-type">updateEps</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Types.html#ExternalPackageState"><span class="hs-identifier hs-type">ExternalPackageState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Types.html#ExternalPackageState"><span class="hs-identifier hs-type">ExternalPackageState</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621681082698"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-547"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082697"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082696"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082698"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-548"></span><span id="updateEps"><span class="annot"><span class="annottext">updateEps :: forall a gbl lcl.
(ExternalPackageState -&gt; (ExternalPackageState, a))
-&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updateEps"><span class="hs-identifier hs-var hs-var">updateEps</span></a></span></span><span> </span><span id="local-6989586621681081599"><span class="annot"><span class="annottext">ExternalPackageState -&gt; (ExternalPackageState, a)
</span><a href="#local-6989586621681081599"><span class="hs-identifier hs-var">upd_fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-549"></span><span>  </span><span class="annot"><span class="annottext">SDoc -&gt; TcRnIf gbl lcl ()
forall m n. SDoc -&gt; TcRnIf m n ()
</span><a href="GHC.Tc.Utils.Monad.html#traceIf"><span class="hs-identifier hs-var">traceIf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;updating EPS&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-550"></span><span>  </span><span id="local-6989586621681081597"><span class="annot"><span class="annottext">TcRef ExternalPackageState
</span><a href="#local-6989586621681081597"><span class="hs-identifier hs-var">eps_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf gbl lcl (TcRef ExternalPackageState)
forall gbl lcl. TcRnIf gbl lcl (TcRef ExternalPackageState)
</span><a href="GHC.Tc.Utils.Monad.html#getEpsVar"><span class="hs-identifier hs-var">getEpsVar</span></a></span><span>
</span><span id="line-551"></span><span>  </span><span class="annot"><span class="annottext">TcRef ExternalPackageState
-&gt; (ExternalPackageState -&gt; (ExternalPackageState, a))
-&gt; TcRnIf gbl lcl a
forall a b env. IORef a -&gt; (a -&gt; (a, b)) -&gt; IOEnv env b
</span><a href="GHC.Data.IOEnv.html#atomicUpdMutVar%27"><span class="hs-identifier hs-var">atomicUpdMutVar'</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef ExternalPackageState
</span><a href="#local-6989586621681081597"><span class="hs-identifier hs-var">eps_var</span></a></span><span> </span><span class="annot"><span class="annottext">ExternalPackageState -&gt; (ExternalPackageState, a)
</span><a href="#local-6989586621681081599"><span class="hs-identifier hs-var">upd_fn</span></a></span><span>
</span><span id="line-552"></span><span>
</span><span id="line-553"></span><span class="hs-comment">-- | Update the external package state.</span><span>
</span><span id="line-554"></span><span class="hs-comment">--</span><span>
</span><span id="line-555"></span><span class="hs-comment">-- This is an atomic operation and forces evaluation of the modified EPS in</span><span>
</span><span id="line-556"></span><span class="hs-comment">-- order to avoid space leaks.</span><span>
</span><span id="line-557"></span><span id="local-6989586621681082686"><span id="local-6989586621681082687"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#updateEps_"><span class="hs-identifier hs-type">updateEps_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Types.html#ExternalPackageState"><span class="hs-identifier hs-type">ExternalPackageState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ExternalPackageState"><span class="hs-identifier hs-type">ExternalPackageState</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-558"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082687"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082686"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-559"></span><span id="updateEps_"><span class="annot"><span class="annottext">updateEps_ :: forall gbl lcl.
(ExternalPackageState -&gt; ExternalPackageState) -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#updateEps_"><span class="hs-identifier hs-var hs-var">updateEps_</span></a></span></span><span> </span><span id="local-6989586621681081595"><span class="annot"><span class="annottext">ExternalPackageState -&gt; ExternalPackageState
</span><a href="#local-6989586621681081595"><span class="hs-identifier hs-var">upd_fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ExternalPackageState -&gt; (ExternalPackageState, ()))
-&gt; TcRnIf gbl lcl ()
forall a gbl lcl.
(ExternalPackageState -&gt; (ExternalPackageState, a))
-&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updateEps"><span class="hs-identifier hs-var">updateEps</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681081594"><span class="annot"><span class="annottext">ExternalPackageState
</span><a href="#local-6989586621681081594"><span class="hs-identifier hs-var">eps</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExternalPackageState -&gt; ExternalPackageState
</span><a href="#local-6989586621681081595"><span class="hs-identifier hs-var">upd_fn</span></a></span><span> </span><span class="annot"><span class="annottext">ExternalPackageState
</span><a href="#local-6989586621681081594"><span class="hs-identifier hs-var">eps</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-560"></span><span>
</span><span id="line-561"></span><span id="local-6989586621681082682"><span id="local-6989586621681082683"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getHpt"><span class="hs-identifier hs-type">getHpt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082683"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082682"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HomePackageTable"><span class="hs-identifier hs-type">HomePackageTable</span></a></span></span></span><span>
</span><span id="line-562"></span><span id="getHpt"><span class="annot"><span class="annottext">getHpt :: forall gbl lcl. TcRnIf gbl lcl HomePackageTable
</span><a href="GHC.Tc.Utils.Monad.html#getHpt"><span class="hs-identifier hs-var hs-var">getHpt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081591"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681081591"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf gbl lcl HscEnv
forall gbl lcl. TcRnIf gbl lcl HscEnv
</span><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-var">getTopEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HomePackageTable -&gt; TcRnIf gbl lcl HomePackageTable
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; HomePackageTable
</span><a href="GHC.Driver.Types.html#hsc_HPT"><span class="hs-identifier hs-var hs-var">hsc_HPT</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681081591"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-563"></span><span>
</span><span id="line-564"></span><span id="local-6989586621681082677"><span id="local-6989586621681082678"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getEpsAndHpt"><span class="hs-identifier hs-type">getEpsAndHpt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082678"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082677"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Types.html#ExternalPackageState"><span class="hs-identifier hs-type">ExternalPackageState</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HomePackageTable"><span class="hs-identifier hs-type">HomePackageTable</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-565"></span><span id="getEpsAndHpt"><span class="annot"><span class="annottext">getEpsAndHpt :: forall gbl lcl.
TcRnIf gbl lcl (ExternalPackageState, HomePackageTable)
</span><a href="GHC.Tc.Utils.Monad.html#getEpsAndHpt"><span class="hs-identifier hs-var hs-var">getEpsAndHpt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081586"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681081586"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf gbl lcl HscEnv
forall gbl lcl. TcRnIf gbl lcl HscEnv
</span><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-var">getTopEnv</span></a></span><span class="hs-special">;</span><span> </span><span id="local-6989586621681081585"><span class="annot"><span class="annottext">ExternalPackageState
</span><a href="#local-6989586621681081585"><span class="hs-identifier hs-var">eps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRef ExternalPackageState
-&gt; IOEnv (Env gbl lcl) ExternalPackageState
forall a env. IORef a -&gt; IOEnv env a
</span><a href="GHC.Data.IOEnv.html#readMutVar"><span class="hs-identifier hs-var">readMutVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; TcRef ExternalPackageState
</span><a href="GHC.Driver.Types.html#hsc_EPS"><span class="hs-identifier hs-var hs-var">hsc_EPS</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681081586"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-566"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(ExternalPackageState, HomePackageTable)
-&gt; TcRnIf gbl lcl (ExternalPackageState, HomePackageTable)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExternalPackageState
</span><a href="#local-6989586621681081585"><span class="hs-identifier hs-var">eps</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; HomePackageTable
</span><a href="GHC.Driver.Types.html#hsc_HPT"><span class="hs-identifier hs-var hs-var">hsc_HPT</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681081586"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-567"></span><span>
</span><span id="line-568"></span><span class="hs-comment">-- | A convenient wrapper for taking a @MaybeErr MsgDoc a@ and throwing</span><span>
</span><span id="line-569"></span><span class="hs-comment">-- an exception if it is an error.</span><span>
</span><span id="line-570"></span><span id="local-6989586621681082672"><span id="local-6989586621681082673"><span id="local-6989586621681082674"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#withException"><span class="hs-identifier hs-type">withException</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082674"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082673"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Maybe.html#MaybeErr"><span class="hs-identifier hs-type">MaybeErr</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#MsgDoc"><span class="hs-identifier hs-type">MsgDoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082672"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082674"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082673"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082672"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-571"></span><span id="withException"><span class="annot"><span class="annottext">withException :: forall gbl lcl a.
TcRnIf gbl lcl (MaybeErr SDoc a) -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#withException"><span class="hs-identifier hs-var hs-var">withException</span></a></span></span><span> </span><span id="local-6989586621681081577"><span class="annot"><span class="annottext">TcRnIf gbl lcl (MaybeErr SDoc a)
</span><a href="#local-6989586621681081577"><span class="hs-identifier hs-var">do_this</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-572"></span><span>    </span><span id="local-6989586621681081576"><span class="annot"><span class="annottext">MaybeErr SDoc a
</span><a href="#local-6989586621681081576"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf gbl lcl (MaybeErr SDoc a)
</span><a href="#local-6989586621681081577"><span class="hs-identifier hs-var">do_this</span></a></span><span>
</span><span id="line-573"></span><span>    </span><span id="local-6989586621681081575"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681081575"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env gbl lcl) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-574"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MaybeErr SDoc a
</span><a href="#local-6989586621681081576"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-575"></span><span>        </span><span class="annot"><a href="GHC.Data.Maybe.html#Failed"><span class="hs-identifier hs-type">Failed</span></a></span><span> </span><span id="local-6989586621681081573"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081573"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO a -&gt; TcRnIf gbl lcl a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO a -&gt; TcRnIf gbl lcl a) -&gt; IO a -&gt; TcRnIf gbl lcl a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">GhcException -&gt; IO a
forall a. GhcException -&gt; IO a
</span><a href="GHC.Utils.Panic.html#throwGhcExceptionIO"><span class="hs-identifier hs-var">throwGhcExceptionIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; GhcException
</span><a href="GHC.Utils.Panic.html#ProgramError"><span class="hs-identifier hs-var">ProgramError</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; SDoc -&gt; FilePath
</span><a href="GHC.Utils.Outputable.html#showSDoc"><span class="hs-identifier hs-var">showSDoc</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681081575"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081573"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-576"></span><span>        </span><span class="annot"><a href="GHC.Data.Maybe.html#Succeeded"><span class="hs-identifier hs-type">Succeeded</span></a></span><span> </span><span id="local-6989586621681081567"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681081567"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; TcRnIf gbl lcl a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681081567"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-577"></span><span>
</span><span id="line-578"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Arrow scopes
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-585"></span><span>
</span><span id="line-586"></span><span id="local-6989586621681082663"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newArrowScope"><span class="hs-identifier hs-type">newArrowScope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082663"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082663"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-587"></span><span id="newArrowScope"><span class="annot"><span class="annottext">newArrowScope :: forall a. TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#newArrowScope"><span class="hs-identifier hs-var hs-var">newArrowScope</span></a></span></span><span>
</span><span id="line-588"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcLclEnv -&gt; TcLclEnv)
-&gt; TcRnIf TcGblEnv TcLclEnv a -&gt; TcRnIf TcGblEnv TcLclEnv a
forall lcl gbl a.
(lcl -&gt; lcl) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updLclEnv"><span class="hs-identifier hs-var">updLclEnv</span></a></span><span> </span><span class="annot"><span class="annottext">((TcLclEnv -&gt; TcLclEnv)
 -&gt; TcRnIf TcGblEnv TcLclEnv a -&gt; TcRnIf TcGblEnv TcLclEnv a)
-&gt; (TcLclEnv -&gt; TcLclEnv)
-&gt; TcRnIf TcGblEnv TcLclEnv a
-&gt; TcRnIf TcGblEnv TcLclEnv a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681081566"><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681081566"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681081566"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcl_arrow_ctxt :: ArrowCtxt
</span><a href="GHC.Tc.Types.html#tcl_arrow_ctxt"><span class="hs-identifier hs-var">tcl_arrow_ctxt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LocalRdrEnv -&gt; IORef WantedConstraints -&gt; ArrowCtxt
</span><a href="GHC.Tc.Types.html#ArrowCtxt"><span class="hs-identifier hs-var">ArrowCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcLclEnv -&gt; LocalRdrEnv
</span><a href="GHC.Tc.Types.html#tcl_rdr"><span class="hs-identifier hs-var hs-var">tcl_rdr</span></a></span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681081566"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcLclEnv -&gt; IORef WantedConstraints
</span><a href="GHC.Tc.Types.html#tcl_lie"><span class="hs-identifier hs-var hs-var">tcl_lie</span></a></span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681081566"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-589"></span><span>
</span><span id="line-590"></span><span class="hs-comment">-- Return to the stored environment (from the enclosing proc)</span><span>
</span><span id="line-591"></span><span id="local-6989586621681081564"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#escapeArrowScope"><span class="hs-identifier hs-type">escapeArrowScope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681081564"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681081564"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-592"></span><span id="escapeArrowScope"><span class="annot"><span class="annottext">escapeArrowScope :: forall a. TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#escapeArrowScope"><span class="hs-identifier hs-var hs-var">escapeArrowScope</span></a></span></span><span>
</span><span id="line-593"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcLclEnv -&gt; TcLclEnv)
-&gt; TcRnIf TcGblEnv TcLclEnv a -&gt; TcRnIf TcGblEnv TcLclEnv a
forall lcl gbl a.
(lcl -&gt; lcl) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updLclEnv"><span class="hs-identifier hs-var">updLclEnv</span></a></span><span> </span><span class="annot"><span class="annottext">((TcLclEnv -&gt; TcLclEnv)
 -&gt; TcRnIf TcGblEnv TcLclEnv a -&gt; TcRnIf TcGblEnv TcLclEnv a)
-&gt; (TcLclEnv -&gt; TcLclEnv)
-&gt; TcRnIf TcGblEnv TcLclEnv a
-&gt; TcRnIf TcGblEnv TcLclEnv a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681081563"><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681081563"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-594"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TcLclEnv -&gt; ArrowCtxt
</span><a href="GHC.Tc.Types.html#tcl_arrow_ctxt"><span class="hs-identifier hs-var hs-var">tcl_arrow_ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681081563"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-595"></span><span>      </span><span class="annot"><span class="annottext">ArrowCtxt
</span><a href="GHC.Tc.Types.html#NoArrowCtxt"><span class="hs-identifier hs-var">NoArrowCtxt</span></a></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681081563"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-596"></span><span>      </span><span class="annot"><a href="GHC.Tc.Types.html#ArrowCtxt"><span class="hs-identifier hs-type">ArrowCtxt</span></a></span><span> </span><span id="local-6989586621681081562"><span class="annot"><span class="annottext">LocalRdrEnv
</span><a href="#local-6989586621681081562"><span class="hs-identifier hs-var">rdr_env</span></a></span></span><span> </span><span id="local-6989586621681081561"><span class="annot"><span class="annottext">IORef WantedConstraints
</span><a href="#local-6989586621681081561"><span class="hs-identifier hs-var">lie</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681081563"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcl_arrow_ctxt :: ArrowCtxt
</span><a href="GHC.Tc.Types.html#tcl_arrow_ctxt"><span class="hs-identifier hs-var">tcl_arrow_ctxt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArrowCtxt
</span><a href="GHC.Tc.Types.html#NoArrowCtxt"><span class="hs-identifier hs-var">NoArrowCtxt</span></a></span><span>
</span><span id="line-597"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcl_lie :: IORef WantedConstraints
</span><a href="GHC.Tc.Types.html#tcl_lie"><span class="hs-identifier hs-var">tcl_lie</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef WantedConstraints
</span><a href="#local-6989586621681081561"><span class="hs-identifier hs-var">lie</span></a></span><span>
</span><span id="line-598"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcl_rdr :: LocalRdrEnv
</span><a href="GHC.Tc.Types.html#tcl_rdr"><span class="hs-identifier hs-var">tcl_rdr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LocalRdrEnv
</span><a href="#local-6989586621681081562"><span class="hs-identifier hs-var">rdr_env</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-599"></span><span>
</span><span id="line-600"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Unique supply
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-607"></span><span>
</span><span id="line-608"></span><span id="local-6989586621681082659"><span id="local-6989586621681082660"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newUnique"><span class="hs-identifier hs-type">newUnique</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082660"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082659"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Unique.html#Unique"><span class="hs-identifier hs-type">Unique</span></a></span></span></span><span>
</span><span id="line-609"></span><span id="newUnique"><span class="annot"><span class="annottext">newUnique :: forall gbl lcl. TcRnIf gbl lcl Unique
</span><a href="GHC.Tc.Utils.Monad.html#newUnique"><span class="hs-identifier hs-var hs-var">newUnique</span></a></span></span><span>
</span><span id="line-610"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081558"><span class="annot"><span class="annottext">Env gbl lcl
</span><a href="#local-6989586621681081558"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env gbl lcl) (Env gbl lcl)
forall env. IOEnv env env
</span><a href="GHC.Data.IOEnv.html#getEnv"><span class="hs-identifier hs-var">getEnv</span></a></span><span>
</span><span id="line-611"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681081557"><span class="annot"><span class="annottext">mask :: Char
</span><a href="#local-6989586621681081557"><span class="hs-identifier hs-var hs-var">mask</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Env gbl lcl -&gt; Char
forall gbl lcl. Env gbl lcl -&gt; Char
</span><a href="GHC.Tc.Types.html#env_um"><span class="hs-identifier hs-var hs-var">env_um</span></a></span><span> </span><span class="annot"><span class="annottext">Env gbl lcl
</span><a href="#local-6989586621681081558"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-612"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">IO Unique -&gt; TcRnIf gbl lcl Unique
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO Unique -&gt; TcRnIf gbl lcl Unique)
-&gt; IO Unique -&gt; TcRnIf gbl lcl Unique
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; IO Unique
</span><a href="GHC.Types.Unique.Supply.html#uniqFromMask"><span class="hs-identifier hs-var">uniqFromMask</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621681081557"><span class="hs-identifier hs-var">mask</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-613"></span><span>
</span><span id="line-614"></span><span id="local-6989586621681082655"><span id="local-6989586621681082656"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newUniqueSupply"><span class="hs-identifier hs-type">newUniqueSupply</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082656"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082655"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html#UniqSupply"><span class="hs-identifier hs-type">UniqSupply</span></a></span></span></span><span>
</span><span id="line-615"></span><span id="newUniqueSupply"><span class="annot"><span class="annottext">newUniqueSupply :: forall gbl lcl. TcRnIf gbl lcl UniqSupply
</span><a href="GHC.Tc.Utils.Monad.html#newUniqueSupply"><span class="hs-identifier hs-var hs-var">newUniqueSupply</span></a></span></span><span>
</span><span id="line-616"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081552"><span class="annot"><span class="annottext">Env gbl lcl
</span><a href="#local-6989586621681081552"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env gbl lcl) (Env gbl lcl)
forall env. IOEnv env env
</span><a href="GHC.Data.IOEnv.html#getEnv"><span class="hs-identifier hs-var">getEnv</span></a></span><span>
</span><span id="line-617"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681081551"><span class="annot"><span class="annottext">mask :: Char
</span><a href="#local-6989586621681081551"><span class="hs-identifier hs-var hs-var">mask</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Env gbl lcl -&gt; Char
forall gbl lcl. Env gbl lcl -&gt; Char
</span><a href="GHC.Tc.Types.html#env_um"><span class="hs-identifier hs-var hs-var">env_um</span></a></span><span> </span><span class="annot"><span class="annottext">Env gbl lcl
</span><a href="#local-6989586621681081552"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-618"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">IO UniqSupply -&gt; TcRnIf gbl lcl UniqSupply
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO UniqSupply -&gt; TcRnIf gbl lcl UniqSupply)
-&gt; IO UniqSupply -&gt; TcRnIf gbl lcl UniqSupply
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="annot"><span class="annottext">Char -&gt; IO UniqSupply
</span><a href="GHC.Types.Unique.Supply.html#mkSplitUniqSupply"><span class="hs-identifier hs-var">mkSplitUniqSupply</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621681081551"><span class="hs-identifier hs-var">mask</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-619"></span><span>
</span><span id="line-620"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#cloneLocalName"><span class="hs-identifier hs-type">cloneLocalName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-621"></span><span class="hs-comment">-- Make a fresh Internal name with the same OccName and SrcSpan</span><span>
</span><span id="line-622"></span><span id="cloneLocalName"><span class="annot"><span class="annottext">cloneLocalName :: Name -&gt; TcM Name
</span><a href="GHC.Tc.Utils.Monad.html#cloneLocalName"><span class="hs-identifier hs-var hs-var">cloneLocalName</span></a></span></span><span> </span><span id="local-6989586621681081549"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681081549"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; SrcSpan -&gt; TcM Name
</span><a href="GHC.Tc.Utils.Monad.html#newNameAt"><span class="hs-identifier hs-var">newNameAt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; OccName
</span><a href="GHC.Types.Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681081549"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SrcSpan
</span><a href="GHC.Types.Name.html#nameSrcSpan"><span class="hs-identifier hs-var">nameSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681081549"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-623"></span><span>
</span><span id="line-624"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newName"><span class="hs-identifier hs-type">newName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Occurrence.html#OccName"><span class="hs-identifier hs-type">OccName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-625"></span><span id="newName"><span class="annot"><span class="annottext">newName :: OccName -&gt; TcM Name
</span><a href="GHC.Tc.Utils.Monad.html#newName"><span class="hs-identifier hs-var hs-var">newName</span></a></span></span><span> </span><span id="local-6989586621681081546"><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621681081546"><span class="hs-identifier hs-var">occ</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081545"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681081545"><span class="hs-identifier hs-var">loc</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn SrcSpan
</span><a href="GHC.Tc.Utils.Monad.html#getSrcSpanM"><span class="hs-identifier hs-var">getSrcSpanM</span></a></span><span>
</span><span id="line-626"></span><span>                 </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; SrcSpan -&gt; TcM Name
</span><a href="GHC.Tc.Utils.Monad.html#newNameAt"><span class="hs-identifier hs-var">newNameAt</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621681081546"><span class="hs-identifier hs-var">occ</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681081545"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-627"></span><span>
</span><span id="line-628"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newNameAt"><span class="hs-identifier hs-type">newNameAt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Occurrence.html#OccName"><span class="hs-identifier hs-type">OccName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-629"></span><span id="newNameAt"><span class="annot"><span class="annottext">newNameAt :: OccName -&gt; SrcSpan -&gt; TcM Name
</span><a href="GHC.Tc.Utils.Monad.html#newNameAt"><span class="hs-identifier hs-var hs-var">newNameAt</span></a></span></span><span> </span><span id="local-6989586621681081544"><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621681081544"><span class="hs-identifier hs-var">occ</span></a></span></span><span> </span><span id="local-6989586621681081543"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681081543"><span class="hs-identifier hs-var">span</span></a></span></span><span>
</span><span id="line-630"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081542"><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621681081542"><span class="hs-identifier hs-var">uniq</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv Unique
forall gbl lcl. TcRnIf gbl lcl Unique
</span><a href="GHC.Tc.Utils.Monad.html#newUnique"><span class="hs-identifier hs-var">newUnique</span></a></span><span>
</span><span id="line-631"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Name
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Unique -&gt; OccName -&gt; SrcSpan -&gt; Name
</span><a href="GHC.Types.Name.html#mkInternalName"><span class="hs-identifier hs-var">mkInternalName</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621681081542"><span class="hs-identifier hs-var">uniq</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621681081544"><span class="hs-identifier hs-var">occ</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681081543"><span class="hs-identifier hs-var">span</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-632"></span><span>
</span><span id="line-633"></span><span id="local-6989586621681082647"><span id="local-6989586621681082648"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newSysName"><span class="hs-identifier hs-type">newSysName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Occurrence.html#OccName"><span class="hs-identifier hs-type">OccName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082648"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082647"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span></span></span><span>
</span><span id="line-634"></span><span id="newSysName"><span class="annot"><span class="annottext">newSysName :: forall gbl lcl. OccName -&gt; TcRnIf gbl lcl Name
</span><a href="GHC.Tc.Utils.Monad.html#newSysName"><span class="hs-identifier hs-var hs-var">newSysName</span></a></span></span><span> </span><span id="local-6989586621681081538"><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621681081538"><span class="hs-identifier hs-var">occ</span></a></span></span><span>
</span><span id="line-635"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081537"><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621681081537"><span class="hs-identifier hs-var">uniq</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf gbl lcl Unique
forall gbl lcl. TcRnIf gbl lcl Unique
</span><a href="GHC.Tc.Utils.Monad.html#newUnique"><span class="hs-identifier hs-var">newUnique</span></a></span><span>
</span><span id="line-636"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcRnIf gbl lcl Name
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Unique -&gt; OccName -&gt; Name
</span><a href="GHC.Types.Name.html#mkSystemName"><span class="hs-identifier hs-var">mkSystemName</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621681081537"><span class="hs-identifier hs-var">uniq</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621681081538"><span class="hs-identifier hs-var">occ</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-637"></span><span>
</span><span id="line-638"></span><span id="local-6989586621681082643"><span id="local-6989586621681082644"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newSysLocalId"><span class="hs-identifier hs-type">newSysLocalId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Mult"><span class="hs-identifier hs-type">Mult</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082644"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082643"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcId"><span class="hs-identifier hs-type">TcId</span></a></span></span></span><span>
</span><span id="line-639"></span><span id="newSysLocalId"><span class="annot"><span class="annottext">newSysLocalId :: forall gbl lcl. FastString -&gt; Type -&gt; Type -&gt; TcRnIf gbl lcl Id
</span><a href="GHC.Tc.Utils.Monad.html#newSysLocalId"><span class="hs-identifier hs-var hs-var">newSysLocalId</span></a></span></span><span> </span><span id="local-6989586621681081530"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621681081530"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span id="local-6989586621681081529"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681081529"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621681081528"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681081528"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-640"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081527"><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621681081527"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf gbl lcl Unique
forall gbl lcl. TcRnIf gbl lcl Unique
</span><a href="GHC.Tc.Utils.Monad.html#newUnique"><span class="hs-identifier hs-var">newUnique</span></a></span><span>
</span><span id="line-641"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Id -&gt; TcRnIf gbl lcl Id
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; Unique -&gt; Type -&gt; Type -&gt; Id
</span><a href="GHC.Types.Id.html#mkSysLocal"><span class="hs-identifier hs-var">mkSysLocal</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621681081530"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621681081527"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681081529"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681081528"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-642"></span><span>
</span><span id="line-643"></span><span id="local-6989586621681082638"><span id="local-6989586621681082639"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newSysLocalIds"><span class="hs-identifier hs-type">newSysLocalIds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082639"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082638"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.html#TcId"><span class="hs-identifier hs-type">TcId</span></a></span><span class="hs-special">]</span></span></span><span>
</span><span id="line-644"></span><span id="newSysLocalIds"><span class="annot"><span class="annottext">newSysLocalIds :: forall gbl lcl. FastString -&gt; [Scaled Type] -&gt; TcRnIf gbl lcl [Id]
</span><a href="GHC.Tc.Utils.Monad.html#newSysLocalIds"><span class="hs-identifier hs-var hs-var">newSysLocalIds</span></a></span></span><span> </span><span id="local-6989586621681081523"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621681081523"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span id="local-6989586621681081522"><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621681081522"><span class="hs-identifier hs-var">tys</span></a></span></span><span>
</span><span id="line-645"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081521"><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621681081521"><span class="hs-identifier hs-var">us</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf gbl lcl UniqSupply
forall gbl lcl. TcRnIf gbl lcl UniqSupply
</span><a href="GHC.Tc.Utils.Monad.html#newUniqueSupply"><span class="hs-identifier hs-var">newUniqueSupply</span></a></span><span>
</span><span id="line-646"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681081520"><span class="annot"><span class="annottext">mkId' :: Unique -&gt; Scaled Type -&gt; Id
</span><a href="#local-6989586621681081520"><span class="hs-identifier hs-var hs-var">mkId'</span></a></span></span><span> </span><span id="local-6989586621681081519"><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621681081519"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span id="local-6989586621681081517"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681081517"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span id="local-6989586621681081516"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681081516"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; Unique -&gt; Type -&gt; Type -&gt; Id
</span><a href="GHC.Types.Id.html#mkSysLocal"><span class="hs-identifier hs-var">mkSysLocal</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621681081523"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621681081519"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681081517"><span class="hs-identifier hs-var">w</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681081516"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-647"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; TcRnIf gbl lcl [Id]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Unique -&gt; Scaled Type -&gt; Id) -&gt; [Unique] -&gt; [Scaled Type] -&gt; [Id]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><a href="../../base/src/GHC.List.html#zipWith"><span class="hs-identifier hs-var">zipWith</span></a></span><span> </span><span class="annot"><span class="annottext">Unique -&gt; Scaled Type -&gt; Id
</span><a href="#local-6989586621681081520"><span class="hs-identifier hs-var">mkId'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UniqSupply -&gt; [Unique]
</span><a href="GHC.Types.Unique.Supply.html#uniqsFromSupply"><span class="hs-identifier hs-var">uniqsFromSupply</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621681081521"><span class="hs-identifier hs-var">us</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621681081522"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-648"></span><span>
</span><span id="line-649"></span><span id="local-6989586621681082630"><span id="local-6989586621681082631"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681081508"><span class="annot"><a href="GHC.Types.Unique.Supply.html#MonadUnique"><span class="hs-identifier hs-type">MonadUnique</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.IOEnv.html#IOEnv"><span class="hs-identifier hs-type">IOEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#Env"><span class="hs-identifier hs-type">Env</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082631"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082630"><span class="hs-identifier hs-type">lcl</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-650"></span><span>        </span><span id="local-6989586621681081506"><span class="annot"><span class="annottext">getUniqueM :: IOEnv (Env gbl lcl) Unique
</span><a href="GHC.Types.Unique.Supply.html#getUniqueM"><span class="hs-identifier hs-var hs-var hs-var hs-var">getUniqueM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env gbl lcl) Unique
forall gbl lcl. TcRnIf gbl lcl Unique
</span><a href="GHC.Tc.Utils.Monad.html#newUnique"><span class="hs-identifier hs-var">newUnique</span></a></span><span>
</span><span id="line-651"></span><span>        </span><span id="local-6989586621681081504"><span class="annot"><span class="annottext">getUniqueSupplyM :: IOEnv (Env gbl lcl) UniqSupply
</span><a href="GHC.Types.Unique.Supply.html#getUniqueSupplyM"><span class="hs-identifier hs-var hs-var hs-var hs-var">getUniqueSupplyM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env gbl lcl) UniqSupply
forall gbl lcl. TcRnIf gbl lcl UniqSupply
</span><a href="GHC.Tc.Utils.Monad.html#newUniqueSupply"><span class="hs-identifier hs-var">newUniqueSupply</span></a></span></span></span><span>
</span><span id="line-652"></span><span>
</span><span id="line-653"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Accessing input/output
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-660"></span><span>
</span><span id="line-661"></span><span id="local-6989586621681082627"><span id="local-6989586621681082628"><span id="local-6989586621681082629"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newTcRef"><span class="hs-identifier hs-type">newTcRef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621681082629"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082628"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082627"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#TcRef"><span class="hs-identifier hs-type">TcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082629"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-662"></span><span id="newTcRef"><span class="annot"><span class="annottext">newTcRef :: forall a gbl lcl. a -&gt; TcRnIf gbl lcl (TcRef a)
</span><a href="GHC.Tc.Utils.Monad.html#newTcRef"><span class="hs-identifier hs-var hs-var">newTcRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">a -&gt; IOEnv (Env gbl lcl) (IORef a)
forall a env. a -&gt; IOEnv env (IORef a)
</span><a href="GHC.Data.IOEnv.html#newMutVar"><span class="hs-identifier hs-var">newMutVar</span></a></span><span>
</span><span id="line-663"></span><span>
</span><span id="line-664"></span><span id="local-6989586621681082619"><span id="local-6989586621681082620"><span id="local-6989586621681082621"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#readTcRef"><span class="hs-identifier hs-type">readTcRef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRef"><span class="hs-identifier hs-type">TcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082621"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082620"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082619"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082621"><span class="hs-identifier hs-type">a</span></a></span></span></span></span><span>
</span><span id="line-665"></span><span id="readTcRef"><span class="annot"><span class="annottext">readTcRef :: forall a gbl lcl. TcRef a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#readTcRef"><span class="hs-identifier hs-var hs-var">readTcRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef a -&gt; IOEnv (Env gbl lcl) a
forall a env. IORef a -&gt; IOEnv env a
</span><a href="GHC.Data.IOEnv.html#readMutVar"><span class="hs-identifier hs-var">readMutVar</span></a></span><span>
</span><span id="line-666"></span><span>
</span><span id="line-667"></span><span id="local-6989586621681082613"><span id="local-6989586621681082614"><span id="local-6989586621681082615"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#writeTcRef"><span class="hs-identifier hs-type">writeTcRef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRef"><span class="hs-identifier hs-type">TcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082615"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681082615"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082614"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082613"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-668"></span><span id="writeTcRef"><span class="annot"><span class="annottext">writeTcRef :: forall a gbl lcl. TcRef a -&gt; a -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#writeTcRef"><span class="hs-identifier hs-var hs-var">writeTcRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef a -&gt; a -&gt; IOEnv (Env gbl lcl) ()
forall a env. IORef a -&gt; a -&gt; IOEnv env ()
</span><a href="GHC.Data.IOEnv.html#writeMutVar"><span class="hs-identifier hs-var">writeMutVar</span></a></span><span>
</span><span id="line-669"></span><span>
</span><span id="line-670"></span><span id="local-6989586621681082605"><span id="local-6989586621681082606"><span id="local-6989586621681082607"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#updTcRef"><span class="hs-identifier hs-type">updTcRef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRef"><span class="hs-identifier hs-type">TcRef</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082607"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681082607"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681082607"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082606"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082605"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-671"></span><span class="hs-comment">-- Returns ()</span><span>
</span><span id="line-672"></span><span id="updTcRef"><span class="annot"><span class="annottext">updTcRef :: forall a gbl lcl. TcRef a -&gt; (a -&gt; a) -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#updTcRef"><span class="hs-identifier hs-var hs-var">updTcRef</span></a></span></span><span> </span><span id="local-6989586621681081498"><span class="annot"><span class="annottext">TcRef a
</span><a href="#local-6989586621681081498"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span id="local-6989586621681081497"><span class="annot"><span class="annottext">a -&gt; a
</span><a href="#local-6989586621681081497"><span class="hs-identifier hs-var">fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IOEnv (Env gbl lcl) ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IOEnv (Env gbl lcl) ())
-&gt; IO () -&gt; IOEnv (Env gbl lcl) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081496"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681081496"><span class="hs-identifier hs-var">old</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRef a -&gt; IO a
forall a. IORef a -&gt; IO a
</span><a href="../../base/src/GHC.IORef.html#readIORef"><span class="hs-identifier hs-var">readIORef</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef a
</span><a href="#local-6989586621681081498"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-673"></span><span>                              </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcRef a -&gt; a -&gt; IO ()
forall a. IORef a -&gt; a -&gt; IO ()
</span><a href="../../base/src/GHC.IORef.html#writeIORef"><span class="hs-identifier hs-var">writeIORef</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef a
</span><a href="#local-6989586621681081498"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; a
</span><a href="#local-6989586621681081497"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681081496"><span class="hs-identifier hs-var">old</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-674"></span><span>
</span><span id="line-675"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Debugging
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-682"></span><span>
</span><span id="line-683"></span><span class="hs-comment">-- Note [INLINE conditional tracing utilities]</span><span>
</span><span id="line-684"></span><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><span id="line-685"></span><span class="hs-comment">-- In general we want to optimise for the case where tracing is not enabled.</span><span>
</span><span id="line-686"></span><span class="hs-comment">-- To ensure this happens, we ensure that traceTc and friends are inlined; this</span><span>
</span><span id="line-687"></span><span class="hs-comment">-- ensures that the allocation of the document can be pushed into the tracing</span><span>
</span><span id="line-688"></span><span class="hs-comment">-- path, keeping the non-traced path free of this extraneous work. For</span><span>
</span><span id="line-689"></span><span class="hs-comment">-- instance, instead of</span><span>
</span><span id="line-690"></span><span class="hs-comment">--</span><span>
</span><span id="line-691"></span><span class="hs-comment">--     let thunk = ...</span><span>
</span><span id="line-692"></span><span class="hs-comment">--     in if doTracing</span><span>
</span><span id="line-693"></span><span class="hs-comment">--          then emitTraceMsg thunk</span><span>
</span><span id="line-694"></span><span class="hs-comment">--          else return ()</span><span>
</span><span id="line-695"></span><span class="hs-comment">--</span><span>
</span><span id="line-696"></span><span class="hs-comment">-- where the conditional is buried in a non-inlined utility function (e.g.</span><span>
</span><span id="line-697"></span><span class="hs-comment">-- traceTc), we would rather have:</span><span>
</span><span id="line-698"></span><span class="hs-comment">--</span><span>
</span><span id="line-699"></span><span class="hs-comment">--     if doTracing</span><span>
</span><span id="line-700"></span><span class="hs-comment">--       then let thunk = ...</span><span>
</span><span id="line-701"></span><span class="hs-comment">--            in emitTraceMsg thunk</span><span>
</span><span id="line-702"></span><span class="hs-comment">--       else return ()</span><span>
</span><span id="line-703"></span><span class="hs-comment">--</span><span>
</span><span id="line-704"></span><span class="hs-comment">-- See #18168.</span><span>
</span><span id="line-705"></span><span class="hs-comment">--</span><span>
</span><span id="line-706"></span><span>
</span><span id="line-707"></span><span class="hs-comment">-- Typechecker trace</span><span>
</span><span id="line-708"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-type">traceTc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-709"></span><span id="traceTc"><span class="annot"><span class="annottext">traceTc :: FilePath -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var hs-var">traceTc</span></a></span></span><span> </span><span id="local-6989586621681081494"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681081494"><span class="hs-identifier hs-var">herald</span></a></span></span><span> </span><span id="local-6989586621681081493"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081493"><span class="hs-identifier hs-var">doc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-710"></span><span>    </span><span class="annot"><span class="annottext">DumpFlag -&gt; FilePath -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#labelledTraceOptTcRn"><span class="hs-identifier hs-var">labelledTraceOptTcRn</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_tc_trace"><span class="hs-identifier hs-var">Opt_D_dump_tc_trace</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681081494"><span class="hs-identifier hs-var">herald</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081493"><span class="hs-identifier hs-var">doc</span></a></span><span>
</span><span id="line-711"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-pragma hs-type">traceTc</span></a></span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-comment">-- see Note [INLINE conditional tracing utilities]</span><span>
</span><span id="line-712"></span><span>
</span><span id="line-713"></span><span class="hs-comment">-- Renamer Trace</span><span>
</span><span id="line-714"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceRn"><span class="hs-identifier hs-type">traceRn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-715"></span><span id="traceRn"><span class="annot"><span class="annottext">traceRn :: FilePath -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#traceRn"><span class="hs-identifier hs-var hs-var">traceRn</span></a></span></span><span> </span><span id="local-6989586621681081490"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681081490"><span class="hs-identifier hs-var">herald</span></a></span></span><span> </span><span id="local-6989586621681081489"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081489"><span class="hs-identifier hs-var">doc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-716"></span><span>    </span><span class="annot"><span class="annottext">DumpFlag -&gt; FilePath -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#labelledTraceOptTcRn"><span class="hs-identifier hs-var">labelledTraceOptTcRn</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_rn_trace"><span class="hs-identifier hs-var">Opt_D_dump_rn_trace</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681081490"><span class="hs-identifier hs-var">herald</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081489"><span class="hs-identifier hs-var">doc</span></a></span><span>
</span><span id="line-717"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceRn"><span class="hs-pragma hs-type">traceRn</span></a></span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-comment">-- see Note [INLINE conditional tracing utilities]</span><span>
</span><span id="line-718"></span><span>
</span><span id="line-719"></span><span class="hs-comment">-- | Trace when a certain flag is enabled. This is like `traceOptTcRn`</span><span>
</span><span id="line-720"></span><span class="hs-comment">-- but accepts a string as a label and formats the trace message uniformly.</span><span>
</span><span id="line-721"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#labelledTraceOptTcRn"><span class="hs-identifier hs-type">labelledTraceOptTcRn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#DumpFlag"><span class="hs-identifier hs-type">DumpFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-722"></span><span id="labelledTraceOptTcRn"><span class="annot"><span class="annottext">labelledTraceOptTcRn :: DumpFlag -&gt; FilePath -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#labelledTraceOptTcRn"><span class="hs-identifier hs-var hs-var">labelledTraceOptTcRn</span></a></span></span><span> </span><span id="local-6989586621681081487"><span class="annot"><span class="annottext">DumpFlag
</span><a href="#local-6989586621681081487"><span class="hs-identifier hs-var">flag</span></a></span></span><span> </span><span id="local-6989586621681081486"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681081486"><span class="hs-identifier hs-var">herald</span></a></span></span><span> </span><span id="local-6989586621681081485"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081485"><span class="hs-identifier hs-var">doc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-723"></span><span>  </span><span class="annot"><span class="annottext">DumpFlag -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#traceOptTcRn"><span class="hs-identifier hs-var">traceOptTcRn</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="#local-6989586621681081487"><span class="hs-identifier hs-var">flag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Tc.Utils.Monad.html#formatTraceMsg"><span class="hs-identifier hs-var">formatTraceMsg</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681081486"><span class="hs-identifier hs-var">herald</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081485"><span class="hs-identifier hs-var">doc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-724"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#labelledTraceOptTcRn"><span class="hs-pragma hs-type">labelledTraceOptTcRn</span></a></span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-comment">-- see Note [INLINE conditional tracing utilities]</span><span>
</span><span id="line-725"></span><span>
</span><span id="line-726"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#formatTraceMsg"><span class="hs-identifier hs-type">formatTraceMsg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-727"></span><span id="formatTraceMsg"><span class="annot"><span class="annottext">formatTraceMsg :: FilePath -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Tc.Utils.Monad.html#formatTraceMsg"><span class="hs-identifier hs-var hs-var">formatTraceMsg</span></a></span></span><span> </span><span id="local-6989586621681081483"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681081483"><span class="hs-identifier hs-var">herald</span></a></span></span><span> </span><span id="local-6989586621681081482"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081482"><span class="hs-identifier hs-var">doc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681081483"><span class="hs-identifier hs-var">herald</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081482"><span class="hs-identifier hs-var">doc</span></a></span><span>
</span><span id="line-728"></span><span>
</span><span id="line-729"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceOptTcRn"><span class="hs-identifier hs-type">traceOptTcRn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#DumpFlag"><span class="hs-identifier hs-type">DumpFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-730"></span><span id="traceOptTcRn"><span class="annot"><span class="annottext">traceOptTcRn :: DumpFlag -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#traceOptTcRn"><span class="hs-identifier hs-var hs-var">traceOptTcRn</span></a></span></span><span> </span><span id="local-6989586621681081480"><span class="annot"><span class="annottext">DumpFlag
</span><a href="#local-6989586621681081480"><span class="hs-identifier hs-var">flag</span></a></span></span><span> </span><span id="local-6989586621681081479"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081479"><span class="hs-identifier hs-var">doc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-731"></span><span>  </span><span class="annot"><span class="annottext">DumpFlag -&gt; TcM () -&gt; TcM ()
forall gbl lcl. DumpFlag -&gt; TcRnIf gbl lcl () -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#whenDOptM"><span class="hs-identifier hs-var">whenDOptM</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="#local-6989586621681081480"><span class="hs-identifier hs-var">flag</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM () -&gt; TcM ()) -&gt; TcM () -&gt; TcM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-732"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; DumpOptions -&gt; FilePath -&gt; DumpFormat -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#dumpTcRn"><span class="hs-identifier hs-var">dumpTcRn</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DumpFlag -&gt; DumpOptions
</span><a href="GHC.Utils.Error.html#dumpOptionsFromFlag"><span class="hs-identifier hs-var">dumpOptionsFromFlag</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="#local-6989586621681081480"><span class="hs-identifier hs-var">flag</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">DumpFormat
</span><a href="GHC.Utils.Error.html#FormatText"><span class="hs-identifier hs-var">FormatText</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081479"><span class="hs-identifier hs-var">doc</span></a></span><span>
</span><span id="line-733"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceOptTcRn"><span class="hs-pragma hs-type">traceOptTcRn</span></a></span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-comment">-- see Note [INLINE conditional tracing utilities]</span><span>
</span><span id="line-734"></span><span>
</span><span id="line-735"></span><span class="hs-comment">-- | Dump if the given 'DumpFlag' is set.</span><span>
</span><span id="line-736"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#dumpOptTcRn"><span class="hs-identifier hs-type">dumpOptTcRn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#DumpFlag"><span class="hs-identifier hs-type">DumpFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#DumpFormat"><span class="hs-identifier hs-type">DumpFormat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-737"></span><span id="dumpOptTcRn"><span class="annot"><span class="annottext">dumpOptTcRn :: DumpFlag -&gt; FilePath -&gt; DumpFormat -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#dumpOptTcRn"><span class="hs-identifier hs-var hs-var">dumpOptTcRn</span></a></span></span><span> </span><span id="local-6989586621681081476"><span class="annot"><span class="annottext">DumpFlag
</span><a href="#local-6989586621681081476"><span class="hs-identifier hs-var">flag</span></a></span></span><span> </span><span id="local-6989586621681081475"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681081475"><span class="hs-identifier hs-var">title</span></a></span></span><span> </span><span id="local-6989586621681081474"><span class="annot"><span class="annottext">DumpFormat
</span><a href="#local-6989586621681081474"><span class="hs-identifier hs-var">fmt</span></a></span></span><span> </span><span id="local-6989586621681081473"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081473"><span class="hs-identifier hs-var">doc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-738"></span><span>  </span><span class="annot"><span class="annottext">DumpFlag -&gt; TcM () -&gt; TcM ()
forall gbl lcl. DumpFlag -&gt; TcRnIf gbl lcl () -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#whenDOptM"><span class="hs-identifier hs-var">whenDOptM</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="#local-6989586621681081476"><span class="hs-identifier hs-var">flag</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM () -&gt; TcM ()) -&gt; TcM () -&gt; TcM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-739"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; DumpOptions -&gt; FilePath -&gt; DumpFormat -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#dumpTcRn"><span class="hs-identifier hs-var">dumpTcRn</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DumpFlag -&gt; DumpOptions
</span><a href="GHC.Utils.Error.html#dumpOptionsFromFlag"><span class="hs-identifier hs-var">dumpOptionsFromFlag</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="#local-6989586621681081476"><span class="hs-identifier hs-var">flag</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681081475"><span class="hs-identifier hs-var">title</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFormat
</span><a href="#local-6989586621681081474"><span class="hs-identifier hs-var">fmt</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081473"><span class="hs-identifier hs-var">doc</span></a></span><span>
</span><span id="line-740"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#dumpOptTcRn"><span class="hs-pragma hs-type">dumpOptTcRn</span></a></span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-comment">-- see Note [INLINE conditional tracing utilities]</span><span>
</span><span id="line-741"></span><span>
</span><span id="line-742"></span><span class="hs-comment">-- | Unconditionally dump some trace output</span><span>
</span><span id="line-743"></span><span class="hs-comment">--</span><span>
</span><span id="line-744"></span><span class="hs-comment">-- Certain tests (T3017, Roles3, T12763 etc.) expect part of the</span><span>
</span><span id="line-745"></span><span class="hs-comment">-- output generated by `-ddump-types` to be in 'PprUser' style. However,</span><span>
</span><span id="line-746"></span><span class="hs-comment">-- generally we want all other debugging output to use 'PprDump'</span><span>
</span><span id="line-747"></span><span class="hs-comment">-- style. We 'PprUser' style if 'useUserStyle' is True.</span><span>
</span><span id="line-748"></span><span class="hs-comment">--</span><span>
</span><span id="line-749"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#dumpTcRn"><span class="hs-identifier hs-type">dumpTcRn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#DumpOptions"><span class="hs-identifier hs-type">DumpOptions</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#DumpFormat"><span class="hs-identifier hs-type">DumpFormat</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-750"></span><span id="dumpTcRn"><span class="annot"><span class="annottext">dumpTcRn :: Bool -&gt; DumpOptions -&gt; FilePath -&gt; DumpFormat -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#dumpTcRn"><span class="hs-identifier hs-var hs-var">dumpTcRn</span></a></span></span><span> </span><span id="local-6989586621681081472"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681081472"><span class="hs-identifier hs-var">useUserStyle</span></a></span></span><span> </span><span id="local-6989586621681081471"><span class="annot"><span class="annottext">DumpOptions
</span><a href="#local-6989586621681081471"><span class="hs-identifier hs-var">dumpOpt</span></a></span></span><span> </span><span id="local-6989586621681081470"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681081470"><span class="hs-identifier hs-var">title</span></a></span></span><span> </span><span id="local-6989586621681081469"><span class="annot"><span class="annottext">DumpFormat
</span><a href="#local-6989586621681081469"><span class="hs-identifier hs-var">fmt</span></a></span></span><span> </span><span id="local-6989586621681081468"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081468"><span class="hs-identifier hs-var">doc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-751"></span><span>  </span><span id="local-6989586621681081467"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681081467"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-752"></span><span>  </span><span id="local-6989586621681081466"><span class="annot"><span class="annottext">PrintUnqualified
</span><a href="#local-6989586621681081466"><span class="hs-identifier hs-var">printer</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; TcRn PrintUnqualified
</span><a href="GHC.Tc.Utils.Monad.html#getPrintUnqualified"><span class="hs-identifier hs-var">getPrintUnqualified</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681081467"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-753"></span><span>  </span><span id="local-6989586621681081465"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081465"><span class="hs-identifier hs-var">real_doc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcRn SDoc
</span><a href="GHC.Tc.Utils.Monad.html#wrapDocLoc"><span class="hs-identifier hs-var">wrapDocLoc</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081468"><span class="hs-identifier hs-var">doc</span></a></span><span>
</span><span id="line-754"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681081463"><span class="annot"><span class="annottext">sty :: PprStyle
</span><a href="#local-6989586621681081463"><span class="hs-identifier hs-var hs-var">sty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681081472"><span class="hs-identifier hs-var">useUserStyle</span></a></span><span>
</span><span id="line-755"></span><span>              </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">PrintUnqualified -&gt; Depth -&gt; PprStyle
</span><a href="GHC.Utils.Outputable.html#mkUserStyle"><span class="hs-identifier hs-var">mkUserStyle</span></a></span><span> </span><span class="annot"><span class="annottext">PrintUnqualified
</span><a href="#local-6989586621681081466"><span class="hs-identifier hs-var">printer</span></a></span><span> </span><span class="annot"><span class="annottext">Depth
</span><a href="GHC.Utils.Outputable.html#AllTheWay"><span class="hs-identifier hs-var">AllTheWay</span></a></span><span>
</span><span id="line-756"></span><span>              </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">PrintUnqualified -&gt; PprStyle
</span><a href="GHC.Utils.Outputable.html#mkDumpStyle"><span class="hs-identifier hs-var">mkDumpStyle</span></a></span><span> </span><span class="annot"><span class="annottext">PrintUnqualified
</span><a href="#local-6989586621681081466"><span class="hs-identifier hs-var">printer</span></a></span><span>
</span><span id="line-757"></span><span>  </span><span class="annot"><span class="annottext">IO () -&gt; TcM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; TcM ()) -&gt; IO () -&gt; TcM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DumpAction
</span><a href="GHC.Utils.Error.html#dumpAction"><span class="hs-identifier hs-var">dumpAction</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681081467"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">PprStyle
</span><a href="#local-6989586621681081463"><span class="hs-identifier hs-var">sty</span></a></span><span> </span><span class="annot"><span class="annottext">DumpOptions
</span><a href="#local-6989586621681081471"><span class="hs-identifier hs-var">dumpOpt</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681081470"><span class="hs-identifier hs-var">title</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFormat
</span><a href="#local-6989586621681081469"><span class="hs-identifier hs-var">fmt</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081465"><span class="hs-identifier hs-var">real_doc</span></a></span><span>
</span><span id="line-758"></span><span>
</span><span id="line-759"></span><span class="hs-comment">-- | Add current location if -dppr-debug</span><span>
</span><span id="line-760"></span><span class="hs-comment">-- (otherwise the full location is usually way too much)</span><span>
</span><span id="line-761"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#wrapDocLoc"><span class="hs-identifier hs-type">wrapDocLoc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-762"></span><span id="wrapDocLoc"><span class="annot"><span class="annottext">wrapDocLoc :: SDoc -&gt; TcRn SDoc
</span><a href="GHC.Tc.Utils.Monad.html#wrapDocLoc"><span class="hs-identifier hs-var hs-var">wrapDocLoc</span></a></span></span><span> </span><span id="local-6989586621681081458"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081458"><span class="hs-identifier hs-var">doc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-763"></span><span>  </span><span id="local-6989586621681081457"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681081457"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-764"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#hasPprDebug"><span class="hs-identifier hs-var">hasPprDebug</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681081457"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-765"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-766"></span><span>      </span><span id="local-6989586621681081455"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681081455"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn SrcSpan
</span><a href="GHC.Tc.Utils.Monad.html#getSrcSpanM"><span class="hs-identifier hs-var">getSrcSpanM</span></a></span><span>
</span><span id="line-767"></span><span>      </span><span class="annot"><span class="annottext">SDoc -&gt; TcRn SDoc
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Severity -&gt; SrcSpan -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Error.html#mkLocMessage"><span class="hs-identifier hs-var">mkLocMessage</span></a></span><span> </span><span class="annot"><span class="annottext">Severity
</span><a href="GHC.Utils.Error.html#SevOutput"><span class="hs-identifier hs-var">SevOutput</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681081455"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081458"><span class="hs-identifier hs-var">doc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-768"></span><span>    </span><span class="hs-keyword">else</span><span>
</span><span id="line-769"></span><span>      </span><span class="annot"><span class="annottext">SDoc -&gt; TcRn SDoc
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081458"><span class="hs-identifier hs-var">doc</span></a></span><span>
</span><span id="line-770"></span><span>
</span><span id="line-771"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getPrintUnqualified"><span class="hs-identifier hs-type">getPrintUnqualified</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#PrintUnqualified"><span class="hs-identifier hs-type">PrintUnqualified</span></a></span><span>
</span><span id="line-772"></span><span id="getPrintUnqualified"><span class="annot"><span class="annottext">getPrintUnqualified :: DynFlags -&gt; TcRn PrintUnqualified
</span><a href="GHC.Tc.Utils.Monad.html#getPrintUnqualified"><span class="hs-identifier hs-var hs-var">getPrintUnqualified</span></a></span></span><span> </span><span id="local-6989586621681081452"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681081452"><span class="hs-identifier hs-var">dflags</span></a></span></span><span>
</span><span id="line-773"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081451"><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621681081451"><span class="hs-identifier hs-var">rdr_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn GlobalRdrEnv
</span><a href="GHC.Tc.Utils.Monad.html#getGlobalRdrEnv"><span class="hs-identifier hs-var">getGlobalRdrEnv</span></a></span><span>
</span><span id="line-774"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">PrintUnqualified -&gt; TcRn PrintUnqualified
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(PrintUnqualified -&gt; TcRn PrintUnqualified)
-&gt; PrintUnqualified -&gt; TcRn PrintUnqualified
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; GlobalRdrEnv -&gt; PrintUnqualified
</span><a href="GHC.Driver.Types.html#mkPrintUnqualified"><span class="hs-identifier hs-var">mkPrintUnqualified</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681081452"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621681081451"><span class="hs-identifier hs-var">rdr_env</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-775"></span><span>
</span><span id="line-776"></span><span class="hs-comment">-- | Like logInfoTcRn, but for user consumption</span><span>
</span><span id="line-777"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#printForUserTcRn"><span class="hs-identifier hs-type">printForUserTcRn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-778"></span><span id="printForUserTcRn"><span class="annot"><span class="annottext">printForUserTcRn :: SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#printForUserTcRn"><span class="hs-identifier hs-var hs-var">printForUserTcRn</span></a></span></span><span> </span><span id="local-6989586621681081449"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081449"><span class="hs-identifier hs-var">doc</span></a></span></span><span>
</span><span id="line-779"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081448"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681081448"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-780"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681081447"><span class="annot"><span class="annottext">PrintUnqualified
</span><a href="#local-6989586621681081447"><span class="hs-identifier hs-var">printer</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; TcRn PrintUnqualified
</span><a href="GHC.Tc.Utils.Monad.html#getPrintUnqualified"><span class="hs-identifier hs-var">getPrintUnqualified</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681081448"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-781"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; TcM ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; PrintUnqualified -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#printOutputForUser"><span class="hs-identifier hs-var">printOutputForUser</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681081448"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">PrintUnqualified
</span><a href="#local-6989586621681081447"><span class="hs-identifier hs-var">printer</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081449"><span class="hs-identifier hs-var">doc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-782"></span><span>
</span><span id="line-783"></span><span class="hs-comment">{-
traceIf and traceHiDiffs work in the TcRnIf monad, where no RdrEnv is
available.  Alas, they behave inconsistently with the other stuff;
e.g. are unaffected by -dump-to-file.
-}</span><span>
</span><span id="line-788"></span><span>
</span><span id="line-789"></span><span id="local-6989586621681082691"><span id="local-6989586621681082692"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceIf"><span class="hs-identifier hs-type">traceIf</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceHiDiffs"><span class="hs-identifier hs-type">traceHiDiffs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082692"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082691"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-790"></span><span id="traceIf"><span class="annot"><span class="annottext">traceIf :: forall m n. SDoc -&gt; TcRnIf m n ()
</span><a href="GHC.Tc.Utils.Monad.html#traceIf"><span class="hs-identifier hs-var hs-var">traceIf</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DumpFlag -&gt; SDoc -&gt; TcRnIf m n ()
forall m n. DumpFlag -&gt; SDoc -&gt; TcRnIf m n ()
</span><a href="GHC.Tc.Utils.Monad.html#traceOptIf"><span class="hs-identifier hs-var">traceOptIf</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_if_trace"><span class="hs-identifier hs-var">Opt_D_dump_if_trace</span></a></span><span>
</span><span id="line-791"></span><span id="traceHiDiffs"><span class="annot"><span class="annottext">traceHiDiffs :: forall m n. SDoc -&gt; TcRnIf m n ()
</span><a href="GHC.Tc.Utils.Monad.html#traceHiDiffs"><span class="hs-identifier hs-var hs-var">traceHiDiffs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DumpFlag -&gt; SDoc -&gt; TcRnIf m n ()
forall m n. DumpFlag -&gt; SDoc -&gt; TcRnIf m n ()
</span><a href="GHC.Tc.Utils.Monad.html#traceOptIf"><span class="hs-identifier hs-var">traceOptIf</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_hi_diffs"><span class="hs-identifier hs-var">Opt_D_dump_hi_diffs</span></a></span><span>
</span><span id="line-792"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceIf"><span class="hs-pragma hs-type">traceIf</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-793"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceHiDiffs"><span class="hs-pragma hs-type">traceHiDiffs</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-794"></span><span>  </span><span class="hs-comment">-- see Note [INLINE conditional tracing utilities]</span><span>
</span><span id="line-795"></span><span>
</span><span id="line-796"></span><span id="local-6989586621681082590"><span id="local-6989586621681082591"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceOptIf"><span class="hs-identifier hs-type">traceOptIf</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#DumpFlag"><span class="hs-identifier hs-type">DumpFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082591"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082590"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span></span><span>
</span><span id="line-797"></span><span id="traceOptIf"><span class="annot"><span class="annottext">traceOptIf :: forall m n. DumpFlag -&gt; SDoc -&gt; TcRnIf m n ()
</span><a href="GHC.Tc.Utils.Monad.html#traceOptIf"><span class="hs-identifier hs-var hs-var">traceOptIf</span></a></span></span><span> </span><span id="local-6989586621681081439"><span class="annot"><span class="annottext">DumpFlag
</span><a href="#local-6989586621681081439"><span class="hs-identifier hs-var">flag</span></a></span></span><span> </span><span id="local-6989586621681081438"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081438"><span class="hs-identifier hs-var">doc</span></a></span></span><span>
</span><span id="line-798"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DumpFlag -&gt; TcRnIf m n () -&gt; TcRnIf m n ()
forall gbl lcl. DumpFlag -&gt; TcRnIf gbl lcl () -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#whenDOptM"><span class="hs-identifier hs-var">whenDOptM</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="#local-6989586621681081439"><span class="hs-identifier hs-var">flag</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRnIf m n () -&gt; TcRnIf m n ()) -&gt; TcRnIf m n () -&gt; TcRnIf m n ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>    </span><span class="hs-comment">-- No RdrEnv available, so qualify everything</span><span>
</span><span id="line-799"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081437"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681081437"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env m n) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-800"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; TcRnIf m n ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#putMsg"><span class="hs-identifier hs-var">putMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681081437"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081438"><span class="hs-identifier hs-var">doc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-801"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceOptIf"><span class="hs-pragma hs-type">traceOptIf</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>  </span><span class="hs-comment">-- see Note [INLINE conditional tracing utilities]</span><span>
</span><span id="line-802"></span><span>
</span><span id="line-803"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Typechecker global environment
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-810"></span><span>
</span><span id="line-811"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getIsGHCi"><span class="hs-identifier hs-type">getIsGHCi</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-812"></span><span id="getIsGHCi"><span class="annot"><span class="annottext">getIsGHCi :: TcRn Bool
</span><a href="GHC.Tc.Utils.Monad.html#getIsGHCi"><span class="hs-identifier hs-var hs-var">getIsGHCi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081435"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681081435"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) Module
forall (m :: * -&gt; *). HasModule m =&gt; m Module
</span><a href="GHC.Unit.Module.html#getModule"><span class="hs-identifier hs-var">getModule</span></a></span><span>
</span><span id="line-813"></span><span>               </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRn Bool
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; Bool
</span><a href="GHC.Unit.Types.html#isInteractiveModule"><span class="hs-identifier hs-var">isInteractiveModule</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681081435"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-814"></span><span>
</span><span id="line-815"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getGHCiMonad"><span class="hs-identifier hs-type">getGHCiMonad</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-816"></span><span id="getGHCiMonad"><span class="annot"><span class="annottext">getGHCiMonad :: TcM Name
</span><a href="GHC.Tc.Utils.Monad.html#getGHCiMonad"><span class="hs-identifier hs-var hs-var">getGHCiMonad</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081432"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681081432"><span class="hs-identifier hs-var">hsc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv HscEnv
forall gbl lcl. TcRnIf gbl lcl HscEnv
</span><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-var">getTopEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Name
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InteractiveContext -&gt; Name
</span><a href="GHC.Driver.Types.html#ic_monad"><span class="hs-identifier hs-var hs-var">ic_monad</span></a></span><span> </span><span class="annot"><span class="annottext">(InteractiveContext -&gt; Name) -&gt; InteractiveContext -&gt; Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; InteractiveContext
</span><a href="GHC.Driver.Types.html#hsc_IC"><span class="hs-identifier hs-var hs-var">hsc_IC</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681081432"><span class="hs-identifier hs-var">hsc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-817"></span><span>
</span><span id="line-818"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getInteractivePrintName"><span class="hs-identifier hs-type">getInteractivePrintName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-819"></span><span id="getInteractivePrintName"><span class="annot"><span class="annottext">getInteractivePrintName :: TcM Name
</span><a href="GHC.Tc.Utils.Monad.html#getInteractivePrintName"><span class="hs-identifier hs-var hs-var">getInteractivePrintName</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081430"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681081430"><span class="hs-identifier hs-var">hsc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv HscEnv
forall gbl lcl. TcRnIf gbl lcl HscEnv
</span><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-var">getTopEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Name
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InteractiveContext -&gt; Name
</span><a href="GHC.Driver.Types.html#ic_int_print"><span class="hs-identifier hs-var hs-var">ic_int_print</span></a></span><span> </span><span class="annot"><span class="annottext">(InteractiveContext -&gt; Name) -&gt; InteractiveContext -&gt; Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; InteractiveContext
</span><a href="GHC.Driver.Types.html#hsc_IC"><span class="hs-identifier hs-var hs-var">hsc_IC</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681081430"><span class="hs-identifier hs-var">hsc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-820"></span><span>
</span><span id="line-821"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#tcIsHsBootOrSig"><span class="hs-identifier hs-type">tcIsHsBootOrSig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-822"></span><span id="tcIsHsBootOrSig"><span class="annot"><span class="annottext">tcIsHsBootOrSig :: TcRn Bool
</span><a href="GHC.Tc.Utils.Monad.html#tcIsHsBootOrSig"><span class="hs-identifier hs-var hs-var">tcIsHsBootOrSig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081428"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681081428"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRn Bool
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscSource -&gt; Bool
</span><a href="GHC.Driver.Phases.html#isHsBootOrSig"><span class="hs-identifier hs-var">isHsBootOrSig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; HscSource
</span><a href="GHC.Tc.Types.html#tcg_src"><span class="hs-identifier hs-var hs-var">tcg_src</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681081428"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-823"></span><span>
</span><span id="line-824"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#tcIsHsig"><span class="hs-identifier hs-type">tcIsHsig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-825"></span><span id="tcIsHsig"><span class="annot"><span class="annottext">tcIsHsig :: TcRn Bool
</span><a href="GHC.Tc.Utils.Monad.html#tcIsHsig"><span class="hs-identifier hs-var hs-var">tcIsHsig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081426"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681081426"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRn Bool
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscSource -&gt; Bool
</span><a href="GHC.Driver.Phases.html#isHsigFile"><span class="hs-identifier hs-var">isHsigFile</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; HscSource
</span><a href="GHC.Tc.Types.html#tcg_src"><span class="hs-identifier hs-var hs-var">tcg_src</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681081426"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-826"></span><span>
</span><span id="line-827"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#tcSelfBootInfo"><span class="hs-identifier hs-type">tcSelfBootInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#SelfBootInfo"><span class="hs-identifier hs-type">SelfBootInfo</span></a></span><span>
</span><span id="line-828"></span><span id="tcSelfBootInfo"><span class="annot"><span class="annottext">tcSelfBootInfo :: TcRn SelfBootInfo
</span><a href="GHC.Tc.Utils.Monad.html#tcSelfBootInfo"><span class="hs-identifier hs-var hs-var">tcSelfBootInfo</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081424"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681081424"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">SelfBootInfo -&gt; TcRn SelfBootInfo
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; SelfBootInfo
</span><a href="GHC.Tc.Types.html#tcg_self_boot"><span class="hs-identifier hs-var hs-var">tcg_self_boot</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681081424"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-829"></span><span>
</span><span id="line-830"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getGlobalRdrEnv"><span class="hs-identifier hs-type">getGlobalRdrEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a></span><span>
</span><span id="line-831"></span><span id="getGlobalRdrEnv"><span class="annot"><span class="annottext">getGlobalRdrEnv :: TcRn GlobalRdrEnv
</span><a href="GHC.Tc.Utils.Monad.html#getGlobalRdrEnv"><span class="hs-identifier hs-var hs-var">getGlobalRdrEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081423"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681081423"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv -&gt; TcRn GlobalRdrEnv
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; GlobalRdrEnv
</span><a href="GHC.Tc.Types.html#tcg_rdr_env"><span class="hs-identifier hs-var hs-var">tcg_rdr_env</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681081423"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-832"></span><span>
</span><span id="line-833"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getRdrEnvs"><span class="hs-identifier hs-type">getRdrEnvs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#LocalRdrEnv"><span class="hs-identifier hs-type">LocalRdrEnv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-834"></span><span id="getRdrEnvs"><span class="annot"><span class="annottext">getRdrEnvs :: TcRn (GlobalRdrEnv, LocalRdrEnv)
</span><a href="GHC.Tc.Utils.Monad.html#getRdrEnvs"><span class="hs-identifier hs-var hs-var">getRdrEnvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681081422"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681081422"><span class="hs-identifier hs-var">gbl</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681081421"><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681081421"><span class="hs-identifier hs-var">lcl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv (TcGblEnv, TcLclEnv)
forall gbl lcl. TcRnIf gbl lcl (gbl, lcl)
</span><a href="GHC.Tc.Utils.Monad.html#getEnvs"><span class="hs-identifier hs-var">getEnvs</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(GlobalRdrEnv, LocalRdrEnv) -&gt; TcRn (GlobalRdrEnv, LocalRdrEnv)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; GlobalRdrEnv
</span><a href="GHC.Tc.Types.html#tcg_rdr_env"><span class="hs-identifier hs-var hs-var">tcg_rdr_env</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681081422"><span class="hs-identifier hs-var">gbl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcLclEnv -&gt; LocalRdrEnv
</span><a href="GHC.Tc.Types.html#tcl_rdr"><span class="hs-identifier hs-var hs-var">tcl_rdr</span></a></span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681081421"><span class="hs-identifier hs-var">lcl</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-835"></span><span>
</span><span id="line-836"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getImports"><span class="hs-identifier hs-type">getImports</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#ImportAvails"><span class="hs-identifier hs-type">ImportAvails</span></a></span><span>
</span><span id="line-837"></span><span id="getImports"><span class="annot"><span class="annottext">getImports :: TcRn ImportAvails
</span><a href="GHC.Tc.Utils.Monad.html#getImports"><span class="hs-identifier hs-var hs-var">getImports</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081420"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681081420"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">ImportAvails -&gt; TcRn ImportAvails
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; ImportAvails
</span><a href="GHC.Tc.Types.html#tcg_imports"><span class="hs-identifier hs-var hs-var">tcg_imports</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681081420"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-838"></span><span>
</span><span id="line-839"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getFixityEnv"><span class="hs-identifier hs-type">getFixityEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#FixityEnv"><span class="hs-identifier hs-type">FixityEnv</span></a></span><span>
</span><span id="line-840"></span><span id="getFixityEnv"><span class="annot"><span class="annottext">getFixityEnv :: TcRn FixityEnv
</span><a href="GHC.Tc.Utils.Monad.html#getFixityEnv"><span class="hs-identifier hs-var hs-var">getFixityEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081419"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681081419"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">FixityEnv -&gt; TcRn FixityEnv
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; FixityEnv
</span><a href="GHC.Tc.Types.html#tcg_fix_env"><span class="hs-identifier hs-var hs-var">tcg_fix_env</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681081419"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-841"></span><span>
</span><span id="line-842"></span><span id="local-6989586621681082583"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#extendFixityEnv"><span class="hs-identifier hs-type">extendFixityEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Driver.Types.html#FixItem"><span class="hs-identifier hs-type">FixItem</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082583"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082583"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-843"></span><span id="extendFixityEnv"><span class="annot"><span class="annottext">extendFixityEnv :: forall a. [(Name, FixItem)] -&gt; RnM a -&gt; RnM a
</span><a href="GHC.Tc.Utils.Monad.html#extendFixityEnv"><span class="hs-identifier hs-var hs-var">extendFixityEnv</span></a></span></span><span> </span><span id="local-6989586621681081418"><span class="annot"><span class="annottext">[(Name, FixItem)]
</span><a href="#local-6989586621681081418"><span class="hs-identifier hs-var">new_bit</span></a></span></span><span>
</span><span id="line-844"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcGblEnv -&gt; TcGblEnv)
-&gt; TcRnIf TcGblEnv TcLclEnv a -&gt; TcRnIf TcGblEnv TcLclEnv a
forall gbl lcl a.
(gbl -&gt; gbl) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updGblEnv"><span class="hs-identifier hs-var">updGblEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681081417"><span class="annot"><span class="annottext">env :: TcGblEnv
</span><a href="#local-6989586621681081417"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcg_fix_env :: TcGblEnv -&gt; FixityEnv
</span><a href="GHC.Tc.Types.html#tcg_fix_env"><span class="hs-identifier hs-var">tcg_fix_env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681081416"><span class="annot"><span class="annottext">FixityEnv
</span><a href="#local-6989586621681081416"><span class="hs-identifier hs-var">old_fix_env</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-845"></span><span>                </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681081417"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">tcg_fix_env :: FixityEnv
</span><a href="GHC.Tc.Types.html#tcg_fix_env"><span class="hs-identifier hs-var">tcg_fix_env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FixityEnv -&gt; [(Name, FixItem)] -&gt; FixityEnv
forall a. NameEnv a -&gt; [(Name, a)] -&gt; NameEnv a
</span><a href="GHC.Types.Name.Env.html#extendNameEnvList"><span class="hs-identifier hs-var">extendNameEnvList</span></a></span><span> </span><span class="annot"><span class="annottext">FixityEnv
</span><a href="#local-6989586621681081416"><span class="hs-identifier hs-var">old_fix_env</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, FixItem)]
</span><a href="#local-6989586621681081418"><span class="hs-identifier hs-var">new_bit</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-846"></span><span>
</span><span id="line-847"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getRecFieldEnv"><span class="hs-identifier hs-type">getRecFieldEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RecFieldEnv"><span class="hs-identifier hs-type">RecFieldEnv</span></a></span><span>
</span><span id="line-848"></span><span id="getRecFieldEnv"><span class="annot"><span class="annottext">getRecFieldEnv :: TcRn RecFieldEnv
</span><a href="GHC.Tc.Utils.Monad.html#getRecFieldEnv"><span class="hs-identifier hs-var hs-var">getRecFieldEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081414"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681081414"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">RecFieldEnv -&gt; TcRn RecFieldEnv
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; RecFieldEnv
</span><a href="GHC.Tc.Types.html#tcg_field_env"><span class="hs-identifier hs-var hs-var">tcg_field_env</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681081414"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-849"></span><span>
</span><span id="line-850"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getDeclaredDefaultTys"><span class="hs-identifier hs-type">getDeclaredDefaultTys</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-851"></span><span id="getDeclaredDefaultTys"><span class="annot"><span class="annottext">getDeclaredDefaultTys :: TcRn (Maybe [Type])
</span><a href="GHC.Tc.Utils.Monad.html#getDeclaredDefaultTys"><span class="hs-identifier hs-var hs-var">getDeclaredDefaultTys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081413"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681081413"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Maybe [Type] -&gt; TcRn (Maybe [Type])
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; Maybe [Type]
</span><a href="GHC.Tc.Types.html#tcg_default"><span class="hs-identifier hs-var hs-var">tcg_default</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681081413"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-852"></span><span>
</span><span id="line-853"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addDependentFiles"><span class="hs-identifier hs-type">addDependentFiles</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../base/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-854"></span><span id="addDependentFiles"><span class="annot"><span class="annottext">addDependentFiles :: [FilePath] -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addDependentFiles"><span class="hs-identifier hs-var hs-var">addDependentFiles</span></a></span></span><span> </span><span id="local-6989586621681081412"><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621681081412"><span class="hs-identifier hs-var">fs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-855"></span><span>  </span><span id="local-6989586621681081411"><span class="annot"><span class="annottext">IORef [FilePath]
</span><a href="#local-6989586621681081411"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TcGblEnv -&gt; IORef [FilePath])
-&gt; TcRnIf TcGblEnv TcLclEnv TcGblEnv
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (IORef [FilePath])
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; IORef [FilePath]
</span><a href="GHC.Tc.Types.html#tcg_dependent_files"><span class="hs-identifier hs-var hs-var">tcg_dependent_files</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-856"></span><span>  </span><span id="local-6989586621681081410"><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621681081410"><span class="hs-identifier hs-var">dep_files</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef [FilePath] -&gt; TcRnIf TcGblEnv TcLclEnv [FilePath]
forall a gbl lcl. TcRef a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef [FilePath]
</span><a href="#local-6989586621681081411"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-857"></span><span>  </span><span class="annot"><span class="annottext">IORef [FilePath] -&gt; [FilePath] -&gt; TcM ()
forall a gbl lcl. TcRef a -&gt; a -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#writeTcRef"><span class="hs-identifier hs-var">writeTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef [FilePath]
</span><a href="#local-6989586621681081411"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621681081412"><span class="hs-identifier hs-var">fs</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath] -&gt; [FilePath] -&gt; [FilePath]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621681081410"><span class="hs-identifier hs-var">dep_files</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-858"></span><span>
</span><span id="line-859"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Error management
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-866"></span><span>
</span><span id="line-867"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getSrcSpanM"><span class="hs-identifier hs-type">getSrcSpanM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span>
</span><span id="line-868"></span><span>        </span><span class="hs-comment">-- Avoid clash with Name.getSrcLoc</span><span>
</span><span id="line-869"></span><span id="getSrcSpanM"><span class="annot"><span class="annottext">getSrcSpanM :: TcRn SrcSpan
</span><a href="GHC.Tc.Utils.Monad.html#getSrcSpanM"><span class="hs-identifier hs-var hs-var">getSrcSpanM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081409"><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681081409"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcLclEnv
forall gbl lcl. TcRnIf gbl lcl lcl
</span><a href="GHC.Tc.Utils.Monad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcRn SrcSpan
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RealSrcSpan -&gt; Maybe BufSpan -&gt; SrcSpan
</span><a href="GHC.Types.SrcLoc.html#RealSrcSpan"><span class="hs-identifier hs-var">RealSrcSpan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcLclEnv -&gt; RealSrcSpan
</span><a href="GHC.Tc.Types.html#tcl_loc"><span class="hs-identifier hs-var hs-var">tcl_loc</span></a></span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681081409"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe BufSpan
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-870"></span><span>
</span><span id="line-871"></span><span class="hs-comment">-- See Note [Rebindable syntax and HsExpansion].</span><span>
</span><span id="line-872"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#inGeneratedCode"><span class="hs-identifier hs-type">inGeneratedCode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-873"></span><span id="inGeneratedCode"><span class="annot"><span class="annottext">inGeneratedCode :: TcRn Bool
</span><a href="GHC.Tc.Utils.Monad.html#inGeneratedCode"><span class="hs-identifier hs-var hs-var">inGeneratedCode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLclEnv -&gt; Bool
</span><a href="GHC.Tc.Types.html#tcl_in_gen_code"><span class="hs-identifier hs-var hs-var">tcl_in_gen_code</span></a></span><span> </span><span class="annot"><span class="annottext">(TcLclEnv -&gt; Bool)
-&gt; TcRnIf TcGblEnv TcLclEnv TcLclEnv -&gt; TcRn Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcLclEnv
forall gbl lcl. TcRnIf gbl lcl lcl
</span><a href="GHC.Tc.Utils.Monad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a></span><span>
</span><span id="line-874"></span><span>
</span><span id="line-875"></span><span id="local-6989586621681082571"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-type">setSrcSpan</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082571"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082571"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-876"></span><span id="setSrcSpan"><span class="annot"><span class="annottext">setSrcSpan :: forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var hs-var">setSrcSpan</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#RealSrcSpan"><span class="hs-identifier hs-type">RealSrcSpan</span></a></span><span> </span><span id="local-6989586621681081406"><span class="annot"><span class="annottext">RealSrcSpan
</span><a href="#local-6989586621681081406"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe BufSpan
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681081405"><span class="annot"><span class="annottext">TcRn a
</span><a href="#local-6989586621681081405"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-877"></span><span>  </span><span class="annot"><span class="annottext">(TcLclEnv -&gt; TcLclEnv) -&gt; TcRn a -&gt; TcRn a
forall lcl gbl a.
(lcl -&gt; lcl) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updLclEnv"><span class="hs-identifier hs-var">updLclEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681081404"><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681081404"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681081404"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcl_loc :: RealSrcSpan
</span><a href="GHC.Tc.Types.html#tcl_loc"><span class="hs-identifier hs-var">tcl_loc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RealSrcSpan
</span><a href="#local-6989586621681081406"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcl_in_gen_code :: Bool
</span><a href="GHC.Tc.Types.html#tcl_in_gen_code"><span class="hs-identifier hs-var">tcl_in_gen_code</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-878"></span><span>            </span><span class="annot"><span class="annottext">TcRn a
</span><a href="#local-6989586621681081405"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-879"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span id="local-6989586621681081403"><span class="annot"><span class="annottext">loc :: SrcSpan
</span><a href="#local-6989586621681081403"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#UnhelpfulSpan"><span class="hs-identifier hs-type">UnhelpfulSpan</span></a></span><span> </span><span class="annot"><span class="annottext">UnhelpfulSpanReason
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681081401"><span class="annot"><span class="annottext">TcRn a
</span><a href="#local-6989586621681081401"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-880"></span><span>  </span><span class="hs-comment">-- See Note [Rebindable syntax and HsExpansion].</span><span>
</span><span id="line-881"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; Bool
</span><a href="GHC.Types.SrcLoc.html#isGeneratedSrcSpan"><span class="hs-identifier hs-var">isGeneratedSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681081403"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-882"></span><span>      </span><span class="annot"><span class="annottext">(TcLclEnv -&gt; TcLclEnv) -&gt; TcRn a -&gt; TcRn a
forall lcl gbl a.
(lcl -&gt; lcl) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updLclEnv"><span class="hs-identifier hs-var">updLclEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681081399"><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681081399"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681081399"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcl_in_gen_code :: Bool
</span><a href="GHC.Tc.Types.html#tcl_in_gen_code"><span class="hs-identifier hs-var">tcl_in_gen_code</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcRn a
</span><a href="#local-6989586621681081401"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-883"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRn a
</span><a href="#local-6989586621681081401"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-884"></span><span>
</span><span id="line-885"></span><span id="local-6989586621681082567"><span id="local-6989586621681082568"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addLocM"><span class="hs-identifier hs-type">addLocM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681082568"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082567"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082568"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082567"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-886"></span><span id="addLocM"><span class="annot"><span class="annottext">addLocM :: forall a b. (a -&gt; TcM b) -&gt; Located a -&gt; TcM b
</span><a href="GHC.Tc.Utils.Monad.html#addLocM"><span class="hs-identifier hs-var hs-var">addLocM</span></a></span></span><span> </span><span id="local-6989586621681081398"><span class="annot"><span class="annottext">a -&gt; TcM b
</span><a href="#local-6989586621681081398"><span class="hs-identifier hs-var">fn</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681081396"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681081396"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681081395"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681081395"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcM b -&gt; TcM b
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681081396"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM b -&gt; TcM b) -&gt; TcM b -&gt; TcM b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; TcM b
</span><a href="#local-6989586621681081398"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681081395"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-887"></span><span>
</span><span id="line-888"></span><span id="local-6989586621681082562"><span id="local-6989586621681082563"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#wrapLocM"><span class="hs-identifier hs-type">wrapLocM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681082563"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082562"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082563"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082562"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span></span><span>
</span><span id="line-889"></span><span id="wrapLocM"><span class="annot"><span class="annottext">wrapLocM :: forall a b. (a -&gt; TcM b) -&gt; Located a -&gt; TcM (Located b)
</span><a href="GHC.Tc.Utils.Monad.html#wrapLocM"><span class="hs-identifier hs-var hs-var">wrapLocM</span></a></span></span><span> </span><span id="local-6989586621681081392"><span class="annot"><span class="annottext">a -&gt; TcM b
</span><a href="#local-6989586621681081392"><span class="hs-identifier hs-var">fn</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681081391"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681081391"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681081390"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681081390"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan
-&gt; TcRn (GenLocated SrcSpan b) -&gt; TcRn (GenLocated SrcSpan b)
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681081391"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn (GenLocated SrcSpan b) -&gt; TcRn (GenLocated SrcSpan b))
-&gt; TcRn (GenLocated SrcSpan b) -&gt; TcRn (GenLocated SrcSpan b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081389"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621681081389"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">a -&gt; TcM b
</span><a href="#local-6989586621681081392"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681081390"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-890"></span><span>                                            </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpan b -&gt; TcRn (GenLocated SrcSpan b)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; b -&gt; GenLocated SrcSpan b
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681081391"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621681081389"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-891"></span><span>
</span><span id="line-892"></span><span id="local-6989586621681082555"><span id="local-6989586621681082556"><span id="local-6989586621681082557"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#wrapLocFstM"><span class="hs-identifier hs-type">wrapLocFstM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681082557"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681082556"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621681082555"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082557"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082556"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621681082555"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-893"></span><span id="wrapLocFstM"><span class="annot"><span class="annottext">wrapLocFstM :: forall a b c. (a -&gt; TcM (b, c)) -&gt; Located a -&gt; TcM (Located b, c)
</span><a href="GHC.Tc.Utils.Monad.html#wrapLocFstM"><span class="hs-identifier hs-var hs-var">wrapLocFstM</span></a></span></span><span> </span><span id="local-6989586621681081386"><span class="annot"><span class="annottext">a -&gt; TcM (b, c)
</span><a href="#local-6989586621681081386"><span class="hs-identifier hs-var">fn</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681081385"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681081385"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681081384"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681081384"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-894"></span><span>  </span><span class="annot"><span class="annottext">SrcSpan
-&gt; TcRn (GenLocated SrcSpan b, c) -&gt; TcRn (GenLocated SrcSpan b, c)
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681081385"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn (GenLocated SrcSpan b, c) -&gt; TcRn (GenLocated SrcSpan b, c))
-&gt; TcRn (GenLocated SrcSpan b, c) -&gt; TcRn (GenLocated SrcSpan b, c)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-895"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681081383"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621681081383"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681081382"><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621681081382"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">a -&gt; TcM (b, c)
</span><a href="#local-6989586621681081386"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681081384"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-896"></span><span>    </span><span class="annot"><span class="annottext">(GenLocated SrcSpan b, c) -&gt; TcRn (GenLocated SrcSpan b, c)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; b -&gt; GenLocated SrcSpan b
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681081385"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621681081383"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621681081382"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-897"></span><span>
</span><span id="line-898"></span><span id="local-6989586621681082549"><span id="local-6989586621681082550"><span id="local-6989586621681082551"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#wrapLocSndM"><span class="hs-identifier hs-type">wrapLocSndM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681082551"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681082550"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621681082549"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082551"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681082550"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082549"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span></span></span></span><span>
</span><span id="line-899"></span><span id="wrapLocSndM"><span class="annot"><span class="annottext">wrapLocSndM :: forall a b c. (a -&gt; TcM (b, c)) -&gt; Located a -&gt; TcM (b, Located c)
</span><a href="GHC.Tc.Utils.Monad.html#wrapLocSndM"><span class="hs-identifier hs-var hs-var">wrapLocSndM</span></a></span></span><span> </span><span id="local-6989586621681081379"><span class="annot"><span class="annottext">a -&gt; TcM (b, c)
</span><a href="#local-6989586621681081379"><span class="hs-identifier hs-var">fn</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681081378"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681081378"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681081377"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681081377"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-900"></span><span>  </span><span class="annot"><span class="annottext">SrcSpan
-&gt; TcRn (b, GenLocated SrcSpan c) -&gt; TcRn (b, GenLocated SrcSpan c)
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681081378"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn (b, GenLocated SrcSpan c) -&gt; TcRn (b, GenLocated SrcSpan c))
-&gt; TcRn (b, GenLocated SrcSpan c) -&gt; TcRn (b, GenLocated SrcSpan c)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-901"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681081376"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621681081376"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681081375"><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621681081375"><span class="hs-identifier hs-var">c</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">a -&gt; TcM (b, c)
</span><a href="#local-6989586621681081379"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681081377"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-902"></span><span>    </span><span class="annot"><span class="annottext">(b, GenLocated SrcSpan c) -&gt; TcRn (b, GenLocated SrcSpan c)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621681081376"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; c -&gt; GenLocated SrcSpan c
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681081378"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621681081375"><span class="hs-identifier hs-var">c</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-903"></span><span>
</span><span id="line-904"></span><span id="local-6989586621681082545"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#wrapLocM_"><span class="hs-identifier hs-type">wrapLocM_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681082545"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082545"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-905"></span><span id="wrapLocM_"><span class="annot"><span class="annottext">wrapLocM_ :: forall a. (a -&gt; TcM ()) -&gt; Located a -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#wrapLocM_"><span class="hs-identifier hs-var hs-var">wrapLocM_</span></a></span></span><span> </span><span id="local-6989586621681081374"><span class="annot"><span class="annottext">a -&gt; TcM ()
</span><a href="#local-6989586621681081374"><span class="hs-identifier hs-var">fn</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681081373"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681081373"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681081372"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681081372"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcM () -&gt; TcM ()
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681081373"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; TcM ()
</span><a href="#local-6989586621681081374"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681081372"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-906"></span><span>
</span><span id="line-907"></span><span class="hs-comment">-- Reporting errors</span><span>
</span><span id="line-908"></span><span>
</span><span id="line-909"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getErrsVar"><span class="hs-identifier hs-type">getErrsVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#TcRef"><span class="hs-identifier hs-type">TcRef</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-910"></span><span id="getErrsVar"><span class="annot"><span class="annottext">getErrsVar :: TcRn (IORef Messages)
</span><a href="GHC.Tc.Utils.Monad.html#getErrsVar"><span class="hs-identifier hs-var hs-var">getErrsVar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081371"><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681081371"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcLclEnv
forall gbl lcl. TcRnIf gbl lcl lcl
</span><a href="GHC.Tc.Utils.Monad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">IORef Messages -&gt; TcRn (IORef Messages)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcLclEnv -&gt; IORef Messages
</span><a href="GHC.Tc.Types.html#tcl_errs"><span class="hs-identifier hs-var hs-var">tcl_errs</span></a></span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681081371"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-911"></span><span>
</span><span id="line-912"></span><span id="local-6989586621681082543"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setErrsVar"><span class="hs-identifier hs-type">setErrsVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRef"><span class="hs-identifier hs-type">TcRef</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082543"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082543"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-913"></span><span id="setErrsVar"><span class="annot"><span class="annottext">setErrsVar :: forall a. IORef Messages -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setErrsVar"><span class="hs-identifier hs-var hs-var">setErrsVar</span></a></span></span><span> </span><span id="local-6989586621681081370"><span class="annot"><span class="annottext">IORef Messages
</span><a href="#local-6989586621681081370"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcLclEnv -&gt; TcLclEnv)
-&gt; TcRnIf TcGblEnv TcLclEnv a -&gt; TcRnIf TcGblEnv TcLclEnv a
forall lcl gbl a.
(lcl -&gt; lcl) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updLclEnv"><span class="hs-identifier hs-var">updLclEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681081369"><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681081369"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681081369"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcl_errs :: IORef Messages
</span><a href="GHC.Tc.Types.html#tcl_errs"><span class="hs-identifier hs-var">tcl_errs</span></a></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">IORef Messages
</span><a href="#local-6989586621681081370"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-914"></span><span>
</span><span id="line-915"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addErr"><span class="hs-identifier hs-type">addErr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#MsgDoc"><span class="hs-identifier hs-type">MsgDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-916"></span><span id="addErr"><span class="annot"><span class="annottext">addErr :: SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addErr"><span class="hs-identifier hs-var hs-var">addErr</span></a></span></span><span> </span><span id="local-6989586621681081368"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081368"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081367"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681081367"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn SrcSpan
</span><a href="GHC.Tc.Utils.Monad.html#getSrcSpanM"><span class="hs-identifier hs-var">getSrcSpanM</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrAt"><span class="hs-identifier hs-var">addErrAt</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681081367"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081368"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-917"></span><span>
</span><span id="line-918"></span><span id="local-6989586621681082541"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#failWith"><span class="hs-identifier hs-type">failWith</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#MsgDoc"><span class="hs-identifier hs-type">MsgDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082541"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-919"></span><span id="failWith"><span class="annot"><span class="annottext">failWith :: forall a. SDoc -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#failWith"><span class="hs-identifier hs-var hs-var">failWith</span></a></span></span><span> </span><span id="local-6989586621681081365"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081365"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081365"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">TcM ()
-&gt; IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><a href="../../base/src/GHC.Base.html#%3E%3E"><span class="hs-operator hs-var">&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) a
forall env a. IOEnv env a
</span><a href="GHC.Data.IOEnv.html#failM"><span class="hs-identifier hs-var">failM</span></a></span><span>
</span><span id="line-920"></span><span>
</span><span id="line-921"></span><span id="local-6989586621681082537"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#failAt"><span class="hs-identifier hs-type">failAt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#MsgDoc"><span class="hs-identifier hs-type">MsgDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082537"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-922"></span><span id="failAt"><span class="annot"><span class="annottext">failAt :: forall a. SrcSpan -&gt; SDoc -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#failAt"><span class="hs-identifier hs-var hs-var">failAt</span></a></span></span><span> </span><span id="local-6989586621681081362"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681081362"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681081361"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081361"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrAt"><span class="hs-identifier hs-var">addErrAt</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681081362"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081361"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">TcM ()
-&gt; IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><a href="../../base/src/GHC.Base.html#%3E%3E"><span class="hs-operator hs-var">&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) a
forall env a. IOEnv env a
</span><a href="GHC.Data.IOEnv.html#failM"><span class="hs-identifier hs-var">failM</span></a></span><span>
</span><span id="line-923"></span><span>
</span><span id="line-924"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addErrAt"><span class="hs-identifier hs-type">addErrAt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#MsgDoc"><span class="hs-identifier hs-type">MsgDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-925"></span><span class="hs-comment">-- addErrAt is mainly (exclusively?) used by the renamer, where</span><span>
</span><span id="line-926"></span><span class="hs-comment">-- tidying is not an issue, but it's all lazy so the extra</span><span>
</span><span id="line-927"></span><span class="hs-comment">-- work doesn't matter</span><span>
</span><span id="line-928"></span><span id="addErrAt"><span class="annot"><span class="annottext">addErrAt :: SrcSpan -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrAt"><span class="hs-identifier hs-var hs-var">addErrAt</span></a></span></span><span> </span><span id="local-6989586621681081360"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681081360"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681081359"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081359"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081358"><span class="annot"><span class="annottext">[ErrCtxt]
</span><a href="#local-6989586621681081358"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM [ErrCtxt]
</span><a href="GHC.Tc.Utils.Monad.html#getErrCtxt"><span class="hs-identifier hs-var">getErrCtxt</span></a></span><span>
</span><span id="line-929"></span><span>                      </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681081357"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621681081357"><span class="hs-identifier hs-var">tidy_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM TidyEnv
</span><a href="GHC.Tc.Utils.Env.html#tcInitTidyEnv"><span class="hs-identifier hs-var">tcInitTidyEnv</span></a></span><span>
</span><span id="line-930"></span><span>                      </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681081356"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081356"><span class="hs-identifier hs-var">err_info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; [ErrCtxt] -&gt; TcRn SDoc
</span><a href="GHC.Tc.Utils.Monad.html#mkErrInfo"><span class="hs-identifier hs-var">mkErrInfo</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621681081357"><span class="hs-identifier hs-var">tidy_env</span></a></span><span> </span><span class="annot"><span class="annottext">[ErrCtxt]
</span><a href="#local-6989586621681081358"><span class="hs-identifier hs-var">ctxt</span></a></span><span>
</span><span id="line-931"></span><span>                      </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; SDoc -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addLongErrAt"><span class="hs-identifier hs-var">addLongErrAt</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681081360"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081359"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081356"><span class="hs-identifier hs-var">err_info</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-932"></span><span>
</span><span id="line-933"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addErrs"><span class="hs-identifier hs-type">addErrs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Utils.Error.html#MsgDoc"><span class="hs-identifier hs-type">MsgDoc</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-934"></span><span id="addErrs"><span class="annot"><span class="annottext">addErrs :: [(SrcSpan, SDoc)] -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrs"><span class="hs-identifier hs-var hs-var">addErrs</span></a></span></span><span> </span><span id="local-6989586621681081355"><span class="annot"><span class="annottext">[(SrcSpan, SDoc)]
</span><a href="#local-6989586621681081355"><span class="hs-identifier hs-var">msgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((SrcSpan, SDoc) -&gt; TcM ()) -&gt; [(SrcSpan, SDoc)] -&gt; TcM ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><a href="../../base/src/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a></span><span> </span><span class="annot"><span class="annottext">(SrcSpan, SDoc) -&gt; TcM ()
</span><a href="#local-6989586621681081353"><span class="hs-identifier hs-var">add</span></a></span><span> </span><span class="annot"><span class="annottext">[(SrcSpan, SDoc)]
</span><a href="#local-6989586621681081355"><span class="hs-identifier hs-var">msgs</span></a></span><span>
</span><span id="line-935"></span><span>             </span><span class="hs-keyword">where</span><span>
</span><span id="line-936"></span><span>               </span><span id="local-6989586621681081353"><span class="annot"><span class="annottext">add :: (SrcSpan, SDoc) -&gt; TcM ()
</span><a href="#local-6989586621681081353"><span class="hs-identifier hs-var hs-var">add</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681081352"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681081352"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681081351"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081351"><span class="hs-identifier hs-var">msg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrAt"><span class="hs-identifier hs-var">addErrAt</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681081352"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081351"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-937"></span><span>
</span><span id="line-938"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#checkErr"><span class="hs-identifier hs-type">checkErr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#MsgDoc"><span class="hs-identifier hs-type">MsgDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-939"></span><span class="hs-comment">-- Add the error if the bool is False</span><span>
</span><span id="line-940"></span><span id="checkErr"><span class="annot"><span class="annottext">checkErr :: Bool -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#checkErr"><span class="hs-identifier hs-var hs-var">checkErr</span></a></span></span><span> </span><span id="local-6989586621681081350"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681081350"><span class="hs-identifier hs-var">ok</span></a></span></span><span> </span><span id="local-6989586621681081349"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081349"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcM () -&gt; TcM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base/src/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681081350"><span class="hs-identifier hs-var">ok</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081349"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-941"></span><span>
</span><span id="line-942"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addMessages"><span class="hs-identifier hs-type">addMessages</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-943"></span><span id="addMessages"><span class="annot"><span class="annottext">addMessages :: Messages -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addMessages"><span class="hs-identifier hs-var hs-var">addMessages</span></a></span></span><span> </span><span id="local-6989586621681081348"><span class="annot"><span class="annottext">Messages
</span><a href="#local-6989586621681081348"><span class="hs-identifier hs-var">msgs1</span></a></span></span><span>
</span><span id="line-944"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081347"><span class="annot"><span class="annottext">IORef Messages
</span><a href="#local-6989586621681081347"><span class="hs-identifier hs-var">errs_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn (IORef Messages)
</span><a href="GHC.Tc.Utils.Monad.html#getErrsVar"><span class="hs-identifier hs-var">getErrsVar</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-945"></span><span>         </span><span id="local-6989586621681081346"><span class="annot"><span class="annottext">Messages
</span><a href="#local-6989586621681081346"><span class="hs-identifier hs-var">msgs0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef Messages -&gt; TcRnIf TcGblEnv TcLclEnv Messages
forall a gbl lcl. TcRef a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef Messages
</span><a href="#local-6989586621681081347"><span class="hs-identifier hs-var">errs_var</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-946"></span><span>         </span><span class="annot"><span class="annottext">IORef Messages -&gt; Messages -&gt; TcM ()
forall a gbl lcl. TcRef a -&gt; a -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#writeTcRef"><span class="hs-identifier hs-var">writeTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef Messages
</span><a href="#local-6989586621681081347"><span class="hs-identifier hs-var">errs_var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Messages -&gt; Messages -&gt; Messages
</span><a href="GHC.Utils.Error.html#unionMessages"><span class="hs-identifier hs-var">unionMessages</span></a></span><span> </span><span class="annot"><span class="annottext">Messages
</span><a href="#local-6989586621681081346"><span class="hs-identifier hs-var">msgs0</span></a></span><span> </span><span class="annot"><span class="annottext">Messages
</span><a href="#local-6989586621681081348"><span class="hs-identifier hs-var">msgs1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-947"></span><span>
</span><span id="line-948"></span><span id="local-6989586621681081344"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#discardWarnings"><span class="hs-identifier hs-type">discardWarnings</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681081344"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681081344"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-949"></span><span class="hs-comment">-- Ignore warnings inside the thing inside;</span><span>
</span><span id="line-950"></span><span class="hs-comment">-- used to ignore-unused-variable warnings inside derived code</span><span>
</span><span id="line-951"></span><span id="discardWarnings"><span class="annot"><span class="annottext">discardWarnings :: forall a. TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#discardWarnings"><span class="hs-identifier hs-var hs-var">discardWarnings</span></a></span></span><span> </span><span id="local-6989586621681081337"><span class="annot"><span class="annottext">TcRn a
</span><a href="#local-6989586621681081337"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-952"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081336"><span class="annot"><span class="annottext">IORef Messages
</span><a href="#local-6989586621681081336"><span class="hs-identifier hs-var">errs_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn (IORef Messages)
</span><a href="GHC.Tc.Utils.Monad.html#getErrsVar"><span class="hs-identifier hs-var">getErrsVar</span></a></span><span>
</span><span id="line-953"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681081335"><span class="annot"><span class="annottext">Bag WarnMsg
</span><a href="#local-6989586621681081335"><span class="hs-identifier hs-var">old_warns</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bag WarnMsg
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef Messages -&gt; TcRnIf TcGblEnv TcLclEnv Messages
forall a gbl lcl. TcRef a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef Messages
</span><a href="#local-6989586621681081336"><span class="hs-identifier hs-var">errs_var</span></a></span><span>
</span><span id="line-954"></span><span>
</span><span id="line-955"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681081334"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681081334"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn a
</span><a href="#local-6989586621681081337"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-956"></span><span>
</span><span id="line-957"></span><span>        </span><span class="hs-comment">-- Revert warnings to old_warns</span><span>
</span><span id="line-958"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681081333"><span class="annot"><span class="annottext">Bag WarnMsg
</span><a href="#local-6989586621681081333"><span class="hs-identifier hs-var">_new_warns</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681081332"><span class="annot"><span class="annottext">Bag WarnMsg
</span><a href="#local-6989586621681081332"><span class="hs-identifier hs-var">new_errs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef Messages -&gt; TcRnIf TcGblEnv TcLclEnv Messages
forall a gbl lcl. TcRef a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef Messages
</span><a href="#local-6989586621681081336"><span class="hs-identifier hs-var">errs_var</span></a></span><span>
</span><span id="line-959"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">IORef Messages -&gt; Messages -&gt; TcM ()
forall a gbl lcl. TcRef a -&gt; a -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#writeTcRef"><span class="hs-identifier hs-var">writeTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef Messages
</span><a href="#local-6989586621681081336"><span class="hs-identifier hs-var">errs_var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bag WarnMsg
</span><a href="#local-6989586621681081335"><span class="hs-identifier hs-var">old_warns</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bag WarnMsg
</span><a href="#local-6989586621681081332"><span class="hs-identifier hs-var">new_errs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-960"></span><span>
</span><span id="line-961"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">a -&gt; TcRn a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681081334"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-962"></span><span>
</span><span id="line-963"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
        Shared error message stuff: renamer and typechecker
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-970"></span><span>
</span><span id="line-971"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#mkLongErrAt"><span class="hs-identifier hs-type">mkLongErrAt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#MsgDoc"><span class="hs-identifier hs-type">MsgDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#MsgDoc"><span class="hs-identifier hs-type">MsgDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#ErrMsg"><span class="hs-identifier hs-type">ErrMsg</span></a></span><span>
</span><span id="line-972"></span><span id="mkLongErrAt"><span class="annot"><span class="annottext">mkLongErrAt :: SrcSpan -&gt; SDoc -&gt; SDoc -&gt; TcRn WarnMsg
</span><a href="GHC.Tc.Utils.Monad.html#mkLongErrAt"><span class="hs-identifier hs-var hs-var">mkLongErrAt</span></a></span></span><span> </span><span id="local-6989586621681081330"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681081330"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681081329"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081329"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span id="local-6989586621681081328"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081328"><span class="hs-identifier hs-var">extra</span></a></span></span><span>
</span><span id="line-973"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081327"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681081327"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-974"></span><span>         </span><span id="local-6989586621681081326"><span class="annot"><span class="annottext">PrintUnqualified
</span><a href="#local-6989586621681081326"><span class="hs-identifier hs-var">printer</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; TcRn PrintUnqualified
</span><a href="GHC.Tc.Utils.Monad.html#getPrintUnqualified"><span class="hs-identifier hs-var">getPrintUnqualified</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681081327"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-975"></span><span>         </span><span class="annot"><span class="annottext">WarnMsg -&gt; TcRn WarnMsg
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(WarnMsg -&gt; TcRn WarnMsg) -&gt; WarnMsg -&gt; TcRn WarnMsg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; SrcSpan -&gt; PrintUnqualified -&gt; SDoc -&gt; SDoc -&gt; WarnMsg
</span><a href="GHC.Utils.Error.html#mkLongErrMsg"><span class="hs-identifier hs-var">mkLongErrMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681081327"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681081330"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">PrintUnqualified
</span><a href="#local-6989586621681081326"><span class="hs-identifier hs-var">printer</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081329"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081328"><span class="hs-identifier hs-var">extra</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-976"></span><span>
</span><span id="line-977"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#mkErrDocAt"><span class="hs-identifier hs-type">mkErrDocAt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#ErrDoc"><span class="hs-identifier hs-type">ErrDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#ErrMsg"><span class="hs-identifier hs-type">ErrMsg</span></a></span><span>
</span><span id="line-978"></span><span id="mkErrDocAt"><span class="annot"><span class="annottext">mkErrDocAt :: SrcSpan -&gt; ErrDoc -&gt; TcRn WarnMsg
</span><a href="GHC.Tc.Utils.Monad.html#mkErrDocAt"><span class="hs-identifier hs-var hs-var">mkErrDocAt</span></a></span></span><span> </span><span id="local-6989586621681081324"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681081324"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681081323"><span class="annot"><span class="annottext">ErrDoc
</span><a href="#local-6989586621681081323"><span class="hs-identifier hs-var">errDoc</span></a></span></span><span>
</span><span id="line-979"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081322"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681081322"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-980"></span><span>         </span><span id="local-6989586621681081321"><span class="annot"><span class="annottext">PrintUnqualified
</span><a href="#local-6989586621681081321"><span class="hs-identifier hs-var">printer</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; TcRn PrintUnqualified
</span><a href="GHC.Tc.Utils.Monad.html#getPrintUnqualified"><span class="hs-identifier hs-var">getPrintUnqualified</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681081322"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-981"></span><span>         </span><span class="annot"><span class="annottext">WarnMsg -&gt; TcRn WarnMsg
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(WarnMsg -&gt; TcRn WarnMsg) -&gt; WarnMsg -&gt; TcRn WarnMsg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; SrcSpan -&gt; PrintUnqualified -&gt; ErrDoc -&gt; WarnMsg
</span><a href="GHC.Utils.Error.html#mkErrDoc"><span class="hs-identifier hs-var">mkErrDoc</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681081322"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681081324"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">PrintUnqualified
</span><a href="#local-6989586621681081321"><span class="hs-identifier hs-var">printer</span></a></span><span> </span><span class="annot"><span class="annottext">ErrDoc
</span><a href="#local-6989586621681081323"><span class="hs-identifier hs-var">errDoc</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-982"></span><span>
</span><span id="line-983"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addLongErrAt"><span class="hs-identifier hs-type">addLongErrAt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#MsgDoc"><span class="hs-identifier hs-type">MsgDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#MsgDoc"><span class="hs-identifier hs-type">MsgDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-984"></span><span id="addLongErrAt"><span class="annot"><span class="annottext">addLongErrAt :: SrcSpan -&gt; SDoc -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addLongErrAt"><span class="hs-identifier hs-var hs-var">addLongErrAt</span></a></span></span><span> </span><span id="local-6989586621681081319"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681081319"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681081318"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081318"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span id="local-6989586621681081317"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081317"><span class="hs-identifier hs-var">extra</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; SDoc -&gt; SDoc -&gt; TcRn WarnMsg
</span><a href="GHC.Tc.Utils.Monad.html#mkLongErrAt"><span class="hs-identifier hs-var">mkLongErrAt</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681081319"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081318"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081317"><span class="hs-identifier hs-var">extra</span></a></span><span> </span><span class="annot"><span class="annottext">TcRn WarnMsg -&gt; (WarnMsg -&gt; TcM ()) -&gt; TcM ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../base/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">WarnMsg -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#reportError"><span class="hs-identifier hs-var">reportError</span></a></span><span>
</span><span id="line-985"></span><span>
</span><span id="line-986"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#reportErrors"><span class="hs-identifier hs-type">reportErrors</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Utils.Error.html#ErrMsg"><span class="hs-identifier hs-type">ErrMsg</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-987"></span><span id="reportErrors"><span class="annot"><span class="annottext">reportErrors :: [WarnMsg] -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#reportErrors"><span class="hs-identifier hs-var hs-var">reportErrors</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(WarnMsg -&gt; TcM ()) -&gt; [WarnMsg] -&gt; TcM ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><a href="../../base/src/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a></span><span> </span><span class="annot"><span class="annottext">WarnMsg -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#reportError"><span class="hs-identifier hs-var">reportError</span></a></span><span>
</span><span id="line-988"></span><span>
</span><span id="line-989"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#reportError"><span class="hs-identifier hs-type">reportError</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#ErrMsg"><span class="hs-identifier hs-type">ErrMsg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-990"></span><span id="reportError"><span class="annot"><span class="annottext">reportError :: WarnMsg -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#reportError"><span class="hs-identifier hs-var hs-var">reportError</span></a></span></span><span> </span><span id="local-6989586621681081316"><span class="annot"><span class="annottext">WarnMsg
</span><a href="#local-6989586621681081316"><span class="hs-identifier hs-var">err</span></a></span></span><span>
</span><span id="line-991"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;Adding error:&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WarnMsg -&gt; SDoc
</span><a href="GHC.Utils.Error.html#pprLocErrMsg"><span class="hs-identifier hs-var">pprLocErrMsg</span></a></span><span> </span><span class="annot"><span class="annottext">WarnMsg
</span><a href="#local-6989586621681081316"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-992"></span><span>         </span><span id="local-6989586621681081314"><span class="annot"><span class="annottext">IORef Messages
</span><a href="#local-6989586621681081314"><span class="hs-identifier hs-var">errs_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn (IORef Messages)
</span><a href="GHC.Tc.Utils.Monad.html#getErrsVar"><span class="hs-identifier hs-var">getErrsVar</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-993"></span><span>         </span><span class="hs-special">(</span><span id="local-6989586621681081313"><span class="annot"><span class="annottext">Bag WarnMsg
</span><a href="#local-6989586621681081313"><span class="hs-identifier hs-var">warns</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681081312"><span class="annot"><span class="annottext">Bag WarnMsg
</span><a href="#local-6989586621681081312"><span class="hs-identifier hs-var">errs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef Messages -&gt; TcRnIf TcGblEnv TcLclEnv Messages
forall a gbl lcl. TcRef a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef Messages
</span><a href="#local-6989586621681081314"><span class="hs-identifier hs-var">errs_var</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-994"></span><span>         </span><span class="annot"><span class="annottext">IORef Messages -&gt; Messages -&gt; TcM ()
forall a gbl lcl. TcRef a -&gt; a -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#writeTcRef"><span class="hs-identifier hs-var">writeTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef Messages
</span><a href="#local-6989586621681081314"><span class="hs-identifier hs-var">errs_var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bag WarnMsg
</span><a href="#local-6989586621681081313"><span class="hs-identifier hs-var">warns</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bag WarnMsg
</span><a href="#local-6989586621681081312"><span class="hs-identifier hs-var">errs</span></a></span><span> </span><span class="annot"><span class="annottext">Bag WarnMsg -&gt; WarnMsg -&gt; Bag WarnMsg
forall a. Bag a -&gt; a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#snocBag"><span class="hs-operator hs-var">`snocBag`</span></a></span><span> </span><span class="annot"><span class="annottext">WarnMsg
</span><a href="#local-6989586621681081316"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-995"></span><span>
</span><span id="line-996"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#reportWarning"><span class="hs-identifier hs-type">reportWarning</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#WarnReason"><span class="hs-identifier hs-type">WarnReason</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#ErrMsg"><span class="hs-identifier hs-type">ErrMsg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-997"></span><span id="reportWarning"><span class="annot"><span class="annottext">reportWarning :: WarnReason -&gt; WarnMsg -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#reportWarning"><span class="hs-identifier hs-var hs-var">reportWarning</span></a></span></span><span> </span><span id="local-6989586621681081310"><span class="annot"><span class="annottext">WarnReason
</span><a href="#local-6989586621681081310"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span id="local-6989586621681081309"><span class="annot"><span class="annottext">WarnMsg
</span><a href="#local-6989586621681081309"><span class="hs-identifier hs-var">err</span></a></span></span><span>
</span><span id="line-998"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681081308"><span class="annot"><span class="annottext">warn :: WarnMsg
</span><a href="#local-6989586621681081308"><span class="hs-identifier hs-var hs-var">warn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WarnReason -&gt; WarnMsg -&gt; WarnMsg
</span><a href="GHC.Utils.Error.html#makeIntoWarning"><span class="hs-identifier hs-var">makeIntoWarning</span></a></span><span> </span><span class="annot"><span class="annottext">WarnReason
</span><a href="#local-6989586621681081310"><span class="hs-identifier hs-var">reason</span></a></span><span> </span><span class="annot"><span class="annottext">WarnMsg
</span><a href="#local-6989586621681081309"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-999"></span><span>                    </span><span class="hs-comment">-- 'err' was built by mkLongErrMsg or something like that,</span><span>
</span><span id="line-1000"></span><span>                    </span><span class="hs-comment">-- so it's of error severity.  For a warning we downgrade</span><span>
</span><span id="line-1001"></span><span>                    </span><span class="hs-comment">-- its severity to SevWarning</span><span>
</span><span id="line-1002"></span><span>
</span><span id="line-1003"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;Adding warning:&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WarnMsg -&gt; SDoc
</span><a href="GHC.Utils.Error.html#pprLocErrMsg"><span class="hs-identifier hs-var">pprLocErrMsg</span></a></span><span> </span><span class="annot"><span class="annottext">WarnMsg
</span><a href="#local-6989586621681081308"><span class="hs-identifier hs-var">warn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1004"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681081306"><span class="annot"><span class="annottext">IORef Messages
</span><a href="#local-6989586621681081306"><span class="hs-identifier hs-var">errs_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn (IORef Messages)
</span><a href="GHC.Tc.Utils.Monad.html#getErrsVar"><span class="hs-identifier hs-var">getErrsVar</span></a></span><span>
</span><span id="line-1005"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681081305"><span class="annot"><span class="annottext">Bag WarnMsg
</span><a href="#local-6989586621681081305"><span class="hs-identifier hs-var">warns</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681081304"><span class="annot"><span class="annottext">Bag WarnMsg
</span><a href="#local-6989586621681081304"><span class="hs-identifier hs-var">errs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef Messages -&gt; TcRnIf TcGblEnv TcLclEnv Messages
forall a gbl lcl. TcRef a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef Messages
</span><a href="#local-6989586621681081306"><span class="hs-identifier hs-var">errs_var</span></a></span><span>
</span><span id="line-1006"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">IORef Messages -&gt; Messages -&gt; TcM ()
forall a gbl lcl. TcRef a -&gt; a -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#writeTcRef"><span class="hs-identifier hs-var">writeTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef Messages
</span><a href="#local-6989586621681081306"><span class="hs-identifier hs-var">errs_var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bag WarnMsg
</span><a href="#local-6989586621681081305"><span class="hs-identifier hs-var">warns</span></a></span><span> </span><span class="annot"><span class="annottext">Bag WarnMsg -&gt; WarnMsg -&gt; Bag WarnMsg
forall a. Bag a -&gt; a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#snocBag"><span class="hs-operator hs-var">`snocBag`</span></a></span><span> </span><span class="annot"><span class="annottext">WarnMsg
</span><a href="#local-6989586621681081308"><span class="hs-identifier hs-var">warn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bag WarnMsg
</span><a href="#local-6989586621681081304"><span class="hs-identifier hs-var">errs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1007"></span><span>
</span><span id="line-1008"></span><span>
</span><span id="line-1009"></span><span class="hs-comment">-----------------------</span><span>
</span><span id="line-1010"></span><span id="local-6989586621681081303"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#checkNoErrs"><span class="hs-identifier hs-type">checkNoErrs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681081303"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681081303"><span class="hs-identifier hs-type">r</span></a></span></span><span>
</span><span id="line-1011"></span><span class="hs-comment">-- (checkNoErrs m) succeeds iff m succeeds and generates no errors</span><span>
</span><span id="line-1012"></span><span class="hs-comment">-- If m fails then (checkNoErrsTc m) fails.</span><span>
</span><span id="line-1013"></span><span class="hs-comment">-- If m succeeds, it checks whether m generated any errors messages</span><span>
</span><span id="line-1014"></span><span class="hs-comment">--      (it might have recovered internally)</span><span>
</span><span id="line-1015"></span><span class="hs-comment">--      If so, it fails too.</span><span>
</span><span id="line-1016"></span><span class="hs-comment">-- Regardless, any errors generated by m are propagated to the enclosing context.</span><span>
</span><span id="line-1017"></span><span id="checkNoErrs"><span class="annot"><span class="annottext">checkNoErrs :: forall a. TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#checkNoErrs"><span class="hs-identifier hs-var hs-var">checkNoErrs</span></a></span></span><span> </span><span id="local-6989586621681081298"><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621681081298"><span class="hs-identifier hs-var">main</span></a></span></span><span>
</span><span id="line-1018"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681081297"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681081297"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681081296"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681081296"><span class="hs-identifier hs-var">no_errs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM r -&gt; TcRn (r, Bool)
forall a. TcRn a -&gt; TcRn (a, Bool)
</span><a href="GHC.Tc.Utils.Monad.html#askNoErrs"><span class="hs-identifier hs-var">askNoErrs</span></a></span><span> </span><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621681081298"><span class="hs-identifier hs-var">main</span></a></span><span>
</span><span id="line-1019"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcM () -&gt; TcM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base/src/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681081296"><span class="hs-identifier hs-var">no_errs</span></a></span><span> </span><span class="annot"><span class="annottext">TcM ()
forall env a. IOEnv env a
</span><a href="GHC.Data.IOEnv.html#failM"><span class="hs-identifier hs-var">failM</span></a></span><span>
</span><span id="line-1020"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">r -&gt; TcM r
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681081297"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1021"></span><span>
</span><span id="line-1022"></span><span class="hs-comment">-----------------------</span><span>
</span><span id="line-1023"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#whenNoErrs"><span class="hs-identifier hs-type">whenNoErrs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1024"></span><span id="whenNoErrs"><span class="annot"><span class="annottext">whenNoErrs :: TcM () -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#whenNoErrs"><span class="hs-identifier hs-var hs-var">whenNoErrs</span></a></span></span><span> </span><span id="local-6989586621681081295"><span class="annot"><span class="annottext">TcM ()
</span><a href="#local-6989586621681081295"><span class="hs-identifier hs-var">thing</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM () -&gt; TcM () -&gt; TcM ()
forall r. TcRn r -&gt; TcRn r -&gt; TcRn r
</span><a href="GHC.Tc.Utils.Monad.html#ifErrsM"><span class="hs-identifier hs-var">ifErrsM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; TcM ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcM ()
</span><a href="#local-6989586621681081295"><span class="hs-identifier hs-var">thing</span></a></span><span>
</span><span id="line-1025"></span><span>
</span><span id="line-1026"></span><span id="local-6989586621681082522"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#ifErrsM"><span class="hs-identifier hs-type">ifErrsM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082522"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082522"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082522"><span class="hs-identifier hs-type">r</span></a></span></span><span>
</span><span id="line-1027"></span><span class="hs-comment">--      ifErrsM bale_out normal</span><span>
</span><span id="line-1028"></span><span class="hs-comment">-- does 'bale_out' if there are errors in errors collection</span><span>
</span><span id="line-1029"></span><span class="hs-comment">-- otherwise does 'normal'</span><span>
</span><span id="line-1030"></span><span id="ifErrsM"><span class="annot"><span class="annottext">ifErrsM :: forall r. TcRn r -&gt; TcRn r -&gt; TcRn r
</span><a href="GHC.Tc.Utils.Monad.html#ifErrsM"><span class="hs-identifier hs-var hs-var">ifErrsM</span></a></span></span><span> </span><span id="local-6989586621681081290"><span class="annot"><span class="annottext">TcRn r
</span><a href="#local-6989586621681081290"><span class="hs-identifier hs-var">bale_out</span></a></span></span><span> </span><span id="local-6989586621681081289"><span class="annot"><span class="annottext">TcRn r
</span><a href="#local-6989586621681081289"><span class="hs-identifier hs-var">normal</span></a></span></span><span>
</span><span id="line-1031"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081288"><span class="annot"><span class="annottext">IORef Messages
</span><a href="#local-6989586621681081288"><span class="hs-identifier hs-var">errs_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn (IORef Messages)
</span><a href="GHC.Tc.Utils.Monad.html#getErrsVar"><span class="hs-identifier hs-var">getErrsVar</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1032"></span><span>        </span><span id="local-6989586621681081287"><span class="annot"><span class="annottext">Messages
</span><a href="#local-6989586621681081287"><span class="hs-identifier hs-var">msgs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef Messages -&gt; TcRnIf TcGblEnv TcLclEnv Messages
forall a gbl lcl. TcRef a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef Messages
</span><a href="#local-6989586621681081288"><span class="hs-identifier hs-var">errs_var</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1033"></span><span>        </span><span id="local-6989586621681081286"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681081286"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1034"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Messages -&gt; Bool
</span><a href="GHC.Utils.Error.html#errorsFound"><span class="hs-identifier hs-var">errorsFound</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681081286"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Messages
</span><a href="#local-6989586621681081287"><span class="hs-identifier hs-var">msgs</span></a></span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-1035"></span><span>           </span><span class="annot"><span class="annottext">TcRn r
</span><a href="#local-6989586621681081290"><span class="hs-identifier hs-var">bale_out</span></a></span><span>
</span><span id="line-1036"></span><span>        </span><span class="hs-keyword">else</span><span>
</span><span id="line-1037"></span><span>           </span><span class="annot"><span class="annottext">TcRn r
</span><a href="#local-6989586621681081289"><span class="hs-identifier hs-var">normal</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1038"></span><span>
</span><span id="line-1039"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#failIfErrsM"><span class="hs-identifier hs-type">failIfErrsM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1040"></span><span class="hs-comment">-- Useful to avoid error cascades</span><span>
</span><span id="line-1041"></span><span id="failIfErrsM"><span class="annot"><span class="annottext">failIfErrsM :: TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#failIfErrsM"><span class="hs-identifier hs-var hs-var">failIfErrsM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM () -&gt; TcM () -&gt; TcM ()
forall r. TcRn r -&gt; TcRn r -&gt; TcRn r
</span><a href="GHC.Tc.Utils.Monad.html#ifErrsM"><span class="hs-identifier hs-var">ifErrsM</span></a></span><span> </span><span class="annot"><span class="annottext">TcM ()
forall env a. IOEnv env a
</span><a href="GHC.Data.IOEnv.html#failM"><span class="hs-identifier hs-var">failM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; TcM ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1042"></span><span>
</span><span id="line-1043"></span><span class="hs-comment">{- *********************************************************************
*                                                                      *
        Context management for the type checker
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-1049"></span><span>
</span><span id="line-1050"></span><span class="hs-comment">{- Note [Inlining addErrCtxt]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
You will notice a bunch of INLINE pragamas on addErrCtxt and friends.
The reason is to promote better eta-expansion in client modules.
Consider
    \e s. addErrCtxt c (tc_foo x) e s
It looks as if tc_foo is applied to only two arguments, but if we
inline addErrCtxt it'll turn into something more like
    \e s. tc_foo x (munge c e) s
This is much better because Called Arity analysis can see that tc_foo
is applied to four arguments.  See #18379 for a concrete example.

This reliance on delicate inlining and Called Arity is not good.
See #18202 for a more general approach.  But meanwhile, these
ininings seem unobjectional, and they solve the immediate
problem. -}</span><span>
</span><span id="line-1066"></span><span>
</span><span id="line-1067"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getErrCtxt"><span class="hs-identifier hs-type">getErrCtxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.html#ErrCtxt"><span class="hs-identifier hs-type">ErrCtxt</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1068"></span><span id="getErrCtxt"><span class="annot"><span class="annottext">getErrCtxt :: TcM [ErrCtxt]
</span><a href="GHC.Tc.Utils.Monad.html#getErrCtxt"><span class="hs-identifier hs-var hs-var">getErrCtxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081285"><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681081285"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcLclEnv
forall gbl lcl. TcRnIf gbl lcl lcl
</span><a href="GHC.Tc.Utils.Monad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">[ErrCtxt] -&gt; TcM [ErrCtxt]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcLclEnv -&gt; [ErrCtxt]
</span><a href="GHC.Tc.Types.html#tcl_ctxt"><span class="hs-identifier hs-var hs-var">tcl_ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681081285"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1069"></span><span>
</span><span id="line-1070"></span><span id="local-6989586621681082520"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setErrCtxt"><span class="hs-identifier hs-type">setErrCtxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.html#ErrCtxt"><span class="hs-identifier hs-type">ErrCtxt</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082520"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082520"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1071"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setErrCtxt"><span class="hs-pragma hs-type">setErrCtxt</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>   </span><span class="hs-comment">-- Note [Inlining addErrCtxt]</span><span>
</span><span id="line-1072"></span><span id="setErrCtxt"><span class="annot"><span class="annottext">setErrCtxt :: forall a. [ErrCtxt] -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#setErrCtxt"><span class="hs-identifier hs-var hs-var">setErrCtxt</span></a></span></span><span> </span><span id="local-6989586621681081284"><span class="annot"><span class="annottext">[ErrCtxt]
</span><a href="#local-6989586621681081284"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcLclEnv -&gt; TcLclEnv)
-&gt; TcRnIf TcGblEnv TcLclEnv a -&gt; TcRnIf TcGblEnv TcLclEnv a
forall lcl gbl a.
(lcl -&gt; lcl) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updLclEnv"><span class="hs-identifier hs-var">updLclEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681081283"><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681081283"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681081283"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcl_ctxt :: [ErrCtxt]
</span><a href="GHC.Tc.Types.html#tcl_ctxt"><span class="hs-identifier hs-var">tcl_ctxt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ErrCtxt]
</span><a href="#local-6989586621681081284"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1073"></span><span>
</span><span id="line-1074"></span><span class="hs-comment">-- | Add a fixed message to the error context. This message should not</span><span>
</span><span id="line-1075"></span><span class="hs-comment">-- do any tidying.</span><span>
</span><span id="line-1076"></span><span id="local-6989586621681082518"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-identifier hs-type">addErrCtxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#MsgDoc"><span class="hs-identifier hs-type">MsgDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082518"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082518"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1077"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-pragma hs-type">addErrCtxt</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>   </span><span class="hs-comment">-- Note [Inlining addErrCtxt]</span><span>
</span><span id="line-1078"></span><span id="addErrCtxt"><span class="annot"><span class="annottext">addErrCtxt :: forall a. SDoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-identifier hs-var hs-var">addErrCtxt</span></a></span></span><span> </span><span id="local-6989586621681081281"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081281"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TidyEnv -&gt; TcM (TidyEnv, SDoc)) -&gt; TcM a -&gt; TcM a
forall a. (TidyEnv -&gt; TcM (TidyEnv, SDoc)) -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxtM"><span class="hs-identifier hs-var">addErrCtxtM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681081280"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621681081280"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(TidyEnv, SDoc) -&gt; TcM (TidyEnv, SDoc)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621681081280"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081281"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1079"></span><span>
</span><span id="line-1080"></span><span class="hs-comment">-- | Add a message to the error context. This message may do tidying.</span><span>
</span><span id="line-1081"></span><span id="local-6989586621681082516"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addErrCtxtM"><span class="hs-identifier hs-type">addErrCtxtM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#MsgDoc"><span class="hs-identifier hs-type">MsgDoc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082516"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082516"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1082"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addErrCtxtM"><span class="hs-pragma hs-type">addErrCtxtM</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>  </span><span class="hs-comment">-- Note [Inlining addErrCtxt]</span><span>
</span><span id="line-1083"></span><span id="addErrCtxtM"><span class="annot"><span class="annottext">addErrCtxtM :: forall a. (TidyEnv -&gt; TcM (TidyEnv, SDoc)) -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxtM"><span class="hs-identifier hs-var hs-var">addErrCtxtM</span></a></span></span><span> </span><span id="local-6989586621681081279"><span class="annot"><span class="annottext">TidyEnv -&gt; TcM (TidyEnv, SDoc)
</span><a href="#local-6989586621681081279"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621681081278"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681081278"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; [ErrCtxt] -&gt; [ErrCtxt]) -&gt; TcM a -&gt; TcM a
forall a. (Bool -&gt; [ErrCtxt] -&gt; [ErrCtxt]) -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#updCtxt"><span class="hs-identifier hs-var">updCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ErrCtxt -&gt; Bool -&gt; [ErrCtxt] -&gt; [ErrCtxt]
</span><a href="GHC.Tc.Utils.Monad.html#push_ctxt"><span class="hs-identifier hs-var">push_ctxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; TcM (TidyEnv, SDoc)
</span><a href="#local-6989586621681081279"><span class="hs-identifier hs-var">ctxt</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681081278"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-1084"></span><span>
</span><span id="line-1085"></span><span class="hs-comment">-- | Add a fixed landmark message to the error context. A landmark</span><span>
</span><span id="line-1086"></span><span class="hs-comment">-- message is always sure to be reported, even if there is a lot of</span><span>
</span><span id="line-1087"></span><span class="hs-comment">-- context. It also doesn't count toward the maximum number of contexts</span><span>
</span><span id="line-1088"></span><span class="hs-comment">-- reported.</span><span>
</span><span id="line-1089"></span><span id="local-6989586621681081275"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addLandmarkErrCtxt"><span class="hs-identifier hs-type">addLandmarkErrCtxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#MsgDoc"><span class="hs-identifier hs-type">MsgDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681081275"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681081275"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1090"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addLandmarkErrCtxt"><span class="hs-pragma hs-type">addLandmarkErrCtxt</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>  </span><span class="hs-comment">-- Note [Inlining addErrCtxt]</span><span>
</span><span id="line-1091"></span><span id="addLandmarkErrCtxt"><span class="annot"><span class="annottext">addLandmarkErrCtxt :: forall a. SDoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addLandmarkErrCtxt"><span class="hs-identifier hs-var hs-var">addLandmarkErrCtxt</span></a></span></span><span> </span><span id="local-6989586621681081273"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081273"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TidyEnv -&gt; TcM (TidyEnv, SDoc)) -&gt; TcM a -&gt; TcM a
forall a. (TidyEnv -&gt; TcM (TidyEnv, SDoc)) -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addLandmarkErrCtxtM"><span class="hs-identifier hs-var">addLandmarkErrCtxtM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681081272"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621681081272"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(TidyEnv, SDoc) -&gt; TcM (TidyEnv, SDoc)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621681081272"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081273"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1092"></span><span>
</span><span id="line-1093"></span><span class="hs-comment">-- | Variant of 'addLandmarkErrCtxt' that allows for monadic operations</span><span>
</span><span id="line-1094"></span><span class="hs-comment">-- and tidying.</span><span>
</span><span id="line-1095"></span><span id="local-6989586621681081271"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addLandmarkErrCtxtM"><span class="hs-identifier hs-type">addLandmarkErrCtxtM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#MsgDoc"><span class="hs-identifier hs-type">MsgDoc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681081271"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681081271"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1096"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addLandmarkErrCtxtM"><span class="hs-pragma hs-type">addLandmarkErrCtxtM</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>  </span><span class="hs-comment">-- Note [Inlining addErrCtxt]</span><span>
</span><span id="line-1097"></span><span id="addLandmarkErrCtxtM"><span class="annot"><span class="annottext">addLandmarkErrCtxtM :: forall a. (TidyEnv -&gt; TcM (TidyEnv, SDoc)) -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addLandmarkErrCtxtM"><span class="hs-identifier hs-var hs-var">addLandmarkErrCtxtM</span></a></span></span><span> </span><span id="local-6989586621681081270"><span class="annot"><span class="annottext">TidyEnv -&gt; TcM (TidyEnv, SDoc)
</span><a href="#local-6989586621681081270"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621681081269"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681081269"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; [ErrCtxt] -&gt; [ErrCtxt]) -&gt; TcM a -&gt; TcM a
forall a. (Bool -&gt; [ErrCtxt] -&gt; [ErrCtxt]) -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#updCtxt"><span class="hs-identifier hs-var">updCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ErrCtxt -&gt; Bool -&gt; [ErrCtxt] -&gt; [ErrCtxt]
</span><a href="GHC.Tc.Utils.Monad.html#push_ctxt"><span class="hs-identifier hs-var">push_ctxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; TcM (TidyEnv, SDoc)
</span><a href="#local-6989586621681081270"><span class="hs-identifier hs-var">ctxt</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681081269"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-1098"></span><span>
</span><span id="line-1099"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#push_ctxt"><span class="hs-identifier hs-type">push_ctxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#MsgDoc"><span class="hs-identifier hs-type">MsgDoc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1100"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.html#ErrCtxt"><span class="hs-identifier hs-type">ErrCtxt</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.html#ErrCtxt"><span class="hs-identifier hs-type">ErrCtxt</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1101"></span><span id="push_ctxt"><span class="annot"><span class="annottext">push_ctxt :: ErrCtxt -&gt; Bool -&gt; [ErrCtxt] -&gt; [ErrCtxt]
</span><a href="GHC.Tc.Utils.Monad.html#push_ctxt"><span class="hs-identifier hs-var hs-var">push_ctxt</span></a></span></span><span> </span><span id="local-6989586621681081268"><span class="annot"><span class="annottext">ErrCtxt
</span><a href="#local-6989586621681081268"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span id="local-6989586621681081267"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681081267"><span class="hs-identifier hs-var">in_gen</span></a></span></span><span> </span><span id="local-6989586621681081266"><span class="annot"><span class="annottext">[ErrCtxt]
</span><a href="#local-6989586621681081266"><span class="hs-identifier hs-var">ctxts</span></a></span></span><span>
</span><span id="line-1102"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681081267"><span class="hs-identifier hs-var">in_gen</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ErrCtxt]
</span><a href="#local-6989586621681081266"><span class="hs-identifier hs-var">ctxts</span></a></span><span>
</span><span id="line-1103"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ErrCtxt
</span><a href="#local-6989586621681081268"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">ErrCtxt -&gt; [ErrCtxt] -&gt; [ErrCtxt]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[ErrCtxt]
</span><a href="#local-6989586621681081266"><span class="hs-identifier hs-var">ctxts</span></a></span><span>
</span><span id="line-1104"></span><span>
</span><span id="line-1105"></span><span id="local-6989586621681082514"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#updCtxt"><span class="hs-identifier hs-type">updCtxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.html#ErrCtxt"><span class="hs-identifier hs-type">ErrCtxt</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.html#ErrCtxt"><span class="hs-identifier hs-type">ErrCtxt</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082514"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082514"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1106"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#updCtxt"><span class="hs-pragma hs-type">updCtxt</span></a></span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-comment">-- Note [Inlining addErrCtxt]</span><span>
</span><span id="line-1107"></span><span class="hs-comment">-- Helper function for the above</span><span>
</span><span id="line-1108"></span><span class="hs-comment">-- The Bool is true if we are in generated code</span><span>
</span><span id="line-1109"></span><span id="updCtxt"><span class="annot"><span class="annottext">updCtxt :: forall a. (Bool -&gt; [ErrCtxt] -&gt; [ErrCtxt]) -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#updCtxt"><span class="hs-identifier hs-var hs-var">updCtxt</span></a></span></span><span> </span><span id="local-6989586621681081265"><span class="annot"><span class="annottext">Bool -&gt; [ErrCtxt] -&gt; [ErrCtxt]
</span><a href="#local-6989586621681081265"><span class="hs-identifier hs-var">upd</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcLclEnv -&gt; TcLclEnv)
-&gt; TcRnIf TcGblEnv TcLclEnv a -&gt; TcRnIf TcGblEnv TcLclEnv a
forall lcl gbl a.
(lcl -&gt; lcl) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updLclEnv"><span class="hs-identifier hs-var">updLclEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681081264"><span class="annot"><span class="annottext">env :: TcLclEnv
</span><a href="#local-6989586621681081264"><span class="hs-identifier hs-var">env</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#TcLclEnv"><span class="hs-identifier hs-type">TcLclEnv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcl_ctxt :: TcLclEnv -&gt; [ErrCtxt]
</span><a href="GHC.Tc.Types.html#tcl_ctxt"><span class="hs-identifier hs-var">tcl_ctxt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681081263"><span class="annot"><span class="annottext">[ErrCtxt]
</span><a href="#local-6989586621681081263"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span>
</span><span id="line-1110"></span><span>                                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcl_in_gen_code :: TcLclEnv -&gt; Bool
</span><a href="GHC.Tc.Types.html#tcl_in_gen_code"><span class="hs-identifier hs-var">tcl_in_gen_code</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681081262"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681081262"><span class="hs-identifier hs-var">in_gen</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1111"></span><span>                           </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681081264"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcl_ctxt :: [ErrCtxt]
</span><a href="GHC.Tc.Types.html#tcl_ctxt"><span class="hs-identifier hs-var">tcl_ctxt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; [ErrCtxt] -&gt; [ErrCtxt]
</span><a href="#local-6989586621681081265"><span class="hs-identifier hs-var">upd</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681081262"><span class="hs-identifier hs-var">in_gen</span></a></span><span> </span><span class="annot"><span class="annottext">[ErrCtxt]
</span><a href="#local-6989586621681081263"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1112"></span><span>
</span><span id="line-1113"></span><span id="local-6989586621681081261"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#popErrCtxt"><span class="hs-identifier hs-type">popErrCtxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681081261"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681081261"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1114"></span><span id="popErrCtxt"><span class="annot"><span class="annottext">popErrCtxt :: forall a. TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#popErrCtxt"><span class="hs-identifier hs-var hs-var">popErrCtxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; [ErrCtxt] -&gt; [ErrCtxt]) -&gt; TcM a -&gt; TcM a
forall a. (Bool -&gt; [ErrCtxt] -&gt; [ErrCtxt]) -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#updCtxt"><span class="hs-identifier hs-var">updCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681081260"><span class="annot"><span class="annottext">[ErrCtxt]
</span><a href="#local-6989586621681081260"><span class="hs-identifier hs-var">msgs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[ErrCtxt]
</span><a href="#local-6989586621681081260"><span class="hs-identifier hs-var">msgs</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ErrCtxt
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681081259"><span class="annot"><span class="annottext">[ErrCtxt]
</span><a href="#local-6989586621681081259"><span class="hs-identifier hs-var">ms</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[ErrCtxt]
</span><a href="#local-6989586621681081259"><span class="hs-identifier hs-var">ms</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1115"></span><span>
</span><span id="line-1116"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getCtLocM"><span class="hs-identifier hs-type">getCtLocM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#TypeOrKind"><span class="hs-identifier hs-type">TypeOrKind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span>
</span><span id="line-1117"></span><span id="getCtLocM"><span class="annot"><span class="annottext">getCtLocM :: CtOrigin -&gt; Maybe TypeOrKind -&gt; TcM CtLoc
</span><a href="GHC.Tc.Utils.Monad.html#getCtLocM"><span class="hs-identifier hs-var hs-var">getCtLocM</span></a></span></span><span> </span><span id="local-6989586621681081258"><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621681081258"><span class="hs-identifier hs-var">origin</span></a></span></span><span> </span><span id="local-6989586621681081257"><span class="annot"><span class="annottext">Maybe TypeOrKind
</span><a href="#local-6989586621681081257"><span class="hs-identifier hs-var">t_or_k</span></a></span></span><span>
</span><span id="line-1118"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081256"><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681081256"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcLclEnv
forall gbl lcl. TcRnIf gbl lcl lcl
</span><a href="GHC.Tc.Utils.Monad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a></span><span>
</span><span id="line-1119"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">CtLoc -&gt; TcM CtLoc
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtLoc :: CtOrigin -&gt; TcLclEnv -&gt; Maybe TypeOrKind -&gt; SubGoalDepth -&gt; CtLoc
</span><a href="GHC.Tc.Types.Constraint.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ctl_origin :: CtOrigin
</span><a href="GHC.Tc.Types.Constraint.html#ctl_origin"><span class="hs-identifier hs-var">ctl_origin</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621681081258"><span class="hs-identifier hs-var">origin</span></a></span><span>
</span><span id="line-1120"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctl_env :: TcLclEnv
</span><a href="GHC.Tc.Types.Constraint.html#ctl_env"><span class="hs-identifier hs-var">ctl_env</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681081256"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-1121"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctl_t_or_k :: Maybe TypeOrKind
</span><a href="GHC.Tc.Types.Constraint.html#ctl_t_or_k"><span class="hs-identifier hs-var">ctl_t_or_k</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe TypeOrKind
</span><a href="#local-6989586621681081257"><span class="hs-identifier hs-var">t_or_k</span></a></span><span>
</span><span id="line-1122"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ctl_depth :: SubGoalDepth
</span><a href="GHC.Tc.Types.Constraint.html#ctl_depth"><span class="hs-identifier hs-var">ctl_depth</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SubGoalDepth
</span><a href="GHC.Tc.Types.Constraint.html#initialSubGoalDepth"><span class="hs-identifier hs-var">initialSubGoalDepth</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1123"></span><span>
</span><span id="line-1124"></span><span id="local-6989586621681082505"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setCtLocM"><span class="hs-identifier hs-type">setCtLocM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082505"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082505"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1125"></span><span class="hs-comment">-- Set the SrcSpan and error context from the CtLoc</span><span>
</span><span id="line-1126"></span><span id="setCtLocM"><span class="annot"><span class="annottext">setCtLocM :: forall a. CtLoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#setCtLocM"><span class="hs-identifier hs-var hs-var">setCtLocM</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#CtLoc"><span class="hs-identifier hs-type">CtLoc</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ctl_env :: CtLoc -&gt; TcLclEnv
</span><a href="GHC.Tc.Types.Constraint.html#ctl_env"><span class="hs-identifier hs-var">ctl_env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681081249"><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681081249"><span class="hs-identifier hs-var">lcl</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621681081248"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681081248"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1127"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcLclEnv -&gt; TcLclEnv) -&gt; TcM a -&gt; TcM a
forall lcl gbl a.
(lcl -&gt; lcl) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updLclEnv"><span class="hs-identifier hs-var">updLclEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681081247"><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681081247"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681081247"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcl_loc :: RealSrcSpan
</span><a href="GHC.Tc.Types.html#tcl_loc"><span class="hs-identifier hs-var">tcl_loc</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLclEnv -&gt; RealSrcSpan
</span><a href="GHC.Tc.Types.html#tcl_loc"><span class="hs-identifier hs-var hs-var">tcl_loc</span></a></span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681081249"><span class="hs-identifier hs-var">lcl</span></a></span><span>
</span><span id="line-1128"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcl_bndrs :: TcBinderStack
</span><a href="GHC.Tc.Types.html#tcl_bndrs"><span class="hs-identifier hs-var">tcl_bndrs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLclEnv -&gt; TcBinderStack
</span><a href="GHC.Tc.Types.html#tcl_bndrs"><span class="hs-identifier hs-var hs-var">tcl_bndrs</span></a></span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681081249"><span class="hs-identifier hs-var">lcl</span></a></span><span>
</span><span id="line-1129"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tcl_ctxt :: [ErrCtxt]
</span><a href="GHC.Tc.Types.html#tcl_ctxt"><span class="hs-identifier hs-var">tcl_ctxt</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLclEnv -&gt; [ErrCtxt]
</span><a href="GHC.Tc.Types.html#tcl_ctxt"><span class="hs-identifier hs-var hs-var">tcl_ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681081249"><span class="hs-identifier hs-var">lcl</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1130"></span><span>              </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681081248"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1131"></span><span>
</span><span id="line-1132"></span><span>
</span><span id="line-1133"></span><span class="hs-comment">{- *********************************************************************
*                                                                      *
             Error recovery and exceptions
*                                                                      *
********************************************************************* -}</span><span>
</span><span id="line-1138"></span><span>
</span><span id="line-1139"></span><span id="local-6989586621681082503"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#tcTryM"><span class="hs-identifier hs-type">tcTryM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082503"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082503"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1140"></span><span class="hs-comment">-- The most basic function: catch the exception</span><span>
</span><span id="line-1141"></span><span class="hs-comment">--   Nothing =&gt; an exception happened</span><span>
</span><span id="line-1142"></span><span class="hs-comment">--   Just r  =&gt; no exception, result R</span><span>
</span><span id="line-1143"></span><span class="hs-comment">-- Errors and constraints are propagated in both cases</span><span>
</span><span id="line-1144"></span><span class="hs-comment">-- Never throws an exception</span><span>
</span><span id="line-1145"></span><span id="tcTryM"><span class="annot"><span class="annottext">tcTryM :: forall r. TcRn r -&gt; TcRn (Maybe r)
</span><a href="GHC.Tc.Utils.Monad.html#tcTryM"><span class="hs-identifier hs-var hs-var">tcTryM</span></a></span></span><span> </span><span id="local-6989586621681081243"><span class="annot"><span class="annottext">TcRn r
</span><a href="#local-6989586621681081243"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1146"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081242"><span class="annot"><span class="annottext">Either IOEnvFailure r
</span><a href="#local-6989586621681081242"><span class="hs-identifier hs-var">either_res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn r -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Either IOEnvFailure r)
forall env r. IOEnv env r -&gt; IOEnv env (Either IOEnvFailure r)
</span><a href="GHC.Data.IOEnv.html#tryM"><span class="hs-identifier hs-var">tryM</span></a></span><span> </span><span class="annot"><span class="annottext">TcRn r
</span><a href="#local-6989586621681081243"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1147"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Maybe r -&gt; TcRn (Maybe r)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either IOEnvFailure r
</span><a href="#local-6989586621681081242"><span class="hs-identifier hs-var">either_res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1148"></span><span>                    </span><span class="annot"><a href="../../base/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span class="annot"><span class="annottext">IOEnvFailure
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe r
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1149"></span><span>                    </span><span class="annot"><a href="../../base/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621681081241"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681081241"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">r -&gt; Maybe r
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681081241"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1150"></span><span>         </span><span class="hs-comment">-- In the Left case the exception is always the IOEnv</span><span>
</span><span id="line-1151"></span><span>         </span><span class="hs-comment">-- built-in in exception; see IOEnv.failM</span><span>
</span><span id="line-1152"></span><span>
</span><span id="line-1153"></span><span class="hs-comment">-----------------------</span><span>
</span><span id="line-1154"></span><span id="local-6989586621681082501"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#capture_constraints"><span class="hs-identifier hs-type">capture_constraints</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082501"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681082501"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1155"></span><span class="hs-comment">-- capture_constraints simply captures and returns the</span><span>
</span><span id="line-1156"></span><span class="hs-comment">--                     constraints generated by thing_inside</span><span>
</span><span id="line-1157"></span><span class="hs-comment">-- Precondition: thing_inside must not throw an exception!</span><span>
</span><span id="line-1158"></span><span class="hs-comment">-- Reason for precondition: an exception would blow past the place</span><span>
</span><span id="line-1159"></span><span class="hs-comment">-- where we read the lie_var, and we'd lose the constraints altogether</span><span>
</span><span id="line-1160"></span><span id="capture_constraints"><span class="annot"><span class="annottext">capture_constraints :: forall r. TcM r -&gt; TcM (r, WantedConstraints)
</span><a href="GHC.Tc.Utils.Monad.html#capture_constraints"><span class="hs-identifier hs-var hs-var">capture_constraints</span></a></span></span><span> </span><span id="local-6989586621681081235"><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621681081235"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1161"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081234"><span class="annot"><span class="annottext">IORef WantedConstraints
</span><a href="#local-6989586621681081234"><span class="hs-identifier hs-var">lie_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">WantedConstraints
-&gt; TcRnIf TcGblEnv TcLclEnv (IORef WantedConstraints)
forall a gbl lcl. a -&gt; TcRnIf gbl lcl (TcRef a)
</span><a href="GHC.Tc.Utils.Monad.html#newTcRef"><span class="hs-identifier hs-var">newTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="GHC.Tc.Types.Constraint.html#emptyWC"><span class="hs-identifier hs-var">emptyWC</span></a></span><span>
</span><span id="line-1162"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681081233"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681081233"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TcLclEnv -&gt; TcLclEnv) -&gt; TcM r -&gt; TcM r
forall lcl gbl a.
(lcl -&gt; lcl) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updLclEnv"><span class="hs-identifier hs-var">updLclEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681081232"><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681081232"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681081232"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcl_lie :: IORef WantedConstraints
</span><a href="GHC.Tc.Types.html#tcl_lie"><span class="hs-identifier hs-var">tcl_lie</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef WantedConstraints
</span><a href="#local-6989586621681081234"><span class="hs-identifier hs-var">lie_var</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM r -&gt; TcM r) -&gt; TcM r -&gt; TcM r
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1163"></span><span>                </span><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621681081235"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1164"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681081231"><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621681081231"><span class="hs-identifier hs-var">lie</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef WantedConstraints
-&gt; TcRnIf TcGblEnv TcLclEnv WantedConstraints
forall a gbl lcl. TcRef a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef WantedConstraints
</span><a href="#local-6989586621681081234"><span class="hs-identifier hs-var">lie_var</span></a></span><span>
</span><span id="line-1165"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(r, WantedConstraints) -&gt; TcM (r, WantedConstraints)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681081233"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621681081231"><span class="hs-identifier hs-var">lie</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1166"></span><span>
</span><span id="line-1167"></span><span id="local-6989586621681082499"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#capture_messages"><span class="hs-identifier hs-type">capture_messages</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082499"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681082499"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1168"></span><span class="hs-comment">-- capture_messages simply captures and returns the</span><span>
</span><span id="line-1169"></span><span class="hs-comment">--                  errors arnd warnings generated by thing_inside</span><span>
</span><span id="line-1170"></span><span class="hs-comment">-- Precondition: thing_inside must not throw an exception!</span><span>
</span><span id="line-1171"></span><span class="hs-comment">-- Reason for precondition: an exception would blow past the place</span><span>
</span><span id="line-1172"></span><span class="hs-comment">-- where we read the msg_var, and we'd lose the constraints altogether</span><span>
</span><span id="line-1173"></span><span id="capture_messages"><span class="annot"><span class="annottext">capture_messages :: forall r. TcM r -&gt; TcM (r, Messages)
</span><a href="GHC.Tc.Utils.Monad.html#capture_messages"><span class="hs-identifier hs-var hs-var">capture_messages</span></a></span></span><span> </span><span id="local-6989586621681081225"><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621681081225"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1174"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081224"><span class="annot"><span class="annottext">IORef Messages
</span><a href="#local-6989586621681081224"><span class="hs-identifier hs-var">msg_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Messages -&gt; TcRn (IORef Messages)
forall a gbl lcl. a -&gt; TcRnIf gbl lcl (TcRef a)
</span><a href="GHC.Tc.Utils.Monad.html#newTcRef"><span class="hs-identifier hs-var">newTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">Messages
</span><a href="GHC.Utils.Error.html#emptyMessages"><span class="hs-identifier hs-var">emptyMessages</span></a></span><span>
</span><span id="line-1175"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681081222"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681081222"><span class="hs-identifier hs-var">res</span></a></span></span><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef Messages -&gt; TcM r -&gt; TcM r
forall a. IORef Messages -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setErrsVar"><span class="hs-identifier hs-var">setErrsVar</span></a></span><span> </span><span class="annot"><span class="annottext">IORef Messages
</span><a href="#local-6989586621681081224"><span class="hs-identifier hs-var">msg_var</span></a></span><span> </span><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621681081225"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1176"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681081221"><span class="annot"><span class="annottext">Messages
</span><a href="#local-6989586621681081221"><span class="hs-identifier hs-var">msgs</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef Messages -&gt; TcRnIf TcGblEnv TcLclEnv Messages
forall a gbl lcl. TcRef a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef Messages
</span><a href="#local-6989586621681081224"><span class="hs-identifier hs-var">msg_var</span></a></span><span>
</span><span id="line-1177"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(r, Messages) -&gt; TcM (r, Messages)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681081222"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Messages
</span><a href="#local-6989586621681081221"><span class="hs-identifier hs-var">msgs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1178"></span><span>
</span><span id="line-1179"></span><span class="hs-comment">-----------------------</span><span>
</span><span id="line-1180"></span><span class="hs-comment">-- (askNoErrs m) runs m</span><span>
</span><span id="line-1181"></span><span class="hs-comment">-- If m fails,</span><span>
</span><span id="line-1182"></span><span class="hs-comment">--    then (askNoErrs m) fails, propagating only</span><span>
</span><span id="line-1183"></span><span class="hs-comment">--         insoluble constraints</span><span>
</span><span id="line-1184"></span><span class="hs-comment">--</span><span>
</span><span id="line-1185"></span><span class="hs-comment">-- If m succeeds with result r,</span><span>
</span><span id="line-1186"></span><span class="hs-comment">--    then (askNoErrs m) succeeds with result (r, b),</span><span>
</span><span id="line-1187"></span><span class="hs-comment">--         where b is True iff m generated no errors</span><span>
</span><span id="line-1188"></span><span class="hs-comment">--</span><span>
</span><span id="line-1189"></span><span class="hs-comment">-- Regardless of success or failure,</span><span>
</span><span id="line-1190"></span><span class="hs-comment">--   propagate any errors/warnings generated by m</span><span>
</span><span id="line-1191"></span><span id="local-6989586621681082523"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#askNoErrs"><span class="hs-identifier hs-type">askNoErrs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082523"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681082523"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span></span><span>
</span><span id="line-1192"></span><span id="askNoErrs"><span class="annot"><span class="annottext">askNoErrs :: forall a. TcRn a -&gt; TcRn (a, Bool)
</span><a href="GHC.Tc.Utils.Monad.html#askNoErrs"><span class="hs-identifier hs-var hs-var">askNoErrs</span></a></span></span><span> </span><span id="local-6989586621681081213"><span class="annot"><span class="annottext">TcRn a
</span><a href="#local-6989586621681081213"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1193"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621681081212"><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621681081212"><span class="hs-identifier hs-var">mb_res</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681081211"><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621681081211"><span class="hs-identifier hs-var">lie</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621681081210"><span class="annot"><span class="annottext">Messages
</span><a href="#local-6989586621681081210"><span class="hs-identifier hs-var">msgs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM (Maybe a, WantedConstraints)
-&gt; TcM ((Maybe a, WantedConstraints), Messages)
forall r. TcM r -&gt; TcM (r, Messages)
</span><a href="GHC.Tc.Utils.Monad.html#capture_messages"><span class="hs-identifier hs-var">capture_messages</span></a></span><span>    </span><span class="annot"><span class="annottext">(TcM (Maybe a, WantedConstraints)
 -&gt; TcM ((Maybe a, WantedConstraints), Messages))
-&gt; TcM (Maybe a, WantedConstraints)
-&gt; TcM ((Maybe a, WantedConstraints), Messages)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1194"></span><span>                                  </span><span class="annot"><span class="annottext">TcM (Maybe a) -&gt; TcM (Maybe a, WantedConstraints)
forall r. TcM r -&gt; TcM (r, WantedConstraints)
</span><a href="GHC.Tc.Utils.Monad.html#capture_constraints"><span class="hs-identifier hs-var">capture_constraints</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (Maybe a) -&gt; TcM (Maybe a, WantedConstraints))
-&gt; TcM (Maybe a) -&gt; TcM (Maybe a, WantedConstraints)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1195"></span><span>                                  </span><span class="annot"><span class="annottext">TcRn a -&gt; TcM (Maybe a)
forall r. TcRn r -&gt; TcRn (Maybe r)
</span><a href="GHC.Tc.Utils.Monad.html#tcTryM"><span class="hs-identifier hs-var">tcTryM</span></a></span><span> </span><span class="annot"><span class="annottext">TcRn a
</span><a href="#local-6989586621681081213"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1196"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Messages -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addMessages"><span class="hs-identifier hs-var">addMessages</span></a></span><span> </span><span class="annot"><span class="annottext">Messages
</span><a href="#local-6989586621681081210"><span class="hs-identifier hs-var">msgs</span></a></span><span>
</span><span id="line-1197"></span><span>
</span><span id="line-1198"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621681081212"><span class="hs-identifier hs-var">mb_res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1199"></span><span>           </span><span class="annot"><span class="annottext">Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">WantedConstraints -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#emitConstraints"><span class="hs-identifier hs-var">emitConstraints</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WantedConstraints -&gt; WantedConstraints
</span><a href="GHC.Tc.Types.Constraint.html#dropMisleading"><span class="hs-identifier hs-var">dropMisleading</span></a></span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621681081211"><span class="hs-identifier hs-var">lie</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1200"></span><span>                          </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcRn (a, Bool)
forall env a. IOEnv env a
</span><a href="GHC.Data.IOEnv.html#failM"><span class="hs-identifier hs-var">failM</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1201"></span><span>
</span><span id="line-1202"></span><span>           </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681081208"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681081208"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">WantedConstraints -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#emitConstraints"><span class="hs-identifier hs-var">emitConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621681081211"><span class="hs-identifier hs-var">lie</span></a></span><span>
</span><span id="line-1203"></span><span>                          </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681081207"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681081207"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-1204"></span><span>                          </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681081206"><span class="annot"><span class="annottext">errs_found :: Bool
</span><a href="#local-6989586621681081206"><span class="hs-identifier hs-var hs-var">errs_found</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Messages -&gt; Bool
</span><a href="GHC.Utils.Error.html#errorsFound"><span class="hs-identifier hs-var">errorsFound</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681081207"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Messages
</span><a href="#local-6989586621681081210"><span class="hs-identifier hs-var">msgs</span></a></span><span>
</span><span id="line-1205"></span><span>                                          </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">WantedConstraints -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#insolubleWC"><span class="hs-identifier hs-var">insolubleWC</span></a></span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621681081211"><span class="hs-identifier hs-var">lie</span></a></span><span>
</span><span id="line-1206"></span><span>                          </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(a, Bool) -&gt; TcRn (a, Bool)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681081208"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681081206"><span class="hs-identifier hs-var">errs_found</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1207"></span><span>
</span><span id="line-1208"></span><span class="hs-comment">-----------------------</span><span>
</span><span id="line-1209"></span><span id="local-6989586621681082496"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#tryCaptureConstraints"><span class="hs-identifier hs-type">tryCaptureConstraints</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082496"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082496"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1210"></span><span class="hs-comment">-- (tryCaptureConstraints_maybe m) runs m,</span><span>
</span><span id="line-1211"></span><span class="hs-comment">--   and returns the type constraints it generates</span><span>
</span><span id="line-1212"></span><span class="hs-comment">-- It never throws an exception; instead if thing_inside fails,</span><span>
</span><span id="line-1213"></span><span class="hs-comment">--   it returns Nothing and the /insoluble/ constraints</span><span>
</span><span id="line-1214"></span><span class="hs-comment">-- Error messages are propagated</span><span>
</span><span id="line-1215"></span><span id="tryCaptureConstraints"><span class="annot"><span class="annottext">tryCaptureConstraints :: forall a. TcM a -&gt; TcM (Maybe a, WantedConstraints)
</span><a href="GHC.Tc.Utils.Monad.html#tryCaptureConstraints"><span class="hs-identifier hs-var hs-var">tryCaptureConstraints</span></a></span></span><span> </span><span id="local-6989586621681081202"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681081202"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1216"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681081201"><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621681081201"><span class="hs-identifier hs-var">mb_res</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681081200"><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621681081200"><span class="hs-identifier hs-var">lie</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM (Maybe a) -&gt; TcM (Maybe a, WantedConstraints)
forall r. TcM r -&gt; TcM (r, WantedConstraints)
</span><a href="GHC.Tc.Utils.Monad.html#capture_constraints"><span class="hs-identifier hs-var">capture_constraints</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (Maybe a) -&gt; TcM (Maybe a, WantedConstraints))
-&gt; TcM (Maybe a) -&gt; TcM (Maybe a, WantedConstraints)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1217"></span><span>                          </span><span class="annot"><span class="annottext">TcM a -&gt; TcM (Maybe a)
forall r. TcRn r -&gt; TcRn (Maybe r)
</span><a href="GHC.Tc.Utils.Monad.html#tcTryM"><span class="hs-identifier hs-var">tcTryM</span></a></span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681081202"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1218"></span><span>
</span><span id="line-1219"></span><span>       </span><span class="hs-comment">-- See Note [Constraints and errors]</span><span>
</span><span id="line-1220"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681081199"><span class="annot"><span class="annottext">lie_to_keep :: WantedConstraints
</span><a href="#local-6989586621681081199"><span class="hs-identifier hs-var hs-var">lie_to_keep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621681081201"><span class="hs-identifier hs-var">mb_res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1221"></span><span>                             </span><span class="annot"><span class="annottext">Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WantedConstraints -&gt; WantedConstraints
</span><a href="GHC.Tc.Types.Constraint.html#dropMisleading"><span class="hs-identifier hs-var">dropMisleading</span></a></span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621681081200"><span class="hs-identifier hs-var">lie</span></a></span><span>
</span><span id="line-1222"></span><span>                             </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621681081200"><span class="hs-identifier hs-var">lie</span></a></span><span>
</span><span id="line-1223"></span><span>
</span><span id="line-1224"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(Maybe a, WantedConstraints) -&gt; TcM (Maybe a, WantedConstraints)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621681081201"><span class="hs-identifier hs-var">mb_res</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621681081199"><span class="hs-identifier hs-var">lie_to_keep</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1225"></span><span>
</span><span id="line-1226"></span><span id="local-6989586621681081198"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#captureConstraints"><span class="hs-identifier hs-type">captureConstraints</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681081198"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681081198"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1227"></span><span class="hs-comment">-- (captureConstraints m) runs m, and returns the type constraints it generates</span><span>
</span><span id="line-1228"></span><span class="hs-comment">-- If thing_inside fails (throwing an exception),</span><span>
</span><span id="line-1229"></span><span class="hs-comment">--   then (captureConstraints thing_inside) fails too</span><span>
</span><span id="line-1230"></span><span class="hs-comment">--   propagating the insoluble constraints only</span><span>
</span><span id="line-1231"></span><span class="hs-comment">-- Error messages are propagated in either case</span><span>
</span><span id="line-1232"></span><span id="captureConstraints"><span class="annot"><span class="annottext">captureConstraints :: forall r. TcM r -&gt; TcM (r, WantedConstraints)
</span><a href="GHC.Tc.Utils.Monad.html#captureConstraints"><span class="hs-identifier hs-var hs-var">captureConstraints</span></a></span></span><span> </span><span id="local-6989586621681081194"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681081194"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1233"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681081193"><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621681081193"><span class="hs-identifier hs-var">mb_res</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681081192"><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621681081192"><span class="hs-identifier hs-var">lie</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM a -&gt; TcM (Maybe a, WantedConstraints)
forall a. TcM a -&gt; TcM (Maybe a, WantedConstraints)
</span><a href="GHC.Tc.Utils.Monad.html#tryCaptureConstraints"><span class="hs-identifier hs-var">tryCaptureConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681081194"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1234"></span><span>
</span><span id="line-1235"></span><span>            </span><span class="hs-comment">-- See Note [Constraints and errors]</span><span>
</span><span id="line-1236"></span><span>            </span><span class="hs-comment">-- If the thing_inside threw an exception, emit the insoluble</span><span>
</span><span id="line-1237"></span><span>            </span><span class="hs-comment">-- constraints only (returned by tryCaptureConstraints)</span><span>
</span><span id="line-1238"></span><span>            </span><span class="hs-comment">-- so that they are not lost</span><span>
</span><span id="line-1239"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621681081193"><span class="hs-identifier hs-var">mb_res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1240"></span><span>           </span><span class="annot"><span class="annottext">Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">WantedConstraints -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#emitConstraints"><span class="hs-identifier hs-var">emitConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621681081192"><span class="hs-identifier hs-var">lie</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcM (a, WantedConstraints)
forall env a. IOEnv env a
</span><a href="GHC.Data.IOEnv.html#failM"><span class="hs-identifier hs-var">failM</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1241"></span><span>           </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681081191"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681081191"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(a, WantedConstraints) -&gt; TcM (a, WantedConstraints)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681081191"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621681081192"><span class="hs-identifier hs-var">lie</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1242"></span><span>
</span><span id="line-1243"></span><span class="hs-comment">-----------------------</span><span>
</span><span id="line-1244"></span><span class="hs-comment">-- | @tcCollectingUsage thing_inside@ runs @thing_inside@ and returns the usage</span><span>
</span><span id="line-1245"></span><span class="hs-comment">-- information which was collected as part of the execution of</span><span>
</span><span id="line-1246"></span><span class="hs-comment">-- @thing_inside@. Careful: @tcCollectingUsage thing_inside@ itself does not</span><span>
</span><span id="line-1247"></span><span class="hs-comment">-- report any usage information, it's up to the caller to incorporate the</span><span>
</span><span id="line-1248"></span><span class="hs-comment">-- returned usage information into the larger context appropriately.</span><span>
</span><span id="line-1249"></span><span id="local-6989586621681082493"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#tcCollectingUsage"><span class="hs-identifier hs-type">tcCollectingUsage</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082493"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.UsageEnv.html#UsageEnv"><span class="hs-identifier hs-type">UsageEnv</span></a></span><span class="hs-special">,</span><span class="annot"><a href="#local-6989586621681082493"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1250"></span><span id="tcCollectingUsage"><span class="annot"><span class="annottext">tcCollectingUsage :: forall a. TcM a -&gt; TcM (UsageEnv, a)
</span><a href="GHC.Tc.Utils.Monad.html#tcCollectingUsage"><span class="hs-identifier hs-var hs-var">tcCollectingUsage</span></a></span></span><span> </span><span id="local-6989586621681081185"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681081185"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1251"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081184"><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681081184"><span class="hs-identifier hs-var">env0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcLclEnv
forall gbl lcl. TcRnIf gbl lcl lcl
</span><a href="GHC.Tc.Utils.Monad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a></span><span>
</span><span id="line-1252"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681081183"><span class="annot"><span class="annottext">IORef UsageEnv
</span><a href="#local-6989586621681081183"><span class="hs-identifier hs-var">local_usage_ref</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UsageEnv -&gt; TcRnIf TcGblEnv TcLclEnv (IORef UsageEnv)
forall a gbl lcl. a -&gt; TcRnIf gbl lcl (TcRef a)
</span><a href="GHC.Tc.Utils.Monad.html#newTcRef"><span class="hs-identifier hs-var">newTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">UsageEnv
</span><a href="GHC.Core.UsageEnv.html#zeroUE"><span class="hs-identifier hs-var">zeroUE</span></a></span><span>
</span><span id="line-1253"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681081182"><span class="annot"><span class="annottext">env1 :: TcLclEnv
</span><a href="#local-6989586621681081182"><span class="hs-identifier hs-var hs-var">env1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681081184"><span class="hs-identifier hs-var">env0</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcl_usage :: IORef UsageEnv
</span><a href="GHC.Tc.Types.html#tcl_usage"><span class="hs-identifier hs-var">tcl_usage</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef UsageEnv
</span><a href="#local-6989586621681081183"><span class="hs-identifier hs-var">local_usage_ref</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1254"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681081181"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681081181"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcLclEnv -&gt; TcM a -&gt; TcM a
forall lcl' gbl a lcl.
lcl' -&gt; TcRnIf gbl lcl' a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#setLclEnv"><span class="hs-identifier hs-var">setLclEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681081182"><span class="hs-identifier hs-var">env1</span></a></span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681081185"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1255"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681081180"><span class="annot"><span class="annottext">UsageEnv
</span><a href="#local-6989586621681081180"><span class="hs-identifier hs-var">local_usage</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef UsageEnv -&gt; TcRnIf TcGblEnv TcLclEnv UsageEnv
forall a gbl lcl. TcRef a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef UsageEnv
</span><a href="#local-6989586621681081183"><span class="hs-identifier hs-var">local_usage_ref</span></a></span><span>
</span><span id="line-1256"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(UsageEnv, a) -&gt; TcM (UsageEnv, a)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UsageEnv
</span><a href="#local-6989586621681081180"><span class="hs-identifier hs-var">local_usage</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681081181"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1257"></span><span>
</span><span id="line-1258"></span><span class="hs-comment">-- | @tcScalingUsage mult thing_inside@ runs @thing_inside@ and scales all the</span><span>
</span><span id="line-1259"></span><span class="hs-comment">-- usage information by @mult@.</span><span>
</span><span id="line-1260"></span><span id="local-6989586621681082491"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-type">tcScalingUsage</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Mult"><span class="hs-identifier hs-type">Mult</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082491"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082491"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1261"></span><span id="tcScalingUsage"><span class="annot"><span class="annottext">tcScalingUsage :: forall a. Type -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-var hs-var">tcScalingUsage</span></a></span></span><span> </span><span id="local-6989586621681081173"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681081173"><span class="hs-identifier hs-var">mult</span></a></span></span><span> </span><span id="local-6989586621681081172"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681081172"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1262"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681081171"><span class="annot"><span class="annottext">UsageEnv
</span><a href="#local-6989586621681081171"><span class="hs-identifier hs-var">usage</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681081170"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681081170"><span class="hs-identifier hs-var">result</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM a -&gt; TcM (UsageEnv, a)
forall a. TcM a -&gt; TcM (UsageEnv, a)
</span><a href="GHC.Tc.Utils.Monad.html#tcCollectingUsage"><span class="hs-identifier hs-var">tcCollectingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681081172"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1263"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;tcScalingUsage&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681081173"><span class="hs-identifier hs-var">mult</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1264"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">UsageEnv -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#tcEmitBindingUsage"><span class="hs-identifier hs-var">tcEmitBindingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">(UsageEnv -&gt; TcM ()) -&gt; UsageEnv -&gt; TcM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; UsageEnv -&gt; UsageEnv
</span><a href="GHC.Core.UsageEnv.html#scaleUE"><span class="hs-identifier hs-var">scaleUE</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681081173"><span class="hs-identifier hs-var">mult</span></a></span><span> </span><span class="annot"><span class="annottext">UsageEnv
</span><a href="#local-6989586621681081171"><span class="hs-identifier hs-var">usage</span></a></span><span>
</span><span id="line-1265"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">a -&gt; TcM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681081170"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1266"></span><span>
</span><span id="line-1267"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#tcEmitBindingUsage"><span class="hs-identifier hs-type">tcEmitBindingUsage</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.UsageEnv.html#UsageEnv"><span class="hs-identifier hs-type">UsageEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1268"></span><span id="tcEmitBindingUsage"><span class="annot"><span class="annottext">tcEmitBindingUsage :: UsageEnv -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#tcEmitBindingUsage"><span class="hs-identifier hs-var hs-var">tcEmitBindingUsage</span></a></span></span><span> </span><span id="local-6989586621681081168"><span class="annot"><span class="annottext">UsageEnv
</span><a href="#local-6989586621681081168"><span class="hs-identifier hs-var">ue</span></a></span></span><span>
</span><span id="line-1269"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081167"><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681081167"><span class="hs-identifier hs-var">lcl_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcLclEnv
forall gbl lcl. TcRnIf gbl lcl lcl
</span><a href="GHC.Tc.Utils.Monad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a></span><span>
</span><span id="line-1270"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681081166"><span class="annot"><span class="annottext">usage :: IORef UsageEnv
</span><a href="#local-6989586621681081166"><span class="hs-identifier hs-var hs-var">usage</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLclEnv -&gt; IORef UsageEnv
</span><a href="GHC.Tc.Types.html#tcl_usage"><span class="hs-identifier hs-var hs-var">tcl_usage</span></a></span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681081167"><span class="hs-identifier hs-var">lcl_env</span></a></span><span>
</span><span id="line-1271"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">IORef UsageEnv -&gt; (UsageEnv -&gt; UsageEnv) -&gt; TcM ()
forall a gbl lcl. TcRef a -&gt; (a -&gt; a) -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#updTcRef"><span class="hs-identifier hs-var">updTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef UsageEnv
</span><a href="#local-6989586621681081166"><span class="hs-identifier hs-var">usage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UsageEnv -&gt; UsageEnv -&gt; UsageEnv
</span><a href="GHC.Core.UsageEnv.html#addUE"><span class="hs-identifier hs-var">addUE</span></a></span><span> </span><span class="annot"><span class="annottext">UsageEnv
</span><a href="#local-6989586621681081168"><span class="hs-identifier hs-var">ue</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1272"></span><span>
</span><span id="line-1273"></span><span class="hs-comment">-----------------------</span><span>
</span><span id="line-1274"></span><span id="local-6989586621681081164"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#attemptM"><span class="hs-identifier hs-type">attemptM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681081164"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681081164"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1275"></span><span class="hs-comment">-- (attemptM thing_inside) runs thing_inside</span><span>
</span><span id="line-1276"></span><span class="hs-comment">-- If thing_inside succeeds, returning r,</span><span>
</span><span id="line-1277"></span><span class="hs-comment">--   we return (Just r), and propagate all constraints and errors</span><span>
</span><span id="line-1278"></span><span class="hs-comment">-- If thing_inside fail, throwing an exception,</span><span>
</span><span id="line-1279"></span><span class="hs-comment">--   we return Nothing, propagating insoluble constraints,</span><span>
</span><span id="line-1280"></span><span class="hs-comment">--                      and all errors</span><span>
</span><span id="line-1281"></span><span class="hs-comment">-- attemptM never throws an exception</span><span>
</span><span id="line-1282"></span><span id="attemptM"><span class="annot"><span class="annottext">attemptM :: forall r. TcRn r -&gt; TcRn (Maybe r)
</span><a href="GHC.Tc.Utils.Monad.html#attemptM"><span class="hs-identifier hs-var hs-var">attemptM</span></a></span></span><span> </span><span id="local-6989586621681081157"><span class="annot"><span class="annottext">TcRn r
</span><a href="#local-6989586621681081157"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1283"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681081156"><span class="annot"><span class="annottext">Maybe r
</span><a href="#local-6989586621681081156"><span class="hs-identifier hs-var">mb_r</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681081155"><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621681081155"><span class="hs-identifier hs-var">lie</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn r -&gt; TcM (Maybe r, WantedConstraints)
forall a. TcM a -&gt; TcM (Maybe a, WantedConstraints)
</span><a href="GHC.Tc.Utils.Monad.html#tryCaptureConstraints"><span class="hs-identifier hs-var">tryCaptureConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">TcRn r
</span><a href="#local-6989586621681081157"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1284"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">WantedConstraints -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#emitConstraints"><span class="hs-identifier hs-var">emitConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621681081155"><span class="hs-identifier hs-var">lie</span></a></span><span>
</span><span id="line-1285"></span><span>
</span><span id="line-1286"></span><span>       </span><span class="hs-comment">-- Debug trace</span><span>
</span><span id="line-1287"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcM () -&gt; TcM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe r -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../../base/src/Data.Maybe.html#isNothing"><span class="hs-identifier hs-var">isNothing</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe r
</span><a href="#local-6989586621681081156"><span class="hs-identifier hs-var">mb_r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM () -&gt; TcM ()) -&gt; TcM () -&gt; TcM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1288"></span><span>         </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;attemptM recovering with insoluble constraints&quot;</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; TcM ()) -&gt; SDoc -&gt; TcM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1289"></span><span>                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WantedConstraints -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621681081155"><span class="hs-identifier hs-var">lie</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1290"></span><span>
</span><span id="line-1291"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Maybe r -&gt; TcRn (Maybe r)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe r
</span><a href="#local-6989586621681081156"><span class="hs-identifier hs-var">mb_r</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1292"></span><span>
</span><span id="line-1293"></span><span class="hs-comment">-----------------------</span><span>
</span><span id="line-1294"></span><span id="local-6989586621681081153"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#recoverM"><span class="hs-identifier hs-type">recoverM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681081153"><span class="hs-identifier hs-type">r</span></a></span><span>      </span><span class="hs-comment">-- Recovery action; do this if the main one fails</span><span>
</span><span id="line-1295"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681081153"><span class="hs-identifier hs-type">r</span></a></span><span>      </span><span class="hs-comment">-- Main action: do this first;</span><span>
</span><span id="line-1296"></span><span>                        </span><span class="hs-comment">--  if it generates errors, propagate them all</span><span>
</span><span id="line-1297"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681081153"><span class="hs-identifier hs-type">r</span></a></span></span><span>
</span><span id="line-1298"></span><span class="hs-comment">-- (recoverM recover thing_inside) runs thing_inside</span><span>
</span><span id="line-1299"></span><span class="hs-comment">-- If thing_inside fails, propagate its errors and insoluble constraints</span><span>
</span><span id="line-1300"></span><span class="hs-comment">--                        and run 'recover'</span><span>
</span><span id="line-1301"></span><span class="hs-comment">-- If thing_inside succeeds, propagate all its errors and constraints</span><span>
</span><span id="line-1302"></span><span class="hs-comment">--</span><span>
</span><span id="line-1303"></span><span class="hs-comment">-- Can fail, if 'recover' fails</span><span>
</span><span id="line-1304"></span><span id="recoverM"><span class="annot"><span class="annottext">recoverM :: forall r. TcRn r -&gt; TcRn r -&gt; TcRn r
</span><a href="GHC.Tc.Utils.Monad.html#recoverM"><span class="hs-identifier hs-var hs-var">recoverM</span></a></span></span><span> </span><span id="local-6989586621681081150"><span class="annot"><span class="annottext">TcRn r
</span><a href="#local-6989586621681081150"><span class="hs-identifier hs-var">recover</span></a></span></span><span> </span><span id="local-6989586621681081149"><span class="annot"><span class="annottext">TcRn r
</span><a href="#local-6989586621681081149"><span class="hs-identifier hs-var">thing</span></a></span></span><span>
</span><span id="line-1305"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081148"><span class="annot"><span class="annottext">Maybe r
</span><a href="#local-6989586621681081148"><span class="hs-identifier hs-var">mb_res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn r -&gt; TcRn (Maybe r)
forall r. TcRn r -&gt; TcRn (Maybe r)
</span><a href="GHC.Tc.Utils.Monad.html#attemptM"><span class="hs-identifier hs-var">attemptM</span></a></span><span> </span><span class="annot"><span class="annottext">TcRn r
</span><a href="#local-6989586621681081149"><span class="hs-identifier hs-var">thing</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1306"></span><span>         </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe r
</span><a href="#local-6989586621681081148"><span class="hs-identifier hs-var">mb_res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1307"></span><span>           </span><span class="annot"><span class="annottext">Maybe r
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcRn r
</span><a href="#local-6989586621681081150"><span class="hs-identifier hs-var">recover</span></a></span><span>
</span><span id="line-1308"></span><span>           </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681081147"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681081147"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">r -&gt; TcRn r
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681081147"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1309"></span><span>
</span><span id="line-1310"></span><span class="hs-comment">-----------------------</span><span>
</span><span id="line-1311"></span><span>
</span><span id="line-1312"></span><span class="hs-comment">-- | Drop elements of the input that fail, so the result</span><span>
</span><span id="line-1313"></span><span class="hs-comment">-- list can be shorter than the argument list</span><span>
</span><span id="line-1314"></span><span id="local-6989586621681082486"><span id="local-6989586621681082487"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#mapAndRecoverM"><span class="hs-identifier hs-type">mapAndRecoverM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681082487"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082486"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621681082487"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621681082486"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">]</span></span></span><span>
</span><span id="line-1315"></span><span id="mapAndRecoverM"><span class="annot"><span class="annottext">mapAndRecoverM :: forall a b. (a -&gt; TcRn b) -&gt; [a] -&gt; TcRn [b]
</span><a href="GHC.Tc.Utils.Monad.html#mapAndRecoverM"><span class="hs-identifier hs-var hs-var">mapAndRecoverM</span></a></span></span><span> </span><span id="local-6989586621681081141"><span class="annot"><span class="annottext">a -&gt; TcRn b
</span><a href="#local-6989586621681081141"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621681081140"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621681081140"><span class="hs-identifier hs-var">xs</span></a></span></span><span>
</span><span id="line-1316"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081139"><span class="annot"><span class="annottext">[Maybe b]
</span><a href="#local-6989586621681081139"><span class="hs-identifier hs-var">mb_rs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(a -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe b))
-&gt; [a] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [Maybe b]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcRn b -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe b)
forall r. TcRn r -&gt; TcRn (Maybe r)
</span><a href="GHC.Tc.Utils.Monad.html#attemptM"><span class="hs-identifier hs-var">attemptM</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn b -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe b))
-&gt; (a -&gt; TcRn b) -&gt; a -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe b)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; TcRn b
</span><a href="#local-6989586621681081141"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621681081140"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-1317"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">[b] -&gt; TcRn [b]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621681081136"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681081136"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621681081136"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Maybe b]
</span><a href="#local-6989586621681081139"><span class="hs-identifier hs-var">mb_rs</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1318"></span><span>
</span><span id="line-1319"></span><span class="hs-comment">-- | Apply the function to all elements on the input list</span><span>
</span><span id="line-1320"></span><span class="hs-comment">-- If all succeed, return the list of results</span><span>
</span><span id="line-1321"></span><span class="hs-comment">-- Otherwise fail, propagating all errors</span><span>
</span><span id="line-1322"></span><span id="local-6989586621681081134"><span id="local-6989586621681081135"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#mapAndReportM"><span class="hs-identifier hs-type">mapAndReportM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681081135"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681081134"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621681081135"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621681081134"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">]</span></span></span><span>
</span><span id="line-1323"></span><span id="mapAndReportM"><span class="annot"><span class="annottext">mapAndReportM :: forall a b. (a -&gt; TcRn b) -&gt; [a] -&gt; TcRn [b]
</span><a href="GHC.Tc.Utils.Monad.html#mapAndReportM"><span class="hs-identifier hs-var hs-var">mapAndReportM</span></a></span></span><span> </span><span id="local-6989586621681081126"><span class="annot"><span class="annottext">a -&gt; TcRn b
</span><a href="#local-6989586621681081126"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621681081125"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621681081125"><span class="hs-identifier hs-var">xs</span></a></span></span><span>
</span><span id="line-1324"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081124"><span class="annot"><span class="annottext">[Maybe b]
</span><a href="#local-6989586621681081124"><span class="hs-identifier hs-var">mb_rs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(a -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe b))
-&gt; [a] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [Maybe b]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcRn b -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe b)
forall r. TcRn r -&gt; TcRn (Maybe r)
</span><a href="GHC.Tc.Utils.Monad.html#attemptM"><span class="hs-identifier hs-var">attemptM</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn b -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe b))
-&gt; (a -&gt; TcRn b) -&gt; a -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe b)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; TcRn b
</span><a href="#local-6989586621681081126"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621681081125"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-1325"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcM () -&gt; TcM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Maybe b -&gt; Bool) -&gt; [Maybe b] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe b -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../../base/src/Data.Maybe.html#isNothing"><span class="hs-identifier hs-var">isNothing</span></a></span><span> </span><span class="annot"><span class="annottext">[Maybe b]
</span><a href="#local-6989586621681081124"><span class="hs-identifier hs-var">mb_rs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcM ()
forall env a. IOEnv env a
</span><a href="GHC.Data.IOEnv.html#failM"><span class="hs-identifier hs-var">failM</span></a></span><span>
</span><span id="line-1326"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">[b] -&gt; TcRn [b]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621681081122"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681081122"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621681081122"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Maybe b]
</span><a href="#local-6989586621681081124"><span class="hs-identifier hs-var">mb_rs</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1327"></span><span>
</span><span id="line-1328"></span><span class="hs-comment">-- | The accumulator is not updated if the action fails</span><span>
</span><span id="line-1329"></span><span id="local-6989586621681082471"><span id="local-6989586621681082472"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#foldAndRecoverM"><span class="hs-identifier hs-type">foldAndRecoverM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681082472"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681082471"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082472"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681082472"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621681082471"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082472"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-1330"></span><span id="foldAndRecoverM"><span class="annot"><span class="annottext">foldAndRecoverM :: forall b a. (b -&gt; a -&gt; TcRn b) -&gt; b -&gt; [a] -&gt; TcRn b
</span><a href="GHC.Tc.Utils.Monad.html#foldAndRecoverM"><span class="hs-identifier hs-var hs-var">foldAndRecoverM</span></a></span></span><span> </span><span class="annot"><span class="annottext">b -&gt; a -&gt; TcRn b
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681081119"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621681081119"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">b -&gt; TcRn b
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621681081119"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-1331"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#foldAndRecoverM"><span class="hs-identifier hs-var">foldAndRecoverM</span></a></span><span> </span><span id="local-6989586621681081118"><span class="annot"><span class="annottext">b -&gt; a -&gt; TcRn b
</span><a href="#local-6989586621681081118"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621681081117"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621681081117"><span class="hs-identifier hs-var">acc</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681081116"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681081116"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681081115"><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621681081115"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1332"></span><span>                          </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081114"><span class="annot"><span class="annottext">Maybe b
</span><a href="#local-6989586621681081114"><span class="hs-identifier hs-var">mb_r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn b -&gt; TcRn (Maybe b)
forall r. TcRn r -&gt; TcRn (Maybe r)
</span><a href="GHC.Tc.Utils.Monad.html#attemptM"><span class="hs-identifier hs-var">attemptM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">b -&gt; a -&gt; TcRn b
</span><a href="#local-6989586621681081118"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621681081117"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681081116"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1333"></span><span>                             </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe b
</span><a href="#local-6989586621681081114"><span class="hs-identifier hs-var">mb_r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1334"></span><span>                                </span><span class="annot"><span class="annottext">Maybe b
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(b -&gt; a -&gt; TcRn b) -&gt; b -&gt; [a] -&gt; TcRn b
forall b a. (b -&gt; a -&gt; TcRn b) -&gt; b -&gt; [a] -&gt; TcRn b
</span><a href="GHC.Tc.Utils.Monad.html#foldAndRecoverM"><span class="hs-identifier hs-var">foldAndRecoverM</span></a></span><span> </span><span class="annot"><span class="annottext">b -&gt; a -&gt; TcRn b
</span><a href="#local-6989586621681081118"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621681081117"><span class="hs-identifier hs-var">acc</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621681081115"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-1335"></span><span>                                </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681081113"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621681081113"><span class="hs-identifier hs-var">acc'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(b -&gt; a -&gt; TcRn b) -&gt; b -&gt; [a] -&gt; TcRn b
forall b a. (b -&gt; a -&gt; TcRn b) -&gt; b -&gt; [a] -&gt; TcRn b
</span><a href="GHC.Tc.Utils.Monad.html#foldAndRecoverM"><span class="hs-identifier hs-var">foldAndRecoverM</span></a></span><span> </span><span class="annot"><span class="annottext">b -&gt; a -&gt; TcRn b
</span><a href="#local-6989586621681081118"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621681081113"><span class="hs-identifier hs-var">acc'</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621681081115"><span class="hs-identifier hs-var">xs</span></a></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-1336"></span><span>
</span><span id="line-1337"></span><span class="hs-comment">-----------------------</span><span>
</span><span id="line-1338"></span><span id="local-6989586621681082468"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#tryTc"><span class="hs-identifier hs-type">tryTc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082468"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082468"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1339"></span><span class="hs-comment">-- (tryTc m) executes m, and returns</span><span>
</span><span id="line-1340"></span><span class="hs-comment">--      Just r,  if m succeeds (returning r)</span><span>
</span><span id="line-1341"></span><span class="hs-comment">--      Nothing, if m fails</span><span>
</span><span id="line-1342"></span><span class="hs-comment">-- It also returns all the errors and warnings accumulated by m</span><span>
</span><span id="line-1343"></span><span class="hs-comment">-- It always succeeds (never raises an exception)</span><span>
</span><span id="line-1344"></span><span id="tryTc"><span class="annot"><span class="annottext">tryTc :: forall a. TcRn a -&gt; TcRn (Maybe a, Messages)
</span><a href="GHC.Tc.Utils.Monad.html#tryTc"><span class="hs-identifier hs-var hs-var">tryTc</span></a></span></span><span> </span><span id="local-6989586621681081112"><span class="annot"><span class="annottext">TcRn a
</span><a href="#local-6989586621681081112"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1345"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM (Maybe a) -&gt; TcM (Maybe a, Messages)
forall r. TcM r -&gt; TcM (r, Messages)
</span><a href="GHC.Tc.Utils.Monad.html#capture_messages"><span class="hs-identifier hs-var">capture_messages</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcRn a -&gt; TcM (Maybe a)
forall r. TcRn r -&gt; TcRn (Maybe r)
</span><a href="GHC.Tc.Utils.Monad.html#attemptM"><span class="hs-identifier hs-var">attemptM</span></a></span><span> </span><span class="annot"><span class="annottext">TcRn a
</span><a href="#local-6989586621681081112"><span class="hs-identifier hs-var">thing_inside</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1346"></span><span>
</span><span id="line-1347"></span><span class="hs-comment">-----------------------</span><span>
</span><span id="line-1348"></span><span id="local-6989586621681081111"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#discardErrs"><span class="hs-identifier hs-type">discardErrs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681081111"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681081111"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1349"></span><span class="hs-comment">-- (discardErrs m) runs m,</span><span>
</span><span id="line-1350"></span><span class="hs-comment">--   discarding all error messages and warnings generated by m</span><span>
</span><span id="line-1351"></span><span class="hs-comment">-- If m fails, discardErrs fails, and vice versa</span><span>
</span><span id="line-1352"></span><span id="discardErrs"><span class="annot"><span class="annottext">discardErrs :: forall a. TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#discardErrs"><span class="hs-identifier hs-var hs-var">discardErrs</span></a></span></span><span> </span><span id="local-6989586621681081109"><span class="annot"><span class="annottext">TcRn a
</span><a href="#local-6989586621681081109"><span class="hs-identifier hs-var">m</span></a></span></span><span>
</span><span id="line-1353"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081108"><span class="annot"><span class="annottext">IORef Messages
</span><a href="#local-6989586621681081108"><span class="hs-identifier hs-var">errs_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Messages -&gt; TcRn (IORef Messages)
forall a gbl lcl. a -&gt; TcRnIf gbl lcl (TcRef a)
</span><a href="GHC.Tc.Utils.Monad.html#newTcRef"><span class="hs-identifier hs-var">newTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">Messages
</span><a href="GHC.Utils.Error.html#emptyMessages"><span class="hs-identifier hs-var">emptyMessages</span></a></span><span>
</span><span id="line-1354"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">IORef Messages -&gt; TcRn a -&gt; TcRn a
forall a. IORef Messages -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setErrsVar"><span class="hs-identifier hs-var">setErrsVar</span></a></span><span> </span><span class="annot"><span class="annottext">IORef Messages
</span><a href="#local-6989586621681081108"><span class="hs-identifier hs-var">errs_var</span></a></span><span> </span><span class="annot"><span class="annottext">TcRn a
</span><a href="#local-6989586621681081109"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1355"></span><span>
</span><span id="line-1356"></span><span class="hs-comment">-----------------------</span><span>
</span><span id="line-1357"></span><span id="local-6989586621681081107"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#tryTcDiscardingErrs"><span class="hs-identifier hs-type">tryTcDiscardingErrs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681081107"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681081107"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681081107"><span class="hs-identifier hs-type">r</span></a></span></span><span>
</span><span id="line-1358"></span><span class="hs-comment">-- (tryTcDiscardingErrs recover thing_inside) tries 'thing_inside';</span><span>
</span><span id="line-1359"></span><span class="hs-comment">--      if 'main' succeeds with no error messages, it's the answer</span><span>
</span><span id="line-1360"></span><span class="hs-comment">--      otherwise discard everything from 'main', including errors,</span><span>
</span><span id="line-1361"></span><span class="hs-comment">--          and try 'recover' instead.</span><span>
</span><span id="line-1362"></span><span id="tryTcDiscardingErrs"><span class="annot"><span class="annottext">tryTcDiscardingErrs :: forall r. TcRn r -&gt; TcRn r -&gt; TcRn r
</span><a href="GHC.Tc.Utils.Monad.html#tryTcDiscardingErrs"><span class="hs-identifier hs-var hs-var">tryTcDiscardingErrs</span></a></span></span><span> </span><span id="local-6989586621681081100"><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621681081100"><span class="hs-identifier hs-var">recover</span></a></span></span><span> </span><span id="local-6989586621681081099"><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621681081099"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1363"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621681081098"><span class="annot"><span class="annottext">Maybe r
</span><a href="#local-6989586621681081098"><span class="hs-identifier hs-var">mb_res</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681081097"><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621681081097"><span class="hs-identifier hs-var">lie</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621681081096"><span class="annot"><span class="annottext">Messages
</span><a href="#local-6989586621681081096"><span class="hs-identifier hs-var">msgs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM (Maybe r, WantedConstraints)
-&gt; TcM ((Maybe r, WantedConstraints), Messages)
forall r. TcM r -&gt; TcM (r, Messages)
</span><a href="GHC.Tc.Utils.Monad.html#capture_messages"><span class="hs-identifier hs-var">capture_messages</span></a></span><span>    </span><span class="annot"><span class="annottext">(TcM (Maybe r, WantedConstraints)
 -&gt; TcM ((Maybe r, WantedConstraints), Messages))
-&gt; TcM (Maybe r, WantedConstraints)
-&gt; TcM ((Maybe r, WantedConstraints), Messages)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1364"></span><span>                                  </span><span class="annot"><span class="annottext">TcM (Maybe r) -&gt; TcM (Maybe r, WantedConstraints)
forall r. TcM r -&gt; TcM (r, WantedConstraints)
</span><a href="GHC.Tc.Utils.Monad.html#capture_constraints"><span class="hs-identifier hs-var">capture_constraints</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (Maybe r) -&gt; TcM (Maybe r, WantedConstraints))
-&gt; TcM (Maybe r) -&gt; TcM (Maybe r, WantedConstraints)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1365"></span><span>                                  </span><span class="annot"><span class="annottext">TcM r -&gt; TcM (Maybe r)
forall r. TcRn r -&gt; TcRn (Maybe r)
</span><a href="GHC.Tc.Utils.Monad.html#tcTryM"><span class="hs-identifier hs-var">tcTryM</span></a></span><span> </span><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621681081099"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1366"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681081095"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681081095"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-1367"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe r
</span><a href="#local-6989586621681081098"><span class="hs-identifier hs-var">mb_res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1368"></span><span>            </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681081094"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681081094"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Messages -&gt; Bool
</span><a href="GHC.Utils.Error.html#errorsFound"><span class="hs-identifier hs-var">errorsFound</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681081095"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Messages
</span><a href="#local-6989586621681081096"><span class="hs-identifier hs-var">msgs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1369"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WantedConstraints -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#insolubleWC"><span class="hs-identifier hs-var">insolubleWC</span></a></span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621681081097"><span class="hs-identifier hs-var">lie</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1370"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-comment">-- 'main' succeeded with no errors</span><span>
</span><span id="line-1371"></span><span>                 </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Messages -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addMessages"><span class="hs-identifier hs-var">addMessages</span></a></span><span> </span><span class="annot"><span class="annottext">Messages
</span><a href="#local-6989586621681081096"><span class="hs-identifier hs-var">msgs</span></a></span><span>  </span><span class="hs-comment">-- msgs might still have warnings</span><span>
</span><span id="line-1372"></span><span>                    </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">WantedConstraints -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#emitConstraints"><span class="hs-identifier hs-var">emitConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621681081097"><span class="hs-identifier hs-var">lie</span></a></span><span>
</span><span id="line-1373"></span><span>                    </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">r -&gt; TcM r
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621681081094"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1374"></span><span>
</span><span id="line-1375"></span><span>            </span><span class="annot"><span class="annottext">Maybe r
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-comment">-- 'main' failed, or produced an error message</span><span>
</span><span id="line-1376"></span><span>                 </span><span class="annot"><span class="annottext">TcM r
</span><a href="#local-6989586621681081100"><span class="hs-identifier hs-var">recover</span></a></span><span>     </span><span class="hs-comment">-- Discard all errors and warnings</span><span>
</span><span id="line-1377"></span><span>                             </span><span class="hs-comment">-- and unsolved constraints entirely</span><span>
</span><span id="line-1378"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-1379"></span><span>
</span><span id="line-1380"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
             Error message generation (type checker)
*                                                                      *
************************************************************************

    The addErrTc functions add an error message, but do not cause failure.
    The 'M' variants pass a TidyEnv that has already been used to
    tidy up the message; we then use it to tidy the context messages
-}</span><span>
</span><span id="line-1391"></span><span>
</span><span id="line-1392"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addErrTc"><span class="hs-identifier hs-type">addErrTc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#MsgDoc"><span class="hs-identifier hs-type">MsgDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1393"></span><span id="addErrTc"><span class="annot"><span class="annottext">addErrTc :: SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrTc"><span class="hs-identifier hs-var hs-var">addErrTc</span></a></span></span><span> </span><span id="local-6989586621681081093"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081093"><span class="hs-identifier hs-var">err_msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081092"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621681081092"><span class="hs-identifier hs-var">env0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM TidyEnv
</span><a href="GHC.Tc.Utils.Env.html#tcInitTidyEnv"><span class="hs-identifier hs-var">tcInitTidyEnv</span></a></span><span>
</span><span id="line-1394"></span><span>                      </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(TidyEnv, SDoc) -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrTcM"><span class="hs-identifier hs-var">addErrTcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621681081092"><span class="hs-identifier hs-var">env0</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081093"><span class="hs-identifier hs-var">err_msg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1395"></span><span>
</span><span id="line-1396"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addErrTcM"><span class="hs-identifier hs-type">addErrTcM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#MsgDoc"><span class="hs-identifier hs-type">MsgDoc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1397"></span><span id="addErrTcM"><span class="annot"><span class="annottext">addErrTcM :: (TidyEnv, SDoc) -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrTcM"><span class="hs-identifier hs-var hs-var">addErrTcM</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681081091"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621681081091"><span class="hs-identifier hs-var">tidy_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681081090"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081090"><span class="hs-identifier hs-var">err_msg</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1398"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081089"><span class="annot"><span class="annottext">[ErrCtxt]
</span><a href="#local-6989586621681081089"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM [ErrCtxt]
</span><a href="GHC.Tc.Utils.Monad.html#getErrCtxt"><span class="hs-identifier hs-var">getErrCtxt</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1399"></span><span>         </span><span id="local-6989586621681081088"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681081088"><span class="hs-identifier hs-var">loc</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn SrcSpan
</span><a href="GHC.Tc.Utils.Monad.html#getSrcSpanM"><span class="hs-identifier hs-var">getSrcSpanM</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1400"></span><span>         </span><span class="annot"><span class="annottext">TidyEnv -&gt; SDoc -&gt; SrcSpan -&gt; [ErrCtxt] -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#add_err_tcm"><span class="hs-identifier hs-var">add_err_tcm</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621681081091"><span class="hs-identifier hs-var">tidy_env</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081090"><span class="hs-identifier hs-var">err_msg</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681081088"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">[ErrCtxt]
</span><a href="#local-6989586621681081089"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1401"></span><span>
</span><span id="line-1402"></span><span class="hs-comment">-- The failWith functions add an error message and cause failure</span><span>
</span><span id="line-1403"></span><span>
</span><span id="line-1404"></span><span id="local-6989586621681081086"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-type">failWithTc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#MsgDoc"><span class="hs-identifier hs-type">MsgDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681081086"><span class="hs-identifier hs-type">a</span></a></span></span><span>               </span><span class="hs-comment">-- Add an error message and fail</span><span>
</span><span id="line-1405"></span><span id="failWithTc"><span class="annot"><span class="annottext">failWithTc :: forall a. SDoc -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var hs-var">failWithTc</span></a></span></span><span> </span><span id="local-6989586621681081084"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081084"><span class="hs-identifier hs-var">err_msg</span></a></span></span><span>
</span><span id="line-1406"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrTc"><span class="hs-identifier hs-var">addErrTc</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081084"><span class="hs-identifier hs-var">err_msg</span></a></span><span> </span><span class="annot"><span class="annottext">TcM ()
-&gt; IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><a href="../../base/src/GHC.Base.html#%3E%3E"><span class="hs-operator hs-var">&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) a
forall env a. IOEnv env a
</span><a href="GHC.Data.IOEnv.html#failM"><span class="hs-identifier hs-var">failM</span></a></span><span>
</span><span id="line-1407"></span><span>
</span><span id="line-1408"></span><span id="local-6989586621681082463"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#failWithTcM"><span class="hs-identifier hs-type">failWithTcM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#MsgDoc"><span class="hs-identifier hs-type">MsgDoc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082463"><span class="hs-identifier hs-type">a</span></a></span></span><span>   </span><span class="hs-comment">-- Add an error message and fail</span><span>
</span><span id="line-1409"></span><span id="failWithTcM"><span class="annot"><span class="annottext">failWithTcM :: forall a. (TidyEnv, SDoc) -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTcM"><span class="hs-identifier hs-var hs-var">failWithTcM</span></a></span></span><span> </span><span id="local-6989586621681081082"><span class="annot"><span class="annottext">(TidyEnv, SDoc)
</span><a href="#local-6989586621681081082"><span class="hs-identifier hs-var">local_and_msg</span></a></span></span><span>
</span><span id="line-1410"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TidyEnv, SDoc) -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrTcM"><span class="hs-identifier hs-var">addErrTcM</span></a></span><span> </span><span class="annot"><span class="annottext">(TidyEnv, SDoc)
</span><a href="#local-6989586621681081082"><span class="hs-identifier hs-var">local_and_msg</span></a></span><span> </span><span class="annot"><span class="annottext">TcM ()
-&gt; IOEnv (Env TcGblEnv TcLclEnv) a
-&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><a href="../../base/src/GHC.Base.html#%3E%3E"><span class="hs-operator hs-var">&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) a
forall env a. IOEnv env a
</span><a href="GHC.Data.IOEnv.html#failM"><span class="hs-identifier hs-var">failM</span></a></span><span>
</span><span id="line-1411"></span><span>
</span><span id="line-1412"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-type">checkTc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#MsgDoc"><span class="hs-identifier hs-type">MsgDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>         </span><span class="hs-comment">-- Check that the boolean is true</span><span>
</span><span id="line-1413"></span><span id="checkTc"><span class="annot"><span class="annottext">checkTc :: Bool -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-var hs-var">checkTc</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>  </span><span class="annot"><span class="annottext">SDoc
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcM ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1414"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span id="local-6989586621681081081"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081081"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcM ()
forall a. SDoc -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081081"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-1415"></span><span>
</span><span id="line-1416"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#checkTcM"><span class="hs-identifier hs-type">checkTcM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#MsgDoc"><span class="hs-identifier hs-type">MsgDoc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1417"></span><span id="checkTcM"><span class="annot"><span class="annottext">checkTcM :: Bool -&gt; (TidyEnv, SDoc) -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#checkTcM"><span class="hs-identifier hs-var hs-var">checkTcM</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>  </span><span class="annot"><span class="annottext">(TidyEnv, SDoc)
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcM ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1418"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#checkTcM"><span class="hs-identifier hs-var">checkTcM</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span id="local-6989586621681081080"><span class="annot"><span class="annottext">(TidyEnv, SDoc)
</span><a href="#local-6989586621681081080"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TidyEnv, SDoc) -&gt; TcM ()
forall a. (TidyEnv, SDoc) -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTcM"><span class="hs-identifier hs-var">failWithTcM</span></a></span><span> </span><span class="annot"><span class="annottext">(TidyEnv, SDoc)
</span><a href="#local-6989586621681081080"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-1419"></span><span>
</span><span id="line-1420"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#failIfTc"><span class="hs-identifier hs-type">failIfTc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#MsgDoc"><span class="hs-identifier hs-type">MsgDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>         </span><span class="hs-comment">-- Check that the boolean is false</span><span>
</span><span id="line-1421"></span><span id="failIfTc"><span class="annot"><span class="annottext">failIfTc :: Bool -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#failIfTc"><span class="hs-identifier hs-var hs-var">failIfTc</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcM ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1422"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#failIfTc"><span class="hs-identifier hs-var">failIfTc</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>  </span><span id="local-6989586621681081079"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081079"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcM ()
forall a. SDoc -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081079"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-1423"></span><span>
</span><span id="line-1424"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#failIfTcM"><span class="hs-identifier hs-type">failIfTcM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#MsgDoc"><span class="hs-identifier hs-type">MsgDoc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1425"></span><span>   </span><span class="hs-comment">-- Check that the boolean is false</span><span>
</span><span id="line-1426"></span><span id="failIfTcM"><span class="annot"><span class="annottext">failIfTcM :: Bool -&gt; (TidyEnv, SDoc) -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#failIfTcM"><span class="hs-identifier hs-var hs-var">failIfTcM</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">(TidyEnv, SDoc)
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcM ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1427"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#failIfTcM"><span class="hs-identifier hs-var">failIfTcM</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>  </span><span id="local-6989586621681081078"><span class="annot"><span class="annottext">(TidyEnv, SDoc)
</span><a href="#local-6989586621681081078"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TidyEnv, SDoc) -&gt; TcM ()
forall a. (TidyEnv, SDoc) -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTcM"><span class="hs-identifier hs-var">failWithTcM</span></a></span><span> </span><span class="annot"><span class="annottext">(TidyEnv, SDoc)
</span><a href="#local-6989586621681081078"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-1428"></span><span>
</span><span id="line-1429"></span><span>
</span><span id="line-1430"></span><span class="hs-comment">--         Warnings have no 'M' variant, nor failure</span><span>
</span><span id="line-1431"></span><span>
</span><span id="line-1432"></span><span class="hs-comment">-- | Display a warning if a condition is met,</span><span>
</span><span id="line-1433"></span><span class="hs-comment">--   and the warning is enabled</span><span>
</span><span id="line-1434"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#warnIfFlag"><span class="hs-identifier hs-type">warnIfFlag</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#WarningFlag"><span class="hs-identifier hs-type">WarningFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#MsgDoc"><span class="hs-identifier hs-type">MsgDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1435"></span><span id="warnIfFlag"><span class="annot"><span class="annottext">warnIfFlag :: WarningFlag -&gt; Bool -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#warnIfFlag"><span class="hs-identifier hs-var hs-var">warnIfFlag</span></a></span></span><span> </span><span id="local-6989586621681081077"><span class="annot"><span class="annottext">WarningFlag
</span><a href="#local-6989586621681081077"><span class="hs-identifier hs-var">warn_flag</span></a></span></span><span> </span><span id="local-6989586621681081076"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681081076"><span class="hs-identifier hs-var">is_bad</span></a></span></span><span> </span><span id="local-6989586621681081075"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081075"><span class="hs-identifier hs-var">msg</span></a></span></span><span>
</span><span id="line-1436"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081074"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681081074"><span class="hs-identifier hs-var">warn_on</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">WarningFlag -&gt; TcRn Bool
forall gbl lcl. WarningFlag -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#woptM"><span class="hs-identifier hs-var">woptM</span></a></span><span> </span><span class="annot"><span class="annottext">WarningFlag
</span><a href="#local-6989586621681081077"><span class="hs-identifier hs-var">warn_flag</span></a></span><span>
</span><span id="line-1437"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcM () -&gt; TcM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681081074"><span class="hs-identifier hs-var">warn_on</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681081076"><span class="hs-identifier hs-var">is_bad</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM () -&gt; TcM ()) -&gt; TcM () -&gt; TcM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1438"></span><span>         </span><span class="annot"><span class="annottext">WarnReason -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addWarn"><span class="hs-identifier hs-var">addWarn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WarningFlag -&gt; WarnReason
</span><a href="GHC.Driver.Flags.html#Reason"><span class="hs-identifier hs-var">Reason</span></a></span><span> </span><span class="annot"><span class="annottext">WarningFlag
</span><a href="#local-6989586621681081077"><span class="hs-identifier hs-var">warn_flag</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081075"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1439"></span><span>
</span><span id="line-1440"></span><span class="hs-comment">-- | Display a warning if a condition is met.</span><span>
</span><span id="line-1441"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#warnIf"><span class="hs-identifier hs-type">warnIf</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#MsgDoc"><span class="hs-identifier hs-type">MsgDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1442"></span><span id="warnIf"><span class="annot"><span class="annottext">warnIf :: Bool -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#warnIf"><span class="hs-identifier hs-var hs-var">warnIf</span></a></span></span><span> </span><span id="local-6989586621681081072"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681081072"><span class="hs-identifier hs-var">is_bad</span></a></span></span><span> </span><span id="local-6989586621681081071"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081071"><span class="hs-identifier hs-var">msg</span></a></span></span><span>
</span><span id="line-1443"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcM () -&gt; TcM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681081072"><span class="hs-identifier hs-var">is_bad</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WarnReason -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addWarn"><span class="hs-identifier hs-var">addWarn</span></a></span><span> </span><span class="annot"><span class="annottext">WarnReason
</span><a href="GHC.Driver.Flags.html#NoReason"><span class="hs-identifier hs-var">NoReason</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081071"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1444"></span><span>
</span><span id="line-1445"></span><span class="hs-comment">-- | Display a warning if a condition is met.</span><span>
</span><span id="line-1446"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#warnTc"><span class="hs-identifier hs-type">warnTc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#WarnReason"><span class="hs-identifier hs-type">WarnReason</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#MsgDoc"><span class="hs-identifier hs-type">MsgDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1447"></span><span id="warnTc"><span class="annot"><span class="annottext">warnTc :: WarnReason -&gt; Bool -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#warnTc"><span class="hs-identifier hs-var hs-var">warnTc</span></a></span></span><span> </span><span id="local-6989586621681081069"><span class="annot"><span class="annottext">WarnReason
</span><a href="#local-6989586621681081069"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span id="local-6989586621681081068"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681081068"><span class="hs-identifier hs-var">warn_if_true</span></a></span></span><span> </span><span id="local-6989586621681081067"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081067"><span class="hs-identifier hs-var">warn_msg</span></a></span></span><span>
</span><span id="line-1448"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681081068"><span class="hs-identifier hs-var">warn_if_true</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WarnReason -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addWarnTc"><span class="hs-identifier hs-var">addWarnTc</span></a></span><span> </span><span class="annot"><span class="annottext">WarnReason
</span><a href="#local-6989586621681081069"><span class="hs-identifier hs-var">reason</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081067"><span class="hs-identifier hs-var">warn_msg</span></a></span><span>
</span><span id="line-1449"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcM ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1450"></span><span>
</span><span id="line-1451"></span><span class="hs-comment">-- | Display a warning if a condition is met.</span><span>
</span><span id="line-1452"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#warnTcM"><span class="hs-identifier hs-type">warnTcM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#WarnReason"><span class="hs-identifier hs-type">WarnReason</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#MsgDoc"><span class="hs-identifier hs-type">MsgDoc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1453"></span><span id="warnTcM"><span class="annot"><span class="annottext">warnTcM :: WarnReason -&gt; Bool -&gt; (TidyEnv, SDoc) -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#warnTcM"><span class="hs-identifier hs-var hs-var">warnTcM</span></a></span></span><span> </span><span id="local-6989586621681081066"><span class="annot"><span class="annottext">WarnReason
</span><a href="#local-6989586621681081066"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span id="local-6989586621681081065"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681081065"><span class="hs-identifier hs-var">warn_if_true</span></a></span></span><span> </span><span id="local-6989586621681081064"><span class="annot"><span class="annottext">(TidyEnv, SDoc)
</span><a href="#local-6989586621681081064"><span class="hs-identifier hs-var">warn_msg</span></a></span></span><span>
</span><span id="line-1454"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681081065"><span class="hs-identifier hs-var">warn_if_true</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WarnReason -&gt; (TidyEnv, SDoc) -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addWarnTcM"><span class="hs-identifier hs-var">addWarnTcM</span></a></span><span> </span><span class="annot"><span class="annottext">WarnReason
</span><a href="#local-6989586621681081066"><span class="hs-identifier hs-var">reason</span></a></span><span> </span><span class="annot"><span class="annottext">(TidyEnv, SDoc)
</span><a href="#local-6989586621681081064"><span class="hs-identifier hs-var">warn_msg</span></a></span><span>
</span><span id="line-1455"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcM ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1456"></span><span>
</span><span id="line-1457"></span><span class="hs-comment">-- | Display a warning in the current context.</span><span>
</span><span id="line-1458"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addWarnTc"><span class="hs-identifier hs-type">addWarnTc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#WarnReason"><span class="hs-identifier hs-type">WarnReason</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#MsgDoc"><span class="hs-identifier hs-type">MsgDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1459"></span><span id="addWarnTc"><span class="annot"><span class="annottext">addWarnTc :: WarnReason -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addWarnTc"><span class="hs-identifier hs-var hs-var">addWarnTc</span></a></span></span><span> </span><span id="local-6989586621681081063"><span class="annot"><span class="annottext">WarnReason
</span><a href="#local-6989586621681081063"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span id="local-6989586621681081062"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081062"><span class="hs-identifier hs-var">msg</span></a></span></span><span>
</span><span id="line-1460"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081061"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621681081061"><span class="hs-identifier hs-var">env0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM TidyEnv
</span><a href="GHC.Tc.Utils.Env.html#tcInitTidyEnv"><span class="hs-identifier hs-var">tcInitTidyEnv</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1461"></span><span>      </span><span class="annot"><span class="annottext">WarnReason -&gt; (TidyEnv, SDoc) -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addWarnTcM"><span class="hs-identifier hs-var">addWarnTcM</span></a></span><span> </span><span class="annot"><span class="annottext">WarnReason
</span><a href="#local-6989586621681081063"><span class="hs-identifier hs-var">reason</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621681081061"><span class="hs-identifier hs-var">env0</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081062"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1462"></span><span>
</span><span id="line-1463"></span><span class="hs-comment">-- | Display a warning in a given context.</span><span>
</span><span id="line-1464"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addWarnTcM"><span class="hs-identifier hs-type">addWarnTcM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#WarnReason"><span class="hs-identifier hs-type">WarnReason</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#MsgDoc"><span class="hs-identifier hs-type">MsgDoc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1465"></span><span id="addWarnTcM"><span class="annot"><span class="annottext">addWarnTcM :: WarnReason -&gt; (TidyEnv, SDoc) -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addWarnTcM"><span class="hs-identifier hs-var hs-var">addWarnTcM</span></a></span></span><span> </span><span id="local-6989586621681081060"><span class="annot"><span class="annottext">WarnReason
</span><a href="#local-6989586621681081060"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681081059"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621681081059"><span class="hs-identifier hs-var">env0</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681081058"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081058"><span class="hs-identifier hs-var">msg</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1466"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081057"><span class="annot"><span class="annottext">[ErrCtxt]
</span><a href="#local-6989586621681081057"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM [ErrCtxt]
</span><a href="GHC.Tc.Utils.Monad.html#getErrCtxt"><span class="hs-identifier hs-var">getErrCtxt</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1467"></span><span>        </span><span id="local-6989586621681081056"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081056"><span class="hs-identifier hs-var">err_info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; [ErrCtxt] -&gt; TcRn SDoc
</span><a href="GHC.Tc.Utils.Monad.html#mkErrInfo"><span class="hs-identifier hs-var">mkErrInfo</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621681081059"><span class="hs-identifier hs-var">env0</span></a></span><span> </span><span class="annot"><span class="annottext">[ErrCtxt]
</span><a href="#local-6989586621681081057"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1468"></span><span>        </span><span class="annot"><span class="annottext">WarnReason -&gt; SDoc -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#add_warn"><span class="hs-identifier hs-var">add_warn</span></a></span><span> </span><span class="annot"><span class="annottext">WarnReason
</span><a href="#local-6989586621681081060"><span class="hs-identifier hs-var">reason</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081058"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081056"><span class="hs-identifier hs-var">err_info</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1469"></span><span>
</span><span id="line-1470"></span><span class="hs-comment">-- | Display a warning for the current source location.</span><span>
</span><span id="line-1471"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addWarn"><span class="hs-identifier hs-type">addWarn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#WarnReason"><span class="hs-identifier hs-type">WarnReason</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#MsgDoc"><span class="hs-identifier hs-type">MsgDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1472"></span><span id="addWarn"><span class="annot"><span class="annottext">addWarn :: WarnReason -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addWarn"><span class="hs-identifier hs-var hs-var">addWarn</span></a></span></span><span> </span><span id="local-6989586621681081055"><span class="annot"><span class="annottext">WarnReason
</span><a href="#local-6989586621681081055"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span id="local-6989586621681081054"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081054"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WarnReason -&gt; SDoc -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#add_warn"><span class="hs-identifier hs-var">add_warn</span></a></span><span> </span><span class="annot"><span class="annottext">WarnReason
</span><a href="#local-6989586621681081055"><span class="hs-identifier hs-var">reason</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081054"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">Outputable.empty</span></a></span><span>
</span><span id="line-1473"></span><span>
</span><span id="line-1474"></span><span class="hs-comment">-- | Display a warning for a given source location.</span><span>
</span><span id="line-1475"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addWarnAt"><span class="hs-identifier hs-type">addWarnAt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#WarnReason"><span class="hs-identifier hs-type">WarnReason</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#MsgDoc"><span class="hs-identifier hs-type">MsgDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1476"></span><span id="addWarnAt"><span class="annot"><span class="annottext">addWarnAt :: WarnReason -&gt; SrcSpan -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addWarnAt"><span class="hs-identifier hs-var hs-var">addWarnAt</span></a></span></span><span> </span><span id="local-6989586621681081052"><span class="annot"><span class="annottext">WarnReason
</span><a href="#local-6989586621681081052"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span id="local-6989586621681081051"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681081051"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681081050"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081050"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WarnReason -&gt; SrcSpan -&gt; SDoc -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#add_warn_at"><span class="hs-identifier hs-var">add_warn_at</span></a></span><span> </span><span class="annot"><span class="annottext">WarnReason
</span><a href="#local-6989586621681081052"><span class="hs-identifier hs-var">reason</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681081051"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081050"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">Outputable.empty</span></a></span><span>
</span><span id="line-1477"></span><span>
</span><span id="line-1478"></span><span class="hs-comment">-- | Display a warning, with an optional flag, for the current source</span><span>
</span><span id="line-1479"></span><span class="hs-comment">-- location.</span><span>
</span><span id="line-1480"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#add_warn"><span class="hs-identifier hs-type">add_warn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#WarnReason"><span class="hs-identifier hs-type">WarnReason</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#MsgDoc"><span class="hs-identifier hs-type">MsgDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#MsgDoc"><span class="hs-identifier hs-type">MsgDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1481"></span><span id="add_warn"><span class="annot"><span class="annottext">add_warn :: WarnReason -&gt; SDoc -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#add_warn"><span class="hs-identifier hs-var hs-var">add_warn</span></a></span></span><span> </span><span id="local-6989586621681081048"><span class="annot"><span class="annottext">WarnReason
</span><a href="#local-6989586621681081048"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span id="local-6989586621681081047"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081047"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span id="local-6989586621681081046"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081046"><span class="hs-identifier hs-var">extra_info</span></a></span></span><span>
</span><span id="line-1482"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081045"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681081045"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn SrcSpan
</span><a href="GHC.Tc.Utils.Monad.html#getSrcSpanM"><span class="hs-identifier hs-var">getSrcSpanM</span></a></span><span>
</span><span id="line-1483"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">WarnReason -&gt; SrcSpan -&gt; SDoc -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#add_warn_at"><span class="hs-identifier hs-var">add_warn_at</span></a></span><span> </span><span class="annot"><span class="annottext">WarnReason
</span><a href="#local-6989586621681081048"><span class="hs-identifier hs-var">reason</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681081045"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081047"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081046"><span class="hs-identifier hs-var">extra_info</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1484"></span><span>
</span><span id="line-1485"></span><span class="hs-comment">-- | Display a warning, with an optional flag, for a given location.</span><span>
</span><span id="line-1486"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#add_warn_at"><span class="hs-identifier hs-type">add_warn_at</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Flags.html#WarnReason"><span class="hs-identifier hs-type">WarnReason</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#MsgDoc"><span class="hs-identifier hs-type">MsgDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#MsgDoc"><span class="hs-identifier hs-type">MsgDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1487"></span><span id="add_warn_at"><span class="annot"><span class="annottext">add_warn_at :: WarnReason -&gt; SrcSpan -&gt; SDoc -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#add_warn_at"><span class="hs-identifier hs-var hs-var">add_warn_at</span></a></span></span><span> </span><span id="local-6989586621681081044"><span class="annot"><span class="annottext">WarnReason
</span><a href="#local-6989586621681081044"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span id="local-6989586621681081043"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681081043"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681081042"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081042"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span id="local-6989586621681081041"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081041"><span class="hs-identifier hs-var">extra_info</span></a></span></span><span>
</span><span id="line-1488"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081040"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681081040"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1489"></span><span>         </span><span id="local-6989586621681081039"><span class="annot"><span class="annottext">PrintUnqualified
</span><a href="#local-6989586621681081039"><span class="hs-identifier hs-var">printer</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; TcRn PrintUnqualified
</span><a href="GHC.Tc.Utils.Monad.html#getPrintUnqualified"><span class="hs-identifier hs-var">getPrintUnqualified</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681081040"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1490"></span><span>         </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081038"><span class="annot"><span class="annottext">warn :: WarnMsg
</span><a href="#local-6989586621681081038"><span class="hs-identifier hs-var hs-var">warn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; SrcSpan -&gt; PrintUnqualified -&gt; SDoc -&gt; SDoc -&gt; WarnMsg
</span><a href="GHC.Utils.Error.html#mkLongWarnMsg"><span class="hs-identifier hs-var">mkLongWarnMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681081040"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681081043"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">PrintUnqualified
</span><a href="#local-6989586621681081039"><span class="hs-identifier hs-var">printer</span></a></span><span>
</span><span id="line-1491"></span><span>                                    </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081042"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081041"><span class="hs-identifier hs-var">extra_info</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1492"></span><span>         </span><span class="annot"><span class="annottext">WarnReason -&gt; WarnMsg -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#reportWarning"><span class="hs-identifier hs-var">reportWarning</span></a></span><span> </span><span class="annot"><span class="annottext">WarnReason
</span><a href="#local-6989586621681081044"><span class="hs-identifier hs-var">reason</span></a></span><span> </span><span class="annot"><span class="annottext">WarnMsg
</span><a href="#local-6989586621681081038"><span class="hs-identifier hs-var">warn</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1493"></span><span>
</span><span id="line-1494"></span><span>
</span><span id="line-1495"></span><span class="hs-comment">{-
-----------------------------------
        Other helper functions
-}</span><span>
</span><span id="line-1499"></span><span>
</span><span id="line-1500"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#add_err_tcm"><span class="hs-identifier hs-type">add_err_tcm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#MsgDoc"><span class="hs-identifier hs-type">MsgDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span>
</span><span id="line-1501"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.html#ErrCtxt"><span class="hs-identifier hs-type">ErrCtxt</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1502"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1503"></span><span id="add_err_tcm"><span class="annot"><span class="annottext">add_err_tcm :: TidyEnv -&gt; SDoc -&gt; SrcSpan -&gt; [ErrCtxt] -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#add_err_tcm"><span class="hs-identifier hs-var hs-var">add_err_tcm</span></a></span></span><span> </span><span id="local-6989586621681081036"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621681081036"><span class="hs-identifier hs-var">tidy_env</span></a></span></span><span> </span><span id="local-6989586621681081035"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081035"><span class="hs-identifier hs-var">err_msg</span></a></span></span><span> </span><span id="local-6989586621681081034"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681081034"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681081033"><span class="annot"><span class="annottext">[ErrCtxt]
</span><a href="#local-6989586621681081033"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span>
</span><span id="line-1504"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081032"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081032"><span class="hs-identifier hs-var">err_info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; [ErrCtxt] -&gt; TcRn SDoc
</span><a href="GHC.Tc.Utils.Monad.html#mkErrInfo"><span class="hs-identifier hs-var">mkErrInfo</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621681081036"><span class="hs-identifier hs-var">tidy_env</span></a></span><span> </span><span class="annot"><span class="annottext">[ErrCtxt]
</span><a href="#local-6989586621681081033"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1505"></span><span>        </span><span class="annot"><span class="annottext">SrcSpan -&gt; SDoc -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addLongErrAt"><span class="hs-identifier hs-var">addLongErrAt</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681081034"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081035"><span class="hs-identifier hs-var">err_msg</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081032"><span class="hs-identifier hs-var">err_info</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1506"></span><span>
</span><span id="line-1507"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#mkErrInfo"><span class="hs-identifier hs-type">mkErrInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.html#ErrCtxt"><span class="hs-identifier hs-type">ErrCtxt</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-1508"></span><span class="hs-comment">-- Tidy the error info, trimming excessive contexts</span><span>
</span><span id="line-1509"></span><span id="mkErrInfo"><span class="annot"><span class="annottext">mkErrInfo :: TidyEnv -&gt; [ErrCtxt] -&gt; TcRn SDoc
</span><a href="GHC.Tc.Utils.Monad.html#mkErrInfo"><span class="hs-identifier hs-var hs-var">mkErrInfo</span></a></span></span><span> </span><span id="local-6989586621681081031"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621681081031"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span id="local-6989586621681081030"><span class="annot"><span class="annottext">[ErrCtxt]
</span><a href="#local-6989586621681081030"><span class="hs-identifier hs-var">ctxts</span></a></span></span><span>
</span><span id="line-1510"></span><span class="hs-comment">--  = do</span><span>
</span><span id="line-1511"></span><span class="hs-comment">--       dbg &lt;- hasPprDebug &lt;$&gt; getDynFlags</span><span>
</span><span id="line-1512"></span><span class="hs-comment">--       if dbg                -- In -dppr-debug style the output</span><span>
</span><span id="line-1513"></span><span class="hs-comment">--          then return empty  -- just becomes too voluminous</span><span>
</span><span id="line-1514"></span><span class="hs-comment">--          else go dbg 0 env ctxts</span><span>
</span><span id="line-1515"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Int -&gt; TidyEnv -&gt; [ErrCtxt] -&gt; TcRn SDoc
</span><a href="#local-6989586621681081029"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621681081031"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">[ErrCtxt]
</span><a href="#local-6989586621681081030"><span class="hs-identifier hs-var">ctxts</span></a></span><span>
</span><span id="line-1516"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1517"></span><span>   </span><span class="annot"><a href="#local-6989586621681081029"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#TidyEnv"><span class="hs-identifier hs-type">TidyEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.html#ErrCtxt"><span class="hs-identifier hs-type">ErrCtxt</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-1518"></span><span>   </span><span id="local-6989586621681081029"><span class="annot"><span class="annottext">go :: Bool -&gt; Int -&gt; TidyEnv -&gt; [ErrCtxt] -&gt; TcRn SDoc
</span><a href="#local-6989586621681081029"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcRn SDoc
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-1519"></span><span>   </span><span class="annot"><a href="#local-6989586621681081029"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681081028"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681081028"><span class="hs-identifier hs-var">dbg</span></a></span></span><span> </span><span id="local-6989586621681081027"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681081027"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681081026"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621681081026"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621681081025"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681081025"><span class="hs-identifier hs-var">is_landmark</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681081024"><span class="annot"><span class="annottext">TidyEnv -&gt; TcM (TidyEnv, SDoc)
</span><a href="#local-6989586621681081024"><span class="hs-identifier hs-var">ctxt</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681081023"><span class="annot"><span class="annottext">[ErrCtxt]
</span><a href="#local-6989586621681081023"><span class="hs-identifier hs-var">ctxts</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1520"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681081025"><span class="hs-identifier hs-var">is_landmark</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681081027"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="GHC.Tc.Utils.Monad.html#mAX_CONTEXTS"><span class="hs-identifier hs-var">mAX_CONTEXTS</span></a></span><span> </span><span class="hs-comment">-- Too verbose || dbg</span><span>
</span><span id="line-1521"></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681081020"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621681081020"><span class="hs-identifier hs-var">env'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681081019"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081019"><span class="hs-identifier hs-var">msg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; TcM (TidyEnv, SDoc)
</span><a href="#local-6989586621681081024"><span class="hs-identifier hs-var">ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621681081026"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-1522"></span><span>          </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681081015"><span class="annot"><span class="annottext">n' :: Int
</span><a href="#local-6989586621681081015"><span class="hs-identifier hs-var hs-var">n'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681081025"><span class="hs-identifier hs-var">is_landmark</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681081027"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681081027"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-1523"></span><span>          </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681081013"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081013"><span class="hs-identifier hs-var">rest</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Int -&gt; TidyEnv -&gt; [ErrCtxt] -&gt; TcRn SDoc
</span><a href="#local-6989586621681081029"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681081028"><span class="hs-identifier hs-var">dbg</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681081015"><span class="hs-identifier hs-var">n'</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621681081020"><span class="hs-identifier hs-var">env'</span></a></span><span> </span><span class="annot"><span class="annottext">[ErrCtxt]
</span><a href="#local-6989586621681081023"><span class="hs-identifier hs-var">ctxts</span></a></span><span>
</span><span id="line-1524"></span><span>          </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcRn SDoc
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081019"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681081013"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1525"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1526"></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Int -&gt; TidyEnv -&gt; [ErrCtxt] -&gt; TcRn SDoc
</span><a href="#local-6989586621681081029"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681081028"><span class="hs-identifier hs-var">dbg</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681081027"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621681081026"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">[ErrCtxt]
</span><a href="#local-6989586621681081023"><span class="hs-identifier hs-var">ctxts</span></a></span><span>
</span><span id="line-1527"></span><span>
</span><span id="line-1528"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#mAX_CONTEXTS"><span class="hs-identifier hs-type">mAX_CONTEXTS</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>     </span><span class="hs-comment">-- No more than this number of non-landmark contexts</span><span>
</span><span id="line-1529"></span><span id="mAX_CONTEXTS"><span class="annot"><span class="annottext">mAX_CONTEXTS :: Int
</span><a href="GHC.Tc.Utils.Monad.html#mAX_CONTEXTS"><span class="hs-identifier hs-var hs-var">mAX_CONTEXTS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">3</span></span><span>
</span><span id="line-1530"></span><span>
</span><span id="line-1531"></span><span class="hs-comment">-- debugTc is useful for monadic debugging code</span><span>
</span><span id="line-1532"></span><span>
</span><span id="line-1533"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#debugTc"><span class="hs-identifier hs-type">debugTc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1534"></span><span id="debugTc"><span class="annot"><span class="annottext">debugTc :: TcM () -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#debugTc"><span class="hs-identifier hs-var hs-var">debugTc</span></a></span></span><span> </span><span id="local-6989586621681081011"><span class="annot"><span class="annottext">TcM ()
</span><a href="#local-6989586621681081011"><span class="hs-identifier hs-var">thing</span></a></span></span><span>
</span><span id="line-1535"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="GHC.Utils.Misc.html#debugIsOn"><span class="hs-identifier hs-var">debugIsOn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM ()
</span><a href="#local-6989586621681081011"><span class="hs-identifier hs-var">thing</span></a></span><span>
</span><span id="line-1536"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcM ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1537"></span><span>
</span><span id="line-1538"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
             Type constraints
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-1545"></span><span>
</span><span id="line-1546"></span><span id="local-6989586621681082459"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addTopEvBinds"><span class="hs-identifier hs-type">addTopEvBinds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBind"><span class="hs-identifier hs-type">EvBind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082459"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082459"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1547"></span><span id="addTopEvBinds"><span class="annot"><span class="annottext">addTopEvBinds :: forall a. Bag EvBind -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addTopEvBinds"><span class="hs-identifier hs-var hs-var">addTopEvBinds</span></a></span></span><span> </span><span id="local-6989586621681081009"><span class="annot"><span class="annottext">Bag EvBind
</span><a href="#local-6989586621681081009"><span class="hs-identifier hs-var">new_ev_binds</span></a></span></span><span> </span><span id="local-6989586621681081008"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681081008"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1548"></span><span>  </span><span class="hs-glyph">=</span><span class="annot"><span class="annottext">(TcGblEnv -&gt; TcGblEnv) -&gt; TcM a -&gt; TcM a
forall gbl lcl a.
(gbl -&gt; gbl) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updGblEnv"><span class="hs-identifier hs-var">updGblEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; TcGblEnv
</span><a href="#local-6989586621681081007"><span class="hs-identifier hs-var">upd_env</span></a></span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681081008"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1549"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1550"></span><span>    </span><span id="local-6989586621681081007"><span class="annot"><span class="annottext">upd_env :: TcGblEnv -&gt; TcGblEnv
</span><a href="#local-6989586621681081007"><span class="hs-identifier hs-var hs-var">upd_env</span></a></span></span><span> </span><span id="local-6989586621681081006"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681081006"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681081006"><span class="hs-identifier hs-var">tcg_env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcg_ev_binds :: Bag EvBind
</span><a href="GHC.Tc.Types.html#tcg_ev_binds"><span class="hs-identifier hs-var">tcg_ev_binds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; Bag EvBind
</span><a href="GHC.Tc.Types.html#tcg_ev_binds"><span class="hs-identifier hs-var hs-var">tcg_ev_binds</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681081006"><span class="hs-identifier hs-var">tcg_env</span></a></span><span>
</span><span id="line-1551"></span><span>                                               </span><span class="annot"><span class="annottext">Bag EvBind -&gt; Bag EvBind -&gt; Bag EvBind
forall a. Bag a -&gt; Bag a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#unionBags"><span class="hs-operator hs-var">`unionBags`</span></a></span><span> </span><span class="annot"><span class="annottext">Bag EvBind
</span><a href="#local-6989586621681081009"><span class="hs-identifier hs-var">new_ev_binds</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1552"></span><span>
</span><span id="line-1553"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newTcEvBinds"><span class="hs-identifier hs-type">newTcEvBinds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBindsVar"><span class="hs-identifier hs-type">EvBindsVar</span></a></span><span>
</span><span id="line-1554"></span><span id="newTcEvBinds"><span class="annot"><span class="annottext">newTcEvBinds :: TcM EvBindsVar
</span><a href="GHC.Tc.Utils.Monad.html#newTcEvBinds"><span class="hs-identifier hs-var hs-var">newTcEvBinds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681081004"><span class="annot"><span class="annottext">TcRef EvBindMap
</span><a href="#local-6989586621681081004"><span class="hs-identifier hs-var">binds_ref</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">EvBindMap -&gt; TcRnIf TcGblEnv TcLclEnv (TcRef EvBindMap)
forall a gbl lcl. a -&gt; TcRnIf gbl lcl (TcRef a)
</span><a href="GHC.Tc.Utils.Monad.html#newTcRef"><span class="hs-identifier hs-var">newTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">EvBindMap
</span><a href="GHC.Tc.Types.Evidence.html#emptyEvBindMap"><span class="hs-identifier hs-var">emptyEvBindMap</span></a></span><span>
</span><span id="line-1555"></span><span>                  </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681081002"><span class="annot"><span class="annottext">TcRef VarSet
</span><a href="#local-6989586621681081002"><span class="hs-identifier hs-var">tcvs_ref</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; TcRnIf TcGblEnv TcLclEnv (TcRef VarSet)
forall a gbl lcl. a -&gt; TcRnIf gbl lcl (TcRef a)
</span><a href="GHC.Tc.Utils.Monad.html#newTcRef"><span class="hs-identifier hs-var">newTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="GHC.Types.Var.Set.html#emptyVarSet"><span class="hs-identifier hs-var">emptyVarSet</span></a></span><span>
</span><span id="line-1556"></span><span>                  </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681081000"><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621681081000"><span class="hs-identifier hs-var">uniq</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv Unique
forall gbl lcl. TcRnIf gbl lcl Unique
</span><a href="GHC.Tc.Utils.Monad.html#newUnique"><span class="hs-identifier hs-var">newUnique</span></a></span><span>
</span><span id="line-1557"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;newTcEvBinds&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;unique =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Unique -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621681081000"><span class="hs-identifier hs-var">uniq</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1558"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">EvBindsVar -&gt; TcM EvBindsVar
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvBindsVar :: Unique -&gt; TcRef EvBindMap -&gt; TcRef VarSet -&gt; EvBindsVar
</span><a href="GHC.Tc.Types.Evidence.html#EvBindsVar"><span class="hs-identifier hs-type">EvBindsVar</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ebv_binds :: TcRef EvBindMap
</span><a href="GHC.Tc.Types.Evidence.html#ebv_binds"><span class="hs-identifier hs-var">ebv_binds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRef EvBindMap
</span><a href="#local-6989586621681081004"><span class="hs-identifier hs-var">binds_ref</span></a></span><span>
</span><span id="line-1559"></span><span>                                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ebv_tcvs :: TcRef VarSet
</span><a href="GHC.Tc.Types.Evidence.html#ebv_tcvs"><span class="hs-identifier hs-var">ebv_tcvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRef VarSet
</span><a href="#local-6989586621681081002"><span class="hs-identifier hs-var">tcvs_ref</span></a></span><span>
</span><span id="line-1560"></span><span>                                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ebv_uniq :: Unique
</span><a href="GHC.Tc.Types.Evidence.html#ebv_uniq"><span class="hs-identifier hs-var">ebv_uniq</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621681081000"><span class="hs-identifier hs-var">uniq</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1561"></span><span>
</span><span id="line-1562"></span><span class="hs-comment">-- | Creates an EvBindsVar incapable of holding any bindings. It still</span><span>
</span><span id="line-1563"></span><span class="hs-comment">-- tracks covar usages (see comments on ebv_tcvs in &quot;GHC.Tc.Types.Evidence&quot;), thus</span><span>
</span><span id="line-1564"></span><span class="hs-comment">-- must be made monadically</span><span>
</span><span id="line-1565"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#newNoTcEvBinds"><span class="hs-identifier hs-type">newNoTcEvBinds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBindsVar"><span class="hs-identifier hs-type">EvBindsVar</span></a></span><span>
</span><span id="line-1566"></span><span id="newNoTcEvBinds"><span class="annot"><span class="annottext">newNoTcEvBinds :: TcM EvBindsVar
</span><a href="GHC.Tc.Utils.Monad.html#newNoTcEvBinds"><span class="hs-identifier hs-var hs-var">newNoTcEvBinds</span></a></span></span><span>
</span><span id="line-1567"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681080994"><span class="annot"><span class="annottext">TcRef VarSet
</span><a href="#local-6989586621681080994"><span class="hs-identifier hs-var">tcvs_ref</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; TcRnIf TcGblEnv TcLclEnv (TcRef VarSet)
forall a gbl lcl. a -&gt; TcRnIf gbl lcl (TcRef a)
</span><a href="GHC.Tc.Utils.Monad.html#newTcRef"><span class="hs-identifier hs-var">newTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="GHC.Types.Var.Set.html#emptyVarSet"><span class="hs-identifier hs-var">emptyVarSet</span></a></span><span>
</span><span id="line-1568"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681080993"><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621681080993"><span class="hs-identifier hs-var">uniq</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv Unique
forall gbl lcl. TcRnIf gbl lcl Unique
</span><a href="GHC.Tc.Utils.Monad.html#newUnique"><span class="hs-identifier hs-var">newUnique</span></a></span><span>
</span><span id="line-1569"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;newNoTcEvBinds&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;unique =&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Unique -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621681080993"><span class="hs-identifier hs-var">uniq</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1570"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">EvBindsVar -&gt; TcM EvBindsVar
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoEvBindsVar :: Unique -&gt; TcRef VarSet -&gt; EvBindsVar
</span><a href="GHC.Tc.Types.Evidence.html#CoEvBindsVar"><span class="hs-identifier hs-type">CoEvBindsVar</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ebv_tcvs :: TcRef VarSet
</span><a href="GHC.Tc.Types.Evidence.html#ebv_tcvs"><span class="hs-identifier hs-var">ebv_tcvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRef VarSet
</span><a href="#local-6989586621681080994"><span class="hs-identifier hs-var">tcvs_ref</span></a></span><span>
</span><span id="line-1571"></span><span>                              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ebv_uniq :: Unique
</span><a href="GHC.Tc.Types.Evidence.html#ebv_uniq"><span class="hs-identifier hs-var">ebv_uniq</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621681080993"><span class="hs-identifier hs-var">uniq</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1572"></span><span>
</span><span id="line-1573"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#cloneEvBindsVar"><span class="hs-identifier hs-type">cloneEvBindsVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBindsVar"><span class="hs-identifier hs-type">EvBindsVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBindsVar"><span class="hs-identifier hs-type">EvBindsVar</span></a></span><span>
</span><span id="line-1574"></span><span class="hs-comment">-- Clone the refs, so that any binding created when</span><span>
</span><span id="line-1575"></span><span class="hs-comment">-- solving don't pollute the original</span><span>
</span><span id="line-1576"></span><span id="cloneEvBindsVar"><span class="annot"><span class="annottext">cloneEvBindsVar :: EvBindsVar -&gt; TcM EvBindsVar
</span><a href="GHC.Tc.Utils.Monad.html#cloneEvBindsVar"><span class="hs-identifier hs-var hs-var">cloneEvBindsVar</span></a></span></span><span> </span><span id="local-6989586621681080991"><span class="annot"><span class="annottext">ebv :: EvBindsVar
</span><a href="#local-6989586621681080991"><span class="hs-identifier hs-var">ebv</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBindsVar"><span class="hs-identifier hs-type">EvBindsVar</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1577"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681080990"><span class="annot"><span class="annottext">TcRef EvBindMap
</span><a href="#local-6989586621681080990"><span class="hs-identifier hs-var">binds_ref</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">EvBindMap -&gt; TcRnIf TcGblEnv TcLclEnv (TcRef EvBindMap)
forall a gbl lcl. a -&gt; TcRnIf gbl lcl (TcRef a)
</span><a href="GHC.Tc.Utils.Monad.html#newTcRef"><span class="hs-identifier hs-var">newTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">EvBindMap
</span><a href="GHC.Tc.Types.Evidence.html#emptyEvBindMap"><span class="hs-identifier hs-var">emptyEvBindMap</span></a></span><span>
</span><span id="line-1578"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681080989"><span class="annot"><span class="annottext">TcRef VarSet
</span><a href="#local-6989586621681080989"><span class="hs-identifier hs-var">tcvs_ref</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; TcRnIf TcGblEnv TcLclEnv (TcRef VarSet)
forall a gbl lcl. a -&gt; TcRnIf gbl lcl (TcRef a)
</span><a href="GHC.Tc.Utils.Monad.html#newTcRef"><span class="hs-identifier hs-var">newTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="GHC.Types.Var.Set.html#emptyVarSet"><span class="hs-identifier hs-var">emptyVarSet</span></a></span><span>
</span><span id="line-1579"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">EvBindsVar -&gt; TcM EvBindsVar
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvBindsVar
</span><a href="#local-6989586621681080991"><span class="hs-identifier hs-var">ebv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ebv_binds :: TcRef EvBindMap
</span><a href="GHC.Tc.Types.Evidence.html#ebv_binds"><span class="hs-identifier hs-var">ebv_binds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRef EvBindMap
</span><a href="#local-6989586621681080990"><span class="hs-identifier hs-var">binds_ref</span></a></span><span>
</span><span id="line-1580"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ebv_tcvs :: TcRef VarSet
</span><a href="GHC.Tc.Types.Evidence.html#ebv_tcvs"><span class="hs-identifier hs-var">ebv_tcvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRef VarSet
</span><a href="#local-6989586621681080989"><span class="hs-identifier hs-var">tcvs_ref</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1581"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#cloneEvBindsVar"><span class="hs-identifier hs-var">cloneEvBindsVar</span></a></span><span> </span><span id="local-6989586621681080988"><span class="annot"><span class="annottext">ebv :: EvBindsVar
</span><a href="#local-6989586621681080988"><span class="hs-identifier hs-var">ebv</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#CoEvBindsVar"><span class="hs-identifier hs-type">CoEvBindsVar</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1582"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681080987"><span class="annot"><span class="annottext">TcRef VarSet
</span><a href="#local-6989586621681080987"><span class="hs-identifier hs-var">tcvs_ref</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; TcRnIf TcGblEnv TcLclEnv (TcRef VarSet)
forall a gbl lcl. a -&gt; TcRnIf gbl lcl (TcRef a)
</span><a href="GHC.Tc.Utils.Monad.html#newTcRef"><span class="hs-identifier hs-var">newTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="GHC.Types.Var.Set.html#emptyVarSet"><span class="hs-identifier hs-var">emptyVarSet</span></a></span><span>
</span><span id="line-1583"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">EvBindsVar -&gt; TcM EvBindsVar
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvBindsVar
</span><a href="#local-6989586621681080988"><span class="hs-identifier hs-var">ebv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ebv_tcvs :: TcRef VarSet
</span><a href="GHC.Tc.Types.Evidence.html#ebv_tcvs"><span class="hs-identifier hs-var">ebv_tcvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRef VarSet
</span><a href="#local-6989586621681080987"><span class="hs-identifier hs-var">tcvs_ref</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1584"></span><span>
</span><span id="line-1585"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getTcEvTyCoVars"><span class="hs-identifier hs-type">getTcEvTyCoVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBindsVar"><span class="hs-identifier hs-type">EvBindsVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#TyCoVarSet"><span class="hs-identifier hs-type">TyCoVarSet</span></a></span><span>
</span><span id="line-1586"></span><span id="getTcEvTyCoVars"><span class="annot"><span class="annottext">getTcEvTyCoVars :: EvBindsVar -&gt; TcM VarSet
</span><a href="GHC.Tc.Utils.Monad.html#getTcEvTyCoVars"><span class="hs-identifier hs-var hs-var">getTcEvTyCoVars</span></a></span></span><span> </span><span id="local-6989586621681080985"><span class="annot"><span class="annottext">EvBindsVar
</span><a href="#local-6989586621681080985"><span class="hs-identifier hs-var">ev_binds_var</span></a></span></span><span>
</span><span id="line-1587"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRef VarSet -&gt; TcM VarSet
forall a gbl lcl. TcRef a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvBindsVar -&gt; TcRef VarSet
</span><a href="GHC.Tc.Types.Evidence.html#ebv_tcvs"><span class="hs-identifier hs-var hs-var">ebv_tcvs</span></a></span><span> </span><span class="annot"><span class="annottext">EvBindsVar
</span><a href="#local-6989586621681080985"><span class="hs-identifier hs-var">ev_binds_var</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1588"></span><span>
</span><span id="line-1589"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getTcEvBindsMap"><span class="hs-identifier hs-type">getTcEvBindsMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBindsVar"><span class="hs-identifier hs-type">EvBindsVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBindMap"><span class="hs-identifier hs-type">EvBindMap</span></a></span><span>
</span><span id="line-1590"></span><span id="getTcEvBindsMap"><span class="annot"><span class="annottext">getTcEvBindsMap :: EvBindsVar -&gt; TcM EvBindMap
</span><a href="GHC.Tc.Utils.Monad.html#getTcEvBindsMap"><span class="hs-identifier hs-var hs-var">getTcEvBindsMap</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBindsVar"><span class="hs-identifier hs-type">EvBindsVar</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ebv_binds :: EvBindsVar -&gt; TcRef EvBindMap
</span><a href="GHC.Tc.Types.Evidence.html#ebv_binds"><span class="hs-identifier hs-var">ebv_binds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681080984"><span class="annot"><span class="annottext">TcRef EvBindMap
</span><a href="#local-6989586621681080984"><span class="hs-identifier hs-var">ev_ref</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1591"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRef EvBindMap -&gt; TcM EvBindMap
forall a gbl lcl. TcRef a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef EvBindMap
</span><a href="#local-6989586621681080984"><span class="hs-identifier hs-var">ev_ref</span></a></span><span>
</span><span id="line-1592"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getTcEvBindsMap"><span class="hs-identifier hs-var">getTcEvBindsMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#CoEvBindsVar"><span class="hs-identifier hs-type">CoEvBindsVar</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1593"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">EvBindMap -&gt; TcM EvBindMap
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">EvBindMap
</span><a href="GHC.Tc.Types.Evidence.html#emptyEvBindMap"><span class="hs-identifier hs-var">emptyEvBindMap</span></a></span><span>
</span><span id="line-1594"></span><span>
</span><span id="line-1595"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setTcEvBindsMap"><span class="hs-identifier hs-type">setTcEvBindsMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBindsVar"><span class="hs-identifier hs-type">EvBindsVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBindMap"><span class="hs-identifier hs-type">EvBindMap</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1596"></span><span id="setTcEvBindsMap"><span class="annot"><span class="annottext">setTcEvBindsMap :: EvBindsVar -&gt; EvBindMap -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#setTcEvBindsMap"><span class="hs-identifier hs-var hs-var">setTcEvBindsMap</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBindsVar"><span class="hs-identifier hs-type">EvBindsVar</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ebv_binds :: EvBindsVar -&gt; TcRef EvBindMap
</span><a href="GHC.Tc.Types.Evidence.html#ebv_binds"><span class="hs-identifier hs-var">ebv_binds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681080983"><span class="annot"><span class="annottext">TcRef EvBindMap
</span><a href="#local-6989586621681080983"><span class="hs-identifier hs-var">ev_ref</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621681080982"><span class="annot"><span class="annottext">EvBindMap
</span><a href="#local-6989586621681080982"><span class="hs-identifier hs-var">binds</span></a></span></span><span>
</span><span id="line-1597"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcRef EvBindMap -&gt; EvBindMap -&gt; TcM ()
forall a gbl lcl. TcRef a -&gt; a -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#writeTcRef"><span class="hs-identifier hs-var">writeTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef EvBindMap
</span><a href="#local-6989586621681080983"><span class="hs-identifier hs-var">ev_ref</span></a></span><span> </span><span class="annot"><span class="annottext">EvBindMap
</span><a href="#local-6989586621681080982"><span class="hs-identifier hs-var">binds</span></a></span><span>
</span><span id="line-1598"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setTcEvBindsMap"><span class="hs-identifier hs-var">setTcEvBindsMap</span></a></span><span> </span><span id="local-6989586621681080981"><span class="annot"><span class="annottext">v :: EvBindsVar
</span><a href="#local-6989586621681080981"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#CoEvBindsVar"><span class="hs-identifier hs-type">CoEvBindsVar</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621681080980"><span class="annot"><span class="annottext">EvBindMap
</span><a href="#local-6989586621681080980"><span class="hs-identifier hs-var">ev_binds</span></a></span></span><span>
</span><span id="line-1599"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">EvBindMap -&gt; Bool
</span><a href="GHC.Tc.Types.Evidence.html#isEmptyEvBindMap"><span class="hs-identifier hs-var">isEmptyEvBindMap</span></a></span><span> </span><span class="annot"><span class="annottext">EvBindMap
</span><a href="#local-6989586621681080980"><span class="hs-identifier hs-var">ev_binds</span></a></span><span>
</span><span id="line-1600"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcM ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1601"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1602"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc -&gt; TcM ()
forall a. HasCallStack =&gt; FilePath -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;setTcEvBindsMap&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvBindsVar -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">EvBindsVar
</span><a href="#local-6989586621681080981"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">EvBindMap -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">EvBindMap
</span><a href="#local-6989586621681080980"><span class="hs-identifier hs-var">ev_binds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1603"></span><span>
</span><span id="line-1604"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addTcEvBind"><span class="hs-identifier hs-type">addTcEvBind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBindsVar"><span class="hs-identifier hs-type">EvBindsVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBind"><span class="hs-identifier hs-type">EvBind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1605"></span><span class="hs-comment">-- Add a binding to the TcEvBinds by side effect</span><span>
</span><span id="line-1606"></span><span id="addTcEvBind"><span class="annot"><span class="annottext">addTcEvBind :: EvBindsVar -&gt; EvBind -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addTcEvBind"><span class="hs-identifier hs-var hs-var">addTcEvBind</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#EvBindsVar"><span class="hs-identifier hs-type">EvBindsVar</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ebv_binds :: EvBindsVar -&gt; TcRef EvBindMap
</span><a href="GHC.Tc.Types.Evidence.html#ebv_binds"><span class="hs-identifier hs-var">ebv_binds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681080978"><span class="annot"><span class="annottext">TcRef EvBindMap
</span><a href="#local-6989586621681080978"><span class="hs-identifier hs-var">ev_ref</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ebv_uniq :: EvBindsVar -&gt; Unique
</span><a href="GHC.Tc.Types.Evidence.html#ebv_uniq"><span class="hs-identifier hs-var">ebv_uniq</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681080977"><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621681080977"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621681080976"><span class="annot"><span class="annottext">EvBind
</span><a href="#local-6989586621681080976"><span class="hs-identifier hs-var">ev_bind</span></a></span></span><span>
</span><span id="line-1607"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;addTcEvBind&quot;</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; TcM ()) -&gt; SDoc -&gt; TcM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Unique -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621681080977"><span class="hs-identifier hs-var">u</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-1608"></span><span>                                 </span><span class="annot"><span class="annottext">EvBind -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">EvBind
</span><a href="#local-6989586621681080976"><span class="hs-identifier hs-var">ev_bind</span></a></span><span>
</span><span id="line-1609"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681080975"><span class="annot"><span class="annottext">EvBindMap
</span><a href="#local-6989586621681080975"><span class="hs-identifier hs-var">bnds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRef EvBindMap -&gt; TcM EvBindMap
forall a gbl lcl. TcRef a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef EvBindMap
</span><a href="#local-6989586621681080978"><span class="hs-identifier hs-var">ev_ref</span></a></span><span>
</span><span id="line-1610"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcRef EvBindMap -&gt; EvBindMap -&gt; TcM ()
forall a gbl lcl. TcRef a -&gt; a -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#writeTcRef"><span class="hs-identifier hs-var">writeTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef EvBindMap
</span><a href="#local-6989586621681080978"><span class="hs-identifier hs-var">ev_ref</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvBindMap -&gt; EvBind -&gt; EvBindMap
</span><a href="GHC.Tc.Types.Evidence.html#extendEvBinds"><span class="hs-identifier hs-var">extendEvBinds</span></a></span><span> </span><span class="annot"><span class="annottext">EvBindMap
</span><a href="#local-6989586621681080975"><span class="hs-identifier hs-var">bnds</span></a></span><span> </span><span class="annot"><span class="annottext">EvBind
</span><a href="#local-6989586621681080976"><span class="hs-identifier hs-var">ev_bind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1611"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addTcEvBind"><span class="hs-identifier hs-var">addTcEvBind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#CoEvBindsVar"><span class="hs-identifier hs-type">CoEvBindsVar</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ebv_uniq :: EvBindsVar -&gt; Unique
</span><a href="GHC.Tc.Types.Evidence.html#ebv_uniq"><span class="hs-identifier hs-var">ebv_uniq</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681080973"><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621681080973"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621681080972"><span class="annot"><span class="annottext">EvBind
</span><a href="#local-6989586621681080972"><span class="hs-identifier hs-var">ev_bind</span></a></span></span><span>
</span><span id="line-1612"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc -&gt; TcM ()
forall a. HasCallStack =&gt; FilePath -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;addTcEvBind CoEvBindsVar&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">EvBind -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">EvBind
</span><a href="#local-6989586621681080972"><span class="hs-identifier hs-var">ev_bind</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">Unique -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621681080973"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1613"></span><span>
</span><span id="line-1614"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#chooseUniqueOccTc"><span class="hs-identifier hs-type">chooseUniqueOccTc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.Occurrence.html#OccSet"><span class="hs-identifier hs-type">OccSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Occurrence.html#OccName"><span class="hs-identifier hs-type">OccName</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Occurrence.html#OccName"><span class="hs-identifier hs-type">OccName</span></a></span><span>
</span><span id="line-1615"></span><span id="chooseUniqueOccTc"><span class="annot"><span class="annottext">chooseUniqueOccTc :: (OccSet -&gt; OccName) -&gt; TcM OccName
</span><a href="GHC.Tc.Utils.Monad.html#chooseUniqueOccTc"><span class="hs-identifier hs-var hs-var">chooseUniqueOccTc</span></a></span></span><span> </span><span id="local-6989586621681080971"><span class="annot"><span class="annottext">OccSet -&gt; OccName
</span><a href="#local-6989586621681080971"><span class="hs-identifier hs-var">fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1616"></span><span>  </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681080970"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681080970"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-1617"></span><span>     </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681080969"><span class="annot"><span class="annottext">dfun_n_var :: IORef OccSet
</span><a href="#local-6989586621681080969"><span class="hs-identifier hs-var hs-var">dfun_n_var</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; IORef OccSet
</span><a href="GHC.Tc.Types.html#tcg_dfun_n"><span class="hs-identifier hs-var hs-var">tcg_dfun_n</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681080970"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-1618"></span><span>     </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681080968"><span class="annot"><span class="annottext">OccSet
</span><a href="#local-6989586621681080968"><span class="hs-identifier hs-var">set</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef OccSet -&gt; TcRnIf TcGblEnv TcLclEnv OccSet
forall a gbl lcl. TcRef a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef OccSet
</span><a href="#local-6989586621681080969"><span class="hs-identifier hs-var">dfun_n_var</span></a></span><span>
</span><span id="line-1619"></span><span>     </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681080967"><span class="annot"><span class="annottext">occ :: OccName
</span><a href="#local-6989586621681080967"><span class="hs-identifier hs-var hs-var">occ</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OccSet -&gt; OccName
</span><a href="#local-6989586621681080971"><span class="hs-identifier hs-var">fn</span></a></span><span> </span><span class="annot"><span class="annottext">OccSet
</span><a href="#local-6989586621681080968"><span class="hs-identifier hs-var">set</span></a></span><span>
</span><span id="line-1620"></span><span>     </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">IORef OccSet -&gt; OccSet -&gt; TcM ()
forall a gbl lcl. TcRef a -&gt; a -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#writeTcRef"><span class="hs-identifier hs-var">writeTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef OccSet
</span><a href="#local-6989586621681080969"><span class="hs-identifier hs-var">dfun_n_var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OccSet -&gt; OccName -&gt; OccSet
</span><a href="GHC.Types.Name.Occurrence.html#extendOccSet"><span class="hs-identifier hs-var">extendOccSet</span></a></span><span> </span><span class="annot"><span class="annottext">OccSet
</span><a href="#local-6989586621681080968"><span class="hs-identifier hs-var">set</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621681080967"><span class="hs-identifier hs-var">occ</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1621"></span><span>     </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; TcM OccName
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621681080967"><span class="hs-identifier hs-var">occ</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1622"></span><span>
</span><span id="line-1623"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getConstraintVar"><span class="hs-identifier hs-type">getConstraintVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#TcRef"><span class="hs-identifier hs-type">TcRef</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1624"></span><span id="getConstraintVar"><span class="annot"><span class="annottext">getConstraintVar :: TcRnIf TcGblEnv TcLclEnv (IORef WantedConstraints)
</span><a href="GHC.Tc.Utils.Monad.html#getConstraintVar"><span class="hs-identifier hs-var hs-var">getConstraintVar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681080965"><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681080965"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcLclEnv
forall gbl lcl. TcRnIf gbl lcl lcl
</span><a href="GHC.Tc.Utils.Monad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">IORef WantedConstraints
-&gt; TcRnIf TcGblEnv TcLclEnv (IORef WantedConstraints)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcLclEnv -&gt; IORef WantedConstraints
</span><a href="GHC.Tc.Types.html#tcl_lie"><span class="hs-identifier hs-var hs-var">tcl_lie</span></a></span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681080965"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1625"></span><span>
</span><span id="line-1626"></span><span id="local-6989586621681082455"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setConstraintVar"><span class="hs-identifier hs-type">setConstraintVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRef"><span class="hs-identifier hs-type">TcRef</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082455"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082455"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1627"></span><span id="setConstraintVar"><span class="annot"><span class="annottext">setConstraintVar :: forall a. IORef WantedConstraints -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#setConstraintVar"><span class="hs-identifier hs-var hs-var">setConstraintVar</span></a></span></span><span> </span><span id="local-6989586621681080964"><span class="annot"><span class="annottext">IORef WantedConstraints
</span><a href="#local-6989586621681080964"><span class="hs-identifier hs-var">lie_var</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcLclEnv -&gt; TcLclEnv)
-&gt; TcRnIf TcGblEnv TcLclEnv a -&gt; TcRnIf TcGblEnv TcLclEnv a
forall lcl gbl a.
(lcl -&gt; lcl) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updLclEnv"><span class="hs-identifier hs-var">updLclEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681080963"><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681080963"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681080963"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcl_lie :: IORef WantedConstraints
</span><a href="GHC.Tc.Types.html#tcl_lie"><span class="hs-identifier hs-var">tcl_lie</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef WantedConstraints
</span><a href="#local-6989586621681080964"><span class="hs-identifier hs-var">lie_var</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1628"></span><span>
</span><span id="line-1629"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitStaticConstraints"><span class="hs-identifier hs-type">emitStaticConstraints</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1630"></span><span id="emitStaticConstraints"><span class="annot"><span class="annottext">emitStaticConstraints :: WantedConstraints -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#emitStaticConstraints"><span class="hs-identifier hs-var hs-var">emitStaticConstraints</span></a></span></span><span> </span><span id="local-6989586621681080962"><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621681080962"><span class="hs-identifier hs-var">static_lie</span></a></span></span><span>
</span><span id="line-1631"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681080961"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681080961"><span class="hs-identifier hs-var">gbl_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-1632"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">IORef WantedConstraints
-&gt; (WantedConstraints -&gt; WantedConstraints) -&gt; TcM ()
forall a gbl lcl. TcRef a -&gt; (a -&gt; a) -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#updTcRef"><span class="hs-identifier hs-var">updTcRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; IORef WantedConstraints
</span><a href="GHC.Tc.Types.html#tcg_static_wc"><span class="hs-identifier hs-var hs-var">tcg_static_wc</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681080961"><span class="hs-identifier hs-var">gbl_env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WantedConstraints -&gt; WantedConstraints -&gt; WantedConstraints
</span><a href="GHC.Tc.Types.Constraint.html#andWC"><span class="hs-operator hs-var">`andWC`</span></a></span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621681080962"><span class="hs-identifier hs-var">static_lie</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1633"></span><span>
</span><span id="line-1634"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitConstraints"><span class="hs-identifier hs-type">emitConstraints</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1635"></span><span id="emitConstraints"><span class="annot"><span class="annottext">emitConstraints :: WantedConstraints -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#emitConstraints"><span class="hs-identifier hs-var hs-var">emitConstraints</span></a></span></span><span> </span><span id="local-6989586621681080959"><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621681080959"><span class="hs-identifier hs-var">ct</span></a></span></span><span>
</span><span id="line-1636"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">WantedConstraints -&gt; Bool
</span><a href="GHC.Tc.Types.Constraint.html#isEmptyWC"><span class="hs-identifier hs-var">isEmptyWC</span></a></span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621681080959"><span class="hs-identifier hs-var">ct</span></a></span><span>
</span><span id="line-1637"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcM ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1638"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1639"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681080958"><span class="annot"><span class="annottext">IORef WantedConstraints
</span><a href="#local-6989586621681080958"><span class="hs-identifier hs-var">lie_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv (IORef WantedConstraints)
</span><a href="GHC.Tc.Utils.Monad.html#getConstraintVar"><span class="hs-identifier hs-var">getConstraintVar</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1640"></span><span>         </span><span class="annot"><span class="annottext">IORef WantedConstraints
-&gt; (WantedConstraints -&gt; WantedConstraints) -&gt; TcM ()
forall a gbl lcl. TcRef a -&gt; (a -&gt; a) -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#updTcRef"><span class="hs-identifier hs-var">updTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef WantedConstraints
</span><a href="#local-6989586621681080958"><span class="hs-identifier hs-var">lie_var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WantedConstraints -&gt; WantedConstraints -&gt; WantedConstraints
</span><a href="GHC.Tc.Types.Constraint.html#andWC"><span class="hs-operator hs-var">`andWC`</span></a></span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621681080959"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1641"></span><span>
</span><span id="line-1642"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitSimple"><span class="hs-identifier hs-type">emitSimple</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1643"></span><span id="emitSimple"><span class="annot"><span class="annottext">emitSimple :: Ct -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#emitSimple"><span class="hs-identifier hs-var hs-var">emitSimple</span></a></span></span><span> </span><span id="local-6989586621681080957"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681080957"><span class="hs-identifier hs-var">ct</span></a></span></span><span>
</span><span id="line-1644"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681080956"><span class="annot"><span class="annottext">IORef WantedConstraints
</span><a href="#local-6989586621681080956"><span class="hs-identifier hs-var">lie_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv (IORef WantedConstraints)
</span><a href="GHC.Tc.Utils.Monad.html#getConstraintVar"><span class="hs-identifier hs-var">getConstraintVar</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1645"></span><span>         </span><span class="annot"><span class="annottext">IORef WantedConstraints
-&gt; (WantedConstraints -&gt; WantedConstraints) -&gt; TcM ()
forall a gbl lcl. TcRef a -&gt; (a -&gt; a) -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#updTcRef"><span class="hs-identifier hs-var">updTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef WantedConstraints
</span><a href="#local-6989586621681080956"><span class="hs-identifier hs-var">lie_var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WantedConstraints -&gt; Bag Ct -&gt; WantedConstraints
</span><a href="GHC.Tc.Types.Constraint.html#addSimples"><span class="hs-operator hs-var">`addSimples`</span></a></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; Bag Ct
forall a. a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#unitBag"><span class="hs-identifier hs-var">unitBag</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681080957"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1646"></span><span>
</span><span id="line-1647"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitSimples"><span class="hs-identifier hs-type">emitSimples</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Cts"><span class="hs-identifier hs-type">Cts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1648"></span><span id="emitSimples"><span class="annot"><span class="annottext">emitSimples :: Bag Ct -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#emitSimples"><span class="hs-identifier hs-var hs-var">emitSimples</span></a></span></span><span> </span><span id="local-6989586621681080952"><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681080952"><span class="hs-identifier hs-var">cts</span></a></span></span><span>
</span><span id="line-1649"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681080951"><span class="annot"><span class="annottext">IORef WantedConstraints
</span><a href="#local-6989586621681080951"><span class="hs-identifier hs-var">lie_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv (IORef WantedConstraints)
</span><a href="GHC.Tc.Utils.Monad.html#getConstraintVar"><span class="hs-identifier hs-var">getConstraintVar</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1650"></span><span>         </span><span class="annot"><span class="annottext">IORef WantedConstraints
-&gt; (WantedConstraints -&gt; WantedConstraints) -&gt; TcM ()
forall a gbl lcl. TcRef a -&gt; (a -&gt; a) -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#updTcRef"><span class="hs-identifier hs-var">updTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef WantedConstraints
</span><a href="#local-6989586621681080951"><span class="hs-identifier hs-var">lie_var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WantedConstraints -&gt; Bag Ct -&gt; WantedConstraints
</span><a href="GHC.Tc.Types.Constraint.html#addSimples"><span class="hs-operator hs-var">`addSimples`</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Ct
</span><a href="#local-6989586621681080952"><span class="hs-identifier hs-var">cts</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1651"></span><span>
</span><span id="line-1652"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitImplication"><span class="hs-identifier hs-type">emitImplication</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Implication"><span class="hs-identifier hs-type">Implication</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1653"></span><span id="emitImplication"><span class="annot"><span class="annottext">emitImplication :: Implication -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#emitImplication"><span class="hs-identifier hs-var hs-var">emitImplication</span></a></span></span><span> </span><span id="local-6989586621681080950"><span class="annot"><span class="annottext">Implication
</span><a href="#local-6989586621681080950"><span class="hs-identifier hs-var">ct</span></a></span></span><span>
</span><span id="line-1654"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681080949"><span class="annot"><span class="annottext">IORef WantedConstraints
</span><a href="#local-6989586621681080949"><span class="hs-identifier hs-var">lie_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv (IORef WantedConstraints)
</span><a href="GHC.Tc.Utils.Monad.html#getConstraintVar"><span class="hs-identifier hs-var">getConstraintVar</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1655"></span><span>         </span><span class="annot"><span class="annottext">IORef WantedConstraints
-&gt; (WantedConstraints -&gt; WantedConstraints) -&gt; TcM ()
forall a gbl lcl. TcRef a -&gt; (a -&gt; a) -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#updTcRef"><span class="hs-identifier hs-var">updTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef WantedConstraints
</span><a href="#local-6989586621681080949"><span class="hs-identifier hs-var">lie_var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WantedConstraints -&gt; Bag Implication -&gt; WantedConstraints
</span><a href="GHC.Tc.Types.Constraint.html#addImplics"><span class="hs-operator hs-var">`addImplics`</span></a></span><span> </span><span class="annot"><span class="annottext">Implication -&gt; Bag Implication
forall a. a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#unitBag"><span class="hs-identifier hs-var">unitBag</span></a></span><span> </span><span class="annot"><span class="annottext">Implication
</span><a href="#local-6989586621681080950"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1656"></span><span>
</span><span id="line-1657"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitImplications"><span class="hs-identifier hs-type">emitImplications</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Implication"><span class="hs-identifier hs-type">Implication</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1658"></span><span id="emitImplications"><span class="annot"><span class="annottext">emitImplications :: Bag Implication -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#emitImplications"><span class="hs-identifier hs-var hs-var">emitImplications</span></a></span></span><span> </span><span id="local-6989586621681080947"><span class="annot"><span class="annottext">Bag Implication
</span><a href="#local-6989586621681080947"><span class="hs-identifier hs-var">ct</span></a></span></span><span>
</span><span id="line-1659"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcM () -&gt; TcM ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base/src/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bag Implication -&gt; Bool
forall a. Bag a -&gt; Bool
</span><a href="GHC.Data.Bag.html#isEmptyBag"><span class="hs-identifier hs-var">isEmptyBag</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Implication
</span><a href="#local-6989586621681080947"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM () -&gt; TcM ()) -&gt; TcM () -&gt; TcM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1660"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681080945"><span class="annot"><span class="annottext">IORef WantedConstraints
</span><a href="#local-6989586621681080945"><span class="hs-identifier hs-var">lie_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv (IORef WantedConstraints)
</span><a href="GHC.Tc.Utils.Monad.html#getConstraintVar"><span class="hs-identifier hs-var">getConstraintVar</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-1661"></span><span>         </span><span class="annot"><span class="annottext">IORef WantedConstraints
-&gt; (WantedConstraints -&gt; WantedConstraints) -&gt; TcM ()
forall a gbl lcl. TcRef a -&gt; (a -&gt; a) -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#updTcRef"><span class="hs-identifier hs-var">updTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef WantedConstraints
</span><a href="#local-6989586621681080945"><span class="hs-identifier hs-var">lie_var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WantedConstraints -&gt; Bag Implication -&gt; WantedConstraints
</span><a href="GHC.Tc.Types.Constraint.html#addImplics"><span class="hs-operator hs-var">`addImplics`</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Implication
</span><a href="#local-6989586621681080947"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1662"></span><span>
</span><span id="line-1663"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitInsoluble"><span class="hs-identifier hs-type">emitInsoluble</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Ct"><span class="hs-identifier hs-type">Ct</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1664"></span><span id="emitInsoluble"><span class="annot"><span class="annottext">emitInsoluble :: Ct -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#emitInsoluble"><span class="hs-identifier hs-var hs-var">emitInsoluble</span></a></span></span><span> </span><span id="local-6989586621681080944"><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681080944"><span class="hs-identifier hs-var">ct</span></a></span></span><span>
</span><span id="line-1665"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;emitInsoluble&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Ct -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681080944"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1666"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681080943"><span class="annot"><span class="annottext">IORef WantedConstraints
</span><a href="#local-6989586621681080943"><span class="hs-identifier hs-var">lie_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv (IORef WantedConstraints)
</span><a href="GHC.Tc.Utils.Monad.html#getConstraintVar"><span class="hs-identifier hs-var">getConstraintVar</span></a></span><span>
</span><span id="line-1667"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">IORef WantedConstraints
-&gt; (WantedConstraints -&gt; WantedConstraints) -&gt; TcM ()
forall a gbl lcl. TcRef a -&gt; (a -&gt; a) -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#updTcRef"><span class="hs-identifier hs-var">updTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef WantedConstraints
</span><a href="#local-6989586621681080943"><span class="hs-identifier hs-var">lie_var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WantedConstraints -&gt; Bag Ct -&gt; WantedConstraints
</span><a href="GHC.Tc.Types.Constraint.html#addInsols"><span class="hs-operator hs-var">`addInsols`</span></a></span><span> </span><span class="annot"><span class="annottext">Ct -&gt; Bag Ct
forall a. a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#unitBag"><span class="hs-identifier hs-var">unitBag</span></a></span><span> </span><span class="annot"><span class="annottext">Ct
</span><a href="#local-6989586621681080944"><span class="hs-identifier hs-var">ct</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1668"></span><span>
</span><span id="line-1669"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitHole"><span class="hs-identifier hs-type">emitHole</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Hole"><span class="hs-identifier hs-type">Hole</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1670"></span><span id="emitHole"><span class="annot"><span class="annottext">emitHole :: Hole -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#emitHole"><span class="hs-identifier hs-var hs-var">emitHole</span></a></span></span><span> </span><span id="local-6989586621681080941"><span class="annot"><span class="annottext">Hole
</span><a href="#local-6989586621681080941"><span class="hs-identifier hs-var">hole</span></a></span></span><span>
</span><span id="line-1671"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;emitHole&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Hole -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Hole
</span><a href="#local-6989586621681080941"><span class="hs-identifier hs-var">hole</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1672"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681080940"><span class="annot"><span class="annottext">IORef WantedConstraints
</span><a href="#local-6989586621681080940"><span class="hs-identifier hs-var">lie_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv (IORef WantedConstraints)
</span><a href="GHC.Tc.Utils.Monad.html#getConstraintVar"><span class="hs-identifier hs-var">getConstraintVar</span></a></span><span>
</span><span id="line-1673"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">IORef WantedConstraints
-&gt; (WantedConstraints -&gt; WantedConstraints) -&gt; TcM ()
forall a gbl lcl. TcRef a -&gt; (a -&gt; a) -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#updTcRef"><span class="hs-identifier hs-var">updTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef WantedConstraints
</span><a href="#local-6989586621681080940"><span class="hs-identifier hs-var">lie_var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WantedConstraints -&gt; Bag Hole -&gt; WantedConstraints
</span><a href="GHC.Tc.Types.Constraint.html#addHoles"><span class="hs-operator hs-var">`addHoles`</span></a></span><span> </span><span class="annot"><span class="annottext">Hole -&gt; Bag Hole
forall a. a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#unitBag"><span class="hs-identifier hs-var">unitBag</span></a></span><span> </span><span class="annot"><span class="annottext">Hole
</span><a href="#local-6989586621681080941"><span class="hs-identifier hs-var">hole</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1674"></span><span>
</span><span id="line-1675"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitHoles"><span class="hs-identifier hs-type">emitHoles</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html#Bag"><span class="hs-identifier hs-type">Bag</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#Hole"><span class="hs-identifier hs-type">Hole</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1676"></span><span id="emitHoles"><span class="annot"><span class="annottext">emitHoles :: Bag Hole -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#emitHoles"><span class="hs-identifier hs-var hs-var">emitHoles</span></a></span></span><span> </span><span id="local-6989586621681080938"><span class="annot"><span class="annottext">Bag Hole
</span><a href="#local-6989586621681080938"><span class="hs-identifier hs-var">holes</span></a></span></span><span>
</span><span id="line-1677"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;emitHoles&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bag Hole -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Hole
</span><a href="#local-6989586621681080938"><span class="hs-identifier hs-var">holes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1678"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681080937"><span class="annot"><span class="annottext">IORef WantedConstraints
</span><a href="#local-6989586621681080937"><span class="hs-identifier hs-var">lie_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv (IORef WantedConstraints)
</span><a href="GHC.Tc.Utils.Monad.html#getConstraintVar"><span class="hs-identifier hs-var">getConstraintVar</span></a></span><span>
</span><span id="line-1679"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">IORef WantedConstraints
-&gt; (WantedConstraints -&gt; WantedConstraints) -&gt; TcM ()
forall a gbl lcl. TcRef a -&gt; (a -&gt; a) -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#updTcRef"><span class="hs-identifier hs-var">updTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef WantedConstraints
</span><a href="#local-6989586621681080937"><span class="hs-identifier hs-var">lie_var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WantedConstraints -&gt; Bag Hole -&gt; WantedConstraints
</span><a href="GHC.Tc.Types.Constraint.html#addHoles"><span class="hs-operator hs-var">`addHoles`</span></a></span><span> </span><span class="annot"><span class="annottext">Bag Hole
</span><a href="#local-6989586621681080938"><span class="hs-identifier hs-var">holes</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1680"></span><span>
</span><span id="line-1681"></span><span class="hs-comment">-- | Throw out any constraints emitted by the thing_inside</span><span>
</span><span id="line-1682"></span><span id="local-6989586621681080936"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#discardConstraints"><span class="hs-identifier hs-type">discardConstraints</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681080936"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681080936"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1683"></span><span id="discardConstraints"><span class="annot"><span class="annottext">discardConstraints :: forall a. TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#discardConstraints"><span class="hs-identifier hs-var hs-var">discardConstraints</span></a></span></span><span> </span><span id="local-6989586621681080934"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681080934"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a, WantedConstraints) -&gt; a
forall a b. (a, b) -&gt; a
</span><a href="../../base/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">((a, WantedConstraints) -&gt; a)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (a, WantedConstraints) -&gt; TcM a
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TcM a -&gt; IOEnv (Env TcGblEnv TcLclEnv) (a, WantedConstraints)
forall r. TcM r -&gt; TcM (r, WantedConstraints)
</span><a href="GHC.Tc.Utils.Monad.html#captureConstraints"><span class="hs-identifier hs-var">captureConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681080934"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1684"></span><span>
</span><span id="line-1685"></span><span class="hs-comment">-- | The name says it all. The returned TcLevel is the *inner* TcLevel.</span><span>
</span><span id="line-1686"></span><span id="local-6989586621681082447"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#pushLevelAndCaptureConstraints"><span class="hs-identifier hs-type">pushLevelAndCaptureConstraints</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082447"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Constraint.html#WantedConstraints"><span class="hs-identifier hs-type">WantedConstraints</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621681082447"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1687"></span><span id="pushLevelAndCaptureConstraints"><span class="annot"><span class="annottext">pushLevelAndCaptureConstraints :: forall a. TcM a -&gt; TcM (TcLevel, WantedConstraints, a)
</span><a href="GHC.Tc.Utils.Monad.html#pushLevelAndCaptureConstraints"><span class="hs-identifier hs-var hs-var">pushLevelAndCaptureConstraints</span></a></span></span><span> </span><span id="local-6989586621681080925"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681080925"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1688"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681080924"><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681080924"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcLclEnv
forall gbl lcl. TcRnIf gbl lcl lcl
</span><a href="GHC.Tc.Utils.Monad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a></span><span>
</span><span id="line-1689"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681080923"><span class="annot"><span class="annottext">tclvl' :: TcLevel
</span><a href="#local-6989586621681080923"><span class="hs-identifier hs-var hs-var">tclvl'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLevel -&gt; TcLevel
</span><a href="GHC.Tc.Utils.TcType.html#pushTcLevel"><span class="hs-identifier hs-var">pushTcLevel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcLclEnv -&gt; TcLevel
</span><a href="GHC.Tc.Types.html#tcl_tclvl"><span class="hs-identifier hs-var hs-var">tcl_tclvl</span></a></span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681080924"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1690"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;pushLevelAndCaptureConstraints {&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcLevel -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681080923"><span class="hs-identifier hs-var">tclvl'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1691"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681080921"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681080921"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681080920"><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621681080920"><span class="hs-identifier hs-var">lie</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcLclEnv
-&gt; TcRnIf TcGblEnv TcLclEnv (a, WantedConstraints)
-&gt; TcRnIf TcGblEnv TcLclEnv (a, WantedConstraints)
forall lcl' gbl a lcl.
lcl' -&gt; TcRnIf gbl lcl' a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#setLclEnv"><span class="hs-identifier hs-var">setLclEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681080924"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcl_tclvl :: TcLevel
</span><a href="GHC.Tc.Types.html#tcl_tclvl"><span class="hs-identifier hs-var">tcl_tclvl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681080923"><span class="hs-identifier hs-var">tclvl'</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcRnIf TcGblEnv TcLclEnv (a, WantedConstraints)
 -&gt; TcRnIf TcGblEnv TcLclEnv (a, WantedConstraints))
-&gt; TcRnIf TcGblEnv TcLclEnv (a, WantedConstraints)
-&gt; TcRnIf TcGblEnv TcLclEnv (a, WantedConstraints)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1692"></span><span>                       </span><span class="annot"><span class="annottext">TcM a -&gt; TcRnIf TcGblEnv TcLclEnv (a, WantedConstraints)
forall r. TcM r -&gt; TcM (r, WantedConstraints)
</span><a href="GHC.Tc.Utils.Monad.html#captureConstraints"><span class="hs-identifier hs-var">captureConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681080925"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1693"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;pushLevelAndCaptureConstraints }&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcLevel -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681080923"><span class="hs-identifier hs-var">tclvl'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1694"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(TcLevel, WantedConstraints, a)
-&gt; TcM (TcLevel, WantedConstraints, a)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681080923"><span class="hs-identifier hs-var">tclvl'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621681080920"><span class="hs-identifier hs-var">lie</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681080921"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1695"></span><span>
</span><span id="line-1696"></span><span id="local-6989586621681080919"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#pushTcLevelM_"><span class="hs-identifier hs-type">pushTcLevelM_</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681080919"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681080919"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1697"></span><span id="pushTcLevelM_"><span class="annot"><span class="annottext">pushTcLevelM_ :: forall a. TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#pushTcLevelM_"><span class="hs-identifier hs-var hs-var">pushTcLevelM_</span></a></span></span><span> </span><span id="local-6989586621681080918"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681080918"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcLclEnv -&gt; TcLclEnv) -&gt; TcM a -&gt; TcM a
forall lcl gbl a.
(lcl -&gt; lcl) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updLclEnv"><span class="hs-identifier hs-var">updLclEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681080917"><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681080917"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681080917"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcl_tclvl :: TcLevel
</span><a href="GHC.Tc.Types.html#tcl_tclvl"><span class="hs-identifier hs-var">tcl_tclvl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLevel -&gt; TcLevel
</span><a href="GHC.Tc.Utils.TcType.html#pushTcLevel"><span class="hs-identifier hs-var">pushTcLevel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcLclEnv -&gt; TcLevel
</span><a href="GHC.Tc.Types.html#tcl_tclvl"><span class="hs-identifier hs-var hs-var">tcl_tclvl</span></a></span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681080917"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681080918"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1698"></span><span>
</span><span id="line-1699"></span><span id="local-6989586621681082444"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#pushTcLevelM"><span class="hs-identifier hs-type">pushTcLevelM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082444"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621681082444"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1700"></span><span class="hs-comment">-- See Note [TcLevel assignment] in GHC.Tc.Utils.TcType</span><span>
</span><span id="line-1701"></span><span id="pushTcLevelM"><span class="annot"><span class="annottext">pushTcLevelM :: forall a. TcM a -&gt; TcM (TcLevel, a)
</span><a href="GHC.Tc.Utils.Monad.html#pushTcLevelM"><span class="hs-identifier hs-var hs-var">pushTcLevelM</span></a></span></span><span> </span><span id="local-6989586621681080913"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681080913"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1702"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681080912"><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681080912"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcLclEnv
forall gbl lcl. TcRnIf gbl lcl lcl
</span><a href="GHC.Tc.Utils.Monad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a></span><span>
</span><span id="line-1703"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681080911"><span class="annot"><span class="annottext">tclvl' :: TcLevel
</span><a href="#local-6989586621681080911"><span class="hs-identifier hs-var hs-var">tclvl'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLevel -&gt; TcLevel
</span><a href="GHC.Tc.Utils.TcType.html#pushTcLevel"><span class="hs-identifier hs-var">pushTcLevel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcLclEnv -&gt; TcLevel
</span><a href="GHC.Tc.Types.html#tcl_tclvl"><span class="hs-identifier hs-var hs-var">tcl_tclvl</span></a></span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681080912"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1704"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681080910"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681080910"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcLclEnv -&gt; TcM a -&gt; TcM a
forall lcl' gbl a lcl.
lcl' -&gt; TcRnIf gbl lcl' a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#setLclEnv"><span class="hs-identifier hs-var">setLclEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681080912"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcl_tclvl :: TcLevel
</span><a href="GHC.Tc.Types.html#tcl_tclvl"><span class="hs-identifier hs-var">tcl_tclvl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681080911"><span class="hs-identifier hs-var">tclvl'</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1705"></span><span>                          </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681080913"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1706"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(TcLevel, a) -&gt; TcM (TcLevel, a)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681080911"><span class="hs-identifier hs-var">tclvl'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681080910"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1707"></span><span>
</span><span id="line-1708"></span><span class="hs-comment">-- Returns pushed TcLevel</span><span>
</span><span id="line-1709"></span><span id="local-6989586621681082442"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#pushTcLevelsM"><span class="hs-identifier hs-type">pushTcLevelsM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082442"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681082442"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1710"></span><span id="pushTcLevelsM"><span class="annot"><span class="annottext">pushTcLevelsM :: forall a. Int -&gt; TcM a -&gt; TcM (a, TcLevel)
</span><a href="GHC.Tc.Utils.Monad.html#pushTcLevelsM"><span class="hs-identifier hs-var hs-var">pushTcLevelsM</span></a></span></span><span> </span><span id="local-6989586621681080906"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681080906"><span class="hs-identifier hs-var">num_levels</span></a></span></span><span> </span><span id="local-6989586621681080905"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681080905"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1711"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681080904"><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681080904"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcLclEnv
forall gbl lcl. TcRnIf gbl lcl lcl
</span><a href="GHC.Tc.Utils.Monad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a></span><span>
</span><span id="line-1712"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681080903"><span class="annot"><span class="annottext">tclvl' :: TcLevel
</span><a href="#local-6989586621681080903"><span class="hs-identifier hs-var hs-var">tclvl'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; (TcLevel -&gt; TcLevel) -&gt; TcLevel -&gt; TcLevel
forall a. Int -&gt; (a -&gt; a) -&gt; a -&gt; a
</span><a href="GHC.Utils.Misc.html#nTimes"><span class="hs-identifier hs-var">nTimes</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681080906"><span class="hs-identifier hs-var">num_levels</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel -&gt; TcLevel
</span><a href="GHC.Tc.Utils.TcType.html#pushTcLevel"><span class="hs-identifier hs-var">pushTcLevel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcLclEnv -&gt; TcLevel
</span><a href="GHC.Tc.Types.html#tcl_tclvl"><span class="hs-identifier hs-var hs-var">tcl_tclvl</span></a></span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681080904"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1713"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681080901"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681080901"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcLclEnv -&gt; TcM a -&gt; TcM a
forall lcl' gbl a lcl.
lcl' -&gt; TcRnIf gbl lcl' a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#setLclEnv"><span class="hs-identifier hs-var">setLclEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681080904"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcl_tclvl :: TcLevel
</span><a href="GHC.Tc.Types.html#tcl_tclvl"><span class="hs-identifier hs-var">tcl_tclvl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681080903"><span class="hs-identifier hs-var">tclvl'</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM a -&gt; TcM a) -&gt; TcM a -&gt; TcM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1714"></span><span>                </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681080905"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1715"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(a, TcLevel) -&gt; TcM (a, TcLevel)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681080901"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681080903"><span class="hs-identifier hs-var">tclvl'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1716"></span><span>
</span><span id="line-1717"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getTcLevel"><span class="hs-identifier hs-type">getTcLevel</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a></span><span>
</span><span id="line-1718"></span><span id="getTcLevel"><span class="annot"><span class="annottext">getTcLevel :: TcM TcLevel
</span><a href="GHC.Tc.Utils.Monad.html#getTcLevel"><span class="hs-identifier hs-var hs-var">getTcLevel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681080900"><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681080900"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcLclEnv
forall gbl lcl. TcRnIf gbl lcl lcl
</span><a href="GHC.Tc.Utils.Monad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a></span><span>
</span><span id="line-1719"></span><span>                </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcLevel -&gt; TcM TcLevel
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcLclEnv -&gt; TcLevel
</span><a href="GHC.Tc.Types.html#tcl_tclvl"><span class="hs-identifier hs-var hs-var">tcl_tclvl</span></a></span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681080900"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1720"></span><span>
</span><span id="line-1721"></span><span id="local-6989586621681082439"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setTcLevel"><span class="hs-identifier hs-type">setTcLevel</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcLevel"><span class="hs-identifier hs-type">TcLevel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082439"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082439"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1722"></span><span id="setTcLevel"><span class="annot"><span class="annottext">setTcLevel :: forall a. TcLevel -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#setTcLevel"><span class="hs-identifier hs-var hs-var">setTcLevel</span></a></span></span><span> </span><span id="local-6989586621681080899"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681080899"><span class="hs-identifier hs-var">tclvl</span></a></span></span><span> </span><span id="local-6989586621681080898"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681080898"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1723"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcLclEnv -&gt; TcLclEnv) -&gt; TcM a -&gt; TcM a
forall lcl gbl a.
(lcl -&gt; lcl) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updLclEnv"><span class="hs-identifier hs-var">updLclEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681080897"><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681080897"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681080897"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcl_tclvl :: TcLevel
</span><a href="GHC.Tc.Types.html#tcl_tclvl"><span class="hs-identifier hs-var">tcl_tclvl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681080899"><span class="hs-identifier hs-var">tclvl</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681080898"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1724"></span><span>
</span><span id="line-1725"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#isTouchableTcM"><span class="hs-identifier hs-type">isTouchableTcM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1726"></span><span id="isTouchableTcM"><span class="annot"><span class="annottext">isTouchableTcM :: Id -&gt; TcRn Bool
</span><a href="GHC.Tc.Utils.Monad.html#isTouchableTcM"><span class="hs-identifier hs-var hs-var">isTouchableTcM</span></a></span></span><span> </span><span id="local-6989586621681080895"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681080895"><span class="hs-identifier hs-var">tv</span></a></span></span><span>
</span><span id="line-1727"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681080894"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681080894"><span class="hs-identifier hs-var">lvl</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM TcLevel
</span><a href="GHC.Tc.Utils.Monad.html#getTcLevel"><span class="hs-identifier hs-var">getTcLevel</span></a></span><span>
</span><span id="line-1728"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRn Bool
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcLevel -&gt; Id -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#isTouchableMetaTyVar"><span class="hs-identifier hs-var">isTouchableMetaTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681080894"><span class="hs-identifier hs-var">lvl</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681080895"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1729"></span><span>
</span><span id="line-1730"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getLclTypeEnv"><span class="hs-identifier hs-type">getLclTypeEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcTypeEnv"><span class="hs-identifier hs-type">TcTypeEnv</span></a></span><span>
</span><span id="line-1731"></span><span id="getLclTypeEnv"><span class="annot"><span class="annottext">getLclTypeEnv :: TcM TcTypeEnv
</span><a href="GHC.Tc.Utils.Monad.html#getLclTypeEnv"><span class="hs-identifier hs-var hs-var">getLclTypeEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681080892"><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681080892"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcLclEnv
forall gbl lcl. TcRnIf gbl lcl lcl
</span><a href="GHC.Tc.Utils.Monad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcTypeEnv -&gt; TcM TcTypeEnv
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcLclEnv -&gt; TcTypeEnv
</span><a href="GHC.Tc.Types.html#tcl_env"><span class="hs-identifier hs-var hs-var">tcl_env</span></a></span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681080892"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1732"></span><span>
</span><span id="line-1733"></span><span id="local-6989586621681082437"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setLclTypeEnv"><span class="hs-identifier hs-type">setLclTypeEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcLclEnv"><span class="hs-identifier hs-type">TcLclEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082437"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082437"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1734"></span><span class="hs-comment">-- Set the local type envt, but do *not* disturb other fields,</span><span>
</span><span id="line-1735"></span><span class="hs-comment">-- notably the lie_var</span><span>
</span><span id="line-1736"></span><span id="setLclTypeEnv"><span class="annot"><span class="annottext">setLclTypeEnv :: forall a. TcLclEnv -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#setLclTypeEnv"><span class="hs-identifier hs-var hs-var">setLclTypeEnv</span></a></span></span><span> </span><span id="local-6989586621681080891"><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681080891"><span class="hs-identifier hs-var">lcl_env</span></a></span></span><span> </span><span id="local-6989586621681080890"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681080890"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1737"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcLclEnv -&gt; TcLclEnv) -&gt; TcM a -&gt; TcM a
forall lcl gbl a.
(lcl -&gt; lcl) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updLclEnv"><span class="hs-identifier hs-var">updLclEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TcLclEnv -&gt; TcLclEnv
</span><a href="#local-6989586621681080889"><span class="hs-identifier hs-var">upd</span></a></span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681080890"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1738"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1739"></span><span>    </span><span id="local-6989586621681080889"><span class="annot"><span class="annottext">upd :: TcLclEnv -&gt; TcLclEnv
</span><a href="#local-6989586621681080889"><span class="hs-identifier hs-var hs-var">upd</span></a></span></span><span> </span><span id="local-6989586621681080888"><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681080888"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681080888"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcl_env :: TcTypeEnv
</span><a href="GHC.Tc.Types.html#tcl_env"><span class="hs-identifier hs-var">tcl_env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLclEnv -&gt; TcTypeEnv
</span><a href="GHC.Tc.Types.html#tcl_env"><span class="hs-identifier hs-var hs-var">tcl_env</span></a></span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681080891"><span class="hs-identifier hs-var">lcl_env</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1740"></span><span>
</span><span id="line-1741"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#traceTcConstraints"><span class="hs-identifier hs-type">traceTcConstraints</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1742"></span><span id="traceTcConstraints"><span class="annot"><span class="annottext">traceTcConstraints :: FilePath -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTcConstraints"><span class="hs-identifier hs-var hs-var">traceTcConstraints</span></a></span></span><span> </span><span id="local-6989586621681080887"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681080887"><span class="hs-identifier hs-var">msg</span></a></span></span><span>
</span><span id="line-1743"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681080886"><span class="annot"><span class="annottext">IORef WantedConstraints
</span><a href="#local-6989586621681080886"><span class="hs-identifier hs-var">lie_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv (IORef WantedConstraints)
</span><a href="GHC.Tc.Utils.Monad.html#getConstraintVar"><span class="hs-identifier hs-var">getConstraintVar</span></a></span><span>
</span><span id="line-1744"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681080885"><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621681080885"><span class="hs-identifier hs-var">lie</span></a></span></span><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef WantedConstraints
-&gt; TcRnIf TcGblEnv TcLclEnv WantedConstraints
forall a gbl lcl. TcRef a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef WantedConstraints
</span><a href="#local-6989586621681080886"><span class="hs-identifier hs-var">lie_var</span></a></span><span>
</span><span id="line-1745"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">DumpFlag -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#traceOptTcRn"><span class="hs-identifier hs-var">traceOptTcRn</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_tc_trace"><span class="hs-identifier hs-var">Opt_D_dump_tc_trace</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; TcM ()) -&gt; SDoc -&gt; TcM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1746"></span><span>         </span><span class="annot"><span class="annottext">SDoc -&gt; Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681080887"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;: LIE:&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WantedConstraints -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621681080885"><span class="hs-identifier hs-var">lie</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1747"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-1748"></span><span>
</span><span id="line-1749"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitAnonTypeHole"><span class="hs-identifier hs-type">emitAnonTypeHole</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1750"></span><span id="emitAnonTypeHole"><span class="annot"><span class="annottext">emitAnonTypeHole :: Id -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#emitAnonTypeHole"><span class="hs-identifier hs-var hs-var">emitAnonTypeHole</span></a></span></span><span> </span><span id="local-6989586621681080884"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681080884"><span class="hs-identifier hs-var">tv</span></a></span></span><span>
</span><span id="line-1751"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681080883"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681080883"><span class="hs-identifier hs-var">ct_loc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; Maybe TypeOrKind -&gt; TcM CtLoc
</span><a href="GHC.Tc.Utils.Monad.html#getCtLocM"><span class="hs-identifier hs-var">getCtLocM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OccName -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#TypeHoleOrigin"><span class="hs-identifier hs-var">TypeHoleOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621681080881"><span class="hs-identifier hs-var">occ</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe TypeOrKind
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1752"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681080880"><span class="annot"><span class="annottext">hole :: Hole
</span><a href="#local-6989586621681080880"><span class="hs-identifier hs-var hs-var">hole</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Hole :: HoleSort -&gt; OccName -&gt; Type -&gt; CtLoc -&gt; Hole
</span><a href="GHC.Tc.Types.Constraint.html#Hole"><span class="hs-identifier hs-type">Hole</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hole_sort :: HoleSort
</span><a href="GHC.Tc.Types.Constraint.html#hole_sort"><span class="hs-identifier hs-var">hole_sort</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HoleSort
</span><a href="GHC.Tc.Types.Constraint.html#TypeHole"><span class="hs-identifier hs-var">TypeHole</span></a></span><span>
</span><span id="line-1753"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hole_occ :: OccName
</span><a href="GHC.Tc.Types.Constraint.html#hole_occ"><span class="hs-identifier hs-var">hole_occ</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621681080881"><span class="hs-identifier hs-var">occ</span></a></span><span>
</span><span id="line-1754"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hole_ty :: Type
</span><a href="GHC.Tc.Types.Constraint.html#hole_ty"><span class="hs-identifier hs-var">hole_ty</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681080884"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-1755"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hole_loc :: CtLoc
</span><a href="GHC.Tc.Types.Constraint.html#hole_loc"><span class="hs-identifier hs-var">hole_loc</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681080883"><span class="hs-identifier hs-var">ct_loc</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1756"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Hole -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#emitHole"><span class="hs-identifier hs-var">emitHole</span></a></span><span> </span><span class="annot"><span class="annottext">Hole
</span><a href="#local-6989586621681080880"><span class="hs-identifier hs-var">hole</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1757"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1758"></span><span>    </span><span id="local-6989586621681080881"><span class="annot"><span class="annottext">occ :: OccName
</span><a href="#local-6989586621681080881"><span class="hs-identifier hs-var hs-var">occ</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; OccName
</span><a href="GHC.Types.Name.Occurrence.html#mkTyVarOcc"><span class="hs-identifier hs-var">mkTyVarOcc</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;_&quot;</span></span><span>
</span><span id="line-1759"></span><span>
</span><span id="line-1760"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#emitNamedTypeHole"><span class="hs-identifier hs-type">emitNamedTypeHole</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TcTyVar"><span class="hs-identifier hs-type">TcTyVar</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1761"></span><span id="emitNamedTypeHole"><span class="annot"><span class="annottext">emitNamedTypeHole :: (Name, Id) -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#emitNamedTypeHole"><span class="hs-identifier hs-var hs-var">emitNamedTypeHole</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681080871"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681080871"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681080870"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681080870"><span class="hs-identifier hs-var">tv</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1762"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681080869"><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681080869"><span class="hs-identifier hs-var">ct_loc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcM CtLoc -&gt; TcM CtLoc
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SrcSpan
</span><a href="GHC.Types.Name.html#nameSrcSpan"><span class="hs-identifier hs-var">nameSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681080871"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM CtLoc -&gt; TcM CtLoc) -&gt; TcM CtLoc -&gt; TcM CtLoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1763"></span><span>                   </span><span class="annot"><span class="annottext">CtOrigin -&gt; Maybe TypeOrKind -&gt; TcM CtLoc
</span><a href="GHC.Tc.Utils.Monad.html#getCtLocM"><span class="hs-identifier hs-var">getCtLocM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OccName -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#TypeHoleOrigin"><span class="hs-identifier hs-var">TypeHoleOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621681080868"><span class="hs-identifier hs-var">occ</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe TypeOrKind
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1764"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681080867"><span class="annot"><span class="annottext">hole :: Hole
</span><a href="#local-6989586621681080867"><span class="hs-identifier hs-var hs-var">hole</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Hole :: HoleSort -&gt; OccName -&gt; Type -&gt; CtLoc -&gt; Hole
</span><a href="GHC.Tc.Types.Constraint.html#Hole"><span class="hs-identifier hs-type">Hole</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hole_sort :: HoleSort
</span><a href="GHC.Tc.Types.Constraint.html#hole_sort"><span class="hs-identifier hs-var">hole_sort</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HoleSort
</span><a href="GHC.Tc.Types.Constraint.html#TypeHole"><span class="hs-identifier hs-var">TypeHole</span></a></span><span>
</span><span id="line-1765"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hole_occ :: OccName
</span><a href="GHC.Tc.Types.Constraint.html#hole_occ"><span class="hs-identifier hs-var">hole_occ</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621681080868"><span class="hs-identifier hs-var">occ</span></a></span><span>
</span><span id="line-1766"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hole_ty :: Type
</span><a href="GHC.Tc.Types.Constraint.html#hole_ty"><span class="hs-identifier hs-var">hole_ty</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681080870"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-1767"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hole_loc :: CtLoc
</span><a href="GHC.Tc.Types.Constraint.html#hole_loc"><span class="hs-identifier hs-var">hole_loc</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtLoc
</span><a href="#local-6989586621681080869"><span class="hs-identifier hs-var">ct_loc</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1768"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Hole -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#emitHole"><span class="hs-identifier hs-var">emitHole</span></a></span><span> </span><span class="annot"><span class="annottext">Hole
</span><a href="#local-6989586621681080867"><span class="hs-identifier hs-var">hole</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1769"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1770"></span><span>    </span><span id="local-6989586621681080868"><span class="annot"><span class="annottext">occ :: OccName
</span><a href="#local-6989586621681080868"><span class="hs-identifier hs-var hs-var">occ</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; OccName
</span><a href="GHC.Types.Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681080871"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-1771"></span><span>
</span><span id="line-1772"></span><span class="hs-comment">{- Note [Constraints and errors]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider this (#12124):

  foo :: Maybe Int
  foo = return (case Left 3 of
                  Left -&gt; 1  -- Hard error here!
                  _    -&gt; 0)

The call to 'return' will generate a (Monad m) wanted constraint; but
then there'll be &quot;hard error&quot; (i.e. an exception in the TcM monad), from
the unsaturated Left constructor pattern.

We'll recover in tcPolyBinds, using recoverM.  But then the final
tcSimplifyTop will see that (Monad m) constraint, with 'm' utterly
un-filled-in, and will emit a misleading error message.

The underlying problem is that an exception interrupts the constraint
gathering process. Bottom line: if we have an exception, it's best
simply to discard any gathered constraints.  Hence in 'attemptM' we
capture the constraints in a fresh variable, and only emit them into
the surrounding context if we exit normally.  If an exception is
raised, simply discard the collected constraints... we have a hard
error to report.  So this capture-the-emit dance isn't as stupid as it
looks :-).

However suppose we throw an exception inside an invocation of
captureConstraints, and discard all the constraints. Some of those
constraints might be &quot;variable out of scope&quot; Hole constraints, and that
might have been the actual original cause of the exception!  For
example (#12529):
   f = p @ Int
Here 'p' is out of scope, so we get an insoluble Hole constraint. But
the visible type application fails in the monad (throws an exception).
We must not discard the out-of-scope error.

So we /retain the insoluble constraints/ if there is an exception.
Hence:
  - insolublesOnly in tryCaptureConstraints
  - emitConstraints in the Left case of captureConstraints

However note that freshly-generated constraints like (Int ~ Bool), or
((a -&gt; b) ~ Int) are all CNonCanonical, and hence won't be flagged as
insoluble.  The constraint solver does that.  So they'll be discarded.
That's probably ok; but see th/5358 as a not-so-good example:
   t1 :: Int
   t1 x = x   -- Manifestly wrong

   foo = $(...raises exception...)
We report the exception, but not the bug in t1.  Oh well.  Possible
solution: make GHC.Tc.Utils.Unify.uType spot manifestly-insoluble constraints.


************************************************************************
*                                                                      *
             Template Haskell context
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-1831"></span><span>
</span><span id="line-1832"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#recordThUse"><span class="hs-identifier hs-type">recordThUse</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1833"></span><span id="recordThUse"><span class="annot"><span class="annottext">recordThUse :: TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#recordThUse"><span class="hs-identifier hs-var hs-var">recordThUse</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681080866"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681080866"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">IORef Bool -&gt; Bool -&gt; TcM ()
forall a gbl lcl. TcRef a -&gt; a -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#writeTcRef"><span class="hs-identifier hs-var">writeTcRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; IORef Bool
</span><a href="GHC.Tc.Types.html#tcg_th_used"><span class="hs-identifier hs-var hs-var">tcg_th_used</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681080866"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1834"></span><span>
</span><span id="line-1835"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#recordThSpliceUse"><span class="hs-identifier hs-type">recordThSpliceUse</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1836"></span><span id="recordThSpliceUse"><span class="annot"><span class="annottext">recordThSpliceUse :: TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#recordThSpliceUse"><span class="hs-identifier hs-var hs-var">recordThSpliceUse</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681080865"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681080865"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">IORef Bool -&gt; Bool -&gt; TcM ()
forall a gbl lcl. TcRef a -&gt; a -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#writeTcRef"><span class="hs-identifier hs-var">writeTcRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; IORef Bool
</span><a href="GHC.Tc.Types.html#tcg_th_splice_used"><span class="hs-identifier hs-var hs-var">tcg_th_splice_used</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681080865"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1837"></span><span>
</span><span id="line-1838"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#keepAlive"><span class="hs-identifier hs-type">keepAlive</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>     </span><span class="hs-comment">-- Record the name in the keep-alive set</span><span>
</span><span id="line-1839"></span><span id="keepAlive"><span class="annot"><span class="annottext">keepAlive :: Name -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#keepAlive"><span class="hs-identifier hs-var hs-var">keepAlive</span></a></span></span><span> </span><span id="local-6989586621681080864"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681080864"><span class="hs-identifier hs-var">name</span></a></span></span><span>
</span><span id="line-1840"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681080863"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681080863"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-1841"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#traceRn"><span class="hs-identifier hs-var">traceRn</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;keep alive&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681080864"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1842"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">IORef NameSet -&gt; (NameSet -&gt; NameSet) -&gt; TcM ()
forall a gbl lcl. TcRef a -&gt; (a -&gt; a) -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#updTcRef"><span class="hs-identifier hs-var">updTcRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; IORef NameSet
</span><a href="GHC.Tc.Types.html#tcg_keep"><span class="hs-identifier hs-var hs-var">tcg_keep</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681080863"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NameSet -&gt; Name -&gt; NameSet
</span><a href="GHC.Types.Name.Set.html#extendNameSet"><span class="hs-operator hs-var">`extendNameSet`</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681080864"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1843"></span><span>
</span><span id="line-1844"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getStage"><span class="hs-identifier hs-type">getStage</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#ThStage"><span class="hs-identifier hs-type">ThStage</span></a></span><span>
</span><span id="line-1845"></span><span id="getStage"><span class="annot"><span class="annottext">getStage :: TcM ThStage
</span><a href="GHC.Tc.Utils.Monad.html#getStage"><span class="hs-identifier hs-var hs-var">getStage</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681080861"><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681080861"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcLclEnv
forall gbl lcl. TcRnIf gbl lcl lcl
</span><a href="GHC.Tc.Utils.Monad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">ThStage -&gt; TcM ThStage
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcLclEnv -&gt; ThStage
</span><a href="GHC.Tc.Types.html#tcl_th_ctxt"><span class="hs-identifier hs-var hs-var">tcl_th_ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681080861"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1846"></span><span>
</span><span id="line-1847"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getStageAndBindLevel"><span class="hs-identifier hs-type">getStageAndBindLevel</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Basic.html#TopLevelFlag"><span class="hs-identifier hs-type">TopLevelFlag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#ThLevel"><span class="hs-identifier hs-type">ThLevel</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#ThStage"><span class="hs-identifier hs-type">ThStage</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1848"></span><span id="getStageAndBindLevel"><span class="annot"><span class="annottext">getStageAndBindLevel :: Name -&gt; TcRn (Maybe (TopLevelFlag, Int, ThStage))
</span><a href="GHC.Tc.Utils.Monad.html#getStageAndBindLevel"><span class="hs-identifier hs-var hs-var">getStageAndBindLevel</span></a></span></span><span> </span><span id="local-6989586621681080859"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681080859"><span class="hs-identifier hs-var">name</span></a></span></span><span>
</span><span id="line-1849"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681080858"><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681080858"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcLclEnv
forall gbl lcl. TcRnIf gbl lcl lcl
</span><a href="GHC.Tc.Utils.Monad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a></span><span class="hs-special">;</span><span>
</span><span id="line-1850"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ThBindEnv -&gt; Name -&gt; Maybe (TopLevelFlag, Int)
forall a. NameEnv a -&gt; Name -&gt; Maybe a
</span><a href="GHC.Types.Name.Env.html#lookupNameEnv"><span class="hs-identifier hs-var">lookupNameEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcLclEnv -&gt; ThBindEnv
</span><a href="GHC.Tc.Types.html#tcl_th_bndrs"><span class="hs-identifier hs-var hs-var">tcl_th_bndrs</span></a></span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681080858"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681080859"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1851"></span><span>           </span><span class="annot"><span class="annottext">Maybe (TopLevelFlag, Int)
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (TopLevelFlag, Int, ThStage)
-&gt; TcRn (Maybe (TopLevelFlag, Int, ThStage))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (TopLevelFlag, Int, ThStage)
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1852"></span><span>           </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681080856"><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="#local-6989586621681080856"><span class="hs-identifier hs-var">top_lvl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681080855"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681080855"><span class="hs-identifier hs-var">bind_lvl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (TopLevelFlag, Int, ThStage)
-&gt; TcRn (Maybe (TopLevelFlag, Int, ThStage))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TopLevelFlag, Int, ThStage) -&gt; Maybe (TopLevelFlag, Int, ThStage)
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="#local-6989586621681080856"><span class="hs-identifier hs-var">top_lvl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681080855"><span class="hs-identifier hs-var">bind_lvl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcLclEnv -&gt; ThStage
</span><a href="GHC.Tc.Types.html#tcl_th_ctxt"><span class="hs-identifier hs-var hs-var">tcl_th_ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681080858"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1853"></span><span>
</span><span id="line-1854"></span><span id="local-6989586621681082432"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setStage"><span class="hs-identifier hs-type">setStage</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#ThStage"><span class="hs-identifier hs-type">ThStage</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082432"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082432"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1855"></span><span id="setStage"><span class="annot"><span class="annottext">setStage :: forall a. ThStage -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#setStage"><span class="hs-identifier hs-var hs-var">setStage</span></a></span></span><span> </span><span id="local-6989586621681080854"><span class="annot"><span class="annottext">ThStage
</span><a href="#local-6989586621681080854"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcLclEnv -&gt; TcLclEnv)
-&gt; TcRnIf TcGblEnv TcLclEnv a -&gt; TcRnIf TcGblEnv TcLclEnv a
forall lcl gbl a.
(lcl -&gt; lcl) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updLclEnv"><span class="hs-identifier hs-var">updLclEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681080853"><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681080853"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681080853"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcl_th_ctxt :: ThStage
</span><a href="GHC.Tc.Types.html#tcl_th_ctxt"><span class="hs-identifier hs-var">tcl_th_ctxt</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ThStage
</span><a href="#local-6989586621681080854"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1856"></span><span>
</span><span id="line-1857"></span><span class="hs-comment">-- | Adds the given modFinalizers to the global environment and set them to use</span><span>
</span><span id="line-1858"></span><span class="hs-comment">-- the current local environment.</span><span>
</span><span id="line-1859"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#addModFinalizersWithLclEnv"><span class="hs-identifier hs-type">addModFinalizersWithLclEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#ThModFinalizers"><span class="hs-identifier hs-type">ThModFinalizers</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1860"></span><span id="addModFinalizersWithLclEnv"><span class="annot"><span class="annottext">addModFinalizersWithLclEnv :: ThModFinalizers -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#addModFinalizersWithLclEnv"><span class="hs-identifier hs-var hs-var">addModFinalizersWithLclEnv</span></a></span></span><span> </span><span id="local-6989586621681080852"><span class="annot"><span class="annottext">ThModFinalizers
</span><a href="#local-6989586621681080852"><span class="hs-identifier hs-var">mod_finalizers</span></a></span></span><span>
</span><span id="line-1861"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621681080851"><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681080851"><span class="hs-identifier hs-var">lcl_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcLclEnv
forall gbl lcl. TcRnIf gbl lcl lcl
</span><a href="GHC.Tc.Utils.Monad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a></span><span>
</span><span id="line-1862"></span><span>       </span><span id="local-6989586621681080850"><span class="annot"><span class="annottext">IORef [(TcLclEnv, ThModFinalizers)]
</span><a href="#local-6989586621681080850"><span class="hs-identifier hs-var">th_modfinalizers_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TcGblEnv -&gt; IORef [(TcLclEnv, ThModFinalizers)])
-&gt; TcRnIf TcGblEnv TcLclEnv TcGblEnv
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (IORef [(TcLclEnv, ThModFinalizers)])
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; IORef [(TcLclEnv, ThModFinalizers)]
</span><a href="GHC.Tc.Types.html#tcg_th_modfinalizers"><span class="hs-identifier hs-var hs-var">tcg_th_modfinalizers</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-1863"></span><span>       </span><span class="annot"><span class="annottext">IORef [(TcLclEnv, ThModFinalizers)]
-&gt; ([(TcLclEnv, ThModFinalizers)] -&gt; [(TcLclEnv, ThModFinalizers)])
-&gt; TcM ()
forall a gbl lcl. TcRef a -&gt; (a -&gt; a) -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#updTcRef"><span class="hs-identifier hs-var">updTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef [(TcLclEnv, ThModFinalizers)]
</span><a href="#local-6989586621681080850"><span class="hs-identifier hs-var">th_modfinalizers_var</span></a></span><span> </span><span class="annot"><span class="annottext">(([(TcLclEnv, ThModFinalizers)] -&gt; [(TcLclEnv, ThModFinalizers)])
 -&gt; TcM ())
-&gt; ([(TcLclEnv, ThModFinalizers)] -&gt; [(TcLclEnv, ThModFinalizers)])
-&gt; TcM ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681080849"><span class="annot"><span class="annottext">[(TcLclEnv, ThModFinalizers)]
</span><a href="#local-6989586621681080849"><span class="hs-identifier hs-var">fins</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1864"></span><span>         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681080851"><span class="hs-identifier hs-var">lcl_env</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ThModFinalizers
</span><a href="#local-6989586621681080852"><span class="hs-identifier hs-var">mod_finalizers</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcLclEnv, ThModFinalizers)
-&gt; [(TcLclEnv, ThModFinalizers)] -&gt; [(TcLclEnv, ThModFinalizers)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[(TcLclEnv, ThModFinalizers)]
</span><a href="#local-6989586621681080849"><span class="hs-identifier hs-var">fins</span></a></span><span>
</span><span id="line-1865"></span><span>
</span><span id="line-1866"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
             Safe Haskell context
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-1873"></span><span>
</span><span id="line-1874"></span><span class="hs-comment">-- | Mark that safe inference has failed</span><span>
</span><span id="line-1875"></span><span class="hs-comment">-- See Note [Safe Haskell Overlapping Instances Implementation]</span><span>
</span><span id="line-1876"></span><span class="hs-comment">-- although this is used for more than just that failure case.</span><span>
</span><span id="line-1877"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#recordUnsafeInfer"><span class="hs-identifier hs-type">recordUnsafeInfer</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#WarningMessages"><span class="hs-identifier hs-type">WarningMessages</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1878"></span><span id="recordUnsafeInfer"><span class="annot"><span class="annottext">recordUnsafeInfer :: Bag WarnMsg -&gt; TcM ()
</span><a href="GHC.Tc.Utils.Monad.html#recordUnsafeInfer"><span class="hs-identifier hs-var hs-var">recordUnsafeInfer</span></a></span></span><span> </span><span id="local-6989586621681080847"><span class="annot"><span class="annottext">Bag WarnMsg
</span><a href="#local-6989586621681080847"><span class="hs-identifier hs-var">warns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1879"></span><span>    </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv -&gt; (TcGblEnv -&gt; TcM ()) -&gt; TcM ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../base/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681080846"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681080846"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IORef (Bool, Bag WarnMsg) -&gt; (Bool, Bag WarnMsg) -&gt; TcM ()
forall a gbl lcl. TcRef a -&gt; a -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#writeTcRef"><span class="hs-identifier hs-var">writeTcRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; IORef (Bool, Bag WarnMsg)
</span><a href="GHC.Tc.Types.html#tcg_safeInfer"><span class="hs-identifier hs-var hs-var">tcg_safeInfer</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681080846"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bag WarnMsg
</span><a href="#local-6989586621681080847"><span class="hs-identifier hs-var">warns</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1880"></span><span>
</span><span id="line-1881"></span><span class="hs-comment">-- | Figure out the final correct safe haskell mode</span><span>
</span><span id="line-1882"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#finalSafeMode"><span class="hs-identifier hs-type">finalSafeMode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#SafeHaskellMode"><span class="hs-identifier hs-type">SafeHaskellMode</span></a></span><span>
</span><span id="line-1883"></span><span id="finalSafeMode"><span class="annot"><span class="annottext">finalSafeMode :: DynFlags -&gt; TcGblEnv -&gt; IO SafeHaskellMode
</span><a href="GHC.Tc.Utils.Monad.html#finalSafeMode"><span class="hs-identifier hs-var hs-var">finalSafeMode</span></a></span></span><span> </span><span id="local-6989586621681080845"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681080845"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621681080844"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681080844"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1884"></span><span>    </span><span id="local-6989586621681080843"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681080843"><span class="hs-identifier hs-var">safeInf</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Bool, Bag WarnMsg) -&gt; Bool
forall a b. (a, b) -&gt; a
</span><a href="../../base/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">((Bool, Bag WarnMsg) -&gt; Bool) -&gt; IO (Bool, Bag WarnMsg) -&gt; IO Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">IORef (Bool, Bag WarnMsg) -&gt; IO (Bool, Bag WarnMsg)
forall a. IORef a -&gt; IO a
</span><a href="../../base/src/GHC.IORef.html#readIORef"><span class="hs-identifier hs-var">readIORef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; IORef (Bool, Bag WarnMsg)
</span><a href="GHC.Tc.Types.html#tcg_safeInfer"><span class="hs-identifier hs-var hs-var">tcg_safeInfer</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681080844"><span class="hs-identifier hs-var">tcg_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1885"></span><span>    </span><span class="annot"><span class="annottext">SafeHaskellMode -&gt; IO SafeHaskellMode
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(SafeHaskellMode -&gt; IO SafeHaskellMode)
-&gt; SafeHaskellMode -&gt; IO SafeHaskellMode
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; SafeHaskellMode
</span><a href="GHC.Driver.Session.html#safeHaskell"><span class="hs-identifier hs-var hs-var">safeHaskell</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681080845"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1886"></span><span>        </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="GHC.Driver.Session.html#Sf_None"><span class="hs-identifier hs-var">Sf_None</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#safeInferOn"><span class="hs-identifier hs-var">safeInferOn</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681080845"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681080843"><span class="hs-identifier hs-var">safeInf</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="GHC.Driver.Session.html#Sf_SafeInferred"><span class="hs-identifier hs-var">Sf_SafeInferred</span></a></span><span>
</span><span id="line-1887"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="GHC.Driver.Session.html#Sf_None"><span class="hs-identifier hs-var">Sf_None</span></a></span><span>
</span><span id="line-1888"></span><span>        </span><span id="local-6989586621681080838"><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="#local-6989586621681080838"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="#local-6989586621681080838"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-1889"></span><span>
</span><span id="line-1890"></span><span class="hs-comment">-- | Switch instances to safe instances if we're in Safe mode.</span><span>
</span><span id="line-1891"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#fixSafeInstances"><span class="hs-identifier hs-type">fixSafeInstances</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#SafeHaskellMode"><span class="hs-identifier hs-type">SafeHaskellMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1892"></span><span id="fixSafeInstances"><span class="annot"><span class="annottext">fixSafeInstances :: SafeHaskellMode -&gt; [ClsInst] -&gt; [ClsInst]
</span><a href="GHC.Tc.Utils.Monad.html#fixSafeInstances"><span class="hs-identifier hs-var hs-var">fixSafeInstances</span></a></span></span><span> </span><span id="local-6989586621681080837"><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="#local-6989586621681080837"><span class="hs-identifier hs-var">sfMode</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="#local-6989586621681080837"><span class="hs-identifier hs-var">sfMode</span></a></span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode -&gt; SafeHaskellMode -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="GHC.Driver.Session.html#Sf_Safe"><span class="hs-identifier hs-var">Sf_Safe</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="#local-6989586621681080837"><span class="hs-identifier hs-var">sfMode</span></a></span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode -&gt; SafeHaskellMode -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="GHC.Driver.Session.html#Sf_SafeInferred"><span class="hs-identifier hs-var">Sf_SafeInferred</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ClsInst] -&gt; [ClsInst]
forall a. a -&gt; a
</span><a href="../../base/src/GHC.Base.html#id"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-1893"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#fixSafeInstances"><span class="hs-identifier hs-var">fixSafeInstances</span></a></span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ClsInst -&gt; ClsInst) -&gt; [ClsInst] -&gt; [ClsInst]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">ClsInst -&gt; ClsInst
</span><a href="#local-6989586621681080833"><span class="hs-identifier hs-var">fixSafe</span></a></span><span>
</span><span id="line-1894"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681080833"><span class="annot"><span class="annottext">fixSafe :: ClsInst -&gt; ClsInst
</span><a href="#local-6989586621681080833"><span class="hs-identifier hs-var hs-var">fixSafe</span></a></span></span><span> </span><span id="local-6989586621681080832"><span class="annot"><span class="annottext">ClsInst
</span><a href="#local-6989586621681080832"><span class="hs-identifier hs-var">inst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681080831"><span class="annot"><span class="annottext">new_flag :: OverlapFlag
</span><a href="#local-6989586621681080831"><span class="hs-identifier hs-var hs-var">new_flag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ClsInst -&gt; OverlapFlag
</span><a href="GHC.Core.InstEnv.html#is_flag"><span class="hs-identifier hs-var hs-var">is_flag</span></a></span><span> </span><span class="annot"><span class="annottext">ClsInst
</span><a href="#local-6989586621681080832"><span class="hs-identifier hs-var">inst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">isSafeOverlap :: Bool
</span><a href="GHC.Types.Basic.html#isSafeOverlap"><span class="hs-identifier hs-var">isSafeOverlap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1895"></span><span>                       </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">ClsInst
</span><a href="#local-6989586621681080832"><span class="hs-identifier hs-var">inst</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">is_flag :: OverlapFlag
</span><a href="GHC.Core.InstEnv.html#is_flag"><span class="hs-identifier hs-var">is_flag</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OverlapFlag
</span><a href="#local-6989586621681080831"><span class="hs-identifier hs-var">new_flag</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1896"></span><span>
</span><span id="line-1897"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
             Stuff for the renamer's local env
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-1904"></span><span>
</span><span id="line-1905"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getLocalRdrEnv"><span class="hs-identifier hs-type">getLocalRdrEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#LocalRdrEnv"><span class="hs-identifier hs-type">LocalRdrEnv</span></a></span><span>
</span><span id="line-1906"></span><span id="getLocalRdrEnv"><span class="annot"><span class="annottext">getLocalRdrEnv :: RnM LocalRdrEnv
</span><a href="GHC.Tc.Utils.Monad.html#getLocalRdrEnv"><span class="hs-identifier hs-var hs-var">getLocalRdrEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681080828"><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681080828"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcLclEnv
forall gbl lcl. TcRnIf gbl lcl lcl
</span><a href="GHC.Tc.Utils.Monad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">LocalRdrEnv -&gt; RnM LocalRdrEnv
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcLclEnv -&gt; LocalRdrEnv
</span><a href="GHC.Tc.Types.html#tcl_rdr"><span class="hs-identifier hs-var hs-var">tcl_rdr</span></a></span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681080828"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1907"></span><span>
</span><span id="line-1908"></span><span id="local-6989586621681082426"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setLocalRdrEnv"><span class="hs-identifier hs-type">setLocalRdrEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#LocalRdrEnv"><span class="hs-identifier hs-type">LocalRdrEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082426"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082426"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1909"></span><span id="setLocalRdrEnv"><span class="annot"><span class="annottext">setLocalRdrEnv :: forall a. LocalRdrEnv -&gt; RnM a -&gt; RnM a
</span><a href="GHC.Tc.Utils.Monad.html#setLocalRdrEnv"><span class="hs-identifier hs-var hs-var">setLocalRdrEnv</span></a></span></span><span> </span><span id="local-6989586621681080827"><span class="annot"><span class="annottext">LocalRdrEnv
</span><a href="#local-6989586621681080827"><span class="hs-identifier hs-var">rdr_env</span></a></span></span><span> </span><span id="local-6989586621681080826"><span class="annot"><span class="annottext">RnM a
</span><a href="#local-6989586621681080826"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1910"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcLclEnv -&gt; TcLclEnv) -&gt; RnM a -&gt; RnM a
forall lcl gbl a.
(lcl -&gt; lcl) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updLclEnv"><span class="hs-identifier hs-var">updLclEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681080825"><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681080825"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681080825"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">tcl_rdr :: LocalRdrEnv
</span><a href="GHC.Tc.Types.html#tcl_rdr"><span class="hs-identifier hs-var">tcl_rdr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LocalRdrEnv
</span><a href="#local-6989586621681080827"><span class="hs-identifier hs-var">rdr_env</span></a></span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RnM a
</span><a href="#local-6989586621681080826"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1911"></span><span>
</span><span id="line-1912"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
             Stuff for interface decls
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-1919"></span><span>
</span><span id="line-1920"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#mkIfLclEnv"><span class="hs-identifier hs-type">mkIfLclEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#IsBootInterface"><span class="hs-identifier hs-type">IsBootInterface</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#IfLclEnv"><span class="hs-identifier hs-type">IfLclEnv</span></a></span><span>
</span><span id="line-1921"></span><span id="mkIfLclEnv"><span class="annot"><span class="annottext">mkIfLclEnv :: Module -&gt; SDoc -&gt; IsBootInterface -&gt; IfLclEnv
</span><a href="GHC.Tc.Utils.Monad.html#mkIfLclEnv"><span class="hs-identifier hs-var hs-var">mkIfLclEnv</span></a></span></span><span> </span><span id="local-6989586621681080824"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681080824"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span id="local-6989586621681080823"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681080823"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681080822"><span class="annot"><span class="annottext">IsBootInterface
</span><a href="#local-6989586621681080822"><span class="hs-identifier hs-var">boot</span></a></span></span><span>
</span><span id="line-1922"></span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IfLclEnv :: Module
-&gt; IsBootInterface
-&gt; SDoc
-&gt; Maybe NameShape
-&gt; Maybe TypeEnv
-&gt; FastStringEnv Id
-&gt; FastStringEnv Id
-&gt; IfLclEnv
</span><a href="GHC.Tc.Types.html#IfLclEnv"><span class="hs-identifier hs-type">IfLclEnv</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">if_mod :: Module
</span><a href="GHC.Tc.Types.html#if_mod"><span class="hs-identifier hs-var">if_mod</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681080824"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1923"></span><span>                                </span><span class="annot"><span class="annottext">if_loc :: SDoc
</span><a href="GHC.Tc.Types.html#if_loc"><span class="hs-identifier hs-var">if_loc</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681080823"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1924"></span><span>                                </span><span class="annot"><span class="annottext">if_boot :: IsBootInterface
</span><a href="GHC.Tc.Types.html#if_boot"><span class="hs-identifier hs-var">if_boot</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="#local-6989586621681080822"><span class="hs-identifier hs-var">boot</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1925"></span><span>                                </span><span class="annot"><span class="annottext">if_nsubst :: Maybe NameShape
</span><a href="GHC.Tc.Types.html#if_nsubst"><span class="hs-identifier hs-var">if_nsubst</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe NameShape
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1926"></span><span>                                </span><span class="annot"><span class="annottext">if_implicits_env :: Maybe TypeEnv
</span><a href="GHC.Tc.Types.html#if_implicits_env"><span class="hs-identifier hs-var">if_implicits_env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe TypeEnv
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1927"></span><span>                                </span><span class="annot"><span class="annottext">if_tv_env :: FastStringEnv Id
</span><a href="GHC.Tc.Types.html#if_tv_env"><span class="hs-identifier hs-var">if_tv_env</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastStringEnv Id
forall a. FastStringEnv a
</span><a href="GHC.Data.FastString.Env.html#emptyFsEnv"><span class="hs-identifier hs-var">emptyFsEnv</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1928"></span><span>                                </span><span class="annot"><span class="annottext">if_id_env :: FastStringEnv Id
</span><a href="GHC.Tc.Types.html#if_id_env"><span class="hs-identifier hs-var">if_id_env</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastStringEnv Id
forall a. FastStringEnv a
</span><a href="GHC.Data.FastString.Env.html#emptyFsEnv"><span class="hs-identifier hs-var">emptyFsEnv</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1929"></span><span>
</span><span id="line-1930"></span><span class="hs-comment">-- | Run an 'IfG' (top-level interface monad) computation inside an existing</span><span>
</span><span id="line-1931"></span><span class="hs-comment">-- 'TcRn' (typecheck-renaming monad) computation by initializing an 'IfGblEnv'</span><span>
</span><span id="line-1932"></span><span class="hs-comment">-- based on 'TcGblEnv'.</span><span>
</span><span id="line-1933"></span><span id="local-6989586621681082420"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#initIfaceTcRn"><span class="hs-identifier hs-type">initIfaceTcRn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#IfG"><span class="hs-identifier hs-type">IfG</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082420"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082420"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1934"></span><span id="initIfaceTcRn"><span class="annot"><span class="annottext">initIfaceTcRn :: forall a. IfG a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#initIfaceTcRn"><span class="hs-identifier hs-var hs-var">initIfaceTcRn</span></a></span></span><span> </span><span id="local-6989586621681080809"><span class="annot"><span class="annottext">IfG a
</span><a href="#local-6989586621681080809"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1935"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681080808"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681080808"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-1936"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681080807"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681080807"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-1937"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681080806"><span class="annot"><span class="annottext">mod :: Module
</span><a href="#local-6989586621681080806"><span class="hs-identifier hs-var hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; Module
</span><a href="GHC.Tc.Types.html#tcg_semantic_mod"><span class="hs-identifier hs-var hs-var">tcg_semantic_mod</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681080808"><span class="hs-identifier hs-var">tcg_env</span></a></span><span>
</span><span id="line-1938"></span><span>              </span><span class="hs-comment">-- When we are instantiating a signature, we DEFINITELY</span><span>
</span><span id="line-1939"></span><span>              </span><span class="hs-comment">-- do not want to knot tie.</span><span>
</span><span id="line-1940"></span><span>              </span><span id="local-6989586621681080804"><span class="annot"><span class="annottext">is_instantiate :: Bool
</span><a href="#local-6989586621681080804"><span class="hs-identifier hs-var hs-var">is_instantiate</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Unit.State.html#homeUnitIsDefinite"><span class="hs-identifier hs-var">homeUnitIsDefinite</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681080807"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-1941"></span><span>                               </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(ModuleName, Module)] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; [(ModuleName, Module)]
</span><a href="GHC.Driver.Session.html#homeUnitInstantiations"><span class="hs-identifier hs-var hs-var">homeUnitInstantiations</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681080807"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1942"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681080800"><span class="annot"><span class="annottext">if_env :: IfGblEnv
</span><a href="#local-6989586621681080800"><span class="hs-identifier hs-var hs-var">if_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IfGblEnv :: SDoc -&gt; Maybe (Module, IfG TypeEnv) -&gt; IfGblEnv
</span><a href="GHC.Tc.Types.html#IfGblEnv"><span class="hs-identifier hs-type">IfGblEnv</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-1943"></span><span>                            </span><span class="annot"><span class="annottext">if_doc :: SDoc
</span><a href="GHC.Tc.Types.html#if_doc"><span class="hs-identifier hs-var">if_doc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;initIfaceTcRn&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-1944"></span><span>                            </span><span class="annot"><span class="annottext">if_rec_types :: Maybe (Module, IfG TypeEnv)
</span><a href="GHC.Tc.Types.html#if_rec_types"><span class="hs-identifier hs-var">if_rec_types</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1945"></span><span>                                </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681080804"><span class="hs-identifier hs-var">is_instantiate</span></a></span><span>
</span><span id="line-1946"></span><span>                                    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Maybe (Module, IfG TypeEnv)
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1947"></span><span>                                    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">(Module, IfG TypeEnv) -&gt; Maybe (Module, IfG TypeEnv)
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681080806"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IfG TypeEnv
forall {gbl} {lcl}. TcRnIf gbl lcl TypeEnv
</span><a href="#local-6989586621681080796"><span class="hs-identifier hs-var">get_type_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1948"></span><span>                         </span><span class="hs-special">}</span><span>
</span><span id="line-1949"></span><span>              </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681080796"><span class="annot"><span class="annottext">get_type_env :: TcRnIf gbl lcl TypeEnv
</span><a href="#local-6989586621681080796"><span class="hs-identifier hs-var hs-var">get_type_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef TypeEnv -&gt; TcRnIf gbl lcl TypeEnv
forall a gbl lcl. TcRef a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; IORef TypeEnv
</span><a href="GHC.Tc.Types.html#tcg_type_env_var"><span class="hs-identifier hs-var hs-var">tcg_type_env_var</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681080808"><span class="hs-identifier hs-var">tcg_env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1950"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(IfGblEnv, ()) -&gt; IfG a -&gt; TcRn a
forall gbl' lcl' a gbl lcl.
(gbl', lcl') -&gt; TcRnIf gbl' lcl' a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#setEnvs"><span class="hs-identifier hs-var">setEnvs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IfGblEnv
</span><a href="#local-6989586621681080800"><span class="hs-identifier hs-var">if_env</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IfG a
</span><a href="#local-6989586621681080809"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1951"></span><span>
</span><span id="line-1952"></span><span class="hs-comment">-- Used when sucking in a ModIface into a ModDetails to put in</span><span>
</span><span id="line-1953"></span><span class="hs-comment">-- the HPT.  Notably, unlike initIfaceCheck, this does NOT use</span><span>
</span><span id="line-1954"></span><span class="hs-comment">-- hsc_type_env_var (since we're not actually going to typecheck,</span><span>
</span><span id="line-1955"></span><span class="hs-comment">-- so this variable will never get updated!)</span><span>
</span><span id="line-1956"></span><span id="local-6989586621681082412"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#initIfaceLoad"><span class="hs-identifier hs-type">initIfaceLoad</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#IfG"><span class="hs-identifier hs-type">IfG</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082412"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621681082412"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1957"></span><span id="initIfaceLoad"><span class="annot"><span class="annottext">initIfaceLoad :: forall a. HscEnv -&gt; IfG a -&gt; IO a
</span><a href="GHC.Tc.Utils.Monad.html#initIfaceLoad"><span class="hs-identifier hs-var hs-var">initIfaceLoad</span></a></span></span><span> </span><span id="local-6989586621681080795"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681080795"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681080794"><span class="annot"><span class="annottext">IfG a
</span><a href="#local-6989586621681080794"><span class="hs-identifier hs-var">do_this</span></a></span></span><span>
</span><span id="line-1958"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681080793"><span class="annot"><span class="annottext">gbl_env :: IfGblEnv
</span><a href="#local-6989586621681080793"><span class="hs-identifier hs-var hs-var">gbl_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IfGblEnv :: SDoc -&gt; Maybe (Module, IfG TypeEnv) -&gt; IfGblEnv
</span><a href="GHC.Tc.Types.html#IfGblEnv"><span class="hs-identifier hs-type">IfGblEnv</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-1959"></span><span>                        </span><span class="annot"><span class="annottext">if_doc :: SDoc
</span><a href="GHC.Tc.Types.html#if_doc"><span class="hs-identifier hs-var">if_doc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;initIfaceLoad&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-1960"></span><span>                        </span><span class="annot"><span class="annottext">if_rec_types :: Maybe (Module, IfG TypeEnv)
</span><a href="GHC.Tc.Types.html#if_rec_types"><span class="hs-identifier hs-var">if_rec_types</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Module, IfG TypeEnv)
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1961"></span><span>                    </span><span class="hs-special">}</span><span>
</span><span id="line-1962"></span><span>      </span><span class="annot"><span class="annottext">Char -&gt; HscEnv -&gt; IfGblEnv -&gt; () -&gt; IfG a -&gt; IO a
forall gbl lcl a.
Char -&gt; HscEnv -&gt; gbl -&gt; lcl -&gt; TcRnIf gbl lcl a -&gt; IO a
</span><a href="GHC.Tc.Utils.Monad.html#initTcRnIf"><span class="hs-identifier hs-var">initTcRnIf</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'i'</span></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681080795"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">IfGblEnv
</span><a href="#local-6989586621681080793"><span class="hs-identifier hs-var">gbl_env</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IfG a
</span><a href="#local-6989586621681080794"><span class="hs-identifier hs-var">do_this</span></a></span><span>
</span><span id="line-1963"></span><span>
</span><span id="line-1964"></span><span id="local-6989586621681082410"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#initIfaceCheck"><span class="hs-identifier hs-type">initIfaceCheck</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#IfG"><span class="hs-identifier hs-type">IfG</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082410"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621681082410"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1965"></span><span class="hs-comment">-- Used when checking the up-to-date-ness of the old Iface</span><span>
</span><span id="line-1966"></span><span class="hs-comment">-- Initialise the environment with no useful info at all</span><span>
</span><span id="line-1967"></span><span id="initIfaceCheck"><span class="annot"><span class="annottext">initIfaceCheck :: forall a. SDoc -&gt; HscEnv -&gt; IfG a -&gt; IO a
</span><a href="GHC.Tc.Utils.Monad.html#initIfaceCheck"><span class="hs-identifier hs-var hs-var">initIfaceCheck</span></a></span></span><span> </span><span id="local-6989586621681080792"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681080792"><span class="hs-identifier hs-var">doc</span></a></span></span><span> </span><span id="local-6989586621681080791"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681080791"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681080790"><span class="annot"><span class="annottext">IfG a
</span><a href="#local-6989586621681080790"><span class="hs-identifier hs-var">do_this</span></a></span></span><span>
</span><span id="line-1968"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681080789"><span class="annot"><span class="annottext">rec_types :: Maybe (Module, TcRnIf gbl lcl TypeEnv)
</span><a href="#local-6989586621681080789"><span class="hs-identifier hs-var hs-var">rec_types</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Maybe (Module, IORef TypeEnv)
</span><a href="GHC.Driver.Types.html#hsc_type_env_var"><span class="hs-identifier hs-var hs-var">hsc_type_env_var</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681080791"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1969"></span><span>                         </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681080788"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681080788"><span class="hs-identifier hs-var">mod</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681080787"><span class="annot"><span class="annottext">IORef TypeEnv
</span><a href="#local-6989586621681080787"><span class="hs-identifier hs-var">var</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Module, TcRnIf gbl lcl TypeEnv)
-&gt; Maybe (Module, TcRnIf gbl lcl TypeEnv)
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681080788"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IORef TypeEnv -&gt; TcRnIf gbl lcl TypeEnv
forall a gbl lcl. TcRef a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef TypeEnv
</span><a href="#local-6989586621681080787"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1970"></span><span>                         </span><span class="annot"><span class="annottext">Maybe (Module, IORef TypeEnv)
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Module, TcRnIf gbl lcl TypeEnv)
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1971"></span><span>          </span><span id="local-6989586621681080786"><span class="annot"><span class="annottext">gbl_env :: IfGblEnv
</span><a href="#local-6989586621681080786"><span class="hs-identifier hs-var hs-var">gbl_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IfGblEnv :: SDoc -&gt; Maybe (Module, IfG TypeEnv) -&gt; IfGblEnv
</span><a href="GHC.Tc.Types.html#IfGblEnv"><span class="hs-identifier hs-type">IfGblEnv</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-1972"></span><span>                        </span><span class="annot"><span class="annottext">if_doc :: SDoc
</span><a href="GHC.Tc.Types.html#if_doc"><span class="hs-identifier hs-var">if_doc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;initIfaceCheck&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681080792"><span class="hs-identifier hs-var">doc</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1973"></span><span>                        </span><span class="annot"><span class="annottext">if_rec_types :: Maybe (Module, IfG TypeEnv)
</span><a href="GHC.Tc.Types.html#if_rec_types"><span class="hs-identifier hs-var">if_rec_types</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Module, IfG TypeEnv)
forall {gbl} {lcl}. Maybe (Module, TcRnIf gbl lcl TypeEnv)
</span><a href="#local-6989586621681080789"><span class="hs-identifier hs-var">rec_types</span></a></span><span>
</span><span id="line-1974"></span><span>                    </span><span class="hs-special">}</span><span>
</span><span id="line-1975"></span><span>      </span><span class="annot"><span class="annottext">Char -&gt; HscEnv -&gt; IfGblEnv -&gt; () -&gt; IfG a -&gt; IO a
forall gbl lcl a.
Char -&gt; HscEnv -&gt; gbl -&gt; lcl -&gt; TcRnIf gbl lcl a -&gt; IO a
</span><a href="GHC.Tc.Utils.Monad.html#initTcRnIf"><span class="hs-identifier hs-var">initTcRnIf</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'i'</span></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681080791"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">IfGblEnv
</span><a href="#local-6989586621681080786"><span class="hs-identifier hs-var">gbl_env</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IfG a
</span><a href="#local-6989586621681080790"><span class="hs-identifier hs-var">do_this</span></a></span><span>
</span><span id="line-1976"></span><span>
</span><span id="line-1977"></span><span id="local-6989586621681082404"><span id="local-6989586621681082406"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#initIfaceLcl"><span class="hs-identifier hs-type">initIfaceLcl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#IsBootInterface"><span class="hs-identifier hs-type">IsBootInterface</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#IfL"><span class="hs-identifier hs-type">IfL</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082406"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#IfM"><span class="hs-identifier hs-type">IfM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082404"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082406"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-1978"></span><span id="initIfaceLcl"><span class="annot"><span class="annottext">initIfaceLcl :: forall a lcl.
Module -&gt; SDoc -&gt; IsBootInterface -&gt; IfL a -&gt; IfM lcl a
</span><a href="GHC.Tc.Utils.Monad.html#initIfaceLcl"><span class="hs-identifier hs-var hs-var">initIfaceLcl</span></a></span></span><span> </span><span id="local-6989586621681080785"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681080785"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span id="local-6989586621681080784"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681080784"><span class="hs-identifier hs-var">loc_doc</span></a></span></span><span> </span><span id="local-6989586621681080783"><span class="annot"><span class="annottext">IsBootInterface
</span><a href="#local-6989586621681080783"><span class="hs-identifier hs-var">hi_boot_file</span></a></span></span><span> </span><span id="local-6989586621681080782"><span class="annot"><span class="annottext">IfL a
</span><a href="#local-6989586621681080782"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1979"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IfLclEnv -&gt; IfL a -&gt; TcRnIf IfGblEnv lcl a
forall lcl' gbl a lcl.
lcl' -&gt; TcRnIf gbl lcl' a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#setLclEnv"><span class="hs-identifier hs-var">setLclEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; SDoc -&gt; IsBootInterface -&gt; IfLclEnv
</span><a href="GHC.Tc.Utils.Monad.html#mkIfLclEnv"><span class="hs-identifier hs-var">mkIfLclEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681080785"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681080784"><span class="hs-identifier hs-var">loc_doc</span></a></span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="#local-6989586621681080783"><span class="hs-identifier hs-var">hi_boot_file</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IfL a
</span><a href="#local-6989586621681080782"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1980"></span><span>
</span><span id="line-1981"></span><span class="hs-comment">-- | Initialize interface typechecking, but with a 'NameShape'</span><span>
</span><span id="line-1982"></span><span class="hs-comment">-- to apply when typechecking top-level 'OccName's (see</span><span>
</span><span id="line-1983"></span><span class="hs-comment">-- 'lookupIfaceTop')</span><span>
</span><span id="line-1984"></span><span id="local-6989586621681082399"><span id="local-6989586621681082400"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#initIfaceLclWithSubst"><span class="hs-identifier hs-type">initIfaceLclWithSubst</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#IsBootInterface"><span class="hs-identifier hs-type">IsBootInterface</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#NameShape"><span class="hs-identifier hs-type">NameShape</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#IfL"><span class="hs-identifier hs-type">IfL</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082400"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#IfM"><span class="hs-identifier hs-type">IfM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082399"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082400"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-1985"></span><span id="initIfaceLclWithSubst"><span class="annot"><span class="annottext">initIfaceLclWithSubst :: forall a lcl.
Module
-&gt; SDoc -&gt; IsBootInterface -&gt; NameShape -&gt; IfL a -&gt; IfM lcl a
</span><a href="GHC.Tc.Utils.Monad.html#initIfaceLclWithSubst"><span class="hs-identifier hs-var hs-var">initIfaceLclWithSubst</span></a></span></span><span> </span><span id="local-6989586621681080781"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681080781"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span id="local-6989586621681080780"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681080780"><span class="hs-identifier hs-var">loc_doc</span></a></span></span><span> </span><span id="local-6989586621681080779"><span class="annot"><span class="annottext">IsBootInterface
</span><a href="#local-6989586621681080779"><span class="hs-identifier hs-var">hi_boot_file</span></a></span></span><span> </span><span id="local-6989586621681080778"><span class="annot"><span class="annottext">NameShape
</span><a href="#local-6989586621681080778"><span class="hs-identifier hs-var">nsubst</span></a></span></span><span> </span><span id="local-6989586621681080777"><span class="annot"><span class="annottext">IfL a
</span><a href="#local-6989586621681080777"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1986"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IfLclEnv -&gt; IfL a -&gt; TcRnIf IfGblEnv lcl a
forall lcl' gbl a lcl.
lcl' -&gt; TcRnIf gbl lcl' a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#setLclEnv"><span class="hs-identifier hs-var">setLclEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; SDoc -&gt; IsBootInterface -&gt; IfLclEnv
</span><a href="GHC.Tc.Utils.Monad.html#mkIfLclEnv"><span class="hs-identifier hs-var">mkIfLclEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681080781"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681080780"><span class="hs-identifier hs-var">loc_doc</span></a></span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="#local-6989586621681080779"><span class="hs-identifier hs-var">hi_boot_file</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">if_nsubst :: Maybe NameShape
</span><a href="GHC.Tc.Types.html#if_nsubst"><span class="hs-identifier hs-var">if_nsubst</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NameShape -&gt; Maybe NameShape
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">NameShape
</span><a href="#local-6989586621681080778"><span class="hs-identifier hs-var">nsubst</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IfL a
</span><a href="#local-6989586621681080777"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1987"></span><span>
</span><span id="line-1988"></span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getIfModule"><span class="hs-identifier hs-type">getIfModule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#IfL"><span class="hs-identifier hs-type">IfL</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span>
</span><span id="line-1989"></span><span id="getIfModule"><span class="annot"><span class="annottext">getIfModule :: IfL Module
</span><a href="GHC.Tc.Utils.Monad.html#getIfModule"><span class="hs-identifier hs-var hs-var">getIfModule</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681080776"><span class="annot"><span class="annottext">IfLclEnv
</span><a href="#local-6989586621681080776"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf IfGblEnv IfLclEnv IfLclEnv
forall gbl lcl. TcRnIf gbl lcl lcl
</span><a href="GHC.Tc.Utils.Monad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Module -&gt; IfL Module
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IfLclEnv -&gt; Module
</span><a href="GHC.Tc.Types.html#if_mod"><span class="hs-identifier hs-var hs-var">if_mod</span></a></span><span> </span><span class="annot"><span class="annottext">IfLclEnv
</span><a href="#local-6989586621681080776"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1990"></span><span>
</span><span id="line-1991"></span><span class="hs-comment">--------------------</span><span>
</span><span id="line-1992"></span><span id="local-6989586621681082396"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#failIfM"><span class="hs-identifier hs-type">failIfM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#MsgDoc"><span class="hs-identifier hs-type">MsgDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#IfL"><span class="hs-identifier hs-type">IfL</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082396"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1993"></span><span class="hs-comment">-- The Iface monad doesn't have a place to accumulate errors, so we</span><span>
</span><span id="line-1994"></span><span class="hs-comment">-- just fall over fast if one happens; it &quot;shouldn't happen&quot;.</span><span>
</span><span id="line-1995"></span><span class="hs-comment">-- We use IfL here so that we can get context info out of the local env</span><span>
</span><span id="line-1996"></span><span id="failIfM"><span class="annot"><span class="annottext">failIfM :: forall a. SDoc -&gt; IfL a
</span><a href="GHC.Tc.Utils.Monad.html#failIfM"><span class="hs-identifier hs-var hs-var">failIfM</span></a></span></span><span> </span><span id="local-6989586621681080769"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681080769"><span class="hs-identifier hs-var">msg</span></a></span></span><span>
</span><span id="line-1997"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681080768"><span class="annot"><span class="annottext">IfLclEnv
</span><a href="#local-6989586621681080768"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf IfGblEnv IfLclEnv IfLclEnv
forall gbl lcl. TcRnIf gbl lcl lcl
</span><a href="GHC.Tc.Utils.Monad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a></span><span>
</span><span id="line-1998"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681080767"><span class="annot"><span class="annottext">full_msg :: SDoc
</span><a href="#local-6989586621681080767"><span class="hs-identifier hs-var hs-var">full_msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IfLclEnv -&gt; SDoc
</span><a href="GHC.Tc.Types.html#if_loc"><span class="hs-identifier hs-var hs-var">if_loc</span></a></span><span> </span><span class="annot"><span class="annottext">IfLclEnv
</span><a href="#local-6989586621681080768"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#colon"><span class="hs-identifier hs-var">colon</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681080769"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-1999"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681080763"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681080763"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env IfGblEnv IfLclEnv) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-2000"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IOEnv (Env IfGblEnv IfLclEnv) ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; WarnReason -&gt; Severity -&gt; SrcSpan -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Driver.Session.html#putLogMsg"><span class="hs-identifier hs-var">putLogMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681080763"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">WarnReason
</span><a href="GHC.Driver.Flags.html#NoReason"><span class="hs-identifier hs-var">NoReason</span></a></span><span> </span><span class="annot"><span class="annottext">Severity
</span><a href="GHC.Utils.Error.html#SevFatal"><span class="hs-identifier hs-var">SevFatal</span></a></span><span>
</span><span id="line-2001"></span><span>                   </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="GHC.Types.SrcLoc.html#noSrcSpan"><span class="hs-identifier hs-var">noSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; IO ()) -&gt; SDoc -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PprStyle -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#withPprStyle"><span class="hs-identifier hs-var">withPprStyle</span></a></span><span> </span><span class="annot"><span class="annottext">PprStyle
</span><a href="GHC.Utils.Outputable.html#defaultErrStyle"><span class="hs-identifier hs-var">defaultErrStyle</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681080767"><span class="hs-identifier hs-var">full_msg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2002"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">IfL a
forall env a. IOEnv env a
</span><a href="GHC.Data.IOEnv.html#failM"><span class="hs-identifier hs-var">failM</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2003"></span><span>
</span><span id="line-2004"></span><span class="hs-comment">--------------------</span><span>
</span><span id="line-2005"></span><span id="local-6989586621681082394"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#forkM_maybe"><span class="hs-identifier hs-type">forkM_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#IfL"><span class="hs-identifier hs-type">IfL</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082394"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#IfL"><span class="hs-identifier hs-type">IfL</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082394"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-2006"></span><span class="hs-comment">-- Run thing_inside in an interleaved thread.</span><span>
</span><span id="line-2007"></span><span class="hs-comment">-- It shares everything with the parent thread, so this is DANGEROUS.</span><span>
</span><span id="line-2008"></span><span class="hs-comment">--</span><span>
</span><span id="line-2009"></span><span class="hs-comment">-- It returns Nothing if the computation fails</span><span>
</span><span id="line-2010"></span><span class="hs-comment">--</span><span>
</span><span id="line-2011"></span><span class="hs-comment">-- It's used for lazily type-checking interface</span><span>
</span><span id="line-2012"></span><span class="hs-comment">-- signatures, which is pretty benign</span><span>
</span><span id="line-2013"></span><span>
</span><span id="line-2014"></span><span id="forkM_maybe"><span class="annot"><span class="annottext">forkM_maybe :: forall a. SDoc -&gt; IfL a -&gt; IfL (Maybe a)
</span><a href="GHC.Tc.Utils.Monad.html#forkM_maybe"><span class="hs-identifier hs-var hs-var">forkM_maybe</span></a></span></span><span> </span><span id="local-6989586621681080746"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681080746"><span class="hs-identifier hs-var">doc</span></a></span></span><span> </span><span id="local-6989586621681080745"><span class="annot"><span class="annottext">IfL a
</span><a href="#local-6989586621681080745"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-2015"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- see Note [Masking exceptions in forkM_maybe]</span><span>
</span><span id="line-2016"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">IfL (Maybe a) -&gt; IfL (Maybe a)
forall env a. IOEnv env a -&gt; IOEnv env a
</span><a href="GHC.Data.IOEnv.html#unsafeInterleaveM"><span class="hs-identifier hs-var">unsafeInterleaveM</span></a></span><span> </span><span class="annot"><span class="annottext">(IfL (Maybe a) -&gt; IfL (Maybe a)) -&gt; IfL (Maybe a) -&gt; IfL (Maybe a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">IfL (Maybe a) -&gt; IfL (Maybe a)
forall env a. IOEnv env a -&gt; IOEnv env a
</span><a href="GHC.Data.IOEnv.html#uninterruptibleMaskM_"><span class="hs-identifier hs-var">uninterruptibleMaskM_</span></a></span><span> </span><span class="annot"><span class="annottext">(IfL (Maybe a) -&gt; IfL (Maybe a)) -&gt; IfL (Maybe a) -&gt; IfL (Maybe a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2017"></span><span>        </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; IOEnv (Env IfGblEnv IfLclEnv) ()
forall m n. SDoc -&gt; TcRnIf m n ()
</span><a href="GHC.Tc.Utils.Monad.html#traceIf"><span class="hs-identifier hs-var">traceIf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;Starting fork {&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681080746"><span class="hs-identifier hs-var">doc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2018"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681080742"><span class="annot"><span class="annottext">Either IOEnvFailure a
</span><a href="#local-6989586621681080742"><span class="hs-identifier hs-var">mb_res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IfL a -&gt; IOEnv (Env IfGblEnv IfLclEnv) (Either IOEnvFailure a)
forall env r. IOEnv env r -&gt; IOEnv env (Either IOEnvFailure r)
</span><a href="GHC.Data.IOEnv.html#tryM"><span class="hs-identifier hs-var">tryM</span></a></span><span> </span><span class="annot"><span class="annottext">(IfL a -&gt; IOEnv (Env IfGblEnv IfLclEnv) (Either IOEnvFailure a))
-&gt; IfL a -&gt; IOEnv (Env IfGblEnv IfLclEnv) (Either IOEnvFailure a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2019"></span><span>                       </span><span class="annot"><span class="annottext">(IfLclEnv -&gt; IfLclEnv) -&gt; IfL a -&gt; IfL a
forall lcl gbl a.
(lcl -&gt; lcl) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updLclEnv"><span class="hs-identifier hs-var">updLclEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681080741"><span class="annot"><span class="annottext">IfLclEnv
</span><a href="#local-6989586621681080741"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IfLclEnv
</span><a href="#local-6989586621681080741"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">if_loc :: SDoc
</span><a href="GHC.Tc.Types.html#if_loc"><span class="hs-identifier hs-var">if_loc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IfLclEnv -&gt; SDoc
</span><a href="GHC.Tc.Types.html#if_loc"><span class="hs-identifier hs-var hs-var">if_loc</span></a></span><span> </span><span class="annot"><span class="annottext">IfLclEnv
</span><a href="#local-6989586621681080741"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681080746"><span class="hs-identifier hs-var">doc</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IfL a -&gt; IfL a) -&gt; IfL a -&gt; IfL a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2020"></span><span>                       </span><span class="annot"><span class="annottext">IfL a
</span><a href="#local-6989586621681080745"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-2021"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either IOEnvFailure a
</span><a href="#local-6989586621681080742"><span class="hs-identifier hs-var">mb_res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2022"></span><span>                </span><span class="annot"><a href="../../base/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621681080740"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681080740"><span class="hs-identifier hs-var">r</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; IOEnv (Env IfGblEnv IfLclEnv) ()
forall m n. SDoc -&gt; TcRnIf m n ()
</span><a href="GHC.Tc.Utils.Monad.html#traceIf"><span class="hs-identifier hs-var">traceIf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;} ending fork&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681080746"><span class="hs-identifier hs-var">doc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2023"></span><span>                                </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Maybe a -&gt; IfL (Maybe a)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681080740"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2024"></span><span>                </span><span class="annot"><a href="../../base/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621681080739"><span class="annot"><span class="annottext">IOEnvFailure
</span><a href="#local-6989586621681080739"><span class="hs-identifier hs-var">exn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-2025"></span><span>
</span><span id="line-2026"></span><span>                    </span><span class="hs-comment">-- Bleat about errors in the forked thread, if -ddump-if-trace is on</span><span>
</span><span id="line-2027"></span><span>                    </span><span class="hs-comment">-- Otherwise we silently discard errors. Errors can legitimately</span><span>
</span><span id="line-2028"></span><span>                    </span><span class="hs-comment">-- happen when compiling interface signatures (see tcInterfaceSigs)</span><span>
</span><span id="line-2029"></span><span>                      </span><span class="annot"><span class="annottext">DumpFlag
-&gt; IOEnv (Env IfGblEnv IfLclEnv) ()
-&gt; IOEnv (Env IfGblEnv IfLclEnv) ()
forall gbl lcl. DumpFlag -&gt; TcRnIf gbl lcl () -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#whenDOptM"><span class="hs-identifier hs-var">whenDOptM</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_if_trace"><span class="hs-identifier hs-var">Opt_D_dump_if_trace</span></a></span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env IfGblEnv IfLclEnv) ()
 -&gt; IOEnv (Env IfGblEnv IfLclEnv) ())
-&gt; IOEnv (Env IfGblEnv IfLclEnv) ()
-&gt; IOEnv (Env IfGblEnv IfLclEnv) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2030"></span><span>                          </span><span id="local-6989586621681080738"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681080738"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env IfGblEnv IfLclEnv) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-2031"></span><span>                          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681080735"><span class="annot"><span class="annottext">msg :: SDoc
</span><a href="#local-6989586621681080735"><span class="hs-identifier hs-var hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;forkM failed:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681080746"><span class="hs-identifier hs-var">doc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2032"></span><span>                                       </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IOEnvFailure -&gt; FilePath
forall a. Show a =&gt; a -&gt; FilePath
</span><a href="../../base/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">IOEnvFailure
</span><a href="#local-6989586621681080739"><span class="hs-identifier hs-var">exn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2033"></span><span>                          </span><span class="annot"><span class="annottext">IO () -&gt; IOEnv (Env IfGblEnv IfLclEnv) ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IOEnv (Env IfGblEnv IfLclEnv) ())
-&gt; IO () -&gt; IOEnv (Env IfGblEnv IfLclEnv) ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; WarnReason -&gt; Severity -&gt; SrcSpan -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Driver.Session.html#putLogMsg"><span class="hs-identifier hs-var">putLogMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681080738"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-2034"></span><span>                                             </span><span class="annot"><span class="annottext">WarnReason
</span><a href="GHC.Driver.Flags.html#NoReason"><span class="hs-identifier hs-var">NoReason</span></a></span><span>
</span><span id="line-2035"></span><span>                                             </span><span class="annot"><span class="annottext">Severity
</span><a href="GHC.Utils.Error.html#SevFatal"><span class="hs-identifier hs-var">SevFatal</span></a></span><span>
</span><span id="line-2036"></span><span>                                             </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="GHC.Types.SrcLoc.html#noSrcSpan"><span class="hs-identifier hs-var">noSrcSpan</span></a></span><span>
</span><span id="line-2037"></span><span>                                             </span><span class="annot"><span class="annottext">(SDoc -&gt; IO ()) -&gt; SDoc -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PprStyle -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#withPprStyle"><span class="hs-identifier hs-var">withPprStyle</span></a></span><span> </span><span class="annot"><span class="annottext">PprStyle
</span><a href="GHC.Utils.Outputable.html#defaultErrStyle"><span class="hs-identifier hs-var">defaultErrStyle</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681080735"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-2038"></span><span>
</span><span id="line-2039"></span><span>                    </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; IOEnv (Env IfGblEnv IfLclEnv) ()
forall m n. SDoc -&gt; TcRnIf m n ()
</span><a href="GHC.Tc.Utils.Monad.html#traceIf"><span class="hs-identifier hs-var">traceIf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;} ending fork (badly)&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681080746"><span class="hs-identifier hs-var">doc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2040"></span><span>                    </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Maybe a -&gt; IfL (Maybe a)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2041"></span><span>        </span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><span id="line-2042"></span><span>
</span><span id="line-2043"></span><span id="local-6989586621681082389"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#forkM"><span class="hs-identifier hs-type">forkM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#IfL"><span class="hs-identifier hs-type">IfL</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082389"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#IfL"><span class="hs-identifier hs-type">IfL</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082389"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-2044"></span><span id="forkM"><span class="annot"><span class="annottext">forkM :: forall a. SDoc -&gt; IfL a -&gt; IfL a
</span><a href="GHC.Tc.Utils.Monad.html#forkM"><span class="hs-identifier hs-var hs-var">forkM</span></a></span></span><span> </span><span id="local-6989586621681080731"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681080731"><span class="hs-identifier hs-var">doc</span></a></span></span><span> </span><span id="local-6989586621681080730"><span class="annot"><span class="annottext">IfL a
</span><a href="#local-6989586621681080730"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-2045"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>   </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681080729"><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621681080729"><span class="hs-identifier hs-var">mb_res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; IfL a -&gt; IfL (Maybe a)
forall a. SDoc -&gt; IfL a -&gt; IfL (Maybe a)
</span><a href="GHC.Tc.Utils.Monad.html#forkM_maybe"><span class="hs-identifier hs-var">forkM_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681080731"><span class="hs-identifier hs-var">doc</span></a></span><span> </span><span class="annot"><span class="annottext">IfL a
</span><a href="#local-6989586621681080730"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-2046"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">a -&gt; IfL a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621681080729"><span class="hs-identifier hs-var">mb_res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2047"></span><span>                        </span><span class="annot"><span class="annottext">Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; a
forall a. FilePath -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#pgmError"><span class="hs-identifier hs-var">pgmError</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;Cannot continue after interface file error&quot;</span></span><span>
</span><span id="line-2048"></span><span>                                   </span><span class="hs-comment">-- pprPanic &quot;forkM&quot; doc</span><span>
</span><span id="line-2049"></span><span>                        </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681080727"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681080727"><span class="hs-identifier hs-var">r</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681080727"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2050"></span><span>
</span><span id="line-2051"></span><span id="local-6989586621681082386"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#setImplicitEnvM"><span class="hs-identifier hs-type">setImplicitEnvM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#TypeEnv"><span class="hs-identifier hs-type">TypeEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#IfL"><span class="hs-identifier hs-type">IfL</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082386"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#IfL"><span class="hs-identifier hs-type">IfL</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082386"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-2052"></span><span id="setImplicitEnvM"><span class="annot"><span class="annottext">setImplicitEnvM :: forall a. TypeEnv -&gt; IfL a -&gt; IfL a
</span><a href="GHC.Tc.Utils.Monad.html#setImplicitEnvM"><span class="hs-identifier hs-var hs-var">setImplicitEnvM</span></a></span></span><span> </span><span id="local-6989586621681080726"><span class="annot"><span class="annottext">TypeEnv
</span><a href="#local-6989586621681080726"><span class="hs-identifier hs-var">tenv</span></a></span></span><span> </span><span id="local-6989586621681080725"><span class="annot"><span class="annottext">IfL a
</span><a href="#local-6989586621681080725"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(IfLclEnv -&gt; IfLclEnv) -&gt; IfL a -&gt; IfL a
forall lcl gbl a.
(lcl -&gt; lcl) -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#updLclEnv"><span class="hs-identifier hs-var">updLclEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681080724"><span class="annot"><span class="annottext">IfLclEnv
</span><a href="#local-6989586621681080724"><span class="hs-identifier hs-var">lcl</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IfLclEnv
</span><a href="#local-6989586621681080724"><span class="hs-identifier hs-var">lcl</span></a></span><span>
</span><span id="line-2053"></span><span>                                     </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">if_implicits_env :: Maybe TypeEnv
</span><a href="GHC.Tc.Types.html#if_implicits_env"><span class="hs-identifier hs-var">if_implicits_env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeEnv -&gt; Maybe TypeEnv
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">TypeEnv
</span><a href="#local-6989586621681080726"><span class="hs-identifier hs-var">tenv</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IfL a
</span><a href="#local-6989586621681080725"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-2054"></span><span>
</span><span id="line-2055"></span><span class="hs-comment">{-
Note [Masking exceptions in forkM_maybe]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

When using GHC-as-API it must be possible to interrupt snippets of code
executed using runStmt (#1381). Since commit 02c4ab04 this is almost possible
by throwing an asynchronous interrupt to the GHC thread. However, there is a
subtle problem: runStmt first typechecks the code before running it, and the
exception might interrupt the type checker rather than the code. Moreover, the
typechecker might be inside an unsafeInterleaveIO (through forkM_maybe), and
more importantly might be inside an exception handler inside that
unsafeInterleaveIO. If that is the case, the exception handler will rethrow the
asynchronous exception as a synchronous exception, and the exception will end
up as the value of the unsafeInterleaveIO thunk (see #8006 for a detailed
discussion).  We don't currently know a general solution to this problem, but
we can use uninterruptibleMask_ to avoid the situation.
-}</span><span>
</span><span id="line-2072"></span><span>
</span><span id="line-2073"></span><span class="hs-comment">-- | Environments which track 'CostCentreState'</span><span>
</span><span id="line-2074"></span><span class="hs-keyword">class</span><span> </span><span id="ContainsCostCentreState"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#ContainsCostCentreState"><span class="hs-identifier hs-var">ContainsCostCentreState</span></a></span></span><span> </span><span id="local-6989586621681082383"><span class="annot"><a href="#local-6989586621681082383"><span class="hs-identifier hs-type">e</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2075"></span><span>  </span><span id="extractCostCentreState"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#extractCostCentreState"><span class="hs-identifier hs-type">extractCostCentreState</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621681082383"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRef"><span class="hs-identifier hs-type">TcRef</span></a></span><span> </span><span class="annot"><a href="GHC.Types.CostCentre.State.html#CostCentreState"><span class="hs-identifier hs-type">CostCentreState</span></a></span><span>
</span><span id="line-2076"></span><span>
</span><span id="line-2077"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#ContainsCostCentreState"><span class="hs-identifier hs-type">ContainsCostCentreState</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2078"></span><span>  </span><span id="local-6989586621681080719"><span class="annot"><span class="annottext">extractCostCentreState :: TcGblEnv -&gt; IORef CostCentreState
</span><a href="#local-6989586621681080719"><span class="hs-identifier hs-var hs-var hs-var hs-var">extractCostCentreState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; IORef CostCentreState
</span><a href="GHC.Tc.Types.html#tcg_cc_st"><span class="hs-identifier hs-var hs-var">tcg_cc_st</span></a></span><span>
</span><span id="line-2079"></span><span>
</span><span id="line-2080"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#ContainsCostCentreState"><span class="hs-identifier hs-type">ContainsCostCentreState</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#DsGblEnv"><span class="hs-identifier hs-type">DsGblEnv</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2081"></span><span>  </span><span id="local-6989586621681080716"><span class="annot"><span class="annottext">extractCostCentreState :: DsGblEnv -&gt; IORef CostCentreState
</span><a href="#local-6989586621681080716"><span class="hs-identifier hs-var hs-var hs-var hs-var">extractCostCentreState</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DsGblEnv -&gt; IORef CostCentreState
</span><a href="GHC.Tc.Types.html#ds_cc_st"><span class="hs-identifier hs-var hs-var">ds_cc_st</span></a></span><span>
</span><span id="line-2082"></span><span>
</span><span id="line-2083"></span><span class="hs-comment">-- | Get the next cost centre index associated with a given name.</span><span>
</span><span id="line-2084"></span><span id="local-6989586621681082380"><span id="local-6989586621681082381"><span class="annot"><a href="GHC.Tc.Utils.Monad.html#getCCIndexM"><span class="hs-identifier hs-type">getCCIndexM</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#ContainsCostCentreState"><span class="hs-identifier hs-type">ContainsCostCentreState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082381"><span class="hs-identifier hs-type">gbl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2085"></span><span>            </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRnIf"><span class="hs-identifier hs-type">TcRnIf</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082381"><span class="hs-identifier hs-type">gbl</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681082380"><span class="hs-identifier hs-type">lcl</span></a></span><span> </span><span class="annot"><a href="GHC.Types.CostCentre.State.html#CostCentreIndex"><span class="hs-identifier hs-type">CostCentreIndex</span></a></span></span></span><span>
</span><span id="line-2086"></span><span id="getCCIndexM"><span class="annot"><span class="annottext">getCCIndexM :: forall gbl lcl.
ContainsCostCentreState gbl =&gt;
FastString -&gt; TcRnIf gbl lcl CostCentreIndex
</span><a href="GHC.Tc.Utils.Monad.html#getCCIndexM"><span class="hs-identifier hs-var hs-var">getCCIndexM</span></a></span></span><span> </span><span id="local-6989586621681080709"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621681080709"><span class="hs-identifier hs-var">nm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2087"></span><span>  </span><span id="local-6989586621681080708"><span class="annot"><span class="annottext">gbl
</span><a href="#local-6989586621681080708"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf gbl lcl gbl
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-2088"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681080706"><span class="annot"><span class="annottext">cc_st_ref :: IORef CostCentreState
</span><a href="#local-6989586621681080706"><span class="hs-identifier hs-var hs-var">cc_st_ref</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">gbl -&gt; IORef CostCentreState
forall e. ContainsCostCentreState e =&gt; e -&gt; IORef CostCentreState
</span><a href="GHC.Tc.Utils.Monad.html#extractCostCentreState"><span class="hs-identifier hs-var">extractCostCentreState</span></a></span><span> </span><span class="annot"><span class="annottext">gbl
</span><a href="#local-6989586621681080708"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-2089"></span><span>  </span><span id="local-6989586621681080705"><span class="annot"><span class="annottext">CostCentreState
</span><a href="#local-6989586621681080705"><span class="hs-identifier hs-var">cc_st</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef CostCentreState -&gt; TcRnIf gbl lcl CostCentreState
forall a gbl lcl. TcRef a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef CostCentreState
</span><a href="#local-6989586621681080706"><span class="hs-identifier hs-var">cc_st_ref</span></a></span><span>
</span><span id="line-2090"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681080704"><span class="annot"><span class="annottext">CostCentreIndex
</span><a href="#local-6989586621681080704"><span class="hs-identifier hs-var">idx</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681080703"><span class="annot"><span class="annottext">CostCentreState
</span><a href="#local-6989586621681080703"><span class="hs-identifier hs-var">cc_st'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; CostCentreState -&gt; (CostCentreIndex, CostCentreState)
</span><a href="GHC.Types.CostCentre.State.html#getCCIndex"><span class="hs-identifier hs-var">getCCIndex</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621681080709"><span class="hs-identifier hs-var">nm</span></a></span><span> </span><span class="annot"><span class="annottext">CostCentreState
</span><a href="#local-6989586621681080705"><span class="hs-identifier hs-var">cc_st</span></a></span><span>
</span><span id="line-2091"></span><span>  </span><span class="annot"><span class="annottext">IORef CostCentreState -&gt; CostCentreState -&gt; TcRnIf gbl lcl ()
forall a gbl lcl. TcRef a -&gt; a -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#writeTcRef"><span class="hs-identifier hs-var">writeTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef CostCentreState
</span><a href="#local-6989586621681080706"><span class="hs-identifier hs-var">cc_st_ref</span></a></span><span> </span><span class="annot"><span class="annottext">CostCentreState
</span><a href="#local-6989586621681080703"><span class="hs-identifier hs-var">cc_st'</span></a></span><span>
</span><span id="line-2092"></span><span>  </span><span class="annot"><span class="annottext">CostCentreIndex -&gt; TcRnIf gbl lcl CostCentreIndex
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">CostCentreIndex
</span><a href="#local-6989586621681080704"><span class="hs-identifier hs-var">idx</span></a></span><span>
</span><span id="line-2093"></span></pre></body></html>