<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE BangPatterns, CPP, MagicHash, NondecreasingIndentation #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# OPTIONS_GHC -fprof-auto-top #-}</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><span id="line-5"></span><span class="hs-comment">--</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- | Main API for compiling plain Haskell source code.</span><span>
</span><span id="line-7"></span><span class="hs-comment">--</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- This module implements compilation of a Haskell source. It is</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- /not/ concerned with preprocessing of source files; this is handled</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- in &quot;GHC.Driver.Pipeline&quot;</span><span>
</span><span id="line-11"></span><span class="hs-comment">--</span><span>
</span><span id="line-12"></span><span class="hs-comment">-- There are various entry points depending on what mode we're in:</span><span>
</span><span id="line-13"></span><span class="hs-comment">-- &quot;batch&quot; mode (@--make@), &quot;one-shot&quot; mode (@-c@, @-S@ etc.), and</span><span>
</span><span id="line-14"></span><span class="hs-comment">-- &quot;interactive&quot; mode (GHCi). There are also entry points for</span><span>
</span><span id="line-15"></span><span class="hs-comment">-- individual passes: parsing, typechecking/renaming, desugaring, and</span><span>
</span><span id="line-16"></span><span class="hs-comment">-- simplification.</span><span>
</span><span id="line-17"></span><span class="hs-comment">--</span><span>
</span><span id="line-18"></span><span class="hs-comment">-- All the functions here take an 'HscEnv' as a parameter, but none of</span><span>
</span><span id="line-19"></span><span class="hs-comment">-- them return a new one: 'HscEnv' is treated as an immutable value</span><span>
</span><span id="line-20"></span><span class="hs-comment">-- from here on in (although it has mutable components, for the</span><span>
</span><span id="line-21"></span><span class="hs-comment">-- caches).</span><span>
</span><span id="line-22"></span><span class="hs-comment">--</span><span>
</span><span id="line-23"></span><span class="hs-comment">-- We use the Hsc monad to deal with warning messages consistently:</span><span>
</span><span id="line-24"></span><span class="hs-comment">-- specifically, while executing within an Hsc monad, warnings are</span><span>
</span><span id="line-25"></span><span class="hs-comment">-- collected. When a Hsc monad returns to an IO monad, the</span><span>
</span><span id="line-26"></span><span class="hs-comment">-- warnings are printed, or compilation aborts if the @-Werror@</span><span>
</span><span id="line-27"></span><span class="hs-comment">-- flag is enabled.</span><span>
</span><span id="line-28"></span><span class="hs-comment">--</span><span>
</span><span id="line-29"></span><span class="hs-comment">-- (c) The GRASP/AQUA Project, Glasgow University, 1993-2000</span><span>
</span><span id="line-30"></span><span class="hs-comment">--</span><span>
</span><span id="line-31"></span><span class="hs-comment">-------------------------------------------------------------------------------</span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">GHC.Driver.Main</span><span>
</span><span id="line-34"></span><span>    </span><span class="hs-special">(</span><span>
</span><span id="line-35"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Making an HscEnv</span></span><span>
</span><span id="line-36"></span><span>      </span><span class="annot"><a href="GHC.Driver.Main.html#newHscEnv"><span class="hs-identifier">newHscEnv</span></a></span><span>
</span><span id="line-37"></span><span>
</span><span id="line-38"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Compiling complete source files</span></span><span>
</span><span id="line-39"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#Messager"><span class="hs-identifier">Messager</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#batchMsg"><span class="hs-identifier">batchMsg</span></a></span><span>
</span><span id="line-40"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscStatus"><span class="hs-identifier">HscStatus</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscIncrementalCompile"><span class="hs-identifier">hscIncrementalCompile</span></a></span><span>
</span><span id="line-42"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#initModDetails"><span class="hs-identifier">initModDetails</span></a></span><span>
</span><span id="line-43"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscMaybeWriteIface"><span class="hs-identifier">hscMaybeWriteIface</span></a></span><span>
</span><span id="line-44"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscCompileCmmFile"><span class="hs-identifier">hscCompileCmmFile</span></a></span><span>
</span><span id="line-45"></span><span>
</span><span id="line-46"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscGenHardCode"><span class="hs-identifier">hscGenHardCode</span></a></span><span>
</span><span id="line-47"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscInteractive"><span class="hs-identifier">hscInteractive</span></a></span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Running passes separately</span></span><span>
</span><span id="line-50"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscParse"><span class="hs-identifier">hscParse</span></a></span><span>
</span><span id="line-51"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscTypecheckRename"><span class="hs-identifier">hscTypecheckRename</span></a></span><span>
</span><span id="line-52"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscDesugar"><span class="hs-identifier">hscDesugar</span></a></span><span>
</span><span id="line-53"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#makeSimpleDetails"><span class="hs-identifier">makeSimpleDetails</span></a></span><span>
</span><span id="line-54"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscSimplify"><span class="hs-identifier">hscSimplify</span></a></span><span> </span><span class="hs-comment">-- ToDo, shouldn't really export this</span><span>
</span><span id="line-55"></span><span>
</span><span id="line-56"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Safe Haskell</span></span><span>
</span><span id="line-57"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscCheckSafe"><span class="hs-identifier">hscCheckSafe</span></a></span><span>
</span><span id="line-58"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscGetSafe"><span class="hs-identifier">hscGetSafe</span></a></span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Support for interactive evaluation</span></span><span>
</span><span id="line-61"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscParseIdentifier"><span class="hs-identifier">hscParseIdentifier</span></a></span><span>
</span><span id="line-62"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscTcRcLookupName"><span class="hs-identifier">hscTcRcLookupName</span></a></span><span>
</span><span id="line-63"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscTcRnGetInfo"><span class="hs-identifier">hscTcRnGetInfo</span></a></span><span>
</span><span id="line-64"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscIsGHCiMonad"><span class="hs-identifier">hscIsGHCiMonad</span></a></span><span>
</span><span id="line-65"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscGetModuleInterface"><span class="hs-identifier">hscGetModuleInterface</span></a></span><span>
</span><span id="line-66"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscRnImportDecls"><span class="hs-identifier">hscRnImportDecls</span></a></span><span>
</span><span id="line-67"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscTcRnLookupRdrName"><span class="hs-identifier">hscTcRnLookupRdrName</span></a></span><span>
</span><span id="line-68"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscStmt"><span class="hs-identifier">hscStmt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscParseStmtWithLocation"><span class="hs-identifier">hscParseStmtWithLocation</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscStmtWithLocation"><span class="hs-identifier">hscStmtWithLocation</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscParsedStmt"><span class="hs-identifier">hscParsedStmt</span></a></span><span>
</span><span id="line-69"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscDecls"><span class="hs-identifier">hscDecls</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscParseDeclsWithLocation"><span class="hs-identifier">hscParseDeclsWithLocation</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscDeclsWithLocation"><span class="hs-identifier">hscDeclsWithLocation</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscParsedDecls"><span class="hs-identifier">hscParsedDecls</span></a></span><span>
</span><span id="line-70"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscTcExpr"><span class="hs-identifier">hscTcExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#TcRnExprMode"><span class="hs-identifier">TcRnExprMode</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscImport"><span class="hs-identifier">hscImport</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscKcType"><span class="hs-identifier">hscKcType</span></a></span><span>
</span><span id="line-71"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscParseExpr"><span class="hs-identifier">hscParseExpr</span></a></span><span>
</span><span id="line-72"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscParseType"><span class="hs-identifier">hscParseType</span></a></span><span>
</span><span id="line-73"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscCompileCoreExpr"><span class="hs-identifier">hscCompileCoreExpr</span></a></span><span>
</span><span id="line-74"></span><span>    </span><span class="annot"><span class="hs-comment">-- * Low-level exports for hooks</span></span><span>
</span><span id="line-75"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscCompileCoreExpr%27"><span class="hs-identifier">hscCompileCoreExpr'</span></a></span><span>
</span><span id="line-76"></span><span>      </span><span class="hs-comment">-- We want to make sure that we export enough to be able to redefine</span><span>
</span><span id="line-77"></span><span>      </span><span class="hs-comment">-- hsc_typecheck in client code</span><span>
</span><span id="line-78"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscParse%27"><span class="hs-identifier">hscParse'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscSimplify%27"><span class="hs-identifier">hscSimplify'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscDesugar%27"><span class="hs-identifier">hscDesugar'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#tcRnModule%27"><span class="hs-identifier">tcRnModule'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#doCodeGen"><span class="hs-identifier">doCodeGen</span></a></span><span>
</span><span id="line-79"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#getHscEnv"><span class="hs-identifier">getHscEnv</span></a></span><span>
</span><span id="line-80"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscSimpleIface%27"><span class="hs-identifier">hscSimpleIface'</span></a></span><span>
</span><span id="line-81"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#oneShotMsg"><span class="hs-identifier">oneShotMsg</span></a></span><span>
</span><span id="line-82"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#dumpIfaceStats"><span class="hs-identifier">dumpIfaceStats</span></a></span><span>
</span><span id="line-83"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#ioMsgMaybe"><span class="hs-identifier">ioMsgMaybe</span></a></span><span>
</span><span id="line-84"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#showModuleIndex"><span class="hs-identifier">showModuleIndex</span></a></span><span>
</span><span id="line-85"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#hscAddSptEntries"><span class="hs-identifier">hscAddSptEntries</span></a></span><span>
</span><span id="line-86"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-87"></span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base/src/Data.Data.html#"><span class="hs-identifier">Data.Data</span></a></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/Data.Data.html#Fixity"><span class="hs-identifier">Fixity</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">TyCon</span></span><span class="hs-special">)</span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base/src/Data.Maybe.html#"><span class="hs-identifier">Data.Maybe</span></a></span><span>       </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../base/src/Data.Maybe.html#fromJust"><span class="hs-identifier">fromJust</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.html"><span class="hs-identifier">GHC.Types.Id</span></a></span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html"><span class="hs-identifier">GHC.Runtime.Interpreter</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html#addSptEntry"><span class="hs-identifier">addSptEntry</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../ghci/src/GHCi.RemoteTypes.html#"><span class="hs-identifier">GHCi.RemoteTypes</span></a></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../ghci/src/GHCi.RemoteTypes.html#ForeignHValue"><span class="hs-identifier">ForeignHValue</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.CoreToByteCode.html"><span class="hs-identifier">GHC.CoreToByteCode</span></a></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.CoreToByteCode.html#byteCodeGen"><span class="hs-identifier">byteCodeGen</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.CoreToByteCode.html#coreExprToBCOs"><span class="hs-identifier">coreExprToBCOs</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Runtime.Linker.html"><span class="hs-identifier">GHC.Runtime.Linker</span></a></span><span>
</span><span id="line-97"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Tidy.html"><span class="hs-identifier">GHC.Core.Tidy</span></a></span><span>           </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.Tidy.html#tidyExpr"><span class="hs-identifier">tidyExpr</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-98"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Type.html"><span class="hs-identifier">GHC.Core.Type</span></a></span><span>           </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier">Kind</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-99"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Lint.html"><span class="hs-identifier">GHC.Core.Lint</span></a></span><span>           </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.Lint.html#lintInteractiveExpr"><span class="hs-identifier">lintInteractiveExpr</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html"><span class="hs-identifier">GHC.Types.Var.Env</span></a></span><span>       </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#emptyTidyEnv"><span class="hs-identifier">emptyTidyEnv</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-101"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-102"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.ConLike.html"><span class="hs-identifier">GHC.Core.ConLike</span></a></span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Parser.Annotation.html"><span class="hs-identifier">GHC.Parser.Annotation</span></a></span><span>
</span><span id="line-105"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.html"><span class="hs-identifier">GHC.Unit.Module</span></a></span><span>
</span><span id="line-106"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.State.html"><span class="hs-identifier">GHC.Unit.State</span></a></span><span>
</span><span id="line-107"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html"><span class="hs-identifier">GHC.Types.Name.Reader</span></a></span><span>
</span><span id="line-108"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Hs.html"><span class="hs-identifier">GHC.Hs</span></a></span><span>
</span><span id="line-109"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Hs.Dump.html"><span class="hs-identifier">GHC.Hs.Dump</span></a></span><span>
</span><span id="line-110"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.html"><span class="hs-identifier">GHC.Core</span></a></span><span>
</span><span id="line-111"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.StringBuffer.html"><span class="hs-identifier">GHC.Data.StringBuffer</span></a></span><span>
</span><span id="line-112"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Parser.html"><span class="hs-identifier">GHC.Parser</span></a></span><span>
</span><span id="line-113"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Parser.Lexer.html"><span class="hs-identifier">GHC.Parser.Lexer</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Lexer</span></span><span>
</span><span id="line-114"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html"><span class="hs-identifier">GHC.Types.SrcLoc</span></a></span><span>
</span><span id="line-115"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html"><span class="hs-identifier">GHC.Tc.Module</span></a></span><span>
</span><span id="line-116"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.IfaceToCore.html"><span class="hs-identifier">GHC.IfaceToCore</span></a></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.IfaceToCore.html#typecheckIface"><span class="hs-identifier">typecheckIface</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-117"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html"><span class="hs-identifier">GHC.Tc.Utils.Monad</span></a></span><span>
</span><span id="line-118"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Zonk.html"><span class="hs-identifier">GHC.Tc.Utils.Zonk</span></a></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Zonk.html#ZonkFlexi"><span class="hs-identifier">ZonkFlexi</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.Zonk.html#DefaultFlexi"><span class="hs-identifier">DefaultFlexi</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-119"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Cache.html"><span class="hs-identifier">GHC.Types.Name.Cache</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Name.Cache.html#initNameCache"><span class="hs-identifier">initNameCache</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-120"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Utils.html"><span class="hs-identifier">GHC.Builtin.Utils</span></a></span><span>
</span><span id="line-121"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Opt.Pipeline.html"><span class="hs-identifier">GHC.Core.Opt.Pipeline</span></a></span><span>
</span><span id="line-122"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.HsToCore.html"><span class="hs-identifier">GHC.HsToCore</span></a></span><span>
</span><span id="line-123"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Iface.Load.html"><span class="hs-identifier">GHC.Iface.Load</span></a></span><span>   </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Iface.Load.html#ifaceStats"><span class="hs-identifier">ifaceStats</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Iface.Load.html#initExternalPackageState"><span class="hs-identifier">initExternalPackageState</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Iface.Load.html#writeIface"><span class="hs-identifier">writeIface</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-124"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Iface.Make.html"><span class="hs-identifier">GHC.Iface.Make</span></a></span><span>
</span><span id="line-125"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Iface.Recomp.html"><span class="hs-identifier">GHC.Iface.Recomp</span></a></span><span>
</span><span id="line-126"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Iface.Tidy.html"><span class="hs-identifier">GHC.Iface.Tidy</span></a></span><span>
</span><span id="line-127"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.CoreToStg.Prep.html"><span class="hs-identifier">GHC.CoreToStg.Prep</span></a></span><span>
</span><span id="line-128"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.CoreToStg.html"><span class="hs-identifier">GHC.CoreToStg</span></a></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.CoreToStg.html#coreToStg"><span class="hs-identifier">coreToStg</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-129"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Stg.Syntax.html"><span class="hs-identifier">GHC.Stg.Syntax</span></a></span><span>
</span><span id="line-130"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Stg.FVs.html"><span class="hs-identifier">GHC.Stg.FVs</span></a></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Stg.FVs.html#annTopBindingsFreeVars"><span class="hs-identifier">annTopBindingsFreeVars</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-131"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Stg.Pipeline.html"><span class="hs-identifier">GHC.Stg.Pipeline</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Stg.Pipeline.html#stg2stg"><span class="hs-identifier">stg2stg</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.StgToCmm.html"><span class="hs-identifier">GHC.StgToCmm</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">StgToCmm</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.StgToCmm.html#codeGen"><span class="hs-identifier">codeGen</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-133"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.CostCentre.html"><span class="hs-identifier">GHC.Types.CostCentre</span></a></span><span>
</span><span id="line-134"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html"><span class="hs-identifier">GHC.Core.TyCon</span></a></span><span>
</span><span id="line-135"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.html"><span class="hs-identifier">GHC.Types.Name</span></a></span><span>
</span><span id="line-136"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.html"><span class="hs-identifier">GHC.Cmm</span></a></span><span>
</span><span id="line-137"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Parser.html"><span class="hs-identifier">GHC.Cmm.Parser</span></a></span><span>       </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Cmm.Parser.html#parseCmmFile"><span class="hs-identifier">parseCmmFile</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-138"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.Build.html"><span class="hs-identifier">GHC.Cmm.Info.Build</span></a></span><span>
</span><span id="line-139"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Pipeline.html"><span class="hs-identifier">GHC.Cmm.Pipeline</span></a></span><span>
</span><span id="line-140"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Cmm.Info.html"><span class="hs-identifier">GHC.Cmm.Info</span></a></span><span>
</span><span id="line-141"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.CodeOutput.html"><span class="hs-identifier">GHC.Driver.CodeOutput</span></a></span><span>
</span><span id="line-142"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html"><span class="hs-identifier">GHC.Core.InstEnv</span></a></span><span>
</span><span id="line-143"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html"><span class="hs-identifier">GHC.Core.FamInstEnv</span></a></span><span>
</span><span id="line-144"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Fingerprint.html"><span class="hs-identifier">GHC.Utils.Fingerprint</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../base/src/GHC.Fingerprint.Type.html#Fingerprint"><span class="hs-identifier">Fingerprint</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-145"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Hooks.html"><span class="hs-identifier">GHC.Driver.Hooks</span></a></span><span>
</span><span id="line-146"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html"><span class="hs-identifier">GHC.Tc.Utils.Env</span></a></span><span>
</span><span id="line-147"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html"><span class="hs-identifier">GHC.Builtin.Names</span></a></span><span>
</span><span id="line-148"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Plugins.html"><span class="hs-identifier">GHC.Driver.Plugins</span></a></span><span>
</span><span id="line-149"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Runtime.Loader.html"><span class="hs-identifier">GHC.Runtime.Loader</span></a></span><span>   </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Runtime.Loader.html#initializePlugins"><span class="hs-identifier">initializePlugins</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-150"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Types.html"><span class="hs-identifier">GHC.StgToCmm.Types</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.StgToCmm.Types.html#CgInfos"><span class="hs-identifier">CgInfos</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Types.html#ModuleLFInfos"><span class="hs-identifier">ModuleLFInfos</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-151"></span><span>
</span><span id="line-152"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html"><span class="hs-identifier">GHC.Driver.Session</span></a></span><span>
</span><span id="line-153"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html"><span class="hs-identifier">GHC.Utils.Error</span></a></span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-156"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Env.html"><span class="hs-identifier">GHC.Types.Name.Env</span></a></span><span>
</span><span id="line-157"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Hs.Stats.html"><span class="hs-identifier">GHC.Hs.Stats</span></a></span><span>         </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Hs.Stats.html#ppSourceStats"><span class="hs-identifier">ppSourceStats</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html"><span class="hs-identifier">GHC.Driver.Types</span></a></span><span>
</span><span id="line-159"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html"><span class="hs-identifier">GHC.Data.FastString</span></a></span><span>
</span><span id="line-160"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Supply.html"><span class="hs-identifier">GHC.Types.Unique.Supply</span></a></span><span>
</span><span id="line-161"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html"><span class="hs-identifier">GHC.Data.Bag</span></a></span><span>
</span><span id="line-162"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Exception.html"><span class="hs-identifier">GHC.Utils.Exception</span></a></span><span>
</span><span id="line-163"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.Data.Stream.html"><span class="hs-identifier">GHC.Data.Stream</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Stream</span></span><span>
</span><span id="line-164"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Stream.html"><span class="hs-identifier">GHC.Data.Stream</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Stream.html#Stream"><span class="hs-identifier">Stream</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-167"></span><span>
</span><span id="line-168"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base/src/Data.List.html#"><span class="hs-identifier">Data.List</span></a></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../base/src/Data.OldList.html#nub"><span class="hs-identifier">nub</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base/src/Data.OldList.html#isPrefixOf"><span class="hs-identifier">isPrefixOf</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base/src/Data.OldList.html#partition"><span class="hs-identifier">partition</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-169"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base/src/Control.Monad.html#"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-170"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base/src/Data.IORef.html#"><span class="hs-identifier">Data.IORef</span></a></span><span>
</span><span id="line-171"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../filepath/src/System.FilePath.html#"><span class="hs-identifier">System.FilePath</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">FilePath</span></span><span>
</span><span id="line-172"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../directory/src/System.Directory.html#"><span class="hs-identifier">System.Directory</span></a></span><span>
</span><span id="line-173"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base/src/System.IO.html#"><span class="hs-identifier">System.IO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/System.IO.html#fixIO"><span class="hs-identifier">fixIO</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-174"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../containers/src/Data.Map.html#"><span class="hs-identifier">Data.Map</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">M</span></span><span>
</span><span id="line-175"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../containers/src/Data.Set.html#"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">S</span></span><span>
</span><span id="line-176"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../containers/src/Data.Set.html#"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers/src/Data.Set.Internal.html#Set"><span class="hs-identifier">Set</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-177"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base/src/Data.Functor.html#"><span class="hs-identifier">Data.Functor</span></a></span><span>
</span><span id="line-178"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../deepseq/src/Control.DeepSeq.html#"><span class="hs-identifier">Control.DeepSeq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../deepseq/src/Control.DeepSeq.html#force"><span class="hs-identifier">force</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-179"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base/src/Data.Bifunctor.html#"><span class="hs-identifier">Data.Bifunctor</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/Data.Bifunctor.html#first"><span class="hs-identifier">first</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-180"></span><span>
</span><span id="line-181"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Iface.Ext.Ast.html"><span class="hs-identifier">GHC.Iface.Ext.Ast</span></a></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Iface.Ext.Ast.html#mkHieFile"><span class="hs-identifier">mkHieFile</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-182"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Iface.Ext.Types.html"><span class="hs-identifier">GHC.Iface.Ext.Types</span></a></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Iface.Ext.Types.html#getAsts"><span class="hs-identifier">getAsts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Iface.Ext.Types.html#hie_asts"><span class="hs-identifier">hie_asts</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Iface.Ext.Types.html#hie_module"><span class="hs-identifier">hie_module</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-183"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Iface.Ext.Binary.html"><span class="hs-identifier">GHC.Iface.Ext.Binary</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Iface.Ext.Binary.html#readHieFile"><span class="hs-identifier">readHieFile</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Iface.Ext.Binary.html#writeHieFile"><span class="hs-identifier">writeHieFile</span></a></span><span> </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Iface.Ext.Binary.html#hie_file_result"><span class="hs-identifier">hie_file_result</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Iface.Env.html#NameCacheUpdater"><span class="hs-identifier">NameCacheUpdater</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-184"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Iface.Ext.Debug.html"><span class="hs-identifier">GHC.Iface.Ext.Debug</span></a></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Iface.Ext.Debug.html#diffFile"><span class="hs-identifier">diffFile</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Iface.Ext.Debug.html#validateScopes"><span class="hs-identifier">validateScopes</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-185"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base/src/Data.List.NonEmpty.html#"><span class="hs-identifier">Data.List.NonEmpty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/GHC.Base.html#NonEmpty"><span class="hs-identifier">NonEmpty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/GHC.Base.html#%3A%7C"><span class="hs-operator">(:|)</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-cpp">

#include &quot;HsVersions.h&quot;
</span><span>
</span><span id="line-189"></span><span>
</span><span id="line-190"></span><span class="hs-comment">{- **********************************************************************
%*                                                                      *
                Initialisation
%*                                                                      *
%********************************************************************* -}</span><span>
</span><span id="line-195"></span><span>
</span><span id="line-196"></span><span class="annot"><a href="GHC.Driver.Main.html#newHscEnv"><span class="hs-identifier hs-type">newHscEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-197"></span><span id="newHscEnv"><span class="annot"><span class="annottext">newHscEnv :: DynFlags -&gt; IO HscEnv
</span><a href="GHC.Driver.Main.html#newHscEnv"><span class="hs-identifier hs-var hs-var">newHscEnv</span></a></span></span><span> </span><span id="local-6989586621681072939"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072939"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-198"></span><span>    </span><span id="local-6989586621681072938"><span class="annot"><span class="annottext">IORef ExternalPackageState
</span><a href="#local-6989586621681072938"><span class="hs-identifier hs-var">eps_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExternalPackageState -&gt; IO (IORef ExternalPackageState)
forall a. a -&gt; IO (IORef a)
</span><a href="../../base/src/GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; ExternalPackageState
</span><a href="GHC.Iface.Load.html#initExternalPackageState"><span class="hs-identifier hs-var">initExternalPackageState</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072939"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-199"></span><span>    </span><span id="local-6989586621681072936"><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621681072936"><span class="hs-identifier hs-var">us</span></a></span></span><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Char -&gt; IO UniqSupply
</span><a href="GHC.Types.Unique.Supply.html#mkSplitUniqSupply"><span class="hs-identifier hs-var">mkSplitUniqSupply</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'r'</span></span><span>
</span><span id="line-200"></span><span>    </span><span id="local-6989586621681072934"><span class="annot"><span class="annottext">IORef NameCache
</span><a href="#local-6989586621681072934"><span class="hs-identifier hs-var">nc_var</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NameCache -&gt; IO (IORef NameCache)
forall a. a -&gt; IO (IORef a)
</span><a href="../../base/src/GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UniqSupply -&gt; [Name] -&gt; NameCache
</span><a href="GHC.Types.Name.Cache.html#initNameCache"><span class="hs-identifier hs-var">initNameCache</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSupply
</span><a href="#local-6989586621681072936"><span class="hs-identifier hs-var">us</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="GHC.Builtin.Utils.html#knownKeyNames"><span class="hs-identifier hs-var">knownKeyNames</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-201"></span><span>    </span><span id="local-6989586621681072932"><span class="annot"><span class="annottext">IORef (InstalledModuleEnv InstalledFindResult)
</span><a href="#local-6989586621681072932"><span class="hs-identifier hs-var">fc_var</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">InstalledModuleEnv InstalledFindResult
-&gt; IO (IORef (InstalledModuleEnv InstalledFindResult))
forall a. a -&gt; IO (IORef a)
</span><a href="../../base/src/GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a></span><span> </span><span class="annot"><span class="annottext">InstalledModuleEnv InstalledFindResult
forall a. InstalledModuleEnv a
</span><a href="GHC.Unit.Module.Env.html#emptyInstalledModuleEnv"><span class="hs-identifier hs-var">emptyInstalledModuleEnv</span></a></span><span>
</span><span id="line-202"></span><span>    </span><span id="local-6989586621681072930"><span class="annot"><span class="annottext">DynLinker
</span><a href="#local-6989586621681072930"><span class="hs-identifier hs-var">emptyDynLinker</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO DynLinker
</span><a href="GHC.Runtime.Linker.html#uninitializedLinker"><span class="hs-identifier hs-var">uninitializedLinker</span></a></span><span>
</span><span id="line-203"></span><span>    </span><span class="annot"><span class="annottext">HscEnv -&gt; IO HscEnv
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv :: DynFlags
-&gt; [Target]
-&gt; ModuleGraph
-&gt; InteractiveContext
-&gt; HomePackageTable
-&gt; IORef ExternalPackageState
-&gt; IORef NameCache
-&gt; IORef (InstalledModuleEnv InstalledFindResult)
-&gt; Maybe (Module, IORef TypeEnv)
-&gt; Maybe Interp
-&gt; DynLinker
-&gt; HscEnv
</span><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-special">{</span><span>  </span><span class="annot"><span class="annottext">hsc_dflags :: DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072939"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-204"></span><span>                  </span><span class="hs-special">,</span><span>  </span><span class="annot"><span class="annottext">hsc_targets :: [Target]
</span><a href="GHC.Driver.Types.html#hsc_targets"><span class="hs-identifier hs-var">hsc_targets</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-205"></span><span>                  </span><span class="hs-special">,</span><span>  </span><span class="annot"><span class="annottext">hsc_mod_graph :: ModuleGraph
</span><a href="GHC.Driver.Types.html#hsc_mod_graph"><span class="hs-identifier hs-var">hsc_mod_graph</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="GHC.Driver.Types.html#emptyMG"><span class="hs-identifier hs-var">emptyMG</span></a></span><span>
</span><span id="line-206"></span><span>                  </span><span class="hs-special">,</span><span>  </span><span class="annot"><span class="annottext">hsc_IC :: InteractiveContext
</span><a href="GHC.Driver.Types.html#hsc_IC"><span class="hs-identifier hs-var">hsc_IC</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; InteractiveContext
</span><a href="GHC.Driver.Types.html#emptyInteractiveContext"><span class="hs-identifier hs-var">emptyInteractiveContext</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072939"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-207"></span><span>                  </span><span class="hs-special">,</span><span>  </span><span class="annot"><span class="annottext">hsc_HPT :: HomePackageTable
</span><a href="GHC.Driver.Types.html#hsc_HPT"><span class="hs-identifier hs-var">hsc_HPT</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HomePackageTable
</span><a href="GHC.Driver.Types.html#emptyHomePackageTable"><span class="hs-identifier hs-var">emptyHomePackageTable</span></a></span><span>
</span><span id="line-208"></span><span>                  </span><span class="hs-special">,</span><span>  </span><span class="annot"><span class="annottext">hsc_EPS :: IORef ExternalPackageState
</span><a href="GHC.Driver.Types.html#hsc_EPS"><span class="hs-identifier hs-var">hsc_EPS</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef ExternalPackageState
</span><a href="#local-6989586621681072938"><span class="hs-identifier hs-var">eps_var</span></a></span><span>
</span><span id="line-209"></span><span>                  </span><span class="hs-special">,</span><span>  </span><span class="annot"><span class="annottext">hsc_NC :: IORef NameCache
</span><a href="GHC.Driver.Types.html#hsc_NC"><span class="hs-identifier hs-var">hsc_NC</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef NameCache
</span><a href="#local-6989586621681072934"><span class="hs-identifier hs-var">nc_var</span></a></span><span>
</span><span id="line-210"></span><span>                  </span><span class="hs-special">,</span><span>  </span><span class="annot"><span class="annottext">hsc_FC :: IORef (InstalledModuleEnv InstalledFindResult)
</span><a href="GHC.Driver.Types.html#hsc_FC"><span class="hs-identifier hs-var">hsc_FC</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef (InstalledModuleEnv InstalledFindResult)
</span><a href="#local-6989586621681072932"><span class="hs-identifier hs-var">fc_var</span></a></span><span>
</span><span id="line-211"></span><span>                  </span><span class="hs-special">,</span><span>  </span><span class="annot"><span class="annottext">hsc_type_env_var :: Maybe (Module, IORef TypeEnv)
</span><a href="GHC.Driver.Types.html#hsc_type_env_var"><span class="hs-identifier hs-var">hsc_type_env_var</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Module, IORef TypeEnv)
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-212"></span><span>                  </span><span class="hs-special">,</span><span>  </span><span class="annot"><span class="annottext">hsc_interp :: Maybe Interp
</span><a href="GHC.Driver.Types.html#hsc_interp"><span class="hs-identifier hs-var">hsc_interp</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Interp
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-213"></span><span>                  </span><span class="hs-special">,</span><span>  </span><span class="annot"><span class="annottext">hsc_dynLinker :: DynLinker
</span><a href="GHC.Driver.Types.html#hsc_dynLinker"><span class="hs-identifier hs-var">hsc_dynLinker</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynLinker
</span><a href="#local-6989586621681072930"><span class="hs-identifier hs-var">emptyDynLinker</span></a></span><span>
</span><span id="line-214"></span><span>                  </span><span class="hs-special">}</span><span>
</span><span id="line-215"></span><span>
</span><span id="line-216"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-217"></span><span>
</span><span id="line-218"></span><span class="annot"><a href="GHC.Driver.Main.html#getWarnings"><span class="hs-identifier hs-type">getWarnings</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#WarningMessages"><span class="hs-identifier hs-type">WarningMessages</span></a></span><span>
</span><span id="line-219"></span><span id="getWarnings"><span class="annot"><span class="annottext">getWarnings :: Hsc WarningMessages
</span><a href="GHC.Driver.Main.html#getWarnings"><span class="hs-identifier hs-var hs-var">getWarnings</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HscEnv
 -&gt; WarningMessages -&gt; IO (WarningMessages, WarningMessages))
-&gt; Hsc WarningMessages
forall a.
(HscEnv -&gt; WarningMessages -&gt; IO (a, WarningMessages)) -&gt; Hsc a
</span><a href="GHC.Driver.Types.html#Hsc"><span class="hs-identifier hs-var">Hsc</span></a></span><span> </span><span class="annot"><span class="annottext">((HscEnv
  -&gt; WarningMessages -&gt; IO (WarningMessages, WarningMessages))
 -&gt; Hsc WarningMessages)
-&gt; (HscEnv
    -&gt; WarningMessages -&gt; IO (WarningMessages, WarningMessages))
-&gt; Hsc WarningMessages
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">HscEnv
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681072911"><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681072911"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(WarningMessages, WarningMessages)
-&gt; IO (WarningMessages, WarningMessages)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681072911"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681072911"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-220"></span><span>
</span><span id="line-221"></span><span class="annot"><a href="GHC.Driver.Main.html#clearWarnings"><span class="hs-identifier hs-type">clearWarnings</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-222"></span><span id="clearWarnings"><span class="annot"><span class="annottext">clearWarnings :: Hsc ()
</span><a href="GHC.Driver.Main.html#clearWarnings"><span class="hs-identifier hs-var hs-var">clearWarnings</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HscEnv -&gt; WarningMessages -&gt; IO ((), WarningMessages)) -&gt; Hsc ()
forall a.
(HscEnv -&gt; WarningMessages -&gt; IO (a, WarningMessages)) -&gt; Hsc a
</span><a href="GHC.Driver.Types.html#Hsc"><span class="hs-identifier hs-var">Hsc</span></a></span><span> </span><span class="annot"><span class="annottext">((HscEnv -&gt; WarningMessages -&gt; IO ((), WarningMessages)) -&gt; Hsc ())
-&gt; (HscEnv -&gt; WarningMessages -&gt; IO ((), WarningMessages))
-&gt; Hsc ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">HscEnv
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">WarningMessages
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">((), WarningMessages) -&gt; IO ((), WarningMessages)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">WarningMessages
forall a. Bag a
</span><a href="GHC.Data.Bag.html#emptyBag"><span class="hs-identifier hs-var">emptyBag</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-223"></span><span>
</span><span id="line-224"></span><span class="annot"><a href="GHC.Driver.Main.html#logWarnings"><span class="hs-identifier hs-type">logWarnings</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#WarningMessages"><span class="hs-identifier hs-type">WarningMessages</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-225"></span><span id="logWarnings"><span class="annot"><span class="annottext">logWarnings :: WarningMessages -&gt; Hsc ()
</span><a href="GHC.Driver.Main.html#logWarnings"><span class="hs-identifier hs-var hs-var">logWarnings</span></a></span></span><span> </span><span id="local-6989586621681072907"><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681072907"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HscEnv -&gt; WarningMessages -&gt; IO ((), WarningMessages)) -&gt; Hsc ()
forall a.
(HscEnv -&gt; WarningMessages -&gt; IO (a, WarningMessages)) -&gt; Hsc a
</span><a href="GHC.Driver.Types.html#Hsc"><span class="hs-identifier hs-var">Hsc</span></a></span><span> </span><span class="annot"><span class="annottext">((HscEnv -&gt; WarningMessages -&gt; IO ((), WarningMessages)) -&gt; Hsc ())
-&gt; (HscEnv -&gt; WarningMessages -&gt; IO ((), WarningMessages))
-&gt; Hsc ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">HscEnv
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681072906"><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681072906"><span class="hs-identifier hs-var">w0</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">((), WarningMessages) -&gt; IO ((), WarningMessages)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681072906"><span class="hs-identifier hs-var">w0</span></a></span><span> </span><span class="annot"><span class="annottext">WarningMessages -&gt; WarningMessages -&gt; WarningMessages
forall a. Bag a -&gt; Bag a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#unionBags"><span class="hs-operator hs-var">`unionBags`</span></a></span><span> </span><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681072907"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-226"></span><span>
</span><span id="line-227"></span><span class="annot"><a href="GHC.Driver.Main.html#getHscEnv"><span class="hs-identifier hs-type">getHscEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-228"></span><span id="getHscEnv"><span class="annot"><span class="annottext">getHscEnv :: Hsc HscEnv
</span><a href="GHC.Driver.Main.html#getHscEnv"><span class="hs-identifier hs-var hs-var">getHscEnv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HscEnv -&gt; WarningMessages -&gt; IO (HscEnv, WarningMessages))
-&gt; Hsc HscEnv
forall a.
(HscEnv -&gt; WarningMessages -&gt; IO (a, WarningMessages)) -&gt; Hsc a
</span><a href="GHC.Driver.Types.html#Hsc"><span class="hs-identifier hs-var">Hsc</span></a></span><span> </span><span class="annot"><span class="annottext">((HscEnv -&gt; WarningMessages -&gt; IO (HscEnv, WarningMessages))
 -&gt; Hsc HscEnv)
-&gt; (HscEnv -&gt; WarningMessages -&gt; IO (HscEnv, WarningMessages))
-&gt; Hsc HscEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681072904"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072904"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621681072903"><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681072903"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(HscEnv, WarningMessages) -&gt; IO (HscEnv, WarningMessages)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072904"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681072903"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-229"></span><span>
</span><span id="line-230"></span><span class="annot"><a href="GHC.Driver.Main.html#handleWarnings"><span class="hs-identifier hs-type">handleWarnings</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-231"></span><span id="handleWarnings"><span class="annot"><span class="annottext">handleWarnings :: Hsc ()
</span><a href="GHC.Driver.Main.html#handleWarnings"><span class="hs-identifier hs-var hs-var">handleWarnings</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-232"></span><span>    </span><span id="local-6989586621681072901"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072901"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-233"></span><span>    </span><span id="local-6989586621681072899"><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681072899"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc WarningMessages
</span><a href="GHC.Driver.Main.html#getWarnings"><span class="hs-identifier hs-var">getWarnings</span></a></span><span>
</span><span id="line-234"></span><span>    </span><span class="annot"><span class="annottext">IO () -&gt; Hsc ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; Hsc ()) -&gt; IO () -&gt; Hsc ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; WarningMessages -&gt; IO ()
</span><a href="GHC.Driver.Types.html#printOrThrowWarnings"><span class="hs-identifier hs-var">printOrThrowWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072901"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681072899"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-235"></span><span>    </span><span class="annot"><span class="annottext">Hsc ()
</span><a href="GHC.Driver.Main.html#clearWarnings"><span class="hs-identifier hs-var">clearWarnings</span></a></span><span>
</span><span id="line-236"></span><span>
</span><span id="line-237"></span><span class="hs-comment">-- | log warning in the monad, and if there are errors then</span><span>
</span><span id="line-238"></span><span class="hs-comment">-- throw a SourceError exception.</span><span>
</span><span id="line-239"></span><span class="annot"><a href="GHC.Driver.Main.html#logWarningsReportErrors"><span class="hs-identifier hs-type">logWarningsReportErrors</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-240"></span><span id="logWarningsReportErrors"><span class="annot"><span class="annottext">logWarningsReportErrors :: (WarningMessages, WarningMessages) -&gt; Hsc ()
</span><a href="GHC.Driver.Main.html#logWarningsReportErrors"><span class="hs-identifier hs-var hs-var">logWarningsReportErrors</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681072894"><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681072894"><span class="hs-identifier hs-var">warns</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681072893"><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681072893"><span class="hs-identifier hs-var">errs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-241"></span><span>    </span><span class="annot"><span class="annottext">WarningMessages -&gt; Hsc ()
</span><a href="GHC.Driver.Main.html#logWarnings"><span class="hs-identifier hs-var">logWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681072894"><span class="hs-identifier hs-var">warns</span></a></span><span>
</span><span id="line-242"></span><span>    </span><span class="annot"><span class="annottext">IsSafeImport -&gt; Hsc () -&gt; Hsc ()
forall (f :: * -&gt; *). Applicative f =&gt; IsSafeImport -&gt; f () -&gt; f ()
</span><a href="../../base/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsSafeImport -&gt; IsSafeImport
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(IsSafeImport -&gt; IsSafeImport) -&gt; IsSafeImport -&gt; IsSafeImport
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WarningMessages -&gt; IsSafeImport
forall a. Bag a -&gt; IsSafeImport
</span><a href="GHC.Data.Bag.html#isEmptyBag"><span class="hs-identifier hs-var">isEmptyBag</span></a></span><span> </span><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681072893"><span class="hs-identifier hs-var">errs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Hsc () -&gt; Hsc ()) -&gt; Hsc () -&gt; Hsc ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WarningMessages -&gt; Hsc ()
forall (io :: * -&gt; *) a. MonadIO io =&gt; WarningMessages -&gt; io a
</span><a href="GHC.Driver.Types.html#throwErrors"><span class="hs-identifier hs-var">throwErrors</span></a></span><span> </span><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681072893"><span class="hs-identifier hs-var">errs</span></a></span><span>
</span><span id="line-243"></span><span>
</span><span id="line-244"></span><span class="hs-comment">-- | Log warnings and throw errors, assuming the messages</span><span>
</span><span id="line-245"></span><span class="hs-comment">-- contain at least one error (e.g. coming from PFailed)</span><span>
</span><span id="line-246"></span><span id="local-6989586621681073835"><span class="annot"><a href="GHC.Driver.Main.html#handleWarningsThrowErrors"><span class="hs-identifier hs-type">handleWarningsThrowErrors</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681073835"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-247"></span><span id="handleWarningsThrowErrors"><span class="annot"><span class="annottext">handleWarningsThrowErrors :: forall a. (WarningMessages, WarningMessages) -&gt; Hsc a
</span><a href="GHC.Driver.Main.html#handleWarningsThrowErrors"><span class="hs-identifier hs-var hs-var">handleWarningsThrowErrors</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681072879"><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681072879"><span class="hs-identifier hs-var">warns</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681072878"><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681072878"><span class="hs-identifier hs-var">errs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-248"></span><span>    </span><span class="annot"><span class="annottext">WarningMessages -&gt; Hsc ()
</span><a href="GHC.Driver.Main.html#logWarnings"><span class="hs-identifier hs-var">logWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681072879"><span class="hs-identifier hs-var">warns</span></a></span><span>
</span><span id="line-249"></span><span>    </span><span id="local-6989586621681072877"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072877"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-250"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681072876"><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681072876"><span class="hs-identifier hs-var">wWarns</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681072875"><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681072875"><span class="hs-identifier hs-var">wErrs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; WarningMessages -&gt; (WarningMessages, WarningMessages)
</span><a href="GHC.Utils.Error.html#warningsToMessages"><span class="hs-identifier hs-var">warningsToMessages</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072877"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">(WarningMessages -&gt; (WarningMessages, WarningMessages))
-&gt; Hsc WarningMessages -&gt; Hsc (WarningMessages, WarningMessages)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Hsc WarningMessages
</span><a href="GHC.Driver.Main.html#getWarnings"><span class="hs-identifier hs-var">getWarnings</span></a></span><span>
</span><span id="line-251"></span><span>    </span><span class="annot"><span class="annottext">IO () -&gt; Hsc ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; Hsc ()) -&gt; IO () -&gt; Hsc ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; WarningMessages -&gt; IO ()
</span><a href="GHC.Utils.Error.html#printBagOfErrors"><span class="hs-identifier hs-var">printBagOfErrors</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072877"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681072876"><span class="hs-identifier hs-var">wWarns</span></a></span><span>
</span><span id="line-252"></span><span>    </span><span class="annot"><span class="annottext">WarningMessages -&gt; Hsc a
forall (io :: * -&gt; *) a. MonadIO io =&gt; WarningMessages -&gt; io a
</span><a href="GHC.Driver.Types.html#throwErrors"><span class="hs-identifier hs-var">throwErrors</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WarningMessages -&gt; WarningMessages -&gt; WarningMessages
forall a. Bag a -&gt; Bag a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#unionBags"><span class="hs-identifier hs-var">unionBags</span></a></span><span> </span><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681072878"><span class="hs-identifier hs-var">errs</span></a></span><span> </span><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681072875"><span class="hs-identifier hs-var">wErrs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-253"></span><span>
</span><span id="line-254"></span><span class="hs-comment">-- | Deal with errors and warnings returned by a compilation step</span><span>
</span><span id="line-255"></span><span class="hs-comment">--</span><span>
</span><span id="line-256"></span><span class="hs-comment">-- In order to reduce dependencies to other parts of the compiler, functions</span><span>
</span><span id="line-257"></span><span class="hs-comment">-- outside the &quot;main&quot; parts of GHC return warnings and errors as a parameter</span><span>
</span><span id="line-258"></span><span class="hs-comment">-- and signal success via by wrapping the result in a 'Maybe' type. This</span><span>
</span><span id="line-259"></span><span class="hs-comment">-- function logs the returned warnings and propagates errors as exceptions</span><span>
</span><span id="line-260"></span><span class="hs-comment">-- (of type 'SourceError').</span><span>
</span><span id="line-261"></span><span class="hs-comment">--</span><span>
</span><span id="line-262"></span><span class="hs-comment">-- This function assumes the following invariants:</span><span>
</span><span id="line-263"></span><span class="hs-comment">--</span><span>
</span><span id="line-264"></span><span class="hs-comment">--  1. If the second result indicates success (is of the form 'Just x'),</span><span>
</span><span id="line-265"></span><span class="hs-comment">--     there must be no error messages in the first result.</span><span>
</span><span id="line-266"></span><span class="hs-comment">--</span><span>
</span><span id="line-267"></span><span class="hs-comment">--  2. If there are no error messages, but the second result indicates failure</span><span>
</span><span id="line-268"></span><span class="hs-comment">--     there should be warnings in the first result. That is, if the action</span><span>
</span><span id="line-269"></span><span class="hs-comment">--     failed, it must have been due to the warnings (i.e., @-Werror@).</span><span>
</span><span id="line-270"></span><span id="local-6989586621681073830"><span class="annot"><a href="GHC.Driver.Main.html#ioMsgMaybe"><span class="hs-identifier hs-type">ioMsgMaybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681073830"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681073830"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-271"></span><span id="ioMsgMaybe"><span class="annot"><span class="annottext">ioMsgMaybe :: forall a. IO ((WarningMessages, WarningMessages), Maybe a) -&gt; Hsc a
</span><a href="GHC.Driver.Main.html#ioMsgMaybe"><span class="hs-identifier hs-var hs-var">ioMsgMaybe</span></a></span></span><span> </span><span id="local-6989586621681072866"><span class="annot"><span class="annottext">IO ((WarningMessages, WarningMessages), Maybe a)
</span><a href="#local-6989586621681072866"><span class="hs-identifier hs-var">ioA</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-272"></span><span>    </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621681072865"><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681072865"><span class="hs-identifier hs-var">warns</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681072864"><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681072864"><span class="hs-identifier hs-var">errs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621681072863"><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621681072863"><span class="hs-identifier hs-var">mb_r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ((WarningMessages, WarningMessages), Maybe a)
-&gt; Hsc ((WarningMessages, WarningMessages), Maybe a)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">IO ((WarningMessages, WarningMessages), Maybe a)
</span><a href="#local-6989586621681072866"><span class="hs-identifier hs-var">ioA</span></a></span><span>
</span><span id="line-273"></span><span>    </span><span class="annot"><span class="annottext">WarningMessages -&gt; Hsc ()
</span><a href="GHC.Driver.Main.html#logWarnings"><span class="hs-identifier hs-var">logWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681072865"><span class="hs-identifier hs-var">warns</span></a></span><span>
</span><span id="line-274"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621681072863"><span class="hs-identifier hs-var">mb_r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-275"></span><span>        </span><span class="annot"><span class="annottext">Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WarningMessages -&gt; Hsc a
forall (io :: * -&gt; *) a. MonadIO io =&gt; WarningMessages -&gt; io a
</span><a href="GHC.Driver.Types.html#throwErrors"><span class="hs-identifier hs-var">throwErrors</span></a></span><span> </span><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681072864"><span class="hs-identifier hs-var">errs</span></a></span><span>
</span><span id="line-276"></span><span>        </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681072862"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681072862"><span class="hs-identifier hs-var">r</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isEmptyBag</span><span> </span><span class="hs-identifier">errs</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">r</span><span>
</span><span id="line-277"></span><span>
</span><span id="line-278"></span><span class="hs-comment">-- | like ioMsgMaybe, except that we ignore error messages and return</span><span>
</span><span id="line-279"></span><span class="hs-comment">-- 'Nothing' instead.</span><span>
</span><span id="line-280"></span><span id="local-6989586621681073827"><span class="annot"><a href="GHC.Driver.Main.html#ioMsgMaybe%27"><span class="hs-identifier hs-type">ioMsgMaybe'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681073827"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681073827"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-281"></span><span id="ioMsgMaybe%27"><span class="annot"><span class="annottext">ioMsgMaybe' :: forall a.
IO ((WarningMessages, WarningMessages), Maybe a) -&gt; Hsc (Maybe a)
</span><a href="GHC.Driver.Main.html#ioMsgMaybe%27"><span class="hs-identifier hs-var hs-var">ioMsgMaybe'</span></a></span></span><span> </span><span id="local-6989586621681072853"><span class="annot"><span class="annottext">IO ((WarningMessages, WarningMessages), Maybe a)
</span><a href="#local-6989586621681072853"><span class="hs-identifier hs-var">ioA</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-282"></span><span>    </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621681072852"><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681072852"><span class="hs-identifier hs-var">warns</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681072851"><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681072851"><span class="hs-identifier hs-var">_errs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621681072850"><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621681072850"><span class="hs-identifier hs-var">mb_r</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ((WarningMessages, WarningMessages), Maybe a)
-&gt; Hsc ((WarningMessages, WarningMessages), Maybe a)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ((WarningMessages, WarningMessages), Maybe a)
 -&gt; Hsc ((WarningMessages, WarningMessages), Maybe a))
-&gt; IO ((WarningMessages, WarningMessages), Maybe a)
-&gt; Hsc ((WarningMessages, WarningMessages), Maybe a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">IO ((WarningMessages, WarningMessages), Maybe a)
</span><a href="#local-6989586621681072853"><span class="hs-identifier hs-var">ioA</span></a></span><span>
</span><span id="line-283"></span><span>    </span><span class="annot"><span class="annottext">WarningMessages -&gt; Hsc ()
</span><a href="GHC.Driver.Main.html#logWarnings"><span class="hs-identifier hs-var">logWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681072852"><span class="hs-identifier hs-var">warns</span></a></span><span>
</span><span id="line-284"></span><span>    </span><span class="annot"><span class="annottext">Maybe a -&gt; Hsc (Maybe a)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621681072850"><span class="hs-identifier hs-var">mb_r</span></a></span><span>
</span><span id="line-285"></span><span>
</span><span id="line-286"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-287"></span><span class="hs-comment">-- | Lookup things in the compiler's environment</span><span>
</span><span id="line-288"></span><span>
</span><span id="line-289"></span><span class="annot"><a href="GHC.Driver.Main.html#hscTcRnLookupRdrName"><span class="hs-identifier hs-type">hscTcRnLookupRdrName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-290"></span><span id="hscTcRnLookupRdrName"><span class="annot"><span class="annottext">hscTcRnLookupRdrName :: HscEnv -&gt; Located RdrName -&gt; IO [Name]
</span><a href="GHC.Driver.Main.html#hscTcRnLookupRdrName"><span class="hs-identifier hs-var hs-var">hscTcRnLookupRdrName</span></a></span></span><span> </span><span id="local-6989586621681072849"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072849"><span class="hs-identifier hs-var">hsc_env0</span></a></span></span><span> </span><span id="local-6989586621681072848"><span class="annot"><span class="annottext">Located RdrName
</span><a href="#local-6989586621681072848"><span class="hs-identifier hs-var">rdr_name</span></a></span></span><span>
</span><span id="line-291"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Hsc [Name] -&gt; IO [Name]
forall a. HscEnv -&gt; Hsc a -&gt; IO a
</span><a href="GHC.Driver.Types.html#runInteractiveHsc"><span class="hs-identifier hs-var">runInteractiveHsc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072849"><span class="hs-identifier hs-var">hsc_env0</span></a></span><span> </span><span class="annot"><span class="annottext">(Hsc [Name] -&gt; IO [Name]) -&gt; Hsc [Name] -&gt; IO [Name]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-292"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681072846"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072846"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc HscEnv
</span><a href="GHC.Driver.Main.html#getHscEnv"><span class="hs-identifier hs-var">getHscEnv</span></a></span><span>
</span><span id="line-293"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">IO ((WarningMessages, WarningMessages), Maybe [Name]) -&gt; Hsc [Name]
forall a. IO ((WarningMessages, WarningMessages), Maybe a) -&gt; Hsc a
</span><a href="GHC.Driver.Main.html#ioMsgMaybe"><span class="hs-identifier hs-var">ioMsgMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ((WarningMessages, WarningMessages), Maybe [Name])
 -&gt; Hsc [Name])
-&gt; IO ((WarningMessages, WarningMessages), Maybe [Name])
-&gt; Hsc [Name]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; Located RdrName
-&gt; IO ((WarningMessages, WarningMessages), Maybe [Name])
</span><a href="GHC.Tc.Module.html#tcRnLookupRdrName"><span class="hs-identifier hs-var">tcRnLookupRdrName</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072846"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">Located RdrName
</span><a href="#local-6989586621681072848"><span class="hs-identifier hs-var">rdr_name</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-294"></span><span>
</span><span id="line-295"></span><span class="annot"><a href="GHC.Driver.Main.html#hscTcRcLookupName"><span class="hs-identifier hs-type">hscTcRcLookupName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-296"></span><span id="hscTcRcLookupName"><span class="annot"><span class="annottext">hscTcRcLookupName :: HscEnv -&gt; Name -&gt; IO (Maybe TyThing)
</span><a href="GHC.Driver.Main.html#hscTcRcLookupName"><span class="hs-identifier hs-var hs-var">hscTcRcLookupName</span></a></span></span><span> </span><span id="local-6989586621681072844"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072844"><span class="hs-identifier hs-var">hsc_env0</span></a></span></span><span> </span><span id="local-6989586621681072843"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681072843"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Hsc (Maybe TyThing) -&gt; IO (Maybe TyThing)
forall a. HscEnv -&gt; Hsc a -&gt; IO a
</span><a href="GHC.Driver.Types.html#runInteractiveHsc"><span class="hs-identifier hs-var">runInteractiveHsc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072844"><span class="hs-identifier hs-var">hsc_env0</span></a></span><span> </span><span class="annot"><span class="annottext">(Hsc (Maybe TyThing) -&gt; IO (Maybe TyThing))
-&gt; Hsc (Maybe TyThing) -&gt; IO (Maybe TyThing)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-297"></span><span>  </span><span id="local-6989586621681072842"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072842"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc HscEnv
</span><a href="GHC.Driver.Main.html#getHscEnv"><span class="hs-identifier hs-var">getHscEnv</span></a></span><span>
</span><span id="line-298"></span><span>  </span><span class="annot"><span class="annottext">IO ((WarningMessages, WarningMessages), Maybe TyThing)
-&gt; Hsc (Maybe TyThing)
forall a.
IO ((WarningMessages, WarningMessages), Maybe a) -&gt; Hsc (Maybe a)
</span><a href="GHC.Driver.Main.html#ioMsgMaybe%27"><span class="hs-identifier hs-var">ioMsgMaybe'</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ((WarningMessages, WarningMessages), Maybe TyThing)
 -&gt; Hsc (Maybe TyThing))
-&gt; IO ((WarningMessages, WarningMessages), Maybe TyThing)
-&gt; Hsc (Maybe TyThing)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; Name -&gt; IO ((WarningMessages, WarningMessages), Maybe TyThing)
</span><a href="GHC.Tc.Module.html#tcRnLookupName"><span class="hs-identifier hs-var">tcRnLookupName</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072842"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681072843"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-299"></span><span>      </span><span class="hs-comment">-- ignore errors: the only error we're likely to get is</span><span>
</span><span id="line-300"></span><span>      </span><span class="hs-comment">-- &quot;name not found&quot;, and the Maybe in the return type</span><span>
</span><span id="line-301"></span><span>      </span><span class="hs-comment">-- is used to indicate that.</span><span>
</span><span id="line-302"></span><span>
</span><span id="line-303"></span><span class="annot"><a href="GHC.Driver.Main.html#hscTcRnGetInfo"><span class="hs-identifier hs-type">hscTcRnGetInfo</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-304"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#Fixity"><span class="hs-identifier hs-type">Fixity</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.FamInstEnv.html#FamInst"><span class="hs-identifier hs-type">FamInst</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-305"></span><span id="hscTcRnGetInfo"><span class="annot"><span class="annottext">hscTcRnGetInfo :: HscEnv
-&gt; Name -&gt; IO (Maybe (TyThing, Fixity, [ClsInst], [FamInst], SDoc))
</span><a href="GHC.Driver.Main.html#hscTcRnGetInfo"><span class="hs-identifier hs-var hs-var">hscTcRnGetInfo</span></a></span></span><span> </span><span id="local-6989586621681072840"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072840"><span class="hs-identifier hs-var">hsc_env0</span></a></span></span><span> </span><span id="local-6989586621681072839"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681072839"><span class="hs-identifier hs-var">name</span></a></span></span><span>
</span><span id="line-306"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; Hsc (Maybe (TyThing, Fixity, [ClsInst], [FamInst], SDoc))
-&gt; IO (Maybe (TyThing, Fixity, [ClsInst], [FamInst], SDoc))
forall a. HscEnv -&gt; Hsc a -&gt; IO a
</span><a href="GHC.Driver.Types.html#runInteractiveHsc"><span class="hs-identifier hs-var">runInteractiveHsc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072840"><span class="hs-identifier hs-var">hsc_env0</span></a></span><span> </span><span class="annot"><span class="annottext">(Hsc (Maybe (TyThing, Fixity, [ClsInst], [FamInst], SDoc))
 -&gt; IO (Maybe (TyThing, Fixity, [ClsInst], [FamInst], SDoc)))
-&gt; Hsc (Maybe (TyThing, Fixity, [ClsInst], [FamInst], SDoc))
-&gt; IO (Maybe (TyThing, Fixity, [ClsInst], [FamInst], SDoc))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-307"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681072838"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072838"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc HscEnv
</span><a href="GHC.Driver.Main.html#getHscEnv"><span class="hs-identifier hs-var">getHscEnv</span></a></span><span>
</span><span id="line-308"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">IO
  ((WarningMessages, WarningMessages),
   Maybe (TyThing, Fixity, [ClsInst], [FamInst], SDoc))
-&gt; Hsc (Maybe (TyThing, Fixity, [ClsInst], [FamInst], SDoc))
forall a.
IO ((WarningMessages, WarningMessages), Maybe a) -&gt; Hsc (Maybe a)
</span><a href="GHC.Driver.Main.html#ioMsgMaybe%27"><span class="hs-identifier hs-var">ioMsgMaybe'</span></a></span><span> </span><span class="annot"><span class="annottext">(IO
   ((WarningMessages, WarningMessages),
    Maybe (TyThing, Fixity, [ClsInst], [FamInst], SDoc))
 -&gt; Hsc (Maybe (TyThing, Fixity, [ClsInst], [FamInst], SDoc)))
-&gt; IO
     ((WarningMessages, WarningMessages),
      Maybe (TyThing, Fixity, [ClsInst], [FamInst], SDoc))
-&gt; Hsc (Maybe (TyThing, Fixity, [ClsInst], [FamInst], SDoc))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; Name
-&gt; IO
     ((WarningMessages, WarningMessages),
      Maybe (TyThing, Fixity, [ClsInst], [FamInst], SDoc))
</span><a href="GHC.Tc.Module.html#tcRnGetInfo"><span class="hs-identifier hs-var">tcRnGetInfo</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072838"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681072839"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-309"></span><span>
</span><span id="line-310"></span><span class="annot"><a href="GHC.Driver.Main.html#hscIsGHCiMonad"><span class="hs-identifier hs-type">hscIsGHCiMonad</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-311"></span><span id="hscIsGHCiMonad"><span class="annot"><span class="annottext">hscIsGHCiMonad :: HscEnv -&gt; String -&gt; IO Name
</span><a href="GHC.Driver.Main.html#hscIsGHCiMonad"><span class="hs-identifier hs-var hs-var">hscIsGHCiMonad</span></a></span></span><span> </span><span id="local-6989586621681072836"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072836"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681072835"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681072835"><span class="hs-identifier hs-var">name</span></a></span></span><span>
</span><span id="line-312"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Hsc Name -&gt; IO Name
forall a. HscEnv -&gt; Hsc a -&gt; IO a
</span><a href="GHC.Driver.Types.html#runHsc"><span class="hs-identifier hs-var">runHsc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072836"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(Hsc Name -&gt; IO Name) -&gt; Hsc Name -&gt; IO Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">IO ((WarningMessages, WarningMessages), Maybe Name) -&gt; Hsc Name
forall a. IO ((WarningMessages, WarningMessages), Maybe a) -&gt; Hsc a
</span><a href="GHC.Driver.Main.html#ioMsgMaybe"><span class="hs-identifier hs-var">ioMsgMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ((WarningMessages, WarningMessages), Maybe Name) -&gt; Hsc Name)
-&gt; IO ((WarningMessages, WarningMessages), Maybe Name) -&gt; Hsc Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; String -&gt; IO ((WarningMessages, WarningMessages), Maybe Name)
</span><a href="GHC.Tc.Module.html#isGHCiMonad"><span class="hs-identifier hs-var">isGHCiMonad</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072836"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681072835"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-313"></span><span>
</span><span id="line-314"></span><span class="annot"><a href="GHC.Driver.Main.html#hscGetModuleInterface"><span class="hs-identifier hs-type">hscGetModuleInterface</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a></span><span>
</span><span id="line-315"></span><span id="hscGetModuleInterface"><span class="annot"><span class="annottext">hscGetModuleInterface :: HscEnv -&gt; Module -&gt; IO ModIface
</span><a href="GHC.Driver.Main.html#hscGetModuleInterface"><span class="hs-identifier hs-var hs-var">hscGetModuleInterface</span></a></span></span><span> </span><span id="local-6989586621681072832"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072832"><span class="hs-identifier hs-var">hsc_env0</span></a></span></span><span> </span><span id="local-6989586621681072831"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681072831"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Hsc ModIface -&gt; IO ModIface
forall a. HscEnv -&gt; Hsc a -&gt; IO a
</span><a href="GHC.Driver.Types.html#runInteractiveHsc"><span class="hs-identifier hs-var">runInteractiveHsc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072832"><span class="hs-identifier hs-var">hsc_env0</span></a></span><span> </span><span class="annot"><span class="annottext">(Hsc ModIface -&gt; IO ModIface) -&gt; Hsc ModIface -&gt; IO ModIface
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-316"></span><span>  </span><span id="local-6989586621681072830"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072830"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc HscEnv
</span><a href="GHC.Driver.Main.html#getHscEnv"><span class="hs-identifier hs-var">getHscEnv</span></a></span><span>
</span><span id="line-317"></span><span>  </span><span class="annot"><span class="annottext">IO ((WarningMessages, WarningMessages), Maybe ModIface)
-&gt; Hsc ModIface
forall a. IO ((WarningMessages, WarningMessages), Maybe a) -&gt; Hsc a
</span><a href="GHC.Driver.Main.html#ioMsgMaybe"><span class="hs-identifier hs-var">ioMsgMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ((WarningMessages, WarningMessages), Maybe ModIface)
 -&gt; Hsc ModIface)
-&gt; IO ((WarningMessages, WarningMessages), Maybe ModIface)
-&gt; Hsc ModIface
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; Module
-&gt; IO ((WarningMessages, WarningMessages), Maybe ModIface)
</span><a href="GHC.Tc.Module.html#getModuleInterface"><span class="hs-identifier hs-var">getModuleInterface</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072830"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681072831"><span class="hs-identifier hs-var">mod</span></a></span><span>
</span><span id="line-318"></span><span>
</span><span id="line-319"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-320"></span><span class="hs-comment">-- | Rename some import declarations</span><span>
</span><span id="line-321"></span><span class="annot"><a href="GHC.Driver.Main.html#hscRnImportDecls"><span class="hs-identifier hs-type">hscRnImportDecls</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Hs.ImpExp.html#LImportDecl"><span class="hs-identifier hs-type">LImportDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrEnv"><span class="hs-identifier hs-type">GlobalRdrEnv</span></a></span><span>
</span><span id="line-322"></span><span id="hscRnImportDecls"><span class="annot"><span class="annottext">hscRnImportDecls :: HscEnv -&gt; [LImportDecl GhcPs] -&gt; IO GlobalRdrEnv
</span><a href="GHC.Driver.Main.html#hscRnImportDecls"><span class="hs-identifier hs-var hs-var">hscRnImportDecls</span></a></span></span><span> </span><span id="local-6989586621681072828"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072828"><span class="hs-identifier hs-var">hsc_env0</span></a></span></span><span> </span><span id="local-6989586621681072827"><span class="annot"><span class="annottext">[LImportDecl GhcPs]
</span><a href="#local-6989586621681072827"><span class="hs-identifier hs-var">import_decls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Hsc GlobalRdrEnv -&gt; IO GlobalRdrEnv
forall a. HscEnv -&gt; Hsc a -&gt; IO a
</span><a href="GHC.Driver.Types.html#runInteractiveHsc"><span class="hs-identifier hs-var">runInteractiveHsc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072828"><span class="hs-identifier hs-var">hsc_env0</span></a></span><span> </span><span class="annot"><span class="annottext">(Hsc GlobalRdrEnv -&gt; IO GlobalRdrEnv)
-&gt; Hsc GlobalRdrEnv -&gt; IO GlobalRdrEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-323"></span><span>  </span><span id="local-6989586621681072826"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072826"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc HscEnv
</span><a href="GHC.Driver.Main.html#getHscEnv"><span class="hs-identifier hs-var">getHscEnv</span></a></span><span>
</span><span id="line-324"></span><span>  </span><span class="annot"><span class="annottext">IO ((WarningMessages, WarningMessages), Maybe GlobalRdrEnv)
-&gt; Hsc GlobalRdrEnv
forall a. IO ((WarningMessages, WarningMessages), Maybe a) -&gt; Hsc a
</span><a href="GHC.Driver.Main.html#ioMsgMaybe"><span class="hs-identifier hs-var">ioMsgMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ((WarningMessages, WarningMessages), Maybe GlobalRdrEnv)
 -&gt; Hsc GlobalRdrEnv)
-&gt; IO ((WarningMessages, WarningMessages), Maybe GlobalRdrEnv)
-&gt; Hsc GlobalRdrEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; [LImportDecl GhcPs]
-&gt; IO ((WarningMessages, WarningMessages), Maybe GlobalRdrEnv)
</span><a href="GHC.Tc.Module.html#tcRnImportDecls"><span class="hs-identifier hs-var">tcRnImportDecls</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072826"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">[LImportDecl GhcPs]
</span><a href="#local-6989586621681072827"><span class="hs-identifier hs-var">import_decls</span></a></span><span>
</span><span id="line-325"></span><span>
</span><span id="line-326"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-327"></span><span class="hs-comment">-- | parse a file, returning the abstract syntax</span><span>
</span><span id="line-328"></span><span>
</span><span id="line-329"></span><span class="annot"><a href="GHC.Driver.Main.html#hscParse"><span class="hs-identifier hs-type">hscParse</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HsParsedModule"><span class="hs-identifier hs-type">HsParsedModule</span></a></span><span>
</span><span id="line-330"></span><span id="hscParse"><span class="annot"><span class="annottext">hscParse :: HscEnv -&gt; ModSummary -&gt; IO HsParsedModule
</span><a href="GHC.Driver.Main.html#hscParse"><span class="hs-identifier hs-var hs-var">hscParse</span></a></span></span><span> </span><span id="local-6989586621681072824"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072824"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681072823"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681072823"><span class="hs-identifier hs-var">mod_summary</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Hsc HsParsedModule -&gt; IO HsParsedModule
forall a. HscEnv -&gt; Hsc a -&gt; IO a
</span><a href="GHC.Driver.Types.html#runHsc"><span class="hs-identifier hs-var">runHsc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072824"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(Hsc HsParsedModule -&gt; IO HsParsedModule)
-&gt; Hsc HsParsedModule -&gt; IO HsParsedModule
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; Hsc HsParsedModule
</span><a href="GHC.Driver.Main.html#hscParse%27"><span class="hs-identifier hs-var">hscParse'</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681072823"><span class="hs-identifier hs-var">mod_summary</span></a></span><span>
</span><span id="line-331"></span><span>
</span><span id="line-332"></span><span class="hs-comment">-- internal version, that doesn't fail due to -Werror</span><span>
</span><span id="line-333"></span><span class="annot"><a href="GHC.Driver.Main.html#hscParse%27"><span class="hs-identifier hs-type">hscParse'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HsParsedModule"><span class="hs-identifier hs-type">HsParsedModule</span></a></span><span>
</span><span id="line-334"></span><span id="hscParse%27"><span class="annot"><span class="annottext">hscParse' :: ModSummary -&gt; Hsc HsParsedModule
</span><a href="GHC.Driver.Main.html#hscParse%27"><span class="hs-identifier hs-var hs-var">hscParse'</span></a></span></span><span> </span><span id="local-6989586621681072822"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681072822"><span class="hs-identifier hs-var">mod_summary</span></a></span></span><span>
</span><span id="line-335"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681072821"><span class="annot"><span class="annottext">HsParsedModule
</span><a href="#local-6989586621681072821"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; Maybe HsParsedModule
</span><a href="GHC.Driver.Types.html#ms_parsed_mod"><span class="hs-identifier hs-var hs-var">ms_parsed_mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681072822"><span class="hs-identifier hs-var">mod_summary</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsParsedModule -&gt; Hsc HsParsedModule
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">HsParsedModule
</span><a href="#local-6989586621681072821"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-336"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;Parser&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-337"></span><span>    </span><span class="annot"><span class="annottext">SDoc
-&gt; (HsParsedModule -&gt; ())
-&gt; Hsc HsParsedModule
-&gt; Hsc HsParsedModule
forall (m :: * -&gt; *) a.
(MonadIO m, HasDynFlags m) =&gt;
SDoc -&gt; (a -&gt; ()) -&gt; m a -&gt; m a
</span><a href="GHC.Utils.Error.html#withTimingD"><span class="hs-identifier hs-var">withTimingD</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Parser&quot;</span></span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#brackets"><span class="hs-identifier hs-var">brackets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">(Module -&gt; SDoc) -&gt; Module -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; Module
</span><a href="GHC.Driver.Types.html#ms_mod"><span class="hs-identifier hs-var hs-var">ms_mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681072822"><span class="hs-identifier hs-var">mod_summary</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-338"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; HsParsedModule -&gt; ()
forall a b. a -&gt; b -&gt; a
</span><a href="../../base/src/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Hsc HsParsedModule -&gt; Hsc HsParsedModule)
-&gt; Hsc HsParsedModule -&gt; Hsc HsParsedModule
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-339"></span><span>    </span><span id="local-6989586621681072812"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072812"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-340"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681072811"><span class="annot"><span class="annottext">src_filename :: String
</span><a href="#local-6989586621681072811"><span class="hs-identifier hs-var hs-var">src_filename</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; String
</span><a href="GHC.Driver.Types.html#ms_hspp_file"><span class="hs-identifier hs-var hs-var">ms_hspp_file</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681072822"><span class="hs-identifier hs-var">mod_summary</span></a></span><span>
</span><span id="line-341"></span><span>        </span><span id="local-6989586621681072809"><span class="annot"><span class="annottext">maybe_src_buf :: Maybe StringBuffer
</span><a href="#local-6989586621681072809"><span class="hs-identifier hs-var hs-var">maybe_src_buf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; Maybe StringBuffer
</span><a href="GHC.Driver.Types.html#ms_hspp_buf"><span class="hs-identifier hs-var hs-var">ms_hspp_buf</span></a></span><span>  </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681072822"><span class="hs-identifier hs-var">mod_summary</span></a></span><span>
</span><span id="line-342"></span><span>
</span><span id="line-343"></span><span>    </span><span class="hs-comment">--------------------------  Parser  ----------------</span><span>
</span><span id="line-344"></span><span>    </span><span class="hs-comment">-- sometimes we already have the buffer in memory, perhaps</span><span>
</span><span id="line-345"></span><span>    </span><span class="hs-comment">-- because we needed to parse the imports out of it, or get the</span><span>
</span><span id="line-346"></span><span>    </span><span class="hs-comment">-- module name.</span><span>
</span><span id="line-347"></span><span>    </span><span id="local-6989586621681072807"><span class="annot"><span class="annottext">StringBuffer
</span><a href="#local-6989586621681072807"><span class="hs-identifier hs-var">buf</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe StringBuffer
</span><a href="#local-6989586621681072809"><span class="hs-identifier hs-var">maybe_src_buf</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-348"></span><span>               </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681072806"><span class="annot"><span class="annottext">StringBuffer
</span><a href="#local-6989586621681072806"><span class="hs-identifier hs-var">b</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">StringBuffer -&gt; Hsc StringBuffer
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">StringBuffer
</span><a href="#local-6989586621681072806"><span class="hs-identifier hs-var">b</span></a></span><span>
</span><span id="line-349"></span><span>               </span><span class="annot"><span class="annottext">Maybe StringBuffer
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO StringBuffer -&gt; Hsc StringBuffer
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO StringBuffer -&gt; Hsc StringBuffer)
-&gt; IO StringBuffer -&gt; Hsc StringBuffer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO StringBuffer
</span><a href="GHC.Data.StringBuffer.html#hGetStringBuffer"><span class="hs-identifier hs-var">hGetStringBuffer</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681072811"><span class="hs-identifier hs-var">src_filename</span></a></span><span>
</span><span id="line-350"></span><span>
</span><span id="line-351"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681072804"><span class="annot"><span class="annottext">loc :: RealSrcLoc
</span><a href="#local-6989586621681072804"><span class="hs-identifier hs-var hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; Int -&gt; Int -&gt; RealSrcLoc
</span><a href="GHC.Types.SrcLoc.html#mkRealSrcLoc"><span class="hs-identifier hs-var">mkRealSrcLoc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#mkFastString"><span class="hs-identifier hs-var">mkFastString</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681072811"><span class="hs-identifier hs-var">src_filename</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-352"></span><span>    </span><span class="annot"><span class="annottext">IsSafeImport -&gt; Hsc () -&gt; Hsc ()
forall (f :: * -&gt; *). Applicative f =&gt; IsSafeImport -&gt; f () -&gt; f ()
</span><a href="../../base/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WarningFlag -&gt; DynFlags -&gt; IsSafeImport
</span><a href="GHC.Driver.Session.html#wopt"><span class="hs-identifier hs-var">wopt</span></a></span><span> </span><span class="annot"><span class="annottext">WarningFlag
</span><a href="GHC.Driver.Flags.html#Opt_WarnUnicodeBidirectionalFormatCharacters"><span class="hs-identifier hs-var">Opt_WarnUnicodeBidirectionalFormatCharacters</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072812"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Hsc () -&gt; Hsc ()) -&gt; Hsc () -&gt; Hsc ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-353"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PsLoc -&gt; StringBuffer -&gt; Maybe (NonEmpty (PsLoc, Char, String))
</span><a href="GHC.Driver.Main.html#checkBidirectionFormatChars"><span class="hs-identifier hs-var">checkBidirectionFormatChars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RealSrcLoc -&gt; BufPos -&gt; PsLoc
</span><a href="GHC.Types.SrcLoc.html#PsLoc"><span class="hs-identifier hs-var">PsLoc</span></a></span><span> </span><span class="annot"><span class="annottext">RealSrcLoc
</span><a href="#local-6989586621681072804"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; BufPos
</span><a href="GHC.Types.SrcLoc.html#BufPos"><span class="hs-identifier hs-var">BufPos</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StringBuffer
</span><a href="#local-6989586621681072807"><span class="hs-identifier hs-var">buf</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-354"></span><span>        </span><span class="annot"><span class="annottext">Maybe (NonEmpty (PsLoc, Char, String))
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; Hsc ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-355"></span><span>        </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621681072796"><span class="annot"><span class="annottext">PsLoc
</span><a href="#local-6989586621681072796"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681072795"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621681072795"><span class="hs-identifier hs-var">chr</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681072794"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681072794"><span class="hs-identifier hs-var">desc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="../../base/src/GHC.Base.html#%3A%7C"><span class="hs-operator hs-type">:|</span></a></span><span> </span><span id="local-6989586621681072793"><span class="annot"><span class="annottext">[(PsLoc, Char, String)]
</span><a href="#local-6989586621681072793"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-356"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681072792"><span class="annot"><span class="annottext">span :: SrcSpan
</span><a href="#local-6989586621681072792"><span class="hs-identifier hs-var hs-var">span</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PsSpan -&gt; SrcSpan
</span><a href="GHC.Types.SrcLoc.html#mkSrcSpanPs"><span class="hs-identifier hs-var">mkSrcSpanPs</span></a></span><span> </span><span class="annot"><span class="annottext">(PsSpan -&gt; SrcSpan) -&gt; PsSpan -&gt; SrcSpan
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PsLoc -&gt; PsLoc -&gt; PsSpan
</span><a href="GHC.Types.SrcLoc.html#mkPsSpan"><span class="hs-identifier hs-var">mkPsSpan</span></a></span><span> </span><span class="annot"><span class="annottext">PsLoc
</span><a href="#local-6989586621681072796"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PsLoc -&gt; Char -&gt; PsLoc
</span><a href="GHC.Types.SrcLoc.html#advancePsLoc"><span class="hs-identifier hs-var">advancePsLoc</span></a></span><span> </span><span class="annot"><span class="annottext">PsLoc
</span><a href="#local-6989586621681072796"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621681072795"><span class="hs-identifier hs-var">chr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-357"></span><span>              </span><span id="local-6989586621681072788"><span class="annot"><span class="annottext">warn :: ErrMsg
</span><a href="#local-6989586621681072788"><span class="hs-identifier hs-var hs-var">warn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WarnReason -&gt; ErrMsg -&gt; ErrMsg
</span><a href="GHC.Utils.Error.html#makeIntoWarning"><span class="hs-identifier hs-var">makeIntoWarning</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WarningFlag -&gt; WarnReason
</span><a href="GHC.Driver.Flags.html#Reason"><span class="hs-identifier hs-var">Reason</span></a></span><span> </span><span class="annot"><span class="annottext">WarningFlag
</span><a href="GHC.Driver.Flags.html#Opt_WarnUnicodeBidirectionalFormatCharacters"><span class="hs-identifier hs-var">Opt_WarnUnicodeBidirectionalFormatCharacters</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ErrMsg -&gt; ErrMsg) -&gt; ErrMsg -&gt; ErrMsg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; SrcSpan -&gt; PrintUnqualified -&gt; SDoc -&gt; SDoc -&gt; ErrMsg
</span><a href="GHC.Utils.Error.html#mkLongWarnMsg"><span class="hs-identifier hs-var">mkLongWarnMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072812"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681072792"><span class="hs-identifier hs-var">span</span></a></span><span> </span><span class="annot"><span class="annottext">PrintUnqualified
</span><a href="GHC.Utils.Outputable.html#neverQualify"><span class="hs-identifier hs-var">neverQualify</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681072783"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-358"></span><span>              </span><span id="local-6989586621681072783"><span class="annot"><span class="annottext">msg :: SDoc
</span><a href="#local-6989586621681072783"><span class="hs-identifier hs-var hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;A unicode bidirectional formatting character&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681072794"><span class="hs-identifier hs-var">desc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-359"></span><span>                 </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;was found at offset&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BufPos -&gt; Int
</span><a href="GHC.Types.SrcLoc.html#bufPos"><span class="hs-identifier hs-var hs-var">bufPos</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PsLoc -&gt; BufPos
</span><a href="GHC.Types.SrcLoc.html#psBufPos"><span class="hs-identifier hs-var hs-var">psBufPos</span></a></span><span> </span><span class="annot"><span class="annottext">PsLoc
</span><a href="#local-6989586621681072796"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;in the file&quot;</span></span><span>
</span><span id="line-360"></span><span>                 </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[(PsLoc, Char, String)]
</span><a href="#local-6989586621681072793"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-361"></span><span>                       </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-362"></span><span>                       </span><span id="local-6989586621681072776"><span class="annot"><span class="annottext">[(PsLoc, Char, String)]
</span><a href="#local-6989586621681072776"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;along with further bidirectional formatting characters at&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[(PsLoc, Char, String)] -&gt; SDoc
forall {b}. [(PsLoc, b, String)] -&gt; SDoc
</span><a href="#local-6989586621681072775"><span class="hs-identifier hs-var">pprChars</span></a></span><span> </span><span class="annot"><span class="annottext">[(PsLoc, Char, String)]
</span><a href="#local-6989586621681072776"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-363"></span><span>                        </span><span class="hs-keyword">where</span><span>
</span><span id="line-364"></span><span>                          </span><span id="local-6989586621681072775"><span class="annot"><span class="annottext">pprChars :: [(PsLoc, b, String)] -&gt; SDoc
</span><a href="#local-6989586621681072775"><span class="hs-identifier hs-var hs-var">pprChars</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-365"></span><span>                          </span><span class="annot"><a href="#local-6989586621681072775"><span class="hs-identifier hs-var">pprChars</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621681072773"><span class="annot"><span class="annottext">PsLoc
</span><a href="#local-6989586621681072773"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">b
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621681072772"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681072772"><span class="hs-identifier hs-var">desc</span></a></span></span><span class="hs-special">)</span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681072771"><span class="annot"><span class="annottext">[(PsLoc, b, String)]
</span><a href="#local-6989586621681072771"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;offset&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BufPos -&gt; Int
</span><a href="GHC.Types.SrcLoc.html#bufPos"><span class="hs-identifier hs-var hs-var">bufPos</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PsLoc -&gt; BufPos
</span><a href="GHC.Types.SrcLoc.html#psBufPos"><span class="hs-identifier hs-var hs-var">psBufPos</span></a></span><span> </span><span class="annot"><span class="annottext">PsLoc
</span><a href="#local-6989586621681072773"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681072772"><span class="hs-identifier hs-var">desc</span></a></span><span>
</span><span id="line-366"></span><span>                                                    </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">[(PsLoc, b, String)] -&gt; SDoc
</span><a href="#local-6989586621681072775"><span class="hs-identifier hs-var">pprChars</span></a></span><span> </span><span class="annot"><span class="annottext">[(PsLoc, b, String)]
</span><a href="#local-6989586621681072771"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-367"></span><span>                 </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Bidirectional formatting characters may be rendered misleadingly in certain editors&quot;</span></span><span>
</span><span id="line-368"></span><span>
</span><span id="line-369"></span><span>          </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; Hsc ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; Hsc ()) -&gt; IO () -&gt; Hsc ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; WarningMessages -&gt; IO ()
</span><a href="GHC.Driver.Types.html#printOrThrowWarnings"><span class="hs-identifier hs-var">printOrThrowWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072812"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ErrMsg -&gt; WarningMessages
forall a. a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#unitBag"><span class="hs-identifier hs-var">unitBag</span></a></span><span> </span><span class="annot"><span class="annottext">ErrMsg
</span><a href="#local-6989586621681072788"><span class="hs-identifier hs-var">warn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-370"></span><span>
</span><span id="line-371"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681072767"><span class="annot"><span class="annottext">parseMod :: P (Located HsModule)
</span><a href="#local-6989586621681072767"><span class="hs-identifier hs-var hs-var">parseMod</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="GHC.Driver.Phases.html#HsigFile"><span class="hs-identifier hs-var">HsigFile</span></a></span><span> </span><span class="annot"><span class="annottext">HscSource -&gt; HscSource -&gt; IsSafeImport
forall a. Eq a =&gt; a -&gt; a -&gt; IsSafeImport
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; HscSource
</span><a href="GHC.Driver.Types.html#ms_hsc_src"><span class="hs-identifier hs-var hs-var">ms_hsc_src</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681072822"><span class="hs-identifier hs-var">mod_summary</span></a></span><span>
</span><span id="line-372"></span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">P (Located HsModule)
</span><a href="GHC.Parser.html#parseSignature"><span class="hs-identifier hs-var">parseSignature</span></a></span><span>
</span><span id="line-373"></span><span>                 </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">P (Located HsModule)
</span><a href="GHC.Parser.html#parseModule"><span class="hs-identifier hs-var">parseModule</span></a></span><span>
</span><span id="line-374"></span><span>
</span><span id="line-375"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">P (Located HsModule) -&gt; PState -&gt; ParseResult (Located HsModule)
forall a. P a -&gt; PState -&gt; ParseResult a
</span><a href="GHC.Parser.Lexer.html#unP"><span class="hs-identifier hs-var hs-var">unP</span></a></span><span> </span><span class="annot"><span class="annottext">P (Located HsModule)
</span><a href="#local-6989586621681072767"><span class="hs-identifier hs-var">parseMod</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; StringBuffer -&gt; RealSrcLoc -&gt; PState
</span><a href="GHC.Parser.Lexer.html#mkPState"><span class="hs-identifier hs-var">mkPState</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072812"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">StringBuffer
</span><a href="#local-6989586621681072807"><span class="hs-identifier hs-var">buf</span></a></span><span> </span><span class="annot"><span class="annottext">RealSrcLoc
</span><a href="#local-6989586621681072804"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-376"></span><span>        </span><span class="annot"><a href="GHC.Parser.Lexer.html#PFailed"><span class="hs-identifier hs-type">PFailed</span></a></span><span> </span><span id="local-6989586621681072759"><span class="annot"><span class="annottext">PState
</span><a href="#local-6989586621681072759"><span class="hs-identifier hs-var">pst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-377"></span><span>            </span><span class="annot"><span class="annottext">(WarningMessages, WarningMessages) -&gt; Hsc HsParsedModule
forall a. (WarningMessages, WarningMessages) -&gt; Hsc a
</span><a href="GHC.Driver.Main.html#handleWarningsThrowErrors"><span class="hs-identifier hs-var">handleWarningsThrowErrors</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PState -&gt; DynFlags -&gt; (WarningMessages, WarningMessages)
</span><a href="GHC.Parser.Lexer.html#getMessages"><span class="hs-identifier hs-var">getMessages</span></a></span><span> </span><span class="annot"><span class="annottext">PState
</span><a href="#local-6989586621681072759"><span class="hs-identifier hs-var">pst</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072812"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-378"></span><span>        </span><span class="annot"><a href="GHC.Parser.Lexer.html#POk"><span class="hs-identifier hs-type">POk</span></a></span><span> </span><span id="local-6989586621681072756"><span class="annot"><span class="annottext">PState
</span><a href="#local-6989586621681072756"><span class="hs-identifier hs-var">pst</span></a></span></span><span> </span><span id="local-6989586621681072755"><span class="annot"><span class="annottext">Located HsModule
</span><a href="#local-6989586621681072755"><span class="hs-identifier hs-var">rdr_module</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-379"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681072754"><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681072754"><span class="hs-identifier hs-var">warns</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681072753"><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681072753"><span class="hs-identifier hs-var">errs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PState -&gt; DynFlags -&gt; (WarningMessages, WarningMessages)
</span><a href="GHC.Parser.Lexer.html#getMessages"><span class="hs-identifier hs-var">getMessages</span></a></span><span> </span><span class="annot"><span class="annottext">PState
</span><a href="#local-6989586621681072756"><span class="hs-identifier hs-var">pst</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072812"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-380"></span><span>            </span><span class="annot"><span class="annottext">WarningMessages -&gt; Hsc ()
</span><a href="GHC.Driver.Main.html#logWarnings"><span class="hs-identifier hs-var">logWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681072754"><span class="hs-identifier hs-var">warns</span></a></span><span>
</span><span id="line-381"></span><span>            </span><span class="annot"><span class="annottext">IO () -&gt; Hsc ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; Hsc ()) -&gt; IO () -&gt; Hsc ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; DumpFlag -&gt; String -&gt; DumpFormat -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#dumpIfSet_dyn"><span class="hs-identifier hs-var">dumpIfSet_dyn</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072812"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_parsed"><span class="hs-identifier hs-var">Opt_D_dump_parsed</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Parser&quot;</span></span><span>
</span><span id="line-382"></span><span>                        </span><span class="annot"><span class="annottext">DumpFormat
</span><a href="GHC.Utils.Error.html#FormatHaskell"><span class="hs-identifier hs-var">FormatHaskell</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Located HsModule -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Located HsModule
</span><a href="#local-6989586621681072755"><span class="hs-identifier hs-var">rdr_module</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-383"></span><span>            </span><span class="annot"><span class="annottext">IO () -&gt; Hsc ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; Hsc ()) -&gt; IO () -&gt; Hsc ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; DumpFlag -&gt; String -&gt; DumpFormat -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#dumpIfSet_dyn"><span class="hs-identifier hs-var">dumpIfSet_dyn</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072812"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_parsed_ast"><span class="hs-identifier hs-var">Opt_D_dump_parsed_ast</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Parser AST&quot;</span></span><span>
</span><span id="line-384"></span><span>                        </span><span class="annot"><span class="annottext">DumpFormat
</span><a href="GHC.Utils.Error.html#FormatHaskell"><span class="hs-identifier hs-var">FormatHaskell</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlankSrcSpan -&gt; Located HsModule -&gt; SDoc
forall a. Data a =&gt; BlankSrcSpan -&gt; a -&gt; SDoc
</span><a href="GHC.Hs.Dump.html#showAstData"><span class="hs-identifier hs-var">showAstData</span></a></span><span> </span><span class="annot"><span class="annottext">BlankSrcSpan
</span><a href="GHC.Hs.Dump.html#NoBlankSrcSpan"><span class="hs-identifier hs-var">NoBlankSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">Located HsModule
</span><a href="#local-6989586621681072755"><span class="hs-identifier hs-var">rdr_module</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-385"></span><span>            </span><span class="annot"><span class="annottext">IO () -&gt; Hsc ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; Hsc ()) -&gt; IO () -&gt; Hsc ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; DumpFlag -&gt; String -&gt; DumpFormat -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#dumpIfSet_dyn"><span class="hs-identifier hs-var">dumpIfSet_dyn</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072812"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_source_stats"><span class="hs-identifier hs-var">Opt_D_source_stats</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Source Statistics&quot;</span></span><span>
</span><span id="line-386"></span><span>                        </span><span class="annot"><span class="annottext">DumpFormat
</span><a href="GHC.Utils.Error.html#FormatText"><span class="hs-identifier hs-var">FormatText</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsSafeImport -&gt; Located HsModule -&gt; SDoc
</span><a href="GHC.Hs.Stats.html#ppSourceStats"><span class="hs-identifier hs-var">ppSourceStats</span></a></span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">Located HsModule
</span><a href="#local-6989586621681072755"><span class="hs-identifier hs-var">rdr_module</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-387"></span><span>            </span><span class="annot"><span class="annottext">IsSafeImport -&gt; Hsc () -&gt; Hsc ()
forall (f :: * -&gt; *). Applicative f =&gt; IsSafeImport -&gt; f () -&gt; f ()
</span><a href="../../base/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsSafeImport -&gt; IsSafeImport
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(IsSafeImport -&gt; IsSafeImport) -&gt; IsSafeImport -&gt; IsSafeImport
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WarningMessages -&gt; IsSafeImport
forall a. Bag a -&gt; IsSafeImport
</span><a href="GHC.Data.Bag.html#isEmptyBag"><span class="hs-identifier hs-var">isEmptyBag</span></a></span><span> </span><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681072753"><span class="hs-identifier hs-var">errs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Hsc () -&gt; Hsc ()) -&gt; Hsc () -&gt; Hsc ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WarningMessages -&gt; Hsc ()
forall (io :: * -&gt; *) a. MonadIO io =&gt; WarningMessages -&gt; io a
</span><a href="GHC.Driver.Types.html#throwErrors"><span class="hs-identifier hs-var">throwErrors</span></a></span><span> </span><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681072753"><span class="hs-identifier hs-var">errs</span></a></span><span>
</span><span id="line-388"></span><span>
</span><span id="line-389"></span><span>            </span><span class="hs-comment">-- To get the list of extra source files, we take the list</span><span>
</span><span id="line-390"></span><span>            </span><span class="hs-comment">-- that the parser gave us,</span><span>
</span><span id="line-391"></span><span>            </span><span class="hs-comment">--   - eliminate files beginning with '&lt;'.  gcc likes to use</span><span>
</span><span id="line-392"></span><span>            </span><span class="hs-comment">--     pseudo-filenames like &quot;&lt;built-in&gt;&quot; and &quot;&lt;command-line&gt;&quot;</span><span>
</span><span id="line-393"></span><span>            </span><span class="hs-comment">--   - normalise them (eliminate differences between ./f and f)</span><span>
</span><span id="line-394"></span><span>            </span><span class="hs-comment">--   - filter out the preprocessed source file</span><span>
</span><span id="line-395"></span><span>            </span><span class="hs-comment">--   - filter out anything beginning with tmpdir</span><span>
</span><span id="line-396"></span><span>            </span><span class="hs-comment">--   - remove duplicates</span><span>
</span><span id="line-397"></span><span>            </span><span class="hs-comment">--   - filter out the .hs/.lhs source filename if we have one</span><span>
</span><span id="line-398"></span><span>            </span><span class="hs-comment">--</span><span>
</span><span id="line-399"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681072744"><span class="annot"><span class="annottext">n_hspp :: String
</span><a href="#local-6989586621681072744"><span class="hs-identifier hs-var hs-var">n_hspp</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String
</span><a href="../../filepath/src/System.FilePath.Windows.html#normalise"><span class="hs-identifier hs-var">FilePath.normalise</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681072811"><span class="hs-identifier hs-var">src_filename</span></a></span><span>
</span><span id="line-400"></span><span>                </span><span id="local-6989586621681072736"><span class="annot"><span class="annottext">srcs0 :: [String]
</span><a href="#local-6989586621681072736"><span class="hs-identifier hs-var hs-var">srcs0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; [String]
forall a. Eq a =&gt; [a] -&gt; [a]
</span><a href="../../base/src/Data.OldList.html#nub"><span class="hs-identifier hs-var">nub</span></a></span><span> </span><span class="annot"><span class="annottext">([String] -&gt; [String]) -&gt; [String] -&gt; [String]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IsSafeImport) -&gt; [String] -&gt; [String]
forall a. (a -&gt; IsSafeImport) -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsSafeImport -&gt; IsSafeImport
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(IsSafeImport -&gt; IsSafeImport)
-&gt; (String -&gt; IsSafeImport) -&gt; String -&gt; IsSafeImport
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; String
</span><a href="GHC.Driver.Session.html#tmpDir"><span class="hs-identifier hs-var">tmpDir</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072812"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; IsSafeImport
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; IsSafeImport
</span><a href="../../base/src/Data.OldList.html#isPrefixOf"><span class="hs-operator hs-var">`isPrefixOf`</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-401"></span><span>                            </span><span class="annot"><span class="annottext">([String] -&gt; [String]) -&gt; [String] -&gt; [String]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IsSafeImport) -&gt; [String] -&gt; [String]
forall a. (a -&gt; IsSafeImport) -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsSafeImport -&gt; IsSafeImport
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(IsSafeImport -&gt; IsSafeImport)
-&gt; (String -&gt; IsSafeImport) -&gt; String -&gt; IsSafeImport
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; String -&gt; IsSafeImport
forall a. Eq a =&gt; a -&gt; a -&gt; IsSafeImport
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681072744"><span class="hs-identifier hs-var">n_hspp</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-402"></span><span>                            </span><span class="annot"><span class="annottext">([String] -&gt; [String]) -&gt; [String] -&gt; [String]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; String) -&gt; [String] -&gt; [String]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String
</span><a href="../../filepath/src/System.FilePath.Windows.html#normalise"><span class="hs-identifier hs-var">FilePath.normalise</span></a></span><span>
</span><span id="line-403"></span><span>                            </span><span class="annot"><span class="annottext">([String] -&gt; [String]) -&gt; [String] -&gt; [String]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IsSafeImport) -&gt; [String] -&gt; [String]
forall a. (a -&gt; IsSafeImport) -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsSafeImport -&gt; IsSafeImport
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(IsSafeImport -&gt; IsSafeImport)
-&gt; (String -&gt; IsSafeImport) -&gt; String -&gt; IsSafeImport
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; IsSafeImport
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; IsSafeImport
</span><a href="../../base/src/Data.OldList.html#isPrefixOf"><span class="hs-identifier hs-var">isPrefixOf</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&lt;&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-404"></span><span>                            </span><span class="annot"><span class="annottext">([String] -&gt; [String]) -&gt; [String] -&gt; [String]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(FastString -&gt; String) -&gt; [FastString] -&gt; [String]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; String
</span><a href="GHC.Data.FastString.html#unpackFS"><span class="hs-identifier hs-var">unpackFS</span></a></span><span>
</span><span id="line-405"></span><span>                            </span><span class="annot"><span class="annottext">([FastString] -&gt; [String]) -&gt; [FastString] -&gt; [String]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PState -&gt; [FastString]
</span><a href="GHC.Parser.Lexer.html#srcfiles"><span class="hs-identifier hs-var hs-var">srcfiles</span></a></span><span> </span><span class="annot"><span class="annottext">PState
</span><a href="#local-6989586621681072756"><span class="hs-identifier hs-var">pst</span></a></span><span>
</span><span id="line-406"></span><span>                </span><span id="local-6989586621681072729"><span class="annot"><span class="annottext">srcs1 :: [String]
</span><a href="#local-6989586621681072729"><span class="hs-identifier hs-var hs-var">srcs1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ModLocation -&gt; Maybe String
</span><a href="GHC.Unit.Module.Location.html#ml_hs_file"><span class="hs-identifier hs-var hs-var">ml_hs_file</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; ModLocation
</span><a href="GHC.Driver.Types.html#ms_location"><span class="hs-identifier hs-var hs-var">ms_location</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681072822"><span class="hs-identifier hs-var">mod_summary</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-407"></span><span>                          </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681072726"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681072726"><span class="hs-identifier hs-var">f</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(String -&gt; IsSafeImport) -&gt; [String] -&gt; [String]
forall a. (a -&gt; IsSafeImport) -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; String -&gt; IsSafeImport
forall a. Eq a =&gt; a -&gt; a -&gt; IsSafeImport
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String
</span><a href="../../filepath/src/System.FilePath.Windows.html#normalise"><span class="hs-identifier hs-var">FilePath.normalise</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681072726"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681072736"><span class="hs-identifier hs-var">srcs0</span></a></span><span>
</span><span id="line-408"></span><span>                          </span><span class="annot"><span class="annottext">Maybe String
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681072736"><span class="hs-identifier hs-var">srcs0</span></a></span><span>
</span><span id="line-409"></span><span>
</span><span id="line-410"></span><span>            </span><span class="hs-comment">-- sometimes we see source files from earlier</span><span>
</span><span id="line-411"></span><span>            </span><span class="hs-comment">-- preprocessing stages that cannot be found, so just</span><span>
</span><span id="line-412"></span><span>            </span><span class="hs-comment">-- filter them out:</span><span>
</span><span id="line-413"></span><span>            </span><span id="local-6989586621681072724"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681072724"><span class="hs-identifier hs-var">srcs2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO [String] -&gt; Hsc [String]
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO [String] -&gt; Hsc [String]) -&gt; IO [String] -&gt; Hsc [String]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO IsSafeImport) -&gt; [String] -&gt; IO [String]
forall (m :: * -&gt; *) a.
Applicative m =&gt;
(a -&gt; m IsSafeImport) -&gt; [a] -&gt; m [a]
</span><a href="../../base/src/Control.Monad.html#filterM"><span class="hs-identifier hs-var">filterM</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; IO IsSafeImport
</span><a href="../../directory/src/System.Directory.html#doesFileExist"><span class="hs-identifier hs-var">doesFileExist</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681072729"><span class="hs-identifier hs-var">srcs1</span></a></span><span>
</span><span id="line-414"></span><span>
</span><span id="line-415"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681072714"><span class="annot"><span class="annottext">api_anns :: ApiAnns
</span><a href="#local-6989586621681072714"><span class="hs-identifier hs-var hs-var">api_anns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiAnns :: Map ApiAnnKey [RealSrcSpan]
-&gt; Maybe RealSrcSpan
-&gt; Map RealSrcSpan [RealLocated AnnotationComment]
-&gt; [RealLocated AnnotationComment]
-&gt; ApiAnns
</span><a href="GHC.Parser.Annotation.html#ApiAnns"><span class="hs-identifier hs-type">ApiAnns</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-416"></span><span>                      </span><span class="annot"><span class="annottext">apiAnnItems :: Map ApiAnnKey [RealSrcSpan]
</span><a href="GHC.Parser.Annotation.html#apiAnnItems"><span class="hs-identifier hs-var">apiAnnItems</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([RealSrcSpan] -&gt; [RealSrcSpan] -&gt; [RealSrcSpan])
-&gt; [(ApiAnnKey, [RealSrcSpan])] -&gt; Map ApiAnnKey [RealSrcSpan]
forall k a. Ord k =&gt; (a -&gt; a -&gt; a) -&gt; [(k, a)] -&gt; Map k a
</span><a href="../../containers/src/Data.Map.Internal.html#fromListWith"><span class="hs-identifier hs-var">M.fromListWith</span></a></span><span> </span><span class="annot"><span class="annottext">[RealSrcSpan] -&gt; [RealSrcSpan] -&gt; [RealSrcSpan]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">(++)</span></a></span><span> </span><span class="annot"><span class="annottext">([(ApiAnnKey, [RealSrcSpan])] -&gt; Map ApiAnnKey [RealSrcSpan])
-&gt; [(ApiAnnKey, [RealSrcSpan])] -&gt; Map ApiAnnKey [RealSrcSpan]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PState -&gt; [(ApiAnnKey, [RealSrcSpan])]
</span><a href="GHC.Parser.Lexer.html#annotations"><span class="hs-identifier hs-var hs-var">annotations</span></a></span><span> </span><span class="annot"><span class="annottext">PState
</span><a href="#local-6989586621681072756"><span class="hs-identifier hs-var">pst</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-417"></span><span>                      </span><span class="annot"><span class="annottext">apiAnnEofPos :: Maybe RealSrcSpan
</span><a href="GHC.Parser.Annotation.html#apiAnnEofPos"><span class="hs-identifier hs-var">apiAnnEofPos</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PState -&gt; Maybe RealSrcSpan
</span><a href="GHC.Parser.Lexer.html#eof_pos"><span class="hs-identifier hs-var hs-var">eof_pos</span></a></span><span> </span><span class="annot"><span class="annottext">PState
</span><a href="#local-6989586621681072756"><span class="hs-identifier hs-var">pst</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-418"></span><span>                      </span><span class="annot"><span class="annottext">apiAnnComments :: Map RealSrcSpan [RealLocated AnnotationComment]
</span><a href="GHC.Parser.Annotation.html#apiAnnComments"><span class="hs-identifier hs-var">apiAnnComments</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(RealSrcSpan, [RealLocated AnnotationComment])]
-&gt; Map RealSrcSpan [RealLocated AnnotationComment]
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="../../containers/src/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">M.fromList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PState -&gt; [(RealSrcSpan, [RealLocated AnnotationComment])]
</span><a href="GHC.Parser.Lexer.html#annotations_comments"><span class="hs-identifier hs-var hs-var">annotations_comments</span></a></span><span> </span><span class="annot"><span class="annottext">PState
</span><a href="#local-6989586621681072756"><span class="hs-identifier hs-var">pst</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-419"></span><span>                      </span><span class="annot"><span class="annottext">apiAnnRogueComments :: [RealLocated AnnotationComment]
</span><a href="GHC.Parser.Annotation.html#apiAnnRogueComments"><span class="hs-identifier hs-var">apiAnnRogueComments</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PState -&gt; [RealLocated AnnotationComment]
</span><a href="GHC.Parser.Lexer.html#comment_q"><span class="hs-identifier hs-var hs-var">comment_q</span></a></span><span> </span><span class="annot"><span class="annottext">PState
</span><a href="#local-6989586621681072756"><span class="hs-identifier hs-var">pst</span></a></span><span>
</span><span id="line-420"></span><span>                   </span><span class="hs-special">}</span><span>
</span><span id="line-421"></span><span>                </span><span id="local-6989586621681072702"><span class="annot"><span class="annottext">res :: HsParsedModule
</span><a href="#local-6989586621681072702"><span class="hs-identifier hs-var hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsParsedModule :: Located HsModule -&gt; [String] -&gt; ApiAnns -&gt; HsParsedModule
</span><a href="GHC.Driver.Types.html#HsParsedModule"><span class="hs-identifier hs-type">HsParsedModule</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-422"></span><span>                      </span><span class="annot"><span class="annottext">hpm_module :: Located HsModule
</span><a href="GHC.Driver.Types.html#hpm_module"><span class="hs-identifier hs-var">hpm_module</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Located HsModule
</span><a href="#local-6989586621681072755"><span class="hs-identifier hs-var">rdr_module</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-423"></span><span>                      </span><span class="annot"><span class="annottext">hpm_src_files :: [String]
</span><a href="GHC.Driver.Types.html#hpm_src_files"><span class="hs-identifier hs-var">hpm_src_files</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681072724"><span class="hs-identifier hs-var">srcs2</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-424"></span><span>                      </span><span class="annot"><span class="annottext">hpm_annotations :: ApiAnns
</span><a href="GHC.Driver.Types.html#hpm_annotations"><span class="hs-identifier hs-var">hpm_annotations</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ApiAnns
</span><a href="#local-6989586621681072714"><span class="hs-identifier hs-var">api_anns</span></a></span><span>
</span><span id="line-425"></span><span>                   </span><span class="hs-special">}</span><span>
</span><span id="line-426"></span><span>
</span><span id="line-427"></span><span>            </span><span class="hs-comment">-- apply parse transformation of plugins</span><span>
</span><span id="line-428"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681072697"><span class="annot"><span class="annottext">applyPluginAction :: Plugin -&gt; [String] -&gt; HsParsedModule -&gt; Hsc HsParsedModule
</span><a href="#local-6989586621681072697"><span class="hs-identifier hs-var hs-var">applyPluginAction</span></a></span></span><span> </span><span id="local-6989586621681072696"><span class="annot"><span class="annottext">Plugin
</span><a href="#local-6989586621681072696"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621681072695"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681072695"><span class="hs-identifier hs-var">opts</span></a></span></span><span>
</span><span id="line-429"></span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Plugin
-&gt; [String] -&gt; ModSummary -&gt; HsParsedModule -&gt; Hsc HsParsedModule
</span><a href="GHC.Driver.Plugins.html#parsedResultAction"><span class="hs-identifier hs-var hs-var">parsedResultAction</span></a></span><span> </span><span class="annot"><span class="annottext">Plugin
</span><a href="#local-6989586621681072696"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681072695"><span class="hs-identifier hs-var">opts</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681072822"><span class="hs-identifier hs-var">mod_summary</span></a></span><span>
</span><span id="line-430"></span><span>            </span><span class="annot"><span class="annottext">DynFlags
-&gt; (Plugin -&gt; [String] -&gt; HsParsedModule -&gt; Hsc HsParsedModule)
-&gt; HsParsedModule
-&gt; Hsc HsParsedModule
forall (m :: * -&gt; *) a.
Monad m =&gt;
DynFlags -&gt; PluginOperation m a -&gt; a -&gt; m a
</span><a href="GHC.Driver.Plugins.html#withPlugins"><span class="hs-identifier hs-var">withPlugins</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072812"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Plugin -&gt; [String] -&gt; HsParsedModule -&gt; Hsc HsParsedModule
</span><a href="#local-6989586621681072697"><span class="hs-identifier hs-var">applyPluginAction</span></a></span><span> </span><span class="annot"><span class="annottext">HsParsedModule
</span><a href="#local-6989586621681072702"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-431"></span><span>
</span><span id="line-432"></span><span class="annot"><a href="GHC.Driver.Main.html#checkBidirectionFormatChars"><span class="hs-identifier hs-type">checkBidirectionFormatChars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#PsLoc"><span class="hs-identifier hs-type">PsLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.StringBuffer.html#StringBuffer"><span class="hs-identifier hs-type">StringBuffer</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/GHC.Base.html#NonEmpty"><span class="hs-identifier hs-type">NonEmpty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#PsLoc"><span class="hs-identifier hs-type">PsLoc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-433"></span><span id="checkBidirectionFormatChars"><span class="annot"><span class="annottext">checkBidirectionFormatChars :: PsLoc -&gt; StringBuffer -&gt; Maybe (NonEmpty (PsLoc, Char, String))
</span><a href="GHC.Driver.Main.html#checkBidirectionFormatChars"><span class="hs-identifier hs-var hs-var">checkBidirectionFormatChars</span></a></span></span><span> </span><span id="local-6989586621681072692"><span class="annot"><span class="annottext">PsLoc
</span><a href="#local-6989586621681072692"><span class="hs-identifier hs-var">start_loc</span></a></span></span><span> </span><span id="local-6989586621681072691"><span class="annot"><span class="annottext">StringBuffer
</span><a href="#local-6989586621681072691"><span class="hs-identifier hs-var">sb</span></a></span></span><span>
</span><span id="line-434"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">StringBuffer -&gt; IsSafeImport
</span><a href="GHC.Data.StringBuffer.html#containsBidirectionalFormatChar"><span class="hs-identifier hs-var">containsBidirectionalFormatChar</span></a></span><span> </span><span class="annot"><span class="annottext">StringBuffer
</span><a href="#local-6989586621681072691"><span class="hs-identifier hs-var">sb</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonEmpty (PsLoc, Char, String)
-&gt; Maybe (NonEmpty (PsLoc, Char, String))
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(NonEmpty (PsLoc, Char, String)
 -&gt; Maybe (NonEmpty (PsLoc, Char, String)))
-&gt; NonEmpty (PsLoc, Char, String)
-&gt; Maybe (NonEmpty (PsLoc, Char, String))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PsLoc -&gt; StringBuffer -&gt; NonEmpty (PsLoc, Char, String)
</span><a href="#local-6989586621681072689"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">PsLoc
</span><a href="#local-6989586621681072692"><span class="hs-identifier hs-var">start_loc</span></a></span><span> </span><span class="annot"><span class="annottext">StringBuffer
</span><a href="#local-6989586621681072691"><span class="hs-identifier hs-var">sb</span></a></span><span>
</span><span id="line-435"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (NonEmpty (PsLoc, Char, String))
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-436"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-437"></span><span>    </span><span class="annot"><a href="#local-6989586621681072689"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#PsLoc"><span class="hs-identifier hs-type">PsLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.StringBuffer.html#StringBuffer"><span class="hs-identifier hs-type">StringBuffer</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Base.html#NonEmpty"><span class="hs-identifier hs-type">NonEmpty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#PsLoc"><span class="hs-identifier hs-type">PsLoc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-438"></span><span>    </span><span id="local-6989586621681072689"><span class="annot"><span class="annottext">go :: PsLoc -&gt; StringBuffer -&gt; NonEmpty (PsLoc, Char, String)
</span><a href="#local-6989586621681072689"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621681072688"><span class="annot"><span class="annottext">PsLoc
</span><a href="#local-6989586621681072688"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681072687"><span class="annot"><span class="annottext">StringBuffer
</span><a href="#local-6989586621681072687"><span class="hs-identifier hs-var">sb</span></a></span></span><span>
</span><span id="line-439"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">StringBuffer -&gt; IsSafeImport
</span><a href="GHC.Data.StringBuffer.html#atEnd"><span class="hs-identifier hs-var">atEnd</span></a></span><span> </span><span class="annot"><span class="annottext">StringBuffer
</span><a href="#local-6989586621681072687"><span class="hs-identifier hs-var">sb</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; NonEmpty (PsLoc, Char, String)
forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;checkBidirectionFormatChars: no char found&quot;</span></span><span>
</span><span id="line-440"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">StringBuffer -&gt; (Char, StringBuffer)
</span><a href="GHC.Data.StringBuffer.html#nextChar"><span class="hs-identifier hs-var">nextChar</span></a></span><span> </span><span class="annot"><span class="annottext">StringBuffer
</span><a href="#local-6989586621681072687"><span class="hs-identifier hs-var">sb</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-441"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621681072683"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621681072683"><span class="hs-identifier hs-var">chr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681072682"><span class="annot"><span class="annottext">StringBuffer
</span><a href="#local-6989586621681072682"><span class="hs-identifier hs-var">sb</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-442"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681072681"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681072681"><span class="hs-identifier hs-var">desc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Char -&gt; [(Char, String)] -&gt; Maybe String
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><a href="../../base/src/GHC.List.html#lookup"><span class="hs-identifier hs-var">lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621681072683"><span class="hs-identifier hs-var">chr</span></a></span><span> </span><span class="annot"><span class="annottext">[(Char, String)]
</span><a href="GHC.Data.StringBuffer.html#bidirectionalFormatChars"><span class="hs-identifier hs-var">bidirectionalFormatChars</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-443"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PsLoc
</span><a href="#local-6989586621681072688"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621681072683"><span class="hs-identifier hs-var">chr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681072681"><span class="hs-identifier hs-var">desc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PsLoc, Char, String)
-&gt; [(PsLoc, Char, String)] -&gt; NonEmpty (PsLoc, Char, String)
forall a. a -&gt; [a] -&gt; NonEmpty a
</span><a href="../../base/src/GHC.Base.html#%3A%7C"><span class="hs-operator hs-var">:|</span></a></span><span> </span><span class="annot"><span class="annottext">PsLoc -&gt; StringBuffer -&gt; [(PsLoc, Char, String)]
</span><a href="#local-6989586621681072678"><span class="hs-identifier hs-var">go1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PsLoc -&gt; Char -&gt; PsLoc
</span><a href="GHC.Types.SrcLoc.html#advancePsLoc"><span class="hs-identifier hs-var">advancePsLoc</span></a></span><span> </span><span class="annot"><span class="annottext">PsLoc
</span><a href="#local-6989586621681072688"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621681072683"><span class="hs-identifier hs-var">chr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StringBuffer
</span><a href="#local-6989586621681072682"><span class="hs-identifier hs-var">sb</span></a></span><span>
</span><span id="line-444"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PsLoc -&gt; StringBuffer -&gt; NonEmpty (PsLoc, Char, String)
</span><a href="#local-6989586621681072689"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PsLoc -&gt; Char -&gt; PsLoc
</span><a href="GHC.Types.SrcLoc.html#advancePsLoc"><span class="hs-identifier hs-var">advancePsLoc</span></a></span><span> </span><span class="annot"><span class="annottext">PsLoc
</span><a href="#local-6989586621681072688"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621681072683"><span class="hs-identifier hs-var">chr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StringBuffer
</span><a href="#local-6989586621681072682"><span class="hs-identifier hs-var">sb</span></a></span><span>
</span><span id="line-445"></span><span>
</span><span id="line-446"></span><span>    </span><span class="annot"><a href="#local-6989586621681072678"><span class="hs-identifier hs-type">go1</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#PsLoc"><span class="hs-identifier hs-type">PsLoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.StringBuffer.html#StringBuffer"><span class="hs-identifier hs-type">StringBuffer</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#PsLoc"><span class="hs-identifier hs-type">PsLoc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Char</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-447"></span><span>    </span><span id="local-6989586621681072678"><span class="annot"><span class="annottext">go1 :: PsLoc -&gt; StringBuffer -&gt; [(PsLoc, Char, String)]
</span><a href="#local-6989586621681072678"><span class="hs-identifier hs-var hs-var">go1</span></a></span></span><span> </span><span id="local-6989586621681072677"><span class="annot"><span class="annottext">PsLoc
</span><a href="#local-6989586621681072677"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681072676"><span class="annot"><span class="annottext">StringBuffer
</span><a href="#local-6989586621681072676"><span class="hs-identifier hs-var">sb</span></a></span></span><span>
</span><span id="line-448"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">StringBuffer -&gt; IsSafeImport
</span><a href="GHC.Data.StringBuffer.html#atEnd"><span class="hs-identifier hs-var">atEnd</span></a></span><span> </span><span class="annot"><span class="annottext">StringBuffer
</span><a href="#local-6989586621681072676"><span class="hs-identifier hs-var">sb</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-449"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">StringBuffer -&gt; (Char, StringBuffer)
</span><a href="GHC.Data.StringBuffer.html#nextChar"><span class="hs-identifier hs-var">nextChar</span></a></span><span> </span><span class="annot"><span class="annottext">StringBuffer
</span><a href="#local-6989586621681072676"><span class="hs-identifier hs-var">sb</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-450"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621681072675"><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621681072675"><span class="hs-identifier hs-var">chr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681072674"><span class="annot"><span class="annottext">StringBuffer
</span><a href="#local-6989586621681072674"><span class="hs-identifier hs-var">sb</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-451"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681072673"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681072673"><span class="hs-identifier hs-var">desc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Char -&gt; [(Char, String)] -&gt; Maybe String
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><a href="../../base/src/GHC.List.html#lookup"><span class="hs-identifier hs-var">lookup</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621681072675"><span class="hs-identifier hs-var">chr</span></a></span><span> </span><span class="annot"><span class="annottext">[(Char, String)]
</span><a href="GHC.Data.StringBuffer.html#bidirectionalFormatChars"><span class="hs-identifier hs-var">bidirectionalFormatChars</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-452"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PsLoc
</span><a href="#local-6989586621681072677"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621681072675"><span class="hs-identifier hs-var">chr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681072673"><span class="hs-identifier hs-var">desc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(PsLoc, Char, String)
-&gt; [(PsLoc, Char, String)] -&gt; [(PsLoc, Char, String)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">PsLoc -&gt; StringBuffer -&gt; [(PsLoc, Char, String)]
</span><a href="#local-6989586621681072678"><span class="hs-identifier hs-var">go1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PsLoc -&gt; Char -&gt; PsLoc
</span><a href="GHC.Types.SrcLoc.html#advancePsLoc"><span class="hs-identifier hs-var">advancePsLoc</span></a></span><span> </span><span class="annot"><span class="annottext">PsLoc
</span><a href="#local-6989586621681072677"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621681072675"><span class="hs-identifier hs-var">chr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StringBuffer
</span><a href="#local-6989586621681072674"><span class="hs-identifier hs-var">sb</span></a></span><span>
</span><span id="line-453"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PsLoc -&gt; StringBuffer -&gt; [(PsLoc, Char, String)]
</span><a href="#local-6989586621681072678"><span class="hs-identifier hs-var">go1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PsLoc -&gt; Char -&gt; PsLoc
</span><a href="GHC.Types.SrcLoc.html#advancePsLoc"><span class="hs-identifier hs-var">advancePsLoc</span></a></span><span> </span><span class="annot"><span class="annottext">PsLoc
</span><a href="#local-6989586621681072677"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><a href="#local-6989586621681072675"><span class="hs-identifier hs-var">chr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">StringBuffer
</span><a href="#local-6989586621681072674"><span class="hs-identifier hs-var">sb</span></a></span><span>
</span><span id="line-454"></span><span>
</span><span id="line-455"></span><span>
</span><span id="line-456"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-457"></span><span class="hs-comment">-- | If the renamed source has been kept, extract it. Dump it if requested.</span><span>
</span><span id="line-458"></span><span>
</span><span id="line-459"></span><span>
</span><span id="line-460"></span><span class="annot"><a href="GHC.Driver.Main.html#extract_renamed_stuff"><span class="hs-identifier hs-type">extract_renamed_stuff</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#RenamedStuff"><span class="hs-identifier hs-type">RenamedStuff</span></a></span><span>
</span><span id="line-461"></span><span id="extract_renamed_stuff"><span class="annot"><span class="annottext">extract_renamed_stuff :: ModSummary -&gt; TcGblEnv -&gt; Hsc RenamedStuff
</span><a href="GHC.Driver.Main.html#extract_renamed_stuff"><span class="hs-identifier hs-var hs-var">extract_renamed_stuff</span></a></span></span><span> </span><span id="local-6989586621681072671"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681072671"><span class="hs-identifier hs-var">mod_summary</span></a></span></span><span> </span><span id="local-6989586621681072670"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072670"><span class="hs-identifier hs-var">tc_result</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-462"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681072669"><span class="annot"><span class="annottext">rn_info :: RenamedStuff
</span><a href="#local-6989586621681072669"><span class="hs-identifier hs-var hs-var">rn_info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; RenamedStuff
</span><a href="GHC.Tc.Module.html#getRenamedStuff"><span class="hs-identifier hs-var">getRenamedStuff</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072670"><span class="hs-identifier hs-var">tc_result</span></a></span><span>
</span><span id="line-463"></span><span>
</span><span id="line-464"></span><span>    </span><span id="local-6989586621681072667"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072667"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-465"></span><span>    </span><span class="annot"><span class="annottext">IO () -&gt; Hsc ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; Hsc ()) -&gt; IO () -&gt; Hsc ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; DumpFlag -&gt; String -&gt; DumpFormat -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#dumpIfSet_dyn"><span class="hs-identifier hs-var">dumpIfSet_dyn</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072667"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_rn_ast"><span class="hs-identifier hs-var">Opt_D_dump_rn_ast</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Renamer&quot;</span></span><span>
</span><span id="line-466"></span><span>                </span><span class="annot"><span class="annottext">DumpFormat
</span><a href="GHC.Utils.Error.html#FormatHaskell"><span class="hs-identifier hs-var">FormatHaskell</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlankSrcSpan -&gt; RenamedStuff -&gt; SDoc
forall a. Data a =&gt; BlankSrcSpan -&gt; a -&gt; SDoc
</span><a href="GHC.Hs.Dump.html#showAstData"><span class="hs-identifier hs-var">showAstData</span></a></span><span> </span><span class="annot"><span class="annottext">BlankSrcSpan
</span><a href="GHC.Hs.Dump.html#NoBlankSrcSpan"><span class="hs-identifier hs-var">NoBlankSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">RenamedStuff
</span><a href="#local-6989586621681072669"><span class="hs-identifier hs-var">rn_info</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-467"></span><span>
</span><span id="line-468"></span><span>    </span><span class="hs-comment">-- Create HIE files</span><span>
</span><span id="line-469"></span><span>    </span><span class="annot"><span class="annottext">IsSafeImport -&gt; Hsc () -&gt; Hsc ()
forall (f :: * -&gt; *). Applicative f =&gt; IsSafeImport -&gt; f () -&gt; f ()
</span><a href="../../base/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; IsSafeImport
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_WriteHie"><span class="hs-identifier hs-var">Opt_WriteHie</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072667"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Hsc () -&gt; Hsc ()) -&gt; Hsc () -&gt; Hsc ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-470"></span><span>        </span><span class="hs-comment">-- I assume this fromJust is safe because `-fwrite-hie-file`</span><span>
</span><span id="line-471"></span><span>        </span><span class="hs-comment">-- enables the option which keeps the renamed source.</span><span>
</span><span id="line-472"></span><span>        </span><span id="local-6989586621681072663"><span class="annot"><span class="annottext">HieFile
</span><a href="#local-6989586621681072663"><span class="hs-identifier hs-var">hieFile</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModSummary
-&gt; TcGblEnv
-&gt; (HsGroup GhcRn, [LImportDecl GhcRn],
    Maybe [(LIE GhcRn, Avails)], Maybe LHsDocString)
-&gt; Hsc HieFile
</span><a href="GHC.Iface.Ext.Ast.html#mkHieFile"><span class="hs-identifier hs-var">mkHieFile</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681072671"><span class="hs-identifier hs-var">mod_summary</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072670"><span class="hs-identifier hs-var">tc_result</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RenamedStuff
-&gt; (HsGroup GhcRn, [LImportDecl GhcRn],
    Maybe [(LIE GhcRn, Avails)], Maybe LHsDocString)
forall a. HasCallStack =&gt; Maybe a -&gt; a
</span><a href="../../base/src/Data.Maybe.html#fromJust"><span class="hs-identifier hs-var">fromJust</span></a></span><span> </span><span class="annot"><span class="annottext">RenamedStuff
</span><a href="#local-6989586621681072669"><span class="hs-identifier hs-var">rn_info</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-473"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681072662"><span class="annot"><span class="annottext">out_file :: String
</span><a href="#local-6989586621681072662"><span class="hs-identifier hs-var hs-var">out_file</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModLocation -&gt; String
</span><a href="GHC.Unit.Module.Location.html#ml_hie_file"><span class="hs-identifier hs-var hs-var">ml_hie_file</span></a></span><span> </span><span class="annot"><span class="annottext">(ModLocation -&gt; String) -&gt; ModLocation -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; ModLocation
</span><a href="GHC.Driver.Types.html#ms_location"><span class="hs-identifier hs-var hs-var">ms_location</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681072671"><span class="hs-identifier hs-var">mod_summary</span></a></span><span>
</span><span id="line-474"></span><span>        </span><span class="annot"><span class="annottext">IO () -&gt; Hsc ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; Hsc ()) -&gt; IO () -&gt; Hsc ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; HieFile -&gt; IO ()
</span><a href="GHC.Iface.Ext.Binary.html#writeHieFile"><span class="hs-identifier hs-var">writeHieFile</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681072662"><span class="hs-identifier hs-var">out_file</span></a></span><span> </span><span class="annot"><span class="annottext">HieFile
</span><a href="#local-6989586621681072663"><span class="hs-identifier hs-var">hieFile</span></a></span><span>
</span><span id="line-475"></span><span>        </span><span class="annot"><span class="annottext">IO () -&gt; Hsc ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; Hsc ()) -&gt; IO () -&gt; Hsc ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; DumpFlag -&gt; String -&gt; DumpFormat -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#dumpIfSet_dyn"><span class="hs-identifier hs-var">dumpIfSet_dyn</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072667"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_hie"><span class="hs-identifier hs-var">Opt_D_dump_hie</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;HIE AST&quot;</span></span><span> </span><span class="annot"><span class="annottext">DumpFormat
</span><a href="GHC.Utils.Error.html#FormatHaskell"><span class="hs-identifier hs-var">FormatHaskell</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HieASTs Int -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">(HieASTs Int -&gt; SDoc) -&gt; HieASTs Int -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HieFile -&gt; HieASTs Int
</span><a href="GHC.Iface.Ext.Types.html#hie_asts"><span class="hs-identifier hs-var hs-var">hie_asts</span></a></span><span> </span><span class="annot"><span class="annottext">HieFile
</span><a href="#local-6989586621681072663"><span class="hs-identifier hs-var">hieFile</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-476"></span><span>
</span><span id="line-477"></span><span>        </span><span class="hs-comment">-- Validate HIE files</span><span>
</span><span id="line-478"></span><span>        </span><span class="annot"><span class="annottext">IsSafeImport -&gt; Hsc () -&gt; Hsc ()
forall (f :: * -&gt; *). Applicative f =&gt; IsSafeImport -&gt; f () -&gt; f ()
</span><a href="../../base/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; IsSafeImport
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_ValidateHie"><span class="hs-identifier hs-var">Opt_ValidateHie</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072667"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Hsc () -&gt; Hsc ()) -&gt; Hsc () -&gt; Hsc ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-479"></span><span>            </span><span id="local-6989586621681072658"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072658"><span class="hs-identifier hs-var">hs_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(HscEnv -&gt; WarningMessages -&gt; IO (HscEnv, WarningMessages))
-&gt; Hsc HscEnv
forall a.
(HscEnv -&gt; WarningMessages -&gt; IO (a, WarningMessages)) -&gt; Hsc a
</span><a href="GHC.Driver.Types.html#Hsc"><span class="hs-identifier hs-var">Hsc</span></a></span><span> </span><span class="annot"><span class="annottext">((HscEnv -&gt; WarningMessages -&gt; IO (HscEnv, WarningMessages))
 -&gt; Hsc HscEnv)
-&gt; (HscEnv -&gt; WarningMessages -&gt; IO (HscEnv, WarningMessages))
-&gt; Hsc HscEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681072657"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072657"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621681072656"><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681072656"><span class="hs-identifier hs-var">w</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(HscEnv, WarningMessages) -&gt; IO (HscEnv, WarningMessages)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072657"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681072656"><span class="hs-identifier hs-var">w</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-480"></span><span>            </span><span class="annot"><span class="annottext">IO () -&gt; Hsc ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; Hsc ()) -&gt; IO () -&gt; Hsc ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-481"></span><span>              </span><span class="hs-comment">-- Validate Scopes</span><span>
</span><span id="line-482"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Module -&gt; Map FastString (HieAST Int) -&gt; [SDoc]
forall a. Module -&gt; Map FastString (HieAST a) -&gt; [SDoc]
</span><a href="GHC.Iface.Ext.Debug.html#validateScopes"><span class="hs-identifier hs-var">validateScopes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HieFile -&gt; Module
</span><a href="GHC.Iface.Ext.Types.html#hie_module"><span class="hs-identifier hs-var hs-var">hie_module</span></a></span><span> </span><span class="annot"><span class="annottext">HieFile
</span><a href="#local-6989586621681072663"><span class="hs-identifier hs-var">hieFile</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Map FastString (HieAST Int) -&gt; [SDoc])
-&gt; Map FastString (HieAST Int) -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HieASTs Int -&gt; Map FastString (HieAST Int)
forall a. HieASTs a -&gt; Map FastString (HieAST a)
</span><a href="GHC.Iface.Ext.Types.html#getAsts"><span class="hs-identifier hs-var hs-var">getAsts</span></a></span><span> </span><span class="annot"><span class="annottext">(HieASTs Int -&gt; Map FastString (HieAST Int))
-&gt; HieASTs Int -&gt; Map FastString (HieAST Int)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HieFile -&gt; HieASTs Int
</span><a href="GHC.Iface.Ext.Types.html#hie_asts"><span class="hs-identifier hs-var hs-var">hie_asts</span></a></span><span> </span><span class="annot"><span class="annottext">HieFile
</span><a href="#local-6989586621681072663"><span class="hs-identifier hs-var">hieFile</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-483"></span><span>                  </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#putMsg"><span class="hs-identifier hs-var">putMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072667"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; IO ()) -&gt; SDoc -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Got valid scopes&quot;</span></span><span>
</span><span id="line-484"></span><span>                  </span><span id="local-6989586621681072654"><span class="annot"><span class="annottext">[SDoc]
</span><a href="#local-6989586621681072654"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-485"></span><span>                    </span><span class="annot"><span class="annottext">DynFlags -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#putMsg"><span class="hs-identifier hs-var">putMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072667"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; IO ()) -&gt; SDoc -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Got invalid scopes&quot;</span></span><span>
</span><span id="line-486"></span><span>                    </span><span class="annot"><span class="annottext">(SDoc -&gt; IO ()) -&gt; [SDoc] -&gt; IO ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><a href="../../base/src/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#putMsg"><span class="hs-identifier hs-var">putMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072667"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[SDoc]
</span><a href="#local-6989586621681072654"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-487"></span><span>              </span><span class="hs-comment">-- Roundtrip testing</span><span>
</span><span id="line-488"></span><span>              </span><span id="local-6989586621681072652"><span class="annot"><span class="annottext">HieFileResult
</span><a href="#local-6989586621681072652"><span class="hs-identifier hs-var">file'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NameCacheUpdater -&gt; String -&gt; IO HieFileResult
</span><a href="GHC.Iface.Ext.Binary.html#readHieFile"><span class="hs-identifier hs-var">readHieFile</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(forall c. (NameCache -&gt; (NameCache, c)) -&gt; IO c)
-&gt; NameCacheUpdater
</span><a href="GHC.Iface.Env.html#NCU"><span class="hs-identifier hs-var">NCU</span></a></span><span> </span><span class="annot"><span class="annottext">((forall c. (NameCache -&gt; (NameCache, c)) -&gt; IO c)
 -&gt; NameCacheUpdater)
-&gt; (forall c. (NameCache -&gt; (NameCache, c)) -&gt; IO c)
-&gt; NameCacheUpdater
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">IORef NameCache -&gt; (NameCache -&gt; (NameCache, c)) -&gt; IO c
forall c. IORef NameCache -&gt; (NameCache -&gt; (NameCache, c)) -&gt; IO c
</span><a href="GHC.Driver.Types.html#updNameCache"><span class="hs-identifier hs-var">updNameCache</span></a></span><span> </span><span class="annot"><span class="annottext">(IORef NameCache -&gt; (NameCache -&gt; (NameCache, c)) -&gt; IO c)
-&gt; IORef NameCache -&gt; (NameCache -&gt; (NameCache, c)) -&gt; IO c
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; IORef NameCache
</span><a href="GHC.Driver.Types.html#hsc_NC"><span class="hs-identifier hs-var hs-var">hsc_NC</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072658"><span class="hs-identifier hs-var">hs_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681072662"><span class="hs-identifier hs-var">out_file</span></a></span><span>
</span><span id="line-489"></span><span>              </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Diff HieFile
</span><a href="GHC.Iface.Ext.Debug.html#diffFile"><span class="hs-identifier hs-var">diffFile</span></a></span><span> </span><span class="annot"><span class="annottext">HieFile
</span><a href="#local-6989586621681072663"><span class="hs-identifier hs-var">hieFile</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HieFileResult -&gt; HieFile
</span><a href="GHC.Iface.Ext.Binary.html#hie_file_result"><span class="hs-identifier hs-var hs-var">hie_file_result</span></a></span><span> </span><span class="annot"><span class="annottext">HieFileResult
</span><a href="#local-6989586621681072652"><span class="hs-identifier hs-var">file'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-490"></span><span>                </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-491"></span><span>                  </span><span class="annot"><span class="annottext">DynFlags -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#putMsg"><span class="hs-identifier hs-var">putMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072667"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; IO ()) -&gt; SDoc -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Got no roundtrip errors&quot;</span></span><span>
</span><span id="line-492"></span><span>                </span><span id="local-6989586621681072649"><span class="annot"><span class="annottext">[SDoc]
</span><a href="#local-6989586621681072649"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-493"></span><span>                  </span><span class="annot"><span class="annottext">DynFlags -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#putMsg"><span class="hs-identifier hs-var">putMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072667"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; IO ()) -&gt; SDoc -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Got roundtrip errors&quot;</span></span><span>
</span><span id="line-494"></span><span>                  </span><span class="annot"><span class="annottext">(SDoc -&gt; IO ()) -&gt; [SDoc] -&gt; IO ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><a href="../../base/src/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#putMsg"><span class="hs-identifier hs-var">putMsg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; DumpFlag -&gt; DynFlags
</span><a href="GHC.Driver.Session.html#dopt_set"><span class="hs-identifier hs-var">dopt_set</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072667"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_ppr_debug"><span class="hs-identifier hs-var">Opt_D_ppr_debug</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[SDoc]
</span><a href="#local-6989586621681072649"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-495"></span><span>    </span><span class="annot"><span class="annottext">RenamedStuff -&gt; Hsc RenamedStuff
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">RenamedStuff
</span><a href="#local-6989586621681072669"><span class="hs-identifier hs-var">rn_info</span></a></span><span>
</span><span id="line-496"></span><span>
</span><span id="line-497"></span><span>
</span><span id="line-498"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-499"></span><span class="hs-comment">-- | Rename and typecheck a module, additionally returning the renamed syntax</span><span>
</span><span id="line-500"></span><span class="annot"><a href="GHC.Driver.Main.html#hscTypecheckRename"><span class="hs-identifier hs-type">hscTypecheckRename</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HsParsedModule"><span class="hs-identifier hs-type">HsParsedModule</span></a></span><span>
</span><span id="line-501"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#RenamedStuff"><span class="hs-identifier hs-type">RenamedStuff</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-502"></span><span id="hscTypecheckRename"><span class="annot"><span class="annottext">hscTypecheckRename :: HscEnv
-&gt; ModSummary -&gt; HsParsedModule -&gt; IO (TcGblEnv, RenamedStuff)
</span><a href="GHC.Driver.Main.html#hscTypecheckRename"><span class="hs-identifier hs-var hs-var">hscTypecheckRename</span></a></span></span><span> </span><span id="local-6989586621681072646"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072646"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681072645"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681072645"><span class="hs-identifier hs-var">mod_summary</span></a></span></span><span> </span><span id="local-6989586621681072644"><span class="annot"><span class="annottext">HsParsedModule
</span><a href="#local-6989586621681072644"><span class="hs-identifier hs-var">rdr_module</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; Hsc (TcGblEnv, RenamedStuff) -&gt; IO (TcGblEnv, RenamedStuff)
forall a. HscEnv -&gt; Hsc a -&gt; IO a
</span><a href="GHC.Driver.Types.html#runHsc"><span class="hs-identifier hs-var">runHsc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072646"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(Hsc (TcGblEnv, RenamedStuff) -&gt; IO (TcGblEnv, RenamedStuff))
-&gt; Hsc (TcGblEnv, RenamedStuff) -&gt; IO (TcGblEnv, RenamedStuff)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-503"></span><span>    </span><span class="annot"><span class="annottext">IsSafeImport
-&gt; ModSummary
-&gt; Maybe HsParsedModule
-&gt; Hsc (TcGblEnv, RenamedStuff)
</span><a href="GHC.Driver.Main.html#hsc_typecheck"><span class="hs-identifier hs-var">hsc_typecheck</span></a></span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681072645"><span class="hs-identifier hs-var">mod_summary</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsParsedModule -&gt; Maybe HsParsedModule
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">HsParsedModule
</span><a href="#local-6989586621681072644"><span class="hs-identifier hs-var">rdr_module</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-504"></span><span>
</span><span id="line-505"></span><span>
</span><span id="line-506"></span><span class="hs-comment">-- | A bunch of logic piled around @tcRnModule'@, concerning a) backpack</span><span>
</span><span id="line-507"></span><span class="hs-comment">-- b) concerning dumping rename info and hie files. It would be nice to further</span><span>
</span><span id="line-508"></span><span class="hs-comment">-- separate this stuff out, probably in conjunction better separating renaming</span><span>
</span><span id="line-509"></span><span class="hs-comment">-- and type checking (#17781).</span><span>
</span><span id="line-510"></span><span class="annot"><a href="GHC.Driver.Main.html#hsc_typecheck"><span class="hs-identifier hs-type">hsc_typecheck</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-comment">-- ^ Keep renamed source?</span><span>
</span><span id="line-511"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HsParsedModule"><span class="hs-identifier hs-type">HsParsedModule</span></a></span><span>
</span><span id="line-512"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#RenamedStuff"><span class="hs-identifier hs-type">RenamedStuff</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-513"></span><span id="hsc_typecheck"><span class="annot"><span class="annottext">hsc_typecheck :: IsSafeImport
-&gt; ModSummary
-&gt; Maybe HsParsedModule
-&gt; Hsc (TcGblEnv, RenamedStuff)
</span><a href="GHC.Driver.Main.html#hsc_typecheck"><span class="hs-identifier hs-var hs-var">hsc_typecheck</span></a></span></span><span> </span><span id="local-6989586621681072642"><span class="annot"><span class="annottext">IsSafeImport
</span><a href="#local-6989586621681072642"><span class="hs-identifier hs-var">keep_rn</span></a></span></span><span> </span><span id="local-6989586621681072641"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681072641"><span class="hs-identifier hs-var">mod_summary</span></a></span></span><span> </span><span id="local-6989586621681072640"><span class="annot"><span class="annottext">Maybe HsParsedModule
</span><a href="#local-6989586621681072640"><span class="hs-identifier hs-var">mb_rdr_module</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-514"></span><span>    </span><span id="local-6989586621681072639"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072639"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc HscEnv
</span><a href="GHC.Driver.Main.html#getHscEnv"><span class="hs-identifier hs-var">getHscEnv</span></a></span><span>
</span><span id="line-515"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681072638"><span class="annot"><span class="annottext">hsc_src :: HscSource
</span><a href="#local-6989586621681072638"><span class="hs-identifier hs-var hs-var">hsc_src</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; HscSource
</span><a href="GHC.Driver.Types.html#ms_hsc_src"><span class="hs-identifier hs-var hs-var">ms_hsc_src</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681072641"><span class="hs-identifier hs-var">mod_summary</span></a></span><span>
</span><span id="line-516"></span><span>        </span><span id="local-6989586621681072637"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621681072637"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072639"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-517"></span><span>        </span><span id="local-6989586621681072636"><span class="annot"><span class="annottext">outer_mod :: Module
</span><a href="#local-6989586621681072636"><span class="hs-identifier hs-var hs-var">outer_mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; Module
</span><a href="GHC.Driver.Types.html#ms_mod"><span class="hs-identifier hs-var hs-var">ms_mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681072641"><span class="hs-identifier hs-var">mod_summary</span></a></span><span>
</span><span id="line-518"></span><span>        </span><span id="local-6989586621681072635"><span class="annot"><span class="annottext">mod_name :: ModuleName
</span><a href="#local-6989586621681072635"><span class="hs-identifier hs-var hs-var">mod_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681072636"><span class="hs-identifier hs-var">outer_mod</span></a></span><span>
</span><span id="line-519"></span><span>        </span><span id="local-6989586621681072633"><span class="annot"><span class="annottext">outer_mod' :: Module
</span><a href="#local-6989586621681072633"><span class="hs-identifier hs-var hs-var">outer_mod'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; ModuleName -&gt; Module
</span><a href="GHC.Driver.Session.html#mkHomeModule"><span class="hs-identifier hs-var">mkHomeModule</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072637"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681072635"><span class="hs-identifier hs-var">mod_name</span></a></span><span>
</span><span id="line-520"></span><span>        </span><span id="local-6989586621681072631"><span class="annot"><span class="annottext">inner_mod :: Module
</span><a href="#local-6989586621681072631"><span class="hs-identifier hs-var hs-var">inner_mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; ModuleName -&gt; Module
</span><a href="GHC.Driver.Session.html#canonicalizeHomeModule"><span class="hs-identifier hs-var">canonicalizeHomeModule</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072637"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681072635"><span class="hs-identifier hs-var">mod_name</span></a></span><span>
</span><span id="line-521"></span><span>        </span><span id="local-6989586621681072629"><span class="annot"><span class="annottext">src_filename :: String
</span><a href="#local-6989586621681072629"><span class="hs-identifier hs-var hs-var">src_filename</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; String
</span><a href="GHC.Driver.Types.html#ms_hspp_file"><span class="hs-identifier hs-var hs-var">ms_hspp_file</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681072641"><span class="hs-identifier hs-var">mod_summary</span></a></span><span>
</span><span id="line-522"></span><span>        </span><span id="local-6989586621681072628"><span class="annot"><span class="annottext">real_loc :: RealSrcSpan
</span><a href="#local-6989586621681072628"><span class="hs-identifier hs-var hs-var">real_loc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RealSrcLoc -&gt; RealSrcSpan
</span><a href="GHC.Types.SrcLoc.html#realSrcLocSpan"><span class="hs-identifier hs-var">realSrcLocSpan</span></a></span><span> </span><span class="annot"><span class="annottext">(RealSrcLoc -&gt; RealSrcSpan) -&gt; RealSrcLoc -&gt; RealSrcSpan
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; Int -&gt; Int -&gt; RealSrcLoc
</span><a href="GHC.Types.SrcLoc.html#mkRealSrcLoc"><span class="hs-identifier hs-var">mkRealSrcLoc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#mkFastString"><span class="hs-identifier hs-var">mkFastString</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681072629"><span class="hs-identifier hs-var">src_filename</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-523"></span><span>        </span><span id="local-6989586621681072626"><span class="annot"><span class="annottext">keep_rn' :: IsSafeImport
</span><a href="#local-6989586621681072626"><span class="hs-identifier hs-var hs-var">keep_rn'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; IsSafeImport
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_WriteHie"><span class="hs-identifier hs-var">Opt_WriteHie</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072637"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">IsSafeImport -&gt; IsSafeImport -&gt; IsSafeImport
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><a href="#local-6989586621681072642"><span class="hs-identifier hs-var">keep_rn</span></a></span><span>
</span><span id="line-524"></span><span>    </span><span class="hs-identifier">MASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isHomeModule</span><span> </span><span class="hs-identifier">dflags</span><span> </span><span class="hs-identifier">outer_mod</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-525"></span><span>    </span><span id="local-6989586621681072623"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072623"><span class="hs-identifier hs-var">tc_result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621681072638"><span class="hs-identifier hs-var">hsc_src</span></a></span><span> </span><span class="annot"><span class="annottext">HscSource -&gt; HscSource -&gt; IsSafeImport
forall a. Eq a =&gt; a -&gt; a -&gt; IsSafeImport
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="GHC.Driver.Phases.html#HsigFile"><span class="hs-identifier hs-var">HsigFile</span></a></span><span> </span><span class="annot"><span class="annottext">IsSafeImport -&gt; IsSafeImport -&gt; IsSafeImport
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">IsSafeImport -&gt; IsSafeImport
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; IsSafeImport
forall u. GenModule (GenUnit u) -&gt; IsSafeImport
</span><a href="GHC.Unit.Module.html#isHoleModule"><span class="hs-identifier hs-var">isHoleModule</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681072631"><span class="hs-identifier hs-var">inner_mod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-526"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">IO ((WarningMessages, WarningMessages), Maybe TcGblEnv)
-&gt; Hsc TcGblEnv
forall a. IO ((WarningMessages, WarningMessages), Maybe a) -&gt; Hsc a
</span><a href="GHC.Driver.Main.html#ioMsgMaybe"><span class="hs-identifier hs-var">ioMsgMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ((WarningMessages, WarningMessages), Maybe TcGblEnv)
 -&gt; Hsc TcGblEnv)
-&gt; IO ((WarningMessages, WarningMessages), Maybe TcGblEnv)
-&gt; Hsc TcGblEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; Module
-&gt; RealSrcSpan
-&gt; IO ((WarningMessages, WarningMessages), Maybe TcGblEnv)
</span><a href="GHC.Tc.Utils.Backpack.html#tcRnInstantiateSignature"><span class="hs-identifier hs-var">tcRnInstantiateSignature</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072639"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681072633"><span class="hs-identifier hs-var">outer_mod'</span></a></span><span> </span><span class="annot"><span class="annottext">RealSrcSpan
</span><a href="#local-6989586621681072628"><span class="hs-identifier hs-var">real_loc</span></a></span><span>
</span><span id="line-527"></span><span>        </span><span class="hs-keyword">else</span><span>
</span><span id="line-528"></span><span>         </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621681072620"><span class="annot"><span class="annottext">HsParsedModule
</span><a href="#local-6989586621681072620"><span class="hs-identifier hs-var">hpm</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe HsParsedModule
</span><a href="#local-6989586621681072640"><span class="hs-identifier hs-var">mb_rdr_module</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-529"></span><span>                    </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681072619"><span class="annot"><span class="annottext">HsParsedModule
</span><a href="#local-6989586621681072619"><span class="hs-identifier hs-var">hpm</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HsParsedModule -&gt; Hsc HsParsedModule
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">HsParsedModule
</span><a href="#local-6989586621681072619"><span class="hs-identifier hs-var">hpm</span></a></span><span>
</span><span id="line-530"></span><span>                    </span><span class="annot"><span class="annottext">Maybe HsParsedModule
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; Hsc HsParsedModule
</span><a href="GHC.Driver.Main.html#hscParse%27"><span class="hs-identifier hs-var">hscParse'</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681072641"><span class="hs-identifier hs-var">mod_summary</span></a></span><span>
</span><span id="line-531"></span><span>            </span><span id="local-6989586621681072618"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072618"><span class="hs-identifier hs-var">tc_result0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; IsSafeImport -&gt; HsParsedModule -&gt; Hsc TcGblEnv
</span><a href="GHC.Driver.Main.html#tcRnModule%27"><span class="hs-identifier hs-var">tcRnModule'</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681072641"><span class="hs-identifier hs-var">mod_summary</span></a></span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><a href="#local-6989586621681072626"><span class="hs-identifier hs-var">keep_rn'</span></a></span><span> </span><span class="annot"><span class="annottext">HsParsedModule
</span><a href="#local-6989586621681072620"><span class="hs-identifier hs-var">hpm</span></a></span><span>
</span><span id="line-532"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621681072638"><span class="hs-identifier hs-var">hsc_src</span></a></span><span> </span><span class="annot"><span class="annottext">HscSource -&gt; HscSource -&gt; IsSafeImport
forall a. Eq a =&gt; a -&gt; a -&gt; IsSafeImport
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="GHC.Driver.Phases.html#HsigFile"><span class="hs-identifier hs-var">HsigFile</span></a></span><span>
</span><span id="line-533"></span><span>                </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681072617"><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621681072617"><span class="hs-identifier hs-var">iface</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Fingerprint
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModDetails
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (ModIface, Maybe Fingerprint, ModDetails)
-&gt; Hsc (ModIface, Maybe Fingerprint, ModDetails)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (ModIface, Maybe Fingerprint, ModDetails)
 -&gt; Hsc (ModIface, Maybe Fingerprint, ModDetails))
-&gt; IO (ModIface, Maybe Fingerprint, ModDetails)
-&gt; Hsc (ModIface, Maybe Fingerprint, ModDetails)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; TcGblEnv
-&gt; Maybe Fingerprint
-&gt; IO (ModIface, Maybe Fingerprint, ModDetails)
</span><a href="GHC.Driver.Main.html#hscSimpleIface"><span class="hs-identifier hs-var">hscSimpleIface</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072639"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072618"><span class="hs-identifier hs-var">tc_result0</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Fingerprint
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-534"></span><span>                        </span><span class="annot"><span class="annottext">IO ((WarningMessages, WarningMessages), Maybe TcGblEnv)
-&gt; Hsc TcGblEnv
forall a. IO ((WarningMessages, WarningMessages), Maybe a) -&gt; Hsc a
</span><a href="GHC.Driver.Main.html#ioMsgMaybe"><span class="hs-identifier hs-var">ioMsgMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ((WarningMessages, WarningMessages), Maybe TcGblEnv)
 -&gt; Hsc TcGblEnv)
-&gt; IO ((WarningMessages, WarningMessages), Maybe TcGblEnv)
-&gt; Hsc TcGblEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-535"></span><span>                            </span><span class="annot"><span class="annottext">HscEnv
-&gt; HsParsedModule
-&gt; TcGblEnv
-&gt; ModIface
-&gt; IO ((WarningMessages, WarningMessages), Maybe TcGblEnv)
</span><a href="GHC.Tc.Utils.Backpack.html#tcRnMergeSignatures"><span class="hs-identifier hs-var">tcRnMergeSignatures</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072639"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">HsParsedModule
</span><a href="#local-6989586621681072620"><span class="hs-identifier hs-var">hpm</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072618"><span class="hs-identifier hs-var">tc_result0</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621681072617"><span class="hs-identifier hs-var">iface</span></a></span><span>
</span><span id="line-536"></span><span>                </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; Hsc TcGblEnv
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072618"><span class="hs-identifier hs-var">tc_result0</span></a></span><span>
</span><span id="line-537"></span><span>    </span><span class="hs-comment">-- TODO are we extracting anything when we merely instantiate a signature?</span><span>
</span><span id="line-538"></span><span>    </span><span class="hs-comment">-- If not, try to move this into the &quot;else&quot; case above.</span><span>
</span><span id="line-539"></span><span>    </span><span id="local-6989586621681072614"><span class="annot"><span class="annottext">RenamedStuff
</span><a href="#local-6989586621681072614"><span class="hs-identifier hs-var">rn_info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; TcGblEnv -&gt; Hsc RenamedStuff
</span><a href="GHC.Driver.Main.html#extract_renamed_stuff"><span class="hs-identifier hs-var">extract_renamed_stuff</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681072641"><span class="hs-identifier hs-var">mod_summary</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072623"><span class="hs-identifier hs-var">tc_result</span></a></span><span>
</span><span id="line-540"></span><span>    </span><span class="annot"><span class="annottext">(TcGblEnv, RenamedStuff) -&gt; Hsc (TcGblEnv, RenamedStuff)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072623"><span class="hs-identifier hs-var">tc_result</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RenamedStuff
</span><a href="#local-6989586621681072614"><span class="hs-identifier hs-var">rn_info</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-541"></span><span>
</span><span id="line-542"></span><span class="hs-comment">-- wrapper around tcRnModule to handle safe haskell extras</span><span>
</span><span id="line-543"></span><span class="annot"><a href="GHC.Driver.Main.html#tcRnModule%27"><span class="hs-identifier hs-type">tcRnModule'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HsParsedModule"><span class="hs-identifier hs-type">HsParsedModule</span></a></span><span>
</span><span id="line-544"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span>
</span><span id="line-545"></span><span id="tcRnModule%27"><span class="annot"><span class="annottext">tcRnModule' :: ModSummary -&gt; IsSafeImport -&gt; HsParsedModule -&gt; Hsc TcGblEnv
</span><a href="GHC.Driver.Main.html#tcRnModule%27"><span class="hs-identifier hs-var hs-var">tcRnModule'</span></a></span></span><span> </span><span id="local-6989586621681072613"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681072613"><span class="hs-identifier hs-var">sum</span></a></span></span><span> </span><span id="local-6989586621681072612"><span class="annot"><span class="annottext">IsSafeImport
</span><a href="#local-6989586621681072612"><span class="hs-identifier hs-var">save_rn_syntax</span></a></span></span><span> </span><span id="local-6989586621681072611"><span class="annot"><span class="annottext">HsParsedModule
</span><a href="#local-6989586621681072611"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-546"></span><span>    </span><span id="local-6989586621681072610"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072610"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc HscEnv
</span><a href="GHC.Driver.Main.html#getHscEnv"><span class="hs-identifier hs-var">getHscEnv</span></a></span><span>
</span><span id="line-547"></span><span>    </span><span id="local-6989586621681072609"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072609"><span class="hs-identifier hs-var">dflags</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-548"></span><span>
</span><span id="line-549"></span><span>    </span><span class="hs-comment">-- -Wmissing-safe-haskell-mode</span><span>
</span><span id="line-550"></span><span>    </span><span class="annot"><span class="annottext">IsSafeImport -&gt; Hsc () -&gt; Hsc ()
forall (f :: * -&gt; *). Applicative f =&gt; IsSafeImport -&gt; f () -&gt; f ()
</span><a href="../../base/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsSafeImport -&gt; IsSafeImport
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; IsSafeImport
</span><a href="GHC.Driver.Session.html#safeHaskellModeEnabled"><span class="hs-identifier hs-var">safeHaskellModeEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072609"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-551"></span><span>          </span><span class="annot"><span class="annottext">IsSafeImport -&gt; IsSafeImport -&gt; IsSafeImport
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">WarningFlag -&gt; DynFlags -&gt; IsSafeImport
</span><a href="GHC.Driver.Session.html#wopt"><span class="hs-identifier hs-var">wopt</span></a></span><span> </span><span class="annot"><span class="annottext">WarningFlag
</span><a href="GHC.Driver.Flags.html#Opt_WarnMissingSafeHaskellMode"><span class="hs-identifier hs-var">Opt_WarnMissingSafeHaskellMode</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072609"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Hsc () -&gt; Hsc ()) -&gt; Hsc () -&gt; Hsc ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-552"></span><span>        </span><span class="annot"><span class="annottext">WarningMessages -&gt; Hsc ()
</span><a href="GHC.Driver.Main.html#logWarnings"><span class="hs-identifier hs-var">logWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">(WarningMessages -&gt; Hsc ()) -&gt; WarningMessages -&gt; Hsc ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ErrMsg -&gt; WarningMessages
forall a. a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#unitBag"><span class="hs-identifier hs-var">unitBag</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrMsg -&gt; WarningMessages) -&gt; ErrMsg -&gt; WarningMessages
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-553"></span><span>        </span><span class="annot"><span class="annottext">WarnReason -&gt; ErrMsg -&gt; ErrMsg
</span><a href="GHC.Utils.Error.html#makeIntoWarning"><span class="hs-identifier hs-var">makeIntoWarning</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WarningFlag -&gt; WarnReason
</span><a href="GHC.Driver.Flags.html#Reason"><span class="hs-identifier hs-var">Reason</span></a></span><span> </span><span class="annot"><span class="annottext">WarningFlag
</span><a href="GHC.Driver.Flags.html#Opt_WarnMissingSafeHaskellMode"><span class="hs-identifier hs-var">Opt_WarnMissingSafeHaskellMode</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ErrMsg -&gt; ErrMsg) -&gt; ErrMsg -&gt; ErrMsg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-554"></span><span>        </span><span class="annot"><span class="annottext">DynFlags -&gt; SrcSpan -&gt; SDoc -&gt; ErrMsg
</span><a href="GHC.Utils.Error.html#mkPlainWarnMsg"><span class="hs-identifier hs-var">mkPlainWarnMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072609"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Located HsModule -&gt; SrcSpan
forall l e. GenLocated l e -&gt; l
</span><a href="GHC.Types.SrcLoc.html#getLoc"><span class="hs-identifier hs-var">getLoc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsParsedModule -&gt; Located HsModule
</span><a href="GHC.Driver.Types.html#hpm_module"><span class="hs-identifier hs-var hs-var">hpm_module</span></a></span><span> </span><span class="annot"><span class="annottext">HsParsedModule
</span><a href="#local-6989586621681072611"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; ErrMsg) -&gt; SDoc -&gt; ErrMsg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-555"></span><span>        </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681072604"><span class="hs-identifier hs-var">warnMissingSafeHaskellMode</span></a></span><span>
</span><span id="line-556"></span><span>
</span><span id="line-557"></span><span>    </span><span id="local-6989586621681072603"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072603"><span class="hs-identifier hs-var">tcg_res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;Typecheck-Rename&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-558"></span><span>               </span><span class="annot"><span class="annottext">IO ((WarningMessages, WarningMessages), Maybe TcGblEnv)
-&gt; Hsc TcGblEnv
forall a. IO ((WarningMessages, WarningMessages), Maybe a) -&gt; Hsc a
</span><a href="GHC.Driver.Main.html#ioMsgMaybe"><span class="hs-identifier hs-var">ioMsgMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ((WarningMessages, WarningMessages), Maybe TcGblEnv)
 -&gt; Hsc TcGblEnv)
-&gt; IO ((WarningMessages, WarningMessages), Maybe TcGblEnv)
-&gt; Hsc TcGblEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-559"></span><span>                   </span><span class="annot"><span class="annottext">HscEnv
-&gt; ModSummary
-&gt; IsSafeImport
-&gt; HsParsedModule
-&gt; IO ((WarningMessages, WarningMessages), Maybe TcGblEnv)
</span><a href="GHC.Tc.Module.html#tcRnModule"><span class="hs-identifier hs-var">tcRnModule</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072610"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681072613"><span class="hs-identifier hs-var">sum</span></a></span><span>
</span><span id="line-560"></span><span>                     </span><span class="annot"><span class="annottext">IsSafeImport
</span><a href="#local-6989586621681072612"><span class="hs-identifier hs-var">save_rn_syntax</span></a></span><span> </span><span class="annot"><span class="annottext">HsParsedModule
</span><a href="#local-6989586621681072611"><span class="hs-identifier hs-var">mod</span></a></span><span>
</span><span id="line-561"></span><span>
</span><span id="line-562"></span><span>    </span><span class="hs-comment">-- See Note [Safe Haskell Overlapping Instances Implementation]</span><span>
</span><span id="line-563"></span><span>    </span><span class="hs-comment">-- although this is used for more than just that failure case.</span><span>
</span><span id="line-564"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681072601"><span class="annot"><span class="annottext">IsSafeImport
</span><a href="#local-6989586621681072601"><span class="hs-identifier hs-var">tcSafeOK</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681072600"><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681072600"><span class="hs-identifier hs-var">whyUnsafe</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (IsSafeImport, WarningMessages)
-&gt; Hsc (IsSafeImport, WarningMessages)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (IsSafeImport, WarningMessages)
 -&gt; Hsc (IsSafeImport, WarningMessages))
-&gt; IO (IsSafeImport, WarningMessages)
-&gt; Hsc (IsSafeImport, WarningMessages)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">IORef (IsSafeImport, WarningMessages)
-&gt; IO (IsSafeImport, WarningMessages)
forall a. IORef a -&gt; IO a
</span><a href="../../base/src/GHC.IORef.html#readIORef"><span class="hs-identifier hs-var">readIORef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; IORef (IsSafeImport, WarningMessages)
</span><a href="GHC.Tc.Types.html#tcg_safeInfer"><span class="hs-identifier hs-var hs-var">tcg_safeInfer</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072603"><span class="hs-identifier hs-var">tcg_res</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-565"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681072597"><span class="annot"><span class="annottext">allSafeOK :: IsSafeImport
</span><a href="#local-6989586621681072597"><span class="hs-identifier hs-var hs-var">allSafeOK</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; IsSafeImport
</span><a href="GHC.Driver.Session.html#safeInferred"><span class="hs-identifier hs-var hs-var">safeInferred</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072609"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">IsSafeImport -&gt; IsSafeImport -&gt; IsSafeImport
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><a href="#local-6989586621681072601"><span class="hs-identifier hs-var">tcSafeOK</span></a></span><span>
</span><span id="line-566"></span><span>
</span><span id="line-567"></span><span>    </span><span class="hs-comment">-- end of the safe haskell line, how to respond to user?</span><span>
</span><span id="line-568"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">IsSafeImport -&gt; IsSafeImport
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; IsSafeImport
</span><a href="GHC.Driver.Session.html#safeHaskellOn"><span class="hs-identifier hs-var">safeHaskellOn</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072609"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-569"></span><span>         </span><span class="annot"><span class="annottext">IsSafeImport -&gt; IsSafeImport -&gt; IsSafeImport
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; IsSafeImport
</span><a href="GHC.Driver.Session.html#safeInferOn"><span class="hs-identifier hs-var">safeInferOn</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072609"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">IsSafeImport -&gt; IsSafeImport -&gt; IsSafeImport
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">IsSafeImport -&gt; IsSafeImport
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><a href="#local-6989586621681072597"><span class="hs-identifier hs-var">allSafeOK</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-570"></span><span>      </span><span class="hs-comment">-- if safe Haskell off or safe infer failed, mark unsafe</span><span>
</span><span id="line-571"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; WarningMessages -&gt; Hsc TcGblEnv
</span><a href="GHC.Driver.Main.html#markUnsafeInfer"><span class="hs-identifier hs-var">markUnsafeInfer</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072603"><span class="hs-identifier hs-var">tcg_res</span></a></span><span> </span><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681072600"><span class="hs-identifier hs-var">whyUnsafe</span></a></span><span>
</span><span id="line-572"></span><span>
</span><span id="line-573"></span><span>      </span><span class="hs-comment">-- module (could be) safe, throw warning if needed</span><span>
</span><span id="line-574"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-575"></span><span>          </span><span id="local-6989586621681072592"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072592"><span class="hs-identifier hs-var">tcg_res'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; Hsc TcGblEnv
</span><a href="GHC.Driver.Main.html#hscCheckSafeImports"><span class="hs-identifier hs-var">hscCheckSafeImports</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072603"><span class="hs-identifier hs-var">tcg_res</span></a></span><span>
</span><span id="line-576"></span><span>          </span><span id="local-6989586621681072590"><span class="annot"><span class="annottext">IsSafeImport
</span><a href="#local-6989586621681072590"><span class="hs-keyword hs-var">safe</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO IsSafeImport -&gt; Hsc IsSafeImport
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO IsSafeImport -&gt; Hsc IsSafeImport)
-&gt; IO IsSafeImport -&gt; Hsc IsSafeImport
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(IsSafeImport, WarningMessages) -&gt; IsSafeImport
forall a b. (a, b) -&gt; a
</span><a href="../../base/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">((IsSafeImport, WarningMessages) -&gt; IsSafeImport)
-&gt; IO (IsSafeImport, WarningMessages) -&gt; IO IsSafeImport
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">IORef (IsSafeImport, WarningMessages)
-&gt; IO (IsSafeImport, WarningMessages)
forall a. IORef a -&gt; IO a
</span><a href="../../base/src/GHC.IORef.html#readIORef"><span class="hs-identifier hs-var">readIORef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; IORef (IsSafeImport, WarningMessages)
</span><a href="GHC.Tc.Types.html#tcg_safeInfer"><span class="hs-identifier hs-var hs-var">tcg_safeInfer</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072592"><span class="hs-identifier hs-var">tcg_res'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-577"></span><span>          </span><span class="annot"><span class="annottext">IsSafeImport -&gt; Hsc () -&gt; Hsc ()
forall (f :: * -&gt; *). Applicative f =&gt; IsSafeImport -&gt; f () -&gt; f ()
</span><a href="../../base/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><a href="#local-6989586621681072590"><span class="hs-keyword hs-var">safe</span></a></span><span> </span><span class="annot"><span class="annottext">(Hsc () -&gt; Hsc ()) -&gt; Hsc () -&gt; Hsc ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-578"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">WarningFlag -&gt; DynFlags -&gt; IsSafeImport
</span><a href="GHC.Driver.Session.html#wopt"><span class="hs-identifier hs-var">wopt</span></a></span><span> </span><span class="annot"><span class="annottext">WarningFlag
</span><a href="GHC.Driver.Flags.html#Opt_WarnSafe"><span class="hs-identifier hs-var">Opt_WarnSafe</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072609"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-579"></span><span>              </span><span class="annot"><span class="annottext">IsSafeImport
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-580"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; SafeHaskellMode
</span><a href="GHC.Driver.Session.html#safeHaskell"><span class="hs-identifier hs-var hs-var">safeHaskell</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072609"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode -&gt; SafeHaskellMode -&gt; IsSafeImport
forall a. Eq a =&gt; a -&gt; a -&gt; IsSafeImport
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="GHC.Driver.Session.html#Sf_Safe"><span class="hs-identifier hs-var">Sf_Safe</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; Hsc ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-581"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WarningMessages -&gt; Hsc ()
</span><a href="GHC.Driver.Main.html#logWarnings"><span class="hs-identifier hs-var">logWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">(WarningMessages -&gt; Hsc ()) -&gt; WarningMessages -&gt; Hsc ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ErrMsg -&gt; WarningMessages
forall a. a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#unitBag"><span class="hs-identifier hs-var">unitBag</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrMsg -&gt; WarningMessages) -&gt; ErrMsg -&gt; WarningMessages
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-582"></span><span>                       </span><span class="annot"><span class="annottext">WarnReason -&gt; ErrMsg -&gt; ErrMsg
</span><a href="GHC.Utils.Error.html#makeIntoWarning"><span class="hs-identifier hs-var">makeIntoWarning</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WarningFlag -&gt; WarnReason
</span><a href="GHC.Driver.Flags.html#Reason"><span class="hs-identifier hs-var">Reason</span></a></span><span> </span><span class="annot"><span class="annottext">WarningFlag
</span><a href="GHC.Driver.Flags.html#Opt_WarnSafe"><span class="hs-identifier hs-var">Opt_WarnSafe</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ErrMsg -&gt; ErrMsg) -&gt; ErrMsg -&gt; ErrMsg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-583"></span><span>                       </span><span class="annot"><span class="annottext">DynFlags -&gt; SrcSpan -&gt; SDoc -&gt; ErrMsg
</span><a href="GHC.Utils.Error.html#mkPlainWarnMsg"><span class="hs-identifier hs-var">mkPlainWarnMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072609"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; SrcSpan
</span><a href="GHC.Driver.Session.html#warnSafeOnLoc"><span class="hs-identifier hs-var hs-var">warnSafeOnLoc</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072609"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; ErrMsg) -&gt; SDoc -&gt; ErrMsg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-584"></span><span>                       </span><span class="annot"><span class="annottext">TcGblEnv -&gt; SDoc
</span><a href="#local-6989586621681072585"><span class="hs-identifier hs-var">errSafe</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072592"><span class="hs-identifier hs-var">tcg_res'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-585"></span><span>              </span><span class="annot"><span class="annottext">IsSafeImport
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; SafeHaskellMode
</span><a href="GHC.Driver.Session.html#safeHaskell"><span class="hs-identifier hs-var hs-var">safeHaskell</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072609"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode -&gt; SafeHaskellMode -&gt; IsSafeImport
forall a. Eq a =&gt; a -&gt; a -&gt; IsSafeImport
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="GHC.Driver.Session.html#Sf_Trustworthy"><span class="hs-identifier hs-var">Sf_Trustworthy</span></a></span><span> </span><span class="annot"><span class="annottext">IsSafeImport -&gt; IsSafeImport -&gt; IsSafeImport
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-586"></span><span>                      </span><span class="annot"><span class="annottext">WarningFlag -&gt; DynFlags -&gt; IsSafeImport
</span><a href="GHC.Driver.Session.html#wopt"><span class="hs-identifier hs-var">wopt</span></a></span><span> </span><span class="annot"><span class="annottext">WarningFlag
</span><a href="GHC.Driver.Flags.html#Opt_WarnTrustworthySafe"><span class="hs-identifier hs-var">Opt_WarnTrustworthySafe</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072609"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-587"></span><span>                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WarningMessages -&gt; Hsc ()
</span><a href="GHC.Driver.Main.html#logWarnings"><span class="hs-identifier hs-var">logWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">(WarningMessages -&gt; Hsc ()) -&gt; WarningMessages -&gt; Hsc ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ErrMsg -&gt; WarningMessages
forall a. a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#unitBag"><span class="hs-identifier hs-var">unitBag</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrMsg -&gt; WarningMessages) -&gt; ErrMsg -&gt; WarningMessages
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-588"></span><span>                       </span><span class="annot"><span class="annottext">WarnReason -&gt; ErrMsg -&gt; ErrMsg
</span><a href="GHC.Utils.Error.html#makeIntoWarning"><span class="hs-identifier hs-var">makeIntoWarning</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WarningFlag -&gt; WarnReason
</span><a href="GHC.Driver.Flags.html#Reason"><span class="hs-identifier hs-var">Reason</span></a></span><span> </span><span class="annot"><span class="annottext">WarningFlag
</span><a href="GHC.Driver.Flags.html#Opt_WarnTrustworthySafe"><span class="hs-identifier hs-var">Opt_WarnTrustworthySafe</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ErrMsg -&gt; ErrMsg) -&gt; ErrMsg -&gt; ErrMsg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-589"></span><span>                       </span><span class="annot"><span class="annottext">DynFlags -&gt; SrcSpan -&gt; SDoc -&gt; ErrMsg
</span><a href="GHC.Utils.Error.html#mkPlainWarnMsg"><span class="hs-identifier hs-var">mkPlainWarnMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072609"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; SrcSpan
</span><a href="GHC.Driver.Session.html#trustworthyOnLoc"><span class="hs-identifier hs-var hs-var">trustworthyOnLoc</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072609"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; ErrMsg) -&gt; SDoc -&gt; ErrMsg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-590"></span><span>                       </span><span class="annot"><span class="annottext">TcGblEnv -&gt; SDoc
</span><a href="#local-6989586621681072581"><span class="hs-identifier hs-var">errTwthySafe</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072592"><span class="hs-identifier hs-var">tcg_res'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-591"></span><span>              </span><span class="annot"><span class="annottext">IsSafeImport
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; Hsc ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-592"></span><span>          </span><span class="annot"><span class="annottext">TcGblEnv -&gt; Hsc TcGblEnv
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072592"><span class="hs-identifier hs-var">tcg_res'</span></a></span><span>
</span><span id="line-593"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-594"></span><span>    </span><span id="local-6989586621681072579"><span class="annot"><span class="annottext">pprMod :: TcGblEnv -&gt; SDoc
</span><a href="#local-6989586621681072579"><span class="hs-identifier hs-var hs-var">pprMod</span></a></span></span><span> </span><span id="local-6989586621681072578"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072578"><span class="hs-identifier hs-var">t</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">(ModuleName -&gt; SDoc) -&gt; ModuleName -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Module -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">(Module -&gt; ModuleName) -&gt; Module -&gt; ModuleName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; Module
</span><a href="GHC.Tc.Types.html#tcg_mod"><span class="hs-identifier hs-var hs-var">tcg_mod</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072578"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-595"></span><span>    </span><span id="local-6989586621681072585"><span class="annot"><span class="annottext">errSafe :: TcGblEnv -&gt; SDoc
</span><a href="#local-6989586621681072585"><span class="hs-identifier hs-var hs-var">errSafe</span></a></span></span><span> </span><span id="local-6989586621681072576"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072576"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; SDoc
</span><a href="#local-6989586621681072579"><span class="hs-identifier hs-var">pprMod</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072576"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;has been inferred as safe!&quot;</span></span><span>
</span><span id="line-596"></span><span>    </span><span id="local-6989586621681072581"><span class="annot"><span class="annottext">errTwthySafe :: TcGblEnv -&gt; SDoc
</span><a href="#local-6989586621681072581"><span class="hs-identifier hs-var hs-var">errTwthySafe</span></a></span></span><span> </span><span id="local-6989586621681072574"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072574"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; SDoc
</span><a href="#local-6989586621681072579"><span class="hs-identifier hs-var">pprMod</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072574"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-597"></span><span>      </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;is marked as Trustworthy but has been inferred as safe!&quot;</span></span><span>
</span><span id="line-598"></span><span>    </span><span id="local-6989586621681072604"><span class="annot"><span class="annottext">warnMissingSafeHaskellMode :: SDoc
</span><a href="#local-6989586621681072604"><span class="hs-identifier hs-var hs-var">warnMissingSafeHaskellMode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var hs-var">moduleName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; Module
</span><a href="GHC.Driver.Types.html#ms_mod"><span class="hs-identifier hs-var hs-var">ms_mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681072613"><span class="hs-identifier hs-var">sum</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-599"></span><span>      </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;is missing Safe Haskell mode&quot;</span></span><span>
</span><span id="line-600"></span><span>
</span><span id="line-601"></span><span class="hs-comment">-- | Convert a typechecked module to Core</span><span>
</span><span id="line-602"></span><span class="annot"><a href="GHC.Driver.Main.html#hscDesugar"><span class="hs-identifier hs-type">hscDesugar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModGuts"><span class="hs-identifier hs-type">ModGuts</span></a></span><span>
</span><span id="line-603"></span><span id="hscDesugar"><span class="annot"><span class="annottext">hscDesugar :: HscEnv -&gt; ModSummary -&gt; TcGblEnv -&gt; IO ModGuts
</span><a href="GHC.Driver.Main.html#hscDesugar"><span class="hs-identifier hs-var hs-var">hscDesugar</span></a></span></span><span> </span><span id="local-6989586621681072572"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072572"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681072571"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681072571"><span class="hs-identifier hs-var">mod_summary</span></a></span></span><span> </span><span id="local-6989586621681072570"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072570"><span class="hs-identifier hs-var">tc_result</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-604"></span><span>    </span><span class="annot"><span class="annottext">HscEnv -&gt; Hsc ModGuts -&gt; IO ModGuts
forall a. HscEnv -&gt; Hsc a -&gt; IO a
</span><a href="GHC.Driver.Types.html#runHsc"><span class="hs-identifier hs-var">runHsc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072572"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(Hsc ModGuts -&gt; IO ModGuts) -&gt; Hsc ModGuts -&gt; IO ModGuts
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation -&gt; TcGblEnv -&gt; Hsc ModGuts
</span><a href="GHC.Driver.Main.html#hscDesugar%27"><span class="hs-identifier hs-var">hscDesugar'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; ModLocation
</span><a href="GHC.Driver.Types.html#ms_location"><span class="hs-identifier hs-var hs-var">ms_location</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681072571"><span class="hs-identifier hs-var">mod_summary</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072570"><span class="hs-identifier hs-var">tc_result</span></a></span><span>
</span><span id="line-605"></span><span>
</span><span id="line-606"></span><span class="annot"><a href="GHC.Driver.Main.html#hscDesugar%27"><span class="hs-identifier hs-type">hscDesugar'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Location.html#ModLocation"><span class="hs-identifier hs-type">ModLocation</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModGuts"><span class="hs-identifier hs-type">ModGuts</span></a></span><span>
</span><span id="line-607"></span><span id="hscDesugar%27"><span class="annot"><span class="annottext">hscDesugar' :: ModLocation -&gt; TcGblEnv -&gt; Hsc ModGuts
</span><a href="GHC.Driver.Main.html#hscDesugar%27"><span class="hs-identifier hs-var hs-var">hscDesugar'</span></a></span></span><span> </span><span id="local-6989586621681072569"><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681072569"><span class="hs-identifier hs-var">mod_location</span></a></span></span><span> </span><span id="local-6989586621681072568"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072568"><span class="hs-identifier hs-var">tc_result</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-608"></span><span>    </span><span id="local-6989586621681072567"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072567"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc HscEnv
</span><a href="GHC.Driver.Main.html#getHscEnv"><span class="hs-identifier hs-var">getHscEnv</span></a></span><span>
</span><span id="line-609"></span><span>    </span><span id="local-6989586621681072566"><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621681072566"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ((WarningMessages, WarningMessages), Maybe ModGuts)
-&gt; Hsc ModGuts
forall a. IO ((WarningMessages, WarningMessages), Maybe a) -&gt; Hsc a
</span><a href="GHC.Driver.Main.html#ioMsgMaybe"><span class="hs-identifier hs-var">ioMsgMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ((WarningMessages, WarningMessages), Maybe ModGuts)
 -&gt; Hsc ModGuts)
-&gt; IO ((WarningMessages, WarningMessages), Maybe ModGuts)
-&gt; Hsc ModGuts
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-610"></span><span>      </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;deSugar&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-611"></span><span>      </span><span class="annot"><span class="annottext">HscEnv
-&gt; ModLocation
-&gt; TcGblEnv
-&gt; IO ((WarningMessages, WarningMessages), Maybe ModGuts)
</span><a href="GHC.HsToCore.html#deSugar"><span class="hs-identifier hs-var">deSugar</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072567"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681072569"><span class="hs-identifier hs-var">mod_location</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072568"><span class="hs-identifier hs-var">tc_result</span></a></span><span>
</span><span id="line-612"></span><span>
</span><span id="line-613"></span><span>    </span><span class="hs-comment">-- always check -Werror after desugaring, this is the last opportunity for</span><span>
</span><span id="line-614"></span><span>    </span><span class="hs-comment">-- warnings to arise before the backend.</span><span>
</span><span id="line-615"></span><span>    </span><span class="annot"><span class="annottext">Hsc ()
</span><a href="GHC.Driver.Main.html#handleWarnings"><span class="hs-identifier hs-var">handleWarnings</span></a></span><span>
</span><span id="line-616"></span><span>    </span><span class="annot"><span class="annottext">ModGuts -&gt; Hsc ModGuts
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621681072566"><span class="hs-identifier hs-var">r</span></a></span><span>
</span><span id="line-617"></span><span>
</span><span id="line-618"></span><span class="hs-comment">-- | Make a 'ModDetails' from the results of typechecking. Used when</span><span>
</span><span id="line-619"></span><span class="hs-comment">-- typechecking only, as opposed to full compilation.</span><span>
</span><span id="line-620"></span><span class="annot"><a href="GHC.Driver.Main.html#makeSimpleDetails"><span class="hs-identifier hs-type">makeSimpleDetails</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModDetails"><span class="hs-identifier hs-type">ModDetails</span></a></span><span>
</span><span id="line-621"></span><span id="makeSimpleDetails"><span class="annot"><span class="annottext">makeSimpleDetails :: HscEnv -&gt; TcGblEnv -&gt; IO ModDetails
</span><a href="GHC.Driver.Main.html#makeSimpleDetails"><span class="hs-identifier hs-var hs-var">makeSimpleDetails</span></a></span></span><span> </span><span id="local-6989586621681072564"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072564"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681072563"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072563"><span class="hs-identifier hs-var">tc_result</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; TcGblEnv -&gt; IO ModDetails
</span><a href="GHC.Iface.Tidy.html#mkBootModDetailsTc"><span class="hs-identifier hs-var">mkBootModDetailsTc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072564"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072563"><span class="hs-identifier hs-var">tc_result</span></a></span><span>
</span><span id="line-622"></span><span>
</span><span id="line-623"></span><span>
</span><span id="line-624"></span><span class="hs-comment">{- **********************************************************************
%*                                                                      *
                The main compiler pipeline
%*                                                                      *
%********************************************************************* -}</span><span>
</span><span id="line-629"></span><span>
</span><span id="line-630"></span><span class="hs-comment">{-
                   --------------------------------
                        The compilation proper
                   --------------------------------

It's the task of the compilation proper to compile Haskell, hs-boot and core
files to either byte-code, hard-code (C, asm, LLVM, etc.) or to nothing at all
(the module is still parsed and type-checked. This feature is mostly used by
IDE's and the likes). Compilation can happen in either 'one-shot', 'batch',
'nothing', or 'interactive' mode. 'One-shot' mode targets hard-code, 'batch'
mode targets hard-code, 'nothing' mode targets nothing and 'interactive' mode
targets byte-code.

The modes are kept separate because of their different types and meanings:

 * In 'one-shot' mode, we're only compiling a single file and can therefore
 discard the new ModIface and ModDetails. This is also the reason it only
 targets hard-code; compiling to byte-code or nothing doesn't make sense when
 we discard the result.

 * 'Batch' mode is like 'one-shot' except that we keep the resulting ModIface
 and ModDetails. 'Batch' mode doesn't target byte-code since that require us to
 return the newly compiled byte-code.

 * 'Nothing' mode has exactly the same type as 'batch' mode but they're still
 kept separate. This is because compiling to nothing is fairly special: We
 don't output any interface files, we don't run the simplifier and we don't
 generate any code.

 * 'Interactive' mode is similar to 'batch' mode except that we return the
 compiled byte-code together with the ModIface and ModDetails.

Trying to compile a hs-boot file to byte-code will result in a run-time error.
This is the only thing that isn't caught by the type-system.
-}</span><span>
</span><span id="line-665"></span><span>
</span><span id="line-666"></span><span>
</span><span id="line-667"></span><span class="hs-keyword">type</span><span> </span><span id="Messager"><span class="annot"><a href="GHC.Driver.Main.html#Messager"><span class="hs-identifier hs-var">Messager</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Iface.Recomp.html#RecompileRequired"><span class="hs-identifier hs-type">RecompileRequired</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-668"></span><span>
</span><span id="line-669"></span><span class="hs-comment">-- | This function runs GHC's frontend with recompilation</span><span>
</span><span id="line-670"></span><span class="hs-comment">-- avoidance. Specifically, it checks if recompilation is needed,</span><span>
</span><span id="line-671"></span><span class="hs-comment">-- and if it is, it parses and typechecks the input module.</span><span>
</span><span id="line-672"></span><span class="hs-comment">-- It does not write out the results of typechecking (See</span><span>
</span><span id="line-673"></span><span class="hs-comment">-- compileOne and hscIncrementalCompile).</span><span>
</span><span id="line-674"></span><span class="annot"><a href="GHC.Driver.Main.html#hscIncrementalFrontend"><span class="hs-identifier hs-type">hscIncrementalFrontend</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-comment">-- always do basic recompilation check?</span><span>
</span><span id="line-675"></span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span>
</span><span id="line-676"></span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#Messager"><span class="hs-identifier hs-type">Messager</span></a></span><span>
</span><span id="line-677"></span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span>
</span><span id="line-678"></span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#SourceModified"><span class="hs-identifier hs-type">SourceModified</span></a></span><span>
</span><span id="line-679"></span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a></span><span>  </span><span class="hs-comment">-- Old interface, if available</span><span>
</span><span id="line-680"></span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>       </span><span class="hs-comment">-- (i,n) = module i of n (for msgs)</span><span>
</span><span id="line-681"></span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#FrontendResult"><span class="hs-identifier hs-type">FrontendResult</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../base/src/GHC.Fingerprint.Type.html#Fingerprint"><span class="hs-identifier hs-type">Fingerprint</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-682"></span><span>
</span><span id="line-683"></span><span id="hscIncrementalFrontend"><span class="annot"><span class="annottext">hscIncrementalFrontend :: IsSafeImport
-&gt; Maybe TcGblEnv
-&gt; Maybe Messager
-&gt; ModSummary
-&gt; SourceModified
-&gt; Maybe ModIface
-&gt; (Int, Int)
-&gt; Hsc (Either ModIface (FrontendResult, Maybe Fingerprint))
</span><a href="GHC.Driver.Main.html#hscIncrementalFrontend"><span class="hs-identifier hs-var hs-var">hscIncrementalFrontend</span></a></span></span><span>
</span><span id="line-684"></span><span>  </span><span id="local-6989586621681072560"><span class="annot"><span class="annottext">IsSafeImport
</span><a href="#local-6989586621681072560"><span class="hs-identifier hs-var">always_do_basic_recompilation_check</span></a></span></span><span> </span><span id="local-6989586621681072559"><span class="annot"><span class="annottext">Maybe TcGblEnv
</span><a href="#local-6989586621681072559"><span class="hs-identifier hs-var">m_tc_result</span></a></span></span><span>
</span><span id="line-685"></span><span>  </span><span id="local-6989586621681072558"><span class="annot"><span class="annottext">Maybe Messager
</span><a href="#local-6989586621681072558"><span class="hs-identifier hs-var">mHscMessage</span></a></span></span><span> </span><span id="local-6989586621681072557"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681072557"><span class="hs-identifier hs-var">mod_summary</span></a></span></span><span> </span><span id="local-6989586621681072556"><span class="annot"><span class="annottext">SourceModified
</span><a href="#local-6989586621681072556"><span class="hs-identifier hs-var">source_modified</span></a></span></span><span> </span><span id="local-6989586621681072555"><span class="annot"><span class="annottext">Maybe ModIface
</span><a href="#local-6989586621681072555"><span class="hs-identifier hs-var">mb_old_iface</span></a></span></span><span> </span><span id="local-6989586621681072554"><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621681072554"><span class="hs-identifier hs-var">mod_index</span></a></span></span><span>
</span><span id="line-686"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-687"></span><span>    </span><span id="local-6989586621681072553"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072553"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc HscEnv
</span><a href="GHC.Driver.Main.html#getHscEnv"><span class="hs-identifier hs-var">getHscEnv</span></a></span><span>
</span><span id="line-688"></span><span>
</span><span id="line-689"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681072551"><span class="annot"><span class="annottext">msg :: RecompileRequired -&gt; IO ()
</span><a href="#local-6989586621681072551"><span class="hs-identifier hs-var hs-var">msg</span></a></span></span><span> </span><span id="local-6989586621681072550"><span class="annot"><span class="annottext">RecompileRequired
</span><a href="#local-6989586621681072550"><span class="hs-identifier hs-var">what</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Messager
</span><a href="#local-6989586621681072558"><span class="hs-identifier hs-var">mHscMessage</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-690"></span><span>                   </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681072549"><span class="annot"><span class="annottext">Messager
</span><a href="#local-6989586621681072549"><span class="hs-identifier hs-var">hscMessage</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Messager
</span><a href="#local-6989586621681072549"><span class="hs-identifier hs-var">hscMessage</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072553"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621681072554"><span class="hs-identifier hs-var">mod_index</span></a></span><span> </span><span class="annot"><span class="annottext">RecompileRequired
</span><a href="#local-6989586621681072550"><span class="hs-identifier hs-var">what</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681072557"><span class="hs-identifier hs-var">mod_summary</span></a></span><span>
</span><span id="line-691"></span><span>                   </span><span class="annot"><span class="annottext">Maybe Messager
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-692"></span><span>
</span><span id="line-693"></span><span>        </span><span id="local-6989586621681072542"><span class="annot"><span class="annottext">skip :: a -&gt; m (Either a b)
</span><a href="#local-6989586621681072542"><span class="hs-identifier hs-var hs-var">skip</span></a></span></span><span> </span><span id="local-6989586621681072541"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681072541"><span class="hs-identifier hs-var">iface</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-694"></span><span>            </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">RecompileRequired -&gt; IO ()
</span><a href="#local-6989586621681072551"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">RecompileRequired
</span><a href="GHC.Iface.Recomp.html#UpToDate"><span class="hs-identifier hs-var">UpToDate</span></a></span><span>
</span><span id="line-695"></span><span>            </span><span class="annot"><span class="annottext">Either a b -&gt; m (Either a b)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Either a b -&gt; m (Either a b)) -&gt; Either a b -&gt; m (Either a b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; Either a b
forall a b. a -&gt; Either a b
</span><a href="../../base/src/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681072541"><span class="hs-identifier hs-var">iface</span></a></span><span>
</span><span id="line-696"></span><span>
</span><span id="line-697"></span><span>        </span><span id="local-6989586621681072535"><span class="annot"><span class="annottext">compile :: b -&gt; RecompileRequired -&gt; Hsc (Either a (FrontendResult, b))
</span><a href="#local-6989586621681072535"><span class="hs-identifier hs-var hs-var">compile</span></a></span></span><span> </span><span id="local-6989586621681072534"><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621681072534"><span class="hs-identifier hs-var">mb_old_hash</span></a></span></span><span> </span><span id="local-6989586621681072533"><span class="annot"><span class="annottext">RecompileRequired
</span><a href="#local-6989586621681072533"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-698"></span><span>            </span><span class="annot"><span class="annottext">IO () -&gt; Hsc ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; Hsc ()) -&gt; IO () -&gt; Hsc ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">RecompileRequired -&gt; IO ()
</span><a href="#local-6989586621681072551"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">RecompileRequired
</span><a href="#local-6989586621681072533"><span class="hs-identifier hs-var">reason</span></a></span><span>
</span><span id="line-699"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621681072532"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072532"><span class="hs-identifier hs-var">tc_result</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RenamedStuff
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IsSafeImport
-&gt; ModSummary
-&gt; Maybe HsParsedModule
-&gt; Hsc (TcGblEnv, RenamedStuff)
</span><a href="GHC.Driver.Main.html#hsc_typecheck"><span class="hs-identifier hs-var">hsc_typecheck</span></a></span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681072557"><span class="hs-identifier hs-var">mod_summary</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe HsParsedModule
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-700"></span><span>            </span><span class="annot"><span class="annottext">Either a (FrontendResult, b) -&gt; Hsc (Either a (FrontendResult, b))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Either a (FrontendResult, b)
 -&gt; Hsc (Either a (FrontendResult, b)))
-&gt; Either a (FrontendResult, b)
-&gt; Hsc (Either a (FrontendResult, b))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(FrontendResult, b) -&gt; Either a (FrontendResult, b)
forall a b. b -&gt; Either a b
</span><a href="../../base/src/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; FrontendResult
</span><a href="GHC.Tc.Types.html#FrontendTypecheck"><span class="hs-identifier hs-var">FrontendTypecheck</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072532"><span class="hs-identifier hs-var">tc_result</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621681072534"><span class="hs-identifier hs-var">mb_old_hash</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-701"></span><span>
</span><span id="line-702"></span><span>        </span><span id="local-6989586621681072530"><span class="annot"><span class="annottext">stable :: IsSafeImport
</span><a href="#local-6989586621681072530"><span class="hs-identifier hs-var hs-var">stable</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SourceModified
</span><a href="#local-6989586621681072556"><span class="hs-identifier hs-var">source_modified</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-703"></span><span>                     </span><span class="annot"><span class="annottext">SourceModified
</span><a href="GHC.Driver.Types.html#SourceUnmodifiedAndStable"><span class="hs-identifier hs-var">SourceUnmodifiedAndStable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-704"></span><span>                     </span><span class="annot"><span class="annottext">SourceModified
</span><span class="hs-identifier">_</span></span><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-705"></span><span>
</span><span id="line-706"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe TcGblEnv
</span><a href="#local-6989586621681072559"><span class="hs-identifier hs-var">m_tc_result</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-707"></span><span>         </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681072528"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072528"><span class="hs-identifier hs-var">tc_result</span></a></span></span><span>
</span><span id="line-708"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">IsSafeImport -&gt; IsSafeImport
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><a href="#local-6989586621681072560"><span class="hs-identifier hs-var">always_do_basic_recompilation_check</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-709"></span><span>             </span><span class="annot"><span class="annottext">Either ModIface (FrontendResult, Maybe Fingerprint)
-&gt; Hsc (Either ModIface (FrontendResult, Maybe Fingerprint))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Either ModIface (FrontendResult, Maybe Fingerprint)
 -&gt; Hsc (Either ModIface (FrontendResult, Maybe Fingerprint)))
-&gt; Either ModIface (FrontendResult, Maybe Fingerprint)
-&gt; Hsc (Either ModIface (FrontendResult, Maybe Fingerprint))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(FrontendResult, Maybe Fingerprint)
-&gt; Either ModIface (FrontendResult, Maybe Fingerprint)
forall a b. b -&gt; Either a b
</span><a href="../../base/src/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; FrontendResult
</span><a href="GHC.Tc.Types.html#FrontendTypecheck"><span class="hs-identifier hs-var">FrontendTypecheck</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072528"><span class="hs-identifier hs-var">tc_result</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Fingerprint
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-710"></span><span>         </span><span class="annot"><span class="annottext">Maybe TcGblEnv
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-711"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621681072527"><span class="annot"><span class="annottext">RecompileRequired
</span><a href="#local-6989586621681072527"><span class="hs-identifier hs-var">recomp_reqd</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681072526"><span class="annot"><span class="annottext">Maybe ModIface
</span><a href="#local-6989586621681072526"><span class="hs-identifier hs-var">mb_checked_iface</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-712"></span><span>                </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;checkOldIface&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-713"></span><span>                   </span><span class="annot"><span class="annottext">IO (RecompileRequired, Maybe ModIface)
-&gt; Hsc (RecompileRequired, Maybe ModIface)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (RecompileRequired, Maybe ModIface)
 -&gt; Hsc (RecompileRequired, Maybe ModIface))
-&gt; IO (RecompileRequired, Maybe ModIface)
-&gt; Hsc (RecompileRequired, Maybe ModIface)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; ModSummary
-&gt; SourceModified
-&gt; Maybe ModIface
-&gt; IO (RecompileRequired, Maybe ModIface)
</span><a href="GHC.Iface.Recomp.html#checkOldIface"><span class="hs-identifier hs-var">checkOldIface</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072553"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681072557"><span class="hs-identifier hs-var">mod_summary</span></a></span><span>
</span><span id="line-714"></span><span>                                </span><span class="annot"><span class="annottext">SourceModified
</span><a href="#local-6989586621681072556"><span class="hs-identifier hs-var">source_modified</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ModIface
</span><a href="#local-6989586621681072555"><span class="hs-identifier hs-var">mb_old_iface</span></a></span><span>
</span><span id="line-715"></span><span>            </span><span class="hs-comment">-- save the interface that comes back from checkOldIface.</span><span>
</span><span id="line-716"></span><span>            </span><span class="hs-comment">-- In one-shot mode we don't have the old iface until this</span><span>
</span><span id="line-717"></span><span>            </span><span class="hs-comment">-- point, when checkOldIface reads it from the disk.</span><span>
</span><span id="line-718"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681072522"><span class="annot"><span class="annottext">mb_old_hash :: Maybe Fingerprint
</span><a href="#local-6989586621681072522"><span class="hs-identifier hs-var hs-var">mb_old_hash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ModIface -&gt; Fingerprint) -&gt; Maybe ModIface -&gt; Maybe Fingerprint
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModIfaceBackend -&gt; Fingerprint
</span><a href="GHC.Driver.Types.html#mi_iface_hash"><span class="hs-identifier hs-var hs-var">mi_iface_hash</span></a></span><span> </span><span class="annot"><span class="annottext">(ModIfaceBackend -&gt; Fingerprint)
-&gt; (ModIface -&gt; ModIfaceBackend) -&gt; ModIface -&gt; Fingerprint
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface -&gt; ModIfaceBackend
forall (phase :: ModIfacePhase).
ModIface_ phase -&gt; IfaceBackendExts phase
</span><a href="GHC.Driver.Types.html#mi_final_exts"><span class="hs-identifier hs-var hs-var">mi_final_exts</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe ModIface
</span><a href="#local-6989586621681072526"><span class="hs-identifier hs-var">mb_checked_iface</span></a></span><span>
</span><span id="line-719"></span><span>
</span><span id="line-720"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe ModIface
</span><a href="#local-6989586621681072526"><span class="hs-identifier hs-var">mb_checked_iface</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-721"></span><span>                </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681072519"><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621681072519"><span class="hs-identifier hs-var">iface</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">IsSafeImport -&gt; IsSafeImport
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RecompileRequired -&gt; IsSafeImport
</span><a href="GHC.Iface.Recomp.html#recompileRequired"><span class="hs-identifier hs-var">recompileRequired</span></a></span><span> </span><span class="annot"><span class="annottext">RecompileRequired
</span><a href="#local-6989586621681072527"><span class="hs-identifier hs-var">recomp_reqd</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-722"></span><span>                    </span><span class="hs-comment">-- If the module used TH splices when it was last</span><span>
</span><span id="line-723"></span><span>                    </span><span class="hs-comment">-- compiled, then the recompilation check is not</span><span>
</span><span id="line-724"></span><span>                    </span><span class="hs-comment">-- accurate enough (#481) and we must ignore</span><span>
</span><span id="line-725"></span><span>                    </span><span class="hs-comment">-- it.  However, if the module is stable (none of</span><span>
</span><span id="line-726"></span><span>                    </span><span class="hs-comment">-- the modules it depends on, directly or</span><span>
</span><span id="line-727"></span><span>                    </span><span class="hs-comment">-- indirectly, changed), then we *can* skip</span><span>
</span><span id="line-728"></span><span>                    </span><span class="hs-comment">-- recompilation. This is why the SourceModified</span><span>
</span><span id="line-729"></span><span>                    </span><span class="hs-comment">-- type contains SourceUnmodifiedAndStable, and</span><span>
</span><span id="line-730"></span><span>                    </span><span class="hs-comment">-- it's pretty important: otherwise ghc --make</span><span>
</span><span id="line-731"></span><span>                    </span><span class="hs-comment">-- would always recompile TH modules, even if</span><span>
</span><span id="line-732"></span><span>                    </span><span class="hs-comment">-- nothing at all has changed. Stability is just</span><span>
</span><span id="line-733"></span><span>                    </span><span class="hs-comment">-- the same check that make is doing for us in</span><span>
</span><span id="line-734"></span><span>                    </span><span class="hs-comment">-- one-shot mode.</span><span>
</span><span id="line-735"></span><span>                    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe TcGblEnv
</span><a href="#local-6989586621681072559"><span class="hs-identifier hs-var">m_tc_result</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-736"></span><span>                    </span><span class="annot"><span class="annottext">Maybe TcGblEnv
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-737"></span><span>                     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ModIface -&gt; IsSafeImport
forall (phase :: ModIfacePhase). ModIface_ phase -&gt; IsSafeImport
</span><a href="GHC.Driver.Types.html#mi_used_th"><span class="hs-identifier hs-var hs-var">mi_used_th</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621681072519"><span class="hs-identifier hs-var">iface</span></a></span><span> </span><span class="annot"><span class="annottext">IsSafeImport -&gt; IsSafeImport -&gt; IsSafeImport
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">IsSafeImport -&gt; IsSafeImport
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><a href="#local-6989586621681072530"><span class="hs-identifier hs-var">stable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-738"></span><span>                        </span><span class="annot"><span class="annottext">Maybe Fingerprint
-&gt; RecompileRequired
-&gt; Hsc (Either ModIface (FrontendResult, Maybe Fingerprint))
forall {b} {a}.
b -&gt; RecompileRequired -&gt; Hsc (Either a (FrontendResult, b))
</span><a href="#local-6989586621681072535"><span class="hs-identifier hs-var">compile</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Fingerprint
</span><a href="#local-6989586621681072522"><span class="hs-identifier hs-var">mb_old_hash</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; RecompileRequired
</span><a href="GHC.Iface.Recomp.html#RecompBecause"><span class="hs-identifier hs-var">RecompBecause</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TH&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-739"></span><span>                    </span><span class="annot"><span class="annottext">Maybe TcGblEnv
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-740"></span><span>                        </span><span class="annot"><span class="annottext">ModIface
-&gt; Hsc (Either ModIface (FrontendResult, Maybe Fingerprint))
forall {m :: * -&gt; *} {a} {b}. MonadIO m =&gt; a -&gt; m (Either a b)
</span><a href="#local-6989586621681072542"><span class="hs-identifier hs-var">skip</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621681072519"><span class="hs-identifier hs-var">iface</span></a></span><span>
</span><span id="line-741"></span><span>                </span><span class="annot"><span class="annottext">Maybe ModIface
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-742"></span><span>                    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe TcGblEnv
</span><a href="#local-6989586621681072559"><span class="hs-identifier hs-var">m_tc_result</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-743"></span><span>                    </span><span class="annot"><span class="annottext">Maybe TcGblEnv
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Fingerprint
-&gt; RecompileRequired
-&gt; Hsc (Either ModIface (FrontendResult, Maybe Fingerprint))
forall {b} {a}.
b -&gt; RecompileRequired -&gt; Hsc (Either a (FrontendResult, b))
</span><a href="#local-6989586621681072535"><span class="hs-identifier hs-var">compile</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Fingerprint
</span><a href="#local-6989586621681072522"><span class="hs-identifier hs-var">mb_old_hash</span></a></span><span> </span><span class="annot"><span class="annottext">RecompileRequired
</span><a href="#local-6989586621681072527"><span class="hs-identifier hs-var">recomp_reqd</span></a></span><span>
</span><span id="line-744"></span><span>                    </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681072515"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072515"><span class="hs-identifier hs-var">tc_result</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-745"></span><span>                        </span><span class="annot"><span class="annottext">Either ModIface (FrontendResult, Maybe Fingerprint)
-&gt; Hsc (Either ModIface (FrontendResult, Maybe Fingerprint))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Either ModIface (FrontendResult, Maybe Fingerprint)
 -&gt; Hsc (Either ModIface (FrontendResult, Maybe Fingerprint)))
-&gt; Either ModIface (FrontendResult, Maybe Fingerprint)
-&gt; Hsc (Either ModIface (FrontendResult, Maybe Fingerprint))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(FrontendResult, Maybe Fingerprint)
-&gt; Either ModIface (FrontendResult, Maybe Fingerprint)
forall a b. b -&gt; Either a b
</span><a href="../../base/src/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; FrontendResult
</span><a href="GHC.Tc.Types.html#FrontendTypecheck"><span class="hs-identifier hs-var">FrontendTypecheck</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072515"><span class="hs-identifier hs-var">tc_result</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Fingerprint
</span><a href="#local-6989586621681072522"><span class="hs-identifier hs-var">mb_old_hash</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-746"></span><span>
</span><span id="line-747"></span><span class="hs-comment">--------------------------------------------------------------</span><span>
</span><span id="line-748"></span><span class="hs-comment">-- Compilers</span><span>
</span><span id="line-749"></span><span class="hs-comment">--------------------------------------------------------------</span><span>
</span><span id="line-750"></span><span>
</span><span id="line-751"></span><span class="hs-comment">-- | Used by both OneShot and batch mode. Runs the pipeline HsSyn and Core parts</span><span>
</span><span id="line-752"></span><span class="hs-comment">-- of the pipeline.</span><span>
</span><span id="line-753"></span><span class="hs-comment">-- We return a interface if we already had an old one around and recompilation</span><span>
</span><span id="line-754"></span><span class="hs-comment">-- was not needed. Otherwise it will be created during later passes when we</span><span>
</span><span id="line-755"></span><span class="hs-comment">-- run the compilation pipeline.</span><span>
</span><span id="line-756"></span><span class="annot"><a href="GHC.Driver.Main.html#hscIncrementalCompile"><span class="hs-identifier hs-type">hscIncrementalCompile</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-757"></span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span>
</span><span id="line-758"></span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#Messager"><span class="hs-identifier hs-type">Messager</span></a></span><span>
</span><span id="line-759"></span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-760"></span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span>
</span><span id="line-761"></span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#SourceModified"><span class="hs-identifier hs-type">SourceModified</span></a></span><span>
</span><span id="line-762"></span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a></span><span>
</span><span id="line-763"></span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-764"></span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Types.html#HscStatus"><span class="hs-identifier hs-type">HscStatus</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-765"></span><span id="hscIncrementalCompile"><span class="annot"><span class="annottext">hscIncrementalCompile :: IsSafeImport
-&gt; Maybe TcGblEnv
-&gt; Maybe Messager
-&gt; HscEnv
-&gt; ModSummary
-&gt; SourceModified
-&gt; Maybe ModIface
-&gt; (Int, Int)
-&gt; IO (HscStatus, DynFlags)
</span><a href="GHC.Driver.Main.html#hscIncrementalCompile"><span class="hs-identifier hs-var hs-var">hscIncrementalCompile</span></a></span></span><span> </span><span id="local-6989586621681072514"><span class="annot"><span class="annottext">IsSafeImport
</span><a href="#local-6989586621681072514"><span class="hs-identifier hs-var">always_do_basic_recompilation_check</span></a></span></span><span> </span><span id="local-6989586621681072513"><span class="annot"><span class="annottext">Maybe TcGblEnv
</span><a href="#local-6989586621681072513"><span class="hs-identifier hs-var">m_tc_result</span></a></span></span><span>
</span><span id="line-766"></span><span>    </span><span id="local-6989586621681072512"><span class="annot"><span class="annottext">Maybe Messager
</span><a href="#local-6989586621681072512"><span class="hs-identifier hs-var">mHscMessage</span></a></span></span><span> </span><span id="local-6989586621681072511"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072511"><span class="hs-identifier hs-var">hsc_env'</span></a></span></span><span> </span><span id="local-6989586621681072510"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681072510"><span class="hs-identifier hs-var">mod_summary</span></a></span></span><span> </span><span id="local-6989586621681072509"><span class="annot"><span class="annottext">SourceModified
</span><a href="#local-6989586621681072509"><span class="hs-identifier hs-var">source_modified</span></a></span></span><span> </span><span id="local-6989586621681072508"><span class="annot"><span class="annottext">Maybe ModIface
</span><a href="#local-6989586621681072508"><span class="hs-identifier hs-var">mb_old_iface</span></a></span></span><span> </span><span id="local-6989586621681072507"><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621681072507"><span class="hs-identifier hs-var">mod_index</span></a></span></span><span>
</span><span id="line-767"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-768"></span><span>    </span><span id="local-6989586621681072506"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072506"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags -&gt; IO DynFlags
</span><a href="GHC.Runtime.Loader.html#initializePlugins"><span class="hs-identifier hs-var">initializePlugins</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072511"><span class="hs-identifier hs-var">hsc_env'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072511"><span class="hs-identifier hs-var">hsc_env'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-769"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681072505"><span class="annot"><span class="annottext">hsc_env'' :: HscEnv
</span><a href="#local-6989586621681072505"><span class="hs-identifier hs-var hs-var">hsc_env''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072511"><span class="hs-identifier hs-var">hsc_env'</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hsc_dflags :: DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072506"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-770"></span><span>
</span><span id="line-771"></span><span>    </span><span class="hs-comment">-- One-shot mode needs a knot-tying mutable variable for interface</span><span>
</span><span id="line-772"></span><span>    </span><span class="hs-comment">-- files. See GHC.Tc.Utils.TcGblEnv.tcg_type_env_var.</span><span>
</span><span id="line-773"></span><span>    </span><span class="hs-comment">-- See also Note [hsc_type_env_var hack]</span><span>
</span><span id="line-774"></span><span>    </span><span id="local-6989586621681072504"><span class="annot"><span class="annottext">IORef TypeEnv
</span><a href="#local-6989586621681072504"><span class="hs-identifier hs-var">type_env_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TypeEnv -&gt; IO (IORef TypeEnv)
forall a. a -&gt; IO (IORef a)
</span><a href="../../base/src/GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a></span><span> </span><span class="annot"><span class="annottext">TypeEnv
forall a. NameEnv a
</span><a href="GHC.Types.Name.Env.html#emptyNameEnv"><span class="hs-identifier hs-var">emptyNameEnv</span></a></span><span>
</span><span id="line-775"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681072502"><span class="annot"><span class="annottext">mod :: Module
</span><a href="#local-6989586621681072502"><span class="hs-identifier hs-var hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; Module
</span><a href="GHC.Driver.Types.html#ms_mod"><span class="hs-identifier hs-var hs-var">ms_mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681072510"><span class="hs-identifier hs-var">mod_summary</span></a></span><span>
</span><span id="line-776"></span><span>        </span><span id="local-6989586621681072501"><span class="annot"><span class="annottext">hsc_env :: HscEnv
</span><a href="#local-6989586621681072501"><span class="hs-identifier hs-var hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">GhcMode -&gt; IsSafeImport
</span><a href="GHC.Driver.Session.html#isOneShot"><span class="hs-identifier hs-var">isOneShot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; GhcMode
</span><a href="GHC.Driver.Session.html#ghcMode"><span class="hs-identifier hs-var hs-var">ghcMode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072505"><span class="hs-identifier hs-var">hsc_env''</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-777"></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072505"><span class="hs-identifier hs-var">hsc_env''</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hsc_type_env_var :: Maybe (Module, IORef TypeEnv)
</span><a href="GHC.Driver.Types.html#hsc_type_env_var"><span class="hs-identifier hs-var">hsc_type_env_var</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Module, IORef TypeEnv) -&gt; Maybe (Module, IORef TypeEnv)
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681072502"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IORef TypeEnv
</span><a href="#local-6989586621681072504"><span class="hs-identifier hs-var">type_env_var</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-778"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-779"></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072505"><span class="hs-identifier hs-var">hsc_env''</span></a></span><span>
</span><span id="line-780"></span><span>
</span><span id="line-781"></span><span>    </span><span class="hs-comment">-- NB: enter Hsc monad here so that we don't bail out early with</span><span>
</span><span id="line-782"></span><span>    </span><span class="hs-comment">-- -Werror on typechecker warnings; we also want to run the desugarer</span><span>
</span><span id="line-783"></span><span>    </span><span class="hs-comment">-- to get those warnings too. (But we'll always exit at that point</span><span>
</span><span id="line-784"></span><span>    </span><span class="hs-comment">-- because the desugarer runs ioMsgMaybe.)</span><span>
</span><span id="line-785"></span><span>    </span><span class="annot"><span class="annottext">HscEnv -&gt; Hsc (HscStatus, DynFlags) -&gt; IO (HscStatus, DynFlags)
forall a. HscEnv -&gt; Hsc a -&gt; IO a
</span><a href="GHC.Driver.Types.html#runHsc"><span class="hs-identifier hs-var">runHsc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072501"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(Hsc (HscStatus, DynFlags) -&gt; IO (HscStatus, DynFlags))
-&gt; Hsc (HscStatus, DynFlags) -&gt; IO (HscStatus, DynFlags)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-786"></span><span>    </span><span id="local-6989586621681072498"><span class="annot"><span class="annottext">Either ModIface (FrontendResult, Maybe Fingerprint)
</span><a href="#local-6989586621681072498"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IsSafeImport
-&gt; Maybe TcGblEnv
-&gt; Maybe Messager
-&gt; ModSummary
-&gt; SourceModified
-&gt; Maybe ModIface
-&gt; (Int, Int)
-&gt; Hsc (Either ModIface (FrontendResult, Maybe Fingerprint))
</span><a href="GHC.Driver.Main.html#hscIncrementalFrontend"><span class="hs-identifier hs-var">hscIncrementalFrontend</span></a></span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><a href="#local-6989586621681072514"><span class="hs-identifier hs-var">always_do_basic_recompilation_check</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TcGblEnv
</span><a href="#local-6989586621681072513"><span class="hs-identifier hs-var">m_tc_result</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Messager
</span><a href="#local-6989586621681072512"><span class="hs-identifier hs-var">mHscMessage</span></a></span><span>
</span><span id="line-787"></span><span>            </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681072510"><span class="hs-identifier hs-var">mod_summary</span></a></span><span> </span><span class="annot"><span class="annottext">SourceModified
</span><a href="#local-6989586621681072509"><span class="hs-identifier hs-var">source_modified</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ModIface
</span><a href="#local-6989586621681072508"><span class="hs-identifier hs-var">mb_old_iface</span></a></span><span> </span><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621681072507"><span class="hs-identifier hs-var">mod_index</span></a></span><span>
</span><span id="line-788"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either ModIface (FrontendResult, Maybe Fingerprint)
</span><a href="#local-6989586621681072498"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-789"></span><span>        </span><span class="hs-comment">-- We didn't need to do any typechecking; the old interface</span><span>
</span><span id="line-790"></span><span>        </span><span class="hs-comment">-- file on disk was good enough.</span><span>
</span><span id="line-791"></span><span>        </span><span class="annot"><a href="../../base/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621681072497"><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621681072497"><span class="hs-identifier hs-var">iface</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-792"></span><span>            </span><span id="local-6989586621681072496"><span class="annot"><span class="annottext">ModDetails
</span><a href="#local-6989586621681072496"><span class="hs-identifier hs-var">details</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ModDetails -&gt; Hsc ModDetails
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ModDetails -&gt; Hsc ModDetails)
-&gt; IO ModDetails -&gt; Hsc ModDetails
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; ModSummary -&gt; ModIface -&gt; IO ModDetails
</span><a href="GHC.Driver.Main.html#initModDetails"><span class="hs-identifier hs-var">initModDetails</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072501"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681072510"><span class="hs-identifier hs-var">mod_summary</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621681072497"><span class="hs-identifier hs-var">iface</span></a></span><span>
</span><span id="line-793"></span><span>            </span><span class="annot"><span class="annottext">(HscStatus, DynFlags) -&gt; Hsc (HscStatus, DynFlags)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModIface -&gt; ModDetails -&gt; HscStatus
</span><a href="GHC.Driver.Types.html#HscUpToDate"><span class="hs-identifier hs-var">HscUpToDate</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621681072497"><span class="hs-identifier hs-var">iface</span></a></span><span> </span><span class="annot"><span class="annottext">ModDetails
</span><a href="#local-6989586621681072496"><span class="hs-identifier hs-var">details</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072506"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-794"></span><span>        </span><span class="hs-comment">-- We finished type checking.  (mb_old_hash is the hash of</span><span>
</span><span id="line-795"></span><span>        </span><span class="hs-comment">-- the interface that existed on disk; it's possible we had</span><span>
</span><span id="line-796"></span><span>        </span><span class="hs-comment">-- to retypecheck but the resulting interface is exactly</span><span>
</span><span id="line-797"></span><span>        </span><span class="hs-comment">-- the same.)</span><span>
</span><span id="line-798"></span><span>        </span><span class="annot"><a href="../../base/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#FrontendTypecheck"><span class="hs-identifier hs-type">FrontendTypecheck</span></a></span><span> </span><span id="local-6989586621681072494"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072494"><span class="hs-identifier hs-var">tc_result</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681072493"><span class="annot"><span class="annottext">Maybe Fingerprint
</span><a href="#local-6989586621681072493"><span class="hs-identifier hs-var">mb_old_hash</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-799"></span><span>            </span><span id="local-6989586621681072492"><span class="annot"><span class="annottext">HscStatus
</span><a href="#local-6989586621681072492"><span class="hs-identifier hs-var">status</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; TcGblEnv -&gt; Maybe Fingerprint -&gt; Hsc HscStatus
</span><a href="GHC.Driver.Main.html#finish"><span class="hs-identifier hs-var">finish</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681072510"><span class="hs-identifier hs-var">mod_summary</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072494"><span class="hs-identifier hs-var">tc_result</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Fingerprint
</span><a href="#local-6989586621681072493"><span class="hs-identifier hs-var">mb_old_hash</span></a></span><span>
</span><span id="line-800"></span><span>            </span><span class="annot"><span class="annottext">(HscStatus, DynFlags) -&gt; Hsc (HscStatus, DynFlags)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscStatus
</span><a href="#local-6989586621681072492"><span class="hs-identifier hs-var">status</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072506"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-801"></span><span>
</span><span id="line-802"></span><span class="hs-comment">-- Knot tying!  See Note [Knot-tying typecheckIface]</span><span>
</span><span id="line-803"></span><span class="hs-comment">-- See Note [ModDetails and --make mode]</span><span>
</span><span id="line-804"></span><span class="annot"><a href="GHC.Driver.Main.html#initModDetails"><span class="hs-identifier hs-type">initModDetails</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModDetails"><span class="hs-identifier hs-type">ModDetails</span></a></span><span>
</span><span id="line-805"></span><span id="initModDetails"><span class="annot"><span class="annottext">initModDetails :: HscEnv -&gt; ModSummary -&gt; ModIface -&gt; IO ModDetails
</span><a href="GHC.Driver.Main.html#initModDetails"><span class="hs-identifier hs-var hs-var">initModDetails</span></a></span></span><span> </span><span id="local-6989586621681072490"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072490"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681072489"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681072489"><span class="hs-identifier hs-var">mod_summary</span></a></span></span><span> </span><span id="local-6989586621681072488"><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621681072488"><span class="hs-identifier hs-var">iface</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-806"></span><span>  </span><span class="annot"><span class="annottext">(ModDetails -&gt; IO ModDetails) -&gt; IO ModDetails
forall a. (a -&gt; IO a) -&gt; IO a
</span><a href="../../base/src/System.IO.html#fixIO"><span class="hs-identifier hs-var">fixIO</span></a></span><span> </span><span class="annot"><span class="annottext">((ModDetails -&gt; IO ModDetails) -&gt; IO ModDetails)
-&gt; (ModDetails -&gt; IO ModDetails) -&gt; IO ModDetails
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681072487"><span class="annot"><span class="annottext">ModDetails
</span><a href="#local-6989586621681072487"><span class="hs-identifier hs-var">details'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-807"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681072486"><span class="annot"><span class="annottext">hsc_env' :: HscEnv
</span><a href="#local-6989586621681072486"><span class="hs-identifier hs-var hs-var">hsc_env'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072490"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-808"></span><span>                    </span><span class="annot"><span class="annottext">hsc_HPT :: HomePackageTable
</span><a href="GHC.Driver.Types.html#hsc_HPT"><span class="hs-identifier hs-var">hsc_HPT</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HomePackageTable -&gt; ModuleName -&gt; HomeModInfo -&gt; HomePackageTable
</span><a href="GHC.Driver.Types.html#addToHpt"><span class="hs-identifier hs-var">addToHpt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; HomePackageTable
</span><a href="GHC.Driver.Types.html#hsc_HPT"><span class="hs-identifier hs-var hs-var">hsc_HPT</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072490"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-809"></span><span>                                       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; ModuleName
</span><a href="GHC.Driver.Types.html#ms_mod_name"><span class="hs-identifier hs-var">ms_mod_name</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681072489"><span class="hs-identifier hs-var">mod_summary</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-810"></span><span>                                       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModIface -&gt; ModDetails -&gt; Maybe Linkable -&gt; HomeModInfo
</span><a href="GHC.Driver.Types.html#HomeModInfo"><span class="hs-identifier hs-var">HomeModInfo</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621681072488"><span class="hs-identifier hs-var">iface</span></a></span><span> </span><span class="annot"><span class="annottext">ModDetails
</span><a href="#local-6989586621681072487"><span class="hs-identifier hs-var">details'</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Linkable
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-811"></span><span>                   </span><span class="hs-special">}</span><span>
</span><span id="line-812"></span><span>    </span><span class="hs-comment">-- NB: This result is actually not that useful</span><span>
</span><span id="line-813"></span><span>    </span><span class="hs-comment">-- in one-shot mode, since we're not going to do</span><span>
</span><span id="line-814"></span><span>    </span><span class="hs-comment">-- any further typechecking.  It's much more useful</span><span>
</span><span id="line-815"></span><span>    </span><span class="hs-comment">-- in make mode, since this HMI will go into the HPT.</span><span>
</span><span id="line-816"></span><span>    </span><span class="annot"><span class="annottext">HscEnv -&gt; ModIface -&gt; IO ModDetails
</span><a href="GHC.Driver.Main.html#genModDetails"><span class="hs-identifier hs-var">genModDetails</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072486"><span class="hs-identifier hs-var">hsc_env'</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621681072488"><span class="hs-identifier hs-var">iface</span></a></span><span>
</span><span id="line-817"></span><span>
</span><span id="line-818"></span><span>
</span><span id="line-819"></span><span class="hs-comment">{-
Note [ModDetails and --make mode]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

An interface file consists of two parts

* The `ModIface` which ends up getting written to disk.
  The `ModIface` is a completely acyclic tree, which can be serialised
  and de-serialised completely straightforwardly.  The `ModIface` is
  also the structure that is finger-printed for recompilation control.

* The `ModDetails` which provides a more structured view that is suitable
  for usage during compilation.  The `ModDetails` is heavily cyclic:
  An `Id` contains a `Type`, which mentions a `TyCon` that contains kind
  that mentions other `TyCons`; the `Id` also includes an unfolding that
  in turn mentions more `Id`s;  And so on.

The `ModIface` can be created from the `ModDetails` and the `ModDetails` from
a `ModIface`.

During tidying, just before interfaces are written to disk,
the ModDetails is calculated and then converted into a ModIface (see GHC.Iface.Make.mkIface_).
Then when GHC needs to restart typechecking from a certain point it can read the
interface file, and regenerate the ModDetails from the ModIface (see GHC.IfaceToCore.typecheckIface).
The key part about the loading is that the ModDetails is regenerated lazily
from the ModIface, so that there's only a detailed in-memory representation
for declarations which are actually used from the interface. This mode is
also used when reading interface files from external packages.

In the old --make mode implementation, the interface was written after compiling a module
but the in-memory ModDetails which was used to compute the ModIface was retained.
The result was that --make mode used much more memory than `-c` mode, because a large amount of
information about a module would be kept in the ModDetails but never used.

The new idea is that even in `--make` mode, when there is an in-memory `ModDetails`
at hand, we re-create the `ModDetails` from the `ModIface`. Doing this means that
we only have to keep the `ModIface` decls in memory and then lazily load
detailed representations if needed. It turns out this makes a really big difference
to memory usage, halving maximum memory used in some cases.

See !5492 and #13586
-}</span><span>
</span><span id="line-861"></span><span>
</span><span id="line-862"></span><span class="hs-comment">-- Runs the post-typechecking frontend (desugar and simplify). We want to</span><span>
</span><span id="line-863"></span><span class="hs-comment">-- generate most of the interface as late as possible. This gets us up-to-date</span><span>
</span><span id="line-864"></span><span class="hs-comment">-- and good unfoldings and other info in the interface file.</span><span>
</span><span id="line-865"></span><span class="hs-comment">--</span><span>
</span><span id="line-866"></span><span class="hs-comment">-- We might create a interface right away, in which case we also return the</span><span>
</span><span id="line-867"></span><span class="hs-comment">-- updated HomeModInfo. But we might also need to run the backend first. In the</span><span>
</span><span id="line-868"></span><span class="hs-comment">-- later case Status will be HscRecomp and we return a function from ModIface -&gt;</span><span>
</span><span id="line-869"></span><span class="hs-comment">-- HomeModInfo.</span><span>
</span><span id="line-870"></span><span class="hs-comment">--</span><span>
</span><span id="line-871"></span><span class="hs-comment">-- HscRecomp in turn will carry the information required to compute a interface</span><span>
</span><span id="line-872"></span><span class="hs-comment">-- when passed the result of the code generator. So all this can and is done at</span><span>
</span><span id="line-873"></span><span class="hs-comment">-- the call site of the backend code gen if it is run.</span><span>
</span><span id="line-874"></span><span class="annot"><a href="GHC.Driver.Main.html#finish"><span class="hs-identifier hs-type">finish</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span>
</span><span id="line-875"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span>
</span><span id="line-876"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../base/src/GHC.Fingerprint.Type.html#Fingerprint"><span class="hs-identifier hs-type">Fingerprint</span></a></span><span>
</span><span id="line-877"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscStatus"><span class="hs-identifier hs-type">HscStatus</span></a></span><span>
</span><span id="line-878"></span><span id="finish"><span class="annot"><span class="annottext">finish :: ModSummary -&gt; TcGblEnv -&gt; Maybe Fingerprint -&gt; Hsc HscStatus
</span><a href="GHC.Driver.Main.html#finish"><span class="hs-identifier hs-var hs-var">finish</span></a></span></span><span> </span><span id="local-6989586621681072481"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681072481"><span class="hs-identifier hs-var">summary</span></a></span></span><span> </span><span id="local-6989586621681072480"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072480"><span class="hs-identifier hs-var">tc_result</span></a></span></span><span> </span><span id="local-6989586621681072479"><span class="annot"><span class="annottext">Maybe Fingerprint
</span><a href="#local-6989586621681072479"><span class="hs-identifier hs-var">mb_old_hash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-879"></span><span>  </span><span id="local-6989586621681072478"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072478"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc HscEnv
</span><a href="GHC.Driver.Main.html#getHscEnv"><span class="hs-identifier hs-var">getHscEnv</span></a></span><span>
</span><span id="line-880"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681072477"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621681072477"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072478"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-881"></span><span>      </span><span id="local-6989586621681072476"><span class="annot"><span class="annottext">target :: HscTarget
</span><a href="#local-6989586621681072476"><span class="hs-identifier hs-var hs-var">target</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; HscTarget
</span><a href="GHC.Driver.Session.html#hscTarget"><span class="hs-identifier hs-var hs-var">hscTarget</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072477"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-882"></span><span>      </span><span id="local-6989586621681072474"><span class="annot"><span class="annottext">hsc_src :: HscSource
</span><a href="#local-6989586621681072474"><span class="hs-identifier hs-var hs-var">hsc_src</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; HscSource
</span><a href="GHC.Driver.Types.html#ms_hsc_src"><span class="hs-identifier hs-var hs-var">ms_hsc_src</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681072481"><span class="hs-identifier hs-var">summary</span></a></span><span>
</span><span id="line-883"></span><span>
</span><span id="line-884"></span><span>  </span><span class="hs-comment">-- Desugar, if appropriate</span><span>
</span><span id="line-885"></span><span>  </span><span class="hs-comment">--</span><span>
</span><span id="line-886"></span><span>  </span><span class="hs-comment">-- We usually desugar even when we are not generating code, otherwise we</span><span>
</span><span id="line-887"></span><span>  </span><span class="hs-comment">-- would miss errors thrown by the desugaring (see #10600). The only</span><span>
</span><span id="line-888"></span><span>  </span><span class="hs-comment">-- exceptions are when the Module is Ghc.Prim or when it is not a</span><span>
</span><span id="line-889"></span><span>  </span><span class="hs-comment">-- HsSrcFile Module.</span><span>
</span><span id="line-890"></span><span>  </span><span id="local-6989586621681072473"><span class="annot"><span class="annottext">Maybe ModGuts
</span><a href="#local-6989586621681072473"><span class="hs-identifier hs-var">mb_desugar</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-891"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; Module
</span><a href="GHC.Driver.Types.html#ms_mod"><span class="hs-identifier hs-var hs-var">ms_mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681072481"><span class="hs-identifier hs-var">summary</span></a></span><span> </span><span class="annot"><span class="annottext">Module -&gt; Module -&gt; IsSafeImport
forall a. Eq a =&gt; a -&gt; a -&gt; IsSafeImport
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="GHC.Builtin.Names.html#gHC_PRIM"><span class="hs-identifier hs-var">gHC_PRIM</span></a></span><span> </span><span class="annot"><span class="annottext">IsSafeImport -&gt; IsSafeImport -&gt; IsSafeImport
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621681072474"><span class="hs-identifier hs-var">hsc_src</span></a></span><span> </span><span class="annot"><span class="annottext">HscSource -&gt; HscSource -&gt; IsSafeImport
forall a. Eq a =&gt; a -&gt; a -&gt; IsSafeImport
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="GHC.Driver.Phases.html#HsSrcFile"><span class="hs-identifier hs-var">HsSrcFile</span></a></span><span>
</span><span id="line-892"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">ModGuts -&gt; Maybe ModGuts
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(ModGuts -&gt; Maybe ModGuts) -&gt; Hsc ModGuts -&gt; Hsc (Maybe ModGuts)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation -&gt; TcGblEnv -&gt; Hsc ModGuts
</span><a href="GHC.Driver.Main.html#hscDesugar%27"><span class="hs-identifier hs-var">hscDesugar'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; ModLocation
</span><a href="GHC.Driver.Types.html#ms_location"><span class="hs-identifier hs-var hs-var">ms_location</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681072481"><span class="hs-identifier hs-var">summary</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072480"><span class="hs-identifier hs-var">tc_result</span></a></span><span>
</span><span id="line-893"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe ModGuts -&gt; Hsc (Maybe ModGuts)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ModGuts
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-894"></span><span>
</span><span id="line-895"></span><span>  </span><span class="hs-comment">-- Simplify, if appropriate, and (whether we simplified or not) generate an</span><span>
</span><span id="line-896"></span><span>  </span><span class="hs-comment">-- interface file.</span><span>
</span><span id="line-897"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe ModGuts
</span><a href="#local-6989586621681072473"><span class="hs-identifier hs-var">mb_desugar</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-898"></span><span>      </span><span class="hs-comment">-- Just cause we desugared doesn't mean we are generating code, see above.</span><span>
</span><span id="line-899"></span><span>      </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681072470"><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621681072470"><span class="hs-identifier hs-var">desugared_guts</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">HscTarget
</span><a href="#local-6989586621681072476"><span class="hs-identifier hs-var">target</span></a></span><span> </span><span class="annot"><span class="annottext">HscTarget -&gt; HscTarget -&gt; IsSafeImport
forall a. Eq a =&gt; a -&gt; a -&gt; IsSafeImport
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">HscTarget
</span><a href="GHC.Driver.Session.html#HscNothing"><span class="hs-identifier hs-var">HscNothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-900"></span><span>          </span><span id="local-6989586621681072468"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681072468"><span class="hs-identifier hs-var">plugins</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO [String] -&gt; Hsc [String]
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO [String] -&gt; Hsc [String]) -&gt; IO [String] -&gt; Hsc [String]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">IORef [String] -&gt; IO [String]
forall a. IORef a -&gt; IO a
</span><a href="../../base/src/GHC.IORef.html#readIORef"><span class="hs-identifier hs-var">readIORef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; IORef [String]
</span><a href="GHC.Tc.Types.html#tcg_th_coreplugins"><span class="hs-identifier hs-var hs-var">tcg_th_coreplugins</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072480"><span class="hs-identifier hs-var">tc_result</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-901"></span><span>          </span><span id="local-6989586621681072466"><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621681072466"><span class="hs-identifier hs-var">simplified_guts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[String] -&gt; ModGuts -&gt; Hsc ModGuts
</span><a href="GHC.Driver.Main.html#hscSimplify%27"><span class="hs-identifier hs-var">hscSimplify'</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681072468"><span class="hs-identifier hs-var">plugins</span></a></span><span> </span><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621681072470"><span class="hs-identifier hs-var">desugared_guts</span></a></span><span>
</span><span id="line-902"></span><span>
</span><span id="line-903"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621681072465"><span class="annot"><span class="annottext">CgGuts
</span><a href="#local-6989586621681072465"><span class="hs-identifier hs-var">cg_guts</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681072464"><span class="annot"><span class="annottext">ModDetails
</span><a href="#local-6989586621681072464"><span class="hs-identifier hs-var">details</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;CoreTidy&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-904"></span><span>              </span><span class="annot"><span class="annottext">IO (CgGuts, ModDetails) -&gt; Hsc (CgGuts, ModDetails)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (CgGuts, ModDetails) -&gt; Hsc (CgGuts, ModDetails))
-&gt; IO (CgGuts, ModDetails) -&gt; Hsc (CgGuts, ModDetails)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; ModGuts -&gt; IO (CgGuts, ModDetails)
</span><a href="GHC.Iface.Tidy.html#tidyProgram"><span class="hs-identifier hs-var">tidyProgram</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072478"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621681072466"><span class="hs-identifier hs-var">simplified_guts</span></a></span><span>
</span><span id="line-905"></span><span>
</span><span id="line-906"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681072454"><span class="annot"><span class="annottext">partial_iface :: PartialModIface
</span><a href="#local-6989586621681072454"><span class="hs-identifier hs-var hs-var">partial_iface</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-907"></span><span>                </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;GHC.Driver.Main.mkPartialIface&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-908"></span><span>                </span><span class="hs-comment">-- This `force` saves 2M residency in test T10370</span><span>
</span><span id="line-909"></span><span>                </span><span class="hs-comment">-- See Note [Avoiding space leaks in toIface*] for details.</span><span>
</span><span id="line-910"></span><span>                </span><span class="annot"><span class="annottext">PartialModIface -&gt; PartialModIface
forall a. NFData a =&gt; a -&gt; a
</span><a href="../../deepseq/src/Control.DeepSeq.html#force"><span class="hs-identifier hs-var">force</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; ModDetails -&gt; ModGuts -&gt; PartialModIface
</span><a href="GHC.Iface.Make.html#mkPartialIface"><span class="hs-identifier hs-var">mkPartialIface</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072478"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">ModDetails
</span><a href="#local-6989586621681072464"><span class="hs-identifier hs-var">details</span></a></span><span> </span><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621681072466"><span class="hs-identifier hs-var">simplified_guts</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-911"></span><span>
</span><span id="line-912"></span><span>          </span><span class="annot"><span class="annottext">HscStatus -&gt; Hsc HscStatus
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">HscRecomp :: CgGuts
-&gt; ModLocation
-&gt; PartialModIface
-&gt; Maybe Fingerprint
-&gt; DynFlags
-&gt; HscStatus
</span><a href="GHC.Driver.Types.html#HscRecomp"><span class="hs-identifier hs-type">HscRecomp</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hscs_guts :: CgGuts
</span><a href="GHC.Driver.Types.html#hscs_guts"><span class="hs-identifier hs-var">hscs_guts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CgGuts
</span><a href="#local-6989586621681072465"><span class="hs-identifier hs-var">cg_guts</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-913"></span><span>                             </span><span class="annot"><span class="annottext">hscs_mod_location :: ModLocation
</span><a href="GHC.Driver.Types.html#hscs_mod_location"><span class="hs-identifier hs-var">hscs_mod_location</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; ModLocation
</span><a href="GHC.Driver.Types.html#ms_location"><span class="hs-identifier hs-var hs-var">ms_location</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681072481"><span class="hs-identifier hs-var">summary</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-914"></span><span>                             </span><span class="annot"><span class="annottext">hscs_partial_iface :: PartialModIface
</span><a href="GHC.Driver.Types.html#hscs_partial_iface"><span class="hs-identifier hs-var">hscs_partial_iface</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PartialModIface
</span><a href="#local-6989586621681072454"><span class="hs-identifier hs-var">partial_iface</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-915"></span><span>                             </span><span class="annot"><span class="annottext">hscs_old_iface_hash :: Maybe Fingerprint
</span><a href="GHC.Driver.Types.html#hscs_old_iface_hash"><span class="hs-identifier hs-var">hscs_old_iface_hash</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Fingerprint
</span><a href="#local-6989586621681072479"><span class="hs-identifier hs-var">mb_old_hash</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-916"></span><span>                             </span><span class="annot"><span class="annottext">hscs_iface_dflags :: DynFlags
</span><a href="GHC.Driver.Types.html#hscs_iface_dflags"><span class="hs-identifier hs-var">hscs_iface_dflags</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072477"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-917"></span><span>
</span><span id="line-918"></span><span>      </span><span class="hs-comment">-- We are not generating code, so we can skip simplification</span><span>
</span><span id="line-919"></span><span>      </span><span class="hs-comment">-- and generate a simple interface.</span><span>
</span><span id="line-920"></span><span>      </span><span class="annot"><span class="annottext">Maybe ModGuts
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-921"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621681072446"><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621681072446"><span class="hs-identifier hs-var">iface</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681072445"><span class="annot"><span class="annottext">Maybe Fingerprint
</span><a href="#local-6989586621681072445"><span class="hs-identifier hs-var">mb_old_iface_hash</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681072444"><span class="annot"><span class="annottext">ModDetails
</span><a href="#local-6989586621681072444"><span class="hs-identifier hs-var">details</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (ModIface, Maybe Fingerprint, ModDetails)
-&gt; Hsc (ModIface, Maybe Fingerprint, ModDetails)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (ModIface, Maybe Fingerprint, ModDetails)
 -&gt; Hsc (ModIface, Maybe Fingerprint, ModDetails))
-&gt; IO (ModIface, Maybe Fingerprint, ModDetails)
-&gt; Hsc (ModIface, Maybe Fingerprint, ModDetails)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-922"></span><span>          </span><span class="annot"><span class="annottext">HscEnv
-&gt; TcGblEnv
-&gt; Maybe Fingerprint
-&gt; IO (ModIface, Maybe Fingerprint, ModDetails)
</span><a href="GHC.Driver.Main.html#hscSimpleIface"><span class="hs-identifier hs-var">hscSimpleIface</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072478"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072480"><span class="hs-identifier hs-var">tc_result</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Fingerprint
</span><a href="#local-6989586621681072479"><span class="hs-identifier hs-var">mb_old_hash</span></a></span><span>
</span><span id="line-923"></span><span>
</span><span id="line-924"></span><span>        </span><span class="annot"><span class="annottext">IO () -&gt; Hsc ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; Hsc ()) -&gt; IO () -&gt; Hsc ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; ModIface -&gt; Maybe Fingerprint -&gt; ModLocation -&gt; IO ()
</span><a href="GHC.Driver.Main.html#hscMaybeWriteIface"><span class="hs-identifier hs-var">hscMaybeWriteIface</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072477"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621681072446"><span class="hs-identifier hs-var">iface</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Fingerprint
</span><a href="#local-6989586621681072445"><span class="hs-identifier hs-var">mb_old_iface_hash</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; ModLocation
</span><a href="GHC.Driver.Types.html#ms_location"><span class="hs-identifier hs-var hs-var">ms_location</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681072481"><span class="hs-identifier hs-var">summary</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-925"></span><span>
</span><span id="line-926"></span><span>        </span><span class="annot"><span class="annottext">HscStatus -&gt; Hsc HscStatus
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(HscStatus -&gt; Hsc HscStatus) -&gt; HscStatus -&gt; Hsc HscStatus
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscTarget
</span><a href="#local-6989586621681072476"><span class="hs-identifier hs-var">target</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621681072474"><span class="hs-identifier hs-var">hsc_src</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-927"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscTarget
</span><a href="GHC.Driver.Session.html#HscNothing"><span class="hs-identifier hs-var">HscNothing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HscSource
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModIface -&gt; ModDetails -&gt; HscStatus
</span><a href="GHC.Driver.Types.html#HscNotGeneratingCode"><span class="hs-identifier hs-var">HscNotGeneratingCode</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621681072446"><span class="hs-identifier hs-var">iface</span></a></span><span> </span><span class="annot"><span class="annottext">ModDetails
</span><a href="#local-6989586621681072444"><span class="hs-identifier hs-var">details</span></a></span><span>
</span><span id="line-928"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscTarget
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="GHC.Driver.Phases.html#HsBootFile"><span class="hs-identifier hs-var">HsBootFile</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModIface -&gt; ModDetails -&gt; HscStatus
</span><a href="GHC.Driver.Types.html#HscUpdateBoot"><span class="hs-identifier hs-var">HscUpdateBoot</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621681072446"><span class="hs-identifier hs-var">iface</span></a></span><span> </span><span class="annot"><span class="annottext">ModDetails
</span><a href="#local-6989586621681072444"><span class="hs-identifier hs-var">details</span></a></span><span>
</span><span id="line-929"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscTarget
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="GHC.Driver.Phases.html#HsigFile"><span class="hs-identifier hs-var">HsigFile</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModIface -&gt; ModDetails -&gt; HscStatus
</span><a href="GHC.Driver.Types.html#HscUpdateSig"><span class="hs-identifier hs-var">HscUpdateSig</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621681072446"><span class="hs-identifier hs-var">iface</span></a></span><span> </span><span class="annot"><span class="annottext">ModDetails
</span><a href="#local-6989586621681072444"><span class="hs-identifier hs-var">details</span></a></span><span>
</span><span id="line-930"></span><span>          </span><span class="annot"><span class="annottext">(HscTarget, HscSource)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; HscStatus
forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;finish&quot;</span></span><span>
</span><span id="line-931"></span><span>
</span><span id="line-932"></span><span class="hs-comment">{-
Note [Writing interface files]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

We write interface files in GHC.Driver.Main and GHC.Driver.Pipeline using
hscMaybeWriteIface, but only once per compilation (twice with dynamic-too).

* If a compilation does NOT require (re)compilation of the hard code we call
  hscMaybeWriteIface inside GHC.Driver.Main:finish.
* If we run in One Shot mode and target bytecode we write it in compileOne'
* Otherwise we must be compiling to regular hard code and require recompilation.
  In this case we create the interface file inside RunPhase using the interface
  generator contained inside the HscRecomp status.
-}</span><span>
</span><span id="line-946"></span><span class="annot"><a href="GHC.Driver.Main.html#hscMaybeWriteIface"><span class="hs-identifier hs-type">hscMaybeWriteIface</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../base/src/GHC.Fingerprint.Type.html#Fingerprint"><span class="hs-identifier hs-type">Fingerprint</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Location.html#ModLocation"><span class="hs-identifier hs-type">ModLocation</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-947"></span><span id="hscMaybeWriteIface"><span class="annot"><span class="annottext">hscMaybeWriteIface :: DynFlags -&gt; ModIface -&gt; Maybe Fingerprint -&gt; ModLocation -&gt; IO ()
</span><a href="GHC.Driver.Main.html#hscMaybeWriteIface"><span class="hs-identifier hs-var hs-var">hscMaybeWriteIface</span></a></span></span><span> </span><span id="local-6989586621681072439"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072439"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621681072438"><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621681072438"><span class="hs-identifier hs-var">iface</span></a></span></span><span> </span><span id="local-6989586621681072437"><span class="annot"><span class="annottext">Maybe Fingerprint
</span><a href="#local-6989586621681072437"><span class="hs-identifier hs-var">old_iface</span></a></span></span><span> </span><span id="local-6989586621681072436"><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681072436"><span class="hs-identifier hs-var">location</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-948"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681072435"><span class="annot"><span class="annottext">force_write_interface :: IsSafeImport
</span><a href="#local-6989586621681072435"><span class="hs-identifier hs-var hs-var">force_write_interface</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; IsSafeImport
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_WriteInterface"><span class="hs-identifier hs-var">Opt_WriteInterface</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072439"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-949"></span><span>        </span><span id="local-6989586621681072433"><span class="annot"><span class="annottext">write_interface :: IsSafeImport
</span><a href="#local-6989586621681072433"><span class="hs-identifier hs-var hs-var">write_interface</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; HscTarget
</span><a href="GHC.Driver.Session.html#hscTarget"><span class="hs-identifier hs-var hs-var">hscTarget</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072439"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-950"></span><span>                            </span><span class="annot"><span class="annottext">HscTarget
</span><a href="GHC.Driver.Session.html#HscNothing"><span class="hs-identifier hs-var">HscNothing</span></a></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-951"></span><span>                            </span><span class="annot"><span class="annottext">HscTarget
</span><a href="GHC.Driver.Session.html#HscInterpreted"><span class="hs-identifier hs-var">HscInterpreted</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-952"></span><span>                            </span><span class="annot"><span class="annottext">HscTarget
</span><span class="hs-identifier">_</span></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-953"></span><span>        </span><span id="local-6989586621681072427"><span class="annot"><span class="annottext">no_change :: IsSafeImport
</span><a href="#local-6989586621681072427"><span class="hs-identifier hs-var hs-var">no_change</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Fingerprint
</span><a href="#local-6989586621681072437"><span class="hs-identifier hs-var">old_iface</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Fingerprint -&gt; Maybe Fingerprint -&gt; IsSafeImport
forall a. Eq a =&gt; a -&gt; a -&gt; IsSafeImport
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Fingerprint -&gt; Maybe Fingerprint
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModIfaceBackend -&gt; Fingerprint
</span><a href="GHC.Driver.Types.html#mi_iface_hash"><span class="hs-identifier hs-var hs-var">mi_iface_hash</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModIface -&gt; IfaceBackendExts 'ModIfaceFinal
forall (phase :: ModIfacePhase).
ModIface_ phase -&gt; IfaceBackendExts phase
</span><a href="GHC.Driver.Types.html#mi_final_exts"><span class="hs-identifier hs-var hs-var">mi_final_exts</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621681072438"><span class="hs-identifier hs-var">iface</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-954"></span><span>
</span><span id="line-955"></span><span>    </span><span class="annot"><span class="annottext">IsSafeImport -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; IsSafeImport -&gt; f () -&gt; f ()
</span><a href="../../base/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsSafeImport
</span><a href="#local-6989586621681072433"><span class="hs-identifier hs-var">write_interface</span></a></span><span> </span><span class="annot"><span class="annottext">IsSafeImport -&gt; IsSafeImport -&gt; IsSafeImport
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><a href="#local-6989586621681072435"><span class="hs-identifier hs-var">force_write_interface</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-956"></span><span>          </span><span class="annot"><span class="annottext">DynFlags -&gt; ModIface -&gt; IsSafeImport -&gt; ModLocation -&gt; IO ()
</span><a href="GHC.Driver.Main.html#hscWriteIface"><span class="hs-identifier hs-var">hscWriteIface</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072439"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621681072438"><span class="hs-identifier hs-var">iface</span></a></span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><a href="#local-6989586621681072427"><span class="hs-identifier hs-var">no_change</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681072436"><span class="hs-identifier hs-var">location</span></a></span><span>
</span><span id="line-957"></span><span>
</span><span id="line-958"></span><span class="hs-comment">--------------------------------------------------------------</span><span>
</span><span id="line-959"></span><span class="hs-comment">-- NoRecomp handlers</span><span>
</span><span id="line-960"></span><span class="hs-comment">--------------------------------------------------------------</span><span>
</span><span id="line-961"></span><span>
</span><span id="line-962"></span><span class="hs-comment">-- NB: this must be knot-tied appropriately, see hscIncrementalCompile</span><span>
</span><span id="line-963"></span><span class="annot"><a href="GHC.Driver.Main.html#genModDetails"><span class="hs-identifier hs-type">genModDetails</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModDetails"><span class="hs-identifier hs-type">ModDetails</span></a></span><span>
</span><span id="line-964"></span><span id="genModDetails"><span class="annot"><span class="annottext">genModDetails :: HscEnv -&gt; ModIface -&gt; IO ModDetails
</span><a href="GHC.Driver.Main.html#genModDetails"><span class="hs-identifier hs-var hs-var">genModDetails</span></a></span></span><span> </span><span id="local-6989586621681072425"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072425"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681072424"><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621681072424"><span class="hs-identifier hs-var">old_iface</span></a></span></span><span>
</span><span id="line-965"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-966"></span><span>    </span><span id="local-6989586621681072423"><span class="annot"><span class="annottext">ModDetails
</span><a href="#local-6989586621681072423"><span class="hs-identifier hs-var">new_details</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;tcRnIface&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-967"></span><span>                   </span><span class="annot"><span class="annottext">HscEnv -&gt; IfG ModDetails -&gt; IO ModDetails
forall a. HscEnv -&gt; IfG a -&gt; IO a
</span><a href="GHC.Tc.Utils.Monad.html#initIfaceLoad"><span class="hs-identifier hs-var">initIfaceLoad</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072425"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModIface -&gt; IfG ModDetails
</span><a href="GHC.IfaceToCore.html#typecheckIface"><span class="hs-identifier hs-var">typecheckIface</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621681072424"><span class="hs-identifier hs-var">old_iface</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-968"></span><span>    </span><span class="annot"><span class="annottext">HscEnv -&gt; IO ()
</span><a href="GHC.Driver.Main.html#dumpIfaceStats"><span class="hs-identifier hs-var">dumpIfaceStats</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072425"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-969"></span><span>    </span><span class="annot"><span class="annottext">ModDetails -&gt; IO ModDetails
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">ModDetails
</span><a href="#local-6989586621681072423"><span class="hs-identifier hs-var">new_details</span></a></span><span>
</span><span id="line-970"></span><span>
</span><span id="line-971"></span><span class="hs-comment">--------------------------------------------------------------</span><span>
</span><span id="line-972"></span><span class="hs-comment">-- Progress displayers.</span><span>
</span><span id="line-973"></span><span class="hs-comment">--------------------------------------------------------------</span><span>
</span><span id="line-974"></span><span>
</span><span id="line-975"></span><span class="annot"><a href="GHC.Driver.Main.html#oneShotMsg"><span class="hs-identifier hs-type">oneShotMsg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Iface.Recomp.html#RecompileRequired"><span class="hs-identifier hs-type">RecompileRequired</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-976"></span><span id="oneShotMsg"><span class="annot"><span class="annottext">oneShotMsg :: HscEnv -&gt; RecompileRequired -&gt; IO ()
</span><a href="GHC.Driver.Main.html#oneShotMsg"><span class="hs-identifier hs-var hs-var">oneShotMsg</span></a></span></span><span> </span><span id="local-6989586621681072421"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072421"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681072420"><span class="annot"><span class="annottext">RecompileRequired
</span><a href="#local-6989586621681072420"><span class="hs-identifier hs-var">recomp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-977"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">RecompileRequired
</span><a href="#local-6989586621681072420"><span class="hs-identifier hs-var">recomp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-978"></span><span>        </span><span class="annot"><span class="annottext">RecompileRequired
</span><a href="GHC.Iface.Recomp.html#UpToDate"><span class="hs-identifier hs-var">UpToDate</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-979"></span><span>            </span><span class="annot"><span class="annottext">DynFlags -&gt; String -&gt; IO ()
</span><a href="GHC.Utils.Error.html#compilationProgressMsg"><span class="hs-identifier hs-var">compilationProgressMsg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072421"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ()) -&gt; String -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-980"></span><span>                   </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;compilation IS NOT required&quot;</span></span><span>
</span><span id="line-981"></span><span>        </span><span class="annot"><span class="annottext">RecompileRequired
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-982"></span><span>            </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-983"></span><span>
</span><span id="line-984"></span><span class="annot"><a href="GHC.Driver.Main.html#batchMsg"><span class="hs-identifier hs-type">batchMsg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#Messager"><span class="hs-identifier hs-type">Messager</span></a></span><span>
</span><span id="line-985"></span><span id="batchMsg"><span class="annot"><span class="annottext">batchMsg :: Messager
</span><a href="GHC.Driver.Main.html#batchMsg"><span class="hs-identifier hs-var hs-var">batchMsg</span></a></span></span><span> </span><span id="local-6989586621681072418"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072418"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681072417"><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621681072417"><span class="hs-identifier hs-var">mod_index</span></a></span></span><span> </span><span id="local-6989586621681072416"><span class="annot"><span class="annottext">RecompileRequired
</span><a href="#local-6989586621681072416"><span class="hs-identifier hs-var">recomp</span></a></span></span><span> </span><span id="local-6989586621681072415"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681072415"><span class="hs-identifier hs-var">mod_summary</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-986"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">RecompileRequired
</span><a href="#local-6989586621681072416"><span class="hs-identifier hs-var">recomp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-987"></span><span>        </span><span class="annot"><span class="annottext">RecompileRequired
</span><a href="GHC.Iface.Recomp.html#MustCompile"><span class="hs-identifier hs-var">MustCompile</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; IO ()
</span><a href="#local-6989586621681072413"><span class="hs-identifier hs-var">showMsg</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Compiling &quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-988"></span><span>        </span><span class="annot"><span class="annottext">RecompileRequired
</span><a href="GHC.Iface.Recomp.html#UpToDate"><span class="hs-identifier hs-var">UpToDate</span></a></span><span>
</span><span id="line-989"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Int
</span><a href="GHC.Driver.Session.html#verbosity"><span class="hs-identifier hs-var hs-var">verbosity</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072418"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; IsSafeImport
forall a. Ord a =&gt; a -&gt; a -&gt; IsSafeImport
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; IO ()
</span><a href="#local-6989586621681072413"><span class="hs-identifier hs-var">showMsg</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Skipping  &quot;</span></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&quot;</span></span><span>
</span><span id="line-990"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-991"></span><span>        </span><span class="annot"><a href="GHC.Iface.Recomp.html#RecompBecause"><span class="hs-identifier hs-type">RecompBecause</span></a></span><span> </span><span id="local-6989586621681072411"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681072411"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; IO ()
</span><a href="#local-6989586621681072413"><span class="hs-identifier hs-var">showMsg</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Compiling &quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; [&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681072411"><span class="hs-identifier hs-var">reason</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;]&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-992"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-993"></span><span>        </span><span id="local-6989586621681072410"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621681072410"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072418"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-994"></span><span>        </span><span id="local-6989586621681072413"><span class="annot"><span class="annottext">showMsg :: String -&gt; String -&gt; IO ()
</span><a href="#local-6989586621681072413"><span class="hs-identifier hs-var hs-var">showMsg</span></a></span></span><span> </span><span id="local-6989586621681072409"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681072409"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span id="local-6989586621681072408"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681072408"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-995"></span><span>            </span><span class="annot"><span class="annottext">DynFlags -&gt; String -&gt; IO ()
</span><a href="GHC.Utils.Error.html#compilationProgressMsg"><span class="hs-identifier hs-var">compilationProgressMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072410"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; IO ()) -&gt; String -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-996"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Int, Int) -&gt; String
</span><a href="GHC.Driver.Main.html#showModuleIndex"><span class="hs-identifier hs-var">showModuleIndex</span></a></span><span> </span><span class="annot"><span class="annottext">(Int, Int)
</span><a href="#local-6989586621681072417"><span class="hs-identifier hs-var">mod_index</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-997"></span><span>            </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681072409"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; HscTarget -&gt; IsSafeImport -&gt; ModSummary -&gt; String
</span><a href="GHC.Driver.Types.html#showModMsg"><span class="hs-identifier hs-var">showModMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072410"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; HscTarget
</span><a href="GHC.Driver.Session.html#hscTarget"><span class="hs-identifier hs-var hs-var">hscTarget</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072410"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-998"></span><span>                              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RecompileRequired -&gt; IsSafeImport
</span><a href="GHC.Iface.Recomp.html#recompileRequired"><span class="hs-identifier hs-var">recompileRequired</span></a></span><span> </span><span class="annot"><span class="annottext">RecompileRequired
</span><a href="#local-6989586621681072416"><span class="hs-identifier hs-var">recomp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681072415"><span class="hs-identifier hs-var">mod_summary</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-999"></span><span>                </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681072408"><span class="hs-identifier hs-var">reason</span></a></span><span>
</span><span id="line-1000"></span><span>
</span><span id="line-1001"></span><span class="hs-comment">--------------------------------------------------------------</span><span>
</span><span id="line-1002"></span><span class="hs-comment">-- Safe Haskell</span><span>
</span><span id="line-1003"></span><span class="hs-comment">--------------------------------------------------------------</span><span>
</span><span id="line-1004"></span><span>
</span><span id="line-1005"></span><span class="hs-comment">-- Note [Safe Haskell Trust Check]</span><span>
</span><span id="line-1006"></span><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><span id="line-1007"></span><span class="hs-comment">-- Safe Haskell checks that an import is trusted according to the following</span><span>
</span><span id="line-1008"></span><span class="hs-comment">-- rules for an import of module M that resides in Package P:</span><span>
</span><span id="line-1009"></span><span class="hs-comment">--</span><span>
</span><span id="line-1010"></span><span class="hs-comment">--   * If M is recorded as Safe and all its trust dependencies are OK</span><span>
</span><span id="line-1011"></span><span class="hs-comment">--     then M is considered safe.</span><span>
</span><span id="line-1012"></span><span class="hs-comment">--   * If M is recorded as Trustworthy and P is considered trusted and</span><span>
</span><span id="line-1013"></span><span class="hs-comment">--     all M's trust dependencies are OK then M is considered safe.</span><span>
</span><span id="line-1014"></span><span class="hs-comment">--</span><span>
</span><span id="line-1015"></span><span class="hs-comment">-- By trust dependencies we mean that the check is transitive. So if</span><span>
</span><span id="line-1016"></span><span class="hs-comment">-- a module M that is Safe relies on a module N that is trustworthy,</span><span>
</span><span id="line-1017"></span><span class="hs-comment">-- importing module M will first check (according to the second case)</span><span>
</span><span id="line-1018"></span><span class="hs-comment">-- that N is trusted before checking M is trusted.</span><span>
</span><span id="line-1019"></span><span class="hs-comment">--</span><span>
</span><span id="line-1020"></span><span class="hs-comment">-- This is a minimal description, so please refer to the user guide</span><span>
</span><span id="line-1021"></span><span class="hs-comment">-- for more details. The user guide is also considered the authoritative</span><span>
</span><span id="line-1022"></span><span class="hs-comment">-- source in this matter, not the comments or code.</span><span>
</span><span id="line-1023"></span><span>
</span><span id="line-1024"></span><span>
</span><span id="line-1025"></span><span class="hs-comment">-- Note [Safe Haskell Inference]</span><span>
</span><span id="line-1026"></span><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><span id="line-1027"></span><span class="hs-comment">-- Safe Haskell does Safe inference on modules that don't have any specific</span><span>
</span><span id="line-1028"></span><span class="hs-comment">-- safe haskell mode flag. The basic approach to this is:</span><span>
</span><span id="line-1029"></span><span class="hs-comment">--   * When deciding if we need to do a Safe language check, treat</span><span>
</span><span id="line-1030"></span><span class="hs-comment">--     an unmarked module as having -XSafe mode specified.</span><span>
</span><span id="line-1031"></span><span class="hs-comment">--   * For checks, don't throw errors but return them to the caller.</span><span>
</span><span id="line-1032"></span><span class="hs-comment">--   * Caller checks if there are errors:</span><span>
</span><span id="line-1033"></span><span class="hs-comment">--     * For modules explicitly marked -XSafe, we throw the errors.</span><span>
</span><span id="line-1034"></span><span class="hs-comment">--     * For unmarked modules (inference mode), we drop the errors</span><span>
</span><span id="line-1035"></span><span class="hs-comment">--       and mark the module as being Unsafe.</span><span>
</span><span id="line-1036"></span><span class="hs-comment">--</span><span>
</span><span id="line-1037"></span><span class="hs-comment">-- It used to be that we only did safe inference on modules that had no Safe</span><span>
</span><span id="line-1038"></span><span class="hs-comment">-- Haskell flags, but now we perform safe inference on all modules as we want</span><span>
</span><span id="line-1039"></span><span class="hs-comment">-- to allow users to set the `-Wsafe`, `-Wunsafe` and</span><span>
</span><span id="line-1040"></span><span class="hs-comment">-- `-Wtrustworthy-safe` flags on Trustworthy and Unsafe modules so that a</span><span>
</span><span id="line-1041"></span><span class="hs-comment">-- user can ensure their assumptions are correct and see reasons for why a</span><span>
</span><span id="line-1042"></span><span class="hs-comment">-- module is safe or unsafe.</span><span>
</span><span id="line-1043"></span><span class="hs-comment">--</span><span>
</span><span id="line-1044"></span><span class="hs-comment">-- This is tricky as we must be careful when we should throw an error compared</span><span>
</span><span id="line-1045"></span><span class="hs-comment">-- to just warnings. For checking safe imports we manage it as two steps. First</span><span>
</span><span id="line-1046"></span><span class="hs-comment">-- we check any imports that are required to be safe, then we check all other</span><span>
</span><span id="line-1047"></span><span class="hs-comment">-- imports to see if we can infer them to be safe.</span><span>
</span><span id="line-1048"></span><span>
</span><span id="line-1049"></span><span>
</span><span id="line-1050"></span><span class="hs-comment">-- | Check that the safe imports of the module being compiled are valid.</span><span>
</span><span id="line-1051"></span><span class="hs-comment">-- If not we either issue a compilation error if the module is explicitly</span><span>
</span><span id="line-1052"></span><span class="hs-comment">-- using Safe Haskell, or mark the module as unsafe if we're in safe</span><span>
</span><span id="line-1053"></span><span class="hs-comment">-- inference mode.</span><span>
</span><span id="line-1054"></span><span class="annot"><a href="GHC.Driver.Main.html#hscCheckSafeImports"><span class="hs-identifier hs-type">hscCheckSafeImports</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span>
</span><span id="line-1055"></span><span id="hscCheckSafeImports"><span class="annot"><span class="annottext">hscCheckSafeImports :: TcGblEnv -&gt; Hsc TcGblEnv
</span><a href="GHC.Driver.Main.html#hscCheckSafeImports"><span class="hs-identifier hs-var hs-var">hscCheckSafeImports</span></a></span></span><span> </span><span id="local-6989586621681072406"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072406"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1056"></span><span>    </span><span id="local-6989586621681072405"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072405"><span class="hs-identifier hs-var">dflags</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-1057"></span><span>    </span><span id="local-6989586621681072404"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072404"><span class="hs-identifier hs-var">tcg_env'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; Hsc TcGblEnv
</span><a href="GHC.Driver.Main.html#checkSafeImports"><span class="hs-identifier hs-var">checkSafeImports</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072406"><span class="hs-identifier hs-var">tcg_env</span></a></span><span>
</span><span id="line-1058"></span><span>    </span><span class="annot"><span class="annottext">DynFlags -&gt; TcGblEnv -&gt; Hsc TcGblEnv
</span><a href="#local-6989586621681072402"><span class="hs-identifier hs-var">checkRULES</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072405"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072404"><span class="hs-identifier hs-var">tcg_env'</span></a></span><span>
</span><span id="line-1059"></span><span>
</span><span id="line-1060"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1061"></span><span>    </span><span id="local-6989586621681072402"><span class="annot"><span class="annottext">checkRULES :: DynFlags -&gt; TcGblEnv -&gt; Hsc TcGblEnv
</span><a href="#local-6989586621681072402"><span class="hs-identifier hs-var hs-var">checkRULES</span></a></span></span><span> </span><span id="local-6989586621681072397"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072397"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621681072396"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072396"><span class="hs-identifier hs-var">tcg_env'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1062"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; IsSafeImport
</span><a href="GHC.Driver.Session.html#safeLanguageOn"><span class="hs-identifier hs-var">safeLanguageOn</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072397"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1063"></span><span>          </span><span class="annot"><span class="annottext">IsSafeImport
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1064"></span><span>              </span><span class="hs-comment">-- XSafe: we nuke user written RULES</span><span>
</span><span id="line-1065"></span><span>              </span><span class="annot"><span class="annottext">WarningMessages -&gt; Hsc ()
</span><a href="GHC.Driver.Main.html#logWarnings"><span class="hs-identifier hs-var">logWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">(WarningMessages -&gt; Hsc ()) -&gt; WarningMessages -&gt; Hsc ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
-&gt; [GenLocated SrcSpan (RuleDecl GhcTc)] -&gt; WarningMessages
</span><a href="#local-6989586621681072394"><span class="hs-identifier hs-var">warns</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072397"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; [GenLocated SrcSpan (RuleDecl GhcTc)]
</span><a href="GHC.Tc.Types.html#tcg_rules"><span class="hs-identifier hs-var hs-var">tcg_rules</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072396"><span class="hs-identifier hs-var">tcg_env'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1066"></span><span>              </span><span class="annot"><span class="annottext">TcGblEnv -&gt; Hsc TcGblEnv
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072396"><span class="hs-identifier hs-var">tcg_env'</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcg_rules :: [GenLocated SrcSpan (RuleDecl GhcTc)]
</span><a href="GHC.Tc.Types.html#tcg_rules"><span class="hs-identifier hs-var">tcg_rules</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1067"></span><span>          </span><span class="annot"><span class="annottext">IsSafeImport
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1068"></span><span>                </span><span class="hs-comment">-- SafeInferred: user defined RULES, so not safe</span><span>
</span><span id="line-1069"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; IsSafeImport
</span><a href="GHC.Driver.Session.html#safeInferOn"><span class="hs-identifier hs-var">safeInferOn</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072397"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">IsSafeImport -&gt; IsSafeImport -&gt; IsSafeImport
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">IsSafeImport -&gt; IsSafeImport
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[GenLocated SrcSpan (RuleDecl GhcTc)] -&gt; IsSafeImport
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; IsSafeImport
</span><a href="../../base/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">([GenLocated SrcSpan (RuleDecl GhcTc)] -&gt; IsSafeImport)
-&gt; [GenLocated SrcSpan (RuleDecl GhcTc)] -&gt; IsSafeImport
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; [GenLocated SrcSpan (RuleDecl GhcTc)]
</span><a href="GHC.Tc.Types.html#tcg_rules"><span class="hs-identifier hs-var hs-var">tcg_rules</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072396"><span class="hs-identifier hs-var">tcg_env'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1070"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; WarningMessages -&gt; Hsc TcGblEnv
</span><a href="GHC.Driver.Main.html#markUnsafeInfer"><span class="hs-identifier hs-var">markUnsafeInfer</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072396"><span class="hs-identifier hs-var">tcg_env'</span></a></span><span> </span><span class="annot"><span class="annottext">(WarningMessages -&gt; Hsc TcGblEnv)
-&gt; WarningMessages -&gt; Hsc TcGblEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
-&gt; [GenLocated SrcSpan (RuleDecl GhcTc)] -&gt; WarningMessages
</span><a href="#local-6989586621681072394"><span class="hs-identifier hs-var">warns</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072397"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; [GenLocated SrcSpan (RuleDecl GhcTc)]
</span><a href="GHC.Tc.Types.html#tcg_rules"><span class="hs-identifier hs-var hs-var">tcg_rules</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072396"><span class="hs-identifier hs-var">tcg_env'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1071"></span><span>
</span><span id="line-1072"></span><span>                </span><span class="hs-comment">-- Trustworthy OR SafeInferred: with no RULES</span><span>
</span><span id="line-1073"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1074"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; Hsc TcGblEnv
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072396"><span class="hs-identifier hs-var">tcg_env'</span></a></span><span>
</span><span id="line-1075"></span><span>
</span><span id="line-1076"></span><span>    </span><span id="local-6989586621681072394"><span class="annot"><span class="annottext">warns :: DynFlags
-&gt; [GenLocated SrcSpan (RuleDecl GhcTc)] -&gt; WarningMessages
</span><a href="#local-6989586621681072394"><span class="hs-identifier hs-var hs-var">warns</span></a></span></span><span> </span><span id="local-6989586621681072391"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072391"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621681072390"><span class="annot"><span class="annottext">[GenLocated SrcSpan (RuleDecl GhcTc)]
</span><a href="#local-6989586621681072390"><span class="hs-identifier hs-var">rules</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ErrMsg] -&gt; WarningMessages
forall a. [a] -&gt; Bag a
</span><a href="GHC.Data.Bag.html#listToBag"><span class="hs-identifier hs-var">listToBag</span></a></span><span> </span><span class="annot"><span class="annottext">([ErrMsg] -&gt; WarningMessages) -&gt; [ErrMsg] -&gt; WarningMessages
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpan (RuleDecl GhcTc) -&gt; ErrMsg)
-&gt; [GenLocated SrcSpan (RuleDecl GhcTc)] -&gt; [ErrMsg]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; GenLocated SrcSpan (RuleDecl GhcTc) -&gt; ErrMsg
</span><a href="#local-6989586621681072388"><span class="hs-identifier hs-var">warnRules</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072391"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[GenLocated SrcSpan (RuleDecl GhcTc)]
</span><a href="#local-6989586621681072390"><span class="hs-identifier hs-var">rules</span></a></span><span>
</span><span id="line-1077"></span><span>
</span><span id="line-1078"></span><span>    </span><span class="annot"><a href="#local-6989586621681072388"><span class="hs-identifier hs-type">warnRules</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#GenLocated"><span class="hs-identifier hs-type">GenLocated</span></a></span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Decls.html#RuleDecl"><span class="hs-identifier hs-type">RuleDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#ErrMsg"><span class="hs-identifier hs-type">ErrMsg</span></a></span><span>
</span><span id="line-1079"></span><span>    </span><span id="local-6989586621681072388"><span class="annot"><span class="annottext">warnRules :: DynFlags -&gt; GenLocated SrcSpan (RuleDecl GhcTc) -&gt; ErrMsg
</span><a href="#local-6989586621681072388"><span class="hs-identifier hs-var hs-var">warnRules</span></a></span></span><span> </span><span id="local-6989586621681072387"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072387"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681072385"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681072385"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Decls.html#HsRule"><span class="hs-identifier hs-type">HsRule</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">rd_name :: forall pass. RuleDecl pass -&gt; Located (SourceText, FastString)
</span><a href="GHC.Hs.Decls.html#rd_name"><span class="hs-identifier hs-var">rd_name</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681072382"><span class="annot"><span class="annottext">Located (SourceText, FastString)
</span><a href="#local-6989586621681072382"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1080"></span><span>        </span><span class="annot"><span class="annottext">DynFlags -&gt; SrcSpan -&gt; SDoc -&gt; ErrMsg
</span><a href="GHC.Utils.Error.html#mkPlainWarnMsg"><span class="hs-identifier hs-var">mkPlainWarnMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072387"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681072385"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; ErrMsg) -&gt; SDoc -&gt; ErrMsg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1081"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Rule \&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ftext"><span class="hs-identifier hs-var">ftext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SourceText, FastString) -&gt; FastString
forall a b. (a, b) -&gt; b
</span><a href="../../base/src/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">((SourceText, FastString) -&gt; FastString)
-&gt; (SourceText, FastString) -&gt; FastString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Located (SourceText, FastString) -&gt; (SourceText, FastString)
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">Located (SourceText, FastString)
</span><a href="#local-6989586621681072382"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;\&quot; ignored&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%2B%24"><span class="hs-operator hs-var">$+$</span></a></span><span>
</span><span id="line-1082"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;User defined rules are disabled under Safe Haskell&quot;</span></span><span>
</span><span id="line-1083"></span><span>
</span><span id="line-1084"></span><span class="hs-comment">-- | Validate that safe imported modules are actually safe.  For modules in the</span><span>
</span><span id="line-1085"></span><span class="hs-comment">-- HomePackage (the package the module we are compiling in resides) this just</span><span>
</span><span id="line-1086"></span><span class="hs-comment">-- involves checking its trust type is 'Safe' or 'Trustworthy'. For modules</span><span>
</span><span id="line-1087"></span><span class="hs-comment">-- that reside in another package we also must check that the external package</span><span>
</span><span id="line-1088"></span><span class="hs-comment">-- is trusted. See the Note [Safe Haskell Trust Check] above for more</span><span>
</span><span id="line-1089"></span><span class="hs-comment">-- information.</span><span>
</span><span id="line-1090"></span><span class="hs-comment">--</span><span>
</span><span id="line-1091"></span><span class="hs-comment">-- The code for this is quite tricky as the whole algorithm is done in a few</span><span>
</span><span id="line-1092"></span><span class="hs-comment">-- distinct phases in different parts of the code base. See</span><span>
</span><span id="line-1093"></span><span class="hs-comment">-- 'GHC.Rename.Names.rnImportDecl' for where package trust dependencies for a</span><span>
</span><span id="line-1094"></span><span class="hs-comment">-- module are collected and unioned.  Specifically see the Note [Tracking Trust</span><span>
</span><span id="line-1095"></span><span class="hs-comment">-- Transitively] in &quot;GHC.Rename.Names&quot; and the Note [Trust Own Package] in</span><span>
</span><span id="line-1096"></span><span class="hs-comment">-- &quot;GHC.Rename.Names&quot;.</span><span>
</span><span id="line-1097"></span><span class="annot"><a href="GHC.Driver.Main.html#checkSafeImports"><span class="hs-identifier hs-type">checkSafeImports</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span>
</span><span id="line-1098"></span><span id="checkSafeImports"><span class="annot"><span class="annottext">checkSafeImports :: TcGblEnv -&gt; Hsc TcGblEnv
</span><a href="GHC.Driver.Main.html#checkSafeImports"><span class="hs-identifier hs-var hs-var">checkSafeImports</span></a></span></span><span> </span><span id="local-6989586621681072378"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072378"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span>
</span><span id="line-1099"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1100"></span><span>        </span><span id="local-6989586621681072377"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072377"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-1101"></span><span>        </span><span id="local-6989586621681072376"><span class="annot"><span class="annottext">[(Module, SrcSpan, IsSafeImport)]
</span><a href="#local-6989586621681072376"><span class="hs-identifier hs-var">imps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((Module, [ImportedModsVal])
 -&gt; Hsc (Module, SrcSpan, IsSafeImport))
-&gt; [(Module, [ImportedModsVal])]
-&gt; Hsc [(Module, SrcSpan, IsSafeImport)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">(Module, [ImportedModsVal]) -&gt; Hsc (Module, SrcSpan, IsSafeImport)
</span><a href="#local-6989586621681072374"><span class="hs-identifier hs-var">condense</span></a></span><span> </span><span class="annot"><span class="annottext">[(Module, [ImportedModsVal])]
</span><a href="#local-6989586621681072373"><span class="hs-identifier hs-var">imports'</span></a></span><span>
</span><span id="line-1102"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681072372"><span class="annot"><span class="annottext">[(Module, SrcSpan, IsSafeImport)]
</span><a href="#local-6989586621681072372"><span class="hs-identifier hs-var">safeImps</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681072371"><span class="annot"><span class="annottext">[(Module, SrcSpan, IsSafeImport)]
</span><a href="#local-6989586621681072371"><span class="hs-identifier hs-var">regImps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Module, SrcSpan, IsSafeImport) -&gt; IsSafeImport)
-&gt; [(Module, SrcSpan, IsSafeImport)]
-&gt; ([(Module, SrcSpan, IsSafeImport)],
    [(Module, SrcSpan, IsSafeImport)])
forall a. (a -&gt; IsSafeImport) -&gt; [a] -&gt; ([a], [a])
</span><a href="../../base/src/Data.OldList.html#partition"><span class="hs-identifier hs-var">partition</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621681072370"><span class="annot"><span class="annottext">IsSafeImport
</span><a href="#local-6989586621681072370"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><a href="#local-6989586621681072370"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Module, SrcSpan, IsSafeImport)]
</span><a href="#local-6989586621681072376"><span class="hs-identifier hs-var">imps</span></a></span><span>
</span><span id="line-1103"></span><span>
</span><span id="line-1104"></span><span>        </span><span class="hs-comment">-- We want to use the warning state specifically for detecting if safe</span><span>
</span><span id="line-1105"></span><span>        </span><span class="hs-comment">-- inference has failed, so store and clear any existing warnings.</span><span>
</span><span id="line-1106"></span><span>        </span><span id="local-6989586621681072369"><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681072369"><span class="hs-identifier hs-var">oldErrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc WarningMessages
</span><a href="GHC.Driver.Main.html#getWarnings"><span class="hs-identifier hs-var">getWarnings</span></a></span><span>
</span><span id="line-1107"></span><span>        </span><span class="annot"><span class="annottext">Hsc ()
</span><a href="GHC.Driver.Main.html#clearWarnings"><span class="hs-identifier hs-var">clearWarnings</span></a></span><span>
</span><span id="line-1108"></span><span>
</span><span id="line-1109"></span><span>        </span><span class="hs-comment">-- Check safe imports are correct</span><span>
</span><span id="line-1110"></span><span>        </span><span id="local-6989586621681072368"><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621681072368"><span class="hs-identifier hs-var">safePkgs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[UnitId] -&gt; Set UnitId
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="../../containers/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">S.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([UnitId] -&gt; Set UnitId) -&gt; Hsc [UnitId] -&gt; Hsc (Set UnitId)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">((Module, SrcSpan, IsSafeImport) -&gt; Hsc (Maybe UnitId))
-&gt; [(Module, SrcSpan, IsSafeImport)] -&gt; Hsc [UnitId]
forall (m :: * -&gt; *) a b.
Applicative m =&gt;
(a -&gt; m (Maybe b)) -&gt; [a] -&gt; m [b]
</span><a href="GHC.Utils.Monad.html#mapMaybeM"><span class="hs-identifier hs-var">mapMaybeM</span></a></span><span> </span><span class="annot"><span class="annottext">(Module, SrcSpan, IsSafeImport) -&gt; Hsc (Maybe UnitId)
forall a. (Module, SrcSpan, a) -&gt; Hsc (Maybe UnitId)
</span><a href="#local-6989586621681072365"><span class="hs-identifier hs-var">checkSafe</span></a></span><span> </span><span class="annot"><span class="annottext">[(Module, SrcSpan, IsSafeImport)]
</span><a href="#local-6989586621681072372"><span class="hs-identifier hs-var">safeImps</span></a></span><span>
</span><span id="line-1111"></span><span>        </span><span id="local-6989586621681072364"><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681072364"><span class="hs-identifier hs-var">safeErrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc WarningMessages
</span><a href="GHC.Driver.Main.html#getWarnings"><span class="hs-identifier hs-var">getWarnings</span></a></span><span>
</span><span id="line-1112"></span><span>        </span><span class="annot"><span class="annottext">Hsc ()
</span><a href="GHC.Driver.Main.html#clearWarnings"><span class="hs-identifier hs-var">clearWarnings</span></a></span><span>
</span><span id="line-1113"></span><span>
</span><span id="line-1114"></span><span>        </span><span class="hs-comment">-- Check non-safe imports are correct if inferring safety</span><span>
</span><span id="line-1115"></span><span>        </span><span class="hs-comment">-- See the Note [Safe Haskell Inference]</span><span>
</span><span id="line-1116"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621681072363"><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681072363"><span class="hs-identifier hs-var">infErrs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681072362"><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621681072362"><span class="hs-identifier hs-var">infPkgs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; IsSafeImport
</span><a href="GHC.Driver.Session.html#safeInferOn"><span class="hs-identifier hs-var">safeInferOn</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072377"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1117"></span><span>          </span><span class="annot"><span class="annottext">IsSafeImport
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(WarningMessages, Set UnitId) -&gt; Hsc (WarningMessages, Set UnitId)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WarningMessages
forall a. Bag a
</span><a href="GHC.Data.Bag.html#emptyBag"><span class="hs-identifier hs-var">emptyBag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set UnitId
forall a. Set a
</span><a href="../../containers/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">S.empty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1118"></span><span>          </span><span class="annot"><span class="annottext">IsSafeImport
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621681072360"><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621681072360"><span class="hs-identifier hs-var">infPkgs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[UnitId] -&gt; Set UnitId
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="../../containers/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">S.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([UnitId] -&gt; Set UnitId) -&gt; Hsc [UnitId] -&gt; Hsc (Set UnitId)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">((Module, SrcSpan, IsSafeImport) -&gt; Hsc (Maybe UnitId))
-&gt; [(Module, SrcSpan, IsSafeImport)] -&gt; Hsc [UnitId]
forall (m :: * -&gt; *) a b.
Applicative m =&gt;
(a -&gt; m (Maybe b)) -&gt; [a] -&gt; m [b]
</span><a href="GHC.Utils.Monad.html#mapMaybeM"><span class="hs-identifier hs-var">mapMaybeM</span></a></span><span> </span><span class="annot"><span class="annottext">(Module, SrcSpan, IsSafeImport) -&gt; Hsc (Maybe UnitId)
forall a. (Module, SrcSpan, a) -&gt; Hsc (Maybe UnitId)
</span><a href="#local-6989586621681072365"><span class="hs-identifier hs-var">checkSafe</span></a></span><span> </span><span class="annot"><span class="annottext">[(Module, SrcSpan, IsSafeImport)]
</span><a href="#local-6989586621681072371"><span class="hs-identifier hs-var">regImps</span></a></span><span>
</span><span id="line-1119"></span><span>                     </span><span id="local-6989586621681072359"><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681072359"><span class="hs-identifier hs-var">infErrs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc WarningMessages
</span><a href="GHC.Driver.Main.html#getWarnings"><span class="hs-identifier hs-var">getWarnings</span></a></span><span>
</span><span id="line-1120"></span><span>                     </span><span class="annot"><span class="annottext">Hsc ()
</span><a href="GHC.Driver.Main.html#clearWarnings"><span class="hs-identifier hs-var">clearWarnings</span></a></span><span>
</span><span id="line-1121"></span><span>                     </span><span class="annot"><span class="annottext">(WarningMessages, Set UnitId) -&gt; Hsc (WarningMessages, Set UnitId)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681072359"><span class="hs-identifier hs-var">infErrs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621681072360"><span class="hs-identifier hs-var">infPkgs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1122"></span><span>
</span><span id="line-1123"></span><span>        </span><span class="hs-comment">-- restore old errors</span><span>
</span><span id="line-1124"></span><span>        </span><span class="annot"><span class="annottext">WarningMessages -&gt; Hsc ()
</span><a href="GHC.Driver.Main.html#logWarnings"><span class="hs-identifier hs-var">logWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681072369"><span class="hs-identifier hs-var">oldErrs</span></a></span><span>
</span><span id="line-1125"></span><span>
</span><span id="line-1126"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WarningMessages -&gt; IsSafeImport
forall a. Bag a -&gt; IsSafeImport
</span><a href="GHC.Data.Bag.html#isEmptyBag"><span class="hs-identifier hs-var">isEmptyBag</span></a></span><span> </span><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681072364"><span class="hs-identifier hs-var">safeErrs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1127"></span><span>          </span><span class="hs-comment">-- Failed safe check</span><span>
</span><span id="line-1128"></span><span>          </span><span class="annot"><span class="annottext">IsSafeImport
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO TcGblEnv -&gt; Hsc TcGblEnv
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO TcGblEnv -&gt; Hsc TcGblEnv)
-&gt; (WarningMessages -&gt; IO TcGblEnv)
-&gt; WarningMessages
-&gt; Hsc TcGblEnv
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">SourceError -&gt; IO TcGblEnv
forall e a. Exception e =&gt; e -&gt; IO a
</span><a href="../../base/src/GHC.IO.html#throwIO"><span class="hs-identifier hs-var">throwIO</span></a></span><span> </span><span class="annot"><span class="annottext">(SourceError -&gt; IO TcGblEnv)
-&gt; (WarningMessages -&gt; SourceError)
-&gt; WarningMessages
-&gt; IO TcGblEnv
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">WarningMessages -&gt; SourceError
</span><a href="GHC.Driver.Types.html#mkSrcErr"><span class="hs-identifier hs-var">mkSrcErr</span></a></span><span> </span><span class="annot"><span class="annottext">(WarningMessages -&gt; Hsc TcGblEnv)
-&gt; WarningMessages -&gt; Hsc TcGblEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681072364"><span class="hs-identifier hs-var">safeErrs</span></a></span><span>
</span><span id="line-1129"></span><span>
</span><span id="line-1130"></span><span>          </span><span class="hs-comment">-- Passed safe check</span><span>
</span><span id="line-1131"></span><span>          </span><span class="annot"><span class="annottext">IsSafeImport
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1132"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681072356"><span class="annot"><span class="annottext">infPassed :: IsSafeImport
</span><a href="#local-6989586621681072356"><span class="hs-identifier hs-var hs-var">infPassed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WarningMessages -&gt; IsSafeImport
forall a. Bag a -&gt; IsSafeImport
</span><a href="GHC.Data.Bag.html#isEmptyBag"><span class="hs-identifier hs-var">isEmptyBag</span></a></span><span> </span><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681072363"><span class="hs-identifier hs-var">infErrs</span></a></span><span>
</span><span id="line-1133"></span><span>            </span><span id="local-6989586621681072355"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072355"><span class="hs-identifier hs-var">tcg_env'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsSafeImport -&gt; IsSafeImport
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><a href="#local-6989586621681072356"><span class="hs-identifier hs-var">infPassed</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1134"></span><span>              </span><span class="annot"><span class="annottext">IsSafeImport
</span><span class="hs-identifier hs-var">True</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; WarningMessages -&gt; Hsc TcGblEnv
</span><a href="GHC.Driver.Main.html#markUnsafeInfer"><span class="hs-identifier hs-var">markUnsafeInfer</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072378"><span class="hs-identifier hs-var">tcg_env</span></a></span><span> </span><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681072363"><span class="hs-identifier hs-var">infErrs</span></a></span><span>
</span><span id="line-1135"></span><span>              </span><span class="annot"><span class="annottext">IsSafeImport
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; Hsc TcGblEnv
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072378"><span class="hs-identifier hs-var">tcg_env</span></a></span><span>
</span><span id="line-1136"></span><span>            </span><span class="annot"><span class="annottext">IsSafeImport -&gt; Hsc () -&gt; Hsc ()
forall (f :: * -&gt; *). Applicative f =&gt; IsSafeImport -&gt; f () -&gt; f ()
</span><a href="../../base/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; IsSafeImport
</span><a href="GHC.Driver.Session.html#packageTrustOn"><span class="hs-identifier hs-var">packageTrustOn</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072377"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Hsc () -&gt; Hsc ()) -&gt; Hsc () -&gt; Hsc ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Set UnitId -&gt; Hsc ()
</span><a href="GHC.Driver.Main.html#checkPkgTrust"><span class="hs-identifier hs-var">checkPkgTrust</span></a></span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621681072352"><span class="hs-identifier hs-var">pkgReqs</span></a></span><span>
</span><span id="line-1137"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681072351"><span class="annot"><span class="annottext">newTrust :: ImportAvails
</span><a href="#local-6989586621681072351"><span class="hs-identifier hs-var hs-var">newTrust</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags
-&gt; Set UnitId -&gt; Set UnitId -&gt; IsSafeImport -&gt; ImportAvails
</span><a href="#local-6989586621681072350"><span class="hs-identifier hs-var">pkgTrustReqs</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072377"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621681072368"><span class="hs-identifier hs-var">safePkgs</span></a></span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621681072362"><span class="hs-identifier hs-var">infPkgs</span></a></span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><a href="#local-6989586621681072356"><span class="hs-identifier hs-var">infPassed</span></a></span><span>
</span><span id="line-1138"></span><span>            </span><span class="annot"><span class="annottext">TcGblEnv -&gt; Hsc TcGblEnv
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072355"><span class="hs-identifier hs-var">tcg_env'</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcg_imports :: ImportAvails
</span><a href="GHC.Tc.Types.html#tcg_imports"><span class="hs-identifier hs-var">tcg_imports</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImportAvails
</span><a href="#local-6989586621681072348"><span class="hs-identifier hs-var">impInfo</span></a></span><span> </span><span class="annot"><span class="annottext">ImportAvails -&gt; ImportAvails -&gt; ImportAvails
</span><a href="GHC.Tc.Types.html#plusImportAvails"><span class="hs-operator hs-var">`plusImportAvails`</span></a></span><span> </span><span class="annot"><span class="annottext">ImportAvails
</span><a href="#local-6989586621681072351"><span class="hs-identifier hs-var">newTrust</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1139"></span><span>
</span><span id="line-1140"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1141"></span><span>    </span><span id="local-6989586621681072348"><span class="annot"><span class="annottext">impInfo :: ImportAvails
</span><a href="#local-6989586621681072348"><span class="hs-identifier hs-var hs-var">impInfo</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; ImportAvails
</span><a href="GHC.Tc.Types.html#tcg_imports"><span class="hs-identifier hs-var hs-var">tcg_imports</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072378"><span class="hs-identifier hs-var">tcg_env</span></a></span><span>     </span><span class="hs-comment">-- ImportAvails</span><span>
</span><span id="line-1142"></span><span>    </span><span id="local-6989586621681072346"><span class="annot"><span class="annottext">imports :: ImportedMods
</span><a href="#local-6989586621681072346"><span class="hs-identifier hs-var hs-var">imports</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImportAvails -&gt; ImportedMods
</span><a href="GHC.Tc.Types.html#imp_mods"><span class="hs-identifier hs-var hs-var">imp_mods</span></a></span><span> </span><span class="annot"><span class="annottext">ImportAvails
</span><a href="#local-6989586621681072348"><span class="hs-identifier hs-var">impInfo</span></a></span><span>        </span><span class="hs-comment">-- ImportedMods</span><span>
</span><span id="line-1143"></span><span>    </span><span id="local-6989586621681072344"><span class="annot"><span class="annottext">imports1 :: [(Module, [ImportedBy])]
</span><a href="#local-6989586621681072344"><span class="hs-identifier hs-var hs-var">imports1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImportedMods -&gt; [(Module, [ImportedBy])]
forall a. ModuleEnv a -&gt; [(Module, a)]
</span><a href="GHC.Unit.Module.Env.html#moduleEnvToList"><span class="hs-identifier hs-var">moduleEnvToList</span></a></span><span> </span><span class="annot"><span class="annottext">ImportedMods
</span><a href="#local-6989586621681072346"><span class="hs-identifier hs-var">imports</span></a></span><span> </span><span class="hs-comment">-- (Module, [ImportedBy])</span><span>
</span><span id="line-1144"></span><span>    </span><span id="local-6989586621681072373"><span class="annot"><span class="annottext">imports' :: [(Module, [ImportedModsVal])]
</span><a href="#local-6989586621681072373"><span class="hs-identifier hs-var hs-var">imports'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Module, [ImportedBy]) -&gt; (Module, [ImportedModsVal]))
-&gt; [(Module, [ImportedBy])] -&gt; [(Module, [ImportedModsVal])]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([ImportedBy] -&gt; [ImportedModsVal])
-&gt; (Module, [ImportedBy]) -&gt; (Module, [ImportedModsVal])
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">[ImportedBy] -&gt; [ImportedModsVal]
</span><a href="GHC.Driver.Types.html#importedByUser"><span class="hs-identifier hs-var">importedByUser</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(Module, [ImportedBy])]
</span><a href="#local-6989586621681072344"><span class="hs-identifier hs-var">imports1</span></a></span><span> </span><span class="hs-comment">-- (Module, [ImportedModsVal])</span><span>
</span><span id="line-1145"></span><span>    </span><span id="local-6989586621681072352"><span class="annot"><span class="annottext">pkgReqs :: Set UnitId
</span><a href="#local-6989586621681072352"><span class="hs-identifier hs-var hs-var">pkgReqs</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImportAvails -&gt; Set UnitId
</span><a href="GHC.Tc.Types.html#imp_trust_pkgs"><span class="hs-identifier hs-var hs-var">imp_trust_pkgs</span></a></span><span> </span><span class="annot"><span class="annottext">ImportAvails
</span><a href="#local-6989586621681072348"><span class="hs-identifier hs-var">impInfo</span></a></span><span>  </span><span class="hs-comment">-- [Unit]</span><span>
</span><span id="line-1146"></span><span>
</span><span id="line-1147"></span><span>    </span><span class="annot"><a href="#local-6989586621681072374"><span class="hs-identifier hs-type">condense</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Driver.Types.html#ImportedModsVal"><span class="hs-identifier hs-type">ImportedModsVal</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#IsSafeImport"><span class="hs-identifier hs-type">IsSafeImport</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1148"></span><span>    </span><span id="local-6989586621681072374"><span class="annot"><span class="annottext">condense :: (Module, [ImportedModsVal]) -&gt; Hsc (Module, SrcSpan, IsSafeImport)
</span><a href="#local-6989586621681072374"><span class="hs-identifier hs-var hs-var">condense</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Hsc (Module, SrcSpan, IsSafeImport)
forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;GHC.Driver.Main.condense: Pattern match failure!&quot;</span></span><span>
</span><span id="line-1149"></span><span>    </span><span class="annot"><a href="#local-6989586621681072374"><span class="hs-identifier hs-var">condense</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681072338"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681072338"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681072337"><span class="annot"><span class="annottext">ImportedModsVal
</span><a href="#local-6989586621681072337"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681072336"><span class="annot"><span class="annottext">[ImportedModsVal]
</span><a href="#local-6989586621681072336"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621681072335"><span class="annot"><span class="annottext">ImportedModsVal
</span><a href="#local-6989586621681072335"><span class="hs-identifier hs-var">imv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ImportedModsVal -&gt; ImportedModsVal -&gt; Hsc ImportedModsVal)
-&gt; ImportedModsVal -&gt; [ImportedModsVal] -&gt; Hsc ImportedModsVal
forall (t :: * -&gt; *) (m :: * -&gt; *) b a.
(Foldable t, Monad m) =&gt;
(b -&gt; a -&gt; m b) -&gt; b -&gt; t a -&gt; m b
</span><a href="../../base/src/Data.Foldable.html#foldlM"><span class="hs-identifier hs-var">foldlM</span></a></span><span> </span><span class="annot"><span class="annottext">ImportedModsVal -&gt; ImportedModsVal -&gt; Hsc ImportedModsVal
</span><a href="#local-6989586621681072333"><span class="hs-identifier hs-var">cond'</span></a></span><span> </span><span class="annot"><span class="annottext">ImportedModsVal
</span><a href="#local-6989586621681072337"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">[ImportedModsVal]
</span><a href="#local-6989586621681072336"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-1150"></span><span>                            </span><span class="annot"><span class="annottext">(Module, SrcSpan, IsSafeImport)
-&gt; Hsc (Module, SrcSpan, IsSafeImport)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681072338"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ImportedModsVal -&gt; SrcSpan
</span><a href="GHC.Driver.Types.html#imv_span"><span class="hs-identifier hs-var hs-var">imv_span</span></a></span><span> </span><span class="annot"><span class="annottext">ImportedModsVal
</span><a href="#local-6989586621681072335"><span class="hs-identifier hs-var">imv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ImportedModsVal -&gt; IsSafeImport
</span><a href="GHC.Driver.Types.html#imv_is_safe"><span class="hs-identifier hs-var hs-var">imv_is_safe</span></a></span><span> </span><span class="annot"><span class="annottext">ImportedModsVal
</span><a href="#local-6989586621681072335"><span class="hs-identifier hs-var">imv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1151"></span><span>
</span><span id="line-1152"></span><span>    </span><span class="hs-comment">-- ImportedModsVal = (ModuleName, Bool, SrcSpan, IsSafeImport)</span><span>
</span><span id="line-1153"></span><span>    </span><span class="annot"><a href="#local-6989586621681072333"><span class="hs-identifier hs-type">cond'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ImportedModsVal"><span class="hs-identifier hs-type">ImportedModsVal</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ImportedModsVal"><span class="hs-identifier hs-type">ImportedModsVal</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ImportedModsVal"><span class="hs-identifier hs-type">ImportedModsVal</span></a></span><span>
</span><span id="line-1154"></span><span>    </span><span id="local-6989586621681072333"><span class="annot"><span class="annottext">cond' :: ImportedModsVal -&gt; ImportedModsVal -&gt; Hsc ImportedModsVal
</span><a href="#local-6989586621681072333"><span class="hs-identifier hs-var hs-var">cond'</span></a></span></span><span> </span><span id="local-6989586621681072330"><span class="annot"><span class="annottext">ImportedModsVal
</span><a href="#local-6989586621681072330"><span class="hs-identifier hs-var">v1</span></a></span></span><span> </span><span id="local-6989586621681072329"><span class="annot"><span class="annottext">ImportedModsVal
</span><a href="#local-6989586621681072329"><span class="hs-identifier hs-var">v2</span></a></span></span><span>
</span><span id="line-1155"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ImportedModsVal -&gt; IsSafeImport
</span><a href="GHC.Driver.Types.html#imv_is_safe"><span class="hs-identifier hs-var hs-var">imv_is_safe</span></a></span><span> </span><span class="annot"><span class="annottext">ImportedModsVal
</span><a href="#local-6989586621681072330"><span class="hs-identifier hs-var">v1</span></a></span><span> </span><span class="annot"><span class="annottext">IsSafeImport -&gt; IsSafeImport -&gt; IsSafeImport
forall a. Eq a =&gt; a -&gt; a -&gt; IsSafeImport
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">ImportedModsVal -&gt; IsSafeImport
</span><a href="GHC.Driver.Types.html#imv_is_safe"><span class="hs-identifier hs-var hs-var">imv_is_safe</span></a></span><span> </span><span class="annot"><span class="annottext">ImportedModsVal
</span><a href="#local-6989586621681072329"><span class="hs-identifier hs-var">v2</span></a></span><span>
</span><span id="line-1156"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1157"></span><span>            </span><span id="local-6989586621681072328"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072328"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-1158"></span><span>            </span><span class="annot"><span class="annottext">ErrMsg -&gt; Hsc ImportedModsVal
forall (io :: * -&gt; *) a. MonadIO io =&gt; ErrMsg -&gt; io a
</span><a href="GHC.Driver.Types.html#throwOneError"><span class="hs-identifier hs-var">throwOneError</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrMsg -&gt; Hsc ImportedModsVal) -&gt; ErrMsg -&gt; Hsc ImportedModsVal
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; SrcSpan -&gt; SDoc -&gt; ErrMsg
</span><a href="GHC.Utils.Error.html#mkPlainErrMsg"><span class="hs-identifier hs-var">mkPlainErrMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072328"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ImportedModsVal -&gt; SrcSpan
</span><a href="GHC.Driver.Types.html#imv_span"><span class="hs-identifier hs-var hs-var">imv_span</span></a></span><span> </span><span class="annot"><span class="annottext">ImportedModsVal
</span><a href="#local-6989586621681072330"><span class="hs-identifier hs-var">v1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1159"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Module&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ImportedModsVal -&gt; ModuleName
</span><a href="GHC.Driver.Types.html#imv_name"><span class="hs-identifier hs-var hs-var">imv_name</span></a></span><span> </span><span class="annot"><span class="annottext">ImportedModsVal
</span><a href="#local-6989586621681072330"><span class="hs-identifier hs-var">v1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-1160"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; SDoc) -&gt; String -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;is imported both as a safe and unsafe import!&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1161"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1162"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImportedModsVal -&gt; Hsc ImportedModsVal
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">ImportedModsVal
</span><a href="#local-6989586621681072330"><span class="hs-identifier hs-var">v1</span></a></span><span>
</span><span id="line-1163"></span><span>
</span><span id="line-1164"></span><span>    </span><span class="hs-comment">-- easier interface to work with</span><span>
</span><span id="line-1165"></span><span>    </span><span id="local-6989586621681073664"><span class="annot"><a href="#local-6989586621681072365"><span class="hs-identifier hs-type">checkSafe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621681073664"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1166"></span><span>    </span><span id="local-6989586621681072365"><span class="annot"><span class="annottext">checkSafe :: forall a. (Module, SrcSpan, a) -&gt; Hsc (Maybe UnitId)
</span><a href="#local-6989586621681072365"><span class="hs-identifier hs-var hs-var">checkSafe</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681072323"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681072323"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681072322"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681072322"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Maybe UnitId, Set UnitId) -&gt; Maybe UnitId
forall a b. (a, b) -&gt; a
</span><a href="../../base/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">((Maybe UnitId, Set UnitId) -&gt; Maybe UnitId)
-&gt; Hsc (Maybe UnitId, Set UnitId) -&gt; Hsc (Maybe UnitId)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/GHC.Base.html#fmap"><span class="hs-operator hs-var">`fmap`</span></a></span><span> </span><span class="annot"><span class="annottext">Module -&gt; SrcSpan -&gt; Hsc (Maybe UnitId, Set UnitId)
</span><a href="GHC.Driver.Main.html#hscCheckSafe%27"><span class="hs-identifier hs-var">hscCheckSafe'</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681072323"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681072322"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-1167"></span><span>
</span><span id="line-1168"></span><span>    </span><span class="hs-comment">-- what pkg's to add to our trust requirements</span><span>
</span><span id="line-1169"></span><span>    </span><span class="annot"><a href="#local-6989586621681072350"><span class="hs-identifier hs-type">pkgTrustReqs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../containers/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../containers/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1170"></span><span>          </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#ImportAvails"><span class="hs-identifier hs-type">ImportAvails</span></a></span><span>
</span><span id="line-1171"></span><span>    </span><span id="local-6989586621681072350"><span class="annot"><span class="annottext">pkgTrustReqs :: DynFlags
-&gt; Set UnitId -&gt; Set UnitId -&gt; IsSafeImport -&gt; ImportAvails
</span><a href="#local-6989586621681072350"><span class="hs-identifier hs-var hs-var">pkgTrustReqs</span></a></span></span><span> </span><span id="local-6989586621681072320"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072320"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621681072319"><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621681072319"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span id="local-6989586621681072318"><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621681072318"><span class="hs-identifier hs-var">inf</span></a></span></span><span> </span><span id="local-6989586621681072317"><span class="annot"><span class="annottext">IsSafeImport
</span><a href="#local-6989586621681072317"><span class="hs-identifier hs-var">infPassed</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; IsSafeImport
</span><a href="GHC.Driver.Session.html#safeInferOn"><span class="hs-identifier hs-var">safeInferOn</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072320"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1172"></span><span>                                  </span><span class="annot"><span class="annottext">IsSafeImport -&gt; IsSafeImport -&gt; IsSafeImport
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">IsSafeImport -&gt; IsSafeImport
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; IsSafeImport
</span><a href="GHC.Driver.Session.html#safeHaskellModeEnabled"><span class="hs-identifier hs-var">safeHaskellModeEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072320"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IsSafeImport -&gt; IsSafeImport -&gt; IsSafeImport
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><a href="#local-6989586621681072317"><span class="hs-identifier hs-var">infPassed</span></a></span><span>
</span><span id="line-1173"></span><span>                                   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImportAvails
</span><a href="GHC.Tc.Types.html#emptyImportAvails"><span class="hs-identifier hs-var">emptyImportAvails</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-1174"></span><span>                                       </span><span class="annot"><span class="annottext">imp_trust_pkgs :: Set UnitId
</span><a href="GHC.Tc.Types.html#imp_trust_pkgs"><span class="hs-identifier hs-var">imp_trust_pkgs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621681072319"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="annot"><span class="annottext">Set UnitId -&gt; Set UnitId -&gt; Set UnitId
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="../../containers/src/Data.Set.Internal.html#union"><span class="hs-operator hs-var">`S.union`</span></a></span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621681072318"><span class="hs-identifier hs-var">inf</span></a></span><span>
</span><span id="line-1175"></span><span>                                   </span><span class="hs-special">}</span><span>
</span><span id="line-1176"></span><span>    </span><span class="annot"><a href="#local-6989586621681072350"><span class="hs-identifier hs-var">pkgTrustReqs</span></a></span><span> </span><span id="local-6989586621681072314"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072314"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><span class="hs-identifier">_</span></span><span>   </span><span class="annot"><span class="annottext">Set UnitId
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; SafeHaskellMode
</span><a href="GHC.Driver.Session.html#safeHaskell"><span class="hs-identifier hs-var hs-var">safeHaskell</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072314"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode -&gt; SafeHaskellMode -&gt; IsSafeImport
forall a. Eq a =&gt; a -&gt; a -&gt; IsSafeImport
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="GHC.Driver.Session.html#Sf_Unsafe"><span class="hs-identifier hs-var">Sf_Unsafe</span></a></span><span>
</span><span id="line-1177"></span><span>                         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImportAvails
</span><a href="GHC.Tc.Types.html#emptyImportAvails"><span class="hs-identifier hs-var">emptyImportAvails</span></a></span><span>
</span><span id="line-1178"></span><span>    </span><span class="annot"><a href="#local-6989586621681072350"><span class="hs-identifier hs-var">pkgTrustReqs</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681072312"><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621681072312"><span class="hs-identifier hs-var">req</span></a></span></span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImportAvails
</span><a href="GHC.Tc.Types.html#emptyImportAvails"><span class="hs-identifier hs-var">emptyImportAvails</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">imp_trust_pkgs :: Set UnitId
</span><a href="GHC.Tc.Types.html#imp_trust_pkgs"><span class="hs-identifier hs-var">imp_trust_pkgs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621681072312"><span class="hs-identifier hs-var">req</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1179"></span><span>
</span><span id="line-1180"></span><span class="hs-comment">-- | Check that a module is safe to import.</span><span>
</span><span id="line-1181"></span><span class="hs-comment">--</span><span>
</span><span id="line-1182"></span><span class="hs-comment">-- We return True to indicate the import is safe and False otherwise</span><span>
</span><span id="line-1183"></span><span class="hs-comment">-- although in the False case an exception may be thrown first.</span><span>
</span><span id="line-1184"></span><span class="annot"><a href="GHC.Driver.Main.html#hscCheckSafe"><span class="hs-identifier hs-type">hscCheckSafe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1185"></span><span id="hscCheckSafe"><span class="annot"><span class="annottext">hscCheckSafe :: HscEnv -&gt; Module -&gt; SrcSpan -&gt; IO IsSafeImport
</span><a href="GHC.Driver.Main.html#hscCheckSafe"><span class="hs-identifier hs-var hs-var">hscCheckSafe</span></a></span></span><span> </span><span id="local-6989586621681072311"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072311"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681072310"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681072310"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621681072309"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681072309"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Hsc IsSafeImport -&gt; IO IsSafeImport
forall a. HscEnv -&gt; Hsc a -&gt; IO a
</span><a href="GHC.Driver.Types.html#runHsc"><span class="hs-identifier hs-var">runHsc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072311"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(Hsc IsSafeImport -&gt; IO IsSafeImport)
-&gt; Hsc IsSafeImport -&gt; IO IsSafeImport
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1186"></span><span>    </span><span id="local-6989586621681072308"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072308"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-1187"></span><span>    </span><span id="local-6989586621681072307"><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621681072307"><span class="hs-identifier hs-var">pkgs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Maybe UnitId, Set UnitId) -&gt; Set UnitId
forall a b. (a, b) -&gt; b
</span><a href="../../base/src/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">((Maybe UnitId, Set UnitId) -&gt; Set UnitId)
-&gt; Hsc (Maybe UnitId, Set UnitId) -&gt; Hsc (Set UnitId)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/GHC.Base.html#fmap"><span class="hs-operator hs-var">`fmap`</span></a></span><span> </span><span class="annot"><span class="annottext">Module -&gt; SrcSpan -&gt; Hsc (Maybe UnitId, Set UnitId)
</span><a href="GHC.Driver.Main.html#hscCheckSafe%27"><span class="hs-identifier hs-var">hscCheckSafe'</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681072310"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681072309"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-1188"></span><span>    </span><span class="annot"><span class="annottext">IsSafeImport -&gt; Hsc () -&gt; Hsc ()
forall (f :: * -&gt; *). Applicative f =&gt; IsSafeImport -&gt; f () -&gt; f ()
</span><a href="../../base/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; IsSafeImport
</span><a href="GHC.Driver.Session.html#packageTrustOn"><span class="hs-identifier hs-var">packageTrustOn</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072308"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Hsc () -&gt; Hsc ()) -&gt; Hsc () -&gt; Hsc ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Set UnitId -&gt; Hsc ()
</span><a href="GHC.Driver.Main.html#checkPkgTrust"><span class="hs-identifier hs-var">checkPkgTrust</span></a></span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621681072307"><span class="hs-identifier hs-var">pkgs</span></a></span><span>
</span><span id="line-1189"></span><span>    </span><span id="local-6989586621681072306"><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681072306"><span class="hs-identifier hs-var">errs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc WarningMessages
</span><a href="GHC.Driver.Main.html#getWarnings"><span class="hs-identifier hs-var">getWarnings</span></a></span><span>
</span><span id="line-1190"></span><span>    </span><span class="annot"><span class="annottext">IsSafeImport -&gt; Hsc IsSafeImport
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(IsSafeImport -&gt; Hsc IsSafeImport)
-&gt; IsSafeImport -&gt; Hsc IsSafeImport
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WarningMessages -&gt; IsSafeImport
forall a. Bag a -&gt; IsSafeImport
</span><a href="GHC.Data.Bag.html#isEmptyBag"><span class="hs-identifier hs-var">isEmptyBag</span></a></span><span> </span><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681072306"><span class="hs-identifier hs-var">errs</span></a></span><span>
</span><span id="line-1191"></span><span>
</span><span id="line-1192"></span><span class="hs-comment">-- | Return if a module is trusted and the pkgs it depends on to be trusted.</span><span>
</span><span id="line-1193"></span><span class="annot"><a href="GHC.Driver.Main.html#hscGetSafe"><span class="hs-identifier hs-type">hscGetSafe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../containers/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1194"></span><span id="hscGetSafe"><span class="annot"><span class="annottext">hscGetSafe :: HscEnv -&gt; Module -&gt; SrcSpan -&gt; IO (IsSafeImport, Set UnitId)
</span><a href="GHC.Driver.Main.html#hscGetSafe"><span class="hs-identifier hs-var hs-var">hscGetSafe</span></a></span></span><span> </span><span id="local-6989586621681072305"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072305"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681072304"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681072304"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621681072303"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681072303"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; Hsc (IsSafeImport, Set UnitId) -&gt; IO (IsSafeImport, Set UnitId)
forall a. HscEnv -&gt; Hsc a -&gt; IO a
</span><a href="GHC.Driver.Types.html#runHsc"><span class="hs-identifier hs-var">runHsc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072305"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(Hsc (IsSafeImport, Set UnitId) -&gt; IO (IsSafeImport, Set UnitId))
-&gt; Hsc (IsSafeImport, Set UnitId) -&gt; IO (IsSafeImport, Set UnitId)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1195"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681072302"><span class="annot"><span class="annottext">Maybe UnitId
</span><a href="#local-6989586621681072302"><span class="hs-identifier hs-var">self</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681072301"><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621681072301"><span class="hs-identifier hs-var">pkgs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Module -&gt; SrcSpan -&gt; Hsc (Maybe UnitId, Set UnitId)
</span><a href="GHC.Driver.Main.html#hscCheckSafe%27"><span class="hs-identifier hs-var">hscCheckSafe'</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681072304"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681072303"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-1196"></span><span>    </span><span id="local-6989586621681072300"><span class="annot"><span class="annottext">IsSafeImport
</span><a href="#local-6989586621681072300"><span class="hs-identifier hs-var">good</span></a></span></span><span>         </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">WarningMessages -&gt; IsSafeImport
forall a. Bag a -&gt; IsSafeImport
</span><a href="GHC.Data.Bag.html#isEmptyBag"><span class="hs-identifier hs-var">isEmptyBag</span></a></span><span> </span><span class="annot"><span class="annottext">(WarningMessages -&gt; IsSafeImport)
-&gt; Hsc WarningMessages -&gt; Hsc IsSafeImport
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/GHC.Base.html#fmap"><span class="hs-operator hs-var">`fmap`</span></a></span><span> </span><span class="annot"><span class="annottext">Hsc WarningMessages
</span><a href="GHC.Driver.Main.html#getWarnings"><span class="hs-identifier hs-var">getWarnings</span></a></span><span>
</span><span id="line-1197"></span><span>    </span><span class="annot"><span class="annottext">Hsc ()
</span><a href="GHC.Driver.Main.html#clearWarnings"><span class="hs-identifier hs-var">clearWarnings</span></a></span><span> </span><span class="hs-comment">-- don't want them printed...</span><span>
</span><span id="line-1198"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681072298"><span class="annot"><span class="annottext">pkgs' :: Set UnitId
</span><a href="#local-6989586621681072298"><span class="hs-identifier hs-var hs-var">pkgs'</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681072297"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681072297"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe UnitId
</span><a href="#local-6989586621681072302"><span class="hs-identifier hs-var">self</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; Set UnitId -&gt; Set UnitId
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><a href="../../containers/src/Data.Set.Internal.html#insert"><span class="hs-identifier hs-var">S.insert</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681072297"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621681072301"><span class="hs-identifier hs-var">pkgs</span></a></span><span>
</span><span id="line-1199"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621681072301"><span class="hs-identifier hs-var">pkgs</span></a></span><span>
</span><span id="line-1200"></span><span>    </span><span class="annot"><span class="annottext">(IsSafeImport, Set UnitId) -&gt; Hsc (IsSafeImport, Set UnitId)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsSafeImport
</span><a href="#local-6989586621681072300"><span class="hs-identifier hs-var">good</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621681072298"><span class="hs-identifier hs-var">pkgs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1201"></span><span>
</span><span id="line-1202"></span><span class="hs-comment">-- | Is a module trusted? If not, throw or log errors depending on the type.</span><span>
</span><span id="line-1203"></span><span class="hs-comment">-- Return (regardless of trusted or not) if the trust type requires the modules</span><span>
</span><span id="line-1204"></span><span class="hs-comment">-- own package be trusted and a list of other packages required to be trusted</span><span>
</span><span id="line-1205"></span><span class="hs-comment">-- (these later ones haven't been checked) but the own package trust has been.</span><span>
</span><span id="line-1206"></span><span class="annot"><a href="GHC.Driver.Main.html#hscCheckSafe%27"><span class="hs-identifier hs-type">hscCheckSafe'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span>
</span><span id="line-1207"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../containers/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1208"></span><span id="hscCheckSafe%27"><span class="annot"><span class="annottext">hscCheckSafe' :: Module -&gt; SrcSpan -&gt; Hsc (Maybe UnitId, Set UnitId)
</span><a href="GHC.Driver.Main.html#hscCheckSafe%27"><span class="hs-identifier hs-var hs-var">hscCheckSafe'</span></a></span></span><span> </span><span id="local-6989586621681072295"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681072295"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621681072294"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681072294"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1209"></span><span>    </span><span id="local-6989586621681072293"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072293"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-1210"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681072292"><span class="annot"><span class="annottext">IsSafeImport
</span><a href="#local-6989586621681072292"><span class="hs-identifier hs-var">tw</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681072291"><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621681072291"><span class="hs-identifier hs-var">pkgs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Module -&gt; SrcSpan -&gt; Hsc (IsSafeImport, Set UnitId)
</span><a href="#local-6989586621681072290"><span class="hs-identifier hs-var">isModSafe</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681072295"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681072294"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-1211"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><a href="#local-6989586621681072292"><span class="hs-identifier hs-var">tw</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1212"></span><span>        </span><span class="annot"><span class="annottext">IsSafeImport
</span><span class="hs-identifier hs-var">False</span></span><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Maybe UnitId, Set UnitId) -&gt; Hsc (Maybe UnitId, Set UnitId)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe UnitId
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621681072291"><span class="hs-identifier hs-var">pkgs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1213"></span><span>        </span><span class="annot"><span class="annottext">IsSafeImport
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Module -&gt; IsSafeImport
</span><a href="GHC.Driver.Session.html#isHomeModule"><span class="hs-identifier hs-var">isHomeModule</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072293"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681072295"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Maybe UnitId, Set UnitId) -&gt; Hsc (Maybe UnitId, Set UnitId)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe UnitId
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621681072291"><span class="hs-identifier hs-var">pkgs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1214"></span><span>             </span><span class="hs-comment">-- TODO: do we also have to check the trust of the instantiation?</span><span>
</span><span id="line-1215"></span><span>             </span><span class="hs-comment">-- Not necessary if that is reflected in dependencies</span><span>
</span><span id="line-1216"></span><span>             </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(Maybe UnitId, Set UnitId) -&gt; Hsc (Maybe UnitId, Set UnitId)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitId -&gt; Maybe UnitId
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(UnitId -&gt; Maybe UnitId) -&gt; UnitId -&gt; Maybe UnitId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId -&gt; UnitId
</span><a href="GHC.Unit.Types.html#toUnitId"><span class="hs-identifier hs-var">toUnitId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; GenUnit UnitId
forall unit. GenModule unit -&gt; unit
</span><a href="GHC.Unit.Types.html#moduleUnit"><span class="hs-identifier hs-var hs-var">moduleUnit</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681072295"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621681072291"><span class="hs-identifier hs-var">pkgs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1217"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1218"></span><span>    </span><span class="annot"><a href="#local-6989586621681072290"><span class="hs-identifier hs-type">isModSafe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../containers/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1219"></span><span>    </span><span id="local-6989586621681072290"><span class="annot"><span class="annottext">isModSafe :: Module -&gt; SrcSpan -&gt; Hsc (IsSafeImport, Set UnitId)
</span><a href="#local-6989586621681072290"><span class="hs-identifier hs-var hs-var">isModSafe</span></a></span></span><span> </span><span id="local-6989586621681072287"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681072287"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621681072286"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681072286"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1220"></span><span>        </span><span id="local-6989586621681072285"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072285"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-1221"></span><span>        </span><span id="local-6989586621681072284"><span class="annot"><span class="annottext">Maybe ModIface
</span><a href="#local-6989586621681072284"><span class="hs-identifier hs-var">iface</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Module -&gt; Hsc (Maybe ModIface)
</span><a href="#local-6989586621681072283"><span class="hs-identifier hs-var">lookup'</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681072287"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-1222"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe ModIface
</span><a href="#local-6989586621681072284"><span class="hs-identifier hs-var">iface</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1223"></span><span>            </span><span class="hs-comment">-- can't load iface to check trust!</span><span>
</span><span id="line-1224"></span><span>            </span><span class="annot"><span class="annottext">Maybe ModIface
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrMsg -&gt; Hsc (IsSafeImport, Set UnitId)
forall (io :: * -&gt; *) a. MonadIO io =&gt; ErrMsg -&gt; io a
</span><a href="GHC.Driver.Types.html#throwOneError"><span class="hs-identifier hs-var">throwOneError</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrMsg -&gt; Hsc (IsSafeImport, Set UnitId))
-&gt; ErrMsg -&gt; Hsc (IsSafeImport, Set UnitId)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; SrcSpan -&gt; SDoc -&gt; ErrMsg
</span><a href="GHC.Utils.Error.html#mkPlainErrMsg"><span class="hs-identifier hs-var">mkPlainErrMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072285"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681072286"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-1225"></span><span>                         </span><span class="annot"><span class="annottext">(SDoc -&gt; ErrMsg) -&gt; SDoc -&gt; ErrMsg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Can't load the interface file for&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Module -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681072287"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-1226"></span><span>                           </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;, to check that it can be safely imported&quot;</span></span><span>
</span><span id="line-1227"></span><span>
</span><span id="line-1228"></span><span>            </span><span class="hs-comment">-- got iface, check trust</span><span>
</span><span id="line-1229"></span><span>            </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681072282"><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621681072282"><span class="hs-identifier hs-var">iface'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1230"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681072281"><span class="annot"><span class="annottext">trust :: SafeHaskellMode
</span><a href="#local-6989586621681072281"><span class="hs-identifier hs-var hs-var">trust</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IfaceTrustInfo -&gt; SafeHaskellMode
</span><a href="GHC.Driver.Types.html#getSafeMode"><span class="hs-identifier hs-var">getSafeMode</span></a></span><span> </span><span class="annot"><span class="annottext">(IfaceTrustInfo -&gt; SafeHaskellMode)
-&gt; IfaceTrustInfo -&gt; SafeHaskellMode
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface -&gt; IfaceTrustInfo
forall (phase :: ModIfacePhase). ModIface_ phase -&gt; IfaceTrustInfo
</span><a href="GHC.Driver.Types.html#mi_trust"><span class="hs-identifier hs-var hs-var">mi_trust</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621681072282"><span class="hs-identifier hs-var">iface'</span></a></span><span>
</span><span id="line-1231"></span><span>                    </span><span id="local-6989586621681072278"><span class="annot"><span class="annottext">trust_own_pkg :: IsSafeImport
</span><a href="#local-6989586621681072278"><span class="hs-identifier hs-var hs-var">trust_own_pkg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModIface -&gt; IsSafeImport
forall (phase :: ModIfacePhase). ModIface_ phase -&gt; IsSafeImport
</span><a href="GHC.Driver.Types.html#mi_trust_pkg"><span class="hs-identifier hs-var hs-var">mi_trust_pkg</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621681072282"><span class="hs-identifier hs-var">iface'</span></a></span><span>
</span><span id="line-1232"></span><span>                    </span><span class="hs-comment">-- check module is trusted</span><span>
</span><span id="line-1233"></span><span>                    </span><span id="local-6989586621681072274"><span class="annot"><span class="annottext">safeM :: IsSafeImport
</span><a href="#local-6989586621681072274"><span class="hs-identifier hs-var hs-var">safeM</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="#local-6989586621681072281"><span class="hs-identifier hs-var">trust</span></a></span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode -&gt; [SafeHaskellMode] -&gt; IsSafeImport
forall (t :: * -&gt; *) a.
(Foldable t, Eq a) =&gt;
a -&gt; t a -&gt; IsSafeImport
</span><a href="../../base/src/Data.Foldable.html#elem"><span class="hs-operator hs-var">`elem`</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="GHC.Driver.Session.html#Sf_Safe"><span class="hs-identifier hs-var">Sf_Safe</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="GHC.Driver.Session.html#Sf_SafeInferred"><span class="hs-identifier hs-var">Sf_SafeInferred</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="GHC.Driver.Session.html#Sf_Trustworthy"><span class="hs-identifier hs-var">Sf_Trustworthy</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1234"></span><span>                    </span><span class="hs-comment">-- check package is trusted</span><span>
</span><span id="line-1235"></span><span>                    </span><span id="local-6989586621681072271"><span class="annot"><span class="annottext">safeP :: IsSafeImport
</span><a href="#local-6989586621681072271"><span class="hs-identifier hs-var hs-var">safeP</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags
-&gt; SafeHaskellMode -&gt; IsSafeImport -&gt; Module -&gt; IsSafeImport
</span><a href="#local-6989586621681072270"><span class="hs-identifier hs-var">packageTrusted</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072285"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="#local-6989586621681072281"><span class="hs-identifier hs-var">trust</span></a></span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><a href="#local-6989586621681072278"><span class="hs-identifier hs-var">trust_own_pkg</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681072287"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-1236"></span><span>                    </span><span class="hs-comment">-- pkg trust reqs</span><span>
</span><span id="line-1237"></span><span>                    </span><span id="local-6989586621681072268"><span class="annot"><span class="annottext">pkgRs :: Set UnitId
</span><a href="#local-6989586621681072268"><span class="hs-identifier hs-var hs-var">pkgRs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[UnitId] -&gt; Set UnitId
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="../../containers/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">S.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([UnitId] -&gt; Set UnitId)
-&gt; ([(UnitId, IsSafeImport)] -&gt; [UnitId])
-&gt; [(UnitId, IsSafeImport)]
-&gt; Set UnitId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">((UnitId, IsSafeImport) -&gt; UnitId)
-&gt; [(UnitId, IsSafeImport)] -&gt; [UnitId]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">(UnitId, IsSafeImport) -&gt; UnitId
forall a b. (a, b) -&gt; a
</span><a href="../../base/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">([(UnitId, IsSafeImport)] -&gt; Set UnitId)
-&gt; [(UnitId, IsSafeImport)] -&gt; Set UnitId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">((UnitId, IsSafeImport) -&gt; IsSafeImport)
-&gt; [(UnitId, IsSafeImport)] -&gt; [(UnitId, IsSafeImport)]
forall a. (a -&gt; IsSafeImport) -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="annot"><span class="annottext">(UnitId, IsSafeImport) -&gt; IsSafeImport
forall a b. (a, b) -&gt; b
</span><a href="../../base/src/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">([(UnitId, IsSafeImport)] -&gt; [(UnitId, IsSafeImport)])
-&gt; [(UnitId, IsSafeImport)] -&gt; [(UnitId, IsSafeImport)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Dependencies -&gt; [(UnitId, IsSafeImport)]
</span><a href="GHC.Driver.Types.html#dep_pkgs"><span class="hs-identifier hs-var hs-var">dep_pkgs</span></a></span><span> </span><span class="annot"><span class="annottext">(Dependencies -&gt; [(UnitId, IsSafeImport)])
-&gt; Dependencies -&gt; [(UnitId, IsSafeImport)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface -&gt; Dependencies
forall (phase :: ModIfacePhase). ModIface_ phase -&gt; Dependencies
</span><a href="GHC.Driver.Types.html#mi_deps"><span class="hs-identifier hs-var hs-var">mi_deps</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621681072282"><span class="hs-identifier hs-var">iface'</span></a></span><span>
</span><span id="line-1238"></span><span>                    </span><span class="hs-comment">-- warn if Safe module imports Safe-Inferred module.</span><span>
</span><span id="line-1239"></span><span>                    </span><span id="local-6989586621681072264"><span class="annot"><span class="annottext">warns :: WarningMessages
</span><a href="#local-6989586621681072264"><span class="hs-identifier hs-var hs-var">warns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">WarningFlag -&gt; DynFlags -&gt; IsSafeImport
</span><a href="GHC.Driver.Session.html#wopt"><span class="hs-identifier hs-var">wopt</span></a></span><span> </span><span class="annot"><span class="annottext">WarningFlag
</span><a href="GHC.Driver.Flags.html#Opt_WarnInferredSafeImports"><span class="hs-identifier hs-var">Opt_WarnInferredSafeImports</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072285"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1240"></span><span>                                </span><span class="annot"><span class="annottext">IsSafeImport -&gt; IsSafeImport -&gt; IsSafeImport
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; IsSafeImport
</span><a href="GHC.Driver.Session.html#safeLanguageOn"><span class="hs-identifier hs-var">safeLanguageOn</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072285"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1241"></span><span>                                </span><span class="annot"><span class="annottext">IsSafeImport -&gt; IsSafeImport -&gt; IsSafeImport
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="#local-6989586621681072281"><span class="hs-identifier hs-var">trust</span></a></span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode -&gt; SafeHaskellMode -&gt; IsSafeImport
forall a. Eq a =&gt; a -&gt; a -&gt; IsSafeImport
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="GHC.Driver.Session.html#Sf_SafeInferred"><span class="hs-identifier hs-var">Sf_SafeInferred</span></a></span><span>
</span><span id="line-1242"></span><span>                                </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681072262"><span class="hs-identifier hs-var">inferredImportWarn</span></a></span><span>
</span><span id="line-1243"></span><span>                                </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">WarningMessages
forall a. Bag a
</span><a href="GHC.Data.Bag.html#emptyBag"><span class="hs-identifier hs-var">emptyBag</span></a></span><span>
</span><span id="line-1244"></span><span>                    </span><span class="hs-comment">-- General errors we throw but Safe errors we log</span><span>
</span><span id="line-1245"></span><span>                    </span><span id="local-6989586621681072261"><span class="annot"><span class="annottext">errs :: WarningMessages
</span><a href="#local-6989586621681072261"><span class="hs-identifier hs-var hs-var">errs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsSafeImport
</span><a href="#local-6989586621681072274"><span class="hs-identifier hs-var">safeM</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><a href="#local-6989586621681072271"><span class="hs-identifier hs-var">safeP</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1246"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsSafeImport
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WarningMessages
forall a. Bag a
</span><a href="GHC.Data.Bag.html#emptyBag"><span class="hs-identifier hs-var">emptyBag</span></a></span><span>
</span><span id="line-1247"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsSafeImport
</span><span class="hs-identifier hs-var">True</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681072260"><span class="hs-identifier hs-var">pkgTrustErr</span></a></span><span>
</span><span id="line-1248"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsSafeImport
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681072259"><span class="hs-identifier hs-var">modTrustErr</span></a></span><span>
</span><span id="line-1249"></span><span>                </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1250"></span><span>                    </span><span class="annot"><span class="annottext">WarningMessages -&gt; Hsc ()
</span><a href="GHC.Driver.Main.html#logWarnings"><span class="hs-identifier hs-var">logWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681072264"><span class="hs-identifier hs-var">warns</span></a></span><span>
</span><span id="line-1251"></span><span>                    </span><span class="annot"><span class="annottext">WarningMessages -&gt; Hsc ()
</span><a href="GHC.Driver.Main.html#logWarnings"><span class="hs-identifier hs-var">logWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681072261"><span class="hs-identifier hs-var">errs</span></a></span><span>
</span><span id="line-1252"></span><span>                    </span><span class="annot"><span class="annottext">(IsSafeImport, Set UnitId) -&gt; Hsc (IsSafeImport, Set UnitId)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="#local-6989586621681072281"><span class="hs-identifier hs-var">trust</span></a></span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode -&gt; SafeHaskellMode -&gt; IsSafeImport
forall a. Eq a =&gt; a -&gt; a -&gt; IsSafeImport
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="GHC.Driver.Session.html#Sf_Trustworthy"><span class="hs-identifier hs-var">Sf_Trustworthy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621681072268"><span class="hs-identifier hs-var">pkgRs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1253"></span><span>
</span><span id="line-1254"></span><span>                </span><span class="hs-keyword">where</span><span>
</span><span id="line-1255"></span><span>                    </span><span id="local-6989586621681072258"><span class="annot"><span class="annottext">state :: UnitState
</span><a href="#local-6989586621681072258"><span class="hs-identifier hs-var hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; UnitState
</span><a href="GHC.Driver.Session.html#unitState"><span class="hs-identifier hs-var hs-var">unitState</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072285"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1256"></span><span>                    </span><span id="local-6989586621681072262"><span class="annot"><span class="annottext">inferredImportWarn :: WarningMessages
</span><a href="#local-6989586621681072262"><span class="hs-identifier hs-var hs-var">inferredImportWarn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ErrMsg -&gt; WarningMessages
forall a. a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#unitBag"><span class="hs-identifier hs-var">unitBag</span></a></span><span>
</span><span id="line-1257"></span><span>                        </span><span class="annot"><span class="annottext">(ErrMsg -&gt; WarningMessages) -&gt; ErrMsg -&gt; WarningMessages
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WarnReason -&gt; ErrMsg -&gt; ErrMsg
</span><a href="GHC.Utils.Error.html#makeIntoWarning"><span class="hs-identifier hs-var">makeIntoWarning</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WarningFlag -&gt; WarnReason
</span><a href="GHC.Driver.Flags.html#Reason"><span class="hs-identifier hs-var">Reason</span></a></span><span> </span><span class="annot"><span class="annottext">WarningFlag
</span><a href="GHC.Driver.Flags.html#Opt_WarnInferredSafeImports"><span class="hs-identifier hs-var">Opt_WarnInferredSafeImports</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1258"></span><span>                        </span><span class="annot"><span class="annottext">(ErrMsg -&gt; ErrMsg) -&gt; ErrMsg -&gt; ErrMsg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; SrcSpan -&gt; PrintUnqualified -&gt; SDoc -&gt; ErrMsg
</span><a href="GHC.Utils.Error.html#mkWarnMsg"><span class="hs-identifier hs-var">mkWarnMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072285"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681072286"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitState -&gt; PrintUnqualified
</span><a href="GHC.Driver.Types.html#pkgQual"><span class="hs-identifier hs-var">pkgQual</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681072258"><span class="hs-identifier hs-var">state</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1259"></span><span>                        </span><span class="annot"><span class="annottext">(SDoc -&gt; ErrMsg) -&gt; SDoc -&gt; ErrMsg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span>
</span><span id="line-1260"></span><span>                            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Importing Safe-Inferred module &quot;</span></span><span>
</span><span id="line-1261"></span><span>                                </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681072287"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1262"></span><span>                                </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; from explicitly Safe module&quot;</span></span><span>
</span><span id="line-1263"></span><span>                            </span><span class="hs-special">]</span><span>
</span><span id="line-1264"></span><span>                    </span><span id="local-6989586621681072260"><span class="annot"><span class="annottext">pkgTrustErr :: WarningMessages
</span><a href="#local-6989586621681072260"><span class="hs-identifier hs-var hs-var">pkgTrustErr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ErrMsg -&gt; WarningMessages
forall a. a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#unitBag"><span class="hs-identifier hs-var">unitBag</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrMsg -&gt; WarningMessages) -&gt; ErrMsg -&gt; WarningMessages
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; SrcSpan -&gt; PrintUnqualified -&gt; SDoc -&gt; ErrMsg
</span><a href="GHC.Utils.Error.html#mkErrMsg"><span class="hs-identifier hs-var">mkErrMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072285"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681072286"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitState -&gt; PrintUnqualified
</span><a href="GHC.Driver.Types.html#pkgQual"><span class="hs-identifier hs-var">pkgQual</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681072258"><span class="hs-identifier hs-var">state</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; ErrMsg) -&gt; SDoc -&gt; ErrMsg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1265"></span><span>                        </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681072287"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1266"></span><span>                                </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;: Can't be safely imported!&quot;</span></span><span>
</span><span id="line-1267"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;The package (&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; GenUnit UnitId
forall unit. GenModule unit -&gt; unit
</span><a href="GHC.Unit.Types.html#moduleUnit"><span class="hs-identifier hs-var hs-var">moduleUnit</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681072287"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1268"></span><span>                                </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;) the module resides in isn't trusted.&quot;</span></span><span>
</span><span id="line-1269"></span><span>                            </span><span class="hs-special">]</span><span>
</span><span id="line-1270"></span><span>                    </span><span id="local-6989586621681072259"><span class="annot"><span class="annottext">modTrustErr :: WarningMessages
</span><a href="#local-6989586621681072259"><span class="hs-identifier hs-var hs-var">modTrustErr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ErrMsg -&gt; WarningMessages
forall a. a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#unitBag"><span class="hs-identifier hs-var">unitBag</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrMsg -&gt; WarningMessages) -&gt; ErrMsg -&gt; WarningMessages
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; SrcSpan -&gt; PrintUnqualified -&gt; SDoc -&gt; ErrMsg
</span><a href="GHC.Utils.Error.html#mkErrMsg"><span class="hs-identifier hs-var">mkErrMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072285"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681072286"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitState -&gt; PrintUnqualified
</span><a href="GHC.Driver.Types.html#pkgQual"><span class="hs-identifier hs-var">pkgQual</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681072258"><span class="hs-identifier hs-var">state</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; ErrMsg) -&gt; SDoc -&gt; ErrMsg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1271"></span><span>                        </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681072287"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1272"></span><span>                                </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;: Can't be safely imported!&quot;</span></span><span>
</span><span id="line-1273"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;The module itself isn't safe.&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1274"></span><span>
</span><span id="line-1275"></span><span>    </span><span class="hs-comment">-- | Check the package a module resides in is trusted. Safe compiled</span><span>
</span><span id="line-1276"></span><span>    </span><span class="hs-comment">-- modules are trusted without requiring that their package is trusted. For</span><span>
</span><span id="line-1277"></span><span>    </span><span class="hs-comment">-- trustworthy modules, modules in the home package are trusted but</span><span>
</span><span id="line-1278"></span><span>    </span><span class="hs-comment">-- otherwise we check the package trust flag.</span><span>
</span><span id="line-1279"></span><span>    </span><span class="annot"><a href="#local-6989586621681072270"><span class="hs-identifier hs-type">packageTrusted</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#SafeHaskellMode"><span class="hs-identifier hs-type">SafeHaskellMode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1280"></span><span>    </span><span id="local-6989586621681072270"><span class="annot"><span class="annottext">packageTrusted :: DynFlags
-&gt; SafeHaskellMode -&gt; IsSafeImport -&gt; Module -&gt; IsSafeImport
</span><a href="#local-6989586621681072270"><span class="hs-identifier hs-var hs-var">packageTrusted</span></a></span></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="GHC.Driver.Session.html#Sf_None"><span class="hs-identifier hs-var">Sf_None</span></a></span><span>      </span><span class="annot"><span class="annottext">IsSafeImport
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Module
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-comment">-- shouldn't hit these cases</span><span>
</span><span id="line-1281"></span><span>    </span><span class="annot"><a href="#local-6989586621681072270"><span class="hs-identifier hs-var">packageTrusted</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="GHC.Driver.Session.html#Sf_Ignore"><span class="hs-identifier hs-var">Sf_Ignore</span></a></span><span>    </span><span class="annot"><span class="annottext">IsSafeImport
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Module
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-comment">-- shouldn't hit these cases</span><span>
</span><span id="line-1282"></span><span>    </span><span class="annot"><a href="#local-6989586621681072270"><span class="hs-identifier hs-var">packageTrusted</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="GHC.Driver.Session.html#Sf_Unsafe"><span class="hs-identifier hs-var">Sf_Unsafe</span></a></span><span>    </span><span class="annot"><span class="annottext">IsSafeImport
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Module
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-comment">-- prefer for completeness.</span><span>
</span><span id="line-1283"></span><span>    </span><span class="annot"><a href="#local-6989586621681072270"><span class="hs-identifier hs-var">packageTrusted</span></a></span><span> </span><span id="local-6989586621681072245"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072245"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Module
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-1284"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">IsSafeImport -&gt; IsSafeImport
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; IsSafeImport
</span><a href="GHC.Driver.Session.html#packageTrustOn"><span class="hs-identifier hs-var">packageTrustOn</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072245"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1285"></span><span>    </span><span class="annot"><a href="#local-6989586621681072270"><span class="hs-identifier hs-var">packageTrusted</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="GHC.Driver.Session.html#Sf_Safe"><span class="hs-identifier hs-var">Sf_Safe</span></a></span><span>  </span><span class="annot"><span class="annottext">IsSafeImport
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">Module
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1286"></span><span>    </span><span class="annot"><a href="#local-6989586621681072270"><span class="hs-identifier hs-var">packageTrusted</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="GHC.Driver.Session.html#Sf_SafeInferred"><span class="hs-identifier hs-var">Sf_SafeInferred</span></a></span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">Module
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1287"></span><span>    </span><span class="annot"><a href="#local-6989586621681072270"><span class="hs-identifier hs-var">packageTrusted</span></a></span><span> </span><span id="local-6989586621681072244"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072244"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681072243"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681072243"><span class="hs-identifier hs-var">m</span></a></span></span><span>
</span><span id="line-1288"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Module -&gt; IsSafeImport
</span><a href="GHC.Driver.Session.html#isHomeModule"><span class="hs-identifier hs-var">isHomeModule</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072244"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681072243"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1289"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenericUnitInfo
  (Indefinite UnitId) PackageId PackageName UnitId ModuleName Module
-&gt; IsSafeImport
forall compid srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo compid srcpkgid srcpkgname uid modulename mod
-&gt; IsSafeImport
</span><a href="../../ghc-boot/src/GHC.Unit.Database.html#unitIsTrusted"><span class="hs-identifier hs-var hs-var">unitIsTrusted</span></a></span><span> </span><span class="annot"><span class="annottext">(GenericUnitInfo
   (Indefinite UnitId) PackageId PackageName UnitId ModuleName Module
 -&gt; IsSafeImport)
-&gt; GenericUnitInfo
     (Indefinite UnitId) PackageId PackageName UnitId ModuleName Module
-&gt; IsSafeImport
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt;
UnitState
-&gt; GenUnit UnitId
-&gt; GenericUnitInfo
     (Indefinite UnitId) PackageId PackageName UnitId ModuleName Module
UnitState
-&gt; GenUnit UnitId
-&gt; GenericUnitInfo
     (Indefinite UnitId) PackageId PackageName UnitId ModuleName Module
</span><a href="GHC.Unit.State.html#unsafeLookupUnit"><span class="hs-identifier hs-var">unsafeLookupUnit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; UnitState
</span><a href="GHC.Driver.Session.html#unitState"><span class="hs-identifier hs-var hs-var">unitState</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072244"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; GenUnit UnitId
forall unit. GenModule unit -&gt; unit
</span><a href="GHC.Unit.Types.html#moduleUnit"><span class="hs-identifier hs-var hs-var">moduleUnit</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681072243"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1290"></span><span>
</span><span id="line-1291"></span><span>    </span><span class="annot"><a href="#local-6989586621681072283"><span class="hs-identifier hs-type">lookup'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1292"></span><span>    </span><span id="local-6989586621681072283"><span class="annot"><span class="annottext">lookup' :: Module -&gt; Hsc (Maybe ModIface)
</span><a href="#local-6989586621681072283"><span class="hs-identifier hs-var hs-var">lookup'</span></a></span></span><span> </span><span id="local-6989586621681072240"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681072240"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1293"></span><span>        </span><span id="local-6989586621681072239"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072239"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc HscEnv
</span><a href="GHC.Driver.Main.html#getHscEnv"><span class="hs-identifier hs-var">getHscEnv</span></a></span><span>
</span><span id="line-1294"></span><span>        </span><span id="local-6989586621681072238"><span class="annot"><span class="annottext">ExternalPackageState
</span><a href="#local-6989586621681072238"><span class="hs-identifier hs-var">hsc_eps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ExternalPackageState -&gt; Hsc ExternalPackageState
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ExternalPackageState -&gt; Hsc ExternalPackageState)
-&gt; IO ExternalPackageState -&gt; Hsc ExternalPackageState
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; IO ExternalPackageState
</span><a href="GHC.Driver.Types.html#hscEPS"><span class="hs-identifier hs-var">hscEPS</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072239"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-1295"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681072236"><span class="annot"><span class="annottext">pkgIfaceT :: PackageIfaceTable
</span><a href="#local-6989586621681072236"><span class="hs-identifier hs-var hs-var">pkgIfaceT</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ExternalPackageState -&gt; PackageIfaceTable
</span><a href="GHC.Driver.Types.html#eps_PIT"><span class="hs-identifier hs-var hs-var">eps_PIT</span></a></span><span> </span><span class="annot"><span class="annottext">ExternalPackageState
</span><a href="#local-6989586621681072238"><span class="hs-identifier hs-var">hsc_eps</span></a></span><span>
</span><span id="line-1296"></span><span>            </span><span id="local-6989586621681072234"><span class="annot"><span class="annottext">homePkgT :: HomePackageTable
</span><a href="#local-6989586621681072234"><span class="hs-identifier hs-var hs-var">homePkgT</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; HomePackageTable
</span><a href="GHC.Driver.Types.html#hsc_HPT"><span class="hs-identifier hs-var hs-var">hsc_HPT</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072239"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-1297"></span><span>            </span><span id="local-6989586621681072233"><span class="annot"><span class="annottext">iface :: Maybe ModIface
</span><a href="#local-6989586621681072233"><span class="hs-identifier hs-var hs-var">iface</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HomePackageTable -&gt; PackageIfaceTable -&gt; Module -&gt; Maybe ModIface
</span><a href="GHC.Driver.Types.html#lookupIfaceByModule"><span class="hs-identifier hs-var">lookupIfaceByModule</span></a></span><span> </span><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621681072234"><span class="hs-identifier hs-var">homePkgT</span></a></span><span> </span><span class="annot"><span class="annottext">PackageIfaceTable
</span><a href="#local-6989586621681072236"><span class="hs-identifier hs-var">pkgIfaceT</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681072240"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-1298"></span><span>        </span><span class="hs-comment">-- the 'lookupIfaceByModule' method will always fail when calling from GHCi</span><span>
</span><span id="line-1299"></span><span>        </span><span class="hs-comment">-- as the compiler hasn't filled in the various module tables</span><span>
</span><span id="line-1300"></span><span>        </span><span class="hs-comment">-- so we need to call 'getModuleInterface' to load from disk</span><span>
</span><span id="line-1301"></span><span>        </span><span id="local-6989586621681072231"><span class="annot"><span class="annottext">Maybe ModIface
</span><a href="#local-6989586621681072231"><span class="hs-identifier hs-var">iface'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe ModIface
</span><a href="#local-6989586621681072233"><span class="hs-identifier hs-var">iface</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1302"></span><span>            </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe ModIface -&gt; Hsc (Maybe ModIface)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ModIface
</span><a href="#local-6989586621681072233"><span class="hs-identifier hs-var">iface</span></a></span><span>
</span><span id="line-1303"></span><span>            </span><span class="annot"><span class="annottext">Maybe ModIface
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">((WarningMessages, WarningMessages), Maybe ModIface)
-&gt; Maybe ModIface
forall a b. (a, b) -&gt; b
</span><a href="../../base/src/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">(((WarningMessages, WarningMessages), Maybe ModIface)
 -&gt; Maybe ModIface)
-&gt; Hsc ((WarningMessages, WarningMessages), Maybe ModIface)
-&gt; Hsc (Maybe ModIface)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/GHC.Base.html#fmap"><span class="hs-operator hs-var">`fmap`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO ((WarningMessages, WarningMessages), Maybe ModIface)
-&gt; Hsc ((WarningMessages, WarningMessages), Maybe ModIface)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ((WarningMessages, WarningMessages), Maybe ModIface)
 -&gt; Hsc ((WarningMessages, WarningMessages), Maybe ModIface))
-&gt; IO ((WarningMessages, WarningMessages), Maybe ModIface)
-&gt; Hsc ((WarningMessages, WarningMessages), Maybe ModIface)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; Module
-&gt; IO ((WarningMessages, WarningMessages), Maybe ModIface)
</span><a href="GHC.Tc.Module.html#getModuleInterface"><span class="hs-identifier hs-var">getModuleInterface</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072239"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681072240"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1304"></span><span>        </span><span class="annot"><span class="annottext">Maybe ModIface -&gt; Hsc (Maybe ModIface)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ModIface
</span><a href="#local-6989586621681072231"><span class="hs-identifier hs-var">iface'</span></a></span><span>
</span><span id="line-1305"></span><span>
</span><span id="line-1306"></span><span>
</span><span id="line-1307"></span><span class="hs-comment">-- | Check the list of packages are trusted.</span><span>
</span><span id="line-1308"></span><span class="annot"><a href="GHC.Driver.Main.html#checkPkgTrust"><span class="hs-identifier hs-type">checkPkgTrust</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../containers/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#UnitId"><span class="hs-identifier hs-type">UnitId</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1309"></span><span id="checkPkgTrust"><span class="annot"><span class="annottext">checkPkgTrust :: Set UnitId -&gt; Hsc ()
</span><a href="GHC.Driver.Main.html#checkPkgTrust"><span class="hs-identifier hs-var hs-var">checkPkgTrust</span></a></span></span><span> </span><span id="local-6989586621681072230"><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621681072230"><span class="hs-identifier hs-var">pkgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1310"></span><span>    </span><span id="local-6989586621681072229"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072229"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-1311"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681072228"><span class="annot"><span class="annottext">errors :: [ErrMsg]
</span><a href="#local-6989586621681072228"><span class="hs-identifier hs-var hs-var">errors</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(UnitId -&gt; [ErrMsg] -&gt; [ErrMsg])
-&gt; [ErrMsg] -&gt; Set UnitId -&gt; [ErrMsg]
forall a b. (a -&gt; b -&gt; b) -&gt; b -&gt; Set a -&gt; b
</span><a href="../../containers/src/Data.Set.Internal.html#foldr"><span class="hs-identifier hs-var">S.foldr</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; [ErrMsg] -&gt; [ErrMsg]
</span><a href="#local-6989586621681072226"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Set UnitId
</span><a href="#local-6989586621681072230"><span class="hs-identifier hs-var">pkgs</span></a></span><span>
</span><span id="line-1312"></span><span>        </span><span id="local-6989586621681072225"><span class="annot"><span class="annottext">state :: UnitState
</span><a href="#local-6989586621681072225"><span class="hs-identifier hs-var hs-var">state</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; UnitState
</span><a href="GHC.Driver.Session.html#unitState"><span class="hs-identifier hs-var hs-var">unitState</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072229"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1313"></span><span>        </span><span id="local-6989586621681072226"><span class="annot"><span class="annottext">go :: UnitId -&gt; [ErrMsg] -&gt; [ErrMsg]
</span><a href="#local-6989586621681072226"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621681072221"><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681072221"><span class="hs-identifier hs-var">pkg</span></a></span></span><span> </span><span id="local-6989586621681072220"><span class="annot"><span class="annottext">[ErrMsg]
</span><a href="#local-6989586621681072220"><span class="hs-identifier hs-var">acc</span></a></span></span><span>
</span><span id="line-1314"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">GenericUnitInfo
  (Indefinite UnitId) PackageId PackageName UnitId ModuleName Module
-&gt; IsSafeImport
forall compid srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo compid srcpkgid srcpkgname uid modulename mod
-&gt; IsSafeImport
</span><a href="../../ghc-boot/src/GHC.Unit.Database.html#unitIsTrusted"><span class="hs-identifier hs-var hs-var">unitIsTrusted</span></a></span><span> </span><span class="annot"><span class="annottext">(GenericUnitInfo
   (Indefinite UnitId) PackageId PackageName UnitId ModuleName Module
 -&gt; IsSafeImport)
-&gt; GenericUnitInfo
     (Indefinite UnitId) PackageId PackageName UnitId ModuleName Module
-&gt; IsSafeImport
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt;
UnitState
-&gt; UnitId
-&gt; GenericUnitInfo
     (Indefinite UnitId) PackageId PackageName UnitId ModuleName Module
UnitState
-&gt; UnitId
-&gt; GenericUnitInfo
     (Indefinite UnitId) PackageId PackageName UnitId ModuleName Module
</span><a href="GHC.Unit.State.html#unsafeLookupUnitId"><span class="hs-identifier hs-var">unsafeLookupUnitId</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681072225"><span class="hs-identifier hs-var">state</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681072221"><span class="hs-identifier hs-var">pkg</span></a></span><span>
</span><span id="line-1315"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ErrMsg]
</span><a href="#local-6989586621681072220"><span class="hs-identifier hs-var">acc</span></a></span><span>
</span><span id="line-1316"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1317"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ErrMsg -&gt; [ErrMsg] -&gt; [ErrMsg]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[ErrMsg]
</span><a href="#local-6989586621681072220"><span class="hs-identifier hs-var">acc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ErrMsg -&gt; [ErrMsg]) -&gt; ErrMsg -&gt; [ErrMsg]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; SrcSpan -&gt; PrintUnqualified -&gt; SDoc -&gt; ErrMsg
</span><a href="GHC.Utils.Error.html#mkErrMsg"><span class="hs-identifier hs-var">mkErrMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072229"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="GHC.Types.SrcLoc.html#noSrcSpan"><span class="hs-identifier hs-var">noSrcSpan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitState -&gt; PrintUnqualified
</span><a href="GHC.Driver.Types.html#pkgQual"><span class="hs-identifier hs-var">pkgQual</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681072225"><span class="hs-identifier hs-var">state</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1318"></span><span>                     </span><span class="annot"><span class="annottext">(SDoc -&gt; ErrMsg) -&gt; SDoc -&gt; ErrMsg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;The package (&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId
</span><a href="#local-6989586621681072221"><span class="hs-identifier hs-var">pkg</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;) is required&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-1319"></span><span>                       </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; to be trusted but it isn't!&quot;</span></span><span>
</span><span id="line-1320"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[ErrMsg]
</span><a href="#local-6989586621681072228"><span class="hs-identifier hs-var">errors</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1321"></span><span>        </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; Hsc ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1322"></span><span>        </span><span class="annot"><span class="annottext">[ErrMsg]
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO () -&gt; Hsc ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; Hsc ()) -&gt; ([ErrMsg] -&gt; IO ()) -&gt; [ErrMsg] -&gt; Hsc ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">SourceError -&gt; IO ()
forall e a. Exception e =&gt; e -&gt; IO a
</span><a href="../../base/src/GHC.IO.html#throwIO"><span class="hs-identifier hs-var">throwIO</span></a></span><span> </span><span class="annot"><span class="annottext">(SourceError -&gt; IO ())
-&gt; ([ErrMsg] -&gt; SourceError) -&gt; [ErrMsg] -&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">WarningMessages -&gt; SourceError
</span><a href="GHC.Driver.Types.html#mkSrcErr"><span class="hs-identifier hs-var">mkSrcErr</span></a></span><span> </span><span class="annot"><span class="annottext">(WarningMessages -&gt; SourceError)
-&gt; ([ErrMsg] -&gt; WarningMessages) -&gt; [ErrMsg] -&gt; SourceError
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[ErrMsg] -&gt; WarningMessages
forall a. [a] -&gt; Bag a
</span><a href="GHC.Data.Bag.html#listToBag"><span class="hs-identifier hs-var">listToBag</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ErrMsg]
</span><a href="#local-6989586621681072228"><span class="hs-identifier hs-var">errors</span></a></span><span>
</span><span id="line-1323"></span><span>
</span><span id="line-1324"></span><span class="hs-comment">-- | Set module to unsafe and (potentially) wipe trust information.</span><span>
</span><span id="line-1325"></span><span class="hs-comment">--</span><span>
</span><span id="line-1326"></span><span class="hs-comment">-- Make sure to call this method to set a module to inferred unsafe, it should</span><span>
</span><span id="line-1327"></span><span class="hs-comment">-- be a central and single failure method. We only wipe the trust information</span><span>
</span><span id="line-1328"></span><span class="hs-comment">-- when we aren't in a specific Safe Haskell mode.</span><span>
</span><span id="line-1329"></span><span class="hs-comment">--</span><span>
</span><span id="line-1330"></span><span class="hs-comment">-- While we only use this for recording that a module was inferred unsafe, we</span><span>
</span><span id="line-1331"></span><span class="hs-comment">-- may call it on modules using Trustworthy or Unsafe flags so as to allow</span><span>
</span><span id="line-1332"></span><span class="hs-comment">-- warning flags for safety to function correctly. See Note [Safe Haskell</span><span>
</span><span id="line-1333"></span><span class="hs-comment">-- Inference].</span><span>
</span><span id="line-1334"></span><span class="annot"><a href="GHC.Driver.Main.html#markUnsafeInfer"><span class="hs-identifier hs-type">markUnsafeInfer</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#WarningMessages"><span class="hs-identifier hs-type">WarningMessages</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span>
</span><span id="line-1335"></span><span id="markUnsafeInfer"><span class="annot"><span class="annottext">markUnsafeInfer :: TcGblEnv -&gt; WarningMessages -&gt; Hsc TcGblEnv
</span><a href="GHC.Driver.Main.html#markUnsafeInfer"><span class="hs-identifier hs-var hs-var">markUnsafeInfer</span></a></span></span><span> </span><span id="local-6989586621681072217"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072217"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span> </span><span id="local-6989586621681072216"><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681072216"><span class="hs-identifier hs-var">whyUnsafe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1336"></span><span>    </span><span id="local-6989586621681072215"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072215"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-1337"></span><span>
</span><span id="line-1338"></span><span>    </span><span class="annot"><span class="annottext">IsSafeImport -&gt; Hsc () -&gt; Hsc ()
forall (f :: * -&gt; *). Applicative f =&gt; IsSafeImport -&gt; f () -&gt; f ()
</span><a href="../../base/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WarningFlag -&gt; DynFlags -&gt; IsSafeImport
</span><a href="GHC.Driver.Session.html#wopt"><span class="hs-identifier hs-var">wopt</span></a></span><span> </span><span class="annot"><span class="annottext">WarningFlag
</span><a href="GHC.Driver.Flags.html#Opt_WarnUnsafe"><span class="hs-identifier hs-var">Opt_WarnUnsafe</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072215"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1339"></span><span>         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WarningMessages -&gt; Hsc ()
</span><a href="GHC.Driver.Main.html#logWarnings"><span class="hs-identifier hs-var">logWarnings</span></a></span><span> </span><span class="annot"><span class="annottext">(WarningMessages -&gt; Hsc ()) -&gt; WarningMessages -&gt; Hsc ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ErrMsg -&gt; WarningMessages
forall a. a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#unitBag"><span class="hs-identifier hs-var">unitBag</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrMsg -&gt; WarningMessages) -&gt; ErrMsg -&gt; WarningMessages
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WarnReason -&gt; ErrMsg -&gt; ErrMsg
</span><a href="GHC.Utils.Error.html#makeIntoWarning"><span class="hs-identifier hs-var">makeIntoWarning</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WarningFlag -&gt; WarnReason
</span><a href="GHC.Driver.Flags.html#Reason"><span class="hs-identifier hs-var">Reason</span></a></span><span> </span><span class="annot"><span class="annottext">WarningFlag
</span><a href="GHC.Driver.Flags.html#Opt_WarnUnsafe"><span class="hs-identifier hs-var">Opt_WarnUnsafe</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ErrMsg -&gt; ErrMsg) -&gt; ErrMsg -&gt; ErrMsg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1340"></span><span>             </span><span class="annot"><span class="annottext">DynFlags -&gt; SrcSpan -&gt; SDoc -&gt; ErrMsg
</span><a href="GHC.Utils.Error.html#mkPlainWarnMsg"><span class="hs-identifier hs-var">mkPlainWarnMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072215"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; SrcSpan
</span><a href="GHC.Driver.Session.html#warnUnsafeOnLoc"><span class="hs-identifier hs-var hs-var">warnUnsafeOnLoc</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072215"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; SDoc
</span><a href="#local-6989586621681072212"><span class="hs-identifier hs-var">whyUnsafe'</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072215"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1341"></span><span>
</span><span id="line-1342"></span><span>    </span><span class="annot"><span class="annottext">IO () -&gt; Hsc ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; Hsc ()) -&gt; IO () -&gt; Hsc ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">IORef (IsSafeImport, WarningMessages)
-&gt; (IsSafeImport, WarningMessages) -&gt; IO ()
forall a. IORef a -&gt; a -&gt; IO ()
</span><a href="../../base/src/GHC.IORef.html#writeIORef"><span class="hs-identifier hs-var">writeIORef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; IORef (IsSafeImport, WarningMessages)
</span><a href="GHC.Tc.Types.html#tcg_safeInfer"><span class="hs-identifier hs-var hs-var">tcg_safeInfer</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072217"><span class="hs-identifier hs-var">tcg_env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsSafeImport
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681072216"><span class="hs-identifier hs-var">whyUnsafe</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1343"></span><span>    </span><span class="hs-comment">-- NOTE: Only wipe trust when not in an explicitly safe haskell mode. Other</span><span>
</span><span id="line-1344"></span><span>    </span><span class="hs-comment">-- times inference may be on but we are in Trustworthy mode -- so we want</span><span>
</span><span id="line-1345"></span><span>    </span><span class="hs-comment">-- to record safe-inference failed but not wipe the trust dependencies.</span><span>
</span><span id="line-1346"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">IsSafeImport -&gt; IsSafeImport
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; IsSafeImport
</span><a href="GHC.Driver.Session.html#safeHaskellModeEnabled"><span class="hs-identifier hs-var">safeHaskellModeEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072215"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1347"></span><span>      </span><span class="annot"><span class="annottext">IsSafeImport
</span><span class="hs-identifier hs-var">True</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; Hsc TcGblEnv
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(TcGblEnv -&gt; Hsc TcGblEnv) -&gt; TcGblEnv -&gt; Hsc TcGblEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072217"><span class="hs-identifier hs-var">tcg_env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tcg_imports :: ImportAvails
</span><a href="GHC.Tc.Types.html#tcg_imports"><span class="hs-identifier hs-var">tcg_imports</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ImportAvails
</span><a href="#local-6989586621681072210"><span class="hs-identifier hs-var">wiped_trust</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1348"></span><span>      </span><span class="annot"><span class="annottext">IsSafeImport
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; Hsc TcGblEnv
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072217"><span class="hs-identifier hs-var">tcg_env</span></a></span><span>
</span><span id="line-1349"></span><span>
</span><span id="line-1350"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1351"></span><span>    </span><span id="local-6989586621681072210"><span class="annot"><span class="annottext">wiped_trust :: ImportAvails
</span><a href="#local-6989586621681072210"><span class="hs-identifier hs-var hs-var">wiped_trust</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; ImportAvails
</span><a href="GHC.Tc.Types.html#tcg_imports"><span class="hs-identifier hs-var hs-var">tcg_imports</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072217"><span class="hs-identifier hs-var">tcg_env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">imp_trust_pkgs :: Set UnitId
</span><a href="GHC.Tc.Types.html#imp_trust_pkgs"><span class="hs-identifier hs-var">imp_trust_pkgs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set UnitId
forall a. Set a
</span><a href="../../containers/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">S.empty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1352"></span><span>    </span><span id="local-6989586621681072208"><span class="annot"><span class="annottext">pprMod :: SDoc
</span><a href="#local-6989586621681072208"><span class="hs-identifier hs-var hs-var">pprMod</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">(ModuleName -&gt; SDoc) -&gt; ModuleName -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Module -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">(Module -&gt; ModuleName) -&gt; Module -&gt; ModuleName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; Module
</span><a href="GHC.Tc.Types.html#tcg_mod"><span class="hs-identifier hs-var hs-var">tcg_mod</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072217"><span class="hs-identifier hs-var">tcg_env</span></a></span><span>
</span><span id="line-1353"></span><span>    </span><span id="local-6989586621681072212"><span class="annot"><span class="annottext">whyUnsafe' :: DynFlags -&gt; SDoc
</span><a href="#local-6989586621681072212"><span class="hs-identifier hs-var hs-var">whyUnsafe'</span></a></span></span><span> </span><span id="local-6989586621681072206"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072206"><span class="hs-identifier hs-var">df</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681072208"><span class="hs-identifier hs-var">pprMod</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;has been inferred as unsafe!&quot;</span></span><span>
</span><span id="line-1354"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Reason:&quot;</span></span><span>
</span><span id="line-1355"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc) -&gt; SDoc -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="annot"><span class="annottext">([SDoc] -&gt; SDoc) -&gt; [SDoc] -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [SDoc]
</span><a href="#local-6989586621681072203"><span class="hs-identifier hs-var">badFlags</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072206"><span class="hs-identifier hs-var">df</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%2B%24"><span class="hs-operator hs-var">$+$</span></a></span><span>
</span><span id="line-1356"></span><span>                                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="annot"><span class="annottext">([SDoc] -&gt; SDoc) -&gt; [SDoc] -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WarningMessages -&gt; [SDoc]
</span><a href="GHC.Utils.Error.html#pprErrMsgBagWithLoc"><span class="hs-identifier hs-var">pprErrMsgBagWithLoc</span></a></span><span> </span><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681072216"><span class="hs-identifier hs-var">whyUnsafe</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%2B%24"><span class="hs-operator hs-var">$+$</span></a></span><span>
</span><span id="line-1357"></span><span>                                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="annot"><span class="annottext">([SDoc] -&gt; SDoc) -&gt; [SDoc] -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[ClsInst] -&gt; [SDoc]
forall {t :: * -&gt; *}. Foldable t =&gt; t ClsInst -&gt; [SDoc]
</span><a href="#local-6989586621681072201"><span class="hs-identifier hs-var">badInsts</span></a></span><span> </span><span class="annot"><span class="annottext">([ClsInst] -&gt; [SDoc]) -&gt; [ClsInst] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; [ClsInst]
</span><a href="GHC.Tc.Types.html#tcg_insts"><span class="hs-identifier hs-var hs-var">tcg_insts</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072217"><span class="hs-identifier hs-var">tcg_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1358"></span><span>                         </span><span class="hs-special">]</span><span>
</span><span id="line-1359"></span><span>    </span><span id="local-6989586621681072203"><span class="annot"><span class="annottext">badFlags :: DynFlags -&gt; [SDoc]
</span><a href="#local-6989586621681072203"><span class="hs-identifier hs-var hs-var">badFlags</span></a></span></span><span> </span><span id="local-6989586621681072198"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072198"><span class="hs-identifier hs-var">df</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((String, DynFlags -&gt; SrcSpan, DynFlags -&gt; IsSafeImport,
  DynFlags -&gt; DynFlags)
 -&gt; [SDoc])
-&gt; [(String, DynFlags -&gt; SrcSpan, DynFlags -&gt; IsSafeImport,
     DynFlags -&gt; DynFlags)]
-&gt; [SDoc]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><a href="../../base/src/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags
-&gt; (String, DynFlags -&gt; SrcSpan, DynFlags -&gt; IsSafeImport,
    DynFlags -&gt; DynFlags)
-&gt; [SDoc]
forall {t} {d}.
t -&gt; (String, t -&gt; SrcSpan, t -&gt; IsSafeImport, d) -&gt; [SDoc]
</span><a href="#local-6989586621681072196"><span class="hs-identifier hs-var">badFlag</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072198"><span class="hs-identifier hs-var">df</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(String, DynFlags -&gt; SrcSpan, DynFlags -&gt; IsSafeImport,
  DynFlags -&gt; DynFlags)]
</span><a href="GHC.Driver.Session.html#unsafeFlagsForInfer"><span class="hs-identifier hs-var">unsafeFlagsForInfer</span></a></span><span>
</span><span id="line-1360"></span><span>    </span><span id="local-6989586621681072196"><span class="annot"><span class="annottext">badFlag :: t -&gt; (String, t -&gt; SrcSpan, t -&gt; IsSafeImport, d) -&gt; [SDoc]
</span><a href="#local-6989586621681072196"><span class="hs-identifier hs-var hs-var">badFlag</span></a></span></span><span> </span><span id="local-6989586621681072194"><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621681072194"><span class="hs-identifier hs-var">df</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681072193"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681072193"><span class="hs-identifier hs-var">str</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681072192"><span class="annot"><span class="annottext">t -&gt; SrcSpan
</span><a href="#local-6989586621681072192"><span class="hs-identifier hs-var">loc</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681072191"><span class="annot"><span class="annottext">t -&gt; IsSafeImport
</span><a href="#local-6989586621681072191"><span class="hs-identifier hs-var">on</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">d
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-1361"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">t -&gt; IsSafeImport
</span><a href="#local-6989586621681072191"><span class="hs-identifier hs-var">on</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621681072194"><span class="hs-identifier hs-var">df</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Severity -&gt; SrcSpan -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Error.html#mkLocMessage"><span class="hs-identifier hs-var">mkLocMessage</span></a></span><span> </span><span class="annot"><span class="annottext">Severity
</span><a href="GHC.Utils.Error.html#SevOutput"><span class="hs-identifier hs-var">SevOutput</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t -&gt; SrcSpan
</span><a href="#local-6989586621681072192"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621681072194"><span class="hs-identifier hs-var">df</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc) -&gt; SDoc -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1362"></span><span>                            </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681072193"><span class="hs-identifier hs-var">str</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;is not allowed in Safe Haskell&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-1363"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1364"></span><span>    </span><span id="local-6989586621681072201"><span class="annot"><span class="annottext">badInsts :: t ClsInst -&gt; [SDoc]
</span><a href="#local-6989586621681072201"><span class="hs-identifier hs-var hs-var">badInsts</span></a></span></span><span> </span><span id="local-6989586621681072186"><span class="annot"><span class="annottext">t ClsInst
</span><a href="#local-6989586621681072186"><span class="hs-identifier hs-var">insts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ClsInst -&gt; [SDoc]) -&gt; t ClsInst -&gt; [SDoc]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><a href="../../base/src/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a></span><span> </span><span class="annot"><span class="annottext">ClsInst -&gt; [SDoc]
</span><a href="#local-6989586621681072185"><span class="hs-identifier hs-var">badInst</span></a></span><span> </span><span class="annot"><span class="annottext">t ClsInst
</span><a href="#local-6989586621681072186"><span class="hs-identifier hs-var">insts</span></a></span><span>
</span><span id="line-1365"></span><span>
</span><span id="line-1366"></span><span>    </span><span id="local-6989586621681072184"><span class="annot"><span class="annottext">checkOverlap :: OverlapMode -&gt; IsSafeImport
</span><a href="#local-6989586621681072184"><span class="hs-identifier hs-var hs-var">checkOverlap</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Basic.html#NoOverlap"><span class="hs-identifier hs-type">NoOverlap</span></a></span><span> </span><span class="annot"><span class="annottext">SourceText
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1367"></span><span>    </span><span class="annot"><a href="#local-6989586621681072184"><span class="hs-identifier hs-var">checkOverlap</span></a></span><span> </span><span class="annot"><span class="annottext">OverlapMode
</span><span class="hs-identifier">_</span></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1368"></span><span>
</span><span id="line-1369"></span><span>    </span><span id="local-6989586621681072185"><span class="annot"><span class="annottext">badInst :: ClsInst -&gt; [SDoc]
</span><a href="#local-6989586621681072185"><span class="hs-identifier hs-var hs-var">badInst</span></a></span></span><span> </span><span id="local-6989586621681072178"><span class="annot"><span class="annottext">ClsInst
</span><a href="#local-6989586621681072178"><span class="hs-identifier hs-var">ins</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">OverlapMode -&gt; IsSafeImport
</span><a href="#local-6989586621681072184"><span class="hs-identifier hs-var">checkOverlap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OverlapFlag -&gt; OverlapMode
</span><a href="GHC.Types.Basic.html#overlapMode"><span class="hs-identifier hs-var hs-var">overlapMode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ClsInst -&gt; OverlapFlag
</span><a href="GHC.Core.InstEnv.html#is_flag"><span class="hs-identifier hs-var hs-var">is_flag</span></a></span><span> </span><span class="annot"><span class="annottext">ClsInst
</span><a href="#local-6989586621681072178"><span class="hs-identifier hs-var">ins</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1370"></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Severity -&gt; SrcSpan -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Error.html#mkLocMessage"><span class="hs-identifier hs-var">mkLocMessage</span></a></span><span> </span><span class="annot"><span class="annottext">Severity
</span><a href="GHC.Utils.Error.html#SevOutput"><span class="hs-identifier hs-var">SevOutput</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SrcSpan
</span><a href="GHC.Types.Name.html#nameSrcSpan"><span class="hs-identifier hs-var">nameSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; SrcSpan) -&gt; Name -&gt; SrcSpan
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Name
forall a. NamedThing a =&gt; a -&gt; Name
</span><a href="GHC.Types.Name.html#getName"><span class="hs-identifier hs-var">getName</span></a></span><span> </span><span class="annot"><span class="annottext">(Id -&gt; Name) -&gt; Id -&gt; Name
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ClsInst -&gt; Id
</span><a href="GHC.Core.InstEnv.html#is_dfun"><span class="hs-identifier hs-var hs-var">is_dfun</span></a></span><span> </span><span class="annot"><span class="annottext">ClsInst
</span><a href="#local-6989586621681072178"><span class="hs-identifier hs-var">ins</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc) -&gt; SDoc -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1371"></span><span>                      </span><span class="annot"><span class="annottext">OverlapMode -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OverlapFlag -&gt; OverlapMode
</span><a href="GHC.Types.Basic.html#overlapMode"><span class="hs-identifier hs-var hs-var">overlapMode</span></a></span><span> </span><span class="annot"><span class="annottext">(OverlapFlag -&gt; OverlapMode) -&gt; OverlapFlag -&gt; OverlapMode
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ClsInst -&gt; OverlapFlag
</span><a href="GHC.Core.InstEnv.html#is_flag"><span class="hs-identifier hs-var hs-var">is_flag</span></a></span><span> </span><span class="annot"><span class="annottext">ClsInst
</span><a href="#local-6989586621681072178"><span class="hs-identifier hs-var">ins</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-1372"></span><span>                      </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;overlap mode isn't allowed in Safe Haskell&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-1373"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1374"></span><span>
</span><span id="line-1375"></span><span>
</span><span id="line-1376"></span><span class="hs-comment">-- | Figure out the final correct safe haskell mode</span><span>
</span><span id="line-1377"></span><span class="annot"><a href="GHC.Driver.Main.html#hscGetSafeMode"><span class="hs-identifier hs-type">hscGetSafeMode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#SafeHaskellMode"><span class="hs-identifier hs-type">SafeHaskellMode</span></a></span><span>
</span><span id="line-1378"></span><span id="hscGetSafeMode"><span class="annot"><span class="annottext">hscGetSafeMode :: TcGblEnv -&gt; Hsc SafeHaskellMode
</span><a href="GHC.Driver.Main.html#hscGetSafeMode"><span class="hs-identifier hs-var hs-var">hscGetSafeMode</span></a></span></span><span> </span><span id="local-6989586621681072171"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072171"><span class="hs-identifier hs-var">tcg_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1379"></span><span>    </span><span id="local-6989586621681072170"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072170"><span class="hs-identifier hs-var">dflags</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-1380"></span><span>    </span><span class="annot"><span class="annottext">IO SafeHaskellMode -&gt; Hsc SafeHaskellMode
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO SafeHaskellMode -&gt; Hsc SafeHaskellMode)
-&gt; IO SafeHaskellMode -&gt; Hsc SafeHaskellMode
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; TcGblEnv -&gt; IO SafeHaskellMode
</span><a href="GHC.Tc.Utils.Monad.html#finalSafeMode"><span class="hs-identifier hs-var">finalSafeMode</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072170"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072171"><span class="hs-identifier hs-var">tcg_env</span></a></span><span>
</span><span id="line-1381"></span><span>
</span><span id="line-1382"></span><span class="hs-comment">--------------------------------------------------------------</span><span>
</span><span id="line-1383"></span><span class="hs-comment">-- Simplifiers</span><span>
</span><span id="line-1384"></span><span class="hs-comment">--------------------------------------------------------------</span><span>
</span><span id="line-1385"></span><span>
</span><span id="line-1386"></span><span class="annot"><a href="GHC.Driver.Main.html#hscSimplify"><span class="hs-identifier hs-type">hscSimplify</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../base/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModGuts"><span class="hs-identifier hs-type">ModGuts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModGuts"><span class="hs-identifier hs-type">ModGuts</span></a></span><span>
</span><span id="line-1387"></span><span id="hscSimplify"><span class="annot"><span class="annottext">hscSimplify :: HscEnv -&gt; [String] -&gt; ModGuts -&gt; IO ModGuts
</span><a href="GHC.Driver.Main.html#hscSimplify"><span class="hs-identifier hs-var hs-var">hscSimplify</span></a></span></span><span> </span><span id="local-6989586621681072168"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072168"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681072167"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681072167"><span class="hs-identifier hs-var">plugins</span></a></span></span><span> </span><span id="local-6989586621681072166"><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621681072166"><span class="hs-identifier hs-var">modguts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1388"></span><span>    </span><span class="annot"><span class="annottext">HscEnv -&gt; Hsc ModGuts -&gt; IO ModGuts
forall a. HscEnv -&gt; Hsc a -&gt; IO a
</span><a href="GHC.Driver.Types.html#runHsc"><span class="hs-identifier hs-var">runHsc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072168"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(Hsc ModGuts -&gt; IO ModGuts) -&gt; Hsc ModGuts -&gt; IO ModGuts
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[String] -&gt; ModGuts -&gt; Hsc ModGuts
</span><a href="GHC.Driver.Main.html#hscSimplify%27"><span class="hs-identifier hs-var">hscSimplify'</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681072167"><span class="hs-identifier hs-var">plugins</span></a></span><span> </span><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621681072166"><span class="hs-identifier hs-var">modguts</span></a></span><span>
</span><span id="line-1389"></span><span>
</span><span id="line-1390"></span><span class="annot"><a href="GHC.Driver.Main.html#hscSimplify%27"><span class="hs-identifier hs-type">hscSimplify'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../base/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModGuts"><span class="hs-identifier hs-type">ModGuts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModGuts"><span class="hs-identifier hs-type">ModGuts</span></a></span><span>
</span><span id="line-1391"></span><span id="hscSimplify%27"><span class="annot"><span class="annottext">hscSimplify' :: [String] -&gt; ModGuts -&gt; Hsc ModGuts
</span><a href="GHC.Driver.Main.html#hscSimplify%27"><span class="hs-identifier hs-var hs-var">hscSimplify'</span></a></span></span><span> </span><span id="local-6989586621681072165"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681072165"><span class="hs-identifier hs-var">plugins</span></a></span></span><span> </span><span id="local-6989586621681072164"><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621681072164"><span class="hs-identifier hs-var">ds_result</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1392"></span><span>    </span><span id="local-6989586621681072163"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072163"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc HscEnv
</span><a href="GHC.Driver.Main.html#getHscEnv"><span class="hs-identifier hs-var">getHscEnv</span></a></span><span>
</span><span id="line-1393"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681072161"><span class="annot"><span class="annottext">hsc_env_with_plugins :: HscEnv
</span><a href="#local-6989586621681072161"><span class="hs-identifier hs-var hs-var">hsc_env_with_plugins</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072163"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-1394"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hsc_dflags :: DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(String -&gt; DynFlags -&gt; DynFlags)
-&gt; DynFlags -&gt; [String] -&gt; DynFlags
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; DynFlags -&gt; DynFlags
</span><a href="GHC.Driver.Session.html#addPluginModuleName"><span class="hs-identifier hs-var">addPluginModuleName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072163"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681072165"><span class="hs-identifier hs-var">plugins</span></a></span><span>
</span><span id="line-1395"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-1396"></span><span>    </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;Core2Core&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1397"></span><span>      </span><span class="annot"><span class="annottext">IO ModGuts -&gt; Hsc ModGuts
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ModGuts -&gt; Hsc ModGuts) -&gt; IO ModGuts -&gt; Hsc ModGuts
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; ModGuts -&gt; IO ModGuts
</span><a href="GHC.Core.Opt.Pipeline.html#core2core"><span class="hs-identifier hs-var">core2core</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072161"><span class="hs-identifier hs-var">hsc_env_with_plugins</span></a></span><span> </span><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621681072164"><span class="hs-identifier hs-var">ds_result</span></a></span><span>
</span><span id="line-1398"></span><span>
</span><span id="line-1399"></span><span class="hs-comment">--------------------------------------------------------------</span><span>
</span><span id="line-1400"></span><span class="hs-comment">-- Interface generators</span><span>
</span><span id="line-1401"></span><span class="hs-comment">--------------------------------------------------------------</span><span>
</span><span id="line-1402"></span><span>
</span><span id="line-1403"></span><span class="hs-comment">-- | Generate a striped down interface file, e.g. for boot files or when ghci</span><span>
</span><span id="line-1404"></span><span class="hs-comment">-- generates interface files. See Note [simpleTidyPgm - mkBootModDetailsTc]</span><span>
</span><span id="line-1405"></span><span class="annot"><a href="GHC.Driver.Main.html#hscSimpleIface"><span class="hs-identifier hs-type">hscSimpleIface</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-1406"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span>
</span><span id="line-1407"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../base/src/GHC.Fingerprint.Type.html#Fingerprint"><span class="hs-identifier hs-type">Fingerprint</span></a></span><span>
</span><span id="line-1408"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Types.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../base/src/GHC.Fingerprint.Type.html#Fingerprint"><span class="hs-identifier hs-type">Fingerprint</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModDetails"><span class="hs-identifier hs-type">ModDetails</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1409"></span><span id="hscSimpleIface"><span class="annot"><span class="annottext">hscSimpleIface :: HscEnv
-&gt; TcGblEnv
-&gt; Maybe Fingerprint
-&gt; IO (ModIface, Maybe Fingerprint, ModDetails)
</span><a href="GHC.Driver.Main.html#hscSimpleIface"><span class="hs-identifier hs-var hs-var">hscSimpleIface</span></a></span></span><span> </span><span id="local-6989586621681072157"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072157"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681072156"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072156"><span class="hs-identifier hs-var">tc_result</span></a></span></span><span> </span><span id="local-6989586621681072155"><span class="annot"><span class="annottext">Maybe Fingerprint
</span><a href="#local-6989586621681072155"><span class="hs-identifier hs-var">mb_old_iface</span></a></span></span><span>
</span><span id="line-1410"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; Hsc (ModIface, Maybe Fingerprint, ModDetails)
-&gt; IO (ModIface, Maybe Fingerprint, ModDetails)
forall a. HscEnv -&gt; Hsc a -&gt; IO a
</span><a href="GHC.Driver.Types.html#runHsc"><span class="hs-identifier hs-var">runHsc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072157"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(Hsc (ModIface, Maybe Fingerprint, ModDetails)
 -&gt; IO (ModIface, Maybe Fingerprint, ModDetails))
-&gt; Hsc (ModIface, Maybe Fingerprint, ModDetails)
-&gt; IO (ModIface, Maybe Fingerprint, ModDetails)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
-&gt; Maybe Fingerprint
-&gt; Hsc (ModIface, Maybe Fingerprint, ModDetails)
</span><a href="GHC.Driver.Main.html#hscSimpleIface%27"><span class="hs-identifier hs-var">hscSimpleIface'</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072156"><span class="hs-identifier hs-var">tc_result</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Fingerprint
</span><a href="#local-6989586621681072155"><span class="hs-identifier hs-var">mb_old_iface</span></a></span><span>
</span><span id="line-1411"></span><span>
</span><span id="line-1412"></span><span class="annot"><a href="GHC.Driver.Main.html#hscSimpleIface%27"><span class="hs-identifier hs-type">hscSimpleIface'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcGblEnv"><span class="hs-identifier hs-type">TcGblEnv</span></a></span><span>
</span><span id="line-1413"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../base/src/GHC.Fingerprint.Type.html#Fingerprint"><span class="hs-identifier hs-type">Fingerprint</span></a></span><span>
</span><span id="line-1414"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Types.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../base/src/GHC.Fingerprint.Type.html#Fingerprint"><span class="hs-identifier hs-type">Fingerprint</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModDetails"><span class="hs-identifier hs-type">ModDetails</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1415"></span><span id="hscSimpleIface%27"><span class="annot"><span class="annottext">hscSimpleIface' :: TcGblEnv
-&gt; Maybe Fingerprint
-&gt; Hsc (ModIface, Maybe Fingerprint, ModDetails)
</span><a href="GHC.Driver.Main.html#hscSimpleIface%27"><span class="hs-identifier hs-var hs-var">hscSimpleIface'</span></a></span></span><span> </span><span id="local-6989586621681072154"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072154"><span class="hs-identifier hs-var">tc_result</span></a></span></span><span> </span><span id="local-6989586621681072153"><span class="annot"><span class="annottext">Maybe Fingerprint
</span><a href="#local-6989586621681072153"><span class="hs-identifier hs-var">mb_old_iface</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1416"></span><span>    </span><span id="local-6989586621681072152"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072152"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc HscEnv
</span><a href="GHC.Driver.Main.html#getHscEnv"><span class="hs-identifier hs-var">getHscEnv</span></a></span><span>
</span><span id="line-1417"></span><span>    </span><span id="local-6989586621681072151"><span class="annot"><span class="annottext">ModDetails
</span><a href="#local-6989586621681072151"><span class="hs-identifier hs-var">details</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ModDetails -&gt; Hsc ModDetails
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ModDetails -&gt; Hsc ModDetails)
-&gt; IO ModDetails -&gt; Hsc ModDetails
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; TcGblEnv -&gt; IO ModDetails
</span><a href="GHC.Iface.Tidy.html#mkBootModDetailsTc"><span class="hs-identifier hs-var">mkBootModDetailsTc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072152"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072154"><span class="hs-identifier hs-var">tc_result</span></a></span><span>
</span><span id="line-1418"></span><span>    </span><span id="local-6989586621681072150"><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="#local-6989586621681072150"><span class="hs-identifier hs-var">safe_mode</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; Hsc SafeHaskellMode
</span><a href="GHC.Driver.Main.html#hscGetSafeMode"><span class="hs-identifier hs-var">hscGetSafeMode</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072154"><span class="hs-identifier hs-var">tc_result</span></a></span><span>
</span><span id="line-1419"></span><span>    </span><span id="local-6989586621681072149"><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621681072149"><span class="hs-identifier hs-var">new_iface</span></a></span></span><span>
</span><span id="line-1420"></span><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;MkFinalIface&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1421"></span><span>           </span><span class="annot"><span class="annottext">IO ModIface -&gt; Hsc ModIface
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ModIface -&gt; Hsc ModIface) -&gt; IO ModIface -&gt; Hsc ModIface
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1422"></span><span>               </span><span class="annot"><span class="annottext">HscEnv -&gt; SafeHaskellMode -&gt; ModDetails -&gt; TcGblEnv -&gt; IO ModIface
</span><a href="GHC.Iface.Make.html#mkIfaceTc"><span class="hs-identifier hs-var">mkIfaceTc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072152"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">SafeHaskellMode
</span><a href="#local-6989586621681072150"><span class="hs-identifier hs-var">safe_mode</span></a></span><span> </span><span class="annot"><span class="annottext">ModDetails
</span><a href="#local-6989586621681072151"><span class="hs-identifier hs-var">details</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681072154"><span class="hs-identifier hs-var">tc_result</span></a></span><span>
</span><span id="line-1423"></span><span>    </span><span class="hs-comment">-- And the answer is ...</span><span>
</span><span id="line-1424"></span><span>    </span><span class="annot"><span class="annottext">IO () -&gt; Hsc ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; Hsc ()) -&gt; IO () -&gt; Hsc ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; IO ()
</span><a href="GHC.Driver.Main.html#dumpIfaceStats"><span class="hs-identifier hs-var">dumpIfaceStats</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072152"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-1425"></span><span>    </span><span class="annot"><span class="annottext">(ModIface, Maybe Fingerprint, ModDetails)
-&gt; Hsc (ModIface, Maybe Fingerprint, ModDetails)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621681072149"><span class="hs-identifier hs-var">new_iface</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe Fingerprint
</span><a href="#local-6989586621681072153"><span class="hs-identifier hs-var">mb_old_iface</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModDetails
</span><a href="#local-6989586621681072151"><span class="hs-identifier hs-var">details</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1426"></span><span>
</span><span id="line-1427"></span><span class="hs-comment">--------------------------------------------------------------</span><span>
</span><span id="line-1428"></span><span class="hs-comment">-- BackEnd combinators</span><span>
</span><span id="line-1429"></span><span class="hs-comment">--------------------------------------------------------------</span><span>
</span><span id="line-1430"></span><span class="hs-comment">{-
Note [Interface filename extensions]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

ModLocation only contains the base names, however when generating dynamic files
the actual extension might differ from the default.

So we only load the base name from ModLocation and replace the actual extension
according to the information in DynFlags.

If we generate a interface file right after running the core pipeline we will
have set -dynamic-too and potentially generate both interface files at the same
time.

If we generate a interface file after running the backend then dynamic-too won't
be set, however then the extension will be contained in the dynflags instead so
things still work out fine.
-}</span><span>
</span><span id="line-1448"></span><span>
</span><span id="line-1449"></span><span class="annot"><a href="GHC.Driver.Main.html#hscWriteIface"><span class="hs-identifier hs-type">hscWriteIface</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModIface"><span class="hs-identifier hs-type">ModIface</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Location.html#ModLocation"><span class="hs-identifier hs-type">ModLocation</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1450"></span><span id="hscWriteIface"><span class="annot"><span class="annottext">hscWriteIface :: DynFlags -&gt; ModIface -&gt; IsSafeImport -&gt; ModLocation -&gt; IO ()
</span><a href="GHC.Driver.Main.html#hscWriteIface"><span class="hs-identifier hs-var hs-var">hscWriteIface</span></a></span></span><span> </span><span id="local-6989586621681072147"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072147"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621681072146"><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621681072146"><span class="hs-identifier hs-var">iface</span></a></span></span><span> </span><span id="local-6989586621681072145"><span class="annot"><span class="annottext">IsSafeImport
</span><a href="#local-6989586621681072145"><span class="hs-identifier hs-var">no_change</span></a></span></span><span> </span><span id="local-6989586621681072144"><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681072144"><span class="hs-identifier hs-var">mod_location</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1451"></span><span>    </span><span class="hs-comment">-- mod_location only contains the base name, so we rebuild the</span><span>
</span><span id="line-1452"></span><span>    </span><span class="hs-comment">-- correct file extension from the dynflags.</span><span>
</span><span id="line-1453"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681072143"><span class="annot"><span class="annottext">ifaceBaseFile :: String
</span><a href="#local-6989586621681072143"><span class="hs-identifier hs-var hs-var">ifaceBaseFile</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModLocation -&gt; String
</span><a href="GHC.Unit.Module.Location.html#ml_hi_file"><span class="hs-identifier hs-var hs-var">ml_hi_file</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681072144"><span class="hs-identifier hs-var">mod_location</span></a></span><span>
</span><span id="line-1454"></span><span>    </span><span class="annot"><span class="annottext">IsSafeImport -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; IsSafeImport -&gt; f () -&gt; f ()
</span><a href="../../base/src/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><a href="#local-6989586621681072145"><span class="hs-identifier hs-var">no_change</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1455"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681072140"><span class="annot"><span class="annottext">ifaceFile :: String
</span><a href="#local-6989586621681072140"><span class="hs-identifier hs-var hs-var">ifaceFile</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><a href="#local-6989586621681072139"><span class="hs-identifier hs-var">buildIfName</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681072143"><span class="hs-identifier hs-var">ifaceBaseFile</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; String
</span><a href="GHC.Driver.Session.html#hiSuf"><span class="hs-identifier hs-var hs-var">hiSuf</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072147"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1456"></span><span>        </span><span class="hs-keyword">in</span><span>  </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;writeIface&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1457"></span><span>            </span><span class="annot"><span class="annottext">DynFlags -&gt; String -&gt; ModIface -&gt; IO ()
</span><a href="GHC.Iface.Load.html#writeIface"><span class="hs-identifier hs-var">writeIface</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072147"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681072140"><span class="hs-identifier hs-var">ifaceFile</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621681072146"><span class="hs-identifier hs-var">iface</span></a></span><span>
</span><span id="line-1458"></span><span>    </span><span class="annot"><span class="annottext">DynFlags -&gt; IO () -&gt; IO ()
forall (m :: * -&gt; *). MonadIO m =&gt; DynFlags -&gt; m () -&gt; m ()
</span><a href="GHC.Driver.Session.html#whenGeneratingDynamicToo"><span class="hs-identifier hs-var">whenGeneratingDynamicToo</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072147"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1459"></span><span>        </span><span class="hs-comment">-- TODO: We should do a no_change check for the dynamic</span><span>
</span><span id="line-1460"></span><span>        </span><span class="hs-comment">--       interface file too</span><span>
</span><span id="line-1461"></span><span>        </span><span class="hs-comment">-- When we generate iface files after core</span><span>
</span><span id="line-1462"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681072136"><span class="annot"><span class="annottext">dynDflags :: DynFlags
</span><a href="#local-6989586621681072136"><span class="hs-identifier hs-var hs-var">dynDflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; DynFlags
</span><a href="GHC.Driver.Session.html#dynamicTooMkDynamicDynFlags"><span class="hs-identifier hs-var">dynamicTooMkDynamicDynFlags</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072147"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1463"></span><span>            </span><span class="hs-comment">-- dynDflags will have set hiSuf correctly.</span><span>
</span><span id="line-1464"></span><span>            </span><span id="local-6989586621681072134"><span class="annot"><span class="annottext">dynIfaceFile :: String
</span><a href="#local-6989586621681072134"><span class="hs-identifier hs-var hs-var">dynIfaceFile</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><a href="#local-6989586621681072139"><span class="hs-identifier hs-var">buildIfName</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681072143"><span class="hs-identifier hs-var">ifaceBaseFile</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; String
</span><a href="GHC.Driver.Session.html#hiSuf"><span class="hs-identifier hs-var hs-var">hiSuf</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072136"><span class="hs-identifier hs-var">dynDflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1465"></span><span>
</span><span id="line-1466"></span><span>        </span><span class="annot"><span class="annottext">DynFlags -&gt; String -&gt; ModIface -&gt; IO ()
</span><a href="GHC.Iface.Load.html#writeIface"><span class="hs-identifier hs-var">writeIface</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072136"><span class="hs-identifier hs-var">dynDflags</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681072134"><span class="hs-identifier hs-var">dynIfaceFile</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621681072146"><span class="hs-identifier hs-var">iface</span></a></span><span>
</span><span id="line-1467"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1468"></span><span>    </span><span class="annot"><a href="#local-6989586621681072139"><span class="hs-identifier hs-type">buildIfName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span>
</span><span id="line-1469"></span><span>    </span><span id="local-6989586621681072139"><span class="annot"><span class="annottext">buildIfName :: String -&gt; String -&gt; String
</span><a href="#local-6989586621681072139"><span class="hs-identifier hs-var hs-var">buildIfName</span></a></span></span><span> </span><span id="local-6989586621681072133"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681072133"><span class="hs-identifier hs-var">baseName</span></a></span></span><span> </span><span id="local-6989586621681072132"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681072132"><span class="hs-identifier hs-var">suffix</span></a></span></span><span>
</span><span id="line-1470"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681072131"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681072131"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Maybe String
</span><a href="GHC.Driver.Session.html#outputHi"><span class="hs-identifier hs-var hs-var">outputHi</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072147"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1471"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681072131"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-1472"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1473"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681072129"><span class="annot"><span class="annottext">with_hi :: String
</span><a href="#local-6989586621681072129"><span class="hs-identifier hs-var hs-var">with_hi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
</span><a href="../../filepath/src/System.FilePath.Windows.html#replaceExtension"><span class="hs-identifier hs-var">replaceExtension</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681072133"><span class="hs-identifier hs-var">baseName</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681072132"><span class="hs-identifier hs-var">suffix</span></a></span><span>
</span><span id="line-1474"></span><span>        </span><span class="hs-keyword">in</span><span>  </span><span class="annot"><span class="annottext">IsBootInterface -&gt; String -&gt; String
</span><a href="GHC.Unit.Module.Location.html#addBootSuffix_maybe"><span class="hs-identifier hs-var">addBootSuffix_maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModIface -&gt; IsBootInterface
</span><a href="GHC.Driver.Types.html#mi_boot"><span class="hs-identifier hs-var">mi_boot</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621681072146"><span class="hs-identifier hs-var">iface</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681072129"><span class="hs-identifier hs-var">with_hi</span></a></span><span>
</span><span id="line-1475"></span><span>
</span><span id="line-1476"></span><span class="hs-comment">-- | Compile to hard-code.</span><span>
</span><span id="line-1477"></span><span class="annot"><a href="GHC.Driver.Main.html#hscGenHardCode"><span class="hs-identifier hs-type">hscGenHardCode</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#CgGuts"><span class="hs-identifier hs-type">CgGuts</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Location.html#ModLocation"><span class="hs-identifier hs-type">ModLocation</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>
</span><span id="line-1478"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../base/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="../../ghc-boot-th/src/GHC.ForeignSrcLang.Type.html#ForeignSrcLang"><span class="hs-identifier hs-type">ForeignSrcLang</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.StgToCmm.Types.html#CgInfos"><span class="hs-identifier hs-type">CgInfos</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1479"></span><span>               </span><span class="hs-comment">-- ^ @Just f@ &lt;=&gt; _stub.c is f</span><span>
</span><span id="line-1480"></span><span id="hscGenHardCode"><span class="annot"><span class="annottext">hscGenHardCode :: HscEnv
-&gt; CgGuts
-&gt; ModLocation
-&gt; String
-&gt; IO (String, Maybe String, [(ForeignSrcLang, String)], CgInfos)
</span><a href="GHC.Driver.Main.html#hscGenHardCode"><span class="hs-identifier hs-var hs-var">hscGenHardCode</span></a></span></span><span> </span><span id="local-6989586621681072124"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072124"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681072123"><span class="annot"><span class="annottext">CgGuts
</span><a href="#local-6989586621681072123"><span class="hs-identifier hs-var">cgguts</span></a></span></span><span> </span><span id="local-6989586621681072122"><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681072122"><span class="hs-identifier hs-var">location</span></a></span></span><span> </span><span id="local-6989586621681072121"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681072121"><span class="hs-identifier hs-var">output_filename</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1481"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#CgGuts"><span class="hs-identifier hs-type">CgGuts</span></a></span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- This is the last use of the ModGuts in a compilation.</span><span>
</span><span id="line-1482"></span><span>                    </span><span class="hs-comment">-- From now on, we just use the bits we need.</span><span>
</span><span id="line-1483"></span><span>                    </span><span class="annot"><span class="annottext">cg_module :: CgGuts -&gt; Module
</span><a href="GHC.Driver.Types.html#cg_module"><span class="hs-identifier hs-var">cg_module</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681072118"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681072118"><span class="hs-identifier hs-var">this_mod</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-1484"></span><span>                    </span><span class="annot"><span class="annottext">cg_binds :: CgGuts -&gt; CoreProgram
</span><a href="GHC.Driver.Types.html#cg_binds"><span class="hs-identifier hs-var">cg_binds</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681072116"><span class="annot"><span class="annottext">CoreProgram
</span><a href="#local-6989586621681072116"><span class="hs-identifier hs-var">core_binds</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-1485"></span><span>                    </span><span class="annot"><span class="annottext">cg_tycons :: CgGuts -&gt; [TyCon]
</span><a href="GHC.Driver.Types.html#cg_tycons"><span class="hs-identifier hs-var">cg_tycons</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681072114"><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681072114"><span class="hs-identifier hs-var">tycons</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-1486"></span><span>                    </span><span class="annot"><span class="annottext">cg_foreign :: CgGuts -&gt; ForeignStubs
</span><a href="GHC.Driver.Types.html#cg_foreign"><span class="hs-identifier hs-var">cg_foreign</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681072112"><span class="annot"><span class="annottext">ForeignStubs
</span><a href="#local-6989586621681072112"><span class="hs-identifier hs-var">foreign_stubs0</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-1487"></span><span>                    </span><span class="annot"><span class="annottext">cg_foreign_files :: CgGuts -&gt; [(ForeignSrcLang, String)]
</span><a href="GHC.Driver.Types.html#cg_foreign_files"><span class="hs-identifier hs-var">cg_foreign_files</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681072110"><span class="annot"><span class="annottext">[(ForeignSrcLang, String)]
</span><a href="#local-6989586621681072110"><span class="hs-identifier hs-var">foreign_files</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-1488"></span><span>                    </span><span class="annot"><span class="annottext">cg_dep_pkgs :: CgGuts -&gt; [UnitId]
</span><a href="GHC.Driver.Types.html#cg_dep_pkgs"><span class="hs-identifier hs-var">cg_dep_pkgs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681072108"><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681072108"><span class="hs-identifier hs-var">dependencies</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-1489"></span><span>                    </span><span class="annot"><span class="annottext">cg_hpc_info :: CgGuts -&gt; HpcInfo
</span><a href="GHC.Driver.Types.html#cg_hpc_info"><span class="hs-identifier hs-var">cg_hpc_info</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681072106"><span class="annot"><span class="annottext">HpcInfo
</span><a href="#local-6989586621681072106"><span class="hs-identifier hs-var">hpc_info</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CgGuts
</span><a href="#local-6989586621681072123"><span class="hs-identifier hs-var">cgguts</span></a></span><span>
</span><span id="line-1490"></span><span>            </span><span id="local-6989586621681072105"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621681072105"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072124"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-1491"></span><span>            </span><span id="local-6989586621681072104"><span class="annot"><span class="annottext">data_tycons :: [TyCon]
</span><a href="#local-6989586621681072104"><span class="hs-identifier hs-var hs-var">data_tycons</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TyCon -&gt; IsSafeImport) -&gt; [TyCon] -&gt; [TyCon]
forall a. (a -&gt; IsSafeImport) -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; IsSafeImport
</span><a href="GHC.Core.TyCon.html#isDataTyCon"><span class="hs-identifier hs-var">isDataTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681072114"><span class="hs-identifier hs-var">tycons</span></a></span><span>
</span><span id="line-1492"></span><span>            </span><span class="hs-comment">-- cg_tycons includes newtypes, for the benefit of External Core,</span><span>
</span><span id="line-1493"></span><span>            </span><span class="hs-comment">-- but we don't generate any code for newtypes</span><span>
</span><span id="line-1494"></span><span>
</span><span id="line-1495"></span><span>        </span><span class="hs-comment">-------------------</span><span>
</span><span id="line-1496"></span><span>        </span><span class="hs-comment">-- PREPARE FOR CODE GENERATION</span><span>
</span><span id="line-1497"></span><span>        </span><span class="hs-comment">-- Do saturation and convert to A-normal form</span><span>
</span><span id="line-1498"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621681072102"><span class="annot"><span class="annottext">CoreProgram
</span><a href="#local-6989586621681072102"><span class="hs-identifier hs-var">prepd_binds</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681072101"><span class="annot"><span class="annottext">Set CostCentre
</span><a href="#local-6989586621681072101"><span class="hs-identifier hs-var">local_ccs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;CorePrep&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1499"></span><span>                       </span><span class="annot"><span class="annottext">HscEnv
-&gt; Module
-&gt; ModLocation
-&gt; CoreProgram
-&gt; [TyCon]
-&gt; IO (CoreProgram, Set CostCentre)
</span><a href="GHC.CoreToStg.Prep.html#corePrepPgm"><span class="hs-identifier hs-var">corePrepPgm</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072124"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681072118"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681072122"><span class="hs-identifier hs-var">location</span></a></span><span>
</span><span id="line-1500"></span><span>                                   </span><span class="annot"><span class="annottext">CoreProgram
</span><a href="#local-6989586621681072116"><span class="hs-identifier hs-var">core_binds</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681072104"><span class="hs-identifier hs-var">data_tycons</span></a></span><span>
</span><span id="line-1501"></span><span>        </span><span class="hs-comment">-----------------  Convert to STG ------------------</span><span>
</span><span id="line-1502"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621681072099"><span class="annot"><span class="annottext">[StgTopBinding]
</span><a href="#local-6989586621681072099"><span class="hs-identifier hs-var">stg_binds</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681072098"><span class="annot"><span class="annottext">[CostCentre]
</span><a href="#local-6989586621681072098"><span class="hs-identifier hs-var">caf_ccs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681072097"><span class="annot"><span class="annottext">[CostCentreStack]
</span><a href="#local-6989586621681072097"><span class="hs-identifier hs-var">caf_cc_stacks</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1503"></span><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;CoreToStg&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1504"></span><span>               </span><span class="annot"><span class="annottext">DynFlags
-&gt; Module -&gt; CoreProgram -&gt; IO ([StgTopBinding], CollectedCCs)
</span><a href="GHC.Driver.Main.html#myCoreToStg"><span class="hs-identifier hs-var">myCoreToStg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072105"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681072118"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="annot"><span class="annottext">CoreProgram
</span><a href="#local-6989586621681072102"><span class="hs-identifier hs-var">prepd_binds</span></a></span><span>
</span><span id="line-1505"></span><span>
</span><span id="line-1506"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681072095"><span class="annot"><span class="annottext">cost_centre_info :: CollectedCCs
</span><a href="#local-6989586621681072095"><span class="hs-identifier hs-var hs-var">cost_centre_info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1507"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Set CostCentre -&gt; [CostCentre]
forall a. Set a -&gt; [a]
</span><a href="../../containers/src/Data.Set.Internal.html#toList"><span class="hs-identifier hs-var">S.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Set CostCentre
</span><a href="#local-6989586621681072101"><span class="hs-identifier hs-var">local_ccs</span></a></span><span> </span><span class="annot"><span class="annottext">[CostCentre] -&gt; [CostCentre] -&gt; [CostCentre]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[CostCentre]
</span><a href="#local-6989586621681072098"><span class="hs-identifier hs-var">caf_ccs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[CostCentreStack]
</span><a href="#local-6989586621681072097"><span class="hs-identifier hs-var">caf_cc_stacks</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1508"></span><span>            </span><span id="local-6989586621681072093"><span class="annot"><span class="annottext">prof_init :: SDoc
</span><a href="#local-6989586621681072093"><span class="hs-identifier hs-var hs-var">prof_init</span></a></span></span><span>
</span><span id="line-1509"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; IsSafeImport
</span><a href="GHC.Driver.Session.html#sccProfilingEnabled"><span class="hs-identifier hs-var">sccProfilingEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072105"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module -&gt; CollectedCCs -&gt; SDoc
</span><a href="GHC.Driver.CodeOutput.html#profilingInitCode"><span class="hs-identifier hs-var">profilingInitCode</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681072118"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="annot"><span class="annottext">CollectedCCs
</span><a href="#local-6989586621681072095"><span class="hs-identifier hs-var">cost_centre_info</span></a></span><span>
</span><span id="line-1510"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span>
</span><span id="line-1511"></span><span>            </span><span id="local-6989586621681072090"><span class="annot"><span class="annottext">foreign_stubs :: ForeignStubs
</span><a href="#local-6989586621681072090"><span class="hs-identifier hs-var hs-var">foreign_stubs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ForeignStubs
</span><a href="#local-6989586621681072112"><span class="hs-identifier hs-var">foreign_stubs0</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignStubs -&gt; SDoc -&gt; ForeignStubs
</span><a href="GHC.Driver.Types.html#appendStubC"><span class="hs-operator hs-var">`appendStubC`</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681072093"><span class="hs-identifier hs-var">prof_init</span></a></span><span>
</span><span id="line-1512"></span><span>
</span><span id="line-1513"></span><span>        </span><span class="hs-comment">------------------  Code generation ------------------</span><span>
</span><span id="line-1514"></span><span>
</span><span id="line-1515"></span><span>        </span><span class="hs-comment">-- The back-end is streamed: each top-level function goes</span><span>
</span><span id="line-1516"></span><span>        </span><span class="hs-comment">-- from Stg all the way to asm before dealing with the next</span><span>
</span><span id="line-1517"></span><span>        </span><span class="hs-comment">-- top-level function, so showPass isn't very useful here.</span><span>
</span><span id="line-1518"></span><span>        </span><span class="hs-comment">-- Hence we have one showPass for the whole backend, the</span><span>
</span><span id="line-1519"></span><span>        </span><span class="hs-comment">-- next showPass after this will be &quot;Assembler&quot;.</span><span>
</span><span id="line-1520"></span><span>        </span><span class="annot"><span class="annottext">DynFlags
-&gt; SDoc
-&gt; ((String, Maybe String, [(ForeignSrcLang, String)], CgInfos)
    -&gt; ())
-&gt; IO (String, Maybe String, [(ForeignSrcLang, String)], CgInfos)
-&gt; IO (String, Maybe String, [(ForeignSrcLang, String)], CgInfos)
forall (m :: * -&gt; *) a.
MonadIO m =&gt;
DynFlags -&gt; SDoc -&gt; (a -&gt; ()) -&gt; m a -&gt; m a
</span><a href="GHC.Utils.Error.html#withTiming"><span class="hs-identifier hs-var">withTiming</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072105"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1521"></span><span>                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;CodeGen&quot;</span></span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#brackets"><span class="hs-identifier hs-var">brackets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681072118"><span class="hs-identifier hs-var">this_mod</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1522"></span><span>                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">()
-&gt; (String, Maybe String, [(ForeignSrcLang, String)], CgInfos)
-&gt; ()
forall a b. a -&gt; b -&gt; a
</span><a href="../../base/src/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO (String, Maybe String, [(ForeignSrcLang, String)], CgInfos)
 -&gt; IO (String, Maybe String, [(ForeignSrcLang, String)], CgInfos))
-&gt; IO (String, Maybe String, [(ForeignSrcLang, String)], CgInfos)
-&gt; IO (String, Maybe String, [(ForeignSrcLang, String)], CgInfos)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1523"></span><span>            </span><span id="local-6989586621681072087"><span class="annot"><span class="annottext">Stream IO CmmGroupSRTs CgInfos
</span><a href="#local-6989586621681072087"><span class="hs-identifier hs-var">cmms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;StgToCmm&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1524"></span><span>                            </span><span class="annot"><span class="annottext">HscEnv
-&gt; Module
-&gt; [TyCon]
-&gt; CollectedCCs
-&gt; [StgTopBinding]
-&gt; HpcInfo
-&gt; IO (Stream IO CmmGroupSRTs CgInfos)
</span><a href="GHC.Driver.Main.html#doCodeGen"><span class="hs-identifier hs-var">doCodeGen</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072124"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681072118"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681072104"><span class="hs-identifier hs-var">data_tycons</span></a></span><span>
</span><span id="line-1525"></span><span>                                </span><span class="annot"><span class="annottext">CollectedCCs
</span><a href="#local-6989586621681072095"><span class="hs-identifier hs-var">cost_centre_info</span></a></span><span>
</span><span id="line-1526"></span><span>                                </span><span class="annot"><span class="annottext">[StgTopBinding]
</span><a href="#local-6989586621681072099"><span class="hs-identifier hs-var">stg_binds</span></a></span><span> </span><span class="annot"><span class="annottext">HpcInfo
</span><a href="#local-6989586621681072106"><span class="hs-identifier hs-var">hpc_info</span></a></span><span>
</span><span id="line-1527"></span><span>
</span><span id="line-1528"></span><span>            </span><span class="hs-comment">------------------  Code output -----------------------</span><span>
</span><span id="line-1529"></span><span>            </span><span id="local-6989586621681072086"><span class="annot"><span class="annottext">Stream IO RawCmmGroup CgInfos
</span><a href="#local-6989586621681072086"><span class="hs-identifier hs-var">rawcmms0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;cmmToRawCmm&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1530"></span><span>                      </span><span class="annot"><span class="annottext">(Hooks
 -&gt; Maybe
      (DynFlags
       -&gt; Maybe Module
       -&gt; Stream IO CmmGroupSRTs CgInfos
       -&gt; IO (Stream IO RawCmmGroup CgInfos)))
-&gt; (DynFlags
    -&gt; Maybe Module
    -&gt; Stream IO CmmGroupSRTs CgInfos
    -&gt; IO (Stream IO RawCmmGroup CgInfos))
-&gt; DynFlags
-&gt; DynFlags
-&gt; Maybe Module
-&gt; Stream IO CmmGroupSRTs CgInfos
-&gt; IO (Stream IO RawCmmGroup CgInfos)
forall a. (Hooks -&gt; Maybe a) -&gt; a -&gt; DynFlags -&gt; a
</span><a href="GHC.Driver.Hooks.html#lookupHook"><span class="hs-identifier hs-var">lookupHook</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681072084"><span class="annot"><span class="annottext">Hooks
</span><a href="#local-6989586621681072084"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Hooks
-&gt; forall a.
   Maybe
     (DynFlags
      -&gt; Maybe Module
      -&gt; Stream IO CmmGroupSRTs a
      -&gt; IO (Stream IO RawCmmGroup a))
</span><a href="GHC.Driver.Hooks.html#cmmToRawCmmHook"><span class="hs-identifier hs-var hs-var">cmmToRawCmmHook</span></a></span><span> </span><span class="annot"><span class="annottext">Hooks
</span><a href="#local-6989586621681072084"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1531"></span><span>                        </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681072082"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072082"><span class="hs-identifier hs-var">dflg</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe Module
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DynFlags
-&gt; Stream IO CmmGroupSRTs CgInfos
-&gt; IO (Stream IO RawCmmGroup CgInfos)
forall a.
DynFlags
-&gt; Stream IO CmmGroupSRTs a -&gt; IO (Stream IO RawCmmGroup a)
</span><a href="GHC.Cmm.Info.html#cmmToRawCmm"><span class="hs-identifier hs-var">cmmToRawCmm</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072082"><span class="hs-identifier hs-var">dflg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072105"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072105"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; Maybe Module
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681072118"><span class="hs-identifier hs-var">this_mod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Stream IO CmmGroupSRTs CgInfos
</span><a href="#local-6989586621681072087"><span class="hs-identifier hs-var">cmms</span></a></span><span>
</span><span id="line-1532"></span><span>
</span><span id="line-1533"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681072073"><span class="annot"><span class="annottext">dump :: t a -&gt; IO (t a)
</span><a href="#local-6989586621681072073"><span class="hs-identifier hs-var hs-var">dump</span></a></span></span><span> </span><span id="local-6989586621681072072"><span class="annot"><span class="annottext">t a
</span><a href="#local-6989586621681072072"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1534"></span><span>                  </span><span class="annot"><span class="annottext">IsSafeImport -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; IsSafeImport -&gt; f () -&gt; f ()
</span><a href="../../base/src/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t a -&gt; IsSafeImport
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; IsSafeImport
</span><a href="../../base/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">t a
</span><a href="#local-6989586621681072072"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1535"></span><span>                    </span><span class="annot"><span class="annottext">DynFlags -&gt; DumpFlag -&gt; String -&gt; DumpFormat -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#dumpIfSet_dyn"><span class="hs-identifier hs-var">dumpIfSet_dyn</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072105"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_cmm_raw"><span class="hs-identifier hs-var">Opt_D_dump_cmm_raw</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Raw Cmm&quot;</span></span><span> </span><span class="annot"><span class="annottext">DumpFormat
</span><a href="GHC.Utils.Error.html#FormatCMM"><span class="hs-identifier hs-var">FormatCMM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t a -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">t a
</span><a href="#local-6989586621681072072"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1536"></span><span>                  </span><span class="annot"><span class="annottext">t a -&gt; IO (t a)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">t a
</span><a href="#local-6989586621681072072"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-1537"></span><span>                </span><span id="local-6989586621681072061"><span class="annot"><span class="annottext">rawcmms1 :: Stream IO RawCmmGroup CgInfos
</span><a href="#local-6989586621681072061"><span class="hs-identifier hs-var hs-var">rawcmms1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(RawCmmGroup -&gt; IO RawCmmGroup)
-&gt; Stream IO RawCmmGroup CgInfos -&gt; Stream IO RawCmmGroup CgInfos
forall (m :: * -&gt; *) a b x.
Monad m =&gt;
(a -&gt; m b) -&gt; Stream m a x -&gt; Stream m b x
</span><a href="GHC.Data.Stream.html#mapM"><span class="hs-identifier hs-var">Stream.mapM</span></a></span><span> </span><span class="annot"><span class="annottext">RawCmmGroup -&gt; IO RawCmmGroup
forall {t :: * -&gt; *} {a}.
(Foldable t, Outputable (t a)) =&gt;
t a -&gt; IO (t a)
</span><a href="#local-6989586621681072073"><span class="hs-identifier hs-var">dump</span></a></span><span> </span><span class="annot"><span class="annottext">Stream IO RawCmmGroup CgInfos
</span><a href="#local-6989586621681072086"><span class="hs-identifier hs-var">rawcmms0</span></a></span><span>
</span><span id="line-1538"></span><span>
</span><span id="line-1539"></span><span>            </span><span class="hs-special">(</span><span id="local-6989586621681072059"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681072059"><span class="hs-identifier hs-var">output_filename</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681072058"><span class="annot"><span class="annottext">IsSafeImport
</span><a href="#local-6989586621681072058"><span class="hs-identifier hs-var">_stub_h_exists</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681072057"><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621681072057"><span class="hs-identifier hs-var">stub_c_exists</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621681072056"><span class="annot"><span class="annottext">[(ForeignSrcLang, String)]
</span><a href="#local-6989586621681072056"><span class="hs-identifier hs-var">foreign_fps</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681072055"><span class="annot"><span class="annottext">CgInfos
</span><a href="#local-6989586621681072055"><span class="hs-identifier hs-var">cg_infos</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1540"></span><span>                </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;codeOutput&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1541"></span><span>                  </span><span class="annot"><span class="annottext">DynFlags
-&gt; Module
-&gt; String
-&gt; ModLocation
-&gt; ForeignStubs
-&gt; [(ForeignSrcLang, String)]
-&gt; [UnitId]
-&gt; Stream IO RawCmmGroup CgInfos
-&gt; IO
     (String, (IsSafeImport, Maybe String), [(ForeignSrcLang, String)],
      CgInfos)
forall a.
DynFlags
-&gt; Module
-&gt; String
-&gt; ModLocation
-&gt; ForeignStubs
-&gt; [(ForeignSrcLang, String)]
-&gt; [UnitId]
-&gt; Stream IO RawCmmGroup a
-&gt; IO
     (String, (IsSafeImport, Maybe String), [(ForeignSrcLang, String)],
      a)
</span><a href="GHC.Driver.CodeOutput.html#codeOutput"><span class="hs-identifier hs-var">codeOutput</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072105"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681072118"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681072121"><span class="hs-identifier hs-var">output_filename</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681072122"><span class="hs-identifier hs-var">location</span></a></span><span>
</span><span id="line-1542"></span><span>                  </span><span class="annot"><span class="annottext">ForeignStubs
</span><a href="#local-6989586621681072090"><span class="hs-identifier hs-var">foreign_stubs</span></a></span><span> </span><span class="annot"><span class="annottext">[(ForeignSrcLang, String)]
</span><a href="#local-6989586621681072110"><span class="hs-identifier hs-var">foreign_files</span></a></span><span> </span><span class="annot"><span class="annottext">[UnitId]
</span><a href="#local-6989586621681072108"><span class="hs-identifier hs-var">dependencies</span></a></span><span> </span><span class="annot"><span class="annottext">Stream IO RawCmmGroup CgInfos
</span><a href="#local-6989586621681072061"><span class="hs-identifier hs-var">rawcmms1</span></a></span><span>
</span><span id="line-1543"></span><span>            </span><span class="annot"><span class="annottext">(String, Maybe String, [(ForeignSrcLang, String)], CgInfos)
-&gt; IO (String, Maybe String, [(ForeignSrcLang, String)], CgInfos)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681072059"><span class="hs-identifier hs-var">output_filename</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621681072057"><span class="hs-identifier hs-var">stub_c_exists</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[(ForeignSrcLang, String)]
</span><a href="#local-6989586621681072056"><span class="hs-identifier hs-var">foreign_fps</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CgInfos
</span><a href="#local-6989586621681072055"><span class="hs-identifier hs-var">cg_infos</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1544"></span><span>
</span><span id="line-1545"></span><span>
</span><span id="line-1546"></span><span class="annot"><a href="GHC.Driver.Main.html#hscInteractive"><span class="hs-identifier hs-type">hscInteractive</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-1547"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#CgGuts"><span class="hs-identifier hs-type">CgGuts</span></a></span><span>
</span><span id="line-1548"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Location.html#ModLocation"><span class="hs-identifier hs-type">ModLocation</span></a></span><span>
</span><span id="line-1549"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../base/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.ByteCode.Types.html#CompiledByteCode"><span class="hs-identifier hs-type">CompiledByteCode</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Runtime.Linker.Types.html#SptEntry"><span class="hs-identifier hs-type">SptEntry</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1550"></span><span id="hscInteractive"><span class="annot"><span class="annottext">hscInteractive :: HscEnv
-&gt; CgGuts
-&gt; ModLocation
-&gt; IO (Maybe String, CompiledByteCode, [SptEntry])
</span><a href="GHC.Driver.Main.html#hscInteractive"><span class="hs-identifier hs-var hs-var">hscInteractive</span></a></span></span><span> </span><span id="local-6989586621681072053"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072053"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681072052"><span class="annot"><span class="annottext">CgGuts
</span><a href="#local-6989586621681072052"><span class="hs-identifier hs-var">cgguts</span></a></span></span><span> </span><span id="local-6989586621681072051"><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681072051"><span class="hs-identifier hs-var">location</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1551"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681072050"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621681072050"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072053"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-1552"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#CgGuts"><span class="hs-identifier hs-type">CgGuts</span></a></span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- This is the last use of the ModGuts in a compilation.</span><span>
</span><span id="line-1553"></span><span>                </span><span class="hs-comment">-- From now on, we just use the bits we need.</span><span>
</span><span id="line-1554"></span><span>               </span><span class="annot"><span class="annottext">cg_module :: CgGuts -&gt; Module
</span><a href="GHC.Driver.Types.html#cg_module"><span class="hs-identifier hs-var">cg_module</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681072049"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681072049"><span class="hs-identifier hs-var">this_mod</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-1555"></span><span>               </span><span class="annot"><span class="annottext">cg_binds :: CgGuts -&gt; CoreProgram
</span><a href="GHC.Driver.Types.html#cg_binds"><span class="hs-identifier hs-var">cg_binds</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681072048"><span class="annot"><span class="annottext">CoreProgram
</span><a href="#local-6989586621681072048"><span class="hs-identifier hs-var">core_binds</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-1556"></span><span>               </span><span class="annot"><span class="annottext">cg_tycons :: CgGuts -&gt; [TyCon]
</span><a href="GHC.Driver.Types.html#cg_tycons"><span class="hs-identifier hs-var">cg_tycons</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681072047"><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681072047"><span class="hs-identifier hs-var">tycons</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-1557"></span><span>               </span><span class="annot"><span class="annottext">cg_foreign :: CgGuts -&gt; ForeignStubs
</span><a href="GHC.Driver.Types.html#cg_foreign"><span class="hs-identifier hs-var">cg_foreign</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681072046"><span class="annot"><span class="annottext">ForeignStubs
</span><a href="#local-6989586621681072046"><span class="hs-identifier hs-var">foreign_stubs</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-1558"></span><span>               </span><span class="annot"><span class="annottext">cg_modBreaks :: CgGuts -&gt; Maybe ModBreaks
</span><a href="GHC.Driver.Types.html#cg_modBreaks"><span class="hs-identifier hs-var">cg_modBreaks</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681072044"><span class="annot"><span class="annottext">Maybe ModBreaks
</span><a href="#local-6989586621681072044"><span class="hs-identifier hs-var">mod_breaks</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-1559"></span><span>               </span><span class="annot"><span class="annottext">cg_spt_entries :: CgGuts -&gt; [SptEntry]
</span><a href="GHC.Driver.Types.html#cg_spt_entries"><span class="hs-identifier hs-var">cg_spt_entries</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681072042"><span class="annot"><span class="annottext">[SptEntry]
</span><a href="#local-6989586621681072042"><span class="hs-identifier hs-var">spt_entries</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CgGuts
</span><a href="#local-6989586621681072052"><span class="hs-identifier hs-var">cgguts</span></a></span><span>
</span><span id="line-1560"></span><span>
</span><span id="line-1561"></span><span>        </span><span id="local-6989586621681072041"><span class="annot"><span class="annottext">data_tycons :: [TyCon]
</span><a href="#local-6989586621681072041"><span class="hs-identifier hs-var hs-var">data_tycons</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TyCon -&gt; IsSafeImport) -&gt; [TyCon] -&gt; [TyCon]
forall a. (a -&gt; IsSafeImport) -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; IsSafeImport
</span><a href="GHC.Core.TyCon.html#isDataTyCon"><span class="hs-identifier hs-var">isDataTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681072047"><span class="hs-identifier hs-var">tycons</span></a></span><span>
</span><span id="line-1562"></span><span>        </span><span class="hs-comment">-- cg_tycons includes newtypes, for the benefit of External Core,</span><span>
</span><span id="line-1563"></span><span>        </span><span class="hs-comment">-- but we don't generate any code for newtypes</span><span>
</span><span id="line-1564"></span><span>
</span><span id="line-1565"></span><span>    </span><span class="hs-comment">-------------------</span><span>
</span><span id="line-1566"></span><span>    </span><span class="hs-comment">-- PREPARE FOR CODE GENERATION</span><span>
</span><span id="line-1567"></span><span>    </span><span class="hs-comment">-- Do saturation and convert to A-normal form</span><span>
</span><span id="line-1568"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681072040"><span class="annot"><span class="annottext">CoreProgram
</span><a href="#local-6989586621681072040"><span class="hs-identifier hs-var">prepd_binds</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set CostCentre
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;CorePrep&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1569"></span><span>                   </span><span class="annot"><span class="annottext">HscEnv
-&gt; Module
-&gt; ModLocation
-&gt; CoreProgram
-&gt; [TyCon]
-&gt; IO (CoreProgram, Set CostCentre)
</span><a href="GHC.CoreToStg.Prep.html#corePrepPgm"><span class="hs-identifier hs-var">corePrepPgm</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072053"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681072049"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681072051"><span class="hs-identifier hs-var">location</span></a></span><span> </span><span class="annot"><span class="annottext">CoreProgram
</span><a href="#local-6989586621681072048"><span class="hs-identifier hs-var">core_binds</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681072041"><span class="hs-identifier hs-var">data_tycons</span></a></span><span>
</span><span id="line-1570"></span><span>    </span><span class="hs-comment">-----------------  Generate byte code ------------------</span><span>
</span><span id="line-1571"></span><span>    </span><span id="local-6989586621681072039"><span class="annot"><span class="annottext">CompiledByteCode
</span><a href="#local-6989586621681072039"><span class="hs-identifier hs-var">comp_bc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; Module
-&gt; CoreProgram
-&gt; [TyCon]
-&gt; Maybe ModBreaks
-&gt; IO CompiledByteCode
</span><a href="GHC.CoreToByteCode.html#byteCodeGen"><span class="hs-identifier hs-var">byteCodeGen</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072053"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681072049"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="annot"><span class="annottext">CoreProgram
</span><a href="#local-6989586621681072040"><span class="hs-identifier hs-var">prepd_binds</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681072041"><span class="hs-identifier hs-var">data_tycons</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ModBreaks
</span><a href="#local-6989586621681072044"><span class="hs-identifier hs-var">mod_breaks</span></a></span><span>
</span><span id="line-1572"></span><span>    </span><span class="hs-comment">------------------ Create f-x-dynamic C-side stuff -----</span><span>
</span><span id="line-1573"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681072038"><span class="annot"><span class="annottext">IsSafeImport
</span><a href="#local-6989586621681072038"><span class="hs-identifier hs-var">_istub_h_exists</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681072037"><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621681072037"><span class="hs-identifier hs-var">istub_c_exists</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1574"></span><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags
-&gt; Module
-&gt; ModLocation
-&gt; ForeignStubs
-&gt; IO (IsSafeImport, Maybe String)
</span><a href="GHC.Driver.CodeOutput.html#outputForeignStubs"><span class="hs-identifier hs-var">outputForeignStubs</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072050"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681072049"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681072051"><span class="hs-identifier hs-var">location</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignStubs
</span><a href="#local-6989586621681072046"><span class="hs-identifier hs-var">foreign_stubs</span></a></span><span>
</span><span id="line-1575"></span><span>    </span><span class="annot"><span class="annottext">(Maybe String, CompiledByteCode, [SptEntry])
-&gt; IO (Maybe String, CompiledByteCode, [SptEntry])
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe String
</span><a href="#local-6989586621681072037"><span class="hs-identifier hs-var">istub_c_exists</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CompiledByteCode
</span><a href="#local-6989586621681072039"><span class="hs-identifier hs-var">comp_bc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[SptEntry]
</span><a href="#local-6989586621681072042"><span class="hs-identifier hs-var">spt_entries</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1576"></span><span>
</span><span id="line-1577"></span><span class="hs-comment">------------------------------</span><span>
</span><span id="line-1578"></span><span>
</span><span id="line-1579"></span><span class="annot"><a href="GHC.Driver.Main.html#hscCompileCmmFile"><span class="hs-identifier hs-type">hscCompileCmmFile</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1580"></span><span id="hscCompileCmmFile"><span class="annot"><span class="annottext">hscCompileCmmFile :: HscEnv -&gt; String -&gt; String -&gt; IO ()
</span><a href="GHC.Driver.Main.html#hscCompileCmmFile"><span class="hs-identifier hs-var hs-var">hscCompileCmmFile</span></a></span></span><span> </span><span id="local-6989586621681072035"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072035"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681072034"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681072034"><span class="hs-identifier hs-var">filename</span></a></span></span><span> </span><span id="local-6989586621681072033"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681072033"><span class="hs-identifier hs-var">output_filename</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Hsc () -&gt; IO ()
forall a. HscEnv -&gt; Hsc a -&gt; IO a
</span><a href="GHC.Driver.Types.html#runHsc"><span class="hs-identifier hs-var">runHsc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072035"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(Hsc () -&gt; IO ()) -&gt; Hsc () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1581"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681072032"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621681072032"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072035"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-1582"></span><span>    </span><span id="local-6989586621681072031"><span class="annot"><span class="annottext">CmmGroup
</span><a href="#local-6989586621681072031"><span class="hs-identifier hs-var">cmm</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ((WarningMessages, WarningMessages), Maybe CmmGroup)
-&gt; Hsc CmmGroup
forall a. IO ((WarningMessages, WarningMessages), Maybe a) -&gt; Hsc a
</span><a href="GHC.Driver.Main.html#ioMsgMaybe"><span class="hs-identifier hs-var">ioMsgMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ((WarningMessages, WarningMessages), Maybe CmmGroup)
 -&gt; Hsc CmmGroup)
-&gt; IO ((WarningMessages, WarningMessages), Maybe CmmGroup)
-&gt; Hsc CmmGroup
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
-&gt; String
-&gt; IO ((WarningMessages, WarningMessages), Maybe CmmGroup)
</span><a href="GHC.Cmm.Parser.html#parseCmmFile"><span class="hs-identifier hs-var">parseCmmFile</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072032"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681072034"><span class="hs-identifier hs-var">filename</span></a></span><span>
</span><span id="line-1583"></span><span>    </span><span class="annot"><span class="annottext">IO () -&gt; Hsc ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; Hsc ()) -&gt; IO () -&gt; Hsc ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1584"></span><span>        </span><span class="annot"><span class="annottext">DynFlags -&gt; DumpFlag -&gt; String -&gt; DumpFormat -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#dumpIfSet_dyn"><span class="hs-identifier hs-var">dumpIfSet_dyn</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072032"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_cmm_verbose_by_proc"><span class="hs-identifier hs-var">Opt_D_dump_cmm_verbose_by_proc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Parsed Cmm&quot;</span></span><span> </span><span class="annot"><span class="annottext">DumpFormat
</span><a href="GHC.Utils.Error.html#FormatCMM"><span class="hs-identifier hs-var">FormatCMM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmGroup -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CmmGroup
</span><a href="#local-6989586621681072031"><span class="hs-identifier hs-var">cmm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1585"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- Make up a module name to give the NCG. We can't pass bottom here</span><span>
</span><span id="line-1586"></span><span>            </span><span class="hs-comment">-- lest we reproduce #11784.</span><span>
</span><span id="line-1587"></span><span>            </span><span id="local-6989586621681072029"><span class="annot"><span class="annottext">mod_name :: ModuleName
</span><a href="#local-6989586621681072029"><span class="hs-identifier hs-var hs-var">mod_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; ModuleName
</span><a href="GHC.Unit.Module.Name.html#mkModuleName"><span class="hs-identifier hs-var">mkModuleName</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ModuleName) -&gt; String -&gt; ModuleName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Cmm$&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String
</span><a href="../../filepath/src/System.FilePath.Windows.html#takeFileName"><span class="hs-identifier hs-var">FilePath.takeFileName</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681072034"><span class="hs-identifier hs-var">filename</span></a></span><span>
</span><span id="line-1588"></span><span>            </span><span id="local-6989586621681072026"><span class="annot"><span class="annottext">cmm_mod :: Module
</span><a href="#local-6989586621681072026"><span class="hs-identifier hs-var hs-var">cmm_mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; ModuleName -&gt; Module
</span><a href="GHC.Driver.Session.html#mkHomeModule"><span class="hs-identifier hs-var">mkHomeModule</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072032"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681072029"><span class="hs-identifier hs-var">mod_name</span></a></span><span>
</span><span id="line-1589"></span><span>
</span><span id="line-1590"></span><span>        </span><span class="hs-comment">-- Compile decls in Cmm files one decl at a time, to avoid re-ordering</span><span>
</span><span id="line-1591"></span><span>        </span><span class="hs-comment">-- them in SRT analysis.</span><span>
</span><span id="line-1592"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-1593"></span><span>        </span><span class="hs-comment">-- Re-ordering here causes breakage when booting with C backend because</span><span>
</span><span id="line-1594"></span><span>        </span><span class="hs-comment">-- in C we must declare before use, but SRT algorithm is free to</span><span>
</span><span id="line-1595"></span><span>        </span><span class="hs-comment">-- re-order [A, B] (B refers to A) when A is not CAFFY and return [B, A]</span><span>
</span><span id="line-1596"></span><span>        </span><span id="local-6989586621681072025"><span class="annot"><span class="annottext">CmmGroupSRTs
</span><a href="#local-6989586621681072025"><span class="hs-identifier hs-var">cmmgroup</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1597"></span><span>          </span><span class="annot"><span class="annottext">(GenCmmDecl CmmStatics CmmTopInfo CmmGraph -&gt; IO CmmGroupSRTs)
-&gt; CmmGroup -&gt; IO CmmGroupSRTs
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m [b]) -&gt; [a] -&gt; m [b]
</span><a href="GHC.Utils.Monad.html#concatMapM"><span class="hs-identifier hs-var">concatMapM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681072023"><span class="annot"><span class="annottext">GenCmmDecl CmmStatics CmmTopInfo CmmGraph
</span><a href="#local-6989586621681072023"><span class="hs-identifier hs-var">cmm</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(ModuleSRTInfo, CmmGroupSRTs) -&gt; CmmGroupSRTs
forall a b. (a, b) -&gt; b
</span><a href="../../base/src/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">((ModuleSRTInfo, CmmGroupSRTs) -&gt; CmmGroupSRTs)
-&gt; IO (ModuleSRTInfo, CmmGroupSRTs) -&gt; IO CmmGroupSRTs
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; ModuleSRTInfo -&gt; CmmGroup -&gt; IO (ModuleSRTInfo, CmmGroupSRTs)
</span><a href="GHC.Cmm.Pipeline.html#cmmPipeline"><span class="hs-identifier hs-var">cmmPipeline</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072035"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; ModuleSRTInfo
</span><a href="GHC.Cmm.Info.Build.html#emptySRT"><span class="hs-identifier hs-var">emptySRT</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681072026"><span class="hs-identifier hs-var">cmm_mod</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">GenCmmDecl CmmStatics CmmTopInfo CmmGraph
</span><a href="#local-6989586621681072023"><span class="hs-identifier hs-var">cmm</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CmmGroup
</span><a href="#local-6989586621681072031"><span class="hs-identifier hs-var">cmm</span></a></span><span>
</span><span id="line-1598"></span><span>
</span><span id="line-1599"></span><span>        </span><span class="annot"><span class="annottext">IsSafeImport -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; IsSafeImport -&gt; f () -&gt; f ()
</span><a href="../../base/src/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmGroupSRTs -&gt; IsSafeImport
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; IsSafeImport
</span><a href="../../base/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">CmmGroupSRTs
</span><a href="#local-6989586621681072025"><span class="hs-identifier hs-var">cmmgroup</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1600"></span><span>          </span><span class="annot"><span class="annottext">DynFlags -&gt; DumpFlag -&gt; String -&gt; DumpFormat -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#dumpIfSet_dyn"><span class="hs-identifier hs-var">dumpIfSet_dyn</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072032"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_cmm"><span class="hs-identifier hs-var">Opt_D_dump_cmm</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Output Cmm&quot;</span></span><span>
</span><span id="line-1601"></span><span>            </span><span class="annot"><span class="annottext">DumpFormat
</span><a href="GHC.Utils.Error.html#FormatCMM"><span class="hs-identifier hs-var">FormatCMM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmGroupSRTs -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CmmGroupSRTs
</span><a href="#local-6989586621681072025"><span class="hs-identifier hs-var">cmmgroup</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1602"></span><span>        </span><span id="local-6989586621681072019"><span class="annot"><span class="annottext">Stream IO RawCmmGroup ()
</span><a href="#local-6989586621681072019"><span class="hs-identifier hs-var">rawCmms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Hooks
 -&gt; Maybe
      (DynFlags
       -&gt; Maybe Module
       -&gt; Stream IO CmmGroupSRTs ()
       -&gt; IO (Stream IO RawCmmGroup ())))
-&gt; (DynFlags
    -&gt; Maybe Module
    -&gt; Stream IO CmmGroupSRTs ()
    -&gt; IO (Stream IO RawCmmGroup ()))
-&gt; DynFlags
-&gt; DynFlags
-&gt; Maybe Module
-&gt; Stream IO CmmGroupSRTs ()
-&gt; IO (Stream IO RawCmmGroup ())
forall a. (Hooks -&gt; Maybe a) -&gt; a -&gt; DynFlags -&gt; a
</span><a href="GHC.Driver.Hooks.html#lookupHook"><span class="hs-identifier hs-var">lookupHook</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681072018"><span class="annot"><span class="annottext">Hooks
</span><a href="#local-6989586621681072018"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Hooks
-&gt; forall a.
   Maybe
     (DynFlags
      -&gt; Maybe Module
      -&gt; Stream IO CmmGroupSRTs a
      -&gt; IO (Stream IO RawCmmGroup a))
</span><a href="GHC.Driver.Hooks.html#cmmToRawCmmHook"><span class="hs-identifier hs-var hs-var">cmmToRawCmmHook</span></a></span><span> </span><span class="annot"><span class="annottext">Hooks
</span><a href="#local-6989586621681072018"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1603"></span><span>                     </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681072017"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072017"><span class="hs-identifier hs-var">dflgs</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe Module
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DynFlags
-&gt; Stream IO CmmGroupSRTs () -&gt; IO (Stream IO RawCmmGroup ())
forall a.
DynFlags
-&gt; Stream IO CmmGroupSRTs a -&gt; IO (Stream IO RawCmmGroup a)
</span><a href="GHC.Cmm.Info.html#cmmToRawCmm"><span class="hs-identifier hs-var">cmmToRawCmm</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072017"><span class="hs-identifier hs-var">dflgs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072032"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072032"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Module
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CmmGroupSRTs -&gt; Stream IO CmmGroupSRTs ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; Stream m a ()
</span><a href="GHC.Data.Stream.html#yield"><span class="hs-identifier hs-var">Stream.yield</span></a></span><span> </span><span class="annot"><span class="annottext">CmmGroupSRTs
</span><a href="#local-6989586621681072025"><span class="hs-identifier hs-var">cmmgroup</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1604"></span><span>        </span><span class="annot"><span class="annottext">(String, (IsSafeImport, Maybe String), [(ForeignSrcLang, String)],
 ())
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags
-&gt; Module
-&gt; String
-&gt; ModLocation
-&gt; ForeignStubs
-&gt; [(ForeignSrcLang, String)]
-&gt; [UnitId]
-&gt; Stream IO RawCmmGroup ()
-&gt; IO
     (String, (IsSafeImport, Maybe String), [(ForeignSrcLang, String)],
      ())
forall a.
DynFlags
-&gt; Module
-&gt; String
-&gt; ModLocation
-&gt; ForeignStubs
-&gt; [(ForeignSrcLang, String)]
-&gt; [UnitId]
-&gt; Stream IO RawCmmGroup a
-&gt; IO
     (String, (IsSafeImport, Maybe String), [(ForeignSrcLang, String)],
      a)
</span><a href="GHC.Driver.CodeOutput.html#codeOutput"><span class="hs-identifier hs-var">codeOutput</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072032"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681072026"><span class="hs-identifier hs-var">cmm_mod</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681072033"><span class="hs-identifier hs-var">output_filename</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681072015"><span class="hs-identifier hs-var">no_loc</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignStubs
</span><a href="GHC.Driver.Types.html#NoStubs"><span class="hs-identifier hs-var">NoStubs</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1605"></span><span>             </span><span class="annot"><span class="annottext">Stream IO RawCmmGroup ()
</span><a href="#local-6989586621681072019"><span class="hs-identifier hs-var">rawCmms</span></a></span><span>
</span><span id="line-1606"></span><span>        </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1607"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1608"></span><span>    </span><span id="local-6989586621681072015"><span class="annot"><span class="annottext">no_loc :: ModLocation
</span><a href="#local-6989586621681072015"><span class="hs-identifier hs-var hs-var">no_loc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModLocation :: Maybe String -&gt; String -&gt; String -&gt; String -&gt; ModLocation
</span><a href="GHC.Unit.Module.Location.html#ModLocation"><span class="hs-identifier hs-type">ModLocation</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ml_hs_file :: Maybe String
</span><a href="GHC.Unit.Module.Location.html#ml_hs_file"><span class="hs-identifier hs-var">ml_hs_file</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Maybe String
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681072034"><span class="hs-identifier hs-var">filename</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1609"></span><span>                          </span><span class="annot"><span class="annottext">ml_hi_file :: String
</span><a href="GHC.Unit.Module.Location.html#ml_hi_file"><span class="hs-identifier hs-var">ml_hi_file</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String
forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;hscCompileCmmFile: no hi file&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-1610"></span><span>                          </span><span class="annot"><span class="annottext">ml_obj_file :: String
</span><a href="GHC.Unit.Module.Location.html#ml_obj_file"><span class="hs-identifier hs-var">ml_obj_file</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String
forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;hscCompileCmmFile: no obj file&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-1611"></span><span>                          </span><span class="annot"><span class="annottext">ml_hie_file :: String
</span><a href="GHC.Unit.Module.Location.html#ml_hie_file"><span class="hs-identifier hs-var">ml_hie_file</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String
forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;hscCompileCmmFile: no hie file&quot;</span></span><span class="hs-special">}</span><span>
</span><span id="line-1612"></span><span>
</span><span id="line-1613"></span><span class="hs-comment">-------------------- Stuff for new code gen ---------------------</span><span>
</span><span id="line-1614"></span><span>
</span><span id="line-1615"></span><span class="hs-comment">{-
Note [Forcing of stg_binds]
~~~~~~~~~~~~~~~~~~~~~~~~~~~

The two last steps in the STG pipeline are:

* Sorting the bindings in dependency order.
* Annotating them with free variables.

We want to make sure we do not keep references to unannotated STG bindings
alive, nor references to bindings which have already been compiled to Cmm.

We explicitly force the bindings to avoid this.

This reduces residency towards the end of the CodeGen phase significantly
(5-10%).
-}</span><span>
</span><span id="line-1632"></span><span>
</span><span id="line-1633"></span><span class="annot"><a href="GHC.Driver.Main.html#doCodeGen"><span class="hs-identifier hs-type">doCodeGen</span></a></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1634"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.CostCentre.html#CollectedCCs"><span class="hs-identifier hs-type">CollectedCCs</span></a></span><span>
</span><span id="line-1635"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgTopBinding"><span class="hs-identifier hs-type">StgTopBinding</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1636"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HpcInfo"><span class="hs-identifier hs-type">HpcInfo</span></a></span><span>
</span><span id="line-1637"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Stream.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmGroupSRTs"><span class="hs-identifier hs-type">CmmGroupSRTs</span></a></span><span> </span><span class="annot"><a href="GHC.StgToCmm.Types.html#CgInfos"><span class="hs-identifier hs-type">CgInfos</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1638"></span><span>         </span><span class="hs-comment">-- Note we produce a 'Stream' of CmmGroups, so that the</span><span>
</span><span id="line-1639"></span><span>         </span><span class="hs-comment">-- backend can be run incrementally.  Otherwise it generates all</span><span>
</span><span id="line-1640"></span><span>         </span><span class="hs-comment">-- the C-- up front, which has a significant space cost.</span><span>
</span><span id="line-1641"></span><span id="doCodeGen"><span class="annot"><span class="annottext">doCodeGen :: HscEnv
-&gt; Module
-&gt; [TyCon]
-&gt; CollectedCCs
-&gt; [StgTopBinding]
-&gt; HpcInfo
-&gt; IO (Stream IO CmmGroupSRTs CgInfos)
</span><a href="GHC.Driver.Main.html#doCodeGen"><span class="hs-identifier hs-var hs-var">doCodeGen</span></a></span></span><span> </span><span id="local-6989586621681072011"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072011"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681072010"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681072010"><span class="hs-identifier hs-var">this_mod</span></a></span></span><span> </span><span id="local-6989586621681072009"><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681072009"><span class="hs-identifier hs-var">data_tycons</span></a></span></span><span>
</span><span id="line-1642"></span><span>              </span><span id="local-6989586621681072008"><span class="annot"><span class="annottext">CollectedCCs
</span><a href="#local-6989586621681072008"><span class="hs-identifier hs-var">cost_centre_info</span></a></span></span><span> </span><span id="local-6989586621681072007"><span class="annot"><span class="annottext">[StgTopBinding]
</span><a href="#local-6989586621681072007"><span class="hs-identifier hs-var">stg_binds</span></a></span></span><span> </span><span id="local-6989586621681072006"><span class="annot"><span class="annottext">HpcInfo
</span><a href="#local-6989586621681072006"><span class="hs-identifier hs-var">hpc_info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1643"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681072005"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621681072005"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072011"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-1644"></span><span>
</span><span id="line-1645"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681072004"><span class="annot"><span class="annottext">stg_binds_w_fvs :: [CgStgTopBinding]
</span><a href="#local-6989586621681072004"><span class="hs-identifier hs-var hs-var">stg_binds_w_fvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[StgTopBinding] -&gt; [CgStgTopBinding]
</span><a href="GHC.Stg.FVs.html#annTopBindingsFreeVars"><span class="hs-identifier hs-var">annTopBindingsFreeVars</span></a></span><span> </span><span class="annot"><span class="annottext">[StgTopBinding]
</span><a href="#local-6989586621681072007"><span class="hs-identifier hs-var">stg_binds</span></a></span><span>
</span><span id="line-1646"></span><span>
</span><span id="line-1647"></span><span>    </span><span class="annot"><span class="annottext">DynFlags -&gt; DumpFlag -&gt; String -&gt; DumpFormat -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#dumpIfSet_dyn"><span class="hs-identifier hs-var">dumpIfSet_dyn</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072005"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_stg_final"><span class="hs-identifier hs-var">Opt_D_dump_stg_final</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Final STG:&quot;</span></span><span> </span><span class="annot"><span class="annottext">DumpFormat
</span><a href="GHC.Utils.Error.html#FormatSTG"><span class="hs-identifier hs-var">FormatSTG</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">StgPprOpts -&gt; [CgStgTopBinding] -&gt; SDoc
forall (pass :: StgPass).
OutputablePass pass =&gt;
StgPprOpts -&gt; [GenStgTopBinding pass] -&gt; SDoc
</span><a href="GHC.Stg.Syntax.html#pprGenStgTopBindings"><span class="hs-identifier hs-var">pprGenStgTopBindings</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; StgPprOpts
</span><a href="GHC.Stg.Syntax.html#initStgPprOpts"><span class="hs-identifier hs-var">initStgPprOpts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072005"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[CgStgTopBinding]
</span><a href="#local-6989586621681072004"><span class="hs-identifier hs-var">stg_binds_w_fvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1648"></span><span>
</span><span id="line-1649"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621681071999"><span class="hs-identifier hs-type">cmm_stream</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.Stream.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmGroup"><span class="hs-identifier hs-type">CmmGroup</span></a></span><span> </span><span class="annot"><a href="GHC.StgToCmm.Types.html#ModuleLFInfos"><span class="hs-identifier hs-type">ModuleLFInfos</span></a></span><span>
</span><span id="line-1650"></span><span>        </span><span class="hs-comment">-- See Note [Forcing of stg_binds]</span><span>
</span><span id="line-1651"></span><span>        </span><span id="local-6989586621681071999"><span class="annot"><span class="annottext">cmm_stream :: Stream IO CmmGroup ModuleLFInfos
</span><a href="#local-6989586621681071999"><span class="hs-identifier hs-var hs-var">cmm_stream</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[CgStgTopBinding]
</span><a href="#local-6989586621681072004"><span class="hs-identifier hs-var">stg_binds_w_fvs</span></a></span><span> </span><span class="annot"><span class="annottext">[CgStgTopBinding]
-&gt; Stream IO CmmGroup ModuleLFInfos
-&gt; Stream IO CmmGroup ModuleLFInfos
forall a b. [a] -&gt; b -&gt; b
</span><a href="GHC.Utils.Misc.html#seqList"><span class="hs-operator hs-var">`seqList`</span></a></span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;StgToCmm&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1652"></span><span>            </span><span class="annot"><span class="annottext">(Hooks
 -&gt; Maybe
      (DynFlags
       -&gt; Module
       -&gt; [TyCon]
       -&gt; CollectedCCs
       -&gt; [CgStgTopBinding]
       -&gt; HpcInfo
       -&gt; Stream IO CmmGroup ModuleLFInfos))
-&gt; (DynFlags
    -&gt; Module
    -&gt; [TyCon]
    -&gt; CollectedCCs
    -&gt; [CgStgTopBinding]
    -&gt; HpcInfo
    -&gt; Stream IO CmmGroup ModuleLFInfos)
-&gt; DynFlags
-&gt; DynFlags
-&gt; Module
-&gt; [TyCon]
-&gt; CollectedCCs
-&gt; [CgStgTopBinding]
-&gt; HpcInfo
-&gt; Stream IO CmmGroup ModuleLFInfos
forall a. (Hooks -&gt; Maybe a) -&gt; a -&gt; DynFlags -&gt; a
</span><a href="GHC.Driver.Hooks.html#lookupHook"><span class="hs-identifier hs-var">lookupHook</span></a></span><span> </span><span class="annot"><span class="annottext">Hooks
-&gt; Maybe
     (DynFlags
      -&gt; Module
      -&gt; [TyCon]
      -&gt; CollectedCCs
      -&gt; [CgStgTopBinding]
      -&gt; HpcInfo
      -&gt; Stream IO CmmGroup ModuleLFInfos)
</span><a href="GHC.Driver.Hooks.html#stgToCmmHook"><span class="hs-identifier hs-var hs-var">stgToCmmHook</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
-&gt; Module
-&gt; [TyCon]
-&gt; CollectedCCs
-&gt; [CgStgTopBinding]
-&gt; HpcInfo
-&gt; Stream IO CmmGroup ModuleLFInfos
</span><a href="GHC.StgToCmm.html#codeGen"><span class="hs-identifier hs-var">StgToCmm.codeGen</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072005"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072005"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681072010"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681072009"><span class="hs-identifier hs-var">data_tycons</span></a></span><span>
</span><span id="line-1653"></span><span>                           </span><span class="annot"><span class="annottext">CollectedCCs
</span><a href="#local-6989586621681072008"><span class="hs-identifier hs-var">cost_centre_info</span></a></span><span> </span><span class="annot"><span class="annottext">[CgStgTopBinding]
</span><a href="#local-6989586621681072004"><span class="hs-identifier hs-var">stg_binds_w_fvs</span></a></span><span> </span><span class="annot"><span class="annottext">HpcInfo
</span><a href="#local-6989586621681072006"><span class="hs-identifier hs-var">hpc_info</span></a></span><span>
</span><span id="line-1654"></span><span>
</span><span id="line-1655"></span><span>        </span><span class="hs-comment">-- codegen consumes a stream of CmmGroup, and produces a new</span><span>
</span><span id="line-1656"></span><span>        </span><span class="hs-comment">-- stream of CmmGroup (not necessarily synchronised: one</span><span>
</span><span id="line-1657"></span><span>        </span><span class="hs-comment">-- CmmGroup on input may produce many CmmGroups on output due</span><span>
</span><span id="line-1658"></span><span>        </span><span class="hs-comment">-- to proc-point splitting).</span><span>
</span><span id="line-1659"></span><span>
</span><span id="line-1660"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681071989"><span class="annot"><span class="annottext">dump1 :: t a -&gt; IO (t a)
</span><a href="#local-6989586621681071989"><span class="hs-identifier hs-var hs-var">dump1</span></a></span></span><span> </span><span id="local-6989586621681071988"><span class="annot"><span class="annottext">t a
</span><a href="#local-6989586621681071988"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1661"></span><span>          </span><span class="annot"><span class="annottext">IsSafeImport -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; IsSafeImport -&gt; f () -&gt; f ()
</span><a href="../../base/src/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t a -&gt; IsSafeImport
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; IsSafeImport
</span><a href="../../base/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">t a
</span><a href="#local-6989586621681071988"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1662"></span><span>            </span><span class="annot"><span class="annottext">DynFlags -&gt; DumpFlag -&gt; String -&gt; DumpFormat -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#dumpIfSet_dyn"><span class="hs-identifier hs-var">dumpIfSet_dyn</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072005"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_cmm_from_stg"><span class="hs-identifier hs-var">Opt_D_dump_cmm_from_stg</span></a></span><span>
</span><span id="line-1663"></span><span>              </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Cmm produced by codegen&quot;</span></span><span> </span><span class="annot"><span class="annottext">DumpFormat
</span><a href="GHC.Utils.Error.html#FormatCMM"><span class="hs-identifier hs-var">FormatCMM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t a -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">t a
</span><a href="#local-6989586621681071988"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1664"></span><span>          </span><span class="annot"><span class="annottext">t a -&gt; IO (t a)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">t a
</span><a href="#local-6989586621681071988"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-1665"></span><span>
</span><span id="line-1666"></span><span>        </span><span id="local-6989586621681071979"><span class="annot"><span class="annottext">ppr_stream1 :: Stream IO CmmGroup ModuleLFInfos
</span><a href="#local-6989586621681071979"><span class="hs-identifier hs-var hs-var">ppr_stream1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CmmGroup -&gt; IO CmmGroup)
-&gt; Stream IO CmmGroup ModuleLFInfos
-&gt; Stream IO CmmGroup ModuleLFInfos
forall (m :: * -&gt; *) a b x.
Monad m =&gt;
(a -&gt; m b) -&gt; Stream m a x -&gt; Stream m b x
</span><a href="GHC.Data.Stream.html#mapM"><span class="hs-identifier hs-var">Stream.mapM</span></a></span><span> </span><span class="annot"><span class="annottext">CmmGroup -&gt; IO CmmGroup
forall {t :: * -&gt; *} {a}.
(Foldable t, Outputable (t a)) =&gt;
t a -&gt; IO (t a)
</span><a href="#local-6989586621681071989"><span class="hs-identifier hs-var">dump1</span></a></span><span> </span><span class="annot"><span class="annottext">Stream IO CmmGroup ModuleLFInfos
</span><a href="#local-6989586621681071999"><span class="hs-identifier hs-var">cmm_stream</span></a></span><span>
</span><span id="line-1667"></span><span>
</span><span id="line-1668"></span><span>        </span><span class="annot"><a href="#local-6989586621681071978"><span class="hs-identifier hs-type">pipeline_stream</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.Stream.html#Stream"><span class="hs-identifier hs-type">Stream</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Cmm.html#CmmGroupSRTs"><span class="hs-identifier hs-type">CmmGroupSRTs</span></a></span><span> </span><span class="annot"><a href="GHC.StgToCmm.Types.html#CgInfos"><span class="hs-identifier hs-type">CgInfos</span></a></span><span>
</span><span id="line-1669"></span><span>        </span><span id="local-6989586621681071978"><span class="annot"><span class="annottext">pipeline_stream :: Stream IO CmmGroupSRTs CgInfos
</span><a href="#local-6989586621681071978"><span class="hs-identifier hs-var hs-var">pipeline_stream</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1670"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621681071977"><span class="annot"><span class="annottext">NonCaffySet
</span><a href="#local-6989586621681071977"><span class="hs-identifier hs-var">non_cafs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681071976"><span class="annot"><span class="annottext">ModuleLFInfos
</span><a href="#local-6989586621681071976"><span class="hs-identifier hs-var">lf_infos</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1671"></span><span>            </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;cmmPipeline&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1672"></span><span>            </span><span class="annot"><span class="annottext">(ModuleSRTInfo -&gt; CmmGroup -&gt; IO (ModuleSRTInfo, CmmGroupSRTs))
-&gt; ModuleSRTInfo
-&gt; Stream IO CmmGroup ModuleLFInfos
-&gt; Stream IO CmmGroupSRTs (ModuleSRTInfo, ModuleLFInfos)
forall (m :: * -&gt; *) c a b r.
Monad m =&gt;
(c -&gt; a -&gt; m (c, b)) -&gt; c -&gt; Stream m a r -&gt; Stream m b (c, r)
</span><a href="GHC.Data.Stream.html#mapAccumL_"><span class="hs-identifier hs-var">Stream.mapAccumL_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv
-&gt; ModuleSRTInfo -&gt; CmmGroup -&gt; IO (ModuleSRTInfo, CmmGroupSRTs)
</span><a href="GHC.Cmm.Pipeline.html#cmmPipeline"><span class="hs-identifier hs-var">cmmPipeline</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681072011"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; ModuleSRTInfo
</span><a href="GHC.Cmm.Info.Build.html#emptySRT"><span class="hs-identifier hs-var">emptySRT</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681072010"><span class="hs-identifier hs-var">this_mod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Stream IO CmmGroup ModuleLFInfos
</span><a href="#local-6989586621681071979"><span class="hs-identifier hs-var">ppr_stream1</span></a></span><span>
</span><span id="line-1673"></span><span>              </span><span class="annot"><span class="annottext">Stream IO CmmGroupSRTs (ModuleSRTInfo, ModuleLFInfos)
-&gt; ((ModuleSRTInfo, ModuleLFInfos) -&gt; (NonCaffySet, ModuleLFInfos))
-&gt; Stream IO CmmGroupSRTs (NonCaffySet, ModuleLFInfos)
forall (f :: * -&gt; *) a b. Functor f =&gt; f a -&gt; (a -&gt; b) -&gt; f b
</span><a href="../../base/src/Data.Functor.html#%3C%26%3E"><span class="hs-operator hs-var">&lt;&amp;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(ModuleSRTInfo -&gt; NonCaffySet)
-&gt; (ModuleSRTInfo, ModuleLFInfos) -&gt; (NonCaffySet, ModuleLFInfos)
forall (p :: * -&gt; * -&gt; *) a b c.
Bifunctor p =&gt;
(a -&gt; b) -&gt; p a c -&gt; p b c
</span><a href="../../base/src/Data.Bifunctor.html#first"><span class="hs-identifier hs-var">first</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SRTMap -&gt; NonCaffySet
</span><a href="GHC.Cmm.Info.Build.html#srtMapNonCAFs"><span class="hs-identifier hs-var">srtMapNonCAFs</span></a></span><span> </span><span class="annot"><span class="annottext">(SRTMap -&gt; NonCaffySet)
-&gt; (ModuleSRTInfo -&gt; SRTMap) -&gt; ModuleSRTInfo -&gt; NonCaffySet
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleSRTInfo -&gt; SRTMap
</span><a href="GHC.Cmm.Info.Build.html#moduleSRTMap"><span class="hs-identifier hs-var hs-var">moduleSRTMap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1674"></span><span>
</span><span id="line-1675"></span><span>          </span><span class="annot"><span class="annottext">CgInfos -&gt; Stream IO CmmGroupSRTs CgInfos
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">CgInfos :: NonCaffySet -&gt; ModuleLFInfos -&gt; CgInfos
</span><a href="GHC.StgToCmm.Types.html#CgInfos"><span class="hs-identifier hs-type">CgInfos</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cgNonCafs :: NonCaffySet
</span><a href="GHC.StgToCmm.Types.html#cgNonCafs"><span class="hs-identifier hs-var">cgNonCafs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NonCaffySet
</span><a href="#local-6989586621681071977"><span class="hs-identifier hs-var">non_cafs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cgLFInfos :: ModuleLFInfos
</span><a href="GHC.StgToCmm.Types.html#cgLFInfos"><span class="hs-identifier hs-var">cgLFInfos</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleLFInfos
</span><a href="#local-6989586621681071976"><span class="hs-identifier hs-var">lf_infos</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1676"></span><span>
</span><span id="line-1677"></span><span>        </span><span id="local-6989586621681071961"><span class="annot"><span class="annottext">dump2 :: t a -&gt; IO (t a)
</span><a href="#local-6989586621681071961"><span class="hs-identifier hs-var hs-var">dump2</span></a></span></span><span> </span><span id="local-6989586621681071960"><span class="annot"><span class="annottext">t a
</span><a href="#local-6989586621681071960"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1678"></span><span>          </span><span class="annot"><span class="annottext">IsSafeImport -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; IsSafeImport -&gt; f () -&gt; f ()
</span><a href="../../base/src/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t a -&gt; IsSafeImport
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; IsSafeImport
</span><a href="../../base/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">t a
</span><a href="#local-6989586621681071960"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1679"></span><span>            </span><span class="annot"><span class="annottext">DynFlags -&gt; DumpFlag -&gt; String -&gt; DumpFormat -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#dumpIfSet_dyn"><span class="hs-identifier hs-var">dumpIfSet_dyn</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681072005"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_cmm"><span class="hs-identifier hs-var">Opt_D_dump_cmm</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Output Cmm&quot;</span></span><span> </span><span class="annot"><span class="annottext">DumpFormat
</span><a href="GHC.Utils.Error.html#FormatCMM"><span class="hs-identifier hs-var">FormatCMM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">t a -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">t a
</span><a href="#local-6989586621681071960"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1680"></span><span>          </span><span class="annot"><span class="annottext">t a -&gt; IO (t a)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">t a
</span><a href="#local-6989586621681071960"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-1681"></span><span>
</span><span id="line-1682"></span><span>    </span><span class="annot"><span class="annottext">Stream IO CmmGroupSRTs CgInfos
-&gt; IO (Stream IO CmmGroupSRTs CgInfos)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(CmmGroupSRTs -&gt; IO CmmGroupSRTs)
-&gt; Stream IO CmmGroupSRTs CgInfos -&gt; Stream IO CmmGroupSRTs CgInfos
forall (m :: * -&gt; *) a b x.
Monad m =&gt;
(a -&gt; m b) -&gt; Stream m a x -&gt; Stream m b x
</span><a href="GHC.Data.Stream.html#mapM"><span class="hs-identifier hs-var">Stream.mapM</span></a></span><span> </span><span class="annot"><span class="annottext">CmmGroupSRTs -&gt; IO CmmGroupSRTs
forall {t :: * -&gt; *} {a}.
(Foldable t, Outputable (t a)) =&gt;
t a -&gt; IO (t a)
</span><a href="#local-6989586621681071961"><span class="hs-identifier hs-var">dump2</span></a></span><span> </span><span class="annot"><span class="annottext">Stream IO CmmGroupSRTs CgInfos
</span><a href="#local-6989586621681071978"><span class="hs-identifier hs-var">pipeline_stream</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1683"></span><span>
</span><span id="line-1684"></span><span class="annot"><a href="GHC.Driver.Main.html#myCoreToStg"><span class="hs-identifier hs-type">myCoreToStg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreProgram"><span class="hs-identifier hs-type">CoreProgram</span></a></span><span>
</span><span id="line-1685"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Stg.Syntax.html#StgTopBinding"><span class="hs-identifier hs-type">StgTopBinding</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- output program</span><span>
</span><span id="line-1686"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.CostCentre.html#CollectedCCs"><span class="hs-identifier hs-type">CollectedCCs</span></a></span><span> </span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- CAF cost centre info (declared and used)</span><span>
</span><span id="line-1687"></span><span id="myCoreToStg"><span class="annot"><span class="annottext">myCoreToStg :: DynFlags
-&gt; Module -&gt; CoreProgram -&gt; IO ([StgTopBinding], CollectedCCs)
</span><a href="GHC.Driver.Main.html#myCoreToStg"><span class="hs-identifier hs-var hs-var">myCoreToStg</span></a></span></span><span> </span><span id="local-6989586621681071959"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681071959"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621681071958"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681071958"><span class="hs-identifier hs-var">this_mod</span></a></span></span><span> </span><span id="local-6989586621681071957"><span class="annot"><span class="annottext">CoreProgram
</span><a href="#local-6989586621681071957"><span class="hs-identifier hs-var">prepd_binds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1688"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681071956"><span class="annot"><span class="annottext">[StgTopBinding]
</span><a href="#local-6989586621681071956"><span class="hs-identifier hs-var">stg_binds</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681071955"><span class="annot"><span class="annottext">CollectedCCs
</span><a href="#local-6989586621681071955"><span class="hs-identifier hs-var">cost_centre_info</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1689"></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;Core2Stg&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1690"></span><span>           </span><span class="annot"><span class="annottext">DynFlags
-&gt; Module -&gt; CoreProgram -&gt; ([StgTopBinding], CollectedCCs)
</span><a href="GHC.CoreToStg.html#coreToStg"><span class="hs-identifier hs-var">coreToStg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681071959"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681071958"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="annot"><span class="annottext">CoreProgram
</span><a href="#local-6989586621681071957"><span class="hs-identifier hs-var">prepd_binds</span></a></span><span>
</span><span id="line-1691"></span><span>
</span><span id="line-1692"></span><span>    </span><span id="local-6989586621681071954"><span class="annot"><span class="annottext">[StgTopBinding]
</span><a href="#local-6989586621681071954"><span class="hs-identifier hs-var">stg_binds2</span></a></span></span><span>
</span><span id="line-1693"></span><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;Stg2Stg&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1694"></span><span>           </span><span class="annot"><span class="annottext">DynFlags -&gt; Module -&gt; [StgTopBinding] -&gt; IO [StgTopBinding]
</span><a href="GHC.Stg.Pipeline.html#stg2stg"><span class="hs-identifier hs-var">stg2stg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681071959"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681071958"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="annot"><span class="annottext">[StgTopBinding]
</span><a href="#local-6989586621681071956"><span class="hs-identifier hs-var">stg_binds</span></a></span><span>
</span><span id="line-1695"></span><span>
</span><span id="line-1696"></span><span>    </span><span class="annot"><span class="annottext">([StgTopBinding], CollectedCCs)
-&gt; IO ([StgTopBinding], CollectedCCs)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[StgTopBinding]
</span><a href="#local-6989586621681071954"><span class="hs-identifier hs-var">stg_binds2</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">CollectedCCs
</span><a href="#local-6989586621681071955"><span class="hs-identifier hs-var">cost_centre_info</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1697"></span><span>
</span><span id="line-1698"></span><span>
</span><span id="line-1699"></span><span class="hs-comment">{- **********************************************************************
%*                                                                      *
\subsection{Compiling a do-statement}
%*                                                                      *
%********************************************************************* -}</span><span>
</span><span id="line-1704"></span><span>
</span><span id="line-1705"></span><span class="hs-comment">{-
When the UnlinkedBCOExpr is linked you get an HValue of type *IO [HValue]* When
you run it you get a list of HValues that should be the same length as the list
of names; add them to the ClosureEnv.

A naked expression returns a singleton Name [it]. The stmt is lifted into the
IO monad as explained in Note [Interactively-bound Ids in GHCi] in GHC.Driver.Types
-}</span><span>
</span><span id="line-1713"></span><span>
</span><span id="line-1714"></span><span class="hs-comment">-- | Compile a stmt all the way to an HValue, but don't run it</span><span>
</span><span id="line-1715"></span><span class="hs-comment">--</span><span>
</span><span id="line-1716"></span><span class="hs-comment">-- We return Nothing to indicate an empty statement (or comment only), not a</span><span>
</span><span id="line-1717"></span><span class="hs-comment">-- parse error.</span><span>
</span><span id="line-1718"></span><span class="annot"><a href="GHC.Driver.Main.html#hscStmt"><span class="hs-identifier hs-type">hscStmt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../ghci/src/GHCi.RemoteTypes.html#ForeignHValue"><span class="hs-identifier hs-type">ForeignHValue</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#FixityEnv"><span class="hs-identifier hs-type">FixityEnv</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1719"></span><span id="hscStmt"><span class="annot"><span class="annottext">hscStmt :: HscEnv -&gt; String -&gt; IO (Maybe ([Id], ForeignHValue, FixityEnv))
</span><a href="GHC.Driver.Main.html#hscStmt"><span class="hs-identifier hs-var hs-var">hscStmt</span></a></span></span><span> </span><span id="local-6989586621681071953"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071953"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681071952"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681071952"><span class="hs-identifier hs-var">stmt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; String
-&gt; String
-&gt; Int
-&gt; IO (Maybe ([Id], ForeignHValue, FixityEnv))
</span><a href="GHC.Driver.Main.html#hscStmtWithLocation"><span class="hs-identifier hs-var">hscStmtWithLocation</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071953"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681071952"><span class="hs-identifier hs-var">stmt</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&lt;interactive&gt;&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-1720"></span><span>
</span><span id="line-1721"></span><span class="hs-comment">-- | Compile a stmt all the way to an HValue, but don't run it</span><span>
</span><span id="line-1722"></span><span class="hs-comment">--</span><span>
</span><span id="line-1723"></span><span class="hs-comment">-- We return Nothing to indicate an empty statement (or comment only), not a</span><span>
</span><span id="line-1724"></span><span class="hs-comment">-- parse error.</span><span>
</span><span id="line-1725"></span><span class="annot"><a href="GHC.Driver.Main.html#hscStmtWithLocation"><span class="hs-identifier hs-type">hscStmtWithLocation</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-1726"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-comment">-- ^ The statement</span><span>
</span><span id="line-1727"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-comment">-- ^ The source</span><span>
</span><span id="line-1728"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>    </span><span class="hs-comment">-- ^ Starting line</span><span>
</span><span id="line-1729"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1730"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../ghci/src/GHCi.RemoteTypes.html#ForeignHValue"><span class="hs-identifier hs-type">ForeignHValue</span></a></span><span> </span><span class="hs-comment">{- IO [HValue] -}</span><span>
</span><span id="line-1731"></span><span>                          </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#FixityEnv"><span class="hs-identifier hs-type">FixityEnv</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1732"></span><span id="hscStmtWithLocation"><span class="annot"><span class="annottext">hscStmtWithLocation :: HscEnv
-&gt; String
-&gt; String
-&gt; Int
-&gt; IO (Maybe ([Id], ForeignHValue, FixityEnv))
</span><a href="GHC.Driver.Main.html#hscStmtWithLocation"><span class="hs-identifier hs-var hs-var">hscStmtWithLocation</span></a></span></span><span> </span><span id="local-6989586621681071951"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071951"><span class="hs-identifier hs-var">hsc_env0</span></a></span></span><span> </span><span id="local-6989586621681071950"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681071950"><span class="hs-identifier hs-var">stmt</span></a></span></span><span> </span><span id="local-6989586621681071949"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681071949"><span class="hs-identifier hs-var">source</span></a></span></span><span> </span><span id="local-6989586621681071948"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681071948"><span class="hs-identifier hs-var">linenumber</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1733"></span><span>  </span><span class="annot"><span class="annottext">HscEnv
-&gt; Hsc (Maybe ([Id], ForeignHValue, FixityEnv))
-&gt; IO (Maybe ([Id], ForeignHValue, FixityEnv))
forall a. HscEnv -&gt; Hsc a -&gt; IO a
</span><a href="GHC.Driver.Types.html#runInteractiveHsc"><span class="hs-identifier hs-var">runInteractiveHsc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071951"><span class="hs-identifier hs-var">hsc_env0</span></a></span><span> </span><span class="annot"><span class="annottext">(Hsc (Maybe ([Id], ForeignHValue, FixityEnv))
 -&gt; IO (Maybe ([Id], ForeignHValue, FixityEnv)))
-&gt; Hsc (Maybe ([Id], ForeignHValue, FixityEnv))
-&gt; IO (Maybe ([Id], ForeignHValue, FixityEnv))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1734"></span><span>    </span><span id="local-6989586621681071947"><span class="annot"><span class="annottext">Maybe (LStmt GhcPs (LHsExpr GhcPs))
</span><a href="#local-6989586621681071947"><span class="hs-identifier hs-var">maybe_stmt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String
-&gt; Int -&gt; String -&gt; Hsc (Maybe (LStmt GhcPs (LHsExpr GhcPs)))
</span><a href="GHC.Driver.Main.html#hscParseStmtWithLocation"><span class="hs-identifier hs-var">hscParseStmtWithLocation</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681071949"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681071948"><span class="hs-identifier hs-var">linenumber</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681071950"><span class="hs-identifier hs-var">stmt</span></a></span><span>
</span><span id="line-1735"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (LStmt GhcPs (LHsExpr GhcPs))
</span><a href="#local-6989586621681071947"><span class="hs-identifier hs-var">maybe_stmt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1736"></span><span>      </span><span class="annot"><span class="annottext">Maybe (LStmt GhcPs (LHsExpr GhcPs))
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe ([Id], ForeignHValue, FixityEnv)
-&gt; Hsc (Maybe ([Id], ForeignHValue, FixityEnv))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ([Id], ForeignHValue, FixityEnv)
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1737"></span><span>
</span><span id="line-1738"></span><span>      </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681071946"><span class="annot"><span class="annottext">LStmt GhcPs (LHsExpr GhcPs)
</span><a href="#local-6989586621681071946"><span class="hs-identifier hs-var">parsed_stmt</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1739"></span><span>        </span><span id="local-6989586621681071945"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071945"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc HscEnv
</span><a href="GHC.Driver.Main.html#getHscEnv"><span class="hs-identifier hs-var">getHscEnv</span></a></span><span>
</span><span id="line-1740"></span><span>        </span><span class="annot"><span class="annottext">IO (Maybe ([Id], ForeignHValue, FixityEnv))
-&gt; Hsc (Maybe ([Id], ForeignHValue, FixityEnv))
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (Maybe ([Id], ForeignHValue, FixityEnv))
 -&gt; Hsc (Maybe ([Id], ForeignHValue, FixityEnv)))
-&gt; IO (Maybe ([Id], ForeignHValue, FixityEnv))
-&gt; Hsc (Maybe ([Id], ForeignHValue, FixityEnv))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; LStmt GhcPs (LHsExpr GhcPs)
-&gt; IO (Maybe ([Id], ForeignHValue, FixityEnv))
</span><a href="GHC.Driver.Main.html#hscParsedStmt"><span class="hs-identifier hs-var">hscParsedStmt</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071945"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">LStmt GhcPs (LHsExpr GhcPs)
</span><a href="#local-6989586621681071946"><span class="hs-identifier hs-var">parsed_stmt</span></a></span><span>
</span><span id="line-1741"></span><span>
</span><span id="line-1742"></span><span class="annot"><a href="GHC.Driver.Main.html#hscParsedStmt"><span class="hs-identifier hs-type">hscParsedStmt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-1743"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#GhciLStmt"><span class="hs-identifier hs-type">GhciLStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span>  </span><span class="hs-comment">-- ^ The parsed statement</span><span>
</span><span id="line-1744"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1745"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../ghci/src/GHCi.RemoteTypes.html#ForeignHValue"><span class="hs-identifier hs-type">ForeignHValue</span></a></span><span> </span><span class="hs-comment">{- IO [HValue] -}</span><span>
</span><span id="line-1746"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#FixityEnv"><span class="hs-identifier hs-type">FixityEnv</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1747"></span><span id="hscParsedStmt"><span class="annot"><span class="annottext">hscParsedStmt :: HscEnv
-&gt; LStmt GhcPs (LHsExpr GhcPs)
-&gt; IO (Maybe ([Id], ForeignHValue, FixityEnv))
</span><a href="GHC.Driver.Main.html#hscParsedStmt"><span class="hs-identifier hs-var hs-var">hscParsedStmt</span></a></span></span><span> </span><span id="local-6989586621681071943"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071943"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681071942"><span class="annot"><span class="annottext">LStmt GhcPs (LHsExpr GhcPs)
</span><a href="#local-6989586621681071942"><span class="hs-identifier hs-var">stmt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; Hsc (Maybe ([Id], ForeignHValue, FixityEnv))
-&gt; IO (Maybe ([Id], ForeignHValue, FixityEnv))
forall a. HscEnv -&gt; Hsc a -&gt; IO a
</span><a href="GHC.Driver.Types.html#runInteractiveHsc"><span class="hs-identifier hs-var">runInteractiveHsc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071943"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(Hsc (Maybe ([Id], ForeignHValue, FixityEnv))
 -&gt; IO (Maybe ([Id], ForeignHValue, FixityEnv)))
-&gt; Hsc (Maybe ([Id], ForeignHValue, FixityEnv))
-&gt; IO (Maybe ([Id], ForeignHValue, FixityEnv))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1748"></span><span>  </span><span class="hs-comment">-- Rename and typecheck it</span><span>
</span><span id="line-1749"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621681071941"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681071941"><span class="hs-identifier hs-var">ids</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681071940"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681071940"><span class="hs-identifier hs-var">tc_expr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681071939"><span class="annot"><span class="annottext">FixityEnv
</span><a href="#local-6989586621681071939"><span class="hs-identifier hs-var">fix_env</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO
  ((WarningMessages, WarningMessages),
   Maybe ([Id], LHsExpr GhcTc, FixityEnv))
-&gt; Hsc ([Id], LHsExpr GhcTc, FixityEnv)
forall a. IO ((WarningMessages, WarningMessages), Maybe a) -&gt; Hsc a
</span><a href="GHC.Driver.Main.html#ioMsgMaybe"><span class="hs-identifier hs-var">ioMsgMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">(IO
   ((WarningMessages, WarningMessages),
    Maybe ([Id], LHsExpr GhcTc, FixityEnv))
 -&gt; Hsc ([Id], LHsExpr GhcTc, FixityEnv))
-&gt; IO
     ((WarningMessages, WarningMessages),
      Maybe ([Id], LHsExpr GhcTc, FixityEnv))
-&gt; Hsc ([Id], LHsExpr GhcTc, FixityEnv)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; LStmt GhcPs (LHsExpr GhcPs)
-&gt; IO
     ((WarningMessages, WarningMessages),
      Maybe ([Id], LHsExpr GhcTc, FixityEnv))
</span><a href="GHC.Tc.Module.html#tcRnStmt"><span class="hs-identifier hs-var">tcRnStmt</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071943"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">LStmt GhcPs (LHsExpr GhcPs)
</span><a href="#local-6989586621681071942"><span class="hs-identifier hs-var">stmt</span></a></span><span>
</span><span id="line-1750"></span><span>
</span><span id="line-1751"></span><span>  </span><span class="hs-comment">-- Desugar it</span><span>
</span><span id="line-1752"></span><span>  </span><span id="local-6989586621681071937"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621681071937"><span class="hs-identifier hs-var">ds_expr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ((WarningMessages, WarningMessages), Maybe CoreExpr)
-&gt; Hsc CoreExpr
forall a. IO ((WarningMessages, WarningMessages), Maybe a) -&gt; Hsc a
</span><a href="GHC.Driver.Main.html#ioMsgMaybe"><span class="hs-identifier hs-var">ioMsgMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ((WarningMessages, WarningMessages), Maybe CoreExpr)
 -&gt; Hsc CoreExpr)
-&gt; IO ((WarningMessages, WarningMessages), Maybe CoreExpr)
-&gt; Hsc CoreExpr
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; LHsExpr GhcTc
-&gt; IO ((WarningMessages, WarningMessages), Maybe CoreExpr)
</span><a href="GHC.HsToCore.html#deSugarExpr"><span class="hs-identifier hs-var">deSugarExpr</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071943"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681071940"><span class="hs-identifier hs-var">tc_expr</span></a></span><span>
</span><span id="line-1753"></span><span>  </span><span class="annot"><span class="annottext">IO () -&gt; Hsc ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; HscEnv -&gt; CoreExpr -&gt; IO ()
</span><a href="GHC.Core.Lint.html#lintInteractiveExpr"><span class="hs-identifier hs-var">lintInteractiveExpr</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;desugar expression&quot;</span></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071943"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621681071937"><span class="hs-identifier hs-var">ds_expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1754"></span><span>  </span><span class="annot"><span class="annottext">Hsc ()
</span><a href="GHC.Driver.Main.html#handleWarnings"><span class="hs-identifier hs-var">handleWarnings</span></a></span><span>
</span><span id="line-1755"></span><span>
</span><span id="line-1756"></span><span>  </span><span class="hs-comment">-- Then code-gen, and link it</span><span>
</span><span id="line-1757"></span><span>  </span><span class="hs-comment">-- It's important NOT to have package 'interactive' as thisUnitId</span><span>
</span><span id="line-1758"></span><span>  </span><span class="hs-comment">-- for linking, else we try to link 'main' and can't find it.</span><span>
</span><span id="line-1759"></span><span>  </span><span class="hs-comment">-- Whereas the linker already knows to ignore 'interactive'</span><span>
</span><span id="line-1760"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681071935"><span class="annot"><span class="annottext">src_span :: SrcSpan
</span><a href="#local-6989586621681071935"><span class="hs-identifier hs-var hs-var">src_span</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; SrcSpan
</span><a href="GHC.Types.SrcLoc.html#srcLocSpan"><span class="hs-identifier hs-var">srcLocSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="GHC.Types.SrcLoc.html#interactiveSrcLoc"><span class="hs-identifier hs-var">interactiveSrcLoc</span></a></span><span>
</span><span id="line-1761"></span><span>  </span><span id="local-6989586621681071932"><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621681071932"><span class="hs-identifier hs-var">hval</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ForeignHValue -&gt; Hsc ForeignHValue
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ForeignHValue -&gt; Hsc ForeignHValue)
-&gt; IO ForeignHValue -&gt; Hsc ForeignHValue
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; SrcSpan -&gt; CoreExpr -&gt; IO ForeignHValue
</span><a href="GHC.Driver.Main.html#hscCompileCoreExpr"><span class="hs-identifier hs-var">hscCompileCoreExpr</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071943"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681071935"><span class="hs-identifier hs-var">src_span</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621681071937"><span class="hs-identifier hs-var">ds_expr</span></a></span><span>
</span><span id="line-1762"></span><span>
</span><span id="line-1763"></span><span>  </span><span class="annot"><span class="annottext">Maybe ([Id], ForeignHValue, FixityEnv)
-&gt; Hsc (Maybe ([Id], ForeignHValue, FixityEnv))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe ([Id], ForeignHValue, FixityEnv)
 -&gt; Hsc (Maybe ([Id], ForeignHValue, FixityEnv)))
-&gt; Maybe ([Id], ForeignHValue, FixityEnv)
-&gt; Hsc (Maybe ([Id], ForeignHValue, FixityEnv))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">([Id], ForeignHValue, FixityEnv)
-&gt; Maybe ([Id], ForeignHValue, FixityEnv)
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681071941"><span class="hs-identifier hs-var">ids</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621681071932"><span class="hs-identifier hs-var">hval</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FixityEnv
</span><a href="#local-6989586621681071939"><span class="hs-identifier hs-var">fix_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1764"></span><span>
</span><span id="line-1765"></span><span class="hs-comment">-- | Compile a decls</span><span>
</span><span id="line-1766"></span><span class="annot"><a href="GHC.Driver.Main.html#hscDecls"><span class="hs-identifier hs-type">hscDecls</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-1767"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-comment">-- ^ The statement</span><span>
</span><span id="line-1768"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#InteractiveContext"><span class="hs-identifier hs-type">InteractiveContext</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1769"></span><span id="hscDecls"><span class="annot"><span class="annottext">hscDecls :: HscEnv -&gt; String -&gt; IO ([TyThing], InteractiveContext)
</span><a href="GHC.Driver.Main.html#hscDecls"><span class="hs-identifier hs-var hs-var">hscDecls</span></a></span></span><span> </span><span id="local-6989586621681071931"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071931"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681071930"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681071930"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; String -&gt; String -&gt; Int -&gt; IO ([TyThing], InteractiveContext)
</span><a href="GHC.Driver.Main.html#hscDeclsWithLocation"><span class="hs-identifier hs-var">hscDeclsWithLocation</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071931"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681071930"><span class="hs-identifier hs-var">str</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&lt;interactive&gt;&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-1770"></span><span>
</span><span id="line-1771"></span><span class="annot"><a href="GHC.Driver.Main.html#hscParseDeclsWithLocation"><span class="hs-identifier hs-type">hscParseDeclsWithLocation</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Hs.Decls.html#LHsDecl"><span class="hs-identifier hs-type">LHsDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1772"></span><span id="hscParseDeclsWithLocation"><span class="annot"><span class="annottext">hscParseDeclsWithLocation :: HscEnv -&gt; String -&gt; Int -&gt; String -&gt; IO [LHsDecl GhcPs]
</span><a href="GHC.Driver.Main.html#hscParseDeclsWithLocation"><span class="hs-identifier hs-var hs-var">hscParseDeclsWithLocation</span></a></span></span><span> </span><span id="local-6989586621681071929"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071929"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681071928"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681071928"><span class="hs-identifier hs-var">source</span></a></span></span><span> </span><span id="local-6989586621681071927"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681071927"><span class="hs-identifier hs-var">line_num</span></a></span></span><span> </span><span id="local-6989586621681071926"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681071926"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1773"></span><span>    </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.html#HsModule"><span class="hs-identifier hs-type">HsModule</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hsmodDecls :: HsModule -&gt; [LHsDecl GhcPs]
</span><a href="GHC.Hs.html#hsmodDecls"><span class="hs-identifier hs-var">hsmodDecls</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681071923"><span class="annot"><span class="annottext">[LHsDecl GhcPs]
</span><a href="#local-6989586621681071923"><span class="hs-identifier hs-var">decls</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1774"></span><span>      </span><span class="annot"><span class="annottext">HscEnv -&gt; Hsc (Located HsModule) -&gt; IO (Located HsModule)
forall a. HscEnv -&gt; Hsc a -&gt; IO a
</span><a href="GHC.Driver.Types.html#runInteractiveHsc"><span class="hs-identifier hs-var">runInteractiveHsc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071929"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(Hsc (Located HsModule) -&gt; IO (Located HsModule))
-&gt; Hsc (Located HsModule) -&gt; IO (Located HsModule)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1775"></span><span>        </span><span class="annot"><span class="annottext">String
-&gt; Int -&gt; P (Located HsModule) -&gt; String -&gt; Hsc (Located HsModule)
forall thing.
(Outputable thing, Data thing) =&gt;
String -&gt; Int -&gt; P thing -&gt; String -&gt; Hsc thing
</span><a href="GHC.Driver.Main.html#hscParseThingWithLocation"><span class="hs-identifier hs-var">hscParseThingWithLocation</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681071928"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681071927"><span class="hs-identifier hs-var">line_num</span></a></span><span> </span><span class="annot"><span class="annottext">P (Located HsModule)
</span><a href="GHC.Parser.html#parseModule"><span class="hs-identifier hs-var">parseModule</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681071926"><span class="hs-identifier hs-var">str</span></a></span><span>
</span><span id="line-1776"></span><span>    </span><span class="annot"><span class="annottext">[LHsDecl GhcPs] -&gt; IO [LHsDecl GhcPs]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsDecl GhcPs]
</span><a href="#local-6989586621681071923"><span class="hs-identifier hs-var">decls</span></a></span><span>
</span><span id="line-1777"></span><span>
</span><span id="line-1778"></span><span class="hs-comment">-- | Compile a decls</span><span>
</span><span id="line-1779"></span><span class="annot"><a href="GHC.Driver.Main.html#hscDeclsWithLocation"><span class="hs-identifier hs-type">hscDeclsWithLocation</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-1780"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-comment">-- ^ The statement</span><span>
</span><span id="line-1781"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-comment">-- ^ The source</span><span>
</span><span id="line-1782"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>    </span><span class="hs-comment">-- ^ Starting line</span><span>
</span><span id="line-1783"></span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#InteractiveContext"><span class="hs-identifier hs-type">InteractiveContext</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1784"></span><span id="hscDeclsWithLocation"><span class="annot"><span class="annottext">hscDeclsWithLocation :: HscEnv
-&gt; String -&gt; String -&gt; Int -&gt; IO ([TyThing], InteractiveContext)
</span><a href="GHC.Driver.Main.html#hscDeclsWithLocation"><span class="hs-identifier hs-var hs-var">hscDeclsWithLocation</span></a></span></span><span> </span><span id="local-6989586621681071921"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071921"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681071920"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681071920"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span id="local-6989586621681071919"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681071919"><span class="hs-identifier hs-var">source</span></a></span></span><span> </span><span id="local-6989586621681071918"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681071918"><span class="hs-identifier hs-var">linenumber</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1785"></span><span>    </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.html#HsModule"><span class="hs-identifier hs-type">HsModule</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hsmodDecls :: HsModule -&gt; [LHsDecl GhcPs]
</span><a href="GHC.Hs.html#hsmodDecls"><span class="hs-identifier hs-var">hsmodDecls</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681071917"><span class="annot"><span class="annottext">[LHsDecl GhcPs]
</span><a href="#local-6989586621681071917"><span class="hs-identifier hs-var">decls</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1786"></span><span>      </span><span class="annot"><span class="annottext">HscEnv -&gt; Hsc (Located HsModule) -&gt; IO (Located HsModule)
forall a. HscEnv -&gt; Hsc a -&gt; IO a
</span><a href="GHC.Driver.Types.html#runInteractiveHsc"><span class="hs-identifier hs-var">runInteractiveHsc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071921"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(Hsc (Located HsModule) -&gt; IO (Located HsModule))
-&gt; Hsc (Located HsModule) -&gt; IO (Located HsModule)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1787"></span><span>        </span><span class="annot"><span class="annottext">String
-&gt; Int -&gt; P (Located HsModule) -&gt; String -&gt; Hsc (Located HsModule)
forall thing.
(Outputable thing, Data thing) =&gt;
String -&gt; Int -&gt; P thing -&gt; String -&gt; Hsc thing
</span><a href="GHC.Driver.Main.html#hscParseThingWithLocation"><span class="hs-identifier hs-var">hscParseThingWithLocation</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681071919"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681071918"><span class="hs-identifier hs-var">linenumber</span></a></span><span> </span><span class="annot"><span class="annottext">P (Located HsModule)
</span><a href="GHC.Parser.html#parseModule"><span class="hs-identifier hs-var">parseModule</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681071920"><span class="hs-identifier hs-var">str</span></a></span><span>
</span><span id="line-1788"></span><span>    </span><span class="annot"><span class="annottext">HscEnv -&gt; [LHsDecl GhcPs] -&gt; IO ([TyThing], InteractiveContext)
</span><a href="GHC.Driver.Main.html#hscParsedDecls"><span class="hs-identifier hs-var">hscParsedDecls</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071921"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsDecl GhcPs]
</span><a href="#local-6989586621681071917"><span class="hs-identifier hs-var">decls</span></a></span><span>
</span><span id="line-1789"></span><span>
</span><span id="line-1790"></span><span class="annot"><a href="GHC.Driver.Main.html#hscParsedDecls"><span class="hs-identifier hs-type">hscParsedDecls</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Hs.Decls.html#LHsDecl"><span class="hs-identifier hs-type">LHsDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyThing"><span class="hs-identifier hs-type">TyThing</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#InteractiveContext"><span class="hs-identifier hs-type">InteractiveContext</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1791"></span><span id="hscParsedDecls"><span class="annot"><span class="annottext">hscParsedDecls :: HscEnv -&gt; [LHsDecl GhcPs] -&gt; IO ([TyThing], InteractiveContext)
</span><a href="GHC.Driver.Main.html#hscParsedDecls"><span class="hs-identifier hs-var hs-var">hscParsedDecls</span></a></span></span><span> </span><span id="local-6989586621681071916"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071916"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681071915"><span class="annot"><span class="annottext">[LHsDecl GhcPs]
</span><a href="#local-6989586621681071915"><span class="hs-identifier hs-var">decls</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; Hsc ([TyThing], InteractiveContext)
-&gt; IO ([TyThing], InteractiveContext)
forall a. HscEnv -&gt; Hsc a -&gt; IO a
</span><a href="GHC.Driver.Types.html#runInteractiveHsc"><span class="hs-identifier hs-var">runInteractiveHsc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071916"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(Hsc ([TyThing], InteractiveContext)
 -&gt; IO ([TyThing], InteractiveContext))
-&gt; Hsc ([TyThing], InteractiveContext)
-&gt; IO ([TyThing], InteractiveContext)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1792"></span><span>    </span><span class="hs-comment">{- Rename and typecheck it -}</span><span>
</span><span id="line-1793"></span><span>    </span><span id="local-6989586621681071914"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071914"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc HscEnv
</span><a href="GHC.Driver.Main.html#getHscEnv"><span class="hs-identifier hs-var">getHscEnv</span></a></span><span>
</span><span id="line-1794"></span><span>    </span><span id="local-6989586621681071913"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681071913"><span class="hs-identifier hs-var">tc_gblenv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ((WarningMessages, WarningMessages), Maybe TcGblEnv)
-&gt; Hsc TcGblEnv
forall a. IO ((WarningMessages, WarningMessages), Maybe a) -&gt; Hsc a
</span><a href="GHC.Driver.Main.html#ioMsgMaybe"><span class="hs-identifier hs-var">ioMsgMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ((WarningMessages, WarningMessages), Maybe TcGblEnv)
 -&gt; Hsc TcGblEnv)
-&gt; IO ((WarningMessages, WarningMessages), Maybe TcGblEnv)
-&gt; Hsc TcGblEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; [LHsDecl GhcPs]
-&gt; IO ((WarningMessages, WarningMessages), Maybe TcGblEnv)
</span><a href="GHC.Tc.Module.html#tcRnDeclsi"><span class="hs-identifier hs-var">tcRnDeclsi</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071914"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsDecl GhcPs]
</span><a href="#local-6989586621681071915"><span class="hs-identifier hs-var">decls</span></a></span><span>
</span><span id="line-1795"></span><span>
</span><span id="line-1796"></span><span>    </span><span class="hs-comment">{- Grab the new instances -}</span><span>
</span><span id="line-1797"></span><span>    </span><span class="hs-comment">-- We grab the whole environment because of the overlapping that may have</span><span>
</span><span id="line-1798"></span><span>    </span><span class="hs-comment">-- been done. See the notes at the definition of InteractiveContext</span><span>
</span><span id="line-1799"></span><span>    </span><span class="hs-comment">-- (ic_instances) for more details.</span><span>
</span><span id="line-1800"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681071911"><span class="annot"><span class="annottext">defaults :: Maybe [Type]
</span><a href="#local-6989586621681071911"><span class="hs-identifier hs-var hs-var">defaults</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; Maybe [Type]
</span><a href="GHC.Tc.Types.html#tcg_default"><span class="hs-identifier hs-var hs-var">tcg_default</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681071913"><span class="hs-identifier hs-var">tc_gblenv</span></a></span><span>
</span><span id="line-1801"></span><span>
</span><span id="line-1802"></span><span>    </span><span class="hs-comment">{- Desugar it -}</span><span>
</span><span id="line-1803"></span><span>    </span><span class="hs-comment">-- We use a basically null location for iNTERACTIVE</span><span>
</span><span id="line-1804"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681071909"><span class="annot"><span class="annottext">iNTERACTIVELoc :: ModLocation
</span><a href="#local-6989586621681071909"><span class="hs-identifier hs-var hs-var">iNTERACTIVELoc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModLocation :: Maybe String -&gt; String -&gt; String -&gt; String -&gt; ModLocation
</span><a href="GHC.Unit.Module.Location.html#ModLocation"><span class="hs-identifier hs-type">ModLocation</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ml_hs_file :: Maybe String
</span><a href="GHC.Unit.Module.Location.html#ml_hs_file"><span class="hs-identifier hs-var">ml_hs_file</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe String
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1805"></span><span>                                      </span><span class="annot"><span class="annottext">ml_hi_file :: String
</span><a href="GHC.Unit.Module.Location.html#ml_hi_file"><span class="hs-identifier hs-var">ml_hi_file</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String
forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;hsDeclsWithLocation:ml_hi_file&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-1806"></span><span>                                      </span><span class="annot"><span class="annottext">ml_obj_file :: String
</span><a href="GHC.Unit.Module.Location.html#ml_obj_file"><span class="hs-identifier hs-var">ml_obj_file</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String
forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;hsDeclsWithLocation:ml_obj_file&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-1807"></span><span>                                      </span><span class="annot"><span class="annottext">ml_hie_file :: String
</span><a href="GHC.Unit.Module.Location.html#ml_hie_file"><span class="hs-identifier hs-var">ml_hie_file</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String
forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;hsDeclsWithLocation:ml_hie_file&quot;</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1808"></span><span>    </span><span id="local-6989586621681071908"><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621681071908"><span class="hs-identifier hs-var">ds_result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModLocation -&gt; TcGblEnv -&gt; Hsc ModGuts
</span><a href="GHC.Driver.Main.html#hscDesugar%27"><span class="hs-identifier hs-var">hscDesugar'</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681071909"><span class="hs-identifier hs-var">iNTERACTIVELoc</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681071913"><span class="hs-identifier hs-var">tc_gblenv</span></a></span><span>
</span><span id="line-1809"></span><span>
</span><span id="line-1810"></span><span>    </span><span class="hs-comment">{- Simplify -}</span><span>
</span><span id="line-1811"></span><span>    </span><span id="local-6989586621681071907"><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621681071907"><span class="hs-identifier hs-var">simpl_mg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ModGuts -&gt; Hsc ModGuts
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ModGuts -&gt; Hsc ModGuts) -&gt; IO ModGuts -&gt; Hsc ModGuts
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1812"></span><span>      </span><span id="local-6989586621681071906"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681071906"><span class="hs-identifier hs-var">plugins</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef [String] -&gt; IO [String]
forall a. IORef a -&gt; IO a
</span><a href="../../base/src/GHC.IORef.html#readIORef"><span class="hs-identifier hs-var">readIORef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; IORef [String]
</span><a href="GHC.Tc.Types.html#tcg_th_coreplugins"><span class="hs-identifier hs-var hs-var">tcg_th_coreplugins</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681071913"><span class="hs-identifier hs-var">tc_gblenv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1813"></span><span>      </span><span class="annot"><span class="annottext">HscEnv -&gt; [String] -&gt; ModGuts -&gt; IO ModGuts
</span><a href="GHC.Driver.Main.html#hscSimplify"><span class="hs-identifier hs-var">hscSimplify</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071914"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681071906"><span class="hs-identifier hs-var">plugins</span></a></span><span> </span><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621681071908"><span class="hs-identifier hs-var">ds_result</span></a></span><span>
</span><span id="line-1814"></span><span>
</span><span id="line-1815"></span><span>    </span><span class="hs-comment">{- Tidy -}</span><span>
</span><span id="line-1816"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681071905"><span class="annot"><span class="annottext">CgGuts
</span><a href="#local-6989586621681071905"><span class="hs-identifier hs-var">tidy_cg</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681071904"><span class="annot"><span class="annottext">ModDetails
</span><a href="#local-6989586621681071904"><span class="hs-identifier hs-var">mod_details</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (CgGuts, ModDetails) -&gt; Hsc (CgGuts, ModDetails)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (CgGuts, ModDetails) -&gt; Hsc (CgGuts, ModDetails))
-&gt; IO (CgGuts, ModDetails) -&gt; Hsc (CgGuts, ModDetails)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; ModGuts -&gt; IO (CgGuts, ModDetails)
</span><a href="GHC.Iface.Tidy.html#tidyProgram"><span class="hs-identifier hs-var">tidyProgram</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071914"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621681071907"><span class="hs-identifier hs-var">simpl_mg</span></a></span><span>
</span><span id="line-1817"></span><span>
</span><span id="line-1818"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Driver.Types.html#CgGuts"><span class="hs-identifier hs-type">CgGuts</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cg_module :: CgGuts -&gt; Module
</span><a href="GHC.Driver.Types.html#cg_module"><span class="hs-identifier hs-var">cg_module</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681071903"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681071903"><span class="hs-identifier hs-var">this_mod</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-1819"></span><span>                 </span><span class="annot"><span class="annottext">cg_binds :: CgGuts -&gt; CoreProgram
</span><a href="GHC.Driver.Types.html#cg_binds"><span class="hs-identifier hs-var">cg_binds</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681071902"><span class="annot"><span class="annottext">CoreProgram
</span><a href="#local-6989586621681071902"><span class="hs-identifier hs-var">core_binds</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-1820"></span><span>                 </span><span class="annot"><span class="annottext">cg_tycons :: CgGuts -&gt; [TyCon]
</span><a href="GHC.Driver.Types.html#cg_tycons"><span class="hs-identifier hs-var">cg_tycons</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681071901"><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681071901"><span class="hs-identifier hs-var">tycons</span></a></span></span><span class="hs-special">,</span><span>
</span><span id="line-1821"></span><span>                 </span><span class="annot"><span class="annottext">cg_modBreaks :: CgGuts -&gt; Maybe ModBreaks
</span><a href="GHC.Driver.Types.html#cg_modBreaks"><span class="hs-identifier hs-var">cg_modBreaks</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681071900"><span class="annot"><span class="annottext">Maybe ModBreaks
</span><a href="#local-6989586621681071900"><span class="hs-identifier hs-var">mod_breaks</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CgGuts
</span><a href="#local-6989586621681071905"><span class="hs-identifier hs-var">tidy_cg</span></a></span><span>
</span><span id="line-1822"></span><span>
</span><span id="line-1823"></span><span>        </span><span class="hs-glyph">!</span><span class="annot"><a href="GHC.Driver.Types.html#ModDetails"><span class="hs-identifier hs-type">ModDetails</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">md_insts :: ModDetails -&gt; [ClsInst]
</span><a href="GHC.Driver.Types.html#md_insts"><span class="hs-identifier hs-var">md_insts</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681071897"><span class="annot"><span class="annottext">[ClsInst]
</span><a href="#local-6989586621681071897"><span class="hs-identifier hs-var">cls_insts</span></a></span></span><span>
</span><span id="line-1824"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">md_fam_insts :: ModDetails -&gt; [FamInst]
</span><a href="GHC.Driver.Types.html#md_fam_insts"><span class="hs-identifier hs-var">md_fam_insts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681071895"><span class="annot"><span class="annottext">[FamInst]
</span><a href="#local-6989586621681071895"><span class="hs-identifier hs-var">fam_insts</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModDetails
</span><a href="#local-6989586621681071904"><span class="hs-identifier hs-var">mod_details</span></a></span><span>
</span><span id="line-1825"></span><span>            </span><span class="hs-comment">-- Get the *tidied* cls_insts and fam_insts</span><span>
</span><span id="line-1826"></span><span>
</span><span id="line-1827"></span><span>        </span><span id="local-6989586621681071894"><span class="annot"><span class="annottext">data_tycons :: [TyCon]
</span><a href="#local-6989586621681071894"><span class="hs-identifier hs-var hs-var">data_tycons</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TyCon -&gt; IsSafeImport) -&gt; [TyCon] -&gt; [TyCon]
forall a. (a -&gt; IsSafeImport) -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; IsSafeImport
</span><a href="GHC.Core.TyCon.html#isDataTyCon"><span class="hs-identifier hs-var">isDataTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681071901"><span class="hs-identifier hs-var">tycons</span></a></span><span>
</span><span id="line-1828"></span><span>
</span><span id="line-1829"></span><span>    </span><span class="hs-comment">{- Prepare For Code Generation -}</span><span>
</span><span id="line-1830"></span><span>    </span><span class="hs-comment">-- Do saturation and convert to A-normal form</span><span>
</span><span id="line-1831"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681071893"><span class="annot"><span class="annottext">CoreProgram
</span><a href="#local-6989586621681071893"><span class="hs-identifier hs-var">prepd_binds</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set CostCentre
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;CorePrep&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-1832"></span><span>      </span><span class="annot"><span class="annottext">IO (CoreProgram, Set CostCentre)
-&gt; Hsc (CoreProgram, Set CostCentre)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (CoreProgram, Set CostCentre)
 -&gt; Hsc (CoreProgram, Set CostCentre))
-&gt; IO (CoreProgram, Set CostCentre)
-&gt; Hsc (CoreProgram, Set CostCentre)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; Module
-&gt; ModLocation
-&gt; CoreProgram
-&gt; [TyCon]
-&gt; IO (CoreProgram, Set CostCentre)
</span><a href="GHC.CoreToStg.Prep.html#corePrepPgm"><span class="hs-identifier hs-var">corePrepPgm</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071914"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681071903"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681071909"><span class="hs-identifier hs-var">iNTERACTIVELoc</span></a></span><span> </span><span class="annot"><span class="annottext">CoreProgram
</span><a href="#local-6989586621681071902"><span class="hs-identifier hs-var">core_binds</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681071894"><span class="hs-identifier hs-var">data_tycons</span></a></span><span>
</span><span id="line-1833"></span><span>
</span><span id="line-1834"></span><span>    </span><span class="hs-comment">{- Generate byte code -}</span><span>
</span><span id="line-1835"></span><span>    </span><span id="local-6989586621681071892"><span class="annot"><span class="annottext">CompiledByteCode
</span><a href="#local-6989586621681071892"><span class="hs-identifier hs-var">cbc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO CompiledByteCode -&gt; Hsc CompiledByteCode
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO CompiledByteCode -&gt; Hsc CompiledByteCode)
-&gt; IO CompiledByteCode -&gt; Hsc CompiledByteCode
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; Module
-&gt; CoreProgram
-&gt; [TyCon]
-&gt; Maybe ModBreaks
-&gt; IO CompiledByteCode
</span><a href="GHC.CoreToByteCode.html#byteCodeGen"><span class="hs-identifier hs-var">byteCodeGen</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071914"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681071903"><span class="hs-identifier hs-var">this_mod</span></a></span><span>
</span><span id="line-1836"></span><span>                                </span><span class="annot"><span class="annottext">CoreProgram
</span><a href="#local-6989586621681071893"><span class="hs-identifier hs-var">prepd_binds</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681071894"><span class="hs-identifier hs-var">data_tycons</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ModBreaks
</span><a href="#local-6989586621681071900"><span class="hs-identifier hs-var">mod_breaks</span></a></span><span>
</span><span id="line-1837"></span><span>
</span><span id="line-1838"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681071891"><span class="annot"><span class="annottext">src_span :: SrcSpan
</span><a href="#local-6989586621681071891"><span class="hs-identifier hs-var hs-var">src_span</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcLoc -&gt; SrcSpan
</span><a href="GHC.Types.SrcLoc.html#srcLocSpan"><span class="hs-identifier hs-var">srcLocSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcLoc
</span><a href="GHC.Types.SrcLoc.html#interactiveSrcLoc"><span class="hs-identifier hs-var">interactiveSrcLoc</span></a></span><span>
</span><span id="line-1839"></span><span>    </span><span class="annot"><span class="annottext">IO () -&gt; Hsc ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; Hsc ()) -&gt; IO () -&gt; Hsc ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; SrcSpan -&gt; CompiledByteCode -&gt; IO ()
</span><a href="GHC.Runtime.Linker.html#linkDecls"><span class="hs-identifier hs-var">linkDecls</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071914"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681071891"><span class="hs-identifier hs-var">src_span</span></a></span><span> </span><span class="annot"><span class="annottext">CompiledByteCode
</span><a href="#local-6989586621681071892"><span class="hs-identifier hs-var">cbc</span></a></span><span>
</span><span id="line-1840"></span><span>
</span><span id="line-1841"></span><span>    </span><span class="hs-comment">{- Load static pointer table entries -}</span><span>
</span><span id="line-1842"></span><span>    </span><span class="annot"><span class="annottext">IO () -&gt; Hsc ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; Hsc ()) -&gt; IO () -&gt; Hsc ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; [SptEntry] -&gt; IO ()
</span><a href="GHC.Driver.Main.html#hscAddSptEntries"><span class="hs-identifier hs-var">hscAddSptEntries</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071914"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CgGuts -&gt; [SptEntry]
</span><a href="GHC.Driver.Types.html#cg_spt_entries"><span class="hs-identifier hs-var hs-var">cg_spt_entries</span></a></span><span> </span><span class="annot"><span class="annottext">CgGuts
</span><a href="#local-6989586621681071905"><span class="hs-identifier hs-var">tidy_cg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1843"></span><span>
</span><span id="line-1844"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681071889"><span class="annot"><span class="annottext">tcs :: [TyCon]
</span><a href="#local-6989586621681071889"><span class="hs-identifier hs-var hs-var">tcs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TyCon -&gt; IsSafeImport) -&gt; [TyCon] -&gt; [TyCon]
forall a. (a -&gt; IsSafeImport) -&gt; [a] -&gt; [a]
</span><a href="GHC.Utils.Misc.html#filterOut"><span class="hs-identifier hs-var">filterOut</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; IsSafeImport
</span><a href="GHC.Core.TyCon.html#isImplicitTyCon"><span class="hs-identifier hs-var">isImplicitTyCon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModGuts -&gt; [TyCon]
</span><a href="GHC.Driver.Types.html#mg_tcs"><span class="hs-identifier hs-var hs-var">mg_tcs</span></a></span><span> </span><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621681071907"><span class="hs-identifier hs-var">simpl_mg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1845"></span><span>        </span><span id="local-6989586621681071885"><span class="annot"><span class="annottext">patsyns :: [PatSyn]
</span><a href="#local-6989586621681071885"><span class="hs-identifier hs-var hs-var">patsyns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModGuts -&gt; [PatSyn]
</span><a href="GHC.Driver.Types.html#mg_patsyns"><span class="hs-identifier hs-var hs-var">mg_patsyns</span></a></span><span> </span><span class="annot"><span class="annottext">ModGuts
</span><a href="#local-6989586621681071907"><span class="hs-identifier hs-var">simpl_mg</span></a></span><span>
</span><span id="line-1846"></span><span>
</span><span id="line-1847"></span><span>        </span><span id="local-6989586621681071883"><span class="annot"><span class="annottext">ext_ids :: [Id]
</span><a href="#local-6989586621681071883"><span class="hs-identifier hs-var hs-var">ext_ids</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681071882"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681071882"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681071882"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoreProgram -&gt; [Id]
forall b. [Bind b] -&gt; [b]
</span><a href="GHC.Core.html#bindersOfBinds"><span class="hs-identifier hs-var">bindersOfBinds</span></a></span><span> </span><span class="annot"><span class="annottext">CoreProgram
</span><a href="#local-6989586621681071902"><span class="hs-identifier hs-var">core_binds</span></a></span><span>
</span><span id="line-1848"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; IsSafeImport
</span><a href="GHC.Types.Name.html#isExternalName"><span class="hs-identifier hs-var">isExternalName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681071882"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1849"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IsSafeImport -&gt; IsSafeImport
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; IsSafeImport
</span><a href="GHC.Types.Id.html#isDFunId"><span class="hs-identifier hs-var">isDFunId</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681071882"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">IsSafeImport -&gt; IsSafeImport -&gt; IsSafeImport
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Id -&gt; IsSafeImport
</span><a href="GHC.Types.Id.html#isImplicitId"><span class="hs-identifier hs-var">isImplicitId</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681071882"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1850"></span><span>            </span><span class="hs-comment">-- We only need to keep around the external bindings</span><span>
</span><span id="line-1851"></span><span>            </span><span class="hs-comment">-- (as decided by GHC.Iface.Tidy), since those are the only ones</span><span>
</span><span id="line-1852"></span><span>            </span><span class="hs-comment">-- that might later be looked up by name.  But we can exclude</span><span>
</span><span id="line-1853"></span><span>            </span><span class="hs-comment">--    - DFunIds, which are in 'cls_insts' (see Note [ic_tythings] in GHC.Driver.Types</span><span>
</span><span id="line-1854"></span><span>            </span><span class="hs-comment">--    - Implicit Ids, which are implicit in tcs</span><span>
</span><span id="line-1855"></span><span>            </span><span class="hs-comment">-- c.f. GHC.Tc.Module.runTcInteractive, which reconstructs the TypeEnv</span><span>
</span><span id="line-1856"></span><span>
</span><span id="line-1857"></span><span>        </span><span id="local-6989586621681071876"><span class="annot"><span class="annottext">new_tythings :: [TyThing]
</span><a href="#local-6989586621681071876"><span class="hs-identifier hs-var hs-var">new_tythings</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Id -&gt; TyThing) -&gt; [Id] -&gt; [TyThing]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; TyThing
</span><a href="GHC.Core.TyCo.Rep.html#AnId"><span class="hs-identifier hs-var">AnId</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681071883"><span class="hs-identifier hs-var">ext_ids</span></a></span><span> </span><span class="annot"><span class="annottext">[TyThing] -&gt; [TyThing] -&gt; [TyThing]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">(TyCon -&gt; TyThing) -&gt; [TyCon] -&gt; [TyThing]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TyThing
</span><a href="GHC.Core.TyCo.Rep.html#ATyCon"><span class="hs-identifier hs-var">ATyCon</span></a></span><span> </span><span class="annot"><span class="annottext">[TyCon]
</span><a href="#local-6989586621681071889"><span class="hs-identifier hs-var">tcs</span></a></span><span> </span><span class="annot"><span class="annottext">[TyThing] -&gt; [TyThing] -&gt; [TyThing]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">(PatSyn -&gt; TyThing) -&gt; [PatSyn] -&gt; [TyThing]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConLike -&gt; TyThing
</span><a href="GHC.Core.TyCo.Rep.html#AConLike"><span class="hs-identifier hs-var">AConLike</span></a></span><span> </span><span class="annot"><span class="annottext">(ConLike -&gt; TyThing) -&gt; (PatSyn -&gt; ConLike) -&gt; PatSyn -&gt; TyThing
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">PatSyn -&gt; ConLike
</span><a href="GHC.Core.ConLike.html#PatSynCon"><span class="hs-identifier hs-var">PatSynCon</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PatSyn]
</span><a href="#local-6989586621681071885"><span class="hs-identifier hs-var">patsyns</span></a></span><span>
</span><span id="line-1858"></span><span>        </span><span id="local-6989586621681071871"><span class="annot"><span class="annottext">ictxt :: InteractiveContext
</span><a href="#local-6989586621681071871"><span class="hs-identifier hs-var hs-var">ictxt</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; InteractiveContext
</span><a href="GHC.Driver.Types.html#hsc_IC"><span class="hs-identifier hs-var hs-var">hsc_IC</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071914"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-1859"></span><span>        </span><span class="hs-comment">-- See Note [Fixity declarations in GHCi]</span><span>
</span><span id="line-1860"></span><span>        </span><span id="local-6989586621681071870"><span class="annot"><span class="annottext">fix_env :: FixityEnv
</span><a href="#local-6989586621681071870"><span class="hs-identifier hs-var hs-var">fix_env</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; FixityEnv
</span><a href="GHC.Tc.Types.html#tcg_fix_env"><span class="hs-identifier hs-var hs-var">tcg_fix_env</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681071913"><span class="hs-identifier hs-var">tc_gblenv</span></a></span><span>
</span><span id="line-1861"></span><span>        </span><span id="local-6989586621681071868"><span class="annot"><span class="annottext">new_ictxt :: InteractiveContext
</span><a href="#local-6989586621681071868"><span class="hs-identifier hs-var hs-var">new_ictxt</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InteractiveContext
-&gt; [TyThing]
-&gt; [ClsInst]
-&gt; [FamInst]
-&gt; Maybe [Type]
-&gt; FixityEnv
-&gt; InteractiveContext
</span><a href="GHC.Driver.Types.html#extendInteractiveContext"><span class="hs-identifier hs-var">extendInteractiveContext</span></a></span><span> </span><span class="annot"><span class="annottext">InteractiveContext
</span><a href="#local-6989586621681071871"><span class="hs-identifier hs-var">ictxt</span></a></span><span> </span><span class="annot"><span class="annottext">[TyThing]
</span><a href="#local-6989586621681071876"><span class="hs-identifier hs-var">new_tythings</span></a></span><span> </span><span class="annot"><span class="annottext">[ClsInst]
</span><a href="#local-6989586621681071897"><span class="hs-identifier hs-var">cls_insts</span></a></span><span>
</span><span id="line-1862"></span><span>                                                </span><span class="annot"><span class="annottext">[FamInst]
</span><a href="#local-6989586621681071895"><span class="hs-identifier hs-var">fam_insts</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [Type]
</span><a href="#local-6989586621681071911"><span class="hs-identifier hs-var">defaults</span></a></span><span> </span><span class="annot"><span class="annottext">FixityEnv
</span><a href="#local-6989586621681071870"><span class="hs-identifier hs-var">fix_env</span></a></span><span>
</span><span id="line-1863"></span><span>    </span><span class="annot"><span class="annottext">([TyThing], InteractiveContext)
-&gt; Hsc ([TyThing], InteractiveContext)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyThing]
</span><a href="#local-6989586621681071876"><span class="hs-identifier hs-var">new_tythings</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">InteractiveContext
</span><a href="#local-6989586621681071868"><span class="hs-identifier hs-var">new_ictxt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1864"></span><span>
</span><span id="line-1865"></span><span class="hs-comment">-- | Load the given static-pointer table entries into the interpreter.</span><span>
</span><span id="line-1866"></span><span class="hs-comment">-- See Note [Grand plan for static forms] in &quot;GHC.Iface.Tidy.StaticPtrTable&quot;.</span><span>
</span><span id="line-1867"></span><span class="annot"><a href="GHC.Driver.Main.html#hscAddSptEntries"><span class="hs-identifier hs-type">hscAddSptEntries</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Runtime.Linker.Types.html#SptEntry"><span class="hs-identifier hs-type">SptEntry</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1868"></span><span id="hscAddSptEntries"><span class="annot"><span class="annottext">hscAddSptEntries :: HscEnv -&gt; [SptEntry] -&gt; IO ()
</span><a href="GHC.Driver.Main.html#hscAddSptEntries"><span class="hs-identifier hs-var hs-var">hscAddSptEntries</span></a></span></span><span> </span><span id="local-6989586621681071866"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071866"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681071865"><span class="annot"><span class="annottext">[SptEntry]
</span><a href="#local-6989586621681071865"><span class="hs-identifier hs-var">entries</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1869"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621681071864"><span class="hs-identifier hs-type">add_spt_entry</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Linker.Types.html#SptEntry"><span class="hs-identifier hs-type">SptEntry</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1870"></span><span>        </span><span id="local-6989586621681071864"><span class="annot"><span class="annottext">add_spt_entry :: SptEntry -&gt; IO ()
</span><a href="#local-6989586621681071864"><span class="hs-identifier hs-var hs-var">add_spt_entry</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Linker.Types.html#SptEntry"><span class="hs-identifier hs-type">SptEntry</span></a></span><span> </span><span id="local-6989586621681071862"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681071862"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621681071861"><span class="annot"><span class="annottext">Fingerprint
</span><a href="#local-6989586621681071861"><span class="hs-identifier hs-var">fpr</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1871"></span><span>            </span><span id="local-6989586621681071860"><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621681071860"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Name -&gt; IO ForeignHValue
</span><a href="GHC.Runtime.Linker.html#getHValue"><span class="hs-identifier hs-var">getHValue</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071866"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681071862"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1872"></span><span>            </span><span class="annot"><span class="annottext">HscEnv -&gt; Fingerprint -&gt; ForeignHValue -&gt; IO ()
</span><a href="GHC.Runtime.Interpreter.html#addSptEntry"><span class="hs-identifier hs-var">addSptEntry</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071866"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">Fingerprint
</span><a href="#local-6989586621681071861"><span class="hs-identifier hs-var">fpr</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621681071860"><span class="hs-identifier hs-var">val</span></a></span><span>
</span><span id="line-1873"></span><span>    </span><span class="annot"><span class="annottext">(SptEntry -&gt; IO ()) -&gt; [SptEntry] -&gt; IO ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><a href="../../base/src/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a></span><span> </span><span class="annot"><span class="annottext">SptEntry -&gt; IO ()
</span><a href="#local-6989586621681071864"><span class="hs-identifier hs-var">add_spt_entry</span></a></span><span> </span><span class="annot"><span class="annottext">[SptEntry]
</span><a href="#local-6989586621681071865"><span class="hs-identifier hs-var">entries</span></a></span><span>
</span><span id="line-1874"></span><span>
</span><span id="line-1875"></span><span class="hs-comment">{-
  Note [Fixity declarations in GHCi]
  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

  To support fixity declarations on types defined within GHCi (as requested
  in #10018) we record the fixity environment in InteractiveContext.
  When we want to evaluate something GHC.Tc.Module.runTcInteractive pulls out this
  fixity environment and uses it to initialize the global typechecker environment.
  After the typechecker has finished its business, an updated fixity environment
  (reflecting whatever fixity declarations were present in the statements we
  passed it) will be returned from hscParsedStmt. This is passed to
  updateFixityEnv, which will stuff it back into InteractiveContext, to be
  used in evaluating the next statement.

-}</span><span>
</span><span id="line-1890"></span><span>
</span><span id="line-1891"></span><span class="annot"><a href="GHC.Driver.Main.html#hscImport"><span class="hs-identifier hs-type">hscImport</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.ImpExp.html#ImportDecl"><span class="hs-identifier hs-type">ImportDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1892"></span><span id="hscImport"><span class="annot"><span class="annottext">hscImport :: HscEnv -&gt; String -&gt; IO (ImportDecl GhcPs)
</span><a href="GHC.Driver.Main.html#hscImport"><span class="hs-identifier hs-var hs-var">hscImport</span></a></span></span><span> </span><span id="local-6989586621681071858"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071858"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681071857"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681071857"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Hsc (ImportDecl GhcPs) -&gt; IO (ImportDecl GhcPs)
forall a. HscEnv -&gt; Hsc a -&gt; IO a
</span><a href="GHC.Driver.Types.html#runInteractiveHsc"><span class="hs-identifier hs-var">runInteractiveHsc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071858"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(Hsc (ImportDecl GhcPs) -&gt; IO (ImportDecl GhcPs))
-&gt; Hsc (ImportDecl GhcPs) -&gt; IO (ImportDecl GhcPs)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1893"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.html#HsModule"><span class="hs-identifier hs-type">HsModule</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">hsmodImports :: HsModule -&gt; [LImportDecl GhcPs]
</span><a href="GHC.Hs.html#hsmodImports"><span class="hs-identifier hs-var">hsmodImports</span></a></span><span class="hs-glyph">=</span><span id="local-6989586621681071855"><span class="annot"><span class="annottext">[LImportDecl GhcPs]
</span><a href="#local-6989586621681071855"><span class="hs-identifier hs-var">is</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1894"></span><span>       </span><span class="annot"><span class="annottext">P (Located HsModule) -&gt; String -&gt; Hsc (Located HsModule)
forall thing.
(Outputable thing, Data thing) =&gt;
P thing -&gt; String -&gt; Hsc thing
</span><a href="GHC.Driver.Main.html#hscParseThing"><span class="hs-identifier hs-var">hscParseThing</span></a></span><span> </span><span class="annot"><span class="annottext">P (Located HsModule)
</span><a href="GHC.Parser.html#parseModule"><span class="hs-identifier hs-var">parseModule</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681071857"><span class="hs-identifier hs-var">str</span></a></span><span>
</span><span id="line-1895"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[LImportDecl GhcPs]
</span><a href="#local-6989586621681071855"><span class="hs-identifier hs-var">is</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1896"></span><span>        </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681071853"><span class="annot"><span class="annottext">ImportDecl GhcPs
</span><a href="#local-6989586621681071853"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ImportDecl GhcPs -&gt; Hsc (ImportDecl GhcPs)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">ImportDecl GhcPs
</span><a href="#local-6989586621681071853"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-1897"></span><span>        </span><span class="annot"><span class="annottext">[LImportDecl GhcPs]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO (ImportDecl GhcPs) -&gt; Hsc (ImportDecl GhcPs)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (ImportDecl GhcPs) -&gt; Hsc (ImportDecl GhcPs))
-&gt; IO (ImportDecl GhcPs) -&gt; Hsc (ImportDecl GhcPs)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ErrMsg -&gt; IO (ImportDecl GhcPs)
forall (io :: * -&gt; *) a. MonadIO io =&gt; ErrMsg -&gt; io a
</span><a href="GHC.Driver.Types.html#throwOneError"><span class="hs-identifier hs-var">throwOneError</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrMsg -&gt; IO (ImportDecl GhcPs))
-&gt; ErrMsg -&gt; IO (ImportDecl GhcPs)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1898"></span><span>                 </span><span class="annot"><span class="annottext">DynFlags -&gt; SrcSpan -&gt; SDoc -&gt; ErrMsg
</span><a href="GHC.Utils.Error.html#mkPlainErrMsg"><span class="hs-identifier hs-var">mkPlainErrMsg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071858"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="GHC.Types.SrcLoc.html#noSrcSpan"><span class="hs-identifier hs-var">noSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; ErrMsg) -&gt; SDoc -&gt; ErrMsg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1899"></span><span>                     </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;parse error in import declaration&quot;</span></span><span>
</span><span id="line-1900"></span><span>
</span><span id="line-1901"></span><span class="hs-comment">-- | Typecheck an expression (but don't run it)</span><span>
</span><span id="line-1902"></span><span class="annot"><a href="GHC.Driver.Main.html#hscTcExpr"><span class="hs-identifier hs-type">hscTcExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-1903"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Module.html#TcRnExprMode"><span class="hs-identifier hs-type">TcRnExprMode</span></a></span><span>
</span><span id="line-1904"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-comment">-- ^ The expression</span><span>
</span><span id="line-1905"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-1906"></span><span id="hscTcExpr"><span class="annot"><span class="annottext">hscTcExpr :: HscEnv -&gt; TcRnExprMode -&gt; String -&gt; IO Type
</span><a href="GHC.Driver.Main.html#hscTcExpr"><span class="hs-identifier hs-var hs-var">hscTcExpr</span></a></span></span><span> </span><span id="local-6989586621681071852"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071852"><span class="hs-identifier hs-var">hsc_env0</span></a></span></span><span> </span><span id="local-6989586621681071851"><span class="annot"><span class="annottext">TcRnExprMode
</span><a href="#local-6989586621681071851"><span class="hs-identifier hs-var">mode</span></a></span></span><span> </span><span id="local-6989586621681071850"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681071850"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Hsc Type -&gt; IO Type
forall a. HscEnv -&gt; Hsc a -&gt; IO a
</span><a href="GHC.Driver.Types.html#runInteractiveHsc"><span class="hs-identifier hs-var">runInteractiveHsc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071852"><span class="hs-identifier hs-var">hsc_env0</span></a></span><span> </span><span class="annot"><span class="annottext">(Hsc Type -&gt; IO Type) -&gt; Hsc Type -&gt; IO Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1907"></span><span>  </span><span id="local-6989586621681071849"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071849"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc HscEnv
</span><a href="GHC.Driver.Main.html#getHscEnv"><span class="hs-identifier hs-var">getHscEnv</span></a></span><span>
</span><span id="line-1908"></span><span>  </span><span id="local-6989586621681071848"><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621681071848"><span class="hs-identifier hs-var">parsed_expr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; Hsc (LHsExpr GhcPs)
</span><a href="GHC.Driver.Main.html#hscParseExpr"><span class="hs-identifier hs-var">hscParseExpr</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681071850"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-1909"></span><span>  </span><span class="annot"><span class="annottext">IO ((WarningMessages, WarningMessages), Maybe Type) -&gt; Hsc Type
forall a. IO ((WarningMessages, WarningMessages), Maybe a) -&gt; Hsc a
</span><a href="GHC.Driver.Main.html#ioMsgMaybe"><span class="hs-identifier hs-var">ioMsgMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ((WarningMessages, WarningMessages), Maybe Type) -&gt; Hsc Type)
-&gt; IO ((WarningMessages, WarningMessages), Maybe Type) -&gt; Hsc Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; TcRnExprMode
-&gt; LHsExpr GhcPs
-&gt; IO ((WarningMessages, WarningMessages), Maybe Type)
</span><a href="GHC.Tc.Module.html#tcRnExpr"><span class="hs-identifier hs-var">tcRnExpr</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071849"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnExprMode
</span><a href="#local-6989586621681071851"><span class="hs-identifier hs-var">mode</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621681071848"><span class="hs-identifier hs-var">parsed_expr</span></a></span><span>
</span><span id="line-1910"></span><span>
</span><span id="line-1911"></span><span class="hs-comment">-- | Find the kind of a type, after generalisation</span><span>
</span><span id="line-1912"></span><span class="annot"><a href="GHC.Driver.Main.html#hscKcType"><span class="hs-identifier hs-type">hscKcType</span></a></span><span>
</span><span id="line-1913"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-1914"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>            </span><span class="hs-comment">-- ^ Normalise the type</span><span>
</span><span id="line-1915"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span>          </span><span class="hs-comment">-- ^ The type as a string</span><span>
</span><span id="line-1916"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Resulting type (possibly normalised) and kind</span><span>
</span><span id="line-1917"></span><span id="hscKcType"><span class="annot"><span class="annottext">hscKcType :: HscEnv -&gt; IsSafeImport -&gt; String -&gt; IO (Type, Type)
</span><a href="GHC.Driver.Main.html#hscKcType"><span class="hs-identifier hs-var hs-var">hscKcType</span></a></span></span><span> </span><span id="local-6989586621681071846"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071846"><span class="hs-identifier hs-var">hsc_env0</span></a></span></span><span> </span><span id="local-6989586621681071845"><span class="annot"><span class="annottext">IsSafeImport
</span><a href="#local-6989586621681071845"><span class="hs-identifier hs-var">normalise</span></a></span></span><span> </span><span id="local-6989586621681071844"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681071844"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Hsc (Type, Type) -&gt; IO (Type, Type)
forall a. HscEnv -&gt; Hsc a -&gt; IO a
</span><a href="GHC.Driver.Types.html#runInteractiveHsc"><span class="hs-identifier hs-var">runInteractiveHsc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071846"><span class="hs-identifier hs-var">hsc_env0</span></a></span><span> </span><span class="annot"><span class="annottext">(Hsc (Type, Type) -&gt; IO (Type, Type))
-&gt; Hsc (Type, Type) -&gt; IO (Type, Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1918"></span><span>    </span><span id="local-6989586621681071843"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071843"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc HscEnv
</span><a href="GHC.Driver.Main.html#getHscEnv"><span class="hs-identifier hs-var">getHscEnv</span></a></span><span>
</span><span id="line-1919"></span><span>    </span><span id="local-6989586621681071842"><span class="annot"><span class="annottext">LHsType GhcPs
</span><a href="#local-6989586621681071842"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; Hsc (LHsType GhcPs)
</span><a href="GHC.Driver.Main.html#hscParseType"><span class="hs-identifier hs-var">hscParseType</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681071844"><span class="hs-identifier hs-var">str</span></a></span><span>
</span><span id="line-1920"></span><span>    </span><span class="annot"><span class="annottext">IO ((WarningMessages, WarningMessages), Maybe (Type, Type))
-&gt; Hsc (Type, Type)
forall a. IO ((WarningMessages, WarningMessages), Maybe a) -&gt; Hsc a
</span><a href="GHC.Driver.Main.html#ioMsgMaybe"><span class="hs-identifier hs-var">ioMsgMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ((WarningMessages, WarningMessages), Maybe (Type, Type))
 -&gt; Hsc (Type, Type))
-&gt; IO ((WarningMessages, WarningMessages), Maybe (Type, Type))
-&gt; Hsc (Type, Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; ZonkFlexi
-&gt; IsSafeImport
-&gt; LHsType GhcPs
-&gt; IO ((WarningMessages, WarningMessages), Maybe (Type, Type))
</span><a href="GHC.Tc.Module.html#tcRnType"><span class="hs-identifier hs-var">tcRnType</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071843"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">ZonkFlexi
</span><a href="GHC.Tc.Utils.Zonk.html#DefaultFlexi"><span class="hs-identifier hs-var">DefaultFlexi</span></a></span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><a href="#local-6989586621681071845"><span class="hs-identifier hs-var">normalise</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcPs
</span><a href="#local-6989586621681071842"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1921"></span><span>
</span><span id="line-1922"></span><span class="annot"><a href="GHC.Driver.Main.html#hscParseExpr"><span class="hs-identifier hs-type">hscParseExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1923"></span><span id="hscParseExpr"><span class="annot"><span class="annottext">hscParseExpr :: String -&gt; Hsc (LHsExpr GhcPs)
</span><a href="GHC.Driver.Main.html#hscParseExpr"><span class="hs-identifier hs-var hs-var">hscParseExpr</span></a></span></span><span> </span><span id="local-6989586621681071840"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681071840"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1924"></span><span>  </span><span id="local-6989586621681071839"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071839"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc HscEnv
</span><a href="GHC.Driver.Main.html#getHscEnv"><span class="hs-identifier hs-var">getHscEnv</span></a></span><span>
</span><span id="line-1925"></span><span>  </span><span id="local-6989586621681071838"><span class="annot"><span class="annottext">Maybe (LStmt GhcPs (LHsExpr GhcPs))
</span><a href="#local-6989586621681071838"><span class="hs-identifier hs-var">maybe_stmt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">String -&gt; Hsc (Maybe (LStmt GhcPs (LHsExpr GhcPs)))
</span><a href="GHC.Driver.Main.html#hscParseStmt"><span class="hs-identifier hs-var">hscParseStmt</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681071840"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-1926"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (LStmt GhcPs (LHsExpr GhcPs))
</span><a href="#local-6989586621681071838"><span class="hs-identifier hs-var">maybe_stmt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1927"></span><span>    </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#BodyStmt"><span class="hs-identifier hs-type">BodyStmt</span></a></span><span> </span><span class="annot"><span class="annottext">XBodyStmt GhcPs GhcPs (LHsExpr GhcPs)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681071835"><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621681071835"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcPs
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs -&gt; Hsc (LHsExpr GhcPs)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621681071835"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-1928"></span><span>    </span><span class="annot"><span class="annottext">Maybe (LStmt GhcPs (LHsExpr GhcPs))
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ErrMsg -&gt; Hsc (LHsExpr GhcPs)
forall (io :: * -&gt; *) a. MonadIO io =&gt; ErrMsg -&gt; io a
</span><a href="GHC.Driver.Types.html#throwOneError"><span class="hs-identifier hs-var">throwOneError</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrMsg -&gt; Hsc (LHsExpr GhcPs)) -&gt; ErrMsg -&gt; Hsc (LHsExpr GhcPs)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; SrcSpan -&gt; SDoc -&gt; ErrMsg
</span><a href="GHC.Utils.Error.html#mkPlainErrMsg"><span class="hs-identifier hs-var">mkPlainErrMsg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071839"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="GHC.Types.SrcLoc.html#noSrcSpan"><span class="hs-identifier hs-var">noSrcSpan</span></a></span><span>
</span><span id="line-1929"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;not an expression:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681071840"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1930"></span><span>
</span><span id="line-1931"></span><span class="annot"><a href="GHC.Driver.Main.html#hscParseStmt"><span class="hs-identifier hs-type">hscParseStmt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#GhciLStmt"><span class="hs-identifier hs-type">GhciLStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1932"></span><span id="hscParseStmt"><span class="annot"><span class="annottext">hscParseStmt :: String -&gt; Hsc (Maybe (LStmt GhcPs (LHsExpr GhcPs)))
</span><a href="GHC.Driver.Main.html#hscParseStmt"><span class="hs-identifier hs-var hs-var">hscParseStmt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">P (Maybe (LStmt GhcPs (LHsExpr GhcPs)))
-&gt; String -&gt; Hsc (Maybe (LStmt GhcPs (LHsExpr GhcPs)))
forall thing.
(Outputable thing, Data thing) =&gt;
P thing -&gt; String -&gt; Hsc thing
</span><a href="GHC.Driver.Main.html#hscParseThing"><span class="hs-identifier hs-var">hscParseThing</span></a></span><span> </span><span class="annot"><span class="annottext">P (Maybe (LStmt GhcPs (LHsExpr GhcPs)))
</span><a href="GHC.Parser.html#parseStmt"><span class="hs-identifier hs-var">parseStmt</span></a></span><span>
</span><span id="line-1933"></span><span>
</span><span id="line-1934"></span><span class="annot"><a href="GHC.Driver.Main.html#hscParseStmtWithLocation"><span class="hs-identifier hs-type">hscParseStmtWithLocation</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span>
</span><span id="line-1935"></span><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#GhciLStmt"><span class="hs-identifier hs-type">GhciLStmt</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1936"></span><span id="hscParseStmtWithLocation"><span class="annot"><span class="annottext">hscParseStmtWithLocation :: String
-&gt; Int -&gt; String -&gt; Hsc (Maybe (LStmt GhcPs (LHsExpr GhcPs)))
</span><a href="GHC.Driver.Main.html#hscParseStmtWithLocation"><span class="hs-identifier hs-var hs-var">hscParseStmtWithLocation</span></a></span></span><span> </span><span id="local-6989586621681071833"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681071833"><span class="hs-identifier hs-var">source</span></a></span></span><span> </span><span id="local-6989586621681071832"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681071832"><span class="hs-identifier hs-var">linenumber</span></a></span></span><span> </span><span id="local-6989586621681071831"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681071831"><span class="hs-identifier hs-var">stmt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1937"></span><span>    </span><span class="annot"><span class="annottext">String
-&gt; Int
-&gt; P (Maybe (LStmt GhcPs (LHsExpr GhcPs)))
-&gt; String
-&gt; Hsc (Maybe (LStmt GhcPs (LHsExpr GhcPs)))
forall thing.
(Outputable thing, Data thing) =&gt;
String -&gt; Int -&gt; P thing -&gt; String -&gt; Hsc thing
</span><a href="GHC.Driver.Main.html#hscParseThingWithLocation"><span class="hs-identifier hs-var">hscParseThingWithLocation</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681071833"><span class="hs-identifier hs-var">source</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681071832"><span class="hs-identifier hs-var">linenumber</span></a></span><span> </span><span class="annot"><span class="annottext">P (Maybe (LStmt GhcPs (LHsExpr GhcPs)))
</span><a href="GHC.Parser.html#parseStmt"><span class="hs-identifier hs-var">parseStmt</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681071831"><span class="hs-identifier hs-var">stmt</span></a></span><span>
</span><span id="line-1938"></span><span>
</span><span id="line-1939"></span><span class="annot"><a href="GHC.Driver.Main.html#hscParseType"><span class="hs-identifier hs-type">hscParseType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Type.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1940"></span><span id="hscParseType"><span class="annot"><span class="annottext">hscParseType :: String -&gt; Hsc (LHsType GhcPs)
</span><a href="GHC.Driver.Main.html#hscParseType"><span class="hs-identifier hs-var hs-var">hscParseType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">P (LHsType GhcPs) -&gt; String -&gt; Hsc (LHsType GhcPs)
forall thing.
(Outputable thing, Data thing) =&gt;
P thing -&gt; String -&gt; Hsc thing
</span><a href="GHC.Driver.Main.html#hscParseThing"><span class="hs-identifier hs-var">hscParseThing</span></a></span><span> </span><span class="annot"><span class="annottext">P (LHsType GhcPs)
</span><a href="GHC.Parser.html#parseType"><span class="hs-identifier hs-var">parseType</span></a></span><span>
</span><span id="line-1941"></span><span>
</span><span id="line-1942"></span><span class="annot"><a href="GHC.Driver.Main.html#hscParseIdentifier"><span class="hs-identifier hs-type">hscParseIdentifier</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1943"></span><span id="hscParseIdentifier"><span class="annot"><span class="annottext">hscParseIdentifier :: HscEnv -&gt; String -&gt; IO (Located RdrName)
</span><a href="GHC.Driver.Main.html#hscParseIdentifier"><span class="hs-identifier hs-var hs-var">hscParseIdentifier</span></a></span></span><span> </span><span id="local-6989586621681071829"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071829"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681071828"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681071828"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1944"></span><span>    </span><span class="annot"><span class="annottext">HscEnv -&gt; Hsc (Located RdrName) -&gt; IO (Located RdrName)
forall a. HscEnv -&gt; Hsc a -&gt; IO a
</span><a href="GHC.Driver.Types.html#runInteractiveHsc"><span class="hs-identifier hs-var">runInteractiveHsc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071829"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(Hsc (Located RdrName) -&gt; IO (Located RdrName))
-&gt; Hsc (Located RdrName) -&gt; IO (Located RdrName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">P (Located RdrName) -&gt; String -&gt; Hsc (Located RdrName)
forall thing.
(Outputable thing, Data thing) =&gt;
P thing -&gt; String -&gt; Hsc thing
</span><a href="GHC.Driver.Main.html#hscParseThing"><span class="hs-identifier hs-var">hscParseThing</span></a></span><span> </span><span class="annot"><span class="annottext">P (Located RdrName)
</span><a href="GHC.Parser.html#parseIdentifier"><span class="hs-identifier hs-var">parseIdentifier</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681071828"><span class="hs-identifier hs-var">str</span></a></span><span>
</span><span id="line-1945"></span><span>
</span><span id="line-1946"></span><span id="local-6989586621681073536"><span class="annot"><a href="GHC.Driver.Main.html#hscParseThing"><span class="hs-identifier hs-type">hscParseThing</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681073536"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base/src/Data.Data.html#Data"><span class="hs-identifier hs-type">Data</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681073536"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1947"></span><span>              </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Parser.Lexer.html#P"><span class="hs-identifier hs-type">Lexer.P</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681073536"><span class="hs-identifier hs-type">thing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681073536"><span class="hs-identifier hs-type">thing</span></a></span></span><span>
</span><span id="line-1948"></span><span id="hscParseThing"><span class="annot"><span class="annottext">hscParseThing :: forall thing.
(Outputable thing, Data thing) =&gt;
P thing -&gt; String -&gt; Hsc thing
</span><a href="GHC.Driver.Main.html#hscParseThing"><span class="hs-identifier hs-var hs-var">hscParseThing</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Int -&gt; P thing -&gt; String -&gt; Hsc thing
forall thing.
(Outputable thing, Data thing) =&gt;
String -&gt; Int -&gt; P thing -&gt; String -&gt; Hsc thing
</span><a href="GHC.Driver.Main.html#hscParseThingWithLocation"><span class="hs-identifier hs-var">hscParseThingWithLocation</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;&lt;interactive&gt;&quot;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-1949"></span><span>
</span><span id="line-1950"></span><span id="local-6989586621681073542"><span class="annot"><a href="GHC.Driver.Main.html#hscParseThingWithLocation"><span class="hs-identifier hs-type">hscParseThingWithLocation</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681073542"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base/src/Data.Data.html#Data"><span class="hs-identifier hs-type">Data</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681073542"><span class="hs-identifier hs-type">thing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-1951"></span><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Parser.Lexer.html#P"><span class="hs-identifier hs-type">Lexer.P</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681073542"><span class="hs-identifier hs-type">thing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#Hsc"><span class="hs-identifier hs-type">Hsc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681073542"><span class="hs-identifier hs-type">thing</span></a></span></span><span>
</span><span id="line-1952"></span><span id="hscParseThingWithLocation"><span class="annot"><span class="annottext">hscParseThingWithLocation :: forall thing.
(Outputable thing, Data thing) =&gt;
String -&gt; Int -&gt; P thing -&gt; String -&gt; Hsc thing
</span><a href="GHC.Driver.Main.html#hscParseThingWithLocation"><span class="hs-identifier hs-var hs-var">hscParseThingWithLocation</span></a></span></span><span> </span><span id="local-6989586621681071808"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681071808"><span class="hs-identifier hs-var">source</span></a></span></span><span> </span><span id="local-6989586621681071807"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681071807"><span class="hs-identifier hs-var">linenumber</span></a></span></span><span> </span><span id="local-6989586621681071806"><span class="annot"><span class="annottext">P thing
</span><a href="#local-6989586621681071806"><span class="hs-identifier hs-var">parser</span></a></span></span><span> </span><span id="local-6989586621681071805"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681071805"><span class="hs-identifier hs-var">str</span></a></span></span><span>
</span><span id="line-1953"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; (thing -&gt; ()) -&gt; Hsc thing -&gt; Hsc thing
forall (m :: * -&gt; *) a.
(MonadIO m, HasDynFlags m) =&gt;
SDoc -&gt; (a -&gt; ()) -&gt; m a -&gt; m a
</span><a href="GHC.Utils.Error.html#withTimingD"><span class="hs-identifier hs-var">withTimingD</span></a></span><span>
</span><span id="line-1954"></span><span>               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Parser [source]&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1955"></span><span>               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; thing -&gt; ()
forall a b. a -&gt; b -&gt; a
</span><a href="../../base/src/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Hsc thing -&gt; Hsc thing) -&gt; Hsc thing -&gt; Hsc thing
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-pragma">{-# SCC</span><span> </span><span class="hs-pragma">&quot;Parser&quot;</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1956"></span><span>    </span><span id="local-6989586621681071804"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681071804"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Hsc DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-1957"></span><span>
</span><span id="line-1958"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681071803"><span class="annot"><span class="annottext">buf :: StringBuffer
</span><a href="#local-6989586621681071803"><span class="hs-identifier hs-var hs-var">buf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; StringBuffer
</span><a href="GHC.Data.StringBuffer.html#stringToStringBuffer"><span class="hs-identifier hs-var">stringToStringBuffer</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681071805"><span class="hs-identifier hs-var">str</span></a></span><span>
</span><span id="line-1959"></span><span>        </span><span id="local-6989586621681071801"><span class="annot"><span class="annottext">loc :: RealSrcLoc
</span><a href="#local-6989586621681071801"><span class="hs-identifier hs-var hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; Int -&gt; Int -&gt; RealSrcLoc
</span><a href="GHC.Types.SrcLoc.html#mkRealSrcLoc"><span class="hs-identifier hs-var">mkRealSrcLoc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681071808"><span class="hs-identifier hs-var">source</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681071807"><span class="hs-identifier hs-var">linenumber</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span>
</span><span id="line-1960"></span><span>
</span><span id="line-1961"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">P thing -&gt; PState -&gt; ParseResult thing
forall a. P a -&gt; PState -&gt; ParseResult a
</span><a href="GHC.Parser.Lexer.html#unP"><span class="hs-identifier hs-var hs-var">unP</span></a></span><span> </span><span class="annot"><span class="annottext">P thing
</span><a href="#local-6989586621681071806"><span class="hs-identifier hs-var">parser</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; StringBuffer -&gt; RealSrcLoc -&gt; PState
</span><a href="GHC.Parser.Lexer.html#mkPState"><span class="hs-identifier hs-var">mkPState</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681071804"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">StringBuffer
</span><a href="#local-6989586621681071803"><span class="hs-identifier hs-var">buf</span></a></span><span> </span><span class="annot"><span class="annottext">RealSrcLoc
</span><a href="#local-6989586621681071801"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1962"></span><span>        </span><span class="annot"><a href="GHC.Parser.Lexer.html#PFailed"><span class="hs-identifier hs-type">PFailed</span></a></span><span> </span><span id="local-6989586621681071799"><span class="annot"><span class="annottext">PState
</span><a href="#local-6989586621681071799"><span class="hs-identifier hs-var">pst</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1963"></span><span>            </span><span class="annot"><span class="annottext">(WarningMessages, WarningMessages) -&gt; Hsc thing
forall a. (WarningMessages, WarningMessages) -&gt; Hsc a
</span><a href="GHC.Driver.Main.html#handleWarningsThrowErrors"><span class="hs-identifier hs-var">handleWarningsThrowErrors</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PState -&gt; DynFlags -&gt; (WarningMessages, WarningMessages)
</span><a href="GHC.Parser.Lexer.html#getMessages"><span class="hs-identifier hs-var">getMessages</span></a></span><span> </span><span class="annot"><span class="annottext">PState
</span><a href="#local-6989586621681071799"><span class="hs-identifier hs-var">pst</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681071804"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1964"></span><span>
</span><span id="line-1965"></span><span>        </span><span class="annot"><a href="GHC.Parser.Lexer.html#POk"><span class="hs-identifier hs-type">POk</span></a></span><span> </span><span id="local-6989586621681071798"><span class="annot"><span class="annottext">PState
</span><a href="#local-6989586621681071798"><span class="hs-identifier hs-var">pst</span></a></span></span><span> </span><span id="local-6989586621681071797"><span class="annot"><span class="annottext">thing
</span><a href="#local-6989586621681071797"><span class="hs-identifier hs-var">thing</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1966"></span><span>            </span><span class="annot"><span class="annottext">(WarningMessages, WarningMessages) -&gt; Hsc ()
</span><a href="GHC.Driver.Main.html#logWarningsReportErrors"><span class="hs-identifier hs-var">logWarningsReportErrors</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PState -&gt; DynFlags -&gt; (WarningMessages, WarningMessages)
</span><a href="GHC.Parser.Lexer.html#getMessages"><span class="hs-identifier hs-var">getMessages</span></a></span><span> </span><span class="annot"><span class="annottext">PState
</span><a href="#local-6989586621681071798"><span class="hs-identifier hs-var">pst</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681071804"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1967"></span><span>            </span><span class="annot"><span class="annottext">IO () -&gt; Hsc ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; Hsc ()) -&gt; IO () -&gt; Hsc ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; DumpFlag -&gt; String -&gt; DumpFormat -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#dumpIfSet_dyn"><span class="hs-identifier hs-var">dumpIfSet_dyn</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681071804"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_parsed"><span class="hs-identifier hs-var">Opt_D_dump_parsed</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Parser&quot;</span></span><span>
</span><span id="line-1968"></span><span>                        </span><span class="annot"><span class="annottext">DumpFormat
</span><a href="GHC.Utils.Error.html#FormatHaskell"><span class="hs-identifier hs-var">FormatHaskell</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">thing -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">thing
</span><a href="#local-6989586621681071797"><span class="hs-identifier hs-var">thing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1969"></span><span>            </span><span class="annot"><span class="annottext">IO () -&gt; Hsc ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; Hsc ()) -&gt; IO () -&gt; Hsc ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; DumpFlag -&gt; String -&gt; DumpFormat -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#dumpIfSet_dyn"><span class="hs-identifier hs-var">dumpIfSet_dyn</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681071804"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_parsed_ast"><span class="hs-identifier hs-var">Opt_D_dump_parsed_ast</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Parser AST&quot;</span></span><span>
</span><span id="line-1970"></span><span>                        </span><span class="annot"><span class="annottext">DumpFormat
</span><a href="GHC.Utils.Error.html#FormatHaskell"><span class="hs-identifier hs-var">FormatHaskell</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BlankSrcSpan -&gt; thing -&gt; SDoc
forall a. Data a =&gt; BlankSrcSpan -&gt; a -&gt; SDoc
</span><a href="GHC.Hs.Dump.html#showAstData"><span class="hs-identifier hs-var">showAstData</span></a></span><span> </span><span class="annot"><span class="annottext">BlankSrcSpan
</span><a href="GHC.Hs.Dump.html#NoBlankSrcSpan"><span class="hs-identifier hs-var">NoBlankSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">thing
</span><a href="#local-6989586621681071797"><span class="hs-identifier hs-var">thing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1971"></span><span>            </span><span class="annot"><span class="annottext">thing -&gt; Hsc thing
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">thing
</span><a href="#local-6989586621681071797"><span class="hs-identifier hs-var">thing</span></a></span><span>
</span><span id="line-1972"></span><span>
</span><span id="line-1973"></span><span>
</span><span id="line-1974"></span><span class="hs-comment">{- **********************************************************************
%*                                                                      *
        Desugar, simplify, convert to bytecode, and link an expression
%*                                                                      *
%********************************************************************* -}</span><span>
</span><span id="line-1979"></span><span>
</span><span id="line-1980"></span><span class="annot"><a href="GHC.Driver.Main.html#hscCompileCoreExpr"><span class="hs-identifier hs-type">hscCompileCoreExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="../../ghci/src/GHCi.RemoteTypes.html#ForeignHValue"><span class="hs-identifier hs-type">ForeignHValue</span></a></span><span>
</span><span id="line-1981"></span><span id="hscCompileCoreExpr"><span class="annot"><span class="annottext">hscCompileCoreExpr :: HscEnv -&gt; SrcSpan -&gt; CoreExpr -&gt; IO ForeignHValue
</span><a href="GHC.Driver.Main.html#hscCompileCoreExpr"><span class="hs-identifier hs-var hs-var">hscCompileCoreExpr</span></a></span></span><span> </span><span id="local-6989586621681071796"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071796"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1982"></span><span>  </span><span class="annot"><span class="annottext">(Hooks
 -&gt; Maybe (HscEnv -&gt; SrcSpan -&gt; CoreExpr -&gt; IO ForeignHValue))
-&gt; (HscEnv -&gt; SrcSpan -&gt; CoreExpr -&gt; IO ForeignHValue)
-&gt; DynFlags
-&gt; HscEnv
-&gt; SrcSpan
-&gt; CoreExpr
-&gt; IO ForeignHValue
forall a. (Hooks -&gt; Maybe a) -&gt; a -&gt; DynFlags -&gt; a
</span><a href="GHC.Driver.Hooks.html#lookupHook"><span class="hs-identifier hs-var">lookupHook</span></a></span><span> </span><span class="annot"><span class="annottext">Hooks -&gt; Maybe (HscEnv -&gt; SrcSpan -&gt; CoreExpr -&gt; IO ForeignHValue)
</span><a href="GHC.Driver.Hooks.html#hscCompileCoreExprHook"><span class="hs-identifier hs-var hs-var">hscCompileCoreExprHook</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; SrcSpan -&gt; CoreExpr -&gt; IO ForeignHValue
</span><a href="GHC.Driver.Main.html#hscCompileCoreExpr%27"><span class="hs-identifier hs-var">hscCompileCoreExpr'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071796"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071796"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-1983"></span><span>
</span><span id="line-1984"></span><span class="annot"><a href="GHC.Driver.Main.html#hscCompileCoreExpr%27"><span class="hs-identifier hs-type">hscCompileCoreExpr'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.html#CoreExpr"><span class="hs-identifier hs-type">CoreExpr</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="../../ghci/src/GHCi.RemoteTypes.html#ForeignHValue"><span class="hs-identifier hs-type">ForeignHValue</span></a></span><span>
</span><span id="line-1985"></span><span id="hscCompileCoreExpr%27"><span class="annot"><span class="annottext">hscCompileCoreExpr' :: HscEnv -&gt; SrcSpan -&gt; CoreExpr -&gt; IO ForeignHValue
</span><a href="GHC.Driver.Main.html#hscCompileCoreExpr%27"><span class="hs-identifier hs-var hs-var">hscCompileCoreExpr'</span></a></span></span><span> </span><span id="local-6989586621681071794"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071794"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681071793"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681071793"><span class="hs-identifier hs-var">srcspan</span></a></span></span><span> </span><span id="local-6989586621681071792"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621681071792"><span class="hs-identifier hs-var">ds_expr</span></a></span></span><span>
</span><span id="line-1986"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">{- Simplify it -}</span><span>
</span><span id="line-1987"></span><span>           </span><span id="local-6989586621681071791"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621681071791"><span class="hs-identifier hs-var">simpl_expr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; CoreExpr -&gt; IO CoreExpr
</span><a href="GHC.Core.Opt.Pipeline.html#simplifyExpr"><span class="hs-identifier hs-var">simplifyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071794"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621681071792"><span class="hs-identifier hs-var">ds_expr</span></a></span><span>
</span><span id="line-1988"></span><span>
</span><span id="line-1989"></span><span>           </span><span class="hs-comment">{- Tidy it (temporary, until coreSat does cloning) -}</span><span>
</span><span id="line-1990"></span><span>         </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681071789"><span class="annot"><span class="annottext">tidy_expr :: CoreExpr
</span><a href="#local-6989586621681071789"><span class="hs-identifier hs-var hs-var">tidy_expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; CoreExpr -&gt; CoreExpr
</span><a href="GHC.Core.Tidy.html#tidyExpr"><span class="hs-identifier hs-var">tidyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="GHC.Types.Var.Env.html#emptyTidyEnv"><span class="hs-identifier hs-var">emptyTidyEnv</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621681071791"><span class="hs-identifier hs-var">simpl_expr</span></a></span><span>
</span><span id="line-1991"></span><span>
</span><span id="line-1992"></span><span>           </span><span class="hs-comment">{- Prepare for codegen -}</span><span>
</span><span id="line-1993"></span><span>         </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681071788"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621681071788"><span class="hs-identifier hs-var">prepd_expr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; CoreExpr -&gt; IO CoreExpr
</span><a href="GHC.CoreToStg.Prep.html#corePrepExpr"><span class="hs-identifier hs-var">corePrepExpr</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071794"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621681071789"><span class="hs-identifier hs-var">tidy_expr</span></a></span><span>
</span><span id="line-1994"></span><span>
</span><span id="line-1995"></span><span>           </span><span class="hs-comment">{- Lint if necessary -}</span><span>
</span><span id="line-1996"></span><span>         </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; HscEnv -&gt; CoreExpr -&gt; IO ()
</span><a href="GHC.Core.Lint.html#lintInteractiveExpr"><span class="hs-identifier hs-var">lintInteractiveExpr</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;hscCompileExpr&quot;</span></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071794"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621681071788"><span class="hs-identifier hs-var">prepd_expr</span></a></span><span>
</span><span id="line-1997"></span><span>
</span><span id="line-1998"></span><span>           </span><span class="hs-comment">{- Convert to BCOs -}</span><span>
</span><span id="line-1999"></span><span>         </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681071786"><span class="annot"><span class="annottext">UnlinkedBCO
</span><a href="#local-6989586621681071786"><span class="hs-identifier hs-var">bcos</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Module -&gt; CoreExpr -&gt; IO UnlinkedBCO
</span><a href="GHC.CoreToByteCode.html#coreExprToBCOs"><span class="hs-identifier hs-var">coreExprToBCOs</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071794"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2000"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InteractiveContext -&gt; Module
</span><a href="GHC.Driver.Types.html#icInteractiveModule"><span class="hs-identifier hs-var">icInteractiveModule</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; InteractiveContext
</span><a href="GHC.Driver.Types.html#hsc_IC"><span class="hs-identifier hs-var hs-var">hsc_IC</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071794"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621681071788"><span class="hs-identifier hs-var">prepd_expr</span></a></span><span>
</span><span id="line-2001"></span><span>
</span><span id="line-2002"></span><span>           </span><span class="hs-comment">{- link it -}</span><span>
</span><span id="line-2003"></span><span>         </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681071784"><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621681071784"><span class="hs-identifier hs-var">hval</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; SrcSpan -&gt; UnlinkedBCO -&gt; IO ForeignHValue
</span><a href="GHC.Runtime.Linker.html#linkExpr"><span class="hs-identifier hs-var">linkExpr</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071794"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681071793"><span class="hs-identifier hs-var">srcspan</span></a></span><span> </span><span class="annot"><span class="annottext">UnlinkedBCO
</span><a href="#local-6989586621681071786"><span class="hs-identifier hs-var">bcos</span></a></span><span>
</span><span id="line-2004"></span><span>
</span><span id="line-2005"></span><span>         </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">ForeignHValue -&gt; IO ForeignHValue
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621681071784"><span class="hs-identifier hs-var">hval</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2006"></span><span>
</span><span id="line-2007"></span><span>
</span><span id="line-2008"></span><span class="hs-comment">{- **********************************************************************
%*                                                                      *
        Statistics on reading interfaces
%*                                                                      *
%********************************************************************* -}</span><span>
</span><span id="line-2013"></span><span>
</span><span id="line-2014"></span><span class="annot"><a href="GHC.Driver.Main.html#dumpIfaceStats"><span class="hs-identifier hs-type">dumpIfaceStats</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2015"></span><span id="dumpIfaceStats"><span class="annot"><span class="annottext">dumpIfaceStats :: HscEnv -&gt; IO ()
</span><a href="GHC.Driver.Main.html#dumpIfaceStats"><span class="hs-identifier hs-var hs-var">dumpIfaceStats</span></a></span></span><span> </span><span id="local-6989586621681071782"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071782"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2016"></span><span>    </span><span id="local-6989586621681071781"><span class="annot"><span class="annottext">ExternalPackageState
</span><a href="#local-6989586621681071781"><span class="hs-identifier hs-var">eps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef ExternalPackageState -&gt; IO ExternalPackageState
forall a. IORef a -&gt; IO a
</span><a href="../../base/src/GHC.IORef.html#readIORef"><span class="hs-identifier hs-var">readIORef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; IORef ExternalPackageState
</span><a href="GHC.Driver.Types.html#hsc_EPS"><span class="hs-identifier hs-var hs-var">hsc_EPS</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071782"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2017"></span><span>    </span><span class="annot"><span class="annottext">DynFlags -&gt; IsSafeImport -&gt; String -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#dumpIfSet"><span class="hs-identifier hs-var">dumpIfSet</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681071779"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsSafeImport
</span><a href="#local-6989586621681071778"><span class="hs-identifier hs-var">dump_if_trace</span></a></span><span> </span><span class="annot"><span class="annottext">IsSafeImport -&gt; IsSafeImport -&gt; IsSafeImport
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">IsSafeImport
</span><a href="#local-6989586621681071777"><span class="hs-identifier hs-var">dump_rn_stats</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2018"></span><span>              </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Interface statistics&quot;</span></span><span>
</span><span id="line-2019"></span><span>              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExternalPackageState -&gt; SDoc
</span><a href="GHC.Iface.Load.html#ifaceStats"><span class="hs-identifier hs-var">ifaceStats</span></a></span><span> </span><span class="annot"><span class="annottext">ExternalPackageState
</span><a href="#local-6989586621681071781"><span class="hs-identifier hs-var">eps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2020"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2021"></span><span>    </span><span id="local-6989586621681071779"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621681071779"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681071782"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2022"></span><span>    </span><span id="local-6989586621681071777"><span class="annot"><span class="annottext">dump_rn_stats :: IsSafeImport
</span><a href="#local-6989586621681071777"><span class="hs-identifier hs-var hs-var">dump_rn_stats</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DumpFlag -&gt; DynFlags -&gt; IsSafeImport
</span><a href="GHC.Driver.Session.html#dopt"><span class="hs-identifier hs-var">dopt</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_rn_stats"><span class="hs-identifier hs-var">Opt_D_dump_rn_stats</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681071779"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-2023"></span><span>    </span><span id="local-6989586621681071778"><span class="annot"><span class="annottext">dump_if_trace :: IsSafeImport
</span><a href="#local-6989586621681071778"><span class="hs-identifier hs-var hs-var">dump_if_trace</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DumpFlag -&gt; DynFlags -&gt; IsSafeImport
</span><a href="GHC.Driver.Session.html#dopt"><span class="hs-identifier hs-var">dopt</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_if_trace"><span class="hs-identifier hs-var">Opt_D_dump_if_trace</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681071779"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-2024"></span><span>
</span><span id="line-2025"></span><span>
</span><span id="line-2026"></span><span class="hs-comment">{- **********************************************************************
%*                                                                      *
        Progress Messages: Module i of n
%*                                                                      *
%********************************************************************* -}</span><span>
</span><span id="line-2031"></span><span>
</span><span id="line-2032"></span><span class="annot"><a href="GHC.Driver.Main.html#showModuleIndex"><span class="hs-identifier hs-type">showModuleIndex</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span>
</span><span id="line-2033"></span><span id="showModuleIndex"><span class="annot"><span class="annottext">showModuleIndex :: (Int, Int) -&gt; String
</span><a href="GHC.Driver.Main.html#showModuleIndex"><span class="hs-identifier hs-var hs-var">showModuleIndex</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681071773"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681071773"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681071772"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681071772"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;[&quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681071771"><span class="hs-identifier hs-var">padded</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot; of &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681071770"><span class="hs-identifier hs-var">n_str</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;] &quot;</span></span><span>
</span><span id="line-2034"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2035"></span><span>    </span><span id="local-6989586621681071770"><span class="annot"><span class="annottext">n_str :: String
</span><a href="#local-6989586621681071770"><span class="hs-identifier hs-var hs-var">n_str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../base/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681071772"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-2036"></span><span>    </span><span id="local-6989586621681071765"><span class="annot"><span class="annottext">i_str :: String
</span><a href="#local-6989586621681071765"><span class="hs-identifier hs-var hs-var">i_str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../base/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681071773"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-2037"></span><span>    </span><span id="local-6989586621681071771"><span class="annot"><span class="annottext">padded :: String
</span><a href="#local-6989586621681071771"><span class="hs-identifier hs-var hs-var">padded</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Char -&gt; String
forall a. Int -&gt; a -&gt; [a]
</span><a href="../../base/src/GHC.List.html#replicate"><span class="hs-identifier hs-var">replicate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681071770"><span class="hs-identifier hs-var">n_str</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base/src/GHC.Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681071765"><span class="hs-identifier hs-var">i_str</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">' '</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681071765"><span class="hs-identifier hs-var">i_str</span></a></span><span>
</span><span id="line-2038"></span></pre></body></html>