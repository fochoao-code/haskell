<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-
%
(c) The University of Glasgow 2006
(c) The GRASP/AQUA Project, Glasgow University, 1992-1998

-}</span><span>
</span><span id="line-7"></span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE CPP, TupleSections, ScopedTypeVariables #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE FlexibleContexts #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies, DataKinds, TypeApplications #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE UndecidableInstances #-}</span><span> </span><span class="hs-comment">-- Wrinkle in Note [Trees That Grow]</span><span>
</span><span id="line-12"></span><span>                                      </span><span class="hs-comment">-- in module GHC.Hs.Extension</span><span>
</span><span id="line-13"></span><span>
</span><span id="line-14"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-incomplete-uni-patterns   #-}</span><span>
</span><span id="line-15"></span><span>
</span><span id="line-16"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">GHC.Tc.Gen.Expr</span><span>
</span><span id="line-17"></span><span>       </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExpr"><span class="hs-identifier">tcCheckPolyExpr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-18"></span><span>         </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcCheckMonoExpr"><span class="hs-identifier">tcCheckMonoExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcCheckMonoExprNC"><span class="hs-identifier">tcCheckMonoExprNC</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcMonoExpr"><span class="hs-identifier">tcMonoExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcMonoExprNC"><span class="hs-identifier">tcMonoExprNC</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>         </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcInferSigma"><span class="hs-identifier">tcInferSigma</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcInferRho"><span class="hs-identifier">tcInferRho</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcInferRhoNC"><span class="hs-identifier">tcInferRhoNC</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-20"></span><span>         </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier">tcExpr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>         </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOp"><span class="hs-identifier">tcSyntaxOp</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOpGen"><span class="hs-identifier">tcSyntaxOpGen</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#SyntaxOpType"><span class="hs-identifier">SyntaxOpType</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#synKnownType"><span class="hs-identifier">synKnownType</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-22"></span><span>         </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcCheckId"><span class="hs-identifier">tcCheckId</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>         </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#addAmbiguousNameErr"><span class="hs-identifier">addAmbiguousNameErr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-24"></span><span>         </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#getFixedTyVars"><span class="hs-identifier">getFixedTyVars</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span class="hs-cpp">

#include &quot;HsVersions.h&quot;
</span><span>
</span><span id="line-28"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-29"></span><span>
</span><span id="line-30"></span><span class="hs-keyword">import</span><span> </span><span class="hs-pragma">{-# SOURCE</span><span> </span><span class="hs-pragma">#-}</span><span>   </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html"><span class="hs-identifier">GHC.Tc.Gen.Splice</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#tcSpliceExpr"><span class="hs-identifier">tcSpliceExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#tcTypedBracket"><span class="hs-identifier">tcTypedBracket</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#tcUntypedBracket"><span class="hs-identifier">tcUntypedBracket</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.TH.html"><span class="hs-identifier">GHC.Builtin.Names.TH</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.TH.html#liftStringName"><span class="hs-identifier">liftStringName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.TH.html#liftName"><span class="hs-identifier">liftName</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Hs.html"><span class="hs-identifier">GHC.Hs</span></a></span><span>
</span><span id="line-34"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Zonk.html"><span class="hs-identifier">GHC.Tc.Utils.Zonk</span></a></span><span>
</span><span id="line-35"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html"><span class="hs-identifier">GHC.Tc.Utils.Monad</span></a></span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html"><span class="hs-identifier">GHC.Tc.Utils.Unify</span></a></span><span>
</span><span id="line-37"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html"><span class="hs-identifier">GHC.Types.Basic</span></a></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Multiplicity.html"><span class="hs-identifier">GHC.Core.Multiplicity</span></a></span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.UsageEnv.html"><span class="hs-identifier">GHC.Core.UsageEnv</span></a></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html"><span class="hs-identifier">GHC.Tc.Utils.Instantiate</span></a></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html"><span class="hs-identifier">GHC.Tc.Gen.Bind</span></a></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#chooseInferredQuantifiers"><span class="hs-identifier">chooseInferredQuantifiers</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Bind.html#tcLocalBinds"><span class="hs-identifier">tcLocalBinds</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Sig.html"><span class="hs-identifier">GHC.Tc.Gen.Sig</span></a></span><span>         </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Sig.html#tcUserTypeSig"><span class="hs-identifier">tcUserTypeSig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Sig.html#tcInstSig"><span class="hs-identifier">tcInstSig</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.html"><span class="hs-identifier">GHC.Tc.Solver</span></a></span><span>          </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.html#simplifyInfer"><span class="hs-identifier">simplifyInfer</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.html#InferMode"><span class="hs-identifier">InferMode</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Family.html"><span class="hs-identifier">GHC.Tc.Instance.Family</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Family.html#tcGetFamInstEnvs"><span class="hs-identifier">tcGetFamInstEnvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Family.html#tcLookupDataFamInst"><span class="hs-identifier">tcLookupDataFamInst</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Family.html#tcLookupDataFamInst_maybe"><span class="hs-identifier">tcLookupDataFamInst_maybe</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html"><span class="hs-identifier">GHC.Core.FamInstEnv</span></a></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html#FamInstEnvs"><span class="hs-identifier">FamInstEnvs</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html"><span class="hs-identifier">GHC.Rename.Env</span></a></span><span>         </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html#addUsedGRE"><span class="hs-identifier">addUsedGRE</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.Utils.html"><span class="hs-identifier">GHC.Rename.Utils</span></a></span><span>       </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Rename.Utils.html#addNameClashErrRn"><span class="hs-identifier">addNameClashErrRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Utils.html#unknownSubordinateErr"><span class="hs-identifier">unknownSubordinateErr</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html"><span class="hs-identifier">GHC.Tc.Utils.Env</span></a></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Arrow.html"><span class="hs-identifier">GHC.Tc.Gen.Arrow</span></a></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Match.html"><span class="hs-identifier">GHC.Tc.Gen.Match</span></a></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html"><span class="hs-identifier">GHC.Tc.Gen.HsType</span></a></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.TyCl.PatSyn.html"><span class="hs-identifier">GHC.Tc.TyCl.PatSyn</span></a></span><span>     </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.TyCl.PatSyn.html#tcPatSynBuilderOcc"><span class="hs-identifier">tcPatSynBuilderOcc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.TyCl.PatSyn.html#nonBidirectionalErr"><span class="hs-identifier">nonBidirectionalErr</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Pat.html"><span class="hs-identifier">GHC.Tc.Gen.Pat</span></a></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html"><span class="hs-identifier">GHC.Tc.Utils.TcMType</span></a></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html"><span class="hs-identifier">GHC.Tc.Types.Origin</span></a></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html"><span class="hs-identifier">GHC.Tc.Utils.TcType</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TcType</span></span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.html"><span class="hs-identifier">GHC.Types.Id</span></a></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.Info.html"><span class="hs-identifier">GHC.Types.Id.Info</span></a></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.ConLike.html"><span class="hs-identifier">GHC.Core.ConLike</span></a></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html"><span class="hs-identifier">GHC.Core.DataCon</span></a></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.PatSyn.html"><span class="hs-identifier">GHC.Core.PatSyn</span></a></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.html"><span class="hs-identifier">GHC.Types.Name</span></a></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Env.html"><span class="hs-identifier">GHC.Types.Name.Env</span></a></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html"><span class="hs-identifier">GHC.Types.Name.Set</span></a></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html"><span class="hs-identifier">GHC.Types.Name.Reader</span></a></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html"><span class="hs-identifier">GHC.Core.TyCon</span></a></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html"><span class="hs-identifier">GHC.Core.TyCo.Rep</span></a></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Ppr.html"><span class="hs-identifier">GHC.Core.TyCo.Ppr</span></a></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html"><span class="hs-identifier">GHC.Core.TyCo.Subst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#substTyWithInScope"><span class="hs-identifier">substTyWithInScope</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Type.html"><span class="hs-identifier">GHC.Core.Type</span></a></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html"><span class="hs-identifier">GHC.Tc.Types.Evidence</span></a></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html"><span class="hs-identifier">GHC.Types.Var.Set</span></a></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html"><span class="hs-identifier">GHC.Builtin.Types</span></a></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.PrimOps.html"><span class="hs-identifier">GHC.Builtin.PrimOps</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Builtin.PrimOps.html#tagToEnumKey"><span class="hs-identifier">tagToEnumKey</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html"><span class="hs-identifier">GHC.Builtin.Names</span></a></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html"><span class="hs-identifier">GHC.Driver.Session</span></a></span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html"><span class="hs-identifier">GHC.Types.SrcLoc</span></a></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html"><span class="hs-identifier">GHC.Types.Var.Env</span></a></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#emptyTidyEnv"><span class="hs-identifier">emptyTidyEnv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Var.Env.html#mkInScopeSet"><span class="hs-identifier">mkInScopeSet</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.List.SetOps.html"><span class="hs-identifier">GHC.Data.List.SetOps</span></a></span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html"><span class="hs-identifier">GHC.Data.Maybe</span></a></span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Outputable</span></span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html"><span class="hs-identifier">GHC.Data.FastString</span></a></span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base/src/Control.Monad.html#"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Class.html"><span class="hs-identifier">GHC.Core.Class</span></a></span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Class.html#classTyCon"><span class="hs-identifier">classTyCon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Set.html"><span class="hs-identifier">GHC.Types.Unique.Set</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Set.html#nonDetEltsUniqSet"><span class="hs-identifier">nonDetEltsUniqSet</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../ghc-boot/src/GHC.LanguageExtensions.html#"><span class="hs-identifier">GHC.LanguageExtensions</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LangExt</span></span><span>
</span><span id="line-88"></span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base/src/Data.Function.html#"><span class="hs-identifier">Data.Function</span></a></span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base/src/Data.List.html#"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/Data.OldList.html#partition"><span class="hs-identifier">partition</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base/src/Data.OldList.html#sortBy"><span class="hs-identifier">sortBy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base/src/Data.OldList.html#groupBy"><span class="hs-identifier">groupBy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base/src/Data.OldList.html#intersect"><span class="hs-identifier">intersect</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../containers/src/Data.Set.html#"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-92"></span><span>
</span><span id="line-93"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Main wrappers}
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span>
</span><span id="line-102"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExpr"><span class="hs-identifier hs-type">tcCheckPolyExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExprNC"><span class="hs-identifier hs-type">tcCheckPolyExprNC</span></a></span><span>
</span><span id="line-103"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>         </span><span class="hs-comment">-- Expression to type check</span><span>
</span><span id="line-104"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span>           </span><span class="hs-comment">-- Expected type (could be a polytype)</span><span>
</span><span id="line-105"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Generalised expr with expected type</span><span>
</span><span id="line-106"></span><span>
</span><span id="line-107"></span><span class="hs-comment">-- tcCheckPolyExpr is a convenient place (frequent but not too frequent)</span><span>
</span><span id="line-108"></span><span class="hs-comment">-- place to add context information.</span><span>
</span><span id="line-109"></span><span class="hs-comment">-- The NC version does not do so, usually because the caller wants</span><span>
</span><span id="line-110"></span><span class="hs-comment">-- to do so himself.</span><span>
</span><span id="line-111"></span><span>
</span><span id="line-112"></span><span id="tcCheckPolyExpr"><span class="annot"><span class="annottext">tcCheckPolyExpr :: LHsExpr GhcRn -&gt; TcType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExpr"><span class="hs-identifier hs-var hs-var">tcCheckPolyExpr</span></a></span></span><span>   </span><span id="local-6989586621681094136"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681094136"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span id="local-6989586621681094135"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681094135"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcPolyExpr"><span class="hs-identifier hs-var">tcPolyExpr</span></a></span><span>   </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681094136"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; ExpRhoType
</span><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681094135"><span class="hs-identifier hs-var">res_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-113"></span><span id="tcCheckPolyExprNC"><span class="annot"><span class="annottext">tcCheckPolyExprNC :: LHsExpr GhcRn -&gt; TcType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExprNC"><span class="hs-identifier hs-var hs-var">tcCheckPolyExprNC</span></a></span></span><span> </span><span id="local-6989586621681094132"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681094132"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span id="local-6989586621681094131"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681094131"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcPolyExprNC"><span class="hs-identifier hs-var">tcPolyExprNC</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681094132"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; ExpRhoType
</span><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681094131"><span class="hs-identifier hs-var">res_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span>
</span><span id="line-115"></span><span class="hs-comment">-- These versions take an ExpType</span><span>
</span><span id="line-116"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcPolyExpr"><span class="hs-identifier hs-type">tcPolyExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcPolyExprNC"><span class="hs-identifier hs-type">tcPolyExprNC</span></a></span><span>
</span><span id="line-117"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpSigmaType"><span class="hs-identifier hs-type">ExpSigmaType</span></a></span><span>
</span><span id="line-118"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span id="tcPolyExpr"><span class="annot"><span class="annottext">tcPolyExpr :: LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcPolyExpr"><span class="hs-identifier hs-var hs-var">tcPolyExpr</span></a></span></span><span> </span><span id="local-6989586621681094128"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681094128"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span id="local-6989586621681094127"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681094127"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-121"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a. LHsExpr GhcRn -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Gen.Expr.html#addExprCtxt"><span class="hs-identifier hs-var">addExprCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681094128"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-122"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcPolyExpr&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExpRhoType -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681094127"><span class="hs-identifier hs-var">res_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-123"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcPolyExprNC"><span class="hs-identifier hs-var">tcPolyExprNC</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681094128"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681094127"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-124"></span><span>
</span><span id="line-125"></span><span id="tcPolyExprNC"><span class="annot"><span class="annottext">tcPolyExprNC :: LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcPolyExprNC"><span class="hs-identifier hs-var hs-var">tcPolyExprNC</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681094122"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681094122"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681094121"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681094121"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681094120"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681094120"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-126"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan
-&gt; HsExpr GhcRn -&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall {a}. SrcSpan -&gt; HsExpr GhcRn -&gt; TcRn a -&gt; TcRn a
</span><a href="#local-6989586621681094119"><span class="hs-identifier hs-var">set_loc_and_ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681094122"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681094121"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-127"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcPolyExprNC&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExpRhoType -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681094120"><span class="hs-identifier hs-var">res_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-128"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681094118"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681094118"><span class="hs-identifier hs-var">wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681094117"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681094117"><span class="hs-identifier hs-var">expr'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
-&gt; ExpRhoType
-&gt; (ExpRhoType -&gt; TcM (HsExpr GhcTc))
-&gt; TcM (HsWrapper, HsExpr GhcTc)
forall result.
UserTypeCtxt
-&gt; ExpRhoType
-&gt; (ExpRhoType -&gt; TcM result)
-&gt; TcM (HsWrapper, result)
</span><a href="GHC.Tc.Utils.Unify.html#tcSkolemiseET"><span class="hs-identifier hs-var">tcSkolemiseET</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#GenSigCtxt"><span class="hs-identifier hs-var">GenSigCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681094120"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">((ExpRhoType -&gt; TcM (HsExpr GhcTc))
 -&gt; TcM (HsWrapper, HsExpr GhcTc))
-&gt; (ExpRhoType -&gt; TcM (HsExpr GhcTc))
-&gt; TcM (HsWrapper, HsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681094114"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681094114"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-129"></span><span>                          </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681094121"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681094114"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-130"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc -&gt; TcM (LHsExpr GhcTc)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(LHsExpr GhcTc -&gt; TcM (LHsExpr GhcTc))
-&gt; LHsExpr GhcTc -&gt; TcM (LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; HsExpr GhcTc -&gt; LHsExpr GhcTc
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681094122"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrap"><span class="hs-identifier hs-var">mkHsWrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681094118"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681094117"><span class="hs-identifier hs-var">expr'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-131"></span><span>
</span><span id="line-132"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span class="hs-comment">-- See Note [Rebindable syntax and HsExpansion), which describes</span><span>
</span><span id="line-133"></span><span>        </span><span class="hs-comment">-- the logic behind this location/context tweaking.</span><span>
</span><span id="line-134"></span><span>        </span><span id="local-6989586621681094119"><span class="annot"><span class="annottext">set_loc_and_ctxt :: SrcSpan -&gt; HsExpr GhcRn -&gt; TcRn a -&gt; TcRn a
</span><a href="#local-6989586621681094119"><span class="hs-identifier hs-var hs-var">set_loc_and_ctxt</span></a></span></span><span> </span><span id="local-6989586621681094111"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681094111"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621681094110"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681094110"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621681094109"><span class="annot"><span class="annottext">TcRn a
</span><a href="#local-6989586621681094109"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-135"></span><span>          </span><span id="local-6989586621681094108"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681094108"><span class="hs-identifier hs-var">inGenCode</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn Bool
</span><a href="GHC.Tc.Utils.Monad.html#inGeneratedCode"><span class="hs-identifier hs-var">inGeneratedCode</span></a></span><span>
</span><span id="line-136"></span><span>          </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681094108"><span class="hs-identifier hs-var">inGenCode</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; Bool
</span><a href="GHC.Types.SrcLoc.html#isGeneratedSrcSpan"><span class="hs-identifier hs-var">isGeneratedSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681094111"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-137"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcRn a -&gt; TcRn a
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681094111"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn a -&gt; TcRn a) -&gt; TcRn a -&gt; TcRn a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; TcRn a -&gt; TcRn a
forall a. LHsExpr GhcRn -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Gen.Expr.html#addExprCtxt"><span class="hs-identifier hs-var">addExprCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; HsExpr GhcRn -&gt; LHsExpr GhcRn
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681094111"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681094110"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcRn a
</span><a href="#local-6989586621681094109"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-138"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcRn a -&gt; TcRn a
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681094111"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">TcRn a
</span><a href="#local-6989586621681094109"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span class="hs-comment">---------------</span><span>
</span><span id="line-141"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcInferSigma"><span class="hs-identifier hs-type">tcInferSigma</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-142"></span><span class="hs-comment">-- Used by tcRnExpr to implement GHCi :type</span><span>
</span><span id="line-143"></span><span class="hs-comment">-- It goes against the principle of eager instantiation,</span><span>
</span><span id="line-144"></span><span class="hs-comment">-- so we expect very very few calls to this function</span><span>
</span><span id="line-145"></span><span class="hs-comment">-- Most clients will want tcInferRho</span><span>
</span><span id="line-146"></span><span id="tcInferSigma"><span class="annot"><span class="annottext">tcInferSigma :: LHsExpr GhcRn -&gt; TcM (LHsExpr GhcTc, TcType)
</span><a href="GHC.Tc.Gen.Expr.html#tcInferSigma"><span class="hs-identifier hs-var hs-var">tcInferSigma</span></a></span></span><span> </span><span id="local-6989586621681094102"><span class="annot"><span class="annottext">le :: LHsExpr GhcRn
</span><a href="#local-6989586621681094102"><span class="hs-identifier hs-var">le</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681094101"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681094101"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681094100"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681094100"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-147"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
-&gt; TcM (LHsExpr GhcTc, TcType) -&gt; TcM (LHsExpr GhcTc, TcType)
forall a. LHsExpr GhcRn -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Gen.Expr.html#addExprCtxt"><span class="hs-identifier hs-var">addExprCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681094102"><span class="hs-identifier hs-var">le</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc, TcType) -&gt; TcM (LHsExpr GhcTc, TcType))
-&gt; TcM (LHsExpr GhcTc, TcType) -&gt; TcM (LHsExpr GhcTc, TcType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
-&gt; TcM (LHsExpr GhcTc, TcType) -&gt; TcM (LHsExpr GhcTc, TcType)
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681094101"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc, TcType) -&gt; TcM (LHsExpr GhcTc, TcType))
-&gt; TcM (LHsExpr GhcTc, TcType) -&gt; TcM (LHsExpr GhcTc, TcType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-148"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681094099"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681094099"><span class="hs-identifier hs-var">fun</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681094098"><span class="annot"><span class="annottext">[LHsExprArgOut]
</span><a href="#local-6989586621681094098"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681094097"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681094097"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; TcM (HsExpr GhcTc, [LHsExprArgOut], TcType)
</span><a href="GHC.Tc.Gen.Expr.html#tcInferApp"><span class="hs-identifier hs-var">tcInferApp</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681094100"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-149"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(LHsExpr GhcTc, TcType) -&gt; TcM (LHsExpr GhcTc, TcType)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; HsExpr GhcTc -&gt; LHsExpr GhcTc
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681094101"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; [LHsExprArgOut] -&gt; HsExpr GhcTc
</span><a href="GHC.Tc.Gen.Expr.html#applyHsArgs"><span class="hs-identifier hs-var">applyHsArgs</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681094099"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsExprArgOut]
</span><a href="#local-6989586621681094098"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681094097"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-150"></span><span>
</span><span id="line-151"></span><span class="hs-comment">---------------</span><span>
</span><span id="line-152"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcCheckMonoExpr"><span class="hs-identifier hs-type">tcCheckMonoExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcCheckMonoExprNC"><span class="hs-identifier hs-type">tcCheckMonoExprNC</span></a></span><span>
</span><span id="line-153"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>     </span><span class="hs-comment">-- Expression to type check</span><span>
</span><span id="line-154"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcRhoType"><span class="hs-identifier hs-type">TcRhoType</span></a></span><span>         </span><span class="hs-comment">-- Expected type</span><span>
</span><span id="line-155"></span><span>                         </span><span class="hs-comment">-- Definitely no foralls at the top</span><span>
</span><span id="line-156"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-157"></span><span id="tcCheckMonoExpr"><span class="annot"><span class="annottext">tcCheckMonoExpr :: LHsExpr GhcRn -&gt; TcType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckMonoExpr"><span class="hs-identifier hs-var hs-var">tcCheckMonoExpr</span></a></span></span><span>   </span><span id="local-6989586621681094093"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681094093"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span id="local-6989586621681094092"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681094092"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcMonoExpr"><span class="hs-identifier hs-var">tcMonoExpr</span></a></span><span>   </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681094093"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; ExpRhoType
</span><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681094092"><span class="hs-identifier hs-var">res_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span id="tcCheckMonoExprNC"><span class="annot"><span class="annottext">tcCheckMonoExprNC :: LHsExpr GhcRn -&gt; TcType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckMonoExprNC"><span class="hs-identifier hs-var hs-var">tcCheckMonoExprNC</span></a></span></span><span> </span><span id="local-6989586621681094091"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681094091"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span id="local-6989586621681094090"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681094090"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcMonoExprNC"><span class="hs-identifier hs-var">tcMonoExprNC</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681094091"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; ExpRhoType
</span><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681094090"><span class="hs-identifier hs-var">res_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcMonoExpr"><span class="hs-identifier hs-type">tcMonoExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcMonoExprNC"><span class="hs-identifier hs-type">tcMonoExprNC</span></a></span><span>
</span><span id="line-161"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>     </span><span class="hs-comment">-- Expression to type check</span><span>
</span><span id="line-162"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span>        </span><span class="hs-comment">-- Expected type</span><span>
</span><span id="line-163"></span><span>                         </span><span class="hs-comment">-- Definitely no foralls at the top</span><span>
</span><span id="line-164"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span id="tcMonoExpr"><span class="annot"><span class="annottext">tcMonoExpr :: LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcMonoExpr"><span class="hs-identifier hs-var hs-var">tcMonoExpr</span></a></span></span><span> </span><span id="local-6989586621681094089"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681094089"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span id="local-6989586621681094088"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681094088"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-167"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a. LHsExpr GhcRn -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Gen.Expr.html#addExprCtxt"><span class="hs-identifier hs-var">addExprCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681094089"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-168"></span><span>    </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcMonoExprNC"><span class="hs-identifier hs-var">tcMonoExprNC</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681094089"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681094088"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-169"></span><span>
</span><span id="line-170"></span><span id="tcMonoExprNC"><span class="annot"><span class="annottext">tcMonoExprNC :: LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcMonoExprNC"><span class="hs-identifier hs-var hs-var">tcMonoExprNC</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681094087"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681094087"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681094086"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681094086"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681094085"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681094085"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-171"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681094087"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-172"></span><span>    </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681094084"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681094084"><span class="hs-identifier hs-var">expr'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681094086"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681094085"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-173"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc -&gt; TcM (LHsExpr GhcTc)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; HsExpr GhcTc -&gt; LHsExpr GhcTc
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681094087"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681094084"><span class="hs-identifier hs-var">expr'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-174"></span><span>
</span><span id="line-175"></span><span class="hs-comment">---------------</span><span>
</span><span id="line-176"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcInferRho"><span class="hs-identifier hs-type">tcInferRho</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcInferRhoNC"><span class="hs-identifier hs-type">tcInferRhoNC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcRhoType"><span class="hs-identifier hs-type">TcRhoType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-177"></span><span class="hs-comment">-- Infer a *rho*-type. The return type is always instantiated.</span><span>
</span><span id="line-178"></span><span id="tcInferRho"><span class="annot"><span class="annottext">tcInferRho :: LHsExpr GhcRn -&gt; TcM (LHsExpr GhcTc, TcType)
</span><a href="GHC.Tc.Gen.Expr.html#tcInferRho"><span class="hs-identifier hs-var hs-var">tcInferRho</span></a></span></span><span> </span><span id="local-6989586621681094083"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681094083"><span class="hs-identifier hs-var">le</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
-&gt; TcM (LHsExpr GhcTc, TcType) -&gt; TcM (LHsExpr GhcTc, TcType)
forall a. LHsExpr GhcRn -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Gen.Expr.html#addExprCtxt"><span class="hs-identifier hs-var">addExprCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681094083"><span class="hs-identifier hs-var">le</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; TcM (LHsExpr GhcTc, TcType)
</span><a href="GHC.Tc.Gen.Expr.html#tcInferRhoNC"><span class="hs-identifier hs-var">tcInferRhoNC</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681094083"><span class="hs-identifier hs-var">le</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-179"></span><span>
</span><span id="line-180"></span><span id="tcInferRhoNC"><span class="annot"><span class="annottext">tcInferRhoNC :: LHsExpr GhcRn -&gt; TcM (LHsExpr GhcTc, TcType)
</span><a href="GHC.Tc.Gen.Expr.html#tcInferRhoNC"><span class="hs-identifier hs-var hs-var">tcInferRhoNC</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681094082"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681094082"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681094081"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681094081"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-181"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan
-&gt; TcM (LHsExpr GhcTc, TcType) -&gt; TcM (LHsExpr GhcTc, TcType)
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681094082"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc, TcType) -&gt; TcM (LHsExpr GhcTc, TcType))
-&gt; TcM (LHsExpr GhcTc, TcType) -&gt; TcM (LHsExpr GhcTc, TcType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-182"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681094080"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681094080"><span class="hs-identifier hs-var">expr'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681094079"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681094079"><span class="hs-identifier hs-var">rho</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ExpRhoType -&gt; TcM (HsExpr GhcTc)) -&gt; TcM (HsExpr GhcTc, TcType)
forall a. (ExpRhoType -&gt; TcM a) -&gt; TcM (a, TcType)
</span><a href="GHC.Tc.Utils.TcMType.html#tcInfer"><span class="hs-identifier hs-var">tcInfer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681094081"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-183"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(LHsExpr GhcTc, TcType) -&gt; TcM (LHsExpr GhcTc, TcType)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; HsExpr GhcTc -&gt; LHsExpr GhcTc
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681094082"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681094080"><span class="hs-identifier hs-var">expr'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681094079"><span class="hs-identifier hs-var">rho</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-184"></span><span>
</span><span id="line-185"></span><span>
</span><span id="line-186"></span><span class="hs-comment">{- *********************************************************************
*                                                                      *
        tcExpr: the main expression typechecker
*                                                                      *
********************************************************************* -}</span><span>
</span><span id="line-191"></span><span>
</span><span id="line-192"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcLExpr"><span class="hs-identifier hs-type">tcLExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcLExprNC"><span class="hs-identifier hs-type">tcLExprNC</span></a></span><span>
</span><span id="line-193"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>     </span><span class="hs-comment">-- Expression to type check</span><span>
</span><span id="line-194"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span>        </span><span class="hs-comment">-- Expected type</span><span>
</span><span id="line-195"></span><span>                         </span><span class="hs-comment">-- Definitely no foralls at the top</span><span>
</span><span id="line-196"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span><span id="tcLExpr"><span class="annot"><span class="annottext">tcLExpr :: LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcLExpr"><span class="hs-identifier hs-var hs-var">tcLExpr</span></a></span></span><span> </span><span id="local-6989586621681094075"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681094075"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span id="local-6989586621681094074"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681094074"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-199"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; SrcSpan
forall l e. GenLocated l e -&gt; l
</span><a href="GHC.Types.SrcLoc.html#getLoc"><span class="hs-identifier hs-var">getLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681094075"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a. LHsExpr GhcRn -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Gen.Expr.html#addExprCtxt"><span class="hs-identifier hs-var">addExprCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681094075"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcLExprNC"><span class="hs-identifier hs-var">tcLExprNC</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681094075"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681094074"><span class="hs-identifier hs-var">res_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-200"></span><span>
</span><span id="line-201"></span><span id="tcLExprNC"><span class="annot"><span class="annottext">tcLExprNC :: LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcLExprNC"><span class="hs-identifier hs-var hs-var">tcLExprNC</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681094072"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681094072"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681094071"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681094071"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681094070"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681094070"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-202"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681094072"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-203"></span><span>    </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681094069"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681094069"><span class="hs-identifier hs-var">expr'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681094071"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681094070"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-204"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc -&gt; TcM (LHsExpr GhcTc)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; HsExpr GhcTc -&gt; LHsExpr GhcTc
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681094072"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681094069"><span class="hs-identifier hs-var">expr'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-205"></span><span>
</span><span id="line-206"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-type">tcExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-207"></span><span id="tcExpr"><span class="annot"><span class="annottext">tcExpr :: HsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var hs-var">tcExpr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsVar"><span class="hs-identifier hs-type">HsVar</span></a></span><span> </span><span class="annot"><span class="annottext">XVar GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681094067"><span class="annot"><span class="annottext">IdP GhcRn
</span><a href="#local-6989586621681094067"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>   </span><span id="local-6989586621681094066"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681094066"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckId"><span class="hs-identifier hs-var">tcCheckId</span></a></span><span> </span><span class="annot"><span class="annottext">Name
IdP GhcRn
</span><a href="#local-6989586621681094067"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681094066"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-208"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span id="local-6989586621681094065"><span class="annot"><span class="annottext">e :: HsExpr GhcRn
</span><a href="#local-6989586621681094065"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsUnboundVar"><span class="hs-identifier hs-type">HsUnboundVar</span></a></span><span> </span><span class="annot"><span class="annottext">XUnboundVar GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681094063"><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621681094063"><span class="hs-identifier hs-var">uv</span></a></span></span><span class="hs-special">)</span><span>  </span><span id="local-6989586621681094062"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681094062"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; OccName -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcUnboundId"><span class="hs-identifier hs-var">tcUnboundId</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681094065"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621681094063"><span class="hs-identifier hs-var">uv</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681094062"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-209"></span><span>
</span><span id="line-210"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span id="local-6989586621681094060"><span class="annot"><span class="annottext">e :: HsExpr GhcRn
</span><a href="#local-6989586621681094060"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsApp"><span class="hs-identifier hs-type">HsApp</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>     </span><span id="local-6989586621681094058"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681094058"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcApp"><span class="hs-identifier hs-var">tcApp</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681094060"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681094058"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-211"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span id="local-6989586621681094056"><span class="annot"><span class="annottext">e :: HsExpr GhcRn
</span><a href="#local-6989586621681094056"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsAppType"><span class="hs-identifier hs-type">HsAppType</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621681094054"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681094054"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcApp"><span class="hs-identifier hs-var">tcApp</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681094056"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681094054"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-212"></span><span>
</span><span id="line-213"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span id="local-6989586621681094053"><span class="annot"><span class="annottext">e :: HsExpr GhcRn
</span><a href="#local-6989586621681094053"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsLit"><span class="hs-identifier hs-type">HsLit</span></a></span><span> </span><span id="local-6989586621681094051"><span class="annot"><span class="annottext">XLitE GhcRn
</span><a href="#local-6989586621681094051"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681094050"><span class="annot"><span class="annottext">HsLit GhcRn
</span><a href="#local-6989586621681094050"><span class="hs-identifier hs-var">lit</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681094049"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681094049"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-214"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681094048"><span class="annot"><span class="annottext">lit_ty :: TcType
</span><a href="#local-6989586621681094048"><span class="hs-identifier hs-var hs-var">lit_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsLit GhcRn -&gt; TcType
forall (p :: Pass). HsLit (GhcPass p) -&gt; TcType
</span><a href="GHC.Tc.Utils.Zonk.html#hsLitType"><span class="hs-identifier hs-var">hsLitType</span></a></span><span> </span><span class="annot"><span class="annottext">HsLit GhcRn
</span><a href="#local-6989586621681094050"><span class="hs-identifier hs-var">lit</span></a></span><span>
</span><span id="line-215"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
-&gt; HsExpr GhcTc -&gt; TcType -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Utils.Unify.html#tcWrapResult"><span class="hs-identifier hs-var">tcWrapResult</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681094053"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XLitE GhcTc -&gt; HsLit GhcTc -&gt; HsExpr GhcTc
forall p. XLitE p -&gt; HsLit p -&gt; HsExpr p
</span><a href="GHC.Hs.Expr.html#HsLit"><span class="hs-identifier hs-var">HsLit</span></a></span><span> </span><span class="annot"><span class="annottext">XLitE GhcRn
XLitE GhcTc
</span><a href="#local-6989586621681094051"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsLit GhcRn -&gt; HsLit GhcTc
forall (p1 :: Pass) (p2 :: Pass).
HsLit (GhcPass p1) -&gt; HsLit (GhcPass p2)
</span><a href="GHC.Hs.Lit.html#convertLit"><span class="hs-identifier hs-var">convertLit</span></a></span><span> </span><span class="annot"><span class="annottext">HsLit GhcRn
</span><a href="#local-6989586621681094050"><span class="hs-identifier hs-var">lit</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681094048"><span class="hs-identifier hs-var">lit_ty</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681094049"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-216"></span><span>
</span><span id="line-217"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsPar"><span class="hs-identifier hs-type">HsPar</span></a></span><span> </span><span id="local-6989586621681094043"><span class="annot"><span class="annottext">XPar GhcRn
</span><a href="#local-6989586621681094043"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681094042"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681094042"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681094041"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681094041"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681094040"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681094040"><span class="hs-identifier hs-var">expr'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcLExprNC"><span class="hs-identifier hs-var">tcLExprNC</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681094042"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681094041"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-218"></span><span>                                  </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XPar GhcTc -&gt; LHsExpr GhcTc -&gt; HsExpr GhcTc
forall p. XPar p -&gt; LHsExpr p -&gt; HsExpr p
</span><a href="GHC.Hs.Expr.html#HsPar"><span class="hs-identifier hs-var">HsPar</span></a></span><span> </span><span class="annot"><span class="annottext">XPar GhcRn
XPar GhcTc
</span><a href="#local-6989586621681094043"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681094040"><span class="hs-identifier hs-var">expr'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-219"></span><span>
</span><span id="line-220"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsPragE"><span class="hs-identifier hs-type">HsPragE</span></a></span><span> </span><span id="local-6989586621681094038"><span class="annot"><span class="annottext">XPragE GhcRn
</span><a href="#local-6989586621681094038"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681094037"><span class="annot"><span class="annottext">HsPragE GhcRn
</span><a href="#local-6989586621681094037"><span class="hs-identifier hs-var">prag</span></a></span></span><span> </span><span id="local-6989586621681094036"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681094036"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681094035"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681094035"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-221"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681094034"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681094034"><span class="hs-identifier hs-var">expr'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcLExpr"><span class="hs-identifier hs-var">tcLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681094036"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681094035"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-222"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XPragE GhcTc -&gt; HsPragE GhcTc -&gt; LHsExpr GhcTc -&gt; HsExpr GhcTc
forall p. XPragE p -&gt; HsPragE p -&gt; LHsExpr p -&gt; HsExpr p
</span><a href="GHC.Hs.Expr.html#HsPragE"><span class="hs-identifier hs-var">HsPragE</span></a></span><span> </span><span class="annot"><span class="annottext">XPragE GhcRn
XPragE GhcTc
</span><a href="#local-6989586621681094038"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsPragE GhcRn -&gt; HsPragE GhcTc
</span><a href="GHC.Tc.Gen.Expr.html#tcExprPrag"><span class="hs-identifier hs-var">tcExprPrag</span></a></span><span> </span><span class="annot"><span class="annottext">HsPragE GhcRn
</span><a href="#local-6989586621681094037"><span class="hs-identifier hs-var">prag</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681094034"><span class="hs-identifier hs-var">expr'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-223"></span><span>
</span><span id="line-224"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsOverLit"><span class="hs-identifier hs-type">HsOverLit</span></a></span><span> </span><span id="local-6989586621681094031"><span class="annot"><span class="annottext">XOverLitE GhcRn
</span><a href="#local-6989586621681094031"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681094030"><span class="annot"><span class="annottext">HsOverLit GhcRn
</span><a href="#local-6989586621681094030"><span class="hs-identifier hs-var">lit</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681094029"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681094029"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-225"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681094028"><span class="annot"><span class="annottext">HsOverLit GhcTc
</span><a href="#local-6989586621681094028"><span class="hs-identifier hs-var">lit'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsOverLit GhcRn -&gt; ExpRhoType -&gt; TcM (HsOverLit GhcTc)
</span><a href="GHC.Tc.Utils.Instantiate.html#newOverloadedLit"><span class="hs-identifier hs-var">newOverloadedLit</span></a></span><span> </span><span class="annot"><span class="annottext">HsOverLit GhcRn
</span><a href="#local-6989586621681094030"><span class="hs-identifier hs-var">lit</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681094029"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-226"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XOverLitE GhcTc -&gt; HsOverLit GhcTc -&gt; HsExpr GhcTc
forall p. XOverLitE p -&gt; HsOverLit p -&gt; HsExpr p
</span><a href="GHC.Hs.Expr.html#HsOverLit"><span class="hs-identifier hs-var">HsOverLit</span></a></span><span> </span><span class="annot"><span class="annottext">XOverLitE GhcRn
XOverLitE GhcTc
</span><a href="#local-6989586621681094031"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">HsOverLit GhcTc
</span><a href="#local-6989586621681094028"><span class="hs-identifier hs-var">lit'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-227"></span><span>
</span><span id="line-228"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#NegApp"><span class="hs-identifier hs-type">NegApp</span></a></span><span> </span><span id="local-6989586621681094025"><span class="annot"><span class="annottext">XNegApp GhcRn
</span><a href="#local-6989586621681094025"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681094024"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681094024"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span id="local-6989586621681094023"><span class="annot"><span class="annottext">SyntaxExpr GhcRn
</span><a href="#local-6989586621681094023"><span class="hs-identifier hs-var">neg_expr</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681094022"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681094022"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-229"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681094021"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681094021"><span class="hs-identifier hs-var">expr'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681094020"><span class="annot"><span class="annottext">SyntaxExprTc
</span><a href="#local-6989586621681094020"><span class="hs-identifier hs-var">neg_expr'</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-230"></span><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin
-&gt; SyntaxExprRn
-&gt; [SyntaxOpType]
-&gt; ExpRhoType
-&gt; ([TcType] -&gt; [TcType] -&gt; TcM (LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc, SyntaxExprTc)
forall a.
CtOrigin
-&gt; SyntaxExprRn
-&gt; [SyntaxOpType]
-&gt; ExpRhoType
-&gt; ([TcType] -&gt; [TcType] -&gt; TcM a)
-&gt; TcM (a, SyntaxExprTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOp"><span class="hs-identifier hs-var">tcSyntaxOp</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#NegateOrigin"><span class="hs-identifier hs-var">NegateOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcRn
SyntaxExprRn
</span><a href="#local-6989586621681094023"><span class="hs-identifier hs-var">neg_expr</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="GHC.Tc.Utils.TcType.html#SynAny"><span class="hs-identifier hs-var">SynAny</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681094022"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">(([TcType] -&gt; [TcType] -&gt; TcM (LHsExpr GhcTc))
 -&gt; TcM (LHsExpr GhcTc, SyntaxExprTc))
-&gt; ([TcType] -&gt; [TcType] -&gt; TcM (LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc, SyntaxExprTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-231"></span><span>               </span><span class="hs-glyph">\</span><span class="hs-special">[</span><span id="local-6989586621681094017"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681094017"><span class="hs-identifier hs-var">arg_ty</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span id="local-6989586621681094016"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681094016"><span class="hs-identifier hs-var">arg_mult</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-232"></span><span>               </span><span class="annot"><span class="annottext">TcType -&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a. TcType -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-var">tcScalingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681094016"><span class="hs-identifier hs-var">arg_mult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcLExpr"><span class="hs-identifier hs-var">tcLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681094024"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; ExpRhoType
</span><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681094017"><span class="hs-identifier hs-var">arg_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-233"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XNegApp GhcTc -&gt; LHsExpr GhcTc -&gt; SyntaxExpr GhcTc -&gt; HsExpr GhcTc
forall p. XNegApp p -&gt; LHsExpr p -&gt; SyntaxExpr p -&gt; HsExpr p
</span><a href="GHC.Hs.Expr.html#NegApp"><span class="hs-identifier hs-var">NegApp</span></a></span><span> </span><span class="annot"><span class="annottext">XNegApp GhcRn
XNegApp GhcTc
</span><a href="#local-6989586621681094025"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681094021"><span class="hs-identifier hs-var">expr'</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcTc
SyntaxExprTc
</span><a href="#local-6989586621681094020"><span class="hs-identifier hs-var">neg_expr'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-234"></span><span>
</span><span id="line-235"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span id="local-6989586621681094014"><span class="annot"><span class="annottext">e :: HsExpr GhcRn
</span><a href="#local-6989586621681094014"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsIPVar"><span class="hs-identifier hs-type">HsIPVar</span></a></span><span> </span><span class="annot"><span class="annottext">XIPVar GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681094012"><span class="annot"><span class="annottext">HsIPName
</span><a href="#local-6989586621681094012"><span class="hs-identifier hs-var">x</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681094011"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681094011"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-236"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>   </span><span class="hs-comment">{- Implicit parameters must have a *tau-type* not a
              type scheme.  We enforce this by creating a fresh
              type variable as its type.  (Because res_ty may not
              be a tau-type.) -}</span><span>
</span><span id="line-240"></span><span>         </span><span id="local-6989586621681094010"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681094010"><span class="hs-identifier hs-var">ip_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#newOpenFlexiTyVarTy"><span class="hs-identifier hs-var">newOpenFlexiTyVarTy</span></a></span><span>
</span><span id="line-241"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681094008"><span class="annot"><span class="annottext">ip_name :: TcType
</span><a href="#local-6989586621681094008"><span class="hs-identifier hs-var hs-var">ip_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FieldLabelString -&gt; TcType
</span><a href="GHC.Core.Type.html#mkStrLitTy"><span class="hs-identifier hs-var">mkStrLitTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsIPName -&gt; FieldLabelString
</span><a href="GHC.Hs.Type.html#hsIPNameFS"><span class="hs-identifier hs-var">hsIPNameFS</span></a></span><span> </span><span class="annot"><span class="annottext">HsIPName
</span><a href="#local-6989586621681094012"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-242"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681094005"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681094005"><span class="hs-identifier hs-var">ipClass</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Class
</span><a href="GHC.Tc.Utils.Env.html#tcLookupClass"><span class="hs-identifier hs-var">tcLookupClass</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#ipClassName"><span class="hs-identifier hs-var">ipClassName</span></a></span><span>
</span><span id="line-243"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681094002"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681094002"><span class="hs-identifier hs-var">ip_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; TcType -&gt; TcM Var
</span><a href="GHC.Tc.Utils.TcMType.html#emitWantedEvVar"><span class="hs-identifier hs-var">emitWantedEvVar</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621681094000"><span class="hs-identifier hs-var">origin</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; [TcType] -&gt; TcType
</span><a href="GHC.Core.Predicate.html#mkClassPred"><span class="hs-identifier hs-var">mkClassPred</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681094005"><span class="hs-identifier hs-var">ipClass</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681094008"><span class="hs-identifier hs-var">ip_name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681094010"><span class="hs-identifier hs-var">ip_ty</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-244"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
-&gt; HsExpr GhcTc -&gt; TcType -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Utils.Unify.html#tcWrapResult"><span class="hs-identifier hs-var">tcWrapResult</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681094014"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-245"></span><span>                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; TcType -&gt; TcType -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="#local-6989586621681093998"><span class="hs-identifier hs-var">fromDict</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681094005"><span class="hs-identifier hs-var">ipClass</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681094008"><span class="hs-identifier hs-var">ip_name</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681094010"><span class="hs-identifier hs-var">ip_ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XVar GhcTc -&gt; Located (IdP GhcTc) -&gt; HsExpr GhcTc
forall p. XVar p -&gt; Located (IdP p) -&gt; HsExpr p
</span><a href="GHC.Hs.Expr.html#HsVar"><span class="hs-identifier hs-var">HsVar</span></a></span><span> </span><span class="annot"><span class="annottext">NoExtField
XVar GhcTc
</span><a href="GHC.Hs.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Located Var
forall e. e -&gt; Located e
</span><a href="GHC.Types.SrcLoc.html#noLoc"><span class="hs-identifier hs-var">noLoc</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681094002"><span class="hs-identifier hs-var">ip_var</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-246"></span><span>                   </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681094010"><span class="hs-identifier hs-var">ip_ty</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681094011"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-247"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-248"></span><span>  </span><span class="hs-comment">-- Coerces a dictionary for `IP &quot;x&quot; t` into `t`.</span><span>
</span><span id="line-249"></span><span>  </span><span id="local-6989586621681093998"><span class="annot"><span class="annottext">fromDict :: Class -&gt; TcType -&gt; TcType -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="#local-6989586621681093998"><span class="hs-identifier hs-var hs-var">fromDict</span></a></span></span><span> </span><span id="local-6989586621681093995"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681093995"><span class="hs-identifier hs-var">ipClass</span></a></span></span><span> </span><span id="local-6989586621681093994"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093994"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681093993"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093993"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrap"><span class="hs-identifier hs-var">mkHsWrap</span></a></span><span> </span><span class="annot"><span class="annottext">(HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc)
-&gt; HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionR -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#mkWpCastR"><span class="hs-identifier hs-var">mkWpCastR</span></a></span><span> </span><span class="annot"><span class="annottext">(TcCoercionR -&gt; HsWrapper) -&gt; TcCoercionR -&gt; HsWrapper
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-250"></span><span>                          </span><span class="annot"><span class="annottext">TcType -&gt; TcCoercionR
</span><a href="GHC.Tc.Types.Evidence.html#unwrapIP"><span class="hs-identifier hs-var">unwrapIP</span></a></span><span> </span><span class="annot"><span class="annottext">(TcType -&gt; TcCoercionR) -&gt; TcType -&gt; TcCoercionR
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Class -&gt; [TcType] -&gt; TcType
</span><a href="GHC.Core.Predicate.html#mkClassPred"><span class="hs-identifier hs-var">mkClassPred</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681093995"><span class="hs-identifier hs-var">ipClass</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093994"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093993"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-251"></span><span>  </span><span id="local-6989586621681094000"><span class="annot"><span class="annottext">origin :: CtOrigin
</span><a href="#local-6989586621681094000"><span class="hs-identifier hs-var hs-var">origin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsIPName -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#IPOccOrigin"><span class="hs-identifier hs-var">IPOccOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">HsIPName
</span><a href="#local-6989586621681094012"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-252"></span><span>
</span><span id="line-253"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span id="local-6989586621681093989"><span class="annot"><span class="annottext">e :: HsExpr GhcRn
</span><a href="#local-6989586621681093989"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsOverLabel"><span class="hs-identifier hs-type">HsOverLabel</span></a></span><span> </span><span class="annot"><span class="annottext">XOverLabel GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681093987"><span class="annot"><span class="annottext">Maybe (IdP GhcRn)
</span><a href="#local-6989586621681093987"><span class="hs-identifier hs-var">mb_fromLabel</span></a></span></span><span> </span><span id="local-6989586621681093986"><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621681093986"><span class="hs-identifier hs-var">l</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681093985"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093985"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-254"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- See Note [Type-checking overloaded labels]</span><span>
</span><span id="line-255"></span><span>         </span><span id="local-6989586621681093984"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681093984"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn SrcSpan
</span><a href="GHC.Tc.Utils.Monad.html#getSrcSpanM"><span class="hs-identifier hs-var">getSrcSpanM</span></a></span><span>
</span><span id="line-256"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (IdP GhcRn)
</span><a href="#local-6989586621681093987"><span class="hs-identifier hs-var">mb_fromLabel</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-257"></span><span>           </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681093982"><span class="annot"><span class="annottext">IdP GhcRn
</span><a href="#local-6989586621681093982"><span class="hs-identifier hs-var">fromLabel</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; Name -&gt; HsExpr GhcRn
</span><a href="#local-6989586621681093981"><span class="hs-identifier hs-var">applyFromLabel</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681093984"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Name
IdP GhcRn
</span><a href="#local-6989586621681093982"><span class="hs-identifier hs-var">fromLabel</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093985"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-258"></span><span>           </span><span class="annot"><span class="annottext">Maybe (IdP GhcRn)
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681093980"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681093980"><span class="hs-identifier hs-var">isLabelClass</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Class
</span><a href="GHC.Tc.Utils.Env.html#tcLookupClass"><span class="hs-identifier hs-var">tcLookupClass</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#isLabelClassName"><span class="hs-identifier hs-var">isLabelClassName</span></a></span><span>
</span><span id="line-259"></span><span>                         </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681093978"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093978"><span class="hs-identifier hs-var">alpha</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#newFlexiTyVarTy"><span class="hs-identifier hs-var">newFlexiTyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a></span><span>
</span><span id="line-260"></span><span>                         </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681093975"><span class="annot"><span class="annottext">pred :: TcType
</span><a href="#local-6989586621681093975"><span class="hs-identifier hs-var hs-var">pred</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Class -&gt; [TcType] -&gt; TcType
</span><a href="GHC.Core.Predicate.html#mkClassPred"><span class="hs-identifier hs-var">mkClassPred</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681093980"><span class="hs-identifier hs-var">isLabelClass</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093974"><span class="hs-identifier hs-var">lbl</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093978"><span class="hs-identifier hs-var">alpha</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-261"></span><span>                         </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681093973"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681093973"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn SrcSpan
</span><a href="GHC.Tc.Utils.Monad.html#getSrcSpanM"><span class="hs-identifier hs-var">getSrcSpanM</span></a></span><span>
</span><span id="line-262"></span><span>                         </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681093972"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681093972"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; TcType -&gt; TcM Var
</span><a href="GHC.Tc.Utils.TcMType.html#emitWantedEvVar"><span class="hs-identifier hs-var">emitWantedEvVar</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621681093971"><span class="hs-identifier hs-var">origin</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093975"><span class="hs-identifier hs-var">pred</span></a></span><span>
</span><span id="line-263"></span><span>                         </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
-&gt; HsExpr GhcTc -&gt; TcType -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Utils.Unify.html#tcWrapResult"><span class="hs-identifier hs-var">tcWrapResult</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681093989"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-264"></span><span>                                       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="#local-6989586621681093970"><span class="hs-identifier hs-var">fromDict</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093975"><span class="hs-identifier hs-var">pred</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XVar GhcTc -&gt; Located (IdP GhcTc) -&gt; HsExpr GhcTc
forall p. XVar p -&gt; Located (IdP p) -&gt; HsExpr p
</span><a href="GHC.Hs.Expr.html#HsVar"><span class="hs-identifier hs-var">HsVar</span></a></span><span> </span><span class="annot"><span class="annottext">NoExtField
XVar GhcTc
</span><a href="GHC.Hs.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; Var -&gt; Located Var
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681093973"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681093972"><span class="hs-identifier hs-var">var</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-265"></span><span>                                        </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093978"><span class="hs-identifier hs-var">alpha</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093985"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-266"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-267"></span><span>  </span><span class="hs-comment">-- Coerces a dictionary for `IsLabel &quot;x&quot; t` into `t`,</span><span>
</span><span id="line-268"></span><span>  </span><span class="hs-comment">-- or `HasField &quot;x&quot; r a into `r -&gt; a`.</span><span>
</span><span id="line-269"></span><span>  </span><span id="local-6989586621681093970"><span class="annot"><span class="annottext">fromDict :: TcType -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="#local-6989586621681093970"><span class="hs-identifier hs-var hs-var">fromDict</span></a></span></span><span> </span><span id="local-6989586621681093969"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093969"><span class="hs-identifier hs-var">pred</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrap"><span class="hs-identifier hs-var">mkHsWrap</span></a></span><span> </span><span class="annot"><span class="annottext">(HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc)
-&gt; HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionR -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#mkWpCastR"><span class="hs-identifier hs-var">mkWpCastR</span></a></span><span> </span><span class="annot"><span class="annottext">(TcCoercionR -&gt; HsWrapper) -&gt; TcCoercionR -&gt; HsWrapper
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcCoercionR
</span><a href="GHC.Tc.Types.Evidence.html#unwrapIP"><span class="hs-identifier hs-var">unwrapIP</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093969"><span class="hs-identifier hs-var">pred</span></a></span><span>
</span><span id="line-270"></span><span>  </span><span id="local-6989586621681093971"><span class="annot"><span class="annottext">origin :: CtOrigin
</span><a href="#local-6989586621681093971"><span class="hs-identifier hs-var hs-var">origin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FieldLabelString -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#OverLabelOrigin"><span class="hs-identifier hs-var">OverLabelOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621681093986"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-271"></span><span>  </span><span id="local-6989586621681093974"><span class="annot"><span class="annottext">lbl :: TcType
</span><a href="#local-6989586621681093974"><span class="hs-identifier hs-var hs-var">lbl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FieldLabelString -&gt; TcType
</span><a href="GHC.Core.Type.html#mkStrLitTy"><span class="hs-identifier hs-var">mkStrLitTy</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621681093986"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-272"></span><span>
</span><span id="line-273"></span><span>  </span><span id="local-6989586621681093981"><span class="annot"><span class="annottext">applyFromLabel :: SrcSpan -&gt; Name -&gt; HsExpr GhcRn
</span><a href="#local-6989586621681093981"><span class="hs-identifier hs-var hs-var">applyFromLabel</span></a></span></span><span> </span><span id="local-6989586621681093967"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681093967"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681093966"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681093966"><span class="hs-identifier hs-var">fromLabel</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-274"></span><span>    </span><span class="annot"><span class="annottext">XAppTypeE GhcRn
-&gt; LHsExpr GhcRn -&gt; LHsWcType (NoGhcTc GhcRn) -&gt; HsExpr GhcRn
forall p.
XAppTypeE p -&gt; LHsExpr p -&gt; LHsWcType (NoGhcTc p) -&gt; HsExpr p
</span><a href="GHC.Hs.Expr.html#HsAppType"><span class="hs-identifier hs-var">HsAppType</span></a></span><span> </span><span class="annot"><span class="annottext">NoExtField
XAppTypeE GhcRn
</span><a href="GHC.Hs.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span>
</span><span id="line-275"></span><span>         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; HsExpr GhcRn -&gt; LHsExpr GhcRn
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681093967"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XVar GhcRn -&gt; GenLocated SrcSpan (IdP GhcRn) -&gt; HsExpr GhcRn
forall p. XVar p -&gt; Located (IdP p) -&gt; HsExpr p
</span><a href="GHC.Hs.Expr.html#HsVar"><span class="hs-identifier hs-var">HsVar</span></a></span><span> </span><span class="annot"><span class="annottext">NoExtField
XVar GhcRn
</span><a href="GHC.Hs.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; Name -&gt; GenLocated SrcSpan Name
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681093967"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681093966"><span class="hs-identifier hs-var">fromLabel</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-276"></span><span>         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpan (HsType GhcRn) -&gt; LHsWcType GhcRn
forall thing. thing -&gt; HsWildCardBndrs GhcRn thing
</span><a href="GHC.Hs.Type.html#mkEmptyWildCardBndrs"><span class="hs-identifier hs-var">mkEmptyWildCardBndrs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; HsType GhcRn -&gt; GenLocated SrcSpan (HsType GhcRn)
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681093967"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XTyLit GhcRn -&gt; HsTyLit -&gt; HsType GhcRn
forall pass. XTyLit pass -&gt; HsTyLit -&gt; HsType pass
</span><a href="GHC.Hs.Type.html#HsTyLit"><span class="hs-identifier hs-var">HsTyLit</span></a></span><span> </span><span class="annot"><span class="annottext">NoExtField
XTyLit GhcRn
</span><a href="GHC.Hs.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceText -&gt; FieldLabelString -&gt; HsTyLit
</span><a href="GHC.Hs.Type.html#HsStrTy"><span class="hs-identifier hs-var">HsStrTy</span></a></span><span> </span><span class="annot"><span class="annottext">SourceText
</span><a href="GHC.Types.Basic.html#NoSourceText"><span class="hs-identifier hs-var">NoSourceText</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621681093986"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-277"></span><span>
</span><span id="line-278"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsLam"><span class="hs-identifier hs-type">HsLam</span></a></span><span> </span><span id="local-6989586621681093960"><span class="annot"><span class="annottext">XLam GhcRn
</span><a href="#local-6989586621681093960"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681093959"><span class="annot"><span class="annottext">MatchGroup GhcRn (LHsExpr GhcRn)
</span><a href="#local-6989586621681093959"><span class="hs-identifier hs-var">match</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681093958"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093958"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-279"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681093957"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681093957"><span class="hs-identifier hs-var">wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093956"><span class="annot"><span class="annottext">MatchGroup GhcTc (LHsExpr GhcTc)
</span><a href="#local-6989586621681093956"><span class="hs-identifier hs-var">match'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SDoc
-&gt; TcMatchCtxt HsExpr
-&gt; MatchGroup GhcRn (LHsExpr GhcRn)
-&gt; ExpRhoType
-&gt; TcM (HsWrapper, MatchGroup GhcTc (LHsExpr GhcTc))
</span><a href="GHC.Tc.Gen.Match.html#tcMatchLambda"><span class="hs-identifier hs-var">tcMatchLambda</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681093954"><span class="hs-identifier hs-var">herald</span></a></span><span> </span><span class="annot"><span class="annottext">TcMatchCtxt HsExpr
</span><a href="#local-6989586621681093953"><span class="hs-identifier hs-var">match_ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">MatchGroup GhcRn (LHsExpr GhcRn)
</span><a href="#local-6989586621681093959"><span class="hs-identifier hs-var">match</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093958"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-280"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrap"><span class="hs-identifier hs-var">mkHsWrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681093957"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XLam GhcTc -&gt; MatchGroup GhcTc (LHsExpr GhcTc) -&gt; HsExpr GhcTc
forall p. XLam p -&gt; MatchGroup p (LHsExpr p) -&gt; HsExpr p
</span><a href="GHC.Hs.Expr.html#HsLam"><span class="hs-identifier hs-var">HsLam</span></a></span><span> </span><span class="annot"><span class="annottext">XLam GhcRn
XLam GhcTc
</span><a href="#local-6989586621681093960"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">MatchGroup GhcTc (LHsExpr GhcTc)
</span><a href="#local-6989586621681093956"><span class="hs-identifier hs-var">match'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-281"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-282"></span><span>    </span><span id="local-6989586621681093953"><span class="annot"><span class="annottext">match_ctxt :: TcMatchCtxt HsExpr
</span><a href="#local-6989586621681093953"><span class="hs-identifier hs-var hs-var">match_ctxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MC :: forall (body :: * -&gt; *).
HsMatchContext GhcRn
-&gt; (Located (body GhcRn)
    -&gt; ExpRhoType -&gt; TcM (Located (body GhcTc)))
-&gt; TcMatchCtxt body
</span><a href="GHC.Tc.Gen.Match.html#MC"><span class="hs-identifier hs-type">MC</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mc_what :: HsMatchContext GhcRn
</span><a href="GHC.Tc.Gen.Match.html#mc_what"><span class="hs-identifier hs-var">mc_what</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsMatchContext GhcRn
forall p. HsMatchContext p
</span><a href="GHC.Hs.Expr.html#LambdaExpr"><span class="hs-identifier hs-var">LambdaExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mc_body :: LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Match.html#mc_body"><span class="hs-identifier hs-var">mc_body</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Match.html#tcBody"><span class="hs-identifier hs-var">tcBody</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-283"></span><span>    </span><span id="local-6989586621681093954"><span class="annot"><span class="annottext">herald :: SDoc
</span><a href="#local-6989586621681093954"><span class="hs-identifier hs-var hs-var">herald</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;The lambda expression&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-284"></span><span>                   </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Depth -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pprSetDepth"><span class="hs-identifier hs-var">pprSetDepth</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ThLevel -&gt; Depth
</span><a href="GHC.Utils.Outputable.html#PartWay"><span class="hs-identifier hs-var">PartWay</span></a></span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc) -&gt; SDoc -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-285"></span><span>                           </span><span class="annot"><span class="annottext">MatchGroup GhcRn (LHsExpr GhcRn) -&gt; SDoc
forall (idR :: Pass) body.
(OutputableBndrId idR, Outputable body) =&gt;
MatchGroup (GhcPass idR) body -&gt; SDoc
</span><a href="GHC.Hs.Expr.html#pprMatches"><span class="hs-identifier hs-var">pprMatches</span></a></span><span> </span><span class="annot"><span class="annottext">MatchGroup GhcRn (LHsExpr GhcRn)
</span><a href="#local-6989586621681093959"><span class="hs-identifier hs-var">match</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-286"></span><span>                        </span><span class="hs-comment">-- The pprSetDepth makes the abstraction print briefly</span><span>
</span><span id="line-287"></span><span>                   </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;has&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-288"></span><span>
</span><span id="line-289"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span id="local-6989586621681093940"><span class="annot"><span class="annottext">e :: HsExpr GhcRn
</span><a href="#local-6989586621681093940"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsLamCase"><span class="hs-identifier hs-type">HsLamCase</span></a></span><span> </span><span id="local-6989586621681093938"><span class="annot"><span class="annottext">XLamCase GhcRn
</span><a href="#local-6989586621681093938"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681093937"><span class="annot"><span class="annottext">MatchGroup GhcRn (LHsExpr GhcRn)
</span><a href="#local-6989586621681093937"><span class="hs-identifier hs-var">matches</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681093936"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093936"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-290"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681093935"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681093935"><span class="hs-identifier hs-var">wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093934"><span class="annot"><span class="annottext">MatchGroup GhcTc (LHsExpr GhcTc)
</span><a href="#local-6989586621681093934"><span class="hs-identifier hs-var">matches'</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-291"></span><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SDoc
-&gt; TcMatchCtxt HsExpr
-&gt; MatchGroup GhcRn (LHsExpr GhcRn)
-&gt; ExpRhoType
-&gt; TcM (HsWrapper, MatchGroup GhcTc (LHsExpr GhcTc))
</span><a href="GHC.Tc.Gen.Match.html#tcMatchLambda"><span class="hs-identifier hs-var">tcMatchLambda</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681093933"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">TcMatchCtxt HsExpr
</span><a href="#local-6989586621681093932"><span class="hs-identifier hs-var">match_ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">MatchGroup GhcRn (LHsExpr GhcRn)
</span><a href="#local-6989586621681093937"><span class="hs-identifier hs-var">matches</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093936"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-292"></span><span>           </span><span class="hs-comment">-- The laziness annotation is because we don't want to fail here</span><span>
</span><span id="line-293"></span><span>           </span><span class="hs-comment">-- if there are multiple arguments</span><span>
</span><span id="line-294"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrap"><span class="hs-identifier hs-var">mkHsWrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681093935"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc -&gt; HsExpr GhcTc) -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">XLamCase GhcTc -&gt; MatchGroup GhcTc (LHsExpr GhcTc) -&gt; HsExpr GhcTc
forall p. XLamCase p -&gt; MatchGroup p (LHsExpr p) -&gt; HsExpr p
</span><a href="GHC.Hs.Expr.html#HsLamCase"><span class="hs-identifier hs-var">HsLamCase</span></a></span><span> </span><span class="annot"><span class="annottext">XLamCase GhcRn
XLamCase GhcTc
</span><a href="#local-6989586621681093938"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">MatchGroup GhcTc (LHsExpr GhcTc)
</span><a href="#local-6989586621681093934"><span class="hs-identifier hs-var">matches'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-295"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-296"></span><span>    </span><span id="local-6989586621681093933"><span class="annot"><span class="annottext">msg :: SDoc
</span><a href="#local-6989586621681093933"><span class="hs-identifier hs-var hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;The function&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681093940"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-297"></span><span>              </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;requires&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-298"></span><span>    </span><span id="local-6989586621681093932"><span class="annot"><span class="annottext">match_ctxt :: TcMatchCtxt HsExpr
</span><a href="#local-6989586621681093932"><span class="hs-identifier hs-var hs-var">match_ctxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MC :: forall (body :: * -&gt; *).
HsMatchContext GhcRn
-&gt; (Located (body GhcRn)
    -&gt; ExpRhoType -&gt; TcM (Located (body GhcTc)))
-&gt; TcMatchCtxt body
</span><a href="GHC.Tc.Gen.Match.html#MC"><span class="hs-identifier hs-type">MC</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mc_what :: HsMatchContext GhcRn
</span><a href="GHC.Tc.Gen.Match.html#mc_what"><span class="hs-identifier hs-var">mc_what</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsMatchContext GhcRn
forall p. HsMatchContext p
</span><a href="GHC.Hs.Expr.html#CaseAlt"><span class="hs-identifier hs-var">CaseAlt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mc_body :: LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Match.html#mc_body"><span class="hs-identifier hs-var">mc_body</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Match.html#tcBody"><span class="hs-identifier hs-var">tcBody</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-299"></span><span>
</span><span id="line-300"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span id="local-6989586621681093930"><span class="annot"><span class="annottext">e :: HsExpr GhcRn
</span><a href="#local-6989586621681093930"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#ExprWithTySig"><span class="hs-identifier hs-type">ExprWithTySig</span></a></span><span> </span><span class="annot"><span class="annottext">XExprWithTySig GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681093928"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093928"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span id="local-6989586621681093927"><span class="annot"><span class="annottext">LHsSigWcType (NoGhcTc GhcRn)
</span><a href="#local-6989586621681093927"><span class="hs-identifier hs-var">hs_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681093926"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093926"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-301"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681093925"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681093925"><span class="hs-identifier hs-var">expr'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093924"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093924"><span class="hs-identifier hs-var">poly_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
-&gt; LHsSigWcType (NoGhcTc GhcRn) -&gt; TcM (HsExpr GhcTc, TcType)
</span><a href="GHC.Tc.Gen.Expr.html#tcExprWithSig"><span class="hs-identifier hs-var">tcExprWithSig</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093928"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsSigWcType (NoGhcTc GhcRn)
</span><a href="#local-6989586621681093927"><span class="hs-identifier hs-var">hs_ty</span></a></span><span>
</span><span id="line-302"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
-&gt; HsExpr GhcTc -&gt; TcType -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Utils.Unify.html#tcWrapResult"><span class="hs-identifier hs-var">tcWrapResult</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681093930"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681093925"><span class="hs-identifier hs-var">expr'</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093924"><span class="hs-identifier hs-var">poly_ty</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093926"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-303"></span><span>
</span><span id="line-304"></span><span class="hs-comment">{-
Note [Type-checking overloaded labels]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Recall that we have

  module GHC.OverloadedLabels where
    class IsLabel (x :: Symbol) a where
      fromLabel :: a

We translate `#foo` to `fromLabel @&quot;foo&quot;`, where we use

 * the in-scope `fromLabel` if `RebindableSyntax` is enabled; or if not
 * `GHC.OverloadedLabels.fromLabel`.

In the `RebindableSyntax` case, the renamer will have filled in the
first field of `HsOverLabel` with the `fromLabel` function to use, and
we simply apply it to the appropriate visible type argument.

In the `OverloadedLabels` case, when we see an overloaded label like
`#foo`, we generate a fresh variable `alpha` for the type and emit an
`IsLabel &quot;foo&quot; alpha` constraint.  Because the `IsLabel` class has a
single method, it is represented by a newtype, so we can coerce
`IsLabel &quot;foo&quot; alpha` to `alpha` (just like for implicit parameters).

-}</span><span>
</span><span id="line-329"></span><span>
</span><span id="line-330"></span><span>
</span><span id="line-331"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Infix operators and sections
*                                                                      *
************************************************************************

Note [Left sections]
~~~~~~~~~~~~~~~~~~~~
Left sections, like (4 *), are equivalent to
        \ x -&gt; (*) 4 x,
or, if PostfixOperators is enabled, just
        (*) 4
With PostfixOperators we don't actually require the function to take
two arguments at all.  For example, (x `not`) means (not x); you get
postfix operators!  Not Haskell 98, but it's less work and kind of
useful.

Note [Typing rule for ($)]
~~~~~~~~~~~~~~~~~~~~~~~~~~
People write
   runST $ blah
so much, where
   runST :: (forall s. ST s a) -&gt; a
that I have finally given in and written a special type-checking
rule just for saturated applications of ($).
  * Infer the type of the first argument
  * Decompose it; should be of form (arg2_ty -&gt; res_ty),
       where arg2_ty might be a polytype
  * Use arg2_ty to typecheck arg2
-}</span><span>
</span><span id="line-362"></span><span>
</span><span id="line-363"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span id="local-6989586621681093922"><span class="annot"><span class="annottext">expr :: HsExpr GhcRn
</span><a href="#local-6989586621681093922"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#OpApp"><span class="hs-identifier hs-type">OpApp</span></a></span><span> </span><span id="local-6989586621681093920"><span class="annot"><span class="annottext">XOpApp GhcRn
</span><a href="#local-6989586621681093920"><span class="hs-identifier hs-var">fix</span></a></span></span><span> </span><span id="local-6989586621681093919"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093919"><span class="hs-identifier hs-var">arg1</span></a></span></span><span> </span><span id="local-6989586621681093918"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093918"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span id="local-6989586621681093917"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093917"><span class="hs-identifier hs-var">arg2</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681093916"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093916"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-364"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681093915"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681093915"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsVar"><span class="hs-identifier hs-type">HsVar</span></a></span><span> </span><span class="annot"><span class="annottext">XVar GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681093914"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681093914"><span class="hs-identifier hs-var">lv</span></a></span></span><span> </span><span id="local-6989586621681093913"><span class="annot"><span class="annottext">IdP GhcRn
</span><a href="#local-6989586621681093913"><span class="hs-identifier hs-var">op_name</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093918"><span class="hs-identifier hs-var">op</span></a></span><span>
</span><span id="line-365"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
IdP GhcRn
</span><a href="#local-6989586621681093913"><span class="hs-identifier hs-var">op_name</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; Unique -&gt; Bool
</span><a href="GHC.Types.Unique.html#hasKey"><span class="hs-operator hs-var">`hasKey`</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#dollarIdKey"><span class="hs-identifier hs-var">dollarIdKey</span></a></span><span>        </span><span class="hs-comment">-- Note [Typing rule for ($)]</span><span>
</span><span id="line-366"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Application rule&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093918"><span class="hs-identifier hs-var">op</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-367"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681093910"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681093910"><span class="hs-identifier hs-var">arg1'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093909"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093909"><span class="hs-identifier hs-var">arg1_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcM (LHsExpr GhcTc, TcType) -&gt; TcM (LHsExpr GhcTc, TcType)
forall a. SDoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; LHsExpr GhcRn -&gt; ThLevel -&gt; SDoc
forall fun arg.
(Outputable fun, Outputable arg) =&gt;
fun -&gt; arg -&gt; ThLevel -&gt; SDoc
</span><a href="GHC.Tc.Gen.HsType.html#funAppCtxt"><span class="hs-identifier hs-var">funAppCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093918"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093919"><span class="hs-identifier hs-var">arg1</span></a></span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc, TcType) -&gt; TcM (LHsExpr GhcTc, TcType))
-&gt; TcM (LHsExpr GhcTc, TcType) -&gt; TcM (LHsExpr GhcTc, TcType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-368"></span><span>                             </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; TcM (LHsExpr GhcTc, TcType)
</span><a href="GHC.Tc.Gen.Expr.html#tcInferRhoNC"><span class="hs-identifier hs-var">tcInferRhoNC</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093919"><span class="hs-identifier hs-var">arg1</span></a></span><span>
</span><span id="line-369"></span><span>
</span><span id="line-370"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681093906"><span class="annot"><span class="annottext">doc :: SDoc
</span><a href="#local-6989586621681093906"><span class="hs-identifier hs-var hs-var">doc</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;The first argument of ($) takes&quot;</span></span><span>
</span><span id="line-371"></span><span>             </span><span id="local-6989586621681093905"><span class="annot"><span class="annottext">orig1 :: CtOrigin
</span><a href="#local-6989586621681093905"><span class="hs-identifier hs-var hs-var">orig1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#lexprCtOrigin"><span class="hs-identifier hs-var">lexprCtOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093919"><span class="hs-identifier hs-var">arg1</span></a></span><span>
</span><span id="line-372"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681093903"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681093903"><span class="hs-identifier hs-var">wrap_arg1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621681093902"><span class="annot"><span class="annottext">Scaled TcType
</span><a href="#local-6989586621681093902"><span class="hs-identifier hs-var">arg2_sigma</span></a></span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093901"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093901"><span class="hs-identifier hs-var">op_res_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-373"></span><span>           </span><span class="annot"><span class="annottext">SDoc
-&gt; CtOrigin
-&gt; Maybe (HsExpr GhcRn)
-&gt; ThLevel
-&gt; TcType
-&gt; TcM (HsWrapper, [Scaled TcType], TcType)
</span><a href="GHC.Tc.Utils.Unify.html#matchActualFunTysRho"><span class="hs-identifier hs-var">matchActualFunTysRho</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681093906"><span class="hs-identifier hs-var">doc</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621681093905"><span class="hs-identifier hs-var">orig1</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; Maybe (HsExpr GhcRn)
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; HsExpr GhcRn
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093919"><span class="hs-identifier hs-var">arg1</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093909"><span class="hs-identifier hs-var">arg1_ty</span></a></span><span>
</span><span id="line-374"></span><span>
</span><span id="line-375"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681093898"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681093898"><span class="hs-identifier hs-var">mult_wrap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; TcType -&gt; TcType -&gt; TcM HsWrapper
</span><a href="GHC.Tc.Utils.Unify.html#tcSubMult"><span class="hs-identifier hs-var">tcSubMult</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#AppOrigin"><span class="hs-identifier hs-var">AppOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="GHC.Core.Type.html#Many"><span class="hs-identifier hs-var">Many</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scaled TcType -&gt; TcType
forall a. Scaled a -&gt; TcType
</span><a href="GHC.Core.TyCo.Rep.html#scaledMult"><span class="hs-identifier hs-var">scaledMult</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled TcType
</span><a href="#local-6989586621681093902"><span class="hs-identifier hs-var">arg2_sigma</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-376"></span><span>         </span><span class="hs-comment">-- See Note [Wrapper returned from tcSubMult] in GHC.Tc.Utils.Unify.</span><span>
</span><span id="line-377"></span><span>         </span><span class="hs-comment">--</span><span>
</span><span id="line-378"></span><span>         </span><span class="hs-comment">-- When ($) becomes multiplicity-polymorphic, then the above check will</span><span>
</span><span id="line-379"></span><span>         </span><span class="hs-comment">-- need to go. But in the meantime, it would produce ill-typed</span><span>
</span><span id="line-380"></span><span>         </span><span class="hs-comment">-- desugared code to accept linear functions to the left of a ($).</span><span>
</span><span id="line-381"></span><span>
</span><span id="line-382"></span><span>         </span><span class="hs-comment">-- We have (arg1 $ arg2)</span><span>
</span><span id="line-383"></span><span>         </span><span class="hs-comment">-- So: arg1_ty = arg2_ty -&gt; op_res_ty</span><span>
</span><span id="line-384"></span><span>         </span><span class="hs-comment">-- where arg2_sigma maybe polymorphic; that's the point</span><span>
</span><span id="line-385"></span><span>
</span><span id="line-386"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681093893"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681093893"><span class="hs-identifier hs-var">arg2'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
-&gt; LHsExpr GhcRn -&gt; Scaled TcType -&gt; ThLevel -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcArg"><span class="hs-identifier hs-var">tcArg</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681093891"><span class="hs-identifier hs-var">nl_op</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093917"><span class="hs-identifier hs-var">arg2</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled TcType
</span><a href="#local-6989586621681093902"><span class="hs-identifier hs-var">arg2_sigma</span></a></span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><span class="hs-number">2</span></span><span>
</span><span id="line-387"></span><span>
</span><span id="line-388"></span><span>       </span><span class="hs-comment">-- Make sure that the argument type has kind '*'</span><span>
</span><span id="line-389"></span><span>       </span><span class="hs-comment">--   ($) :: forall (r:RuntimeRep) (a:*) (b:TYPE r). (a-&gt;b) -&gt; a -&gt; b</span><span>
</span><span id="line-390"></span><span>       </span><span class="hs-comment">-- Eg we do not want to allow  (D#  $  4.0#)   #5570</span><span>
</span><span id="line-391"></span><span>       </span><span class="hs-comment">--    (which gives a seg fault)</span><span>
</span><span id="line-392"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcCoercionR
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (HsType GhcRn) -&gt; TcType -&gt; TcType -&gt; TcM TcCoercionR
</span><a href="GHC.Tc.Utils.Unify.html#unifyKind"><span class="hs-identifier hs-var">unifyKind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsType GhcRn -&gt; Maybe (HsType GhcRn)
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XXType GhcRn -&gt; HsType GhcRn
forall pass. XXType pass -&gt; HsType pass
</span><a href="GHC.Hs.Type.html#XHsType"><span class="hs-identifier hs-var">XHsType</span></a></span><span> </span><span class="annot"><span class="annottext">(XXType GhcRn -&gt; HsType GhcRn) -&gt; XXType GhcRn -&gt; HsType GhcRn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TcType -&gt; NewHsTypeX
</span><a href="GHC.Hs.Type.html#NHsCoreTy"><span class="hs-identifier hs-var">NHsCoreTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scaled TcType -&gt; TcType
forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled TcType
</span><a href="#local-6989586621681093902"><span class="hs-identifier hs-var">arg2_sigma</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-393"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; TcType -&gt; TcType
TcType -&gt; TcType
</span><a href="GHC.Core.Type.html#tcTypeKind"><span class="hs-identifier hs-var">tcTypeKind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scaled TcType -&gt; TcType
forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled TcType
</span><a href="#local-6989586621681093902"><span class="hs-identifier hs-var">arg2_sigma</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a></span><span>
</span><span id="line-394"></span><span>           </span><span class="hs-comment">-- Ignore the evidence. arg2_sigma must have type * or #,</span><span>
</span><span id="line-395"></span><span>           </span><span class="hs-comment">-- because we know (arg2_sigma -&gt; op_res_ty) is well-kinded</span><span>
</span><span id="line-396"></span><span>           </span><span class="hs-comment">-- (because otherwise matchActualFunTysRho would fail)</span><span>
</span><span id="line-397"></span><span>           </span><span class="hs-comment">-- So this 'unifyKind' will either succeed with Refl, or will</span><span>
</span><span id="line-398"></span><span>           </span><span class="hs-comment">-- produce an insoluble constraint * ~ #, which we'll report later.</span><span>
</span><span id="line-399"></span><span>
</span><span id="line-400"></span><span>       </span><span class="hs-comment">-- NB: unlike the argument type, the *result* type, op_res_ty can</span><span>
</span><span id="line-401"></span><span>       </span><span class="hs-comment">-- have any kind (#8739), so we don't need to check anything for that</span><span>
</span><span id="line-402"></span><span>
</span><span id="line-403"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681093885"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681093885"><span class="hs-identifier hs-var">op_id</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Var
</span><a href="GHC.Tc.Utils.Env.html#tcLookupId"><span class="hs-identifier hs-var">tcLookupId</span></a></span><span> </span><span class="annot"><span class="annottext">Name
IdP GhcRn
</span><a href="#local-6989586621681093913"><span class="hs-identifier hs-var">op_name</span></a></span><span>
</span><span id="line-404"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681093883"><span class="annot"><span class="annottext">op' :: LHsExpr GhcTc
</span><a href="#local-6989586621681093883"><span class="hs-identifier hs-var hs-var">op'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; HsExpr GhcTc -&gt; LHsExpr GhcTc
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681093915"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrap"><span class="hs-identifier hs-var">mkHsWrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TcType] -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#mkWpTyApps"><span class="hs-identifier hs-var">mkWpTyApps</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; TcType -&gt; TcType
TcType -&gt; TcType
</span><a href="GHC.Core.Type.html#getRuntimeRep"><span class="hs-identifier hs-var">getRuntimeRep</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093901"><span class="hs-identifier hs-var">op_res_ty</span></a></span><span>
</span><span id="line-405"></span><span>                                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Scaled TcType -&gt; TcType
forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled TcType
</span><a href="#local-6989586621681093902"><span class="hs-identifier hs-var">arg2_sigma</span></a></span><span>
</span><span id="line-406"></span><span>                                               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093901"><span class="hs-identifier hs-var">op_res_ty</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-407"></span><span>                                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XVar GhcTc -&gt; Located (IdP GhcTc) -&gt; HsExpr GhcTc
forall p. XVar p -&gt; Located (IdP p) -&gt; HsExpr p
</span><a href="GHC.Hs.Expr.html#HsVar"><span class="hs-identifier hs-var">HsVar</span></a></span><span> </span><span class="annot"><span class="annottext">NoExtField
XVar GhcTc
</span><a href="GHC.Hs.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; Var -&gt; Located Var
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681093914"><span class="hs-identifier hs-var">lv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681093885"><span class="hs-identifier hs-var">op_id</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-408"></span><span>             </span><span class="hs-comment">-- arg1' :: arg1_ty</span><span>
</span><span id="line-409"></span><span>             </span><span class="hs-comment">-- wrap_arg1 :: arg1_ty &quot;-&gt;&quot; (arg2_sigma -&gt; op_res_ty)</span><span>
</span><span id="line-410"></span><span>             </span><span class="hs-comment">-- op' :: (a2_ty -&gt; op_res_ty) -&gt; a2_ty -&gt; op_res_ty</span><span>
</span><span id="line-411"></span><span>
</span><span id="line-412"></span><span>             </span><span id="local-6989586621681093880"><span class="annot"><span class="annottext">expr' :: HsExpr GhcTc
</span><a href="#local-6989586621681093880"><span class="hs-identifier hs-var hs-var">expr'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XOpApp GhcTc
-&gt; LHsExpr GhcTc -&gt; LHsExpr GhcTc -&gt; LHsExpr GhcTc -&gt; HsExpr GhcTc
forall p.
XOpApp p -&gt; LHsExpr p -&gt; LHsExpr p -&gt; LHsExpr p -&gt; HsExpr p
</span><a href="GHC.Hs.Expr.html#OpApp"><span class="hs-identifier hs-var">OpApp</span></a></span><span> </span><span class="annot"><span class="annottext">XOpApp GhcRn
XOpApp GhcTc
</span><a href="#local-6989586621681093920"><span class="hs-identifier hs-var">fix</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper -&gt; LHsExpr GhcTc -&gt; LHsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkLHsWrap"><span class="hs-identifier hs-var">mkLHsWrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681093903"><span class="hs-identifier hs-var">wrap_arg1</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsWrapper -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681093898"><span class="hs-identifier hs-var">mult_wrap</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681093910"><span class="hs-identifier hs-var">arg1'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681093883"><span class="hs-identifier hs-var">op'</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681093893"><span class="hs-identifier hs-var">arg2'</span></a></span><span>
</span><span id="line-413"></span><span>
</span><span id="line-414"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
-&gt; HsExpr GhcTc -&gt; TcType -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Utils.Unify.html#tcWrapResult"><span class="hs-identifier hs-var">tcWrapResult</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681093922"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681093880"><span class="hs-identifier hs-var">expr'</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093901"><span class="hs-identifier hs-var">op_res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093916"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-415"></span><span>
</span><span id="line-416"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681093877"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681093877"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsRecFld"><span class="hs-identifier hs-type">HsRecFld</span></a></span><span> </span><span class="annot"><span class="annottext">XRecFld GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Type.html#Ambiguous"><span class="hs-identifier hs-type">Ambiguous</span></a></span><span> </span><span class="annot"><span class="annottext">XAmbiguous GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681093874"><span class="annot"><span class="annottext">Located RdrName
</span><a href="#local-6989586621681093874"><span class="hs-identifier hs-var">lbl</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093918"><span class="hs-identifier hs-var">op</span></a></span><span>
</span><span id="line-417"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681093873"><span class="annot"><span class="annottext">LHsSigWcType GhcRn
</span><a href="#local-6989586621681093873"><span class="hs-identifier hs-var">sig_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; Maybe (LHsSigWcType GhcRn)
</span><a href="GHC.Tc.Gen.Expr.html#obviousSig"><span class="hs-identifier hs-var">obviousSig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; HsExpr GhcRn
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093919"><span class="hs-identifier hs-var">arg1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-418"></span><span>    </span><span class="hs-comment">-- See Note [Disambiguating record fields]</span><span>
</span><span id="line-419"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681093871"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093871"><span class="hs-identifier hs-var">sig_tc_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt -&gt; LHsSigWcType GhcRn -&gt; TcM TcType
</span><a href="GHC.Tc.Gen.HsType.html#tcHsSigWcType"><span class="hs-identifier hs-var">tcHsSigWcType</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#ExprSigCtxt"><span class="hs-identifier hs-var">ExprSigCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">LHsSigWcType GhcRn
</span><a href="#local-6989586621681093873"><span class="hs-identifier hs-var">sig_ty</span></a></span><span>
</span><span id="line-420"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681093868"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681093868"><span class="hs-identifier hs-var">sel_name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Located RdrName -&gt; TcType -&gt; TcM Name
</span><a href="GHC.Tc.Gen.Expr.html#disambiguateSelector"><span class="hs-identifier hs-var">disambiguateSelector</span></a></span><span> </span><span class="annot"><span class="annottext">Located RdrName
</span><a href="#local-6989586621681093874"><span class="hs-identifier hs-var">lbl</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093871"><span class="hs-identifier hs-var">sig_tc_ty</span></a></span><span>
</span><span id="line-421"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681093866"><span class="annot"><span class="annottext">op' :: LHsExpr GhcRn
</span><a href="#local-6989586621681093866"><span class="hs-identifier hs-var hs-var">op'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; HsExpr GhcRn -&gt; LHsExpr GhcRn
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681093877"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XRecFld GhcRn -&gt; AmbiguousFieldOcc GhcRn -&gt; HsExpr GhcRn
forall p. XRecFld p -&gt; AmbiguousFieldOcc p -&gt; HsExpr p
</span><a href="GHC.Hs.Expr.html#HsRecFld"><span class="hs-identifier hs-var">HsRecFld</span></a></span><span> </span><span class="annot"><span class="annottext">NoExtField
XRecFld GhcRn
</span><a href="GHC.Hs.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XUnambiguous GhcRn -&gt; Located RdrName -&gt; AmbiguousFieldOcc GhcRn
forall pass.
XUnambiguous pass -&gt; Located RdrName -&gt; AmbiguousFieldOcc pass
</span><a href="GHC.Hs.Type.html#Unambiguous"><span class="hs-identifier hs-var">Unambiguous</span></a></span><span> </span><span class="annot"><span class="annottext">Name
XUnambiguous GhcRn
</span><a href="#local-6989586621681093868"><span class="hs-identifier hs-var">sel_name</span></a></span><span> </span><span class="annot"><span class="annottext">Located RdrName
</span><a href="#local-6989586621681093874"><span class="hs-identifier hs-var">lbl</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-422"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XOpApp GhcRn
-&gt; LHsExpr GhcRn -&gt; LHsExpr GhcRn -&gt; LHsExpr GhcRn -&gt; HsExpr GhcRn
forall p.
XOpApp p -&gt; LHsExpr p -&gt; LHsExpr p -&gt; LHsExpr p -&gt; HsExpr p
</span><a href="GHC.Hs.Expr.html#OpApp"><span class="hs-identifier hs-var">OpApp</span></a></span><span> </span><span class="annot"><span class="annottext">XOpApp GhcRn
</span><a href="#local-6989586621681093920"><span class="hs-identifier hs-var">fix</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093919"><span class="hs-identifier hs-var">arg1</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093866"><span class="hs-identifier hs-var">op'</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093917"><span class="hs-identifier hs-var">arg2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093916"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-423"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-424"></span><span>
</span><span id="line-425"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-426"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Non Application rule&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093918"><span class="hs-identifier hs-var">op</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-427"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681093864"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681093864"><span class="hs-identifier hs-var">op'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093863"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093863"><span class="hs-identifier hs-var">op_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; TcM (LHsExpr GhcTc, TcType)
</span><a href="GHC.Tc.Gen.Expr.html#tcInferRhoNC"><span class="hs-identifier hs-var">tcInferRhoNC</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093918"><span class="hs-identifier hs-var">op</span></a></span><span>
</span><span id="line-428"></span><span>
</span><span id="line-429"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681093862"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681093862"><span class="hs-identifier hs-var">wrap_fun</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span id="local-6989586621681093861"><span class="annot"><span class="annottext">Scaled TcType
</span><a href="#local-6989586621681093861"><span class="hs-identifier hs-var">arg1_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093860"><span class="annot"><span class="annottext">Scaled TcType
</span><a href="#local-6989586621681093860"><span class="hs-identifier hs-var">arg2_ty</span></a></span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093859"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093859"><span class="hs-identifier hs-var">op_res_ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-430"></span><span>                  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SDoc
-&gt; CtOrigin
-&gt; Maybe (HsExpr GhcRn)
-&gt; ThLevel
-&gt; TcType
-&gt; TcM (HsWrapper, [Scaled TcType], TcType)
</span><a href="GHC.Tc.Utils.Unify.html#matchActualFunTysRho"><span class="hs-identifier hs-var">matchActualFunTysRho</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; SDoc
</span><a href="GHC.Tc.Gen.Expr.html#mk_op_msg"><span class="hs-identifier hs-var">mk_op_msg</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093918"><span class="hs-identifier hs-var">op</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621681093857"><span class="hs-identifier hs-var">fn_orig</span></a></span><span>
</span><span id="line-431"></span><span>                                          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; Maybe (HsExpr GhcRn)
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; HsExpr GhcRn
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093918"><span class="hs-identifier hs-var">op</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093863"><span class="hs-identifier hs-var">op_ty</span></a></span><span>
</span><span id="line-432"></span><span>         </span><span class="hs-comment">-- You might think we should use tcInferApp here, but there is</span><span>
</span><span id="line-433"></span><span>         </span><span class="hs-comment">-- too much impedance-matching, because tcApp may return wrappers as</span><span>
</span><span id="line-434"></span><span>         </span><span class="hs-comment">-- well as type-checked arguments.</span><span>
</span><span id="line-435"></span><span>
</span><span id="line-436"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681093856"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681093856"><span class="hs-identifier hs-var">arg1'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
-&gt; LHsExpr GhcRn -&gt; Scaled TcType -&gt; ThLevel -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcArg"><span class="hs-identifier hs-var">tcArg</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681093891"><span class="hs-identifier hs-var">nl_op</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093919"><span class="hs-identifier hs-var">arg1</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled TcType
</span><a href="#local-6989586621681093861"><span class="hs-identifier hs-var">arg1_ty</span></a></span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><span class="hs-number">1</span></span><span>
</span><span id="line-437"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681093855"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681093855"><span class="hs-identifier hs-var">arg2'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
-&gt; LHsExpr GhcRn -&gt; Scaled TcType -&gt; ThLevel -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcArg"><span class="hs-identifier hs-var">tcArg</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681093891"><span class="hs-identifier hs-var">nl_op</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093917"><span class="hs-identifier hs-var">arg2</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled TcType
</span><a href="#local-6989586621681093860"><span class="hs-identifier hs-var">arg2_ty</span></a></span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><span class="hs-number">2</span></span><span>
</span><span id="line-438"></span><span>
</span><span id="line-439"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681093854"><span class="annot"><span class="annottext">expr' :: HsExpr GhcTc
</span><a href="#local-6989586621681093854"><span class="hs-identifier hs-var hs-var">expr'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XOpApp GhcTc
-&gt; LHsExpr GhcTc -&gt; LHsExpr GhcTc -&gt; LHsExpr GhcTc -&gt; HsExpr GhcTc
forall p.
XOpApp p -&gt; LHsExpr p -&gt; LHsExpr p -&gt; LHsExpr p -&gt; HsExpr p
</span><a href="GHC.Hs.Expr.html#OpApp"><span class="hs-identifier hs-var">OpApp</span></a></span><span> </span><span class="annot"><span class="annottext">XOpApp GhcRn
XOpApp GhcTc
</span><a href="#local-6989586621681093920"><span class="hs-identifier hs-var">fix</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681093856"><span class="hs-identifier hs-var">arg1'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper -&gt; LHsExpr GhcTc -&gt; LHsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkLHsWrap"><span class="hs-identifier hs-var">mkLHsWrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681093862"><span class="hs-identifier hs-var">wrap_fun</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681093864"><span class="hs-identifier hs-var">op'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681093855"><span class="hs-identifier hs-var">arg2'</span></a></span><span>
</span><span id="line-440"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
-&gt; HsExpr GhcTc -&gt; TcType -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Utils.Unify.html#tcWrapResult"><span class="hs-identifier hs-var">tcWrapResult</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681093922"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681093854"><span class="hs-identifier hs-var">expr'</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093859"><span class="hs-identifier hs-var">op_res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093916"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-441"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-442"></span><span>    </span><span id="local-6989586621681093857"><span class="annot"><span class="annottext">fn_orig :: CtOrigin
</span><a href="#local-6989586621681093857"><span class="hs-identifier hs-var hs-var">fn_orig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#exprCtOrigin"><span class="hs-identifier hs-var">exprCtOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681093891"><span class="hs-identifier hs-var">nl_op</span></a></span><span>
</span><span id="line-443"></span><span>    </span><span id="local-6989586621681093891"><span class="annot"><span class="annottext">nl_op :: HsExpr GhcRn
</span><a href="#local-6989586621681093891"><span class="hs-identifier hs-var hs-var">nl_op</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; HsExpr GhcRn
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093918"><span class="hs-identifier hs-var">op</span></a></span><span>
</span><span id="line-444"></span><span>
</span><span id="line-445"></span><span class="hs-comment">-- Right sections, equivalent to \ x -&gt; x `op` expr, or</span><span>
</span><span id="line-446"></span><span class="hs-comment">--      \ x -&gt; op x expr</span><span>
</span><span id="line-447"></span><span>
</span><span id="line-448"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span id="local-6989586621681093852"><span class="annot"><span class="annottext">expr :: HsExpr GhcRn
</span><a href="#local-6989586621681093852"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#SectionR"><span class="hs-identifier hs-type">SectionR</span></a></span><span> </span><span id="local-6989586621681093850"><span class="annot"><span class="annottext">XSectionR GhcRn
</span><a href="#local-6989586621681093850"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681093849"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093849"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span id="local-6989586621681093848"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093848"><span class="hs-identifier hs-var">arg2</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681093847"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093847"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-449"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681093846"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681093846"><span class="hs-identifier hs-var">op'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093845"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093845"><span class="hs-identifier hs-var">op_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; TcM (LHsExpr GhcTc, TcType)
</span><a href="GHC.Tc.Gen.Expr.html#tcInferRhoNC"><span class="hs-identifier hs-var">tcInferRhoNC</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093849"><span class="hs-identifier hs-var">op</span></a></span><span>
</span><span id="line-450"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681093844"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681093844"><span class="hs-identifier hs-var">wrap_fun</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span id="local-6989586621681093842"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093842"><span class="hs-identifier hs-var">arg1_mult</span></a></span></span><span> </span><span id="local-6989586621681093841"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093841"><span class="hs-identifier hs-var">arg1_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093840"><span class="annot"><span class="annottext">Scaled TcType
</span><a href="#local-6989586621681093840"><span class="hs-identifier hs-var">arg2_ty</span></a></span></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093839"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093839"><span class="hs-identifier hs-var">op_res_ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-451"></span><span>                  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SDoc
-&gt; CtOrigin
-&gt; Maybe (HsExpr GhcRn)
-&gt; ThLevel
-&gt; TcType
-&gt; TcM (HsWrapper, [Scaled TcType], TcType)
</span><a href="GHC.Tc.Utils.Unify.html#matchActualFunTysRho"><span class="hs-identifier hs-var">matchActualFunTysRho</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; SDoc
</span><a href="GHC.Tc.Gen.Expr.html#mk_op_msg"><span class="hs-identifier hs-var">mk_op_msg</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093849"><span class="hs-identifier hs-var">op</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621681093838"><span class="hs-identifier hs-var">fn_orig</span></a></span><span>
</span><span id="line-452"></span><span>                                          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; Maybe (HsExpr GhcRn)
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; HsExpr GhcRn
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093849"><span class="hs-identifier hs-var">op</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093845"><span class="hs-identifier hs-var">op_ty</span></a></span><span>
</span><span id="line-453"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681093837"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681093837"><span class="hs-identifier hs-var">arg2'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
-&gt; LHsExpr GhcRn -&gt; Scaled TcType -&gt; ThLevel -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcArg"><span class="hs-identifier hs-var">tcArg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; HsExpr GhcRn
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093849"><span class="hs-identifier hs-var">op</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093848"><span class="hs-identifier hs-var">arg2</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled TcType
</span><a href="#local-6989586621681093840"><span class="hs-identifier hs-var">arg2_ty</span></a></span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><span class="hs-number">2</span></span><span>
</span><span id="line-454"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681093836"><span class="annot"><span class="annottext">expr' :: HsExpr GhcTc
</span><a href="#local-6989586621681093836"><span class="hs-identifier hs-var hs-var">expr'</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XSectionR GhcTc -&gt; LHsExpr GhcTc -&gt; LHsExpr GhcTc -&gt; HsExpr GhcTc
forall p. XSectionR p -&gt; LHsExpr p -&gt; LHsExpr p -&gt; HsExpr p
</span><a href="GHC.Hs.Expr.html#SectionR"><span class="hs-identifier hs-var">SectionR</span></a></span><span> </span><span class="annot"><span class="annottext">XSectionR GhcRn
XSectionR GhcTc
</span><a href="#local-6989586621681093850"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper -&gt; LHsExpr GhcTc -&gt; LHsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkLHsWrap"><span class="hs-identifier hs-var">mkLHsWrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681093844"><span class="hs-identifier hs-var">wrap_fun</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681093846"><span class="hs-identifier hs-var">op'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681093837"><span class="hs-identifier hs-var">arg2'</span></a></span><span>
</span><span id="line-455"></span><span>             </span><span id="local-6989586621681093835"><span class="annot"><span class="annottext">act_res_ty :: TcType
</span><a href="#local-6989586621681093835"><span class="hs-identifier hs-var hs-var">act_res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcType -&gt; TcType -&gt; TcType
</span><a href="GHC.Core.TyCo.Rep.html#mkVisFunTy"><span class="hs-identifier hs-var">mkVisFunTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093842"><span class="hs-identifier hs-var">arg1_mult</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093841"><span class="hs-identifier hs-var">arg1_ty</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093839"><span class="hs-identifier hs-var">op_res_ty</span></a></span><span>
</span><span id="line-456"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
-&gt; HsExpr GhcTc -&gt; TcType -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Utils.Unify.html#tcWrapResultMono"><span class="hs-identifier hs-var">tcWrapResultMono</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681093852"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681093836"><span class="hs-identifier hs-var">expr'</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093835"><span class="hs-identifier hs-var">act_res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093847"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-457"></span><span>
</span><span id="line-458"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-459"></span><span>    </span><span id="local-6989586621681093838"><span class="annot"><span class="annottext">fn_orig :: CtOrigin
</span><a href="#local-6989586621681093838"><span class="hs-identifier hs-var hs-var">fn_orig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#lexprCtOrigin"><span class="hs-identifier hs-var">lexprCtOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093849"><span class="hs-identifier hs-var">op</span></a></span><span>
</span><span id="line-460"></span><span>    </span><span class="hs-comment">-- It's important to use the origin of 'op', so that call-stacks</span><span>
</span><span id="line-461"></span><span>    </span><span class="hs-comment">-- come out right; they are driven by the OccurrenceOf CtOrigin</span><span>
</span><span id="line-462"></span><span>    </span><span class="hs-comment">-- See #13285</span><span>
</span><span id="line-463"></span><span>
</span><span id="line-464"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span id="local-6989586621681093832"><span class="annot"><span class="annottext">expr :: HsExpr GhcRn
</span><a href="#local-6989586621681093832"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#SectionL"><span class="hs-identifier hs-type">SectionL</span></a></span><span> </span><span id="local-6989586621681093830"><span class="annot"><span class="annottext">XSectionL GhcRn
</span><a href="#local-6989586621681093830"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681093829"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093829"><span class="hs-identifier hs-var">arg1</span></a></span></span><span> </span><span id="local-6989586621681093828"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093828"><span class="hs-identifier hs-var">op</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681093827"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093827"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-465"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681093826"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681093826"><span class="hs-identifier hs-var">op'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093825"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093825"><span class="hs-identifier hs-var">op_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; TcM (LHsExpr GhcTc, TcType)
</span><a href="GHC.Tc.Gen.Expr.html#tcInferRhoNC"><span class="hs-identifier hs-var">tcInferRhoNC</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093828"><span class="hs-identifier hs-var">op</span></a></span><span>
</span><span id="line-466"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681093824"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681093824"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>      </span><span class="hs-comment">-- Note [Left sections]</span><span>
</span><span id="line-467"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681093822"><span class="annot"><span class="annottext">n_reqd_args :: ThLevel
</span><a href="#local-6989586621681093822"><span class="hs-identifier hs-var hs-var">n_reqd_args</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#xopt"><span class="hs-identifier hs-var">xopt</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><a href="../../ghc-boot-th/src/GHC.LanguageExtensions.Type.html#PostfixOperators"><span class="hs-identifier hs-var">LangExt.PostfixOperators</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681093824"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><span class="hs-number">1</span></span><span>
</span><span id="line-468"></span><span>                         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>                            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><span class="hs-number">2</span></span><span>
</span><span id="line-469"></span><span>
</span><span id="line-470"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681093819"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681093819"><span class="hs-identifier hs-var">wrap_fn</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681093818"><span class="annot"><span class="annottext">Scaled TcType
</span><a href="#local-6989586621681093818"><span class="hs-identifier hs-var">arg1_ty</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681093817"><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681093817"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093816"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093816"><span class="hs-identifier hs-var">op_res_ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-471"></span><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SDoc
-&gt; CtOrigin
-&gt; Maybe (HsExpr GhcRn)
-&gt; ThLevel
-&gt; TcType
-&gt; TcM (HsWrapper, [Scaled TcType], TcType)
</span><a href="GHC.Tc.Utils.Unify.html#matchActualFunTysRho"><span class="hs-identifier hs-var">matchActualFunTysRho</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; SDoc
</span><a href="GHC.Tc.Gen.Expr.html#mk_op_msg"><span class="hs-identifier hs-var">mk_op_msg</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093828"><span class="hs-identifier hs-var">op</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621681093815"><span class="hs-identifier hs-var">fn_orig</span></a></span><span>
</span><span id="line-472"></span><span>                                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; Maybe (HsExpr GhcRn)
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; HsExpr GhcRn
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093828"><span class="hs-identifier hs-var">op</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621681093822"><span class="hs-identifier hs-var">n_reqd_args</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093825"><span class="hs-identifier hs-var">op_ty</span></a></span><span>
</span><span id="line-473"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681093814"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681093814"><span class="hs-identifier hs-var">arg1'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
-&gt; LHsExpr GhcRn -&gt; Scaled TcType -&gt; ThLevel -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcArg"><span class="hs-identifier hs-var">tcArg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; HsExpr GhcRn
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093828"><span class="hs-identifier hs-var">op</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093829"><span class="hs-identifier hs-var">arg1</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled TcType
</span><a href="#local-6989586621681093818"><span class="hs-identifier hs-var">arg1_ty</span></a></span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><span class="hs-number">1</span></span><span>
</span><span id="line-474"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681093813"><span class="annot"><span class="annottext">expr' :: HsExpr GhcTc
</span><a href="#local-6989586621681093813"><span class="hs-identifier hs-var hs-var">expr'</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XSectionL GhcTc -&gt; LHsExpr GhcTc -&gt; LHsExpr GhcTc -&gt; HsExpr GhcTc
forall p. XSectionL p -&gt; LHsExpr p -&gt; LHsExpr p -&gt; HsExpr p
</span><a href="GHC.Hs.Expr.html#SectionL"><span class="hs-identifier hs-var">SectionL</span></a></span><span> </span><span class="annot"><span class="annottext">XSectionL GhcRn
XSectionL GhcTc
</span><a href="#local-6989586621681093830"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681093814"><span class="hs-identifier hs-var">arg1'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper -&gt; LHsExpr GhcTc -&gt; LHsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkLHsWrap"><span class="hs-identifier hs-var">mkLHsWrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681093819"><span class="hs-identifier hs-var">wrap_fn</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681093826"><span class="hs-identifier hs-var">op'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-475"></span><span>             </span><span id="local-6989586621681093812"><span class="annot"><span class="annottext">act_res_ty :: TcType
</span><a href="#local-6989586621681093812"><span class="hs-identifier hs-var hs-var">act_res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Scaled TcType] -&gt; TcType -&gt; TcType
</span><a href="GHC.Core.TyCo.Rep.html#mkVisFunTys"><span class="hs-identifier hs-var">mkVisFunTys</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681093817"><span class="hs-identifier hs-var">arg_tys</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093816"><span class="hs-identifier hs-var">op_res_ty</span></a></span><span>
</span><span id="line-476"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
-&gt; HsExpr GhcTc -&gt; TcType -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Utils.Unify.html#tcWrapResultMono"><span class="hs-identifier hs-var">tcWrapResultMono</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681093832"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681093813"><span class="hs-identifier hs-var">expr'</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093812"><span class="hs-identifier hs-var">act_res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093827"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-477"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-478"></span><span>    </span><span id="local-6989586621681093815"><span class="annot"><span class="annottext">fn_orig :: CtOrigin
</span><a href="#local-6989586621681093815"><span class="hs-identifier hs-var hs-var">fn_orig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#lexprCtOrigin"><span class="hs-identifier hs-var">lexprCtOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093828"><span class="hs-identifier hs-var">op</span></a></span><span>
</span><span id="line-479"></span><span>    </span><span class="hs-comment">-- It's important to use the origin of 'op', so that call-stacks</span><span>
</span><span id="line-480"></span><span>    </span><span class="hs-comment">-- come out right; they are driven by the OccurrenceOf CtOrigin</span><span>
</span><span id="line-481"></span><span>    </span><span class="hs-comment">-- See #13285</span><span>
</span><span id="line-482"></span><span>
</span><span id="line-483"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span id="local-6989586621681093810"><span class="annot"><span class="annottext">expr :: HsExpr GhcRn
</span><a href="#local-6989586621681093810"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#ExplicitTuple"><span class="hs-identifier hs-type">ExplicitTuple</span></a></span><span> </span><span id="local-6989586621681093808"><span class="annot"><span class="annottext">XExplicitTuple GhcRn
</span><a href="#local-6989586621681093808"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681093807"><span class="annot"><span class="annottext">[LHsTupArg GhcRn]
</span><a href="#local-6989586621681093807"><span class="hs-identifier hs-var">tup_args</span></a></span></span><span> </span><span id="local-6989586621681093806"><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681093806"><span class="hs-identifier hs-var">boxity</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681093805"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093805"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-484"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">(LHsTupArg GhcRn -&gt; Bool) -&gt; [LHsTupArg GhcRn] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#all"><span class="hs-identifier hs-var">all</span></a></span><span> </span><span class="annot"><span class="annottext">LHsTupArg GhcRn -&gt; Bool
forall id. LHsTupArg id -&gt; Bool
</span><a href="GHC.Hs.Expr.html#tupArgPresent"><span class="hs-identifier hs-var">tupArgPresent</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsTupArg GhcRn]
</span><a href="#local-6989586621681093807"><span class="hs-identifier hs-var">tup_args</span></a></span><span>
</span><span id="line-485"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681093802"><span class="annot"><span class="annottext">arity :: ThLevel
</span><a href="#local-6989586621681093802"><span class="hs-identifier hs-var hs-var">arity</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[LHsTupArg GhcRn] -&gt; ThLevel
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; ThLevel
</span><a href="../../base/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsTupArg GhcRn]
</span><a href="#local-6989586621681093807"><span class="hs-identifier hs-var">tup_args</span></a></span><span>
</span><span id="line-486"></span><span>             </span><span id="local-6989586621681093800"><span class="annot"><span class="annottext">tup_tc :: TyCon
</span><a href="#local-6989586621681093800"><span class="hs-identifier hs-var hs-var">tup_tc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Boxity -&gt; ThLevel -&gt; TyCon
</span><a href="GHC.Builtin.Types.html#tupleTyCon"><span class="hs-identifier hs-var">tupleTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681093806"><span class="hs-identifier hs-var">boxity</span></a></span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621681093802"><span class="hs-identifier hs-var">arity</span></a></span><span>
</span><span id="line-487"></span><span>               </span><span class="hs-comment">-- NB: tupleTyCon doesn't flatten 1-tuples</span><span>
</span><span id="line-488"></span><span>               </span><span class="hs-comment">-- See Note [Don't flatten tuples from HsSyn] in GHC.Core.Make</span><span>
</span><span id="line-489"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681093798"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093798"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpRhoType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#expTypeToType"><span class="hs-identifier hs-var">expTypeToType</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093805"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-490"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681093796"><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621681093796"><span class="hs-identifier hs-var">coi</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093795"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681093795"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TcType -&gt; TcM (TcCoercionR, [TcType])
</span><a href="GHC.Tc.Utils.Unify.html#matchExpectedTyConApp"><span class="hs-identifier hs-var">matchExpectedTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681093800"><span class="hs-identifier hs-var">tup_tc</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093798"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-491"></span><span>                           </span><span class="hs-comment">-- Unboxed tuples have RuntimeRep vars, which we</span><span>
</span><span id="line-492"></span><span>                           </span><span class="hs-comment">-- don't care about here</span><span>
</span><span id="line-493"></span><span>                           </span><span class="hs-comment">-- See Note [Unboxed tuple RuntimeRep vars] in GHC.Core.TyCon</span><span>
</span><span id="line-494"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681093793"><span class="annot"><span class="annottext">arg_tys' :: [TcType]
</span><a href="#local-6989586621681093793"><span class="hs-identifier hs-var hs-var">arg_tys'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681093806"><span class="hs-identifier hs-var">boxity</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="GHC.Types.Basic.html#Unboxed"><span class="hs-identifier hs-var">Unboxed</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ThLevel -&gt; [TcType] -&gt; [TcType]
forall a. ThLevel -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.List.html#drop"><span class="hs-identifier hs-var">drop</span></a></span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621681093802"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681093795"><span class="hs-identifier hs-var">arg_tys</span></a></span><span>
</span><span id="line-495"></span><span>                                       </span><span class="annot"><span class="annottext">Boxity
</span><a href="GHC.Types.Basic.html#Boxed"><span class="hs-identifier hs-var">Boxed</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681093795"><span class="hs-identifier hs-var">arg_tys</span></a></span><span>
</span><span id="line-496"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681093789"><span class="annot"><span class="annottext">[LHsTupArg GhcTc]
</span><a href="#local-6989586621681093789"><span class="hs-identifier hs-var">tup_args1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[LHsTupArg GhcRn] -&gt; [TcType] -&gt; TcM [LHsTupArg GhcTc]
</span><a href="GHC.Tc.Gen.Expr.html#tcTupArgs"><span class="hs-identifier hs-var">tcTupArgs</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsTupArg GhcRn]
</span><a href="#local-6989586621681093807"><span class="hs-identifier hs-var">tup_args</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681093793"><span class="hs-identifier hs-var">arg_tys'</span></a></span><span>
</span><span id="line-497"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc -&gt; TcM (HsExpr GhcTc))
-&gt; HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionR -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrapCo"><span class="hs-identifier hs-var">mkHsWrapCo</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621681093796"><span class="hs-identifier hs-var">coi</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XExplicitTuple GhcTc -&gt; [LHsTupArg GhcTc] -&gt; Boxity -&gt; HsExpr GhcTc
forall p. XExplicitTuple p -&gt; [LHsTupArg p] -&gt; Boxity -&gt; HsExpr p
</span><a href="GHC.Hs.Expr.html#ExplicitTuple"><span class="hs-identifier hs-var">ExplicitTuple</span></a></span><span> </span><span class="annot"><span class="annottext">XExplicitTuple GhcRn
XExplicitTuple GhcTc
</span><a href="#local-6989586621681093808"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsTupArg GhcTc]
</span><a href="#local-6989586621681093789"><span class="hs-identifier hs-var">tup_args1</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681093806"><span class="hs-identifier hs-var">boxity</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-498"></span><span>
</span><span id="line-499"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-500"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- The tup_args are a mixture of Present and Missing (for tuple sections)</span><span>
</span><span id="line-501"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681093786"><span class="annot"><span class="annottext">arity :: ThLevel
</span><a href="#local-6989586621681093786"><span class="hs-identifier hs-var hs-var">arity</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[LHsTupArg GhcRn] -&gt; ThLevel
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; ThLevel
</span><a href="../../base/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsTupArg GhcRn]
</span><a href="#local-6989586621681093807"><span class="hs-identifier hs-var">tup_args</span></a></span><span>
</span><span id="line-502"></span><span>
</span><span id="line-503"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681093785"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681093785"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681093806"><span class="hs-identifier hs-var">boxity</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-504"></span><span>           </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="GHC.Types.Basic.html#Boxed"><span class="hs-identifier hs-var">Boxed</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ThLevel -&gt; TcType -&gt; IOEnv (Env TcGblEnv TcLclEnv) [TcType]
</span><a href="GHC.Tc.Utils.TcMType.html#newFlexiTyVarTys"><span class="hs-identifier hs-var">newFlexiTyVarTys</span></a></span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621681093786"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a></span><span>
</span><span id="line-505"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="GHC.Types.Basic.html#Unboxed"><span class="hs-identifier hs-var">Unboxed</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ThLevel -&gt; TcM TcType -&gt; IOEnv (Env TcGblEnv TcLclEnv) [TcType]
forall (m :: * -&gt; *) a. Applicative m =&gt; ThLevel -&gt; m a -&gt; m [a]
</span><a href="../../base/src/Control.Monad.html#replicateM"><span class="hs-identifier hs-var">replicateM</span></a></span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621681093786"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="annot"><span class="annottext">TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#newOpenFlexiTyVarTy"><span class="hs-identifier hs-var">newOpenFlexiTyVarTy</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-506"></span><span>
</span><span id="line-507"></span><span>       </span><span class="hs-comment">-- Handle tuple sections where</span><span>
</span><span id="line-508"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681093782"><span class="annot"><span class="annottext">[LHsTupArg GhcTc]
</span><a href="#local-6989586621681093782"><span class="hs-identifier hs-var">tup_args1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[LHsTupArg GhcRn] -&gt; [TcType] -&gt; TcM [LHsTupArg GhcTc]
</span><a href="GHC.Tc.Gen.Expr.html#tcTupArgs"><span class="hs-identifier hs-var">tcTupArgs</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsTupArg GhcRn]
</span><a href="#local-6989586621681093807"><span class="hs-identifier hs-var">tup_args</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681093785"><span class="hs-identifier hs-var">arg_tys</span></a></span><span>
</span><span id="line-509"></span><span>
</span><span id="line-510"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681093781"><span class="annot"><span class="annottext">expr' :: HsExpr GhcTc
</span><a href="#local-6989586621681093781"><span class="hs-identifier hs-var hs-var">expr'</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XExplicitTuple GhcTc -&gt; [LHsTupArg GhcTc] -&gt; Boxity -&gt; HsExpr GhcTc
forall p. XExplicitTuple p -&gt; [LHsTupArg p] -&gt; Boxity -&gt; HsExpr p
</span><a href="GHC.Hs.Expr.html#ExplicitTuple"><span class="hs-identifier hs-var">ExplicitTuple</span></a></span><span> </span><span class="annot"><span class="annottext">XExplicitTuple GhcRn
XExplicitTuple GhcTc
</span><a href="#local-6989586621681093808"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsTupArg GhcTc]
</span><a href="#local-6989586621681093782"><span class="hs-identifier hs-var">tup_args1</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681093806"><span class="hs-identifier hs-var">boxity</span></a></span><span>
</span><span id="line-511"></span><span>             </span><span id="local-6989586621681093780"><span class="annot"><span class="annottext">missing_tys :: [Scaled TcType]
</span><a href="#local-6989586621681093780"><span class="hs-identifier hs-var hs-var">missing_tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TcType -&gt; TcType -&gt; Scaled TcType
forall a. TcType -&gt; a -&gt; Scaled a
</span><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-var">Scaled</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093779"><span class="hs-identifier hs-var">mult</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093778"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#Missing"><span class="hs-identifier hs-type">Missing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span id="local-6989586621681093779"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093779"><span class="hs-identifier hs-var">mult</span></a></span></span><span> </span><span class="annot"><span class="annottext">TcType
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093778"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093778"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[LHsTupArg GhcTc] -&gt; [TcType] -&gt; [(LHsTupArg GhcTc, TcType)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../../base/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsTupArg GhcTc]
</span><a href="#local-6989586621681093782"><span class="hs-identifier hs-var">tup_args1</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681093785"><span class="hs-identifier hs-var">arg_tys</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-512"></span><span>
</span><span id="line-513"></span><span>             </span><span class="hs-comment">-- See Note [Linear fields generalization]</span><span>
</span><span id="line-514"></span><span>             </span><span id="local-6989586621681093776"><span class="annot"><span class="annottext">act_res_ty :: TcType
</span><a href="#local-6989586621681093776"><span class="hs-identifier hs-var hs-var">act_res_ty</span></a></span></span><span>
</span><span id="line-515"></span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Scaled TcType] -&gt; TcType -&gt; TcType
</span><a href="GHC.Core.TyCo.Rep.html#mkVisFunTys"><span class="hs-identifier hs-var">mkVisFunTys</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681093780"><span class="hs-identifier hs-var">missing_tys</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Boxity -&gt; [TcType] -&gt; TcType
</span><a href="GHC.Builtin.Types.html#mkTupleTy1"><span class="hs-identifier hs-var">mkTupleTy1</span></a></span><span> </span><span class="annot"><span class="annottext">Boxity
</span><a href="#local-6989586621681093806"><span class="hs-identifier hs-var">boxity</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681093785"><span class="hs-identifier hs-var">arg_tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-516"></span><span>                   </span><span class="hs-comment">-- See Note [Don't flatten tuples from HsSyn] in GHC.Core.Make</span><span>
</span><span id="line-517"></span><span>
</span><span id="line-518"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;ExplicitTuple&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093776"><span class="hs-identifier hs-var">act_res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093805"><span class="hs-identifier hs-var">res_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-519"></span><span>
</span><span id="line-520"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
-&gt; HsExpr GhcTc -&gt; TcType -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Utils.Unify.html#tcWrapResultMono"><span class="hs-identifier hs-var">tcWrapResultMono</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681093810"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681093781"><span class="hs-identifier hs-var">expr'</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093776"><span class="hs-identifier hs-var">act_res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093805"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-521"></span><span>
</span><span id="line-522"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#ExplicitSum"><span class="hs-identifier hs-type">ExplicitSum</span></a></span><span> </span><span class="annot"><span class="annottext">XExplicitSum GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681093772"><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621681093772"><span class="hs-identifier hs-var">alt</span></a></span></span><span> </span><span id="local-6989586621681093771"><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621681093771"><span class="hs-identifier hs-var">arity</span></a></span></span><span> </span><span id="local-6989586621681093770"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093770"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681093769"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093769"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-523"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681093768"><span class="annot"><span class="annottext">sum_tc :: TyCon
</span><a href="#local-6989586621681093768"><span class="hs-identifier hs-var hs-var">sum_tc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ThLevel -&gt; TyCon
</span><a href="GHC.Builtin.Types.html#sumTyCon"><span class="hs-identifier hs-var">sumTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621681093771"><span class="hs-identifier hs-var">arity</span></a></span><span>
</span><span id="line-524"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681093766"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093766"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpRhoType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#expTypeToType"><span class="hs-identifier hs-var">expTypeToType</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093769"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-525"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681093765"><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621681093765"><span class="hs-identifier hs-var">coi</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093764"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681093764"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TcType -&gt; TcM (TcCoercionR, [TcType])
</span><a href="GHC.Tc.Utils.Unify.html#matchExpectedTyConApp"><span class="hs-identifier hs-var">matchExpectedTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681093768"><span class="hs-identifier hs-var">sum_tc</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093766"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-526"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-comment">-- Drop levity vars, we don't care about them here</span><span>
</span><span id="line-527"></span><span>         </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681093763"><span class="annot"><span class="annottext">arg_tys' :: [TcType]
</span><a href="#local-6989586621681093763"><span class="hs-identifier hs-var hs-var">arg_tys'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ThLevel -&gt; [TcType] -&gt; [TcType]
forall a. ThLevel -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.List.html#drop"><span class="hs-identifier hs-var">drop</span></a></span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621681093771"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681093764"><span class="hs-identifier hs-var">arg_tys</span></a></span><span>
</span><span id="line-528"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681093762"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681093762"><span class="hs-identifier hs-var">expr'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; TcType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExpr"><span class="hs-identifier hs-var">tcCheckPolyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093770"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681093763"><span class="hs-identifier hs-var">arg_tys'</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType] -&gt; ThLevel -&gt; TcType
forall a. Outputable a =&gt; [a] -&gt; ThLevel -&gt; a
</span><a href="GHC.Data.List.SetOps.html#getNth"><span class="hs-operator hs-var">`getNth`</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621681093772"><span class="hs-identifier hs-var">alt</span></a></span><span> </span><span class="annot"><span class="annottext">ThLevel -&gt; ThLevel -&gt; ThLevel
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base/src/GHC.Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-529"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc -&gt; TcM (HsExpr GhcTc))
-&gt; HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionR -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrapCo"><span class="hs-identifier hs-var">mkHsWrapCo</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621681093765"><span class="hs-identifier hs-var">coi</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XExplicitSum GhcTc
-&gt; ThLevel -&gt; ThLevel -&gt; LHsExpr GhcTc -&gt; HsExpr GhcTc
forall p.
XExplicitSum p -&gt; ThLevel -&gt; ThLevel -&gt; LHsExpr p -&gt; HsExpr p
</span><a href="GHC.Hs.Expr.html#ExplicitSum"><span class="hs-identifier hs-var">ExplicitSum</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
XExplicitSum GhcTc
</span><a href="#local-6989586621681093763"><span class="hs-identifier hs-var">arg_tys'</span></a></span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621681093772"><span class="hs-identifier hs-var">alt</span></a></span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621681093771"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681093762"><span class="hs-identifier hs-var">expr'</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-530"></span><span>
</span><span id="line-531"></span><span class="hs-comment">-- This will see the empty list only when -XOverloadedLists.</span><span>
</span><span id="line-532"></span><span class="hs-comment">-- See Note [Empty lists] in GHC.Hs.Expr.</span><span>
</span><span id="line-533"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#ExplicitList"><span class="hs-identifier hs-type">ExplicitList</span></a></span><span> </span><span class="annot"><span class="annottext">XExplicitList GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681093759"><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcRn)
</span><a href="#local-6989586621681093759"><span class="hs-identifier hs-var">witness</span></a></span></span><span> </span><span id="local-6989586621681093758"><span class="annot"><span class="annottext">[LHsExpr GhcRn]
</span><a href="#local-6989586621681093758"><span class="hs-identifier hs-var">exprs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681093757"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093757"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-534"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcRn)
</span><a href="#local-6989586621681093759"><span class="hs-identifier hs-var">witness</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-535"></span><span>      </span><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcRn)
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681093756"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093756"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpRhoType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#expTypeToType"><span class="hs-identifier hs-var">expTypeToType</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093757"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-536"></span><span>                       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681093755"><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621681093755"><span class="hs-identifier hs-var">coi</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093754"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093754"><span class="hs-identifier hs-var">elt_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcM (TcCoercionR, TcType)
</span><a href="GHC.Tc.Utils.Unify.html#matchExpectedListTy"><span class="hs-identifier hs-var">matchExpectedListTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093756"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-537"></span><span>                       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681093752"><span class="annot"><span class="annottext">[LHsExpr GhcTc]
</span><a href="#local-6989586621681093752"><span class="hs-identifier hs-var">exprs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(LHsExpr GhcRn -&gt; TcM (LHsExpr GhcTc))
-&gt; [LHsExpr GhcRn] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [LHsExpr GhcTc]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; LHsExpr GhcRn -&gt; TcM (LHsExpr GhcTc)
</span><a href="#local-6989586621681093750"><span class="hs-identifier hs-var">tc_elt</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093754"><span class="hs-identifier hs-var">elt_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LHsExpr GhcRn]
</span><a href="#local-6989586621681093758"><span class="hs-identifier hs-var">exprs</span></a></span><span>
</span><span id="line-538"></span><span>                       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc -&gt; TcM (HsExpr GhcTc))
-&gt; HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-539"></span><span>                         </span><span class="annot"><span class="annottext">TcCoercionR -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrapCo"><span class="hs-identifier hs-var">mkHsWrapCo</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621681093755"><span class="hs-identifier hs-var">coi</span></a></span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc -&gt; HsExpr GhcTc) -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">XExplicitList GhcTc
-&gt; Maybe (SyntaxExpr GhcTc) -&gt; [LHsExpr GhcTc] -&gt; HsExpr GhcTc
forall p.
XExplicitList p -&gt; Maybe (SyntaxExpr p) -&gt; [LHsExpr p] -&gt; HsExpr p
</span><a href="GHC.Hs.Expr.html#ExplicitList"><span class="hs-identifier hs-var">ExplicitList</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
XExplicitList GhcTc
</span><a href="#local-6989586621681093754"><span class="hs-identifier hs-var">elt_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcTc)
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsExpr GhcTc]
</span><a href="#local-6989586621681093752"><span class="hs-identifier hs-var">exprs'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-540"></span><span>
</span><span id="line-541"></span><span>      </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681093749"><span class="annot"><span class="annottext">SyntaxExpr GhcRn
</span><a href="#local-6989586621681093749"><span class="hs-identifier hs-var">fln</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621681093748"><span class="annot"><span class="annottext">[LHsExpr GhcTc]
</span><a href="#local-6989586621681093748"><span class="hs-identifier hs-var">exprs'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093747"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093747"><span class="hs-identifier hs-var">elt_ty</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093746"><span class="annot"><span class="annottext">SyntaxExprTc
</span><a href="#local-6989586621681093746"><span class="hs-identifier hs-var">fln'</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-542"></span><span>                         </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin
-&gt; SyntaxExprRn
-&gt; [SyntaxOpType]
-&gt; ExpRhoType
-&gt; ([TcType] -&gt; [TcType] -&gt; TcM ([LHsExpr GhcTc], TcType))
-&gt; TcM (([LHsExpr GhcTc], TcType), SyntaxExprTc)
forall a.
CtOrigin
-&gt; SyntaxExprRn
-&gt; [SyntaxOpType]
-&gt; ExpRhoType
-&gt; ([TcType] -&gt; [TcType] -&gt; TcM a)
-&gt; TcM (a, SyntaxExprTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOp"><span class="hs-identifier hs-var">tcSyntaxOp</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#ListOrigin"><span class="hs-identifier hs-var">ListOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcRn
SyntaxExprRn
</span><a href="#local-6989586621681093749"><span class="hs-identifier hs-var">fln</span></a></span><span>
</span><span id="line-543"></span><span>                                       </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TcType -&gt; SyntaxOpType
</span><a href="GHC.Tc.Utils.TcType.html#synKnownType"><span class="hs-identifier hs-var">synKnownType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="GHC.Builtin.Types.html#intTy"><span class="hs-identifier hs-var">intTy</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="GHC.Tc.Utils.TcType.html#SynList"><span class="hs-identifier hs-var">SynList</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093757"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">(([TcType] -&gt; [TcType] -&gt; TcM ([LHsExpr GhcTc], TcType))
 -&gt; TcM (([LHsExpr GhcTc], TcType), SyntaxExprTc))
-&gt; ([TcType] -&gt; [TcType] -&gt; TcM ([LHsExpr GhcTc], TcType))
-&gt; TcM (([LHsExpr GhcTc], TcType), SyntaxExprTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-544"></span><span>                            </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">[</span><span id="local-6989586621681093742"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093742"><span class="hs-identifier hs-var">elt_ty</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span id="local-6989586621681093741"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093741"><span class="hs-identifier hs-var">_int_mul</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093740"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093740"><span class="hs-identifier hs-var">list_mul</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-545"></span><span>                              </span><span class="hs-comment">-- We ignore _int_mul because the integer (first</span><span>
</span><span id="line-546"></span><span>                              </span><span class="hs-comment">-- argument of fromListN) is statically known: it</span><span>
</span><span id="line-547"></span><span>                              </span><span class="hs-comment">-- is desugared to a literal. Therefore there is</span><span>
</span><span id="line-548"></span><span>                              </span><span class="hs-comment">-- no variable of which to scale the usage in that</span><span>
</span><span id="line-549"></span><span>                              </span><span class="hs-comment">-- first argument, and `_int_mul` is completely</span><span>
</span><span id="line-550"></span><span>                              </span><span class="hs-comment">-- free in this expression.</span><span>
</span><span id="line-551"></span><span>                            </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681093739"><span class="annot"><span class="annottext">[LHsExpr GhcTc]
</span><a href="#local-6989586621681093739"><span class="hs-identifier hs-var">exprs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-552"></span><span>                                    </span><span class="annot"><span class="annottext">(LHsExpr GhcRn -&gt; TcM (LHsExpr GhcTc))
-&gt; [LHsExpr GhcRn] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [LHsExpr GhcTc]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a. TcType -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-var">tcScalingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093740"><span class="hs-identifier hs-var">list_mul</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc))
-&gt; (LHsExpr GhcRn -&gt; TcM (LHsExpr GhcTc))
-&gt; LHsExpr GhcRn
-&gt; TcM (LHsExpr GhcTc)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">TcType -&gt; LHsExpr GhcRn -&gt; TcM (LHsExpr GhcTc)
</span><a href="#local-6989586621681093750"><span class="hs-identifier hs-var">tc_elt</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093742"><span class="hs-identifier hs-var">elt_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LHsExpr GhcRn]
</span><a href="#local-6989586621681093758"><span class="hs-identifier hs-var">exprs</span></a></span><span>
</span><span id="line-553"></span><span>                               </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">([LHsExpr GhcTc], TcType) -&gt; TcM ([LHsExpr GhcTc], TcType)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[LHsExpr GhcTc]
</span><a href="#local-6989586621681093739"><span class="hs-identifier hs-var">exprs'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093742"><span class="hs-identifier hs-var">elt_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-554"></span><span>
</span><span id="line-555"></span><span>                     </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc -&gt; TcM (HsExpr GhcTc))
-&gt; HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">XExplicitList GhcTc
-&gt; Maybe (SyntaxExpr GhcTc) -&gt; [LHsExpr GhcTc] -&gt; HsExpr GhcTc
forall p.
XExplicitList p -&gt; Maybe (SyntaxExpr p) -&gt; [LHsExpr p] -&gt; HsExpr p
</span><a href="GHC.Hs.Expr.html#ExplicitList"><span class="hs-identifier hs-var">ExplicitList</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
XExplicitList GhcTc
</span><a href="#local-6989586621681093747"><span class="hs-identifier hs-var">elt_ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SyntaxExprTc -&gt; Maybe SyntaxExprTc
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxExprTc
</span><a href="#local-6989586621681093746"><span class="hs-identifier hs-var">fln'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LHsExpr GhcTc]
</span><a href="#local-6989586621681093748"><span class="hs-identifier hs-var">exprs'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-556"></span><span>     </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681093750"><span class="annot"><span class="annottext">tc_elt :: TcType -&gt; LHsExpr GhcRn -&gt; TcM (LHsExpr GhcTc)
</span><a href="#local-6989586621681093750"><span class="hs-identifier hs-var hs-var">tc_elt</span></a></span></span><span> </span><span id="local-6989586621681093737"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093737"><span class="hs-identifier hs-var">elt_ty</span></a></span></span><span> </span><span id="local-6989586621681093736"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093736"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; TcType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExpr"><span class="hs-identifier hs-var">tcCheckPolyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093736"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093737"><span class="hs-identifier hs-var">elt_ty</span></a></span><span>
</span><span id="line-557"></span><span>
</span><span id="line-558"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Let, case, if, do
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-565"></span><span>
</span><span id="line-566"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsLet"><span class="hs-identifier hs-type">HsLet</span></a></span><span> </span><span id="local-6989586621681093734"><span class="annot"><span class="annottext">XLet GhcRn
</span><a href="#local-6989586621681093734"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681093733"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681093733"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621681093732"><span class="annot"><span class="annottext">HsLocalBinds GhcRn
</span><a href="#local-6989586621681093732"><span class="hs-identifier hs-var">binds</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681093731"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093731"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681093730"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093730"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-567"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681093729"><span class="annot"><span class="annottext">HsLocalBinds GhcTc
</span><a href="#local-6989586621681093729"><span class="hs-identifier hs-var">binds'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093728"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681093728"><span class="hs-identifier hs-var">expr'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsLocalBinds GhcRn
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (HsLocalBinds GhcTc, LHsExpr GhcTc)
forall thing.
HsLocalBinds GhcRn -&gt; TcM thing -&gt; TcM (HsLocalBinds GhcTc, thing)
</span><a href="GHC.Tc.Gen.Bind.html#tcLocalBinds"><span class="hs-identifier hs-var">tcLocalBinds</span></a></span><span> </span><span class="annot"><span class="annottext">HsLocalBinds GhcRn
</span><a href="#local-6989586621681093732"><span class="hs-identifier hs-var">binds</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (HsLocalBinds GhcTc, LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (HsLocalBinds GhcTc, LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-568"></span><span>                             </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcLExpr"><span class="hs-identifier hs-var">tcLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093731"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093730"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-569"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XLet GhcTc -&gt; LHsLocalBinds GhcTc -&gt; LHsExpr GhcTc -&gt; HsExpr GhcTc
forall p. XLet p -&gt; LHsLocalBinds p -&gt; LHsExpr p -&gt; HsExpr p
</span><a href="GHC.Hs.Expr.html#HsLet"><span class="hs-identifier hs-var">HsLet</span></a></span><span> </span><span class="annot"><span class="annottext">XLet GhcRn
XLet GhcTc
</span><a href="#local-6989586621681093734"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; HsLocalBinds GhcTc -&gt; LHsLocalBinds GhcTc
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681093733"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">HsLocalBinds GhcTc
</span><a href="#local-6989586621681093729"><span class="hs-identifier hs-var">binds'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681093728"><span class="hs-identifier hs-var">expr'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-570"></span><span>
</span><span id="line-571"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsCase"><span class="hs-identifier hs-type">HsCase</span></a></span><span> </span><span id="local-6989586621681093726"><span class="annot"><span class="annottext">XCase GhcRn
</span><a href="#local-6989586621681093726"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681093725"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093725"><span class="hs-identifier hs-var">scrut</span></a></span></span><span> </span><span id="local-6989586621681093724"><span class="annot"><span class="annottext">MatchGroup GhcRn (LHsExpr GhcRn)
</span><a href="#local-6989586621681093724"><span class="hs-identifier hs-var">matches</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681093723"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093723"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-572"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span>  </span><span class="hs-comment">-- We used to typecheck the case alternatives first.</span><span>
</span><span id="line-573"></span><span>           </span><span class="hs-comment">-- The case patterns tend to give good type info to use</span><span>
</span><span id="line-574"></span><span>           </span><span class="hs-comment">-- when typechecking the scrutinee.  For example</span><span>
</span><span id="line-575"></span><span>           </span><span class="hs-comment">--   case (map f) of</span><span>
</span><span id="line-576"></span><span>           </span><span class="hs-comment">--     (x:xs) -&gt; ...</span><span>
</span><span id="line-577"></span><span>           </span><span class="hs-comment">-- will report that map is applied to too few arguments</span><span>
</span><span id="line-578"></span><span>           </span><span class="hs-comment">--</span><span>
</span><span id="line-579"></span><span>           </span><span class="hs-comment">-- But now, in the GADT world, we need to typecheck the scrutinee</span><span>
</span><span id="line-580"></span><span>           </span><span class="hs-comment">-- first, to get type info that may be refined in the case alternatives</span><span>
</span><span id="line-581"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681093722"><span class="annot"><span class="annottext">mult :: TcType
</span><a href="#local-6989586621681093722"><span class="hs-identifier hs-var hs-var">mult</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="GHC.Core.Type.html#Many"><span class="hs-identifier hs-var">Many</span></a></span><span>
</span><span id="line-582"></span><span>            </span><span class="hs-comment">-- There is not yet syntax or inference mechanism for case</span><span>
</span><span id="line-583"></span><span>            </span><span class="hs-comment">-- expressions to be anything else than unrestricted.</span><span>
</span><span id="line-584"></span><span>
</span><span id="line-585"></span><span>          </span><span class="hs-comment">-- Typecheck the scrutinee.  We use tcInferRho but tcInferSigma</span><span>
</span><span id="line-586"></span><span>          </span><span class="hs-comment">-- would also be possible (tcMatchesCase accepts sigma-types)</span><span>
</span><span id="line-587"></span><span>          </span><span class="hs-comment">-- Interesting litmus test: do these two behave the same?</span><span>
</span><span id="line-588"></span><span>          </span><span class="hs-comment">--     case id        of {..}</span><span>
</span><span id="line-589"></span><span>          </span><span class="hs-comment">--     case (\v -&gt; v) of {..}</span><span>
</span><span id="line-590"></span><span>          </span><span class="hs-comment">-- This design choice is discussed in #17790</span><span>
</span><span id="line-591"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681093721"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681093721"><span class="hs-identifier hs-var">scrut'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093720"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093720"><span class="hs-identifier hs-var">scrut_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType
-&gt; TcM (LHsExpr GhcTc, TcType) -&gt; TcM (LHsExpr GhcTc, TcType)
forall a. TcType -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-var">tcScalingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093722"><span class="hs-identifier hs-var">mult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc, TcType) -&gt; TcM (LHsExpr GhcTc, TcType))
-&gt; TcM (LHsExpr GhcTc, TcType) -&gt; TcM (LHsExpr GhcTc, TcType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; TcM (LHsExpr GhcTc, TcType)
</span><a href="GHC.Tc.Gen.Expr.html#tcInferRho"><span class="hs-identifier hs-var">tcInferRho</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093725"><span class="hs-identifier hs-var">scrut</span></a></span><span>
</span><span id="line-592"></span><span>
</span><span id="line-593"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;HsCase&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093720"><span class="hs-identifier hs-var">scrut_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-594"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681093719"><span class="annot"><span class="annottext">MatchGroup GhcTc (LHsExpr GhcTc)
</span><a href="#local-6989586621681093719"><span class="hs-identifier hs-var">matches'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcMatchCtxt HsExpr
-&gt; Scaled TcType
-&gt; MatchGroup GhcRn (LHsExpr GhcRn)
-&gt; ExpRhoType
-&gt; TcM (MatchGroup GhcTc (LHsExpr GhcTc))
forall (body :: * -&gt; *).
Outputable (body GhcRn) =&gt;
TcMatchCtxt body
-&gt; Scaled TcType
-&gt; MatchGroup GhcRn (Located (body GhcRn))
-&gt; ExpRhoType
-&gt; TcM (MatchGroup GhcTc (Located (body GhcTc)))
</span><a href="GHC.Tc.Gen.Match.html#tcMatchesCase"><span class="hs-identifier hs-var">tcMatchesCase</span></a></span><span> </span><span class="annot"><span class="annottext">TcMatchCtxt HsExpr
</span><a href="#local-6989586621681093717"><span class="hs-identifier hs-var">match_ctxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; TcType -&gt; Scaled TcType
forall a. TcType -&gt; a -&gt; Scaled a
</span><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-var">Scaled</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093722"><span class="hs-identifier hs-var">mult</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093720"><span class="hs-identifier hs-var">scrut_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MatchGroup GhcRn (LHsExpr GhcRn)
</span><a href="#local-6989586621681093724"><span class="hs-identifier hs-var">matches</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093723"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-595"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XCase GhcTc
-&gt; LHsExpr GhcTc
-&gt; MatchGroup GhcTc (LHsExpr GhcTc)
-&gt; HsExpr GhcTc
forall p.
XCase p -&gt; LHsExpr p -&gt; MatchGroup p (LHsExpr p) -&gt; HsExpr p
</span><a href="GHC.Hs.Expr.html#HsCase"><span class="hs-identifier hs-var">HsCase</span></a></span><span> </span><span class="annot"><span class="annottext">XCase GhcRn
XCase GhcTc
</span><a href="#local-6989586621681093726"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681093721"><span class="hs-identifier hs-var">scrut'</span></a></span><span> </span><span class="annot"><span class="annottext">MatchGroup GhcTc (LHsExpr GhcTc)
</span><a href="#local-6989586621681093719"><span class="hs-identifier hs-var">matches'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-596"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-597"></span><span>    </span><span id="local-6989586621681093717"><span class="annot"><span class="annottext">match_ctxt :: TcMatchCtxt HsExpr
</span><a href="#local-6989586621681093717"><span class="hs-identifier hs-var hs-var">match_ctxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MC :: forall (body :: * -&gt; *).
HsMatchContext GhcRn
-&gt; (Located (body GhcRn)
    -&gt; ExpRhoType -&gt; TcM (Located (body GhcTc)))
-&gt; TcMatchCtxt body
</span><a href="GHC.Tc.Gen.Match.html#MC"><span class="hs-identifier hs-type">MC</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mc_what :: HsMatchContext GhcRn
</span><a href="GHC.Tc.Gen.Match.html#mc_what"><span class="hs-identifier hs-var">mc_what</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsMatchContext GhcRn
forall p. HsMatchContext p
</span><a href="GHC.Hs.Expr.html#CaseAlt"><span class="hs-identifier hs-var">CaseAlt</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-598"></span><span>                      </span><span class="annot"><span class="annottext">mc_body :: LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Match.html#mc_body"><span class="hs-identifier hs-var">mc_body</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Match.html#tcBody"><span class="hs-identifier hs-var">tcBody</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-599"></span><span>
</span><span id="line-600"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsIf"><span class="hs-identifier hs-type">HsIf</span></a></span><span> </span><span id="local-6989586621681093715"><span class="annot"><span class="annottext">XIf GhcRn
</span><a href="#local-6989586621681093715"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681093714"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093714"><span class="hs-identifier hs-var">pred</span></a></span></span><span> </span><span id="local-6989586621681093713"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093713"><span class="hs-identifier hs-var">b1</span></a></span></span><span> </span><span id="local-6989586621681093712"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093712"><span class="hs-identifier hs-var">b2</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681093711"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093711"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-601"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681093710"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681093710"><span class="hs-identifier hs-var">pred'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcLExpr"><span class="hs-identifier hs-var">tcLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093714"><span class="hs-identifier hs-var">pred</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; ExpRhoType
</span><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="GHC.Builtin.Types.html#boolTy"><span class="hs-identifier hs-var">boolTy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-602"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681093708"><span class="annot"><span class="annottext">UsageEnv
</span><a href="#local-6989586621681093708"><span class="hs-identifier hs-var">u1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681093707"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681093707"><span class="hs-identifier hs-var">b1'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM (LHsExpr GhcTc) -&gt; TcM (UsageEnv, LHsExpr GhcTc)
forall a. TcM a -&gt; TcM (UsageEnv, a)
</span><a href="GHC.Tc.Utils.Monad.html#tcCollectingUsage"><span class="hs-identifier hs-var">tcCollectingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (UsageEnv, LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (UsageEnv, LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcLExpr"><span class="hs-identifier hs-var">tcLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093713"><span class="hs-identifier hs-var">b1</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093711"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-603"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681093705"><span class="annot"><span class="annottext">UsageEnv
</span><a href="#local-6989586621681093705"><span class="hs-identifier hs-var">u2</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681093704"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681093704"><span class="hs-identifier hs-var">b2'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM (LHsExpr GhcTc) -&gt; TcM (UsageEnv, LHsExpr GhcTc)
forall a. TcM a -&gt; TcM (UsageEnv, a)
</span><a href="GHC.Tc.Utils.Monad.html#tcCollectingUsage"><span class="hs-identifier hs-var">tcCollectingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (UsageEnv, LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (UsageEnv, LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcLExpr"><span class="hs-identifier hs-var">tcLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093712"><span class="hs-identifier hs-var">b2</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093711"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-604"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">UsageEnv -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#tcEmitBindingUsage"><span class="hs-identifier hs-var">tcEmitBindingUsage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UsageEnv -&gt; UsageEnv -&gt; UsageEnv
</span><a href="GHC.Core.UsageEnv.html#supUE"><span class="hs-identifier hs-var">supUE</span></a></span><span> </span><span class="annot"><span class="annottext">UsageEnv
</span><a href="#local-6989586621681093708"><span class="hs-identifier hs-var">u1</span></a></span><span> </span><span class="annot"><span class="annottext">UsageEnv
</span><a href="#local-6989586621681093705"><span class="hs-identifier hs-var">u2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-605"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XIf GhcTc
-&gt; LHsExpr GhcTc -&gt; LHsExpr GhcTc -&gt; LHsExpr GhcTc -&gt; HsExpr GhcTc
forall p. XIf p -&gt; LHsExpr p -&gt; LHsExpr p -&gt; LHsExpr p -&gt; HsExpr p
</span><a href="GHC.Hs.Expr.html#HsIf"><span class="hs-identifier hs-var">HsIf</span></a></span><span> </span><span class="annot"><span class="annottext">XIf GhcRn
XIf GhcTc
</span><a href="#local-6989586621681093715"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681093710"><span class="hs-identifier hs-var">pred'</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681093707"><span class="hs-identifier hs-var">b1'</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681093704"><span class="hs-identifier hs-var">b2'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-606"></span><span>
</span><span id="line-607"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsMultiIf"><span class="hs-identifier hs-type">HsMultiIf</span></a></span><span> </span><span class="annot"><span class="annottext">XMultiIf GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681093700"><span class="annot"><span class="annottext">[LGRHS GhcRn (LHsExpr GhcRn)]
</span><a href="#local-6989586621681093700"><span class="hs-identifier hs-var">alts</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681093699"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093699"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-608"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681093698"><span class="annot"><span class="annottext">[Located (GRHS GhcTc (LHsExpr GhcTc))]
</span><a href="#local-6989586621681093698"><span class="hs-identifier hs-var">alts'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(LGRHS GhcRn (LHsExpr GhcRn)
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv) (Located (GRHS GhcTc (LHsExpr GhcTc))))
-&gt; [LGRHS GhcRn (LHsExpr GhcRn)]
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) [Located (GRHS GhcTc (LHsExpr GhcTc))]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(GRHS GhcRn (LHsExpr GhcRn) -&gt; TcM (GRHS GhcTc (LHsExpr GhcTc)))
-&gt; LGRHS GhcRn (LHsExpr GhcRn)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (Located (GRHS GhcTc (LHsExpr GhcTc)))
forall a b. (a -&gt; TcM b) -&gt; Located a -&gt; TcM (Located b)
</span><a href="GHC.Tc.Utils.Monad.html#wrapLocM"><span class="hs-identifier hs-var">wrapLocM</span></a></span><span> </span><span class="annot"><span class="annottext">((GRHS GhcRn (LHsExpr GhcRn) -&gt; TcM (GRHS GhcTc (LHsExpr GhcTc)))
 -&gt; LGRHS GhcRn (LHsExpr GhcRn)
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv) (Located (GRHS GhcTc (LHsExpr GhcTc))))
-&gt; (GRHS GhcRn (LHsExpr GhcRn) -&gt; TcM (GRHS GhcTc (LHsExpr GhcTc)))
-&gt; LGRHS GhcRn (LHsExpr GhcRn)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (Located (GRHS GhcTc (LHsExpr GhcTc)))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TcMatchCtxt HsExpr
-&gt; ExpRhoType
-&gt; GRHS GhcRn (LHsExpr GhcRn)
-&gt; TcM (GRHS GhcTc (LHsExpr GhcTc))
forall (body :: * -&gt; *).
TcMatchCtxt body
-&gt; ExpRhoType
-&gt; GRHS GhcRn (Located (body GhcRn))
-&gt; TcM (GRHS GhcTc (Located (body GhcTc)))
</span><a href="GHC.Tc.Gen.Match.html#tcGRHS"><span class="hs-identifier hs-var">tcGRHS</span></a></span><span> </span><span class="annot"><span class="annottext">TcMatchCtxt HsExpr
</span><a href="#local-6989586621681093695"><span class="hs-identifier hs-var">match_ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093699"><span class="hs-identifier hs-var">res_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LGRHS GhcRn (LHsExpr GhcRn)]
</span><a href="#local-6989586621681093700"><span class="hs-identifier hs-var">alts</span></a></span><span>
</span><span id="line-609"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681093694"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093694"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpRhoType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#readExpType"><span class="hs-identifier hs-var">readExpType</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093699"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-610"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XMultiIf GhcTc
-&gt; [Located (GRHS GhcTc (LHsExpr GhcTc))] -&gt; HsExpr GhcTc
forall p. XMultiIf p -&gt; [LGRHS p (LHsExpr p)] -&gt; HsExpr p
</span><a href="GHC.Hs.Expr.html#HsMultiIf"><span class="hs-identifier hs-var">HsMultiIf</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
XMultiIf GhcTc
</span><a href="#local-6989586621681093694"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">[Located (GRHS GhcTc (LHsExpr GhcTc))]
</span><a href="#local-6989586621681093698"><span class="hs-identifier hs-var">alts'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-611"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681093695"><span class="annot"><span class="annottext">match_ctxt :: TcMatchCtxt HsExpr
</span><a href="#local-6989586621681093695"><span class="hs-identifier hs-var hs-var">match_ctxt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MC :: forall (body :: * -&gt; *).
HsMatchContext GhcRn
-&gt; (Located (body GhcRn)
    -&gt; ExpRhoType -&gt; TcM (Located (body GhcTc)))
-&gt; TcMatchCtxt body
</span><a href="GHC.Tc.Gen.Match.html#MC"><span class="hs-identifier hs-type">MC</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">mc_what :: HsMatchContext GhcRn
</span><a href="GHC.Tc.Gen.Match.html#mc_what"><span class="hs-identifier hs-var">mc_what</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsMatchContext GhcRn
forall p. HsMatchContext p
</span><a href="GHC.Hs.Expr.html#IfAlt"><span class="hs-identifier hs-var">IfAlt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">mc_body :: LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Match.html#mc_body"><span class="hs-identifier hs-var">mc_body</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Match.html#tcBody"><span class="hs-identifier hs-var">tcBody</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-612"></span><span>
</span><span id="line-613"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsDo"><span class="hs-identifier hs-type">HsDo</span></a></span><span> </span><span class="annot"><span class="annottext">XDo GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681093690"><span class="annot"><span class="annottext">HsStmtContext GhcRn
</span><a href="#local-6989586621681093690"><span class="hs-identifier hs-var">do_or_lc</span></a></span></span><span> </span><span id="local-6989586621681093689"><span class="annot"><span class="annottext">Located [ExprLStmt GhcRn]
</span><a href="#local-6989586621681093689"><span class="hs-identifier hs-var">stmts</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681093688"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093688"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-614"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681093687"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681093687"><span class="hs-identifier hs-var">expr'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsStmtContext GhcRn
-&gt; Located [ExprLStmt GhcRn] -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Match.html#tcDoStmts"><span class="hs-identifier hs-var">tcDoStmts</span></a></span><span> </span><span class="annot"><span class="annottext">HsStmtContext GhcRn
</span><a href="#local-6989586621681093690"><span class="hs-identifier hs-var">do_or_lc</span></a></span><span> </span><span class="annot"><span class="annottext">Located [ExprLStmt GhcRn]
</span><a href="#local-6989586621681093689"><span class="hs-identifier hs-var">stmts</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093688"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-615"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681093687"><span class="hs-identifier hs-var">expr'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-616"></span><span>
</span><span id="line-617"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsProc"><span class="hs-identifier hs-type">HsProc</span></a></span><span> </span><span id="local-6989586621681093684"><span class="annot"><span class="annottext">XProc GhcRn
</span><a href="#local-6989586621681093684"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681093683"><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="#local-6989586621681093683"><span class="hs-identifier hs-var">pat</span></a></span></span><span> </span><span id="local-6989586621681093682"><span class="annot"><span class="annottext">LHsCmdTop GhcRn
</span><a href="#local-6989586621681093682"><span class="hs-identifier hs-var">cmd</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681093681"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093681"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-618"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681093680"><span class="annot"><span class="annottext">Located (Pat GhcTc)
</span><a href="#local-6989586621681093680"><span class="hs-identifier hs-var">pat'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093679"><span class="annot"><span class="annottext">LHsCmdTop GhcTc
</span><a href="#local-6989586621681093679"><span class="hs-identifier hs-var">cmd'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093678"><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621681093678"><span class="hs-identifier hs-var">coi</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LPat GhcRn
-&gt; LHsCmdTop GhcRn
-&gt; ExpRhoType
-&gt; TcM (LPat GhcTc, LHsCmdTop GhcTc, TcCoercionR)
</span><a href="GHC.Tc.Gen.Arrow.html#tcProc"><span class="hs-identifier hs-var">tcProc</span></a></span><span> </span><span class="annot"><span class="annottext">LPat GhcRn
</span><a href="#local-6989586621681093683"><span class="hs-identifier hs-var">pat</span></a></span><span> </span><span class="annot"><span class="annottext">LHsCmdTop GhcRn
</span><a href="#local-6989586621681093682"><span class="hs-identifier hs-var">cmd</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093681"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-619"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc -&gt; TcM (HsExpr GhcTc))
-&gt; HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionR -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrapCo"><span class="hs-identifier hs-var">mkHsWrapCo</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621681093678"><span class="hs-identifier hs-var">coi</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XProc GhcTc -&gt; LPat GhcTc -&gt; LHsCmdTop GhcTc -&gt; HsExpr GhcTc
forall p. XProc p -&gt; LPat p -&gt; LHsCmdTop p -&gt; HsExpr p
</span><a href="GHC.Hs.Expr.html#HsProc"><span class="hs-identifier hs-var">HsProc</span></a></span><span> </span><span class="annot"><span class="annottext">XProc GhcRn
XProc GhcTc
</span><a href="#local-6989586621681093684"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">Located (Pat GhcTc)
LPat GhcTc
</span><a href="#local-6989586621681093680"><span class="hs-identifier hs-var">pat'</span></a></span><span> </span><span class="annot"><span class="annottext">LHsCmdTop GhcTc
</span><a href="#local-6989586621681093679"><span class="hs-identifier hs-var">cmd'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-620"></span><span>
</span><span id="line-621"></span><span class="hs-comment">-- Typechecks the static form and wraps it with a call to 'fromStaticPtr'.</span><span>
</span><span id="line-622"></span><span class="hs-comment">-- See Note [Grand plan for static forms] in GHC.Iface.Tidy.StaticPtrTable for an overview.</span><span>
</span><span id="line-623"></span><span class="hs-comment">-- To type check</span><span>
</span><span id="line-624"></span><span class="hs-comment">--      (static e) :: p a</span><span>
</span><span id="line-625"></span><span class="hs-comment">-- we want to check (e :: a),</span><span>
</span><span id="line-626"></span><span class="hs-comment">-- and wrap (static e) in a call to</span><span>
</span><span id="line-627"></span><span class="hs-comment">--    fromStaticPtr :: IsStatic p =&gt; StaticPtr a -&gt; p a</span><span>
</span><span id="line-628"></span><span>
</span><span id="line-629"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsStatic"><span class="hs-identifier hs-type">HsStatic</span></a></span><span> </span><span id="local-6989586621681093675"><span class="annot"><span class="annottext">XStatic GhcRn
</span><a href="#local-6989586621681093675"><span class="hs-identifier hs-var">fvs</span></a></span></span><span> </span><span id="local-6989586621681093674"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093674"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681093673"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093673"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-630"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681093672"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093672"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>          </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpRhoType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#expTypeToType"><span class="hs-identifier hs-var">expTypeToType</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093673"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-631"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681093671"><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621681093671"><span class="hs-identifier hs-var">co</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681093670"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093670"><span class="hs-identifier hs-var">p_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093669"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093669"><span class="hs-identifier hs-var">expr_ty</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcM (TcCoercionR, (TcType, TcType))
</span><a href="GHC.Tc.Utils.Unify.html#matchExpectedAppTy"><span class="hs-identifier hs-var">matchExpectedAppTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093672"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-632"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681093667"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681093667"><span class="hs-identifier hs-var">expr'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093666"><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621681093666"><span class="hs-identifier hs-var">lie</span></a></span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc, WantedConstraints)
forall a. TcM a -&gt; TcM (a, WantedConstraints)
</span><a href="GHC.Tc.Utils.Monad.html#captureConstraints"><span class="hs-identifier hs-var">captureConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc, WantedConstraints))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc, WantedConstraints)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-633"></span><span>            </span><span class="annot"><span class="annottext">SDoc -&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a. SDoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; ThLevel -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;In the body of a static form:&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-634"></span><span>                             </span><span class="annot"><span class="annottext">ThLevel
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093674"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-635"></span><span>                       </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-636"></span><span>            </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; TcType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExprNC"><span class="hs-identifier hs-var">tcCheckPolyExprNC</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093674"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093669"><span class="hs-identifier hs-var">expr_ty</span></a></span><span>
</span><span id="line-637"></span><span>
</span><span id="line-638"></span><span>        </span><span class="hs-comment">-- Check that the free variables of the static form are closed.</span><span>
</span><span id="line-639"></span><span>        </span><span class="hs-comment">-- It's OK to use nonDetEltsUniqSet here as the only side effects of</span><span>
</span><span id="line-640"></span><span>        </span><span class="hs-comment">-- checkClosedInStaticForm are error messages.</span><span>
</span><span id="line-641"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; TcRn ()) -&gt; [Name] -&gt; TcRn ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><a href="../../base/src/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcRn ()
</span><a href="GHC.Tc.Gen.Expr.html#checkClosedInStaticForm"><span class="hs-identifier hs-var">checkClosedInStaticForm</span></a></span><span> </span><span class="annot"><span class="annottext">([Name] -&gt; TcRn ()) -&gt; [Name] -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSet Name -&gt; [Name]
forall elt. UniqSet elt -&gt; [elt]
</span><a href="GHC.Types.Unique.Set.html#nonDetEltsUniqSet"><span class="hs-identifier hs-var">nonDetEltsUniqSet</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSet Name
XStatic GhcRn
</span><a href="#local-6989586621681093675"><span class="hs-identifier hs-var">fvs</span></a></span><span>
</span><span id="line-642"></span><span>
</span><span id="line-643"></span><span>        </span><span class="hs-comment">-- Require the type of the argument to be Typeable.</span><span>
</span><span id="line-644"></span><span>        </span><span class="hs-comment">-- The evidence is not used, but asking the constraint ensures that</span><span>
</span><span id="line-645"></span><span>        </span><span class="hs-comment">-- the current implementation is as restrictive as future versions</span><span>
</span><span id="line-646"></span><span>        </span><span class="hs-comment">-- of the StaticPointers extension.</span><span>
</span><span id="line-647"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681093661"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681093661"><span class="hs-identifier hs-var">typeableClass</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Class
</span><a href="GHC.Tc.Utils.Env.html#tcLookupClass"><span class="hs-identifier hs-var">tcLookupClass</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#typeableClassName"><span class="hs-identifier hs-var">typeableClassName</span></a></span><span>
</span><span id="line-648"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; TcType -&gt; TcM Var
</span><a href="GHC.Tc.Utils.TcMType.html#emitWantedEvVar"><span class="hs-identifier hs-var">emitWantedEvVar</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#StaticOrigin"><span class="hs-identifier hs-var">StaticOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">(TcType -&gt; TcM Var) -&gt; TcType -&gt; TcM Var
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-649"></span><span>                  </span><span class="annot"><span class="annottext">TyCon -&gt; [TcType] -&gt; TcType
</span><a href="GHC.Core.TyCo.Rep.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; TyCon
</span><a href="GHC.Core.Class.html#classTyCon"><span class="hs-identifier hs-var hs-var">classTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681093661"><span class="hs-identifier hs-var">typeableClass</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-650"></span><span>                             </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TcType
</span><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093669"><span class="hs-identifier hs-var">expr_ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-651"></span><span>
</span><span id="line-652"></span><span>        </span><span class="hs-comment">-- Insert the constraints of the static form in a global list for later</span><span>
</span><span id="line-653"></span><span>        </span><span class="hs-comment">-- validation.</span><span>
</span><span id="line-654"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">WantedConstraints -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#emitStaticConstraints"><span class="hs-identifier hs-var">emitStaticConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621681093666"><span class="hs-identifier hs-var">lie</span></a></span><span>
</span><span id="line-655"></span><span>
</span><span id="line-656"></span><span>        </span><span class="hs-comment">-- Wrap the static form with the 'fromStaticPtr' call.</span><span>
</span><span id="line-657"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681093656"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681093656"><span class="hs-identifier hs-var">fromStaticPtr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; Name -&gt; [TcType] -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Utils.Instantiate.html#newMethodFromName"><span class="hs-identifier hs-var">newMethodFromName</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#StaticOrigin"><span class="hs-identifier hs-var">StaticOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#fromStaticPtrName"><span class="hs-identifier hs-var">fromStaticPtrName</span></a></span><span>
</span><span id="line-658"></span><span>                                             </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093670"><span class="hs-identifier hs-var">p_ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-659"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681093653"><span class="annot"><span class="annottext">wrap :: HsWrapper
</span><a href="#local-6989586621681093653"><span class="hs-identifier hs-var hs-var">wrap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TcType] -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#mkWpTyApps"><span class="hs-identifier hs-var">mkWpTyApps</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093669"><span class="hs-identifier hs-var">expr_ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-660"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681093652"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681093652"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn SrcSpan
</span><a href="GHC.Tc.Utils.Monad.html#getSrcSpanM"><span class="hs-identifier hs-var">getSrcSpanM</span></a></span><span>
</span><span id="line-661"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc -&gt; TcM (HsExpr GhcTc))
-&gt; HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionR -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrapCo"><span class="hs-identifier hs-var">mkHsWrapCo</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621681093671"><span class="hs-identifier hs-var">co</span></a></span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc -&gt; HsExpr GhcTc) -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">XApp GhcTc -&gt; LHsExpr GhcTc -&gt; LHsExpr GhcTc -&gt; HsExpr GhcTc
forall p. XApp p -&gt; LHsExpr p -&gt; LHsExpr p -&gt; HsExpr p
</span><a href="GHC.Hs.Expr.html#HsApp"><span class="hs-identifier hs-var">HsApp</span></a></span><span> </span><span class="annot"><span class="annottext">NoExtField
XApp GhcTc
</span><a href="GHC.Hs.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span>
</span><span id="line-662"></span><span>                                         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; HsExpr GhcTc -&gt; LHsExpr GhcTc
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681093652"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc -&gt; LHsExpr GhcTc) -&gt; HsExpr GhcTc -&gt; LHsExpr GhcTc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrap"><span class="hs-identifier hs-var">mkHsWrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681093653"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681093656"><span class="hs-identifier hs-var">fromStaticPtr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-663"></span><span>                                         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; HsExpr GhcTc -&gt; LHsExpr GhcTc
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681093652"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XStatic GhcTc -&gt; LHsExpr GhcTc -&gt; HsExpr GhcTc
forall p. XStatic p -&gt; LHsExpr p -&gt; HsExpr p
</span><a href="GHC.Hs.Expr.html#HsStatic"><span class="hs-identifier hs-var">HsStatic</span></a></span><span> </span><span class="annot"><span class="annottext">XStatic GhcRn
XStatic GhcTc
</span><a href="#local-6989586621681093675"><span class="hs-identifier hs-var">fvs</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681093667"><span class="hs-identifier hs-var">expr'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-664"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-665"></span><span>
</span><span id="line-666"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Record construction and update
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-673"></span><span>
</span><span id="line-674"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span id="local-6989586621681093651"><span class="annot"><span class="annottext">expr :: HsExpr GhcRn
</span><a href="#local-6989586621681093651"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#RecordCon"><span class="hs-identifier hs-type">RecordCon</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">rcon_con_name :: forall p. HsExpr p -&gt; Located (IdP p)
</span><a href="GHC.Hs.Expr.html#rcon_con_name"><span class="hs-identifier hs-var">rcon_con_name</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681093648"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681093648"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681093647"><span class="annot"><span class="annottext">IdP GhcRn
</span><a href="#local-6989586621681093647"><span class="hs-identifier hs-var">con_name</span></a></span></span><span>
</span><span id="line-675"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">rcon_flds :: forall p. HsExpr p -&gt; HsRecordBinds p
</span><a href="GHC.Hs.Expr.html#rcon_flds"><span class="hs-identifier hs-var">rcon_flds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681093645"><span class="annot"><span class="annottext">HsRecordBinds GhcRn
</span><a href="#local-6989586621681093645"><span class="hs-identifier hs-var">rbinds</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621681093644"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093644"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-676"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681093643"><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681093643"><span class="hs-identifier hs-var">con_like</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM ConLike
</span><a href="GHC.Tc.Utils.Env.html#tcLookupConLike"><span class="hs-identifier hs-var">tcLookupConLike</span></a></span><span> </span><span class="annot"><span class="annottext">Name
IdP GhcRn
</span><a href="#local-6989586621681093647"><span class="hs-identifier hs-var">con_name</span></a></span><span>
</span><span id="line-677"></span><span>
</span><span id="line-678"></span><span>        </span><span class="hs-comment">-- Check for missing fields</span><span>
</span><span id="line-679"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">ConLike -&gt; HsRecordBinds GhcRn -&gt; TcRn ()
</span><a href="GHC.Tc.Gen.Expr.html#checkMissingFields"><span class="hs-identifier hs-var">checkMissingFields</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681093643"><span class="hs-identifier hs-var">con_like</span></a></span><span> </span><span class="annot"><span class="annottext">HsRecordBinds GhcRn
</span><a href="#local-6989586621681093645"><span class="hs-identifier hs-var">rbinds</span></a></span><span>
</span><span id="line-680"></span><span>
</span><span id="line-681"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681093640"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681093640"><span class="hs-identifier hs-var">con_expr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093639"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093639"><span class="hs-identifier hs-var">con_sigma</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM (HsExpr GhcTc, TcType)
</span><a href="GHC.Tc.Gen.Expr.html#tcInferId"><span class="hs-identifier hs-var">tcInferId</span></a></span><span> </span><span class="annot"><span class="annottext">Name
IdP GhcRn
</span><a href="#local-6989586621681093647"><span class="hs-identifier hs-var">con_name</span></a></span><span>
</span><span id="line-682"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681093637"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681093637"><span class="hs-identifier hs-var">con_wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093636"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093636"><span class="hs-identifier hs-var">con_tau</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; TcType -&gt; TcM (HsWrapper, TcType)
</span><a href="GHC.Tc.Utils.Instantiate.html#topInstantiate"><span class="hs-identifier hs-var">topInstantiate</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621681093634"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093639"><span class="hs-identifier hs-var">con_sigma</span></a></span><span>
</span><span id="line-683"></span><span>              </span><span class="hs-comment">-- a shallow instantiation should really be enough for</span><span>
</span><span id="line-684"></span><span>              </span><span class="hs-comment">-- a data constructor.</span><span>
</span><span id="line-685"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681093633"><span class="annot"><span class="annottext">arity :: ThLevel
</span><a href="#local-6989586621681093633"><span class="hs-identifier hs-var hs-var">arity</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConLike -&gt; ThLevel
</span><a href="GHC.Core.ConLike.html#conLikeArity"><span class="hs-identifier hs-var">conLikeArity</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681093643"><span class="hs-identifier hs-var">con_like</span></a></span><span>
</span><span id="line-686"></span><span>              </span><span class="annot"><a href="../../base/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681093631"><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681093631"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093630"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093630"><span class="hs-identifier hs-var">actual_res_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ThLevel -&gt; TcType -&gt; Either ThLevel ([Scaled TcType], TcType)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitFunTysN"><span class="hs-identifier hs-var">tcSplitFunTysN</span></a></span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621681093633"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093636"><span class="hs-identifier hs-var">con_tau</span></a></span><span>
</span><span id="line-687"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ConLike -&gt; Maybe Var
</span><a href="GHC.Core.ConLike.html#conLikeWrapId_maybe"><span class="hs-identifier hs-var">conLikeWrapId_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681093643"><span class="hs-identifier hs-var">con_like</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-688"></span><span>               </span><span class="annot"><span class="annottext">Maybe Var
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM (HsExpr GhcTc)
forall name a. Outputable name =&gt; name -&gt; TcM a
</span><a href="GHC.Tc.TyCl.PatSyn.html#nonBidirectionalErr"><span class="hs-identifier hs-var">nonBidirectionalErr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConLike -&gt; Name
</span><a href="GHC.Core.ConLike.html#conLikeName"><span class="hs-identifier hs-var">conLikeName</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681093643"><span class="hs-identifier hs-var">con_like</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-689"></span><span>               </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681093626"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681093626"><span class="hs-identifier hs-var">con_id</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-690"></span><span>
</span><span id="line-691"></span><span>     </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681093625"><span class="annot"><span class="annottext">HsRecordBinds GhcTc
</span><a href="#local-6989586621681093625"><span class="hs-identifier hs-var">rbinds'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ConLike
-&gt; [TcType] -&gt; HsRecordBinds GhcRn -&gt; TcM (HsRecordBinds GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcRecordBinds"><span class="hs-identifier hs-var">tcRecordBinds</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681093643"><span class="hs-identifier hs-var">con_like</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Scaled TcType -&gt; TcType) -&gt; [Scaled TcType] -&gt; [TcType]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled TcType -&gt; TcType
forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681093631"><span class="hs-identifier hs-var">arg_tys</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HsRecordBinds GhcRn
</span><a href="#local-6989586621681093645"><span class="hs-identifier hs-var">rbinds</span></a></span><span>
</span><span id="line-692"></span><span>                   </span><span class="hs-comment">-- It is currently not possible for a record to have</span><span>
</span><span id="line-693"></span><span>                   </span><span class="hs-comment">-- multiplicities. When they do, `tcRecordBinds` will take</span><span>
</span><span id="line-694"></span><span>                   </span><span class="hs-comment">-- scaled types instead. Meanwhile, it's safe to take</span><span>
</span><span id="line-695"></span><span>                   </span><span class="hs-comment">-- `scaledThing` above, as we know all the multiplicities are</span><span>
</span><span id="line-696"></span><span>                   </span><span class="hs-comment">-- Many.</span><span>
</span><span id="line-697"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681093623"><span class="annot"><span class="annottext">rcon_tc :: RecordConTc
</span><a href="#local-6989586621681093623"><span class="hs-identifier hs-var hs-var">rcon_tc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RecordConTc :: ConLike -&gt; HsExpr GhcTc -&gt; RecordConTc
</span><a href="GHC.Hs.Expr.html#RecordConTc"><span class="hs-identifier hs-type">RecordConTc</span></a></span><span>
</span><span id="line-698"></span><span>                           </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">rcon_con_like :: ConLike
</span><a href="GHC.Hs.Expr.html#rcon_con_like"><span class="hs-identifier hs-var">rcon_con_like</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681093643"><span class="hs-identifier hs-var">con_like</span></a></span><span>
</span><span id="line-699"></span><span>                           </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">rcon_con_expr :: HsExpr GhcTc
</span><a href="GHC.Hs.Expr.html#rcon_con_expr"><span class="hs-identifier hs-var">rcon_con_expr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrap"><span class="hs-identifier hs-var">mkHsWrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681093637"><span class="hs-identifier hs-var">con_wrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681093640"><span class="hs-identifier hs-var">con_expr</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-700"></span><span>              </span><span id="local-6989586621681093619"><span class="annot"><span class="annottext">expr' :: HsExpr GhcTc
</span><a href="#local-6989586621681093619"><span class="hs-identifier hs-var hs-var">expr'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RecordCon :: forall p.
XRecordCon p -&gt; Located (IdP p) -&gt; HsRecordBinds p -&gt; HsExpr p
</span><a href="GHC.Hs.Expr.html#RecordCon"><span class="hs-identifier hs-type">RecordCon</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">rcon_ext :: XRecordCon GhcTc
</span><a href="GHC.Hs.Expr.html#rcon_ext"><span class="hs-identifier hs-var">rcon_ext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XRecordCon GhcTc
RecordConTc
</span><a href="#local-6989586621681093623"><span class="hs-identifier hs-var">rcon_tc</span></a></span><span>
</span><span id="line-701"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">rcon_con_name :: Located (IdP GhcTc)
</span><a href="GHC.Hs.Expr.html#rcon_con_name"><span class="hs-identifier hs-var">rcon_con_name</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; Var -&gt; Located Var
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681093648"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681093626"><span class="hs-identifier hs-var">con_id</span></a></span><span>
</span><span id="line-702"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">rcon_flds :: HsRecordBinds GhcTc
</span><a href="GHC.Hs.Expr.html#rcon_flds"><span class="hs-identifier hs-var">rcon_flds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsRecordBinds GhcTc
</span><a href="#local-6989586621681093625"><span class="hs-identifier hs-var">rbinds'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-703"></span><span>
</span><span id="line-704"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
-&gt; HsExpr GhcTc -&gt; TcType -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Utils.Unify.html#tcWrapResultMono"><span class="hs-identifier hs-var">tcWrapResultMono</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681093651"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681093619"><span class="hs-identifier hs-var">expr'</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093630"><span class="hs-identifier hs-var">actual_res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093644"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-705"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-706"></span><span>    </span><span id="local-6989586621681093634"><span class="annot"><span class="annottext">orig :: CtOrigin
</span><a href="#local-6989586621681093634"><span class="hs-identifier hs-var hs-var">orig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#OccurrenceOf"><span class="hs-identifier hs-var">OccurrenceOf</span></a></span><span> </span><span class="annot"><span class="annottext">Name
IdP GhcRn
</span><a href="#local-6989586621681093647"><span class="hs-identifier hs-var">con_name</span></a></span><span>
</span><span id="line-707"></span><span>
</span><span id="line-708"></span><span class="hs-comment">{-
Note [Type of a record update]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The main complication with RecordUpd is that we need to explicitly
handle the *non-updated* fields.  Consider:

        data T a b c = MkT1 { fa :: a, fb :: (b,c) }
                     | MkT2 { fa :: a, fb :: (b,c), fc :: c -&gt; c }
                     | MkT3 { fd :: a }

        upd :: T a b c -&gt; (b',c) -&gt; T a b' c
        upd t x = t { fb = x}

The result type should be (T a b' c)
not (T a b c),   because 'b' *is not* mentioned in a non-updated field
not (T a b' c'), because 'c' *is*     mentioned in a non-updated field
NB that it's not good enough to look at just one constructor; we must
look at them all; cf #3219

After all, upd should be equivalent to:
        upd t x = case t of
                        MkT1 p q -&gt; MkT1 p x
                        MkT2 a b -&gt; MkT2 p b
                        MkT3 d   -&gt; error ...

So we need to give a completely fresh type to the result record,
and then constrain it by the fields that are *not* updated (&quot;p&quot; above).
We call these the &quot;fixed&quot; type variables, and compute them in getFixedTyVars.

Note that because MkT3 doesn't contain all the fields being updated,
its RHS is simply an error, so it doesn't impose any type constraints.
Hence the use of 'relevant_cont'.

Note [Implicit type sharing]
~~~~~~~~~~~~~~~~~~~~~~~~~~~
We also take into account any &quot;implicit&quot; non-update fields.  For example
        data T a b where { MkT { f::a } :: T a a; ... }
So the &quot;real&quot; type of MkT is: forall ab. (a~b) =&gt; a -&gt; T a b

Then consider
        upd t x = t { f=x }
We infer the type
        upd :: T a b -&gt; a -&gt; T a b
        upd (t::T a b) (x::a)
           = case t of { MkT (co:a~b) (_:a) -&gt; MkT co x }
We can't give it the more general type
        upd :: T a b -&gt; c -&gt; T c b

Note [Criteria for update]
~~~~~~~~~~~~~~~~~~~~~~~~~~
We want to allow update for existentials etc, provided the updated
field isn't part of the existential. For example, this should be ok.
  data T a where { MkT { f1::a, f2::b-&gt;b } :: T a }
  f :: T a -&gt; b -&gt; T b
  f t b = t { f1=b }

The criterion we use is this:

  The types of the updated fields
  mention only the universally-quantified type variables
  of the data constructor

NB: this is not (quite) the same as being a &quot;naughty&quot; record selector
(See Note [Naughty record selectors]) in GHC.Tc.TyCl), at least
in the case of GADTs. Consider
   data T a where { MkT :: { f :: a } :: T [a] }
Then f is not &quot;naughty&quot; because it has a well-typed record selector.
But we don't allow updates for 'f'.  (One could consider trying to
allow this, but it makes my head hurt.  Badly.  And no one has asked
for it.)

In principle one could go further, and allow
  g :: T a -&gt; T a
  g t = t { f2 = \x -&gt; x }
because the expression is polymorphic...but that seems a bridge too far.

Note [Data family example]
~~~~~~~~~~~~~~~~~~~~~~~~~~
    data instance T (a,b) = MkT { x::a, y::b }
  ---&gt;
    data :TP a b = MkT { a::a, y::b }
    coTP a b :: T (a,b) ~ :TP a b

Suppose r :: T (t1,t2), e :: t3
Then  r { x=e } :: T (t3,t1)
  ---&gt;
      case r |&gt; co1 of
        MkT x y -&gt; MkT e y |&gt; co2
      where co1 :: T (t1,t2) ~ :TP t1 t2
            co2 :: :TP t3 t2 ~ T (t3,t2)
The wrapping with co2 is done by the constructor wrapper for MkT

Outgoing invariants
~~~~~~~~~~~~~~~~~~~
In the outgoing (HsRecordUpd scrut binds cons in_inst_tys out_inst_tys):

  * cons are the data constructors to be updated

  * in_inst_tys, out_inst_tys have same length, and instantiate the
        *representation* tycon of the data cons.  In Note [Data
        family example], in_inst_tys = [t1,t2], out_inst_tys = [t3,t2]

Note [Mixed Record Field Updates]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider the following pattern synonym.

  data MyRec = MyRec { foo :: Int, qux :: String }

  pattern HisRec{f1, f2} = MyRec{foo = f1, qux=f2}

This allows updates such as the following

  updater :: MyRec -&gt; MyRec
  updater a = a {f1 = 1 }

It would also make sense to allow the following update (which we reject).

  updater a = a {f1 = 1, qux = &quot;two&quot; } ==? MyRec 1 &quot;two&quot;

This leads to confusing behaviour when the selectors in fact refer the same
field.

  updater a = a {f1 = 1, foo = 2} ==? ???

For this reason, we reject a mixture of pattern synonym and normal record
selectors in the same update block. Although of course we still allow the
following.

  updater a = (a {f1 = 1}) {foo = 2}

  &gt; updater (MyRec 0 &quot;str&quot;)
  MyRec 2 &quot;str&quot;

-}</span><span>
</span><span id="line-842"></span><span>
</span><span id="line-843"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span id="local-6989586621681093616"><span class="annot"><span class="annottext">expr :: HsExpr GhcRn
</span><a href="#local-6989586621681093616"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#RecordUpd"><span class="hs-identifier hs-type">RecordUpd</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">rupd_expr :: forall p. HsExpr p -&gt; LHsExpr p
</span><a href="GHC.Hs.Expr.html#rupd_expr"><span class="hs-identifier hs-var">rupd_expr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681093613"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093613"><span class="hs-identifier hs-var">record_expr</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">rupd_flds :: forall p. HsExpr p -&gt; [LHsRecUpdField p]
</span><a href="GHC.Hs.Expr.html#rupd_flds"><span class="hs-identifier hs-var">rupd_flds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681093611"><span class="annot"><span class="annottext">[LHsRecUpdField GhcRn]
</span><a href="#local-6989586621681093611"><span class="hs-identifier hs-var">rbnds</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621681093610"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093610"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-844"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">notNull</span><span> </span><span class="hs-identifier">rbnds</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-845"></span><span>    </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- STEP -2: typecheck the record_expr, the record to be updated</span><span>
</span><span id="line-846"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621681093606"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681093606"><span class="hs-identifier hs-var">record_expr'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093605"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093605"><span class="hs-identifier hs-var">record_rho</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType
-&gt; TcM (LHsExpr GhcTc, TcType) -&gt; TcM (LHsExpr GhcTc, TcType)
forall a. TcType -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-var">tcScalingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="GHC.Core.Type.html#Many"><span class="hs-identifier hs-var">Many</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc, TcType) -&gt; TcM (LHsExpr GhcTc, TcType))
-&gt; TcM (LHsExpr GhcTc, TcType) -&gt; TcM (LHsExpr GhcTc, TcType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; TcM (LHsExpr GhcTc, TcType)
</span><a href="GHC.Tc.Gen.Expr.html#tcInferRho"><span class="hs-identifier hs-var">tcInferRho</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093613"><span class="hs-identifier hs-var">record_expr</span></a></span><span>
</span><span id="line-847"></span><span>            </span><span class="hs-comment">-- Record update drops some of the content of the record (namely the</span><span>
</span><span id="line-848"></span><span>            </span><span class="hs-comment">-- content of the field being updated). As a consequence, unless the</span><span>
</span><span id="line-849"></span><span>            </span><span class="hs-comment">-- field being updated is unrestricted in the record, or we need an</span><span>
</span><span id="line-850"></span><span>            </span><span class="hs-comment">-- unrestricted record. Currently, we simply always require an</span><span>
</span><span id="line-851"></span><span>            </span><span class="hs-comment">-- unrestricted record.</span><span>
</span><span id="line-852"></span><span>            </span><span class="hs-comment">--</span><span>
</span><span id="line-853"></span><span>            </span><span class="hs-comment">-- Consider the following example:</span><span>
</span><span id="line-854"></span><span>            </span><span class="hs-comment">--</span><span>
</span><span id="line-855"></span><span>            </span><span class="hs-comment">-- data R a = R { self :: a }</span><span>
</span><span id="line-856"></span><span>            </span><span class="hs-comment">-- bad :: a &#8888; ()</span><span>
</span><span id="line-857"></span><span>            </span><span class="hs-comment">-- bad x = let r = R x in case r { self = () } of { R x' -&gt; x' }</span><span>
</span><span id="line-858"></span><span>            </span><span class="hs-comment">--</span><span>
</span><span id="line-859"></span><span>            </span><span class="hs-comment">-- This should definitely *not* typecheck.</span><span>
</span><span id="line-860"></span><span>
</span><span id="line-861"></span><span>        </span><span class="hs-comment">-- STEP -1  See Note [Disambiguating record fields]</span><span>
</span><span id="line-862"></span><span>        </span><span class="hs-comment">-- After this we know that rbinds is unambiguous</span><span>
</span><span id="line-863"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681093604"><span class="annot"><span class="annottext">[LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)]
</span><a href="#local-6989586621681093604"><span class="hs-identifier hs-var">rbinds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
-&gt; TcType
-&gt; [LHsRecUpdField GhcRn]
-&gt; ExpRhoType
-&gt; TcM [LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)]
</span><a href="GHC.Tc.Gen.Expr.html#disambiguateRecordBinds"><span class="hs-identifier hs-var">disambiguateRecordBinds</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093613"><span class="hs-identifier hs-var">record_expr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093605"><span class="hs-identifier hs-var">record_rho</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsRecUpdField GhcRn]
</span><a href="#local-6989586621681093611"><span class="hs-identifier hs-var">rbnds</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093610"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-864"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681093602"><span class="annot"><span class="annottext">upd_flds :: [AmbiguousFieldOcc GhcTc]
</span><a href="#local-6989586621681093602"><span class="hs-identifier hs-var hs-var">upd_flds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)
 -&gt; AmbiguousFieldOcc GhcTc)
-&gt; [LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)]
-&gt; [AmbiguousFieldOcc GhcTc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpan (AmbiguousFieldOcc GhcTc)
-&gt; AmbiguousFieldOcc GhcTc
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpan (AmbiguousFieldOcc GhcTc)
 -&gt; AmbiguousFieldOcc GhcTc)
-&gt; (LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)
    -&gt; GenLocated SrcSpan (AmbiguousFieldOcc GhcTc))
-&gt; LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)
-&gt; AmbiguousFieldOcc GhcTc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">HsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)
-&gt; GenLocated SrcSpan (AmbiguousFieldOcc GhcTc)
forall id arg. HsRecField' id arg -&gt; Located id
</span><a href="GHC.Hs.Pat.html#hsRecFieldLbl"><span class="hs-identifier hs-var hs-var">hsRecFieldLbl</span></a></span><span> </span><span class="annot"><span class="annottext">(HsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)
 -&gt; GenLocated SrcSpan (AmbiguousFieldOcc GhcTc))
-&gt; (LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)
    -&gt; HsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn))
-&gt; LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)
-&gt; GenLocated SrcSpan (AmbiguousFieldOcc GhcTc)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)
-&gt; HsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)]
</span><a href="#local-6989586621681093604"><span class="hs-identifier hs-var">rbinds</span></a></span><span>
</span><span id="line-865"></span><span>              </span><span id="local-6989586621681093600"><span class="annot"><span class="annottext">upd_fld_occs :: [FieldLabelString]
</span><a href="#local-6989586621681093600"><span class="hs-identifier hs-var hs-var">upd_fld_occs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(AmbiguousFieldOcc GhcTc -&gt; FieldLabelString)
-&gt; [AmbiguousFieldOcc GhcTc] -&gt; [FieldLabelString]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OccName -&gt; FieldLabelString
</span><a href="GHC.Types.Name.Occurrence.html#occNameFS"><span class="hs-identifier hs-var hs-var">occNameFS</span></a></span><span> </span><span class="annot"><span class="annottext">(OccName -&gt; FieldLabelString)
-&gt; (AmbiguousFieldOcc GhcTc -&gt; OccName)
-&gt; AmbiguousFieldOcc GhcTc
-&gt; FieldLabelString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; OccName
</span><a href="GHC.Types.Name.Reader.html#rdrNameOcc"><span class="hs-identifier hs-var">rdrNameOcc</span></a></span><span> </span><span class="annot"><span class="annottext">(RdrName -&gt; OccName)
-&gt; (AmbiguousFieldOcc GhcTc -&gt; RdrName)
-&gt; AmbiguousFieldOcc GhcTc
-&gt; OccName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">AmbiguousFieldOcc GhcTc -&gt; RdrName
forall (p :: Pass). AmbiguousFieldOcc (GhcPass p) -&gt; RdrName
</span><a href="GHC.Hs.Type.html#rdrNameAmbiguousFieldOcc"><span class="hs-identifier hs-var">rdrNameAmbiguousFieldOcc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[AmbiguousFieldOcc GhcTc]
</span><a href="#local-6989586621681093602"><span class="hs-identifier hs-var">upd_flds</span></a></span><span>
</span><span id="line-866"></span><span>              </span><span id="local-6989586621681093596"><span class="annot"><span class="annottext">sel_ids :: [Var]
</span><a href="#local-6989586621681093596"><span class="hs-identifier hs-var hs-var">sel_ids</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(AmbiguousFieldOcc GhcTc -&gt; Var)
-&gt; [AmbiguousFieldOcc GhcTc] -&gt; [Var]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">AmbiguousFieldOcc GhcTc -&gt; Var
</span><a href="GHC.Hs.Type.html#selectorAmbiguousFieldOcc"><span class="hs-identifier hs-var">selectorAmbiguousFieldOcc</span></a></span><span> </span><span class="annot"><span class="annottext">[AmbiguousFieldOcc GhcTc]
</span><a href="#local-6989586621681093602"><span class="hs-identifier hs-var">upd_flds</span></a></span><span>
</span><span id="line-867"></span><span>        </span><span class="hs-comment">-- STEP 0</span><span>
</span><span id="line-868"></span><span>        </span><span class="hs-comment">-- Check that the field names are really field names</span><span>
</span><span id="line-869"></span><span>        </span><span class="hs-comment">-- and they are all field names for proper records or</span><span>
</span><span id="line-870"></span><span>        </span><span class="hs-comment">-- all field names for pattern synonyms.</span><span>
</span><span id="line-871"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681093594"><span class="annot"><span class="annottext">bad_guys :: [TcRn ()]
</span><a href="#local-6989586621681093594"><span class="hs-identifier hs-var hs-var">bad_guys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcRn () -&gt; TcRn ()
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681093593"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcRn ()) -&gt; TcRn () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrTc"><span class="hs-identifier hs-var">addErrTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SDoc
</span><a href="GHC.Tc.Gen.Expr.html#notSelector"><span class="hs-identifier hs-var">notSelector</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681093590"><span class="hs-identifier hs-var">fld_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-872"></span><span>                         </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681093589"><span class="annot"><span class="annottext">LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)
</span><a href="#local-6989586621681093589"><span class="hs-identifier hs-var">fld</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)]
</span><a href="#local-6989586621681093604"><span class="hs-identifier hs-var">rbinds</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-873"></span><span>                           </span><span class="hs-comment">-- Excludes class ops</span><span>
</span><span id="line-874"></span><span>                           </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681093593"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681093593"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681093588"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681093588"><span class="hs-identifier hs-var">sel_id</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)
-&gt; Located Var
forall arg.
HsRecField' (AmbiguousFieldOcc GhcTc) arg -&gt; Located Var
</span><a href="GHC.Hs.Pat.html#hsRecUpdFieldId"><span class="hs-identifier hs-var">hsRecUpdFieldId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)
-&gt; HsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)
</span><a href="#local-6989586621681093589"><span class="hs-identifier hs-var">fld</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-875"></span><span>                           </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Bool
</span><a href="GHC.Types.Id.html#isRecordSelector"><span class="hs-identifier hs-var">isRecordSelector</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681093588"><span class="hs-identifier hs-var">sel_id</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-876"></span><span>                           </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681093590"><span class="annot"><span class="annottext">fld_name :: Name
</span><a href="#local-6989586621681093590"><span class="hs-identifier hs-var hs-var">fld_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681093588"><span class="hs-identifier hs-var">sel_id</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-877"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRn () -&gt; TcRn ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base/src/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TcRn ()] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[TcRn ()]
</span><a href="#local-6989586621681093594"><span class="hs-identifier hs-var">bad_guys</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TcRn ()] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [()]
forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Traversable t, Monad m) =&gt;
t (m a) -&gt; m (t a)
</span><a href="../../base/src/Data.Traversable.html#sequence"><span class="hs-identifier hs-var">sequence</span></a></span><span> </span><span class="annot"><span class="annottext">[TcRn ()]
</span><a href="#local-6989586621681093594"><span class="hs-identifier hs-var">bad_guys</span></a></span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) [()] -&gt; TcRn () -&gt; TcRn ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><a href="../../base/src/GHC.Base.html#%3E%3E"><span class="hs-operator hs-var">&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TcRn ()
forall env a. IOEnv env a
</span><a href="GHC.Data.IOEnv.html#failM"><span class="hs-identifier hs-var">failM</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-878"></span><span>        </span><span class="hs-comment">-- See note [Mixed Record Selectors]</span><span>
</span><span id="line-879"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681093580"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621681093580"><span class="hs-identifier hs-var">data_sels</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093579"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621681093579"><span class="hs-identifier hs-var">pat_syn_sels</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-880"></span><span>                </span><span class="annot"><span class="annottext">(Var -&gt; Bool) -&gt; [Var] -&gt; ([Var], [Var])
forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><a href="../../base/src/Data.OldList.html#partition"><span class="hs-identifier hs-var">partition</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Bool
</span><a href="GHC.Types.Id.html#isDataConRecordSelector"><span class="hs-identifier hs-var">isDataConRecordSelector</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621681093596"><span class="hs-identifier hs-var">sel_ids</span></a></span><span>
</span><span id="line-881"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-identifier">MASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">all</span><span> </span><span class="hs-identifier">isPatSynRecordSelector</span><span> </span><span class="hs-identifier">pat_syn_sels</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-882"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621681093580"><span class="hs-identifier hs-var">data_sels</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621681093579"><span class="hs-identifier hs-var">pat_syn_sels</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-883"></span><span>                  </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; [Var] -&gt; SDoc
</span><a href="GHC.Tc.Gen.Expr.html#mixedSelectors"><span class="hs-identifier hs-var">mixedSelectors</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621681093580"><span class="hs-identifier hs-var">data_sels</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621681093579"><span class="hs-identifier hs-var">pat_syn_sels</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-884"></span><span>
</span><span id="line-885"></span><span>        </span><span class="hs-comment">-- STEP 1</span><span>
</span><span id="line-886"></span><span>        </span><span class="hs-comment">-- Figure out the tycon and data cons from the first field name</span><span>
</span><span id="line-887"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span>   </span><span class="hs-comment">-- It's OK to use the non-tc splitters here (for a selector)</span><span>
</span><span id="line-888"></span><span>              </span><span id="local-6989586621681093573"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681093573"><span class="hs-identifier hs-var">sel_id</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621681093596"><span class="hs-identifier hs-var">sel_ids</span></a></span><span>
</span><span id="line-889"></span><span>
</span><span id="line-890"></span><span>              </span><span class="annot"><a href="#local-6989586621681093572"><span class="hs-identifier hs-type">mtycon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span>
</span><span id="line-891"></span><span>              </span><span id="local-6989586621681093572"><span class="annot"><span class="annottext">mtycon :: Maybe TyCon
</span><a href="#local-6989586621681093572"><span class="hs-identifier hs-var hs-var">mtycon</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Var -&gt; IdDetails
</span><a href="GHC.Types.Var.html#idDetails"><span class="hs-identifier hs-var">idDetails</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681093573"><span class="hs-identifier hs-var">sel_id</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-892"></span><span>                          </span><span class="annot"><a href="GHC.Types.Id.Info.html#RecSelId"><span class="hs-identifier hs-type">RecSelId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Id.Info.html#RecSelData"><span class="hs-identifier hs-type">RecSelData</span></a></span><span> </span><span id="local-6989586621681093568"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681093568"><span class="hs-identifier hs-var">tycon</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Maybe TyCon
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681093568"><span class="hs-identifier hs-var">tycon</span></a></span><span>
</span><span id="line-893"></span><span>                          </span><span class="annot"><span class="annottext">IdDetails
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe TyCon
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-894"></span><span>
</span><span id="line-895"></span><span>              </span><span class="annot"><a href="#local-6989586621681093567"><span class="hs-identifier hs-type">con_likes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.ConLike.html#ConLike"><span class="hs-identifier hs-type">ConLike</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-896"></span><span>              </span><span id="local-6989586621681093567"><span class="annot"><span class="annottext">con_likes :: [ConLike]
</span><a href="#local-6989586621681093567"><span class="hs-identifier hs-var hs-var">con_likes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Var -&gt; IdDetails
</span><a href="GHC.Types.Var.html#idDetails"><span class="hs-identifier hs-var">idDetails</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681093573"><span class="hs-identifier hs-var">sel_id</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-897"></span><span>                             </span><span class="annot"><a href="GHC.Types.Id.Info.html#RecSelId"><span class="hs-identifier hs-type">RecSelId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Id.Info.html#RecSelData"><span class="hs-identifier hs-type">RecSelData</span></a></span><span> </span><span id="local-6989586621681093566"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681093566"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-898"></span><span>                                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(DataCon -&gt; ConLike) -&gt; [DataCon] -&gt; [ConLike]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; ConLike
</span><a href="GHC.Core.ConLike.html#RealDataCon"><span class="hs-identifier hs-var">RealDataCon</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [DataCon]
</span><a href="GHC.Core.TyCon.html#tyConDataCons"><span class="hs-identifier hs-var">tyConDataCons</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681093566"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-899"></span><span>                             </span><span class="annot"><a href="GHC.Types.Id.Info.html#RecSelId"><span class="hs-identifier hs-type">RecSelId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Id.Info.html#RecSelPatSyn"><span class="hs-identifier hs-type">RecSelPatSyn</span></a></span><span> </span><span id="local-6989586621681093562"><span class="annot"><span class="annottext">PatSyn
</span><a href="#local-6989586621681093562"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-900"></span><span>                                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">PatSyn -&gt; ConLike
</span><a href="GHC.Core.ConLike.html#PatSynCon"><span class="hs-identifier hs-var">PatSynCon</span></a></span><span> </span><span class="annot"><span class="annottext">PatSyn
</span><a href="#local-6989586621681093562"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-901"></span><span>                             </span><span class="annot"><span class="annottext">IdDetails
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; [ConLike]
forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcRecordUpd&quot;</span></span><span>
</span><span id="line-902"></span><span>                </span><span class="hs-comment">-- NB: for a data type family, the tycon is the instance tycon</span><span>
</span><span id="line-903"></span><span>
</span><span id="line-904"></span><span>              </span><span id="local-6989586621681093559"><span class="annot"><span class="annottext">relevant_cons :: [ConLike]
</span><a href="#local-6989586621681093559"><span class="hs-identifier hs-var hs-var">relevant_cons</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ConLike] -&gt; [FieldLabelString] -&gt; [ConLike]
</span><a href="GHC.Core.ConLike.html#conLikesWithFields"><span class="hs-identifier hs-var">conLikesWithFields</span></a></span><span> </span><span class="annot"><span class="annottext">[ConLike]
</span><a href="#local-6989586621681093567"><span class="hs-identifier hs-var">con_likes</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldLabelString]
</span><a href="#local-6989586621681093600"><span class="hs-identifier hs-var">upd_fld_occs</span></a></span><span>
</span><span id="line-905"></span><span>                </span><span class="hs-comment">-- A constructor is only relevant to this process if</span><span>
</span><span id="line-906"></span><span>                </span><span class="hs-comment">-- it contains *all* the fields that are being updated</span><span>
</span><span id="line-907"></span><span>                </span><span class="hs-comment">-- Other ones will cause a runtime error if they occur</span><span>
</span><span id="line-908"></span><span>
</span><span id="line-909"></span><span>        </span><span class="hs-comment">-- Step 2</span><span>
</span><span id="line-910"></span><span>        </span><span class="hs-comment">-- Check that at least one constructor has all the named fields</span><span>
</span><span id="line-911"></span><span>        </span><span class="hs-comment">-- i.e. has an empty set of bad fields returned by badFields</span><span>
</span><span id="line-912"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ConLike] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[ConLike]
</span><a href="#local-6989586621681093559"><span class="hs-identifier hs-var">relevant_cons</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)]
-&gt; [ConLike] -&gt; SDoc
</span><a href="GHC.Tc.Gen.Expr.html#badFieldsUpd"><span class="hs-identifier hs-var">badFieldsUpd</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)]
</span><a href="#local-6989586621681093604"><span class="hs-identifier hs-var">rbinds</span></a></span><span> </span><span class="annot"><span class="annottext">[ConLike]
</span><a href="#local-6989586621681093567"><span class="hs-identifier hs-var">con_likes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-913"></span><span>
</span><span id="line-914"></span><span>        </span><span class="hs-comment">-- Take apart a representative constructor</span><span>
</span><span id="line-915"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681093556"><span class="annot"><span class="annottext">con1 :: ConLike
</span><a href="#local-6989586621681093556"><span class="hs-identifier hs-var hs-var">con1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">null</span><span> </span><span class="hs-identifier">relevant_cons</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-identifier">head</span><span> </span><span class="hs-identifier">relevant_cons</span><span>
</span><span id="line-916"></span><span>              </span><span class="hs-special">(</span><span id="local-6989586621681093554"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621681093554"><span class="hs-identifier hs-var">con1_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Var]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[EqSpec]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093553"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681093553"><span class="hs-identifier hs-var">_prov_theta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093552"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681093552"><span class="hs-identifier hs-var">req_theta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093551"><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681093551"><span class="hs-identifier hs-var">scaled_con1_arg_tys</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-917"></span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConLike
-&gt; ([Var], [Var], [EqSpec], [TcType], [TcType], [Scaled TcType],
    TcType)
</span><a href="GHC.Core.ConLike.html#conLikeFullSig"><span class="hs-identifier hs-var">conLikeFullSig</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681093556"><span class="hs-identifier hs-var">con1</span></a></span><span>
</span><span id="line-918"></span><span>              </span><span id="local-6989586621681093549"><span class="annot"><span class="annottext">con1_arg_tys :: [TcType]
</span><a href="#local-6989586621681093549"><span class="hs-identifier hs-var hs-var">con1_arg_tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Scaled TcType -&gt; TcType) -&gt; [Scaled TcType] -&gt; [TcType]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled TcType -&gt; TcType
forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681093551"><span class="hs-identifier hs-var">scaled_con1_arg_tys</span></a></span><span>
</span><span id="line-919"></span><span>                </span><span class="hs-comment">-- We can safely drop the fields' multiplicities because</span><span>
</span><span id="line-920"></span><span>                </span><span class="hs-comment">-- they are currently always 1: there is no syntax for record</span><span>
</span><span id="line-921"></span><span>                </span><span class="hs-comment">-- fields with other multiplicities yet. This way we don't need</span><span>
</span><span id="line-922"></span><span>                </span><span class="hs-comment">-- to handle it in the rest of the function</span><span>
</span><span id="line-923"></span><span>              </span><span id="local-6989586621681093548"><span class="annot"><span class="annottext">con1_flds :: [FieldLabelString]
</span><a href="#local-6989586621681093548"><span class="hs-identifier hs-var hs-var">con1_flds</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(FieldLbl Name -&gt; FieldLabelString)
-&gt; [FieldLbl Name] -&gt; [FieldLabelString]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLbl Name -&gt; FieldLabelString
forall a. FieldLbl a -&gt; FieldLabelString
</span><a href="GHC.Types.FieldLabel.html#flLabel"><span class="hs-identifier hs-var hs-var">flLabel</span></a></span><span> </span><span class="annot"><span class="annottext">([FieldLbl Name] -&gt; [FieldLabelString])
-&gt; [FieldLbl Name] -&gt; [FieldLabelString]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike -&gt; [FieldLbl Name]
</span><a href="GHC.Core.ConLike.html#conLikeFieldLabels"><span class="hs-identifier hs-var">conLikeFieldLabels</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681093556"><span class="hs-identifier hs-var">con1</span></a></span><span>
</span><span id="line-924"></span><span>              </span><span id="local-6989586621681093545"><span class="annot"><span class="annottext">con1_tv_tys :: [TcType]
</span><a href="#local-6989586621681093545"><span class="hs-identifier hs-var hs-var">con1_tv_tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; [TcType]
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621681093554"><span class="hs-identifier hs-var">con1_tvs</span></a></span><span>
</span><span id="line-925"></span><span>              </span><span id="local-6989586621681093543"><span class="annot"><span class="annottext">con1_res_ty :: TcType
</span><a href="#local-6989586621681093543"><span class="hs-identifier hs-var hs-var">con1_res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe TyCon
</span><a href="#local-6989586621681093572"><span class="hs-identifier hs-var">mtycon</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-926"></span><span>                              </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681093542"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681093542"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [TcType] -&gt; TcType
</span><a href="GHC.Core.Type.html#mkFamilyTyConApp"><span class="hs-identifier hs-var">mkFamilyTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681093542"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681093545"><span class="hs-identifier hs-var">con1_tv_tys</span></a></span><span>
</span><span id="line-927"></span><span>                              </span><span class="annot"><span class="annottext">Maybe TyCon
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ConLike -&gt; [TcType] -&gt; TcType
</span><a href="GHC.Core.ConLike.html#conLikeResTy"><span class="hs-identifier hs-var">conLikeResTy</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681093556"><span class="hs-identifier hs-var">con1</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681093545"><span class="hs-identifier hs-var">con1_tv_tys</span></a></span><span>
</span><span id="line-928"></span><span>
</span><span id="line-929"></span><span>        </span><span class="hs-comment">-- Check that we're not dealing with a unidirectional pattern</span><span>
</span><span id="line-930"></span><span>        </span><span class="hs-comment">-- synonym</span><span>
</span><span id="line-931"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRn () -&gt; TcRn ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base/src/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Var -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../../base/src/Data.Maybe.html#isJust"><span class="hs-identifier hs-var">isJust</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Var -&gt; Bool) -&gt; Maybe Var -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike -&gt; Maybe Var
</span><a href="GHC.Core.ConLike.html#conLikeWrapId_maybe"><span class="hs-identifier hs-var">conLikeWrapId_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681093556"><span class="hs-identifier hs-var">con1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-932"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; TcRn ()
forall name a. Outputable name =&gt; name -&gt; TcM a
</span><a href="GHC.Tc.TyCl.PatSyn.html#nonBidirectionalErr"><span class="hs-identifier hs-var">nonBidirectionalErr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConLike -&gt; Name
</span><a href="GHC.Core.ConLike.html#conLikeName"><span class="hs-identifier hs-var">conLikeName</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681093556"><span class="hs-identifier hs-var">con1</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-933"></span><span>
</span><span id="line-934"></span><span>        </span><span class="hs-comment">-- STEP 3    Note [Criteria for update]</span><span>
</span><span id="line-935"></span><span>        </span><span class="hs-comment">-- Check that each updated field is polymorphic; that is, its type</span><span>
</span><span id="line-936"></span><span>        </span><span class="hs-comment">-- mentions only the universally-quantified variables of the data con</span><span>
</span><span id="line-937"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681093538"><span class="annot"><span class="annottext">flds1_w_tys :: [(FieldLabelString, TcType)]
</span><a href="#local-6989586621681093538"><span class="hs-identifier hs-var hs-var">flds1_w_tys</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
-&gt; [FieldLabelString] -&gt; [TcType] -&gt; [(FieldLabelString, TcType)]
forall a b. String -&gt; [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="GHC.Utils.Misc.html#zipEqual"><span class="hs-identifier hs-var">zipEqual</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcExpr:RecConUpd&quot;</span></span><span> </span><span class="annot"><span class="annottext">[FieldLabelString]
</span><a href="#local-6989586621681093548"><span class="hs-identifier hs-var">con1_flds</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681093549"><span class="hs-identifier hs-var">con1_arg_tys</span></a></span><span>
</span><span id="line-938"></span><span>              </span><span id="local-6989586621681093536"><span class="annot"><span class="annottext">bad_upd_flds :: [(FieldLabelString, TcType)]
</span><a href="#local-6989586621681093536"><span class="hs-identifier hs-var hs-var">bad_upd_flds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((FieldLabelString, TcType) -&gt; Bool)
-&gt; [(FieldLabelString, TcType)] -&gt; [(FieldLabelString, TcType)]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="annot"><span class="annottext">(FieldLabelString, TcType) -&gt; Bool
</span><a href="#local-6989586621681093535"><span class="hs-identifier hs-var">bad_fld</span></a></span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, TcType)]
</span><a href="#local-6989586621681093538"><span class="hs-identifier hs-var">flds1_w_tys</span></a></span><span>
</span><span id="line-939"></span><span>              </span><span id="local-6989586621681093534"><span class="annot"><span class="annottext">con1_tv_set :: VarSet
</span><a href="#local-6989586621681093534"><span class="hs-identifier hs-var hs-var">con1_tv_set</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#mkVarSet"><span class="hs-identifier hs-var">mkVarSet</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621681093554"><span class="hs-identifier hs-var">con1_tvs</span></a></span><span>
</span><span id="line-940"></span><span>              </span><span id="local-6989586621681093535"><span class="annot"><span class="annottext">bad_fld :: (FieldLabelString, TcType) -&gt; Bool
</span><a href="#local-6989586621681093535"><span class="hs-identifier hs-var hs-var">bad_fld</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681093532"><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621681093532"><span class="hs-identifier hs-var">fld</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093531"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093531"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621681093532"><span class="hs-identifier hs-var">fld</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabelString -&gt; [FieldLabelString] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#elem"><span class="hs-operator hs-var">`elem`</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldLabelString]
</span><a href="#local-6989586621681093600"><span class="hs-identifier hs-var">upd_fld_occs</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-941"></span><span>                                      </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093531"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; VarSet -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#subVarSet"><span class="hs-operator hs-var">`subVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621681093534"><span class="hs-identifier hs-var">con1_tv_set</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-942"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(FieldLabelString, TcType)] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, TcType)]
</span><a href="#local-6989586621681093536"><span class="hs-identifier hs-var">bad_upd_flds</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(FieldLabelString, TcType)] -&gt; SDoc
</span><a href="GHC.Tc.Gen.Expr.html#badFieldTypes"><span class="hs-identifier hs-var">badFieldTypes</span></a></span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, TcType)]
</span><a href="#local-6989586621681093536"><span class="hs-identifier hs-var">bad_upd_flds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-943"></span><span>
</span><span id="line-944"></span><span>        </span><span class="hs-comment">-- STEP 4  Note [Type of a record update]</span><span>
</span><span id="line-945"></span><span>        </span><span class="hs-comment">-- Figure out types for the scrutinee and result</span><span>
</span><span id="line-946"></span><span>        </span><span class="hs-comment">-- Both are of form (T a b c), with fresh type variables, but with</span><span>
</span><span id="line-947"></span><span>        </span><span class="hs-comment">-- common variables where the scrutinee and result must have the same type</span><span>
</span><span id="line-948"></span><span>        </span><span class="hs-comment">-- These are variables that appear in *any* arg of *any* of the</span><span>
</span><span id="line-949"></span><span>        </span><span class="hs-comment">-- relevant constructors *except* in the updated fields</span><span>
</span><span id="line-950"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-951"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681093526"><span class="annot"><span class="annottext">fixed_tvs :: VarSet
</span><a href="#local-6989586621681093526"><span class="hs-identifier hs-var hs-var">fixed_tvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FieldLabelString] -&gt; [Var] -&gt; [ConLike] -&gt; VarSet
</span><a href="GHC.Tc.Gen.Expr.html#getFixedTyVars"><span class="hs-identifier hs-var">getFixedTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldLabelString]
</span><a href="#local-6989586621681093600"><span class="hs-identifier hs-var">upd_fld_occs</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621681093554"><span class="hs-identifier hs-var">con1_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[ConLike]
</span><a href="#local-6989586621681093559"><span class="hs-identifier hs-var">relevant_cons</span></a></span><span>
</span><span id="line-952"></span><span>              </span><span id="local-6989586621681093525"><span class="annot"><span class="annottext">is_fixed_tv :: Var -&gt; Bool
</span><a href="#local-6989586621681093525"><span class="hs-identifier hs-var hs-var">is_fixed_tv</span></a></span></span><span> </span><span id="local-6989586621681093524"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681093524"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681093524"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; VarSet -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#elemVarSet"><span class="hs-operator hs-var">`elemVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621681093526"><span class="hs-identifier hs-var">fixed_tvs</span></a></span><span>
</span><span id="line-953"></span><span>
</span><span id="line-954"></span><span>              </span><span class="annot"><a href="#local-6989586621681093522"><span class="hs-identifier hs-type">mk_inst_ty</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Subst.html#TCvSubst"><span class="hs-identifier hs-type">TCvSubst</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-955"></span><span>              </span><span class="hs-comment">-- Deals with instantiation of kind variables</span><span>
</span><span id="line-956"></span><span>              </span><span class="hs-comment">--   c.f. GHC.Tc.Utils.TcMType.newMetaTyVars</span><span>
</span><span id="line-957"></span><span>              </span><span id="local-6989586621681093522"><span class="annot"><span class="annottext">mk_inst_ty :: TCvSubst -&gt; (Var, TcType) -&gt; TcM (TCvSubst, TcType)
</span><a href="#local-6989586621681093522"><span class="hs-identifier hs-var hs-var">mk_inst_ty</span></a></span></span><span> </span><span id="local-6989586621681093520"><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681093520"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681093519"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681093519"><span class="hs-identifier hs-var">tv</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093518"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093518"><span class="hs-identifier hs-var">result_inst_ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-958"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Bool
</span><a href="#local-6989586621681093525"><span class="hs-identifier hs-var">is_fixed_tv</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681093519"><span class="hs-identifier hs-var">tv</span></a></span><span>   </span><span class="hs-comment">-- Same as result type</span><span>
</span><span id="line-959"></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TCvSubst, TcType) -&gt; TcM (TCvSubst, TcType)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCvSubst -&gt; Var -&gt; TcType -&gt; TCvSubst
</span><a href="GHC.Core.TyCo.Subst.html#extendTvSubst"><span class="hs-identifier hs-var">extendTvSubst</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681093520"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681093519"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093518"><span class="hs-identifier hs-var">result_inst_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093518"><span class="hs-identifier hs-var">result_inst_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-960"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>        </span><span class="hs-comment">-- Fresh type, of correct kind</span><span>
</span><span id="line-961"></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681093516"><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681093516"><span class="hs-identifier hs-var">subst'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093515"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681093515"><span class="hs-identifier hs-var">new_tv</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TCvSubst -&gt; Var -&gt; TcM (TCvSubst, Var)
</span><a href="GHC.Tc.Utils.TcMType.html#newMetaTyVarX"><span class="hs-identifier hs-var">newMetaTyVarX</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681093520"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681093519"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-962"></span><span>                     </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(TCvSubst, TcType) -&gt; TcM (TCvSubst, TcType)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681093516"><span class="hs-identifier hs-var">subst'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; TcType
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681093515"><span class="hs-identifier hs-var">new_tv</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-963"></span><span>
</span><span id="line-964"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681093512"><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681093512"><span class="hs-identifier hs-var">result_subst</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093511"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621681093511"><span class="hs-identifier hs-var">con1_tvs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; TcM (TCvSubst, [Var])
</span><a href="GHC.Tc.Utils.TcMType.html#newMetaTyVars"><span class="hs-identifier hs-var">newMetaTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621681093554"><span class="hs-identifier hs-var">con1_tvs</span></a></span><span>
</span><span id="line-965"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681093509"><span class="annot"><span class="annottext">result_inst_tys :: [TcType]
</span><a href="#local-6989586621681093509"><span class="hs-identifier hs-var hs-var">result_inst_tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; [TcType]
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621681093511"><span class="hs-identifier hs-var">con1_tvs'</span></a></span><span>
</span><span id="line-966"></span><span>              </span><span id="local-6989586621681093508"><span class="annot"><span class="annottext">init_subst :: TCvSubst
</span><a href="#local-6989586621681093508"><span class="hs-identifier hs-var hs-var">init_subst</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InScopeSet -&gt; TCvSubst
</span><a href="GHC.Core.TyCo.Subst.html#mkEmptyTCvSubst"><span class="hs-identifier hs-var">mkEmptyTCvSubst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCvSubst -&gt; InScopeSet
</span><a href="GHC.Core.TyCo.Subst.html#getTCvInScope"><span class="hs-identifier hs-var">getTCvInScope</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681093512"><span class="hs-identifier hs-var">result_subst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-967"></span><span>
</span><span id="line-968"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681093505"><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681093505"><span class="hs-identifier hs-var">scrut_subst</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093504"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681093504"><span class="hs-identifier hs-var">scrut_inst_tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TCvSubst -&gt; (Var, TcType) -&gt; TcM (TCvSubst, TcType))
-&gt; TCvSubst
-&gt; [(Var, TcType)]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (TCvSubst, [TcType])
forall (m :: * -&gt; *) acc x y.
Monad m =&gt;
(acc -&gt; x -&gt; m (acc, y)) -&gt; acc -&gt; [x] -&gt; m (acc, [y])
</span><a href="GHC.Utils.Monad.html#mapAccumLM"><span class="hs-identifier hs-var">mapAccumLM</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst -&gt; (Var, TcType) -&gt; TcM (TCvSubst, TcType)
</span><a href="#local-6989586621681093522"><span class="hs-identifier hs-var">mk_inst_ty</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681093508"><span class="hs-identifier hs-var">init_subst</span></a></span><span>
</span><span id="line-969"></span><span>                                                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621681093554"><span class="hs-identifier hs-var">con1_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; [TcType] -&gt; [(Var, TcType)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../../base/src/GHC.List.html#zip"><span class="hs-operator hs-var">`zip`</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681093509"><span class="hs-identifier hs-var">result_inst_tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-970"></span><span>
</span><span id="line-971"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681093502"><span class="annot"><span class="annottext">rec_res_ty :: TcType
</span><a href="#local-6989586621681093502"><span class="hs-identifier hs-var hs-var">rec_res_ty</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; TCvSubst -&gt; TcType -&gt; TcType
TCvSubst -&gt; TcType -&gt; TcType
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">TcType.substTy</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681093512"><span class="hs-identifier hs-var">result_subst</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093543"><span class="hs-identifier hs-var">con1_res_ty</span></a></span><span>
</span><span id="line-972"></span><span>              </span><span id="local-6989586621681093500"><span class="annot"><span class="annottext">scrut_ty :: TcType
</span><a href="#local-6989586621681093500"><span class="hs-identifier hs-var hs-var">scrut_ty</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; TCvSubst -&gt; TcType -&gt; TcType
TCvSubst -&gt; TcType -&gt; TcType
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">TcType.substTy</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681093505"><span class="hs-identifier hs-var">scrut_subst</span></a></span><span>  </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093543"><span class="hs-identifier hs-var">con1_res_ty</span></a></span><span>
</span><span id="line-973"></span><span>              </span><span id="local-6989586621681093499"><span class="annot"><span class="annottext">con1_arg_tys' :: [TcType]
</span><a href="#local-6989586621681093499"><span class="hs-identifier hs-var hs-var">con1_arg_tys'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TcType -&gt; TcType) -&gt; [TcType] -&gt; [TcType]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasCallStack =&gt; TCvSubst -&gt; TcType -&gt; TcType
TCvSubst -&gt; TcType -&gt; TcType
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">TcType.substTy</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681093512"><span class="hs-identifier hs-var">result_subst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681093549"><span class="hs-identifier hs-var">con1_arg_tys</span></a></span><span>
</span><span id="line-974"></span><span>
</span><span id="line-975"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681093498"><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621681093498"><span class="hs-identifier hs-var">co_scrut</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (HsExpr GhcRn) -&gt; TcType -&gt; TcType -&gt; TcM TcCoercionR
</span><a href="GHC.Tc.Utils.Unify.html#unifyType"><span class="hs-identifier hs-var">unifyType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; Maybe (HsExpr GhcRn)
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; HsExpr GhcRn
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093613"><span class="hs-identifier hs-var">record_expr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093605"><span class="hs-identifier hs-var">record_rho</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093500"><span class="hs-identifier hs-var">scrut_ty</span></a></span><span>
</span><span id="line-976"></span><span>                </span><span class="hs-comment">-- NB: normal unification is OK here (as opposed to subsumption),</span><span>
</span><span id="line-977"></span><span>                </span><span class="hs-comment">-- because for this to work out, both record_rho and scrut_ty have</span><span>
</span><span id="line-978"></span><span>                </span><span class="hs-comment">-- to be normal datatypes -- no contravariant stuff can go on</span><span>
</span><span id="line-979"></span><span>
</span><span id="line-980"></span><span>        </span><span class="hs-comment">-- STEP 5</span><span>
</span><span id="line-981"></span><span>        </span><span class="hs-comment">-- Typecheck the bindings</span><span>
</span><span id="line-982"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681093496"><span class="annot"><span class="annottext">[LHsRecUpdField GhcTc]
</span><a href="#local-6989586621681093496"><span class="hs-identifier hs-var">rbinds'</span></a></span></span><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ConLike
-&gt; [TcType]
-&gt; [LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)]
-&gt; TcM [LHsRecUpdField GhcTc]
</span><a href="GHC.Tc.Gen.Expr.html#tcRecordUpd"><span class="hs-identifier hs-var">tcRecordUpd</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681093556"><span class="hs-identifier hs-var">con1</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681093499"><span class="hs-identifier hs-var">con1_arg_tys'</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)]
</span><a href="#local-6989586621681093604"><span class="hs-identifier hs-var">rbinds</span></a></span><span>
</span><span id="line-983"></span><span>
</span><span id="line-984"></span><span>        </span><span class="hs-comment">-- STEP 6: Deal with the stupid theta</span><span>
</span><span id="line-985"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681093494"><span class="annot"><span class="annottext">theta' :: [TcType]
</span><a href="#local-6989586621681093494"><span class="hs-identifier hs-var hs-var">theta'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCvSubst -&gt; [TcType] -&gt; [TcType]
</span><a href="GHC.Core.TyCo.Subst.html#substThetaUnchecked"><span class="hs-identifier hs-var">substThetaUnchecked</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681093505"><span class="hs-identifier hs-var">scrut_subst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConLike -&gt; [TcType]
</span><a href="GHC.Core.ConLike.html#conLikeStupidTheta"><span class="hs-identifier hs-var">conLikeStupidTheta</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681093556"><span class="hs-identifier hs-var">con1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-986"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; [TcType] -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Instantiate.html#instStupidTheta"><span class="hs-identifier hs-var">instStupidTheta</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#RecordUpdOrigin"><span class="hs-identifier hs-var">RecordUpdOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681093494"><span class="hs-identifier hs-var">theta'</span></a></span><span>
</span><span id="line-987"></span><span>
</span><span id="line-988"></span><span>        </span><span class="hs-comment">-- Step 7: make a cast for the scrutinee, in the</span><span>
</span><span id="line-989"></span><span>        </span><span class="hs-comment">--         case that it's from a data family</span><span>
</span><span id="line-990"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621681093489"><span class="hs-identifier hs-type">fam_co</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span>   </span><span class="hs-comment">-- RepT t1 .. tn ~R scrut_ty</span><span>
</span><span id="line-991"></span><span>              </span><span id="local-6989586621681093489"><span class="annot"><span class="annottext">fam_co :: HsWrapper
</span><a href="#local-6989586621681093489"><span class="hs-identifier hs-var hs-var">fam_co</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681093488"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681093488"><span class="hs-identifier hs-var">tycon</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe TyCon
</span><a href="#local-6989586621681093572"><span class="hs-identifier hs-var">mtycon</span></a></span><span>
</span><span id="line-992"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681093487"><span class="annot"><span class="annottext">CoAxiom Unbranched
</span><a href="#local-6989586621681093487"><span class="hs-identifier hs-var">co_con</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Maybe (CoAxiom Unbranched)
</span><a href="GHC.Core.TyCon.html#tyConFamilyCoercion_maybe"><span class="hs-identifier hs-var">tyConFamilyCoercion_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681093488"><span class="hs-identifier hs-var">tycon</span></a></span><span>
</span><span id="line-993"></span><span>                     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcCoercionR -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#mkWpCastR"><span class="hs-identifier hs-var">mkWpCastR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoAxiom Unbranched -&gt; [TcType] -&gt; [TcCoercionR] -&gt; TcCoercionR
</span><a href="GHC.Tc.Types.Evidence.html#mkTcUnbranchedAxInstCo"><span class="hs-identifier hs-var">mkTcUnbranchedAxInstCo</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiom Unbranched
</span><a href="#local-6989586621681093487"><span class="hs-identifier hs-var">co_con</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681093504"><span class="hs-identifier hs-var">scrut_inst_tys</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-994"></span><span>                     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-995"></span><span>                     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#idHsWrapper"><span class="hs-identifier hs-var">idHsWrapper</span></a></span><span>
</span><span id="line-996"></span><span>
</span><span id="line-997"></span><span>        </span><span class="hs-comment">-- Step 8: Check that the req constraints are satisfied</span><span>
</span><span id="line-998"></span><span>        </span><span class="hs-comment">-- For normal data constructors req_theta is empty but we must do</span><span>
</span><span id="line-999"></span><span>        </span><span class="hs-comment">-- this check for pattern synonyms.</span><span>
</span><span id="line-1000"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681093483"><span class="annot"><span class="annottext">req_theta' :: [TcType]
</span><a href="#local-6989586621681093483"><span class="hs-identifier hs-var hs-var">req_theta'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCvSubst -&gt; [TcType] -&gt; [TcType]
</span><a href="GHC.Core.TyCo.Subst.html#substThetaUnchecked"><span class="hs-identifier hs-var">substThetaUnchecked</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681093505"><span class="hs-identifier hs-var">scrut_subst</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681093552"><span class="hs-identifier hs-var">req_theta</span></a></span><span>
</span><span id="line-1001"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681093482"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681093482"><span class="hs-identifier hs-var">req_wrap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; [TcType] -&gt; TcM HsWrapper
</span><a href="GHC.Tc.Utils.Instantiate.html#instCallConstraints"><span class="hs-identifier hs-var">instCallConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#RecordUpdOrigin"><span class="hs-identifier hs-var">RecordUpdOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681093483"><span class="hs-identifier hs-var">req_theta'</span></a></span><span>
</span><span id="line-1002"></span><span>
</span><span id="line-1003"></span><span>        </span><span class="hs-comment">-- Phew!</span><span>
</span><span id="line-1004"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681093480"><span class="annot"><span class="annottext">upd_tc :: RecordUpdTc
</span><a href="#local-6989586621681093480"><span class="hs-identifier hs-var hs-var">upd_tc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RecordUpdTc :: [ConLike] -&gt; [TcType] -&gt; [TcType] -&gt; HsWrapper -&gt; RecordUpdTc
</span><a href="GHC.Hs.Expr.html#RecordUpdTc"><span class="hs-identifier hs-type">RecordUpdTc</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">rupd_cons :: [ConLike]
</span><a href="GHC.Hs.Expr.html#rupd_cons"><span class="hs-identifier hs-var">rupd_cons</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ConLike]
</span><a href="#local-6989586621681093559"><span class="hs-identifier hs-var">relevant_cons</span></a></span><span>
</span><span id="line-1005"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">rupd_in_tys :: [TcType]
</span><a href="GHC.Hs.Expr.html#rupd_in_tys"><span class="hs-identifier hs-var">rupd_in_tys</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681093504"><span class="hs-identifier hs-var">scrut_inst_tys</span></a></span><span>
</span><span id="line-1006"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">rupd_out_tys :: [TcType]
</span><a href="GHC.Hs.Expr.html#rupd_out_tys"><span class="hs-identifier hs-var">rupd_out_tys</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681093509"><span class="hs-identifier hs-var">result_inst_tys</span></a></span><span>
</span><span id="line-1007"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">rupd_wrap :: HsWrapper
</span><a href="GHC.Hs.Expr.html#rupd_wrap"><span class="hs-identifier hs-var">rupd_wrap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681093482"><span class="hs-identifier hs-var">req_wrap</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1008"></span><span>              </span><span id="local-6989586621681093474"><span class="annot"><span class="annottext">expr' :: HsExpr GhcTc
</span><a href="#local-6989586621681093474"><span class="hs-identifier hs-var hs-var">expr'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RecordUpd :: forall p.
XRecordUpd p -&gt; LHsExpr p -&gt; [LHsRecUpdField p] -&gt; HsExpr p
</span><a href="GHC.Hs.Expr.html#RecordUpd"><span class="hs-identifier hs-type">RecordUpd</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">rupd_expr :: LHsExpr GhcTc
</span><a href="GHC.Hs.Expr.html#rupd_expr"><span class="hs-identifier hs-var">rupd_expr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; LHsExpr GhcTc -&gt; LHsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkLHsWrap"><span class="hs-identifier hs-var">mkLHsWrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681093489"><span class="hs-identifier hs-var">fam_co</span></a></span><span> </span><span class="annot"><span class="annottext">(LHsExpr GhcTc -&gt; LHsExpr GhcTc) -&gt; LHsExpr GhcTc -&gt; LHsExpr GhcTc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1009"></span><span>                                              </span><span class="annot"><span class="annottext">TcCoercionR -&gt; LHsExpr GhcTc -&gt; LHsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkLHsWrapCo"><span class="hs-identifier hs-var">mkLHsWrapCo</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621681093498"><span class="hs-identifier hs-var">co_scrut</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681093606"><span class="hs-identifier hs-var">record_expr'</span></a></span><span>
</span><span id="line-1010"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">rupd_flds :: [LHsRecUpdField GhcTc]
</span><a href="GHC.Hs.Expr.html#rupd_flds"><span class="hs-identifier hs-var">rupd_flds</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[LHsRecUpdField GhcTc]
</span><a href="#local-6989586621681093496"><span class="hs-identifier hs-var">rbinds'</span></a></span><span>
</span><span id="line-1011"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">rupd_ext :: XRecordUpd GhcTc
</span><a href="GHC.Hs.Expr.html#rupd_ext"><span class="hs-identifier hs-var">rupd_ext</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XRecordUpd GhcTc
RecordUpdTc
</span><a href="#local-6989586621681093480"><span class="hs-identifier hs-var">upd_tc</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1012"></span><span>
</span><span id="line-1013"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
-&gt; HsExpr GhcTc -&gt; TcType -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Utils.Unify.html#tcWrapResult"><span class="hs-identifier hs-var">tcWrapResult</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681093616"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681093474"><span class="hs-identifier hs-var">expr'</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093502"><span class="hs-identifier hs-var">rec_res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093610"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1014"></span><span>
</span><span id="line-1015"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span id="local-6989586621681093471"><span class="annot"><span class="annottext">e :: HsExpr GhcRn
</span><a href="#local-6989586621681093471"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsRecFld"><span class="hs-identifier hs-type">HsRecFld</span></a></span><span> </span><span class="annot"><span class="annottext">XRecFld GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681093470"><span class="annot"><span class="annottext">AmbiguousFieldOcc GhcRn
</span><a href="#local-6989586621681093470"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681093469"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093469"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-1016"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
-&gt; AmbiguousFieldOcc GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckRecSelId"><span class="hs-identifier hs-var">tcCheckRecSelId</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681093471"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">AmbiguousFieldOcc GhcRn
</span><a href="#local-6989586621681093470"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093469"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-1017"></span><span>
</span><span id="line-1018"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
        Arithmetic sequences                    e.g. [a,b..]
        and their parallel-array counterparts   e.g. [: a,b.. :]

*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-1027"></span><span>
</span><span id="line-1028"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#ArithSeq"><span class="hs-identifier hs-type">ArithSeq</span></a></span><span> </span><span class="annot"><span class="annottext">XArithSeq GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681093466"><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcRn)
</span><a href="#local-6989586621681093466"><span class="hs-identifier hs-var">witness</span></a></span></span><span> </span><span id="local-6989586621681093465"><span class="annot"><span class="annottext">ArithSeqInfo GhcRn
</span><a href="#local-6989586621681093465"><span class="hs-identifier hs-var">seq</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681093464"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093464"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-1029"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcRn)
-&gt; ArithSeqInfo GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcArithSeq"><span class="hs-identifier hs-var">tcArithSeq</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcRn)
</span><a href="#local-6989586621681093466"><span class="hs-identifier hs-var">witness</span></a></span><span> </span><span class="annot"><span class="annottext">ArithSeqInfo GhcRn
</span><a href="#local-6989586621681093465"><span class="hs-identifier hs-var">seq</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093464"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-1030"></span><span>
</span><span id="line-1031"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Template Haskell
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-1038"></span><span>
</span><span id="line-1039"></span><span class="hs-comment">-- HsSpliced is an annotation produced by 'GHC.Rename.Splice.rnSpliceExpr'.</span><span>
</span><span id="line-1040"></span><span class="hs-comment">-- Here we get rid of it and add the finalizers to the global environment.</span><span>
</span><span id="line-1041"></span><span class="hs-comment">--</span><span>
</span><span id="line-1042"></span><span class="hs-comment">-- See Note [Delaying modFinalizers in untyped splices] in GHC.Rename.Splice.</span><span>
</span><span id="line-1043"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsSpliceE"><span class="hs-identifier hs-type">HsSpliceE</span></a></span><span> </span><span class="annot"><span class="annottext">XSpliceE GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsSpliced"><span class="hs-identifier hs-type">HsSpliced</span></a></span><span> </span><span class="annot"><span class="annottext">XSpliced GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681093460"><span class="annot"><span class="annottext">ThModFinalizers
</span><a href="#local-6989586621681093460"><span class="hs-identifier hs-var">mod_finalizers</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsSplicedExpr"><span class="hs-identifier hs-type">HsSplicedExpr</span></a></span><span> </span><span id="local-6989586621681093458"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681093458"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1044"></span><span>       </span><span id="local-6989586621681093457"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093457"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-1045"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">ThModFinalizers -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addModFinalizersWithLclEnv"><span class="hs-identifier hs-var">addModFinalizersWithLclEnv</span></a></span><span> </span><span class="annot"><span class="annottext">ThModFinalizers
</span><a href="#local-6989586621681093460"><span class="hs-identifier hs-var">mod_finalizers</span></a></span><span>
</span><span id="line-1046"></span><span>       </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681093458"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093457"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-1047"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsSpliceE"><span class="hs-identifier hs-type">HsSpliceE</span></a></span><span> </span><span class="annot"><span class="annottext">XSpliceE GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681093455"><span class="annot"><span class="annottext">HsSplice GhcRn
</span><a href="#local-6989586621681093455"><span class="hs-identifier hs-var">splice</span></a></span></span><span class="hs-special">)</span><span>          </span><span id="local-6989586621681093454"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093454"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsSplice GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Splice.html#tcSpliceExpr"><span class="hs-identifier hs-var">tcSpliceExpr</span></a></span><span> </span><span class="annot"><span class="annottext">HsSplice GhcRn
</span><a href="#local-6989586621681093455"><span class="hs-identifier hs-var">splice</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093454"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-1048"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span id="local-6989586621681093453"><span class="annot"><span class="annottext">e :: HsExpr GhcRn
</span><a href="#local-6989586621681093453"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsBracket"><span class="hs-identifier hs-type">HsBracket</span></a></span><span> </span><span class="annot"><span class="annottext">XBracket GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681093451"><span class="annot"><span class="annottext">HsBracket GhcRn
</span><a href="#local-6989586621681093451"><span class="hs-identifier hs-var">brack</span></a></span></span><span class="hs-special">)</span><span>         </span><span id="local-6989586621681093450"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093450"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; HsBracket GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Splice.html#tcTypedBracket"><span class="hs-identifier hs-var">tcTypedBracket</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681093453"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">HsBracket GhcRn
</span><a href="#local-6989586621681093451"><span class="hs-identifier hs-var">brack</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093450"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-1049"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span id="local-6989586621681093449"><span class="annot"><span class="annottext">e :: HsExpr GhcRn
</span><a href="#local-6989586621681093449"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsRnBracketOut"><span class="hs-identifier hs-type">HsRnBracketOut</span></a></span><span> </span><span class="annot"><span class="annottext">XRnBracketOut GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681093447"><span class="annot"><span class="annottext">HsBracket GhcRn
</span><a href="#local-6989586621681093447"><span class="hs-identifier hs-var">brack</span></a></span></span><span> </span><span id="local-6989586621681093446"><span class="annot"><span class="annottext">[PendingRnSplice]
</span><a href="#local-6989586621681093446"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681093445"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093445"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
-&gt; HsBracket GhcRn
-&gt; [PendingRnSplice]
-&gt; ExpRhoType
-&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Splice.html#tcUntypedBracket"><span class="hs-identifier hs-var">tcUntypedBracket</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681093449"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">HsBracket GhcRn
</span><a href="#local-6989586621681093447"><span class="hs-identifier hs-var">brack</span></a></span><span> </span><span class="annot"><span class="annottext">[PendingRnSplice]
</span><a href="#local-6989586621681093446"><span class="hs-identifier hs-var">ps</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093445"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-1050"></span><span>
</span><span id="line-1051"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Rebindable syntax
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-1058"></span><span>
</span><span id="line-1059"></span><span class="hs-comment">-- See Note [Rebindable syntax and HsExpansion].</span><span>
</span><span id="line-1060"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#XExpr"><span class="hs-identifier hs-type">XExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsExpanded"><span class="hs-identifier hs-type">HsExpanded</span></a></span><span> </span><span id="local-6989586621681093442"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681093442"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span id="local-6989586621681093441"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681093441"><span class="hs-identifier hs-var">b</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621681093440"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093440"><span class="hs-identifier hs-var">t</span></a></span></span><span>
</span><span id="line-1061"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc -&gt; HsExpr GhcTc)
-&gt; TcM (HsExpr GhcTc) -&gt; TcM (HsExpr GhcTc)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XXExprGhcTc -&gt; HsExpr GhcTc
forall p. XXExpr p -&gt; HsExpr p
</span><a href="GHC.Hs.Expr.html#XExpr"><span class="hs-identifier hs-var">XExpr</span></a></span><span> </span><span class="annot"><span class="annottext">(XXExprGhcTc -&gt; HsExpr GhcTc)
-&gt; (HsExpr GhcTc -&gt; XXExprGhcTc) -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpansion (HsExpr GhcRn) (HsExpr GhcTc) -&gt; XXExprGhcTc
</span><a href="GHC.Hs.Expr.html#ExpansionExpr"><span class="hs-identifier hs-var">ExpansionExpr</span></a></span><span> </span><span class="annot"><span class="annottext">(HsExpansion (HsExpr GhcRn) (HsExpr GhcTc) -&gt; XXExprGhcTc)
-&gt; (HsExpr GhcTc -&gt; HsExpansion (HsExpr GhcRn) (HsExpr GhcTc))
-&gt; HsExpr GhcTc
-&gt; XXExprGhcTc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
-&gt; HsExpr GhcTc -&gt; HsExpansion (HsExpr GhcRn) (HsExpr GhcTc)
forall a b. a -&gt; b -&gt; HsExpansion a b
</span><a href="GHC.Hs.Expr.html#HsExpanded"><span class="hs-identifier hs-var">HsExpanded</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681093442"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM (HsExpr GhcTc) -&gt; TcM (HsExpr GhcTc))
-&gt; TcM (HsExpr GhcTc) -&gt; TcM (HsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1062"></span><span>      </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcM (HsExpr GhcTc) -&gt; TcM (HsExpr GhcTc)
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="GHC.Types.SrcLoc.html#generatedSrcSpan"><span class="hs-identifier hs-var">generatedSrcSpan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681093441"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093440"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1063"></span><span>
</span><span id="line-1064"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Catch-all
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-1071"></span><span>
</span><span id="line-1072"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span id="local-6989586621681093437"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681093437"><span class="hs-identifier hs-var">other</span></a></span></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcM (HsExpr GhcTc)
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcLExpr&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681093437"><span class="hs-identifier hs-var">other</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1073"></span><span>  </span><span class="hs-comment">-- Include ArrForm, ArrApp, which shouldn't appear at all</span><span>
</span><span id="line-1074"></span><span>  </span><span class="hs-comment">-- Also HsTcBracketOut, HsQuasiQuoteE</span><span>
</span><span id="line-1075"></span><span>
</span><span id="line-1076"></span><span>
</span><span id="line-1077"></span><span class="hs-comment">{- *********************************************************************
*                                                                      *
             Pragmas on expressions
*                                                                      *
********************************************************************* -}</span><span>
</span><span id="line-1082"></span><span>
</span><span id="line-1083"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExprPrag"><span class="hs-identifier hs-type">tcExprPrag</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsPragE"><span class="hs-identifier hs-type">HsPragE</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsPragE"><span class="hs-identifier hs-type">HsPragE</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span>
</span><span id="line-1084"></span><span id="tcExprPrag"><span class="annot"><span class="annottext">tcExprPrag :: HsPragE GhcRn -&gt; HsPragE GhcTc
</span><a href="GHC.Tc.Gen.Expr.html#tcExprPrag"><span class="hs-identifier hs-var hs-var">tcExprPrag</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsPragSCC"><span class="hs-identifier hs-type">HsPragSCC</span></a></span><span> </span><span id="local-6989586621681093434"><span class="annot"><span class="annottext">XSCC GhcRn
</span><a href="#local-6989586621681093434"><span class="hs-identifier hs-var">x1</span></a></span></span><span> </span><span id="local-6989586621681093433"><span class="annot"><span class="annottext">SourceText
</span><a href="#local-6989586621681093433"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span id="local-6989586621681093432"><span class="annot"><span class="annottext">StringLiteral
</span><a href="#local-6989586621681093432"><span class="hs-identifier hs-var">ann</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XSCC GhcTc -&gt; SourceText -&gt; StringLiteral -&gt; HsPragE GhcTc
forall p. XSCC p -&gt; SourceText -&gt; StringLiteral -&gt; HsPragE p
</span><a href="GHC.Hs.Expr.html#HsPragSCC"><span class="hs-identifier hs-var">HsPragSCC</span></a></span><span> </span><span class="annot"><span class="annottext">XSCC GhcRn
XSCC GhcTc
</span><a href="#local-6989586621681093434"><span class="hs-identifier hs-var">x1</span></a></span><span> </span><span class="annot"><span class="annottext">SourceText
</span><a href="#local-6989586621681093433"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="annot"><span class="annottext">StringLiteral
</span><a href="#local-6989586621681093432"><span class="hs-identifier hs-var">ann</span></a></span><span>
</span><span id="line-1085"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExprPrag"><span class="hs-identifier hs-var">tcExprPrag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsPragTick"><span class="hs-identifier hs-type">HsPragTick</span></a></span><span> </span><span id="local-6989586621681093430"><span class="annot"><span class="annottext">XTickPragma GhcRn
</span><a href="#local-6989586621681093430"><span class="hs-identifier hs-var">x1</span></a></span></span><span> </span><span id="local-6989586621681093429"><span class="annot"><span class="annottext">SourceText
</span><a href="#local-6989586621681093429"><span class="hs-identifier hs-var">src</span></a></span></span><span> </span><span id="local-6989586621681093428"><span class="annot"><span class="annottext">(StringLiteral, (ThLevel, ThLevel), (ThLevel, ThLevel))
</span><a href="#local-6989586621681093428"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span id="local-6989586621681093427"><span class="annot"><span class="annottext">((SourceText, SourceText), (SourceText, SourceText))
</span><a href="#local-6989586621681093427"><span class="hs-identifier hs-var">srcInfo</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XTickPragma GhcTc
-&gt; SourceText
-&gt; (StringLiteral, (ThLevel, ThLevel), (ThLevel, ThLevel))
-&gt; ((SourceText, SourceText), (SourceText, SourceText))
-&gt; HsPragE GhcTc
forall p.
XTickPragma p
-&gt; SourceText
-&gt; (StringLiteral, (ThLevel, ThLevel), (ThLevel, ThLevel))
-&gt; ((SourceText, SourceText), (SourceText, SourceText))
-&gt; HsPragE p
</span><a href="GHC.Hs.Expr.html#HsPragTick"><span class="hs-identifier hs-var">HsPragTick</span></a></span><span> </span><span class="annot"><span class="annottext">XTickPragma GhcRn
XTickPragma GhcTc
</span><a href="#local-6989586621681093430"><span class="hs-identifier hs-var">x1</span></a></span><span> </span><span class="annot"><span class="annottext">SourceText
</span><a href="#local-6989586621681093429"><span class="hs-identifier hs-var">src</span></a></span><span> </span><span class="annot"><span class="annottext">(StringLiteral, (ThLevel, ThLevel), (ThLevel, ThLevel))
</span><a href="#local-6989586621681093428"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="annot"><span class="annottext">((SourceText, SourceText), (SourceText, SourceText))
</span><a href="#local-6989586621681093427"><span class="hs-identifier hs-var">srcInfo</span></a></span><span>
</span><span id="line-1086"></span><span>
</span><span id="line-1087"></span><span>
</span><span id="line-1088"></span><span class="hs-comment">{- *********************************************************************
*                                                                      *
             Expression with type signature e::ty
*                                                                      *
********************************************************************* -}</span><span>
</span><span id="line-1093"></span><span>
</span><span id="line-1094"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExprWithSig"><span class="hs-identifier hs-type">tcExprWithSig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Type.html#LHsSigWcType"><span class="hs-identifier hs-type">LHsSigWcType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Extension.html#NoGhcTc"><span class="hs-identifier hs-type">NoGhcTc</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1095"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1096"></span><span id="tcExprWithSig"><span class="annot"><span class="annottext">tcExprWithSig :: LHsExpr GhcRn
-&gt; LHsSigWcType (NoGhcTc GhcRn) -&gt; TcM (HsExpr GhcTc, TcType)
</span><a href="GHC.Tc.Gen.Expr.html#tcExprWithSig"><span class="hs-identifier hs-var hs-var">tcExprWithSig</span></a></span></span><span> </span><span id="local-6989586621681093426"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093426"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span id="local-6989586621681093425"><span class="annot"><span class="annottext">LHsSigWcType (NoGhcTc GhcRn)
</span><a href="#local-6989586621681093425"><span class="hs-identifier hs-var">hs_ty</span></a></span></span><span>
</span><span id="line-1097"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681093424"><span class="annot"><span class="annottext">TcIdSigInfo
</span><a href="#local-6989586621681093424"><span class="hs-identifier hs-var">sig_info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM TcIdSigInfo -&gt; TcM TcIdSigInfo
forall r. TcM r -&gt; TcM r
</span><a href="GHC.Tc.Utils.Monad.html#checkNoErrs"><span class="hs-identifier hs-var">checkNoErrs</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM TcIdSigInfo -&gt; TcM TcIdSigInfo)
-&gt; TcM TcIdSigInfo -&gt; TcM TcIdSigInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>  </span><span class="hs-comment">-- Avoid error cascade</span><span>
</span><span id="line-1098"></span><span>                     </span><span class="annot"><span class="annottext">SrcSpan -&gt; LHsSigWcType GhcRn -&gt; Maybe Name -&gt; TcM TcIdSigInfo
</span><a href="GHC.Tc.Gen.Sig.html#tcUserTypeSig"><span class="hs-identifier hs-var">tcUserTypeSig</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681093422"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">LHsSigWcType GhcRn
LHsSigWcType (NoGhcTc GhcRn)
</span><a href="#local-6989586621681093425"><span class="hs-identifier hs-var">hs_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Name
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1099"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681093421"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681093421"><span class="hs-identifier hs-var">expr'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093420"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093420"><span class="hs-identifier hs-var">poly_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; TcIdSigInfo -&gt; TcM (LHsExpr GhcTc, TcType)
</span><a href="GHC.Tc.Gen.Expr.html#tcExprSig"><span class="hs-identifier hs-var">tcExprSig</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093426"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">TcIdSigInfo
</span><a href="#local-6989586621681093424"><span class="hs-identifier hs-var">sig_info</span></a></span><span>
</span><span id="line-1100"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc, TcType) -&gt; TcM (HsExpr GhcTc, TcType)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XExprWithTySig GhcTc
-&gt; LHsExpr GhcTc -&gt; LHsSigWcType (NoGhcTc GhcTc) -&gt; HsExpr GhcTc
forall p.
XExprWithTySig p
-&gt; LHsExpr p -&gt; LHsSigWcType (NoGhcTc p) -&gt; HsExpr p
</span><a href="GHC.Hs.Expr.html#ExprWithTySig"><span class="hs-identifier hs-var">ExprWithTySig</span></a></span><span> </span><span class="annot"><span class="annottext">NoExtField
XExprWithTySig GhcTc
</span><a href="GHC.Hs.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681093421"><span class="hs-identifier hs-var">expr'</span></a></span><span> </span><span class="annot"><span class="annottext">LHsSigWcType (NoGhcTc GhcRn)
LHsSigWcType (NoGhcTc GhcTc)
</span><a href="#local-6989586621681093425"><span class="hs-identifier hs-var">hs_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093420"><span class="hs-identifier hs-var">poly_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1101"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1102"></span><span>    </span><span id="local-6989586621681093422"><span class="annot"><span class="annottext">loc :: SrcSpan
</span><a href="#local-6989586621681093422"><span class="hs-identifier hs-var hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpan (HsType GhcRn) -&gt; SrcSpan
forall l e. GenLocated l e -&gt; l
</span><a href="GHC.Types.SrcLoc.html#getLoc"><span class="hs-identifier hs-var">getLoc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsSigWcType GhcRn -&gt; GenLocated SrcSpan (HsType GhcRn)
forall pass. LHsSigWcType pass -&gt; LHsType pass
</span><a href="GHC.Hs.Type.html#hsSigWcType"><span class="hs-identifier hs-var">hsSigWcType</span></a></span><span> </span><span class="annot"><span class="annottext">LHsSigWcType GhcRn
LHsSigWcType (NoGhcTc GhcRn)
</span><a href="#local-6989586621681093425"><span class="hs-identifier hs-var">hs_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1103"></span><span>
</span><span id="line-1104"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Arithmetic sequences [a..b] etc
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-1111"></span><span>
</span><span id="line-1112"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcArithSeq"><span class="hs-identifier hs-type">tcArithSeq</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#SyntaxExpr"><span class="hs-identifier hs-type">SyntaxExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#ArithSeqInfo"><span class="hs-identifier hs-type">ArithSeqInfo</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span>
</span><span id="line-1113"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1114"></span><span>
</span><span id="line-1115"></span><span id="tcArithSeq"><span class="annot"><span class="annottext">tcArithSeq :: Maybe (SyntaxExpr GhcRn)
-&gt; ArithSeqInfo GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcArithSeq"><span class="hs-identifier hs-var hs-var">tcArithSeq</span></a></span></span><span> </span><span id="local-6989586621681093417"><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcRn)
</span><a href="#local-6989586621681093417"><span class="hs-identifier hs-var">witness</span></a></span></span><span> </span><span id="local-6989586621681093416"><span class="annot"><span class="annottext">seq :: ArithSeqInfo GhcRn
</span><a href="#local-6989586621681093416"><span class="hs-identifier hs-var">seq</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#From"><span class="hs-identifier hs-type">From</span></a></span><span> </span><span id="local-6989586621681093414"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093414"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681093413"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093413"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-1116"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681093412"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681093412"><span class="hs-identifier hs-var">wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093411"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093411"><span class="hs-identifier hs-var">elt_mult</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093410"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093410"><span class="hs-identifier hs-var">elt_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093409"><span class="annot"><span class="annottext">Maybe SyntaxExprTc
</span><a href="#local-6989586621681093409"><span class="hs-identifier hs-var">wit'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcRn)
-&gt; ExpRhoType
-&gt; TcM (HsWrapper, TcType, TcType, Maybe (SyntaxExpr GhcTc))
</span><a href="GHC.Tc.Gen.Expr.html#arithSeqEltType"><span class="hs-identifier hs-var">arithSeqEltType</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcRn)
</span><a href="#local-6989586621681093417"><span class="hs-identifier hs-var">witness</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093413"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-1117"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681093407"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681093407"><span class="hs-identifier hs-var">expr'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span class="annot"><span class="annottext">TcType -&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a. TcType -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-var">tcScalingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093411"><span class="hs-identifier hs-var">elt_mult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; TcType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExpr"><span class="hs-identifier hs-var">tcCheckPolyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093414"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093410"><span class="hs-identifier hs-var">elt_ty</span></a></span><span>
</span><span id="line-1118"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681093406"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681093406"><span class="hs-identifier hs-var">enum_from</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; Name -&gt; [TcType] -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Utils.Instantiate.html#newMethodFromName"><span class="hs-identifier hs-var">newMethodFromName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArithSeqInfo GhcRn -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#ArithSeqOrigin"><span class="hs-identifier hs-var">ArithSeqOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">ArithSeqInfo GhcRn
</span><a href="#local-6989586621681093416"><span class="hs-identifier hs-var">seq</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1119"></span><span>                              </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#enumFromName"><span class="hs-identifier hs-var">enumFromName</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093410"><span class="hs-identifier hs-var">elt_ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1120"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc -&gt; TcM (HsExpr GhcTc))
-&gt; HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrap"><span class="hs-identifier hs-var">mkHsWrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681093412"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc -&gt; HsExpr GhcTc) -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1121"></span><span>         </span><span class="annot"><span class="annottext">XArithSeq GhcTc
-&gt; Maybe (SyntaxExpr GhcTc) -&gt; ArithSeqInfo GhcTc -&gt; HsExpr GhcTc
forall p.
XArithSeq p -&gt; Maybe (SyntaxExpr p) -&gt; ArithSeqInfo p -&gt; HsExpr p
</span><a href="GHC.Hs.Expr.html#ArithSeq"><span class="hs-identifier hs-var">ArithSeq</span></a></span><span> </span><span class="annot"><span class="annottext">XArithSeq GhcTc
HsExpr GhcTc
</span><a href="#local-6989586621681093406"><span class="hs-identifier hs-var">enum_from</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcTc)
Maybe SyntaxExprTc
</span><a href="#local-6989586621681093409"><span class="hs-identifier hs-var">wit'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsExpr GhcTc -&gt; ArithSeqInfo GhcTc
forall id. LHsExpr id -&gt; ArithSeqInfo id
</span><a href="GHC.Hs.Expr.html#From"><span class="hs-identifier hs-var">From</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681093407"><span class="hs-identifier hs-var">expr'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1122"></span><span>
</span><span id="line-1123"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcArithSeq"><span class="hs-identifier hs-var">tcArithSeq</span></a></span><span> </span><span id="local-6989586621681093403"><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcRn)
</span><a href="#local-6989586621681093403"><span class="hs-identifier hs-var">witness</span></a></span></span><span> </span><span id="local-6989586621681093402"><span class="annot"><span class="annottext">seq :: ArithSeqInfo GhcRn
</span><a href="#local-6989586621681093402"><span class="hs-identifier hs-var">seq</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#FromThen"><span class="hs-identifier hs-type">FromThen</span></a></span><span> </span><span id="local-6989586621681093400"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093400"><span class="hs-identifier hs-var">expr1</span></a></span></span><span> </span><span id="local-6989586621681093399"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093399"><span class="hs-identifier hs-var">expr2</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681093398"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093398"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-1124"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681093397"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681093397"><span class="hs-identifier hs-var">wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093396"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093396"><span class="hs-identifier hs-var">elt_mult</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093395"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093395"><span class="hs-identifier hs-var">elt_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093394"><span class="annot"><span class="annottext">Maybe SyntaxExprTc
</span><a href="#local-6989586621681093394"><span class="hs-identifier hs-var">wit'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcRn)
-&gt; ExpRhoType
-&gt; TcM (HsWrapper, TcType, TcType, Maybe (SyntaxExpr GhcTc))
</span><a href="GHC.Tc.Gen.Expr.html#arithSeqEltType"><span class="hs-identifier hs-var">arithSeqEltType</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcRn)
</span><a href="#local-6989586621681093403"><span class="hs-identifier hs-var">witness</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093398"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-1125"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681093393"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681093393"><span class="hs-identifier hs-var">expr1'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a. TcType -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-var">tcScalingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093396"><span class="hs-identifier hs-var">elt_mult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; TcType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExpr"><span class="hs-identifier hs-var">tcCheckPolyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093400"><span class="hs-identifier hs-var">expr1</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093395"><span class="hs-identifier hs-var">elt_ty</span></a></span><span>
</span><span id="line-1126"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681093392"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681093392"><span class="hs-identifier hs-var">expr2'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a. TcType -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-var">tcScalingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093396"><span class="hs-identifier hs-var">elt_mult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; TcType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExpr"><span class="hs-identifier hs-var">tcCheckPolyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093399"><span class="hs-identifier hs-var">expr2</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093395"><span class="hs-identifier hs-var">elt_ty</span></a></span><span>
</span><span id="line-1127"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681093391"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681093391"><span class="hs-identifier hs-var">enum_from_then</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; Name -&gt; [TcType] -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Utils.Instantiate.html#newMethodFromName"><span class="hs-identifier hs-var">newMethodFromName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArithSeqInfo GhcRn -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#ArithSeqOrigin"><span class="hs-identifier hs-var">ArithSeqOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">ArithSeqInfo GhcRn
</span><a href="#local-6989586621681093402"><span class="hs-identifier hs-var">seq</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1128"></span><span>                              </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#enumFromThenName"><span class="hs-identifier hs-var">enumFromThenName</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093395"><span class="hs-identifier hs-var">elt_ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1129"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc -&gt; TcM (HsExpr GhcTc))
-&gt; HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrap"><span class="hs-identifier hs-var">mkHsWrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681093397"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc -&gt; HsExpr GhcTc) -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1130"></span><span>         </span><span class="annot"><span class="annottext">XArithSeq GhcTc
-&gt; Maybe (SyntaxExpr GhcTc) -&gt; ArithSeqInfo GhcTc -&gt; HsExpr GhcTc
forall p.
XArithSeq p -&gt; Maybe (SyntaxExpr p) -&gt; ArithSeqInfo p -&gt; HsExpr p
</span><a href="GHC.Hs.Expr.html#ArithSeq"><span class="hs-identifier hs-var">ArithSeq</span></a></span><span> </span><span class="annot"><span class="annottext">XArithSeq GhcTc
HsExpr GhcTc
</span><a href="#local-6989586621681093391"><span class="hs-identifier hs-var">enum_from_then</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcTc)
Maybe SyntaxExprTc
</span><a href="#local-6989586621681093394"><span class="hs-identifier hs-var">wit'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsExpr GhcTc -&gt; LHsExpr GhcTc -&gt; ArithSeqInfo GhcTc
forall id. LHsExpr id -&gt; LHsExpr id -&gt; ArithSeqInfo id
</span><a href="GHC.Hs.Expr.html#FromThen"><span class="hs-identifier hs-var">FromThen</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681093393"><span class="hs-identifier hs-var">expr1'</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681093392"><span class="hs-identifier hs-var">expr2'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1131"></span><span>
</span><span id="line-1132"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcArithSeq"><span class="hs-identifier hs-var">tcArithSeq</span></a></span><span> </span><span id="local-6989586621681093389"><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcRn)
</span><a href="#local-6989586621681093389"><span class="hs-identifier hs-var">witness</span></a></span></span><span> </span><span id="local-6989586621681093388"><span class="annot"><span class="annottext">seq :: ArithSeqInfo GhcRn
</span><a href="#local-6989586621681093388"><span class="hs-identifier hs-var">seq</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#FromTo"><span class="hs-identifier hs-type">FromTo</span></a></span><span> </span><span id="local-6989586621681093386"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093386"><span class="hs-identifier hs-var">expr1</span></a></span></span><span> </span><span id="local-6989586621681093385"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093385"><span class="hs-identifier hs-var">expr2</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681093384"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093384"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-1133"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681093383"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681093383"><span class="hs-identifier hs-var">wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093382"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093382"><span class="hs-identifier hs-var">elt_mult</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093381"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093381"><span class="hs-identifier hs-var">elt_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093380"><span class="annot"><span class="annottext">Maybe SyntaxExprTc
</span><a href="#local-6989586621681093380"><span class="hs-identifier hs-var">wit'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcRn)
-&gt; ExpRhoType
-&gt; TcM (HsWrapper, TcType, TcType, Maybe (SyntaxExpr GhcTc))
</span><a href="GHC.Tc.Gen.Expr.html#arithSeqEltType"><span class="hs-identifier hs-var">arithSeqEltType</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcRn)
</span><a href="#local-6989586621681093389"><span class="hs-identifier hs-var">witness</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093384"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-1134"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681093379"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681093379"><span class="hs-identifier hs-var">expr1'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a. TcType -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-var">tcScalingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093382"><span class="hs-identifier hs-var">elt_mult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; TcType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExpr"><span class="hs-identifier hs-var">tcCheckPolyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093386"><span class="hs-identifier hs-var">expr1</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093381"><span class="hs-identifier hs-var">elt_ty</span></a></span><span>
</span><span id="line-1135"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681093378"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681093378"><span class="hs-identifier hs-var">expr2'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a. TcType -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-var">tcScalingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093382"><span class="hs-identifier hs-var">elt_mult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; TcType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExpr"><span class="hs-identifier hs-var">tcCheckPolyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093385"><span class="hs-identifier hs-var">expr2</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093381"><span class="hs-identifier hs-var">elt_ty</span></a></span><span>
</span><span id="line-1136"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681093377"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681093377"><span class="hs-identifier hs-var">enum_from_to</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; Name -&gt; [TcType] -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Utils.Instantiate.html#newMethodFromName"><span class="hs-identifier hs-var">newMethodFromName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArithSeqInfo GhcRn -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#ArithSeqOrigin"><span class="hs-identifier hs-var">ArithSeqOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">ArithSeqInfo GhcRn
</span><a href="#local-6989586621681093388"><span class="hs-identifier hs-var">seq</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1137"></span><span>                              </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#enumFromToName"><span class="hs-identifier hs-var">enumFromToName</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093381"><span class="hs-identifier hs-var">elt_ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1138"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc -&gt; TcM (HsExpr GhcTc))
-&gt; HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrap"><span class="hs-identifier hs-var">mkHsWrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681093383"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc -&gt; HsExpr GhcTc) -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1139"></span><span>         </span><span class="annot"><span class="annottext">XArithSeq GhcTc
-&gt; Maybe (SyntaxExpr GhcTc) -&gt; ArithSeqInfo GhcTc -&gt; HsExpr GhcTc
forall p.
XArithSeq p -&gt; Maybe (SyntaxExpr p) -&gt; ArithSeqInfo p -&gt; HsExpr p
</span><a href="GHC.Hs.Expr.html#ArithSeq"><span class="hs-identifier hs-var">ArithSeq</span></a></span><span> </span><span class="annot"><span class="annottext">XArithSeq GhcTc
HsExpr GhcTc
</span><a href="#local-6989586621681093377"><span class="hs-identifier hs-var">enum_from_to</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcTc)
Maybe SyntaxExprTc
</span><a href="#local-6989586621681093380"><span class="hs-identifier hs-var">wit'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsExpr GhcTc -&gt; LHsExpr GhcTc -&gt; ArithSeqInfo GhcTc
forall id. LHsExpr id -&gt; LHsExpr id -&gt; ArithSeqInfo id
</span><a href="GHC.Hs.Expr.html#FromTo"><span class="hs-identifier hs-var">FromTo</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681093379"><span class="hs-identifier hs-var">expr1'</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681093378"><span class="hs-identifier hs-var">expr2'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1140"></span><span>
</span><span id="line-1141"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcArithSeq"><span class="hs-identifier hs-var">tcArithSeq</span></a></span><span> </span><span id="local-6989586621681093375"><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcRn)
</span><a href="#local-6989586621681093375"><span class="hs-identifier hs-var">witness</span></a></span></span><span> </span><span id="local-6989586621681093374"><span class="annot"><span class="annottext">seq :: ArithSeqInfo GhcRn
</span><a href="#local-6989586621681093374"><span class="hs-identifier hs-var">seq</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#FromThenTo"><span class="hs-identifier hs-type">FromThenTo</span></a></span><span> </span><span id="local-6989586621681093372"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093372"><span class="hs-identifier hs-var">expr1</span></a></span></span><span> </span><span id="local-6989586621681093371"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093371"><span class="hs-identifier hs-var">expr2</span></a></span></span><span> </span><span id="local-6989586621681093370"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093370"><span class="hs-identifier hs-var">expr3</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681093369"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093369"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-1142"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681093368"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681093368"><span class="hs-identifier hs-var">wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093367"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093367"><span class="hs-identifier hs-var">elt_mult</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093366"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093366"><span class="hs-identifier hs-var">elt_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093365"><span class="annot"><span class="annottext">Maybe SyntaxExprTc
</span><a href="#local-6989586621681093365"><span class="hs-identifier hs-var">wit'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcRn)
-&gt; ExpRhoType
-&gt; TcM (HsWrapper, TcType, TcType, Maybe (SyntaxExpr GhcTc))
</span><a href="GHC.Tc.Gen.Expr.html#arithSeqEltType"><span class="hs-identifier hs-var">arithSeqEltType</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcRn)
</span><a href="#local-6989586621681093375"><span class="hs-identifier hs-var">witness</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093369"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-1143"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681093364"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681093364"><span class="hs-identifier hs-var">expr1'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a. TcType -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-var">tcScalingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093367"><span class="hs-identifier hs-var">elt_mult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; TcType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExpr"><span class="hs-identifier hs-var">tcCheckPolyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093372"><span class="hs-identifier hs-var">expr1</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093366"><span class="hs-identifier hs-var">elt_ty</span></a></span><span>
</span><span id="line-1144"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681093363"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681093363"><span class="hs-identifier hs-var">expr2'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a. TcType -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-var">tcScalingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093367"><span class="hs-identifier hs-var">elt_mult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; TcType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExpr"><span class="hs-identifier hs-var">tcCheckPolyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093371"><span class="hs-identifier hs-var">expr2</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093366"><span class="hs-identifier hs-var">elt_ty</span></a></span><span>
</span><span id="line-1145"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681093362"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681093362"><span class="hs-identifier hs-var">expr3'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a. TcType -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-var">tcScalingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093367"><span class="hs-identifier hs-var">elt_mult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; TcType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExpr"><span class="hs-identifier hs-var">tcCheckPolyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093370"><span class="hs-identifier hs-var">expr3</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093366"><span class="hs-identifier hs-var">elt_ty</span></a></span><span>
</span><span id="line-1146"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681093361"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681093361"><span class="hs-identifier hs-var">eft</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; Name -&gt; [TcType] -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Utils.Instantiate.html#newMethodFromName"><span class="hs-identifier hs-var">newMethodFromName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ArithSeqInfo GhcRn -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#ArithSeqOrigin"><span class="hs-identifier hs-var">ArithSeqOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">ArithSeqInfo GhcRn
</span><a href="#local-6989586621681093374"><span class="hs-identifier hs-var">seq</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1147"></span><span>                              </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#enumFromThenToName"><span class="hs-identifier hs-var">enumFromThenToName</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093366"><span class="hs-identifier hs-var">elt_ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1148"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc -&gt; TcM (HsExpr GhcTc))
-&gt; HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrap"><span class="hs-identifier hs-var">mkHsWrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681093368"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc -&gt; HsExpr GhcTc) -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1149"></span><span>          </span><span class="annot"><span class="annottext">XArithSeq GhcTc
-&gt; Maybe (SyntaxExpr GhcTc) -&gt; ArithSeqInfo GhcTc -&gt; HsExpr GhcTc
forall p.
XArithSeq p -&gt; Maybe (SyntaxExpr p) -&gt; ArithSeqInfo p -&gt; HsExpr p
</span><a href="GHC.Hs.Expr.html#ArithSeq"><span class="hs-identifier hs-var">ArithSeq</span></a></span><span> </span><span class="annot"><span class="annottext">XArithSeq GhcTc
HsExpr GhcTc
</span><a href="#local-6989586621681093361"><span class="hs-identifier hs-var">eft</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcTc)
Maybe SyntaxExprTc
</span><a href="#local-6989586621681093365"><span class="hs-identifier hs-var">wit'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsExpr GhcTc
-&gt; LHsExpr GhcTc -&gt; LHsExpr GhcTc -&gt; ArithSeqInfo GhcTc
forall id.
LHsExpr id -&gt; LHsExpr id -&gt; LHsExpr id -&gt; ArithSeqInfo id
</span><a href="GHC.Hs.Expr.html#FromThenTo"><span class="hs-identifier hs-var">FromThenTo</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681093364"><span class="hs-identifier hs-var">expr1'</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681093363"><span class="hs-identifier hs-var">expr2'</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681093362"><span class="hs-identifier hs-var">expr3'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1150"></span><span>
</span><span id="line-1151"></span><span class="hs-comment">-----------------</span><span>
</span><span id="line-1152"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#arithSeqEltType"><span class="hs-identifier hs-type">arithSeqEltType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#SyntaxExpr"><span class="hs-identifier hs-type">SyntaxExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span>
</span><span id="line-1153"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Mult"><span class="hs-identifier hs-type">Mult</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#SyntaxExpr"><span class="hs-identifier hs-type">SyntaxExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1154"></span><span id="arithSeqEltType"><span class="annot"><span class="annottext">arithSeqEltType :: Maybe (SyntaxExpr GhcRn)
-&gt; ExpRhoType
-&gt; TcM (HsWrapper, TcType, TcType, Maybe (SyntaxExpr GhcTc))
</span><a href="GHC.Tc.Gen.Expr.html#arithSeqEltType"><span class="hs-identifier hs-var hs-var">arithSeqEltType</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe (SyntaxExpr GhcRn)
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span id="local-6989586621681093358"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093358"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-1155"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681093357"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093357"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpRhoType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#expTypeToType"><span class="hs-identifier hs-var">expTypeToType</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093358"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-1156"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681093356"><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621681093356"><span class="hs-identifier hs-var">coi</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093355"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093355"><span class="hs-identifier hs-var">elt_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcM (TcCoercionR, TcType)
</span><a href="GHC.Tc.Utils.Unify.html#matchExpectedListTy"><span class="hs-identifier hs-var">matchExpectedListTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093357"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-1157"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(HsWrapper, TcType, TcType, Maybe SyntaxExprTc)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (HsWrapper, TcType, TcType, Maybe SyntaxExprTc)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcCoercionR -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#mkWpCastN"><span class="hs-identifier hs-var">mkWpCastN</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621681093356"><span class="hs-identifier hs-var">coi</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="GHC.Core.Type.html#One"><span class="hs-identifier hs-var">One</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093355"><span class="hs-identifier hs-var">elt_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe SyntaxExprTc
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1158"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#arithSeqEltType"><span class="hs-identifier hs-var">arithSeqEltType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681093352"><span class="annot"><span class="annottext">SyntaxExpr GhcRn
</span><a href="#local-6989586621681093352"><span class="hs-identifier hs-var">fl</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681093351"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093351"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-1159"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621681093350"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093350"><span class="hs-identifier hs-var">elt_mult</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093349"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093349"><span class="hs-identifier hs-var">elt_ty</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093348"><span class="annot"><span class="annottext">SyntaxExprTc
</span><a href="#local-6989586621681093348"><span class="hs-identifier hs-var">fl'</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1160"></span><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin
-&gt; SyntaxExprRn
-&gt; [SyntaxOpType]
-&gt; ExpRhoType
-&gt; ([TcType] -&gt; [TcType] -&gt; TcM (TcType, TcType))
-&gt; TcM ((TcType, TcType), SyntaxExprTc)
forall a.
CtOrigin
-&gt; SyntaxExprRn
-&gt; [SyntaxOpType]
-&gt; ExpRhoType
-&gt; ([TcType] -&gt; [TcType] -&gt; TcM a)
-&gt; TcM (a, SyntaxExprTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOp"><span class="hs-identifier hs-var">tcSyntaxOp</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#ListOrigin"><span class="hs-identifier hs-var">ListOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxExpr GhcRn
SyntaxExprRn
</span><a href="#local-6989586621681093352"><span class="hs-identifier hs-var">fl</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="GHC.Tc.Utils.TcType.html#SynList"><span class="hs-identifier hs-var">SynList</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093351"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">(([TcType] -&gt; [TcType] -&gt; TcM (TcType, TcType))
 -&gt; TcM ((TcType, TcType), SyntaxExprTc))
-&gt; ([TcType] -&gt; [TcType] -&gt; TcM (TcType, TcType))
-&gt; TcM ((TcType, TcType), SyntaxExprTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1161"></span><span>              </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">[</span><span id="local-6989586621681093347"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093347"><span class="hs-identifier hs-var">elt_ty</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span id="local-6989586621681093346"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093346"><span class="hs-identifier hs-var">elt_mult</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(TcType, TcType) -&gt; TcM (TcType, TcType)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093346"><span class="hs-identifier hs-var">elt_mult</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093347"><span class="hs-identifier hs-var">elt_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1162"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(HsWrapper, TcType, TcType, Maybe SyntaxExprTc)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (HsWrapper, TcType, TcType, Maybe SyntaxExprTc)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#idHsWrapper"><span class="hs-identifier hs-var">idHsWrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093350"><span class="hs-identifier hs-var">elt_mult</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093349"><span class="hs-identifier hs-var">elt_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SyntaxExprTc -&gt; Maybe SyntaxExprTc
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxExprTc
</span><a href="#local-6989586621681093348"><span class="hs-identifier hs-var">fl'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1163"></span><span>
</span><span id="line-1164"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                Applications
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-1171"></span><span>
</span><span id="line-1172"></span><span class="hs-comment">{- Note [Typechecking applications]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We typecheck application chains (f e1 @ty e2) specially:

* So we can report errors like &quot;in the third arument of a call of f&quot;

* So we can do Visible Type Application (VTA), for which we must not
  eagerly instantiate the function part of the application.

* So that we can do Quick Look impredicativity.

The idea is:

* Use collectHsArgs, which peels off
     HsApp, HsTypeApp, HsPrag, HsPar
  returning the function in the corner and the arguments

* Use tcInferAppHead to infer the type of the fuction,
    as an (uninstantiated) TcSigmaType
  There are special cases for
     HsVar, HsREcFld, and ExprWithTySig
  Otherwise, delegate back to tcExpr, which
    infers an (instantiated) TcRhoType

Some cases that /won't/ work:

1. Consider this (which uses visible type application):

    (let { f :: forall a. a -&gt; a; f x = x } in f) @Int

   Since 'let' is not among the special cases for tcInferAppHead,
   we'll delegate back to tcExpr, which will instantiate f's type
   and the type application to @Int will fail.  Too bad!

-}</span><span>
</span><span id="line-1207"></span><span>
</span><span id="line-1208"></span><span class="hs-comment">-- HsExprArg is a very local type, used only within this module.</span><span>
</span><span id="line-1209"></span><span class="hs-comment">-- It's really a zipper for an application chain</span><span>
</span><span id="line-1210"></span><span class="hs-comment">-- It's a GHC-specific type, so using TTG only where necessary</span><span>
</span><span id="line-1211"></span><span class="hs-keyword">data</span><span> </span><span id="HsExprArg"><span class="annot"><a href="GHC.Tc.Gen.Expr.html#HsExprArg"><span class="hs-identifier hs-var">HsExprArg</span></a></span></span><span> </span><span id="local-6989586621681094897"><span class="annot"><a href="#local-6989586621681094897"><span class="hs-identifier hs-type">id</span></a></span></span><span>
</span><span id="line-1212"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="HsEValArg"><span class="annot"><a href="GHC.Tc.Gen.Expr.html#HsEValArg"><span class="hs-identifier hs-var">HsEValArg</span></a></span></span><span>  </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span>        </span><span class="hs-comment">-- Of the function</span><span>
</span><span id="line-1213"></span><span>               </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPass"><span class="hs-identifier hs-type">GhcPass</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681094897"><span class="hs-identifier hs-type">id</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1214"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="HsETypeArg"><span class="annot"><a href="GHC.Tc.Gen.Expr.html#HsETypeArg"><span class="hs-identifier hs-var">HsETypeArg</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span>        </span><span class="hs-comment">-- Of the function</span><span>
</span><span id="line-1215"></span><span>               </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Type.html#LHsWcType"><span class="hs-identifier hs-type">LHsWcType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Extension.html#NoGhcTc"><span class="hs-identifier hs-type">NoGhcTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPass"><span class="hs-identifier hs-type">GhcPass</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681094897"><span class="hs-identifier hs-type">id</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1216"></span><span>               </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#XExprTypeArg"><span class="hs-identifier hs-type">XExprTypeArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681094897"><span class="hs-identifier hs-type">id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1217"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="HsEPrag"><span class="annot"><a href="GHC.Tc.Gen.Expr.html#HsEPrag"><span class="hs-identifier hs-var">HsEPrag</span></a></span></span><span>    </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span>
</span><span id="line-1218"></span><span>               </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsPragE"><span class="hs-identifier hs-type">HsPragE</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPass"><span class="hs-identifier hs-type">GhcPass</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681094897"><span class="hs-identifier hs-type">id</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1219"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="HsEPar"><span class="annot"><a href="GHC.Tc.Gen.Expr.html#HsEPar"><span class="hs-identifier hs-var">HsEPar</span></a></span></span><span>     </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span>         </span><span class="hs-comment">-- Of the nested expr</span><span>
</span><span id="line-1220"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span id="HsEWrap"><span class="annot"><a href="GHC.Tc.Gen.Expr.html#HsEWrap"><span class="hs-identifier hs-var">HsEWrap</span></a></span></span><span>    </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#XArgWrap"><span class="hs-identifier hs-type">XArgWrap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681094897"><span class="hs-identifier hs-type">id</span></a></span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- Wrapper, after typechecking only</span><span>
</span><span id="line-1221"></span><span>
</span><span id="line-1222"></span><span class="hs-comment">-- The outer location is the location of the application itself</span><span>
</span><span id="line-1223"></span><span class="hs-keyword">type</span><span> </span><span id="LHsExprArgIn"><span class="annot"><a href="GHC.Tc.Gen.Expr.html#LHsExprArgIn"><span class="hs-identifier hs-var">LHsExprArgIn</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#HsExprArg"><span class="hs-identifier hs-type">HsExprArg</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Hs.Extension.html#Renamed"><span class="hs-identifier hs-type">Renamed</span></a></span><span>
</span><span id="line-1224"></span><span class="hs-keyword">type</span><span> </span><span id="LHsExprArgOut"><span class="annot"><a href="GHC.Tc.Gen.Expr.html#LHsExprArgOut"><span class="hs-identifier hs-var">LHsExprArgOut</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#HsExprArg"><span class="hs-identifier hs-type">HsExprArg</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Hs.Extension.html#Typechecked"><span class="hs-identifier hs-type">Typechecked</span></a></span><span>
</span><span id="line-1225"></span><span>
</span><span id="line-1226"></span><span id="local-6989586621681094904"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681093338"><span class="annot"><a href="GHC.Hs.Extension.html#OutputableBndrId"><span class="hs-identifier hs-type">OutputableBndrId</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681094904"><span class="hs-identifier hs-type">id</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#Outputable"><span class="hs-identifier hs-type">Outputable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#HsExprArg"><span class="hs-identifier hs-type">HsExprArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681094904"><span class="hs-identifier hs-type">id</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1227"></span><span>  </span><span id="local-6989586621681093325"><span class="annot"><span class="annottext">ppr :: HsExprArg id -&gt; SDoc
</span><a href="#local-6989586621681093325"><span class="hs-identifier hs-var hs-var hs-var hs-var">ppr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#HsEValArg"><span class="hs-identifier hs-type">HsEValArg</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681093324"><span class="annot"><span class="annottext">LHsExpr (GhcPass id)
</span><a href="#local-6989586621681093324"><span class="hs-identifier hs-var">tm</span></a></span></span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass id) -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr (GhcPass id)
</span><a href="#local-6989586621681093324"><span class="hs-identifier hs-var">tm</span></a></span><span>
</span><span id="line-1228"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#HsEPrag"><span class="hs-identifier hs-type">HsEPrag</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681093323"><span class="annot"><span class="annottext">HsPragE (GhcPass id)
</span><a href="#local-6989586621681093323"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;HsPrag&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HsPragE (GhcPass id) -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsPragE (GhcPass id)
</span><a href="#local-6989586621681093323"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-1229"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#HsETypeArg"><span class="hs-identifier hs-type">HsETypeArg</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681093322"><span class="annot"><span class="annottext">LHsWcType (NoGhcTc (GhcPass id))
</span><a href="#local-6989586621681093322"><span class="hs-identifier hs-var">hs_ty</span></a></span></span><span> </span><span class="annot"><span class="annottext">XExprTypeArg id
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Char -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'@'</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">LHsWcType (GhcPass (NoGhcTcPass id)) -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsWcType (GhcPass (NoGhcTcPass id))
LHsWcType (NoGhcTc (GhcPass id))
</span><a href="#local-6989586621681093322"><span class="hs-identifier hs-var">hs_ty</span></a></span><span>
</span><span id="line-1230"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#HsEPar"><span class="hs-identifier hs-type">HsEPar</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;HsEPar&quot;</span></span><span>
</span><span id="line-1231"></span><span>  </span><span class="annot"><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#HsEWrap"><span class="hs-identifier hs-type">HsEWrap</span></a></span><span> </span><span id="local-6989586621681093319"><span class="annot"><span class="annottext">XArgWrap id
</span><a href="#local-6989586621681093319"><span class="hs-identifier hs-var">w</span></a></span></span><span class="hs-special">)</span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">forall (p :: Pass). IsPass p =&gt; GhcPass p
</span><a href="GHC.Hs.Extension.html#ghcPass"><span class="hs-identifier hs-var">ghcPass</span></a></span><span> </span><span class="hs-glyph">@</span><span class="annot"><a href="#local-6989586621681094904"><span class="hs-identifier hs-type">id</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1232"></span><span>                                    </span><span class="annot"><span class="annottext">GhcPass id
</span><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-var">GhcTc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;HsEWrap&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
XArgWrap id
</span><a href="#local-6989586621681093319"><span class="hs-identifier hs-var">w</span></a></span><span>
</span><span id="line-1233"></span><span>                                    </span><span class="annot"><span class="annottext">GhcPass id
</span><span class="hs-identifier">_</span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span></span><span>
</span><span id="line-1234"></span><span>
</span><span id="line-1235"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="XExprTypeArg"><span class="annot"><a href="GHC.Tc.Gen.Expr.html#XExprTypeArg"><span class="hs-identifier hs-var">XExprTypeArg</span></a></span></span><span> </span><span id="local-6989586621681093312"><span class="annot"><a href="#local-6989586621681093312"><span class="hs-identifier hs-type">id</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1236"></span><span>  </span><span id="XExprTypeArg"><span class="annot"><a href="GHC.Tc.Gen.Expr.html#XExprTypeArg"><span class="hs-identifier hs-var">XExprTypeArg</span></a></span></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Hs.Extension.html#Parsed"><span class="hs-identifier hs-type">Parsed</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#NoExtField"><span class="hs-identifier hs-type">NoExtField</span></a></span><span>
</span><span id="line-1237"></span><span>  </span><span id="XExprTypeArg"><span class="annot"><a href="GHC.Tc.Gen.Expr.html#XExprTypeArg"><span class="hs-identifier hs-var">XExprTypeArg</span></a></span></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Hs.Extension.html#Renamed"><span class="hs-identifier hs-type">Renamed</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#NoExtField"><span class="hs-identifier hs-type">NoExtField</span></a></span><span>
</span><span id="line-1238"></span><span>  </span><span id="XExprTypeArg"><span class="annot"><a href="GHC.Tc.Gen.Expr.html#XExprTypeArg"><span class="hs-identifier hs-var">XExprTypeArg</span></a></span></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Hs.Extension.html#Typechecked"><span class="hs-identifier hs-type">Typechecked</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-1239"></span><span>
</span><span id="line-1240"></span><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span id="XArgWrap"><span class="annot"><a href="GHC.Tc.Gen.Expr.html#XArgWrap"><span class="hs-identifier hs-var">XArgWrap</span></a></span></span><span> </span><span id="local-6989586621681093309"><span class="annot"><a href="#local-6989586621681093309"><span class="hs-identifier hs-type">id</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1241"></span><span>  </span><span id="XArgWrap"><span class="annot"><a href="GHC.Tc.Gen.Expr.html#XArgWrap"><span class="hs-identifier hs-var">XArgWrap</span></a></span></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Hs.Extension.html#Parsed"><span class="hs-identifier hs-type">Parsed</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#NoExtCon"><span class="hs-identifier hs-type">NoExtCon</span></a></span><span>
</span><span id="line-1242"></span><span>  </span><span id="XArgWrap"><span class="annot"><a href="GHC.Tc.Gen.Expr.html#XArgWrap"><span class="hs-identifier hs-var">XArgWrap</span></a></span></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Hs.Extension.html#Renamed"><span class="hs-identifier hs-type">Renamed</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#NoExtCon"><span class="hs-identifier hs-type">NoExtCon</span></a></span><span>
</span><span id="line-1243"></span><span>  </span><span id="XArgWrap"><span class="annot"><a href="GHC.Tc.Gen.Expr.html#XArgWrap"><span class="hs-identifier hs-var">XArgWrap</span></a></span></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Hs.Extension.html#Typechecked"><span class="hs-identifier hs-type">Typechecked</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span>
</span><span id="line-1244"></span><span>
</span><span id="line-1245"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#addArgWrap"><span class="hs-identifier hs-type">addArgWrap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#LHsExprArgOut"><span class="hs-identifier hs-type">LHsExprArgOut</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#LHsExprArgOut"><span class="hs-identifier hs-type">LHsExprArgOut</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1246"></span><span id="addArgWrap"><span class="annot"><span class="annottext">addArgWrap :: HsWrapper -&gt; [LHsExprArgOut] -&gt; [LHsExprArgOut]
</span><a href="GHC.Tc.Gen.Expr.html#addArgWrap"><span class="hs-identifier hs-var hs-var">addArgWrap</span></a></span></span><span> </span><span id="local-6989586621681093306"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681093306"><span class="hs-identifier hs-var">wrap</span></a></span></span><span> </span><span id="local-6989586621681093305"><span class="annot"><span class="annottext">[LHsExprArgOut]
</span><a href="#local-6989586621681093305"><span class="hs-identifier hs-var">args</span></a></span></span><span>
</span><span id="line-1247"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; Bool
</span><a href="GHC.Tc.Types.Evidence.html#isIdHsWrapper"><span class="hs-identifier hs-var">isIdHsWrapper</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681093306"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[LHsExprArgOut]
</span><a href="#local-6989586621681093305"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1248"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">XArgWrap 'Typechecked -&gt; LHsExprArgOut
forall (id :: Pass). XArgWrap id -&gt; HsExprArg id
</span><a href="GHC.Tc.Gen.Expr.html#HsEWrap"><span class="hs-identifier hs-var">HsEWrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
XArgWrap 'Typechecked
</span><a href="#local-6989586621681093306"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExprArgOut -&gt; [LHsExprArgOut] -&gt; [LHsExprArgOut]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[LHsExprArgOut]
</span><a href="#local-6989586621681093305"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1249"></span><span>
</span><span id="line-1250"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#collectHsArgs"><span class="hs-identifier hs-type">collectHsArgs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#LHsExprArgIn"><span class="hs-identifier hs-type">LHsExprArgIn</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1251"></span><span id="collectHsArgs"><span class="annot"><span class="annottext">collectHsArgs :: HsExpr GhcRn -&gt; (HsExpr GhcRn, [LHsExprArgIn])
</span><a href="GHC.Tc.Gen.Expr.html#collectHsArgs"><span class="hs-identifier hs-var hs-var">collectHsArgs</span></a></span></span><span> </span><span id="local-6989586621681093302"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681093302"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; [LHsExprArgIn] -&gt; (HsExpr GhcRn, [LHsExprArgIn])
forall {id :: Pass}.
(XExprTypeArg id ~ NoExtField) =&gt;
HsExpr (GhcPass id)
-&gt; [HsExprArg id] -&gt; (HsExpr (GhcPass id), [HsExprArg id])
</span><a href="#local-6989586621681093301"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681093302"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1252"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1253"></span><span>    </span><span id="local-6989586621681093301"><span class="annot"><span class="annottext">go :: HsExpr (GhcPass id)
-&gt; [HsExprArg id] -&gt; (HsExpr (GhcPass id), [HsExprArg id])
</span><a href="#local-6989586621681093301"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsPar"><span class="hs-identifier hs-type">HsPar</span></a></span><span> </span><span class="annot"><span class="annottext">XPar (GhcPass id)
</span><span class="hs-identifier">_</span></span><span>     </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681093296"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681093296"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621681093295"><span class="annot"><span class="annottext">HsExpr (GhcPass id)
</span><a href="#local-6989586621681093295"><span class="hs-identifier hs-var">fun</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>       </span><span id="local-6989586621681093294"><span class="annot"><span class="annottext">[HsExprArg id]
</span><a href="#local-6989586621681093294"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass id)
-&gt; [HsExprArg id] -&gt; (HsExpr (GhcPass id), [HsExprArg id])
</span><a href="#local-6989586621681093301"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass id)
</span><a href="#local-6989586621681093295"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; HsExprArg id
forall (id :: Pass). SrcSpan -&gt; HsExprArg id
</span><a href="GHC.Tc.Gen.Expr.html#HsEPar"><span class="hs-identifier hs-var">HsEPar</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681093296"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">HsExprArg id -&gt; [HsExprArg id] -&gt; [HsExprArg id]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[HsExprArg id]
</span><a href="#local-6989586621681093294"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1254"></span><span>    </span><span class="annot"><a href="#local-6989586621681093301"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsPragE"><span class="hs-identifier hs-type">HsPragE</span></a></span><span> </span><span class="annot"><span class="annottext">XPragE (GhcPass id)
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681093293"><span class="annot"><span class="annottext">HsPragE (GhcPass id)
</span><a href="#local-6989586621681093293"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681093292"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681093292"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621681093291"><span class="annot"><span class="annottext">HsExpr (GhcPass id)
</span><a href="#local-6989586621681093291"><span class="hs-identifier hs-var">fun</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>       </span><span id="local-6989586621681093290"><span class="annot"><span class="annottext">[HsExprArg id]
</span><a href="#local-6989586621681093290"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass id)
-&gt; [HsExprArg id] -&gt; (HsExpr (GhcPass id), [HsExprArg id])
</span><a href="#local-6989586621681093301"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass id)
</span><a href="#local-6989586621681093291"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; HsPragE (GhcPass id) -&gt; HsExprArg id
forall (id :: Pass).
SrcSpan -&gt; HsPragE (GhcPass id) -&gt; HsExprArg id
</span><a href="GHC.Tc.Gen.Expr.html#HsEPrag"><span class="hs-identifier hs-var">HsEPrag</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681093292"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">HsPragE (GhcPass id)
</span><a href="#local-6989586621681093293"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">HsExprArg id -&gt; [HsExprArg id] -&gt; [HsExprArg id]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[HsExprArg id]
</span><a href="#local-6989586621681093290"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1255"></span><span>    </span><span class="annot"><a href="#local-6989586621681093301"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsApp"><span class="hs-identifier hs-type">HsApp</span></a></span><span> </span><span class="annot"><span class="annottext">XApp (GhcPass id)
</span><span class="hs-identifier">_</span></span><span>     </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681093289"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681093289"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621681093288"><span class="annot"><span class="annottext">HsExpr (GhcPass id)
</span><a href="#local-6989586621681093288"><span class="hs-identifier hs-var">fun</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681093287"><span class="annot"><span class="annottext">GenLocated SrcSpan (HsExpr (GhcPass id))
</span><a href="#local-6989586621681093287"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">)</span><span>   </span><span id="local-6989586621681093286"><span class="annot"><span class="annottext">[HsExprArg id]
</span><a href="#local-6989586621681093286"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass id)
-&gt; [HsExprArg id] -&gt; (HsExpr (GhcPass id), [HsExprArg id])
</span><a href="#local-6989586621681093301"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass id)
</span><a href="#local-6989586621681093288"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; GenLocated SrcSpan (HsExpr (GhcPass id)) -&gt; HsExprArg id
forall (id :: Pass).
SrcSpan -&gt; LHsExpr (GhcPass id) -&gt; HsExprArg id
</span><a href="GHC.Tc.Gen.Expr.html#HsEValArg"><span class="hs-identifier hs-var">HsEValArg</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681093289"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpan (HsExpr (GhcPass id))
</span><a href="#local-6989586621681093287"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="annot"><span class="annottext">HsExprArg id -&gt; [HsExprArg id] -&gt; [HsExprArg id]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[HsExprArg id]
</span><a href="#local-6989586621681093286"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1256"></span><span>    </span><span class="annot"><a href="#local-6989586621681093301"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsAppType"><span class="hs-identifier hs-type">HsAppType</span></a></span><span> </span><span class="annot"><span class="annottext">XAppTypeE (GhcPass id)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681093285"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681093285"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621681093284"><span class="annot"><span class="annottext">HsExpr (GhcPass id)
</span><a href="#local-6989586621681093284"><span class="hs-identifier hs-var">fun</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681093283"><span class="annot"><span class="annottext">LHsWcType (NoGhcTc (GhcPass id))
</span><a href="#local-6989586621681093283"><span class="hs-identifier hs-var">hs_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681093282"><span class="annot"><span class="annottext">[HsExprArg id]
</span><a href="#local-6989586621681093282"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass id)
-&gt; [HsExprArg id] -&gt; (HsExpr (GhcPass id), [HsExprArg id])
</span><a href="#local-6989586621681093301"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr (GhcPass id)
</span><a href="#local-6989586621681093284"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan
-&gt; LHsWcType (NoGhcTc (GhcPass id))
-&gt; XExprTypeArg id
-&gt; HsExprArg id
forall (id :: Pass).
SrcSpan
-&gt; LHsWcType (NoGhcTc (GhcPass id))
-&gt; XExprTypeArg id
-&gt; HsExprArg id
</span><a href="GHC.Tc.Gen.Expr.html#HsETypeArg"><span class="hs-identifier hs-var">HsETypeArg</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681093285"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">LHsWcType (NoGhcTc (GhcPass id))
</span><a href="#local-6989586621681093283"><span class="hs-identifier hs-var">hs_ty</span></a></span><span> </span><span class="annot"><span class="annottext">NoExtField
XExprTypeArg id
</span><a href="GHC.Hs.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="annot"><span class="annottext">HsExprArg id -&gt; [HsExprArg id] -&gt; [HsExprArg id]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[HsExprArg id]
</span><a href="#local-6989586621681093282"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1257"></span><span>    </span><span class="annot"><a href="#local-6989586621681093301"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681093281"><span class="annot"><span class="annottext">HsExpr (GhcPass id)
</span><a href="#local-6989586621681093281"><span class="hs-identifier hs-var">e</span></a></span></span><span>                             </span><span id="local-6989586621681093280"><span class="annot"><span class="annottext">[HsExprArg id]
</span><a href="#local-6989586621681093280"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr (GhcPass id)
</span><a href="#local-6989586621681093281"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[HsExprArg id]
</span><a href="#local-6989586621681093280"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1258"></span><span>
</span><span id="line-1259"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#applyHsArgs"><span class="hs-identifier hs-type">applyHsArgs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#LHsExprArgOut"><span class="hs-identifier hs-type">LHsExprArgOut</span></a></span><span class="hs-special">]</span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span>
</span><span id="line-1260"></span><span id="applyHsArgs"><span class="annot"><span class="annottext">applyHsArgs :: HsExpr GhcTc -&gt; [LHsExprArgOut] -&gt; HsExpr GhcTc
</span><a href="GHC.Tc.Gen.Expr.html#applyHsArgs"><span class="hs-identifier hs-var hs-var">applyHsArgs</span></a></span></span><span> </span><span id="local-6989586621681093279"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681093279"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span id="local-6989586621681093278"><span class="annot"><span class="annottext">[LHsExprArgOut]
</span><a href="#local-6989586621681093278"><span class="hs-identifier hs-var">args</span></a></span></span><span>
</span><span id="line-1261"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; [LHsExprArgOut] -&gt; HsExpr GhcTc
</span><a href="#local-6989586621681093277"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681093279"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsExprArgOut]
</span><a href="#local-6989586621681093278"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1262"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1263"></span><span>    </span><span id="local-6989586621681093277"><span class="annot"><span class="annottext">go :: HsExpr GhcTc -&gt; [LHsExprArgOut] -&gt; HsExpr GhcTc
</span><a href="#local-6989586621681093277"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621681093276"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681093276"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681093276"><span class="hs-identifier hs-var">fun</span></a></span><span>
</span><span id="line-1264"></span><span>    </span><span class="annot"><a href="#local-6989586621681093277"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681093275"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681093275"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#HsEWrap"><span class="hs-identifier hs-type">HsEWrap</span></a></span><span> </span><span id="local-6989586621681093274"><span class="annot"><span class="annottext">XArgWrap 'Typechecked
</span><a href="#local-6989586621681093274"><span class="hs-identifier hs-var">wrap</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681093273"><span class="annot"><span class="annottext">[LHsExprArgOut]
</span><a href="#local-6989586621681093273"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; [LHsExprArgOut] -&gt; HsExpr GhcTc
</span><a href="#local-6989586621681093277"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrap"><span class="hs-identifier hs-var">mkHsWrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
XArgWrap 'Typechecked
</span><a href="#local-6989586621681093274"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681093275"><span class="hs-identifier hs-var">fun</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LHsExprArgOut]
</span><a href="#local-6989586621681093273"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1265"></span><span>    </span><span class="annot"><a href="#local-6989586621681093277"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681093272"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681093272"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#HsEValArg"><span class="hs-identifier hs-type">HsEValArg</span></a></span><span> </span><span id="local-6989586621681093271"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681093271"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621681093270"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681093270"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681093269"><span class="annot"><span class="annottext">[LHsExprArgOut]
</span><a href="#local-6989586621681093269"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; [LHsExprArgOut] -&gt; HsExpr GhcTc
</span><a href="#local-6989586621681093277"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XApp GhcTc -&gt; LHsExpr GhcTc -&gt; LHsExpr GhcTc -&gt; HsExpr GhcTc
forall p. XApp p -&gt; LHsExpr p -&gt; LHsExpr p -&gt; HsExpr p
</span><a href="GHC.Hs.Expr.html#HsApp"><span class="hs-identifier hs-var">HsApp</span></a></span><span> </span><span class="annot"><span class="annottext">NoExtField
XApp GhcTc
</span><a href="GHC.Hs.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; HsExpr GhcTc -&gt; LHsExpr GhcTc
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681093271"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681093272"><span class="hs-identifier hs-var">fun</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681093270"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LHsExprArgOut]
</span><a href="#local-6989586621681093269"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1266"></span><span>    </span><span class="annot"><a href="#local-6989586621681093277"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681093268"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681093268"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#HsETypeArg"><span class="hs-identifier hs-type">HsETypeArg</span></a></span><span> </span><span id="local-6989586621681093267"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681093267"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621681093266"><span class="annot"><span class="annottext">LHsWcType (NoGhcTc GhcTc)
</span><a href="#local-6989586621681093266"><span class="hs-identifier hs-var">hs_ty</span></a></span></span><span> </span><span id="local-6989586621681093265"><span class="annot"><span class="annottext">XExprTypeArg 'Typechecked
</span><a href="#local-6989586621681093265"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681093264"><span class="annot"><span class="annottext">[LHsExprArgOut]
</span><a href="#local-6989586621681093264"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; [LHsExprArgOut] -&gt; HsExpr GhcTc
</span><a href="#local-6989586621681093277"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XAppTypeE GhcTc
-&gt; LHsExpr GhcTc -&gt; LHsWcType (NoGhcTc GhcTc) -&gt; HsExpr GhcTc
forall p.
XAppTypeE p -&gt; LHsExpr p -&gt; LHsWcType (NoGhcTc p) -&gt; HsExpr p
</span><a href="GHC.Hs.Expr.html#HsAppType"><span class="hs-identifier hs-var">HsAppType</span></a></span><span> </span><span class="annot"><span class="annottext">XAppTypeE GhcTc
XExprTypeArg 'Typechecked
</span><a href="#local-6989586621681093265"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; HsExpr GhcTc -&gt; LHsExpr GhcTc
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681093267"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681093268"><span class="hs-identifier hs-var">fun</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LHsWcType (NoGhcTc GhcTc)
</span><a href="#local-6989586621681093266"><span class="hs-identifier hs-var">hs_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LHsExprArgOut]
</span><a href="#local-6989586621681093264"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1267"></span><span>    </span><span class="annot"><a href="#local-6989586621681093277"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681093263"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681093263"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#HsEPar"><span class="hs-identifier hs-type">HsEPar</span></a></span><span> </span><span id="local-6989586621681093262"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681093262"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681093261"><span class="annot"><span class="annottext">[LHsExprArgOut]
</span><a href="#local-6989586621681093261"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; [LHsExprArgOut] -&gt; HsExpr GhcTc
</span><a href="#local-6989586621681093277"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XPar GhcTc -&gt; LHsExpr GhcTc -&gt; HsExpr GhcTc
forall p. XPar p -&gt; LHsExpr p -&gt; HsExpr p
</span><a href="GHC.Hs.Expr.html#HsPar"><span class="hs-identifier hs-var">HsPar</span></a></span><span> </span><span class="annot"><span class="annottext">NoExtField
XPar GhcTc
</span><a href="GHC.Hs.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; HsExpr GhcTc -&gt; LHsExpr GhcTc
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681093262"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681093263"><span class="hs-identifier hs-var">fun</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LHsExprArgOut]
</span><a href="#local-6989586621681093261"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1268"></span><span>    </span><span class="annot"><a href="#local-6989586621681093277"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681093260"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681093260"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#HsEPrag"><span class="hs-identifier hs-type">HsEPrag</span></a></span><span> </span><span id="local-6989586621681093259"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681093259"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621681093258"><span class="annot"><span class="annottext">HsPragE GhcTc
</span><a href="#local-6989586621681093258"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681093257"><span class="annot"><span class="annottext">[LHsExprArgOut]
</span><a href="#local-6989586621681093257"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; [LHsExprArgOut] -&gt; HsExpr GhcTc
</span><a href="#local-6989586621681093277"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XPragE GhcTc -&gt; HsPragE GhcTc -&gt; LHsExpr GhcTc -&gt; HsExpr GhcTc
forall p. XPragE p -&gt; HsPragE p -&gt; LHsExpr p -&gt; HsExpr p
</span><a href="GHC.Hs.Expr.html#HsPragE"><span class="hs-identifier hs-var">HsPragE</span></a></span><span> </span><span class="annot"><span class="annottext">NoExtField
XPragE GhcTc
</span><a href="GHC.Hs.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="annot"><span class="annottext">HsPragE GhcTc
</span><a href="#local-6989586621681093258"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; HsExpr GhcTc -&gt; LHsExpr GhcTc
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681093259"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681093260"><span class="hs-identifier hs-var">fun</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LHsExprArgOut]
</span><a href="#local-6989586621681093257"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1269"></span><span>
</span><span id="line-1270"></span><span id="local-6989586621681094894"><span class="annot"><a href="GHC.Tc.Gen.Expr.html#isHsValArg"><span class="hs-identifier hs-type">isHsValArg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#HsExprArg"><span class="hs-identifier hs-type">HsExprArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681094894"><span class="hs-identifier hs-type">id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-1271"></span><span id="isHsValArg"><span class="annot"><span class="annottext">isHsValArg :: forall (id :: Pass). HsExprArg id -&gt; Bool
</span><a href="GHC.Tc.Gen.Expr.html#isHsValArg"><span class="hs-identifier hs-var hs-var">isHsValArg</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#HsEValArg"><span class="hs-identifier hs-type">HsEValArg</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1272"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#isHsValArg"><span class="hs-identifier hs-var">isHsValArg</span></a></span><span> </span><span class="annot"><span class="annottext">HsExprArg id
</span><span class="hs-identifier">_</span></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1273"></span><span>
</span><span id="line-1274"></span><span id="local-6989586621681093255"><span class="annot"><a href="GHC.Tc.Gen.Expr.html#isArgPar"><span class="hs-identifier hs-type">isArgPar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#HsExprArg"><span class="hs-identifier hs-type">HsExprArg</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681093255"><span class="hs-identifier hs-type">id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-1275"></span><span id="isArgPar"><span class="annot"><span class="annottext">isArgPar :: forall (id :: Pass). HsExprArg id -&gt; Bool
</span><a href="GHC.Tc.Gen.Expr.html#isArgPar"><span class="hs-identifier hs-var hs-var">isArgPar</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#HsEPar"><span class="hs-identifier hs-type">HsEPar</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1276"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#isArgPar"><span class="hs-identifier hs-var">isArgPar</span></a></span><span> </span><span class="annot"><span class="annottext">HsExprArg id
</span><span class="hs-identifier">_</span></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1277"></span><span>
</span><span id="line-1278"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#getFunLoc"><span class="hs-identifier hs-type">getFunLoc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#HsExprArg"><span class="hs-identifier hs-type">HsExprArg</span></a></span><span> </span><span class="hs-special">'</span><span class="annot"><a href="GHC.Hs.Extension.html#Renamed"><span class="hs-identifier hs-type">Renamed</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span>
</span><span id="line-1279"></span><span id="getFunLoc"><span class="annot"><span class="annottext">getFunLoc :: [LHsExprArgIn] -&gt; Maybe SrcSpan
</span><a href="GHC.Tc.Gen.Expr.html#getFunLoc"><span class="hs-identifier hs-var hs-var">getFunLoc</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe SrcSpan
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1280"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#getFunLoc"><span class="hs-identifier hs-var">getFunLoc</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681093252"><span class="annot"><span class="annottext">LHsExprArgIn
</span><a href="#local-6989586621681093252"><span class="hs-identifier hs-var">a</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[LHsExprArgIn]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; Maybe SrcSpan
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(SrcSpan -&gt; Maybe SrcSpan) -&gt; SrcSpan -&gt; Maybe SrcSpan
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">LHsExprArgIn
</span><a href="#local-6989586621681093252"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1281"></span><span>                           </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#HsEValArg"><span class="hs-identifier hs-type">HsEValArg</span></a></span><span> </span><span id="local-6989586621681093251"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681093251"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><span class="hs-identifier">_</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681093251"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-1282"></span><span>                           </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#HsETypeArg"><span class="hs-identifier hs-type">HsETypeArg</span></a></span><span> </span><span id="local-6989586621681093250"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681093250"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="annot"><span class="annottext">LHsWcType (NoGhcTc GhcRn)
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">XExprTypeArg 'Renamed
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681093250"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-1283"></span><span>                           </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#HsEPrag"><span class="hs-identifier hs-type">HsEPrag</span></a></span><span> </span><span id="local-6989586621681093249"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681093249"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="annot"><span class="annottext">HsPragE GhcRn
</span><span class="hs-identifier">_</span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681093249"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-1284"></span><span>                           </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#HsEPar"><span class="hs-identifier hs-type">HsEPar</span></a></span><span> </span><span id="local-6989586621681093248"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681093248"><span class="hs-identifier hs-var">l</span></a></span></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681093248"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-1285"></span><span>
</span><span id="line-1286"></span><span class="hs-comment">---------------------------</span><span>
</span><span id="line-1287"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcApp"><span class="hs-identifier hs-type">tcApp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>  </span><span class="hs-comment">-- either HsApp or HsAppType</span><span>
</span><span id="line-1288"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1289"></span><span class="hs-comment">-- See Note [Typechecking applications]</span><span>
</span><span id="line-1290"></span><span id="tcApp"><span class="annot"><span class="annottext">tcApp :: HsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcApp"><span class="hs-identifier hs-var hs-var">tcApp</span></a></span></span><span> </span><span id="local-6989586621681093247"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681093247"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span id="local-6989586621681093246"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093246"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-1291"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681093245"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681093245"><span class="hs-identifier hs-var">fun</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093244"><span class="annot"><span class="annottext">[LHsExprArgOut]
</span><a href="#local-6989586621681093244"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093243"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093243"><span class="hs-identifier hs-var">app_res_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; TcM (HsExpr GhcTc, [LHsExprArgOut], TcType)
</span><a href="GHC.Tc.Gen.Expr.html#tcInferApp"><span class="hs-identifier hs-var">tcInferApp</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681093247"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-1292"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; Bool
</span><a href="GHC.Tc.Gen.Expr.html#isTagToEnum"><span class="hs-identifier hs-var">isTagToEnum</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681093245"><span class="hs-identifier hs-var">fun</span></a></span><span>
</span><span id="line-1293"></span><span>         </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
-&gt; HsExpr GhcTc
-&gt; [LHsExprArgOut]
-&gt; TcType
-&gt; ExpRhoType
-&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcTagToEnum"><span class="hs-identifier hs-var">tcTagToEnum</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681093247"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681093245"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsExprArgOut]
</span><a href="#local-6989586621681093244"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093243"><span class="hs-identifier hs-var">app_res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093246"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-1294"></span><span>              </span><span class="hs-comment">-- Done here because we have res_ty,</span><span>
</span><span id="line-1295"></span><span>              </span><span class="hs-comment">-- whereas tcInferApp does not</span><span>
</span><span id="line-1296"></span><span>         </span><span class="hs-keyword">else</span><span>
</span><span id="line-1297"></span><span>
</span><span id="line-1298"></span><span>    </span><span class="hs-comment">-- The wildly common case</span><span>
</span><span id="line-1299"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681093240"><span class="annot"><span class="annottext">expr' :: HsExpr GhcTc
</span><a href="#local-6989586621681093240"><span class="hs-identifier hs-var hs-var">expr'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; [LHsExprArgOut] -&gt; HsExpr GhcTc
</span><a href="GHC.Tc.Gen.Expr.html#applyHsArgs"><span class="hs-identifier hs-var">applyHsArgs</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681093245"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsExprArgOut]
</span><a href="#local-6989586621681093244"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1300"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; HsExpr GhcTc
-&gt; TcType
-&gt; ExpRhoType
-&gt; TcM (HsExpr GhcTc)
-&gt; TcM (HsExpr GhcTc)
forall a.
Bool -&gt; HsExpr GhcTc -&gt; TcType -&gt; ExpRhoType -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Gen.Expr.html#addFunResCtxt"><span class="hs-identifier hs-var">addFunResCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681093245"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093243"><span class="hs-identifier hs-var">app_res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093246"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (HsExpr GhcTc) -&gt; TcM (HsExpr GhcTc))
-&gt; TcM (HsExpr GhcTc) -&gt; TcM (HsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1301"></span><span>         </span><span class="annot"><span class="annottext">HsExpr GhcRn
-&gt; HsExpr GhcTc -&gt; TcType -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Utils.Unify.html#tcWrapResult"><span class="hs-identifier hs-var">tcWrapResult</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681093247"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681093240"><span class="hs-identifier hs-var">expr'</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093243"><span class="hs-identifier hs-var">app_res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093246"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1302"></span><span>
</span><span id="line-1303"></span><span class="hs-comment">---------------------------</span><span>
</span><span id="line-1304"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcInferApp"><span class="hs-identifier hs-type">tcInferApp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-1305"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span>    </span><span class="hs-comment">-- Function</span><span>
</span><span id="line-1306"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#LHsExprArgOut"><span class="hs-identifier hs-type">LHsExprArgOut</span></a></span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- Arguments</span><span>
</span><span id="line-1307"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span class="hs-special">)</span><span>     </span><span class="hs-comment">-- Inferred type: a sigma-type!</span><span>
</span><span id="line-1308"></span><span class="hs-comment">-- Also used by Module.tcRnExpr to implement GHCi :type</span><span>
</span><span id="line-1309"></span><span id="tcInferApp"><span class="annot"><span class="annottext">tcInferApp :: HsExpr GhcRn -&gt; TcM (HsExpr GhcTc, [LHsExprArgOut], TcType)
</span><a href="GHC.Tc.Gen.Expr.html#tcInferApp"><span class="hs-identifier hs-var hs-var">tcInferApp</span></a></span></span><span> </span><span id="local-6989586621681093238"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681093238"><span class="hs-identifier hs-var">expr</span></a></span></span><span>
</span><span id="line-1310"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-comment">-- Gruesome special case for ambiguous record selectors</span><span>
</span><span id="line-1311"></span><span>    </span><span class="annot"><a href="GHC.Hs.Expr.html#HsRecFld"><span class="hs-identifier hs-type">HsRecFld</span></a></span><span> </span><span class="annot"><span class="annottext">XRecFld GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681093237"><span class="annot"><span class="annottext">AmbiguousFieldOcc GhcRn
</span><a href="#local-6989586621681093237"><span class="hs-identifier hs-var">fld_lbl</span></a></span></span><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681093236"><span class="hs-identifier hs-var">fun</span></a></span><span>
</span><span id="line-1312"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Hs.Type.html#Ambiguous"><span class="hs-identifier hs-type">Ambiguous</span></a></span><span> </span><span class="annot"><span class="annottext">XAmbiguous GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681093235"><span class="annot"><span class="annottext">Located RdrName
</span><a href="#local-6989586621681093235"><span class="hs-identifier hs-var">lbl</span></a></span></span><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">AmbiguousFieldOcc GhcRn
</span><a href="#local-6989586621681093237"><span class="hs-identifier hs-var">fld_lbl</span></a></span><span>  </span><span class="hs-comment">-- Still ambiguous</span><span>
</span><span id="line-1313"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#HsEValArg"><span class="hs-identifier hs-type">HsEValArg</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681093234"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681093234"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[LHsExprArgIn]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(LHsExprArgIn -&gt; Bool) -&gt; [LHsExprArgIn] -&gt; [LHsExprArgIn]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="GHC.Utils.Misc.html#filterOut"><span class="hs-identifier hs-var">filterOut</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExprArgIn -&gt; Bool
forall (id :: Pass). HsExprArg id -&gt; Bool
</span><a href="GHC.Tc.Gen.Expr.html#isArgPar"><span class="hs-identifier hs-var">isArgPar</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsExprArgIn]
</span><a href="#local-6989586621681093232"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-comment">-- A value arg is first</span><span>
</span><span id="line-1314"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681093231"><span class="annot"><span class="annottext">LHsSigWcType GhcRn
</span><a href="#local-6989586621681093231"><span class="hs-identifier hs-var">sig_ty</span></a></span></span><span>               </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; Maybe (LHsSigWcType GhcRn)
</span><a href="GHC.Tc.Gen.Expr.html#obviousSig"><span class="hs-identifier hs-var">obviousSig</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681093234"><span class="hs-identifier hs-var">arg</span></a></span><span>  </span><span class="hs-comment">-- A type sig on the arg disambiguates</span><span>
</span><span id="line-1315"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681093230"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093230"><span class="hs-identifier hs-var">sig_tc_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt -&gt; LHsSigWcType GhcRn -&gt; TcM TcType
</span><a href="GHC.Tc.Gen.HsType.html#tcHsSigWcType"><span class="hs-identifier hs-var">tcHsSigWcType</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#ExprSigCtxt"><span class="hs-identifier hs-var">ExprSigCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">LHsSigWcType GhcRn
</span><a href="#local-6989586621681093231"><span class="hs-identifier hs-var">sig_ty</span></a></span><span>
</span><span id="line-1316"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681093229"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681093229"><span class="hs-identifier hs-var">sel_name</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Located RdrName -&gt; TcType -&gt; TcM Name
</span><a href="GHC.Tc.Gen.Expr.html#disambiguateSelector"><span class="hs-identifier hs-var">disambiguateSelector</span></a></span><span> </span><span class="annot"><span class="annottext">Located RdrName
</span><a href="#local-6989586621681093235"><span class="hs-identifier hs-var">lbl</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093230"><span class="hs-identifier hs-var">sig_tc_ty</span></a></span><span>
</span><span id="line-1317"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681093228"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681093228"><span class="hs-identifier hs-var">tc_fun</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093227"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093227"><span class="hs-identifier hs-var">fun_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">AmbiguousFieldOcc GhcRn -&gt; TcM (HsExpr GhcTc, TcType)
</span><a href="GHC.Tc.Gen.Expr.html#tcInferRecSelId"><span class="hs-identifier hs-var">tcInferRecSelId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XUnambiguous GhcRn -&gt; Located RdrName -&gt; AmbiguousFieldOcc GhcRn
forall pass.
XUnambiguous pass -&gt; Located RdrName -&gt; AmbiguousFieldOcc pass
</span><a href="GHC.Hs.Type.html#Unambiguous"><span class="hs-identifier hs-var">Unambiguous</span></a></span><span> </span><span class="annot"><span class="annottext">Name
XUnambiguous GhcRn
</span><a href="#local-6989586621681093229"><span class="hs-identifier hs-var">sel_name</span></a></span><span> </span><span class="annot"><span class="annottext">Located RdrName
</span><a href="#local-6989586621681093235"><span class="hs-identifier hs-var">lbl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1318"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
-&gt; HsExpr GhcTc
-&gt; TcType
-&gt; [LHsExprArgIn]
-&gt; TcM (HsExpr GhcTc, [LHsExprArgOut], TcType)
</span><a href="GHC.Tc.Gen.Expr.html#tcInferApp_finish"><span class="hs-identifier hs-var">tcInferApp_finish</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681093236"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681093228"><span class="hs-identifier hs-var">tc_fun</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093227"><span class="hs-identifier hs-var">fun_ty</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsExprArgIn]
</span><a href="#local-6989586621681093232"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1319"></span><span>
</span><span id="line-1320"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>  </span><span class="hs-comment">-- The wildly common case</span><span>
</span><span id="line-1321"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681093224"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681093224"><span class="hs-identifier hs-var">tc_fun</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093223"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093223"><span class="hs-identifier hs-var">fun_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM (HsExpr GhcTc, TcType) -&gt; TcM (HsExpr GhcTc, TcType)
</span><a href="#local-6989586621681093222"><span class="hs-identifier hs-var">set_fun_loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; TcM (HsExpr GhcTc, TcType)
</span><a href="GHC.Tc.Gen.Expr.html#tcInferAppHead"><span class="hs-identifier hs-var">tcInferAppHead</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681093236"><span class="hs-identifier hs-var">fun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1322"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
-&gt; HsExpr GhcTc
-&gt; TcType
-&gt; [LHsExprArgIn]
-&gt; TcM (HsExpr GhcTc, [LHsExprArgOut], TcType)
</span><a href="GHC.Tc.Gen.Expr.html#tcInferApp_finish"><span class="hs-identifier hs-var">tcInferApp_finish</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681093236"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681093224"><span class="hs-identifier hs-var">tc_fun</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093223"><span class="hs-identifier hs-var">fun_ty</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsExprArgIn]
</span><a href="#local-6989586621681093232"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1323"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1324"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681093236"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681093236"><span class="hs-identifier hs-var">fun</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093232"><span class="annot"><span class="annottext">[LHsExprArgIn]
</span><a href="#local-6989586621681093232"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; (HsExpr GhcRn, [LHsExprArgIn])
</span><a href="GHC.Tc.Gen.Expr.html#collectHsArgs"><span class="hs-identifier hs-var">collectHsArgs</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681093238"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-1325"></span><span>    </span><span id="local-6989586621681093222"><span class="annot"><span class="annottext">set_fun_loc :: TcM (HsExpr GhcTc, TcType) -&gt; TcM (HsExpr GhcTc, TcType)
</span><a href="#local-6989586621681093222"><span class="hs-identifier hs-var hs-var">set_fun_loc</span></a></span></span><span> </span><span id="local-6989586621681093220"><span class="annot"><span class="annottext">TcM (HsExpr GhcTc, TcType)
</span><a href="#local-6989586621681093220"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1326"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[LHsExprArgIn] -&gt; Maybe SrcSpan
</span><a href="GHC.Tc.Gen.Expr.html#getFunLoc"><span class="hs-identifier hs-var">getFunLoc</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsExprArgIn]
</span><a href="#local-6989586621681093232"><span class="hs-identifier hs-var">args</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1327"></span><span>          </span><span class="annot"><span class="annottext">Maybe SrcSpan
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM (HsExpr GhcTc, TcType)
</span><a href="#local-6989586621681093220"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>  </span><span class="hs-comment">-- Don't set the location twice</span><span>
</span><span id="line-1328"></span><span>          </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681093219"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681093219"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcM (HsExpr GhcTc, TcType) -&gt; TcM (HsExpr GhcTc, TcType)
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681093219"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">TcM (HsExpr GhcTc, TcType)
</span><a href="#local-6989586621681093220"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1329"></span><span>
</span><span id="line-1330"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcInferApp_finish"><span class="hs-identifier hs-type">tcInferApp_finish</span></a></span><span>
</span><span id="line-1331"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>                 </span><span class="hs-comment">-- Renamed function</span><span>
</span><span id="line-1332"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span>  </span><span class="hs-comment">-- Function and its type</span><span>
</span><span id="line-1333"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#LHsExprArgIn"><span class="hs-identifier hs-type">LHsExprArgIn</span></a></span><span class="hs-special">]</span><span>               </span><span class="hs-comment">-- Arguments</span><span>
</span><span id="line-1334"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#LHsExprArgOut"><span class="hs-identifier hs-type">LHsExprArgOut</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1335"></span><span id="tcInferApp_finish"><span class="annot"><span class="annottext">tcInferApp_finish :: HsExpr GhcRn
-&gt; HsExpr GhcTc
-&gt; TcType
-&gt; [LHsExprArgIn]
-&gt; TcM (HsExpr GhcTc, [LHsExprArgOut], TcType)
</span><a href="GHC.Tc.Gen.Expr.html#tcInferApp_finish"><span class="hs-identifier hs-var hs-var">tcInferApp_finish</span></a></span></span><span> </span><span id="local-6989586621681093218"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681093218"><span class="hs-identifier hs-var">rn_fun</span></a></span></span><span> </span><span id="local-6989586621681093217"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681093217"><span class="hs-identifier hs-var">tc_fun</span></a></span></span><span> </span><span id="local-6989586621681093216"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093216"><span class="hs-identifier hs-var">fun_sigma</span></a></span></span><span> </span><span id="local-6989586621681093215"><span class="annot"><span class="annottext">[LHsExprArgIn]
</span><a href="#local-6989586621681093215"><span class="hs-identifier hs-var">rn_args</span></a></span></span><span>
</span><span id="line-1336"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681093214"><span class="annot"><span class="annottext">[LHsExprArgOut]
</span><a href="#local-6989586621681093214"><span class="hs-identifier hs-var">tc_args</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093213"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093213"><span class="hs-identifier hs-var">actual_res_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
-&gt; TcType -&gt; [LHsExprArgIn] -&gt; TcM ([LHsExprArgOut], TcType)
</span><a href="GHC.Tc.Gen.Expr.html#tcArgs"><span class="hs-identifier hs-var">tcArgs</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681093218"><span class="hs-identifier hs-var">rn_fun</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093216"><span class="hs-identifier hs-var">fun_sigma</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsExprArgIn]
</span><a href="#local-6989586621681093215"><span class="hs-identifier hs-var">rn_args</span></a></span><span>
</span><span id="line-1337"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc, [LHsExprArgOut], TcType)
-&gt; TcM (HsExpr GhcTc, [LHsExprArgOut], TcType)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681093217"><span class="hs-identifier hs-var">tc_fun</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[LHsExprArgOut]
</span><a href="#local-6989586621681093214"><span class="hs-identifier hs-var">tc_args</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093213"><span class="hs-identifier hs-var">actual_res_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1338"></span><span>
</span><span id="line-1339"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#mk_op_msg"><span class="hs-identifier hs-type">mk_op_msg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-1340"></span><span id="mk_op_msg"><span class="annot"><span class="annottext">mk_op_msg :: LHsExpr GhcRn -&gt; SDoc
</span><a href="GHC.Tc.Gen.Expr.html#mk_op_msg"><span class="hs-identifier hs-var hs-var">mk_op_msg</span></a></span></span><span> </span><span id="local-6989586621681093211"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093211"><span class="hs-identifier hs-var">op</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;The operator&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093211"><span class="hs-identifier hs-var">op</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;takes&quot;</span></span><span>
</span><span id="line-1341"></span><span>
</span><span id="line-1342"></span><span class="hs-comment">----------------</span><span>
</span><span id="line-1343"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcInferAppHead"><span class="hs-identifier hs-type">tcInferAppHead</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1344"></span><span class="hs-comment">-- Infer type of the head of an application, returning a /SigmaType/</span><span>
</span><span id="line-1345"></span><span class="hs-comment">--   i.e. the 'f' in (f e1 ... en)</span><span>
</span><span id="line-1346"></span><span class="hs-comment">-- We get back a SigmaType because we have special cases for</span><span>
</span><span id="line-1347"></span><span class="hs-comment">--   * A bare identifier (just look it up)</span><span>
</span><span id="line-1348"></span><span class="hs-comment">--     This case also covers a record selectro HsRecFld</span><span>
</span><span id="line-1349"></span><span class="hs-comment">--   * An expression with a type signature (e :: ty)</span><span>
</span><span id="line-1350"></span><span class="hs-comment">--</span><span>
</span><span id="line-1351"></span><span class="hs-comment">-- Note that [] and (,,) are both HsVar:</span><span>
</span><span id="line-1352"></span><span class="hs-comment">--   see Note [Empty lists] and [ExplicitTuple] in GHC.Hs.Expr</span><span>
</span><span id="line-1353"></span><span class="hs-comment">--</span><span>
</span><span id="line-1354"></span><span class="hs-comment">-- NB: 'e' cannot be HsApp, HsTyApp, HsPrag, HsPar, because those</span><span>
</span><span id="line-1355"></span><span class="hs-comment">--     cases are dealt with by collectHsArgs.</span><span>
</span><span id="line-1356"></span><span class="hs-comment">--</span><span>
</span><span id="line-1357"></span><span class="hs-comment">-- See Note [Typechecking applications]</span><span>
</span><span id="line-1358"></span><span id="tcInferAppHead"><span class="annot"><span class="annottext">tcInferAppHead :: HsExpr GhcRn -&gt; TcM (HsExpr GhcTc, TcType)
</span><a href="GHC.Tc.Gen.Expr.html#tcInferAppHead"><span class="hs-identifier hs-var hs-var">tcInferAppHead</span></a></span></span><span> </span><span id="local-6989586621681093210"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681093210"><span class="hs-identifier hs-var">e</span></a></span></span><span>
</span><span id="line-1359"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681093210"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1360"></span><span>      </span><span class="annot"><a href="GHC.Hs.Expr.html#HsVar"><span class="hs-identifier hs-type">HsVar</span></a></span><span> </span><span class="annot"><span class="annottext">XVar GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681093209"><span class="annot"><span class="annottext">IdP GhcRn
</span><a href="#local-6989586621681093209"><span class="hs-identifier hs-var">nm</span></a></span></span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM (HsExpr GhcTc, TcType)
</span><a href="GHC.Tc.Gen.Expr.html#tcInferId"><span class="hs-identifier hs-var">tcInferId</span></a></span><span> </span><span class="annot"><span class="annottext">Name
IdP GhcRn
</span><a href="#local-6989586621681093209"><span class="hs-identifier hs-var">nm</span></a></span><span>
</span><span id="line-1361"></span><span>      </span><span class="annot"><a href="GHC.Hs.Expr.html#HsRecFld"><span class="hs-identifier hs-type">HsRecFld</span></a></span><span> </span><span class="annot"><span class="annottext">XRecFld GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681093208"><span class="annot"><span class="annottext">AmbiguousFieldOcc GhcRn
</span><a href="#local-6989586621681093208"><span class="hs-identifier hs-var">f</span></a></span></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">AmbiguousFieldOcc GhcRn -&gt; TcM (HsExpr GhcTc, TcType)
</span><a href="GHC.Tc.Gen.Expr.html#tcInferRecSelId"><span class="hs-identifier hs-var">tcInferRecSelId</span></a></span><span> </span><span class="annot"><span class="annottext">AmbiguousFieldOcc GhcRn
</span><a href="#local-6989586621681093208"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-1362"></span><span>      </span><span class="annot"><a href="GHC.Hs.Expr.html#ExprWithTySig"><span class="hs-identifier hs-type">ExprWithTySig</span></a></span><span> </span><span class="annot"><span class="annottext">XExprWithTySig GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681093207"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093207"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621681093206"><span class="annot"><span class="annottext">LHsSigWcType (NoGhcTc GhcRn)
</span><a href="#local-6989586621681093206"><span class="hs-identifier hs-var">hs_ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM (HsExpr GhcTc, TcType) -&gt; TcM (HsExpr GhcTc, TcType)
</span><a href="#local-6989586621681093205"><span class="hs-identifier hs-var">add_ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (HsExpr GhcTc, TcType) -&gt; TcM (HsExpr GhcTc, TcType))
-&gt; TcM (HsExpr GhcTc, TcType) -&gt; TcM (HsExpr GhcTc, TcType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
-&gt; LHsSigWcType (NoGhcTc GhcRn) -&gt; TcM (HsExpr GhcTc, TcType)
</span><a href="GHC.Tc.Gen.Expr.html#tcExprWithSig"><span class="hs-identifier hs-var">tcExprWithSig</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093207"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="annot"><span class="annottext">LHsSigWcType (NoGhcTc GhcRn)
</span><a href="#local-6989586621681093206"><span class="hs-identifier hs-var">hs_ty</span></a></span><span>
</span><span id="line-1363"></span><span>      </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><span class="hs-identifier">_</span></span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM (HsExpr GhcTc, TcType) -&gt; TcM (HsExpr GhcTc, TcType)
</span><a href="#local-6989586621681093205"><span class="hs-identifier hs-var">add_ctxt</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (HsExpr GhcTc, TcType) -&gt; TcM (HsExpr GhcTc, TcType))
-&gt; TcM (HsExpr GhcTc, TcType) -&gt; TcM (HsExpr GhcTc, TcType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(ExpRhoType -&gt; TcM (HsExpr GhcTc)) -&gt; TcM (HsExpr GhcTc, TcType)
forall a. (ExpRhoType -&gt; TcM a) -&gt; TcM (a, TcType)
</span><a href="GHC.Tc.Utils.TcMType.html#tcInfer"><span class="hs-identifier hs-var">tcInfer</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcExpr"><span class="hs-identifier hs-var">tcExpr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681093210"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1364"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1365"></span><span>    </span><span id="local-6989586621681093205"><span class="annot"><span class="annottext">add_ctxt :: TcM (HsExpr GhcTc, TcType) -&gt; TcM (HsExpr GhcTc, TcType)
</span><a href="#local-6989586621681093205"><span class="hs-identifier hs-var hs-var">add_ctxt</span></a></span></span><span> </span><span id="local-6989586621681093204"><span class="annot"><span class="annottext">TcM (HsExpr GhcTc, TcType)
</span><a href="#local-6989586621681093204"><span class="hs-identifier hs-var">thing</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcM (HsExpr GhcTc, TcType) -&gt; TcM (HsExpr GhcTc, TcType)
forall a. SDoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; SDoc
</span><a href="GHC.Tc.Gen.Expr.html#exprCtxt"><span class="hs-identifier hs-var">exprCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681093210"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcM (HsExpr GhcTc, TcType)
</span><a href="#local-6989586621681093204"><span class="hs-identifier hs-var">thing</span></a></span><span>
</span><span id="line-1366"></span><span>
</span><span id="line-1367"></span><span class="hs-comment">----------------</span><span>
</span><span id="line-1368"></span><span class="hs-comment">-- | Type-check the arguments to a function, possibly including visible type</span><span>
</span><span id="line-1369"></span><span class="hs-comment">-- applications</span><span>
</span><span id="line-1370"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcArgs"><span class="hs-identifier hs-type">tcArgs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>   </span><span class="hs-comment">-- ^ The function itself (for err msgs only)</span><span>
</span><span id="line-1371"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span>    </span><span class="hs-comment">-- ^ the (uninstantiated) type of the function</span><span>
</span><span id="line-1372"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#LHsExprArgIn"><span class="hs-identifier hs-type">LHsExprArgIn</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ the args</span><span>
</span><span id="line-1373"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#LHsExprArgOut"><span class="hs-identifier hs-type">LHsExprArgOut</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1374"></span><span>          </span><span class="hs-comment">-- ^ (a wrapper for the function, the tc'd args, result type)</span><span>
</span><span id="line-1375"></span><span id="tcArgs"><span class="annot"><span class="annottext">tcArgs :: HsExpr GhcRn
-&gt; TcType -&gt; [LHsExprArgIn] -&gt; TcM ([LHsExprArgOut], TcType)
</span><a href="GHC.Tc.Gen.Expr.html#tcArgs"><span class="hs-identifier hs-var hs-var">tcArgs</span></a></span></span><span> </span><span id="local-6989586621681093202"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681093202"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span id="local-6989586621681093201"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093201"><span class="hs-identifier hs-var">orig_fun_ty</span></a></span></span><span> </span><span id="local-6989586621681093200"><span class="annot"><span class="annottext">[LHsExprArgIn]
</span><a href="#local-6989586621681093200"><span class="hs-identifier hs-var">orig_args</span></a></span></span><span>
</span><span id="line-1376"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ThLevel
-&gt; [Scaled TcType]
-&gt; TcType
-&gt; [LHsExprArgIn]
-&gt; TcM ([LHsExprArgOut], TcType)
</span><a href="#local-6989586621681093199"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><span class="hs-number">1</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093201"><span class="hs-identifier hs-var">orig_fun_ty</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsExprArgIn]
</span><a href="#local-6989586621681093200"><span class="hs-identifier hs-var">orig_args</span></a></span><span>
</span><span id="line-1377"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1378"></span><span>    </span><span id="local-6989586621681093198"><span class="annot"><span class="annottext">fun_orig :: CtOrigin
</span><a href="#local-6989586621681093198"><span class="hs-identifier hs-var hs-var">fun_orig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#exprCtOrigin"><span class="hs-identifier hs-var">exprCtOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681093202"><span class="hs-identifier hs-var">fun</span></a></span><span>
</span><span id="line-1379"></span><span>    </span><span id="local-6989586621681093197"><span class="annot"><span class="annottext">herald :: SDoc
</span><a href="#local-6989586621681093197"><span class="hs-identifier hs-var hs-var">herald</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;The function&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681093202"><span class="hs-identifier hs-var">fun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1380"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;is applied to&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-1381"></span><span>
</span><span id="line-1382"></span><span>    </span><span class="hs-comment">-- Count value args only when complaining about a function</span><span>
</span><span id="line-1383"></span><span>    </span><span class="hs-comment">-- applied to too many value args</span><span>
</span><span id="line-1384"></span><span>    </span><span class="hs-comment">-- See Note [Herald for matchExpectedFunTys] in GHC.Tc.Utils.Unify.</span><span>
</span><span id="line-1385"></span><span>    </span><span id="local-6989586621681093196"><span class="annot"><span class="annottext">n_val_args :: ThLevel
</span><a href="#local-6989586621681093196"><span class="hs-identifier hs-var hs-var">n_val_args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LHsExprArgIn -&gt; Bool) -&gt; [LHsExprArgIn] -&gt; ThLevel
forall a. (a -&gt; Bool) -&gt; [a] -&gt; ThLevel
</span><a href="GHC.Utils.Misc.html#count"><span class="hs-identifier hs-var">count</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExprArgIn -&gt; Bool
forall (id :: Pass). HsExprArg id -&gt; Bool
</span><a href="GHC.Tc.Gen.Expr.html#isHsValArg"><span class="hs-identifier hs-var">isHsValArg</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsExprArgIn]
</span><a href="#local-6989586621681093200"><span class="hs-identifier hs-var">orig_args</span></a></span><span>
</span><span id="line-1386"></span><span>
</span><span id="line-1387"></span><span>    </span><span id="local-6989586621681093194"><span class="annot"><span class="annottext">fun_is_out_of_scope :: Bool
</span><a href="#local-6989586621681093194"><span class="hs-identifier hs-var hs-var">fun_is_out_of_scope</span></a></span></span><span>  </span><span class="hs-comment">-- See Note [VTA for out-of-scope functions]</span><span>
</span><span id="line-1388"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681093202"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1389"></span><span>          </span><span class="annot"><a href="GHC.Hs.Expr.html#HsUnboundVar"><span class="hs-identifier hs-type">HsUnboundVar</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1390"></span><span>          </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><span class="hs-identifier">_</span></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1391"></span><span>
</span><span id="line-1392"></span><span>    </span><span class="annot"><a href="#local-6989586621681093199"><span class="hs-identifier hs-type">go</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>           </span><span class="hs-comment">-- Which argment number this is (incl type args)</span><span>
</span><span id="line-1393"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- Value args to which applied so far</span><span>
</span><span id="line-1394"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span>
</span><span id="line-1395"></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#LHsExprArgIn"><span class="hs-identifier hs-type">LHsExprArgIn</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#LHsExprArgOut"><span class="hs-identifier hs-type">LHsExprArgOut</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1396"></span><span>    </span><span id="local-6989586621681093199"><span class="annot"><span class="annottext">go :: ThLevel
-&gt; [Scaled TcType]
-&gt; TcType
-&gt; [LHsExprArgIn]
-&gt; TcM ([LHsExprArgOut], TcType)
</span><a href="#local-6989586621681093199"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681093193"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093193"><span class="hs-identifier hs-var">fun_ty</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcArgs:ret&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093193"><span class="hs-identifier hs-var">fun_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcRn ()
-&gt; TcM ([LHsExprArgOut], TcType) -&gt; TcM ([LHsExprArgOut], TcType)
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><a href="../../base/src/GHC.Base.html#%3E%3E"><span class="hs-operator hs-var">&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">([LHsExprArgOut], TcType) -&gt; TcM ([LHsExprArgOut], TcType)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093193"><span class="hs-identifier hs-var">fun_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1397"></span><span>
</span><span id="line-1398"></span><span>    </span><span class="annot"><a href="#local-6989586621681093199"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681093192"><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621681093192"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681093191"><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681093191"><span class="hs-identifier hs-var">so_far</span></a></span></span><span> </span><span id="local-6989586621681093190"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093190"><span class="hs-identifier hs-var">fun_ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#HsEPar"><span class="hs-identifier hs-type">HsEPar</span></a></span><span> </span><span id="local-6989586621681093189"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681093189"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681093188"><span class="annot"><span class="annottext">[LHsExprArgIn]
</span><a href="#local-6989586621681093188"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1399"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681093187"><span class="annot"><span class="annottext">[LHsExprArgOut]
</span><a href="#local-6989586621681093187"><span class="hs-identifier hs-var">args'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093186"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093186"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ThLevel
-&gt; [Scaled TcType]
-&gt; TcType
-&gt; [LHsExprArgIn]
-&gt; TcM ([LHsExprArgOut], TcType)
</span><a href="#local-6989586621681093199"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621681093192"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681093191"><span class="hs-identifier hs-var">so_far</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093190"><span class="hs-identifier hs-var">fun_ty</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsExprArgIn]
</span><a href="#local-6989586621681093188"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1400"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">([LHsExprArgOut], TcType) -&gt; TcM ([LHsExprArgOut], TcType)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; LHsExprArgOut
forall (id :: Pass). SrcSpan -&gt; HsExprArg id
</span><a href="GHC.Tc.Gen.Expr.html#HsEPar"><span class="hs-identifier hs-var">HsEPar</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681093189"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExprArgOut -&gt; [LHsExprArgOut] -&gt; [LHsExprArgOut]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[LHsExprArgOut]
</span><a href="#local-6989586621681093187"><span class="hs-identifier hs-var">args'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093186"><span class="hs-identifier hs-var">res_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1401"></span><span>
</span><span id="line-1402"></span><span>    </span><span class="annot"><a href="#local-6989586621681093199"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681093185"><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621681093185"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681093184"><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681093184"><span class="hs-identifier hs-var">so_far</span></a></span></span><span> </span><span id="local-6989586621681093183"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093183"><span class="hs-identifier hs-var">fun_ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#HsEPrag"><span class="hs-identifier hs-type">HsEPrag</span></a></span><span> </span><span id="local-6989586621681093182"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681093182"><span class="hs-identifier hs-var">sp</span></a></span></span><span> </span><span id="local-6989586621681093181"><span class="annot"><span class="annottext">HsPragE GhcRn
</span><a href="#local-6989586621681093181"><span class="hs-identifier hs-var">prag</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681093180"><span class="annot"><span class="annottext">[LHsExprArgIn]
</span><a href="#local-6989586621681093180"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1403"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681093179"><span class="annot"><span class="annottext">[LHsExprArgOut]
</span><a href="#local-6989586621681093179"><span class="hs-identifier hs-var">args'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093178"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093178"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ThLevel
-&gt; [Scaled TcType]
-&gt; TcType
-&gt; [LHsExprArgIn]
-&gt; TcM ([LHsExprArgOut], TcType)
</span><a href="#local-6989586621681093199"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621681093185"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681093184"><span class="hs-identifier hs-var">so_far</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093183"><span class="hs-identifier hs-var">fun_ty</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsExprArgIn]
</span><a href="#local-6989586621681093180"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1404"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">([LHsExprArgOut], TcType) -&gt; TcM ([LHsExprArgOut], TcType)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; HsPragE GhcTc -&gt; LHsExprArgOut
forall (id :: Pass).
SrcSpan -&gt; HsPragE (GhcPass id) -&gt; HsExprArg id
</span><a href="GHC.Tc.Gen.Expr.html#HsEPrag"><span class="hs-identifier hs-var">HsEPrag</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681093182"><span class="hs-identifier hs-var">sp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsPragE GhcRn -&gt; HsPragE GhcTc
</span><a href="GHC.Tc.Gen.Expr.html#tcExprPrag"><span class="hs-identifier hs-var">tcExprPrag</span></a></span><span> </span><span class="annot"><span class="annottext">HsPragE GhcRn
</span><a href="#local-6989586621681093181"><span class="hs-identifier hs-var">prag</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LHsExprArgOut -&gt; [LHsExprArgOut] -&gt; [LHsExprArgOut]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[LHsExprArgOut]
</span><a href="#local-6989586621681093179"><span class="hs-identifier hs-var">args'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093178"><span class="hs-identifier hs-var">res_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1405"></span><span>
</span><span id="line-1406"></span><span>    </span><span class="annot"><a href="#local-6989586621681093199"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681093177"><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621681093177"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681093176"><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681093176"><span class="hs-identifier hs-var">so_far</span></a></span></span><span> </span><span id="local-6989586621681093175"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093175"><span class="hs-identifier hs-var">fun_ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#HsETypeArg"><span class="hs-identifier hs-type">HsETypeArg</span></a></span><span> </span><span id="local-6989586621681093174"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681093174"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681093173"><span class="annot"><span class="annottext">LHsWcType (NoGhcTc GhcRn)
</span><a href="#local-6989586621681093173"><span class="hs-identifier hs-var">hs_ty_arg</span></a></span></span><span> </span><span class="annot"><span class="annottext">XExprTypeArg 'Renamed
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681093172"><span class="annot"><span class="annottext">[LHsExprArgIn]
</span><a href="#local-6989586621681093172"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1407"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681093194"><span class="hs-identifier hs-var">fun_is_out_of_scope</span></a></span><span>   </span><span class="hs-comment">-- See Note [VTA for out-of-scope functions]</span><span>
</span><span id="line-1408"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ThLevel
-&gt; [Scaled TcType]
-&gt; TcType
-&gt; [LHsExprArgIn]
-&gt; TcM ([LHsExprArgOut], TcType)
</span><a href="#local-6989586621681093199"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621681093177"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">ThLevel -&gt; ThLevel -&gt; ThLevel
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span class="annot"><span class="annottext">ThLevel
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681093176"><span class="hs-identifier hs-var">so_far</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093175"><span class="hs-identifier hs-var">fun_ty</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsExprArgIn]
</span><a href="#local-6989586621681093172"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1409"></span><span>
</span><span id="line-1410"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1411"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681093170"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681093170"><span class="hs-identifier hs-var">wrap1</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093169"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093169"><span class="hs-identifier hs-var">upsilon_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; TcType -&gt; TcM (HsWrapper, TcType)
</span><a href="GHC.Tc.Utils.Instantiate.html#topInstantiateInferred"><span class="hs-identifier hs-var">topInstantiateInferred</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621681093198"><span class="hs-identifier hs-var">fun_orig</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093175"><span class="hs-identifier hs-var">fun_ty</span></a></span><span>
</span><span id="line-1412"></span><span>               </span><span class="hs-comment">-- wrap1 :: fun_ty &quot;-&gt;&quot; upsilon_ty</span><span>
</span><span id="line-1413"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; Maybe (TyVarBinder, TcType)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitForAllTy_maybe"><span class="hs-identifier hs-var">tcSplitForAllTy_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093169"><span class="hs-identifier hs-var">upsilon_ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1414"></span><span>               </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681093166"><span class="annot"><span class="annottext">TyVarBinder
</span><a href="#local-6989586621681093166"><span class="hs-identifier hs-var">tvb</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093165"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093165"><span class="hs-identifier hs-var">inner_ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1415"></span><span>                 </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyVarBinder -&gt; ArgFlag
forall tv argf. VarBndr tv argf -&gt; argf
</span><a href="GHC.Types.Var.html#binderArgFlag"><span class="hs-identifier hs-var">binderArgFlag</span></a></span><span> </span><span class="annot"><span class="annottext">TyVarBinder
</span><a href="#local-6989586621681093166"><span class="hs-identifier hs-var">tvb</span></a></span><span> </span><span class="annot"><span class="annottext">ArgFlag -&gt; ArgFlag -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ArgFlag
</span><a href="GHC.Types.Var.html#Specified"><span class="hs-identifier hs-var">Specified</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1416"></span><span>                   </span><span class="hs-comment">-- It really can't be Inferred, because we've justn</span><span>
</span><span id="line-1417"></span><span>                   </span><span class="hs-comment">-- instantiated those. But, oddly, it might just be Required.</span><span>
</span><span id="line-1418"></span><span>                   </span><span class="hs-comment">-- See Note [Required quantifiers in the type of a term]</span><span>
</span><span id="line-1419"></span><span>                 </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681093162"><span class="annot"><span class="annottext">tv :: Var
</span><a href="#local-6989586621681093162"><span class="hs-identifier hs-var hs-var">tv</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyVarBinder -&gt; Var
forall tv argf. VarBndr tv argf -&gt; tv
</span><a href="GHC.Types.Var.html#binderVar"><span class="hs-identifier hs-var">binderVar</span></a></span><span> </span><span class="annot"><span class="annottext">TyVarBinder
</span><a href="#local-6989586621681093166"><span class="hs-identifier hs-var">tvb</span></a></span><span>
</span><span id="line-1420"></span><span>                          </span><span id="local-6989586621681093160"><span class="annot"><span class="annottext">kind :: TcType
</span><a href="#local-6989586621681093160"><span class="hs-identifier hs-var hs-var">kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; TcType
</span><a href="GHC.Types.Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681093162"><span class="hs-identifier hs-var">tv</span></a></span><span>
</span><span id="line-1421"></span><span>                    </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681093158"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093158"><span class="hs-identifier hs-var">ty_arg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsWcType GhcRn -&gt; TcType -&gt; TcM TcType
</span><a href="GHC.Tc.Gen.HsType.html#tcHsTypeApp"><span class="hs-identifier hs-var">tcHsTypeApp</span></a></span><span> </span><span class="annot"><span class="annottext">LHsWcType GhcRn
LHsWcType (NoGhcTc GhcRn)
</span><a href="#local-6989586621681093173"><span class="hs-identifier hs-var">hs_ty_arg</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093160"><span class="hs-identifier hs-var">kind</span></a></span><span>
</span><span id="line-1422"></span><span>
</span><span id="line-1423"></span><span>                    </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681093156"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093156"><span class="hs-identifier hs-var">inner_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093165"><span class="hs-identifier hs-var">inner_ty</span></a></span><span>
</span><span id="line-1424"></span><span>                          </span><span class="hs-comment">-- See Note [Visible type application zonk]</span><span>
</span><span id="line-1425"></span><span>                    </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681093154"><span class="annot"><span class="annottext">in_scope :: InScopeSet
</span><a href="#local-6989586621681093154"><span class="hs-identifier hs-var hs-var">in_scope</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; InScopeSet
</span><a href="GHC.Types.Var.Env.html#mkInScopeSet"><span class="hs-identifier hs-var">mkInScopeSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TcType] -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfTypes"><span class="hs-identifier hs-var">tyCoVarsOfTypes</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093169"><span class="hs-identifier hs-var">upsilon_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093158"><span class="hs-identifier hs-var">ty_arg</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1426"></span><span>                          </span><span id="local-6989586621681093152"><span class="annot"><span class="annottext">insted_ty :: TcType
</span><a href="#local-6989586621681093152"><span class="hs-identifier hs-var hs-var">insted_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InScopeSet -&gt; [Var] -&gt; [TcType] -&gt; TcType -&gt; TcType
</span><a href="GHC.Core.TyCo.Subst.html#substTyWithInScope"><span class="hs-identifier hs-var">substTyWithInScope</span></a></span><span> </span><span class="annot"><span class="annottext">InScopeSet
</span><a href="#local-6989586621681093154"><span class="hs-identifier hs-var">in_scope</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681093162"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093158"><span class="hs-identifier hs-var">ty_arg</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093156"><span class="hs-identifier hs-var">inner_ty</span></a></span><span>
</span><span id="line-1427"></span><span>                                      </span><span class="hs-comment">-- NB: tv and ty_arg have the same kind, so this</span><span>
</span><span id="line-1428"></span><span>                                      </span><span class="hs-comment">--     substitution is kind-respecting</span><span>
</span><span id="line-1429"></span><span>                    </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;VTA&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Var -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681093162"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; SDoc
</span><a href="GHC.Core.TyCo.Ppr.html#debugPprType"><span class="hs-identifier hs-var">debugPprType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093160"><span class="hs-identifier hs-var">kind</span></a></span><span>
</span><span id="line-1430"></span><span>                                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; SDoc
</span><a href="GHC.Core.TyCo.Ppr.html#debugPprType"><span class="hs-identifier hs-var">debugPprType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093158"><span class="hs-identifier hs-var">ty_arg</span></a></span><span>
</span><span id="line-1431"></span><span>                                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; SDoc
</span><a href="GHC.Core.TyCo.Ppr.html#debugPprType"><span class="hs-identifier hs-var">debugPprType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; TcType -&gt; TcType
TcType -&gt; TcType
</span><a href="GHC.Core.Type.html#tcTypeKind"><span class="hs-identifier hs-var">tcTypeKind</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093158"><span class="hs-identifier hs-var">ty_arg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1432"></span><span>                                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; SDoc
</span><a href="GHC.Core.TyCo.Ppr.html#debugPprType"><span class="hs-identifier hs-var">debugPprType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093156"><span class="hs-identifier hs-var">inner_ty</span></a></span><span>
</span><span id="line-1433"></span><span>                                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; SDoc
</span><a href="GHC.Core.TyCo.Ppr.html#debugPprType"><span class="hs-identifier hs-var">debugPprType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093152"><span class="hs-identifier hs-var">insted_ty</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1434"></span><span>
</span><span id="line-1435"></span><span>                    </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681093149"><span class="annot"><span class="annottext">[LHsExprArgOut]
</span><a href="#local-6989586621681093149"><span class="hs-identifier hs-var">args'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093148"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093148"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ThLevel
-&gt; [Scaled TcType]
-&gt; TcType
-&gt; [LHsExprArgIn]
-&gt; TcM ([LHsExprArgOut], TcType)
</span><a href="#local-6989586621681093199"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621681093177"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">ThLevel -&gt; ThLevel -&gt; ThLevel
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span class="annot"><span class="annottext">ThLevel
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681093176"><span class="hs-identifier hs-var">so_far</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093152"><span class="hs-identifier hs-var">insted_ty</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsExprArgIn]
</span><a href="#local-6989586621681093172"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1436"></span><span>                    </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">([LHsExprArgOut], TcType) -&gt; TcM ([LHsExprArgOut], TcType)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; [LHsExprArgOut] -&gt; [LHsExprArgOut]
</span><a href="GHC.Tc.Gen.Expr.html#addArgWrap"><span class="hs-identifier hs-var">addArgWrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681093170"><span class="hs-identifier hs-var">wrap1</span></a></span><span> </span><span class="annot"><span class="annottext">([LHsExprArgOut] -&gt; [LHsExprArgOut])
-&gt; [LHsExprArgOut] -&gt; [LHsExprArgOut]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
-&gt; LHsWcType (NoGhcTc GhcTc)
-&gt; XExprTypeArg 'Typechecked
-&gt; LHsExprArgOut
forall (id :: Pass).
SrcSpan
-&gt; LHsWcType (NoGhcTc (GhcPass id))
-&gt; XExprTypeArg id
-&gt; HsExprArg id
</span><a href="GHC.Tc.Gen.Expr.html#HsETypeArg"><span class="hs-identifier hs-var">HsETypeArg</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681093174"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">LHsWcType (NoGhcTc GhcRn)
LHsWcType (NoGhcTc GhcTc)
</span><a href="#local-6989586621681093173"><span class="hs-identifier hs-var">hs_ty_arg</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
XExprTypeArg 'Typechecked
</span><a href="#local-6989586621681093158"><span class="hs-identifier hs-var">ty_arg</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExprArgOut -&gt; [LHsExprArgOut] -&gt; [LHsExprArgOut]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[LHsExprArgOut]
</span><a href="#local-6989586621681093149"><span class="hs-identifier hs-var">args'</span></a></span><span>
</span><span id="line-1437"></span><span>                             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093148"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1438"></span><span>               </span><span class="annot"><span class="annottext">Maybe (TyVarBinder, TcType)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; LHsWcType GhcRn -&gt; TcM ([LHsExprArgOut], TcType)
forall {a} {b}.
Outputable a =&gt;
TcType -&gt; a -&gt; IOEnv (Env TcGblEnv TcLclEnv) b
</span><a href="#local-6989586621681093147"><span class="hs-identifier hs-var">ty_app_err</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093169"><span class="hs-identifier hs-var">upsilon_ty</span></a></span><span> </span><span class="annot"><span class="annottext">LHsWcType GhcRn
LHsWcType (NoGhcTc GhcRn)
</span><a href="#local-6989586621681093173"><span class="hs-identifier hs-var">hs_ty_arg</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1439"></span><span>
</span><span id="line-1440"></span><span>    </span><span class="annot"><a href="#local-6989586621681093199"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681093146"><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621681093146"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681093145"><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681093145"><span class="hs-identifier hs-var">so_far</span></a></span></span><span> </span><span id="local-6989586621681093144"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093144"><span class="hs-identifier hs-var">fun_ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#HsEValArg"><span class="hs-identifier hs-type">HsEValArg</span></a></span><span> </span><span id="local-6989586621681093143"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681093143"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681093142"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093142"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681093141"><span class="annot"><span class="annottext">[LHsExprArgIn]
</span><a href="#local-6989586621681093141"><span class="hs-identifier hs-var">args</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1441"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681093140"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681093140"><span class="hs-identifier hs-var">wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093139"><span class="annot"><span class="annottext">Scaled TcType
</span><a href="#local-6989586621681093139"><span class="hs-identifier hs-var">arg_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093138"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093138"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1442"></span><span>               </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SDoc
-&gt; CtOrigin
-&gt; Maybe (HsExpr GhcRn)
-&gt; (ThLevel, [Scaled TcType])
-&gt; TcType
-&gt; TcM (HsWrapper, Scaled TcType, TcType)
</span><a href="GHC.Tc.Utils.Unify.html#matchActualFunTySigma"><span class="hs-identifier hs-var">matchActualFunTySigma</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681093197"><span class="hs-identifier hs-var">herald</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621681093198"><span class="hs-identifier hs-var">fun_orig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; Maybe (HsExpr GhcRn)
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681093202"><span class="hs-identifier hs-var">fun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1443"></span><span>                                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621681093196"><span class="hs-identifier hs-var">n_val_args</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681093145"><span class="hs-identifier hs-var">so_far</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093144"><span class="hs-identifier hs-var">fun_ty</span></a></span><span>
</span><span id="line-1444"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681093136"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681093136"><span class="hs-identifier hs-var">arg'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
-&gt; LHsExpr GhcRn -&gt; Scaled TcType -&gt; ThLevel -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcArg"><span class="hs-identifier hs-var">tcArg</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681093202"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093142"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled TcType
</span><a href="#local-6989586621681093139"><span class="hs-identifier hs-var">arg_ty</span></a></span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621681093146"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1445"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681093135"><span class="annot"><span class="annottext">[LHsExprArgOut]
</span><a href="#local-6989586621681093135"><span class="hs-identifier hs-var">args'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093134"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093134"><span class="hs-identifier hs-var">inner_res_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ThLevel
-&gt; [Scaled TcType]
-&gt; TcType
-&gt; [LHsExprArgIn]
-&gt; TcM ([LHsExprArgOut], TcType)
</span><a href="#local-6989586621681093199"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621681093146"><span class="hs-identifier hs-var">n</span></a></span><span class="annot"><span class="annottext">ThLevel -&gt; ThLevel -&gt; ThLevel
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span class="annot"><span class="annottext">ThLevel
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scaled TcType
</span><a href="#local-6989586621681093139"><span class="hs-identifier hs-var">arg_ty</span></a></span><span class="annot"><span class="annottext">Scaled TcType -&gt; [Scaled TcType] -&gt; [Scaled TcType]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681093145"><span class="hs-identifier hs-var">so_far</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093138"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsExprArgIn]
</span><a href="#local-6989586621681093141"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1446"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">([LHsExprArgOut], TcType) -&gt; TcM ([LHsExprArgOut], TcType)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; [LHsExprArgOut] -&gt; [LHsExprArgOut]
</span><a href="GHC.Tc.Gen.Expr.html#addArgWrap"><span class="hs-identifier hs-var">addArgWrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681093140"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="annot"><span class="annottext">([LHsExprArgOut] -&gt; [LHsExprArgOut])
-&gt; [LHsExprArgOut] -&gt; [LHsExprArgOut]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; LHsExpr GhcTc -&gt; LHsExprArgOut
forall (id :: Pass).
SrcSpan -&gt; LHsExpr (GhcPass id) -&gt; HsExprArg id
</span><a href="GHC.Tc.Gen.Expr.html#HsEValArg"><span class="hs-identifier hs-var">HsEValArg</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681093143"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681093136"><span class="hs-identifier hs-var">arg'</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExprArgOut -&gt; [LHsExprArgOut] -&gt; [LHsExprArgOut]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[LHsExprArgOut]
</span><a href="#local-6989586621681093135"><span class="hs-identifier hs-var">args'</span></a></span><span>
</span><span id="line-1447"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093134"><span class="hs-identifier hs-var">inner_res_ty</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1448"></span><span>
</span><span id="line-1449"></span><span>    </span><span id="local-6989586621681093147"><span class="annot"><span class="annottext">ty_app_err :: TcType -&gt; a -&gt; IOEnv (Env TcGblEnv TcLclEnv) b
</span><a href="#local-6989586621681093147"><span class="hs-identifier hs-var hs-var">ty_app_err</span></a></span></span><span> </span><span id="local-6989586621681093129"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093129"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621681093128"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681093128"><span class="hs-identifier hs-var">arg</span></a></span></span><span>
</span><span id="line-1450"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093127"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093127"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TidyEnv -&gt; TcType -&gt; TcM (TidyEnv, TcType)
</span><a href="GHC.Tc.Utils.TcMType.html#zonkTidyTcType"><span class="hs-identifier hs-var">zonkTidyTcType</span></a></span><span> </span><span class="annot"><span class="annottext">TidyEnv
</span><a href="GHC.Types.Var.Env.html#emptyTidyEnv"><span class="hs-identifier hs-var">emptyTidyEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093129"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1451"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall a. SDoc -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#failWith"><span class="hs-identifier hs-var">failWith</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) b)
-&gt; SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1452"></span><span>               </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Cannot apply expression of type&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093127"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-1453"></span><span>               </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;to a visible type argument&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681093128"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1454"></span><span>
</span><span id="line-1455"></span><span class="hs-comment">{- Note [Required quantifiers in the type of a term]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Consider (#15859)

  data A k :: k -&gt; Type      -- A      :: forall k -&gt; k -&gt; Type
  type KindOf (a :: k) = k   -- KindOf :: forall k. k -&gt; Type
  a = (undefind :: KindOf A) @Int

With ImpredicativeTypes (thin ice, I know), we instantiate
KindOf at type (forall k -&gt; k -&gt; Type), so
  KindOf A = forall k -&gt; k -&gt; Type
whose first argument is Required

We want to reject this type application to Int, but in earlier
GHCs we had an ASSERT that Required could not occur here.

The ice is thin; c.f. Note [No Required TyCoBinder in terms]
in GHC.Core.TyCo.Rep.

Note [VTA for out-of-scope functions]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Suppose 'wurble' is not in scope, and we have
   (wurble @Int @Bool True 'x')

Then the renamer will make (HsUnboundVar &quot;wurble) for 'wurble',
and the typechecker will typecheck it with tcUnboundId, giving it
a type 'alpha', and emitting a deferred Hole, to be reported later.

But then comes the visible type application. If we do nothing, we'll
generate an immediate failure (in tc_app_err), saying that a function
of type 'alpha' can't be applied to Bool.  That's insane!  And indeed
users complain bitterly (#13834, #17150.)

The right error is the Hole, which has /already/ been emitted by
tcUnboundId.  It later reports 'wurble' as out of scope, and tries to
give its type.

Fortunately in tcArgs we still have access to the function, so we can
check if it is a HsUnboundVar.  We use this info to simply skip over
any visible type arguments.  We've already inferred the type of the
function, so we'll /already/ have emitted a Hole;
failing preserves that constraint.

We do /not/ want to fail altogether in this case (via failM) becuase
that may abandon an entire instance decl, which (in the presence of
-fdefer-type-errors) leads to leading to #17792.

Downside; the typechecked term has lost its visible type arguments; we
don't even kind-check them.  But let's jump that bridge if we come to
it.  Meanwhile, let's not crash!

Note [Visible type application zonk]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* Substitutions should be kind-preserving, so we need kind(tv) = kind(ty_arg).

* tcHsTypeApp only guarantees that
    - ty_arg is zonked
    - kind(zonk(tv)) = kind(ty_arg)
  (checkExpectedKind zonks as it goes).

So we must zonk inner_ty as well, to guarantee consistency between zonk(tv)
and inner_ty.  Otherwise we can build an ill-kinded type.  An example was
#14158, where we had:
   id :: forall k. forall (cat :: k -&gt; k -&gt; *). forall (a :: k). cat a a
and we had the visible type application
  id @(-&gt;)

* We instantiated k := kappa, yielding
    forall (cat :: kappa -&gt; kappa -&gt; *). forall (a :: kappa). cat a a
* Then we called tcHsTypeApp (-&gt;) with expected kind (kappa -&gt; kappa -&gt; *).
* That instantiated (-&gt;) as ((-&gt;) q1 q1), and unified kappa := q1,
  Here q1 :: RuntimeRep
* Now we substitute
     cat  :-&gt;  (-&gt;) q1 q1 :: TYPE q1 -&gt; TYPE q1 -&gt; *
  but we must first zonk the inner_ty to get
      forall (a :: TYPE q1). cat a a
  so that the result of substitution is well-kinded
  Failing to do so led to #14158.
-}</span><span>
</span><span id="line-1534"></span><span>
</span><span id="line-1535"></span><span class="hs-comment">----------------</span><span>
</span><span id="line-1536"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcArg"><span class="hs-identifier hs-type">tcArg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>                   </span><span class="hs-comment">-- The function (for error messages)</span><span>
</span><span id="line-1537"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>                   </span><span class="hs-comment">-- Actual arguments</span><span>
</span><span id="line-1538"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span>              </span><span class="hs-comment">-- expected arg type</span><span>
</span><span id="line-1539"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>                             </span><span class="hs-comment">-- # of argument</span><span>
</span><span id="line-1540"></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>           </span><span class="hs-comment">-- Resulting argument</span><span>
</span><span id="line-1541"></span><span id="tcArg"><span class="annot"><span class="annottext">tcArg :: HsExpr GhcRn
-&gt; LHsExpr GhcRn -&gt; Scaled TcType -&gt; ThLevel -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcArg"><span class="hs-identifier hs-var hs-var">tcArg</span></a></span></span><span> </span><span id="local-6989586621681093124"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681093124"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span id="local-6989586621681093123"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093123"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span id="local-6989586621681093122"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093122"><span class="hs-identifier hs-var">mult</span></a></span></span><span> </span><span id="local-6989586621681093121"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093121"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681093120"><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621681093120"><span class="hs-identifier hs-var">arg_no</span></a></span></span><span>
</span><span id="line-1542"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a. SDoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; LHsExpr GhcRn -&gt; ThLevel -&gt; SDoc
forall fun arg.
(Outputable fun, Outputable arg) =&gt;
fun -&gt; arg -&gt; ThLevel -&gt; SDoc
</span><a href="GHC.Tc.Gen.HsType.html#funAppCtxt"><span class="hs-identifier hs-var">funAppCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681093124"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093123"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621681093120"><span class="hs-identifier hs-var">arg_no</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1543"></span><span>     </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcArg&quot;</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; TcRn ()) -&gt; SDoc -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1544"></span><span>          </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">ThLevel -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621681093120"><span class="hs-identifier hs-var">arg_no</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;of&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681093124"><span class="hs-identifier hs-var">fun</span></a></span><span>
</span><span id="line-1545"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;arg type:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TcType -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093121"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1546"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;arg:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093123"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1547"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a. TcType -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-var">tcScalingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093122"><span class="hs-identifier hs-var">mult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; TcType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExprNC"><span class="hs-identifier hs-var">tcCheckPolyExprNC</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093123"><span class="hs-identifier hs-var">arg</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093121"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1548"></span><span>
</span><span id="line-1549"></span><span class="hs-comment">----------------</span><span>
</span><span id="line-1550"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcTupArgs"><span class="hs-identifier hs-type">tcTupArgs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Hs.Expr.html#LHsTupArg"><span class="hs-identifier hs-type">LHsTupArg</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Hs.Expr.html#LHsTupArg"><span class="hs-identifier hs-type">LHsTupArg</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1551"></span><span id="tcTupArgs"><span class="annot"><span class="annottext">tcTupArgs :: [LHsTupArg GhcRn] -&gt; [TcType] -&gt; TcM [LHsTupArg GhcTc]
</span><a href="GHC.Tc.Gen.Expr.html#tcTupArgs"><span class="hs-identifier hs-var hs-var">tcTupArgs</span></a></span></span><span> </span><span id="local-6989586621681093119"><span class="annot"><span class="annottext">[LHsTupArg GhcRn]
</span><a href="#local-6989586621681093119"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621681093118"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681093118"><span class="hs-identifier hs-var">tys</span></a></span></span><span>
</span><span id="line-1552"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">equalLength</span><span> </span><span class="hs-identifier">args</span><span> </span><span class="hs-identifier">tys</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-identifier">mapM</span><span> </span><span class="hs-identifier">go</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">args</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">zip</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">tys</span><span class="hs-special">)</span><span>
</span><span id="line-1553"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1554"></span><span>    </span><span id="local-6989586621681093116"><span class="annot"><span class="annottext">go :: (GenLocated l (HsTupArg GhcRn), TcType)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (GenLocated l (HsTupArg GhcTc))
</span><a href="#local-6989586621681093116"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681093111"><span class="annot"><span class="annottext">l
</span><a href="#local-6989586621681093111"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#Missing"><span class="hs-identifier hs-type">Missing</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">,</span><span>   </span><span id="local-6989586621681093110"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093110"><span class="hs-identifier hs-var">arg_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681093109"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093109"><span class="hs-identifier hs-var">mult</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#newFlexiTyVarTy"><span class="hs-identifier hs-var">newFlexiTyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="GHC.Builtin.Types.html#multiplicityTy"><span class="hs-identifier hs-var">multiplicityTy</span></a></span><span>
</span><span id="line-1555"></span><span>                                         </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">GenLocated l (HsTupArg GhcTc)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (GenLocated l (HsTupArg GhcTc))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">l -&gt; HsTupArg GhcTc -&gt; GenLocated l (HsTupArg GhcTc)
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">l
</span><a href="#local-6989586621681093111"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XMissing GhcTc -&gt; HsTupArg GhcTc
forall id. XMissing id -&gt; HsTupArg id
</span><a href="GHC.Hs.Expr.html#Missing"><span class="hs-identifier hs-var">Missing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; TcType -&gt; Scaled TcType
forall a. TcType -&gt; a -&gt; Scaled a
</span><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-var">Scaled</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093109"><span class="hs-identifier hs-var">mult</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093110"><span class="hs-identifier hs-var">arg_ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1556"></span><span>    </span><span class="annot"><a href="#local-6989586621681093116"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681093107"><span class="annot"><span class="annottext">l
</span><a href="#local-6989586621681093107"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#Present"><span class="hs-identifier hs-type">Present</span></a></span><span> </span><span id="local-6989586621681093105"><span class="annot"><span class="annottext">XPresent GhcRn
</span><a href="#local-6989586621681093105"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621681093104"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093104"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093103"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093103"><span class="hs-identifier hs-var">arg_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681093102"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681093102"><span class="hs-identifier hs-var">expr'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; TcType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExpr"><span class="hs-identifier hs-var">tcCheckPolyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681093104"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093103"><span class="hs-identifier hs-var">arg_ty</span></a></span><span>
</span><span id="line-1557"></span><span>                                           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">GenLocated l (HsTupArg GhcTc)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (GenLocated l (HsTupArg GhcTc))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">l -&gt; HsTupArg GhcTc -&gt; GenLocated l (HsTupArg GhcTc)
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">l
</span><a href="#local-6989586621681093107"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XPresent GhcTc -&gt; LHsExpr GhcTc -&gt; HsTupArg GhcTc
forall id. XPresent id -&gt; LHsExpr id -&gt; HsTupArg id
</span><a href="GHC.Hs.Expr.html#Present"><span class="hs-identifier hs-var">Present</span></a></span><span> </span><span class="annot"><span class="annottext">XPresent GhcRn
XPresent GhcTc
</span><a href="#local-6989586621681093105"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681093102"><span class="hs-identifier hs-var">expr'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1558"></span><span>
</span><span id="line-1559"></span><span class="hs-comment">---------------------------</span><span>
</span><span id="line-1560"></span><span class="hs-comment">-- See TcType.SyntaxOpType also for commentary</span><span>
</span><span id="line-1561"></span><span id="local-6989586621681095096"><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOp"><span class="hs-identifier hs-type">tcSyntaxOp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a></span><span>
</span><span id="line-1562"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#SyntaxExprRn"><span class="hs-identifier hs-type">SyntaxExprRn</span></a></span><span>
</span><span id="line-1563"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#SyntaxOpType"><span class="hs-identifier hs-type">SyntaxOpType</span></a></span><span class="hs-special">]</span><span>           </span><span class="hs-comment">-- ^ shape of syntax operator arguments</span><span>
</span><span id="line-1564"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span>               </span><span class="hs-comment">-- ^ overall result type</span><span>
</span><span id="line-1565"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Mult"><span class="hs-identifier hs-type">Mult</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681095096"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ Type check any arguments,</span><span>
</span><span id="line-1566"></span><span>                                                 </span><span class="hs-comment">-- takes a type per hole and a</span><span>
</span><span id="line-1567"></span><span>                                                 </span><span class="hs-comment">-- multiplicity per arrow in</span><span>
</span><span id="line-1568"></span><span>                                                 </span><span class="hs-comment">-- the shape.</span><span>
</span><span id="line-1569"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681095096"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#SyntaxExprTc"><span class="hs-identifier hs-type">SyntaxExprTc</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1570"></span><span class="hs-comment">-- ^ Typecheck a syntax operator</span><span>
</span><span id="line-1571"></span><span class="hs-comment">-- The operator is a variable or a lambda at this stage (i.e. renamer</span><span>
</span><span id="line-1572"></span><span class="hs-comment">-- output)</span><span>
</span><span id="line-1573"></span><span id="tcSyntaxOp"><span class="annot"><span class="annottext">tcSyntaxOp :: forall a.
CtOrigin
-&gt; SyntaxExprRn
-&gt; [SyntaxOpType]
-&gt; ExpRhoType
-&gt; ([TcType] -&gt; [TcType] -&gt; TcM a)
-&gt; TcM (a, SyntaxExprTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOp"><span class="hs-identifier hs-var hs-var">tcSyntaxOp</span></a></span></span><span> </span><span id="local-6989586621681093101"><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621681093101"><span class="hs-identifier hs-var">orig</span></a></span></span><span> </span><span id="local-6989586621681093100"><span class="annot"><span class="annottext">SyntaxExprRn
</span><a href="#local-6989586621681093100"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span id="local-6989586621681093099"><span class="annot"><span class="annottext">[SyntaxOpType]
</span><a href="#local-6989586621681093099"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span> </span><span id="local-6989586621681093098"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093098"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-1574"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CtOrigin
-&gt; SyntaxExprRn
-&gt; [SyntaxOpType]
-&gt; SyntaxOpType
-&gt; ([TcType] -&gt; [TcType] -&gt; TcM a)
-&gt; TcM (a, SyntaxExprTc)
forall a.
CtOrigin
-&gt; SyntaxExprRn
-&gt; [SyntaxOpType]
-&gt; SyntaxOpType
-&gt; ([TcType] -&gt; [TcType] -&gt; TcM a)
-&gt; TcM (a, SyntaxExprTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOpGen"><span class="hs-identifier hs-var">tcSyntaxOpGen</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621681093101"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxExprRn
</span><a href="#local-6989586621681093100"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">[SyntaxOpType]
</span><a href="#local-6989586621681093099"><span class="hs-identifier hs-var">arg_tys</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ExpRhoType -&gt; SyntaxOpType
</span><a href="GHC.Tc.Utils.TcType.html#SynType"><span class="hs-identifier hs-var">SynType</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093098"><span class="hs-identifier hs-var">res_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1575"></span><span>
</span><span id="line-1576"></span><span class="hs-comment">-- | Slightly more general version of 'tcSyntaxOp' that allows the caller</span><span>
</span><span id="line-1577"></span><span class="hs-comment">-- to specify the shape of the result of the syntax operator</span><span>
</span><span id="line-1578"></span><span id="local-6989586621681094872"><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOpGen"><span class="hs-identifier hs-type">tcSyntaxOpGen</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a></span><span>
</span><span id="line-1579"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#SyntaxExprRn"><span class="hs-identifier hs-type">SyntaxExprRn</span></a></span><span>
</span><span id="line-1580"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#SyntaxOpType"><span class="hs-identifier hs-type">SyntaxOpType</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1581"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#SyntaxOpType"><span class="hs-identifier hs-type">SyntaxOpType</span></a></span><span>
</span><span id="line-1582"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Mult"><span class="hs-identifier hs-type">Mult</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681094872"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1583"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681094872"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#SyntaxExprTc"><span class="hs-identifier hs-type">SyntaxExprTc</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1584"></span><span id="tcSyntaxOpGen"><span class="annot"><span class="annottext">tcSyntaxOpGen :: forall a.
CtOrigin
-&gt; SyntaxExprRn
-&gt; [SyntaxOpType]
-&gt; SyntaxOpType
-&gt; ([TcType] -&gt; [TcType] -&gt; TcM a)
-&gt; TcM (a, SyntaxExprTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOpGen"><span class="hs-identifier hs-var hs-var">tcSyntaxOpGen</span></a></span></span><span> </span><span id="local-6989586621681093081"><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621681093081"><span class="hs-identifier hs-var">orig</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#SyntaxExprRn"><span class="hs-identifier hs-type">SyntaxExprRn</span></a></span><span> </span><span id="local-6989586621681093079"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681093079"><span class="hs-identifier hs-var">op</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681093078"><span class="annot"><span class="annottext">[SyntaxOpType]
</span><a href="#local-6989586621681093078"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span> </span><span id="local-6989586621681093077"><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="#local-6989586621681093077"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span id="local-6989586621681093076"><span class="annot"><span class="annottext">[TcType] -&gt; [TcType] -&gt; TcM a
</span><a href="#local-6989586621681093076"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1585"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681093075"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681093075"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093074"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093074"><span class="hs-identifier hs-var">sigma</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; TcM (HsExpr GhcTc, TcType)
</span><a href="GHC.Tc.Gen.Expr.html#tcInferAppHead"><span class="hs-identifier hs-var">tcInferAppHead</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681093079"><span class="hs-identifier hs-var">op</span></a></span><span>
</span><span id="line-1586"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcSyntaxOpGen&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681093079"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681093075"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">TcType -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093074"><span class="hs-identifier hs-var">sigma</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1587"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681093073"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681093073"><span class="hs-identifier hs-var">result</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093072"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681093072"><span class="hs-identifier hs-var">expr_wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093071"><span class="annot"><span class="annottext">[HsWrapper]
</span><a href="#local-6989586621681093071"><span class="hs-identifier hs-var">arg_wraps</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093070"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681093070"><span class="hs-identifier hs-var">res_wrap</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1588"></span><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin
-&gt; TcType
-&gt; [SyntaxOpType]
-&gt; SyntaxOpType
-&gt; ([TcType] -&gt; [TcType] -&gt; TcM a)
-&gt; TcM (a, HsWrapper, [HsWrapper], HsWrapper)
forall a.
CtOrigin
-&gt; TcType
-&gt; [SyntaxOpType]
-&gt; SyntaxOpType
-&gt; ([TcType] -&gt; [TcType] -&gt; TcM a)
-&gt; TcM (a, HsWrapper, [HsWrapper], HsWrapper)
</span><a href="GHC.Tc.Gen.Expr.html#tcSynArgA"><span class="hs-identifier hs-var">tcSynArgA</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621681093081"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093074"><span class="hs-identifier hs-var">sigma</span></a></span><span> </span><span class="annot"><span class="annottext">[SyntaxOpType]
</span><a href="#local-6989586621681093078"><span class="hs-identifier hs-var">arg_tys</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="#local-6989586621681093077"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">(([TcType] -&gt; [TcType] -&gt; TcM a)
 -&gt; TcM (a, HsWrapper, [HsWrapper], HsWrapper))
-&gt; ([TcType] -&gt; [TcType] -&gt; TcM a)
-&gt; TcM (a, HsWrapper, [HsWrapper], HsWrapper)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1589"></span><span>              </span><span class="annot"><span class="annottext">[TcType] -&gt; [TcType] -&gt; TcM a
</span><a href="#local-6989586621681093076"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-1590"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcSyntaxOpGen&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681093079"><span class="hs-identifier hs-var">op</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681093075"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">TcType -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093074"><span class="hs-identifier hs-var">sigma</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-1591"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(a, SyntaxExprTc) -&gt; TcM (a, SyntaxExprTc)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681093073"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SyntaxExprTc :: HsExpr GhcTc -&gt; [HsWrapper] -&gt; HsWrapper -&gt; SyntaxExprTc
</span><a href="GHC.Hs.Expr.html#SyntaxExprTc"><span class="hs-identifier hs-type">SyntaxExprTc</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">syn_expr :: HsExpr GhcTc
</span><a href="GHC.Hs.Expr.html#syn_expr"><span class="hs-identifier hs-var">syn_expr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrap"><span class="hs-identifier hs-var">mkHsWrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681093072"><span class="hs-identifier hs-var">expr_wrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681093075"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-1592"></span><span>                                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">syn_arg_wraps :: [HsWrapper]
</span><a href="GHC.Hs.Expr.html#syn_arg_wraps"><span class="hs-identifier hs-var">syn_arg_wraps</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[HsWrapper]
</span><a href="#local-6989586621681093071"><span class="hs-identifier hs-var">arg_wraps</span></a></span><span>
</span><span id="line-1593"></span><span>                                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">syn_res_wrap :: HsWrapper
</span><a href="GHC.Hs.Expr.html#syn_res_wrap"><span class="hs-identifier hs-var">syn_res_wrap</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681093070"><span class="hs-identifier hs-var">res_wrap</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1594"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcSyntaxOpGen"><span class="hs-identifier hs-var">tcSyntaxOpGen</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SyntaxExprRn
</span><a href="GHC.Hs.Expr.html#NoSyntaxExprRn"><span class="hs-identifier hs-var">NoSyntaxExprRn</span></a></span><span> </span><span class="annot"><span class="annottext">[SyntaxOpType]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SyntaxOpType
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[TcType] -&gt; [TcType] -&gt; TcM a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; TcM (a, SyntaxExprTc)
forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcSyntaxOpGen&quot;</span></span><span>
</span><span id="line-1595"></span><span>
</span><span id="line-1596"></span><span class="hs-comment">{-
Note [tcSynArg]
~~~~~~~~~~~~~~~
Because of the rich structure of SyntaxOpType, we must do the
contra-/covariant thing when working down arrows, to get the
instantiation vs. skolemisation decisions correct (and, more
obviously, the orientation of the HsWrappers). We thus have
two tcSynArgs.
-}</span><span>
</span><span id="line-1605"></span><span>
</span><span id="line-1606"></span><span class="hs-comment">-- works on &quot;expected&quot; types, skolemising where necessary</span><span>
</span><span id="line-1607"></span><span class="hs-comment">-- See Note [tcSynArg]</span><span>
</span><span id="line-1608"></span><span id="local-6989586621681094869"><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcSynArgE"><span class="hs-identifier hs-type">tcSynArgE</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a></span><span>
</span><span id="line-1609"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span>
</span><span id="line-1610"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#SyntaxOpType"><span class="hs-identifier hs-type">SyntaxOpType</span></a></span><span>                </span><span class="hs-comment">-- ^ shape it is expected to have</span><span>
</span><span id="line-1611"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Mult"><span class="hs-identifier hs-type">Mult</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681094869"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ check the arguments</span><span>
</span><span id="line-1612"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681094869"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1613"></span><span>           </span><span class="hs-comment">-- ^ returns a wrapper :: (type of right shape) &quot;-&gt;&quot; (type passed in)</span><span>
</span><span id="line-1614"></span><span id="tcSynArgE"><span class="annot"><span class="annottext">tcSynArgE :: forall a.
CtOrigin
-&gt; TcType
-&gt; SyntaxOpType
-&gt; ([TcType] -&gt; [TcType] -&gt; TcM a)
-&gt; TcM (a, HsWrapper)
</span><a href="GHC.Tc.Gen.Expr.html#tcSynArgE"><span class="hs-identifier hs-var hs-var">tcSynArgE</span></a></span></span><span> </span><span id="local-6989586621681093037"><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621681093037"><span class="hs-identifier hs-var">orig</span></a></span></span><span> </span><span id="local-6989586621681093036"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093036"><span class="hs-identifier hs-var">sigma_ty</span></a></span></span><span> </span><span id="local-6989586621681093035"><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="#local-6989586621681093035"><span class="hs-identifier hs-var">syn_ty</span></a></span></span><span> </span><span id="local-6989586621681093034"><span class="annot"><span class="annottext">[TcType] -&gt; [TcType] -&gt; TcM a
</span><a href="#local-6989586621681093034"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1615"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681093033"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681093033"><span class="hs-identifier hs-var">skol_wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681093032"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681093032"><span class="hs-identifier hs-var">result</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093031"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681093031"><span class="hs-identifier hs-var">ty_wrapper</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1616"></span><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
-&gt; TcType
-&gt; (TcType -&gt; TcM (a, HsWrapper))
-&gt; TcM (HsWrapper, (a, HsWrapper))
forall result.
UserTypeCtxt
-&gt; TcType -&gt; (TcType -&gt; TcM result) -&gt; TcM (HsWrapper, result)
</span><a href="GHC.Tc.Utils.Unify.html#tcSkolemise"><span class="hs-identifier hs-var">tcSkolemise</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#GenSigCtxt"><span class="hs-identifier hs-var">GenSigCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093036"><span class="hs-identifier hs-var">sigma_ty</span></a></span><span> </span><span class="annot"><span class="annottext">((TcType -&gt; TcM (a, HsWrapper)) -&gt; TcM (HsWrapper, (a, HsWrapper)))
-&gt; (TcType -&gt; TcM (a, HsWrapper))
-&gt; TcM (HsWrapper, (a, HsWrapper))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681093029"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093029"><span class="hs-identifier hs-var">rho_ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1617"></span><span>              </span><span class="annot"><span class="annottext">TcType -&gt; SyntaxOpType -&gt; TcM (a, HsWrapper)
</span><a href="#local-6989586621681093028"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093029"><span class="hs-identifier hs-var">rho_ty</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="#local-6989586621681093035"><span class="hs-identifier hs-var">syn_ty</span></a></span><span>
</span><span id="line-1618"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(a, HsWrapper) -&gt; TcM (a, HsWrapper)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681093032"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681093033"><span class="hs-identifier hs-var">skol_wrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsWrapper -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681093031"><span class="hs-identifier hs-var">ty_wrapper</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1619"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-1620"></span><span>    </span><span id="local-6989586621681093028"><span class="annot"><span class="annottext">go :: TcType -&gt; SyntaxOpType -&gt; TcM (a, HsWrapper)
</span><a href="#local-6989586621681093028"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621681093027"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093027"><span class="hs-identifier hs-var">rho_ty</span></a></span></span><span> </span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="GHC.Tc.Utils.TcType.html#SynAny"><span class="hs-identifier hs-var">SynAny</span></a></span><span>
</span><span id="line-1621"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681093026"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681093026"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TcType] -&gt; [TcType] -&gt; TcM a
</span><a href="#local-6989586621681093034"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093027"><span class="hs-identifier hs-var">rho_ty</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1622"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(a, HsWrapper) -&gt; TcM (a, HsWrapper)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681093026"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#idHsWrapper"><span class="hs-identifier hs-var">idHsWrapper</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1623"></span><span>
</span><span id="line-1624"></span><span>    </span><span class="annot"><a href="#local-6989586621681093028"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681093025"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093025"><span class="hs-identifier hs-var">rho_ty</span></a></span></span><span> </span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="GHC.Tc.Utils.TcType.html#SynRho"><span class="hs-identifier hs-var">SynRho</span></a></span><span>   </span><span class="hs-comment">-- same as SynAny, because we skolemise eagerly</span><span>
</span><span id="line-1625"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681093023"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681093023"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TcType] -&gt; [TcType] -&gt; TcM a
</span><a href="#local-6989586621681093034"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093025"><span class="hs-identifier hs-var">rho_ty</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1626"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(a, HsWrapper) -&gt; TcM (a, HsWrapper)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681093023"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#idHsWrapper"><span class="hs-identifier hs-var">idHsWrapper</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1627"></span><span>
</span><span id="line-1628"></span><span>    </span><span class="annot"><a href="#local-6989586621681093028"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681093022"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093022"><span class="hs-identifier hs-var">rho_ty</span></a></span></span><span> </span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="GHC.Tc.Utils.TcType.html#SynList"><span class="hs-identifier hs-var">SynList</span></a></span><span>
</span><span id="line-1629"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681093021"><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621681093021"><span class="hs-identifier hs-var">list_co</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093020"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093020"><span class="hs-identifier hs-var">elt_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcM (TcCoercionR, TcType)
</span><a href="GHC.Tc.Utils.Unify.html#matchExpectedListTy"><span class="hs-identifier hs-var">matchExpectedListTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093022"><span class="hs-identifier hs-var">rho_ty</span></a></span><span>
</span><span id="line-1630"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681093019"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681093019"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TcType] -&gt; [TcType] -&gt; TcM a
</span><a href="#local-6989586621681093034"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093020"><span class="hs-identifier hs-var">elt_ty</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1631"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(a, HsWrapper) -&gt; TcM (a, HsWrapper)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681093019"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcCoercionR -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#mkWpCastN"><span class="hs-identifier hs-var">mkWpCastN</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621681093021"><span class="hs-identifier hs-var">list_co</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1632"></span><span>
</span><span id="line-1633"></span><span>    </span><span class="annot"><a href="#local-6989586621681093028"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681093018"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093018"><span class="hs-identifier hs-var">rho_ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#SynFun"><span class="hs-identifier hs-type">SynFun</span></a></span><span> </span><span id="local-6989586621681093016"><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="#local-6989586621681093016"><span class="hs-identifier hs-var">arg_shape</span></a></span></span><span> </span><span id="local-6989586621681093015"><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="#local-6989586621681093015"><span class="hs-identifier hs-var">res_shape</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1634"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span> </span><span id="local-6989586621681093014"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681093014"><span class="hs-identifier hs-var">match_wrapper</span></a></span></span><span>                         </span><span class="hs-comment">-- :: (arg_ty -&gt; res_ty) &quot;-&gt;&quot; rho_ty</span><span>
</span><span id="line-1635"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681093013"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681093013"><span class="hs-identifier hs-var">result</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093012"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093012"><span class="hs-identifier hs-var">arg_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093011"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093011"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093010"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093010"><span class="hs-identifier hs-var">op_mult</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1636"></span><span>                 </span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093009"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681093009"><span class="hs-identifier hs-var">res_wrapper</span></a></span></span><span> </span><span class="hs-special">)</span><span>                     </span><span class="hs-comment">-- :: res_ty_out &quot;-&gt;&quot; res_ty</span><span>
</span><span id="line-1637"></span><span>               </span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093008"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681093008"><span class="hs-identifier hs-var">arg_wrapper1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span id="local-6989586621681093007"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681093007"><span class="hs-identifier hs-var">arg_wrapper2</span></a></span></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- :: arg_ty &quot;-&gt;&quot; arg_ty_out</span><span>
</span><span id="line-1638"></span><span>               </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SDoc
-&gt; UserTypeCtxt
-&gt; ThLevel
-&gt; ExpRhoType
-&gt; ([Scaled ExpRhoType]
    -&gt; ExpRhoType
    -&gt; TcM
         (((a, TcType, TcType, TcType), HsWrapper), HsWrapper, [HsWrapper],
          HsWrapper))
-&gt; TcM
     (HsWrapper,
      (((a, TcType, TcType, TcType), HsWrapper), HsWrapper, [HsWrapper],
       HsWrapper))
forall a.
SDoc
-&gt; UserTypeCtxt
-&gt; ThLevel
-&gt; ExpRhoType
-&gt; ([Scaled ExpRhoType] -&gt; ExpRhoType -&gt; TcM a)
-&gt; TcM (HsWrapper, a)
</span><a href="GHC.Tc.Utils.Unify.html#matchExpectedFunTys"><span class="hs-identifier hs-var">matchExpectedFunTys</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681093005"><span class="hs-identifier hs-var">herald</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#GenSigCtxt"><span class="hs-identifier hs-var">GenSigCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><span class="hs-number">1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; ExpRhoType
</span><a href="GHC.Tc.Utils.TcType.html#mkCheckExpType"><span class="hs-identifier hs-var">mkCheckExpType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093018"><span class="hs-identifier hs-var">rho_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(([Scaled ExpRhoType]
  -&gt; ExpRhoType
  -&gt; TcM
       (((a, TcType, TcType, TcType), HsWrapper), HsWrapper, [HsWrapper],
        HsWrapper))
 -&gt; TcM
      (HsWrapper,
       (((a, TcType, TcType, TcType), HsWrapper), HsWrapper, [HsWrapper],
        HsWrapper)))
-&gt; ([Scaled ExpRhoType]
    -&gt; ExpRhoType
    -&gt; TcM
         (((a, TcType, TcType, TcType), HsWrapper), HsWrapper, [HsWrapper],
          HsWrapper))
-&gt; TcM
     (HsWrapper,
      (((a, TcType, TcType, TcType), HsWrapper), HsWrapper, [HsWrapper],
       HsWrapper))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1639"></span><span>                  </span><span class="hs-glyph">\</span><span> </span><span class="hs-special">[</span><span id="local-6989586621681093004"><span class="annot"><span class="annottext">Scaled ExpRhoType
</span><a href="#local-6989586621681093004"><span class="hs-identifier hs-var">arg_ty</span></a></span></span><span class="hs-special">]</span><span> </span><span id="local-6989586621681093003"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093003"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1640"></span><span>                  </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681093002"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093002"><span class="hs-identifier hs-var">arg_tc_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpRhoType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#expTypeToType"><span class="hs-identifier hs-var">expTypeToType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scaled ExpRhoType -&gt; ExpRhoType
forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpRhoType
</span><a href="#local-6989586621681093004"><span class="hs-identifier hs-var">arg_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1641"></span><span>                     </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681093001"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093001"><span class="hs-identifier hs-var">res_tc_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpRhoType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#expTypeToType"><span class="hs-identifier hs-var">expTypeToType</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681093003"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-1642"></span><span>
</span><span id="line-1643"></span><span>                         </span><span class="hs-comment">-- another nested arrow is too much for now,</span><span>
</span><span id="line-1644"></span><span>                         </span><span class="hs-comment">-- but I bet we'll never need this</span><span>
</span><span id="line-1645"></span><span>                     </span><span class="hs-special">;</span><span> </span><span class="hs-identifier">MASSERT2</span><span class="hs-special">(</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">arg_shape</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1646"></span><span>                                   </span><span class="hs-identifier">SynFun</span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">False</span><span class="hs-special">;</span><span>
</span><span id="line-1647"></span><span>                                   </span><span class="hs-identifier">_</span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">True</span><span>
</span><span id="line-1648"></span><span>                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">text</span><span> </span><span class="hs-string">&quot;Too many nested arrows in SyntaxOpType&quot;</span><span> </span><span class="hs-operator">$$</span><span>
</span><span id="line-1649"></span><span>                                 </span><span class="hs-identifier">pprCtOrigin</span><span> </span><span class="hs-identifier">orig</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-1650"></span><span>
</span><span id="line-1651"></span><span>                     </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681092998"><span class="annot"><span class="annottext">arg_mult :: TcType
</span><a href="#local-6989586621681092998"><span class="hs-identifier hs-var hs-var">arg_mult</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Scaled ExpRhoType -&gt; TcType
forall a. Scaled a -&gt; TcType
</span><a href="GHC.Core.TyCo.Rep.html#scaledMult"><span class="hs-identifier hs-var">scaledMult</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled ExpRhoType
</span><a href="#local-6989586621681093004"><span class="hs-identifier hs-var">arg_ty</span></a></span><span>
</span><span id="line-1652"></span><span>                     </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">CtOrigin
-&gt; TcType
-&gt; [SyntaxOpType]
-&gt; SyntaxOpType
-&gt; ([TcType]
    -&gt; [TcType] -&gt; TcM ((a, TcType, TcType, TcType), HsWrapper))
-&gt; TcM
     (((a, TcType, TcType, TcType), HsWrapper), HsWrapper, [HsWrapper],
      HsWrapper)
forall a.
CtOrigin
-&gt; TcType
-&gt; [SyntaxOpType]
-&gt; SyntaxOpType
-&gt; ([TcType] -&gt; [TcType] -&gt; TcM a)
-&gt; TcM (a, HsWrapper, [HsWrapper], HsWrapper)
</span><a href="GHC.Tc.Gen.Expr.html#tcSynArgA"><span class="hs-identifier hs-var">tcSynArgA</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621681093037"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093002"><span class="hs-identifier hs-var">arg_tc_ty</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="#local-6989586621681093016"><span class="hs-identifier hs-var">arg_shape</span></a></span><span> </span><span class="annot"><span class="annottext">(([TcType]
  -&gt; [TcType] -&gt; TcM ((a, TcType, TcType, TcType), HsWrapper))
 -&gt; TcM
      (((a, TcType, TcType, TcType), HsWrapper), HsWrapper, [HsWrapper],
       HsWrapper))
-&gt; ([TcType]
    -&gt; [TcType] -&gt; TcM ((a, TcType, TcType, TcType), HsWrapper))
-&gt; TcM
     (((a, TcType, TcType, TcType), HsWrapper), HsWrapper, [HsWrapper],
      HsWrapper)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1653"></span><span>                       </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681092997"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681092997"><span class="hs-identifier hs-var">arg_results</span></a></span></span><span> </span><span id="local-6989586621681092996"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681092996"><span class="hs-identifier hs-var">arg_res_mults</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1654"></span><span>                       </span><span class="annot"><span class="annottext">CtOrigin
-&gt; TcType
-&gt; SyntaxOpType
-&gt; ([TcType] -&gt; [TcType] -&gt; TcM (a, TcType, TcType, TcType))
-&gt; TcM ((a, TcType, TcType, TcType), HsWrapper)
forall a.
CtOrigin
-&gt; TcType
-&gt; SyntaxOpType
-&gt; ([TcType] -&gt; [TcType] -&gt; TcM a)
-&gt; TcM (a, HsWrapper)
</span><a href="GHC.Tc.Gen.Expr.html#tcSynArgE"><span class="hs-identifier hs-var">tcSynArgE</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621681093037"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093001"><span class="hs-identifier hs-var">res_tc_ty</span></a></span><span> </span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="#local-6989586621681093015"><span class="hs-identifier hs-var">res_shape</span></a></span><span> </span><span class="annot"><span class="annottext">(([TcType] -&gt; [TcType] -&gt; TcM (a, TcType, TcType, TcType))
 -&gt; TcM ((a, TcType, TcType, TcType), HsWrapper))
-&gt; ([TcType] -&gt; [TcType] -&gt; TcM (a, TcType, TcType, TcType))
-&gt; TcM ((a, TcType, TcType, TcType), HsWrapper)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1655"></span><span>                       </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681092995"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681092995"><span class="hs-identifier hs-var">res_results</span></a></span></span><span> </span><span id="local-6989586621681092994"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681092994"><span class="hs-identifier hs-var">res_res_mults</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1656"></span><span>                       </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681092993"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681092993"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TcType] -&gt; [TcType] -&gt; TcM a
</span><a href="#local-6989586621681093034"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681092997"><span class="hs-identifier hs-var">arg_results</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType] -&gt; [TcType] -&gt; [TcType]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681092995"><span class="hs-identifier hs-var">res_results</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092998"><span class="hs-identifier hs-var">arg_mult</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[TcType] -&gt; [TcType] -&gt; [TcType]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681092996"><span class="hs-identifier hs-var">arg_res_mults</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType] -&gt; [TcType] -&gt; [TcType]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681092994"><span class="hs-identifier hs-var">res_res_mults</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1657"></span><span>                          </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(a, TcType, TcType, TcType) -&gt; TcM (a, TcType, TcType, TcType)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681092993"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093002"><span class="hs-identifier hs-var">arg_tc_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093001"><span class="hs-identifier hs-var">res_tc_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092998"><span class="hs-identifier hs-var">arg_mult</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><span id="line-1658"></span><span>
</span><span id="line-1659"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(a, HsWrapper) -&gt; TcM (a, HsWrapper)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681093013"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-1660"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681093014"><span class="hs-identifier hs-var">match_wrapper</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsWrapper -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span>
</span><span id="line-1661"></span><span>                      </span><span class="annot"><span class="annottext">HsWrapper
-&gt; HsWrapper -&gt; Scaled TcType -&gt; TcType -&gt; SDoc -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#mkWpFun"><span class="hs-identifier hs-var">mkWpFun</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681093007"><span class="hs-identifier hs-var">arg_wrapper2</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsWrapper -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681093008"><span class="hs-identifier hs-var">arg_wrapper1</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681093009"><span class="hs-identifier hs-var">res_wrapper</span></a></span><span>
</span><span id="line-1662"></span><span>                              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; TcType -&gt; Scaled TcType
forall a. TcType -&gt; a -&gt; Scaled a
</span><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-var">Scaled</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093010"><span class="hs-identifier hs-var">op_mult</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093012"><span class="hs-identifier hs-var">arg_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681093011"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681092991"><span class="hs-identifier hs-var">doc</span></a></span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1663"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-1664"></span><span>        </span><span id="local-6989586621681093005"><span class="annot"><span class="annottext">herald :: SDoc
</span><a href="#local-6989586621681093005"><span class="hs-identifier hs-var hs-var">herald</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;This rebindable syntax expects a function with&quot;</span></span><span>
</span><span id="line-1665"></span><span>        </span><span id="local-6989586621681092991"><span class="annot"><span class="annottext">doc :: SDoc
</span><a href="#local-6989586621681092991"><span class="hs-identifier hs-var hs-var">doc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;When checking a rebindable syntax operator arising from&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621681093037"><span class="hs-identifier hs-var">orig</span></a></span><span>
</span><span id="line-1666"></span><span>
</span><span id="line-1667"></span><span>    </span><span class="annot"><a href="#local-6989586621681093028"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681092990"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092990"><span class="hs-identifier hs-var">rho_ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#SynType"><span class="hs-identifier hs-type">SynType</span></a></span><span> </span><span id="local-6989586621681092989"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681092989"><span class="hs-identifier hs-var">the_ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1668"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681092988"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681092988"><span class="hs-identifier hs-var">wrap</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; UserTypeCtxt -&gt; ExpRhoType -&gt; TcType -&gt; TcM HsWrapper
</span><a href="GHC.Tc.Utils.Unify.html#tcSubTypePat"><span class="hs-identifier hs-var">tcSubTypePat</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621681093037"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#GenSigCtxt"><span class="hs-identifier hs-var">GenSigCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681092989"><span class="hs-identifier hs-var">the_ty</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092990"><span class="hs-identifier hs-var">rho_ty</span></a></span><span>
</span><span id="line-1669"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681092986"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681092986"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TcType] -&gt; [TcType] -&gt; TcM a
</span><a href="#local-6989586621681093034"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1670"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(a, HsWrapper) -&gt; TcM (a, HsWrapper)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681092986"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681092988"><span class="hs-identifier hs-var">wrap</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1671"></span><span>
</span><span id="line-1672"></span><span class="hs-comment">-- works on &quot;actual&quot; types, instantiating where necessary</span><span>
</span><span id="line-1673"></span><span class="hs-comment">-- See Note [tcSynArg]</span><span>
</span><span id="line-1674"></span><span id="local-6989586621681094870"><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcSynArgA"><span class="hs-identifier hs-type">tcSynArgA</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html#CtOrigin"><span class="hs-identifier hs-type">CtOrigin</span></a></span><span>
</span><span id="line-1675"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span>
</span><span id="line-1676"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#SyntaxOpType"><span class="hs-identifier hs-type">SyntaxOpType</span></a></span><span class="hs-special">]</span><span>              </span><span class="hs-comment">-- ^ argument shapes</span><span>
</span><span id="line-1677"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#SyntaxOpType"><span class="hs-identifier hs-type">SyntaxOpType</span></a></span><span>                </span><span class="hs-comment">-- ^ result shape</span><span>
</span><span id="line-1678"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Mult"><span class="hs-identifier hs-type">Mult</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681094870"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ check the arguments</span><span>
</span><span id="line-1679"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681094870"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1680"></span><span>            </span><span class="hs-comment">-- ^ returns a wrapper to be applied to the original function,</span><span>
</span><span id="line-1681"></span><span>            </span><span class="hs-comment">-- wrappers to be applied to arguments</span><span>
</span><span id="line-1682"></span><span>            </span><span class="hs-comment">-- and a wrapper to be applied to the overall expression</span><span>
</span><span id="line-1683"></span><span id="tcSynArgA"><span class="annot"><span class="annottext">tcSynArgA :: forall a.
CtOrigin
-&gt; TcType
-&gt; [SyntaxOpType]
-&gt; SyntaxOpType
-&gt; ([TcType] -&gt; [TcType] -&gt; TcM a)
-&gt; TcM (a, HsWrapper, [HsWrapper], HsWrapper)
</span><a href="GHC.Tc.Gen.Expr.html#tcSynArgA"><span class="hs-identifier hs-var hs-var">tcSynArgA</span></a></span></span><span> </span><span id="local-6989586621681092981"><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621681092981"><span class="hs-identifier hs-var">orig</span></a></span></span><span> </span><span id="local-6989586621681092980"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092980"><span class="hs-identifier hs-var">sigma_ty</span></a></span></span><span> </span><span id="local-6989586621681092979"><span class="annot"><span class="annottext">[SyntaxOpType]
</span><a href="#local-6989586621681092979"><span class="hs-identifier hs-var">arg_shapes</span></a></span></span><span> </span><span id="local-6989586621681092978"><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="#local-6989586621681092978"><span class="hs-identifier hs-var">res_shape</span></a></span></span><span> </span><span id="local-6989586621681092977"><span class="annot"><span class="annottext">[TcType] -&gt; [TcType] -&gt; TcM a
</span><a href="#local-6989586621681092977"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1684"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681092976"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681092976"><span class="hs-identifier hs-var">match_wrapper</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681092975"><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681092975"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681092974"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092974"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1685"></span><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SDoc
-&gt; CtOrigin
-&gt; Maybe (HsExpr GhcRn)
-&gt; ThLevel
-&gt; TcType
-&gt; TcM (HsWrapper, [Scaled TcType], TcType)
</span><a href="GHC.Tc.Utils.Unify.html#matchActualFunTysRho"><span class="hs-identifier hs-var">matchActualFunTysRho</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681092973"><span class="hs-identifier hs-var">herald</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621681092981"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (HsExpr GhcRn)
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1686"></span><span>                                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SyntaxOpType] -&gt; ThLevel
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; ThLevel
</span><a href="../../base/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[SyntaxOpType]
</span><a href="#local-6989586621681092979"><span class="hs-identifier hs-var">arg_shapes</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092980"><span class="hs-identifier hs-var">sigma_ty</span></a></span><span>
</span><span id="line-1687"></span><span>              </span><span class="hs-comment">-- match_wrapper :: sigma_ty &quot;-&gt;&quot; (arg_tys -&gt; res_ty)</span><span>
</span><span id="line-1688"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621681092972"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681092972"><span class="hs-identifier hs-var">result</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681092971"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681092971"><span class="hs-identifier hs-var">res_wrapper</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621681092970"><span class="annot"><span class="annottext">[HsWrapper]
</span><a href="#local-6989586621681092970"><span class="hs-identifier hs-var">arg_wrappers</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1689"></span><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TcType]
-&gt; [SyntaxOpType]
-&gt; ([TcType] -&gt; [TcType] -&gt; TcM (a, HsWrapper))
-&gt; TcM ((a, HsWrapper), [HsWrapper])
forall a.
[TcType]
-&gt; [SyntaxOpType]
-&gt; ([TcType] -&gt; [TcType] -&gt; TcM a)
-&gt; TcM (a, [HsWrapper])
</span><a href="#local-6989586621681092969"><span class="hs-identifier hs-var">tc_syn_args_e</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Scaled TcType -&gt; TcType) -&gt; [Scaled TcType] -&gt; [TcType]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled TcType -&gt; TcType
forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681092975"><span class="hs-identifier hs-var">arg_tys</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[SyntaxOpType]
</span><a href="#local-6989586621681092979"><span class="hs-identifier hs-var">arg_shapes</span></a></span><span> </span><span class="annot"><span class="annottext">(([TcType] -&gt; [TcType] -&gt; TcM (a, HsWrapper))
 -&gt; TcM ((a, HsWrapper), [HsWrapper]))
-&gt; ([TcType] -&gt; [TcType] -&gt; TcM (a, HsWrapper))
-&gt; TcM ((a, HsWrapper), [HsWrapper])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681092968"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681092968"><span class="hs-identifier hs-var">arg_results</span></a></span></span><span> </span><span id="local-6989586621681092967"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681092967"><span class="hs-identifier hs-var">arg_res_mults</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1690"></span><span>              </span><span class="annot"><span class="annottext">TcType -&gt; SyntaxOpType -&gt; ([TcType] -&gt; TcM a) -&gt; TcM (a, HsWrapper)
forall a.
TcType -&gt; SyntaxOpType -&gt; ([TcType] -&gt; TcM a) -&gt; TcM (a, HsWrapper)
</span><a href="#local-6989586621681092966"><span class="hs-identifier hs-var">tc_syn_arg</span></a></span><span>    </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092974"><span class="hs-identifier hs-var">res_ty</span></a></span><span>  </span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="#local-6989586621681092978"><span class="hs-identifier hs-var">res_shape</span></a></span><span>  </span><span class="annot"><span class="annottext">(([TcType] -&gt; TcM a) -&gt; TcM (a, HsWrapper))
-&gt; ([TcType] -&gt; TcM a) -&gt; TcM (a, HsWrapper)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681092965"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681092965"><span class="hs-identifier hs-var">res_results</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1691"></span><span>              </span><span class="annot"><span class="annottext">[TcType] -&gt; [TcType] -&gt; TcM a
</span><a href="#local-6989586621681092977"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681092968"><span class="hs-identifier hs-var">arg_results</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType] -&gt; [TcType] -&gt; [TcType]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681092965"><span class="hs-identifier hs-var">res_results</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Scaled TcType -&gt; TcType) -&gt; [Scaled TcType] -&gt; [TcType]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled TcType -&gt; TcType
forall a. Scaled a -&gt; TcType
</span><a href="GHC.Core.TyCo.Rep.html#scaledMult"><span class="hs-identifier hs-var">scaledMult</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681092975"><span class="hs-identifier hs-var">arg_tys</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType] -&gt; [TcType] -&gt; [TcType]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681092967"><span class="hs-identifier hs-var">arg_res_mults</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1692"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(a, HsWrapper, [HsWrapper], HsWrapper)
-&gt; TcM (a, HsWrapper, [HsWrapper], HsWrapper)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681092972"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681092976"><span class="hs-identifier hs-var">match_wrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[HsWrapper]
</span><a href="#local-6989586621681092970"><span class="hs-identifier hs-var">arg_wrappers</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681092971"><span class="hs-identifier hs-var">res_wrapper</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1693"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1694"></span><span>    </span><span id="local-6989586621681092973"><span class="annot"><span class="annottext">herald :: SDoc
</span><a href="#local-6989586621681092973"><span class="hs-identifier hs-var hs-var">herald</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;This rebindable syntax expects a function with&quot;</span></span><span>
</span><span id="line-1695"></span><span>
</span><span id="line-1696"></span><span>    </span><span id="local-6989586621681094862"><span class="annot"><a href="#local-6989586621681092969"><span class="hs-identifier hs-type">tc_syn_args_e</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#SyntaxOpType"><span class="hs-identifier hs-type">SyntaxOpType</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1697"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Mult"><span class="hs-identifier hs-type">Mult</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681094862"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1698"></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681094862"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span></span><span>
</span><span id="line-1699"></span><span>                    </span><span class="hs-comment">-- the wrappers are for arguments</span><span>
</span><span id="line-1700"></span><span>    </span><span id="local-6989586621681092969"><span class="annot"><span class="annottext">tc_syn_args_e :: forall a.
[TcType]
-&gt; [SyntaxOpType]
-&gt; ([TcType] -&gt; [TcType] -&gt; TcM a)
-&gt; TcM (a, [HsWrapper])
</span><a href="#local-6989586621681092969"><span class="hs-identifier hs-var hs-var">tc_syn_args_e</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681092961"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092961"><span class="hs-identifier hs-var">arg_ty</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681092960"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681092960"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681092959"><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="#local-6989586621681092959"><span class="hs-identifier hs-var">arg_shape</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681092958"><span class="annot"><span class="annottext">[SyntaxOpType]
</span><a href="#local-6989586621681092958"><span class="hs-identifier hs-var">arg_shapes</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681092957"><span class="annot"><span class="annottext">[TcType] -&gt; [TcType] -&gt; TcM a
</span><a href="#local-6989586621681092957"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1701"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621681092956"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681092956"><span class="hs-identifier hs-var">result</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681092955"><span class="annot"><span class="annottext">[HsWrapper]
</span><a href="#local-6989586621681092955"><span class="hs-identifier hs-var">arg_wraps</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621681092954"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681092954"><span class="hs-identifier hs-var">arg_wrap</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1702"></span><span>               </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin
-&gt; TcType
-&gt; SyntaxOpType
-&gt; ([TcType] -&gt; [TcType] -&gt; TcM (a, [HsWrapper]))
-&gt; TcM ((a, [HsWrapper]), HsWrapper)
forall a.
CtOrigin
-&gt; TcType
-&gt; SyntaxOpType
-&gt; ([TcType] -&gt; [TcType] -&gt; TcM a)
-&gt; TcM (a, HsWrapper)
</span><a href="GHC.Tc.Gen.Expr.html#tcSynArgE"><span class="hs-identifier hs-var">tcSynArgE</span></a></span><span>     </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621681092981"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092961"><span class="hs-identifier hs-var">arg_ty</span></a></span><span>  </span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="#local-6989586621681092959"><span class="hs-identifier hs-var">arg_shape</span></a></span><span>  </span><span class="annot"><span class="annottext">(([TcType] -&gt; [TcType] -&gt; TcM (a, [HsWrapper]))
 -&gt; TcM ((a, [HsWrapper]), HsWrapper))
-&gt; ([TcType] -&gt; [TcType] -&gt; TcM (a, [HsWrapper]))
-&gt; TcM ((a, [HsWrapper]), HsWrapper)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681092953"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681092953"><span class="hs-identifier hs-var">arg1_results</span></a></span></span><span> </span><span id="local-6989586621681092952"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681092952"><span class="hs-identifier hs-var">arg1_mults</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1703"></span><span>                  </span><span class="annot"><span class="annottext">[TcType]
-&gt; [SyntaxOpType]
-&gt; ([TcType] -&gt; [TcType] -&gt; TcM a)
-&gt; TcM (a, [HsWrapper])
forall a.
[TcType]
-&gt; [SyntaxOpType]
-&gt; ([TcType] -&gt; [TcType] -&gt; TcM a)
-&gt; TcM (a, [HsWrapper])
</span><a href="#local-6989586621681092969"><span class="hs-identifier hs-var">tc_syn_args_e</span></a></span><span>      </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681092960"><span class="hs-identifier hs-var">arg_tys</span></a></span><span> </span><span class="annot"><span class="annottext">[SyntaxOpType]
</span><a href="#local-6989586621681092958"><span class="hs-identifier hs-var">arg_shapes</span></a></span><span> </span><span class="annot"><span class="annottext">(([TcType] -&gt; [TcType] -&gt; TcM a) -&gt; TcM (a, [HsWrapper]))
-&gt; ([TcType] -&gt; [TcType] -&gt; TcM a) -&gt; TcM (a, [HsWrapper])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681092951"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681092951"><span class="hs-identifier hs-var">args_results</span></a></span></span><span> </span><span id="local-6989586621681092950"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681092950"><span class="hs-identifier hs-var">args_mults</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1704"></span><span>                  </span><span class="annot"><span class="annottext">[TcType] -&gt; [TcType] -&gt; TcM a
</span><a href="#local-6989586621681092957"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681092953"><span class="hs-identifier hs-var">arg1_results</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType] -&gt; [TcType] -&gt; [TcType]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681092951"><span class="hs-identifier hs-var">args_results</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681092952"><span class="hs-identifier hs-var">arg1_mults</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType] -&gt; [TcType] -&gt; [TcType]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681092950"><span class="hs-identifier hs-var">args_mults</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1705"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(a, [HsWrapper]) -&gt; TcM (a, [HsWrapper])
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681092956"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681092954"><span class="hs-identifier hs-var">arg_wrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; [HsWrapper] -&gt; [HsWrapper]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[HsWrapper]
</span><a href="#local-6989586621681092955"><span class="hs-identifier hs-var">arg_wraps</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1706"></span><span>    </span><span class="annot"><a href="#local-6989586621681092969"><span class="hs-identifier hs-var">tc_syn_args_e</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[SyntaxOpType]
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681092949"><span class="annot"><span class="annottext">[TcType] -&gt; [TcType] -&gt; TcM a
</span><a href="#local-6989586621681092949"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-special">,</span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(a -&gt; (a, [HsWrapper])) -&gt; TcM a -&gt; TcM (a, [HsWrapper])
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType] -&gt; [TcType] -&gt; TcM a
</span><a href="#local-6989586621681092949"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1707"></span><span>
</span><span id="line-1708"></span><span>    </span><span id="local-6989586621681094861"><span class="annot"><a href="#local-6989586621681092966"><span class="hs-identifier hs-type">tc_syn_arg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#SyntaxOpType"><span class="hs-identifier hs-type">SyntaxOpType</span></a></span><span>
</span><span id="line-1709"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681094861"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1710"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681094861"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#HsWrapper"><span class="hs-identifier hs-type">HsWrapper</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1711"></span><span>                  </span><span class="hs-comment">-- the wrapper applies to the overall result</span><span>
</span><span id="line-1712"></span><span>    </span><span id="local-6989586621681092966"><span class="annot"><span class="annottext">tc_syn_arg :: forall a.
TcType -&gt; SyntaxOpType -&gt; ([TcType] -&gt; TcM a) -&gt; TcM (a, HsWrapper)
</span><a href="#local-6989586621681092966"><span class="hs-identifier hs-var hs-var">tc_syn_arg</span></a></span></span><span> </span><span id="local-6989586621681092932"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092932"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="GHC.Tc.Utils.TcType.html#SynAny"><span class="hs-identifier hs-var">SynAny</span></a></span><span> </span><span id="local-6989586621681092931"><span class="annot"><span class="annottext">[TcType] -&gt; TcM a
</span><a href="#local-6989586621681092931"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1713"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681092930"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681092930"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TcType] -&gt; TcM a
</span><a href="#local-6989586621681092931"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092932"><span class="hs-identifier hs-var">res_ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1714"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(a, HsWrapper) -&gt; TcM (a, HsWrapper)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681092930"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#idHsWrapper"><span class="hs-identifier hs-var">idHsWrapper</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1715"></span><span>    </span><span class="annot"><a href="#local-6989586621681092966"><span class="hs-identifier hs-var">tc_syn_arg</span></a></span><span> </span><span id="local-6989586621681092929"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092929"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="GHC.Tc.Utils.TcType.html#SynRho"><span class="hs-identifier hs-var">SynRho</span></a></span><span> </span><span id="local-6989586621681092928"><span class="annot"><span class="annottext">[TcType] -&gt; TcM a
</span><a href="#local-6989586621681092928"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1716"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681092927"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681092927"><span class="hs-identifier hs-var">inst_wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681092926"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092926"><span class="hs-identifier hs-var">rho_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; TcType -&gt; TcM (HsWrapper, TcType)
</span><a href="GHC.Tc.Utils.Instantiate.html#topInstantiate"><span class="hs-identifier hs-var">topInstantiate</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621681092981"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092929"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-1717"></span><span>               </span><span class="hs-comment">-- inst_wrap :: res_ty &quot;-&gt;&quot; rho_ty</span><span>
</span><span id="line-1718"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681092925"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681092925"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TcType] -&gt; TcM a
</span><a href="#local-6989586621681092928"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092926"><span class="hs-identifier hs-var">rho_ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1719"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(a, HsWrapper) -&gt; TcM (a, HsWrapper)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681092925"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681092927"><span class="hs-identifier hs-var">inst_wrap</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1720"></span><span>    </span><span class="annot"><a href="#local-6989586621681092966"><span class="hs-identifier hs-var">tc_syn_arg</span></a></span><span> </span><span id="local-6989586621681092924"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092924"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="annot"><span class="annottext">SyntaxOpType
</span><a href="GHC.Tc.Utils.TcType.html#SynList"><span class="hs-identifier hs-var">SynList</span></a></span><span> </span><span id="local-6989586621681092923"><span class="annot"><span class="annottext">[TcType] -&gt; TcM a
</span><a href="#local-6989586621681092923"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1721"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681092922"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681092922"><span class="hs-identifier hs-var">inst_wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681092921"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092921"><span class="hs-identifier hs-var">rho_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; TcType -&gt; TcM (HsWrapper, TcType)
</span><a href="GHC.Tc.Utils.Instantiate.html#topInstantiate"><span class="hs-identifier hs-var">topInstantiate</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621681092981"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092924"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-1722"></span><span>               </span><span class="hs-comment">-- inst_wrap :: res_ty &quot;-&gt;&quot; rho_ty</span><span>
</span><span id="line-1723"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681092920"><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621681092920"><span class="hs-identifier hs-var">list_co</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681092919"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092919"><span class="hs-identifier hs-var">elt_ty</span></a></span></span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcM (TcCoercionR, TcType)
</span><a href="GHC.Tc.Utils.Unify.html#matchExpectedListTy"><span class="hs-identifier hs-var">matchExpectedListTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092921"><span class="hs-identifier hs-var">rho_ty</span></a></span><span>
</span><span id="line-1724"></span><span>               </span><span class="hs-comment">-- list_co :: [elt_ty] ~N rho_ty</span><span>
</span><span id="line-1725"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681092918"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681092918"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TcType] -&gt; TcM a
</span><a href="#local-6989586621681092923"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092919"><span class="hs-identifier hs-var">elt_ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1726"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(a, HsWrapper) -&gt; TcM (a, HsWrapper)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681092918"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcCoercionR -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#mkWpCastN"><span class="hs-identifier hs-var">mkWpCastN</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcCoercionR -&gt; TcCoercionR
</span><a href="GHC.Tc.Types.Evidence.html#mkTcSymCo"><span class="hs-identifier hs-var">mkTcSymCo</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621681092920"><span class="hs-identifier hs-var">list_co</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsWrapper -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681092922"><span class="hs-identifier hs-var">inst_wrap</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1727"></span><span>    </span><span class="annot"><a href="#local-6989586621681092966"><span class="hs-identifier hs-var">tc_syn_arg</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#SynFun"><span class="hs-identifier hs-type">SynFun</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TcType] -&gt; TcM a
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-1728"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcM (a, HsWrapper)
forall a. HasCallStack =&gt; String -&gt; SDoc -&gt; a
</span><a href="GHC.Utils.Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcSynArgA hits a SynFun&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CtOrigin -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621681092981"><span class="hs-identifier hs-var">orig</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1729"></span><span>    </span><span class="annot"><a href="#local-6989586621681092966"><span class="hs-identifier hs-var">tc_syn_arg</span></a></span><span> </span><span id="local-6989586621681092916"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092916"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#SynType"><span class="hs-identifier hs-type">SynType</span></a></span><span> </span><span id="local-6989586621681092915"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681092915"><span class="hs-identifier hs-var">the_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681092914"><span class="annot"><span class="annottext">[TcType] -&gt; TcM a
</span><a href="#local-6989586621681092914"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span>
</span><span id="line-1730"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681092913"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681092913"><span class="hs-identifier hs-var">wrap</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; UserTypeCtxt -&gt; TcType -&gt; ExpRhoType -&gt; TcM HsWrapper
</span><a href="GHC.Tc.Utils.Unify.html#tcSubType"><span class="hs-identifier hs-var">tcSubType</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="#local-6989586621681092981"><span class="hs-identifier hs-var">orig</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#GenSigCtxt"><span class="hs-identifier hs-var">GenSigCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092916"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681092915"><span class="hs-identifier hs-var">the_ty</span></a></span><span>
</span><span id="line-1731"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681092911"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681092911"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TcType] -&gt; TcM a
</span><a href="#local-6989586621681092914"><span class="hs-identifier hs-var">thing_inside</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1732"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(a, HsWrapper) -&gt; TcM (a, HsWrapper)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681092911"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681092913"><span class="hs-identifier hs-var">wrap</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1733"></span><span>
</span><span id="line-1734"></span><span class="hs-comment">{-
Note [Push result type in]
~~~~~~~~~~~~~~~~~~~~~~~~~~
Unify with expected result before type-checking the args so that the
info from res_ty percolates to args.  This is when we might detect a
too-few args situation.  (One can think of cases when the opposite
order would give a better error message.)
experimenting with putting this first.

Here's an example where it actually makes a real difference

   class C t a b | t a -&gt; b
   instance C Char a Bool

   data P t a = forall b. (C t a b) =&gt; MkP b
   data Q t   = MkQ (forall a. P t a)

   f1, f2 :: Q Char;
   f1 = MkQ (MkP True)
   f2 = MkQ (MkP True :: forall a. P Char a)

With the change, f1 will type-check, because the 'Char' info from
the signature is propagated into MkQ's argument. With the check
in the other order, the extra signature in f2 is reqd.

************************************************************************
*                                                                      *
                Expressions with a type signature
                        expr :: type
*                                                                      *
********************************************************************* -}</span><span>
</span><span id="line-1765"></span><span>
</span><span id="line-1766"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExprSig"><span class="hs-identifier hs-type">tcExprSig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcIdSigInfo"><span class="hs-identifier hs-type">TcIdSigInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1767"></span><span id="tcExprSig"><span class="annot"><span class="annottext">tcExprSig :: LHsExpr GhcRn -&gt; TcIdSigInfo -&gt; TcM (LHsExpr GhcTc, TcType)
</span><a href="GHC.Tc.Gen.Expr.html#tcExprSig"><span class="hs-identifier hs-var hs-var">tcExprSig</span></a></span></span><span> </span><span id="local-6989586621681092910"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681092910"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#CompleteSig"><span class="hs-identifier hs-type">CompleteSig</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">sig_bndr :: TcIdSigInfo -&gt; Var
</span><a href="GHC.Tc.Types.html#sig_bndr"><span class="hs-identifier hs-var">sig_bndr</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681092907"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681092907"><span class="hs-identifier hs-var">poly_id</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sig_loc :: TcIdSigInfo -&gt; SrcSpan
</span><a href="GHC.Tc.Types.html#sig_loc"><span class="hs-identifier hs-var">sig_loc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681092905"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681092905"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1768"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan
-&gt; TcM (LHsExpr GhcTc, TcType) -&gt; TcM (LHsExpr GhcTc, TcType)
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681092905"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc, TcType) -&gt; TcM (LHsExpr GhcTc, TcType))
-&gt; TcM (LHsExpr GhcTc, TcType) -&gt; TcM (LHsExpr GhcTc, TcType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>   </span><span class="hs-comment">-- Sets the location for the implication constraint</span><span>
</span><span id="line-1769"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681092904"><span class="annot"><span class="annottext">poly_ty :: TcType
</span><a href="#local-6989586621681092904"><span class="hs-identifier hs-var hs-var">poly_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; TcType
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681092907"><span class="hs-identifier hs-var">poly_id</span></a></span><span>
</span><span id="line-1770"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681092902"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681092902"><span class="hs-identifier hs-var">wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681092901"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681092901"><span class="hs-identifier hs-var">expr'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
-&gt; TcType
-&gt; (TcType -&gt; TcM (LHsExpr GhcTc))
-&gt; TcM (HsWrapper, LHsExpr GhcTc)
forall result.
UserTypeCtxt
-&gt; TcType -&gt; (TcType -&gt; TcM result) -&gt; TcM (HsWrapper, result)
</span><a href="GHC.Tc.Utils.Unify.html#tcSkolemiseScoped"><span class="hs-identifier hs-var">tcSkolemiseScoped</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#ExprSigCtxt"><span class="hs-identifier hs-var">ExprSigCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092904"><span class="hs-identifier hs-var">poly_ty</span></a></span><span> </span><span class="annot"><span class="annottext">((TcType -&gt; TcM (LHsExpr GhcTc)) -&gt; TcM (HsWrapper, LHsExpr GhcTc))
-&gt; (TcType -&gt; TcM (LHsExpr GhcTc))
-&gt; TcM (HsWrapper, LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681092899"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092899"><span class="hs-identifier hs-var">rho_ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1771"></span><span>                          </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; TcType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckMonoExprNC"><span class="hs-identifier hs-var">tcCheckMonoExprNC</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681092910"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092899"><span class="hs-identifier hs-var">rho_ty</span></a></span><span>
</span><span id="line-1772"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(LHsExpr GhcTc, TcType) -&gt; TcM (LHsExpr GhcTc, TcType)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper -&gt; LHsExpr GhcTc -&gt; LHsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkLHsWrap"><span class="hs-identifier hs-var">mkLHsWrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681092902"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681092901"><span class="hs-identifier hs-var">expr'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092904"><span class="hs-identifier hs-var">poly_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1773"></span><span>
</span><span id="line-1774"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcExprSig"><span class="hs-identifier hs-var">tcExprSig</span></a></span><span> </span><span id="local-6989586621681092898"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681092898"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span id="local-6989586621681092897"><span class="annot"><span class="annottext">sig :: TcIdSigInfo
</span><a href="#local-6989586621681092897"><span class="hs-identifier hs-var">sig</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#PartialSig"><span class="hs-identifier hs-type">PartialSig</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">psig_name :: TcIdSigInfo -&gt; Name
</span><a href="GHC.Tc.Types.html#psig_name"><span class="hs-identifier hs-var">psig_name</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681092894"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681092894"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">sig_loc :: TcIdSigInfo -&gt; SrcSpan
</span><a href="GHC.Tc.Types.html#sig_loc"><span class="hs-identifier hs-var">sig_loc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681092893"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681092893"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1775"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan
-&gt; TcM (LHsExpr GhcTc, TcType) -&gt; TcM (LHsExpr GhcTc, TcType)
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681092893"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc, TcType) -&gt; TcM (LHsExpr GhcTc, TcType))
-&gt; TcM (LHsExpr GhcTc, TcType) -&gt; TcM (LHsExpr GhcTc, TcType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>   </span><span class="hs-comment">-- Sets the location for the implication constraint</span><span>
</span><span id="line-1776"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681092892"><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681092892"><span class="hs-identifier hs-var">tclvl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681092891"><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621681092891"><span class="hs-identifier hs-var">wanted</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681092890"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681092890"><span class="hs-identifier hs-var">expr'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681092889"><span class="annot"><span class="annottext">TcIdSigInst
</span><a href="#local-6989586621681092889"><span class="hs-identifier hs-var">sig_inst</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1777"></span><span>             </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM (LHsExpr GhcTc, TcIdSigInst)
-&gt; TcM (TcLevel, WantedConstraints, (LHsExpr GhcTc, TcIdSigInst))
forall a. TcM a -&gt; TcM (TcLevel, WantedConstraints, a)
</span><a href="GHC.Tc.Utils.Monad.html#pushLevelAndCaptureConstraints"><span class="hs-identifier hs-var">pushLevelAndCaptureConstraints</span></a></span><span>  </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc, TcIdSigInst)
 -&gt; TcM (TcLevel, WantedConstraints, (LHsExpr GhcTc, TcIdSigInst)))
-&gt; TcM (LHsExpr GhcTc, TcIdSigInst)
-&gt; TcM (TcLevel, WantedConstraints, (LHsExpr GhcTc, TcIdSigInst))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1778"></span><span>                </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681092887"><span class="annot"><span class="annottext">TcIdSigInst
</span><a href="#local-6989586621681092887"><span class="hs-identifier hs-var">sig_inst</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcIdSigInfo -&gt; TcM TcIdSigInst
</span><a href="GHC.Tc.Gen.Sig.html#tcInstSig"><span class="hs-identifier hs-var">tcInstSig</span></a></span><span> </span><span class="annot"><span class="annottext">TcIdSigInfo
</span><a href="#local-6989586621681092897"><span class="hs-identifier hs-var">sig</span></a></span><span>
</span><span id="line-1779"></span><span>                   </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681092886"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681092886"><span class="hs-identifier hs-var">expr'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Name, Var)] -&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall r. [(Name, Var)] -&gt; TcM r -&gt; TcM r
</span><a href="GHC.Tc.Utils.Env.html#tcExtendNameTyVarEnv"><span class="hs-identifier hs-var">tcExtendNameTyVarEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(VarBndr Var Specificity -&gt; Var)
-&gt; [(Name, VarBndr Var Specificity)] -&gt; [(Name, Var)]
forall b c a. (b -&gt; c) -&gt; [(a, b)] -&gt; [(a, c)]
</span><a href="GHC.Utils.Misc.html#mapSnd"><span class="hs-identifier hs-var">mapSnd</span></a></span><span> </span><span class="annot"><span class="annottext">VarBndr Var Specificity -&gt; Var
forall tv argf. VarBndr tv argf -&gt; tv
</span><a href="GHC.Types.Var.html#binderVar"><span class="hs-identifier hs-var">binderVar</span></a></span><span> </span><span class="annot"><span class="annottext">([(Name, VarBndr Var Specificity)] -&gt; [(Name, Var)])
-&gt; [(Name, VarBndr Var Specificity)] -&gt; [(Name, Var)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TcIdSigInst -&gt; [(Name, VarBndr Var Specificity)]
</span><a href="GHC.Tc.Types.html#sig_inst_skols"><span class="hs-identifier hs-var hs-var">sig_inst_skols</span></a></span><span> </span><span class="annot"><span class="annottext">TcIdSigInst
</span><a href="#local-6989586621681092887"><span class="hs-identifier hs-var">sig_inst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1780"></span><span>                              </span><span class="annot"><span class="annottext">[(Name, Var)] -&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall r. [(Name, Var)] -&gt; TcM r -&gt; TcM r
</span><a href="GHC.Tc.Utils.Env.html#tcExtendNameTyVarEnv"><span class="hs-identifier hs-var">tcExtendNameTyVarEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcIdSigInst -&gt; [(Name, Var)]
</span><a href="GHC.Tc.Types.html#sig_inst_wcs"><span class="hs-identifier hs-var hs-var">sig_inst_wcs</span></a></span><span>   </span><span class="annot"><span class="annottext">TcIdSigInst
</span><a href="#local-6989586621681092887"><span class="hs-identifier hs-var">sig_inst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1781"></span><span>                              </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; TcType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExprNC"><span class="hs-identifier hs-var">tcCheckPolyExprNC</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681092898"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcIdSigInst -&gt; TcType
</span><a href="GHC.Tc.Types.html#sig_inst_tau"><span class="hs-identifier hs-var hs-var">sig_inst_tau</span></a></span><span> </span><span class="annot"><span class="annottext">TcIdSigInst
</span><a href="#local-6989586621681092887"><span class="hs-identifier hs-var">sig_inst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1782"></span><span>                   </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(LHsExpr GhcTc, TcIdSigInst) -&gt; TcM (LHsExpr GhcTc, TcIdSigInst)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681092886"><span class="hs-identifier hs-var">expr'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcIdSigInst
</span><a href="#local-6989586621681092887"><span class="hs-identifier hs-var">sig_inst</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1783"></span><span>       </span><span class="hs-comment">-- See Note [Partial expression signatures]</span><span>
</span><span id="line-1784"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681092880"><span class="annot"><span class="annottext">tau :: TcType
</span><a href="#local-6989586621681092880"><span class="hs-identifier hs-var hs-var">tau</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcIdSigInst -&gt; TcType
</span><a href="GHC.Tc.Types.html#sig_inst_tau"><span class="hs-identifier hs-var hs-var">sig_inst_tau</span></a></span><span> </span><span class="annot"><span class="annottext">TcIdSigInst
</span><a href="#local-6989586621681092889"><span class="hs-identifier hs-var">sig_inst</span></a></span><span>
</span><span id="line-1785"></span><span>             </span><span id="local-6989586621681092879"><span class="annot"><span class="annottext">infer_mode :: InferMode
</span><a href="#local-6989586621681092879"><span class="hs-identifier hs-var hs-var">infer_mode</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[TcType] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcIdSigInst -&gt; [TcType]
</span><a href="GHC.Tc.Types.html#sig_inst_theta"><span class="hs-identifier hs-var hs-var">sig_inst_theta</span></a></span><span> </span><span class="annot"><span class="annottext">TcIdSigInst
</span><a href="#local-6989586621681092889"><span class="hs-identifier hs-var">sig_inst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1786"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe TcType -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../../base/src/Data.Maybe.html#isNothing"><span class="hs-identifier hs-var">isNothing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcIdSigInst -&gt; Maybe TcType
</span><a href="GHC.Tc.Types.html#sig_inst_wcx"><span class="hs-identifier hs-var hs-var">sig_inst_wcx</span></a></span><span> </span><span class="annot"><span class="annottext">TcIdSigInst
</span><a href="#local-6989586621681092889"><span class="hs-identifier hs-var">sig_inst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1787"></span><span>                        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InferMode
</span><a href="GHC.Tc.Solver.html#ApplyMR"><span class="hs-identifier hs-var">ApplyMR</span></a></span><span>
</span><span id="line-1788"></span><span>                        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1789"></span><span>                        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InferMode
</span><a href="GHC.Tc.Solver.html#NoRestrictions"><span class="hs-identifier hs-var">NoRestrictions</span></a></span><span>
</span><span id="line-1790"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681092873"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621681092873"><span class="hs-identifier hs-var">qtvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681092872"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621681092872"><span class="hs-identifier hs-var">givens</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681092871"><span class="annot"><span class="annottext">TcEvBinds
</span><a href="#local-6989586621681092871"><span class="hs-identifier hs-var">ev_binds</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681092870"><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621681092870"><span class="hs-identifier hs-var">residual</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-1791"></span><span>                 </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcLevel
-&gt; InferMode
-&gt; [TcIdSigInst]
-&gt; [(Name, TcType)]
-&gt; WantedConstraints
-&gt; TcM ([Var], [Var], TcEvBinds, WantedConstraints, Bool)
</span><a href="GHC.Tc.Solver.html#simplifyInfer"><span class="hs-identifier hs-var">simplifyInfer</span></a></span><span> </span><span class="annot"><span class="annottext">TcLevel
</span><a href="#local-6989586621681092892"><span class="hs-identifier hs-var">tclvl</span></a></span><span> </span><span class="annot"><span class="annottext">InferMode
</span><a href="#local-6989586621681092879"><span class="hs-identifier hs-var">infer_mode</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TcIdSigInst
</span><a href="#local-6989586621681092889"><span class="hs-identifier hs-var">sig_inst</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681092894"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092880"><span class="hs-identifier hs-var">tau</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621681092891"><span class="hs-identifier hs-var">wanted</span></a></span><span>
</span><span id="line-1792"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">WantedConstraints -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#emitConstraints"><span class="hs-identifier hs-var">emitConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621681092870"><span class="hs-identifier hs-var">residual</span></a></span><span>
</span><span id="line-1793"></span><span>
</span><span id="line-1794"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681092868"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092868"><span class="hs-identifier hs-var">tau</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092880"><span class="hs-identifier hs-var">tau</span></a></span><span>
</span><span id="line-1795"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681092867"><span class="annot"><span class="annottext">inferred_theta :: [TcType]
</span><a href="#local-6989586621681092867"><span class="hs-identifier hs-var hs-var">inferred_theta</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Var -&gt; TcType) -&gt; [Var] -&gt; [TcType]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; TcType
</span><a href="GHC.Tc.Utils.TcType.html#evVarPred"><span class="hs-identifier hs-var">evVarPred</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621681092872"><span class="hs-identifier hs-var">givens</span></a></span><span>
</span><span id="line-1796"></span><span>             </span><span id="local-6989586621681092865"><span class="annot"><span class="annottext">tau_tvs :: VarSet
</span><a href="#local-6989586621681092865"><span class="hs-identifier hs-var hs-var">tau_tvs</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092868"><span class="hs-identifier hs-var">tau</span></a></span><span>
</span><span id="line-1797"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681092864"><span class="annot"><span class="annottext">[VarBndr Var Specificity]
</span><a href="#local-6989586621681092864"><span class="hs-identifier hs-var">binders</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681092863"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681092863"><span class="hs-identifier hs-var">my_theta</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TcType]
-&gt; VarSet
-&gt; [Var]
-&gt; Maybe TcIdSigInst
-&gt; TcM ([VarBndr Var Specificity], [TcType])
</span><a href="GHC.Tc.Gen.Bind.html#chooseInferredQuantifiers"><span class="hs-identifier hs-var">chooseInferredQuantifiers</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681092867"><span class="hs-identifier hs-var">inferred_theta</span></a></span><span>
</span><span id="line-1798"></span><span>                                   </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621681092865"><span class="hs-identifier hs-var">tau_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621681092873"><span class="hs-identifier hs-var">qtvs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcIdSigInst -&gt; Maybe TcIdSigInst
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">TcIdSigInst
</span><a href="#local-6989586621681092889"><span class="hs-identifier hs-var">sig_inst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1799"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681092862"><span class="annot"><span class="annottext">inferred_sigma :: TcType
</span><a href="#local-6989586621681092862"><span class="hs-identifier hs-var hs-var">inferred_sigma</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; [TcType] -&gt; TcType -&gt; TcType
</span><a href="GHC.Tc.Utils.TcType.html#mkInfSigmaTy"><span class="hs-identifier hs-var">mkInfSigmaTy</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621681092873"><span class="hs-identifier hs-var">qtvs</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681092867"><span class="hs-identifier hs-var">inferred_theta</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092868"><span class="hs-identifier hs-var">tau</span></a></span><span>
</span><span id="line-1800"></span><span>             </span><span id="local-6989586621681092860"><span class="annot"><span class="annottext">my_sigma :: TcType
</span><a href="#local-6989586621681092860"><span class="hs-identifier hs-var hs-var">my_sigma</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[VarBndr Var Specificity] -&gt; TcType -&gt; TcType
</span><a href="GHC.Core.TyCo.Rep.html#mkInvisForAllTys"><span class="hs-identifier hs-var">mkInvisForAllTys</span></a></span><span> </span><span class="annot"><span class="annottext">[VarBndr Var Specificity]
</span><a href="#local-6989586621681092864"><span class="hs-identifier hs-var">binders</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TcType] -&gt; TcType -&gt; TcType
</span><a href="GHC.Tc.Utils.TcType.html#mkPhiTy"><span class="hs-identifier hs-var">mkPhiTy</span></a></span><span>  </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681092863"><span class="hs-identifier hs-var">my_theta</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092868"><span class="hs-identifier hs-var">tau</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1801"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681092857"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681092857"><span class="hs-identifier hs-var">wrap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092862"><span class="hs-identifier hs-var">inferred_sigma</span></a></span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcType -&gt; Bool
</span><a href="GHC.Core.Type.html#eqType"><span class="hs-operator hs-var">`eqType`</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092860"><span class="hs-identifier hs-var">my_sigma</span></a></span><span> </span><span class="hs-comment">-- NB: eqType ignores vis.</span><span>
</span><span id="line-1802"></span><span>                 </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; TcM HsWrapper
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#idHsWrapper"><span class="hs-identifier hs-var">idHsWrapper</span></a></span><span>  </span><span class="hs-comment">-- Fast path; also avoids complaint when we infer</span><span>
</span><span id="line-1803"></span><span>                                          </span><span class="hs-comment">-- an ambiguous type and have AllowAmbiguousType</span><span>
</span><span id="line-1804"></span><span>                                          </span><span class="hs-comment">-- e..g infer  x :: forall a. F a -&gt; Int</span><span>
</span><span id="line-1805"></span><span>                 </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt -&gt; TcType -&gt; TcType -&gt; TcM HsWrapper
</span><a href="GHC.Tc.Utils.Unify.html#tcSubTypeSigma"><span class="hs-identifier hs-var">tcSubTypeSigma</span></a></span><span> </span><span class="annot"><span class="annottext">UserTypeCtxt
</span><a href="GHC.Tc.Types.Origin.html#ExprSigCtxt"><span class="hs-identifier hs-var">ExprSigCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092862"><span class="hs-identifier hs-var">inferred_sigma</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092860"><span class="hs-identifier hs-var">my_sigma</span></a></span><span>
</span><span id="line-1806"></span><span>
</span><span id="line-1807"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcExpSig&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621681092873"><span class="hs-identifier hs-var">qtvs</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621681092872"><span class="hs-identifier hs-var">givens</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">TcType -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092862"><span class="hs-identifier hs-var">inferred_sigma</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">TcType -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092860"><span class="hs-identifier hs-var">my_sigma</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1808"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681092854"><span class="annot"><span class="annottext">poly_wrap :: HsWrapper
</span><a href="#local-6989586621681092854"><span class="hs-identifier hs-var hs-var">poly_wrap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681092857"><span class="hs-identifier hs-var">wrap</span></a></span><span>
</span><span id="line-1809"></span><span>                         </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsWrapper -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#mkWpTyLams"><span class="hs-identifier hs-var">mkWpTyLams</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621681092873"><span class="hs-identifier hs-var">qtvs</span></a></span><span>
</span><span id="line-1810"></span><span>                         </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsWrapper -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#mkWpLams"><span class="hs-identifier hs-var">mkWpLams</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621681092872"><span class="hs-identifier hs-var">givens</span></a></span><span>
</span><span id="line-1811"></span><span>                         </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsWrapper -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TcEvBinds -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#mkWpLet"><span class="hs-identifier hs-var">mkWpLet</span></a></span><span>  </span><span class="annot"><span class="annottext">TcEvBinds
</span><a href="#local-6989586621681092871"><span class="hs-identifier hs-var">ev_binds</span></a></span><span>
</span><span id="line-1812"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(LHsExpr GhcTc, TcType) -&gt; TcM (LHsExpr GhcTc, TcType)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper -&gt; LHsExpr GhcTc -&gt; LHsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkLHsWrap"><span class="hs-identifier hs-var">mkLHsWrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681092854"><span class="hs-identifier hs-var">poly_wrap</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681092890"><span class="hs-identifier hs-var">expr'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092860"><span class="hs-identifier hs-var">my_sigma</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1813"></span><span>
</span><span id="line-1814"></span><span>
</span><span id="line-1815"></span><span class="hs-comment">{- Note [Partial expression signatures]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Partial type signatures on expressions are easy to get wrong.  But
here is a guiding principile
    e :: ty
should behave like
    let x :: ty
        x = e
    in x

So for partial signatures we apply the MR if no context is given.  So
   e :: IO _          apply the MR
   e :: _ =&gt; IO _     do not apply the MR
just like in GHC.Tc.Gen.Bind.decideGeneralisationPlan

This makes a difference (#11670):
   peek :: Ptr a -&gt; IO CLong
   peek ptr = peekElemOff undefined 0 :: _
from (peekElemOff undefined 0) we get
          type: IO w
   constraints: Storable w

We must NOT try to generalise over 'w' because the signature specifies
no constraints so we'll complain about not being able to solve
Storable w.  Instead, don't generalise; then _ gets instantiated to
CLong, as it should.
-}</span><span>
</span><span id="line-1842"></span><span>
</span><span id="line-1843"></span><span class="hs-comment">{- *********************************************************************
*                                                                      *
                 tcInferId
*                                                                      *
********************************************************************* -}</span><span>
</span><span id="line-1848"></span><span>
</span><span id="line-1849"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcCheckId"><span class="hs-identifier hs-type">tcCheckId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1850"></span><span id="tcCheckId"><span class="annot"><span class="annottext">tcCheckId :: Name -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckId"><span class="hs-identifier hs-var hs-var">tcCheckId</span></a></span></span><span> </span><span id="local-6989586621681092850"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681092850"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621681092849"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681092849"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-1851"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681092850"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; Unique -&gt; Bool
</span><a href="GHC.Types.Unique.html#hasKey"><span class="hs-operator hs-var">`hasKey`</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.PrimOps.html#tagToEnumKey"><span class="hs-identifier hs-var">tagToEnumKey</span></a></span><span>
</span><span id="line-1852"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcM (HsExpr GhcTc)
forall a. SDoc -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tagToEnum# must appear applied to one argument&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1853"></span><span>    </span><span class="hs-comment">-- tcApp catches the case (tagToEnum# arg)</span><span>
</span><span id="line-1854"></span><span>
</span><span id="line-1855"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1856"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681092847"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681092847"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681092846"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092846"><span class="hs-identifier hs-var">actual_res_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM (HsExpr GhcTc, TcType)
</span><a href="GHC.Tc.Gen.Expr.html#tcInferId"><span class="hs-identifier hs-var">tcInferId</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681092850"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-1857"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcCheckId&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681092850"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092846"><span class="hs-identifier hs-var">actual_res_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ExpRhoType -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681092849"><span class="hs-identifier hs-var">res_ty</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1858"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; HsExpr GhcTc
-&gt; TcType
-&gt; ExpRhoType
-&gt; TcM (HsExpr GhcTc)
-&gt; TcM (HsExpr GhcTc)
forall a.
Bool -&gt; HsExpr GhcTc -&gt; TcType -&gt; ExpRhoType -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Gen.Expr.html#addFunResCtxt"><span class="hs-identifier hs-var">addFunResCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681092847"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092846"><span class="hs-identifier hs-var">actual_res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681092849"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (HsExpr GhcTc) -&gt; TcM (HsExpr GhcTc))
-&gt; TcM (HsExpr GhcTc) -&gt; TcM (HsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1859"></span><span>         </span><span class="annot"><span class="annottext">CtOrigin
-&gt; HsExpr GhcRn
-&gt; HsExpr GhcTc
-&gt; TcType
-&gt; ExpRhoType
-&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Utils.Unify.html#tcWrapResultO"><span class="hs-identifier hs-var">tcWrapResultO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#OccurrenceOf"><span class="hs-identifier hs-var">OccurrenceOf</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681092850"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XVar GhcRn -&gt; GenLocated SrcSpan (IdP GhcRn) -&gt; HsExpr GhcRn
forall p. XVar p -&gt; Located (IdP p) -&gt; HsExpr p
</span><a href="GHC.Hs.Expr.html#HsVar"><span class="hs-identifier hs-var">HsVar</span></a></span><span> </span><span class="annot"><span class="annottext">NoExtField
XVar GhcRn
</span><a href="GHC.Hs.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; GenLocated SrcSpan Name
forall e. e -&gt; Located e
</span><a href="GHC.Types.SrcLoc.html#noLoc"><span class="hs-identifier hs-var">noLoc</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681092850"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681092847"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-1860"></span><span>                                           </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092846"><span class="hs-identifier hs-var">actual_res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681092849"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1861"></span><span>
</span><span id="line-1862"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcCheckRecSelId"><span class="hs-identifier hs-type">tcCheckRecSelId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Type.html#AmbiguousFieldOcc"><span class="hs-identifier hs-type">AmbiguousFieldOcc</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1863"></span><span id="tcCheckRecSelId"><span class="annot"><span class="annottext">tcCheckRecSelId :: HsExpr GhcRn
-&gt; AmbiguousFieldOcc GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckRecSelId"><span class="hs-identifier hs-var hs-var">tcCheckRecSelId</span></a></span></span><span> </span><span id="local-6989586621681092844"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681092844"><span class="hs-identifier hs-var">rn_expr</span></a></span></span><span> </span><span id="local-6989586621681092843"><span class="annot"><span class="annottext">f :: AmbiguousFieldOcc GhcRn
</span><a href="#local-6989586621681092843"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Type.html#Unambiguous"><span class="hs-identifier hs-type">Unambiguous</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span id="local-6989586621681092842"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681092842"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-1864"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681092841"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681092841"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681092840"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092840"><span class="hs-identifier hs-var">actual_res_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">AmbiguousFieldOcc GhcRn -&gt; TcM (HsExpr GhcTc, TcType)
</span><a href="GHC.Tc.Gen.Expr.html#tcInferRecSelId"><span class="hs-identifier hs-var">tcInferRecSelId</span></a></span><span> </span><span class="annot"><span class="annottext">AmbiguousFieldOcc GhcRn
</span><a href="#local-6989586621681092843"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-1865"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
-&gt; HsExpr GhcTc -&gt; TcType -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Utils.Unify.html#tcWrapResult"><span class="hs-identifier hs-var">tcWrapResult</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681092844"><span class="hs-identifier hs-var">rn_expr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681092841"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092840"><span class="hs-identifier hs-var">actual_res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681092842"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1866"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcCheckRecSelId"><span class="hs-identifier hs-var">tcCheckRecSelId</span></a></span><span> </span><span id="local-6989586621681092839"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681092839"><span class="hs-identifier hs-var">rn_expr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Type.html#Ambiguous"><span class="hs-identifier hs-type">Ambiguous</span></a></span><span> </span><span class="annot"><span class="annottext">XAmbiguous GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681092838"><span class="annot"><span class="annottext">Located RdrName
</span><a href="#local-6989586621681092838"><span class="hs-identifier hs-var">lbl</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681092837"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681092837"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-1867"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; Maybe (Scaled TcType, TcType)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitFunTy_maybe"><span class="hs-identifier hs-var">tcSplitFunTy_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">(TcType -&gt; Maybe (Scaled TcType, TcType))
-&gt; Maybe TcType -&gt; Maybe (Scaled TcType, TcType)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><a href="../../base/src/GHC.Base.html#%3D%3C%3C"><span class="hs-operator hs-var">=&lt;&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType -&gt; Maybe TcType
</span><a href="GHC.Tc.Utils.TcMType.html#checkingExpType_maybe"><span class="hs-identifier hs-var">checkingExpType_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681092837"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1868"></span><span>      </span><span class="annot"><span class="annottext">Maybe (Scaled TcType, TcType)
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Located RdrName -&gt; TcM (HsExpr GhcTc)
forall a. Located RdrName -&gt; TcM a
</span><a href="GHC.Tc.Gen.Expr.html#ambiguousSelector"><span class="hs-identifier hs-var">ambiguousSelector</span></a></span><span> </span><span class="annot"><span class="annottext">Located RdrName
</span><a href="#local-6989586621681092838"><span class="hs-identifier hs-var">lbl</span></a></span><span>
</span><span id="line-1869"></span><span>      </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681092832"><span class="annot"><span class="annottext">Scaled TcType
</span><a href="#local-6989586621681092832"><span class="hs-identifier hs-var">arg</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681092831"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681092831"><span class="hs-identifier hs-var">sel_name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Located RdrName -&gt; TcType -&gt; TcM Name
</span><a href="GHC.Tc.Gen.Expr.html#disambiguateSelector"><span class="hs-identifier hs-var">disambiguateSelector</span></a></span><span> </span><span class="annot"><span class="annottext">Located RdrName
</span><a href="#local-6989586621681092838"><span class="hs-identifier hs-var">lbl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Scaled TcType -&gt; TcType
forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled TcType
</span><a href="#local-6989586621681092832"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1870"></span><span>                          </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
-&gt; AmbiguousFieldOcc GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckRecSelId"><span class="hs-identifier hs-var">tcCheckRecSelId</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681092839"><span class="hs-identifier hs-var">rn_expr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XUnambiguous GhcRn -&gt; Located RdrName -&gt; AmbiguousFieldOcc GhcRn
forall pass.
XUnambiguous pass -&gt; Located RdrName -&gt; AmbiguousFieldOcc pass
</span><a href="GHC.Hs.Type.html#Unambiguous"><span class="hs-identifier hs-var">Unambiguous</span></a></span><span> </span><span class="annot"><span class="annottext">Name
XUnambiguous GhcRn
</span><a href="#local-6989586621681092831"><span class="hs-identifier hs-var">sel_name</span></a></span><span> </span><span class="annot"><span class="annottext">Located RdrName
</span><a href="#local-6989586621681092838"><span class="hs-identifier hs-var">lbl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1871"></span><span>                                                    </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681092837"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1872"></span><span>
</span><span id="line-1873"></span><span class="hs-comment">------------------------</span><span>
</span><span id="line-1874"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcInferRecSelId"><span class="hs-identifier hs-type">tcInferRecSelId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Type.html#AmbiguousFieldOcc"><span class="hs-identifier hs-type">AmbiguousFieldOcc</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcRhoType"><span class="hs-identifier hs-type">TcRhoType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1875"></span><span id="tcInferRecSelId"><span class="annot"><span class="annottext">tcInferRecSelId :: AmbiguousFieldOcc GhcRn -&gt; TcM (HsExpr GhcTc, TcType)
</span><a href="GHC.Tc.Gen.Expr.html#tcInferRecSelId"><span class="hs-identifier hs-var hs-var">tcInferRecSelId</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Type.html#Unambiguous"><span class="hs-identifier hs-type">Unambiguous</span></a></span><span> </span><span id="local-6989586621681092830"><span class="annot"><span class="annottext">XUnambiguous GhcRn
</span><a href="#local-6989586621681092830"><span class="hs-identifier hs-var">sel</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681092829"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621681092829"><span class="hs-identifier hs-var">lbl</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1876"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681092828"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681092828"><span class="hs-identifier hs-var">expr'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681092827"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092827"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; Name -&gt; TcM (HsExpr GhcTc, TcType)
</span><a href="GHC.Tc.Gen.Expr.html#tc_infer_id"><span class="hs-identifier hs-var">tc_infer_id</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621681092829"><span class="hs-identifier hs-var">lbl</span></a></span><span> </span><span class="annot"><span class="annottext">Name
XUnambiguous GhcRn
</span><a href="#local-6989586621681092830"><span class="hs-identifier hs-var">sel</span></a></span><span>
</span><span id="line-1877"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc, TcType) -&gt; TcM (HsExpr GhcTc, TcType)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681092828"><span class="hs-identifier hs-var">expr'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092827"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1878"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcInferRecSelId"><span class="hs-identifier hs-var">tcInferRecSelId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Type.html#Ambiguous"><span class="hs-identifier hs-type">Ambiguous</span></a></span><span> </span><span class="annot"><span class="annottext">XAmbiguous GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681092825"><span class="annot"><span class="annottext">Located RdrName
</span><a href="#local-6989586621681092825"><span class="hs-identifier hs-var">lbl</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1879"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Located RdrName -&gt; TcM (HsExpr GhcTc, TcType)
forall a. Located RdrName -&gt; TcM a
</span><a href="GHC.Tc.Gen.Expr.html#ambiguousSelector"><span class="hs-identifier hs-var">ambiguousSelector</span></a></span><span> </span><span class="annot"><span class="annottext">Located RdrName
</span><a href="#local-6989586621681092825"><span class="hs-identifier hs-var">lbl</span></a></span><span>
</span><span id="line-1880"></span><span>
</span><span id="line-1881"></span><span class="hs-comment">------------------------</span><span>
</span><span id="line-1882"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcInferId"><span class="hs-identifier hs-type">tcInferId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1883"></span><span class="hs-comment">-- Look up an occurrence of an Id</span><span>
</span><span id="line-1884"></span><span class="hs-comment">-- Do not instantiate its type</span><span>
</span><span id="line-1885"></span><span id="tcInferId"><span class="annot"><span class="annottext">tcInferId :: Name -&gt; TcM (HsExpr GhcTc, TcType)
</span><a href="GHC.Tc.Gen.Expr.html#tcInferId"><span class="hs-identifier hs-var hs-var">tcInferId</span></a></span></span><span> </span><span id="local-6989586621681092824"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681092824"><span class="hs-identifier hs-var">id_name</span></a></span></span><span>
</span><span id="line-1886"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681092824"><span class="hs-identifier hs-var">id_name</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; Unique -&gt; Bool
</span><a href="GHC.Types.Unique.html#hasKey"><span class="hs-operator hs-var">`hasKey`</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#assertIdKey"><span class="hs-identifier hs-var">assertIdKey</span></a></span><span>
</span><span id="line-1887"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681092822"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681092822"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-1888"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_IgnoreAsserts"><span class="hs-identifier hs-var">Opt_IgnoreAsserts</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681092822"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1889"></span><span>         </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; Name -&gt; TcM (HsExpr GhcTc, TcType)
</span><a href="GHC.Tc.Gen.Expr.html#tc_infer_id"><span class="hs-identifier hs-var">tc_infer_id</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; RdrName
</span><a href="GHC.Types.Name.Reader.html#nameRdrName"><span class="hs-identifier hs-var">nameRdrName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681092824"><span class="hs-identifier hs-var">id_name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681092824"><span class="hs-identifier hs-var">id_name</span></a></span><span>
</span><span id="line-1890"></span><span>         </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM (HsExpr GhcTc, TcType)
</span><a href="GHC.Tc.Gen.Expr.html#tc_infer_assert"><span class="hs-identifier hs-var">tc_infer_assert</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681092824"><span class="hs-identifier hs-var">id_name</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1891"></span><span>
</span><span id="line-1892"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1893"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681092817"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681092817"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681092816"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092816"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; Name -&gt; TcM (HsExpr GhcTc, TcType)
</span><a href="GHC.Tc.Gen.Expr.html#tc_infer_id"><span class="hs-identifier hs-var">tc_infer_id</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; RdrName
</span><a href="GHC.Types.Name.Reader.html#nameRdrName"><span class="hs-identifier hs-var">nameRdrName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681092824"><span class="hs-identifier hs-var">id_name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681092824"><span class="hs-identifier hs-var">id_name</span></a></span><span>
</span><span id="line-1894"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcInferId&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681092824"><span class="hs-identifier hs-var">id_name</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TcType -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092816"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1895"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc, TcType) -&gt; TcM (HsExpr GhcTc, TcType)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681092817"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092816"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1896"></span><span>
</span><span id="line-1897"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tc_infer_assert"><span class="hs-identifier hs-type">tc_infer_assert</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1898"></span><span class="hs-comment">-- Deal with an occurrence of 'assert'</span><span>
</span><span id="line-1899"></span><span class="hs-comment">-- See Note [Adding the implicit parameter to 'assert']</span><span>
</span><span id="line-1900"></span><span id="tc_infer_assert"><span class="annot"><span class="annottext">tc_infer_assert :: Name -&gt; TcM (HsExpr GhcTc, TcType)
</span><a href="GHC.Tc.Gen.Expr.html#tc_infer_assert"><span class="hs-identifier hs-var hs-var">tc_infer_assert</span></a></span></span><span> </span><span id="local-6989586621681092814"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681092814"><span class="hs-identifier hs-var">assert_name</span></a></span></span><span>
</span><span id="line-1901"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681092813"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681092813"><span class="hs-identifier hs-var">assert_error_id</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Var
</span><a href="GHC.Tc.Utils.Env.html#tcLookupId"><span class="hs-identifier hs-var">tcLookupId</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#assertErrorName"><span class="hs-identifier hs-var">assertErrorName</span></a></span><span>
</span><span id="line-1902"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681092811"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681092811"><span class="hs-identifier hs-var">wrap</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681092810"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092810"><span class="hs-identifier hs-var">id_rho</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; TcType -&gt; TcM (HsWrapper, TcType)
</span><a href="GHC.Tc.Utils.Instantiate.html#topInstantiate"><span class="hs-identifier hs-var">topInstantiate</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#OccurrenceOf"><span class="hs-identifier hs-var">OccurrenceOf</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681092814"><span class="hs-identifier hs-var">assert_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1903"></span><span>                                          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; TcType
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681092813"><span class="hs-identifier hs-var">assert_error_id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1904"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc, TcType) -&gt; TcM (HsExpr GhcTc, TcType)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrap"><span class="hs-identifier hs-var">mkHsWrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681092811"><span class="hs-identifier hs-var">wrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XVar GhcTc -&gt; Located (IdP GhcTc) -&gt; HsExpr GhcTc
forall p. XVar p -&gt; Located (IdP p) -&gt; HsExpr p
</span><a href="GHC.Hs.Expr.html#HsVar"><span class="hs-identifier hs-var">HsVar</span></a></span><span> </span><span class="annot"><span class="annottext">NoExtField
XVar GhcTc
</span><a href="GHC.Hs.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Located Var
forall e. e -&gt; Located e
</span><a href="GHC.Types.SrcLoc.html#noLoc"><span class="hs-identifier hs-var">noLoc</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681092813"><span class="hs-identifier hs-var">assert_error_id</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092810"><span class="hs-identifier hs-var">id_rho</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1905"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-1906"></span><span>
</span><span id="line-1907"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tc_infer_id"><span class="hs-identifier hs-type">tc_infer_id</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1908"></span><span id="tc_infer_id"><span class="annot"><span class="annottext">tc_infer_id :: RdrName -&gt; Name -&gt; TcM (HsExpr GhcTc, TcType)
</span><a href="GHC.Tc.Gen.Expr.html#tc_infer_id"><span class="hs-identifier hs-var hs-var">tc_infer_id</span></a></span></span><span> </span><span id="local-6989586621681092809"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621681092809"><span class="hs-identifier hs-var">lbl</span></a></span></span><span> </span><span id="local-6989586621681092808"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681092808"><span class="hs-identifier hs-var">id_name</span></a></span></span><span>
</span><span id="line-1909"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681092807"><span class="annot"><span class="annottext">TcTyThing
</span><a href="#local-6989586621681092807"><span class="hs-identifier hs-var">thing</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM TcTyThing
</span><a href="GHC.Tc.Utils.Env.html#tcLookup"><span class="hs-identifier hs-var">tcLookup</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681092808"><span class="hs-identifier hs-var">id_name</span></a></span><span>
</span><span id="line-1910"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TcTyThing
</span><a href="#local-6989586621681092807"><span class="hs-identifier hs-var">thing</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1911"></span><span>             </span><span class="annot"><a href="GHC.Tc.Types.html#ATcId"><span class="hs-identifier hs-type">ATcId</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tct_id :: TcTyThing -&gt; Var
</span><a href="GHC.Tc.Types.html#tct_id"><span class="hs-identifier hs-var">tct_id</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681092803"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681092803"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1912"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Var -&gt; TcRn ()
</span><a href="#local-6989586621681092802"><span class="hs-identifier hs-var">check_naughty</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681092803"><span class="hs-identifier hs-var">id</span></a></span><span>        </span><span class="hs-comment">-- Note [Local record selectors]</span><span>
</span><span id="line-1913"></span><span>                     </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; TcRn ()
</span><a href="GHC.Tc.Gen.Expr.html#checkThLocalId"><span class="hs-identifier hs-var">checkThLocalId</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681092803"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-1914"></span><span>                     </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">UsageEnv -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#tcEmitBindingUsage"><span class="hs-identifier hs-var">tcEmitBindingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">(UsageEnv -&gt; TcRn ()) -&gt; UsageEnv -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcType -&gt; UsageEnv
forall n. NamedThing n =&gt; n -&gt; TcType -&gt; UsageEnv
</span><a href="GHC.Core.UsageEnv.html#unitUE"><span class="hs-identifier hs-var">unitUE</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681092808"><span class="hs-identifier hs-var">id_name</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="GHC.Core.Type.html#One"><span class="hs-identifier hs-var">One</span></a></span><span>
</span><span id="line-1915"></span><span>                     </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; TcM (HsExpr GhcTc, TcType)
forall {m :: * -&gt; *} {p}.
(Monad m, XVar p ~ NoExtField, IdP p ~ Var) =&gt;
Var -&gt; m (HsExpr p, TcType)
</span><a href="#local-6989586621681092799"><span class="hs-identifier hs-var">return_id</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681092803"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1916"></span><span>
</span><span id="line-1917"></span><span>             </span><span class="annot"><a href="GHC.Tc.Types.html#AGlobal"><span class="hs-identifier hs-type">AGlobal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AnId"><span class="hs-identifier hs-type">AnId</span></a></span><span> </span><span id="local-6989586621681092796"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681092796"><span class="hs-identifier hs-var">id</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1918"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Var -&gt; TcRn ()
</span><a href="#local-6989586621681092802"><span class="hs-identifier hs-var">check_naughty</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681092796"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-1919"></span><span>                     </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Var -&gt; TcM (HsExpr GhcTc, TcType)
forall {m :: * -&gt; *} {p}.
(Monad m, XVar p ~ NoExtField, IdP p ~ Var) =&gt;
Var -&gt; m (HsExpr p, TcType)
</span><a href="#local-6989586621681092799"><span class="hs-identifier hs-var">return_id</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681092796"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1920"></span><span>                    </span><span class="hs-comment">-- A global cannot possibly be ill-staged</span><span>
</span><span id="line-1921"></span><span>                    </span><span class="hs-comment">-- nor does it need the 'lifting' treatment</span><span>
</span><span id="line-1922"></span><span>                    </span><span class="hs-comment">-- hence no checkTh stuff here</span><span>
</span><span id="line-1923"></span><span>
</span><span id="line-1924"></span><span>             </span><span class="annot"><a href="GHC.Tc.Types.html#AGlobal"><span class="hs-identifier hs-type">AGlobal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AConLike"><span class="hs-identifier hs-type">AConLike</span></a></span><span> </span><span id="local-6989586621681092794"><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681092794"><span class="hs-identifier hs-var">cl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681092794"><span class="hs-identifier hs-var">cl</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1925"></span><span>                 </span><span class="annot"><a href="GHC.Core.ConLike.html#RealDataCon"><span class="hs-identifier hs-type">RealDataCon</span></a></span><span> </span><span id="local-6989586621681092793"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681092793"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; TcM (HsExpr GhcTc, TcType)
</span><a href="#local-6989586621681092792"><span class="hs-identifier hs-var">return_data_con</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681092793"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-1926"></span><span>                 </span><span class="annot"><a href="GHC.Core.ConLike.html#PatSynCon"><span class="hs-identifier hs-type">PatSynCon</span></a></span><span> </span><span id="local-6989586621681092791"><span class="annot"><span class="annottext">PatSyn
</span><a href="#local-6989586621681092791"><span class="hs-identifier hs-var">ps</span></a></span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PatSyn -&gt; TcM (HsExpr GhcTc, TcType)
</span><a href="GHC.Tc.TyCl.PatSyn.html#tcPatSynBuilderOcc"><span class="hs-identifier hs-var">tcPatSynBuilderOcc</span></a></span><span> </span><span class="annot"><span class="annottext">PatSyn
</span><a href="#local-6989586621681092791"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-1927"></span><span>
</span><span id="line-1928"></span><span>             </span><span class="annot"><span class="annottext">TcTyThing
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcM (HsExpr GhcTc, TcType)
forall a. SDoc -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; TcM (HsExpr GhcTc, TcType))
-&gt; SDoc -&gt; TcM (HsExpr GhcTc, TcType)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1929"></span><span>                  </span><span class="annot"><span class="annottext">TcTyThing -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyThing
</span><a href="#local-6989586621681092807"><span class="hs-identifier hs-var">thing</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;used where a value identifier was expected&quot;</span></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1930"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1931"></span><span>    </span><span id="local-6989586621681092799"><span class="annot"><span class="annottext">return_id :: Var -&gt; m (HsExpr p, TcType)
</span><a href="#local-6989586621681092799"><span class="hs-identifier hs-var hs-var">return_id</span></a></span></span><span> </span><span id="local-6989586621681092780"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681092780"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HsExpr p, TcType) -&gt; m (HsExpr p, TcType)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XVar p -&gt; Located (IdP p) -&gt; HsExpr p
forall p. XVar p -&gt; Located (IdP p) -&gt; HsExpr p
</span><a href="GHC.Hs.Expr.html#HsVar"><span class="hs-identifier hs-var">HsVar</span></a></span><span> </span><span class="annot"><span class="annottext">NoExtField
XVar p
</span><a href="GHC.Hs.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Located Var
forall e. e -&gt; Located e
</span><a href="GHC.Types.SrcLoc.html#noLoc"><span class="hs-identifier hs-var">noLoc</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681092780"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var -&gt; TcType
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681092780"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1932"></span><span>
</span><span id="line-1933"></span><span>    </span><span id="local-6989586621681092792"><span class="annot"><span class="annottext">return_data_con :: DataCon -&gt; TcM (HsExpr GhcTc, TcType)
</span><a href="#local-6989586621681092792"><span class="hs-identifier hs-var hs-var">return_data_con</span></a></span></span><span> </span><span id="local-6989586621681092779"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681092779"><span class="hs-identifier hs-var">con</span></a></span></span><span>
</span><span id="line-1934"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681092778"><span class="annot"><span class="annottext">tvs :: [VarBndr Var Specificity]
</span><a href="#local-6989586621681092778"><span class="hs-identifier hs-var hs-var">tvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; [VarBndr Var Specificity]
</span><a href="GHC.Core.DataCon.html#dataConUserTyVarBinders"><span class="hs-identifier hs-var">dataConUserTyVarBinders</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681092779"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-1935"></span><span>                 </span><span id="local-6989586621681092776"><span class="annot"><span class="annottext">theta :: [TcType]
</span><a href="#local-6989586621681092776"><span class="hs-identifier hs-var hs-var">theta</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; [TcType]
</span><a href="GHC.Core.DataCon.html#dataConOtherTheta"><span class="hs-identifier hs-var">dataConOtherTheta</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681092779"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-1936"></span><span>                 </span><span id="local-6989586621681092774"><span class="annot"><span class="annottext">args :: [Scaled TcType]
</span><a href="#local-6989586621681092774"><span class="hs-identifier hs-var hs-var">args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; [Scaled TcType]
</span><a href="GHC.Core.DataCon.html#dataConOrigArgTys"><span class="hs-identifier hs-var">dataConOrigArgTys</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681092779"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-1937"></span><span>                 </span><span id="local-6989586621681092772"><span class="annot"><span class="annottext">res :: TcType
</span><a href="#local-6989586621681092772"><span class="hs-identifier hs-var hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; TcType
</span><a href="GHC.Core.DataCon.html#dataConOrigResTy"><span class="hs-identifier hs-var">dataConOrigResTy</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681092779"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-1938"></span><span>
</span><span id="line-1939"></span><span>           </span><span class="hs-comment">-- See Note [Linear fields generalization]</span><span>
</span><span id="line-1940"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681092770"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681092770"><span class="hs-identifier hs-var">mul_vars</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ThLevel -&gt; TcType -&gt; IOEnv (Env TcGblEnv TcLclEnv) [TcType]
</span><a href="GHC.Tc.Utils.TcMType.html#newFlexiTyVarTys"><span class="hs-identifier hs-var">newFlexiTyVarTys</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Scaled TcType] -&gt; ThLevel
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; ThLevel
</span><a href="../../base/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681092774"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="GHC.Builtin.Types.html#multiplicityTy"><span class="hs-identifier hs-var">multiplicityTy</span></a></span><span>
</span><span id="line-1941"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681092769"><span class="annot"><span class="annottext">scaleArgs :: [Scaled TcType] -&gt; [Scaled TcType]
</span><a href="#local-6989586621681092769"><span class="hs-identifier hs-var hs-var">scaleArgs</span></a></span></span><span> </span><span id="local-6989586621681092768"><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681092768"><span class="hs-identifier hs-var">args'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
-&gt; (TcType -&gt; Scaled TcType -&gt; Scaled TcType)
-&gt; [TcType]
-&gt; [Scaled TcType]
-&gt; [Scaled TcType]
forall a b c. String -&gt; (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><a href="GHC.Utils.Misc.html#zipWithEqual"><span class="hs-identifier hs-var">zipWithEqual</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;return_data_con&quot;</span></span><span> </span><span class="annot"><span class="annottext">TcType -&gt; Scaled TcType -&gt; Scaled TcType
forall {a}. TcType -&gt; Scaled a -&gt; Scaled a
</span><a href="#local-6989586621681092766"><span class="hs-identifier hs-var">combine</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681092770"><span class="hs-identifier hs-var">mul_vars</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681092768"><span class="hs-identifier hs-var">args'</span></a></span><span>
</span><span id="line-1942"></span><span>                 </span><span id="local-6989586621681092766"><span class="annot"><span class="annottext">combine :: TcType -&gt; Scaled a -&gt; Scaled a
</span><a href="#local-6989586621681092766"><span class="hs-identifier hs-var hs-var">combine</span></a></span></span><span> </span><span id="local-6989586621681092765"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092765"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="GHC.Core.Type.html#One"><span class="hs-identifier hs-var">One</span></a></span><span> </span><span id="local-6989586621681092764"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681092764"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; a -&gt; Scaled a
forall a. TcType -&gt; a -&gt; Scaled a
</span><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-var">Scaled</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092765"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681092764"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1943"></span><span>                 </span><span class="annot"><a href="#local-6989586621681092766"><span class="hs-identifier hs-var">combine</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><span class="hs-identifier">_</span></span><span>   </span><span id="local-6989586621681092763"><span class="annot"><span class="annottext">Scaled a
</span><a href="#local-6989586621681092763"><span class="hs-identifier hs-var">scaled_ty</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Scaled a
</span><a href="#local-6989586621681092763"><span class="hs-identifier hs-var">scaled_ty</span></a></span><span>
</span><span id="line-1944"></span><span>                   </span><span class="hs-comment">-- The combine function implements the fact that, as</span><span>
</span><span id="line-1945"></span><span>                   </span><span class="hs-comment">-- described in Note [Linear fields generalization], if a</span><span>
</span><span id="line-1946"></span><span>                   </span><span class="hs-comment">-- field is not linear (last line) it isn't made polymorphic.</span><span>
</span><span id="line-1947"></span><span>
</span><span id="line-1948"></span><span>                 </span><span id="local-6989586621681092760"><span class="annot"><span class="annottext">etaWrapper :: t (Scaled TcType) -&gt; HsWrapper
</span><a href="#local-6989586621681092760"><span class="hs-identifier hs-var hs-var">etaWrapper</span></a></span></span><span> </span><span id="local-6989586621681092759"><span class="annot"><span class="annottext">t (Scaled TcType)
</span><a href="#local-6989586621681092759"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Scaled TcType -&gt; HsWrapper -&gt; HsWrapper)
-&gt; HsWrapper -&gt; t (Scaled TcType) -&gt; HsWrapper
forall (t :: * -&gt; *) a b.
Foldable t =&gt;
(a -&gt; b -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base/src/Data.Foldable.html#foldr"><span class="hs-identifier hs-var">foldr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681092757"><span class="annot"><span class="annottext">Scaled TcType
</span><a href="#local-6989586621681092757"><span class="hs-identifier hs-var">scaled_ty</span></a></span></span><span> </span><span id="local-6989586621681092756"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681092756"><span class="hs-identifier hs-var">wr</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsWrapper -&gt; Scaled TcType -&gt; SDoc -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#WpFun"><span class="hs-identifier hs-var">WpFun</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#WpHole"><span class="hs-identifier hs-var">WpHole</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681092756"><span class="hs-identifier hs-var">wr</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled TcType
</span><a href="#local-6989586621681092757"><span class="hs-identifier hs-var">scaled_ty</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#WpHole"><span class="hs-identifier hs-var">WpHole</span></a></span><span> </span><span class="annot"><span class="annottext">t (Scaled TcType)
</span><a href="#local-6989586621681092759"><span class="hs-identifier hs-var">arg_tys</span></a></span><span>
</span><span id="line-1949"></span><span>
</span><span id="line-1950"></span><span>           </span><span class="hs-comment">-- See Note [Instantiating stupid theta]</span><span>
</span><span id="line-1951"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681092753"><span class="annot"><span class="annottext">shouldInstantiate :: Bool
</span><a href="#local-6989586621681092753"><span class="hs-identifier hs-var hs-var">shouldInstantiate</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TcType] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; [TcType]
</span><a href="GHC.Core.DataCon.html#dataConStupidTheta"><span class="hs-identifier hs-var">dataConStupidTheta</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681092779"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span>
</span><span id="line-1952"></span><span>                                      </span><span class="annot"><span class="annottext">TcType -&gt; Bool
</span><a href="GHC.Core.Type.html#isKindLevPoly"><span class="hs-identifier hs-var">isKindLevPoly</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; TcType
</span><a href="GHC.Core.TyCon.html#tyConResKind"><span class="hs-identifier hs-var hs-var">tyConResKind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; TyCon
</span><a href="GHC.Core.DataCon.html#dataConTyCon"><span class="hs-identifier hs-var">dataConTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681092779"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1953"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681092753"><span class="hs-identifier hs-var">shouldInstantiate</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1954"></span><span>               </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681092748"><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681092748"><span class="hs-identifier hs-var">subst</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681092747"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621681092747"><span class="hs-identifier hs-var">tvs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; TcM (TCvSubst, [Var])
</span><a href="GHC.Tc.Utils.TcMType.html#newMetaTyVars"><span class="hs-identifier hs-var">newMetaTyVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[VarBndr Var Specificity] -&gt; [Var]
forall tv argf. [VarBndr tv argf] -&gt; [tv]
</span><a href="GHC.Types.Var.html#binderVars"><span class="hs-identifier hs-var">binderVars</span></a></span><span> </span><span class="annot"><span class="annottext">[VarBndr Var Specificity]
</span><a href="#local-6989586621681092778"><span class="hs-identifier hs-var">tvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1955"></span><span>                           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681092745"><span class="annot"><span class="annottext">tys' :: [TcType]
</span><a href="#local-6989586621681092745"><span class="hs-identifier hs-var hs-var">tys'</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; [TcType]
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621681092747"><span class="hs-identifier hs-var">tvs'</span></a></span><span>
</span><span id="line-1956"></span><span>                                 </span><span id="local-6989586621681092744"><span class="annot"><span class="annottext">theta' :: [TcType]
</span><a href="#local-6989586621681092744"><span class="hs-identifier hs-var hs-var">theta'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; TCvSubst -&gt; [TcType] -&gt; [TcType]
TCvSubst -&gt; [TcType] -&gt; [TcType]
</span><a href="GHC.Core.TyCo.Subst.html#substTheta"><span class="hs-identifier hs-var">substTheta</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681092748"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681092776"><span class="hs-identifier hs-var">theta</span></a></span><span>
</span><span id="line-1957"></span><span>                                 </span><span id="local-6989586621681092742"><span class="annot"><span class="annottext">args' :: [Scaled TcType]
</span><a href="#local-6989586621681092742"><span class="hs-identifier hs-var hs-var">args'</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; TCvSubst -&gt; [Scaled TcType] -&gt; [Scaled TcType]
TCvSubst -&gt; [Scaled TcType] -&gt; [Scaled TcType]
</span><a href="GHC.Core.TyCo.Subst.html#substScaledTys"><span class="hs-identifier hs-var">substScaledTys</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681092748"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681092774"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1958"></span><span>                                 </span><span id="local-6989586621681092740"><span class="annot"><span class="annottext">res' :: TcType
</span><a href="#local-6989586621681092740"><span class="hs-identifier hs-var hs-var">res'</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; TCvSubst -&gt; TcType -&gt; TcType
TCvSubst -&gt; TcType -&gt; TcType
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">substTy</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681092748"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092772"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-1959"></span><span>                           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681092739"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681092739"><span class="hs-identifier hs-var">wrap</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; [TcType] -&gt; [TcType] -&gt; TcM HsWrapper
</span><a href="GHC.Tc.Utils.Instantiate.html#instCall"><span class="hs-identifier hs-var">instCall</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#OccurrenceOf"><span class="hs-identifier hs-var">OccurrenceOf</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681092808"><span class="hs-identifier hs-var">id_name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681092745"><span class="hs-identifier hs-var">tys'</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681092744"><span class="hs-identifier hs-var">theta'</span></a></span><span>
</span><span id="line-1960"></span><span>                           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681092737"><span class="annot"><span class="annottext">scaled_arg_tys :: [Scaled TcType]
</span><a href="#local-6989586621681092737"><span class="hs-identifier hs-var hs-var">scaled_arg_tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Scaled TcType] -&gt; [Scaled TcType]
</span><a href="#local-6989586621681092769"><span class="hs-identifier hs-var">scaleArgs</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681092742"><span class="hs-identifier hs-var">args'</span></a></span><span>
</span><span id="line-1961"></span><span>                                 </span><span id="local-6989586621681092736"><span class="annot"><span class="annottext">eta_wrap :: HsWrapper
</span><a href="#local-6989586621681092736"><span class="hs-identifier hs-var hs-var">eta_wrap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Scaled TcType] -&gt; HsWrapper
forall {t :: * -&gt; *}. Foldable t =&gt; t (Scaled TcType) -&gt; HsWrapper
</span><a href="#local-6989586621681092760"><span class="hs-identifier hs-var">etaWrapper</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681092737"><span class="hs-identifier hs-var">scaled_arg_tys</span></a></span><span>
</span><span id="line-1962"></span><span>                           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; [TcType] -&gt; TcRn ()
</span><a href="GHC.Tc.Gen.Pat.html#addDataConStupidTheta"><span class="hs-identifier hs-var">addDataConStupidTheta</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681092779"><span class="hs-identifier hs-var">con</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681092745"><span class="hs-identifier hs-var">tys'</span></a></span><span>
</span><span id="line-1963"></span><span>                           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc, TcType) -&gt; TcM (HsExpr GhcTc, TcType)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrap"><span class="hs-identifier hs-var">mkHsWrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681092736"><span class="hs-identifier hs-var">eta_wrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsWrapper -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681092739"><span class="hs-identifier hs-var">wrap</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1964"></span><span>                                               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XConLikeOut GhcTc -&gt; ConLike -&gt; HsExpr GhcTc
forall p. XConLikeOut p -&gt; ConLike -&gt; HsExpr p
</span><a href="GHC.Hs.Expr.html#HsConLikeOut"><span class="hs-identifier hs-var">HsConLikeOut</span></a></span><span> </span><span class="annot"><span class="annottext">NoExtField
XConLikeOut GhcTc
</span><a href="GHC.Hs.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; ConLike
</span><a href="GHC.Core.ConLike.html#RealDataCon"><span class="hs-identifier hs-var">RealDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681092779"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1965"></span><span>                                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Scaled TcType] -&gt; TcType -&gt; TcType
</span><a href="GHC.Core.TyCo.Rep.html#mkVisFunTys"><span class="hs-identifier hs-var">mkVisFunTys</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681092737"><span class="hs-identifier hs-var">scaled_arg_tys</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092740"><span class="hs-identifier hs-var">res'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1966"></span><span>                           </span><span class="hs-special">}</span><span>
</span><span id="line-1967"></span><span>               </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681092733"><span class="annot"><span class="annottext">scaled_arg_tys :: [Scaled TcType]
</span><a href="#local-6989586621681092733"><span class="hs-identifier hs-var hs-var">scaled_arg_tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Scaled TcType] -&gt; [Scaled TcType]
</span><a href="#local-6989586621681092769"><span class="hs-identifier hs-var">scaleArgs</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681092774"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-1968"></span><span>                            </span><span id="local-6989586621681092732"><span class="annot"><span class="annottext">wrap1 :: HsWrapper
</span><a href="#local-6989586621681092732"><span class="hs-identifier hs-var hs-var">wrap1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TcType] -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#mkWpTyApps"><span class="hs-identifier hs-var">mkWpTyApps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var] -&gt; [TcType]
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a></span><span> </span><span class="annot"><span class="annottext">([Var] -&gt; [TcType]) -&gt; [Var] -&gt; [TcType]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[VarBndr Var Specificity] -&gt; [Var]
forall tv argf. [VarBndr tv argf] -&gt; [tv]
</span><a href="GHC.Types.Var.html#binderVars"><span class="hs-identifier hs-var">binderVars</span></a></span><span> </span><span class="annot"><span class="annottext">[VarBndr Var Specificity]
</span><a href="#local-6989586621681092778"><span class="hs-identifier hs-var">tvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1969"></span><span>                            </span><span id="local-6989586621681092731"><span class="annot"><span class="annottext">eta_wrap :: HsWrapper
</span><a href="#local-6989586621681092731"><span class="hs-identifier hs-var hs-var">eta_wrap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Scaled TcType] -&gt; HsWrapper
forall {t :: * -&gt; *}. Foldable t =&gt; t (Scaled TcType) -&gt; HsWrapper
</span><a href="#local-6989586621681092760"><span class="hs-identifier hs-var">etaWrapper</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TcType -&gt; Scaled TcType) -&gt; [TcType] -&gt; [Scaled TcType]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">TcType -&gt; Scaled TcType
forall a. a -&gt; Scaled a
</span><a href="GHC.Core.Type.html#unrestricted"><span class="hs-identifier hs-var">unrestricted</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681092776"><span class="hs-identifier hs-var">theta</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled TcType] -&gt; [Scaled TcType] -&gt; [Scaled TcType]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681092733"><span class="hs-identifier hs-var">scaled_arg_tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1970"></span><span>                            </span><span id="local-6989586621681092729"><span class="annot"><span class="annottext">wrap2 :: HsWrapper
</span><a href="#local-6989586621681092729"><span class="hs-identifier hs-var hs-var">wrap2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#mkWpTyLams"><span class="hs-identifier hs-var">mkWpTyLams</span></a></span><span> </span><span class="annot"><span class="annottext">([Var] -&gt; HsWrapper) -&gt; [Var] -&gt; HsWrapper
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[VarBndr Var Specificity] -&gt; [Var]
forall tv argf. [VarBndr tv argf] -&gt; [tv]
</span><a href="GHC.Types.Var.html#binderVars"><span class="hs-identifier hs-var">binderVars</span></a></span><span> </span><span class="annot"><span class="annottext">[VarBndr Var Specificity]
</span><a href="#local-6989586621681092778"><span class="hs-identifier hs-var">tvs</span></a></span><span>
</span><span id="line-1971"></span><span>                        </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc, TcType) -&gt; TcM (HsExpr GhcTc, TcType)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrap"><span class="hs-identifier hs-var">mkHsWrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681092729"><span class="hs-identifier hs-var">wrap2</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsWrapper -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681092731"><span class="hs-identifier hs-var">eta_wrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsWrapper -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681092732"><span class="hs-identifier hs-var">wrap1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1972"></span><span>                                             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XConLikeOut GhcTc -&gt; ConLike -&gt; HsExpr GhcTc
forall p. XConLikeOut p -&gt; ConLike -&gt; HsExpr p
</span><a href="GHC.Hs.Expr.html#HsConLikeOut"><span class="hs-identifier hs-var">HsConLikeOut</span></a></span><span> </span><span class="annot"><span class="annottext">NoExtField
XConLikeOut GhcTc
</span><a href="GHC.Hs.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; ConLike
</span><a href="GHC.Core.ConLike.html#RealDataCon"><span class="hs-identifier hs-var">RealDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681092779"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1973"></span><span>                                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[VarBndr Var Specificity] -&gt; TcType -&gt; TcType
</span><a href="GHC.Core.TyCo.Rep.html#mkInvisForAllTys"><span class="hs-identifier hs-var">mkInvisForAllTys</span></a></span><span> </span><span class="annot"><span class="annottext">[VarBndr Var Specificity]
</span><a href="#local-6989586621681092778"><span class="hs-identifier hs-var">tvs</span></a></span><span> </span><span class="annot"><span class="annottext">(TcType -&gt; TcType) -&gt; TcType -&gt; TcType
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType] -&gt; TcType -&gt; TcType
</span><a href="GHC.Core.TyCo.Rep.html#mkInvisFunTysMany"><span class="hs-identifier hs-var">mkInvisFunTysMany</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681092776"><span class="hs-identifier hs-var">theta</span></a></span><span> </span><span class="annot"><span class="annottext">(TcType -&gt; TcType) -&gt; TcType -&gt; TcType
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled TcType] -&gt; TcType -&gt; TcType
</span><a href="GHC.Core.TyCo.Rep.html#mkVisFunTys"><span class="hs-identifier hs-var">mkVisFunTys</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681092733"><span class="hs-identifier hs-var">scaled_arg_tys</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092772"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1974"></span><span>           </span><span class="hs-special">}</span><span>
</span><span id="line-1975"></span><span>
</span><span id="line-1976"></span><span>    </span><span id="local-6989586621681092802"><span class="annot"><span class="annottext">check_naughty :: Var -&gt; TcRn ()
</span><a href="#local-6989586621681092802"><span class="hs-identifier hs-var hs-var">check_naughty</span></a></span></span><span> </span><span id="local-6989586621681092727"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681092727"><span class="hs-identifier hs-var">id</span></a></span></span><span>
</span><span id="line-1977"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Bool
</span><a href="GHC.Types.Id.html#isNaughtyRecordSelector"><span class="hs-identifier hs-var">isNaughtyRecordSelector</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681092727"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcRn ()
forall a. SDoc -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RdrName -&gt; SDoc
</span><a href="GHC.Tc.Gen.Expr.html#naughtyRecordSel"><span class="hs-identifier hs-var">naughtyRecordSel</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621681092809"><span class="hs-identifier hs-var">lbl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1978"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>                  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1979"></span><span>
</span><span id="line-1980"></span><span>
</span><span id="line-1981"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcUnboundId"><span class="hs-identifier hs-type">tcUnboundId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Occurrence.html#OccName"><span class="hs-identifier hs-type">OccName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1982"></span><span class="hs-comment">-- Typecheck an occurrence of an unbound Id</span><span>
</span><span id="line-1983"></span><span class="hs-comment">--</span><span>
</span><span id="line-1984"></span><span class="hs-comment">-- Some of these started life as a true expression hole &quot;_&quot;.</span><span>
</span><span id="line-1985"></span><span class="hs-comment">-- Others might simply be variables that accidentally have no binding site</span><span>
</span><span id="line-1986"></span><span class="hs-comment">--</span><span>
</span><span id="line-1987"></span><span class="hs-comment">-- We turn all of them into HsVar, since HsUnboundVar can't contain an</span><span>
</span><span id="line-1988"></span><span class="hs-comment">-- Id; and indeed the evidence for the ExprHole does bind it, so it's</span><span>
</span><span id="line-1989"></span><span class="hs-comment">-- not unbound any more!</span><span>
</span><span id="line-1990"></span><span id="tcUnboundId"><span class="annot"><span class="annottext">tcUnboundId :: HsExpr GhcRn -&gt; OccName -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcUnboundId"><span class="hs-identifier hs-var hs-var">tcUnboundId</span></a></span></span><span> </span><span id="local-6989586621681092724"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681092724"><span class="hs-identifier hs-var">rn_expr</span></a></span></span><span> </span><span id="local-6989586621681092723"><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621681092723"><span class="hs-identifier hs-var">occ</span></a></span></span><span> </span><span id="local-6989586621681092722"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681092722"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-1991"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681092721"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092721"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#newOpenFlexiTyVarTy"><span class="hs-identifier hs-var">newOpenFlexiTyVarTy</span></a></span><span>  </span><span class="hs-comment">-- Allow Int# etc (#12531)</span><span>
</span><span id="line-1992"></span><span>      </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681092720"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681092720"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; TcM Name
forall gbl lcl. OccName -&gt; TcRnIf gbl lcl Name
</span><a href="GHC.Tc.Utils.Monad.html#newSysName"><span class="hs-identifier hs-var">newSysName</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621681092723"><span class="hs-identifier hs-var">occ</span></a></span><span>
</span><span id="line-1993"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681092718"><span class="annot"><span class="annottext">ev :: Var
</span><a href="#local-6989586621681092718"><span class="hs-identifier hs-var hs-var">ev</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Name -&gt; TcType -&gt; TcType -&gt; Var
Name -&gt; TcType -&gt; TcType -&gt; Var
</span><a href="GHC.Types.Id.html#mkLocalId"><span class="hs-identifier hs-var">mkLocalId</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681092720"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="GHC.Core.Type.html#Many"><span class="hs-identifier hs-var">Many</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092721"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1994"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; Var -&gt; TcType -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.TcMType.html#emitNewExprHole"><span class="hs-identifier hs-var">emitNewExprHole</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621681092723"><span class="hs-identifier hs-var">occ</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681092718"><span class="hs-identifier hs-var">ev</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092721"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1995"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">CtOrigin
-&gt; HsExpr GhcRn
-&gt; HsExpr GhcTc
-&gt; TcType
-&gt; ExpRhoType
-&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Utils.Unify.html#tcWrapResultO"><span class="hs-identifier hs-var">tcWrapResultO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OccName -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#UnboundOccurrenceOf"><span class="hs-identifier hs-var">UnboundOccurrenceOf</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621681092723"><span class="hs-identifier hs-var">occ</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681092724"><span class="hs-identifier hs-var">rn_expr</span></a></span><span>
</span><span id="line-1996"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XVar GhcTc -&gt; Located (IdP GhcTc) -&gt; HsExpr GhcTc
forall p. XVar p -&gt; Located (IdP p) -&gt; HsExpr p
</span><a href="GHC.Hs.Expr.html#HsVar"><span class="hs-identifier hs-var">HsVar</span></a></span><span> </span><span class="annot"><span class="annottext">NoExtField
XVar GhcTc
</span><a href="GHC.Hs.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Located Var
forall e. e -&gt; Located e
</span><a href="GHC.Types.SrcLoc.html#noLoc"><span class="hs-identifier hs-var">noLoc</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681092718"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092721"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681092722"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1997"></span><span>
</span><span id="line-1998"></span><span>
</span><span id="line-1999"></span><span class="hs-comment">{-
Note [Adding the implicit parameter to 'assert']
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
The typechecker transforms (assert e1 e2) to (assertError e1 e2).
This isn't really the Right Thing because there's no way to &quot;undo&quot;
if you want to see the original source code in the typechecker
output.  We'll have fix this in due course, when we care more about
being able to reconstruct the exact original program.

Note [tagToEnum#]
~~~~~~~~~~~~~~~~~
Nasty check to ensure that tagToEnum# is applied to a type that is an
enumeration TyCon.  Unification may refine the type later, but this
check won't see that, alas.  It's crude, because it relies on our
knowing *now* that the type is ok, which in turn relies on the
eager-unification part of the type checker pushing enough information
here.  In theory the Right Thing to do is to have a new form of
constraint but I definitely cannot face that!  And it works ok as-is.

Here's are two cases that should fail
        f :: forall a. a
        f = tagToEnum# 0        -- Can't do tagToEnum# at a type variable

        g :: Int
        g = tagToEnum# 0        -- Int is not an enumeration

When data type families are involved it's a bit more complicated.
     data family F a
     data instance F [Int] = A | B | C
Then we want to generate something like
     tagToEnum# R:FListInt 3# |&gt; co :: R:FListInt ~ F [Int]
Usually that coercion is hidden inside the wrappers for
constructors of F [Int] but here we have to do it explicitly.

It's all grotesquely complicated.

Note [Instantiating stupid theta]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Normally, when we infer the type of an Id, we don't instantiate,
because we wish to allow for visible type application later on.
But if a datacon has a stupid theta, we're a bit stuck. We need
to emit the stupid theta constraints with instantiated types. It's
difficult to defer this to the lazy instantiation, because a stupid
theta has no spot to put it in a type. So we just instantiate eagerly
in this case. Thus, users cannot use visible type application with
a data constructor sporting a stupid theta. I won't feel so bad for
the users that complain.

Note [Linear fields generalization]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
As per Note [Polymorphisation of linear fields], linear field of data
constructors get a polymorphic type when the data constructor is used as a term.

    Just :: forall {p} a. a #p-&gt; Maybe a

This rule is known only to the typechecker: Just keeps its linear type in Core.

In order to desugar this generalised typing rule, we simply eta-expand:

    \a (x # p :: a) -&gt; Just @a x

has the appropriate type. We insert these eta-expansion with WpFun wrappers.

A small hitch: if the constructor is levity-polymorphic (unboxed tuples, sums,
certain newtypes with -XUnliftedNewtypes) then this strategy produces

    \r1 r2 a b (x # p :: a) (y # q :: b) -&gt; (# a, b #)

Which has type

    forall r1 r2 a b. a #p-&gt; b #q-&gt; (# a, b #)

Which violates the levity-polymorphism restriction see Note [Levity polymorphism
checking] in DsMonad.

So we really must instantiate r1 and r2 rather than quantify over them.  For
simplicity, we just instantiate the entire type, as described in Note
[Instantiating stupid theta]. It breaks visible type application with unboxed
tuples, sums and levity-polymorphic newtypes, but this doesn't appear to be used
anywhere.

A better plan: let's force all representation variable to be *inferred*, so that
they are not subject to visible type applications. Then we can instantiate
inferred argument eagerly.
-}</span><span>
</span><span id="line-2084"></span><span>
</span><span id="line-2085"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#isTagToEnum"><span class="hs-identifier hs-type">isTagToEnum</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2086"></span><span id="isTagToEnum"><span class="annot"><span class="annottext">isTagToEnum :: HsExpr GhcTc -&gt; Bool
</span><a href="GHC.Tc.Gen.Expr.html#isTagToEnum"><span class="hs-identifier hs-var hs-var">isTagToEnum</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsVar"><span class="hs-identifier hs-type">HsVar</span></a></span><span> </span><span class="annot"><span class="annottext">XVar GhcTc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681092714"><span class="annot"><span class="annottext">IdP GhcTc
</span><a href="#local-6989586621681092714"><span class="hs-identifier hs-var">fun_id</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var
IdP GhcTc
</span><a href="#local-6989586621681092714"><span class="hs-identifier hs-var">fun_id</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; Unique -&gt; Bool
</span><a href="GHC.Types.Unique.html#hasKey"><span class="hs-operator hs-var">`hasKey`</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.PrimOps.html#tagToEnumKey"><span class="hs-identifier hs-var">tagToEnumKey</span></a></span><span>
</span><span id="line-2087"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#isTagToEnum"><span class="hs-identifier hs-var">isTagToEnum</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2088"></span><span>
</span><span id="line-2089"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcTagToEnum"><span class="hs-identifier hs-type">tcTagToEnum</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#LHsExprArgOut"><span class="hs-identifier hs-type">LHsExprArgOut</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2090"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span>
</span><span id="line-2091"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2092"></span><span class="hs-comment">-- tagToEnum# :: forall a. Int# -&gt; a</span><span>
</span><span id="line-2093"></span><span class="hs-comment">-- See Note [tagToEnum#]   Urgh!</span><span>
</span><span id="line-2094"></span><span id="tcTagToEnum"><span class="annot"><span class="annottext">tcTagToEnum :: HsExpr GhcRn
-&gt; HsExpr GhcTc
-&gt; [LHsExprArgOut]
-&gt; TcType
-&gt; ExpRhoType
-&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcTagToEnum"><span class="hs-identifier hs-var hs-var">tcTagToEnum</span></a></span></span><span> </span><span id="local-6989586621681092713"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681092713"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span id="local-6989586621681092712"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681092712"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span id="local-6989586621681092711"><span class="annot"><span class="annottext">[LHsExprArgOut]
</span><a href="#local-6989586621681092711"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621681092710"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092710"><span class="hs-identifier hs-var">app_res_ty</span></a></span></span><span> </span><span id="local-6989586621681092709"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681092709"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-2095"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681092708"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092708"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpRhoType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#readExpType"><span class="hs-identifier hs-var">readExpType</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681092709"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-2096"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681092707"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092707"><span class="hs-identifier hs-var">ty'</span></a></span></span><span>    </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092708"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-2097"></span><span>
</span><span id="line-2098"></span><span>       </span><span class="hs-comment">-- Check that the type is algebraic</span><span>
</span><span id="line-2099"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; TcType -&gt; Maybe (TyCon, [TcType])
TcType -&gt; Maybe (TyCon, [TcType])
</span><a href="GHC.Core.Type.html#tcSplitTyConApp_maybe"><span class="hs-identifier hs-var">tcSplitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092707"><span class="hs-identifier hs-var">ty'</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-2100"></span><span>           </span><span class="annot"><span class="annottext">Maybe (TyCon, [TcType])
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrTc"><span class="hs-identifier hs-var">addErrTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; SDoc -&gt; SDoc
</span><a href="#local-6989586621681092705"><span class="hs-identifier hs-var">mk_error</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092707"><span class="hs-identifier hs-var">ty'</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681092704"><span class="hs-identifier hs-var">doc1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2101"></span><span>                         </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcM (HsExpr GhcTc)
</span><a href="#local-6989586621681092703"><span class="hs-identifier hs-var">vanilla_result</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-2102"></span><span>           </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681092702"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681092702"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681092701"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681092701"><span class="hs-identifier hs-var">tc_args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2103"></span><span>
</span><span id="line-2104"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- Look through any type family</span><span>
</span><span id="line-2105"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681092700"><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621681092700"><span class="hs-identifier hs-var">fam_envs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM FamInstEnvs
</span><a href="GHC.Tc.Instance.Family.html#tcGetFamInstEnvs"><span class="hs-identifier hs-var">tcGetFamInstEnvs</span></a></span><span>
</span><span id="line-2106"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">FamInstEnvs
-&gt; TyCon -&gt; [TcType] -&gt; Maybe (TyCon, [TcType], TcCoercionR)
</span><a href="GHC.Tc.Instance.Family.html#tcLookupDataFamInst_maybe"><span class="hs-identifier hs-var">tcLookupDataFamInst_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621681092700"><span class="hs-identifier hs-var">fam_envs</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681092702"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681092701"><span class="hs-identifier hs-var">tc_args</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-2107"></span><span>           </span><span class="annot"><span class="annottext">Maybe (TyCon, [TcType], TcCoercionR)
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TyCon -&gt; TcRn ()
</span><a href="#local-6989586621681092699"><span class="hs-identifier hs-var">check_enumeration</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092707"><span class="hs-identifier hs-var">ty'</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681092702"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-2108"></span><span>                         </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcM (HsExpr GhcTc)
</span><a href="#local-6989586621681092703"><span class="hs-identifier hs-var">vanilla_result</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-2109"></span><span>           </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681092698"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681092698"><span class="hs-identifier hs-var">rep_tc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681092697"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681092697"><span class="hs-identifier hs-var">rep_args</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681092696"><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621681092696"><span class="hs-identifier hs-var">coi</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2110"></span><span>
</span><span id="line-2111"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- coi :: tc tc_args ~R rep_tc rep_args</span><span>
</span><span id="line-2112"></span><span>         </span><span class="annot"><span class="annottext">TcType -&gt; TyCon -&gt; TcRn ()
</span><a href="#local-6989586621681092699"><span class="hs-identifier hs-var">check_enumeration</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092707"><span class="hs-identifier hs-var">ty'</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681092698"><span class="hs-identifier hs-var">rep_tc</span></a></span><span>
</span><span id="line-2113"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681092695"><span class="annot"><span class="annottext">val_arg :: [LHsExprArgOut]
</span><a href="#local-6989586621681092695"><span class="hs-identifier hs-var hs-var">val_arg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LHsExprArgOut -&gt; Bool) -&gt; [LHsExprArgOut] -&gt; [LHsExprArgOut]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.List.html#dropWhile"><span class="hs-identifier hs-var">dropWhile</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (LHsExprArgOut -&gt; Bool) -&gt; LHsExprArgOut -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExprArgOut -&gt; Bool
forall (id :: Pass). HsExprArg id -&gt; Bool
</span><a href="GHC.Tc.Gen.Expr.html#isHsValArg"><span class="hs-identifier hs-var">isHsValArg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LHsExprArgOut]
</span><a href="#local-6989586621681092711"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-2114"></span><span>             </span><span id="local-6989586621681092693"><span class="annot"><span class="annottext">rep_ty :: TcType
</span><a href="#local-6989586621681092693"><span class="hs-identifier hs-var hs-var">rep_ty</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [TcType] -&gt; TcType
</span><a href="GHC.Core.TyCo.Rep.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681092698"><span class="hs-identifier hs-var">rep_tc</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681092697"><span class="hs-identifier hs-var">rep_args</span></a></span><span>
</span><span id="line-2115"></span><span>             </span><span id="local-6989586621681092692"><span class="annot"><span class="annottext">fun' :: HsExpr GhcTc
</span><a href="#local-6989586621681092692"><span class="hs-identifier hs-var hs-var">fun'</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrap"><span class="hs-identifier hs-var">mkHsWrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#WpTyApp"><span class="hs-identifier hs-var">WpTyApp</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092693"><span class="hs-identifier hs-var">rep_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681092712"><span class="hs-identifier hs-var">fun</span></a></span><span>
</span><span id="line-2116"></span><span>             </span><span id="local-6989586621681092690"><span class="annot"><span class="annottext">expr' :: HsExpr GhcTc
</span><a href="#local-6989586621681092690"><span class="hs-identifier hs-var hs-var">expr'</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; [LHsExprArgOut] -&gt; HsExpr GhcTc
</span><a href="GHC.Tc.Gen.Expr.html#applyHsArgs"><span class="hs-identifier hs-var">applyHsArgs</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681092692"><span class="hs-identifier hs-var">fun'</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsExprArgOut]
</span><a href="#local-6989586621681092695"><span class="hs-identifier hs-var">val_arg</span></a></span><span>
</span><span id="line-2117"></span><span>             </span><span id="local-6989586621681092689"><span class="annot"><span class="annottext">df_wrap :: HsWrapper
</span><a href="#local-6989586621681092689"><span class="hs-identifier hs-var hs-var">df_wrap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcCoercionR -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#mkWpCastR"><span class="hs-identifier hs-var">mkWpCastR</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcCoercionR -&gt; TcCoercionR
</span><a href="GHC.Tc.Types.Evidence.html#mkTcSymCo"><span class="hs-identifier hs-var">mkTcSymCo</span></a></span><span> </span><span class="annot"><span class="annottext">TcCoercionR
</span><a href="#local-6989586621681092696"><span class="hs-identifier hs-var">coi</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2118"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrap"><span class="hs-identifier hs-var">mkHsWrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681092689"><span class="hs-identifier hs-var">df_wrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681092690"><span class="hs-identifier hs-var">expr'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><span id="line-2119"></span><span>
</span><span id="line-2120"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2121"></span><span>    </span><span id="local-6989586621681092703"><span class="annot"><span class="annottext">vanilla_result :: TcM (HsExpr GhcTc)
</span><a href="#local-6989586621681092703"><span class="hs-identifier hs-var hs-var">vanilla_result</span></a></span></span><span>
</span><span id="line-2122"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681092688"><span class="annot"><span class="annottext">expr' :: HsExpr GhcTc
</span><a href="#local-6989586621681092688"><span class="hs-identifier hs-var hs-var">expr'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; [LHsExprArgOut] -&gt; HsExpr GhcTc
</span><a href="GHC.Tc.Gen.Expr.html#applyHsArgs"><span class="hs-identifier hs-var">applyHsArgs</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681092712"><span class="hs-identifier hs-var">fun</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsExprArgOut]
</span><a href="#local-6989586621681092711"><span class="hs-identifier hs-var">args</span></a></span><span>
</span><span id="line-2123"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
-&gt; HsExpr GhcTc -&gt; TcType -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Utils.Unify.html#tcWrapResult"><span class="hs-identifier hs-var">tcWrapResult</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681092713"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681092688"><span class="hs-identifier hs-var">expr'</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092710"><span class="hs-identifier hs-var">app_res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681092709"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2124"></span><span>
</span><span id="line-2125"></span><span>    </span><span id="local-6989586621681092699"><span class="annot"><span class="annottext">check_enumeration :: TcType -&gt; TyCon -&gt; TcRn ()
</span><a href="#local-6989586621681092699"><span class="hs-identifier hs-var hs-var">check_enumeration</span></a></span></span><span> </span><span id="local-6989586621681092686"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092686"><span class="hs-identifier hs-var">ty'</span></a></span></span><span> </span><span id="local-6989586621681092685"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681092685"><span class="hs-identifier hs-var">tc</span></a></span></span><span>
</span><span id="line-2126"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isEnumerationTyCon"><span class="hs-identifier hs-var">isEnumerationTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681092685"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2127"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrTc"><span class="hs-identifier hs-var">addErrTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; SDoc -&gt; SDoc
</span><a href="#local-6989586621681092705"><span class="hs-identifier hs-var">mk_error</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092686"><span class="hs-identifier hs-var">ty'</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681092683"><span class="hs-identifier hs-var">doc2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2128"></span><span>
</span><span id="line-2129"></span><span>    </span><span id="local-6989586621681092704"><span class="annot"><span class="annottext">doc1 :: SDoc
</span><a href="#local-6989586621681092704"><span class="hs-identifier hs-var hs-var">doc1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Specify the type by giving a type signature&quot;</span></span><span>
</span><span id="line-2130"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;e.g. (tagToEnum# x) :: Bool&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2131"></span><span>    </span><span id="local-6989586621681092683"><span class="annot"><span class="annottext">doc2 :: SDoc
</span><a href="#local-6989586621681092683"><span class="hs-identifier hs-var hs-var">doc2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Result type must be an enumeration type&quot;</span></span><span>
</span><span id="line-2132"></span><span>
</span><span id="line-2133"></span><span>    </span><span class="annot"><a href="#local-6989586621681092705"><span class="hs-identifier hs-type">mk_error</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-2134"></span><span>    </span><span id="local-6989586621681092705"><span class="annot"><span class="annottext">mk_error :: TcType -&gt; SDoc -&gt; SDoc
</span><a href="#local-6989586621681092705"><span class="hs-identifier hs-var hs-var">mk_error</span></a></span></span><span> </span><span id="local-6989586621681092682"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092682"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621681092681"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681092681"><span class="hs-identifier hs-var">what</span></a></span></span><span>
</span><span id="line-2135"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; ThLevel -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Bad call to tagToEnum#&quot;</span></span><span>
</span><span id="line-2136"></span><span>               </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;at type&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TcType -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092682"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2137"></span><span>           </span><span class="annot"><span class="annottext">ThLevel
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681092681"><span class="hs-identifier hs-var">what</span></a></span><span>
</span><span id="line-2138"></span><span>
</span><span id="line-2139"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                 Template Haskell checks
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-2146"></span><span>
</span><span id="line-2147"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#checkThLocalId"><span class="hs-identifier hs-type">checkThLocalId</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2148"></span><span class="hs-comment">-- The renamer has already done checkWellStaged,</span><span>
</span><span id="line-2149"></span><span class="hs-comment">--   in 'GHC.Rename.Splice.checkThLocalName', so don't repeat that here.</span><span>
</span><span id="line-2150"></span><span class="hs-comment">-- Here we just add constraints fro cross-stage lifting</span><span>
</span><span id="line-2151"></span><span id="checkThLocalId"><span class="annot"><span class="annottext">checkThLocalId :: Var -&gt; TcRn ()
</span><a href="GHC.Tc.Gen.Expr.html#checkThLocalId"><span class="hs-identifier hs-var hs-var">checkThLocalId</span></a></span></span><span> </span><span id="local-6989586621681092679"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681092679"><span class="hs-identifier hs-var">id</span></a></span></span><span>
</span><span id="line-2152"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681092678"><span class="annot"><span class="annottext">Maybe (TopLevelFlag, ThLevel, ThStage)
</span><a href="#local-6989586621681092678"><span class="hs-identifier hs-var">mb_local_use</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcRn (Maybe (TopLevelFlag, ThLevel, ThStage))
</span><a href="GHC.Tc.Utils.Monad.html#getStageAndBindLevel"><span class="hs-identifier hs-var">getStageAndBindLevel</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681092679"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2153"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (TopLevelFlag, ThLevel, ThStage)
</span><a href="#local-6989586621681092678"><span class="hs-identifier hs-var">mb_local_use</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2154"></span><span>             </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681092676"><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="#local-6989586621681092676"><span class="hs-identifier hs-var">top_lvl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681092675"><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621681092675"><span class="hs-identifier hs-var">bind_lvl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681092674"><span class="annot"><span class="annottext">ThStage
</span><a href="#local-6989586621681092674"><span class="hs-identifier hs-var">use_stage</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2155"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ThStage -&gt; ThLevel
</span><a href="GHC.Tc.Types.html#thLevel"><span class="hs-identifier hs-var">thLevel</span></a></span><span> </span><span class="annot"><span class="annottext">ThStage
</span><a href="#local-6989586621681092674"><span class="hs-identifier hs-var">use_stage</span></a></span><span> </span><span class="annot"><span class="annottext">ThLevel -&gt; ThLevel -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621681092675"><span class="hs-identifier hs-var">bind_lvl</span></a></span><span>
</span><span id="line-2156"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TopLevelFlag -&gt; Var -&gt; ThStage -&gt; TcRn ()
</span><a href="GHC.Tc.Gen.Expr.html#checkCrossStageLifting"><span class="hs-identifier hs-var">checkCrossStageLifting</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="#local-6989586621681092676"><span class="hs-identifier hs-var">top_lvl</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681092679"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">ThStage
</span><a href="#local-6989586621681092674"><span class="hs-identifier hs-var">use_stage</span></a></span><span>
</span><span id="line-2157"></span><span>             </span><span class="annot"><span class="annottext">Maybe (TopLevelFlag, ThLevel, ThStage)
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>   </span><span class="hs-comment">-- Not a locally-bound thing, or</span><span>
</span><span id="line-2158"></span><span>                               </span><span class="hs-comment">-- no cross-stage link</span><span>
</span><span id="line-2159"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-2160"></span><span>
</span><span id="line-2161"></span><span class="hs-comment">--------------------------------------</span><span>
</span><span id="line-2162"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#checkCrossStageLifting"><span class="hs-identifier hs-type">checkCrossStageLifting</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#TopLevelFlag"><span class="hs-identifier hs-type">TopLevelFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#ThStage"><span class="hs-identifier hs-type">ThStage</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2163"></span><span class="hs-comment">-- If we are inside typed brackets, and (use_lvl &gt; bind_lvl)</span><span>
</span><span id="line-2164"></span><span class="hs-comment">-- we must check whether there's a cross-stage lift to do</span><span>
</span><span id="line-2165"></span><span class="hs-comment">-- Examples   \x -&gt; [|| x ||]</span><span>
</span><span id="line-2166"></span><span class="hs-comment">--            [|| map ||]</span><span>
</span><span id="line-2167"></span><span class="hs-comment">--</span><span>
</span><span id="line-2168"></span><span class="hs-comment">-- This is similar to checkCrossStageLifting in GHC.Rename.Splice, but</span><span>
</span><span id="line-2169"></span><span class="hs-comment">-- this code is applied to *typed* brackets.</span><span>
</span><span id="line-2170"></span><span>
</span><span id="line-2171"></span><span id="checkCrossStageLifting"><span class="annot"><span class="annottext">checkCrossStageLifting :: TopLevelFlag -&gt; Var -&gt; ThStage -&gt; TcRn ()
</span><a href="GHC.Tc.Gen.Expr.html#checkCrossStageLifting"><span class="hs-identifier hs-var hs-var">checkCrossStageLifting</span></a></span></span><span> </span><span id="local-6989586621681092670"><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="#local-6989586621681092670"><span class="hs-identifier hs-var">top_lvl</span></a></span></span><span> </span><span id="local-6989586621681092669"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681092669"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#Brack"><span class="hs-identifier hs-type">Brack</span></a></span><span> </span><span class="annot"><span class="annottext">ThStage
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#TcPending"><span class="hs-identifier hs-type">TcPending</span></a></span><span> </span><span id="local-6989586621681092666"><span class="annot"><span class="annottext">TcRef [PendingTcSplice]
</span><a href="#local-6989586621681092666"><span class="hs-identifier hs-var">ps_var</span></a></span></span><span> </span><span id="local-6989586621681092665"><span class="annot"><span class="annottext">TcRef WantedConstraints
</span><a href="#local-6989586621681092665"><span class="hs-identifier hs-var">lie_var</span></a></span></span><span> </span><span id="local-6989586621681092664"><span class="annot"><span class="annottext">QuoteWrapper
</span><a href="#local-6989586621681092664"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2172"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TopLevelFlag -&gt; Bool
</span><a href="GHC.Types.Basic.html#isTopLevel"><span class="hs-identifier hs-var">isTopLevel</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelFlag
</span><a href="#local-6989586621681092670"><span class="hs-identifier hs-var">top_lvl</span></a></span><span>
</span><span id="line-2173"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRn () -&gt; TcRn ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="GHC.Types.Name.html#isExternalName"><span class="hs-identifier hs-var">isExternalName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681092660"><span class="hs-identifier hs-var">id_name</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#keepAlive"><span class="hs-identifier hs-var">keepAlive</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681092660"><span class="hs-identifier hs-var">id_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2174"></span><span>    </span><span class="hs-comment">-- See Note [Keeping things alive for Template Haskell] in GHC.Rename.Splice</span><span>
</span><span id="line-2175"></span><span>
</span><span id="line-2176"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-2177"></span><span>  </span><span class="hs-glyph">=</span><span>     </span><span class="hs-comment">-- Nested identifiers, such as 'x' in</span><span>
</span><span id="line-2178"></span><span>        </span><span class="hs-comment">-- E.g. \x -&gt; [|| h x ||]</span><span>
</span><span id="line-2179"></span><span>        </span><span class="hs-comment">-- We must behave as if the reference to x was</span><span>
</span><span id="line-2180"></span><span>        </span><span class="hs-comment">--      h $(lift x)</span><span>
</span><span id="line-2181"></span><span>        </span><span class="hs-comment">-- We use 'x' itself as the splice proxy, used by</span><span>
</span><span id="line-2182"></span><span>        </span><span class="hs-comment">-- the desugarer to stitch it all back together.</span><span>
</span><span id="line-2183"></span><span>        </span><span class="hs-comment">-- If 'x' occurs many times we may get many identical</span><span>
</span><span id="line-2184"></span><span>        </span><span class="hs-comment">-- bindings of the same splice proxy, but that doesn't</span><span>
</span><span id="line-2185"></span><span>        </span><span class="hs-comment">-- matter, although it's a mite untidy.</span><span>
</span><span id="line-2186"></span><span>    </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681092658"><span class="annot"><span class="annottext">id_ty :: TcType
</span><a href="#local-6989586621681092658"><span class="hs-identifier hs-var hs-var">id_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; TcType
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681092669"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-2187"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#checkTc"><span class="hs-identifier hs-var">checkTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcType -&gt; Bool
</span><a href="GHC.Core.Type.html#isTauTy"><span class="hs-identifier hs-var">isTauTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092658"><span class="hs-identifier hs-var">id_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; SDoc
</span><a href="GHC.Tc.Gen.Expr.html#polySpliceErr"><span class="hs-identifier hs-var">polySpliceErr</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681092669"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2188"></span><span>               </span><span class="hs-comment">-- If x is polymorphic, its occurrence sites might</span><span>
</span><span id="line-2189"></span><span>               </span><span class="hs-comment">-- have different instantiations, so we can't use plain</span><span>
</span><span id="line-2190"></span><span>               </span><span class="hs-comment">-- 'x' as the splice proxy name.  I don't know how to</span><span>
</span><span id="line-2191"></span><span>               </span><span class="hs-comment">-- solve this, and it's probably unimportant, so I'm</span><span>
</span><span id="line-2192"></span><span>               </span><span class="hs-comment">-- just going to flag an error for now</span><span>
</span><span id="line-2193"></span><span>
</span><span id="line-2194"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681092655"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681092655"><span class="hs-identifier hs-var">lift</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; Bool
</span><a href="GHC.Tc.Utils.TcType.html#isStringTy"><span class="hs-identifier hs-var">isStringTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092658"><span class="hs-identifier hs-var">id_ty</span></a></span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-2195"></span><span>                     </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681092653"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681092653"><span class="hs-identifier hs-var">sid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Var
</span><a href="GHC.Tc.Utils.Env.html#tcLookupId"><span class="hs-identifier hs-var">tcLookupId</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.TH.html#liftStringName"><span class="hs-identifier hs-var">GHC.Builtin.Names.TH.liftStringName</span></a></span><span>
</span><span id="line-2196"></span><span>                                     </span><span class="hs-comment">-- See Note [Lifting strings]</span><span>
</span><span id="line-2197"></span><span>                        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XVar GhcTc -&gt; Located (IdP GhcTc) -&gt; HsExpr GhcTc
forall p. XVar p -&gt; Located (IdP p) -&gt; HsExpr p
</span><a href="GHC.Hs.Expr.html#HsVar"><span class="hs-identifier hs-var">HsVar</span></a></span><span> </span><span class="annot"><span class="annottext">NoExtField
XVar GhcTc
</span><a href="GHC.Hs.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Located Var
forall e. e -&gt; Located e
</span><a href="GHC.Types.SrcLoc.html#noLoc"><span class="hs-identifier hs-var">noLoc</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681092653"><span class="hs-identifier hs-var">sid</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2198"></span><span>                  </span><span class="hs-keyword">else</span><span>
</span><span id="line-2199"></span><span>                     </span><span class="annot"><span class="annottext">TcRef WantedConstraints -&gt; TcM (HsExpr GhcTc) -&gt; TcM (HsExpr GhcTc)
forall a. TcRef WantedConstraints -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#setConstraintVar"><span class="hs-identifier hs-var">setConstraintVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef WantedConstraints
</span><a href="#local-6989586621681092665"><span class="hs-identifier hs-var">lie_var</span></a></span><span>   </span><span class="annot"><span class="annottext">(TcM (HsExpr GhcTc) -&gt; TcM (HsExpr GhcTc))
-&gt; TcM (HsExpr GhcTc) -&gt; TcM (HsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2200"></span><span>                          </span><span class="hs-comment">-- Put the 'lift' constraint into the right LIE</span><span>
</span><span id="line-2201"></span><span>                     </span><span class="annot"><span class="annottext">CtOrigin -&gt; Name -&gt; [TcType] -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Utils.Instantiate.html#newMethodFromName"><span class="hs-identifier hs-var">newMethodFromName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#OccurrenceOf"><span class="hs-identifier hs-var">OccurrenceOf</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681092660"><span class="hs-identifier hs-var">id_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2202"></span><span>                                       </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.TH.html#liftName"><span class="hs-identifier hs-var">GHC.Builtin.Names.TH.liftName</span></a></span><span>
</span><span id="line-2203"></span><span>                                       </span><span class="hs-special">[</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; TcType -&gt; TcType
TcType -&gt; TcType
</span><a href="GHC.Core.Type.html#getRuntimeRep"><span class="hs-identifier hs-var">getRuntimeRep</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092658"><span class="hs-identifier hs-var">id_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092658"><span class="hs-identifier hs-var">id_ty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2204"></span><span>
</span><span id="line-2205"></span><span>                   </span><span class="hs-comment">-- Update the pending splices</span><span>
</span><span id="line-2206"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681092651"><span class="annot"><span class="annottext">[PendingTcSplice]
</span><a href="#local-6989586621681092651"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRef [PendingTcSplice]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [PendingTcSplice]
forall a env. IORef a -&gt; IOEnv env a
</span><a href="GHC.Data.IOEnv.html#readMutVar"><span class="hs-identifier hs-var">readMutVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef [PendingTcSplice]
</span><a href="#local-6989586621681092666"><span class="hs-identifier hs-var">ps_var</span></a></span><span>
</span><span id="line-2207"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681092649"><span class="annot"><span class="annottext">pending_splice :: PendingTcSplice
</span><a href="#local-6989586621681092649"><span class="hs-identifier hs-var hs-var">pending_splice</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; LHsExpr GhcTc -&gt; PendingTcSplice
</span><a href="GHC.Hs.Expr.html#PendingTcSplice"><span class="hs-identifier hs-var">PendingTcSplice</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681092660"><span class="hs-identifier hs-var">id_name</span></a></span><span>
</span><span id="line-2208"></span><span>                                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsExpr GhcTc -&gt; LHsExpr GhcTc -&gt; LHsExpr GhcTc
forall (id :: Pass).
IsPass id =&gt;
LHsExpr (GhcPass id)
-&gt; LHsExpr (GhcPass id) -&gt; LHsExpr (GhcPass id)
</span><a href="GHC.Hs.Utils.html#nlHsApp"><span class="hs-identifier hs-var">nlHsApp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper -&gt; LHsExpr GhcTc -&gt; LHsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkLHsWrap"><span class="hs-identifier hs-var">mkLHsWrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QuoteWrapper -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#applyQuoteWrapper"><span class="hs-identifier hs-var">applyQuoteWrapper</span></a></span><span> </span><span class="annot"><span class="annottext">QuoteWrapper
</span><a href="#local-6989586621681092664"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; LHsExpr GhcTc
forall e. e -&gt; Located e
</span><a href="GHC.Types.SrcLoc.html#noLoc"><span class="hs-identifier hs-var">noLoc</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681092655"><span class="hs-identifier hs-var">lift</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2209"></span><span>                                          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IdP GhcTc -&gt; LHsExpr GhcTc
forall (id :: Pass). IdP (GhcPass id) -&gt; LHsExpr (GhcPass id)
</span><a href="GHC.Hs.Utils.html#nlHsVar"><span class="hs-identifier hs-var">nlHsVar</span></a></span><span> </span><span class="annot"><span class="annottext">Var
IdP GhcTc
</span><a href="#local-6989586621681092669"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2210"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcRef [PendingTcSplice] -&gt; [PendingTcSplice] -&gt; TcRn ()
forall a env. IORef a -&gt; a -&gt; IOEnv env ()
</span><a href="GHC.Data.IOEnv.html#writeMutVar"><span class="hs-identifier hs-var">writeMutVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef [PendingTcSplice]
</span><a href="#local-6989586621681092666"><span class="hs-identifier hs-var">ps_var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PendingTcSplice
</span><a href="#local-6989586621681092649"><span class="hs-identifier hs-var">pending_splice</span></a></span><span> </span><span class="annot"><span class="annottext">PendingTcSplice -&gt; [PendingTcSplice] -&gt; [PendingTcSplice]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[PendingTcSplice]
</span><a href="#local-6989586621681092651"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2211"></span><span>
</span><span id="line-2212"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2213"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2214"></span><span>    </span><span id="local-6989586621681092660"><span class="annot"><span class="annottext">id_name :: Name
</span><a href="#local-6989586621681092660"><span class="hs-identifier hs-var hs-var">id_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681092669"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-2215"></span><span>
</span><span id="line-2216"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#checkCrossStageLifting"><span class="hs-identifier hs-var">checkCrossStageLifting</span></a></span><span> </span><span class="annot"><span class="annottext">TopLevelFlag
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Var
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ThStage
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2217"></span><span>
</span><span id="line-2218"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#polySpliceErr"><span class="hs-identifier hs-type">polySpliceErr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-2219"></span><span id="polySpliceErr"><span class="annot"><span class="annottext">polySpliceErr :: Var -&gt; SDoc
</span><a href="GHC.Tc.Gen.Expr.html#polySpliceErr"><span class="hs-identifier hs-var hs-var">polySpliceErr</span></a></span></span><span> </span><span id="local-6989586621681092643"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681092643"><span class="hs-identifier hs-var">id</span></a></span></span><span>
</span><span id="line-2220"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Can't splice the polymorphic local variable&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681092643"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2221"></span><span>
</span><span id="line-2222"></span><span class="hs-comment">{-
Note [Lifting strings]
~~~~~~~~~~~~~~~~~~~~~~
If we see $(... [| s |] ...) where s::String, we don't want to
generate a mass of Cons (CharL 'x') (Cons (CharL 'y') ...)) etc.
So this conditional short-circuits the lifting mechanism to generate
(liftString &quot;xy&quot;) in that case.  I didn't want to use overlapping instances
for the Lift class in TH.Syntax, because that can lead to overlapping-instance
errors in a polymorphic situation.

If this check fails (which isn't impossible) we get another chance; see
Note [Converting strings] in &quot;GHC.ThToHs&quot;

Local record selectors
~~~~~~~~~~~~~~~~~~~~~~
Record selectors for TyCons in this module are ordinary local bindings,
which show up as ATcIds rather than AGlobals.  So we need to check for
naughtiness in both branches.  c.f. TcTyClsBindings.mkAuxBinds.


************************************************************************
*                                                                      *
\subsection{Record bindings}
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-2248"></span><span>
</span><span id="line-2249"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#getFixedTyVars"><span class="hs-identifier hs-type">getFixedTyVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.FieldLabel.html#FieldLabelString"><span class="hs-identifier hs-type">FieldLabelString</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.ConLike.html#ConLike"><span class="hs-identifier hs-type">ConLike</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#TyVarSet"><span class="hs-identifier hs-type">TyVarSet</span></a></span><span>
</span><span id="line-2250"></span><span class="hs-comment">-- These tyvars must not change across the updates</span><span>
</span><span id="line-2251"></span><span id="getFixedTyVars"><span class="annot"><span class="annottext">getFixedTyVars :: [FieldLabelString] -&gt; [Var] -&gt; [ConLike] -&gt; VarSet
</span><a href="GHC.Tc.Gen.Expr.html#getFixedTyVars"><span class="hs-identifier hs-var hs-var">getFixedTyVars</span></a></span></span><span> </span><span id="local-6989586621681092641"><span class="annot"><span class="annottext">[FieldLabelString]
</span><a href="#local-6989586621681092641"><span class="hs-identifier hs-var">upd_fld_occs</span></a></span></span><span> </span><span id="local-6989586621681092640"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621681092640"><span class="hs-identifier hs-var">univ_tvs</span></a></span></span><span> </span><span id="local-6989586621681092639"><span class="annot"><span class="annottext">[ConLike]
</span><a href="#local-6989586621681092639"><span class="hs-identifier hs-var">cons</span></a></span></span><span>
</span><span id="line-2252"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#mkVarSet"><span class="hs-identifier hs-var">mkVarSet</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681092638"><span class="hs-identifier hs-var">tv1</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681092637"><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681092637"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[ConLike]
</span><a href="#local-6989586621681092639"><span class="hs-identifier hs-var">cons</span></a></span><span>
</span><span id="line-2253"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681092636"><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621681092636"><span class="hs-identifier hs-var">u_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Var]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681092635"><span class="annot"><span class="annottext">[EqSpec]
</span><a href="#local-6989586621681092635"><span class="hs-identifier hs-var">eqspec</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681092634"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681092634"><span class="hs-identifier hs-var">prov_theta</span></a></span></span><span>
</span><span id="line-2254"></span><span>                             </span><span class="hs-special">,</span><span> </span><span id="local-6989586621681092633"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681092633"><span class="hs-identifier hs-var">req_theta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681092632"><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681092632"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-2255"></span><span>                              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConLike
-&gt; ([Var], [Var], [EqSpec], [TcType], [TcType], [Scaled TcType],
    TcType)
</span><a href="GHC.Core.ConLike.html#conLikeFullSig"><span class="hs-identifier hs-var">conLikeFullSig</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681092637"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-2256"></span><span>                            </span><span id="local-6989586621681092631"><span class="annot"><span class="annottext">theta :: [TcType]
</span><a href="#local-6989586621681092631"><span class="hs-identifier hs-var hs-var">theta</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[EqSpec] -&gt; [TcType]
</span><a href="GHC.Core.DataCon.html#eqSpecPreds"><span class="hs-identifier hs-var">eqSpecPreds</span></a></span><span> </span><span class="annot"><span class="annottext">[EqSpec]
</span><a href="#local-6989586621681092635"><span class="hs-identifier hs-var">eqspec</span></a></span><span>
</span><span id="line-2257"></span><span>                                     </span><span class="annot"><span class="annottext">[TcType] -&gt; [TcType] -&gt; [TcType]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681092634"><span class="hs-identifier hs-var">prov_theta</span></a></span><span>
</span><span id="line-2258"></span><span>                                     </span><span class="annot"><span class="annottext">[TcType] -&gt; [TcType] -&gt; [TcType]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681092633"><span class="hs-identifier hs-var">req_theta</span></a></span><span>
</span><span id="line-2259"></span><span>                            </span><span id="local-6989586621681092629"><span class="annot"><span class="annottext">flds :: [FieldLbl Name]
</span><a href="#local-6989586621681092629"><span class="hs-identifier hs-var hs-var">flds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConLike -&gt; [FieldLbl Name]
</span><a href="GHC.Core.ConLike.html#conLikeFieldLabels"><span class="hs-identifier hs-var">conLikeFieldLabels</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681092637"><span class="hs-identifier hs-var">con</span></a></span><span>
</span><span id="line-2260"></span><span>                            </span><span id="local-6989586621681092628"><span class="annot"><span class="annottext">fixed_tvs :: VarSet
</span><a href="#local-6989586621681092628"><span class="hs-identifier hs-var hs-var">fixed_tvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TcType] -&gt; VarSet
</span><a href="GHC.Tc.Utils.TcType.html#exactTyCoVarsOfTypes"><span class="hs-identifier hs-var">exactTyCoVarsOfTypes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Scaled TcType -&gt; TcType) -&gt; [Scaled TcType] -&gt; [TcType]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled TcType -&gt; TcType
forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681092626"><span class="hs-identifier hs-var">fixed_tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2261"></span><span>                                    </span><span class="hs-comment">-- fixed_tys: See Note [Type of a record update]</span><span>
</span><span id="line-2262"></span><span>                                        </span><span class="annot"><span class="annottext">VarSet -&gt; VarSet -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#unionVarSet"><span class="hs-operator hs-var">`unionVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType] -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfTypes"><span class="hs-identifier hs-var">tyCoVarsOfTypes</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681092631"><span class="hs-identifier hs-var">theta</span></a></span><span>
</span><span id="line-2263"></span><span>                                    </span><span class="hs-comment">-- Universally-quantified tyvars that</span><span>
</span><span id="line-2264"></span><span>                                    </span><span class="hs-comment">-- appear in any of the *implicit*</span><span>
</span><span id="line-2265"></span><span>                                    </span><span class="hs-comment">-- arguments to the constructor are fixed</span><span>
</span><span id="line-2266"></span><span>                                    </span><span class="hs-comment">-- See Note [Implicit type sharing]</span><span>
</span><span id="line-2267"></span><span>
</span><span id="line-2268"></span><span>                            </span><span id="local-6989586621681092626"><span class="annot"><span class="annottext">fixed_tys :: [Scaled TcType]
</span><a href="#local-6989586621681092626"><span class="hs-identifier hs-var hs-var">fixed_tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Scaled TcType
</span><a href="#local-6989586621681092624"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681092623"><span class="annot"><span class="annottext">FieldLbl Name
</span><a href="#local-6989586621681092623"><span class="hs-identifier hs-var">fl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681092624"><span class="annot"><span class="annottext">Scaled TcType
</span><a href="#local-6989586621681092624"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[FieldLbl Name]
-&gt; [Scaled TcType] -&gt; [(FieldLbl Name, Scaled TcType)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../../base/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldLbl Name]
</span><a href="#local-6989586621681092629"><span class="hs-identifier hs-var">flds</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681092632"><span class="hs-identifier hs-var">arg_tys</span></a></span><span>
</span><span id="line-2269"></span><span>                                            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldLbl Name -&gt; FieldLabelString
forall a. FieldLbl a -&gt; FieldLabelString
</span><a href="GHC.Types.FieldLabel.html#flLabel"><span class="hs-identifier hs-var hs-var">flLabel</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLbl Name
</span><a href="#local-6989586621681092623"><span class="hs-identifier hs-var">fl</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabelString -&gt; [FieldLabelString] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#elem"><span class="hs-operator hs-var">`elem`</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldLabelString]
</span><a href="#local-6989586621681092641"><span class="hs-identifier hs-var">upd_fld_occs</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-2270"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681092638"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681092638"><span class="hs-identifier hs-var">tv1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681092622"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681092622"><span class="hs-identifier hs-var">tv</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621681092640"><span class="hs-identifier hs-var">univ_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Var] -&gt; [Var] -&gt; [(Var, Var)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../../base/src/GHC.List.html#zip"><span class="hs-operator hs-var">`zip`</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621681092636"><span class="hs-identifier hs-var">u_tvs</span></a></span><span>
</span><span id="line-2271"></span><span>                      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681092622"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; VarSet -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#elemVarSet"><span class="hs-operator hs-var">`elemVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621681092628"><span class="hs-identifier hs-var">fixed_tvs</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2272"></span><span>
</span><span id="line-2273"></span><span class="hs-comment">{-
Note [Disambiguating record fields]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When the -XDuplicateRecordFields extension is used, and the renamer
encounters a record selector or update that it cannot immediately
disambiguate (because it involves fields that belong to multiple
datatypes), it will defer resolution of the ambiguity to the
typechecker.  In this case, the `Ambiguous` constructor of
`AmbiguousFieldOcc` is used.

Consider the following definitions:

        data S = MkS { foo :: Int }
        data T = MkT { foo :: Int, bar :: Int }
        data U = MkU { bar :: Int, baz :: Int }

When the renamer sees `foo` as a selector or an update, it will not
know which parent datatype is in use.

For selectors, there are two possible ways to disambiguate:

1. Check if the pushed-in type is a function whose domain is a
   datatype, for example:

       f s = (foo :: S -&gt; Int) s

       g :: T -&gt; Int
       g = foo

    This is checked by `tcCheckRecSelId` when checking `HsRecFld foo`.

2. Check if the selector is applied to an argument that has a type
   signature, for example:

       h = foo (s :: S)

    This is checked by `tcApp`.


Updates are slightly more complex.  The `disambiguateRecordBinds`
function tries to determine the parent datatype in three ways:

1. Check for types that have all the fields being updated. For example:

        f x = x { foo = 3, bar = 2 }

   Here `f` must be updating `T` because neither `S` nor `U` have
   both fields. This may also discover that no possible type exists.
   For example the following will be rejected:

        f' x = x { foo = 3, baz = 3 }

2. Use the type being pushed in, if it is already a TyConApp. The
   following are valid updates to `T`:

        g :: T -&gt; T
        g x = x { foo = 3 }

        g' x = x { foo = 3 } :: T

3. Use the type signature of the record expression, if it exists and
   is a TyConApp. Thus this is valid update to `T`:

        h x = (x :: T) { foo = 3 }


Note that we do not look up the types of variables being updated, and
no constraint-solving is performed, so for example the following will
be rejected as ambiguous:

     let bad (s :: S) = foo s

     let r :: T
         r = blah
     in r { foo = 3 }

     \r. (r { foo = 3 },  r :: T )

We could add further tests, of a more heuristic nature. For example,
rather than looking for an explicit signature, we could try to infer
the type of the argument to a selector or the record expression being
updated, in case we are lucky enough to get a TyConApp straight
away. However, it might be hard for programmers to predict whether a
particular update is sufficiently obvious for the signature to be
omitted. Moreover, this might change the behaviour of typechecker in
non-obvious ways.

See also Note [HsRecField and HsRecUpdField] in GHC.Hs.Pat.
-}</span><span>
</span><span id="line-2362"></span><span>
</span><span id="line-2363"></span><span class="hs-comment">-- Given a RdrName that refers to multiple record fields, and the type</span><span>
</span><span id="line-2364"></span><span class="hs-comment">-- of its argument, try to determine the name of the selector that is</span><span>
</span><span id="line-2365"></span><span class="hs-comment">-- meant.</span><span>
</span><span id="line-2366"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#disambiguateSelector"><span class="hs-identifier hs-type">disambiguateSelector</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-2367"></span><span id="disambiguateSelector"><span class="annot"><span class="annottext">disambiguateSelector :: Located RdrName -&gt; TcType -&gt; TcM Name
</span><a href="GHC.Tc.Gen.Expr.html#disambiguateSelector"><span class="hs-identifier hs-var hs-var">disambiguateSelector</span></a></span></span><span> </span><span id="local-6989586621681092621"><span class="annot"><span class="annottext">lr :: Located RdrName
</span><a href="#local-6989586621681092621"><span class="hs-identifier hs-var">lr</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681092620"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621681092620"><span class="hs-identifier hs-var">rdr</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681092619"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092619"><span class="hs-identifier hs-var">parent_type</span></a></span></span><span>
</span><span id="line-2368"></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681092618"><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621681092618"><span class="hs-identifier hs-var">fam_inst_envs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM FamInstEnvs
</span><a href="GHC.Tc.Instance.Family.html#tcGetFamInstEnvs"><span class="hs-identifier hs-var">tcGetFamInstEnvs</span></a></span><span>
</span><span id="line-2369"></span><span>      </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">FamInstEnvs -&gt; TcType -&gt; Maybe TyCon
</span><a href="GHC.Tc.Gen.Expr.html#tyConOf"><span class="hs-identifier hs-var">tyConOf</span></a></span><span> </span><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621681092618"><span class="hs-identifier hs-var">fam_inst_envs</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092619"><span class="hs-identifier hs-var">parent_type</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2370"></span><span>          </span><span class="annot"><span class="annottext">Maybe TyCon
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Located RdrName -&gt; TcM Name
forall a. Located RdrName -&gt; TcM a
</span><a href="GHC.Tc.Gen.Expr.html#ambiguousSelector"><span class="hs-identifier hs-var">ambiguousSelector</span></a></span><span> </span><span class="annot"><span class="annottext">Located RdrName
</span><a href="#local-6989586621681092621"><span class="hs-identifier hs-var">lr</span></a></span><span>
</span><span id="line-2371"></span><span>          </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681092616"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681092616"><span class="hs-identifier hs-var">p</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2372"></span><span>            </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681092615"><span class="annot"><span class="annottext">[(RecSelParent, GlobalRdrElt)]
</span><a href="#local-6989586621681092615"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; RnM [(RecSelParent, GlobalRdrElt)]
</span><a href="GHC.Tc.Gen.Expr.html#lookupParents"><span class="hs-identifier hs-var">lookupParents</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621681092620"><span class="hs-identifier hs-var">rdr</span></a></span><span>
</span><span id="line-2373"></span><span>               </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681092613"><span class="annot"><span class="annottext">parent :: RecSelParent
</span><a href="#local-6989586621681092613"><span class="hs-identifier hs-var hs-var">parent</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; RecSelParent
</span><a href="GHC.Types.Id.Info.html#RecSelData"><span class="hs-identifier hs-var">RecSelData</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681092616"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-2374"></span><span>               </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">RecSelParent
-&gt; [(RecSelParent, GlobalRdrElt)] -&gt; Maybe GlobalRdrElt
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><a href="../../base/src/GHC.List.html#lookup"><span class="hs-identifier hs-var">lookup</span></a></span><span> </span><span class="annot"><span class="annottext">RecSelParent
</span><a href="#local-6989586621681092613"><span class="hs-identifier hs-var">parent</span></a></span><span> </span><span class="annot"><span class="annottext">[(RecSelParent, GlobalRdrElt)]
</span><a href="#local-6989586621681092615"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2375"></span><span>                   </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681092611"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621681092611"><span class="hs-identifier hs-var">gre</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; GlobalRdrElt -&gt; TcRn ()
</span><a href="GHC.Rename.Env.html#addUsedGRE"><span class="hs-identifier hs-var">addUsedGRE</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621681092611"><span class="hs-identifier hs-var">gre</span></a></span><span>
</span><span id="line-2376"></span><span>                                  </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Name
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#gre_name"><span class="hs-identifier hs-var hs-var">gre_name</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621681092611"><span class="hs-identifier hs-var">gre</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2377"></span><span>                   </span><span class="annot"><span class="annottext">Maybe GlobalRdrElt
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcM Name
forall a. SDoc -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RecSelParent -&gt; RdrName -&gt; SDoc
</span><a href="GHC.Tc.Gen.Expr.html#fieldNotInType"><span class="hs-identifier hs-var">fieldNotInType</span></a></span><span> </span><span class="annot"><span class="annottext">RecSelParent
</span><a href="#local-6989586621681092613"><span class="hs-identifier hs-var">parent</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621681092620"><span class="hs-identifier hs-var">rdr</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2378"></span><span>
</span><span id="line-2379"></span><span class="hs-comment">-- This field name really is ambiguous, so add a suitable &quot;ambiguous</span><span>
</span><span id="line-2380"></span><span class="hs-comment">-- occurrence&quot; error, then give up.</span><span>
</span><span id="line-2381"></span><span id="local-6989586621681094842"><span class="annot"><a href="GHC.Tc.Gen.Expr.html#ambiguousSelector"><span class="hs-identifier hs-type">ambiguousSelector</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681094842"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-2382"></span><span id="ambiguousSelector"><span class="annot"><span class="annottext">ambiguousSelector :: forall a. Located RdrName -&gt; TcM a
</span><a href="GHC.Tc.Gen.Expr.html#ambiguousSelector"><span class="hs-identifier hs-var hs-var">ambiguousSelector</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681092607"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621681092607"><span class="hs-identifier hs-var">rdr</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2383"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; TcRn ()
</span><a href="GHC.Tc.Gen.Expr.html#addAmbiguousNameErr"><span class="hs-identifier hs-var">addAmbiguousNameErr</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621681092607"><span class="hs-identifier hs-var">rdr</span></a></span><span>
</span><span id="line-2384"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcM a
forall env a. IOEnv env a
</span><a href="GHC.Data.IOEnv.html#failM"><span class="hs-identifier hs-var">failM</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2385"></span><span>
</span><span id="line-2386"></span><span class="hs-comment">-- | This name really is ambiguous, so add a suitable &quot;ambiguous</span><span>
</span><span id="line-2387"></span><span class="hs-comment">-- occurrence&quot; error, then continue</span><span>
</span><span id="line-2388"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#addAmbiguousNameErr"><span class="hs-identifier hs-type">addAmbiguousNameErr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2389"></span><span id="addAmbiguousNameErr"><span class="annot"><span class="annottext">addAmbiguousNameErr :: RdrName -&gt; TcRn ()
</span><a href="GHC.Tc.Gen.Expr.html#addAmbiguousNameErr"><span class="hs-identifier hs-var hs-var">addAmbiguousNameErr</span></a></span></span><span> </span><span id="local-6989586621681092606"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621681092606"><span class="hs-identifier hs-var">rdr</span></a></span></span><span>
</span><span id="line-2390"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681092605"><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621681092605"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn GlobalRdrEnv
</span><a href="GHC.Tc.Utils.Monad.html#getGlobalRdrEnv"><span class="hs-identifier hs-var">getGlobalRdrEnv</span></a></span><span>
</span><span id="line-2391"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681092603"><span class="annot"><span class="annottext">gres :: [GlobalRdrElt]
</span><a href="#local-6989586621681092603"><span class="hs-identifier hs-var hs-var">gres</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; GlobalRdrEnv -&gt; [GlobalRdrElt]
</span><a href="GHC.Types.Name.Reader.html#lookupGRE_RdrName"><span class="hs-identifier hs-var">lookupGRE_RdrName</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621681092606"><span class="hs-identifier hs-var">rdr</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621681092605"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-2392"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">[ErrCtxt] -&gt; TcRn () -&gt; TcRn ()
forall a. [ErrCtxt] -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#setErrCtxt"><span class="hs-identifier hs-var">setErrCtxt</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcRn ()) -&gt; TcRn () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; [GlobalRdrElt] -&gt; TcRn ()
</span><a href="GHC.Rename.Utils.html#addNameClashErrRn"><span class="hs-identifier hs-var">addNameClashErrRn</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621681092606"><span class="hs-identifier hs-var">rdr</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621681092603"><span class="hs-identifier hs-var">gres</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-2393"></span><span>
</span><span id="line-2394"></span><span class="hs-comment">-- Disambiguate the fields in a record update.</span><span>
</span><span id="line-2395"></span><span class="hs-comment">-- See Note [Disambiguating record fields]</span><span>
</span><span id="line-2396"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#disambiguateRecordBinds"><span class="hs-identifier hs-type">disambiguateRecordBinds</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcRhoType"><span class="hs-identifier hs-type">TcRhoType</span></a></span><span>
</span><span id="line-2397"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Hs.Pat.html#LHsRecUpdField"><span class="hs-identifier hs-type">LHsRecUpdField</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span>
</span><span id="line-2398"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Hs.Pat.html#LHsRecField%27"><span class="hs-identifier hs-type">LHsRecField'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Type.html#AmbiguousFieldOcc"><span class="hs-identifier hs-type">AmbiguousFieldOcc</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-2399"></span><span id="disambiguateRecordBinds"><span class="annot"><span class="annottext">disambiguateRecordBinds :: LHsExpr GhcRn
-&gt; TcType
-&gt; [LHsRecUpdField GhcRn]
-&gt; ExpRhoType
-&gt; TcM [LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)]
</span><a href="GHC.Tc.Gen.Expr.html#disambiguateRecordBinds"><span class="hs-identifier hs-var hs-var">disambiguateRecordBinds</span></a></span></span><span> </span><span id="local-6989586621681092600"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681092600"><span class="hs-identifier hs-var">record_expr</span></a></span></span><span> </span><span id="local-6989586621681092599"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092599"><span class="hs-identifier hs-var">record_rho</span></a></span></span><span> </span><span id="local-6989586621681092598"><span class="annot"><span class="annottext">[LHsRecUpdField GhcRn]
</span><a href="#local-6989586621681092598"><span class="hs-identifier hs-var">rbnds</span></a></span></span><span> </span><span id="local-6989586621681092597"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681092597"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-2400"></span><span>    </span><span class="hs-comment">-- Are all the fields unambiguous?</span><span>
</span><span id="line-2401"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(LHsRecUpdField GhcRn -&gt; Maybe (LHsRecUpdField GhcRn, Name))
-&gt; [LHsRecUpdField GhcRn] -&gt; Maybe [(LHsRecUpdField GhcRn, Name)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">LHsRecUpdField GhcRn -&gt; Maybe (LHsRecUpdField GhcRn, Name)
</span><a href="#local-6989586621681092596"><span class="hs-identifier hs-var">isUnambiguous</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsRecUpdField GhcRn]
</span><a href="#local-6989586621681092598"><span class="hs-identifier hs-var">rbnds</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2402"></span><span>                     </span><span class="hs-comment">-- If so, just skip to looking up the Ids</span><span>
</span><span id="line-2403"></span><span>                     </span><span class="hs-comment">-- Always the case if DuplicateRecordFields is off</span><span>
</span><span id="line-2404"></span><span>      </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681092595"><span class="annot"><span class="annottext">[(LHsRecUpdField GhcRn, Name)]
</span><a href="#local-6989586621681092595"><span class="hs-identifier hs-var">rbnds'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">((LHsRecUpdField GhcRn, Name)
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv)
      (LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)))
-&gt; [(LHsRecUpdField GhcRn, Name)]
-&gt; TcM [LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">(LHsRecUpdField GhcRn, Name)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn))
</span><a href="#local-6989586621681092594"><span class="hs-identifier hs-var">lookupSelector</span></a></span><span> </span><span class="annot"><span class="annottext">[(LHsRecUpdField GhcRn, Name)]
</span><a href="#local-6989586621681092595"><span class="hs-identifier hs-var">rbnds'</span></a></span><span>
</span><span id="line-2405"></span><span>      </span><span class="annot"><span class="annottext">Maybe [(LHsRecUpdField GhcRn, Name)]
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-comment">-- If not, try to identify a single parent</span><span>
</span><span id="line-2406"></span><span>        </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681092593"><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621681092593"><span class="hs-identifier hs-var">fam_inst_envs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM FamInstEnvs
</span><a href="GHC.Tc.Instance.Family.html#tcGetFamInstEnvs"><span class="hs-identifier hs-var">tcGetFamInstEnvs</span></a></span><span>
</span><span id="line-2407"></span><span>             </span><span class="hs-comment">-- Look up the possible parents for each field</span><span>
</span><span id="line-2408"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681092592"><span class="annot"><span class="annottext">[(LHsRecUpdField GhcRn, [(RecSelParent, GlobalRdrElt)])]
</span><a href="#local-6989586621681092592"><span class="hs-identifier hs-var">rbnds_with_parents</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM [(LHsRecUpdField GhcRn, [(RecSelParent, GlobalRdrElt)])]
</span><a href="#local-6989586621681092591"><span class="hs-identifier hs-var">getUpdFieldsParents</span></a></span><span>
</span><span id="line-2409"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681092590"><span class="annot"><span class="annottext">possible_parents :: [[RecSelParent]]
</span><a href="#local-6989586621681092590"><span class="hs-identifier hs-var hs-var">possible_parents</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((LHsRecUpdField GhcRn, [(RecSelParent, GlobalRdrElt)])
 -&gt; [RecSelParent])
-&gt; [(LHsRecUpdField GhcRn, [(RecSelParent, GlobalRdrElt)])]
-&gt; [[RecSelParent]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((RecSelParent, GlobalRdrElt) -&gt; RecSelParent)
-&gt; [(RecSelParent, GlobalRdrElt)] -&gt; [RecSelParent]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">(RecSelParent, GlobalRdrElt) -&gt; RecSelParent
forall a b. (a, b) -&gt; a
</span><a href="../../base/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">([(RecSelParent, GlobalRdrElt)] -&gt; [RecSelParent])
-&gt; ((LHsRecUpdField GhcRn, [(RecSelParent, GlobalRdrElt)])
    -&gt; [(RecSelParent, GlobalRdrElt)])
-&gt; (LHsRecUpdField GhcRn, [(RecSelParent, GlobalRdrElt)])
-&gt; [RecSelParent]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(LHsRecUpdField GhcRn, [(RecSelParent, GlobalRdrElt)])
-&gt; [(RecSelParent, GlobalRdrElt)]
forall a b. (a, b) -&gt; b
</span><a href="../../base/src/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(LHsRecUpdField GhcRn, [(RecSelParent, GlobalRdrElt)])]
</span><a href="#local-6989586621681092592"><span class="hs-identifier hs-var">rbnds_with_parents</span></a></span><span>
</span><span id="line-2410"></span><span>             </span><span class="hs-comment">-- Identify a single parent</span><span>
</span><span id="line-2411"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681092589"><span class="annot"><span class="annottext">RecSelParent
</span><a href="#local-6989586621681092589"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FamInstEnvs -&gt; [[RecSelParent]] -&gt; TcM RecSelParent
</span><a href="#local-6989586621681092588"><span class="hs-identifier hs-var">identifyParent</span></a></span><span> </span><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621681092593"><span class="hs-identifier hs-var">fam_inst_envs</span></a></span><span> </span><span class="annot"><span class="annottext">[[RecSelParent]]
</span><a href="#local-6989586621681092590"><span class="hs-identifier hs-var">possible_parents</span></a></span><span>
</span><span id="line-2412"></span><span>             </span><span class="hs-comment">-- Pick the right selector with that parent for each field</span><span>
</span><span id="line-2413"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcM [LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)]
-&gt; TcM [LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)]
forall r. TcM r -&gt; TcM r
</span><a href="GHC.Tc.Utils.Monad.html#checkNoErrs"><span class="hs-identifier hs-var">checkNoErrs</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM [LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)]
 -&gt; TcM [LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)])
-&gt; TcM [LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)]
-&gt; TcM [LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">((LHsRecUpdField GhcRn, [(RecSelParent, GlobalRdrElt)])
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv)
      (LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)))
-&gt; [(LHsRecUpdField GhcRn, [(RecSelParent, GlobalRdrElt)])]
-&gt; TcM [LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RecSelParent
-&gt; (LHsRecUpdField GhcRn, [(RecSelParent, GlobalRdrElt)])
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn))
</span><a href="#local-6989586621681092587"><span class="hs-identifier hs-var">pickParent</span></a></span><span> </span><span class="annot"><span class="annottext">RecSelParent
</span><a href="#local-6989586621681092589"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(LHsRecUpdField GhcRn, [(RecSelParent, GlobalRdrElt)])]
</span><a href="#local-6989586621681092592"><span class="hs-identifier hs-var">rbnds_with_parents</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2414"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2415"></span><span>    </span><span class="hs-comment">-- Extract the selector name of a field update if it is unambiguous</span><span>
</span><span id="line-2416"></span><span>    </span><span class="annot"><a href="#local-6989586621681092596"><span class="hs-identifier hs-type">isUnambiguous</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Pat.html#LHsRecUpdField"><span class="hs-identifier hs-type">LHsRecUpdField</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Pat.html#LHsRecUpdField"><span class="hs-identifier hs-type">LHsRecUpdField</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2417"></span><span>    </span><span id="local-6989586621681092596"><span class="annot"><span class="annottext">isUnambiguous :: LHsRecUpdField GhcRn -&gt; Maybe (LHsRecUpdField GhcRn, Name)
</span><a href="#local-6989586621681092596"><span class="hs-identifier hs-var hs-var">isUnambiguous</span></a></span></span><span> </span><span id="local-6989586621681092586"><span class="annot"><span class="annottext">LHsRecUpdField GhcRn
</span><a href="#local-6989586621681092586"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Located (AmbiguousFieldOcc GhcRn) -&gt; AmbiguousFieldOcc GhcRn
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsRecField' (AmbiguousFieldOcc GhcRn) (LHsExpr GhcRn)
-&gt; Located (AmbiguousFieldOcc GhcRn)
forall id arg. HsRecField' id arg -&gt; Located id
</span><a href="GHC.Hs.Pat.html#hsRecFieldLbl"><span class="hs-identifier hs-var hs-var">hsRecFieldLbl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsRecUpdField GhcRn
-&gt; HsRecField' (AmbiguousFieldOcc GhcRn) (LHsExpr GhcRn)
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LHsRecUpdField GhcRn
</span><a href="#local-6989586621681092586"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2418"></span><span>                        </span><span class="annot"><a href="GHC.Hs.Type.html#Unambiguous"><span class="hs-identifier hs-type">Unambiguous</span></a></span><span> </span><span id="local-6989586621681092585"><span class="annot"><span class="annottext">XUnambiguous GhcRn
</span><a href="#local-6989586621681092585"><span class="hs-identifier hs-var">sel_name</span></a></span></span><span> </span><span class="annot"><span class="annottext">Located RdrName
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(LHsRecUpdField GhcRn, Name) -&gt; Maybe (LHsRecUpdField GhcRn, Name)
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsRecUpdField GhcRn
</span><a href="#local-6989586621681092586"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name
XUnambiguous GhcRn
</span><a href="#local-6989586621681092585"><span class="hs-identifier hs-var">sel_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2419"></span><span>                        </span><span class="annot"><a href="GHC.Hs.Type.html#Ambiguous"><span class="hs-identifier hs-type">Ambiguous</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (LHsRecUpdField GhcRn, Name)
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-2420"></span><span>
</span><span id="line-2421"></span><span>    </span><span class="hs-comment">-- Look up the possible parents and selector GREs for each field</span><span>
</span><span id="line-2422"></span><span>    </span><span class="annot"><a href="#local-6989586621681092591"><span class="hs-identifier hs-type">getUpdFieldsParents</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Pat.html#LHsRecUpdField"><span class="hs-identifier hs-type">LHsRecUpdField</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-2423"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Id.Info.html#RecSelParent"><span class="hs-identifier hs-type">RecSelParent</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-2424"></span><span>    </span><span id="local-6989586621681092591"><span class="annot"><span class="annottext">getUpdFieldsParents :: TcM [(LHsRecUpdField GhcRn, [(RecSelParent, GlobalRdrElt)])]
</span><a href="#local-6989586621681092591"><span class="hs-identifier hs-var hs-var">getUpdFieldsParents</span></a></span></span><span>
</span><span id="line-2425"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([[(RecSelParent, GlobalRdrElt)]]
 -&gt; [(LHsRecUpdField GhcRn, [(RecSelParent, GlobalRdrElt)])])
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [[(RecSelParent, GlobalRdrElt)]]
-&gt; TcM [(LHsRecUpdField GhcRn, [(RecSelParent, GlobalRdrElt)])]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[LHsRecUpdField GhcRn]
-&gt; [[(RecSelParent, GlobalRdrElt)]]
-&gt; [(LHsRecUpdField GhcRn, [(RecSelParent, GlobalRdrElt)])]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../../base/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsRecUpdField GhcRn]
</span><a href="#local-6989586621681092598"><span class="hs-identifier hs-var">rbnds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) [[(RecSelParent, GlobalRdrElt)]]
 -&gt; TcM [(LHsRecUpdField GhcRn, [(RecSelParent, GlobalRdrElt)])])
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [[(RecSelParent, GlobalRdrElt)]]
-&gt; TcM [(LHsRecUpdField GhcRn, [(RecSelParent, GlobalRdrElt)])]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(LHsRecUpdField GhcRn -&gt; RnM [(RecSelParent, GlobalRdrElt)])
-&gt; [LHsRecUpdField GhcRn]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [[(RecSelParent, GlobalRdrElt)]]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span>
</span><span id="line-2426"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RdrName -&gt; RnM [(RecSelParent, GlobalRdrElt)]
</span><a href="GHC.Tc.Gen.Expr.html#lookupParents"><span class="hs-identifier hs-var">lookupParents</span></a></span><span> </span><span class="annot"><span class="annottext">(RdrName -&gt; RnM [(RecSelParent, GlobalRdrElt)])
-&gt; (LHsRecUpdField GhcRn -&gt; RdrName)
-&gt; LHsRecUpdField GhcRn
-&gt; RnM [(RecSelParent, GlobalRdrElt)]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Located RdrName -&gt; RdrName
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">(Located RdrName -&gt; RdrName)
-&gt; (LHsRecUpdField GhcRn -&gt; Located RdrName)
-&gt; LHsRecUpdField GhcRn
-&gt; RdrName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">HsRecField' (AmbiguousFieldOcc GhcRn) (LHsExpr GhcRn)
-&gt; Located RdrName
forall (p :: Pass). HsRecUpdField (GhcPass p) -&gt; Located RdrName
</span><a href="GHC.Hs.Pat.html#hsRecUpdFieldRdr"><span class="hs-identifier hs-var">hsRecUpdFieldRdr</span></a></span><span> </span><span class="annot"><span class="annottext">(HsRecField' (AmbiguousFieldOcc GhcRn) (LHsExpr GhcRn)
 -&gt; Located RdrName)
-&gt; (LHsRecUpdField GhcRn
    -&gt; HsRecField' (AmbiguousFieldOcc GhcRn) (LHsExpr GhcRn))
-&gt; LHsRecUpdField GhcRn
-&gt; Located RdrName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">LHsRecUpdField GhcRn
-&gt; HsRecField' (AmbiguousFieldOcc GhcRn) (LHsExpr GhcRn)
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2427"></span><span>          </span><span class="annot"><span class="annottext">[LHsRecUpdField GhcRn]
</span><a href="#local-6989586621681092598"><span class="hs-identifier hs-var">rbnds</span></a></span><span>
</span><span id="line-2428"></span><span>
</span><span id="line-2429"></span><span>    </span><span class="hs-comment">-- Given a the lists of possible parents for each field,</span><span>
</span><span id="line-2430"></span><span>    </span><span class="hs-comment">-- identify a single parent</span><span>
</span><span id="line-2431"></span><span>    </span><span class="annot"><a href="#local-6989586621681092588"><span class="hs-identifier hs-type">identifyParent</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html#FamInstEnvs"><span class="hs-identifier hs-type">FamInstEnvs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Id.Info.html#RecSelParent"><span class="hs-identifier hs-type">RecSelParent</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Id.Info.html#RecSelParent"><span class="hs-identifier hs-type">RecSelParent</span></a></span><span>
</span><span id="line-2432"></span><span>    </span><span id="local-6989586621681092588"><span class="annot"><span class="annottext">identifyParent :: FamInstEnvs -&gt; [[RecSelParent]] -&gt; TcM RecSelParent
</span><a href="#local-6989586621681092588"><span class="hs-identifier hs-var hs-var">identifyParent</span></a></span></span><span> </span><span id="local-6989586621681092583"><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621681092583"><span class="hs-identifier hs-var">fam_inst_envs</span></a></span></span><span> </span><span id="local-6989586621681092582"><span class="annot"><span class="annottext">[[RecSelParent]]
</span><a href="#local-6989586621681092582"><span class="hs-identifier hs-var">possible_parents</span></a></span></span><span>
</span><span id="line-2433"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">([RecSelParent] -&gt; [RecSelParent] -&gt; [RecSelParent])
-&gt; [[RecSelParent]] -&gt; [RecSelParent]
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; a -&gt; a) -&gt; t a -&gt; a
</span><a href="../../base/src/Data.Foldable.html#foldr1"><span class="hs-identifier hs-var">foldr1</span></a></span><span> </span><span class="annot"><span class="annottext">[RecSelParent] -&gt; [RecSelParent] -&gt; [RecSelParent]
forall a. Eq a =&gt; [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/Data.OldList.html#intersect"><span class="hs-identifier hs-var">intersect</span></a></span><span> </span><span class="annot"><span class="annottext">[[RecSelParent]]
</span><a href="#local-6989586621681092582"><span class="hs-identifier hs-var">possible_parents</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2434"></span><span>        </span><span class="hs-comment">-- No parents for all fields: record update is ill-typed</span><span>
</span><span id="line-2435"></span><span>        </span><span class="hs-special">[</span><span class="hs-special">]</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcM RecSelParent
forall a. SDoc -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[LHsRecUpdField GhcRn] -&gt; SDoc
</span><a href="GHC.Tc.Gen.Expr.html#noPossibleParents"><span class="hs-identifier hs-var">noPossibleParents</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsRecUpdField GhcRn]
</span><a href="#local-6989586621681092598"><span class="hs-identifier hs-var">rbnds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2436"></span><span>
</span><span id="line-2437"></span><span>        </span><span class="hs-comment">-- Exactly one datatype with all the fields: use that</span><span>
</span><span id="line-2438"></span><span>        </span><span class="hs-special">[</span><span id="local-6989586621681092579"><span class="annot"><span class="annottext">RecSelParent
</span><a href="#local-6989586621681092579"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RecSelParent -&gt; TcM RecSelParent
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">RecSelParent
</span><a href="#local-6989586621681092579"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-2439"></span><span>
</span><span id="line-2440"></span><span>        </span><span class="hs-comment">-- Multiple possible parents: try harder to disambiguate</span><span>
</span><span id="line-2441"></span><span>        </span><span class="hs-comment">-- Can we get a parent TyCon from the pushed-in type?</span><span>
</span><span id="line-2442"></span><span>        </span><span class="annot"><span class="annottext">RecSelParent
</span><span class="hs-identifier">_</span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[RecSelParent]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681092578"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681092578"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FamInstEnvs -&gt; ExpRhoType -&gt; Maybe TyCon
</span><a href="GHC.Tc.Gen.Expr.html#tyConOfET"><span class="hs-identifier hs-var">tyConOfET</span></a></span><span> </span><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621681092583"><span class="hs-identifier hs-var">fam_inst_envs</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681092597"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RecSelParent -&gt; TcM RecSelParent
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; RecSelParent
</span><a href="GHC.Types.Id.Info.html#RecSelData"><span class="hs-identifier hs-var">RecSelData</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681092578"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2443"></span><span>
</span><span id="line-2444"></span><span>        </span><span class="hs-comment">-- Does the expression being updated have a type signature?</span><span>
</span><span id="line-2445"></span><span>        </span><span class="hs-comment">-- If so, try to extract a parent TyCon from it</span><span>
</span><span id="line-2446"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; Maybe (LHsSigWcType GhcRn)
</span><a href="GHC.Tc.Gen.Expr.html#obviousSig"><span class="hs-identifier hs-var">obviousSig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; HsExpr GhcRn
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681092600"><span class="hs-identifier hs-var">record_expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2447"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681092576"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681092576"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FamInstEnvs -&gt; TcType -&gt; Maybe TyCon
</span><a href="GHC.Tc.Gen.Expr.html#tyConOf"><span class="hs-identifier hs-var">tyConOf</span></a></span><span> </span><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621681092583"><span class="hs-identifier hs-var">fam_inst_envs</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092599"><span class="hs-identifier hs-var">record_rho</span></a></span><span>
</span><span id="line-2448"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RecSelParent -&gt; TcM RecSelParent
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; RecSelParent
</span><a href="GHC.Types.Id.Info.html#RecSelData"><span class="hs-identifier hs-var">RecSelData</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681092576"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2449"></span><span>
</span><span id="line-2450"></span><span>        </span><span class="hs-comment">-- Nothing else we can try...</span><span>
</span><span id="line-2451"></span><span>        </span><span class="annot"><span class="annottext">[RecSelParent]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcM RecSelParent
forall a. SDoc -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Tc.Gen.Expr.html#badOverloadedUpdate"><span class="hs-identifier hs-var">badOverloadedUpdate</span></a></span><span>
</span><span id="line-2452"></span><span>
</span><span id="line-2453"></span><span>    </span><span class="hs-comment">-- Make a field unambiguous by choosing the given parent.</span><span>
</span><span id="line-2454"></span><span>    </span><span class="hs-comment">-- Emits an error if the field cannot have that parent,</span><span>
</span><span id="line-2455"></span><span>    </span><span class="hs-comment">-- e.g. if the user writes</span><span>
</span><span id="line-2456"></span><span>    </span><span class="hs-comment">--     r { x = e } :: T</span><span>
</span><span id="line-2457"></span><span>    </span><span class="hs-comment">-- where T does not have field x.</span><span>
</span><span id="line-2458"></span><span>    </span><span class="annot"><a href="#local-6989586621681092587"><span class="hs-identifier hs-type">pickParent</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Id.Info.html#RecSelParent"><span class="hs-identifier hs-type">RecSelParent</span></a></span><span>
</span><span id="line-2459"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Pat.html#LHsRecUpdField"><span class="hs-identifier hs-type">LHsRecUpdField</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Id.Info.html#RecSelParent"><span class="hs-identifier hs-type">RecSelParent</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2460"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Pat.html#LHsRecField%27"><span class="hs-identifier hs-type">LHsRecField'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Type.html#AmbiguousFieldOcc"><span class="hs-identifier hs-type">AmbiguousFieldOcc</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2461"></span><span>    </span><span id="local-6989586621681092587"><span class="annot"><span class="annottext">pickParent :: RecSelParent
-&gt; (LHsRecUpdField GhcRn, [(RecSelParent, GlobalRdrElt)])
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn))
</span><a href="#local-6989586621681092587"><span class="hs-identifier hs-var hs-var">pickParent</span></a></span></span><span> </span><span id="local-6989586621681092574"><span class="annot"><span class="annottext">RecSelParent
</span><a href="#local-6989586621681092574"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681092573"><span class="annot"><span class="annottext">LHsRecUpdField GhcRn
</span><a href="#local-6989586621681092573"><span class="hs-identifier hs-var">upd</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681092572"><span class="annot"><span class="annottext">[(RecSelParent, GlobalRdrElt)]
</span><a href="#local-6989586621681092572"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2462"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">RecSelParent
-&gt; [(RecSelParent, GlobalRdrElt)] -&gt; Maybe GlobalRdrElt
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><a href="../../base/src/GHC.List.html#lookup"><span class="hs-identifier hs-var">lookup</span></a></span><span> </span><span class="annot"><span class="annottext">RecSelParent
</span><a href="#local-6989586621681092574"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="annot"><span class="annottext">[(RecSelParent, GlobalRdrElt)]
</span><a href="#local-6989586621681092572"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2463"></span><span>                      </span><span class="hs-comment">-- Phew! The parent is valid for this field.</span><span>
</span><span id="line-2464"></span><span>                      </span><span class="hs-comment">-- Previously ambiguous fields must be marked as</span><span>
</span><span id="line-2465"></span><span>                      </span><span class="hs-comment">-- used now that we know which one is meant, but</span><span>
</span><span id="line-2466"></span><span>                      </span><span class="hs-comment">-- unambiguous ones shouldn't be recorded again</span><span>
</span><span id="line-2467"></span><span>                      </span><span class="hs-comment">-- (giving duplicate deprecation warnings).</span><span>
</span><span id="line-2468"></span><span>          </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681092571"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621681092571"><span class="hs-identifier hs-var">gre</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRn () -&gt; TcRn ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base/src/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(RecSelParent, GlobalRdrElt)] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(RecSelParent, GlobalRdrElt)] -&gt; [(RecSelParent, GlobalRdrElt)]
forall a. [a] -&gt; [a]
</span><a href="../../base/src/GHC.List.html#tail"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">[(RecSelParent, GlobalRdrElt)]
</span><a href="#local-6989586621681092572"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcRn ()) -&gt; TcRn () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2469"></span><span>                             </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681092569"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681092569"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="annot"><span class="annottext">AmbiguousFieldOcc GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsRecField' (AmbiguousFieldOcc GhcRn) (LHsExpr GhcRn)
-&gt; Located (AmbiguousFieldOcc GhcRn)
forall id arg. HsRecField' id arg -&gt; Located id
</span><a href="GHC.Hs.Pat.html#hsRecFieldLbl"><span class="hs-identifier hs-var hs-var">hsRecFieldLbl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsRecUpdField GhcRn
-&gt; HsRecField' (AmbiguousFieldOcc GhcRn) (LHsExpr GhcRn)
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LHsRecUpdField GhcRn
</span><a href="#local-6989586621681092573"><span class="hs-identifier hs-var">upd</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2470"></span><span>                             </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcRn () -&gt; TcRn ()
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681092569"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcRn ()) -&gt; TcRn () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; GlobalRdrElt -&gt; TcRn ()
</span><a href="GHC.Rename.Env.html#addUsedGRE"><span class="hs-identifier hs-var">addUsedGRE</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621681092571"><span class="hs-identifier hs-var">gre</span></a></span><span>
</span><span id="line-2471"></span><span>                         </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(LHsRecUpdField GhcRn, Name)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn))
</span><a href="#local-6989586621681092594"><span class="hs-identifier hs-var">lookupSelector</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsRecUpdField GhcRn
</span><a href="#local-6989586621681092573"><span class="hs-identifier hs-var">upd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#gre_name"><span class="hs-identifier hs-var hs-var">gre_name</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621681092571"><span class="hs-identifier hs-var">gre</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2472"></span><span>                      </span><span class="hs-comment">-- The field doesn't belong to this parent, so report</span><span>
</span><span id="line-2473"></span><span>                      </span><span class="hs-comment">-- an error but keep going through all the fields</span><span>
</span><span id="line-2474"></span><span>          </span><span class="annot"><span class="annottext">Maybe GlobalRdrElt
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrTc"><span class="hs-identifier hs-var">addErrTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RecSelParent -&gt; RdrName -&gt; SDoc
</span><a href="GHC.Tc.Gen.Expr.html#fieldNotInType"><span class="hs-identifier hs-var">fieldNotInType</span></a></span><span> </span><span class="annot"><span class="annottext">RecSelParent
</span><a href="#local-6989586621681092574"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-2475"></span><span>                                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Located RdrName -&gt; RdrName
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsRecField' (AmbiguousFieldOcc GhcRn) (LHsExpr GhcRn)
-&gt; Located RdrName
forall (p :: Pass). HsRecUpdField (GhcPass p) -&gt; Located RdrName
</span><a href="GHC.Hs.Pat.html#hsRecUpdFieldRdr"><span class="hs-identifier hs-var">hsRecUpdFieldRdr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsRecUpdField GhcRn
-&gt; HsRecField' (AmbiguousFieldOcc GhcRn) (LHsExpr GhcRn)
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LHsRecUpdField GhcRn
</span><a href="#local-6989586621681092573"><span class="hs-identifier hs-var">upd</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2476"></span><span>                         </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(LHsRecUpdField GhcRn, Name)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn))
</span><a href="#local-6989586621681092594"><span class="hs-identifier hs-var">lookupSelector</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsRecUpdField GhcRn
</span><a href="#local-6989586621681092573"><span class="hs-identifier hs-var">upd</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#gre_name"><span class="hs-identifier hs-var hs-var">gre_name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(RecSelParent, GlobalRdrElt) -&gt; GlobalRdrElt
forall a b. (a, b) -&gt; b
</span><a href="../../base/src/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[(RecSelParent, GlobalRdrElt)] -&gt; (RecSelParent, GlobalRdrElt)
forall a. [a] -&gt; a
</span><a href="../../base/src/GHC.List.html#head"><span class="hs-identifier hs-var">head</span></a></span><span> </span><span class="annot"><span class="annottext">[(RecSelParent, GlobalRdrElt)]
</span><a href="#local-6989586621681092572"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2477"></span><span>
</span><span id="line-2478"></span><span>    </span><span class="hs-comment">-- Given a (field update, selector name) pair, look up the</span><span>
</span><span id="line-2479"></span><span>    </span><span class="hs-comment">-- selector to give a field update with an unambiguous Id</span><span>
</span><span id="line-2480"></span><span>    </span><span class="annot"><a href="#local-6989586621681092594"><span class="hs-identifier hs-type">lookupSelector</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Pat.html#LHsRecUpdField"><span class="hs-identifier hs-type">LHsRecUpdField</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2481"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Pat.html#LHsRecField%27"><span class="hs-identifier hs-type">LHsRecField'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Type.html#AmbiguousFieldOcc"><span class="hs-identifier hs-type">AmbiguousFieldOcc</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2482"></span><span>    </span><span id="local-6989586621681092594"><span class="annot"><span class="annottext">lookupSelector :: (LHsRecUpdField GhcRn, Name)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn))
</span><a href="#local-6989586621681092594"><span class="hs-identifier hs-var hs-var">lookupSelector</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681092568"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681092568"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621681092567"><span class="annot"><span class="annottext">HsRecField' (AmbiguousFieldOcc GhcRn) (LHsExpr GhcRn)
</span><a href="#local-6989586621681092567"><span class="hs-identifier hs-var">upd</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681092566"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681092566"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2483"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681092565"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681092565"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Var
</span><a href="GHC.Tc.Utils.Env.html#tcLookupId"><span class="hs-identifier hs-var">tcLookupId</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681092566"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-2484"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681092564"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681092564"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681092563"><span class="annot"><span class="annottext">AmbiguousFieldOcc GhcRn
</span><a href="#local-6989586621681092563"><span class="hs-identifier hs-var">af</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsRecField' (AmbiguousFieldOcc GhcRn) (LHsExpr GhcRn)
-&gt; Located (AmbiguousFieldOcc GhcRn)
forall id arg. HsRecField' id arg -&gt; Located id
</span><a href="GHC.Hs.Pat.html#hsRecFieldLbl"><span class="hs-identifier hs-var hs-var">hsRecFieldLbl</span></a></span><span> </span><span class="annot"><span class="annottext">HsRecField' (AmbiguousFieldOcc GhcRn) (LHsExpr GhcRn)
</span><a href="#local-6989586621681092567"><span class="hs-identifier hs-var">upd</span></a></span><span>
</span><span id="line-2485"></span><span>                 </span><span id="local-6989586621681092562"><span class="annot"><span class="annottext">lbl :: RdrName
</span><a href="#local-6989586621681092562"><span class="hs-identifier hs-var hs-var">lbl</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AmbiguousFieldOcc GhcRn -&gt; RdrName
forall (p :: Pass). AmbiguousFieldOcc (GhcPass p) -&gt; RdrName
</span><a href="GHC.Hs.Type.html#rdrNameAmbiguousFieldOcc"><span class="hs-identifier hs-var">rdrNameAmbiguousFieldOcc</span></a></span><span> </span><span class="annot"><span class="annottext">AmbiguousFieldOcc GhcRn
</span><a href="#local-6989586621681092563"><span class="hs-identifier hs-var">af</span></a></span><span>
</span><span id="line-2486"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv)
      (LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)))
-&gt; LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv)
     (LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
-&gt; HsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)
-&gt; LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681092568"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">HsRecField' (AmbiguousFieldOcc GhcRn) (LHsExpr GhcRn)
</span><a href="#local-6989586621681092567"><span class="hs-identifier hs-var">upd</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hsRecFieldLbl :: GenLocated SrcSpan (AmbiguousFieldOcc GhcTc)
</span><a href="GHC.Hs.Pat.html#hsRecFieldLbl"><span class="hs-identifier hs-var">hsRecFieldLbl</span></a></span><span>
</span><span id="line-2487"></span><span>                                  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan
-&gt; AmbiguousFieldOcc GhcTc
-&gt; GenLocated SrcSpan (AmbiguousFieldOcc GhcTc)
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681092564"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XUnambiguous GhcTc -&gt; Located RdrName -&gt; AmbiguousFieldOcc GhcTc
forall pass.
XUnambiguous pass -&gt; Located RdrName -&gt; AmbiguousFieldOcc pass
</span><a href="GHC.Hs.Type.html#Unambiguous"><span class="hs-identifier hs-var">Unambiguous</span></a></span><span> </span><span class="annot"><span class="annottext">Var
XUnambiguous GhcTc
</span><a href="#local-6989586621681092565"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; RdrName -&gt; Located RdrName
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681092564"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621681092562"><span class="hs-identifier hs-var">lbl</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2488"></span><span>
</span><span id="line-2489"></span><span>
</span><span id="line-2490"></span><span class="hs-comment">-- Extract the outermost TyCon of a type, if there is one; for</span><span>
</span><span id="line-2491"></span><span class="hs-comment">-- data families this is the representation tycon (because that's</span><span>
</span><span id="line-2492"></span><span class="hs-comment">-- where the fields live).</span><span>
</span><span id="line-2493"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tyConOf"><span class="hs-identifier hs-type">tyConOf</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html#FamInstEnvs"><span class="hs-identifier hs-type">FamInstEnvs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcSigmaType"><span class="hs-identifier hs-type">TcSigmaType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span>
</span><span id="line-2494"></span><span id="tyConOf"><span class="annot"><span class="annottext">tyConOf :: FamInstEnvs -&gt; TcType -&gt; Maybe TyCon
</span><a href="GHC.Tc.Gen.Expr.html#tyConOf"><span class="hs-identifier hs-var hs-var">tyConOf</span></a></span></span><span> </span><span id="local-6989586621681092561"><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621681092561"><span class="hs-identifier hs-var">fam_inst_envs</span></a></span></span><span> </span><span id="local-6989586621681092560"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092560"><span class="hs-identifier hs-var">ty0</span></a></span></span><span>
</span><span id="line-2495"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; TcType -&gt; Maybe (TyCon, [TcType])
TcType -&gt; Maybe (TyCon, [TcType])
</span><a href="GHC.Core.Type.html#tcSplitTyConApp_maybe"><span class="hs-identifier hs-var">tcSplitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092559"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2496"></span><span>      </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681092558"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681092558"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681092557"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681092557"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Maybe TyCon
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(TyCon, [TcType], TcCoercionR) -&gt; TyCon
forall a b c. (a, b, c) -&gt; a
</span><a href="GHC.Utils.Misc.html#fstOf3"><span class="hs-identifier hs-var">fstOf3</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FamInstEnvs -&gt; TyCon -&gt; [TcType] -&gt; (TyCon, [TcType], TcCoercionR)
</span><a href="GHC.Tc.Instance.Family.html#tcLookupDataFamInst"><span class="hs-identifier hs-var">tcLookupDataFamInst</span></a></span><span> </span><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621681092561"><span class="hs-identifier hs-var">fam_inst_envs</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681092558"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681092557"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2497"></span><span>      </span><span class="annot"><span class="annottext">Maybe (TyCon, [TcType])
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe TyCon
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-2498"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2499"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681092559"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092559"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; ([Var], [TcType], TcType)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitSigmaTy"><span class="hs-identifier hs-var">tcSplitSigmaTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092560"><span class="hs-identifier hs-var">ty0</span></a></span><span>
</span><span id="line-2500"></span><span>
</span><span id="line-2501"></span><span class="hs-comment">-- Variant of tyConOf that works for ExpTypes</span><span>
</span><span id="line-2502"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tyConOfET"><span class="hs-identifier hs-type">tyConOfET</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html#FamInstEnvs"><span class="hs-identifier hs-type">FamInstEnvs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span>
</span><span id="line-2503"></span><span id="tyConOfET"><span class="annot"><span class="annottext">tyConOfET :: FamInstEnvs -&gt; ExpRhoType -&gt; Maybe TyCon
</span><a href="GHC.Tc.Gen.Expr.html#tyConOfET"><span class="hs-identifier hs-var hs-var">tyConOfET</span></a></span></span><span> </span><span id="local-6989586621681092554"><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621681092554"><span class="hs-identifier hs-var">fam_inst_envs</span></a></span></span><span> </span><span id="local-6989586621681092553"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681092553"><span class="hs-identifier hs-var">ty0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FamInstEnvs -&gt; TcType -&gt; Maybe TyCon
</span><a href="GHC.Tc.Gen.Expr.html#tyConOf"><span class="hs-identifier hs-var">tyConOf</span></a></span><span> </span><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621681092554"><span class="hs-identifier hs-var">fam_inst_envs</span></a></span><span> </span><span class="annot"><span class="annottext">(TcType -&gt; Maybe TyCon) -&gt; Maybe TcType -&gt; Maybe TyCon
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><a href="../../base/src/GHC.Base.html#%3D%3C%3C"><span class="hs-operator hs-var">=&lt;&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType -&gt; Maybe TcType
</span><a href="GHC.Tc.Utils.TcMType.html#checkingExpType_maybe"><span class="hs-identifier hs-var">checkingExpType_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681092553"><span class="hs-identifier hs-var">ty0</span></a></span><span>
</span><span id="line-2504"></span><span>
</span><span id="line-2505"></span><span class="hs-comment">-- For an ambiguous record field, find all the candidate record</span><span>
</span><span id="line-2506"></span><span class="hs-comment">-- selectors (as GlobalRdrElts) and their parents.</span><span>
</span><span id="line-2507"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#lookupParents"><span class="hs-identifier hs-type">lookupParents</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Id.Info.html#RecSelParent"><span class="hs-identifier hs-type">RecSelParent</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-2508"></span><span id="lookupParents"><span class="annot"><span class="annottext">lookupParents :: RdrName -&gt; RnM [(RecSelParent, GlobalRdrElt)]
</span><a href="GHC.Tc.Gen.Expr.html#lookupParents"><span class="hs-identifier hs-var hs-var">lookupParents</span></a></span></span><span> </span><span id="local-6989586621681092552"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621681092552"><span class="hs-identifier hs-var">rdr</span></a></span></span><span>
</span><span id="line-2509"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681092551"><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621681092551"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn GlobalRdrEnv
</span><a href="GHC.Tc.Utils.Monad.html#getGlobalRdrEnv"><span class="hs-identifier hs-var">getGlobalRdrEnv</span></a></span><span>
</span><span id="line-2510"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681092550"><span class="annot"><span class="annottext">gres :: [GlobalRdrElt]
</span><a href="#local-6989586621681092550"><span class="hs-identifier hs-var hs-var">gres</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; GlobalRdrEnv -&gt; [GlobalRdrElt]
</span><a href="GHC.Types.Name.Reader.html#lookupGRE_RdrName"><span class="hs-identifier hs-var">lookupGRE_RdrName</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621681092552"><span class="hs-identifier hs-var">rdr</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrEnv
</span><a href="#local-6989586621681092551"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-2511"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(GlobalRdrElt
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) (RecSelParent, GlobalRdrElt))
-&gt; [GlobalRdrElt] -&gt; RnM [(RecSelParent, GlobalRdrElt)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (RecSelParent, GlobalRdrElt)
</span><a href="#local-6989586621681092549"><span class="hs-identifier hs-var">lookupParent</span></a></span><span> </span><span class="annot"><span class="annottext">[GlobalRdrElt]
</span><a href="#local-6989586621681092550"><span class="hs-identifier hs-var">gres</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2512"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2513"></span><span>    </span><span class="annot"><a href="#local-6989586621681092549"><span class="hs-identifier hs-type">lookupParent</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#RnM"><span class="hs-identifier hs-type">RnM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Id.Info.html#RecSelParent"><span class="hs-identifier hs-type">RecSelParent</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#GlobalRdrElt"><span class="hs-identifier hs-type">GlobalRdrElt</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2514"></span><span>    </span><span id="local-6989586621681092549"><span class="annot"><span class="annottext">lookupParent :: GlobalRdrElt
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (RecSelParent, GlobalRdrElt)
</span><a href="#local-6989586621681092549"><span class="hs-identifier hs-var hs-var">lookupParent</span></a></span></span><span> </span><span id="local-6989586621681092548"><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621681092548"><span class="hs-identifier hs-var">gre</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681092547"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681092547"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Var
</span><a href="GHC.Tc.Utils.Env.html#tcLookupId"><span class="hs-identifier hs-var">tcLookupId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#gre_name"><span class="hs-identifier hs-var hs-var">gre_name</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621681092548"><span class="hs-identifier hs-var">gre</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2515"></span><span>                          </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Var -&gt; Bool
</span><a href="GHC.Types.Id.html#isRecordSelector"><span class="hs-identifier hs-var">isRecordSelector</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681092547"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-2516"></span><span>                              </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">(RecSelParent, GlobalRdrElt)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (RecSelParent, GlobalRdrElt)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; RecSelParent
</span><a href="GHC.Types.Id.html#recordSelectorTyCon"><span class="hs-identifier hs-var">recordSelectorTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681092547"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621681092548"><span class="hs-identifier hs-var">gre</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2517"></span><span>                              </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) (RecSelParent, GlobalRdrElt)
forall a. SDoc -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SDoc
</span><a href="GHC.Tc.Gen.Expr.html#notSelector"><span class="hs-identifier hs-var">notSelector</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GlobalRdrElt -&gt; Name
</span><a href="GHC.Types.Name.Reader.html#gre_name"><span class="hs-identifier hs-var hs-var">gre_name</span></a></span><span> </span><span class="annot"><span class="annottext">GlobalRdrElt
</span><a href="#local-6989586621681092548"><span class="hs-identifier hs-var">gre</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2518"></span><span>
</span><span id="line-2519"></span><span class="hs-comment">-- A type signature on the argument of an ambiguous record selector or</span><span>
</span><span id="line-2520"></span><span class="hs-comment">-- the record expression in an update must be &quot;obvious&quot;, i.e. the</span><span>
</span><span id="line-2521"></span><span class="hs-comment">-- outermost constructor ignoring parentheses.</span><span>
</span><span id="line-2522"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#obviousSig"><span class="hs-identifier hs-type">obviousSig</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Type.html#LHsSigWcType"><span class="hs-identifier hs-type">LHsSigWcType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2523"></span><span id="obviousSig"><span class="annot"><span class="annottext">obviousSig :: HsExpr GhcRn -&gt; Maybe (LHsSigWcType GhcRn)
</span><a href="GHC.Tc.Gen.Expr.html#obviousSig"><span class="hs-identifier hs-var hs-var">obviousSig</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#ExprWithTySig"><span class="hs-identifier hs-type">ExprWithTySig</span></a></span><span> </span><span class="annot"><span class="annottext">XExprWithTySig GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681092545"><span class="annot"><span class="annottext">LHsSigWcType (NoGhcTc GhcRn)
</span><a href="#local-6989586621681092545"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsSigWcType GhcRn -&gt; Maybe (LHsSigWcType GhcRn)
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">LHsSigWcType GhcRn
LHsSigWcType (NoGhcTc GhcRn)
</span><a href="#local-6989586621681092545"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-2524"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#obviousSig"><span class="hs-identifier hs-var">obviousSig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsPar"><span class="hs-identifier hs-type">HsPar</span></a></span><span> </span><span class="annot"><span class="annottext">XPar GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681092544"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681092544"><span class="hs-identifier hs-var">p</span></a></span></span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; Maybe (LHsSigWcType GhcRn)
</span><a href="GHC.Tc.Gen.Expr.html#obviousSig"><span class="hs-identifier hs-var">obviousSig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; HsExpr GhcRn
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681092544"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2525"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#obviousSig"><span class="hs-identifier hs-var">obviousSig</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><span class="hs-identifier">_</span></span><span>                    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (LHsSigWcType GhcRn)
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-2526"></span><span>
</span><span id="line-2527"></span><span>
</span><span id="line-2528"></span><span class="hs-comment">{-
Game plan for record bindings
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
1. Find the TyCon for the bindings, from the first field label.

2. Instantiate its tyvars and unify (T a1 .. an) with expected_ty.

For each binding field = value

3. Instantiate the field type (from the field label) using the type
   envt from step 2.

4  Type check the value using tcArg, passing the field type as
   the expected argument type.

This extends OK when the field types are universally quantified.
-}</span><span>
</span><span id="line-2545"></span><span>
</span><span id="line-2546"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcRecordBinds"><span class="hs-identifier hs-type">tcRecordBinds</span></a></span><span>
</span><span id="line-2547"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.ConLike.html#ConLike"><span class="hs-identifier hs-type">ConLike</span></a></span><span>
</span><span id="line-2548"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">]</span><span>     </span><span class="hs-comment">-- Expected type for each field</span><span>
</span><span id="line-2549"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsRecordBinds"><span class="hs-identifier hs-type">HsRecordBinds</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-2550"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsRecordBinds"><span class="hs-identifier hs-type">HsRecordBinds</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2551"></span><span>
</span><span id="line-2552"></span><span id="tcRecordBinds"><span class="annot"><span class="annottext">tcRecordBinds :: ConLike
-&gt; [TcType] -&gt; HsRecordBinds GhcRn -&gt; TcM (HsRecordBinds GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcRecordBinds"><span class="hs-identifier hs-var hs-var">tcRecordBinds</span></a></span></span><span> </span><span id="local-6989586621681092543"><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681092543"><span class="hs-identifier hs-var">con_like</span></a></span></span><span> </span><span id="local-6989586621681092542"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681092542"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Pat.html#HsRecFields"><span class="hs-identifier hs-type">HsRecFields</span></a></span><span> </span><span id="local-6989586621681092540"><span class="annot"><span class="annottext">[LHsRecField GhcRn (LHsExpr GhcRn)]
</span><a href="#local-6989586621681092540"><span class="hs-identifier hs-var">rbinds</span></a></span></span><span> </span><span id="local-6989586621681092539"><span class="annot"><span class="annottext">Maybe (Located ThLevel)
</span><a href="#local-6989586621681092539"><span class="hs-identifier hs-var">dd</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2553"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681092538"><span class="annot"><span class="annottext">[Maybe (LHsRecField GhcTc (LHsExpr GhcTc))]
</span><a href="#local-6989586621681092538"><span class="hs-identifier hs-var">mb_binds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(LHsRecField GhcRn (LHsExpr GhcRn)
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv)
      (Maybe (LHsRecField GhcTc (LHsExpr GhcTc))))
-&gt; [LHsRecField GhcRn (LHsExpr GhcRn)]
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) [Maybe (LHsRecField GhcTc (LHsExpr GhcTc))]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">LHsRecField GhcRn (LHsExpr GhcRn)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (Maybe (LHsRecField GhcTc (LHsExpr GhcTc)))
</span><a href="#local-6989586621681092537"><span class="hs-identifier hs-var">do_bind</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsRecField GhcRn (LHsExpr GhcRn)]
</span><a href="#local-6989586621681092540"><span class="hs-identifier hs-var">rbinds</span></a></span><span>
</span><span id="line-2554"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsRecordBinds GhcTc -&gt; TcM (HsRecordBinds GhcTc)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[LHsRecField GhcTc (LHsExpr GhcTc)]
-&gt; Maybe (Located ThLevel) -&gt; HsRecordBinds GhcTc
forall p arg.
[LHsRecField p arg] -&gt; Maybe (Located ThLevel) -&gt; HsRecFields p arg
</span><a href="GHC.Hs.Pat.html#HsRecFields"><span class="hs-identifier hs-var">HsRecFields</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Maybe (LHsRecField GhcTc (LHsExpr GhcTc))]
-&gt; [LHsRecField GhcTc (LHsExpr GhcTc)]
forall a. [Maybe a] -&gt; [a]
</span><a href="../../base/src/Data.Maybe.html#catMaybes"><span class="hs-identifier hs-var">catMaybes</span></a></span><span> </span><span class="annot"><span class="annottext">[Maybe (LHsRecField GhcTc (LHsExpr GhcTc))]
</span><a href="#local-6989586621681092538"><span class="hs-identifier hs-var">mb_binds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (Located ThLevel)
</span><a href="#local-6989586621681092539"><span class="hs-identifier hs-var">dd</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2555"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2556"></span><span>    </span><span id="local-6989586621681092535"><span class="annot"><span class="annottext">fields :: [Name]
</span><a href="#local-6989586621681092535"><span class="hs-identifier hs-var hs-var">fields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(FieldLbl Name -&gt; Name) -&gt; [FieldLbl Name] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLbl Name -&gt; Name
forall a. FieldLbl a -&gt; a
</span><a href="GHC.Types.FieldLabel.html#flSelector"><span class="hs-identifier hs-var hs-var">flSelector</span></a></span><span> </span><span class="annot"><span class="annottext">([FieldLbl Name] -&gt; [Name]) -&gt; [FieldLbl Name] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike -&gt; [FieldLbl Name]
</span><a href="GHC.Core.ConLike.html#conLikeFieldLabels"><span class="hs-identifier hs-var">conLikeFieldLabels</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681092543"><span class="hs-identifier hs-var">con_like</span></a></span><span>
</span><span id="line-2557"></span><span>    </span><span id="local-6989586621681092533"><span class="annot"><span class="annottext">flds_w_tys :: [(Name, TcType)]
</span><a href="#local-6989586621681092533"><span class="hs-identifier hs-var hs-var">flds_w_tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; [Name] -&gt; [TcType] -&gt; [(Name, TcType)]
forall a b. String -&gt; [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="GHC.Utils.Misc.html#zipEqual"><span class="hs-identifier hs-var">zipEqual</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcRecordBinds&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621681092535"><span class="hs-identifier hs-var">fields</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681092542"><span class="hs-identifier hs-var">arg_tys</span></a></span><span>
</span><span id="line-2558"></span><span>
</span><span id="line-2559"></span><span>    </span><span class="annot"><a href="#local-6989586621681092537"><span class="hs-identifier hs-type">do_bind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Pat.html#LHsRecField"><span class="hs-identifier hs-type">LHsRecField</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2560"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Pat.html#LHsRecField"><span class="hs-identifier hs-type">LHsRecField</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2561"></span><span>    </span><span id="local-6989586621681092537"><span class="annot"><span class="annottext">do_bind :: LHsRecField GhcRn (LHsExpr GhcRn)
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (Maybe (LHsRecField GhcTc (LHsExpr GhcTc)))
</span><a href="#local-6989586621681092537"><span class="hs-identifier hs-var hs-var">do_bind</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681092532"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681092532"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621681092531"><span class="annot"><span class="annottext">fld :: HsRecField GhcRn (LHsExpr GhcRn)
</span><a href="#local-6989586621681092531"><span class="hs-identifier hs-var">fld</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Pat.html#HsRecField"><span class="hs-identifier hs-type">HsRecField</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hsRecFieldLbl :: forall id arg. HsRecField' id arg -&gt; Located id
</span><a href="GHC.Hs.Pat.html#hsRecFieldLbl"><span class="hs-identifier hs-var">hsRecFieldLbl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681092529"><span class="annot"><span class="annottext">Located (FieldOcc GhcRn)
</span><a href="#local-6989586621681092529"><span class="hs-identifier hs-var">f</span></a></span></span><span>
</span><span id="line-2562"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hsRecFieldArg :: forall id arg. HsRecField' id arg -&gt; arg
</span><a href="GHC.Hs.Pat.html#hsRecFieldArg"><span class="hs-identifier hs-var">hsRecFieldArg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681092527"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681092527"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2563"></span><span>
</span><span id="line-2564"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681092526"><span class="annot"><span class="annottext">Maybe (LFieldOcc GhcTc, LHsExpr GhcTc)
</span><a href="#local-6989586621681092526"><span class="hs-identifier hs-var">mb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ConLike
-&gt; [(Name, TcType)]
-&gt; Located (FieldOcc GhcRn)
-&gt; LHsExpr GhcRn
-&gt; TcM (Maybe (LFieldOcc GhcTc, LHsExpr GhcTc))
</span><a href="GHC.Tc.Gen.Expr.html#tcRecordField"><span class="hs-identifier hs-var">tcRecordField</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681092543"><span class="hs-identifier hs-var">con_like</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, TcType)]
</span><a href="#local-6989586621681092533"><span class="hs-identifier hs-var">flds_w_tys</span></a></span><span> </span><span class="annot"><span class="annottext">Located (FieldOcc GhcRn)
</span><a href="#local-6989586621681092529"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681092527"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-2565"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (LFieldOcc GhcTc, LHsExpr GhcTc)
</span><a href="#local-6989586621681092526"><span class="hs-identifier hs-var">mb</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2566"></span><span>               </span><span class="annot"><span class="annottext">Maybe (LFieldOcc GhcTc, LHsExpr GhcTc)
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (LHsRecField GhcTc (LHsExpr GhcTc))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (Maybe (LHsRecField GhcTc (LHsExpr GhcTc)))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (LHsRecField GhcTc (LHsExpr GhcTc))
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-2567"></span><span>               </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681092524"><span class="annot"><span class="annottext">LFieldOcc GhcTc
</span><a href="#local-6989586621681092524"><span class="hs-identifier hs-var">f'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681092523"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681092523"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (LHsRecField GhcTc (LHsExpr GhcTc))
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (Maybe (LHsRecField GhcTc (LHsExpr GhcTc)))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsRecField GhcTc (LHsExpr GhcTc)
-&gt; Maybe (LHsRecField GhcTc (LHsExpr GhcTc))
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan
-&gt; HsRecField' (FieldOcc GhcTc) (LHsExpr GhcTc)
-&gt; LHsRecField GhcTc (LHsExpr GhcTc)
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681092532"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsRecField GhcRn (LHsExpr GhcRn)
</span><a href="#local-6989586621681092531"><span class="hs-identifier hs-var">fld</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hsRecFieldLbl :: LFieldOcc GhcTc
</span><a href="GHC.Hs.Pat.html#hsRecFieldLbl"><span class="hs-identifier hs-var">hsRecFieldLbl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LFieldOcc GhcTc
</span><a href="#local-6989586621681092524"><span class="hs-identifier hs-var">f'</span></a></span><span>
</span><span id="line-2568"></span><span>                                                          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hsRecFieldArg :: LHsExpr GhcTc
</span><a href="GHC.Hs.Pat.html#hsRecFieldArg"><span class="hs-identifier hs-var">hsRecFieldArg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681092523"><span class="hs-identifier hs-var">rhs'</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2569"></span><span>
</span><span id="line-2570"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcRecordUpd"><span class="hs-identifier hs-type">tcRecordUpd</span></a></span><span>
</span><span id="line-2571"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.ConLike.html#ConLike"><span class="hs-identifier hs-type">ConLike</span></a></span><span>
</span><span id="line-2572"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">]</span><span>     </span><span class="hs-comment">-- Expected type for each field</span><span>
</span><span id="line-2573"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Hs.Pat.html#LHsRecField%27"><span class="hs-identifier hs-type">LHsRecField'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Type.html#AmbiguousFieldOcc"><span class="hs-identifier hs-type">AmbiguousFieldOcc</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-2574"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Hs.Pat.html#LHsRecUpdField"><span class="hs-identifier hs-type">LHsRecUpdField</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2575"></span><span>
</span><span id="line-2576"></span><span id="tcRecordUpd"><span class="annot"><span class="annottext">tcRecordUpd :: ConLike
-&gt; [TcType]
-&gt; [LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)]
-&gt; TcM [LHsRecUpdField GhcTc]
</span><a href="GHC.Tc.Gen.Expr.html#tcRecordUpd"><span class="hs-identifier hs-var hs-var">tcRecordUpd</span></a></span></span><span> </span><span id="local-6989586621681092522"><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681092522"><span class="hs-identifier hs-var">con_like</span></a></span></span><span> </span><span id="local-6989586621681092521"><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681092521"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span> </span><span id="local-6989586621681092520"><span class="annot"><span class="annottext">[LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)]
</span><a href="#local-6989586621681092520"><span class="hs-identifier hs-var">rbinds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Maybe (LHsRecUpdField GhcTc)] -&gt; [LHsRecUpdField GhcTc])
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [Maybe (LHsRecUpdField GhcTc)]
-&gt; TcM [LHsRecUpdField GhcTc]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">[Maybe (LHsRecUpdField GhcTc)] -&gt; [LHsRecUpdField GhcTc]
forall a. [Maybe a] -&gt; [a]
</span><a href="../../base/src/Data.Maybe.html#catMaybes"><span class="hs-identifier hs-var">catMaybes</span></a></span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) [Maybe (LHsRecUpdField GhcTc)]
 -&gt; TcM [LHsRecUpdField GhcTc])
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [Maybe (LHsRecUpdField GhcTc)]
-&gt; TcM [LHsRecUpdField GhcTc]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe (LHsRecUpdField GhcTc)))
-&gt; [LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [Maybe (LHsRecUpdField GhcTc)]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe (LHsRecUpdField GhcTc))
</span><a href="#local-6989586621681092519"><span class="hs-identifier hs-var">do_bind</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)]
</span><a href="#local-6989586621681092520"><span class="hs-identifier hs-var">rbinds</span></a></span><span>
</span><span id="line-2577"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2578"></span><span>    </span><span id="local-6989586621681092518"><span class="annot"><span class="annottext">fields :: [Name]
</span><a href="#local-6989586621681092518"><span class="hs-identifier hs-var hs-var">fields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(FieldLbl Name -&gt; Name) -&gt; [FieldLbl Name] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLbl Name -&gt; Name
forall a. FieldLbl a -&gt; a
</span><a href="GHC.Types.FieldLabel.html#flSelector"><span class="hs-identifier hs-var hs-var">flSelector</span></a></span><span> </span><span class="annot"><span class="annottext">([FieldLbl Name] -&gt; [Name]) -&gt; [FieldLbl Name] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike -&gt; [FieldLbl Name]
</span><a href="GHC.Core.ConLike.html#conLikeFieldLabels"><span class="hs-identifier hs-var">conLikeFieldLabels</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681092522"><span class="hs-identifier hs-var">con_like</span></a></span><span>
</span><span id="line-2579"></span><span>    </span><span id="local-6989586621681092517"><span class="annot"><span class="annottext">flds_w_tys :: [(Name, TcType)]
</span><a href="#local-6989586621681092517"><span class="hs-identifier hs-var hs-var">flds_w_tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; [Name] -&gt; [TcType] -&gt; [(Name, TcType)]
forall a b. String -&gt; [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="GHC.Utils.Misc.html#zipEqual"><span class="hs-identifier hs-var">zipEqual</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcRecordUpd&quot;</span></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621681092518"><span class="hs-identifier hs-var">fields</span></a></span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><a href="#local-6989586621681092521"><span class="hs-identifier hs-var">arg_tys</span></a></span><span>
</span><span id="line-2580"></span><span>
</span><span id="line-2581"></span><span>    </span><span class="annot"><a href="#local-6989586621681092519"><span class="hs-identifier hs-type">do_bind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Pat.html#LHsRecField%27"><span class="hs-identifier hs-type">LHsRecField'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Type.html#AmbiguousFieldOcc"><span class="hs-identifier hs-type">AmbiguousFieldOcc</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2582"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Pat.html#LHsRecUpdField"><span class="hs-identifier hs-type">LHsRecUpdField</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2583"></span><span>    </span><span id="local-6989586621681092519"><span class="annot"><span class="annottext">do_bind :: LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe (LHsRecUpdField GhcTc))
</span><a href="#local-6989586621681092519"><span class="hs-identifier hs-var hs-var">do_bind</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681092516"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681092516"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span id="local-6989586621681092515"><span class="annot"><span class="annottext">fld :: HsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)
</span><a href="#local-6989586621681092515"><span class="hs-identifier hs-var">fld</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Pat.html#HsRecField"><span class="hs-identifier hs-type">HsRecField</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hsRecFieldLbl :: forall id arg. HsRecField' id arg -&gt; Located id
</span><a href="GHC.Hs.Pat.html#hsRecFieldLbl"><span class="hs-identifier hs-var">hsRecFieldLbl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681092514"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681092514"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681092513"><span class="annot"><span class="annottext">AmbiguousFieldOcc GhcTc
</span><a href="#local-6989586621681092513"><span class="hs-identifier hs-var">af</span></a></span></span><span>
</span><span id="line-2584"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hsRecFieldArg :: forall id arg. HsRecField' id arg -&gt; arg
</span><a href="GHC.Hs.Pat.html#hsRecFieldArg"><span class="hs-identifier hs-var">hsRecFieldArg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681092512"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681092512"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2585"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681092511"><span class="annot"><span class="annottext">lbl :: RdrName
</span><a href="#local-6989586621681092511"><span class="hs-identifier hs-var hs-var">lbl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AmbiguousFieldOcc GhcTc -&gt; RdrName
forall (p :: Pass). AmbiguousFieldOcc (GhcPass p) -&gt; RdrName
</span><a href="GHC.Hs.Type.html#rdrNameAmbiguousFieldOcc"><span class="hs-identifier hs-var">rdrNameAmbiguousFieldOcc</span></a></span><span> </span><span class="annot"><span class="annottext">AmbiguousFieldOcc GhcTc
</span><a href="#local-6989586621681092513"><span class="hs-identifier hs-var">af</span></a></span><span>
</span><span id="line-2586"></span><span>                 </span><span id="local-6989586621681092510"><span class="annot"><span class="annottext">sel_id :: Var
</span><a href="#local-6989586621681092510"><span class="hs-identifier hs-var hs-var">sel_id</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AmbiguousFieldOcc GhcTc -&gt; Var
</span><a href="GHC.Hs.Type.html#selectorAmbiguousFieldOcc"><span class="hs-identifier hs-var">selectorAmbiguousFieldOcc</span></a></span><span> </span><span class="annot"><span class="annottext">AmbiguousFieldOcc GhcTc
</span><a href="#local-6989586621681092513"><span class="hs-identifier hs-var">af</span></a></span><span>
</span><span id="line-2587"></span><span>                 </span><span id="local-6989586621681092509"><span class="annot"><span class="annottext">f :: Located (FieldOcc GhcRn)
</span><a href="#local-6989586621681092509"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; FieldOcc GhcRn -&gt; Located (FieldOcc GhcRn)
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681092514"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XCFieldOcc GhcRn -&gt; Located RdrName -&gt; FieldOcc GhcRn
forall pass. XCFieldOcc pass -&gt; Located RdrName -&gt; FieldOcc pass
</span><a href="GHC.Hs.Type.html#FieldOcc"><span class="hs-identifier hs-var">FieldOcc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681092510"><span class="hs-identifier hs-var">sel_id</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; RdrName -&gt; Located RdrName
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681092514"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621681092511"><span class="hs-identifier hs-var">lbl</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2588"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681092507"><span class="annot"><span class="annottext">Maybe (LFieldOcc GhcTc, LHsExpr GhcTc)
</span><a href="#local-6989586621681092507"><span class="hs-identifier hs-var">mb</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ConLike
-&gt; [(Name, TcType)]
-&gt; Located (FieldOcc GhcRn)
-&gt; LHsExpr GhcRn
-&gt; TcM (Maybe (LFieldOcc GhcTc, LHsExpr GhcTc))
</span><a href="GHC.Tc.Gen.Expr.html#tcRecordField"><span class="hs-identifier hs-var">tcRecordField</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681092522"><span class="hs-identifier hs-var">con_like</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, TcType)]
</span><a href="#local-6989586621681092517"><span class="hs-identifier hs-var">flds_w_tys</span></a></span><span> </span><span class="annot"><span class="annottext">Located (FieldOcc GhcRn)
</span><a href="#local-6989586621681092509"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681092512"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-2589"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (LFieldOcc GhcTc, LHsExpr GhcTc)
</span><a href="#local-6989586621681092507"><span class="hs-identifier hs-var">mb</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2590"></span><span>               </span><span class="annot"><span class="annottext">Maybe (LFieldOcc GhcTc, LHsExpr GhcTc)
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (LHsRecUpdField GhcTc)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe (LHsRecUpdField GhcTc))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (LHsRecUpdField GhcTc)
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-2591"></span><span>               </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681092506"><span class="annot"><span class="annottext">LFieldOcc GhcTc
</span><a href="#local-6989586621681092506"><span class="hs-identifier hs-var">f'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681092505"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681092505"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2592"></span><span>                 </span><span class="annot"><span class="annottext">Maybe (LHsRecUpdField GhcTc)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe (LHsRecUpdField GhcTc))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsRecUpdField GhcTc -&gt; Maybe (LHsRecUpdField GhcTc)
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span>
</span><span id="line-2593"></span><span>                         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan
-&gt; HsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcTc)
-&gt; LHsRecUpdField GhcTc
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681092516"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)
</span><a href="#local-6989586621681092515"><span class="hs-identifier hs-var">fld</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hsRecFieldLbl :: GenLocated SrcSpan (AmbiguousFieldOcc GhcTc)
</span><a href="GHC.Hs.Pat.html#hsRecFieldLbl"><span class="hs-identifier hs-var">hsRecFieldLbl</span></a></span><span>
</span><span id="line-2594"></span><span>                                      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan
-&gt; AmbiguousFieldOcc GhcTc
-&gt; GenLocated SrcSpan (AmbiguousFieldOcc GhcTc)
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681092514"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XUnambiguous GhcTc -&gt; Located RdrName -&gt; AmbiguousFieldOcc GhcTc
forall pass.
XUnambiguous pass -&gt; Located RdrName -&gt; AmbiguousFieldOcc pass
</span><a href="GHC.Hs.Type.html#Unambiguous"><span class="hs-identifier hs-var">Unambiguous</span></a></span><span>
</span><span id="line-2595"></span><span>                                               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldOcc GhcTc -&gt; XCFieldOcc GhcTc
forall pass. FieldOcc pass -&gt; XCFieldOcc pass
</span><a href="GHC.Hs.Type.html#extFieldOcc"><span class="hs-identifier hs-var hs-var">extFieldOcc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LFieldOcc GhcTc -&gt; FieldOcc GhcTc
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LFieldOcc GhcTc
</span><a href="#local-6989586621681092506"><span class="hs-identifier hs-var">f'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2596"></span><span>                                               </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; RdrName -&gt; Located RdrName
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681092514"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621681092511"><span class="hs-identifier hs-var">lbl</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2597"></span><span>                                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hsRecFieldArg :: LHsExpr GhcTc
</span><a href="GHC.Hs.Pat.html#hsRecFieldArg"><span class="hs-identifier hs-var">hsRecFieldArg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681092505"><span class="hs-identifier hs-var">rhs'</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2598"></span><span>
</span><span id="line-2599"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#tcRecordField"><span class="hs-identifier hs-type">tcRecordField</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.ConLike.html#ConLike"><span class="hs-identifier hs-type">ConLike</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Data.List.SetOps.html#Assoc"><span class="hs-identifier hs-type">Assoc</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span>
</span><span id="line-2600"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Type.html#LFieldOcc"><span class="hs-identifier hs-type">LFieldOcc</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>
</span><span id="line-2601"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Type.html#LFieldOcc"><span class="hs-identifier hs-type">LFieldOcc</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2602"></span><span id="tcRecordField"><span class="annot"><span class="annottext">tcRecordField :: ConLike
-&gt; [(Name, TcType)]
-&gt; Located (FieldOcc GhcRn)
-&gt; LHsExpr GhcRn
-&gt; TcM (Maybe (LFieldOcc GhcTc, LHsExpr GhcTc))
</span><a href="GHC.Tc.Gen.Expr.html#tcRecordField"><span class="hs-identifier hs-var hs-var">tcRecordField</span></a></span></span><span> </span><span id="local-6989586621681092503"><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681092503"><span class="hs-identifier hs-var">con_like</span></a></span></span><span> </span><span id="local-6989586621681092502"><span class="annot"><span class="annottext">[(Name, TcType)]
</span><a href="#local-6989586621681092502"><span class="hs-identifier hs-var">flds_w_tys</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681092501"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681092501"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Type.html#FieldOcc"><span class="hs-identifier hs-type">FieldOcc</span></a></span><span> </span><span id="local-6989586621681092500"><span class="annot"><span class="annottext">XCFieldOcc GhcRn
</span><a href="#local-6989586621681092500"><span class="hs-identifier hs-var">sel_name</span></a></span></span><span> </span><span id="local-6989586621681092499"><span class="annot"><span class="annottext">Located RdrName
</span><a href="#local-6989586621681092499"><span class="hs-identifier hs-var">lbl</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621681092498"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681092498"><span class="hs-identifier hs-var">rhs</span></a></span></span><span>
</span><span id="line-2603"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681092497"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092497"><span class="hs-identifier hs-var">field_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(Name, TcType)] -&gt; Name -&gt; Maybe TcType
forall a b. Eq a =&gt; Assoc a b -&gt; a -&gt; Maybe b
</span><a href="GHC.Data.List.SetOps.html#assocMaybe"><span class="hs-identifier hs-var">assocMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">[(Name, TcType)]
</span><a href="#local-6989586621681092502"><span class="hs-identifier hs-var">flds_w_tys</span></a></span><span> </span><span class="annot"><span class="annottext">Name
XCFieldOcc GhcRn
</span><a href="#local-6989586621681092500"><span class="hs-identifier hs-var">sel_name</span></a></span><span>
</span><span id="line-2604"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc
-&gt; TcM (Maybe (LFieldOcc GhcTc, LHsExpr GhcTc))
-&gt; TcM (Maybe (LFieldOcc GhcTc, LHsExpr GhcTc))
forall a. SDoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldLabelString -&gt; SDoc
</span><a href="GHC.Tc.Gen.Expr.html#fieldCtxt"><span class="hs-identifier hs-var">fieldCtxt</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621681092494"><span class="hs-identifier hs-var">field_lbl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM (Maybe (LFieldOcc GhcTc, LHsExpr GhcTc))
 -&gt; TcM (Maybe (LFieldOcc GhcTc, LHsExpr GhcTc)))
-&gt; TcM (Maybe (LFieldOcc GhcTc, LHsExpr GhcTc))
-&gt; TcM (Maybe (LFieldOcc GhcTc, LHsExpr GhcTc))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2605"></span><span>        </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681092493"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681092493"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; TcType -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExprNC"><span class="hs-identifier hs-var">tcCheckPolyExprNC</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681092498"><span class="hs-identifier hs-var">rhs</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092497"><span class="hs-identifier hs-var">field_ty</span></a></span><span>
</span><span id="line-2606"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681092492"><span class="annot"><span class="annottext">field_id :: Var
</span><a href="#local-6989586621681092492"><span class="hs-identifier hs-var hs-var">field_id</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; Unique -&gt; TcType -&gt; TcType -&gt; SrcSpan -&gt; Var
</span><a href="GHC.Types.Id.html#mkUserLocal"><span class="hs-identifier hs-var">mkUserLocal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; OccName
</span><a href="GHC.Types.Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
XCFieldOcc GhcRn
</span><a href="#local-6989586621681092500"><span class="hs-identifier hs-var">sel_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2607"></span><span>                                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Unique
</span><a href="GHC.Types.Name.html#nameUnique"><span class="hs-identifier hs-var">nameUnique</span></a></span><span> </span><span class="annot"><span class="annottext">Name
XCFieldOcc GhcRn
</span><a href="#local-6989586621681092500"><span class="hs-identifier hs-var">sel_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2608"></span><span>                                        </span><span class="annot"><span class="annottext">TcType
</span><a href="GHC.Core.Type.html#Many"><span class="hs-identifier hs-var">Many</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092497"><span class="hs-identifier hs-var">field_ty</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681092501"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-2609"></span><span>                </span><span class="hs-comment">-- Yuk: the field_id has the *unique* of the selector Id</span><span>
</span><span id="line-2610"></span><span>                </span><span class="hs-comment">--          (so we can find it easily)</span><span>
</span><span id="line-2611"></span><span>                </span><span class="hs-comment">--      but is a LocalId with the appropriate type of the RHS</span><span>
</span><span id="line-2612"></span><span>                </span><span class="hs-comment">--          (so the desugarer knows the type of local binder to make)</span><span>
</span><span id="line-2613"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Maybe (LFieldOcc GhcTc, LHsExpr GhcTc)
-&gt; TcM (Maybe (LFieldOcc GhcTc, LHsExpr GhcTc))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(LFieldOcc GhcTc, LHsExpr GhcTc)
-&gt; Maybe (LFieldOcc GhcTc, LHsExpr GhcTc)
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; FieldOcc GhcTc -&gt; LFieldOcc GhcTc
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681092501"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XCFieldOcc GhcTc -&gt; Located RdrName -&gt; FieldOcc GhcTc
forall pass. XCFieldOcc pass -&gt; Located RdrName -&gt; FieldOcc pass
</span><a href="GHC.Hs.Type.html#FieldOcc"><span class="hs-identifier hs-var">FieldOcc</span></a></span><span> </span><span class="annot"><span class="annottext">Var
XCFieldOcc GhcTc
</span><a href="#local-6989586621681092492"><span class="hs-identifier hs-var">field_id</span></a></span><span> </span><span class="annot"><span class="annottext">Located RdrName
</span><a href="#local-6989586621681092499"><span class="hs-identifier hs-var">lbl</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681092493"><span class="hs-identifier hs-var">rhs'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2614"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-2615"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrTc"><span class="hs-identifier hs-var">addErrTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConLike -&gt; FieldLabelString -&gt; SDoc
</span><a href="GHC.Tc.Gen.Pat.html#badFieldCon"><span class="hs-identifier hs-var">badFieldCon</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681092503"><span class="hs-identifier hs-var">con_like</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621681092494"><span class="hs-identifier hs-var">field_lbl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2616"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Maybe (LFieldOcc GhcTc, LHsExpr GhcTc)
-&gt; TcM (Maybe (LFieldOcc GhcTc, LHsExpr GhcTc))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (LFieldOcc GhcTc, LHsExpr GhcTc)
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2617"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2618"></span><span>        </span><span id="local-6989586621681092494"><span class="annot"><span class="annottext">field_lbl :: FieldLabelString
</span><a href="#local-6989586621681092494"><span class="hs-identifier hs-var hs-var">field_lbl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; FieldLabelString
</span><a href="GHC.Types.Name.Occurrence.html#occNameFS"><span class="hs-identifier hs-var hs-var">occNameFS</span></a></span><span> </span><span class="annot"><span class="annottext">(OccName -&gt; FieldLabelString) -&gt; OccName -&gt; FieldLabelString
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; OccName
</span><a href="GHC.Types.Name.Reader.html#rdrNameOcc"><span class="hs-identifier hs-var">rdrNameOcc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Located RdrName -&gt; RdrName
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">Located RdrName
</span><a href="#local-6989586621681092499"><span class="hs-identifier hs-var">lbl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2619"></span><span>
</span><span id="line-2620"></span><span>
</span><span id="line-2621"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#checkMissingFields"><span class="hs-identifier hs-type">checkMissingFields</span></a></span><span> </span><span class="hs-glyph">::</span><span>  </span><span class="annot"><a href="GHC.Core.ConLike.html#ConLike"><span class="hs-identifier hs-type">ConLike</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsRecordBinds"><span class="hs-identifier hs-type">HsRecordBinds</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2622"></span><span id="checkMissingFields"><span class="annot"><span class="annottext">checkMissingFields :: ConLike -&gt; HsRecordBinds GhcRn -&gt; TcRn ()
</span><a href="GHC.Tc.Gen.Expr.html#checkMissingFields"><span class="hs-identifier hs-var hs-var">checkMissingFields</span></a></span></span><span> </span><span id="local-6989586621681092487"><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681092487"><span class="hs-identifier hs-var">con_like</span></a></span></span><span> </span><span id="local-6989586621681092486"><span class="annot"><span class="annottext">HsRecordBinds GhcRn
</span><a href="#local-6989586621681092486"><span class="hs-identifier hs-var">rbinds</span></a></span></span><span>
</span><span id="line-2623"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[FieldLbl Name] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldLbl Name]
</span><a href="#local-6989586621681092485"><span class="hs-identifier hs-var">field_labels</span></a></span><span>   </span><span class="hs-comment">-- Not declared as a record;</span><span>
</span><span id="line-2624"></span><span>                        </span><span class="hs-comment">-- But C{} is still valid if no strict fields</span><span>
</span><span id="line-2625"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">(HsImplBang -&gt; Bool) -&gt; [HsImplBang] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a></span><span> </span><span class="annot"><span class="annottext">HsImplBang -&gt; Bool
</span><a href="GHC.Core.DataCon.html#isBanged"><span class="hs-identifier hs-var">isBanged</span></a></span><span> </span><span class="annot"><span class="annottext">[HsImplBang]
</span><a href="#local-6989586621681092482"><span class="hs-identifier hs-var">field_strs</span></a></span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-2626"></span><span>        </span><span class="hs-comment">-- Illegal if any arg is strict</span><span>
</span><span id="line-2627"></span><span>        </span><span class="annot"><span class="annottext">SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrTc"><span class="hs-identifier hs-var">addErrTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConLike -&gt; [FieldLabelString] -&gt; SDoc
</span><a href="GHC.Tc.Gen.Expr.html#missingStrictFields"><span class="hs-identifier hs-var">missingStrictFields</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681092487"><span class="hs-identifier hs-var">con_like</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2628"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2629"></span><span>        </span><span id="local-6989586621681092480"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681092480"><span class="hs-identifier hs-var">warn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">WarningFlag -&gt; TcRn Bool
forall gbl lcl. WarningFlag -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#woptM"><span class="hs-identifier hs-var">woptM</span></a></span><span> </span><span class="annot"><span class="annottext">WarningFlag
</span><a href="GHC.Driver.Flags.html#Opt_WarnMissingFields"><span class="hs-identifier hs-var">Opt_WarnMissingFields</span></a></span><span>
</span><span id="line-2630"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; TcRn () -&gt; TcRn ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681092480"><span class="hs-identifier hs-var">warn</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">[HsImplBang] -&gt; Bool
forall a. [a] -&gt; Bool
</span><a href="GHC.Utils.Misc.html#notNull"><span class="hs-identifier hs-var">notNull</span></a></span><span> </span><span class="annot"><span class="annottext">[HsImplBang]
</span><a href="#local-6989586621681092482"><span class="hs-identifier hs-var">field_strs</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">[FieldLbl Name] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldLbl Name]
</span><a href="#local-6989586621681092485"><span class="hs-identifier hs-var">field_labels</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2631"></span><span>             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WarnReason -&gt; Bool -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#warnTc"><span class="hs-identifier hs-var">warnTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WarningFlag -&gt; WarnReason
</span><a href="GHC.Driver.Flags.html#Reason"><span class="hs-identifier hs-var">Reason</span></a></span><span> </span><span class="annot"><span class="annottext">WarningFlag
</span><a href="GHC.Driver.Flags.html#Opt_WarnMissingFields"><span class="hs-identifier hs-var">Opt_WarnMissingFields</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-2632"></span><span>                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConLike -&gt; [FieldLabelString] -&gt; SDoc
</span><a href="GHC.Tc.Gen.Expr.html#missingFields"><span class="hs-identifier hs-var">missingFields</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681092487"><span class="hs-identifier hs-var">con_like</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2633"></span><span>
</span><span id="line-2634"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>              </span><span class="hs-comment">-- A record</span><span>
</span><span id="line-2635"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; TcRn () -&gt; TcRn ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base/src/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FieldLabelString] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldLabelString]
</span><a href="#local-6989586621681092474"><span class="hs-identifier hs-var">missing_s_fields</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2636"></span><span>           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrTc"><span class="hs-identifier hs-var">addErrTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConLike -&gt; [FieldLabelString] -&gt; SDoc
</span><a href="GHC.Tc.Gen.Expr.html#missingStrictFields"><span class="hs-identifier hs-var">missingStrictFields</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681092487"><span class="hs-identifier hs-var">con_like</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldLabelString]
</span><a href="#local-6989586621681092474"><span class="hs-identifier hs-var">missing_s_fields</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2637"></span><span>
</span><span id="line-2638"></span><span>    </span><span id="local-6989586621681092473"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681092473"><span class="hs-identifier hs-var">warn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">WarningFlag -&gt; TcRn Bool
forall gbl lcl. WarningFlag -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#woptM"><span class="hs-identifier hs-var">woptM</span></a></span><span> </span><span class="annot"><span class="annottext">WarningFlag
</span><a href="GHC.Driver.Flags.html#Opt_WarnMissingFields"><span class="hs-identifier hs-var">Opt_WarnMissingFields</span></a></span><span>
</span><span id="line-2639"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; TcRn () -&gt; TcRn ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681092473"><span class="hs-identifier hs-var">warn</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">[FieldLabelString] -&gt; Bool
forall a. [a] -&gt; Bool
</span><a href="GHC.Utils.Misc.html#notNull"><span class="hs-identifier hs-var">notNull</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldLabelString]
</span><a href="#local-6989586621681092472"><span class="hs-identifier hs-var">missing_ns_fields</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2640"></span><span>         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WarnReason -&gt; Bool -&gt; SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#warnTc"><span class="hs-identifier hs-var">warnTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WarningFlag -&gt; WarnReason
</span><a href="GHC.Driver.Flags.html#Reason"><span class="hs-identifier hs-var">Reason</span></a></span><span> </span><span class="annot"><span class="annottext">WarningFlag
</span><a href="GHC.Driver.Flags.html#Opt_WarnMissingFields"><span class="hs-identifier hs-var">Opt_WarnMissingFields</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-2641"></span><span>             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConLike -&gt; [FieldLabelString] -&gt; SDoc
</span><a href="GHC.Tc.Gen.Expr.html#missingFields"><span class="hs-identifier hs-var">missingFields</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681092487"><span class="hs-identifier hs-var">con_like</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldLabelString]
</span><a href="#local-6989586621681092472"><span class="hs-identifier hs-var">missing_ns_fields</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2642"></span><span>
</span><span id="line-2643"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2644"></span><span>    </span><span id="local-6989586621681092474"><span class="annot"><span class="annottext">missing_s_fields :: [FieldLabelString]
</span><a href="#local-6989586621681092474"><span class="hs-identifier hs-var hs-var">missing_s_fields</span></a></span></span><span>
</span><span id="line-2645"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">FieldLbl Name -&gt; FieldLabelString
forall a. FieldLbl a -&gt; FieldLabelString
</span><a href="GHC.Types.FieldLabel.html#flLabel"><span class="hs-identifier hs-var hs-var">flLabel</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLbl Name
</span><a href="#local-6989586621681092471"><span class="hs-identifier hs-var">fl</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681092471"><span class="annot"><span class="annottext">FieldLbl Name
</span><a href="#local-6989586621681092471"><span class="hs-identifier hs-var">fl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681092470"><span class="annot"><span class="annottext">HsImplBang
</span><a href="#local-6989586621681092470"><span class="hs-identifier hs-var">str</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(FieldLbl Name, HsImplBang)]
</span><a href="#local-6989586621681092469"><span class="hs-identifier hs-var">field_info</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-2646"></span><span>                 </span><span class="annot"><span class="annottext">HsImplBang -&gt; Bool
</span><a href="GHC.Core.DataCon.html#isBanged"><span class="hs-identifier hs-var">isBanged</span></a></span><span> </span><span class="annot"><span class="annottext">HsImplBang
</span><a href="#local-6989586621681092470"><span class="hs-identifier hs-var">str</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-2647"></span><span>                 </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldLbl Name
</span><a href="#local-6989586621681092471"><span class="hs-identifier hs-var">fl</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLbl Name -&gt; [Name] -&gt; Bool
forall {t :: * -&gt; *} {a}.
(Foldable t, Eq a) =&gt;
FieldLbl a -&gt; t a -&gt; Bool
</span><a href="#local-6989586621681092468"><span class="hs-operator hs-var">`elemField`</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
[XCFieldOcc GhcRn]
</span><a href="#local-6989586621681092467"><span class="hs-identifier hs-var">field_names_used</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2648"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-2649"></span><span>    </span><span id="local-6989586621681092472"><span class="annot"><span class="annottext">missing_ns_fields :: [FieldLabelString]
</span><a href="#local-6989586621681092472"><span class="hs-identifier hs-var hs-var">missing_ns_fields</span></a></span></span><span>
</span><span id="line-2650"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">FieldLbl Name -&gt; FieldLabelString
forall a. FieldLbl a -&gt; FieldLabelString
</span><a href="GHC.Types.FieldLabel.html#flLabel"><span class="hs-identifier hs-var hs-var">flLabel</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLbl Name
</span><a href="#local-6989586621681092466"><span class="hs-identifier hs-var">fl</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681092466"><span class="annot"><span class="annottext">FieldLbl Name
</span><a href="#local-6989586621681092466"><span class="hs-identifier hs-var">fl</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681092465"><span class="annot"><span class="annottext">HsImplBang
</span><a href="#local-6989586621681092465"><span class="hs-identifier hs-var">str</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(FieldLbl Name, HsImplBang)]
</span><a href="#local-6989586621681092469"><span class="hs-identifier hs-var">field_info</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-2651"></span><span>                 </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsImplBang -&gt; Bool
</span><a href="GHC.Core.DataCon.html#isBanged"><span class="hs-identifier hs-var">isBanged</span></a></span><span> </span><span class="annot"><span class="annottext">HsImplBang
</span><a href="#local-6989586621681092465"><span class="hs-identifier hs-var">str</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-2652"></span><span>                 </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldLbl Name
</span><a href="#local-6989586621681092466"><span class="hs-identifier hs-var">fl</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLbl Name -&gt; [Name] -&gt; Bool
forall {t :: * -&gt; *} {a}.
(Foldable t, Eq a) =&gt;
FieldLbl a -&gt; t a -&gt; Bool
</span><a href="#local-6989586621681092468"><span class="hs-operator hs-var">`elemField`</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
[XCFieldOcc GhcRn]
</span><a href="#local-6989586621681092467"><span class="hs-identifier hs-var">field_names_used</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2653"></span><span>          </span><span class="hs-special">]</span><span>
</span><span id="line-2654"></span><span>
</span><span id="line-2655"></span><span>    </span><span id="local-6989586621681092467"><span class="annot"><span class="annottext">field_names_used :: [XCFieldOcc GhcRn]
</span><a href="#local-6989586621681092467"><span class="hs-identifier hs-var hs-var">field_names_used</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsRecordBinds GhcRn -&gt; [XCFieldOcc GhcRn]
forall p arg. HsRecFields p arg -&gt; [XCFieldOcc p]
</span><a href="GHC.Hs.Pat.html#hsRecFields"><span class="hs-identifier hs-var">hsRecFields</span></a></span><span> </span><span class="annot"><span class="annottext">HsRecordBinds GhcRn
</span><a href="#local-6989586621681092486"><span class="hs-identifier hs-var">rbinds</span></a></span><span>
</span><span id="line-2656"></span><span>    </span><span id="local-6989586621681092485"><span class="annot"><span class="annottext">field_labels :: [FieldLbl Name]
</span><a href="#local-6989586621681092485"><span class="hs-identifier hs-var hs-var">field_labels</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConLike -&gt; [FieldLbl Name]
</span><a href="GHC.Core.ConLike.html#conLikeFieldLabels"><span class="hs-identifier hs-var">conLikeFieldLabels</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681092487"><span class="hs-identifier hs-var">con_like</span></a></span><span>
</span><span id="line-2657"></span><span>
</span><span id="line-2658"></span><span>    </span><span id="local-6989586621681092469"><span class="annot"><span class="annottext">field_info :: [(FieldLbl Name, HsImplBang)]
</span><a href="#local-6989586621681092469"><span class="hs-identifier hs-var hs-var">field_info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
-&gt; [FieldLbl Name] -&gt; [HsImplBang] -&gt; [(FieldLbl Name, HsImplBang)]
forall a b. String -&gt; [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="GHC.Utils.Misc.html#zipEqual"><span class="hs-identifier hs-var">zipEqual</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;missingFields&quot;</span></span><span>
</span><span id="line-2659"></span><span>                          </span><span class="annot"><span class="annottext">[FieldLbl Name]
</span><a href="#local-6989586621681092485"><span class="hs-identifier hs-var">field_labels</span></a></span><span>
</span><span id="line-2660"></span><span>                          </span><span class="annot"><span class="annottext">[HsImplBang]
</span><a href="#local-6989586621681092482"><span class="hs-identifier hs-var">field_strs</span></a></span><span>
</span><span id="line-2661"></span><span>
</span><span id="line-2662"></span><span>    </span><span id="local-6989586621681092482"><span class="annot"><span class="annottext">field_strs :: [HsImplBang]
</span><a href="#local-6989586621681092482"><span class="hs-identifier hs-var hs-var">field_strs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ConLike -&gt; [HsImplBang]
</span><a href="GHC.Core.ConLike.html#conLikeImplBangs"><span class="hs-identifier hs-var">conLikeImplBangs</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681092487"><span class="hs-identifier hs-var">con_like</span></a></span><span>
</span><span id="line-2663"></span><span>
</span><span id="line-2664"></span><span>    </span><span id="local-6989586621681092458"><span class="annot"><span class="annottext">FieldLbl a
</span><a href="#local-6989586621681092458"><span class="hs-identifier hs-var">fl</span></a></span></span><span> </span><span id="local-6989586621681092468"><span class="annot"><span class="annottext">elemField :: FieldLbl a -&gt; t a -&gt; Bool
</span><a href="#local-6989586621681092468"><span class="hs-operator hs-var hs-var">`elemField`</span></a></span></span><span> </span><span id="local-6989586621681092457"><span class="annot"><span class="annottext">t a
</span><a href="#local-6989586621681092457"><span class="hs-identifier hs-var">flds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; Bool) -&gt; t a -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681092456"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681092456"><span class="hs-identifier hs-var">fl'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FieldLbl a -&gt; a
forall a. FieldLbl a -&gt; a
</span><a href="GHC.Types.FieldLabel.html#flSelector"><span class="hs-identifier hs-var hs-var">flSelector</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLbl a
</span><a href="#local-6989586621681092458"><span class="hs-identifier hs-var">fl</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681092456"><span class="hs-identifier hs-var">fl'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">t a
</span><a href="#local-6989586621681092457"><span class="hs-identifier hs-var">flds</span></a></span><span>
</span><span id="line-2665"></span><span>
</span><span id="line-2666"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Errors and contexts}
*                                                                      *
************************************************************************

Boring and alphabetical:
-}</span><span>
</span><span id="line-2675"></span><span>
</span><span id="line-2676"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#fieldCtxt"><span class="hs-identifier hs-type">fieldCtxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.FieldLabel.html#FieldLabelString"><span class="hs-identifier hs-type">FieldLabelString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-2677"></span><span id="fieldCtxt"><span class="annot"><span class="annottext">fieldCtxt :: FieldLabelString -&gt; SDoc
</span><a href="GHC.Tc.Gen.Expr.html#fieldCtxt"><span class="hs-identifier hs-var hs-var">fieldCtxt</span></a></span></span><span> </span><span id="local-6989586621681092455"><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621681092455"><span class="hs-identifier hs-var">field_name</span></a></span></span><span>
</span><span id="line-2678"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;In the&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldLabelString -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621681092455"><span class="hs-identifier hs-var">field_name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">PtrString -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ptext"><span class="hs-identifier hs-var">ptext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; PtrString
</span><a href="GHC.Data.FastString.html#sLit"><span class="hs-identifier hs-var">sLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;field of a record&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-2679"></span><span>
</span><span id="line-2680"></span><span id="local-6989586621681095135"><span class="annot"><a href="GHC.Tc.Gen.Expr.html#addExprCtxt"><span class="hs-identifier hs-type">addExprCtxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681095135"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcRn"><span class="hs-identifier hs-type">TcRn</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681095135"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-2681"></span><span id="addExprCtxt"><span class="annot"><span class="annottext">addExprCtxt :: forall a. LHsExpr GhcRn -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Gen.Expr.html#addExprCtxt"><span class="hs-identifier hs-var hs-var">addExprCtxt</span></a></span></span><span> </span><span id="local-6989586621681092452"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681092452"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span id="local-6989586621681092451"><span class="annot"><span class="annottext">TcRn a
</span><a href="#local-6989586621681092451"><span class="hs-identifier hs-var">thing_inside</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcRn a -&gt; TcRn a
forall a. SDoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; SDoc
</span><a href="GHC.Tc.Gen.Expr.html#exprCtxt"><span class="hs-identifier hs-var">exprCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; HsExpr GhcRn
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681092452"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">TcRn a
</span><a href="#local-6989586621681092451"><span class="hs-identifier hs-var">thing_inside</span></a></span><span>
</span><span id="line-2682"></span><span>
</span><span id="line-2683"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#exprCtxt"><span class="hs-identifier hs-type">exprCtxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-2684"></span><span id="exprCtxt"><span class="annot"><span class="annottext">exprCtxt :: HsExpr GhcRn -&gt; SDoc
</span><a href="GHC.Tc.Gen.Expr.html#exprCtxt"><span class="hs-identifier hs-var hs-var">exprCtxt</span></a></span></span><span> </span><span id="local-6989586621681092450"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681092450"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; ThLevel -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;In the expression:&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcRn -&gt; HsExpr GhcRn
forall (p :: Pass). HsExpr (GhcPass p) -&gt; HsExpr (GhcPass p)
</span><a href="GHC.Hs.Expr.html#stripParensHsExpr"><span class="hs-identifier hs-var">stripParensHsExpr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681092450"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2685"></span><span>
</span><span id="line-2686"></span><span id="local-6989586621681094891"><span class="annot"><a href="GHC.Tc.Gen.Expr.html#addFunResCtxt"><span class="hs-identifier hs-type">addFunResCtxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>  </span><span class="hs-comment">-- There is at least one argument</span><span>
</span><span id="line-2687"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span>
</span><span id="line-2688"></span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681094891"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681094891"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-2689"></span><span class="hs-comment">-- When we have a mis-match in the return type of a function</span><span>
</span><span id="line-2690"></span><span class="hs-comment">-- try to give a helpful message about too many/few arguments</span><span>
</span><span id="line-2691"></span><span class="hs-comment">--</span><span>
</span><span id="line-2692"></span><span class="hs-comment">-- Used for naked variables too; but with has_args = False</span><span>
</span><span id="line-2693"></span><span id="addFunResCtxt"><span class="annot"><span class="annottext">addFunResCtxt :: forall a.
Bool -&gt; HsExpr GhcTc -&gt; TcType -&gt; ExpRhoType -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Gen.Expr.html#addFunResCtxt"><span class="hs-identifier hs-var hs-var">addFunResCtxt</span></a></span></span><span> </span><span id="local-6989586621681092430"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681092430"><span class="hs-identifier hs-var">has_args</span></a></span></span><span> </span><span id="local-6989586621681092429"><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681092429"><span class="hs-identifier hs-var">fun</span></a></span></span><span> </span><span id="local-6989586621681092428"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092428"><span class="hs-identifier hs-var">fun_res_ty</span></a></span></span><span> </span><span id="local-6989586621681092427"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681092427"><span class="hs-identifier hs-var">env_ty</span></a></span></span><span>
</span><span id="line-2694"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TidyEnv -&gt; TcM (TidyEnv, SDoc)) -&gt; TcM a -&gt; TcM a
forall a. (TidyEnv -&gt; TcM (TidyEnv, SDoc)) -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addLandmarkErrCtxtM"><span class="hs-identifier hs-var">addLandmarkErrCtxtM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681092425"><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621681092425"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TidyEnv
</span><a href="#local-6989586621681092425"><span class="hs-identifier hs-var">env</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; (TidyEnv, SDoc))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) SDoc -&gt; TcM (TidyEnv, SDoc)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) SDoc
</span><a href="#local-6989586621681092424"><span class="hs-identifier hs-var">mk_msg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2695"></span><span>      </span><span class="hs-comment">-- NB: use a landmark error context, so that an empty context</span><span>
</span><span id="line-2696"></span><span>      </span><span class="hs-comment">-- doesn't suppress some more useful context</span><span>
</span><span id="line-2697"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2698"></span><span>    </span><span id="local-6989586621681092424"><span class="annot"><span class="annottext">mk_msg :: IOEnv (Env TcGblEnv TcLclEnv) SDoc
</span><a href="#local-6989586621681092424"><span class="hs-identifier hs-var hs-var">mk_msg</span></a></span></span><span>
</span><span id="line-2699"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681092423"><span class="annot"><span class="annottext">Maybe TcType
</span><a href="#local-6989586621681092423"><span class="hs-identifier hs-var">mb_env_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpRhoType -&gt; TcM (Maybe TcType)
</span><a href="GHC.Tc.Utils.TcMType.html#readExpType_maybe"><span class="hs-identifier hs-var">readExpType_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681092427"><span class="hs-identifier hs-var">env_ty</span></a></span><span>
</span><span id="line-2700"></span><span>                     </span><span class="hs-comment">-- by the time the message is rendered, the ExpType</span><span>
</span><span id="line-2701"></span><span>                     </span><span class="hs-comment">-- will be filled in (except if we're debugging)</span><span>
</span><span id="line-2702"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681092421"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092421"><span class="hs-identifier hs-var">fun_res'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092428"><span class="hs-identifier hs-var">fun_res_ty</span></a></span><span>
</span><span id="line-2703"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681092420"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092420"><span class="hs-identifier hs-var">env'</span></a></span></span><span>     </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe TcType
</span><a href="#local-6989586621681092423"><span class="hs-identifier hs-var">mb_env_ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2704"></span><span>                           </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681092419"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092419"><span class="hs-identifier hs-var">env_ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092419"><span class="hs-identifier hs-var">env_ty</span></a></span><span>
</span><span id="line-2705"></span><span>                           </span><span class="annot"><span class="annottext">Maybe TcType
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>     </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2706"></span><span>                             </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681092418"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681092418"><span class="hs-identifier hs-var">dumping</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DumpFlag -&gt; TcRn Bool
forall gbl lcl. DumpFlag -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#doptM"><span class="hs-identifier hs-var">doptM</span></a></span><span> </span><span class="annot"><span class="annottext">DumpFlag
</span><a href="GHC.Driver.Flags.html#Opt_D_dump_tc_trace"><span class="hs-identifier hs-var">Opt_D_dump_tc_trace</span></a></span><span>
</span><span id="line-2707"></span><span>                                </span><span class="hs-special">;</span><span> </span><span class="hs-identifier">MASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">dumping</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-2708"></span><span>                                </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; TcM TcType
</span><a href="GHC.Tc.Utils.TcMType.html#newFlexiTyVarTy"><span class="hs-identifier hs-var">newFlexiTyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2709"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- See Note [Splitting nested sigma types in mismatched</span><span>
</span><span id="line-2710"></span><span>                 </span><span class="hs-comment">--           function types]</span><span>
</span><span id="line-2711"></span><span>                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681092415"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092415"><span class="hs-identifier hs-var">fun_tau</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; ([Var], [TcType], TcType)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitNestedSigmaTys"><span class="hs-identifier hs-var">tcSplitNestedSigmaTys</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092421"><span class="hs-identifier hs-var">fun_res'</span></a></span><span>
</span><span id="line-2712"></span><span>                 </span><span class="hs-comment">-- No need to call tcSplitNestedSigmaTys here, since env_ty is</span><span>
</span><span id="line-2713"></span><span>                 </span><span class="hs-comment">-- an ExpRhoTy, i.e., it's already instantiated.</span><span>
</span><span id="line-2714"></span><span>                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Var]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681092413"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092413"><span class="hs-identifier hs-var">env_tau</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; ([Var], [TcType], TcType)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitSigmaTy"><span class="hs-identifier hs-var">tcSplitSigmaTy</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092420"><span class="hs-identifier hs-var">env'</span></a></span><span>
</span><span id="line-2715"></span><span>                 </span><span class="hs-special">(</span><span id="local-6989586621681092412"><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681092412"><span class="hs-identifier hs-var">args_fun</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681092411"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092411"><span class="hs-identifier hs-var">res_fun</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; ([Scaled TcType], TcType)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitFunTys"><span class="hs-identifier hs-var">tcSplitFunTys</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092415"><span class="hs-identifier hs-var">fun_tau</span></a></span><span>
</span><span id="line-2716"></span><span>                 </span><span class="hs-special">(</span><span id="local-6989586621681092409"><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681092409"><span class="hs-identifier hs-var">args_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681092408"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092408"><span class="hs-identifier hs-var">res_env</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; ([Scaled TcType], TcType)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitFunTys"><span class="hs-identifier hs-var">tcSplitFunTys</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092413"><span class="hs-identifier hs-var">env_tau</span></a></span><span>
</span><span id="line-2717"></span><span>                 </span><span id="local-6989586621681092407"><span class="annot"><span class="annottext">n_fun :: ThLevel
</span><a href="#local-6989586621681092407"><span class="hs-identifier hs-var hs-var">n_fun</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Scaled TcType] -&gt; ThLevel
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; ThLevel
</span><a href="../../base/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681092412"><span class="hs-identifier hs-var">args_fun</span></a></span><span>
</span><span id="line-2718"></span><span>                 </span><span id="local-6989586621681092406"><span class="annot"><span class="annottext">n_env :: ThLevel
</span><a href="#local-6989586621681092406"><span class="hs-identifier hs-var hs-var">n_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Scaled TcType] -&gt; ThLevel
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; ThLevel
</span><a href="../../base/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled TcType]
</span><a href="#local-6989586621681092409"><span class="hs-identifier hs-var">args_env</span></a></span><span>
</span><span id="line-2719"></span><span>                 </span><span id="local-6989586621681092405"><span class="annot"><span class="annottext">info :: SDoc
</span><a href="#local-6989586621681092405"><span class="hs-identifier hs-var hs-var">info</span></a></span></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621681092407"><span class="hs-identifier hs-var">n_fun</span></a></span><span> </span><span class="annot"><span class="annottext">ThLevel -&gt; ThLevel -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621681092406"><span class="hs-identifier hs-var">n_env</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">Outputable.empty</span></a></span><span>
</span><span id="line-2720"></span><span>                       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621681092407"><span class="hs-identifier hs-var">n_fun</span></a></span><span> </span><span class="annot"><span class="annottext">ThLevel -&gt; ThLevel -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><a href="#local-6989586621681092406"><span class="hs-identifier hs-var">n_env</span></a></span><span>
</span><span id="line-2721"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; Bool
</span><a href="#local-6989586621681092404"><span class="hs-identifier hs-var">not_fun</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092408"><span class="hs-identifier hs-var">res_env</span></a></span><span>
</span><span id="line-2722"></span><span>                       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Probable cause:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681092429"><span class="hs-identifier hs-var">fun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2723"></span><span>                         </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;is applied to too few arguments&quot;</span></span><span>
</span><span id="line-2724"></span><span>
</span><span id="line-2725"></span><span>                       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681092430"><span class="hs-identifier hs-var">has_args</span></a></span><span>
</span><span id="line-2726"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TcType -&gt; Bool
</span><a href="#local-6989586621681092404"><span class="hs-identifier hs-var">not_fun</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092411"><span class="hs-identifier hs-var">res_fun</span></a></span><span>
</span><span id="line-2727"></span><span>                       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Possible cause:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc
</span><a href="#local-6989586621681092429"><span class="hs-identifier hs-var">fun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2728"></span><span>                         </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;is applied to too many arguments&quot;</span></span><span>
</span><span id="line-2729"></span><span>
</span><span id="line-2730"></span><span>                       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-2731"></span><span>                       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">Outputable.empty</span></a></span><span>  </span><span class="hs-comment">-- Never suggest that a naked variable is                                         -- applied to too many args!</span><span>
</span><span id="line-2732"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) SDoc
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681092405"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2733"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-2734"></span><span>        </span><span id="local-6989586621681092404"><span class="annot"><span class="annottext">not_fun :: TcType -&gt; Bool
</span><a href="#local-6989586621681092404"><span class="hs-identifier hs-var hs-var">not_fun</span></a></span></span><span> </span><span id="local-6989586621681092401"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092401"><span class="hs-identifier hs-var">ty</span></a></span></span><span>   </span><span class="hs-comment">-- ty is definitely not an arrow type,</span><span>
</span><span id="line-2735"></span><span>                     </span><span class="hs-comment">-- and cannot conceivably become one</span><span>
</span><span id="line-2736"></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; TcType -&gt; Maybe (TyCon, [TcType])
TcType -&gt; Maybe (TyCon, [TcType])
</span><a href="GHC.Core.Type.html#tcSplitTyConApp_maybe"><span class="hs-identifier hs-var">tcSplitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092401"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2737"></span><span>              </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681092400"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681092400"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[TcType]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isAlgTyCon"><span class="hs-identifier hs-var">isAlgTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681092400"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-2738"></span><span>              </span><span class="annot"><span class="annottext">Maybe (TyCon, [TcType])
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-2739"></span><span>
</span><span id="line-2740"></span><span class="hs-comment">{-
Note [Splitting nested sigma types in mismatched function types]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When one applies a function to too few arguments, GHC tries to determine this
fact if possible so that it may give a helpful error message. It accomplishes
this by checking if the type of the applied function has more argument types
than supplied arguments.

Previously, GHC computed the number of argument types through tcSplitSigmaTy.
This is incorrect in the face of nested foralls, however! This caused Trac
#13311, for instance:

  f :: forall a. (Monoid a) =&gt; forall b. (Monoid b) =&gt; Maybe a -&gt; Maybe b

If one uses `f` like so:

  do { f; putChar 'a' }

Then tcSplitSigmaTy will decompose the type of `f` into:

  Tyvars: [a]
  Context: (Monoid a)
  Argument types: []
  Return type: forall b. Monoid b =&gt; Maybe a -&gt; Maybe b

That is, it will conclude that there are *no* argument types, and since `f`
was given no arguments, it won't print a helpful error message. On the other
hand, tcSplitNestedSigmaTys correctly decomposes `f`'s type down to:

  Tyvars: [a, b]
  Context: (Monoid a, Monoid b)
  Argument types: [Maybe a]
  Return type: Maybe b

So now GHC recognizes that `f` has one more argument type than it was actually
provided.
-}</span><span>
</span><span id="line-2777"></span><span>
</span><span id="line-2778"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#badFieldTypes"><span class="hs-identifier hs-type">badFieldTypes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.FieldLabel.html#FieldLabelString"><span class="hs-identifier hs-type">FieldLabelString</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-2779"></span><span id="badFieldTypes"><span class="annot"><span class="annottext">badFieldTypes :: [(FieldLabelString, TcType)] -&gt; SDoc
</span><a href="GHC.Tc.Gen.Expr.html#badFieldTypes"><span class="hs-identifier hs-var hs-var">badFieldTypes</span></a></span></span><span> </span><span id="local-6989586621681092398"><span class="annot"><span class="annottext">[(FieldLabelString, TcType)]
</span><a href="#local-6989586621681092398"><span class="hs-identifier hs-var">prs</span></a></span></span><span>
</span><span id="line-2780"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; ThLevel -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Record update for insufficiently polymorphic field&quot;</span></span><span>
</span><span id="line-2781"></span><span>                         </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, TcType)] -&gt; SDoc
forall a. [a] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#plural"><span class="hs-identifier hs-var">plural</span></a></span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, TcType)]
</span><a href="#local-6989586621681092398"><span class="hs-identifier hs-var">prs</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#colon"><span class="hs-identifier hs-var">colon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2782"></span><span>       </span><span class="annot"><span class="annottext">ThLevel
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">FieldLabelString -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621681092395"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#dcolon"><span class="hs-identifier hs-var">dcolon</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TcType -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092394"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681092395"><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621681092395"><span class="hs-identifier hs-var">f</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681092394"><span class="annot"><span class="annottext">TcType
</span><a href="#local-6989586621681092394"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, TcType)]
</span><a href="#local-6989586621681092398"><span class="hs-identifier hs-var">prs</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2783"></span><span>
</span><span id="line-2784"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#badFieldsUpd"><span class="hs-identifier hs-type">badFieldsUpd</span></a></span><span>
</span><span id="line-2785"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Hs.Pat.html#LHsRecField%27"><span class="hs-identifier hs-type">LHsRecField'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Type.html#AmbiguousFieldOcc"><span class="hs-identifier hs-type">AmbiguousFieldOcc</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-2786"></span><span>               </span><span class="hs-comment">-- Field names that don't belong to a single datacon</span><span>
</span><span id="line-2787"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.ConLike.html#ConLike"><span class="hs-identifier hs-type">ConLike</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- Data cons of the type which the first field name belongs to</span><span>
</span><span id="line-2788"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-2789"></span><span id="badFieldsUpd"><span class="annot"><span class="annottext">badFieldsUpd :: [LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)]
-&gt; [ConLike] -&gt; SDoc
</span><a href="GHC.Tc.Gen.Expr.html#badFieldsUpd"><span class="hs-identifier hs-var hs-var">badFieldsUpd</span></a></span></span><span> </span><span id="local-6989586621681092393"><span class="annot"><span class="annottext">[LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)]
</span><a href="#local-6989586621681092393"><span class="hs-identifier hs-var">rbinds</span></a></span></span><span> </span><span id="local-6989586621681092392"><span class="annot"><span class="annottext">[ConLike]
</span><a href="#local-6989586621681092392"><span class="hs-identifier hs-var">data_cons</span></a></span></span><span>
</span><span id="line-2790"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; ThLevel -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;No constructor has all these fields:&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-2791"></span><span>       </span><span class="annot"><span class="annottext">ThLevel
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FieldLabelString] -&gt; SDoc
forall a. Outputable a =&gt; [a] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pprQuotedList"><span class="hs-identifier hs-var">pprQuotedList</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldLabelString]
</span><a href="#local-6989586621681092390"><span class="hs-identifier hs-var">conflictingFields</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2792"></span><span>          </span><span class="hs-comment">-- See Note [Finding the conflicting fields]</span><span>
</span><span id="line-2793"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2794"></span><span>    </span><span class="hs-comment">-- A (preferably small) set of fields such that no constructor contains</span><span>
</span><span id="line-2795"></span><span>    </span><span class="hs-comment">-- all of them.  See Note [Finding the conflicting fields]</span><span>
</span><span id="line-2796"></span><span>    </span><span id="local-6989586621681092390"><span class="annot"><span class="annottext">conflictingFields :: [FieldLabelString]
</span><a href="#local-6989586621681092390"><span class="hs-identifier hs-var hs-var">conflictingFields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, [Bool])]
</span><a href="#local-6989586621681092385"><span class="hs-identifier hs-var">nonMembers</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2797"></span><span>        </span><span class="hs-comment">-- nonMember belongs to a different type.</span><span>
</span><span id="line-2798"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621681092384"><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621681092384"><span class="hs-identifier hs-var">nonMember</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Bool]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, [Bool])]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621681092383"><span class="hs-identifier hs-var">aMember</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621681092384"><span class="hs-identifier hs-var">nonMember</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2799"></span><span>        </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span>
</span><span id="line-2800"></span><span>            </span><span class="hs-comment">-- All of rbinds belong to one type. In this case, repeatedly add</span><span>
</span><span id="line-2801"></span><span>            </span><span class="hs-comment">-- a field to the set until no constructor contains the set.</span><span>
</span><span id="line-2802"></span><span>
</span><span id="line-2803"></span><span>            </span><span class="hs-comment">-- Each field, together with a list indicating which constructors</span><span>
</span><span id="line-2804"></span><span>            </span><span class="hs-comment">-- have all the fields so far.</span><span>
</span><span id="line-2805"></span><span>            </span><span class="annot"><a href="#local-6989586621681092382"><span class="hs-identifier hs-type">growingSets</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.FieldLabel.html#FieldLabelString"><span class="hs-identifier hs-type">FieldLabelString</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-2806"></span><span>            </span><span id="local-6989586621681092382"><span class="annot"><span class="annottext">growingSets :: [(FieldLabelString, [Bool])]
</span><a href="#local-6989586621681092382"><span class="hs-identifier hs-var hs-var">growingSets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((FieldLabelString, [Bool])
 -&gt; (FieldLabelString, [Bool]) -&gt; (FieldLabelString, [Bool]))
-&gt; [(FieldLabelString, [Bool])] -&gt; [(FieldLabelString, [Bool])]
forall a. (a -&gt; a -&gt; a) -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.List.html#scanl1"><span class="hs-identifier hs-var">scanl1</span></a></span><span> </span><span class="annot"><span class="annottext">(FieldLabelString, [Bool])
-&gt; (FieldLabelString, [Bool]) -&gt; (FieldLabelString, [Bool])
forall {a} {a}. (a, [Bool]) -&gt; (a, [Bool]) -&gt; (a, [Bool])
</span><a href="#local-6989586621681092380"><span class="hs-identifier hs-var">combine</span></a></span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, [Bool])]
</span><a href="#local-6989586621681092379"><span class="hs-identifier hs-var">membership</span></a></span><span>
</span><span id="line-2807"></span><span>            </span><span id="local-6989586621681092380"><span class="annot"><span class="annottext">combine :: (a, [Bool]) -&gt; (a, [Bool]) -&gt; (a, [Bool])
</span><a href="#local-6989586621681092380"><span class="hs-identifier hs-var hs-var">combine</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681092378"><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621681092378"><span class="hs-identifier hs-var">setMem</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681092377"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681092377"><span class="hs-identifier hs-var">field</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681092376"><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621681092376"><span class="hs-identifier hs-var">fldMem</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2808"></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681092377"><span class="hs-identifier hs-var">field</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool -&gt; Bool) -&gt; [Bool] -&gt; [Bool] -&gt; [Bool]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><a href="../../base/src/GHC.List.html#zipWith"><span class="hs-identifier hs-var">zipWith</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">(&amp;&amp;)</span></span><span> </span><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621681092378"><span class="hs-identifier hs-var">setMem</span></a></span><span> </span><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621681092376"><span class="hs-identifier hs-var">fldMem</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2809"></span><span>            </span><span class="hs-keyword">in</span><span>
</span><span id="line-2810"></span><span>            </span><span class="hs-comment">-- Fields that don't change the membership status of the set</span><span>
</span><span id="line-2811"></span><span>            </span><span class="hs-comment">-- are redundant and can be dropped.</span><span>
</span><span id="line-2812"></span><span>            </span><span class="annot"><span class="annottext">([(FieldLabelString, [Bool])] -&gt; FieldLabelString)
-&gt; [[(FieldLabelString, [Bool])]] -&gt; [FieldLabelString]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(FieldLabelString, [Bool]) -&gt; FieldLabelString
forall a b. (a, b) -&gt; a
</span><a href="../../base/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">((FieldLabelString, [Bool]) -&gt; FieldLabelString)
-&gt; ([(FieldLabelString, [Bool])] -&gt; (FieldLabelString, [Bool]))
-&gt; [(FieldLabelString, [Bool])]
-&gt; FieldLabelString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, [Bool])] -&gt; (FieldLabelString, [Bool])
forall a. [a] -&gt; a
</span><a href="../../base/src/GHC.List.html#head"><span class="hs-identifier hs-var">head</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([[(FieldLabelString, [Bool])]] -&gt; [FieldLabelString])
-&gt; [[(FieldLabelString, [Bool])]] -&gt; [FieldLabelString]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">((FieldLabelString, [Bool]) -&gt; (FieldLabelString, [Bool]) -&gt; Bool)
-&gt; [(FieldLabelString, [Bool])] -&gt; [[(FieldLabelString, [Bool])]]
forall a. (a -&gt; a -&gt; Bool) -&gt; [a] -&gt; [[a]]
</span><a href="../../base/src/Data.OldList.html#groupBy"><span class="hs-identifier hs-var">groupBy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Bool] -&gt; [Bool] -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">(==)</span></span><span> </span><span class="annot"><span class="annottext">([Bool] -&gt; [Bool] -&gt; Bool)
-&gt; ((FieldLabelString, [Bool]) -&gt; [Bool])
-&gt; (FieldLabelString, [Bool])
-&gt; (FieldLabelString, [Bool])
-&gt; Bool
forall b c a. (b -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; a -&gt; c
</span><a href="../../base/src/Data.Function.html#on"><span class="hs-operator hs-var">`on`</span></a></span><span> </span><span class="annot"><span class="annottext">(FieldLabelString, [Bool]) -&gt; [Bool]
forall a b. (a, b) -&gt; b
</span><a href="../../base/src/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, [Bool])]
</span><a href="#local-6989586621681092382"><span class="hs-identifier hs-var">growingSets</span></a></span><span>
</span><span id="line-2813"></span><span>
</span><span id="line-2814"></span><span>    </span><span id="local-6989586621681092383"><span class="annot"><span class="annottext">aMember :: FieldLabelString
</span><a href="#local-6989586621681092383"><span class="hs-identifier hs-var hs-var">aMember</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">null</span><span> </span><span class="hs-identifier">members</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-identifier">fst</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">head</span><span> </span><span class="hs-identifier">members</span><span class="hs-special">)</span><span>
</span><span id="line-2815"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681092372"><span class="annot"><span class="annottext">[(FieldLabelString, [Bool])]
</span><a href="#local-6989586621681092372"><span class="hs-identifier hs-var">members</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681092385"><span class="annot"><span class="annottext">[(FieldLabelString, [Bool])]
</span><a href="#local-6989586621681092385"><span class="hs-identifier hs-var">nonMembers</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((FieldLabelString, [Bool]) -&gt; Bool)
-&gt; [(FieldLabelString, [Bool])]
-&gt; ([(FieldLabelString, [Bool])], [(FieldLabelString, [Bool])])
forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><a href="../../base/src/Data.OldList.html#partition"><span class="hs-identifier hs-var">partition</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Bool] -&gt; Bool
forall (t :: * -&gt; *). Foldable t =&gt; t Bool -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#or"><span class="hs-identifier hs-var">or</span></a></span><span> </span><span class="annot"><span class="annottext">([Bool] -&gt; Bool)
-&gt; ((FieldLabelString, [Bool]) -&gt; [Bool])
-&gt; (FieldLabelString, [Bool])
-&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(FieldLabelString, [Bool]) -&gt; [Bool]
forall a b. (a, b) -&gt; b
</span><a href="../../base/src/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, [Bool])]
</span><a href="#local-6989586621681092379"><span class="hs-identifier hs-var">membership</span></a></span><span>
</span><span id="line-2816"></span><span>
</span><span id="line-2817"></span><span>    </span><span class="hs-comment">-- For each field, which constructors contain the field?</span><span>
</span><span id="line-2818"></span><span>    </span><span class="annot"><a href="#local-6989586621681092379"><span class="hs-identifier hs-type">membership</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.FieldLabel.html#FieldLabelString"><span class="hs-identifier hs-type">FieldLabelString</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-2819"></span><span>    </span><span id="local-6989586621681092379"><span class="annot"><span class="annottext">membership :: [(FieldLabelString, [Bool])]
</span><a href="#local-6989586621681092379"><span class="hs-identifier hs-var hs-var">membership</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(FieldLabelString, [Bool])] -&gt; [(FieldLabelString, [Bool])]
forall {a}. [(a, [Bool])] -&gt; [(a, [Bool])]
</span><a href="#local-6989586621681092369"><span class="hs-identifier hs-var">sortMembership</span></a></span><span> </span><span class="annot"><span class="annottext">([(FieldLabelString, [Bool])] -&gt; [(FieldLabelString, [Bool])])
-&gt; [(FieldLabelString, [Bool])] -&gt; [(FieldLabelString, [Bool])]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2820"></span><span>        </span><span class="annot"><span class="annottext">(FieldLabelString -&gt; (FieldLabelString, [Bool]))
-&gt; [FieldLabelString] -&gt; [(FieldLabelString, [Bool])]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681092368"><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621681092368"><span class="hs-identifier hs-var">fld</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621681092368"><span class="hs-identifier hs-var">fld</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(Set FieldLabelString -&gt; Bool) -&gt; [Set FieldLabelString] -&gt; [Bool]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldLabelString -&gt; Set FieldLabelString -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="../../containers/src/Data.Set.Internal.html#member"><span class="hs-identifier hs-var">Set.member</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabelString
</span><a href="#local-6989586621681092368"><span class="hs-identifier hs-var">fld</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Set FieldLabelString]
</span><a href="#local-6989586621681092366"><span class="hs-identifier hs-var">fieldLabelSets</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([FieldLabelString] -&gt; [(FieldLabelString, [Bool])])
-&gt; [FieldLabelString] -&gt; [(FieldLabelString, [Bool])]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2821"></span><span>          </span><span class="annot"><span class="annottext">(LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)
 -&gt; FieldLabelString)
-&gt; [LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)]
-&gt; [FieldLabelString]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">OccName -&gt; FieldLabelString
</span><a href="GHC.Types.Name.Occurrence.html#occNameFS"><span class="hs-identifier hs-var hs-var">occNameFS</span></a></span><span> </span><span class="annot"><span class="annottext">(OccName -&gt; FieldLabelString)
-&gt; (LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)
    -&gt; OccName)
-&gt; LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)
-&gt; FieldLabelString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; OccName
</span><a href="GHC.Types.Name.Reader.html#rdrNameOcc"><span class="hs-identifier hs-var">rdrNameOcc</span></a></span><span> </span><span class="annot"><span class="annottext">(RdrName -&gt; OccName)
-&gt; (LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)
    -&gt; RdrName)
-&gt; LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)
-&gt; OccName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">AmbiguousFieldOcc GhcTc -&gt; RdrName
forall (p :: Pass). AmbiguousFieldOcc (GhcPass p) -&gt; RdrName
</span><a href="GHC.Hs.Type.html#rdrNameAmbiguousFieldOcc"><span class="hs-identifier hs-var">rdrNameAmbiguousFieldOcc</span></a></span><span> </span><span class="annot"><span class="annottext">(AmbiguousFieldOcc GhcTc -&gt; RdrName)
-&gt; (LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)
    -&gt; AmbiguousFieldOcc GhcTc)
-&gt; LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)
-&gt; RdrName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpan (AmbiguousFieldOcc GhcTc)
-&gt; AmbiguousFieldOcc GhcTc
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpan (AmbiguousFieldOcc GhcTc)
 -&gt; AmbiguousFieldOcc GhcTc)
-&gt; (LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)
    -&gt; GenLocated SrcSpan (AmbiguousFieldOcc GhcTc))
-&gt; LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)
-&gt; AmbiguousFieldOcc GhcTc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">HsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)
-&gt; GenLocated SrcSpan (AmbiguousFieldOcc GhcTc)
forall id arg. HsRecField' id arg -&gt; Located id
</span><a href="GHC.Hs.Pat.html#hsRecFieldLbl"><span class="hs-identifier hs-var hs-var">hsRecFieldLbl</span></a></span><span> </span><span class="annot"><span class="annottext">(HsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)
 -&gt; GenLocated SrcSpan (AmbiguousFieldOcc GhcTc))
-&gt; (LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)
    -&gt; HsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn))
-&gt; LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)
-&gt; GenLocated SrcSpan (AmbiguousFieldOcc GhcTc)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)
-&gt; HsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LHsRecField' (AmbiguousFieldOcc GhcTc) (LHsExpr GhcRn)]
</span><a href="#local-6989586621681092393"><span class="hs-identifier hs-var">rbinds</span></a></span><span>
</span><span id="line-2822"></span><span>
</span><span id="line-2823"></span><span>    </span><span class="annot"><a href="#local-6989586621681092366"><span class="hs-identifier hs-type">fieldLabelSets</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../containers/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set.Set</span></a></span><span> </span><span class="annot"><a href="GHC.Types.FieldLabel.html#FieldLabelString"><span class="hs-identifier hs-type">FieldLabelString</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2824"></span><span>    </span><span id="local-6989586621681092366"><span class="annot"><span class="annottext">fieldLabelSets :: [Set FieldLabelString]
</span><a href="#local-6989586621681092366"><span class="hs-identifier hs-var hs-var">fieldLabelSets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ConLike -&gt; Set FieldLabelString)
-&gt; [ConLike] -&gt; [Set FieldLabelString]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FieldLabelString] -&gt; Set FieldLabelString
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="../../containers/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">Set.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([FieldLabelString] -&gt; Set FieldLabelString)
-&gt; (ConLike -&gt; [FieldLabelString])
-&gt; ConLike
-&gt; Set FieldLabelString
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(FieldLbl Name -&gt; FieldLabelString)
-&gt; [FieldLbl Name] -&gt; [FieldLabelString]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLbl Name -&gt; FieldLabelString
forall a. FieldLbl a -&gt; FieldLabelString
</span><a href="GHC.Types.FieldLabel.html#flLabel"><span class="hs-identifier hs-var hs-var">flLabel</span></a></span><span> </span><span class="annot"><span class="annottext">([FieldLbl Name] -&gt; [FieldLabelString])
-&gt; (ConLike -&gt; [FieldLbl Name]) -&gt; ConLike -&gt; [FieldLabelString]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike -&gt; [FieldLbl Name]
</span><a href="GHC.Core.ConLike.html#conLikeFieldLabels"><span class="hs-identifier hs-var">conLikeFieldLabels</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ConLike]
</span><a href="#local-6989586621681092392"><span class="hs-identifier hs-var">data_cons</span></a></span><span>
</span><span id="line-2825"></span><span>
</span><span id="line-2826"></span><span>    </span><span class="hs-comment">-- Sort in order of increasing number of True, so that a smaller</span><span>
</span><span id="line-2827"></span><span>    </span><span class="hs-comment">-- conflicting set can be found.</span><span>
</span><span id="line-2828"></span><span>    </span><span id="local-6989586621681092369"><span class="annot"><span class="annottext">sortMembership :: [(a, [Bool])] -&gt; [(a, [Bool])]
</span><a href="#local-6989586621681092369"><span class="hs-identifier hs-var hs-var">sortMembership</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2829"></span><span>      </span><span class="annot"><span class="annottext">((ThLevel, (a, [Bool])) -&gt; (a, [Bool]))
-&gt; [(ThLevel, (a, [Bool]))] -&gt; [(a, [Bool])]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">(ThLevel, (a, [Bool])) -&gt; (a, [Bool])
forall a b. (a, b) -&gt; b
</span><a href="../../base/src/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span> </span><span class="annot"><span class="annottext">([(ThLevel, (a, [Bool]))] -&gt; [(a, [Bool])])
-&gt; ([(a, [Bool])] -&gt; [(ThLevel, (a, [Bool]))])
-&gt; [(a, [Bool])]
-&gt; [(a, [Bool])]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span>
</span><span id="line-2830"></span><span>      </span><span class="annot"><span class="annottext">((ThLevel, (a, [Bool])) -&gt; (ThLevel, (a, [Bool])) -&gt; Ordering)
-&gt; [(ThLevel, (a, [Bool]))] -&gt; [(ThLevel, (a, [Bool]))]
forall a. (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; [a]
</span><a href="../../base/src/Data.OldList.html#sortBy"><span class="hs-identifier hs-var">sortBy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ThLevel -&gt; ThLevel -&gt; Ordering
forall a. Ord a =&gt; a -&gt; a -&gt; Ordering
</span><span class="hs-identifier hs-var">compare</span></span><span> </span><span class="annot"><span class="annottext">(ThLevel -&gt; ThLevel -&gt; Ordering)
-&gt; ((ThLevel, (a, [Bool])) -&gt; ThLevel)
-&gt; (ThLevel, (a, [Bool]))
-&gt; (ThLevel, (a, [Bool]))
-&gt; Ordering
forall b c a. (b -&gt; b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; a -&gt; c
</span><a href="../../base/src/Data.Function.html#on"><span class="hs-operator hs-var">`on`</span></a></span><span> </span><span class="annot"><span class="annottext">(ThLevel, (a, [Bool])) -&gt; ThLevel
forall a b. (a, b) -&gt; a
</span><a href="../../base/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([(ThLevel, (a, [Bool]))] -&gt; [(ThLevel, (a, [Bool]))])
-&gt; ([(a, [Bool])] -&gt; [(ThLevel, (a, [Bool]))])
-&gt; [(a, [Bool])]
-&gt; [(ThLevel, (a, [Bool]))]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span>
</span><span id="line-2831"></span><span>      </span><span class="annot"><span class="annottext">((a, [Bool]) -&gt; (ThLevel, (a, [Bool])))
-&gt; [(a, [Bool])] -&gt; [(ThLevel, (a, [Bool]))]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681092362"><span class="annot"><span class="annottext">item :: (a, [Bool])
</span><a href="#local-6989586621681092362"><span class="hs-identifier hs-var">item</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681092361"><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621681092361"><span class="hs-identifier hs-var">membershipRow</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Bool] -&gt; ThLevel
</span><a href="#local-6989586621681092360"><span class="hs-identifier hs-var">countTrue</span></a></span><span> </span><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621681092361"><span class="hs-identifier hs-var">membershipRow</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(a, [Bool])
</span><a href="#local-6989586621681092362"><span class="hs-identifier hs-var">item</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2832"></span><span>
</span><span id="line-2833"></span><span>    </span><span id="local-6989586621681092360"><span class="annot"><span class="annottext">countTrue :: [Bool] -&gt; ThLevel
</span><a href="#local-6989586621681092360"><span class="hs-identifier hs-var hs-var">countTrue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; [Bool] -&gt; ThLevel
forall a. (a -&gt; Bool) -&gt; [a] -&gt; ThLevel
</span><a href="GHC.Utils.Misc.html#count"><span class="hs-identifier hs-var">count</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
forall a. a -&gt; a
</span><a href="../../base/src/GHC.Base.html#id"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-2834"></span><span>
</span><span id="line-2835"></span><span class="hs-comment">{-
Note [Finding the conflicting fields]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Suppose we have
  data A = A {a0, a1 :: Int}
         | B {b0, b1 :: Int}
and we see a record update
  x { a0 = 3, a1 = 2, b0 = 4, b1 = 5 }
Then we'd like to find the smallest subset of fields that no
constructor has all of.  Here, say, {a0,b0}, or {a0,b1}, etc.
We don't really want to report that no constructor has all of
{a0,a1,b0,b1}, because when there are hundreds of fields it's
hard to see what was really wrong.

We may need more than two fields, though; eg
  data T = A { x,y :: Int, v::Int }
          | B { y,z :: Int, v::Int }
          | C { z,x :: Int, v::Int }
with update
   r { x=e1, y=e2, z=e3 }, we

Finding the smallest subset is hard, so the code here makes
a decent stab, no more.  See #7989.
-}</span><span>
</span><span id="line-2859"></span><span>
</span><span id="line-2860"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#naughtyRecordSel"><span class="hs-identifier hs-type">naughtyRecordSel</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-2861"></span><span id="naughtyRecordSel"><span class="annot"><span class="annottext">naughtyRecordSel :: RdrName -&gt; SDoc
</span><a href="GHC.Tc.Gen.Expr.html#naughtyRecordSel"><span class="hs-identifier hs-var hs-var">naughtyRecordSel</span></a></span></span><span> </span><span id="local-6989586621681092358"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621681092358"><span class="hs-identifier hs-var">sel_id</span></a></span></span><span>
</span><span id="line-2862"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Cannot use record selector&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RdrName -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621681092358"><span class="hs-identifier hs-var">sel_id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-2863"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;as a function due to escaped type variables&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-2864"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Probable fix: use pattern-matching syntax instead&quot;</span></span><span>
</span><span id="line-2865"></span><span>
</span><span id="line-2866"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#notSelector"><span class="hs-identifier hs-type">notSelector</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-2867"></span><span id="notSelector"><span class="annot"><span class="annottext">notSelector :: Name -&gt; SDoc
</span><a href="GHC.Tc.Gen.Expr.html#notSelector"><span class="hs-identifier hs-var hs-var">notSelector</span></a></span></span><span> </span><span id="local-6989586621681092357"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681092357"><span class="hs-identifier hs-var">field</span></a></span></span><span>
</span><span id="line-2868"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hsep"><span class="hs-identifier hs-var">hsep</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681092357"><span class="hs-identifier hs-var">field</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;is not a record selector&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-2869"></span><span>
</span><span id="line-2870"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#mixedSelectors"><span class="hs-identifier hs-type">mixedSelectors</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-2871"></span><span id="mixedSelectors"><span class="annot"><span class="annottext">mixedSelectors :: [Var] -&gt; [Var] -&gt; SDoc
</span><a href="GHC.Tc.Gen.Expr.html#mixedSelectors"><span class="hs-identifier hs-var hs-var">mixedSelectors</span></a></span></span><span> </span><span id="local-6989586621681092355"><span class="annot"><span class="annottext">data_sels :: [Var]
</span><a href="#local-6989586621681092355"><span class="hs-identifier hs-var">data_sels</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621681092354"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681092354"><span class="hs-identifier hs-var">dc_rep_id</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[Var]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681092353"><span class="annot"><span class="annottext">pat_syn_sels :: [Var]
</span><a href="#local-6989586621681092353"><span class="hs-identifier hs-var">pat_syn_sels</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621681092352"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681092352"><span class="hs-identifier hs-var">ps_rep_id</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[Var]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-2872"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PtrString -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ptext"><span class="hs-identifier hs-var">ptext</span></a></span><span>
</span><span id="line-2873"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; PtrString
</span><a href="GHC.Data.FastString.html#sLit"><span class="hs-identifier hs-var">sLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Cannot use a mixture of pattern synonym and record selectors&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-2874"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Record selectors defined by&quot;</span></span><span>
</span><span id="line-2875"></span><span>      </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Name
</span><a href="GHC.Core.TyCon.html#tyConName"><span class="hs-identifier hs-var hs-var">tyConName</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681092350"><span class="hs-identifier hs-var">rep_dc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2876"></span><span>      </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;:&quot;</span></span><span>
</span><span id="line-2877"></span><span>      </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(Var -&gt; SDoc) -&gt; [Var] -&gt; SDoc
forall a. (a -&gt; SDoc) -&gt; [a] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pprWithCommas"><span class="hs-identifier hs-var">pprWithCommas</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621681092355"><span class="hs-identifier hs-var">data_sels</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-2878"></span><span>    </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Pattern synonym selectors defined by&quot;</span></span><span>
</span><span id="line-2879"></span><span>      </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatSyn -&gt; Name
</span><a href="GHC.Core.PatSyn.html#patSynName"><span class="hs-identifier hs-var">patSynName</span></a></span><span> </span><span class="annot"><span class="annottext">PatSyn
</span><a href="#local-6989586621681092347"><span class="hs-identifier hs-var">rep_ps</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2880"></span><span>      </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;:&quot;</span></span><span>
</span><span id="line-2881"></span><span>      </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(Var -&gt; SDoc) -&gt; [Var] -&gt; SDoc
forall a. (a -&gt; SDoc) -&gt; [a] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pprWithCommas"><span class="hs-identifier hs-var">pprWithCommas</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><a href="#local-6989586621681092353"><span class="hs-identifier hs-var">pat_syn_sels</span></a></span><span>
</span><span id="line-2882"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2883"></span><span>    </span><span class="annot"><a href="GHC.Types.Id.Info.html#RecSelPatSyn"><span class="hs-identifier hs-type">RecSelPatSyn</span></a></span><span> </span><span id="local-6989586621681092347"><span class="annot"><span class="annottext">PatSyn
</span><a href="#local-6989586621681092347"><span class="hs-identifier hs-var">rep_ps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; RecSelParent
</span><a href="GHC.Types.Id.html#recordSelectorTyCon"><span class="hs-identifier hs-var">recordSelectorTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681092352"><span class="hs-identifier hs-var">ps_rep_id</span></a></span><span>
</span><span id="line-2884"></span><span>    </span><span class="annot"><a href="GHC.Types.Id.Info.html#RecSelData"><span class="hs-identifier hs-type">RecSelData</span></a></span><span> </span><span id="local-6989586621681092350"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681092350"><span class="hs-identifier hs-var">rep_dc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Var -&gt; RecSelParent
</span><a href="GHC.Types.Id.html#recordSelectorTyCon"><span class="hs-identifier hs-var">recordSelectorTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681092354"><span class="hs-identifier hs-var">dc_rep_id</span></a></span><span>
</span><span id="line-2885"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#mixedSelectors"><span class="hs-identifier hs-var">mixedSelectors</span></a></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">[Var]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;GHC.Tc.Gen.Expr: mixedSelectors emptylists&quot;</span></span><span>
</span><span id="line-2886"></span><span>
</span><span id="line-2887"></span><span>
</span><span id="line-2888"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#missingStrictFields"><span class="hs-identifier hs-type">missingStrictFields</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.ConLike.html#ConLike"><span class="hs-identifier hs-type">ConLike</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.FieldLabel.html#FieldLabelString"><span class="hs-identifier hs-type">FieldLabelString</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-2889"></span><span id="missingStrictFields"><span class="annot"><span class="annottext">missingStrictFields :: ConLike -&gt; [FieldLabelString] -&gt; SDoc
</span><a href="GHC.Tc.Gen.Expr.html#missingStrictFields"><span class="hs-identifier hs-var hs-var">missingStrictFields</span></a></span></span><span> </span><span id="local-6989586621681092346"><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681092346"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span id="local-6989586621681092345"><span class="annot"><span class="annottext">[FieldLabelString]
</span><a href="#local-6989586621681092345"><span class="hs-identifier hs-var">fields</span></a></span></span><span>
</span><span id="line-2890"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681092344"><span class="hs-identifier hs-var">header</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681092343"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-2891"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2892"></span><span>    </span><span id="local-6989586621681092343"><span class="annot"><span class="annottext">rest :: SDoc
</span><a href="#local-6989586621681092343"><span class="hs-identifier hs-var hs-var">rest</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[FieldLabelString] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldLabelString]
</span><a href="#local-6989586621681092345"><span class="hs-identifier hs-var">fields</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">Outputable.empty</span></a></span><span>  </span><span class="hs-comment">-- Happens for non-record constructors</span><span>
</span><span id="line-2893"></span><span>                                           </span><span class="hs-comment">-- with strict fields</span><span>
</span><span id="line-2894"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#colon"><span class="hs-identifier hs-var">colon</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(FieldLabelString -&gt; SDoc) -&gt; [FieldLabelString] -&gt; SDoc
forall a. (a -&gt; SDoc) -&gt; [a] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pprWithCommas"><span class="hs-identifier hs-var">pprWithCommas</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabelString -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldLabelString]
</span><a href="#local-6989586621681092345"><span class="hs-identifier hs-var">fields</span></a></span><span>
</span><span id="line-2895"></span><span>
</span><span id="line-2896"></span><span>    </span><span id="local-6989586621681092344"><span class="annot"><span class="annottext">header :: SDoc
</span><a href="#local-6989586621681092344"><span class="hs-identifier hs-var hs-var">header</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Constructor&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConLike -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681092346"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-2897"></span><span>             </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;does not have the required strict field(s)&quot;</span></span><span>
</span><span id="line-2898"></span><span>
</span><span id="line-2899"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#missingFields"><span class="hs-identifier hs-type">missingFields</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.ConLike.html#ConLike"><span class="hs-identifier hs-type">ConLike</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.FieldLabel.html#FieldLabelString"><span class="hs-identifier hs-type">FieldLabelString</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-2900"></span><span id="missingFields"><span class="annot"><span class="annottext">missingFields :: ConLike -&gt; [FieldLabelString] -&gt; SDoc
</span><a href="GHC.Tc.Gen.Expr.html#missingFields"><span class="hs-identifier hs-var hs-var">missingFields</span></a></span></span><span> </span><span id="local-6989586621681092342"><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681092342"><span class="hs-identifier hs-var">con</span></a></span></span><span> </span><span id="local-6989586621681092341"><span class="annot"><span class="annottext">[FieldLabelString]
</span><a href="#local-6989586621681092341"><span class="hs-identifier hs-var">fields</span></a></span></span><span>
</span><span id="line-2901"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681092340"><span class="hs-identifier hs-var">header</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681092339"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-2902"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2903"></span><span>    </span><span id="local-6989586621681092339"><span class="annot"><span class="annottext">rest :: SDoc
</span><a href="#local-6989586621681092339"><span class="hs-identifier hs-var hs-var">rest</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[FieldLabelString] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldLabelString]
</span><a href="#local-6989586621681092341"><span class="hs-identifier hs-var">fields</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">Outputable.empty</span></a></span><span>
</span><span id="line-2904"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#colon"><span class="hs-identifier hs-var">colon</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">(FieldLabelString -&gt; SDoc) -&gt; [FieldLabelString] -&gt; SDoc
forall a. (a -&gt; SDoc) -&gt; [a] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pprWithCommas"><span class="hs-identifier hs-var">pprWithCommas</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabelString -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldLabelString]
</span><a href="#local-6989586621681092341"><span class="hs-identifier hs-var">fields</span></a></span><span>
</span><span id="line-2905"></span><span>    </span><span id="local-6989586621681092340"><span class="annot"><span class="annottext">header :: SDoc
</span><a href="#local-6989586621681092340"><span class="hs-identifier hs-var hs-var">header</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Fields of&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ConLike -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ConLike
</span><a href="#local-6989586621681092342"><span class="hs-identifier hs-var">con</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-2906"></span><span>             </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;not initialised&quot;</span></span><span>
</span><span id="line-2907"></span><span>
</span><span id="line-2908"></span><span class="hs-comment">-- callCtxt fun args = text &quot;In the call&quot; &lt;+&gt; parens (ppr (foldl' mkHsApp fun args))</span><span>
</span><span id="line-2909"></span><span>
</span><span id="line-2910"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#noPossibleParents"><span class="hs-identifier hs-type">noPossibleParents</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Hs.Pat.html#LHsRecUpdField"><span class="hs-identifier hs-type">LHsRecUpdField</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-2911"></span><span id="noPossibleParents"><span class="annot"><span class="annottext">noPossibleParents :: [LHsRecUpdField GhcRn] -&gt; SDoc
</span><a href="GHC.Tc.Gen.Expr.html#noPossibleParents"><span class="hs-identifier hs-var hs-var">noPossibleParents</span></a></span></span><span> </span><span id="local-6989586621681092338"><span class="annot"><span class="annottext">[LHsRecUpdField GhcRn]
</span><a href="#local-6989586621681092338"><span class="hs-identifier hs-var">rbinds</span></a></span></span><span>
</span><span id="line-2912"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; ThLevel -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;No type has all these fields:&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-2913"></span><span>       </span><span class="annot"><span class="annottext">ThLevel
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Located (AmbiguousFieldOcc GhcRn)] -&gt; SDoc
forall a. Outputable a =&gt; [a] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#pprQuotedList"><span class="hs-identifier hs-var">pprQuotedList</span></a></span><span> </span><span class="annot"><span class="annottext">[Located (AmbiguousFieldOcc GhcRn)]
</span><a href="#local-6989586621681092337"><span class="hs-identifier hs-var">fields</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2914"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2915"></span><span>    </span><span id="local-6989586621681092337"><span class="annot"><span class="annottext">fields :: [Located (AmbiguousFieldOcc GhcRn)]
</span><a href="#local-6989586621681092337"><span class="hs-identifier hs-var hs-var">fields</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LHsRecUpdField GhcRn -&gt; Located (AmbiguousFieldOcc GhcRn))
-&gt; [LHsRecUpdField GhcRn] -&gt; [Located (AmbiguousFieldOcc GhcRn)]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsRecField' (AmbiguousFieldOcc GhcRn) (LHsExpr GhcRn)
-&gt; Located (AmbiguousFieldOcc GhcRn)
forall id arg. HsRecField' id arg -&gt; Located id
</span><a href="GHC.Hs.Pat.html#hsRecFieldLbl"><span class="hs-identifier hs-var hs-var">hsRecFieldLbl</span></a></span><span> </span><span class="annot"><span class="annottext">(HsRecField' (AmbiguousFieldOcc GhcRn) (LHsExpr GhcRn)
 -&gt; Located (AmbiguousFieldOcc GhcRn))
-&gt; (LHsRecUpdField GhcRn
    -&gt; HsRecField' (AmbiguousFieldOcc GhcRn) (LHsExpr GhcRn))
-&gt; LHsRecUpdField GhcRn
-&gt; Located (AmbiguousFieldOcc GhcRn)
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">LHsRecUpdField GhcRn
-&gt; HsRecField' (AmbiguousFieldOcc GhcRn) (LHsExpr GhcRn)
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LHsRecUpdField GhcRn]
</span><a href="#local-6989586621681092338"><span class="hs-identifier hs-var">rbinds</span></a></span><span>
</span><span id="line-2916"></span><span>
</span><span id="line-2917"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#badOverloadedUpdate"><span class="hs-identifier hs-type">badOverloadedUpdate</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-2918"></span><span id="badOverloadedUpdate"><span class="annot"><span class="annottext">badOverloadedUpdate :: SDoc
</span><a href="GHC.Tc.Gen.Expr.html#badOverloadedUpdate"><span class="hs-identifier hs-var hs-var">badOverloadedUpdate</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Record update is ambiguous, and requires a type signature&quot;</span></span><span>
</span><span id="line-2919"></span><span>
</span><span id="line-2920"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#fieldNotInType"><span class="hs-identifier hs-type">fieldNotInType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Id.Info.html#RecSelParent"><span class="hs-identifier hs-type">RecSelParent</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-2921"></span><span id="fieldNotInType"><span class="annot"><span class="annottext">fieldNotInType :: RecSelParent -&gt; RdrName -&gt; SDoc
</span><a href="GHC.Tc.Gen.Expr.html#fieldNotInType"><span class="hs-identifier hs-var hs-var">fieldNotInType</span></a></span></span><span> </span><span id="local-6989586621681092336"><span class="annot"><span class="annottext">RecSelParent
</span><a href="#local-6989586621681092336"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621681092335"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621681092335"><span class="hs-identifier hs-var">rdr</span></a></span></span><span>
</span><span id="line-2922"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; RdrName -&gt; SDoc
</span><a href="GHC.Rename.Utils.html#unknownSubordinateErr"><span class="hs-identifier hs-var">unknownSubordinateErr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;field of type&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RecSelParent -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">RecSelParent
</span><a href="#local-6989586621681092336"><span class="hs-identifier hs-var">p</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621681092335"><span class="hs-identifier hs-var">rdr</span></a></span><span>
</span><span id="line-2923"></span><span>
</span><span id="line-2924"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Static Pointers}
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-2931"></span><span>
</span><span id="line-2932"></span><span class="hs-comment">-- | A data type to describe why a variable is not closed.</span><span>
</span><span id="line-2933"></span><span class="hs-keyword">data</span><span> </span><span id="NotClosedReason"><span class="annot"><a href="GHC.Tc.Gen.Expr.html#NotClosedReason"><span class="hs-identifier hs-var">NotClosedReason</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="NotLetBoundReason"><span class="annot"><a href="GHC.Tc.Gen.Expr.html#NotLetBoundReason"><span class="hs-identifier hs-var">NotLetBoundReason</span></a></span></span><span>
</span><span id="line-2934"></span><span>                     </span><span class="hs-glyph">|</span><span> </span><span id="NotTypeClosed"><span class="annot"><a href="GHC.Tc.Gen.Expr.html#NotTypeClosed"><span class="hs-identifier hs-var">NotTypeClosed</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html#VarSet"><span class="hs-identifier hs-type">VarSet</span></a></span><span>
</span><span id="line-2935"></span><span>                     </span><span class="hs-glyph">|</span><span> </span><span id="NotClosed"><span class="annot"><a href="GHC.Tc.Gen.Expr.html#NotClosed"><span class="hs-identifier hs-var">NotClosed</span></a></span></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#NotClosedReason"><span class="hs-identifier hs-type">NotClosedReason</span></a></span><span>
</span><span id="line-2936"></span><span>
</span><span id="line-2937"></span><span class="hs-comment">-- | Checks if the given name is closed and emits an error if not.</span><span>
</span><span id="line-2938"></span><span class="hs-comment">--</span><span>
</span><span id="line-2939"></span><span class="hs-comment">-- See Note [Not-closed error messages].</span><span>
</span><span id="line-2940"></span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#checkClosedInStaticForm"><span class="hs-identifier hs-type">checkClosedInStaticForm</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2941"></span><span id="checkClosedInStaticForm"><span class="annot"><span class="annottext">checkClosedInStaticForm :: Name -&gt; TcRn ()
</span><a href="GHC.Tc.Gen.Expr.html#checkClosedInStaticForm"><span class="hs-identifier hs-var hs-var">checkClosedInStaticForm</span></a></span></span><span> </span><span id="local-6989586621681092331"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681092331"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2942"></span><span>    </span><span id="local-6989586621681092330"><span class="annot"><span class="annottext">TcTypeEnv
</span><a href="#local-6989586621681092330"><span class="hs-identifier hs-var">type_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM TcTypeEnv
</span><a href="GHC.Tc.Utils.Monad.html#getLclTypeEnv"><span class="hs-identifier hs-var">getLclTypeEnv</span></a></span><span>
</span><span id="line-2943"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TcTypeEnv -&gt; Name -&gt; Maybe NotClosedReason
</span><a href="#local-6989586621681092328"><span class="hs-identifier hs-var">checkClosed</span></a></span><span> </span><span class="annot"><span class="annottext">TcTypeEnv
</span><a href="#local-6989586621681092330"><span class="hs-identifier hs-var">type_env</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681092331"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2944"></span><span>      </span><span class="annot"><span class="annottext">Maybe NotClosedReason
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2945"></span><span>      </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681092327"><span class="annot"><span class="annottext">NotClosedReason
</span><a href="#local-6989586621681092327"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addErrTc"><span class="hs-identifier hs-var">addErrTc</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; TcRn ()) -&gt; SDoc -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; NotClosedReason -&gt; SDoc
</span><a href="#local-6989586621681092326"><span class="hs-identifier hs-var">explain</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681092331"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">NotClosedReason
</span><a href="#local-6989586621681092327"><span class="hs-identifier hs-var">reason</span></a></span><span>
</span><span id="line-2946"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2947"></span><span>    </span><span class="hs-comment">-- See Note [Checking closedness].</span><span>
</span><span id="line-2948"></span><span>    </span><span class="annot"><a href="#local-6989586621681092328"><span class="hs-identifier hs-type">checkClosed</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcTypeEnv"><span class="hs-identifier hs-type">TcTypeEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#NotClosedReason"><span class="hs-identifier hs-type">NotClosedReason</span></a></span><span>
</span><span id="line-2949"></span><span>    </span><span id="local-6989586621681092328"><span class="annot"><span class="annottext">checkClosed :: TcTypeEnv -&gt; Name -&gt; Maybe NotClosedReason
</span><a href="#local-6989586621681092328"><span class="hs-identifier hs-var hs-var">checkClosed</span></a></span></span><span> </span><span id="local-6989586621681092325"><span class="annot"><span class="annottext">TcTypeEnv
</span><a href="#local-6989586621681092325"><span class="hs-identifier hs-var">type_env</span></a></span></span><span> </span><span id="local-6989586621681092324"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681092324"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcTypeEnv -&gt; UniqSet Name -&gt; Name -&gt; Maybe NotClosedReason
</span><a href="#local-6989586621681092323"><span class="hs-identifier hs-var">checkLoop</span></a></span><span> </span><span class="annot"><span class="annottext">TcTypeEnv
</span><a href="#local-6989586621681092325"><span class="hs-identifier hs-var">type_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; UniqSet Name
</span><a href="GHC.Types.Name.Set.html#unitNameSet"><span class="hs-identifier hs-var">unitNameSet</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681092324"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681092324"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-2950"></span><span>
</span><span id="line-2951"></span><span>    </span><span class="annot"><a href="#local-6989586621681092323"><span class="hs-identifier hs-type">checkLoop</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcTypeEnv"><span class="hs-identifier hs-type">TcTypeEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html#NameSet"><span class="hs-identifier hs-type">NameSet</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#NotClosedReason"><span class="hs-identifier hs-type">NotClosedReason</span></a></span><span>
</span><span id="line-2952"></span><span>    </span><span id="local-6989586621681092323"><span class="annot"><span class="annottext">checkLoop :: TcTypeEnv -&gt; UniqSet Name -&gt; Name -&gt; Maybe NotClosedReason
</span><a href="#local-6989586621681092323"><span class="hs-identifier hs-var hs-var">checkLoop</span></a></span></span><span> </span><span id="local-6989586621681092320"><span class="annot"><span class="annottext">TcTypeEnv
</span><a href="#local-6989586621681092320"><span class="hs-identifier hs-var">type_env</span></a></span></span><span> </span><span id="local-6989586621681092319"><span class="annot"><span class="annottext">UniqSet Name
</span><a href="#local-6989586621681092319"><span class="hs-identifier hs-var">visited</span></a></span></span><span> </span><span id="local-6989586621681092318"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681092318"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2953"></span><span>      </span><span class="hs-comment">-- The @visited@ set is an accumulating parameter that contains the set of</span><span>
</span><span id="line-2954"></span><span>      </span><span class="hs-comment">-- visited nodes, so we avoid repeating cycles in the traversal.</span><span>
</span><span id="line-2955"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TcTypeEnv -&gt; Name -&gt; Maybe TcTyThing
forall a. NameEnv a -&gt; Name -&gt; Maybe a
</span><a href="GHC.Types.Name.Env.html#lookupNameEnv"><span class="hs-identifier hs-var">lookupNameEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TcTypeEnv
</span><a href="#local-6989586621681092320"><span class="hs-identifier hs-var">type_env</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681092318"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2956"></span><span>        </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#ATcId"><span class="hs-identifier hs-type">ATcId</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">tct_id :: TcTyThing -&gt; Var
</span><a href="GHC.Tc.Types.html#tct_id"><span class="hs-identifier hs-var">tct_id</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681092316"><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681092316"><span class="hs-identifier hs-var">tcid</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">tct_info :: TcTyThing -&gt; IdBindingInfo
</span><a href="GHC.Tc.Types.html#tct_info"><span class="hs-identifier hs-var">tct_info</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681092314"><span class="annot"><span class="annottext">IdBindingInfo
</span><a href="#local-6989586621681092314"><span class="hs-identifier hs-var">info</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">IdBindingInfo
</span><a href="#local-6989586621681092314"><span class="hs-identifier hs-var">info</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2957"></span><span>          </span><span class="annot"><span class="annottext">IdBindingInfo
</span><a href="GHC.Tc.Types.html#ClosedLet"><span class="hs-identifier hs-var">ClosedLet</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe NotClosedReason
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-2958"></span><span>          </span><span class="annot"><span class="annottext">IdBindingInfo
</span><a href="GHC.Tc.Types.html#NotLetBound"><span class="hs-identifier hs-var">NotLetBound</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">NotClosedReason -&gt; Maybe NotClosedReason
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">NotClosedReason
</span><a href="GHC.Tc.Gen.Expr.html#NotLetBoundReason"><span class="hs-identifier hs-var">NotLetBoundReason</span></a></span><span>
</span><span id="line-2959"></span><span>          </span><span class="annot"><a href="GHC.Tc.Types.html#NonClosedLet"><span class="hs-identifier hs-type">NonClosedLet</span></a></span><span> </span><span id="local-6989586621681092310"><span class="annot"><span class="annottext">UniqSet Name
</span><a href="#local-6989586621681092310"><span class="hs-identifier hs-var">fvs</span></a></span></span><span> </span><span id="local-6989586621681092309"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681092309"><span class="hs-identifier hs-var">type_closed</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[NotClosedReason] -&gt; Maybe NotClosedReason
forall a. [a] -&gt; Maybe a
</span><a href="../../base/src/Data.Maybe.html#listToMaybe"><span class="hs-identifier hs-var">listToMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">([NotClosedReason] -&gt; Maybe NotClosedReason)
-&gt; [NotClosedReason] -&gt; Maybe NotClosedReason
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2960"></span><span>            </span><span class="hs-comment">-- Look for a non-closed variable in fvs</span><span>
</span><span id="line-2961"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Name -&gt; NotClosedReason -&gt; NotClosedReason
</span><a href="GHC.Tc.Gen.Expr.html#NotClosed"><span class="hs-identifier hs-var">NotClosed</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681092307"><span class="hs-identifier hs-var">n'</span></a></span><span> </span><span class="annot"><span class="annottext">NotClosedReason
</span><a href="#local-6989586621681092306"><span class="hs-identifier hs-var">reason</span></a></span><span>
</span><span id="line-2962"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681092307"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681092307"><span class="hs-identifier hs-var">n'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UniqSet Name -&gt; [Name]
</span><a href="GHC.Types.Name.Set.html#nameSetElemsStable"><span class="hs-identifier hs-var">nameSetElemsStable</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSet Name
</span><a href="#local-6989586621681092310"><span class="hs-identifier hs-var">fvs</span></a></span><span>
</span><span id="line-2963"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; UniqSet Name -&gt; Bool
</span><a href="GHC.Types.Name.Set.html#elemNameSet"><span class="hs-identifier hs-var">elemNameSet</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681092307"><span class="hs-identifier hs-var">n'</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSet Name
</span><a href="#local-6989586621681092319"><span class="hs-identifier hs-var">visited</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2964"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681092306"><span class="annot"><span class="annottext">NotClosedReason
</span><a href="#local-6989586621681092306"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">TcTypeEnv -&gt; UniqSet Name -&gt; Name -&gt; Maybe NotClosedReason
</span><a href="#local-6989586621681092323"><span class="hs-identifier hs-var">checkLoop</span></a></span><span> </span><span class="annot"><span class="annottext">TcTypeEnv
</span><a href="#local-6989586621681092320"><span class="hs-identifier hs-var">type_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UniqSet Name -&gt; Name -&gt; UniqSet Name
</span><a href="GHC.Types.Name.Set.html#extendNameSet"><span class="hs-identifier hs-var">extendNameSet</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSet Name
</span><a href="#local-6989586621681092319"><span class="hs-identifier hs-var">visited</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681092307"><span class="hs-identifier hs-var">n'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681092307"><span class="hs-identifier hs-var">n'</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2965"></span><span>            </span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[NotClosedReason] -&gt; [NotClosedReason] -&gt; [NotClosedReason]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-2966"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681092309"><span class="hs-identifier hs-var">type_closed</span></a></span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-2967"></span><span>              </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2968"></span><span>            </span><span class="hs-keyword">else</span><span>
</span><span id="line-2969"></span><span>              </span><span class="hs-comment">-- We consider non-let-bound variables easier to figure out than</span><span>
</span><span id="line-2970"></span><span>              </span><span class="hs-comment">-- non-closed types, so we report non-closed types to the user</span><span>
</span><span id="line-2971"></span><span>              </span><span class="hs-comment">-- only if we cannot spot the former.</span><span>
</span><span id="line-2972"></span><span>              </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; NotClosedReason
</span><a href="GHC.Tc.Gen.Expr.html#NotTypeClosed"><span class="hs-identifier hs-var">NotTypeClosed</span></a></span><span> </span><span class="annot"><span class="annottext">(VarSet -&gt; NotClosedReason) -&gt; VarSet -&gt; NotClosedReason
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TcType -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Var -&gt; TcType
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Var
</span><a href="#local-6989586621681092316"><span class="hs-identifier hs-var">tcid</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2973"></span><span>        </span><span class="hs-comment">-- The binding is closed.</span><span>
</span><span id="line-2974"></span><span>        </span><span class="annot"><span class="annottext">Maybe TcTyThing
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe NotClosedReason
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-2975"></span><span>
</span><span id="line-2976"></span><span>    </span><span class="hs-comment">-- Converts a reason into a human-readable sentence.</span><span>
</span><span id="line-2977"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-2978"></span><span>    </span><span class="hs-comment">-- @explain name reason@ starts with</span><span>
</span><span id="line-2979"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-2980"></span><span>    </span><span class="hs-comment">-- &quot;&lt;name&gt; is used in a static form but it is not closed because it&quot;</span><span>
</span><span id="line-2981"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-2982"></span><span>    </span><span class="hs-comment">-- and then follows a list of causes. For each id in the path, the text</span><span>
</span><span id="line-2983"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-2984"></span><span>    </span><span class="hs-comment">-- &quot;uses &lt;id&gt; which&quot;</span><span>
</span><span id="line-2985"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-2986"></span><span>    </span><span class="hs-comment">-- is appended, yielding something like</span><span>
</span><span id="line-2987"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-2988"></span><span>    </span><span class="hs-comment">-- &quot;uses &lt;id&gt; which uses &lt;id1&gt; which uses &lt;id2&gt; which&quot;</span><span>
</span><span id="line-2989"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-2990"></span><span>    </span><span class="hs-comment">-- until the end of the path is reached, which is reported as either</span><span>
</span><span id="line-2991"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-2992"></span><span>    </span><span class="hs-comment">-- &quot;is not let-bound&quot;</span><span>
</span><span id="line-2993"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-2994"></span><span>    </span><span class="hs-comment">-- when the final node is not let-bound, or</span><span>
</span><span id="line-2995"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-2996"></span><span>    </span><span class="hs-comment">-- &quot;has a non-closed type because it contains the type variables:</span><span>
</span><span id="line-2997"></span><span>    </span><span class="hs-comment">-- v1, v2, v3&quot;</span><span>
</span><span id="line-2998"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-2999"></span><span>    </span><span class="hs-comment">-- when the final node has a non-closed type.</span><span>
</span><span id="line-3000"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-3001"></span><span>    </span><span class="annot"><a href="#local-6989586621681092326"><span class="hs-identifier hs-type">explain</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#NotClosedReason"><span class="hs-identifier hs-type">NotClosedReason</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-3002"></span><span>    </span><span id="local-6989586621681092326"><span class="annot"><span class="annottext">explain :: Name -&gt; NotClosedReason -&gt; SDoc
</span><a href="#local-6989586621681092326"><span class="hs-identifier hs-var hs-var">explain</span></a></span></span><span> </span><span id="local-6989586621681092302"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681092302"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621681092301"><span class="annot"><span class="annottext">NotClosedReason
</span><a href="#local-6989586621681092301"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3003"></span><span>      </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681092302"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;is used in a static form but it is not closed&quot;</span></span><span>
</span><span id="line-3004"></span><span>                        </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;because it&quot;</span></span><span>
</span><span id="line-3005"></span><span>                        </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-3006"></span><span>                        </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NotClosedReason -&gt; [SDoc]
</span><a href="#local-6989586621681092300"><span class="hs-identifier hs-var">causes</span></a></span><span> </span><span class="annot"><span class="annottext">NotClosedReason
</span><a href="#local-6989586621681092301"><span class="hs-identifier hs-var">reason</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-3007"></span><span>
</span><span id="line-3008"></span><span>    </span><span class="annot"><a href="#local-6989586621681092300"><span class="hs-identifier hs-type">causes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#NotClosedReason"><span class="hs-identifier hs-type">NotClosedReason</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-3009"></span><span>    </span><span id="local-6989586621681092300"><span class="annot"><span class="annottext">causes :: NotClosedReason -&gt; [SDoc]
</span><a href="#local-6989586621681092300"><span class="hs-identifier hs-var hs-var">causes</span></a></span></span><span> </span><span class="annot"><span class="annottext">NotClosedReason
</span><a href="GHC.Tc.Gen.Expr.html#NotLetBoundReason"><span class="hs-identifier hs-var">NotLetBoundReason</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;is not let-bound.&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-3010"></span><span>    </span><span class="annot"><a href="#local-6989586621681092300"><span class="hs-identifier hs-var">causes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#NotTypeClosed"><span class="hs-identifier hs-type">NotTypeClosed</span></a></span><span> </span><span id="local-6989586621681092299"><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621681092299"><span class="hs-identifier hs-var">vs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3011"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;has a non-closed type because it contains the&quot;</span></span><span>
</span><span id="line-3012"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;type variables:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-3013"></span><span>        </span><span class="annot"><span class="annottext">VarSet -&gt; ([Var] -&gt; SDoc) -&gt; SDoc
</span><a href="GHC.Types.Var.Set.html#pprVarSet"><span class="hs-identifier hs-var">pprVarSet</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621681092299"><span class="hs-identifier hs-var">vs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hsep"><span class="hs-identifier hs-var">hsep</span></a></span><span> </span><span class="annot"><span class="annottext">([SDoc] -&gt; SDoc) -&gt; ([Var] -&gt; [SDoc]) -&gt; [Var] -&gt; SDoc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; [SDoc] -&gt; [SDoc]
</span><a href="GHC.Utils.Outputable.html#punctuate"><span class="hs-identifier hs-var">punctuate</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a></span><span> </span><span class="annot"><span class="annottext">([SDoc] -&gt; [SDoc]) -&gt; ([Var] -&gt; [SDoc]) -&gt; [Var] -&gt; [SDoc]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Var -&gt; SDoc) -&gt; [Var] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc) -&gt; (Var -&gt; SDoc) -&gt; Var -&gt; SDoc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Var -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-3014"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-3015"></span><span>    </span><span class="annot"><a href="#local-6989586621681092300"><span class="hs-identifier hs-var">causes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#NotClosed"><span class="hs-identifier hs-type">NotClosed</span></a></span><span> </span><span id="local-6989586621681092295"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681092295"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681092294"><span class="annot"><span class="annottext">NotClosedReason
</span><a href="#local-6989586621681092294"><span class="hs-identifier hs-var">reason</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-3016"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681092293"><span class="annot"><span class="annottext">msg :: SDoc
</span><a href="#local-6989586621681092293"><span class="hs-identifier hs-var hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;uses&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681092295"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;which&quot;</span></span><span>
</span><span id="line-3017"></span><span>       </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">NotClosedReason
</span><a href="#local-6989586621681092294"><span class="hs-identifier hs-var">reason</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-3018"></span><span>            </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html#NotClosed"><span class="hs-identifier hs-type">NotClosed</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">NotClosedReason
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681092293"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; [SDoc] -&gt; [SDoc]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">NotClosedReason -&gt; [SDoc]
</span><a href="#local-6989586621681092300"><span class="hs-identifier hs-var">causes</span></a></span><span> </span><span class="annot"><span class="annottext">NotClosedReason
</span><a href="#local-6989586621681092294"><span class="hs-identifier hs-var">reason</span></a></span><span>
</span><span id="line-3019"></span><span>            </span><span class="annot"><span class="annottext">NotClosedReason
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681092292"><span class="annot"><span class="annottext">[SDoc]
</span><a href="#local-6989586621681092292"><span class="hs-identifier hs-var">xs0</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681092291"><span class="annot"><span class="annottext">[SDoc]
</span><a href="#local-6989586621681092291"><span class="hs-identifier hs-var">xs1</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ThLevel -&gt; [SDoc] -&gt; ([SDoc], [SDoc])
forall a. ThLevel -&gt; [a] -&gt; ([a], [a])
</span><a href="../../base/src/GHC.List.html#splitAt"><span class="hs-identifier hs-var">splitAt</span></a></span><span> </span><span class="annot"><span class="annottext">ThLevel
</span><span class="hs-number">1</span></span><span> </span><span class="annot"><span class="annottext">([SDoc] -&gt; ([SDoc], [SDoc])) -&gt; [SDoc] -&gt; ([SDoc], [SDoc])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NotClosedReason -&gt; [SDoc]
</span><a href="#local-6989586621681092300"><span class="hs-identifier hs-var">causes</span></a></span><span> </span><span class="annot"><span class="annottext">NotClosedReason
</span><a href="#local-6989586621681092294"><span class="hs-identifier hs-var">reason</span></a></span><span>
</span><span id="line-3020"></span><span>                    </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc) -&gt; [SDoc] -&gt; [SDoc]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681092293"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[SDoc]
</span><a href="#local-6989586621681092292"><span class="hs-identifier hs-var">xs0</span></a></span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; [SDoc] -&gt; [SDoc]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[SDoc]
</span><a href="#local-6989586621681092291"><span class="hs-identifier hs-var">xs1</span></a></span><span>
</span><span id="line-3021"></span><span>
</span><span id="line-3022"></span><span class="hs-comment">-- Note [Not-closed error messages]</span><span>
</span><span id="line-3023"></span><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><span id="line-3024"></span><span class="hs-comment">--</span><span>
</span><span id="line-3025"></span><span class="hs-comment">-- When variables in a static form are not closed, we go through the trouble</span><span>
</span><span id="line-3026"></span><span class="hs-comment">-- of explaining why they aren't.</span><span>
</span><span id="line-3027"></span><span class="hs-comment">--</span><span>
</span><span id="line-3028"></span><span class="hs-comment">-- Thus, the following program</span><span>
</span><span id="line-3029"></span><span class="hs-comment">--</span><span>
</span><span id="line-3030"></span><span class="hs-comment">-- &gt; {-# LANGUAGE StaticPointers #-}</span><span>
</span><span id="line-3031"></span><span class="hs-comment">-- &gt; module M where</span><span>
</span><span id="line-3032"></span><span class="hs-comment">-- &gt;</span><span>
</span><span id="line-3033"></span><span class="hs-comment">-- &gt; f x = static g</span><span>
</span><span id="line-3034"></span><span class="hs-comment">-- &gt;   where</span><span>
</span><span id="line-3035"></span><span class="hs-comment">-- &gt;     g = h</span><span>
</span><span id="line-3036"></span><span class="hs-comment">-- &gt;     h = x</span><span>
</span><span id="line-3037"></span><span class="hs-comment">--</span><span>
</span><span id="line-3038"></span><span class="hs-comment">-- produces the error</span><span>
</span><span id="line-3039"></span><span class="hs-comment">--</span><span>
</span><span id="line-3040"></span><span class="hs-comment">--    'g' is used in a static form but it is not closed because it</span><span>
</span><span id="line-3041"></span><span class="hs-comment">--    uses 'h' which uses 'x' which is not let-bound.</span><span>
</span><span id="line-3042"></span><span class="hs-comment">--</span><span>
</span><span id="line-3043"></span><span class="hs-comment">-- And a program like</span><span>
</span><span id="line-3044"></span><span class="hs-comment">--</span><span>
</span><span id="line-3045"></span><span class="hs-comment">-- &gt; {-# LANGUAGE StaticPointers #-}</span><span>
</span><span id="line-3046"></span><span class="hs-comment">-- &gt; module M where</span><span>
</span><span id="line-3047"></span><span class="hs-comment">-- &gt;</span><span>
</span><span id="line-3048"></span><span class="hs-comment">-- &gt; import Data.Typeable</span><span>
</span><span id="line-3049"></span><span class="hs-comment">-- &gt; import GHC.StaticPtr</span><span>
</span><span id="line-3050"></span><span class="hs-comment">-- &gt;</span><span>
</span><span id="line-3051"></span><span class="hs-comment">-- &gt; f :: Typeable a =&gt; a -&gt; StaticPtr TypeRep</span><span>
</span><span id="line-3052"></span><span class="hs-comment">-- &gt; f x = const (static (g undefined)) (h x)</span><span>
</span><span id="line-3053"></span><span class="hs-comment">-- &gt;   where</span><span>
</span><span id="line-3054"></span><span class="hs-comment">-- &gt;     g = h</span><span>
</span><span id="line-3055"></span><span class="hs-comment">-- &gt;     h = typeOf</span><span>
</span><span id="line-3056"></span><span class="hs-comment">--</span><span>
</span><span id="line-3057"></span><span class="hs-comment">-- produces the error</span><span>
</span><span id="line-3058"></span><span class="hs-comment">--</span><span>
</span><span id="line-3059"></span><span class="hs-comment">--    'g' is used in a static form but it is not closed because it</span><span>
</span><span id="line-3060"></span><span class="hs-comment">--    uses 'h' which has a non-closed type because it contains the</span><span>
</span><span id="line-3061"></span><span class="hs-comment">--    type variables: 'a'</span><span>
</span><span id="line-3062"></span><span class="hs-comment">--</span><span>
</span><span id="line-3063"></span><span>
</span><span id="line-3064"></span><span class="hs-comment">-- Note [Checking closedness]</span><span>
</span><span id="line-3065"></span><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><span id="line-3066"></span><span class="hs-comment">--</span><span>
</span><span id="line-3067"></span><span class="hs-comment">-- @checkClosed@ checks if a binding is closed and returns a reason if it is</span><span>
</span><span id="line-3068"></span><span class="hs-comment">-- not.</span><span>
</span><span id="line-3069"></span><span class="hs-comment">--</span><span>
</span><span id="line-3070"></span><span class="hs-comment">-- The bindings define a graph where the nodes are ids, and there is an edge</span><span>
</span><span id="line-3071"></span><span class="hs-comment">-- from @id1@ to @id2@ if the rhs of @id1@ contains @id2@ among its free</span><span>
</span><span id="line-3072"></span><span class="hs-comment">-- variables.</span><span>
</span><span id="line-3073"></span><span class="hs-comment">--</span><span>
</span><span id="line-3074"></span><span class="hs-comment">-- When @n@ is not closed, it has to exist in the graph some node reachable</span><span>
</span><span id="line-3075"></span><span class="hs-comment">-- from @n@ that it is not a let-bound variable or that it has a non-closed</span><span>
</span><span id="line-3076"></span><span class="hs-comment">-- type. Thus, the &quot;reason&quot; is a path from @n@ to this offending node.</span><span>
</span><span id="line-3077"></span><span class="hs-comment">--</span><span>
</span><span id="line-3078"></span><span class="hs-comment">-- When @n@ is not closed, we traverse the graph reachable from @n@ to build</span><span>
</span><span id="line-3079"></span><span class="hs-comment">-- the reason.</span><span>
</span><span id="line-3080"></span><span class="hs-comment">--</span><span>
</span><span id="line-3081"></span></pre></body></html>