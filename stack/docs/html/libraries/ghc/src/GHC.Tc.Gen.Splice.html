<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-
(c) The University of Glasgow 2006
(c) The GRASP/AQUA Project, Glasgow University, 1992-1998

-}</span><span>
</span><span id="line-6"></span><span>
</span><span id="line-7"></span><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><span id="line-8"></span><span class="hs-pragma">{-# LANGUAGE LambdaCase #-}</span><span>
</span><span id="line-9"></span><span class="hs-pragma">{-# LANGUAGE FlexibleInstances #-}</span><span>
</span><span id="line-10"></span><span class="hs-pragma">{-# LANGUAGE MagicHash #-}</span><span>
</span><span id="line-11"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-12"></span><span class="hs-pragma">{-# LANGUAGE InstanceSigs #-}</span><span>
</span><span id="line-13"></span><span class="hs-pragma">{-# LANGUAGE GADTs #-}</span><span>
</span><span id="line-14"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards #-}</span><span>
</span><span id="line-15"></span><span class="hs-pragma">{-# LANGUAGE MultiWayIf #-}</span><span>
</span><span id="line-16"></span><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><span id="line-17"></span><span class="hs-pragma">{-# LANGUAGE TupleSections #-}</span><span>
</span><span id="line-18"></span><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses #-}</span><span>
</span><span id="line-19"></span><span class="hs-pragma">{-# LANGUAGE FunctionalDependencies #-}</span><span>
</span><span id="line-20"></span><span class="hs-pragma">{-# OPTIONS_GHC -fno-warn-orphans #-}</span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-incomplete-uni-patterns #-}</span><span>
</span><span id="line-23"></span><span>
</span><span id="line-24"></span><span class="hs-comment">-- | Template Haskell splices</span><span>
</span><span id="line-25"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">GHC.Tc.Gen.Splice</span><span class="hs-special">(</span><span>
</span><span id="line-26"></span><span>     </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#tcSpliceExpr"><span class="hs-identifier">tcSpliceExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#tcTypedBracket"><span class="hs-identifier">tcTypedBracket</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#tcUntypedBracket"><span class="hs-identifier">tcUntypedBracket</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span class="hs-comment">--     runQuasiQuoteExpr, runQuasiQuotePat,</span><span>
</span><span id="line-28"></span><span class="hs-comment">--     runQuasiQuoteDecl, runQuasiQuoteType,</span><span>
</span><span id="line-29"></span><span>     </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#runAnnotation"><span class="hs-identifier">runAnnotation</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>
</span><span id="line-31"></span><span>     </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#runMetaE"><span class="hs-identifier">runMetaE</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#runMetaP"><span class="hs-identifier">runMetaP</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#runMetaT"><span class="hs-identifier">runMetaT</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#runMetaD"><span class="hs-identifier">runMetaD</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#runQuasi"><span class="hs-identifier">runQuasi</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-32"></span><span>     </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#tcTopSpliceExpr"><span class="hs-identifier">tcTopSpliceExpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#lookupThName_maybe"><span class="hs-identifier">lookupThName_maybe</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-33"></span><span>     </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#defaultRunMeta"><span class="hs-identifier">defaultRunMeta</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#runMeta%27"><span class="hs-identifier">runMeta'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#runRemoteModFinalizers"><span class="hs-identifier">runRemoteModFinalizers</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-34"></span><span>     </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#finishTH"><span class="hs-identifier">finishTH</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#runTopSplice"><span class="hs-identifier">runTopSplice</span></a></span><span>
</span><span id="line-35"></span><span>      </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span class="hs-cpp">

#include &quot;HsVersions.h&quot;
</span><span>
</span><span id="line-39"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-40"></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Hs.html"><span class="hs-identifier">GHC.Hs</span></a></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Annotations.html"><span class="hs-identifier">GHC.Types.Annotations</span></a></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Finder.html"><span class="hs-identifier">GHC.Driver.Finder</span></a></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.html"><span class="hs-identifier">GHC.Types.Name</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html"><span class="hs-identifier">GHC.Tc.Utils.Monad</span></a></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html"><span class="hs-identifier">GHC.Tc.Utils.TcType</span></a></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Multiplicity.html"><span class="hs-identifier">GHC.Core.Multiplicity</span></a></span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Expr.html"><span class="hs-identifier">GHC.Tc.Gen.Expr</span></a></span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html"><span class="hs-identifier">GHC.Types.SrcLoc</span></a></span><span>
</span><span id="line-52"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.TH.html"><span class="hs-identifier">GHC.Builtin.Names.TH</span></a></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Unify.html"><span class="hs-identifier">GHC.Tc.Utils.Unify</span></a></span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Env.html"><span class="hs-identifier">GHC.Tc.Utils.Env</span></a></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Origin.html"><span class="hs-identifier">GHC.Tc.Types.Origin</span></a></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html"><span class="hs-identifier">GHC.Core.Coercion</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.html#etaExpandCoAxBranch"><span class="hs-identifier">etaExpandCoAxBranch</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.SysTools.FileCleanup.html"><span class="hs-identifier">GHC.SysTools.FileCleanup</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.SysTools.FileCleanup.html#newTempName"><span class="hs-identifier">newTempName</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.SysTools.FileCleanup.html#TempFileLifetime"><span class="hs-identifier">TempFileLifetime</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-58"></span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base/src/Control.Monad.html#"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-60"></span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../ghci/src/GHCi.Message.html#"><span class="hs-identifier">GHCi.Message</span></a></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../ghci/src/GHCi.RemoteTypes.html#"><span class="hs-identifier">GHCi.RemoteTypes</span></a></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.html"><span class="hs-identifier">GHC.Runtime.Interpreter</span></a></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html"><span class="hs-identifier">GHC.Runtime.Interpreter.Types</span></a></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html"><span class="hs-identifier">GHC.Driver.Main</span></a></span><span>
</span><span id="line-66"></span><span>        </span><span class="hs-comment">-- These imports are the reason that GHC.Tc.Gen.Splice</span><span>
</span><span id="line-67"></span><span>        </span><span class="hs-comment">-- is very high up the module hierarchy</span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.Splice.html"><span class="hs-identifier">GHC.Rename.Splice</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Rename.Splice.html#traceSplice"><span class="hs-identifier">traceSplice</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Rename.Splice.html#SpliceInfo"><span class="hs-identifier">SpliceInfo</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html"><span class="hs-identifier">GHC.Types.Name.Reader</span></a></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html"><span class="hs-identifier">GHC.Driver.Types</span></a></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.ThToHs.html"><span class="hs-identifier">GHC.ThToHs</span></a></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.Expr.html"><span class="hs-identifier">GHC.Rename.Expr</span></a></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.Env.html"><span class="hs-identifier">GHC.Rename.Env</span></a></span><span>
</span><span id="line-74"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.Utils.html"><span class="hs-identifier">GHC.Rename.Utils</span></a></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Rename.Utils.html#HsDocContext"><span class="hs-identifier">HsDocContext</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-75"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.Fixity.html"><span class="hs-identifier">GHC.Rename.Fixity</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Rename.Fixity.html#lookupFixityRn_help"><span class="hs-identifier">lookupFixityRn_help</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Rename.HsType.html"><span class="hs-identifier">GHC.Rename.HsType</span></a></span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Zonk.html"><span class="hs-identifier">GHC.Tc.Utils.Zonk</span></a></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Solver.html"><span class="hs-identifier">GHC.Tc.Solver</span></a></span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Type.html"><span class="hs-identifier">GHC.Core.Type</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Type</span></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Set.html"><span class="hs-identifier">GHC.Types.Name.Set</span></a></span><span>
</span><span id="line-81"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcMType.html"><span class="hs-identifier">GHC.Tc.Utils.TcMType</span></a></span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.HsType.html"><span class="hs-identifier">GHC.Tc.Gen.HsType</span></a></span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.IfaceToCore.html"><span class="hs-identifier">GHC.IfaceToCore</span></a></span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html"><span class="hs-identifier">GHC.Core.TyCo.Rep</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TyCoRep</span></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Instance.Family.html"><span class="hs-identifier">GHC.Tc.Instance.Family</span></a></span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html"><span class="hs-identifier">GHC.Core.FamInstEnv</span></a></span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html"><span class="hs-identifier">GHC.Core.InstEnv</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">InstEnv</span></span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Instantiate.html"><span class="hs-identifier">GHC.Tc.Utils.Instantiate</span></a></span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Env.html"><span class="hs-identifier">GHC.Types.Name.Env</span></a></span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Names.html"><span class="hs-identifier">GHC.Builtin.Names</span></a></span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Builtin.Types.html"><span class="hs-identifier">GHC.Builtin.Types</span></a></span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Occurrence.html"><span class="hs-identifier">GHC.Types.Name.Occurrence</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">OccName</span></span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Hooks.html"><span class="hs-identifier">GHC.Driver.Hooks</span></a></span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.html"><span class="hs-identifier">GHC.Types.Var</span></a></span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.html"><span class="hs-identifier">GHC.Unit.Module</span></a></span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Iface.Load.html"><span class="hs-identifier">GHC.Iface.Load</span></a></span><span>
</span><span id="line-97"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Class.html"><span class="hs-identifier">GHC.Core.Class</span></a></span><span>
</span><span id="line-98"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html"><span class="hs-identifier">GHC.Core.TyCon</span></a></span><span>
</span><span id="line-99"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html"><span class="hs-identifier">GHC.Core.Coercion.Axiom</span></a></span><span>
</span><span id="line-100"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.PatSyn.html"><span class="hs-identifier">GHC.Core.PatSyn</span></a></span><span>
</span><span id="line-101"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.ConLike.html"><span class="hs-identifier">GHC.Core.ConLike</span></a></span><span>
</span><span id="line-102"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html"><span class="hs-identifier">GHC.Core.DataCon</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">DataCon</span></span><span>
</span><span id="line-103"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html"><span class="hs-identifier">GHC.Tc.Types.Evidence</span></a></span><span>
</span><span id="line-104"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.html"><span class="hs-identifier">GHC.Types.Id</span></a></span><span>
</span><span id="line-105"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Id.Info.html"><span class="hs-identifier">GHC.Types.Id.Info</span></a></span><span>
</span><span id="line-106"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.HsToCore.Expr.html"><span class="hs-identifier">GHC.HsToCore.Expr</span></a></span><span>
</span><span id="line-107"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.HsToCore.Monad.html"><span class="hs-identifier">GHC.HsToCore.Monad</span></a></span><span>
</span><span id="line-108"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../ghc-boot/src/GHC.Serialized.html#"><span class="hs-identifier">GHC.Serialized</span></a></span><span>
</span><span id="line-109"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html"><span class="hs-identifier">GHC.Utils.Error</span></a></span><span>
</span><span id="line-110"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-111"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.html"><span class="hs-identifier">GHC.Types.Unique</span></a></span><span>
</span><span id="line-112"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Var.Set.html"><span class="hs-identifier">GHC.Types.Var.Set</span></a></span><span>
</span><span id="line-113"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base/src/Data.List.html#"><span class="hs-identifier">Data.List</span></a></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../base/src/Data.Foldable.html#find"><span class="hs-identifier">find</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-114"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base/src/Data.Maybe.html#"><span class="hs-identifier">Data.Maybe</span></a></span><span>
</span><span id="line-115"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html"><span class="hs-identifier">GHC.Data.FastString</span></a></span><span>
</span><span id="line-116"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html"><span class="hs-identifier">GHC.Types.Basic</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">BasicTypes</span></span><span> </span><span class="hs-keyword">hiding</span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#SuccessFlag"><span class="hs-identifier">SuccessFlag</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-117"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html"><span class="hs-identifier">GHC.Data.Maybe</span></a></span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html#MaybeErr"><span class="hs-identifier">MaybeErr</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-118"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html"><span class="hs-identifier">GHC.Driver.Session</span></a></span><span>
</span><span id="line-119"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Panic</span></span><span>
</span><span id="line-120"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Lexeme.html"><span class="hs-identifier">GHC.Utils.Lexeme</span></a></span><span>
</span><span id="line-121"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.Data.EnumSet.html"><span class="hs-identifier">GHC.Data.EnumSet</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">EnumSet</span></span><span>
</span><span id="line-122"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Plugins.html"><span class="hs-identifier">GHC.Driver.Plugins</span></a></span><span>
</span><span id="line-123"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html"><span class="hs-identifier">GHC.Data.Bag</span></a></span><span>
</span><span id="line-124"></span><span>
</span><span id="line-125"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.html#"><span class="hs-identifier">Language.Haskell.TH</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TH</span></span><span>
</span><span id="line-126"></span><span class="hs-comment">-- THSyntax gives access to internal functions and data types</span><span>
</span><span id="line-127"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#"><span class="hs-identifier">Language.Haskell.TH.Syntax</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">TH</span></span><span class="hs-cpp">

#if defined(HAVE_INTERNAL_INTERPRETER)
</span><span class="hs-comment">-- Because GHC.Desugar might not be in the base library of the bootstrapping compiler</span><span>
</span><span id="line-131"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base/src/GHC.Desugar.html#"><span class="hs-identifier">GHC.Desugar</span></a></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../base/src/GHC.Desugar.html#AnnotationWrapper"><span class="hs-identifier">AnnotationWrapper</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-132"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base/src/Unsafe.Coerce.html#"><span class="hs-identifier">Unsafe.Coerce</span></a></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../base/src/Unsafe.Coerce.html#unsafeCoerce"><span class="hs-identifier">unsafeCoerce</span></a></span><span> </span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-135"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base/src/Control.Exception.html#"><span class="hs-identifier">Control.Exception</span></a></span><span>
</span><span id="line-136"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../binary/src/Data.Binary.html#"><span class="hs-identifier">Data.Binary</span></a></span><span>
</span><span id="line-137"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../binary/src/Data.Binary.Get.html#"><span class="hs-identifier">Data.Binary.Get</span></a></span><span>
</span><span id="line-138"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../bytestring/src/Data.ByteString.html#"><span class="hs-identifier">Data.ByteString</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">B</span></span><span>
</span><span id="line-139"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../bytestring/src/Data.ByteString.Lazy.html#"><span class="hs-identifier">Data.ByteString.Lazy</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LB</span></span><span>
</span><span id="line-140"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base/src/Data.Dynamic.html#"><span class="hs-identifier">Data.Dynamic</span></a></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../base/src/Data.Dynamic.html#fromDynamic"><span class="hs-identifier">fromDynamic</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base/src/Data.Dynamic.html#toDyn"><span class="hs-identifier">toDyn</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-141"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../containers/src/Data.Map.html#"><span class="hs-identifier">Data.Map</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-142"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base/src/Data.Typeable.html#"><span class="hs-identifier">Data.Typeable</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../base/src/Data.Typeable.html#typeOf"><span class="hs-identifier">typeOf</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base/src/Data.Typeable.Internal.html#Typeable"><span class="hs-identifier">Typeable</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base/src/Data.Typeable.html#TypeRep"><span class="hs-identifier">TypeRep</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base/src/Data.Typeable.html#typeRep"><span class="hs-identifier">typeRep</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-143"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base/src/Data.Data.html#"><span class="hs-identifier">Data.Data</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/Data.Data.html#Data"><span class="hs-identifier">Data</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-144"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base/src/Data.Proxy.html#"><span class="hs-identifier">Data.Proxy</span></a></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../base/src/Data.Proxy.html#Proxy"><span class="hs-identifier">Proxy</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-145"></span><span>
</span><span id="line-146"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Main interface + stubs for the non-GHCI case
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-153"></span><span>
</span><span id="line-154"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#tcTypedBracket"><span class="hs-identifier hs-type">tcTypedBracket</span></a></span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsBracket"><span class="hs-identifier hs-type">HsBracket</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-155"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#tcUntypedBracket"><span class="hs-identifier hs-type">tcUntypedBracket</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsBracket"><span class="hs-identifier hs-type">HsBracket</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Hs.Expr.html#PendingRnSplice"><span class="hs-identifier hs-type">PendingRnSplice</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span>
</span><span id="line-156"></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-157"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#tcSpliceExpr"><span class="hs-identifier hs-type">tcSpliceExpr</span></a></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsSplice"><span class="hs-identifier hs-type">HsSplice</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span>        </span><span class="hs-comment">-- None of these functions add constraints to the LIE</span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span class="hs-comment">-- runQuasiQuoteExpr :: HsQuasiQuote RdrName -&gt; RnM (LHsExpr RdrName)</span><span>
</span><span id="line-161"></span><span class="hs-comment">-- runQuasiQuotePat  :: HsQuasiQuote RdrName -&gt; RnM (LPat RdrName)</span><span>
</span><span id="line-162"></span><span class="hs-comment">-- runQuasiQuoteType :: HsQuasiQuote RdrName -&gt; RnM (LHsType RdrName)</span><span>
</span><span id="line-163"></span><span class="hs-comment">-- runQuasiQuoteDecl :: HsQuasiQuote RdrName -&gt; RnM [LHsDecl RdrName]</span><span>
</span><span id="line-164"></span><span>
</span><span id="line-165"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#runAnnotation"><span class="hs-identifier hs-type">runAnnotation</span></a></span><span>     </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Annotations.html#CoreAnnTarget"><span class="hs-identifier hs-type">CoreAnnTarget</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Annotations.html#Annotation"><span class="hs-identifier hs-type">Annotation</span></a></span><span>
</span><span id="line-166"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Quoting an expression}
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-173"></span><span>
</span><span id="line-174"></span><span class="hs-comment">-- See Note [How brackets and nested splices are handled]</span><span>
</span><span id="line-175"></span><span class="hs-comment">-- tcTypedBracket :: HsBracket Name -&gt; TcRhoType -&gt; TcM (HsExpr TcId)</span><span>
</span><span id="line-176"></span><span id="tcTypedBracket"><span class="annot"><span class="annottext">tcTypedBracket :: HsExpr GhcRn -&gt; HsBracket GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Splice.html#tcTypedBracket"><span class="hs-identifier hs-var hs-var">tcTypedBracket</span></a></span></span><span> </span><span id="local-6989586621681125734"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681125734"><span class="hs-identifier hs-var">rn_expr</span></a></span></span><span> </span><span id="local-6989586621681125733"><span class="annot"><span class="annottext">brack :: HsBracket GhcRn
</span><a href="#local-6989586621681125733"><span class="hs-identifier hs-var">brack</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#TExpBr"><span class="hs-identifier hs-type">TExpBr</span></a></span><span> </span><span class="annot"><span class="annottext">XTExpBr GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681125731"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681125731"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681125730"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681125730"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-177"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MsgDoc -&gt; TcM (HsExpr GhcTc) -&gt; TcM (HsExpr GhcTc)
forall a. MsgDoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsBracket GhcRn -&gt; MsgDoc
</span><a href="GHC.Tc.Gen.Splice.html#quotationCtxtDoc"><span class="hs-identifier hs-var">quotationCtxtDoc</span></a></span><span> </span><span class="annot"><span class="annottext">HsBracket GhcRn
</span><a href="#local-6989586621681125733"><span class="hs-identifier hs-var">brack</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM (HsExpr GhcTc) -&gt; TcM (HsExpr GhcTc))
-&gt; TcM (HsExpr GhcTc) -&gt; TcM (HsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-178"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681125727"><span class="annot"><span class="annottext">ThStage
</span><a href="#local-6989586621681125727"><span class="hs-identifier hs-var">cur_stage</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM ThStage
</span><a href="GHC.Tc.Utils.Monad.html#getStage"><span class="hs-identifier hs-var">getStage</span></a></span><span>
</span><span id="line-179"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681125725"><span class="annot"><span class="annottext">IORef [PendingTcSplice]
</span><a href="#local-6989586621681125725"><span class="hs-identifier hs-var">ps_ref</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[PendingTcSplice]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (IORef [PendingTcSplice])
forall a env. a -&gt; IOEnv env (IORef a)
</span><a href="GHC.Data.IOEnv.html#newMutVar"><span class="hs-identifier hs-var">newMutVar</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-180"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681125723"><span class="annot"><span class="annottext">TcRef WantedConstraints
</span><a href="#local-6989586621681125723"><span class="hs-identifier hs-var">lie_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM (TcRef WantedConstraints)
</span><a href="GHC.Tc.Utils.Monad.html#getConstraintVar"><span class="hs-identifier hs-var">getConstraintVar</span></a></span><span>   </span><span class="hs-comment">-- Any constraints arising from nested splices</span><span>
</span><span id="line-181"></span><span>                                       </span><span class="hs-comment">-- should get thrown into the constraint set</span><span>
</span><span id="line-182"></span><span>                                       </span><span class="hs-comment">-- from outside the bracket</span><span>
</span><span id="line-183"></span><span>
</span><span id="line-184"></span><span>       </span><span class="hs-comment">-- Make a new type variable for the type of the overall quote</span><span>
</span><span id="line-185"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681125721"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681125721"><span class="hs-identifier hs-var">m_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">(Id -&gt; Type)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) Id
-&gt; IOEnv (Env TcGblEnv TcLclEnv) Type
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) Id
</span><a href="GHC.Tc.Gen.Splice.html#mkMetaTyVar"><span class="hs-identifier hs-var">mkMetaTyVar</span></a></span><span>
</span><span id="line-186"></span><span>       </span><span class="hs-comment">-- Make sure the type variable satisfies Quote</span><span>
</span><span id="line-187"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681125717"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681125717"><span class="hs-identifier hs-var">ev_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) Id
</span><a href="GHC.Tc.Gen.Splice.html#emitQuoteWanted"><span class="hs-identifier hs-var">emitQuoteWanted</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681125721"><span class="hs-identifier hs-var">m_var</span></a></span><span>
</span><span id="line-188"></span><span>       </span><span class="hs-comment">-- Bundle them together so they can be used in GHC.HsToCore.Quote for desugaring</span><span>
</span><span id="line-189"></span><span>       </span><span class="hs-comment">-- brackets.</span><span>
</span><span id="line-190"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681125715"><span class="annot"><span class="annottext">wrapper :: QuoteWrapper
</span><a href="#local-6989586621681125715"><span class="hs-identifier hs-var hs-var">wrapper</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Type -&gt; QuoteWrapper
</span><a href="GHC.Tc.Types.Evidence.html#QuoteWrapper"><span class="hs-identifier hs-var">QuoteWrapper</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681125717"><span class="hs-identifier hs-var">ev_var</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681125721"><span class="hs-identifier hs-var">m_var</span></a></span><span>
</span><span id="line-191"></span><span>       </span><span class="hs-comment">-- Typecheck expr to make sure it is valid,</span><span>
</span><span id="line-192"></span><span>       </span><span class="hs-comment">-- Throw away the typechecked expression but return its type.</span><span>
</span><span id="line-193"></span><span>       </span><span class="hs-comment">-- We'll typecheck it again when we splice it in somewhere</span><span>
</span><span id="line-194"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681125713"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681125713"><span class="hs-identifier hs-var">_tc_expr</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681125712"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681125712"><span class="hs-identifier hs-var">expr_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ThStage -&gt; TcM (LHsExpr GhcTc, Type) -&gt; TcM (LHsExpr GhcTc, Type)
forall a. ThStage -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#setStage"><span class="hs-identifier hs-var">setStage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ThStage -&gt; PendingStuff -&gt; ThStage
</span><a href="GHC.Tc.Types.html#Brack"><span class="hs-identifier hs-var">Brack</span></a></span><span> </span><span class="annot"><span class="annottext">ThStage
</span><a href="#local-6989586621681125727"><span class="hs-identifier hs-var">cur_stage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IORef [PendingTcSplice]
-&gt; TcRef WantedConstraints -&gt; QuoteWrapper -&gt; PendingStuff
</span><a href="GHC.Tc.Types.html#TcPending"><span class="hs-identifier hs-var">TcPending</span></a></span><span> </span><span class="annot"><span class="annottext">IORef [PendingTcSplice]
</span><a href="#local-6989586621681125725"><span class="hs-identifier hs-var">ps_ref</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef WantedConstraints
</span><a href="#local-6989586621681125723"><span class="hs-identifier hs-var">lie_var</span></a></span><span> </span><span class="annot"><span class="annottext">QuoteWrapper
</span><a href="#local-6989586621681125715"><span class="hs-identifier hs-var">wrapper</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc, Type) -&gt; TcM (LHsExpr GhcTc, Type))
-&gt; TcM (LHsExpr GhcTc, Type) -&gt; TcM (LHsExpr GhcTc, Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-195"></span><span>                                </span><span class="annot"><span class="annottext">Type -&gt; TcM (LHsExpr GhcTc, Type) -&gt; TcM (LHsExpr GhcTc, Type)
forall a. Type -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-var">tcScalingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Core.Type.html#Many"><span class="hs-identifier hs-var">Many</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc, Type) -&gt; TcM (LHsExpr GhcTc, Type))
-&gt; TcM (LHsExpr GhcTc, Type) -&gt; TcM (LHsExpr GhcTc, Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-196"></span><span>                                </span><span class="hs-comment">-- Scale by Many, TH lifting is currently nonlinear (#18465)</span><span>
</span><span id="line-197"></span><span>                                </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; TcM (LHsExpr GhcTc, Type)
</span><a href="GHC.Tc.Gen.Expr.html#tcInferRhoNC"><span class="hs-identifier hs-var">tcInferRhoNC</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681125731"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-198"></span><span>                                </span><span class="hs-comment">-- NC for no context; tcBracket does that</span><span>
</span><span id="line-199"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681125705"><span class="annot"><span class="annottext">rep :: Type
</span><a href="#local-6989586621681125705"><span class="hs-identifier hs-var hs-var">rep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
Type -&gt; Type
</span><a href="GHC.Core.Type.html#getRuntimeRep"><span class="hs-identifier hs-var">getRuntimeRep</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681125712"><span class="hs-identifier hs-var">expr_ty</span></a></span><span>
</span><span id="line-200"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681125703"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681125703"><span class="hs-identifier hs-var">meta_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) Type
</span><a href="GHC.Tc.Gen.Splice.html#tcTExpTy"><span class="hs-identifier hs-var">tcTExpTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681125721"><span class="hs-identifier hs-var">m_var</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681125712"><span class="hs-identifier hs-var">expr_ty</span></a></span><span>
</span><span id="line-201"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681125701"><span class="annot"><span class="annottext">[PendingTcSplice]
</span><a href="#local-6989586621681125701"><span class="hs-identifier hs-var">ps'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef [PendingTcSplice]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [PendingTcSplice]
forall a env. IORef a -&gt; IOEnv env a
</span><a href="GHC.Data.IOEnv.html#readMutVar"><span class="hs-identifier hs-var">readMutVar</span></a></span><span> </span><span class="annot"><span class="annottext">IORef [PendingTcSplice]
</span><a href="#local-6989586621681125725"><span class="hs-identifier hs-var">ps_ref</span></a></span><span>
</span><span id="line-202"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681125699"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681125699"><span class="hs-identifier hs-var">texpco</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) Id
</span><a href="GHC.Tc.Utils.Env.html#tcLookupId"><span class="hs-identifier hs-var">tcLookupId</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.TH.html#unsafeCodeCoerceName"><span class="hs-identifier hs-var">unsafeCodeCoerceName</span></a></span><span>
</span><span id="line-203"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">CtOrigin
-&gt; HsExpr GhcRn
-&gt; HsExpr GhcTc
-&gt; Type
-&gt; ExpRhoType
-&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Utils.Unify.html#tcWrapResultO"><span class="hs-identifier hs-var">tcWrapResultO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#Shouldn%27tHappenOrigin"><span class="hs-identifier hs-var">Shouldn'tHappenOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;TExpBr&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-204"></span><span>                       </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681125734"><span class="hs-identifier hs-var">rn_expr</span></a></span><span>
</span><span id="line-205"></span><span>                       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsExpr GhcTc -&gt; HsExpr GhcTc
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsExpr GhcTc -&gt; LHsExpr GhcTc -&gt; LHsExpr GhcTc
forall (id :: Pass).
LHsExpr (GhcPass id)
-&gt; LHsExpr (GhcPass id) -&gt; LHsExpr (GhcPass id)
</span><a href="GHC.Hs.Utils.html#mkHsApp"><span class="hs-identifier hs-var">mkHsApp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper -&gt; LHsExpr GhcTc -&gt; LHsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkLHsWrap"><span class="hs-identifier hs-var">mkLHsWrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QuoteWrapper -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#applyQuoteWrapper"><span class="hs-identifier hs-var">applyQuoteWrapper</span></a></span><span> </span><span class="annot"><span class="annottext">QuoteWrapper
</span><a href="#local-6989586621681125715"><span class="hs-identifier hs-var">wrapper</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-206"></span><span>                                                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; [Type] -&gt; LHsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#nlHsTyApp"><span class="hs-identifier hs-var">nlHsTyApp</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681125699"><span class="hs-identifier hs-var">texpco</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681125705"><span class="hs-identifier hs-var">rep</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681125712"><span class="hs-identifier hs-var">expr_ty</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-207"></span><span>                                      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; LHsExpr GhcTc
forall e. e -&gt; Located e
</span><a href="GHC.Types.SrcLoc.html#noLoc"><span class="hs-identifier hs-var">noLoc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XTcBracketOut GhcTc
-&gt; Maybe QuoteWrapper
-&gt; HsBracket GhcRn
-&gt; [PendingTcSplice]
-&gt; HsExpr GhcTc
forall p.
XTcBracketOut p
-&gt; Maybe QuoteWrapper
-&gt; HsBracket GhcRn
-&gt; [PendingTcSplice]
-&gt; HsExpr p
</span><a href="GHC.Hs.Expr.html#HsTcBracketOut"><span class="hs-identifier hs-var">HsTcBracketOut</span></a></span><span> </span><span class="annot"><span class="annottext">NoExtField
XTcBracketOut GhcTc
</span><a href="GHC.Hs.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QuoteWrapper -&gt; Maybe QuoteWrapper
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">QuoteWrapper
</span><a href="#local-6989586621681125715"><span class="hs-identifier hs-var">wrapper</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HsBracket GhcRn
</span><a href="#local-6989586621681125733"><span class="hs-identifier hs-var">brack</span></a></span><span> </span><span class="annot"><span class="annottext">[PendingTcSplice]
</span><a href="#local-6989586621681125701"><span class="hs-identifier hs-var">ps'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-208"></span><span>                       </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681125703"><span class="hs-identifier hs-var">meta_ty</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681125730"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-209"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#tcTypedBracket"><span class="hs-identifier hs-var">tcTypedBracket</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681125686"><span class="annot"><span class="annottext">HsBracket GhcRn
</span><a href="#local-6989586621681125686"><span class="hs-identifier hs-var">other_brack</span></a></span></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-210"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; MsgDoc -&gt; TcM (HsExpr GhcTc)
forall a. HasCallStack =&gt; String -&gt; MsgDoc -&gt; a
</span><a href="GHC.Utils.Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcTypedBracket&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsBracket GhcRn -&gt; MsgDoc
forall a. Outputable a =&gt; a -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsBracket GhcRn
</span><a href="#local-6989586621681125686"><span class="hs-identifier hs-var">other_brack</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-211"></span><span>
</span><span id="line-212"></span><span class="hs-comment">-- tcUntypedBracket :: HsBracket Name -&gt; [PendingRnSplice] -&gt; ExpRhoType -&gt; TcM (HsExpr TcId)</span><span>
</span><span id="line-213"></span><span class="hs-comment">-- See Note [Typechecking Overloaded Quotes]</span><span>
</span><span id="line-214"></span><span id="tcUntypedBracket"><span class="annot"><span class="annottext">tcUntypedBracket :: HsExpr GhcRn
-&gt; HsBracket GhcRn
-&gt; [PendingRnSplice]
-&gt; ExpRhoType
-&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Splice.html#tcUntypedBracket"><span class="hs-identifier hs-var hs-var">tcUntypedBracket</span></a></span></span><span> </span><span id="local-6989586621681125683"><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681125683"><span class="hs-identifier hs-var">rn_expr</span></a></span></span><span> </span><span id="local-6989586621681125682"><span class="annot"><span class="annottext">HsBracket GhcRn
</span><a href="#local-6989586621681125682"><span class="hs-identifier hs-var">brack</span></a></span></span><span> </span><span id="local-6989586621681125681"><span class="annot"><span class="annottext">[PendingRnSplice]
</span><a href="#local-6989586621681125681"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span id="local-6989586621681125680"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681125680"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-215"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; MsgDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc_bracket untyped&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsBracket GhcRn -&gt; MsgDoc
forall a. Outputable a =&gt; a -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsBracket GhcRn
</span><a href="#local-6989586621681125682"><span class="hs-identifier hs-var">brack</span></a></span><span> </span><span class="annot"><span class="annottext">MsgDoc -&gt; MsgDoc -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">[PendingRnSplice] -&gt; MsgDoc
forall a. Outputable a =&gt; a -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[PendingRnSplice]
</span><a href="#local-6989586621681125681"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-216"></span><span>
</span><span id="line-217"></span><span>
</span><span id="line-218"></span><span>       </span><span class="hs-comment">-- Create the type m Exp for expression bracket, m Type for a type</span><span>
</span><span id="line-219"></span><span>       </span><span class="hs-comment">-- bracket and so on. The brack_info is a Maybe because the</span><span>
</span><span id="line-220"></span><span>       </span><span class="hs-comment">-- VarBracket ('a) isn't overloaded, but also shouldn't contain any</span><span>
</span><span id="line-221"></span><span>       </span><span class="hs-comment">-- splices.</span><span>
</span><span id="line-222"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681125677"><span class="annot"><span class="annottext">Maybe QuoteWrapper
</span><a href="#local-6989586621681125677"><span class="hs-identifier hs-var">brack_info</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681125676"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681125676"><span class="hs-identifier hs-var">expected_type</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsBracket GhcRn -&gt; TcM (Maybe QuoteWrapper, Type)
</span><a href="GHC.Tc.Gen.Splice.html#brackTy"><span class="hs-identifier hs-var">brackTy</span></a></span><span> </span><span class="annot"><span class="annottext">HsBracket GhcRn
</span><a href="#local-6989586621681125682"><span class="hs-identifier hs-var">brack</span></a></span><span>
</span><span id="line-223"></span><span>
</span><span id="line-224"></span><span>       </span><span class="hs-comment">-- Match the expected type with the type of all the internal</span><span>
</span><span id="line-225"></span><span>       </span><span class="hs-comment">-- splices. They might have further constrained types and if they do</span><span>
</span><span id="line-226"></span><span>       </span><span class="hs-comment">-- we want to reflect that in the overall type of the bracket.</span><span>
</span><span id="line-227"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681125674"><span class="annot"><span class="annottext">[PendingTcSplice]
</span><a href="#local-6989586621681125674"><span class="hs-identifier hs-var">ps'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">QuoteWrapper -&gt; Type
</span><a href="GHC.Tc.Types.Evidence.html#quoteWrapperTyVarTy"><span class="hs-identifier hs-var">quoteWrapperTyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">(QuoteWrapper -&gt; Type) -&gt; Maybe QuoteWrapper -&gt; DFunInstType
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe QuoteWrapper
</span><a href="#local-6989586621681125677"><span class="hs-identifier hs-var">brack_info</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-228"></span><span>                  </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681125672"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681125672"><span class="hs-identifier hs-var">m_var</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(PendingRnSplice -&gt; IOEnv (Env TcGblEnv TcLclEnv) PendingTcSplice)
-&gt; [PendingRnSplice]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [PendingTcSplice]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
-&gt; PendingRnSplice -&gt; IOEnv (Env TcGblEnv TcLclEnv) PendingTcSplice
</span><a href="GHC.Tc.Gen.Splice.html#tcPendingSplice"><span class="hs-identifier hs-var">tcPendingSplice</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681125672"><span class="hs-identifier hs-var">m_var</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PendingRnSplice]
</span><a href="#local-6989586621681125681"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-229"></span><span>                  </span><span class="annot"><span class="annottext">DFunInstType
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span class="hs-identifier">null</span><span> </span><span class="hs-identifier">ps</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-230"></span><span>
</span><span id="line-231"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; MsgDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc_bracket done untyped&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; MsgDoc
forall a. Outputable a =&gt; a -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681125676"><span class="hs-identifier hs-var">expected_type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-232"></span><span>
</span><span id="line-233"></span><span>       </span><span class="hs-comment">-- Unify the overall type of the bracket with the expected result</span><span>
</span><span id="line-234"></span><span>       </span><span class="hs-comment">-- type</span><span>
</span><span id="line-235"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">CtOrigin
-&gt; HsExpr GhcRn
-&gt; HsExpr GhcTc
-&gt; Type
-&gt; ExpRhoType
-&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Utils.Unify.html#tcWrapResultO"><span class="hs-identifier hs-var">tcWrapResultO</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#BracketOrigin"><span class="hs-identifier hs-var">BracketOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">HsExpr GhcRn
</span><a href="#local-6989586621681125683"><span class="hs-identifier hs-var">rn_expr</span></a></span><span>
</span><span id="line-236"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XTcBracketOut GhcTc
-&gt; Maybe QuoteWrapper
-&gt; HsBracket GhcRn
-&gt; [PendingTcSplice]
-&gt; HsExpr GhcTc
forall p.
XTcBracketOut p
-&gt; Maybe QuoteWrapper
-&gt; HsBracket GhcRn
-&gt; [PendingTcSplice]
-&gt; HsExpr p
</span><a href="GHC.Hs.Expr.html#HsTcBracketOut"><span class="hs-identifier hs-var">HsTcBracketOut</span></a></span><span> </span><span class="annot"><span class="annottext">NoExtField
XTcBracketOut GhcTc
</span><a href="GHC.Hs.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe QuoteWrapper
</span><a href="#local-6989586621681125677"><span class="hs-identifier hs-var">brack_info</span></a></span><span> </span><span class="annot"><span class="annottext">HsBracket GhcRn
</span><a href="#local-6989586621681125682"><span class="hs-identifier hs-var">brack</span></a></span><span> </span><span class="annot"><span class="annottext">[PendingTcSplice]
</span><a href="#local-6989586621681125674"><span class="hs-identifier hs-var">ps'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-237"></span><span>            </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681125676"><span class="hs-identifier hs-var">expected_type</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681125680"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-238"></span><span>
</span><span id="line-239"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-240"></span><span>
</span><span id="line-241"></span><span class="hs-comment">-- | A type variable with kind * -&gt; * named &quot;m&quot;</span><span>
</span><span id="line-242"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#mkMetaTyVar"><span class="hs-identifier hs-type">mkMetaTyVar</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span>
</span><span id="line-243"></span><span id="mkMetaTyVar"><span class="annot"><span class="annottext">mkMetaTyVar :: IOEnv (Env TcGblEnv TcLclEnv) Id
</span><a href="GHC.Tc.Gen.Splice.html#mkMetaTyVar"><span class="hs-identifier hs-var hs-var">mkMetaTyVar</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-244"></span><span>  </span><span class="annot"><span class="annottext">FastString -&gt; Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) Id
</span><a href="GHC.Tc.Utils.TcMType.html#newNamedFlexiTyVar"><span class="hs-identifier hs-var">newNamedFlexiTyVar</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;m&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkVisFunTyMany"><span class="hs-identifier hs-var">mkVisFunTyMany</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Builtin.Types.html#liftedTypeKind"><span class="hs-identifier hs-var">liftedTypeKind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-245"></span><span>
</span><span id="line-246"></span><span>
</span><span id="line-247"></span><span class="hs-comment">-- | For a type 'm', emit the constraint 'Quote m'.</span><span>
</span><span id="line-248"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#emitQuoteWanted"><span class="hs-identifier hs-type">emitQuoteWanted</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#EvVar"><span class="hs-identifier hs-type">EvVar</span></a></span><span>
</span><span id="line-249"></span><span id="emitQuoteWanted"><span class="annot"><span class="annottext">emitQuoteWanted :: Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) Id
</span><a href="GHC.Tc.Gen.Splice.html#emitQuoteWanted"><span class="hs-identifier hs-var hs-var">emitQuoteWanted</span></a></span></span><span> </span><span id="local-6989586621681125657"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681125657"><span class="hs-identifier hs-var">m_var</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-keyword">do</span><span>
</span><span id="line-250"></span><span>        </span><span id="local-6989586621681125656"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681125656"><span class="hs-identifier hs-var">quote_con</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM TyCon
</span><a href="GHC.Tc.Utils.Env.html#tcLookupTyCon"><span class="hs-identifier hs-var">tcLookupTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.TH.html#quoteClassName"><span class="hs-identifier hs-var">quoteClassName</span></a></span><span>
</span><span id="line-251"></span><span>        </span><span class="annot"><span class="annottext">CtOrigin -&gt; Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) Id
</span><a href="GHC.Tc.Utils.TcMType.html#emitWantedEvVar"><span class="hs-identifier hs-var">emitWantedEvVar</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#BracketOrigin"><span class="hs-identifier hs-var">BracketOrigin</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) Id)
-&gt; Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) Id
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-252"></span><span>          </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681125656"><span class="hs-identifier hs-var">quote_con</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681125657"><span class="hs-identifier hs-var">m_var</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-253"></span><span>
</span><span id="line-254"></span><span class="hs-comment">---------------</span><span>
</span><span id="line-255"></span><span class="hs-comment">-- | Compute the expected type of a quotation, and also the QuoteWrapper in</span><span>
</span><span id="line-256"></span><span class="hs-comment">-- the case where it is an overloaded quotation. All quotation forms are</span><span>
</span><span id="line-257"></span><span class="hs-comment">-- overloaded aprt from Variable quotations ('foo)</span><span>
</span><span id="line-258"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#brackTy"><span class="hs-identifier hs-type">brackTy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsBracket"><span class="hs-identifier hs-type">HsBracket</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#QuoteWrapper"><span class="hs-identifier hs-type">QuoteWrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-259"></span><span id="brackTy"><span class="annot"><span class="annottext">brackTy :: HsBracket GhcRn -&gt; TcM (Maybe QuoteWrapper, Type)
</span><a href="GHC.Tc.Gen.Splice.html#brackTy"><span class="hs-identifier hs-var hs-var">brackTy</span></a></span></span><span> </span><span id="local-6989586621681125651"><span class="annot"><span class="annottext">HsBracket GhcRn
</span><a href="#local-6989586621681125651"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-260"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681125644"><span class="annot"><span class="annottext">mkTy :: Name -&gt; TcM (Maybe QuoteWrapper, Type)
</span><a href="#local-6989586621681125644"><span class="hs-identifier hs-var hs-var">mkTy</span></a></span></span><span> </span><span id="local-6989586621681125643"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681125643"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-261"></span><span>        </span><span class="hs-comment">-- New polymorphic type variable for the bracket</span><span>
</span><span id="line-262"></span><span>        </span><span id="local-6989586621681125642"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681125642"><span class="hs-identifier hs-var">m_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTy"><span class="hs-identifier hs-var">mkTyVarTy</span></a></span><span> </span><span class="annot"><span class="annottext">(Id -&gt; Type)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) Id
-&gt; IOEnv (Env TcGblEnv TcLclEnv) Type
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) Id
</span><a href="GHC.Tc.Gen.Splice.html#mkMetaTyVar"><span class="hs-identifier hs-var">mkMetaTyVar</span></a></span><span>
</span><span id="line-263"></span><span>        </span><span class="hs-comment">-- Emit a Quote constraint for the bracket</span><span>
</span><span id="line-264"></span><span>        </span><span id="local-6989586621681125641"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681125641"><span class="hs-identifier hs-var">ev_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) Id
</span><a href="GHC.Tc.Gen.Splice.html#emitQuoteWanted"><span class="hs-identifier hs-var">emitQuoteWanted</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681125642"><span class="hs-identifier hs-var">m_var</span></a></span><span>
</span><span id="line-265"></span><span>        </span><span class="hs-comment">-- Construct the final expected type of the quote, for example</span><span>
</span><span id="line-266"></span><span>        </span><span class="hs-comment">-- m Exp or m Type</span><span>
</span><span id="line-267"></span><span>        </span><span id="local-6989586621681125640"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681125640"><span class="hs-identifier hs-var">final_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.Type.html#mkAppTy"><span class="hs-identifier hs-var">mkAppTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681125642"><span class="hs-identifier hs-var">m_var</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) Type
-&gt; IOEnv (Env TcGblEnv TcLclEnv) Type
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) Type
</span><a href="GHC.Tc.Utils.Env.html#tcMetaTy"><span class="hs-identifier hs-var">tcMetaTy</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681125643"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-268"></span><span>        </span><span class="hs-comment">-- Return the evidence variable and metavariable to be used during</span><span>
</span><span id="line-269"></span><span>        </span><span class="hs-comment">-- desugaring.</span><span>
</span><span id="line-270"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681125637"><span class="annot"><span class="annottext">wrapper :: QuoteWrapper
</span><a href="#local-6989586621681125637"><span class="hs-identifier hs-var hs-var">wrapper</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Type -&gt; QuoteWrapper
</span><a href="GHC.Tc.Types.Evidence.html#QuoteWrapper"><span class="hs-identifier hs-var">QuoteWrapper</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681125641"><span class="hs-identifier hs-var">ev_var</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681125642"><span class="hs-identifier hs-var">m_var</span></a></span><span>
</span><span id="line-271"></span><span>        </span><span class="annot"><span class="annottext">(Maybe QuoteWrapper, Type) -&gt; TcM (Maybe QuoteWrapper, Type)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QuoteWrapper -&gt; Maybe QuoteWrapper
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">QuoteWrapper
</span><a href="#local-6989586621681125637"><span class="hs-identifier hs-var">wrapper</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681125640"><span class="hs-identifier hs-var">final_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-272"></span><span>  </span><span class="hs-keyword">in</span><span>
</span><span id="line-273"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HsBracket GhcRn
</span><a href="#local-6989586621681125651"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-274"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#VarBr"><span class="hs-identifier hs-type">VarBr</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe QuoteWrapper
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; (Maybe QuoteWrapper, Type))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) Type
-&gt; TcM (Maybe QuoteWrapper, Type)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) Type
</span><a href="GHC.Tc.Utils.Env.html#tcMetaTy"><span class="hs-identifier hs-var">tcMetaTy</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.TH.html#nameTyConName"><span class="hs-identifier hs-var">nameTyConName</span></a></span><span>
</span><span id="line-275"></span><span>                                           </span><span class="hs-comment">-- Result type is Var (not Quote-monadic)</span><span>
</span><span id="line-276"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#ExpBr"><span class="hs-identifier hs-type">ExpBr</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM (Maybe QuoteWrapper, Type)
</span><a href="#local-6989586621681125644"><span class="hs-identifier hs-var">mkTy</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.TH.html#expTyConName"><span class="hs-identifier hs-var">expTyConName</span></a></span><span>  </span><span class="hs-comment">-- Result type is m Exp</span><span>
</span><span id="line-277"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#TypBr"><span class="hs-identifier hs-type">TypBr</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM (Maybe QuoteWrapper, Type)
</span><a href="#local-6989586621681125644"><span class="hs-identifier hs-var">mkTy</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.TH.html#typeTyConName"><span class="hs-identifier hs-var">typeTyConName</span></a></span><span> </span><span class="hs-comment">-- Result type is m Type</span><span>
</span><span id="line-278"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#DecBrG"><span class="hs-identifier hs-type">DecBrG</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM (Maybe QuoteWrapper, Type)
</span><a href="#local-6989586621681125644"><span class="hs-identifier hs-var">mkTy</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.TH.html#decsTyConName"><span class="hs-identifier hs-var">decsTyConName</span></a></span><span> </span><span class="hs-comment">-- Result type is m [Dec]</span><span>
</span><span id="line-279"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#PatBr"><span class="hs-identifier hs-type">PatBr</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM (Maybe QuoteWrapper, Type)
</span><a href="#local-6989586621681125644"><span class="hs-identifier hs-var">mkTy</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.TH.html#patTyConName"><span class="hs-identifier hs-var">patTyConName</span></a></span><span>  </span><span class="hs-comment">-- Result type is m Pat</span><span>
</span><span id="line-280"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#DecBrL"><span class="hs-identifier hs-type">DecBrL</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; TcM (Maybe QuoteWrapper, Type)
forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcBrackTy: Unexpected DecBrL&quot;</span></span><span>
</span><span id="line-281"></span><span>    </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#TExpBr"><span class="hs-identifier hs-type">TExpBr</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; TcM (Maybe QuoteWrapper, Type)
forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcUntypedBracket: Unexpected TExpBr&quot;</span></span><span>
</span><span id="line-282"></span><span>
</span><span id="line-283"></span><span class="hs-comment">---------------</span><span>
</span><span id="line-284"></span><span class="hs-comment">-- | Typechecking a pending splice from a untyped bracket</span><span>
</span><span id="line-285"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#tcPendingSplice"><span class="hs-identifier hs-type">tcPendingSplice</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-comment">-- Metavariable for the expected overall type of the</span><span>
</span><span id="line-286"></span><span>                          </span><span class="hs-comment">-- quotation.</span><span>
</span><span id="line-287"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#PendingRnSplice"><span class="hs-identifier hs-type">PendingRnSplice</span></a></span><span>
</span><span id="line-288"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#PendingTcSplice"><span class="hs-identifier hs-type">PendingTcSplice</span></a></span><span>
</span><span id="line-289"></span><span id="tcPendingSplice"><span class="annot"><span class="annottext">tcPendingSplice :: Type
-&gt; PendingRnSplice -&gt; IOEnv (Env TcGblEnv TcLclEnv) PendingTcSplice
</span><a href="GHC.Tc.Gen.Splice.html#tcPendingSplice"><span class="hs-identifier hs-var hs-var">tcPendingSplice</span></a></span></span><span> </span><span id="local-6989586621681125623"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681125623"><span class="hs-identifier hs-var">m_var</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#PendingRnSplice"><span class="hs-identifier hs-type">PendingRnSplice</span></a></span><span> </span><span id="local-6989586621681125621"><span class="annot"><span class="annottext">UntypedSpliceFlavour
</span><a href="#local-6989586621681125621"><span class="hs-identifier hs-var">flavour</span></a></span></span><span> </span><span id="local-6989586621681125620"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681125620"><span class="hs-identifier hs-var">splice_name</span></a></span></span><span> </span><span id="local-6989586621681125619"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681125619"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-290"></span><span>  </span><span class="hs-comment">-- See Note [Typechecking Overloaded Quotes]</span><span>
</span><span id="line-291"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681125618"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681125618"><span class="hs-identifier hs-var">meta_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) Type
</span><a href="GHC.Tc.Utils.Env.html#tcMetaTy"><span class="hs-identifier hs-var">tcMetaTy</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681125617"><span class="hs-identifier hs-var">meta_ty_name</span></a></span><span>
</span><span id="line-292"></span><span>         </span><span class="hs-comment">-- Expected type of splice, e.g. m Exp</span><span>
</span><span id="line-293"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681125616"><span class="annot"><span class="annottext">expected_type :: Type
</span><a href="#local-6989586621681125616"><span class="hs-identifier hs-var hs-var">expected_type</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="GHC.Core.Type.html#mkAppTy"><span class="hs-identifier hs-var">mkAppTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681125623"><span class="hs-identifier hs-var">m_var</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681125618"><span class="hs-identifier hs-var">meta_ty</span></a></span><span>
</span><span id="line-294"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681125615"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681125615"><span class="hs-identifier hs-var">expr'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a. Type -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#tcScalingUsage"><span class="hs-identifier hs-var">tcScalingUsage</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Core.Type.html#Many"><span class="hs-identifier hs-var">Many</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; Type -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckPolyExpr"><span class="hs-identifier hs-var">tcCheckPolyExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681125619"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681125616"><span class="hs-identifier hs-var">expected_type</span></a></span><span>
</span><span id="line-295"></span><span>                  </span><span class="hs-comment">-- Scale by Many, TH lifting is currently nonlinear (#18465)</span><span>
</span><span id="line-296"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">PendingTcSplice -&gt; IOEnv (Env TcGblEnv TcLclEnv) PendingTcSplice
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; LHsExpr GhcTc -&gt; PendingTcSplice
</span><a href="GHC.Hs.Expr.html#PendingTcSplice"><span class="hs-identifier hs-var">PendingTcSplice</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681125620"><span class="hs-identifier hs-var">splice_name</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681125615"><span class="hs-identifier hs-var">expr'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-297"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-298"></span><span>     </span><span id="local-6989586621681125617"><span class="annot"><span class="annottext">meta_ty_name :: Name
</span><a href="#local-6989586621681125617"><span class="hs-identifier hs-var hs-var">meta_ty_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">UntypedSpliceFlavour
</span><a href="#local-6989586621681125621"><span class="hs-identifier hs-var">flavour</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-299"></span><span>                       </span><span class="annot"><span class="annottext">UntypedSpliceFlavour
</span><a href="GHC.Hs.Expr.html#UntypedExpSplice"><span class="hs-identifier hs-var">UntypedExpSplice</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.TH.html#expTyConName"><span class="hs-identifier hs-var">expTyConName</span></a></span><span>
</span><span id="line-300"></span><span>                       </span><span class="annot"><span class="annottext">UntypedSpliceFlavour
</span><a href="GHC.Hs.Expr.html#UntypedPatSplice"><span class="hs-identifier hs-var">UntypedPatSplice</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.TH.html#patTyConName"><span class="hs-identifier hs-var">patTyConName</span></a></span><span>
</span><span id="line-301"></span><span>                       </span><span class="annot"><span class="annottext">UntypedSpliceFlavour
</span><a href="GHC.Hs.Expr.html#UntypedTypeSplice"><span class="hs-identifier hs-var">UntypedTypeSplice</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.TH.html#typeTyConName"><span class="hs-identifier hs-var">typeTyConName</span></a></span><span>
</span><span id="line-302"></span><span>                       </span><span class="annot"><span class="annottext">UntypedSpliceFlavour
</span><a href="GHC.Hs.Expr.html#UntypedDeclSplice"><span class="hs-identifier hs-var">UntypedDeclSplice</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.TH.html#decsTyConName"><span class="hs-identifier hs-var">decsTyConName</span></a></span><span>
</span><span id="line-303"></span><span>
</span><span id="line-304"></span><span class="hs-comment">---------------</span><span>
</span><span id="line-305"></span><span class="hs-comment">-- Takes a m and tau and returns the type m (TExp tau)</span><span>
</span><span id="line-306"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#tcTExpTy"><span class="hs-identifier hs-type">tcTExpTy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#TcType"><span class="hs-identifier hs-type">TcType</span></a></span><span>
</span><span id="line-307"></span><span id="tcTExpTy"><span class="annot"><span class="annottext">tcTExpTy :: Type -&gt; Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) Type
</span><a href="GHC.Tc.Gen.Splice.html#tcTExpTy"><span class="hs-identifier hs-var hs-var">tcTExpTy</span></a></span></span><span> </span><span id="local-6989586621681125608"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681125608"><span class="hs-identifier hs-var">m_ty</span></a></span></span><span> </span><span id="local-6989586621681125607"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681125607"><span class="hs-identifier hs-var">exp_ty</span></a></span></span><span>
</span><span id="line-308"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TcRn () -&gt; TcRn ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base/src/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#isTauTy"><span class="hs-identifier hs-var">isTauTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681125607"><span class="hs-identifier hs-var">exp_ty</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcRn ()) -&gt; TcRn () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">MsgDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; MsgDoc
forall a. Outputable a =&gt; a -&gt; MsgDoc
</span><a href="#local-6989586621681125603"><span class="hs-identifier hs-var">err_msg</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681125607"><span class="hs-identifier hs-var">exp_ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-309"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681125602"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681125602"><span class="hs-identifier hs-var">codeCon</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM TyCon
</span><a href="GHC.Tc.Utils.Env.html#tcLookupTyCon"><span class="hs-identifier hs-var">tcLookupTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.TH.html#codeTyConName"><span class="hs-identifier hs-var">codeTyConName</span></a></span><span>
</span><span id="line-310"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681125600"><span class="annot"><span class="annottext">rep :: Type
</span><a href="#local-6989586621681125600"><span class="hs-identifier hs-var hs-var">rep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
Type -&gt; Type
</span><a href="GHC.Core.Type.html#getRuntimeRep"><span class="hs-identifier hs-var">getRuntimeRep</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681125607"><span class="hs-identifier hs-var">exp_ty</span></a></span><span>
</span><span id="line-311"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) Type
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681125602"><span class="hs-identifier hs-var">codeCon</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681125600"><span class="hs-identifier hs-var">rep</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681125608"><span class="hs-identifier hs-var">m_ty</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681125607"><span class="hs-identifier hs-var">exp_ty</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-312"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-313"></span><span>    </span><span id="local-6989586621681125603"><span class="annot"><span class="annottext">err_msg :: a -&gt; MsgDoc
</span><a href="#local-6989586621681125603"><span class="hs-identifier hs-var hs-var">err_msg</span></a></span></span><span> </span><span id="local-6989586621681125597"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681125597"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-314"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[MsgDoc] -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Illegal polytype:&quot;</span></span><span> </span><span class="annot"><span class="annottext">MsgDoc -&gt; MsgDoc -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; MsgDoc
forall a. Outputable a =&gt; a -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681125597"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-315"></span><span>             </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;The type of a Typed Template Haskell expression must&quot;</span></span><span> </span><span class="annot"><span class="annottext">MsgDoc -&gt; MsgDoc -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-316"></span><span>               </span><span class="annot"><span class="annottext">String -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;not have any quantification.&quot;</span></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-317"></span><span>
</span><span id="line-318"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#quotationCtxtDoc"><span class="hs-identifier hs-type">quotationCtxtDoc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsBracket"><span class="hs-identifier hs-type">HsBracket</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-319"></span><span id="quotationCtxtDoc"><span class="annot"><span class="annottext">quotationCtxtDoc :: HsBracket GhcRn -&gt; MsgDoc
</span><a href="GHC.Tc.Gen.Splice.html#quotationCtxtDoc"><span class="hs-identifier hs-var hs-var">quotationCtxtDoc</span></a></span></span><span> </span><span id="local-6989586621681125592"><span class="annot"><span class="annottext">HsBracket GhcRn
</span><a href="#local-6989586621681125592"><span class="hs-identifier hs-var">br_body</span></a></span></span><span>
</span><span id="line-320"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MsgDoc -&gt; Arity -&gt; MsgDoc -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;In the Template Haskell quotation&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-321"></span><span>         </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsBracket GhcRn -&gt; MsgDoc
forall a. Outputable a =&gt; a -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsBracket GhcRn
</span><a href="#local-6989586621681125592"><span class="hs-identifier hs-var">br_body</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-322"></span><span>
</span><span id="line-323"></span><span>
</span><span id="line-324"></span><span>  </span><span class="hs-comment">-- The whole of the rest of the file is the else-branch (ie stage2 only)</span><span>
</span><span id="line-325"></span><span>
</span><span id="line-326"></span><span class="hs-comment">{-
Note [How top-level splices are handled]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Top-level splices (those not inside a [| .. |] quotation bracket) are handled
very straightforwardly:

  1. tcTopSpliceExpr: typecheck the body e of the splice $(e)

  2. runMetaT: desugar, compile, run it, and convert result back to
     GHC.Hs syntax RdrName (of the appropriate flavour, eg HsType RdrName,
     HsExpr RdrName etc)

  3. treat the result as if that's what you saw in the first place
     e.g for HsType, rename and kind-check
         for HsExpr, rename and type-check

     (The last step is different for decls, because they can *only* be
      top-level: we return the result of step 2.)

Note [How brackets and nested splices are handled]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Nested splices (those inside a [| .. |] quotation bracket),
are treated quite differently.

Remember, there are two forms of bracket
         typed   [|| e ||]
   and untyped   [|  e  |]

The life cycle of a typed bracket:
   * Starts as HsBracket

   * When renaming:
        * Set the ThStage to (Brack s RnPendingTyped)
        * Rename the body
        * Result is still a HsBracket

   * When typechecking:
        * Set the ThStage to (Brack s (TcPending ps_var lie_var))
        * Typecheck the body, and throw away the elaborated result
        * Nested splices (which must be typed) are typechecked, and
          the results accumulated in ps_var; their constraints
          accumulate in lie_var
        * Result is a HsTcBracketOut rn_brack pending_splices
          where rn_brack is the incoming renamed bracket

The life cycle of a un-typed bracket:
   * Starts as HsBracket

   * When renaming:
        * Set the ThStage to (Brack s (RnPendingUntyped ps_var))
        * Rename the body
        * Nested splices (which must be untyped) are renamed, and the
          results accumulated in ps_var
        * Result is still (HsRnBracketOut rn_body pending_splices)

   * When typechecking a HsRnBracketOut
        * Typecheck the pending_splices individually
        * Ignore the body of the bracket; just check that the context
          expects a bracket of that type (e.g. a [p| pat |] bracket should
          be in a context needing a (Q Pat)
        * Result is a HsTcBracketOut rn_brack pending_splices
          where rn_brack is the incoming renamed bracket


In both cases, desugaring happens like this:
  * HsTcBracketOut is desugared by GHC.HsToCore.Quote.dsBracket.  It

      a) Extends the ds_meta environment with the PendingSplices
         attached to the bracket

      b) Converts the quoted (HsExpr Name) to a CoreExpr that, when
         run, will produce a suitable TH expression/type/decl.  This
         is why we leave the *renamed* expression attached to the bracket:
         the quoted expression should not be decorated with all the goop
         added by the type checker

  * Each splice carries a unique Name, called a &quot;splice point&quot;, thus
    ${n}(e).  The name is initialised to an (Unqual &quot;splice&quot;) when the
    splice is created; the renamer gives it a unique.

  * When GHC.HsToCore.Quote (used to desugar the body of the bracket) comes across
    a splice, it looks up the splice's Name, n, in the ds_meta envt,
    to find an (HsExpr Id) that should be substituted for the splice;
    it just desugars it to get a CoreExpr (GHC.HsToCore.Quote.repSplice).

Example:
    Source:       f = [| Just $(g 3) |]
      The [| |] part is a HsBracket

    Typechecked:  f = [| Just ${s7}(g 3) |]{s7 = g Int 3}
      The [| |] part is a HsBracketOut, containing *renamed*
        (not typechecked) expression
      The &quot;s7&quot; is the &quot;splice point&quot;; the (g Int 3) part
        is a typechecked expression

    Desugared:    f = do { s7 &lt;- g Int 3
                         ; return (ConE &quot;Data.Maybe.Just&quot; s7) }


Note [Template Haskell state diagram]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Here are the ThStages, s, their corresponding level numbers
(the result of (thLevel s)), and their state transitions.
The top level of the program is stage Comp:

     Start here
         |
         V
      -----------     $      ------------   $
      |  Comp   | ---------&gt; |  Splice  | -----|
      |   1     |            |    0     | &lt;----|
      -----------            ------------
        ^     |                ^      |
      $ |     | [||]         $ |      | [||]
        |     v                |      v
   --------------          ----------------
   | Brack Comp |          | Brack Splice |
   |     2      |          |      1       |
   --------------          ----------------

* Normal top-level declarations start in state Comp
       (which has level 1).
  Annotations start in state Splice, since they are
       treated very like a splice (only without a '$')

* Code compiled in state Splice (and only such code)
  will be *run at compile time*, with the result replacing
  the splice

* The original paper used level -1 instead of 0, etc.

* The original paper did not allow a splice within a
  splice, but there is no reason not to. This is the
  $ transition in the top right.

Note [Template Haskell levels]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
* Imported things are impLevel (= 0)

* However things at level 0 are not *necessarily* imported.
      eg  $( \b -&gt; ... )   here b is bound at level 0

* In GHCi, variables bound by a previous command are treated
  as impLevel, because we have bytecode for them.

* Variables are bound at the &quot;current level&quot;

* The current level starts off at outerLevel (= 1)

* The level is decremented by splicing $(..)
               incremented by brackets [| |]
               incremented by name-quoting 'f

* When a variable is used, checkWellStaged compares
        bind:  binding level, and
        use:   current level at usage site

  Generally
        bind &gt; use      Always error (bound later than used)
                        [| \x -&gt; $(f x) |]

        bind = use      Always OK (bound same stage as used)
                        [| \x -&gt; $(f [| x |]) |]

        bind &lt; use      Inside brackets, it depends
                        Inside splice, OK
                        Inside neither, OK

  For (bind &lt; use) inside brackets, there are three cases:
    - Imported things   OK      f = [| map |]
    - Top-level things  OK      g = [| f |]
    - Non-top-level     Only if there is a liftable instance
                                h = \(x:Int) -&gt; [| x |]

  To track top-level-ness we use the ThBindEnv in TcLclEnv

  For example:
           f = ...
           g1 = $(map ...)         is OK
           g2 = $(f ...)           is not OK; because we haven't compiled f yet

Note [Typechecking Overloaded Quotes]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The main function for typechecking untyped quotations is `tcUntypedBracket`.

Consider an expression quote, `[| e |]`, its type is `forall m . Quote m =&gt; m Exp`.
When we typecheck it we therefore create a template of a metavariable `m` applied to `Exp` and
emit a constraint `Quote m`. All this is done in the `brackTy` function.
`brackTy` also selects the correct contents type for the quotation (Exp, Type, Decs etc).

The meta variable and the constraint evidence variable are
returned together in a `QuoteWrapper` and then passed along to two further places
during compilation:

1. Typechecking nested splices (immediately in tcPendingSplice)
2. Desugaring quotations (see GHC.HsToCore.Quote)

`tcPendingSplice` takes the `m` type variable as an argument and checks
each nested splice against this variable `m`. During this
process the variable `m` can either be fixed to a specific value or further constrained by the
nested splices.

Once we have checked all the nested splices, the quote type is checked against
the expected return type.

The process is very simple and like typechecking a list where the quotation is
like the container and the splices are the elements of the list which must have
a specific type.

After the typechecking process is completed, the evidence variable for `Quote m`
and the type `m` is stored in a `QuoteWrapper` which is passed through the pipeline
and used when desugaring quotations.

Typechecking typed quotations is a similar idea but the `QuoteWrapper` is stored
in the `PendingStuff` as the nested splices are gathered up in a different way
to untyped splices. Untyped splices are found in the renamer but typed splices are
not typechecked and extracted until during typechecking.

-}</span><span>
</span><span id="line-546"></span><span>
</span><span id="line-547"></span><span class="hs-comment">-- | We only want to produce warnings for TH-splices if the user requests so.</span><span>
</span><span id="line-548"></span><span class="hs-comment">-- See Note [Warnings for TH splices].</span><span>
</span><span id="line-549"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#getThSpliceOrigin"><span class="hs-identifier hs-type">getThSpliceOrigin</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#Origin"><span class="hs-identifier hs-type">Origin</span></a></span><span>
</span><span id="line-550"></span><span id="getThSpliceOrigin"><span class="annot"><span class="annottext">getThSpliceOrigin :: TcM Origin
</span><a href="GHC.Tc.Gen.Splice.html#getThSpliceOrigin"><span class="hs-identifier hs-var hs-var">getThSpliceOrigin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-551"></span><span>  </span><span id="local-6989586621681125589"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681125589"><span class="hs-identifier hs-var">warn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall gbl lcl. GeneralFlag -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#goptM"><span class="hs-identifier hs-var">goptM</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_EnableThSpliceWarnings"><span class="hs-identifier hs-var">Opt_EnableThSpliceWarnings</span></a></span><span>
</span><span id="line-552"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681125589"><span class="hs-identifier hs-var">warn</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Origin -&gt; TcM Origin
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Origin
</span><a href="GHC.Types.Basic.html#FromSource"><span class="hs-identifier hs-var">FromSource</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Origin -&gt; TcM Origin
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Origin
</span><a href="GHC.Types.Basic.html#Generated"><span class="hs-identifier hs-var">Generated</span></a></span><span>
</span><span id="line-553"></span><span>
</span><span id="line-554"></span><span class="hs-comment">{- Note [Warnings for TH splices]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
We only produce warnings for TH splices when the user requests so
(-fenable-th-splice-warnings). There are multiple reasons:

  * It's not clear that the user that compiles a splice is the author of the code
    that produces the warning. Think of the situation where she just splices in
    code from a third-party library that produces incomplete pattern matches.
    In this scenario, the user isn't even able to fix that warning.
  * Gathering information for producing the warnings (pattern-match check
    warnings in particular) is costly. There's no point in doing so if the user
    is not interested in those warnings.

That's why we store Origin flags in the Haskell AST. The functions from ThToHs
take such a flag and depending on whether TH splice warnings were enabled or
not, we pass FromSource (if the user requests warnings) or Generated
(otherwise). This is implemented in getThSpliceOrigin.

For correct pattern-match warnings it's crucial that we annotate the Origin
consistently (#17270). In the future we could offer the Origin as part of the
TH AST. That would enable us to give quotes from the current module get
FromSource origin, and/or third library authors to tag certain parts of
generated code as FromSource to enable warnings. That effort is tracked in
#14838.
-}</span><span>
</span><span id="line-579"></span><span>
</span><span id="line-580"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Splicing an expression}
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-587"></span><span>
</span><span id="line-588"></span><span id="tcSpliceExpr"><span class="annot"><span class="annottext">tcSpliceExpr :: HsSplice GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Splice.html#tcSpliceExpr"><span class="hs-identifier hs-var hs-var">tcSpliceExpr</span></a></span></span><span> </span><span id="local-6989586621681125584"><span class="annot"><span class="annottext">splice :: HsSplice GhcRn
</span><a href="#local-6989586621681125584"><span class="hs-identifier hs-var">splice</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsTypedSplice"><span class="hs-identifier hs-type">HsTypedSplice</span></a></span><span> </span><span class="annot"><span class="annottext">XTypedSplice GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">SpliceDecoration
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681125582"><span class="annot"><span class="annottext">IdP GhcRn
</span><a href="#local-6989586621681125582"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span id="local-6989586621681125581"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681125581"><span class="hs-identifier hs-var">expr</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681125580"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681125580"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-589"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MsgDoc -&gt; TcM (HsExpr GhcTc) -&gt; TcM (HsExpr GhcTc)
forall a. MsgDoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsSplice GhcRn -&gt; MsgDoc
</span><a href="GHC.Tc.Gen.Splice.html#spliceCtxtDoc"><span class="hs-identifier hs-var">spliceCtxtDoc</span></a></span><span> </span><span class="annot"><span class="annottext">HsSplice GhcRn
</span><a href="#local-6989586621681125584"><span class="hs-identifier hs-var">splice</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM (HsExpr GhcTc) -&gt; TcM (HsExpr GhcTc))
-&gt; TcM (HsExpr GhcTc) -&gt; TcM (HsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-590"></span><span>    </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcM (HsExpr GhcTc) -&gt; TcM (HsExpr GhcTc)
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; SrcSpan
forall l e. GenLocated l e -&gt; l
</span><a href="GHC.Types.SrcLoc.html#getLoc"><span class="hs-identifier hs-var">getLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681125581"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span>    </span><span class="annot"><span class="annottext">(TcM (HsExpr GhcTc) -&gt; TcM (HsExpr GhcTc))
-&gt; TcM (HsExpr GhcTc) -&gt; TcM (HsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-591"></span><span>    </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681125576"><span class="annot"><span class="annottext">ThStage
</span><a href="#local-6989586621681125576"><span class="hs-identifier hs-var">stage</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM ThStage
</span><a href="GHC.Tc.Utils.Monad.html#getStage"><span class="hs-identifier hs-var">getStage</span></a></span><span>
</span><span id="line-592"></span><span>    </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ThStage
</span><a href="#local-6989586621681125576"><span class="hs-identifier hs-var">stage</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-593"></span><span>          </span><span class="annot"><a href="GHC.Tc.Types.html#Splice"><span class="hs-identifier hs-type">Splice</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Splice.html#tcTopSplice"><span class="hs-identifier hs-var">tcTopSplice</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681125581"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681125580"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-594"></span><span>          </span><span class="annot"><a href="GHC.Tc.Types.html#Brack"><span class="hs-identifier hs-type">Brack</span></a></span><span> </span><span id="local-6989586621681125573"><span class="annot"><span class="annottext">ThStage
</span><a href="#local-6989586621681125573"><span class="hs-identifier hs-var">pop_stage</span></a></span></span><span> </span><span id="local-6989586621681125572"><span class="annot"><span class="annottext">PendingStuff
</span><a href="#local-6989586621681125572"><span class="hs-identifier hs-var">pend</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ThStage
-&gt; PendingStuff
-&gt; Name
-&gt; LHsExpr GhcRn
-&gt; ExpRhoType
-&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Splice.html#tcNestedSplice"><span class="hs-identifier hs-var">tcNestedSplice</span></a></span><span> </span><span class="annot"><span class="annottext">ThStage
</span><a href="#local-6989586621681125573"><span class="hs-identifier hs-var">pop_stage</span></a></span><span> </span><span class="annot"><span class="annottext">PendingStuff
</span><a href="#local-6989586621681125572"><span class="hs-identifier hs-var">pend</span></a></span><span> </span><span class="annot"><span class="annottext">Name
IdP GhcRn
</span><a href="#local-6989586621681125582"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681125581"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681125580"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-595"></span><span>          </span><span class="annot"><a href="GHC.Tc.Types.html#RunSplice"><span class="hs-identifier hs-type">RunSplice</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef [ForeignRef (Q ())]
</span><span class="hs-identifier">_</span></span><span>          </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-596"></span><span>            </span><span class="hs-comment">-- See Note [RunSplice ThLevel] in &quot;GHC.Tc.Types&quot;.</span><span>
</span><span id="line-597"></span><span>            </span><span class="annot"><span class="annottext">String -&gt; MsgDoc -&gt; TcM (HsExpr GhcTc)
forall a. HasCallStack =&gt; String -&gt; MsgDoc -&gt; a
</span><a href="GHC.Utils.Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcSpliceExpr: attempted to typecheck a splice when &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-598"></span><span>                      </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;running another splice&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsSplice GhcRn -&gt; MsgDoc
forall a. Outputable a =&gt; a -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsSplice GhcRn
</span><a href="#local-6989586621681125584"><span class="hs-identifier hs-var">splice</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-599"></span><span>          </span><span class="annot"><span class="annottext">ThStage
</span><a href="GHC.Tc.Types.html#Comp"><span class="hs-identifier hs-var">Comp</span></a></span><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Splice.html#tcTopSplice"><span class="hs-identifier hs-var">tcTopSplice</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681125581"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681125580"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-600"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-601"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#tcSpliceExpr"><span class="hs-identifier hs-var">tcSpliceExpr</span></a></span><span> </span><span id="local-6989586621681125568"><span class="annot"><span class="annottext">HsSplice GhcRn
</span><a href="#local-6989586621681125568"><span class="hs-identifier hs-var">splice</span></a></span></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-602"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; MsgDoc -&gt; TcM (HsExpr GhcTc)
forall a. HasCallStack =&gt; String -&gt; MsgDoc -&gt; a
</span><a href="GHC.Utils.Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcSpliceExpr&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsSplice GhcRn -&gt; MsgDoc
forall a. Outputable a =&gt; a -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">HsSplice GhcRn
</span><a href="#local-6989586621681125568"><span class="hs-identifier hs-var">splice</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-603"></span><span>
</span><span id="line-604"></span><span class="hs-comment">{- Note [Collecting modFinalizers in typed splices]
   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

'qAddModFinalizer' of the @Quasi TcM@ instance adds finalizers in the local
environment (see Note [Delaying modFinalizers in untyped splices] in
GHC.Rename.Splice). Thus after executing the splice, we move the finalizers to the
finalizer list in the global environment and set them to use the current local
environment (with 'addModFinalizersWithLclEnv').

-}</span><span>
</span><span id="line-614"></span><span>
</span><span id="line-615"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#tcNestedSplice"><span class="hs-identifier hs-type">tcNestedSplice</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#ThStage"><span class="hs-identifier hs-type">ThStage</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#PendingStuff"><span class="hs-identifier hs-type">PendingStuff</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-616"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-617"></span><span>    </span><span class="hs-comment">-- See Note [How brackets and nested splices are handled]</span><span>
</span><span id="line-618"></span><span>    </span><span class="hs-comment">-- A splice inside brackets</span><span>
</span><span id="line-619"></span><span id="tcNestedSplice"><span class="annot"><span class="annottext">tcNestedSplice :: ThStage
-&gt; PendingStuff
-&gt; Name
-&gt; LHsExpr GhcRn
-&gt; ExpRhoType
-&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Splice.html#tcNestedSplice"><span class="hs-identifier hs-var hs-var">tcNestedSplice</span></a></span></span><span> </span><span id="local-6989586621681125567"><span class="annot"><span class="annottext">ThStage
</span><a href="#local-6989586621681125567"><span class="hs-identifier hs-var">pop_stage</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#TcPending"><span class="hs-identifier hs-type">TcPending</span></a></span><span> </span><span id="local-6989586621681125566"><span class="annot"><span class="annottext">IORef [PendingTcSplice]
</span><a href="#local-6989586621681125566"><span class="hs-identifier hs-var">ps_var</span></a></span></span><span> </span><span id="local-6989586621681125565"><span class="annot"><span class="annottext">TcRef WantedConstraints
</span><a href="#local-6989586621681125565"><span class="hs-identifier hs-var">lie_var</span></a></span></span><span> </span><span id="local-6989586621681125564"><span class="annot"><span class="annottext">q :: QuoteWrapper
</span><a href="#local-6989586621681125564"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.Evidence.html#QuoteWrapper"><span class="hs-identifier hs-type">QuoteWrapper</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681125563"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681125563"><span class="hs-identifier hs-var">m_var</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621681125562"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681125562"><span class="hs-identifier hs-var">splice_name</span></a></span></span><span> </span><span id="local-6989586621681125561"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681125561"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span id="local-6989586621681125560"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681125560"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-620"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681125559"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681125559"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpRhoType -&gt; IOEnv (Env TcGblEnv TcLclEnv) Type
</span><a href="GHC.Tc.Utils.TcMType.html#expTypeToType"><span class="hs-identifier hs-var">expTypeToType</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681125560"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-621"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681125557"><span class="annot"><span class="annottext">rep :: Type
</span><a href="#local-6989586621681125557"><span class="hs-identifier hs-var hs-var">rep</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
Type -&gt; Type
</span><a href="GHC.Core.Type.html#getRuntimeRep"><span class="hs-identifier hs-var">getRuntimeRep</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681125559"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-622"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681125556"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681125556"><span class="hs-identifier hs-var">meta_exp_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) Type
</span><a href="GHC.Tc.Gen.Splice.html#tcTExpTy"><span class="hs-identifier hs-var">tcTExpTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681125563"><span class="hs-identifier hs-var">m_var</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681125559"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-623"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681125555"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681125555"><span class="hs-identifier hs-var">expr'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ThStage -&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a. ThStage -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#setStage"><span class="hs-identifier hs-var">setStage</span></a></span><span> </span><span class="annot"><span class="annottext">ThStage
</span><a href="#local-6989586621681125567"><span class="hs-identifier hs-var">pop_stage</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-624"></span><span>                  </span><span class="annot"><span class="annottext">TcRef WantedConstraints
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a. TcRef WantedConstraints -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#setConstraintVar"><span class="hs-identifier hs-var">setConstraintVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef WantedConstraints
</span><a href="#local-6989586621681125565"><span class="hs-identifier hs-var">lie_var</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-625"></span><span>                  </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; Type -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckMonoExpr"><span class="hs-identifier hs-var">tcCheckMonoExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681125561"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681125556"><span class="hs-identifier hs-var">meta_exp_ty</span></a></span><span>
</span><span id="line-626"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681125552"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681125552"><span class="hs-identifier hs-var">untype_code</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) Id
</span><a href="GHC.Tc.Utils.Env.html#tcLookupId"><span class="hs-identifier hs-var">tcLookupId</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.TH.html#unTypeCodeName"><span class="hs-identifier hs-var">unTypeCodeName</span></a></span><span>
</span><span id="line-627"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681125550"><span class="annot"><span class="annottext">expr'' :: LHsExpr GhcTc
</span><a href="#local-6989586621681125550"><span class="hs-identifier hs-var hs-var">expr''</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc -&gt; LHsExpr GhcTc -&gt; LHsExpr GhcTc
forall (id :: Pass).
LHsExpr (GhcPass id)
-&gt; LHsExpr (GhcPass id) -&gt; LHsExpr (GhcPass id)
</span><a href="GHC.Hs.Utils.html#mkHsApp"><span class="hs-identifier hs-var">mkHsApp</span></a></span><span>
</span><span id="line-628"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper -&gt; LHsExpr GhcTc -&gt; LHsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkLHsWrap"><span class="hs-identifier hs-var">mkLHsWrap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QuoteWrapper -&gt; HsWrapper
</span><a href="GHC.Tc.Types.Evidence.html#applyQuoteWrapper"><span class="hs-identifier hs-var">applyQuoteWrapper</span></a></span><span> </span><span class="annot"><span class="annottext">QuoteWrapper
</span><a href="#local-6989586621681125564"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-629"></span><span>                          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; [Type] -&gt; LHsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#nlHsTyApp"><span class="hs-identifier hs-var">nlHsTyApp</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681125552"><span class="hs-identifier hs-var">untype_code</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681125557"><span class="hs-identifier hs-var">rep</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681125559"><span class="hs-identifier hs-var">res_ty</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681125555"><span class="hs-identifier hs-var">expr'</span></a></span><span>
</span><span id="line-630"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681125549"><span class="annot"><span class="annottext">[PendingTcSplice]
</span><a href="#local-6989586621681125549"><span class="hs-identifier hs-var">ps</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef [PendingTcSplice]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [PendingTcSplice]
forall a env. IORef a -&gt; IOEnv env a
</span><a href="GHC.Data.IOEnv.html#readMutVar"><span class="hs-identifier hs-var">readMutVar</span></a></span><span> </span><span class="annot"><span class="annottext">IORef [PendingTcSplice]
</span><a href="#local-6989586621681125566"><span class="hs-identifier hs-var">ps_var</span></a></span><span>
</span><span id="line-631"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">IORef [PendingTcSplice] -&gt; [PendingTcSplice] -&gt; TcRn ()
forall a env. IORef a -&gt; a -&gt; IOEnv env ()
</span><a href="GHC.Data.IOEnv.html#writeMutVar"><span class="hs-identifier hs-var">writeMutVar</span></a></span><span> </span><span class="annot"><span class="annottext">IORef [PendingTcSplice]
</span><a href="#local-6989586621681125566"><span class="hs-identifier hs-var">ps_var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; LHsExpr GhcTc -&gt; PendingTcSplice
</span><a href="GHC.Hs.Expr.html#PendingTcSplice"><span class="hs-identifier hs-var">PendingTcSplice</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681125562"><span class="hs-identifier hs-var">splice_name</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681125550"><span class="hs-identifier hs-var">expr''</span></a></span><span> </span><span class="annot"><span class="annottext">PendingTcSplice -&gt; [PendingTcSplice] -&gt; [PendingTcSplice]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[PendingTcSplice]
</span><a href="#local-6989586621681125549"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-632"></span><span>
</span><span id="line-633"></span><span>       </span><span class="hs-comment">-- The returned expression is ignored; it's in the pending splices</span><span>
</span><span id="line-634"></span><span>       </span><span class="hs-comment">-- But we still return a plausible expression</span><span>
</span><span id="line-635"></span><span>       </span><span class="hs-comment">--   (a) in case we print it in debug messages, and</span><span>
</span><span id="line-636"></span><span>       </span><span class="hs-comment">--   (b) because we test whether it is tagToEnum in Tc.Gen.Expr.tcApp</span><span>
</span><span id="line-637"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XSpliceE GhcTc -&gt; HsSplice GhcTc -&gt; HsExpr GhcTc
forall p. XSpliceE p -&gt; HsSplice p -&gt; HsExpr p
</span><a href="GHC.Hs.Expr.html#HsSpliceE"><span class="hs-identifier hs-var">HsSpliceE</span></a></span><span> </span><span class="annot"><span class="annottext">NoExtField
XSpliceE GhcTc
</span><a href="GHC.Hs.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="annot"><span class="annottext">(HsSplice GhcTc -&gt; HsExpr GhcTc) -&gt; HsSplice GhcTc -&gt; HsExpr GhcTc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-638"></span><span>                 </span><span class="annot"><span class="annottext">XSpliced GhcTc
-&gt; ThModFinalizers -&gt; HsSplicedThing GhcTc -&gt; HsSplice GhcTc
forall id.
XSpliced id -&gt; ThModFinalizers -&gt; HsSplicedThing id -&gt; HsSplice id
</span><a href="GHC.Hs.Expr.html#HsSpliced"><span class="hs-identifier hs-var">HsSpliced</span></a></span><span> </span><span class="annot"><span class="annottext">NoExtField
XSpliced GhcTc
</span><a href="GHC.Hs.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ForeignRef (Q ())] -&gt; ThModFinalizers
</span><a href="GHC.Hs.Expr.html#ThModFinalizers"><span class="hs-identifier hs-var">ThModFinalizers</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(HsSplicedThing GhcTc -&gt; HsSplice GhcTc)
-&gt; HsSplicedThing GhcTc -&gt; HsSplice GhcTc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-639"></span><span>                 </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; HsSplicedThing GhcTc
forall id. HsExpr id -&gt; HsSplicedThing id
</span><a href="GHC.Hs.Expr.html#HsSplicedExpr"><span class="hs-identifier hs-var">HsSplicedExpr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsExpr GhcTc -&gt; HsExpr GhcTc
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681125550"><span class="hs-identifier hs-var">expr''</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-640"></span><span>
</span><span id="line-641"></span><span>
</span><span id="line-642"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#tcNestedSplice"><span class="hs-identifier hs-var">tcNestedSplice</span></a></span><span> </span><span class="annot"><span class="annottext">ThStage
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">PendingStuff
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681125543"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681125543"><span class="hs-identifier hs-var">splice_name</span></a></span></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-643"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; MsgDoc -&gt; TcM (HsExpr GhcTc)
forall a. HasCallStack =&gt; String -&gt; MsgDoc -&gt; a
</span><a href="GHC.Utils.Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tcNestedSplice: rename stage found&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; MsgDoc
forall a. Outputable a =&gt; a -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681125543"><span class="hs-identifier hs-var">splice_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-644"></span><span>
</span><span id="line-645"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#tcTopSplice"><span class="hs-identifier hs-type">tcTopSplice</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.TcType.html#ExpRhoType"><span class="hs-identifier hs-type">ExpRhoType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-646"></span><span id="tcTopSplice"><span class="annot"><span class="annottext">tcTopSplice :: LHsExpr GhcRn -&gt; ExpRhoType -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Splice.html#tcTopSplice"><span class="hs-identifier hs-var hs-var">tcTopSplice</span></a></span></span><span> </span><span id="local-6989586621681125542"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681125542"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span id="local-6989586621681125541"><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681125541"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span>
</span><span id="line-647"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-comment">-- Typecheck the expression,</span><span>
</span><span id="line-648"></span><span>         </span><span class="hs-comment">-- making sure it has type Q (T res_ty)</span><span>
</span><span id="line-649"></span><span>         </span><span id="local-6989586621681125540"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681125540"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ExpRhoType -&gt; IOEnv (Env TcGblEnv TcLclEnv) Type
</span><a href="GHC.Tc.Utils.TcMType.html#expTypeToType"><span class="hs-identifier hs-var">expTypeToType</span></a></span><span> </span><span class="annot"><span class="annottext">ExpRhoType
</span><a href="#local-6989586621681125541"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-650"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681125539"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681125539"><span class="hs-identifier hs-var">q_type</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) Type
</span><a href="GHC.Tc.Utils.Env.html#tcMetaTy"><span class="hs-identifier hs-var">tcMetaTy</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.TH.html#qTyConName"><span class="hs-identifier hs-var">qTyConName</span></a></span><span>
</span><span id="line-651"></span><span>       </span><span class="hs-comment">-- Top level splices must still be of type Q (TExp a)</span><span>
</span><span id="line-652"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681125537"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681125537"><span class="hs-identifier hs-var">meta_exp_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) Type
</span><a href="GHC.Tc.Gen.Splice.html#tcTExpTy"><span class="hs-identifier hs-var">tcTExpTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681125539"><span class="hs-identifier hs-var">q_type</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681125540"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-653"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681125536"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681125536"><span class="hs-identifier hs-var">q_expr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SpliceType -&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Splice.html#tcTopSpliceExpr"><span class="hs-identifier hs-var">tcTopSpliceExpr</span></a></span><span> </span><span class="annot"><span class="annottext">SpliceType
</span><a href="GHC.Tc.Types.html#Typed"><span class="hs-identifier hs-var">Typed</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-654"></span><span>                   </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; Type -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckMonoExpr"><span class="hs-identifier hs-var">tcCheckMonoExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681125542"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681125537"><span class="hs-identifier hs-var">meta_exp_ty</span></a></span><span>
</span><span id="line-655"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681125534"><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681125534"><span class="hs-identifier hs-var">lcl_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcLclEnv
forall gbl lcl. TcRnIf gbl lcl lcl
</span><a href="GHC.Tc.Utils.Monad.html#getLclEnv"><span class="hs-identifier hs-var">getLclEnv</span></a></span><span>
</span><span id="line-656"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681125532"><span class="annot"><span class="annottext">delayed_splice :: DelayedSplice
</span><a href="#local-6989586621681125532"><span class="hs-identifier hs-var hs-var">delayed_splice</span></a></span></span><span>
</span><span id="line-657"></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcLclEnv -&gt; LHsExpr GhcRn -&gt; Type -&gt; LHsExpr GhcTc -&gt; DelayedSplice
</span><a href="GHC.Hs.Expr.html#DelayedSplice"><span class="hs-identifier hs-var">DelayedSplice</span></a></span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681125534"><span class="hs-identifier hs-var">lcl_env</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681125542"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681125540"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681125536"><span class="hs-identifier hs-var">q_expr</span></a></span><span>
</span><span id="line-658"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XSpliceE GhcTc -&gt; HsSplice GhcTc -&gt; HsExpr GhcTc
forall p. XSpliceE p -&gt; HsSplice p -&gt; HsExpr p
</span><a href="GHC.Hs.Expr.html#HsSpliceE"><span class="hs-identifier hs-var">HsSpliceE</span></a></span><span> </span><span class="annot"><span class="annottext">NoExtField
XSpliceE GhcTc
</span><a href="GHC.Hs.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XXSplice GhcTc -&gt; HsSplice GhcTc
forall id. XXSplice id -&gt; HsSplice id
</span><a href="GHC.Hs.Expr.html#XSplice"><span class="hs-identifier hs-var">XSplice</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DelayedSplice -&gt; HsSplicedT
</span><a href="GHC.Hs.Expr.html#HsSplicedT"><span class="hs-identifier hs-var">HsSplicedT</span></a></span><span> </span><span class="annot"><span class="annottext">DelayedSplice
</span><a href="#local-6989586621681125532"><span class="hs-identifier hs-var">delayed_splice</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-659"></span><span>
</span><span id="line-660"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-661"></span><span>
</span><span id="line-662"></span><span>
</span><span id="line-663"></span><span class="hs-comment">-- This is called in the zonker</span><span>
</span><span id="line-664"></span><span class="hs-comment">-- See Note [Running typed splices in the zonker]</span><span>
</span><span id="line-665"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#runTopSplice"><span class="hs-identifier hs-type">runTopSplice</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#DelayedSplice"><span class="hs-identifier hs-type">DelayedSplice</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#HsExpr"><span class="hs-identifier hs-type">HsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-666"></span><span id="runTopSplice"><span class="annot"><span class="annottext">runTopSplice :: DelayedSplice -&gt; TcM (HsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Splice.html#runTopSplice"><span class="hs-identifier hs-var hs-var">runTopSplice</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#DelayedSplice"><span class="hs-identifier hs-type">DelayedSplice</span></a></span><span> </span><span id="local-6989586621681125528"><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681125528"><span class="hs-identifier hs-var">lcl_env</span></a></span></span><span> </span><span id="local-6989586621681125527"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681125527"><span class="hs-identifier hs-var">orig_expr</span></a></span></span><span> </span><span id="local-6989586621681125526"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681125526"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span id="local-6989586621681125525"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681125525"><span class="hs-identifier hs-var">q_expr</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-667"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-668"></span><span>      </span><span id="local-6989586621681125524"><span class="annot"><span class="annottext">TcRef Messages
</span><a href="#local-6989586621681125524"><span class="hs-identifier hs-var">errs_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn (TcRef Messages)
</span><a href="GHC.Tc.Utils.Monad.html#getErrsVar"><span class="hs-identifier hs-var">getErrsVar</span></a></span><span>
</span><span id="line-669"></span><span>      </span><span class="annot"><span class="annottext">TcLclEnv -&gt; TcM (HsExpr GhcTc) -&gt; TcM (HsExpr GhcTc)
forall lcl' gbl a lcl.
lcl' -&gt; TcRnIf gbl lcl' a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#setLclEnv"><span class="hs-identifier hs-var">setLclEnv</span></a></span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681125528"><span class="hs-identifier hs-var">lcl_env</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (HsExpr GhcTc) -&gt; TcM (HsExpr GhcTc))
-&gt; TcM (HsExpr GhcTc) -&gt; TcM (HsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef Messages -&gt; TcM (HsExpr GhcTc) -&gt; TcM (HsExpr GhcTc)
forall a. TcRef Messages -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setErrsVar"><span class="hs-identifier hs-var">setErrsVar</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef Messages
</span><a href="#local-6989586621681125524"><span class="hs-identifier hs-var">errs_var</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (HsExpr GhcTc) -&gt; TcM (HsExpr GhcTc))
-&gt; TcM (HsExpr GhcTc) -&gt; TcM (HsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-670"></span><span>         </span><span class="hs-comment">-- Set the errs_var to the errs_var from the current context,</span><span>
</span><span id="line-671"></span><span>         </span><span class="hs-comment">-- otherwise error messages can go missing in GHCi (#19470)</span><span>
</span><span id="line-672"></span><span>         </span><span id="local-6989586621681125520"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681125520"><span class="hs-identifier hs-var">zonked_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) Type
</span><a href="GHC.Tc.Utils.TcMType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681125526"><span class="hs-identifier hs-var">res_ty</span></a></span><span>
</span><span id="line-673"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681125518"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681125518"><span class="hs-identifier hs-var">zonked_q_expr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Utils.Zonk.html#zonkTopLExpr"><span class="hs-identifier hs-var">zonkTopLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681125525"><span class="hs-identifier hs-var">q_expr</span></a></span><span>
</span><span id="line-674"></span><span>        </span><span class="hs-comment">-- See Note [Collecting modFinalizers in typed splices].</span><span>
</span><span id="line-675"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681125516"><span class="annot"><span class="annottext">TcRef [ForeignRef (Q ())]
</span><a href="#local-6989586621681125516"><span class="hs-identifier hs-var">modfinalizers_ref</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[ForeignRef (Q ())]
-&gt; TcRnIf TcGblEnv TcLclEnv (TcRef [ForeignRef (Q ())])
forall a gbl lcl. a -&gt; TcRnIf gbl lcl (TcRef a)
</span><a href="GHC.Tc.Utils.Monad.html#newTcRef"><span class="hs-identifier hs-var">newTcRef</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-676"></span><span>         </span><span class="hs-comment">-- Run the expression</span><span>
</span><span id="line-677"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681125514"><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621681125514"><span class="hs-identifier hs-var">expr2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ThStage -&gt; TcM (LHsExpr GhcPs) -&gt; TcM (LHsExpr GhcPs)
forall a. ThStage -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#setStage"><span class="hs-identifier hs-var">setStage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcRef [ForeignRef (Q ())] -&gt; ThStage
</span><a href="GHC.Tc.Types.html#RunSplice"><span class="hs-identifier hs-var">RunSplice</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef [ForeignRef (Q ())]
</span><a href="#local-6989586621681125516"><span class="hs-identifier hs-var">modfinalizers_ref</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcPs) -&gt; TcM (LHsExpr GhcPs))
-&gt; TcM (LHsExpr GhcPs) -&gt; TcM (LHsExpr GhcPs)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-678"></span><span>                    </span><span class="annot"><span class="annottext">LHsExpr GhcTc -&gt; TcM (LHsExpr GhcPs)
</span><a href="GHC.Tc.Gen.Splice.html#runMetaE"><span class="hs-identifier hs-var">runMetaE</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681125518"><span class="hs-identifier hs-var">zonked_q_expr</span></a></span><span>
</span><span id="line-679"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681125513"><span class="annot"><span class="annottext">[ForeignRef (Q ())]
</span><a href="#local-6989586621681125513"><span class="hs-identifier hs-var">mod_finalizers</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRef [ForeignRef (Q ())]
-&gt; TcRnIf TcGblEnv TcLclEnv [ForeignRef (Q ())]
forall a gbl lcl. TcRef a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef [ForeignRef (Q ())]
</span><a href="#local-6989586621681125516"><span class="hs-identifier hs-var">modfinalizers_ref</span></a></span><span>
</span><span id="line-680"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">ThModFinalizers -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addModFinalizersWithLclEnv"><span class="hs-identifier hs-var">addModFinalizersWithLclEnv</span></a></span><span> </span><span class="annot"><span class="annottext">(ThModFinalizers -&gt; TcRn ()) -&gt; ThModFinalizers -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[ForeignRef (Q ())] -&gt; ThModFinalizers
</span><a href="GHC.Hs.Expr.html#ThModFinalizers"><span class="hs-identifier hs-var">ThModFinalizers</span></a></span><span> </span><span class="annot"><span class="annottext">[ForeignRef (Q ())]
</span><a href="#local-6989586621681125513"><span class="hs-identifier hs-var">mod_finalizers</span></a></span><span>
</span><span id="line-681"></span><span>       </span><span class="hs-comment">-- We use orig_expr here and not q_expr when tracing as a call to</span><span>
</span><span id="line-682"></span><span>       </span><span class="hs-comment">-- unsafeTExpCoerce is added to the original expression by the</span><span>
</span><span id="line-683"></span><span>       </span><span class="hs-comment">-- typechecker when typed quotes are type checked.</span><span>
</span><span id="line-684"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">SpliceInfo -&gt; TcRn ()
</span><a href="GHC.Rename.Splice.html#traceSplice"><span class="hs-identifier hs-var">traceSplice</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SpliceInfo :: String -&gt; Maybe (LHsExpr GhcRn) -&gt; Bool -&gt; MsgDoc -&gt; SpliceInfo
</span><a href="GHC.Rename.Splice.html#SpliceInfo"><span class="hs-identifier hs-type">SpliceInfo</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">spliceDescription :: String
</span><a href="GHC.Rename.Splice.html#spliceDescription"><span class="hs-identifier hs-var">spliceDescription</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;expression&quot;</span></span><span>
</span><span id="line-685"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">spliceIsDecl :: Bool
</span><a href="GHC.Rename.Splice.html#spliceIsDecl"><span class="hs-identifier hs-var">spliceIsDecl</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-686"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">spliceSource :: Maybe (LHsExpr GhcRn)
</span><a href="GHC.Rename.Splice.html#spliceSource"><span class="hs-identifier hs-var">spliceSource</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; Maybe (LHsExpr GhcRn)
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681125527"><span class="hs-identifier hs-var">orig_expr</span></a></span><span>
</span><span id="line-687"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">spliceGenerated :: MsgDoc
</span><a href="GHC.Rename.Splice.html#spliceGenerated"><span class="hs-identifier hs-var">spliceGenerated</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs -&gt; MsgDoc
forall a. Outputable a =&gt; a -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621681125514"><span class="hs-identifier hs-var">expr2</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-688"></span><span>        </span><span class="hs-comment">-- Rename and typecheck the spliced-in expression,</span><span>
</span><span id="line-689"></span><span>        </span><span class="hs-comment">-- making sure it has type res_ty</span><span>
</span><span id="line-690"></span><span>        </span><span class="hs-comment">-- These steps should never fail; this is a *typed* splice</span><span>
</span><span id="line-691"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681125505"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681125505"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681125504"><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621681125504"><span class="hs-identifier hs-var">wcs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-692"></span><span>            </span><span class="annot"><span class="annottext">TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc, WantedConstraints)
forall a. TcM a -&gt; TcM (a, WantedConstraints)
</span><a href="GHC.Tc.Utils.Monad.html#captureConstraints"><span class="hs-identifier hs-var">captureConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc, WantedConstraints))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc, WantedConstraints)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-693"></span><span>              </span><span class="annot"><span class="annottext">MsgDoc -&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a. MsgDoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsExpr GhcTc -&gt; MsgDoc
</span><a href="GHC.Tc.Gen.Splice.html#spliceResultDoc"><span class="hs-identifier hs-var">spliceResultDoc</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681125518"><span class="hs-identifier hs-var">zonked_q_expr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-694"></span><span>                </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681125501"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681125501"><span class="hs-identifier hs-var">exp3</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681125500"><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621681125500"><span class="hs-identifier hs-var">_fvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs -&gt; RnM (LHsExpr GhcRn, FreeVars)
</span><a href="GHC.Rename.Expr.html#rnLExpr"><span class="hs-identifier hs-var">rnLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs
</span><a href="#local-6989586621681125514"><span class="hs-identifier hs-var">expr2</span></a></span><span>
</span><span id="line-695"></span><span>                </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; Type -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Expr.html#tcCheckMonoExpr"><span class="hs-identifier hs-var">tcCheckMonoExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681125501"><span class="hs-identifier hs-var">exp3</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681125520"><span class="hs-identifier hs-var">zonked_ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-696"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681125498"><span class="annot"><span class="annottext">Bag EvBind
</span><a href="#local-6989586621681125498"><span class="hs-identifier hs-var">ev</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">WantedConstraints -&gt; TcM (Bag EvBind)
</span><a href="GHC.Tc.Solver.html#simplifyTop"><span class="hs-identifier hs-var">simplifyTop</span></a></span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621681125504"><span class="hs-identifier hs-var">wcs</span></a></span><span>
</span><span id="line-697"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(HsExpr GhcTc -&gt; TcM (HsExpr GhcTc))
-&gt; HsExpr GhcTc -&gt; TcM (HsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc -&gt; HsExpr GhcTc
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcEvBinds -&gt; LHsExpr GhcTc -&gt; LHsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsDictLet"><span class="hs-identifier hs-var">mkHsDictLet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bag EvBind -&gt; TcEvBinds
</span><a href="GHC.Tc.Types.Evidence.html#EvBinds"><span class="hs-identifier hs-var">EvBinds</span></a></span><span> </span><span class="annot"><span class="annottext">Bag EvBind
</span><a href="#local-6989586621681125498"><span class="hs-identifier hs-var">ev</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681125505"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-698"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-699"></span><span>
</span><span id="line-700"></span><span>
</span><span id="line-701"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Error messages}
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-708"></span><span>
</span><span id="line-709"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#spliceCtxtDoc"><span class="hs-identifier hs-type">spliceCtxtDoc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#HsSplice"><span class="hs-identifier hs-type">HsSplice</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcRn"><span class="hs-identifier hs-type">GhcRn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-710"></span><span id="spliceCtxtDoc"><span class="annot"><span class="annottext">spliceCtxtDoc :: HsSplice GhcRn -&gt; MsgDoc
</span><a href="GHC.Tc.Gen.Splice.html#spliceCtxtDoc"><span class="hs-identifier hs-var hs-var">spliceCtxtDoc</span></a></span></span><span> </span><span id="local-6989586621681125494"><span class="annot"><span class="annottext">HsSplice GhcRn
</span><a href="#local-6989586621681125494"><span class="hs-identifier hs-var">splice</span></a></span></span><span>
</span><span id="line-711"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MsgDoc -&gt; Arity -&gt; MsgDoc -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;In the Template Haskell splice&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-712"></span><span>         </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsSplice GhcRn -&gt; MsgDoc
forall (p :: Pass).
OutputableBndrId p =&gt;
HsSplice (GhcPass p) -&gt; MsgDoc
</span><a href="GHC.Hs.Expr.html#pprSplice"><span class="hs-identifier hs-var">pprSplice</span></a></span><span> </span><span class="annot"><span class="annottext">HsSplice GhcRn
</span><a href="#local-6989586621681125494"><span class="hs-identifier hs-var">splice</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-713"></span><span>
</span><span id="line-714"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#spliceResultDoc"><span class="hs-identifier hs-type">spliceResultDoc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-715"></span><span id="spliceResultDoc"><span class="annot"><span class="annottext">spliceResultDoc :: LHsExpr GhcTc -&gt; MsgDoc
</span><a href="GHC.Tc.Gen.Splice.html#spliceResultDoc"><span class="hs-identifier hs-var hs-var">spliceResultDoc</span></a></span></span><span> </span><span id="local-6989586621681125492"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681125492"><span class="hs-identifier hs-var">expr</span></a></span></span><span>
</span><span id="line-716"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[MsgDoc] -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">String -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;In the result of the splice:&quot;</span></span><span>
</span><span id="line-717"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Arity -&gt; MsgDoc -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Char -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#char"><span class="hs-identifier hs-var">char</span></a></span><span> </span><span class="annot"><span class="annottext">Char
</span><span class="hs-char">'$'</span></span><span> </span><span class="annot"><span class="annottext">MsgDoc -&gt; MsgDoc -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc -&gt; MsgDoc
forall a. Outputable a =&gt; a -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681125492"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-718"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;To see what the splice expanded to, use -ddump-splices&quot;</span></span><span class="hs-special">]</span><span>
</span><span id="line-719"></span><span>
</span><span id="line-720"></span><span class="hs-comment">-------------------</span><span>
</span><span id="line-721"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#tcTopSpliceExpr"><span class="hs-identifier hs-type">tcTopSpliceExpr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#SpliceType"><span class="hs-identifier hs-type">SpliceType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-722"></span><span class="hs-comment">-- Note [How top-level splices are handled]</span><span>
</span><span id="line-723"></span><span class="hs-comment">-- Type check an expression that is the body of a top-level splice</span><span>
</span><span id="line-724"></span><span class="hs-comment">--   (the caller will compile and run it)</span><span>
</span><span id="line-725"></span><span class="hs-comment">-- Note that set the level to Splice, regardless of the original level,</span><span>
</span><span id="line-726"></span><span class="hs-comment">-- before typechecking the expression.  For example:</span><span>
</span><span id="line-727"></span><span class="hs-comment">--      f x = $( ...$(g 3) ... )</span><span>
</span><span id="line-728"></span><span class="hs-comment">-- The recursive call to tcCheckPolyExpr will simply expand the</span><span>
</span><span id="line-729"></span><span class="hs-comment">-- inner escape before dealing with the outer one</span><span>
</span><span id="line-730"></span><span>
</span><span id="line-731"></span><span id="tcTopSpliceExpr"><span class="annot"><span class="annottext">tcTopSpliceExpr :: SpliceType -&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Splice.html#tcTopSpliceExpr"><span class="hs-identifier hs-var hs-var">tcTopSpliceExpr</span></a></span></span><span> </span><span id="local-6989586621681125487"><span class="annot"><span class="annottext">SpliceType
</span><a href="#local-6989586621681125487"><span class="hs-identifier hs-var">isTypedSplice</span></a></span></span><span> </span><span id="local-6989586621681125486"><span class="annot"><span class="annottext">TcM (LHsExpr GhcTc)
</span><a href="#local-6989586621681125486"><span class="hs-identifier hs-var">tc_action</span></a></span></span><span>
</span><span id="line-732"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall r. TcM r -&gt; TcM r
</span><a href="GHC.Tc.Utils.Monad.html#checkNoErrs"><span class="hs-identifier hs-var">checkNoErrs</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>  </span><span class="hs-comment">-- checkNoErrs: must not try to run the thing</span><span>
</span><span id="line-733"></span><span>                   </span><span class="hs-comment">-- if the type checker fails!</span><span>
</span><span id="line-734"></span><span>    </span><span class="annot"><span class="annottext">GeneralFlag -&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall gbl lcl a.
GeneralFlag -&gt; TcRnIf gbl lcl a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#unsetGOptM"><span class="hs-identifier hs-var">unsetGOptM</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_DeferTypeErrors"><span class="hs-identifier hs-var">Opt_DeferTypeErrors</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-735"></span><span>                   </span><span class="hs-comment">-- Don't defer type errors.  Not only are we</span><span>
</span><span id="line-736"></span><span>                   </span><span class="hs-comment">-- going to run this code, but we do an unsafe</span><span>
</span><span id="line-737"></span><span>                   </span><span class="hs-comment">-- coerce, so we get a seg-fault if, say we</span><span>
</span><span id="line-738"></span><span>                   </span><span class="hs-comment">-- splice a type into a place where an expression</span><span>
</span><span id="line-739"></span><span>                   </span><span class="hs-comment">-- is expected (#7276)</span><span>
</span><span id="line-740"></span><span>    </span><span class="annot"><span class="annottext">ThStage -&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a. ThStage -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#setStage"><span class="hs-identifier hs-var">setStage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SpliceType -&gt; ThStage
</span><a href="GHC.Tc.Types.html#Splice"><span class="hs-identifier hs-var">Splice</span></a></span><span> </span><span class="annot"><span class="annottext">SpliceType
</span><a href="#local-6989586621681125487"><span class="hs-identifier hs-var">isTypedSplice</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-741"></span><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>    </span><span class="hs-comment">-- Typecheck the expression</span><span>
</span><span id="line-742"></span><span>         </span><span class="hs-special">(</span><span id="local-6989586621681125482"><span class="annot"><span class="annottext">Maybe (LHsExpr GhcTc)
</span><a href="#local-6989586621681125482"><span class="hs-identifier hs-var">mb_expr'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681125481"><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621681125481"><span class="hs-identifier hs-var">wanted</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM (LHsExpr GhcTc)
-&gt; TcM (Maybe (LHsExpr GhcTc), WantedConstraints)
forall a. TcM a -&gt; TcM (Maybe a, WantedConstraints)
</span><a href="GHC.Tc.Utils.Monad.html#tryCaptureConstraints"><span class="hs-identifier hs-var">tryCaptureConstraints</span></a></span><span> </span><span class="annot"><span class="annottext">TcM (LHsExpr GhcTc)
</span><a href="#local-6989586621681125486"><span class="hs-identifier hs-var">tc_action</span></a></span><span>
</span><span id="line-743"></span><span>             </span><span class="hs-comment">-- If tc_action fails (perhaps because of insoluble constraints)</span><span>
</span><span id="line-744"></span><span>             </span><span class="hs-comment">-- we want to capture and report those constraints, else we may</span><span>
</span><span id="line-745"></span><span>             </span><span class="hs-comment">-- just get a silent failure (#20179). Hence the 'try' part.</span><span>
</span><span id="line-746"></span><span>
</span><span id="line-747"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681125479"><span class="annot"><span class="annottext">Bag EvBind
</span><a href="#local-6989586621681125479"><span class="hs-identifier hs-var">const_binds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">WantedConstraints -&gt; TcM (Bag EvBind)
</span><a href="GHC.Tc.Solver.html#simplifyTop"><span class="hs-identifier hs-var">simplifyTop</span></a></span><span> </span><span class="annot"><span class="annottext">WantedConstraints
</span><a href="#local-6989586621681125481"><span class="hs-identifier hs-var">wanted</span></a></span><span>
</span><span id="line-748"></span><span>
</span><span id="line-749"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (LHsExpr GhcTc)
</span><a href="#local-6989586621681125482"><span class="hs-identifier hs-var">mb_expr'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-750"></span><span>            </span><span class="annot"><span class="annottext">Maybe (LHsExpr GhcTc)
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM (LHsExpr GhcTc)
forall env a. IOEnv env a
</span><a href="GHC.Data.IOEnv.html#failM"><span class="hs-identifier hs-var">failM</span></a></span><span>   </span><span class="hs-comment">-- In this case simplifyTop should have</span><span>
</span><span id="line-751"></span><span>                                  </span><span class="hs-comment">-- reported some errors</span><span>
</span><span id="line-752"></span><span>            </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681125477"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681125477"><span class="hs-identifier hs-var">expr'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc -&gt; TcM (LHsExpr GhcTc)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(LHsExpr GhcTc -&gt; TcM (LHsExpr GhcTc))
-&gt; LHsExpr GhcTc -&gt; TcM (LHsExpr GhcTc)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TcEvBinds -&gt; LHsExpr GhcTc -&gt; LHsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsDictLet"><span class="hs-identifier hs-var">mkHsDictLet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bag EvBind -&gt; TcEvBinds
</span><a href="GHC.Tc.Types.Evidence.html#EvBinds"><span class="hs-identifier hs-var">EvBinds</span></a></span><span> </span><span class="annot"><span class="annottext">Bag EvBind
</span><a href="#local-6989586621681125479"><span class="hs-identifier hs-var">const_binds</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681125477"><span class="hs-identifier hs-var">expr'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-753"></span><span>
</span><span id="line-754"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
        Annotations
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-761"></span><span>
</span><span id="line-762"></span><span id="runAnnotation"><span class="annot"><span class="annottext">runAnnotation :: CoreAnnTarget -&gt; LHsExpr GhcRn -&gt; TcM Annotation
</span><a href="GHC.Tc.Gen.Splice.html#runAnnotation"><span class="hs-identifier hs-var hs-var">runAnnotation</span></a></span></span><span> </span><span id="local-6989586621681125476"><span class="annot"><span class="annottext">CoreAnnTarget
</span><a href="#local-6989586621681125476"><span class="hs-identifier hs-var">target</span></a></span></span><span> </span><span id="local-6989586621681125475"><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681125475"><span class="hs-identifier hs-var">expr</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-763"></span><span>    </span><span class="hs-comment">-- Find the classes we want instances for in order to call toAnnotationWrapper</span><span>
</span><span id="line-764"></span><span>    </span><span id="local-6989586621681125474"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681125474"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn SrcSpan
</span><a href="GHC.Tc.Utils.Monad.html#getSrcSpanM"><span class="hs-identifier hs-var">getSrcSpanM</span></a></span><span>
</span><span id="line-765"></span><span>    </span><span id="local-6989586621681125472"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681125472"><span class="hs-identifier hs-var">data_class</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Class
</span><a href="GHC.Tc.Utils.Env.html#tcLookupClass"><span class="hs-identifier hs-var">tcLookupClass</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#dataClassName"><span class="hs-identifier hs-var">dataClassName</span></a></span><span>
</span><span id="line-766"></span><span>    </span><span id="local-6989586621681125469"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681125469"><span class="hs-identifier hs-var">to_annotation_wrapper_id</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; IOEnv (Env TcGblEnv TcLclEnv) Id
</span><a href="GHC.Tc.Utils.Env.html#tcLookupId"><span class="hs-identifier hs-var">tcLookupId</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="GHC.Builtin.Names.html#toAnnotationWrapperName"><span class="hs-identifier hs-var">toAnnotationWrapperName</span></a></span><span>
</span><span id="line-767"></span><span>
</span><span id="line-768"></span><span>    </span><span class="hs-comment">-- Check the instances we require live in another module (we want to execute it..)</span><span>
</span><span id="line-769"></span><span>    </span><span class="hs-comment">-- and check identifiers live in other modules using TH stage checks. tcSimplifyStagedExpr</span><span>
</span><span id="line-770"></span><span>    </span><span class="hs-comment">-- also resolves the LIE constraints to detect e.g. instance ambiguity</span><span>
</span><span id="line-771"></span><span>    </span><span id="local-6989586621681125467"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681125467"><span class="hs-identifier hs-var">zonked_wrapped_expr'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Utils.Zonk.html#zonkTopLExpr"><span class="hs-identifier hs-var">zonkTopLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">(LHsExpr GhcTc -&gt; TcM (LHsExpr GhcTc))
-&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><a href="../../base/src/GHC.Base.html#%3D%3C%3C"><span class="hs-operator hs-var">=&lt;&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">SpliceType -&gt; TcM (LHsExpr GhcTc) -&gt; TcM (LHsExpr GhcTc)
</span><a href="GHC.Tc.Gen.Splice.html#tcTopSpliceExpr"><span class="hs-identifier hs-var">tcTopSpliceExpr</span></a></span><span> </span><span class="annot"><span class="annottext">SpliceType
</span><a href="GHC.Tc.Types.html#Untyped"><span class="hs-identifier hs-var">Untyped</span></a></span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-772"></span><span>           </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681125464"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681125464"><span class="hs-identifier hs-var">expr'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681125463"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681125463"><span class="hs-identifier hs-var">expr_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn -&gt; TcM (LHsExpr GhcTc, Type)
</span><a href="GHC.Tc.Gen.Expr.html#tcInferRhoNC"><span class="hs-identifier hs-var">tcInferRhoNC</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcRn
</span><a href="#local-6989586621681125475"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-773"></span><span>                </span><span class="hs-comment">-- We manually wrap the typechecked expression in a call to toAnnotationWrapper</span><span>
</span><span id="line-774"></span><span>                </span><span class="hs-comment">-- By instantiating the call &gt;here&lt; it gets registered in the</span><span>
</span><span id="line-775"></span><span>                </span><span class="hs-comment">-- LIE consulted by tcTopSpliceExpr</span><span>
</span><span id="line-776"></span><span>                </span><span class="hs-comment">-- and hence ensures the appropriate dictionary is bound by const_binds</span><span>
</span><span id="line-777"></span><span>              </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681125462"><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681125462"><span class="hs-identifier hs-var">wrapper</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CtOrigin -&gt; [Type] -&gt; [Type] -&gt; TcM HsWrapper
</span><a href="GHC.Tc.Utils.Instantiate.html#instCall"><span class="hs-identifier hs-var">instCall</span></a></span><span> </span><span class="annot"><span class="annottext">CtOrigin
</span><a href="GHC.Tc.Types.Origin.html#AnnOrigin"><span class="hs-identifier hs-var">AnnOrigin</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681125463"><span class="hs-identifier hs-var">expr_ty</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Class -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.Predicate.html#mkClassPred"><span class="hs-identifier hs-var">mkClassPred</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681125472"><span class="hs-identifier hs-var">data_class</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681125463"><span class="hs-identifier hs-var">expr_ty</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-778"></span><span>              </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681125458"><span class="annot"><span class="annottext">specialised_to_annotation_wrapper_expr :: LHsExpr GhcTc
</span><a href="#local-6989586621681125458"><span class="hs-identifier hs-var hs-var">specialised_to_annotation_wrapper_expr</span></a></span></span><span>
</span><span id="line-779"></span><span>                      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; HsExpr GhcTc -&gt; LHsExpr GhcTc
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681125474"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsWrapper -&gt; HsExpr GhcTc -&gt; HsExpr GhcTc
</span><a href="GHC.Hs.Utils.html#mkHsWrap"><span class="hs-identifier hs-var">mkHsWrap</span></a></span><span> </span><span class="annot"><span class="annottext">HsWrapper
</span><a href="#local-6989586621681125462"><span class="hs-identifier hs-var">wrapper</span></a></span><span>
</span><span id="line-780"></span><span>                                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XVar GhcTc -&gt; Located (IdP GhcTc) -&gt; HsExpr GhcTc
forall p. XVar p -&gt; Located (IdP p) -&gt; HsExpr p
</span><a href="GHC.Hs.Expr.html#HsVar"><span class="hs-identifier hs-var">HsVar</span></a></span><span> </span><span class="annot"><span class="annottext">NoExtField
XVar GhcTc
</span><a href="GHC.Hs.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; Id -&gt; GenLocated SrcSpan Id
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681125474"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681125469"><span class="hs-identifier hs-var">to_annotation_wrapper_id</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-781"></span><span>              </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc -&gt; TcM (LHsExpr GhcTc)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; HsExpr GhcTc -&gt; LHsExpr GhcTc
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681125474"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">XApp GhcTc -&gt; LHsExpr GhcTc -&gt; LHsExpr GhcTc -&gt; HsExpr GhcTc
forall p. XApp p -&gt; LHsExpr p -&gt; LHsExpr p -&gt; HsExpr p
</span><a href="GHC.Hs.Expr.html#HsApp"><span class="hs-identifier hs-var">HsApp</span></a></span><span> </span><span class="annot"><span class="annottext">NoExtField
XApp GhcTc
</span><a href="GHC.Hs.Extension.html#noExtField"><span class="hs-identifier hs-var">noExtField</span></a></span><span>
</span><span id="line-782"></span><span>                                </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681125458"><span class="hs-identifier hs-var">specialised_to_annotation_wrapper_expr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681125464"><span class="hs-identifier hs-var">expr'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-783"></span><span>                                </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-784"></span><span>
</span><span id="line-785"></span><span>    </span><span class="hs-comment">-- Run the appropriately wrapped expression to get the value of</span><span>
</span><span id="line-786"></span><span>    </span><span class="hs-comment">-- the annotation and its dictionaries. The return value is of</span><span>
</span><span id="line-787"></span><span>    </span><span class="hs-comment">-- type AnnotationWrapper by construction, so this conversion is</span><span>
</span><span id="line-788"></span><span>    </span><span class="hs-comment">-- safe</span><span>
</span><span id="line-789"></span><span>    </span><span id="local-6989586621681125453"><span class="annot"><span class="annottext">Serialized
</span><a href="#local-6989586621681125453"><span class="hs-identifier hs-var">serialized</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc -&gt; TcM Serialized
</span><a href="GHC.Tc.Gen.Splice.html#runMetaAW"><span class="hs-identifier hs-var">runMetaAW</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681125467"><span class="hs-identifier hs-var">zonked_wrapped_expr'</span></a></span><span>
</span><span id="line-790"></span><span>    </span><span class="annot"><span class="annottext">Annotation -&gt; TcM Annotation
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Annotation :: CoreAnnTarget -&gt; Serialized -&gt; Annotation
</span><a href="GHC.Types.Annotations.html#Annotation"><span class="hs-identifier hs-type">Annotation</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-791"></span><span>               </span><span class="annot"><span class="annottext">ann_target :: CoreAnnTarget
</span><a href="GHC.Types.Annotations.html#ann_target"><span class="hs-identifier hs-var">ann_target</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreAnnTarget
</span><a href="#local-6989586621681125476"><span class="hs-identifier hs-var">target</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-792"></span><span>               </span><span class="annot"><span class="annottext">ann_value :: Serialized
</span><a href="GHC.Types.Annotations.html#ann_value"><span class="hs-identifier hs-var">ann_value</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Serialized
</span><a href="#local-6989586621681125453"><span class="hs-identifier hs-var">serialized</span></a></span><span>
</span><span id="line-793"></span><span>           </span><span class="hs-special">}</span><span>
</span><span id="line-794"></span><span>
</span><span id="line-795"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#convertAnnotationWrapper"><span class="hs-identifier hs-type">convertAnnotationWrapper</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../ghci/src/GHCi.RemoteTypes.html#ForeignHValue"><span class="hs-identifier hs-type">ForeignHValue</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#MsgDoc"><span class="hs-identifier hs-type">MsgDoc</span></a></span><span> </span><span class="annot"><a href="../../ghc-boot/src/GHC.Serialized.html#Serialized"><span class="hs-identifier hs-type">Serialized</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-796"></span><span id="convertAnnotationWrapper"><span class="annot"><span class="annottext">convertAnnotationWrapper :: ForeignHValue -&gt; TcM (Either MsgDoc Serialized)
</span><a href="GHC.Tc.Gen.Splice.html#convertAnnotationWrapper"><span class="hs-identifier hs-var hs-var">convertAnnotationWrapper</span></a></span></span><span> </span><span id="local-6989586621681125447"><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621681125447"><span class="hs-identifier hs-var">fhv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-797"></span><span>  </span><span id="local-6989586621681125446"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621681125446"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM Interp
</span><a href="GHC.Tc.Gen.Splice.html#tcGetInterp"><span class="hs-identifier hs-var">tcGetInterp</span></a></span><span>
</span><span id="line-798"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621681125446"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-799"></span><span>    </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#ExternalInterp"><span class="hs-identifier hs-type">ExternalInterp</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Serialized -&gt; Either MsgDoc Serialized
forall a b. b -&gt; Either a b
</span><a href="../../base/src/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">(Serialized -&gt; Either MsgDoc Serialized)
-&gt; TcM Serialized -&gt; TcM (Either MsgDoc Serialized)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">THResultType -&gt; ForeignHValue -&gt; TcM Serialized
forall a. Binary a =&gt; THResultType -&gt; ForeignHValue -&gt; TcM a
</span><a href="GHC.Tc.Gen.Splice.html#runTH"><span class="hs-identifier hs-var">runTH</span></a></span><span> </span><span class="annot"><span class="annottext">THResultType
</span><a href="../../ghci/src/GHCi.Message.html#THAnnWrapper"><span class="hs-identifier hs-var">THAnnWrapper</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621681125447"><span class="hs-identifier hs-var">fhv</span></a></span><span class="hs-cpp">
#if defined(HAVE_INTERNAL_INTERPRETER)
</span><span>    </span><span class="annot"><span class="annottext">Interp
</span><a href="GHC.Runtime.Interpreter.Types.html#InternalInterp"><span class="hs-identifier hs-var">InternalInterp</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-802"></span><span>      </span><span id="local-6989586621681125440"><span class="annot"><span class="annottext">HValue
</span><a href="#local-6989586621681125440"><span class="hs-identifier hs-var">annotation_wrapper</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO HValue -&gt; IOEnv (Env TcGblEnv TcLclEnv) HValue
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO HValue -&gt; IOEnv (Env TcGblEnv TcLclEnv) HValue)
-&gt; IO HValue -&gt; IOEnv (Env TcGblEnv TcLclEnv) HValue
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Interp -&gt; ForeignHValue -&gt; IO HValue
forall a. Interp -&gt; ForeignRef a -&gt; IO a
</span><a href="GHC.Runtime.Interpreter.html#wormhole"><span class="hs-identifier hs-var">wormhole</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="GHC.Runtime.Interpreter.Types.html#InternalInterp"><span class="hs-identifier hs-var">InternalInterp</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621681125447"><span class="hs-identifier hs-var">fhv</span></a></span><span>
</span><span id="line-803"></span><span>      </span><span class="annot"><span class="annottext">Either MsgDoc Serialized -&gt; TcM (Either MsgDoc Serialized)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Either MsgDoc Serialized -&gt; TcM (Either MsgDoc Serialized))
-&gt; Either MsgDoc Serialized -&gt; TcM (Either MsgDoc Serialized)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Serialized -&gt; Either MsgDoc Serialized
forall a b. b -&gt; Either a b
</span><a href="../../base/src/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">(Serialized -&gt; Either MsgDoc Serialized)
-&gt; Serialized -&gt; Either MsgDoc Serialized
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-804"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HValue -&gt; AnnotationWrapper
forall a b. a -&gt; b
</span><a href="../../base/src/Unsafe.Coerce.html#unsafeCoerce"><span class="hs-identifier hs-var">unsafeCoerce</span></a></span><span> </span><span class="annot"><span class="annottext">HValue
</span><a href="#local-6989586621681125440"><span class="hs-identifier hs-var">annotation_wrapper</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-805"></span><span>           </span><span class="annot"><a href="../../base/src/GHC.Desugar.html#AnnotationWrapper"><span class="hs-identifier hs-type">AnnotationWrapper</span></a></span><span> </span><span id="local-6989586621681125431"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681125431"><span class="hs-identifier hs-var">value</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681125430"><span class="annot"><span class="annottext">serialized :: Serialized
</span><a href="#local-6989586621681125430"><span class="hs-identifier hs-var hs-var">serialized</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; [Word8]) -&gt; a -&gt; Serialized
forall a. Typeable a =&gt; (a -&gt; [Word8]) -&gt; a -&gt; Serialized
</span><a href="../../ghc-boot/src/GHC.Serialized.html#toSerialized"><span class="hs-identifier hs-var">toSerialized</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; [Word8]
forall a. Data a =&gt; a -&gt; [Word8]
</span><a href="../../ghc-boot/src/GHC.Serialized.html#serializeWithData"><span class="hs-identifier hs-var">serializeWithData</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681125431"><span class="hs-identifier hs-var">value</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-806"></span><span>               </span><span class="hs-comment">-- Got the value and dictionaries: build the serialized value and</span><span>
</span><span id="line-807"></span><span>               </span><span class="hs-comment">-- call it a day. We ensure that we seq the entire serialized value</span><span>
</span><span id="line-808"></span><span>               </span><span class="hs-comment">-- in order that any errors in the user-written code for the</span><span>
</span><span id="line-809"></span><span>               </span><span class="hs-comment">-- annotation are exposed at this point.  This is also why we are</span><span>
</span><span id="line-810"></span><span>               </span><span class="hs-comment">-- doing all this stuff inside the context of runMeta: it has the</span><span>
</span><span id="line-811"></span><span>               </span><span class="hs-comment">-- facilities to deal with user error in a meta-level expression</span><span>
</span><span id="line-812"></span><span>               </span><span class="annot"><span class="annottext">Serialized -&gt; ()
</span><a href="GHC.Tc.Gen.Splice.html#seqSerialized"><span class="hs-identifier hs-var">seqSerialized</span></a></span><span> </span><span class="annot"><span class="annottext">Serialized
</span><a href="#local-6989586621681125430"><span class="hs-identifier hs-var">serialized</span></a></span><span> </span><span class="annot"><span class="annottext">() -&gt; Serialized -&gt; Serialized
</span><span class="hs-operator hs-var">`seq`</span></span><span> </span><span class="annot"><span class="annottext">Serialized
</span><a href="#local-6989586621681125430"><span class="hs-identifier hs-var">serialized</span></a></span><span>
</span><span id="line-813"></span><span>
</span><span id="line-814"></span><span class="hs-comment">-- | Force the contents of the Serialized value so weknow it doesn't contain any bottoms</span><span>
</span><span id="line-815"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#seqSerialized"><span class="hs-identifier hs-type">seqSerialized</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../ghc-boot/src/GHC.Serialized.html#Serialized"><span class="hs-identifier hs-type">Serialized</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-816"></span><span id="seqSerialized"><span class="annot"><span class="annottext">seqSerialized :: Serialized -&gt; ()
</span><a href="GHC.Tc.Gen.Splice.html#seqSerialized"><span class="hs-identifier hs-var hs-var">seqSerialized</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../ghc-boot/src/GHC.Serialized.html#Serialized"><span class="hs-identifier hs-type">Serialized</span></a></span><span> </span><span id="local-6989586621681125425"><span class="annot"><span class="annottext">TypeRep
</span><a href="#local-6989586621681125425"><span class="hs-identifier hs-var">the_type</span></a></span></span><span> </span><span id="local-6989586621681125424"><span class="annot"><span class="annottext">[Word8]
</span><a href="#local-6989586621681125424"><span class="hs-identifier hs-var">bytes</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TypeRep
</span><a href="#local-6989586621681125425"><span class="hs-identifier hs-var">the_type</span></a></span><span> </span><span class="annot"><span class="annottext">TypeRep -&gt; () -&gt; ()
</span><span class="hs-operator hs-var">`seq`</span></span><span> </span><span class="annot"><span class="annottext">[Word8]
</span><a href="#local-6989586621681125424"><span class="hs-identifier hs-var">bytes</span></a></span><span> </span><span class="annot"><span class="annottext">[Word8] -&gt; () -&gt; ()
forall a b. [a] -&gt; b -&gt; b
</span><a href="GHC.Utils.Misc.html#seqList"><span class="hs-operator hs-var">`seqList`</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-cpp">

#endif
</span><span>
</span><span id="line-820"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
\subsection{Running an expression}
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-827"></span><span>
</span><span id="line-828"></span><span id="local-6989586621681126703"><span class="annot"><a href="GHC.Tc.Gen.Splice.html#runQuasi"><span class="hs-identifier hs-type">runQuasi</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Q"><span class="hs-identifier hs-type">TH.Q</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681126703"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681126703"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-829"></span><span id="runQuasi"><span class="annot"><span class="annottext">runQuasi :: forall a. Q a -&gt; TcM a
</span><a href="GHC.Tc.Gen.Splice.html#runQuasi"><span class="hs-identifier hs-var hs-var">runQuasi</span></a></span></span><span> </span><span id="local-6989586621681125421"><span class="annot"><span class="annottext">Q a
</span><a href="#local-6989586621681125421"><span class="hs-identifier hs-var">act</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Q a -&gt; IOEnv (Env TcGblEnv TcLclEnv) a
forall (m :: * -&gt; *) a. Quasi m =&gt; Q a -&gt; m a
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#runQ"><span class="hs-identifier hs-var">TH.runQ</span></a></span><span> </span><span class="annot"><span class="annottext">Q a
</span><a href="#local-6989586621681125421"><span class="hs-identifier hs-var">act</span></a></span><span>
</span><span id="line-830"></span><span>
</span><span id="line-831"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#runRemoteModFinalizers"><span class="hs-identifier hs-type">runRemoteModFinalizers</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#ThModFinalizers"><span class="hs-identifier hs-type">ThModFinalizers</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-832"></span><span id="runRemoteModFinalizers"><span class="annot"><span class="annottext">runRemoteModFinalizers :: ThModFinalizers -&gt; TcRn ()
</span><a href="GHC.Tc.Gen.Splice.html#runRemoteModFinalizers"><span class="hs-identifier hs-var hs-var">runRemoteModFinalizers</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#ThModFinalizers"><span class="hs-identifier hs-type">ThModFinalizers</span></a></span><span> </span><span id="local-6989586621681125419"><span class="annot"><span class="annottext">[ForeignRef (Q ())]
</span><a href="#local-6989586621681125419"><span class="hs-identifier hs-var">finRefs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-833"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681125418"><span class="annot"><span class="annottext">withForeignRefs :: [ForeignRef a] -&gt; ([RemoteRef a] -&gt; IO b) -&gt; IO b
</span><a href="#local-6989586621681125418"><span class="hs-identifier hs-var hs-var">withForeignRefs</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621681125417"><span class="annot"><span class="annottext">[RemoteRef a] -&gt; IO b
</span><a href="#local-6989586621681125417"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[RemoteRef a] -&gt; IO b
</span><a href="#local-6989586621681125417"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-834"></span><span>      </span><span class="annot"><a href="#local-6989586621681125418"><span class="hs-identifier hs-var">withForeignRefs</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681125416"><span class="annot"><span class="annottext">ForeignRef a
</span><a href="#local-6989586621681125416"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681125415"><span class="annot"><span class="annottext">[ForeignRef a]
</span><a href="#local-6989586621681125415"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681125414"><span class="annot"><span class="annottext">[RemoteRef a] -&gt; IO b
</span><a href="#local-6989586621681125414"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ForeignRef a -&gt; (RemoteRef a -&gt; IO b) -&gt; IO b
forall a b. ForeignRef a -&gt; (RemoteRef a -&gt; IO b) -&gt; IO b
</span><a href="../../ghci/src/GHCi.RemoteTypes.html#withForeignRef"><span class="hs-identifier hs-var">withForeignRef</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignRef a
</span><a href="#local-6989586621681125416"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="annot"><span class="annottext">((RemoteRef a -&gt; IO b) -&gt; IO b) -&gt; (RemoteRef a -&gt; IO b) -&gt; IO b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681125412"><span class="annot"><span class="annottext">RemoteRef a
</span><a href="#local-6989586621681125412"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-835"></span><span>        </span><span class="annot"><span class="annottext">[ForeignRef a] -&gt; ([RemoteRef a] -&gt; IO b) -&gt; IO b
</span><a href="#local-6989586621681125418"><span class="hs-identifier hs-var">withForeignRefs</span></a></span><span> </span><span class="annot"><span class="annottext">[ForeignRef a]
</span><a href="#local-6989586621681125415"><span class="hs-identifier hs-var">xs</span></a></span><span> </span><span class="annot"><span class="annottext">(([RemoteRef a] -&gt; IO b) -&gt; IO b)
-&gt; ([RemoteRef a] -&gt; IO b) -&gt; IO b
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681125411"><span class="annot"><span class="annottext">[RemoteRef a]
</span><a href="#local-6989586621681125411"><span class="hs-identifier hs-var">rs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[RemoteRef a] -&gt; IO b
</span><a href="#local-6989586621681125414"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RemoteRef a
</span><a href="#local-6989586621681125412"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteRef a -&gt; [RemoteRef a] -&gt; [RemoteRef a]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[RemoteRef a]
</span><a href="#local-6989586621681125411"><span class="hs-identifier hs-var">rs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-836"></span><span>  </span><span id="local-6989586621681125410"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621681125410"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM Interp
</span><a href="GHC.Tc.Gen.Splice.html#tcGetInterp"><span class="hs-identifier hs-var">tcGetInterp</span></a></span><span>
</span><span id="line-837"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621681125410"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="hs-keyword">of</span><span class="hs-cpp">
#if defined(HAVE_INTERNAL_INTERPRETER)
</span><span>    </span><span class="annot"><span class="annottext">Interp
</span><a href="GHC.Runtime.Interpreter.Types.html#InternalInterp"><span class="hs-identifier hs-var">InternalInterp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-840"></span><span>      </span><span id="local-6989586621681125409"><span class="annot"><span class="annottext">[Q ()]
</span><a href="#local-6989586621681125409"><span class="hs-identifier hs-var">qs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO [Q ()] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [Q ()]
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ForeignRef (Q ())]
-&gt; ([RemoteRef (Q ())] -&gt; IO [Q ()]) -&gt; IO [Q ()]
forall {a} {b}. [ForeignRef a] -&gt; ([RemoteRef a] -&gt; IO b) -&gt; IO b
</span><a href="#local-6989586621681125418"><span class="hs-identifier hs-var">withForeignRefs</span></a></span><span> </span><span class="annot"><span class="annottext">[ForeignRef (Q ())]
</span><a href="#local-6989586621681125419"><span class="hs-identifier hs-var">finRefs</span></a></span><span> </span><span class="annot"><span class="annottext">(([RemoteRef (Q ())] -&gt; IO [Q ()]) -&gt; IO [Q ()])
-&gt; ([RemoteRef (Q ())] -&gt; IO [Q ()]) -&gt; IO [Q ()]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(RemoteRef (Q ()) -&gt; IO (Q ())) -&gt; [RemoteRef (Q ())] -&gt; IO [Q ()]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteRef (Q ()) -&gt; IO (Q ())
forall a. RemoteRef a -&gt; IO a
</span><a href="../../ghci/src/GHCi.RemoteTypes.html#localRef"><span class="hs-identifier hs-var">localRef</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-841"></span><span>      </span><span class="annot"><span class="annottext">Q () -&gt; TcRn ()
forall a. Q a -&gt; TcM a
</span><a href="GHC.Tc.Gen.Splice.html#runQuasi"><span class="hs-identifier hs-var">runQuasi</span></a></span><span> </span><span class="annot"><span class="annottext">(Q () -&gt; TcRn ()) -&gt; Q () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Q ()] -&gt; Q ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Foldable t, Monad m) =&gt;
t (m a) -&gt; m ()
</span><a href="../../base/src/Data.Foldable.html#sequence_"><span class="hs-identifier hs-var">sequence_</span></a></span><span> </span><span class="annot"><span class="annottext">[Q ()]
</span><a href="#local-6989586621681125409"><span class="hs-identifier hs-var">qs</span></a></span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-844"></span><span>    </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#ExternalInterp"><span class="hs-identifier hs-type">ExternalInterp</span></a></span><span> </span><span id="local-6989586621681125406"><span class="annot"><span class="annottext">IServConfig
</span><a href="#local-6989586621681125406"><span class="hs-identifier hs-var">conf</span></a></span></span><span> </span><span id="local-6989586621681125405"><span class="annot"><span class="annottext">IServ
</span><a href="#local-6989586621681125405"><span class="hs-identifier hs-var">iserv</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IServConfig -&gt; IServ -&gt; (IServInstance -&gt; TcRn ()) -&gt; TcRn ()
forall (m :: * -&gt; *) a.
(MonadIO m, ExceptionMonad m) =&gt;
IServConfig -&gt; IServ -&gt; (IServInstance -&gt; m a) -&gt; m a
</span><a href="GHC.Runtime.Interpreter.html#withIServ_"><span class="hs-identifier hs-var">withIServ_</span></a></span><span> </span><span class="annot"><span class="annottext">IServConfig
</span><a href="#local-6989586621681125406"><span class="hs-identifier hs-var">conf</span></a></span><span> </span><span class="annot"><span class="annottext">IServ
</span><a href="#local-6989586621681125405"><span class="hs-identifier hs-var">iserv</span></a></span><span> </span><span class="annot"><span class="annottext">((IServInstance -&gt; TcRn ()) -&gt; TcRn ())
-&gt; (IServInstance -&gt; TcRn ()) -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681125403"><span class="annot"><span class="annottext">IServInstance
</span><a href="#local-6989586621681125403"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-845"></span><span>      </span><span id="local-6989586621681125402"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681125402"><span class="hs-identifier hs-var">tcg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-846"></span><span>      </span><span id="local-6989586621681125400"><span class="annot"><span class="annottext">Maybe (ForeignRef (IORef QState))
</span><a href="#local-6989586621681125400"><span class="hs-identifier hs-var">th_state</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRef (Maybe (ForeignRef (IORef QState)))
-&gt; TcRnIf TcGblEnv TcLclEnv (Maybe (ForeignRef (IORef QState)))
forall a gbl lcl. TcRef a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; TcRef (Maybe (ForeignRef (IORef QState)))
</span><a href="GHC.Tc.Types.html#tcg_th_remote_state"><span class="hs-identifier hs-var hs-var">tcg_th_remote_state</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681125402"><span class="hs-identifier hs-var">tcg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-847"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (ForeignRef (IORef QState))
</span><a href="#local-6989586621681125400"><span class="hs-identifier hs-var">th_state</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-848"></span><span>        </span><span class="annot"><span class="annottext">Maybe (ForeignRef (IORef QState))
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- TH was not started, nothing to do</span><span>
</span><span id="line-849"></span><span>        </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681125398"><span class="annot"><span class="annottext">ForeignRef (IORef QState)
</span><a href="#local-6989586621681125398"><span class="hs-identifier hs-var">fhv</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-850"></span><span>          </span><span class="annot"><span class="annottext">IO () -&gt; TcRn ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; TcRn ()) -&gt; IO () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignRef (IORef QState)
-&gt; (RemoteRef (IORef QState) -&gt; IO ()) -&gt; IO ()
forall a b. ForeignRef a -&gt; (RemoteRef a -&gt; IO b) -&gt; IO b
</span><a href="../../ghci/src/GHCi.RemoteTypes.html#withForeignRef"><span class="hs-identifier hs-var">withForeignRef</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignRef (IORef QState)
</span><a href="#local-6989586621681125398"><span class="hs-identifier hs-var">fhv</span></a></span><span> </span><span class="annot"><span class="annottext">((RemoteRef (IORef QState) -&gt; IO ()) -&gt; IO ())
-&gt; (RemoteRef (IORef QState) -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681125397"><span class="annot"><span class="annottext">RemoteRef (IORef QState)
</span><a href="#local-6989586621681125397"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-851"></span><span>            </span><span class="annot"><span class="annottext">[ForeignRef (Q ())] -&gt; ([RemoteRef (Q ())] -&gt; IO ()) -&gt; IO ()
forall {a} {b}. [ForeignRef a] -&gt; ([RemoteRef a] -&gt; IO b) -&gt; IO b
</span><a href="#local-6989586621681125418"><span class="hs-identifier hs-var">withForeignRefs</span></a></span><span> </span><span class="annot"><span class="annottext">[ForeignRef (Q ())]
</span><a href="#local-6989586621681125419"><span class="hs-identifier hs-var">finRefs</span></a></span><span> </span><span class="annot"><span class="annottext">(([RemoteRef (Q ())] -&gt; IO ()) -&gt; IO ())
-&gt; ([RemoteRef (Q ())] -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681125396"><span class="annot"><span class="annottext">[RemoteRef (Q ())]
</span><a href="#local-6989586621681125396"><span class="hs-identifier hs-var">qrefs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-852"></span><span>              </span><span class="annot"><span class="annottext">IServInstance -&gt; Put -&gt; IO ()
</span><a href="GHC.Runtime.Interpreter.html#writeIServ"><span class="hs-identifier hs-var">writeIServ</span></a></span><span> </span><span class="annot"><span class="annottext">IServInstance
</span><a href="#local-6989586621681125403"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Message (QResult ()) -&gt; Put
forall a. Message a -&gt; Put
</span><a href="../../ghci/src/GHCi.Message.html#putMessage"><span class="hs-identifier hs-var">putMessage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RemoteRef (IORef QState)
-&gt; [RemoteRef (Q ())] -&gt; Message (QResult ())
</span><a href="../../ghci/src/GHCi.Message.html#RunModFinalizers"><span class="hs-identifier hs-var">RunModFinalizers</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteRef (IORef QState)
</span><a href="#local-6989586621681125397"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">[RemoteRef (Q ())]
</span><a href="#local-6989586621681125396"><span class="hs-identifier hs-var">qrefs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-853"></span><span>          </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IServInstance -&gt; [Messages] -&gt; TcRn ()
</span><a href="GHC.Tc.Gen.Splice.html#runRemoteTH"><span class="hs-identifier hs-var">runRemoteTH</span></a></span><span> </span><span class="annot"><span class="annottext">IServInstance
</span><a href="#local-6989586621681125403"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-854"></span><span>          </span><span class="annot"><span class="annottext">IServInstance -&gt; TcRn ()
forall a. Binary a =&gt; IServInstance -&gt; TcM a
</span><a href="GHC.Tc.Gen.Splice.html#readQResult"><span class="hs-identifier hs-var">readQResult</span></a></span><span> </span><span class="annot"><span class="annottext">IServInstance
</span><a href="#local-6989586621681125403"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-855"></span><span>
</span><span id="line-856"></span><span id="local-6989586621681126678"><span id="local-6989586621681126679"><span class="annot"><a href="GHC.Tc.Gen.Splice.html#runQResult"><span class="hs-identifier hs-type">runQResult</span></a></span><span>
</span><span id="line-857"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681126679"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-858"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Basic.html#Origin"><span class="hs-identifier hs-type">Origin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681126679"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681126678"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-859"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../ghci/src/GHCi.RemoteTypes.html#ForeignHValue"><span class="hs-identifier hs-type">ForeignHValue</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681126679"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-860"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span>
</span><span id="line-861"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghci/src/GHCi.RemoteTypes.html#ForeignHValue"><span class="hs-identifier hs-type">ForeignHValue</span></a></span><span> </span><span class="hs-comment">{- TH.Q a -}</span><span>
</span><span id="line-862"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681126678"><span class="hs-identifier hs-type">b</span></a></span></span></span><span>
</span><span id="line-863"></span><span id="runQResult"><span class="annot"><span class="annottext">runQResult :: forall a b.
(a -&gt; String)
-&gt; (Origin -&gt; SrcSpan -&gt; a -&gt; b)
-&gt; (ForeignHValue -&gt; TcM a)
-&gt; SrcSpan
-&gt; ForeignHValue
-&gt; TcM b
</span><a href="GHC.Tc.Gen.Splice.html#runQResult"><span class="hs-identifier hs-var hs-var">runQResult</span></a></span></span><span> </span><span id="local-6989586621681125385"><span class="annot"><span class="annottext">a -&gt; String
</span><a href="#local-6989586621681125385"><span class="hs-identifier hs-var">show_th</span></a></span></span><span> </span><span id="local-6989586621681125384"><span class="annot"><span class="annottext">Origin -&gt; SrcSpan -&gt; a -&gt; b
</span><a href="#local-6989586621681125384"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span id="local-6989586621681125383"><span class="annot"><span class="annottext">ForeignHValue -&gt; TcM a
</span><a href="#local-6989586621681125383"><span class="hs-identifier hs-var">runQ</span></a></span></span><span> </span><span id="local-6989586621681125382"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681125382"><span class="hs-identifier hs-var">expr_span</span></a></span></span><span> </span><span id="local-6989586621681125381"><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621681125381"><span class="hs-identifier hs-var">hval</span></a></span></span><span>
</span><span id="line-864"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681125380"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681125380"><span class="hs-identifier hs-var">th_result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ForeignHValue -&gt; TcM a
</span><a href="#local-6989586621681125383"><span class="hs-identifier hs-var">runQ</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621681125381"><span class="hs-identifier hs-var">hval</span></a></span><span>
</span><span id="line-865"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681125379"><span class="annot"><span class="annottext">Origin
</span><a href="#local-6989586621681125379"><span class="hs-identifier hs-var">th_origin</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM Origin
</span><a href="GHC.Tc.Gen.Splice.html#getThSpliceOrigin"><span class="hs-identifier hs-var">getThSpliceOrigin</span></a></span><span>
</span><span id="line-866"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; MsgDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Got TH result:&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; String
</span><a href="#local-6989586621681125385"><span class="hs-identifier hs-var">show_th</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681125380"><span class="hs-identifier hs-var">th_result</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-867"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">b -&gt; TcM b
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Origin -&gt; SrcSpan -&gt; a -&gt; b
</span><a href="#local-6989586621681125384"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">Origin
</span><a href="#local-6989586621681125379"><span class="hs-identifier hs-var">th_origin</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681125382"><span class="hs-identifier hs-var">expr_span</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681125380"><span class="hs-identifier hs-var">th_result</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-868"></span><span>
</span><span id="line-869"></span><span>
</span><span id="line-870"></span><span class="hs-comment">-----------------</span><span>
</span><span id="line-871"></span><span id="local-6989586621681126674"><span class="annot"><a href="GHC.Tc.Gen.Splice.html#runMeta"><span class="hs-identifier hs-type">runMeta</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Types.html#MetaHook"><span class="hs-identifier hs-type">MetaHook</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681126674"><span class="hs-identifier hs-type">hs_syn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-872"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span>
</span><span id="line-873"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681126674"><span class="hs-identifier hs-type">hs_syn</span></a></span></span><span>
</span><span id="line-874"></span><span id="runMeta"><span class="annot"><span class="annottext">runMeta :: forall hs_syn.
(MetaHook TcM -&gt; LHsExpr GhcTc -&gt; TcM hs_syn)
-&gt; LHsExpr GhcTc -&gt; TcM hs_syn
</span><a href="GHC.Tc.Gen.Splice.html#runMeta"><span class="hs-identifier hs-var hs-var">runMeta</span></a></span></span><span> </span><span id="local-6989586621681125371"><span class="annot"><span class="annottext">MetaHook TcM -&gt; LHsExpr GhcTc -&gt; TcM hs_syn
</span><a href="#local-6989586621681125371"><span class="hs-identifier hs-var">unwrap</span></a></span></span><span> </span><span id="local-6989586621681125370"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681125370"><span class="hs-identifier hs-var">e</span></a></span></span><span>
</span><span id="line-875"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681125369"><span class="annot"><span class="annottext">MetaHook TcM
</span><a href="#local-6989586621681125369"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Hooks -&gt; Maybe (MetaHook TcM))
-&gt; MetaHook TcM -&gt; IOEnv (Env TcGblEnv TcLclEnv) (MetaHook TcM)
forall (f :: * -&gt; *) a.
(Functor f, HasDynFlags f) =&gt;
(Hooks -&gt; Maybe a) -&gt; a -&gt; f a
</span><a href="GHC.Driver.Hooks.html#getHooked"><span class="hs-identifier hs-var">getHooked</span></a></span><span> </span><span class="annot"><span class="annottext">Hooks -&gt; Maybe (MetaHook TcM)
</span><a href="GHC.Driver.Hooks.html#runMetaHook"><span class="hs-identifier hs-var hs-var">runMetaHook</span></a></span><span> </span><span class="annot"><span class="annottext">MetaHook TcM
</span><a href="GHC.Tc.Gen.Splice.html#defaultRunMeta"><span class="hs-identifier hs-var">defaultRunMeta</span></a></span><span>
</span><span id="line-876"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">MetaHook TcM -&gt; LHsExpr GhcTc -&gt; TcM hs_syn
</span><a href="#local-6989586621681125371"><span class="hs-identifier hs-var">unwrap</span></a></span><span> </span><span class="annot"><span class="annottext">MetaHook TcM
</span><a href="#local-6989586621681125369"><span class="hs-identifier hs-var">h</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681125370"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-877"></span><span>
</span><span id="line-878"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#defaultRunMeta"><span class="hs-identifier hs-type">defaultRunMeta</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#MetaHook"><span class="hs-identifier hs-type">MetaHook</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span>
</span><span id="line-879"></span><span id="defaultRunMeta"><span class="annot"><span class="annottext">defaultRunMeta :: MetaHook TcM
</span><a href="GHC.Tc.Gen.Splice.html#defaultRunMeta"><span class="hs-identifier hs-var hs-var">defaultRunMeta</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Types.html#MetaE"><span class="hs-identifier hs-type">MetaE</span></a></span><span> </span><span id="local-6989586621681125365"><span class="annot"><span class="annottext">LHsExpr GhcPs -&gt; MetaResult
</span><a href="#local-6989586621681125365"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-880"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LHsExpr GhcPs -&gt; MetaResult)
-&gt; TcM (LHsExpr GhcPs) -&gt; IOEnv (Env TcGblEnv TcLclEnv) MetaResult
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs -&gt; MetaResult
</span><a href="#local-6989586621681125365"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (LHsExpr GhcPs) -&gt; IOEnv (Env TcGblEnv TcLclEnv) MetaResult)
-&gt; (LHsExpr GhcTc -&gt; TcM (LHsExpr GhcPs))
-&gt; LHsExpr GhcTc
-&gt; IOEnv (Env TcGblEnv TcLclEnv) MetaResult
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; (LHsExpr GhcPs -&gt; MsgDoc)
-&gt; (SrcSpan
    -&gt; ForeignHValue -&gt; TcM (Either MsgDoc (LHsExpr GhcPs)))
-&gt; LHsExpr GhcTc
-&gt; TcM (LHsExpr GhcPs)
forall hs_syn.
Bool
-&gt; (hs_syn -&gt; MsgDoc)
-&gt; (SrcSpan -&gt; ForeignHValue -&gt; TcM (Either MsgDoc hs_syn))
-&gt; LHsExpr GhcTc
-&gt; TcM hs_syn
</span><a href="GHC.Tc.Gen.Splice.html#runMeta%27"><span class="hs-identifier hs-var">runMeta'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcPs -&gt; MsgDoc
forall a. Outputable a =&gt; a -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Exp -&gt; String)
-&gt; (Origin -&gt; SrcSpan -&gt; Exp -&gt; Either MsgDoc (LHsExpr GhcPs))
-&gt; (ForeignHValue -&gt; TcM Exp)
-&gt; SrcSpan
-&gt; ForeignHValue
-&gt; TcM (Either MsgDoc (LHsExpr GhcPs))
forall a b.
(a -&gt; String)
-&gt; (Origin -&gt; SrcSpan -&gt; a -&gt; b)
-&gt; (ForeignHValue -&gt; TcM a)
-&gt; SrcSpan
-&gt; ForeignHValue
-&gt; TcM b
</span><a href="GHC.Tc.Gen.Splice.html#runQResult"><span class="hs-identifier hs-var">runQResult</span></a></span><span> </span><span class="annot"><span class="annottext">Exp -&gt; String
forall a. Ppr a =&gt; a -&gt; String
</span><a href="../../template-haskell/src/Language.Haskell.TH.Ppr.html#pprint"><span class="hs-identifier hs-var">TH.pprint</span></a></span><span> </span><span class="annot"><span class="annottext">Origin -&gt; SrcSpan -&gt; Exp -&gt; Either MsgDoc (LHsExpr GhcPs)
</span><a href="GHC.ThToHs.html#convertToHsExpr"><span class="hs-identifier hs-var">convertToHsExpr</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignHValue -&gt; TcM Exp
</span><a href="GHC.Tc.Gen.Splice.html#runTHExp"><span class="hs-identifier hs-var">runTHExp</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-881"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#defaultRunMeta"><span class="hs-identifier hs-var">defaultRunMeta</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Types.html#MetaP"><span class="hs-identifier hs-type">MetaP</span></a></span><span> </span><span id="local-6989586621681125359"><span class="annot"><span class="annottext">LPat GhcPs -&gt; MetaResult
</span><a href="#local-6989586621681125359"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-882"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Located (Pat GhcPs) -&gt; MetaResult)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Located (Pat GhcPs))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) MetaResult
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Located (Pat GhcPs) -&gt; MetaResult
LPat GhcPs -&gt; MetaResult
</span><a href="#local-6989586621681125359"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) (Located (Pat GhcPs))
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) MetaResult)
-&gt; (LHsExpr GhcTc
    -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Located (Pat GhcPs)))
-&gt; LHsExpr GhcTc
-&gt; IOEnv (Env TcGblEnv TcLclEnv) MetaResult
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; (Located (Pat GhcPs) -&gt; MsgDoc)
-&gt; (SrcSpan
    -&gt; ForeignHValue -&gt; TcM (Either MsgDoc (Located (Pat GhcPs))))
-&gt; LHsExpr GhcTc
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Located (Pat GhcPs))
forall hs_syn.
Bool
-&gt; (hs_syn -&gt; MsgDoc)
-&gt; (SrcSpan -&gt; ForeignHValue -&gt; TcM (Either MsgDoc hs_syn))
-&gt; LHsExpr GhcTc
-&gt; TcM hs_syn
</span><a href="GHC.Tc.Gen.Splice.html#runMeta%27"><span class="hs-identifier hs-var">runMeta'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">Located (Pat GhcPs) -&gt; MsgDoc
forall a. Outputable a =&gt; a -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Pat -&gt; String)
-&gt; (Origin
    -&gt; SrcSpan -&gt; Pat -&gt; Either MsgDoc (Located (Pat GhcPs)))
-&gt; (ForeignHValue -&gt; TcM Pat)
-&gt; SrcSpan
-&gt; ForeignHValue
-&gt; TcM (Either MsgDoc (Located (Pat GhcPs)))
forall a b.
(a -&gt; String)
-&gt; (Origin -&gt; SrcSpan -&gt; a -&gt; b)
-&gt; (ForeignHValue -&gt; TcM a)
-&gt; SrcSpan
-&gt; ForeignHValue
-&gt; TcM b
</span><a href="GHC.Tc.Gen.Splice.html#runQResult"><span class="hs-identifier hs-var">runQResult</span></a></span><span> </span><span class="annot"><span class="annottext">Pat -&gt; String
forall a. Ppr a =&gt; a -&gt; String
</span><a href="../../template-haskell/src/Language.Haskell.TH.Ppr.html#pprint"><span class="hs-identifier hs-var">TH.pprint</span></a></span><span> </span><span class="annot"><span class="annottext">Origin -&gt; SrcSpan -&gt; Pat -&gt; Either MsgDoc (Located (Pat GhcPs))
Origin -&gt; SrcSpan -&gt; Pat -&gt; Either MsgDoc (LPat GhcPs)
</span><a href="GHC.ThToHs.html#convertToPat"><span class="hs-identifier hs-var">convertToPat</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignHValue -&gt; TcM Pat
</span><a href="GHC.Tc.Gen.Splice.html#runTHPat"><span class="hs-identifier hs-var">runTHPat</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-883"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#defaultRunMeta"><span class="hs-identifier hs-var">defaultRunMeta</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Types.html#MetaT"><span class="hs-identifier hs-type">MetaT</span></a></span><span> </span><span id="local-6989586621681125355"><span class="annot"><span class="annottext">LHsType GhcPs -&gt; MetaResult
</span><a href="#local-6989586621681125355"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-884"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(LHsType GhcPs -&gt; MetaResult)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (LHsType GhcPs)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) MetaResult
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcPs -&gt; MetaResult
</span><a href="#local-6989586621681125355"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) (LHsType GhcPs)
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) MetaResult)
-&gt; (LHsExpr GhcTc -&gt; IOEnv (Env TcGblEnv TcLclEnv) (LHsType GhcPs))
-&gt; LHsExpr GhcTc
-&gt; IOEnv (Env TcGblEnv TcLclEnv) MetaResult
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; (LHsType GhcPs -&gt; MsgDoc)
-&gt; (SrcSpan
    -&gt; ForeignHValue -&gt; TcM (Either MsgDoc (LHsType GhcPs)))
-&gt; LHsExpr GhcTc
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (LHsType GhcPs)
forall hs_syn.
Bool
-&gt; (hs_syn -&gt; MsgDoc)
-&gt; (SrcSpan -&gt; ForeignHValue -&gt; TcM (Either MsgDoc hs_syn))
-&gt; LHsExpr GhcTc
-&gt; TcM hs_syn
</span><a href="GHC.Tc.Gen.Splice.html#runMeta%27"><span class="hs-identifier hs-var">runMeta'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">LHsType GhcPs -&gt; MsgDoc
forall a. Outputable a =&gt; a -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Type -&gt; String)
-&gt; (Origin -&gt; SrcSpan -&gt; Type -&gt; Either MsgDoc (LHsType GhcPs))
-&gt; (ForeignHValue -&gt; TcM Type)
-&gt; SrcSpan
-&gt; ForeignHValue
-&gt; TcM (Either MsgDoc (LHsType GhcPs))
forall a b.
(a -&gt; String)
-&gt; (Origin -&gt; SrcSpan -&gt; a -&gt; b)
-&gt; (ForeignHValue -&gt; TcM a)
-&gt; SrcSpan
-&gt; ForeignHValue
-&gt; TcM b
</span><a href="GHC.Tc.Gen.Splice.html#runQResult"><span class="hs-identifier hs-var">runQResult</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; String
forall a. Ppr a =&gt; a -&gt; String
</span><a href="../../template-haskell/src/Language.Haskell.TH.Ppr.html#pprint"><span class="hs-identifier hs-var">TH.pprint</span></a></span><span> </span><span class="annot"><span class="annottext">Origin -&gt; SrcSpan -&gt; Type -&gt; Either MsgDoc (LHsType GhcPs)
</span><a href="GHC.ThToHs.html#convertToHsType"><span class="hs-identifier hs-var">convertToHsType</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignHValue -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#runTHType"><span class="hs-identifier hs-var">runTHType</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-885"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#defaultRunMeta"><span class="hs-identifier hs-var">defaultRunMeta</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Types.html#MetaD"><span class="hs-identifier hs-type">MetaD</span></a></span><span> </span><span id="local-6989586621681125351"><span class="annot"><span class="annottext">[LHsDecl GhcPs] -&gt; MetaResult
</span><a href="#local-6989586621681125351"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-886"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([LHsDecl GhcPs] -&gt; MetaResult)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [LHsDecl GhcPs]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) MetaResult
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsDecl GhcPs] -&gt; MetaResult
</span><a href="#local-6989586621681125351"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) [LHsDecl GhcPs]
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) MetaResult)
-&gt; (LHsExpr GhcTc -&gt; IOEnv (Env TcGblEnv TcLclEnv) [LHsDecl GhcPs])
-&gt; LHsExpr GhcTc
-&gt; IOEnv (Env TcGblEnv TcLclEnv) MetaResult
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; ([LHsDecl GhcPs] -&gt; MsgDoc)
-&gt; (SrcSpan
    -&gt; ForeignHValue -&gt; TcM (Either MsgDoc [LHsDecl GhcPs]))
-&gt; LHsExpr GhcTc
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [LHsDecl GhcPs]
forall hs_syn.
Bool
-&gt; (hs_syn -&gt; MsgDoc)
-&gt; (SrcSpan -&gt; ForeignHValue -&gt; TcM (Either MsgDoc hs_syn))
-&gt; LHsExpr GhcTc
-&gt; TcM hs_syn
</span><a href="GHC.Tc.Gen.Splice.html#runMeta%27"><span class="hs-identifier hs-var">runMeta'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">[LHsDecl GhcPs] -&gt; MsgDoc
forall a. Outputable a =&gt; a -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([Dec] -&gt; String)
-&gt; (Origin -&gt; SrcSpan -&gt; [Dec] -&gt; Either MsgDoc [LHsDecl GhcPs])
-&gt; (ForeignHValue -&gt; TcM [Dec])
-&gt; SrcSpan
-&gt; ForeignHValue
-&gt; TcM (Either MsgDoc [LHsDecl GhcPs])
forall a b.
(a -&gt; String)
-&gt; (Origin -&gt; SrcSpan -&gt; a -&gt; b)
-&gt; (ForeignHValue -&gt; TcM a)
-&gt; SrcSpan
-&gt; ForeignHValue
-&gt; TcM b
</span><a href="GHC.Tc.Gen.Splice.html#runQResult"><span class="hs-identifier hs-var">runQResult</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec] -&gt; String
forall a. Ppr a =&gt; a -&gt; String
</span><a href="../../template-haskell/src/Language.Haskell.TH.Ppr.html#pprint"><span class="hs-identifier hs-var">TH.pprint</span></a></span><span> </span><span class="annot"><span class="annottext">Origin -&gt; SrcSpan -&gt; [Dec] -&gt; Either MsgDoc [LHsDecl GhcPs]
</span><a href="GHC.ThToHs.html#convertToHsDecls"><span class="hs-identifier hs-var">convertToHsDecls</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignHValue -&gt; TcM [Dec]
</span><a href="GHC.Tc.Gen.Splice.html#runTHDec"><span class="hs-identifier hs-var">runTHDec</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-887"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#defaultRunMeta"><span class="hs-identifier hs-var">defaultRunMeta</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Types.html#MetaAW"><span class="hs-identifier hs-type">MetaAW</span></a></span><span> </span><span id="local-6989586621681125347"><span class="annot"><span class="annottext">Serialized -&gt; MetaResult
</span><a href="#local-6989586621681125347"><span class="hs-identifier hs-var">r</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-888"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Serialized -&gt; MetaResult)
-&gt; TcM Serialized -&gt; IOEnv (Env TcGblEnv TcLclEnv) MetaResult
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Serialized -&gt; MetaResult
</span><a href="#local-6989586621681125347"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM Serialized -&gt; IOEnv (Env TcGblEnv TcLclEnv) MetaResult)
-&gt; (LHsExpr GhcTc -&gt; TcM Serialized)
-&gt; LHsExpr GhcTc
-&gt; IOEnv (Env TcGblEnv TcLclEnv) MetaResult
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; (Serialized -&gt; MsgDoc)
-&gt; (SrcSpan -&gt; ForeignHValue -&gt; TcM (Either MsgDoc Serialized))
-&gt; LHsExpr GhcTc
-&gt; TcM Serialized
forall hs_syn.
Bool
-&gt; (hs_syn -&gt; MsgDoc)
-&gt; (SrcSpan -&gt; ForeignHValue -&gt; TcM (Either MsgDoc hs_syn))
-&gt; LHsExpr GhcTc
-&gt; TcM hs_syn
</span><a href="GHC.Tc.Gen.Splice.html#runMeta%27"><span class="hs-identifier hs-var">runMeta'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MsgDoc -&gt; Serialized -&gt; MsgDoc
forall a b. a -&gt; b -&gt; a
</span><a href="../../base/src/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">MsgDoc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ForeignHValue -&gt; TcM (Either MsgDoc Serialized))
-&gt; SrcSpan -&gt; ForeignHValue -&gt; TcM (Either MsgDoc Serialized)
forall a b. a -&gt; b -&gt; a
</span><a href="../../base/src/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignHValue -&gt; TcM (Either MsgDoc Serialized)
</span><a href="GHC.Tc.Gen.Splice.html#convertAnnotationWrapper"><span class="hs-identifier hs-var">convertAnnotationWrapper</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-889"></span><span>    </span><span class="hs-comment">-- We turn off showing the code in meta-level exceptions because doing so exposes</span><span>
</span><span id="line-890"></span><span>    </span><span class="hs-comment">-- the toAnnotationWrapper function that we slap around the user's code</span><span>
</span><span id="line-891"></span><span>
</span><span id="line-892"></span><span class="hs-comment">----------------</span><span>
</span><span id="line-893"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#runMetaAW"><span class="hs-identifier hs-type">runMetaAW</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span>         </span><span class="hs-comment">-- Of type AnnotationWrapper</span><span>
</span><span id="line-894"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="../../ghc-boot/src/GHC.Serialized.html#Serialized"><span class="hs-identifier hs-type">Serialized</span></a></span><span>
</span><span id="line-895"></span><span id="runMetaAW"><span class="annot"><span class="annottext">runMetaAW :: LHsExpr GhcTc -&gt; TcM Serialized
</span><a href="GHC.Tc.Gen.Splice.html#runMetaAW"><span class="hs-identifier hs-var hs-var">runMetaAW</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(MetaHook TcM -&gt; LHsExpr GhcTc -&gt; TcM Serialized)
-&gt; LHsExpr GhcTc -&gt; TcM Serialized
forall hs_syn.
(MetaHook TcM -&gt; LHsExpr GhcTc -&gt; TcM hs_syn)
-&gt; LHsExpr GhcTc -&gt; TcM hs_syn
</span><a href="GHC.Tc.Gen.Splice.html#runMeta"><span class="hs-identifier hs-var">runMeta</span></a></span><span> </span><span class="annot"><span class="annottext">MetaHook TcM -&gt; LHsExpr GhcTc -&gt; TcM Serialized
forall (f :: * -&gt; *).
Functor f =&gt;
MetaHook f -&gt; LHsExpr GhcTc -&gt; f Serialized
</span><a href="GHC.Driver.Types.html#metaRequestAW"><span class="hs-identifier hs-var">metaRequestAW</span></a></span><span>
</span><span id="line-896"></span><span>
</span><span id="line-897"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#runMetaE"><span class="hs-identifier hs-type">runMetaE</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span>          </span><span class="hs-comment">-- Of type (Q Exp)</span><span>
</span><span id="line-898"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-899"></span><span id="runMetaE"><span class="annot"><span class="annottext">runMetaE :: LHsExpr GhcTc -&gt; TcM (LHsExpr GhcPs)
</span><a href="GHC.Tc.Gen.Splice.html#runMetaE"><span class="hs-identifier hs-var hs-var">runMetaE</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(MetaHook TcM -&gt; LHsExpr GhcTc -&gt; TcM (LHsExpr GhcPs))
-&gt; LHsExpr GhcTc -&gt; TcM (LHsExpr GhcPs)
forall hs_syn.
(MetaHook TcM -&gt; LHsExpr GhcTc -&gt; TcM hs_syn)
-&gt; LHsExpr GhcTc -&gt; TcM hs_syn
</span><a href="GHC.Tc.Gen.Splice.html#runMeta"><span class="hs-identifier hs-var">runMeta</span></a></span><span> </span><span class="annot"><span class="annottext">MetaHook TcM -&gt; LHsExpr GhcTc -&gt; TcM (LHsExpr GhcPs)
forall (f :: * -&gt; *).
Functor f =&gt;
MetaHook f -&gt; LHsExpr GhcTc -&gt; f (LHsExpr GhcPs)
</span><a href="GHC.Driver.Types.html#metaRequestE"><span class="hs-identifier hs-var">metaRequestE</span></a></span><span>
</span><span id="line-900"></span><span>
</span><span id="line-901"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#runMetaP"><span class="hs-identifier hs-type">runMetaP</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span>          </span><span class="hs-comment">-- Of type (Q Pat)</span><span>
</span><span id="line-902"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Pat.html#LPat"><span class="hs-identifier hs-type">LPat</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-903"></span><span id="runMetaP"><span class="annot"><span class="annottext">runMetaP :: LHsExpr GhcTc -&gt; TcM (LPat GhcPs)
</span><a href="GHC.Tc.Gen.Splice.html#runMetaP"><span class="hs-identifier hs-var hs-var">runMetaP</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(MetaHook TcM
 -&gt; LHsExpr GhcTc
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Located (Pat GhcPs)))
-&gt; LHsExpr GhcTc
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Located (Pat GhcPs))
forall hs_syn.
(MetaHook TcM -&gt; LHsExpr GhcTc -&gt; TcM hs_syn)
-&gt; LHsExpr GhcTc -&gt; TcM hs_syn
</span><a href="GHC.Tc.Gen.Splice.html#runMeta"><span class="hs-identifier hs-var">runMeta</span></a></span><span> </span><span class="annot"><span class="annottext">MetaHook TcM
-&gt; LHsExpr GhcTc
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Located (Pat GhcPs))
forall (f :: * -&gt; *).
Functor f =&gt;
MetaHook f -&gt; LHsExpr GhcTc -&gt; f (LPat GhcPs)
</span><a href="GHC.Driver.Types.html#metaRequestP"><span class="hs-identifier hs-var">metaRequestP</span></a></span><span>
</span><span id="line-904"></span><span>
</span><span id="line-905"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#runMetaT"><span class="hs-identifier hs-type">runMetaT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span>          </span><span class="hs-comment">-- Of type (Q Type)</span><span>
</span><span id="line-906"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Type.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-907"></span><span id="runMetaT"><span class="annot"><span class="annottext">runMetaT :: LHsExpr GhcTc -&gt; IOEnv (Env TcGblEnv TcLclEnv) (LHsType GhcPs)
</span><a href="GHC.Tc.Gen.Splice.html#runMetaT"><span class="hs-identifier hs-var hs-var">runMetaT</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(MetaHook TcM
 -&gt; LHsExpr GhcTc -&gt; IOEnv (Env TcGblEnv TcLclEnv) (LHsType GhcPs))
-&gt; LHsExpr GhcTc -&gt; IOEnv (Env TcGblEnv TcLclEnv) (LHsType GhcPs)
forall hs_syn.
(MetaHook TcM -&gt; LHsExpr GhcTc -&gt; TcM hs_syn)
-&gt; LHsExpr GhcTc -&gt; TcM hs_syn
</span><a href="GHC.Tc.Gen.Splice.html#runMeta"><span class="hs-identifier hs-var">runMeta</span></a></span><span> </span><span class="annot"><span class="annottext">MetaHook TcM
-&gt; LHsExpr GhcTc -&gt; IOEnv (Env TcGblEnv TcLclEnv) (LHsType GhcPs)
forall (f :: * -&gt; *).
Functor f =&gt;
MetaHook f -&gt; LHsExpr GhcTc -&gt; f (LHsType GhcPs)
</span><a href="GHC.Driver.Types.html#metaRequestT"><span class="hs-identifier hs-var">metaRequestT</span></a></span><span>
</span><span id="line-908"></span><span>
</span><span id="line-909"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#runMetaD"><span class="hs-identifier hs-type">runMetaD</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span>          </span><span class="hs-comment">-- Of type Q [Dec]</span><span>
</span><span id="line-910"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Hs.Decls.html#LHsDecl"><span class="hs-identifier hs-type">LHsDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-911"></span><span id="runMetaD"><span class="annot"><span class="annottext">runMetaD :: LHsExpr GhcTc -&gt; IOEnv (Env TcGblEnv TcLclEnv) [LHsDecl GhcPs]
</span><a href="GHC.Tc.Gen.Splice.html#runMetaD"><span class="hs-identifier hs-var hs-var">runMetaD</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(MetaHook TcM
 -&gt; LHsExpr GhcTc -&gt; IOEnv (Env TcGblEnv TcLclEnv) [LHsDecl GhcPs])
-&gt; LHsExpr GhcTc -&gt; IOEnv (Env TcGblEnv TcLclEnv) [LHsDecl GhcPs]
forall hs_syn.
(MetaHook TcM -&gt; LHsExpr GhcTc -&gt; TcM hs_syn)
-&gt; LHsExpr GhcTc -&gt; TcM hs_syn
</span><a href="GHC.Tc.Gen.Splice.html#runMeta"><span class="hs-identifier hs-var">runMeta</span></a></span><span> </span><span class="annot"><span class="annottext">MetaHook TcM
-&gt; LHsExpr GhcTc -&gt; IOEnv (Env TcGblEnv TcLclEnv) [LHsDecl GhcPs]
forall (f :: * -&gt; *).
Functor f =&gt;
MetaHook f -&gt; LHsExpr GhcTc -&gt; f [LHsDecl GhcPs]
</span><a href="GHC.Driver.Types.html#metaRequestD"><span class="hs-identifier hs-var">metaRequestD</span></a></span><span>
</span><span id="line-912"></span><span>
</span><span id="line-913"></span><span class="hs-comment">---------------</span><span>
</span><span id="line-914"></span><span id="local-6989586621681126656"><span class="annot"><a href="GHC.Tc.Gen.Splice.html#runMeta%27"><span class="hs-identifier hs-type">runMeta'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>                 </span><span class="hs-comment">-- Whether code should be printed in the exception message</span><span>
</span><span id="line-915"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621681126656"><span class="hs-identifier hs-type">hs_syn</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span class="hs-special">)</span><span>                                    </span><span class="hs-comment">-- how to print the code</span><span>
</span><span id="line-916"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghci/src/GHCi.RemoteTypes.html#ForeignHValue"><span class="hs-identifier hs-type">ForeignHValue</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#MsgDoc"><span class="hs-identifier hs-type">MsgDoc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681126656"><span class="hs-identifier hs-type">hs_syn</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>        </span><span class="hs-comment">-- How to run x</span><span>
</span><span id="line-917"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Hs.Expr.html#LHsExpr"><span class="hs-identifier hs-type">LHsExpr</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcTc"><span class="hs-identifier hs-type">GhcTc</span></a></span><span>        </span><span class="hs-comment">-- Of type x; typically x = Q TH.Exp, or</span><span>
</span><span id="line-918"></span><span>                                 </span><span class="hs-comment">--    something like that</span><span>
</span><span id="line-919"></span><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681126656"><span class="hs-identifier hs-type">hs_syn</span></a></span></span><span>           </span><span class="hs-comment">-- Of type t</span><span>
</span><span id="line-920"></span><span id="runMeta%27"><span class="annot"><span class="annottext">runMeta' :: forall hs_syn.
Bool
-&gt; (hs_syn -&gt; MsgDoc)
-&gt; (SrcSpan -&gt; ForeignHValue -&gt; TcM (Either MsgDoc hs_syn))
-&gt; LHsExpr GhcTc
-&gt; TcM hs_syn
</span><a href="GHC.Tc.Gen.Splice.html#runMeta%27"><span class="hs-identifier hs-var hs-var">runMeta'</span></a></span></span><span> </span><span id="local-6989586621681125315"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681125315"><span class="hs-identifier hs-var">show_code</span></a></span></span><span> </span><span id="local-6989586621681125314"><span class="annot"><span class="annottext">hs_syn -&gt; MsgDoc
</span><a href="#local-6989586621681125314"><span class="hs-identifier hs-var">ppr_hs</span></a></span></span><span> </span><span id="local-6989586621681125313"><span class="annot"><span class="annottext">SrcSpan -&gt; ForeignHValue -&gt; TcM (Either MsgDoc hs_syn)
</span><a href="#local-6989586621681125313"><span class="hs-identifier hs-var">run_and_convert</span></a></span></span><span> </span><span id="local-6989586621681125312"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681125312"><span class="hs-identifier hs-var">expr</span></a></span></span><span>
</span><span id="line-921"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; MsgDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;About to run&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsExpr GhcTc -&gt; MsgDoc
forall a. Outputable a =&gt; a -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681125312"><span class="hs-identifier hs-var">expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-922"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#recordThSpliceUse"><span class="hs-identifier hs-var">recordThSpliceUse</span></a></span><span> </span><span class="hs-comment">-- seems to be the best place to do this,</span><span>
</span><span id="line-923"></span><span>                            </span><span class="hs-comment">-- we catch all kinds of splices and annotations.</span><span>
</span><span id="line-924"></span><span>
</span><span id="line-925"></span><span>        </span><span class="hs-comment">-- Check that we've had no errors of any sort so far.</span><span>
</span><span id="line-926"></span><span>        </span><span class="hs-comment">-- For example, if we found an error in an earlier defn f, but</span><span>
</span><span id="line-927"></span><span>        </span><span class="hs-comment">-- recovered giving it type f :: forall a.a, it'd be very dodgy</span><span>
</span><span id="line-928"></span><span>        </span><span class="hs-comment">-- to carry ont.  Mind you, the staging restrictions mean we won't</span><span>
</span><span id="line-929"></span><span>        </span><span class="hs-comment">-- actually run f, but it still seems wrong. And, more concretely,</span><span>
</span><span id="line-930"></span><span>        </span><span class="hs-comment">-- see #5358 for an example that fell over when trying to</span><span>
</span><span id="line-931"></span><span>        </span><span class="hs-comment">-- reify a function with a &quot;?&quot; kind in it.  (These don't occur</span><span>
</span><span id="line-932"></span><span>        </span><span class="hs-comment">-- in type-correct programs.</span><span>
</span><span id="line-933"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#failIfErrsM"><span class="hs-identifier hs-var">failIfErrsM</span></a></span><span>
</span><span id="line-934"></span><span>
</span><span id="line-935"></span><span>        </span><span class="hs-comment">-- run plugins</span><span>
</span><span id="line-936"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681125309"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681125309"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv HscEnv
forall gbl lcl. TcRnIf gbl lcl HscEnv
</span><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-var">getTopEnv</span></a></span><span>
</span><span id="line-937"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681125307"><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681125307"><span class="hs-identifier hs-var">expr'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags
-&gt; PluginOperation TcM (LHsExpr GhcTc)
-&gt; LHsExpr GhcTc
-&gt; TcM (LHsExpr GhcTc)
forall (m :: * -&gt; *) a.
Monad m =&gt;
DynFlags -&gt; PluginOperation m a -&gt; a -&gt; m a
</span><a href="GHC.Driver.Plugins.html#withPlugins"><span class="hs-identifier hs-var">withPlugins</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681125309"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PluginOperation TcM (LHsExpr GhcTc)
</span><a href="GHC.Driver.Plugins.html#spliceRunAction"><span class="hs-identifier hs-var hs-var">spliceRunAction</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681125312"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-938"></span><span>
</span><span id="line-939"></span><span>        </span><span class="hs-comment">-- Desugar</span><span>
</span><span id="line-940"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681125303"><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621681125303"><span class="hs-identifier hs-var">ds_expr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DsM CoreExpr -&gt; TcM CoreExpr
forall a. DsM a -&gt; TcM a
</span><a href="GHC.HsToCore.Monad.html#initDsTc"><span class="hs-identifier hs-var">initDsTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LHsExpr GhcTc -&gt; DsM CoreExpr
</span><a href="GHC.HsToCore.Expr.html#dsLExpr"><span class="hs-identifier hs-var">dsLExpr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681125307"><span class="hs-identifier hs-var">expr'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-941"></span><span>        </span><span class="hs-comment">-- Compile and link it; might fail if linking fails</span><span>
</span><span id="line-942"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681125300"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681125300"><span class="hs-identifier hs-var">src_span</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn SrcSpan
</span><a href="GHC.Tc.Utils.Monad.html#getSrcSpanM"><span class="hs-identifier hs-var">getSrcSpanM</span></a></span><span>
</span><span id="line-943"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; MsgDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;About to run (desugared)&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CoreExpr -&gt; MsgDoc
forall a. Outputable a =&gt; a -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621681125303"><span class="hs-identifier hs-var">ds_expr</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-944"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681125299"><span class="annot"><span class="annottext">Either IOEnvFailure ForeignHValue
</span><a href="#local-6989586621681125299"><span class="hs-identifier hs-var">either_hval</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) ForeignHValue
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (Either IOEnvFailure ForeignHValue)
forall env r. IOEnv env r -&gt; IOEnv env (Either IOEnvFailure r)
</span><a href="GHC.Data.IOEnv.html#tryM"><span class="hs-identifier hs-var">tryM</span></a></span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) ForeignHValue
 -&gt; IOEnv
      (Env TcGblEnv TcLclEnv) (Either IOEnvFailure ForeignHValue))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ForeignHValue
-&gt; IOEnv
     (Env TcGblEnv TcLclEnv) (Either IOEnvFailure ForeignHValue)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">IO ForeignHValue -&gt; IOEnv (Env TcGblEnv TcLclEnv) ForeignHValue
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ForeignHValue -&gt; IOEnv (Env TcGblEnv TcLclEnv) ForeignHValue)
-&gt; IO ForeignHValue -&gt; IOEnv (Env TcGblEnv TcLclEnv) ForeignHValue
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-945"></span><span>                         </span><span class="annot"><span class="annottext">HscEnv -&gt; SrcSpan -&gt; CoreExpr -&gt; IO ForeignHValue
</span><a href="GHC.Driver.Main.html#hscCompileCoreExpr"><span class="hs-identifier hs-var">GHC.Driver.Main.hscCompileCoreExpr</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681125309"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681125300"><span class="hs-identifier hs-var">src_span</span></a></span><span> </span><span class="annot"><span class="annottext">CoreExpr
</span><a href="#local-6989586621681125303"><span class="hs-identifier hs-var">ds_expr</span></a></span><span>
</span><span id="line-946"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either IOEnvFailure ForeignHValue
</span><a href="#local-6989586621681125299"><span class="hs-identifier hs-var">either_hval</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-947"></span><span>            </span><span class="annot"><a href="../../base/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621681125296"><span class="annot"><span class="annottext">IOEnvFailure
</span><a href="#local-6989586621681125296"><span class="hs-identifier hs-var">exn</span></a></span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; IOEnvFailure -&gt; TcM hs_syn
forall e a. Exception e =&gt; String -&gt; e -&gt; TcM a
</span><a href="#local-6989586621681125295"><span class="hs-identifier hs-var">fail_with_exn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;compile and link&quot;</span></span><span> </span><span class="annot"><span class="annottext">IOEnvFailure
</span><a href="#local-6989586621681125296"><span class="hs-identifier hs-var">exn</span></a></span><span> </span><span class="hs-special">;</span><span>
</span><span id="line-948"></span><span>            </span><span class="annot"><a href="../../base/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621681125294"><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621681125294"><span class="hs-identifier hs-var">hval</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-949"></span><span>
</span><span id="line-950"></span><span>        </span><span class="hs-special">{</span><span>       </span><span class="hs-comment">-- Coerce it to Q t, and run it</span><span>
</span><span id="line-951"></span><span>
</span><span id="line-952"></span><span>                </span><span class="hs-comment">-- Running might fail if it throws an exception of any kind (hence tryAllM)</span><span>
</span><span id="line-953"></span><span>                </span><span class="hs-comment">-- including, say, a pattern-match exception in the code we are running</span><span>
</span><span id="line-954"></span><span>                </span><span class="hs-comment">--</span><span>
</span><span id="line-955"></span><span>                </span><span class="hs-comment">-- We also do the TH -&gt; HS syntax conversion inside the same</span><span>
</span><span id="line-956"></span><span>                </span><span class="hs-comment">-- exception-catching thing so that if there are any lurking</span><span>
</span><span id="line-957"></span><span>                </span><span class="hs-comment">-- exceptions in the data structure returned by hval, we'll</span><span>
</span><span id="line-958"></span><span>                </span><span class="hs-comment">-- encounter them inside the try</span><span>
</span><span id="line-959"></span><span>                </span><span class="hs-comment">--</span><span>
</span><span id="line-960"></span><span>                </span><span class="hs-comment">-- See Note [Exceptions in TH]</span><span>
</span><span id="line-961"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681125293"><span class="annot"><span class="annottext">expr_span :: SrcSpan
</span><a href="#local-6989586621681125293"><span class="hs-identifier hs-var hs-var">expr_span</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc -&gt; SrcSpan
forall l e. GenLocated l e -&gt; l
</span><a href="GHC.Types.SrcLoc.html#getLoc"><span class="hs-identifier hs-var">getLoc</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681125312"><span class="hs-identifier hs-var">expr</span></a></span><span>
</span><span id="line-962"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681125292"><span class="annot"><span class="annottext">Either SomeException hs_syn
</span><a href="#local-6989586621681125292"><span class="hs-identifier hs-var">either_tval</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM hs_syn
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Either SomeException hs_syn)
forall env r. IOEnv env r -&gt; IOEnv env (Either SomeException r)
</span><a href="GHC.Data.IOEnv.html#tryAllM"><span class="hs-identifier hs-var">tryAllM</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM hs_syn
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Either SomeException hs_syn))
-&gt; TcM hs_syn
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (Either SomeException hs_syn)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-963"></span><span>                         </span><span class="annot"><span class="annottext">SrcSpan -&gt; TcM hs_syn -&gt; TcM hs_syn
forall a. SrcSpan -&gt; TcRn a -&gt; TcRn a
</span><a href="GHC.Tc.Utils.Monad.html#setSrcSpan"><span class="hs-identifier hs-var">setSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681125293"><span class="hs-identifier hs-var">expr_span</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM hs_syn -&gt; TcM hs_syn) -&gt; TcM hs_syn -&gt; TcM hs_syn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-comment">-- Set the span so that qLocation can</span><span>
</span><span id="line-964"></span><span>                                                </span><span class="hs-comment">-- see where this splice is</span><span>
</span><span id="line-965"></span><span>             </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681125290"><span class="annot"><span class="annottext">Either MsgDoc hs_syn
</span><a href="#local-6989586621681125290"><span class="hs-identifier hs-var">mb_result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; ForeignHValue -&gt; TcM (Either MsgDoc hs_syn)
</span><a href="#local-6989586621681125313"><span class="hs-identifier hs-var">run_and_convert</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681125293"><span class="hs-identifier hs-var">expr_span</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621681125294"><span class="hs-identifier hs-var">hval</span></a></span><span>
</span><span id="line-966"></span><span>                </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either MsgDoc hs_syn
</span><a href="#local-6989586621681125290"><span class="hs-identifier hs-var">mb_result</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-967"></span><span>                    </span><span class="annot"><a href="../../base/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621681125289"><span class="annot"><span class="annottext">MsgDoc
</span><a href="#local-6989586621681125289"><span class="hs-identifier hs-var">err</span></a></span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MsgDoc -&gt; TcM hs_syn
forall a. MsgDoc -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span> </span><span class="annot"><span class="annottext">MsgDoc
</span><a href="#local-6989586621681125289"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-968"></span><span>                    </span><span class="annot"><a href="../../base/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621681125287"><span class="annot"><span class="annottext">hs_syn
</span><a href="#local-6989586621681125287"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; MsgDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Got HsSyn result:&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">hs_syn -&gt; MsgDoc
</span><a href="#local-6989586621681125314"><span class="hs-identifier hs-var">ppr_hs</span></a></span><span> </span><span class="annot"><span class="annottext">hs_syn
</span><a href="#local-6989586621681125287"><span class="hs-identifier hs-var">result</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-969"></span><span>                                       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">hs_syn -&gt; TcM hs_syn
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(hs_syn -&gt; TcM hs_syn) -&gt; hs_syn -&gt; TcM hs_syn
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="annot"><span class="annottext">hs_syn
</span><a href="#local-6989586621681125287"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-970"></span><span>
</span><span id="line-971"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either SomeException hs_syn
</span><a href="#local-6989586621681125292"><span class="hs-identifier hs-var">either_tval</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-972"></span><span>            </span><span class="annot"><a href="../../base/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621681125285"><span class="annot"><span class="annottext">hs_syn
</span><a href="#local-6989586621681125285"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">hs_syn -&gt; TcM hs_syn
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">hs_syn
</span><a href="#local-6989586621681125285"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-973"></span><span>            </span><span class="annot"><a href="../../base/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621681125284"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621681125284"><span class="hs-identifier hs-var">se</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SomeException -&gt; Maybe IOEnvFailure
forall e. Exception e =&gt; SomeException -&gt; Maybe e
</span><a href="../../base/src/GHC.Exception.Type.html#fromException"><span class="hs-identifier hs-var">fromException</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621681125284"><span class="hs-identifier hs-var">se</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-974"></span><span>                         </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="annottext">IOEnvFailure
</span><a href="GHC.Data.IOEnv.html#IOEnvFailure"><span class="hs-identifier hs-var">IOEnvFailure</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM hs_syn
forall env a. IOEnv env a
</span><a href="GHC.Data.IOEnv.html#failM"><span class="hs-identifier hs-var">failM</span></a></span><span> </span><span class="hs-comment">-- Error already in Tc monad</span><span>
</span><span id="line-975"></span><span>                         </span><span class="annot"><span class="annottext">Maybe IOEnvFailure
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; SomeException -&gt; TcM hs_syn
forall e a. Exception e =&gt; String -&gt; e -&gt; TcM a
</span><a href="#local-6989586621681125295"><span class="hs-identifier hs-var">fail_with_exn</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;run&quot;</span></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621681125284"><span class="hs-identifier hs-var">se</span></a></span><span> </span><span class="hs-comment">-- Exception</span><span>
</span><span id="line-976"></span><span>        </span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><span id="line-977"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-978"></span><span>    </span><span class="hs-comment">-- see Note [Concealed TH exceptions]</span><span>
</span><span id="line-979"></span><span>    </span><span id="local-6989586621681126628"><span id="local-6989586621681126629"><span class="annot"><a href="#local-6989586621681125295"><span class="hs-identifier hs-type">fail_with_exn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base/src/GHC.Exception.Type.html#Exception"><span class="hs-identifier hs-type">Exception</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681126629"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681126629"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681126628"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-980"></span><span>    </span><span id="local-6989586621681125295"><span class="annot"><span class="annottext">fail_with_exn :: forall e a. Exception e =&gt; String -&gt; e -&gt; TcM a
</span><a href="#local-6989586621681125295"><span class="hs-identifier hs-var hs-var">fail_with_exn</span></a></span></span><span> </span><span id="local-6989586621681125276"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681125276"><span class="hs-identifier hs-var">phase</span></a></span></span><span> </span><span id="local-6989586621681125275"><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621681125275"><span class="hs-identifier hs-var">exn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-981"></span><span>        </span><span id="local-6989586621681125274"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681125274"><span class="hs-identifier hs-var">exn_msg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO String -&gt; IOEnv (Env TcGblEnv TcLclEnv) String
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO String -&gt; IOEnv (Env TcGblEnv TcLclEnv) String)
-&gt; IO String -&gt; IOEnv (Env TcGblEnv TcLclEnv) String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">e -&gt; IO String
forall e. Exception e =&gt; e -&gt; IO String
</span><a href="GHC.Utils.Panic.html#safeShowException"><span class="hs-identifier hs-var">Panic.safeShowException</span></a></span><span> </span><span class="annot"><span class="annottext">e
</span><a href="#local-6989586621681125275"><span class="hs-identifier hs-var">exn</span></a></span><span>
</span><span id="line-982"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681125272"><span class="annot"><span class="annottext">msg :: MsgDoc
</span><a href="#local-6989586621681125272"><span class="hs-identifier hs-var hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[MsgDoc] -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Exception when trying to&quot;</span></span><span> </span><span class="annot"><span class="annottext">MsgDoc -&gt; MsgDoc -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681125276"><span class="hs-identifier hs-var">phase</span></a></span><span> </span><span class="annot"><span class="annottext">MsgDoc -&gt; MsgDoc -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;compile-time code:&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-983"></span><span>                        </span><span class="annot"><span class="annottext">Arity -&gt; MsgDoc -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681125274"><span class="hs-identifier hs-var">exn_msg</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-984"></span><span>                        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681125315"><span class="hs-identifier hs-var">show_code</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">String -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Code:&quot;</span></span><span> </span><span class="annot"><span class="annottext">MsgDoc -&gt; MsgDoc -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc -&gt; MsgDoc
forall a. Outputable a =&gt; a -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">LHsExpr GhcTc
</span><a href="#local-6989586621681125312"><span class="hs-identifier hs-var">expr</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">MsgDoc
</span><a href="GHC.Utils.Outputable.html#empty"><span class="hs-identifier hs-var">empty</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-985"></span><span>        </span><span class="annot"><span class="annottext">MsgDoc -&gt; TcM a
forall a. MsgDoc -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span> </span><span class="annot"><span class="annottext">MsgDoc
</span><a href="#local-6989586621681125272"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-986"></span><span>
</span><span id="line-987"></span><span class="hs-comment">{-
Note [Running typed splices in the zonker]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

See #15471 for the full discussion.

For many years typed splices were run immediately after they were type checked
however, this is too early as it means to zonk some type variables before
they can be unified with type variables in the surrounding context.

For example,

```
module A where

test_foo :: forall a . Q (TExp (a -&gt; a))
test_foo = [|| id ||]

module B where

import A

qux = $$(test_foo)
```

We would expect `qux` to have inferred type `forall a . a -&gt; a` but if
we run the splices too early the unified variables are zonked to `Any`. The
inferred type is the unusable `Any -&gt; Any`.

To run the splice, we must compile `test_foo` all the way to byte code.
But at the moment when the type checker is looking at the splice, test_foo
has type `Q (TExp (alpha -&gt; alpha))` and we
certainly can't compile code involving unification variables!

We could default `alpha` to `Any` but then we infer `qux :: Any -&gt; Any`
which definitely is not what we want.  Moreover, if we had
  qux = [$$(test_foo), (\x -&gt; x +1::Int)]
then `alpha` would have to be `Int`.

Conclusion: we must defer taking decisions about `alpha` until the
typechecker is done; and *then* we can run the splice.  It's fine to do it
later, because we know it'll produce type-correct code.

Deferring running the splice until later, in the zonker, means that the
unification variables propagate upwards from the splice into the surrounding
context and are unified correctly.

This is implemented by storing the arguments we need for running the splice
in a `DelayedSplice`. In the zonker, the arguments are passed to
`GHC.Tc.Gen.Splice.runTopSplice` and the expression inserted into the AST as normal.



Note [Exceptions in TH]
~~~~~~~~~~~~~~~~~~~~~~~
Suppose we have something like this
        $( f 4 )
where
        f :: Int -&gt; Q [Dec]
        f n | n&gt;3       = fail &quot;Too many declarations&quot;
            | otherwise = ...

The 'fail' is a user-generated failure, and should be displayed as a
perfectly ordinary compiler error message, not a panic or anything
like that.  Here's how it's processed:

  * 'fail' is the monad fail.  The monad instance for Q in TH.Syntax
    effectively transforms (fail s) to
        qReport True s &gt;&gt; fail
    where 'qReport' comes from the Quasi class and fail from its monad
    superclass.

  * The TcM monad is an instance of Quasi (see GHC.Tc.Gen.Splice), and it implements
    (qReport True s) by using addErr to add an error message to the bag of errors.
    The 'fail' in TcM raises an IOEnvFailure exception

 * 'qReport' forces the message to ensure any exception hidden in unevaluated
   thunk doesn't get into the bag of errors. Otherwise the following splice
   will trigger panic (#8987):
        $(fail undefined)
   See also Note [Concealed TH exceptions]

  * So, when running a splice, we catch all exceptions; then for
        - an IOEnvFailure exception, we assume the error is already
                in the error-bag (above)
        - other errors, we add an error to the bag
    and then fail

Note [Concealed TH exceptions]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When displaying the error message contained in an exception originated from TH
code, we need to make sure that the error message itself does not contain an
exception.  For example, when executing the following splice:

    $( error (&quot;foo &quot; ++ error &quot;bar&quot;) )

the message for the outer exception is a thunk which will throw the inner
exception when evaluated.

For this reason, we display the message of a TH exception using the
'safeShowException' function, which recursively catches any exception thrown
when showing an error message.


To call runQ in the Tc monad, we need to make TcM an instance of Quasi:
-}</span><span>
</span><span id="line-1093"></span><span>
</span><span id="line-1094"></span><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621681125253"><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Quasi"><span class="hs-identifier hs-type">TH.Quasi</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1095"></span><span>  </span><span id="local-6989586621681125238"><span class="annot"><span class="annottext">qNewName :: String -&gt; TcM Name
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#qNewName"><span class="hs-identifier hs-var hs-var hs-var hs-var">qNewName</span></a></span></span><span> </span><span id="local-6989586621681125236"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681125236"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681125235"><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621681125235"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv Unique
forall gbl lcl. TcRnIf gbl lcl Unique
</span><a href="GHC.Tc.Utils.Monad.html#newUnique"><span class="hs-identifier hs-var">newUnique</span></a></span><span>
</span><span id="line-1096"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681125233"><span class="annot"><span class="annottext">i :: Integer
</span><a href="#local-6989586621681125233"><span class="hs-identifier hs-var hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Arity -&gt; Integer
forall a. Integral a =&gt; a -&gt; Integer
</span><a href="../../base/src/GHC.Real.html#toInteger"><span class="hs-identifier hs-var">toInteger</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Unique -&gt; Arity
</span><a href="GHC.Types.Unique.html#getKey"><span class="hs-identifier hs-var">getKey</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="#local-6989586621681125235"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1097"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Name
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Integer -&gt; Name
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#mkNameU"><span class="hs-identifier hs-var">TH.mkNameU</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681125236"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621681125233"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1098"></span><span>
</span><span id="line-1099"></span><span>  </span><span class="hs-comment">-- 'msg' is forced to ensure exceptions don't escape,</span><span>
</span><span id="line-1100"></span><span>  </span><span class="hs-comment">-- see Note [Exceptions in TH]</span><span>
</span><span id="line-1101"></span><span>  </span><span id="local-6989586621681125230"><span class="annot"><span class="annottext">qReport :: Bool -&gt; String -&gt; TcRn ()
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#qReport"><span class="hs-identifier hs-var hs-var hs-var hs-var">qReport</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span id="local-6989586621681125228"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681125228"><span class="hs-identifier hs-var">msg</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; TcRn () -&gt; TcRn ()
forall a b. [a] -&gt; b -&gt; b
</span><a href="GHC.Utils.Misc.html#seqList"><span class="hs-identifier hs-var">seqList</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681125228"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcRn ()) -&gt; TcRn () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">MsgDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681125228"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1102"></span><span>  </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#qReport"><span class="hs-identifier hs-var">qReport</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span id="local-6989586621681125227"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681125227"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; TcRn () -&gt; TcRn ()
forall a b. [a] -&gt; b -&gt; b
</span><a href="GHC.Utils.Misc.html#seqList"><span class="hs-identifier hs-var">seqList</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681125227"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcRn ()) -&gt; TcRn () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">WarnReason -&gt; MsgDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addWarn"><span class="hs-identifier hs-var">addWarn</span></a></span><span> </span><span class="annot"><span class="annottext">WarnReason
</span><a href="GHC.Driver.Flags.html#NoReason"><span class="hs-identifier hs-var">NoReason</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681125227"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1103"></span><span>
</span><span id="line-1104"></span><span>  </span><span id="local-6989586621681125215"><span class="annot"><span class="annottext">qLocation :: TcM Loc
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#qLocation"><span class="hs-identifier hs-var hs-var hs-var hs-var">qLocation</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681125213"><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621681125213"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) (GenModule Unit)
forall (m :: * -&gt; *). HasModule m =&gt; m (GenModule Unit)
</span><a href="GHC.Unit.Module.html#getModule"><span class="hs-identifier hs-var">getModule</span></a></span><span>
</span><span id="line-1105"></span><span>                 </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681125211"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681125211"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn SrcSpan
</span><a href="GHC.Tc.Utils.Monad.html#getSrcSpanM"><span class="hs-identifier hs-var">getSrcSpanM</span></a></span><span>
</span><span id="line-1106"></span><span>                 </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681125210"><span class="annot"><span class="annottext">RealSrcSpan
</span><a href="#local-6989586621681125210"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681125211"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1107"></span><span>                        </span><span class="annot"><a href="GHC.Types.SrcLoc.html#UnhelpfulSpan"><span class="hs-identifier hs-type">UnhelpfulSpan</span></a></span><span> </span><span class="annot"><span class="annottext">UnhelpfulSpanReason
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; MsgDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) RealSrcSpan
forall a. HasCallStack =&gt; String -&gt; MsgDoc -&gt; a
</span><a href="GHC.Utils.Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;qLocation: Unhelpful location&quot;</span></span><span>
</span><span id="line-1108"></span><span>                                                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; MsgDoc
forall a. Outputable a =&gt; a -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681125211"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1109"></span><span>                        </span><span class="annot"><a href="GHC.Types.SrcLoc.html#RealSrcSpan"><span class="hs-identifier hs-type">RealSrcSpan</span></a></span><span> </span><span id="local-6989586621681125207"><span class="annot"><span class="annottext">RealSrcSpan
</span><a href="#local-6989586621681125207"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe BufSpan
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RealSrcSpan -&gt; IOEnv (Env TcGblEnv TcLclEnv) RealSrcSpan
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">RealSrcSpan
</span><a href="#local-6989586621681125207"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-1110"></span><span>                 </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Loc -&gt; TcM Loc
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Loc :: String -&gt; String -&gt; String -&gt; CharPos -&gt; CharPos -&gt; Loc
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Loc"><span class="hs-identifier hs-type">TH.Loc</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">loc_filename :: String
</span><a href="#local-6989586621681125205"><span class="hs-identifier hs-var">TH.loc_filename</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; String
</span><a href="GHC.Data.FastString.html#unpackFS"><span class="hs-identifier hs-var">unpackFS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RealSrcSpan -&gt; FastString
</span><a href="GHC.Types.SrcLoc.html#srcSpanFile"><span class="hs-identifier hs-var hs-var">srcSpanFile</span></a></span><span> </span><span class="annot"><span class="annottext">RealSrcSpan
</span><a href="#local-6989586621681125210"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1111"></span><span>                                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">loc_module :: String
</span><a href="#local-6989586621681125202"><span class="hs-identifier hs-var">TH.loc_module</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; String
</span><a href="GHC.Unit.Module.Name.html#moduleNameString"><span class="hs-identifier hs-var">moduleNameString</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenModule Unit -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621681125213"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1112"></span><span>                                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">loc_package :: String
</span><a href="#local-6989586621681125199"><span class="hs-identifier hs-var">TH.loc_package</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Unit -&gt; String
</span><a href="GHC.Unit.Types.html#unitString"><span class="hs-identifier hs-var">unitString</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenModule Unit -&gt; Unit
forall unit. GenModule unit -&gt; unit
</span><a href="GHC.Unit.Types.html#moduleUnit"><span class="hs-identifier hs-var hs-var">moduleUnit</span></a></span><span> </span><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621681125213"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1113"></span><span>                                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">loc_start :: CharPos
</span><a href="#local-6989586621681125196"><span class="hs-identifier hs-var">TH.loc_start</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RealSrcSpan -&gt; Arity
</span><a href="GHC.Types.SrcLoc.html#srcSpanStartLine"><span class="hs-identifier hs-var">srcSpanStartLine</span></a></span><span> </span><span class="annot"><span class="annottext">RealSrcSpan
</span><a href="#local-6989586621681125210"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RealSrcSpan -&gt; Arity
</span><a href="GHC.Types.SrcLoc.html#srcSpanStartCol"><span class="hs-identifier hs-var">srcSpanStartCol</span></a></span><span> </span><span class="annot"><span class="annottext">RealSrcSpan
</span><a href="#local-6989586621681125210"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1114"></span><span>                                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">loc_end :: CharPos
</span><a href="#local-6989586621681125193"><span class="hs-identifier hs-var">TH.loc_end</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RealSrcSpan -&gt; Arity
</span><a href="GHC.Types.SrcLoc.html#srcSpanEndLine"><span class="hs-identifier hs-var">srcSpanEndLine</span></a></span><span>   </span><span class="annot"><span class="annottext">RealSrcSpan
</span><a href="#local-6989586621681125210"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">RealSrcSpan -&gt; Arity
</span><a href="GHC.Types.SrcLoc.html#srcSpanEndCol"><span class="hs-identifier hs-var">srcSpanEndCol</span></a></span><span>   </span><span class="annot"><span class="annottext">RealSrcSpan
</span><a href="#local-6989586621681125210"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1115"></span><span>
</span><span id="line-1116"></span><span>  </span><span id="local-6989586621681125190"><span class="annot"><span class="annottext">qLookupName :: Bool -&gt; String -&gt; TcM (Maybe Name)
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#qLookupName"><span class="hs-identifier hs-var hs-var hs-var hs-var">qLookupName</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; String -&gt; TcM (Maybe Name)
</span><a href="GHC.Tc.Gen.Splice.html#lookupName"><span class="hs-identifier hs-var">lookupName</span></a></span><span>
</span><span id="line-1117"></span><span>  </span><span id="local-6989586621681125187"><span class="annot"><span class="annottext">qReify :: Name -&gt; TcM Info
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#qReify"><span class="hs-identifier hs-var hs-var hs-var hs-var">qReify</span></a></span></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Info
</span><a href="GHC.Tc.Gen.Splice.html#reify"><span class="hs-identifier hs-var">reify</span></a></span><span>
</span><span id="line-1118"></span><span>  </span><span id="local-6989586621681125183"><span class="annot"><span class="annottext">qReifyFixity :: Name -&gt; TcM (Maybe Fixity)
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#qReifyFixity"><span class="hs-identifier hs-var hs-var hs-var hs-var">qReifyFixity</span></a></span></span><span> </span><span id="local-6989586621681125181"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681125181"><span class="hs-identifier hs-var">nm</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Name
</span><a href="GHC.Tc.Gen.Splice.html#lookupThName"><span class="hs-identifier hs-var">lookupThName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681125181"><span class="hs-identifier hs-var">nm</span></a></span><span> </span><span class="annot"><span class="annottext">TcM Name -&gt; (Name -&gt; TcM (Maybe Fixity)) -&gt; TcM (Maybe Fixity)
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../base/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM (Maybe Fixity)
</span><a href="GHC.Tc.Gen.Splice.html#reifyFixity"><span class="hs-identifier hs-var">reifyFixity</span></a></span><span>
</span><span id="line-1119"></span><span>  </span><span id="local-6989586621681125178"><span class="annot"><span class="annottext">qReifyType :: Name -&gt; TcM Type
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#qReifyType"><span class="hs-identifier hs-var hs-var hs-var hs-var">qReifyType</span></a></span></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyTypeOfThing"><span class="hs-identifier hs-var">reifyTypeOfThing</span></a></span><span>
</span><span id="line-1120"></span><span>  </span><span id="local-6989586621681125175"><span class="annot"><span class="annottext">qReifyInstances :: Name -&gt; [Type] -&gt; TcM [Dec]
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#qReifyInstances"><span class="hs-identifier hs-var hs-var hs-var hs-var">qReifyInstances</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Type] -&gt; TcM [Dec]
</span><a href="GHC.Tc.Gen.Splice.html#reifyInstances"><span class="hs-identifier hs-var">reifyInstances</span></a></span><span>
</span><span id="line-1121"></span><span>  </span><span id="local-6989586621681125172"><span class="annot"><span class="annottext">qReifyRoles :: Name -&gt; TcM [Role]
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#qReifyRoles"><span class="hs-identifier hs-var hs-var hs-var hs-var">qReifyRoles</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM [Role]
</span><a href="GHC.Tc.Gen.Splice.html#reifyRoles"><span class="hs-identifier hs-var">reifyRoles</span></a></span><span>
</span><span id="line-1122"></span><span>  </span><span id="local-6989586621681125167"><span class="annot"><span class="annottext">qReifyAnnotations :: forall a. Data a =&gt; AnnLookup -&gt; TcM [a]
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#qReifyAnnotations"><span class="hs-identifier hs-var hs-var hs-var hs-var">qReifyAnnotations</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AnnLookup -&gt; TcM [a]
forall a. Data a =&gt; AnnLookup -&gt; TcM [a]
</span><a href="GHC.Tc.Gen.Splice.html#reifyAnnotations"><span class="hs-identifier hs-var">reifyAnnotations</span></a></span><span>
</span><span id="line-1123"></span><span>  </span><span id="local-6989586621681125164"><span class="annot"><span class="annottext">qReifyModule :: Module -&gt; TcM ModuleInfo
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#qReifyModule"><span class="hs-identifier hs-var hs-var hs-var hs-var">qReifyModule</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module -&gt; TcM ModuleInfo
</span><a href="GHC.Tc.Gen.Splice.html#reifyModule"><span class="hs-identifier hs-var">reifyModule</span></a></span><span>
</span><span id="line-1124"></span><span>  </span><span id="local-6989586621681125158"><span class="annot"><span class="annottext">qReifyConStrictness :: Name -&gt; TcM [DecidedStrictness]
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#qReifyConStrictness"><span class="hs-identifier hs-var hs-var hs-var hs-var">qReifyConStrictness</span></a></span></span><span> </span><span id="local-6989586621681125156"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681125156"><span class="hs-identifier hs-var">nm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681125155"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681125155"><span class="hs-identifier hs-var">nm'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Name
</span><a href="GHC.Tc.Gen.Splice.html#lookupThName"><span class="hs-identifier hs-var">lookupThName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681125156"><span class="hs-identifier hs-var">nm</span></a></span><span>
</span><span id="line-1125"></span><span>                              </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681125154"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681125154"><span class="hs-identifier hs-var">dc</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM DataCon
</span><a href="GHC.Tc.Utils.Env.html#tcLookupDataCon"><span class="hs-identifier hs-var">tcLookupDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681125155"><span class="hs-identifier hs-var">nm'</span></a></span><span>
</span><span id="line-1126"></span><span>                              </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681125152"><span class="annot"><span class="annottext">bangs :: [HsImplBang]
</span><a href="#local-6989586621681125152"><span class="hs-identifier hs-var hs-var">bangs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; [HsImplBang]
</span><a href="GHC.Core.DataCon.html#dataConImplBangs"><span class="hs-identifier hs-var">dataConImplBangs</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681125154"><span class="hs-identifier hs-var">dc</span></a></span><span>
</span><span id="line-1127"></span><span>                              </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">[DecidedStrictness] -&gt; TcM [DecidedStrictness]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(HsImplBang -&gt; DecidedStrictness)
-&gt; [HsImplBang] -&gt; [DecidedStrictness]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">HsImplBang -&gt; DecidedStrictness
</span><a href="GHC.Tc.Gen.Splice.html#reifyDecidedStrictness"><span class="hs-identifier hs-var">reifyDecidedStrictness</span></a></span><span> </span><span class="annot"><span class="annottext">[HsImplBang]
</span><a href="#local-6989586621681125152"><span class="hs-identifier hs-var">bangs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1128"></span><span>
</span><span id="line-1129"></span><span>        </span><span class="hs-comment">-- For qRecover, discard error messages if</span><span>
</span><span id="line-1130"></span><span>        </span><span class="hs-comment">-- the recovery action is chosen.  Otherwise</span><span>
</span><span id="line-1131"></span><span>        </span><span class="hs-comment">-- we'll only fail higher up.</span><span>
</span><span id="line-1132"></span><span>  </span><span id="local-6989586621681125149"><span class="annot"><span class="annottext">qRecover :: forall a. TcM a -&gt; TcM a -&gt; TcM a
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#qRecover"><span class="hs-identifier hs-var hs-var hs-var hs-var">qRecover</span></a></span></span><span> </span><span id="local-6989586621681125147"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681125147"><span class="hs-identifier hs-var">recover</span></a></span></span><span> </span><span id="local-6989586621681125146"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681125146"><span class="hs-identifier hs-var">main</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TcM a -&gt; TcM a -&gt; TcM a
forall a. TcM a -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#tryTcDiscardingErrs"><span class="hs-identifier hs-var">tryTcDiscardingErrs</span></a></span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681125147"><span class="hs-identifier hs-var">recover</span></a></span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681125146"><span class="hs-identifier hs-var">main</span></a></span><span>
</span><span id="line-1133"></span><span>
</span><span id="line-1134"></span><span>  </span><span id="local-6989586621681125141"><span class="annot"><span class="annottext">qAddDependentFile :: String -&gt; TcRn ()
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#qAddDependentFile"><span class="hs-identifier hs-var hs-var hs-var hs-var">qAddDependentFile</span></a></span></span><span> </span><span id="local-6989586621681125139"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681125139"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1135"></span><span>    </span><span id="local-6989586621681125138"><span class="annot"><span class="annottext">TcRef [String]
</span><a href="#local-6989586621681125138"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TcGblEnv -&gt; TcRef [String])
-&gt; TcRnIf TcGblEnv TcLclEnv TcGblEnv
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (TcRef [String])
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; TcRef [String]
</span><a href="GHC.Tc.Types.html#tcg_dependent_files"><span class="hs-identifier hs-var hs-var">tcg_dependent_files</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-1136"></span><span>    </span><span id="local-6989586621681125136"><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681125136"><span class="hs-identifier hs-var">dep_files</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRef [String] -&gt; TcRnIf TcGblEnv TcLclEnv [String]
forall a gbl lcl. TcRef a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef [String]
</span><a href="#local-6989586621681125138"><span class="hs-identifier hs-var">ref</span></a></span><span>
</span><span id="line-1137"></span><span>    </span><span class="annot"><span class="annottext">TcRef [String] -&gt; [String] -&gt; TcRn ()
forall a gbl lcl. TcRef a -&gt; a -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#writeTcRef"><span class="hs-identifier hs-var">writeTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef [String]
</span><a href="#local-6989586621681125138"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681125139"><span class="hs-identifier hs-var">fp</span></a></span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; [String]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[String]
</span><a href="#local-6989586621681125136"><span class="hs-identifier hs-var">dep_files</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1138"></span><span>
</span><span id="line-1139"></span><span>  </span><span id="local-6989586621681125130"><span class="annot"><span class="annottext">qAddTempFile :: String -&gt; IOEnv (Env TcGblEnv TcLclEnv) String
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#qAddTempFile"><span class="hs-identifier hs-var hs-var hs-var hs-var">qAddTempFile</span></a></span></span><span> </span><span id="local-6989586621681125128"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681125128"><span class="hs-identifier hs-var">suffix</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1140"></span><span>    </span><span id="local-6989586621681125127"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681125127"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-1141"></span><span>    </span><span class="annot"><span class="annottext">IO String -&gt; IOEnv (Env TcGblEnv TcLclEnv) String
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO String -&gt; IOEnv (Env TcGblEnv TcLclEnv) String)
-&gt; IO String -&gt; IOEnv (Env TcGblEnv TcLclEnv) String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; TempFileLifetime -&gt; String -&gt; IO String
</span><a href="GHC.SysTools.FileCleanup.html#newTempName"><span class="hs-identifier hs-var">newTempName</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681125127"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">TempFileLifetime
</span><a href="GHC.SysTools.FileCleanup.html#TFL_GhcSession"><span class="hs-identifier hs-var">TFL_GhcSession</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681125128"><span class="hs-identifier hs-var">suffix</span></a></span><span>
</span><span id="line-1142"></span><span>
</span><span id="line-1143"></span><span>  </span><span id="local-6989586621681125105"><span class="annot"><span class="annottext">qAddTopDecls :: [Dec] -&gt; TcRn ()
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#qAddTopDecls"><span class="hs-identifier hs-var hs-var hs-var hs-var">qAddTopDecls</span></a></span></span><span> </span><span id="local-6989586621681125103"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621681125103"><span class="hs-identifier hs-var">thds</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1144"></span><span>      </span><span id="local-6989586621681125102"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681125102"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn SrcSpan
</span><a href="GHC.Tc.Utils.Monad.html#getSrcSpanM"><span class="hs-identifier hs-var">getSrcSpanM</span></a></span><span>
</span><span id="line-1145"></span><span>      </span><span id="local-6989586621681125101"><span class="annot"><span class="annottext">Origin
</span><a href="#local-6989586621681125101"><span class="hs-identifier hs-var">th_origin</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM Origin
</span><a href="GHC.Tc.Gen.Splice.html#getThSpliceOrigin"><span class="hs-identifier hs-var">getThSpliceOrigin</span></a></span><span>
</span><span id="line-1146"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681125100"><span class="annot"><span class="annottext">either_hval :: Either MsgDoc [LHsDecl GhcPs]
</span><a href="#local-6989586621681125100"><span class="hs-identifier hs-var hs-var">either_hval</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Origin -&gt; SrcSpan -&gt; [Dec] -&gt; Either MsgDoc [LHsDecl GhcPs]
</span><a href="GHC.ThToHs.html#convertToHsDecls"><span class="hs-identifier hs-var">convertToHsDecls</span></a></span><span> </span><span class="annot"><span class="annottext">Origin
</span><a href="#local-6989586621681125101"><span class="hs-identifier hs-var">th_origin</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681125102"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621681125103"><span class="hs-identifier hs-var">thds</span></a></span><span>
</span><span id="line-1147"></span><span>      </span><span id="local-6989586621681125099"><span class="annot"><span class="annottext">[LHsDecl GhcPs]
</span><a href="#local-6989586621681125099"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either MsgDoc [LHsDecl GhcPs]
</span><a href="#local-6989586621681125100"><span class="hs-identifier hs-var">either_hval</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1148"></span><span>              </span><span class="annot"><a href="../../base/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621681125098"><span class="annot"><span class="annottext">MsgDoc
</span><a href="#local-6989586621681125098"><span class="hs-identifier hs-var">exn</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MsgDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) [LHsDecl GhcPs]
forall a. MsgDoc -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span> </span><span class="annot"><span class="annottext">(MsgDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) [LHsDecl GhcPs])
-&gt; MsgDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) [LHsDecl GhcPs]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1149"></span><span>                </span><span class="annot"><span class="annottext">MsgDoc -&gt; Arity -&gt; MsgDoc -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Error in a declaration passed to addTopDecls:&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1150"></span><span>                   </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">MsgDoc
</span><a href="#local-6989586621681125098"><span class="hs-identifier hs-var">exn</span></a></span><span>
</span><span id="line-1151"></span><span>              </span><span class="annot"><a href="../../base/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621681125097"><span class="annot"><span class="annottext">[LHsDecl GhcPs]
</span><a href="#local-6989586621681125097"><span class="hs-identifier hs-var">ds</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[LHsDecl GhcPs] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [LHsDecl GhcPs]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsDecl GhcPs]
</span><a href="#local-6989586621681125097"><span class="hs-identifier hs-var">ds</span></a></span><span>
</span><span id="line-1152"></span><span>      </span><span class="annot"><span class="annottext">(LHsDecl GhcPs -&gt; TcRn ()) -&gt; [LHsDecl GhcPs] -&gt; TcRn ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><a href="../../base/src/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsDecl GhcPs -&gt; TcRn ()
</span><a href="#local-6989586621681125095"><span class="hs-identifier hs-var">checkTopDecl</span></a></span><span> </span><span class="annot"><span class="annottext">(HsDecl GhcPs -&gt; TcRn ())
-&gt; (LHsDecl GhcPs -&gt; HsDecl GhcPs) -&gt; LHsDecl GhcPs -&gt; TcRn ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">LHsDecl GhcPs -&gt; HsDecl GhcPs
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[LHsDecl GhcPs]
</span><a href="#local-6989586621681125099"><span class="hs-identifier hs-var">ds</span></a></span><span>
</span><span id="line-1153"></span><span>      </span><span id="local-6989586621681125094"><span class="annot"><span class="annottext">TcRef [LHsDecl GhcPs]
</span><a href="#local-6989586621681125094"><span class="hs-identifier hs-var">th_topdecls_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TcGblEnv -&gt; TcRef [LHsDecl GhcPs])
-&gt; TcRnIf TcGblEnv TcLclEnv TcGblEnv
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (TcRef [LHsDecl GhcPs])
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; TcRef [LHsDecl GhcPs]
</span><a href="GHC.Tc.Types.html#tcg_th_topdecls"><span class="hs-identifier hs-var hs-var">tcg_th_topdecls</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-1154"></span><span>      </span><span class="annot"><span class="annottext">TcRef [LHsDecl GhcPs]
-&gt; ([LHsDecl GhcPs] -&gt; [LHsDecl GhcPs]) -&gt; TcRn ()
forall a gbl lcl. TcRef a -&gt; (a -&gt; a) -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#updTcRef"><span class="hs-identifier hs-var">updTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef [LHsDecl GhcPs]
</span><a href="#local-6989586621681125094"><span class="hs-identifier hs-var">th_topdecls_var</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681125091"><span class="annot"><span class="annottext">[LHsDecl GhcPs]
</span><a href="#local-6989586621681125091"><span class="hs-identifier hs-var">topds</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[LHsDecl GhcPs]
</span><a href="#local-6989586621681125099"><span class="hs-identifier hs-var">ds</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsDecl GhcPs] -&gt; [LHsDecl GhcPs] -&gt; [LHsDecl GhcPs]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[LHsDecl GhcPs]
</span><a href="#local-6989586621681125091"><span class="hs-identifier hs-var">topds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1155"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-1156"></span><span>      </span><span class="annot"><a href="#local-6989586621681125095"><span class="hs-identifier hs-type">checkTopDecl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Hs.Decls.html#HsDecl"><span class="hs-identifier hs-type">HsDecl</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1157"></span><span>      </span><span id="local-6989586621681125095"><span class="annot"><span class="annottext">checkTopDecl :: HsDecl GhcPs -&gt; TcRn ()
</span><a href="#local-6989586621681125095"><span class="hs-identifier hs-var hs-var">checkTopDecl</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Decls.html#ValD"><span class="hs-identifier hs-type">ValD</span></a></span><span> </span><span class="annot"><span class="annottext">XValD GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681125089"><span class="annot"><span class="annottext">HsBind GhcPs
</span><a href="#local-6989586621681125089"><span class="hs-identifier hs-var">binds</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1158"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(RdrName -&gt; TcRn ()) -&gt; [RdrName] -&gt; TcRn ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><a href="../../base/src/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; TcRn ()
</span><a href="#local-6989586621681125088"><span class="hs-identifier hs-var">bindName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HsBind GhcPs -&gt; [IdP GhcPs]
forall p idR. CollectPass p =&gt; HsBindLR p idR -&gt; [IdP p]
</span><a href="GHC.Hs.Utils.html#collectHsBindBinders"><span class="hs-identifier hs-var">collectHsBindBinders</span></a></span><span> </span><span class="annot"><span class="annottext">HsBind GhcPs
</span><a href="#local-6989586621681125089"><span class="hs-identifier hs-var">binds</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1159"></span><span>      </span><span class="annot"><a href="#local-6989586621681125095"><span class="hs-identifier hs-var">checkTopDecl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Decls.html#SigD"><span class="hs-identifier hs-type">SigD</span></a></span><span> </span><span class="annot"><span class="annottext">XSigD GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Sig GhcPs
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-1160"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1161"></span><span>      </span><span class="annot"><a href="#local-6989586621681125095"><span class="hs-identifier hs-var">checkTopDecl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Decls.html#AnnD"><span class="hs-identifier hs-type">AnnD</span></a></span><span> </span><span class="annot"><span class="annottext">XAnnD GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">AnnDecl GhcPs
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-1162"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1163"></span><span>      </span><span class="annot"><a href="#local-6989586621681125095"><span class="hs-identifier hs-var">checkTopDecl</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Decls.html#ForD"><span class="hs-identifier hs-type">ForD</span></a></span><span> </span><span class="annot"><span class="annottext">XForD GhcPs
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Decls.html#ForeignImport"><span class="hs-identifier hs-type">ForeignImport</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">fd_name :: forall pass. ForeignDecl pass -&gt; Located (IdP pass)
</span><a href="GHC.Hs.Decls.html#fd_name"><span class="hs-identifier hs-var">fd_name</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681125081"><span class="annot"><span class="annottext">IdP GhcPs
</span><a href="#local-6989586621681125081"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1164"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; TcRn ()
</span><a href="#local-6989586621681125088"><span class="hs-identifier hs-var">bindName</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
IdP GhcPs
</span><a href="#local-6989586621681125081"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-1165"></span><span>      </span><span class="annot"><a href="#local-6989586621681125095"><span class="hs-identifier hs-var">checkTopDecl</span></a></span><span> </span><span class="annot"><span class="annottext">HsDecl GhcPs
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-1166"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MsgDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a></span><span> </span><span class="annot"><span class="annottext">(MsgDoc -&gt; TcRn ()) -&gt; MsgDoc -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Only function, value, annotation, and foreign import declarations may be added with addTopDecl&quot;</span></span><span>
</span><span id="line-1167"></span><span>
</span><span id="line-1168"></span><span>      </span><span class="annot"><a href="#local-6989586621681125088"><span class="hs-identifier hs-type">bindName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Reader.html#RdrName"><span class="hs-identifier hs-type">RdrName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1169"></span><span>      </span><span id="local-6989586621681125088"><span class="annot"><span class="annottext">bindName :: RdrName -&gt; TcRn ()
</span><a href="#local-6989586621681125088"><span class="hs-identifier hs-var hs-var">bindName</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Name.Reader.html#Exact"><span class="hs-identifier hs-type">Exact</span></a></span><span> </span><span id="local-6989586621681125079"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681125079"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1170"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681125078"><span class="annot"><span class="annottext">TcRef FreeVars
</span><a href="#local-6989586621681125078"><span class="hs-identifier hs-var">th_topnames_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TcGblEnv -&gt; TcRef FreeVars)
-&gt; TcRnIf TcGblEnv TcLclEnv TcGblEnv
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (TcRef FreeVars)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; TcRef FreeVars
</span><a href="GHC.Tc.Types.html#tcg_th_topnames"><span class="hs-identifier hs-var hs-var">tcg_th_topnames</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-1171"></span><span>             </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcRef FreeVars -&gt; (FreeVars -&gt; FreeVars) -&gt; TcRn ()
forall a gbl lcl. TcRef a -&gt; (a -&gt; a) -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#updTcRef"><span class="hs-identifier hs-var">updTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef FreeVars
</span><a href="#local-6989586621681125078"><span class="hs-identifier hs-var">th_topnames_var</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681125076"><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621681125076"><span class="hs-identifier hs-var">ns</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FreeVars -&gt; Name -&gt; FreeVars
</span><a href="GHC.Types.Name.Set.html#extendNameSet"><span class="hs-identifier hs-var">extendNameSet</span></a></span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621681125076"><span class="hs-identifier hs-var">ns</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681125079"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1172"></span><span>             </span><span class="hs-special">}</span><span>
</span><span id="line-1173"></span><span>
</span><span id="line-1174"></span><span>      </span><span class="annot"><a href="#local-6989586621681125088"><span class="hs-identifier hs-var">bindName</span></a></span><span> </span><span id="local-6989586621681125074"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621681125074"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1175"></span><span>          </span><span class="annot"><span class="annottext">MsgDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a></span><span> </span><span class="annot"><span class="annottext">(MsgDoc -&gt; TcRn ()) -&gt; MsgDoc -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1176"></span><span>          </span><span class="annot"><span class="annottext">MsgDoc -&gt; Arity -&gt; MsgDoc -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;The binder&quot;</span></span><span> </span><span class="annot"><span class="annottext">MsgDoc -&gt; MsgDoc -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">MsgDoc -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RdrName -&gt; MsgDoc
forall a. Outputable a =&gt; a -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621681125074"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MsgDoc -&gt; MsgDoc -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">PtrString -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#ptext"><span class="hs-identifier hs-var">ptext</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; PtrString
</span><a href="GHC.Data.FastString.html#sLit"><span class="hs-identifier hs-var">sLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;is not a NameU.&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1177"></span><span>             </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Probable cause: you used mkName instead of newName to generate a binding.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1178"></span><span>
</span><span id="line-1179"></span><span>  </span><span id="local-6989586621681125068"><span class="annot"><span class="annottext">qAddForeignFilePath :: ForeignSrcLang -&gt; String -&gt; TcRn ()
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#qAddForeignFilePath"><span class="hs-identifier hs-var hs-var hs-var hs-var">qAddForeignFilePath</span></a></span></span><span> </span><span id="local-6989586621681125066"><span class="annot"><span class="annottext">ForeignSrcLang
</span><a href="#local-6989586621681125066"><span class="hs-identifier hs-var">lang</span></a></span></span><span> </span><span id="local-6989586621681125065"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681125065"><span class="hs-identifier hs-var">fp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1180"></span><span>    </span><span id="local-6989586621681125064"><span class="annot"><span class="annottext">TcRef [(ForeignSrcLang, String)]
</span><a href="#local-6989586621681125064"><span class="hs-identifier hs-var">var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TcGblEnv -&gt; TcRef [(ForeignSrcLang, String)])
-&gt; TcRnIf TcGblEnv TcLclEnv TcGblEnv
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (TcRef [(ForeignSrcLang, String)])
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; TcRef [(ForeignSrcLang, String)]
</span><a href="GHC.Tc.Types.html#tcg_th_foreign_files"><span class="hs-identifier hs-var hs-var">tcg_th_foreign_files</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-1181"></span><span>    </span><span class="annot"><span class="annottext">TcRef [(ForeignSrcLang, String)]
-&gt; ([(ForeignSrcLang, String)] -&gt; [(ForeignSrcLang, String)])
-&gt; TcRn ()
forall a gbl lcl. TcRef a -&gt; (a -&gt; a) -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#updTcRef"><span class="hs-identifier hs-var">updTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef [(ForeignSrcLang, String)]
</span><a href="#local-6989586621681125064"><span class="hs-identifier hs-var">var</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">ForeignSrcLang
</span><a href="#local-6989586621681125066"><span class="hs-identifier hs-var">lang</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681125065"><span class="hs-identifier hs-var">fp</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ForeignSrcLang, String)
-&gt; [(ForeignSrcLang, String)] -&gt; [(ForeignSrcLang, String)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span>
</span><span id="line-1182"></span><span>
</span><span id="line-1183"></span><span>  </span><span id="local-6989586621681125058"><span class="annot"><span class="annottext">qAddModFinalizer :: Q () -&gt; TcRn ()
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#qAddModFinalizer"><span class="hs-identifier hs-var hs-var hs-var hs-var">qAddModFinalizer</span></a></span></span><span> </span><span id="local-6989586621681125056"><span class="annot"><span class="annottext">Q ()
</span><a href="#local-6989586621681125056"><span class="hs-identifier hs-var">fin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1184"></span><span>      </span><span id="local-6989586621681125055"><span class="annot"><span class="annottext">RemoteRef (Q ())
</span><a href="#local-6989586621681125055"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (RemoteRef (Q ()))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (RemoteRef (Q ()))
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (RemoteRef (Q ()))
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) (RemoteRef (Q ())))
-&gt; IO (RemoteRef (Q ()))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (RemoteRef (Q ()))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Q () -&gt; IO (RemoteRef (Q ()))
forall a. a -&gt; IO (RemoteRef a)
</span><a href="../../ghci/src/GHCi.RemoteTypes.html#mkRemoteRef"><span class="hs-identifier hs-var">mkRemoteRef</span></a></span><span> </span><span class="annot"><span class="annottext">Q ()
</span><a href="#local-6989586621681125056"><span class="hs-identifier hs-var">fin</span></a></span><span>
</span><span id="line-1185"></span><span>      </span><span id="local-6989586621681125053"><span class="annot"><span class="annottext">ForeignRef (Q ())
</span><a href="#local-6989586621681125053"><span class="hs-identifier hs-var">fref</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (ForeignRef (Q ()))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (ForeignRef (Q ()))
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (ForeignRef (Q ()))
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) (ForeignRef (Q ())))
-&gt; IO (ForeignRef (Q ()))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (ForeignRef (Q ()))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteRef (Q ()) -&gt; IO () -&gt; IO (ForeignRef (Q ()))
forall a. RemoteRef a -&gt; IO () -&gt; IO (ForeignRef a)
</span><a href="../../ghci/src/GHCi.RemoteTypes.html#mkForeignRef"><span class="hs-identifier hs-var">mkForeignRef</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteRef (Q ())
</span><a href="#local-6989586621681125055"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RemoteRef (Q ()) -&gt; IO ()
forall a. RemoteRef a -&gt; IO ()
</span><a href="../../ghci/src/GHCi.RemoteTypes.html#freeRemoteRef"><span class="hs-identifier hs-var">freeRemoteRef</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteRef (Q ())
</span><a href="#local-6989586621681125055"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1186"></span><span>      </span><span class="annot"><span class="annottext">ForeignRef (Q ()) -&gt; TcRn ()
</span><a href="GHC.Tc.Gen.Splice.html#addModFinalizerRef"><span class="hs-identifier hs-var">addModFinalizerRef</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignRef (Q ())
</span><a href="#local-6989586621681125053"><span class="hs-identifier hs-var">fref</span></a></span><span>
</span><span id="line-1187"></span><span>
</span><span id="line-1188"></span><span>  </span><span id="local-6989586621681125038"><span class="annot"><span class="annottext">qAddCorePlugin :: String -&gt; TcRn ()
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#qAddCorePlugin"><span class="hs-identifier hs-var hs-var hs-var hs-var">qAddCorePlugin</span></a></span></span><span> </span><span id="local-6989586621681125036"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681125036"><span class="hs-identifier hs-var">plugin</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1189"></span><span>      </span><span id="local-6989586621681125035"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681125035"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv HscEnv
forall gbl lcl. TcRnIf gbl lcl HscEnv
</span><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-var">getTopEnv</span></a></span><span>
</span><span id="line-1190"></span><span>      </span><span id="local-6989586621681125034"><span class="annot"><span class="annottext">FindResult
</span><a href="#local-6989586621681125034"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO FindResult -&gt; IOEnv (Env TcGblEnv TcLclEnv) FindResult
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO FindResult -&gt; IOEnv (Env TcGblEnv TcLclEnv) FindResult)
-&gt; IO FindResult -&gt; IOEnv (Env TcGblEnv TcLclEnv) FindResult
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; ModuleName -&gt; IO FindResult
</span><a href="GHC.Driver.Finder.html#findHomeModule"><span class="hs-identifier hs-var">findHomeModule</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681125035"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; ModuleName
</span><a href="GHC.Unit.Module.Name.html#mkModuleName"><span class="hs-identifier hs-var">mkModuleName</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681125036"><span class="hs-identifier hs-var">plugin</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1191"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681125031"><span class="annot"><span class="annottext">err :: MsgDoc
</span><a href="#local-6989586621681125031"><span class="hs-identifier hs-var hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MsgDoc -&gt; Arity -&gt; MsgDoc -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span>
</span><span id="line-1192"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;addCorePlugin: invalid plugin module &quot;</span></span><span>
</span><span id="line-1193"></span><span>               </span><span class="annot"><span class="annottext">MsgDoc -&gt; MsgDoc -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../base/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681125036"><span class="hs-identifier hs-var">plugin</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1194"></span><span>            </span><span class="hs-special">)</span><span>
</span><span id="line-1195"></span><span>            </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">2</span></span><span>
</span><span id="line-1196"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Plugins in the current package can't be specified.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1197"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">FindResult
</span><a href="#local-6989586621681125034"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1198"></span><span>        </span><span class="annot"><a href="GHC.Driver.Types.html#Found"><span class="hs-identifier hs-type">Found</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MsgDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a></span><span> </span><span class="annot"><span class="annottext">MsgDoc
</span><a href="#local-6989586621681125031"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-1199"></span><span>        </span><span class="annot"><a href="GHC.Driver.Types.html#FoundMultiple"><span class="hs-identifier hs-type">FoundMultiple</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MsgDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#addErr"><span class="hs-identifier hs-var">addErr</span></a></span><span> </span><span class="annot"><span class="annottext">MsgDoc
</span><a href="#local-6989586621681125031"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-1200"></span><span>        </span><span class="annot"><span class="annottext">FindResult
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1201"></span><span>      </span><span id="local-6989586621681125027"><span class="annot"><span class="annottext">TcRef [String]
</span><a href="#local-6989586621681125027"><span class="hs-identifier hs-var">th_coreplugins_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; TcRef [String]
</span><a href="GHC.Tc.Types.html#tcg_th_coreplugins"><span class="hs-identifier hs-var hs-var">tcg_th_coreplugins</span></a></span><span> </span><span class="annot"><span class="annottext">(TcGblEnv -&gt; TcRef [String])
-&gt; TcRnIf TcGblEnv TcLclEnv TcGblEnv
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (TcRef [String])
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-1202"></span><span>      </span><span class="annot"><span class="annottext">TcRef [String] -&gt; ([String] -&gt; [String]) -&gt; TcRn ()
forall a gbl lcl. TcRef a -&gt; (a -&gt; a) -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#updTcRef"><span class="hs-identifier hs-var">updTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef [String]
</span><a href="#local-6989586621681125027"><span class="hs-identifier hs-var">th_coreplugins_var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681125036"><span class="hs-identifier hs-var">plugin</span></a></span><span class="annot"><span class="annottext">String -&gt; [String] -&gt; [String]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span>
</span><span id="line-1203"></span><span>
</span><span id="line-1204"></span><span>  </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#qGetQ"><span class="hs-identifier hs-type">qGetQ</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621681125024"><span class="annot"><a href="#local-6989586621681125024"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-operator">.</span><span> </span><span class="annot"><a href="../../base/src/Data.Typeable.Internal.html#Typeable"><span class="hs-identifier hs-type">Typeable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681125024"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681125024"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1205"></span><span>  </span><span id="local-6989586621681125010"><span class="annot"><span class="annottext">qGetQ :: forall a. Typeable a =&gt; TcM (Maybe a)
</span><a href="#local-6989586621681125010"><span class="hs-identifier hs-var hs-var hs-var hs-var">qGetQ</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1206"></span><span>      </span><span id="local-6989586621681125009"><span class="annot"><span class="annottext">TcRef (Map TypeRep Dynamic)
</span><a href="#local-6989586621681125009"><span class="hs-identifier hs-var">th_state_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TcGblEnv -&gt; TcRef (Map TypeRep Dynamic))
-&gt; TcRnIf TcGblEnv TcLclEnv TcGblEnv
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (TcRef (Map TypeRep Dynamic))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; TcRef (Map TypeRep Dynamic)
</span><a href="GHC.Tc.Types.html#tcg_th_state"><span class="hs-identifier hs-var hs-var">tcg_th_state</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-1207"></span><span>      </span><span id="local-6989586621681125007"><span class="annot"><span class="annottext">Map TypeRep Dynamic
</span><a href="#local-6989586621681125007"><span class="hs-identifier hs-var">th_state</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRef (Map TypeRep Dynamic)
-&gt; TcRnIf TcGblEnv TcLclEnv (Map TypeRep Dynamic)
forall a gbl lcl. TcRef a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef (Map TypeRep Dynamic)
</span><a href="#local-6989586621681125009"><span class="hs-identifier hs-var">th_state_var</span></a></span><span>
</span><span id="line-1208"></span><span>      </span><span class="hs-comment">-- See #10596 for why we use a scoped type variable here.</span><span>
</span><span id="line-1209"></span><span>      </span><span class="annot"><span class="annottext">Maybe a -&gt; TcM (Maybe a)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeRep -&gt; Map TypeRep Dynamic -&gt; Maybe Dynamic
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../containers/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy a -&gt; TypeRep
forall {k} (proxy :: k -&gt; *) (a :: k).
Typeable a =&gt;
proxy a -&gt; TypeRep
</span><a href="../../base/src/Data.Typeable.html#typeRep"><span class="hs-identifier hs-var">typeRep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Proxy a
forall {k} (t :: k). Proxy t
</span><a href="../../base/src/Data.Proxy.html#Proxy"><span class="hs-identifier hs-var">Proxy</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base/src/Data.Proxy.html#Proxy"><span class="hs-identifier hs-type">Proxy</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681125024"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map TypeRep Dynamic
</span><a href="#local-6989586621681125007"><span class="hs-identifier hs-var">th_state</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Dynamic -&gt; (Dynamic -&gt; Maybe a) -&gt; Maybe a
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../base/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Dynamic -&gt; Maybe a
forall a. Typeable a =&gt; Dynamic -&gt; Maybe a
</span><a href="../../base/src/Data.Dynamic.html#fromDynamic"><span class="hs-identifier hs-var">fromDynamic</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1210"></span><span>
</span><span id="line-1211"></span><span>  </span><span id="local-6989586621681124998"><span class="annot"><span class="annottext">qPutQ :: forall a. Typeable a =&gt; a -&gt; TcRn ()
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#qPutQ"><span class="hs-identifier hs-var hs-var hs-var hs-var">qPutQ</span></a></span></span><span> </span><span id="local-6989586621681124996"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681124996"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1212"></span><span>      </span><span id="local-6989586621681124995"><span class="annot"><span class="annottext">TcRef (Map TypeRep Dynamic)
</span><a href="#local-6989586621681124995"><span class="hs-identifier hs-var">th_state_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(TcGblEnv -&gt; TcRef (Map TypeRep Dynamic))
-&gt; TcRnIf TcGblEnv TcLclEnv TcGblEnv
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (TcRef (Map TypeRep Dynamic))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv -&gt; TcRef (Map TypeRep Dynamic)
</span><a href="GHC.Tc.Types.html#tcg_th_state"><span class="hs-identifier hs-var hs-var">tcg_th_state</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-1213"></span><span>      </span><span class="annot"><span class="annottext">TcRef (Map TypeRep Dynamic)
-&gt; (Map TypeRep Dynamic -&gt; Map TypeRep Dynamic) -&gt; TcRn ()
forall a gbl lcl. TcRef a -&gt; (a -&gt; a) -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#updTcRef"><span class="hs-identifier hs-var">updTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef (Map TypeRep Dynamic)
</span><a href="#local-6989586621681124995"><span class="hs-identifier hs-var">th_state_var</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681124994"><span class="annot"><span class="annottext">Map TypeRep Dynamic
</span><a href="#local-6989586621681124994"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TypeRep -&gt; Dynamic -&gt; Map TypeRep Dynamic -&gt; Map TypeRep Dynamic
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="../../containers/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">Map.insert</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; TypeRep
forall a. Typeable a =&gt; a -&gt; TypeRep
</span><a href="../../base/src/Data.Typeable.html#typeOf"><span class="hs-identifier hs-var">typeOf</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681124996"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Dynamic
forall a. Typeable a =&gt; a -&gt; Dynamic
</span><a href="../../base/src/Data.Dynamic.html#toDyn"><span class="hs-identifier hs-var">toDyn</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681124996"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Map TypeRep Dynamic
</span><a href="#local-6989586621681124994"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1214"></span><span>
</span><span id="line-1215"></span><span>  </span><span id="local-6989586621681124992"><span class="annot"><span class="annottext">qIsExtEnabled :: Extension -&gt; TcRnIf TcGblEnv TcLclEnv Bool
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#qIsExtEnabled"><span class="hs-identifier hs-var hs-var hs-var hs-var">qIsExtEnabled</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Extension -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall gbl lcl. Extension -&gt; TcRnIf gbl lcl Bool
</span><a href="GHC.Tc.Utils.Monad.html#xoptM"><span class="hs-identifier hs-var">xoptM</span></a></span><span>
</span><span id="line-1216"></span><span>
</span><span id="line-1217"></span><span>  </span><span id="local-6989586621681124986"><span class="annot"><span class="annottext">qExtsEnabled :: TcM [Extension]
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#qExtsEnabled"><span class="hs-identifier hs-var hs-var hs-var hs-var">qExtsEnabled</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1218"></span><span>    </span><span class="annot"><span class="annottext">EnumSet Extension -&gt; [Extension]
forall a. Enum a =&gt; EnumSet a -&gt; [a]
</span><a href="GHC.Data.EnumSet.html#toList"><span class="hs-identifier hs-var">EnumSet.toList</span></a></span><span> </span><span class="annot"><span class="annottext">(EnumSet Extension -&gt; [Extension])
-&gt; (HscEnv -&gt; EnumSet Extension) -&gt; HscEnv -&gt; [Extension]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; EnumSet Extension
</span><a href="GHC.Driver.Session.html#extensionFlags"><span class="hs-identifier hs-var hs-var">extensionFlags</span></a></span><span> </span><span class="annot"><span class="annottext">(DynFlags -&gt; EnumSet Extension)
-&gt; (HscEnv -&gt; DynFlags) -&gt; HscEnv -&gt; EnumSet Extension
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">(HscEnv -&gt; [Extension])
-&gt; TcRnIf TcGblEnv TcLclEnv HscEnv -&gt; TcM [Extension]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv HscEnv
forall gbl lcl. TcRnIf gbl lcl HscEnv
</span><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-var">getTopEnv</span></a></span><span>
</span><span id="line-1219"></span><span>
</span><span id="line-1220"></span><span class="hs-comment">-- | Adds a mod finalizer reference to the local environment.</span><span>
</span><span id="line-1221"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#addModFinalizerRef"><span class="hs-identifier hs-type">addModFinalizerRef</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../ghci/src/GHCi.RemoteTypes.html#ForeignRef"><span class="hs-identifier hs-type">ForeignRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Q"><span class="hs-identifier hs-type">TH.Q</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1222"></span><span id="addModFinalizerRef"><span class="annot"><span class="annottext">addModFinalizerRef :: ForeignRef (Q ()) -&gt; TcRn ()
</span><a href="GHC.Tc.Gen.Splice.html#addModFinalizerRef"><span class="hs-identifier hs-var hs-var">addModFinalizerRef</span></a></span></span><span> </span><span id="local-6989586621681124982"><span class="annot"><span class="annottext">ForeignRef (Q ())
</span><a href="#local-6989586621681124982"><span class="hs-identifier hs-var">finRef</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1223"></span><span>    </span><span id="local-6989586621681124981"><span class="annot"><span class="annottext">ThStage
</span><a href="#local-6989586621681124981"><span class="hs-identifier hs-var">th_stage</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM ThStage
</span><a href="GHC.Tc.Utils.Monad.html#getStage"><span class="hs-identifier hs-var">getStage</span></a></span><span>
</span><span id="line-1224"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ThStage
</span><a href="#local-6989586621681124981"><span class="hs-identifier hs-var">th_stage</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1225"></span><span>      </span><span class="annot"><a href="GHC.Tc.Types.html#RunSplice"><span class="hs-identifier hs-type">RunSplice</span></a></span><span> </span><span id="local-6989586621681124980"><span class="annot"><span class="annottext">TcRef [ForeignRef (Q ())]
</span><a href="#local-6989586621681124980"><span class="hs-identifier hs-var">th_modfinalizers_var</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcRef [ForeignRef (Q ())]
-&gt; ([ForeignRef (Q ())] -&gt; [ForeignRef (Q ())]) -&gt; TcRn ()
forall a gbl lcl. TcRef a -&gt; (a -&gt; a) -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#updTcRef"><span class="hs-identifier hs-var">updTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef [ForeignRef (Q ())]
</span><a href="#local-6989586621681124980"><span class="hs-identifier hs-var">th_modfinalizers_var</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ForeignRef (Q ())
</span><a href="#local-6989586621681124982"><span class="hs-identifier hs-var">finRef</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignRef (Q ()) -&gt; [ForeignRef (Q ())] -&gt; [ForeignRef (Q ())]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span>
</span><span id="line-1226"></span><span>      </span><span class="hs-comment">-- This case happens only if a splice is executed and the caller does</span><span>
</span><span id="line-1227"></span><span>      </span><span class="hs-comment">-- not set the 'ThStage' to 'RunSplice' to collect finalizers.</span><span>
</span><span id="line-1228"></span><span>      </span><span class="hs-comment">-- See Note [Delaying modFinalizers in untyped splices] in GHC.Rename.Splice.</span><span>
</span><span id="line-1229"></span><span>      </span><span class="annot"><span class="annottext">ThStage
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1230"></span><span>        </span><span class="annot"><span class="annottext">String -&gt; MsgDoc -&gt; TcRn ()
forall a. HasCallStack =&gt; String -&gt; MsgDoc -&gt; a
</span><a href="GHC.Utils.Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;addModFinalizer was called when no finalizers were collected&quot;</span></span><span>
</span><span id="line-1231"></span><span>                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ThStage -&gt; MsgDoc
forall a. Outputable a =&gt; a -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ThStage
</span><a href="#local-6989586621681124981"><span class="hs-identifier hs-var">th_stage</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1232"></span><span>
</span><span id="line-1233"></span><span class="hs-comment">-- | Releases the external interpreter state.</span><span>
</span><span id="line-1234"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#finishTH"><span class="hs-identifier hs-type">finishTH</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1235"></span><span id="finishTH"><span class="annot"><span class="annottext">finishTH :: TcRn ()
</span><a href="GHC.Tc.Gen.Splice.html#finishTH"><span class="hs-identifier hs-var hs-var">finishTH</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1236"></span><span>  </span><span id="local-6989586621681124979"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681124979"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv HscEnv
forall gbl lcl. TcRnIf gbl lcl HscEnv
</span><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-var">getTopEnv</span></a></span><span>
</span><span id="line-1237"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Maybe Interp
</span><a href="GHC.Driver.Types.html#hsc_interp"><span class="hs-identifier hs-var hs-var">hsc_interp</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681124979"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1238"></span><span>    </span><span class="annot"><span class="annottext">Maybe Interp
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-cpp">
#if defined(HAVE_INTERNAL_INTERPRETER)
</span><span>    </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="GHC.Runtime.Interpreter.Types.html#InternalInterp"><span class="hs-identifier hs-var">InternalInterp</span></a></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span>    </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#ExternalInterp"><span class="hs-identifier hs-type">ExternalInterp</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1243"></span><span>      </span><span id="local-6989586621681124977"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681124977"><span class="hs-identifier hs-var">tcg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-1244"></span><span>      </span><span class="annot"><span class="annottext">TcRef (Maybe (ForeignRef (IORef QState)))
-&gt; Maybe (ForeignRef (IORef QState)) -&gt; TcRn ()
forall a gbl lcl. TcRef a -&gt; a -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#writeTcRef"><span class="hs-identifier hs-var">writeTcRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; TcRef (Maybe (ForeignRef (IORef QState)))
</span><a href="GHC.Tc.Types.html#tcg_th_remote_state"><span class="hs-identifier hs-var hs-var">tcg_th_remote_state</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681124977"><span class="hs-identifier hs-var">tcg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe (ForeignRef (IORef QState))
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1245"></span><span>
</span><span id="line-1246"></span><span>
</span><span id="line-1247"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#runTHExp"><span class="hs-identifier hs-type">runTHExp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../ghci/src/GHCi.RemoteTypes.html#ForeignHValue"><span class="hs-identifier hs-type">ForeignHValue</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Exp"><span class="hs-identifier hs-type">TH.Exp</span></a></span><span>
</span><span id="line-1248"></span><span id="runTHExp"><span class="annot"><span class="annottext">runTHExp :: ForeignHValue -&gt; TcM Exp
</span><a href="GHC.Tc.Gen.Splice.html#runTHExp"><span class="hs-identifier hs-var hs-var">runTHExp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">THResultType -&gt; ForeignHValue -&gt; TcM Exp
forall a. Binary a =&gt; THResultType -&gt; ForeignHValue -&gt; TcM a
</span><a href="GHC.Tc.Gen.Splice.html#runTH"><span class="hs-identifier hs-var">runTH</span></a></span><span> </span><span class="annot"><span class="annottext">THResultType
</span><a href="../../ghci/src/GHCi.Message.html#THExp"><span class="hs-identifier hs-var">THExp</span></a></span><span>
</span><span id="line-1249"></span><span>
</span><span id="line-1250"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#runTHPat"><span class="hs-identifier hs-type">runTHPat</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../ghci/src/GHCi.RemoteTypes.html#ForeignHValue"><span class="hs-identifier hs-type">ForeignHValue</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Pat"><span class="hs-identifier hs-type">TH.Pat</span></a></span><span>
</span><span id="line-1251"></span><span id="runTHPat"><span class="annot"><span class="annottext">runTHPat :: ForeignHValue -&gt; TcM Pat
</span><a href="GHC.Tc.Gen.Splice.html#runTHPat"><span class="hs-identifier hs-var hs-var">runTHPat</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">THResultType -&gt; ForeignHValue -&gt; TcM Pat
forall a. Binary a =&gt; THResultType -&gt; ForeignHValue -&gt; TcM a
</span><a href="GHC.Tc.Gen.Splice.html#runTH"><span class="hs-identifier hs-var">runTH</span></a></span><span> </span><span class="annot"><span class="annottext">THResultType
</span><a href="../../ghci/src/GHCi.Message.html#THPat"><span class="hs-identifier hs-var">THPat</span></a></span><span>
</span><span id="line-1252"></span><span>
</span><span id="line-1253"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#runTHType"><span class="hs-identifier hs-type">runTHType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../ghci/src/GHCi.RemoteTypes.html#ForeignHValue"><span class="hs-identifier hs-type">ForeignHValue</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Type"><span class="hs-identifier hs-type">TH.Type</span></a></span><span>
</span><span id="line-1254"></span><span id="runTHType"><span class="annot"><span class="annottext">runTHType :: ForeignHValue -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#runTHType"><span class="hs-identifier hs-var hs-var">runTHType</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">THResultType -&gt; ForeignHValue -&gt; TcM Type
forall a. Binary a =&gt; THResultType -&gt; ForeignHValue -&gt; TcM a
</span><a href="GHC.Tc.Gen.Splice.html#runTH"><span class="hs-identifier hs-var">runTH</span></a></span><span> </span><span class="annot"><span class="annottext">THResultType
</span><a href="../../ghci/src/GHCi.Message.html#THType"><span class="hs-identifier hs-var">THType</span></a></span><span>
</span><span id="line-1255"></span><span>
</span><span id="line-1256"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#runTHDec"><span class="hs-identifier hs-type">runTHDec</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../ghci/src/GHCi.RemoteTypes.html#ForeignHValue"><span class="hs-identifier hs-type">ForeignHValue</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Dec"><span class="hs-identifier hs-type">TH.Dec</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1257"></span><span id="runTHDec"><span class="annot"><span class="annottext">runTHDec :: ForeignHValue -&gt; TcM [Dec]
</span><a href="GHC.Tc.Gen.Splice.html#runTHDec"><span class="hs-identifier hs-var hs-var">runTHDec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">THResultType -&gt; ForeignHValue -&gt; TcM [Dec]
forall a. Binary a =&gt; THResultType -&gt; ForeignHValue -&gt; TcM a
</span><a href="GHC.Tc.Gen.Splice.html#runTH"><span class="hs-identifier hs-var">runTH</span></a></span><span> </span><span class="annot"><span class="annottext">THResultType
</span><a href="../../ghci/src/GHCi.Message.html#THDec"><span class="hs-identifier hs-var">THDec</span></a></span><span>
</span><span id="line-1258"></span><span>
</span><span id="line-1259"></span><span id="local-6989586621681126720"><span class="annot"><a href="GHC.Tc.Gen.Splice.html#runTH"><span class="hs-identifier hs-type">runTH</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../binary/src/Data.Binary.Class.html#Binary"><span class="hs-identifier hs-type">Binary</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681126720"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../ghci/src/GHCi.Message.html#THResultType"><span class="hs-identifier hs-type">THResultType</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../ghci/src/GHCi.RemoteTypes.html#ForeignHValue"><span class="hs-identifier hs-type">ForeignHValue</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681126720"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1260"></span><span id="runTH"><span class="annot"><span class="annottext">runTH :: forall a. Binary a =&gt; THResultType -&gt; ForeignHValue -&gt; TcM a
</span><a href="GHC.Tc.Gen.Splice.html#runTH"><span class="hs-identifier hs-var hs-var">runTH</span></a></span></span><span> </span><span id="local-6989586621681124953"><span class="annot"><span class="annottext">THResultType
</span><a href="#local-6989586621681124953"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621681124952"><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621681124952"><span class="hs-identifier hs-var">fhv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1261"></span><span>  </span><span id="local-6989586621681124951"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621681124951"><span class="hs-identifier hs-var">interp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM Interp
</span><a href="GHC.Tc.Gen.Splice.html#tcGetInterp"><span class="hs-identifier hs-var">tcGetInterp</span></a></span><span>
</span><span id="line-1262"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621681124951"><span class="hs-identifier hs-var">interp</span></a></span><span> </span><span class="hs-keyword">of</span><span class="hs-cpp">
#if defined(HAVE_INTERNAL_INTERPRETER)
</span><span>    </span><span class="annot"><span class="annottext">Interp
</span><a href="GHC.Runtime.Interpreter.Types.html#InternalInterp"><span class="hs-identifier hs-var">InternalInterp</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1265"></span><span>       </span><span class="hs-comment">-- Run it in the local TcM</span><span>
</span><span id="line-1266"></span><span>      </span><span id="local-6989586621681124950"><span class="annot"><span class="annottext">HValue
</span><a href="#local-6989586621681124950"><span class="hs-identifier hs-var">hv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO HValue -&gt; IOEnv (Env TcGblEnv TcLclEnv) HValue
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO HValue -&gt; IOEnv (Env TcGblEnv TcLclEnv) HValue)
-&gt; IO HValue -&gt; IOEnv (Env TcGblEnv TcLclEnv) HValue
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Interp -&gt; ForeignHValue -&gt; IO HValue
forall a. Interp -&gt; ForeignRef a -&gt; IO a
</span><a href="GHC.Runtime.Interpreter.html#wormhole"><span class="hs-identifier hs-var">wormhole</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="GHC.Runtime.Interpreter.Types.html#InternalInterp"><span class="hs-identifier hs-var">InternalInterp</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621681124952"><span class="hs-identifier hs-var">fhv</span></a></span><span>
</span><span id="line-1267"></span><span>      </span><span id="local-6989586621681124949"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681124949"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Q a -&gt; TcM a
forall a. Q a -&gt; TcM a
</span><a href="GHC.Tc.Gen.Splice.html#runQuasi"><span class="hs-identifier hs-var">runQuasi</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681124948"><span class="annot"><span class="annottext">HValue -&gt; Q a
forall a b. a -&gt; b
</span><a href="../../base/src/Unsafe.Coerce.html#unsafeCoerce"><span class="hs-identifier hs-var">unsafeCoerce</span></a></span><span> </span><span class="annot"><span class="annottext">HValue
</span><a href="#local-6989586621681124950"><span class="hs-identifier hs-var">hv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Q"><span class="hs-identifier hs-type">TH.Q</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681124948"><span class="hs-identifier hs-type">a</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1268"></span><span>      </span><span class="annot"><span class="annottext">a -&gt; TcM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681124949"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-cpp">
#endif
</span><span>
</span><span id="line-1271"></span><span>    </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#ExternalInterp"><span class="hs-identifier hs-type">ExternalInterp</span></a></span><span> </span><span id="local-6989586621681124947"><span class="annot"><span class="annottext">IServConfig
</span><a href="#local-6989586621681124947"><span class="hs-identifier hs-var">conf</span></a></span></span><span> </span><span id="local-6989586621681124946"><span class="annot"><span class="annottext">IServ
</span><a href="#local-6989586621681124946"><span class="hs-identifier hs-var">iserv</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1272"></span><span>      </span><span class="hs-comment">-- Run it on the server.  For an overview of how TH works with</span><span>
</span><span id="line-1273"></span><span>      </span><span class="hs-comment">-- Remote GHCi, see Note [Remote Template Haskell] in</span><span>
</span><span id="line-1274"></span><span>      </span><span class="hs-comment">-- libraries/ghci/GHCi/TH.hs.</span><span>
</span><span id="line-1275"></span><span>      </span><span class="annot"><span class="annottext">IServConfig -&gt; IServ -&gt; (IServInstance -&gt; TcM a) -&gt; TcM a
forall (m :: * -&gt; *) a.
(MonadIO m, ExceptionMonad m) =&gt;
IServConfig -&gt; IServ -&gt; (IServInstance -&gt; m a) -&gt; m a
</span><a href="GHC.Runtime.Interpreter.html#withIServ_"><span class="hs-identifier hs-var">withIServ_</span></a></span><span> </span><span class="annot"><span class="annottext">IServConfig
</span><a href="#local-6989586621681124947"><span class="hs-identifier hs-var">conf</span></a></span><span> </span><span class="annot"><span class="annottext">IServ
</span><a href="#local-6989586621681124946"><span class="hs-identifier hs-var">iserv</span></a></span><span> </span><span class="annot"><span class="annottext">((IServInstance -&gt; TcM a) -&gt; TcM a)
-&gt; (IServInstance -&gt; TcM a) -&gt; TcM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681124945"><span class="annot"><span class="annottext">IServInstance
</span><a href="#local-6989586621681124945"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1276"></span><span>        </span><span id="local-6989586621681124944"><span class="annot"><span class="annottext">ForeignRef (IORef QState)
</span><a href="#local-6989586621681124944"><span class="hs-identifier hs-var">rstate</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IServInstance -&gt; TcM (ForeignRef (IORef QState))
</span><a href="GHC.Tc.Gen.Splice.html#getTHState"><span class="hs-identifier hs-var">getTHState</span></a></span><span> </span><span class="annot"><span class="annottext">IServInstance
</span><a href="#local-6989586621681124945"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-1277"></span><span>        </span><span id="local-6989586621681124942"><span class="annot"><span class="annottext">Loc
</span><a href="#local-6989586621681124942"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM Loc
forall (m :: * -&gt; *). Quasi m =&gt; m Loc
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#qLocation"><span class="hs-identifier hs-var">TH.qLocation</span></a></span><span>
</span><span id="line-1278"></span><span>        </span><span class="annot"><span class="annottext">IO () -&gt; TcRn ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; TcRn ()) -&gt; IO () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1279"></span><span>          </span><span class="annot"><span class="annottext">ForeignRef (IORef QState)
-&gt; (RemoteRef (IORef QState) -&gt; IO ()) -&gt; IO ()
forall a b. ForeignRef a -&gt; (RemoteRef a -&gt; IO b) -&gt; IO b
</span><a href="../../ghci/src/GHCi.RemoteTypes.html#withForeignRef"><span class="hs-identifier hs-var">withForeignRef</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignRef (IORef QState)
</span><a href="#local-6989586621681124944"><span class="hs-identifier hs-var">rstate</span></a></span><span> </span><span class="annot"><span class="annottext">((RemoteRef (IORef QState) -&gt; IO ()) -&gt; IO ())
-&gt; (RemoteRef (IORef QState) -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681124941"><span class="annot"><span class="annottext">RemoteRef (IORef QState)
</span><a href="#local-6989586621681124941"><span class="hs-identifier hs-var">state_hv</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1280"></span><span>          </span><span class="annot"><span class="annottext">ForeignHValue -&gt; (RemoteRef HValue -&gt; IO ()) -&gt; IO ()
forall a b. ForeignRef a -&gt; (RemoteRef a -&gt; IO b) -&gt; IO b
</span><a href="../../ghci/src/GHCi.RemoteTypes.html#withForeignRef"><span class="hs-identifier hs-var">withForeignRef</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignHValue
</span><a href="#local-6989586621681124952"><span class="hs-identifier hs-var">fhv</span></a></span><span> </span><span class="annot"><span class="annottext">((RemoteRef HValue -&gt; IO ()) -&gt; IO ())
-&gt; (RemoteRef HValue -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681124940"><span class="annot"><span class="annottext">RemoteRef HValue
</span><a href="#local-6989586621681124940"><span class="hs-identifier hs-var">q_hv</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1281"></span><span>            </span><span class="annot"><span class="annottext">IServInstance -&gt; Put -&gt; IO ()
</span><a href="GHC.Runtime.Interpreter.html#writeIServ"><span class="hs-identifier hs-var">writeIServ</span></a></span><span> </span><span class="annot"><span class="annottext">IServInstance
</span><a href="#local-6989586621681124945"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Message (QResult ByteString) -&gt; Put
forall a. Message a -&gt; Put
</span><a href="../../ghci/src/GHCi.Message.html#putMessage"><span class="hs-identifier hs-var">putMessage</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">RemoteRef (IORef QState)
-&gt; RemoteRef HValue
-&gt; THResultType
-&gt; Maybe Loc
-&gt; Message (QResult ByteString)
</span><a href="../../ghci/src/GHCi.Message.html#RunTH"><span class="hs-identifier hs-var">RunTH</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteRef (IORef QState)
</span><a href="#local-6989586621681124941"><span class="hs-identifier hs-var">state_hv</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteRef HValue
</span><a href="#local-6989586621681124940"><span class="hs-identifier hs-var">q_hv</span></a></span><span> </span><span class="annot"><span class="annottext">THResultType
</span><a href="#local-6989586621681124953"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Loc -&gt; Maybe Loc
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Loc
</span><a href="#local-6989586621681124942"><span class="hs-identifier hs-var">loc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1282"></span><span>        </span><span class="annot"><span class="annottext">IServInstance -&gt; [Messages] -&gt; TcRn ()
</span><a href="GHC.Tc.Gen.Splice.html#runRemoteTH"><span class="hs-identifier hs-var">runRemoteTH</span></a></span><span> </span><span class="annot"><span class="annottext">IServInstance
</span><a href="#local-6989586621681124945"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1283"></span><span>        </span><span id="local-6989586621681124938"><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681124938"><span class="hs-identifier hs-var">bs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IServInstance -&gt; TcM ByteString
forall a. Binary a =&gt; IServInstance -&gt; TcM a
</span><a href="GHC.Tc.Gen.Splice.html#readQResult"><span class="hs-identifier hs-var">readQResult</span></a></span><span> </span><span class="annot"><span class="annottext">IServInstance
</span><a href="#local-6989586621681124945"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-1284"></span><span>        </span><span class="annot"><span class="annottext">a -&gt; TcM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; TcM a) -&gt; a -&gt; TcM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24%21"><span class="hs-operator hs-var">$!</span></a></span><span> </span><span class="annot"><span class="annottext">Get a -&gt; ByteString -&gt; a
forall a. Get a -&gt; ByteString -&gt; a
</span><a href="../../binary/src/Data.Binary.Get.html#runGet"><span class="hs-identifier hs-var">runGet</span></a></span><span> </span><span class="annot"><span class="annottext">Get a
forall t. Binary t =&gt; Get t
</span><a href="../../binary/src/Data.Binary.Class.html#get"><span class="hs-identifier hs-var">get</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ByteString -&gt; ByteString
</span><a href="../../bytestring/src/Data.ByteString.Lazy.html#fromStrict"><span class="hs-identifier hs-var">LB.fromStrict</span></a></span><span> </span><span class="annot"><span class="annottext">ByteString
</span><a href="#local-6989586621681124938"><span class="hs-identifier hs-var">bs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1285"></span><span>
</span><span id="line-1286"></span><span>
</span><span id="line-1287"></span><span class="hs-comment">-- | communicate with a remotely-running TH computation until it finishes.</span><span>
</span><span id="line-1288"></span><span class="hs-comment">-- See Note [Remote Template Haskell] in libraries/ghci/GHCi/TH.hs.</span><span>
</span><span id="line-1289"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#runRemoteTH"><span class="hs-identifier hs-type">runRemoteTH</span></a></span><span>
</span><span id="line-1290"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#IServInstance"><span class="hs-identifier hs-type">IServInstance</span></a></span><span>
</span><span id="line-1291"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Utils.Error.html#Messages"><span class="hs-identifier hs-type">Messages</span></a></span><span class="hs-special">]</span><span>   </span><span class="hs-comment">--  saved from nested calls to qRecover</span><span>
</span><span id="line-1292"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1293"></span><span id="runRemoteTH"><span class="annot"><span class="annottext">runRemoteTH :: IServInstance -&gt; [Messages] -&gt; TcRn ()
</span><a href="GHC.Tc.Gen.Splice.html#runRemoteTH"><span class="hs-identifier hs-var hs-var">runRemoteTH</span></a></span></span><span> </span><span id="local-6989586621681124934"><span class="annot"><span class="annottext">IServInstance
</span><a href="#local-6989586621681124934"><span class="hs-identifier hs-var">iserv</span></a></span></span><span> </span><span id="local-6989586621681124933"><span class="annot"><span class="annottext">[Messages]
</span><a href="#local-6989586621681124933"><span class="hs-identifier hs-var">recovers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1294"></span><span>  </span><span class="annot"><a href="../../ghci/src/GHCi.Message.html#THMsg"><span class="hs-identifier hs-type">THMsg</span></a></span><span> </span><span id="local-6989586621681124925"><span class="annot"><span class="annottext">THMessage a
</span><a href="#local-6989586621681124925"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO THMsg -&gt; IOEnv (Env TcGblEnv TcLclEnv) THMsg
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO THMsg -&gt; IOEnv (Env TcGblEnv TcLclEnv) THMsg)
-&gt; IO THMsg -&gt; IOEnv (Env TcGblEnv TcLclEnv) THMsg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">IServInstance -&gt; Get THMsg -&gt; IO THMsg
forall a. IServInstance -&gt; Get a -&gt; IO a
</span><a href="GHC.Runtime.Interpreter.html#readIServ"><span class="hs-identifier hs-var">readIServ</span></a></span><span> </span><span class="annot"><span class="annottext">IServInstance
</span><a href="#local-6989586621681124934"><span class="hs-identifier hs-var">iserv</span></a></span><span> </span><span class="annot"><span class="annottext">Get THMsg
</span><a href="../../ghci/src/GHCi.Message.html#getTHMessage"><span class="hs-identifier hs-var">getTHMessage</span></a></span><span>
</span><span id="line-1295"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">THMessage a
</span><a href="#local-6989586621681124925"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1296"></span><span>    </span><span class="annot"><span class="annottext">THMessage a
</span><a href="../../ghci/src/GHCi.Message.html#RunTHDone"><span class="hs-identifier hs-var">RunTHDone</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; TcRn ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1297"></span><span>    </span><span class="annot"><span class="annottext">THMessage a
</span><a href="../../ghci/src/GHCi.Message.html#StartRecover"><span class="hs-identifier hs-var">StartRecover</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-comment">-- Note [TH recover with -fexternal-interpreter]</span><span>
</span><span id="line-1298"></span><span>      </span><span id="local-6989586621681124914"><span class="annot"><span class="annottext">TcRef Messages
</span><a href="#local-6989586621681124914"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn (TcRef Messages)
</span><a href="GHC.Tc.Utils.Monad.html#getErrsVar"><span class="hs-identifier hs-var">getErrsVar</span></a></span><span>
</span><span id="line-1299"></span><span>      </span><span id="local-6989586621681124913"><span class="annot"><span class="annottext">Messages
</span><a href="#local-6989586621681124913"><span class="hs-identifier hs-var">msgs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRef Messages -&gt; TcRnIf TcGblEnv TcLclEnv Messages
forall a gbl lcl. TcRef a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef Messages
</span><a href="#local-6989586621681124914"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-1300"></span><span>      </span><span class="annot"><span class="annottext">TcRef Messages -&gt; Messages -&gt; TcRn ()
forall a gbl lcl. TcRef a -&gt; a -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#writeTcRef"><span class="hs-identifier hs-var">writeTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef Messages
</span><a href="#local-6989586621681124914"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Messages
</span><a href="GHC.Utils.Error.html#emptyMessages"><span class="hs-identifier hs-var">emptyMessages</span></a></span><span>
</span><span id="line-1301"></span><span>      </span><span class="annot"><span class="annottext">IServInstance -&gt; [Messages] -&gt; TcRn ()
</span><a href="GHC.Tc.Gen.Splice.html#runRemoteTH"><span class="hs-identifier hs-var">runRemoteTH</span></a></span><span> </span><span class="annot"><span class="annottext">IServInstance
</span><a href="#local-6989586621681124934"><span class="hs-identifier hs-var">iserv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Messages
</span><a href="#local-6989586621681124913"><span class="hs-identifier hs-var">msgs</span></a></span><span> </span><span class="annot"><span class="annottext">Messages -&gt; [Messages] -&gt; [Messages]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[Messages]
</span><a href="#local-6989586621681124933"><span class="hs-identifier hs-var">recovers</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1302"></span><span>    </span><span class="annot"><a href="../../ghci/src/GHCi.Message.html#EndRecover"><span class="hs-identifier hs-type">EndRecover</span></a></span><span> </span><span id="local-6989586621681124906"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681124906"><span class="hs-identifier hs-var">caught_error</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1303"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681124905"><span class="annot"><span class="annottext">prev_msgs :: Messages
</span><a href="#local-6989586621681124905"><span class="hs-identifier hs-var">prev_msgs</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621681124904"><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681124904"><span class="hs-identifier hs-var">prev_warns</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681124903"><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681124903"><span class="hs-identifier hs-var">prev_errs</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621681124902"><span class="annot"><span class="annottext">[Messages]
</span><a href="#local-6989586621681124902"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[Messages]
</span><a href="#local-6989586621681124933"><span class="hs-identifier hs-var">recovers</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1304"></span><span>             </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; (Messages, [Messages])
forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;EndRecover&quot;</span></span><span>
</span><span id="line-1305"></span><span>             </span><span id="local-6989586621681124901"><span class="annot"><span class="annottext">Messages
</span><a href="#local-6989586621681124901"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681124900"><span class="annot"><span class="annottext">[Messages]
</span><a href="#local-6989586621681124900"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Messages
</span><a href="#local-6989586621681124901"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[Messages]
</span><a href="#local-6989586621681124900"><span class="hs-identifier hs-var">b</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1306"></span><span>      </span><span id="local-6989586621681124899"><span class="annot"><span class="annottext">TcRef Messages
</span><a href="#local-6989586621681124899"><span class="hs-identifier hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn (TcRef Messages)
</span><a href="GHC.Tc.Utils.Monad.html#getErrsVar"><span class="hs-identifier hs-var">getErrsVar</span></a></span><span>
</span><span id="line-1307"></span><span>      </span><span class="hs-special">(</span><span id="local-6989586621681124898"><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681124898"><span class="hs-identifier hs-var">warn_msgs</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">WarningMessages
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRef Messages -&gt; TcRnIf TcGblEnv TcLclEnv Messages
forall a gbl lcl. TcRef a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef Messages
</span><a href="#local-6989586621681124899"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-1308"></span><span>      </span><span class="hs-comment">-- keep the warnings only if there were no errors</span><span>
</span><span id="line-1309"></span><span>      </span><span class="annot"><span class="annottext">TcRef Messages -&gt; Messages -&gt; TcRn ()
forall a gbl lcl. TcRef a -&gt; a -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#writeTcRef"><span class="hs-identifier hs-var">writeTcRef</span></a></span><span> </span><span class="annot"><span class="annottext">TcRef Messages
</span><a href="#local-6989586621681124899"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">(Messages -&gt; TcRn ()) -&gt; Messages -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681124906"><span class="hs-identifier hs-var">caught_error</span></a></span><span>
</span><span id="line-1310"></span><span>        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Messages
</span><a href="#local-6989586621681124905"><span class="hs-identifier hs-var">prev_msgs</span></a></span><span>
</span><span id="line-1311"></span><span>        </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681124904"><span class="hs-identifier hs-var">prev_warns</span></a></span><span> </span><span class="annot"><span class="annottext">WarningMessages -&gt; WarningMessages -&gt; WarningMessages
forall a. Bag a -&gt; Bag a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#unionBags"><span class="hs-operator hs-var">`unionBags`</span></a></span><span> </span><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681124898"><span class="hs-identifier hs-var">warn_msgs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">WarningMessages
</span><a href="#local-6989586621681124903"><span class="hs-identifier hs-var">prev_errs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1312"></span><span>      </span><span class="annot"><span class="annottext">IServInstance -&gt; [Messages] -&gt; TcRn ()
</span><a href="GHC.Tc.Gen.Splice.html#runRemoteTH"><span class="hs-identifier hs-var">runRemoteTH</span></a></span><span> </span><span class="annot"><span class="annottext">IServInstance
</span><a href="#local-6989586621681124934"><span class="hs-identifier hs-var">iserv</span></a></span><span> </span><span class="annot"><span class="annottext">[Messages]
</span><a href="#local-6989586621681124902"><span class="hs-identifier hs-var">rest</span></a></span><span>
</span><span id="line-1313"></span><span>    </span><span id="local-6989586621681124896"><span class="annot"><span class="annottext">THMessage a
</span><a href="#local-6989586621681124896"><span class="hs-identifier hs-var">_other</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1314"></span><span>      </span><span id="local-6989586621681124895"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681124895"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">THMessage a -&gt; TcM a
forall a. THMessage a -&gt; TcM a
</span><a href="GHC.Tc.Gen.Splice.html#handleTHMessage"><span class="hs-identifier hs-var">handleTHMessage</span></a></span><span> </span><span class="annot"><span class="annottext">THMessage a
</span><a href="#local-6989586621681124925"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-1315"></span><span>      </span><span class="annot"><span class="annottext">IO () -&gt; TcRn ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; TcRn ()) -&gt; IO () -&gt; TcRn ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">IServInstance -&gt; Put -&gt; IO ()
</span><a href="GHC.Runtime.Interpreter.html#writeIServ"><span class="hs-identifier hs-var">writeIServ</span></a></span><span> </span><span class="annot"><span class="annottext">IServInstance
</span><a href="#local-6989586621681124934"><span class="hs-identifier hs-var">iserv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Put
forall t. Binary t =&gt; t -&gt; Put
</span><a href="../../binary/src/Data.Binary.Class.html#put"><span class="hs-identifier hs-var">put</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681124895"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1316"></span><span>      </span><span class="annot"><span class="annottext">IServInstance -&gt; [Messages] -&gt; TcRn ()
</span><a href="GHC.Tc.Gen.Splice.html#runRemoteTH"><span class="hs-identifier hs-var">runRemoteTH</span></a></span><span> </span><span class="annot"><span class="annottext">IServInstance
</span><a href="#local-6989586621681124934"><span class="hs-identifier hs-var">iserv</span></a></span><span> </span><span class="annot"><span class="annottext">[Messages]
</span><a href="#local-6989586621681124933"><span class="hs-identifier hs-var">recovers</span></a></span><span>
</span><span id="line-1317"></span><span>
</span><span id="line-1318"></span><span class="hs-comment">-- | Read a value of type QResult from the iserv</span><span>
</span><span id="line-1319"></span><span id="local-6989586621681126680"><span class="annot"><a href="GHC.Tc.Gen.Splice.html#readQResult"><span class="hs-identifier hs-type">readQResult</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../binary/src/Data.Binary.Class.html#Binary"><span class="hs-identifier hs-type">Binary</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681126680"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#IServInstance"><span class="hs-identifier hs-type">IServInstance</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681126680"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1320"></span><span id="readQResult"><span class="annot"><span class="annottext">readQResult :: forall a. Binary a =&gt; IServInstance -&gt; TcM a
</span><a href="GHC.Tc.Gen.Splice.html#readQResult"><span class="hs-identifier hs-var hs-var">readQResult</span></a></span></span><span> </span><span id="local-6989586621681124882"><span class="annot"><span class="annottext">IServInstance
</span><a href="#local-6989586621681124882"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1321"></span><span>  </span><span id="local-6989586621681124881"><span class="annot"><span class="annottext">QResult a
</span><a href="#local-6989586621681124881"><span class="hs-identifier hs-var">qr</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (QResult a) -&gt; IOEnv (Env TcGblEnv TcLclEnv) (QResult a)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (QResult a) -&gt; IOEnv (Env TcGblEnv TcLclEnv) (QResult a))
-&gt; IO (QResult a) -&gt; IOEnv (Env TcGblEnv TcLclEnv) (QResult a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">IServInstance -&gt; Get (QResult a) -&gt; IO (QResult a)
forall a. IServInstance -&gt; Get a -&gt; IO a
</span><a href="GHC.Runtime.Interpreter.html#readIServ"><span class="hs-identifier hs-var">readIServ</span></a></span><span> </span><span class="annot"><span class="annottext">IServInstance
</span><a href="#local-6989586621681124882"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Get (QResult a)
forall t. Binary t =&gt; Get t
</span><a href="../../binary/src/Data.Binary.Class.html#get"><span class="hs-identifier hs-var">get</span></a></span><span>
</span><span id="line-1322"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">QResult a
</span><a href="#local-6989586621681124881"><span class="hs-identifier hs-var">qr</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1323"></span><span>    </span><span class="annot"><a href="../../ghci/src/GHCi.Message.html#QDone"><span class="hs-identifier hs-type">QDone</span></a></span><span> </span><span id="local-6989586621681124879"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681124879"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">a -&gt; TcM a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681124879"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-1324"></span><span>    </span><span class="annot"><a href="../../ghci/src/GHCi.Message.html#QException"><span class="hs-identifier hs-type">QException</span></a></span><span> </span><span id="local-6989586621681124877"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681124877"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO a -&gt; TcM a
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO a -&gt; TcM a) -&gt; IO a -&gt; TcM a
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorCall -&gt; IO a
forall e a. Exception e =&gt; e -&gt; IO a
</span><a href="../../base/src/GHC.IO.html#throwIO"><span class="hs-identifier hs-var">throwIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; ErrorCall
</span><a href="../../base/src/GHC.Exception.html#ErrorCall"><span class="hs-identifier hs-var">ErrorCall</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681124877"><span class="hs-identifier hs-var">str</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1325"></span><span>    </span><span class="annot"><a href="../../ghci/src/GHCi.Message.html#QFail"><span class="hs-identifier hs-type">QFail</span></a></span><span> </span><span id="local-6989586621681124873"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681124873"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; TcM a
forall (m :: * -&gt; *) a. MonadFail m =&gt; String -&gt; m a
</span><a href="../../base/src/Control.Monad.Fail.html#fail"><span class="hs-identifier hs-var">fail</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681124873"><span class="hs-identifier hs-var">str</span></a></span><span>
</span><span id="line-1326"></span><span>
</span><span id="line-1327"></span><span class="hs-comment">{- Note [TH recover with -fexternal-interpreter]

Recover is slightly tricky to implement.

The meaning of &quot;recover a b&quot; is
 - Do a
   - If it finished with no errors, then keep the warnings it generated
   - If it failed, discard any messages it generated, and do b

Note that &quot;failed&quot; here can mean either
  (1) threw an exception (failTc)
  (2) generated an error message (addErrTcM)

The messages are managed by GHC in the TcM monad, whereas the
exception-handling is done in the ghc-iserv process, so we have to
coordinate between the two.

On the server:
  - emit a StartRecover message
  - run &quot;a; FailIfErrs&quot; inside a try
  - emit an (EndRecover x) message, where x = True if &quot;a; FailIfErrs&quot; failed
  - if &quot;a; FailIfErrs&quot; failed, run &quot;b&quot;

Back in GHC, when we receive:

  FailIfErrrs
    failTc if there are any error messages (= failIfErrsM)
  StartRecover
    save the current messages and start with an empty set.
  EndRecover caught_error
    Restore the previous messages,
    and merge in the new messages if caught_error is false.
-}</span><span>
</span><span id="line-1360"></span><span>
</span><span id="line-1361"></span><span class="hs-comment">-- | Retrieve (or create, if it hasn't been created already), the</span><span>
</span><span id="line-1362"></span><span class="hs-comment">-- remote TH state.  The TH state is a remote reference to an IORef</span><span>
</span><span id="line-1363"></span><span class="hs-comment">-- QState living on the server, and we have to pass this to each RunTH</span><span>
</span><span id="line-1364"></span><span class="hs-comment">-- call we make.</span><span>
</span><span id="line-1365"></span><span class="hs-comment">--</span><span>
</span><span id="line-1366"></span><span class="hs-comment">-- The TH state is stored in tcg_th_remote_state in the TcGblEnv.</span><span>
</span><span id="line-1367"></span><span class="hs-comment">--</span><span>
</span><span id="line-1368"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#getTHState"><span class="hs-identifier hs-type">getTHState</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#IServInstance"><span class="hs-identifier hs-type">IServInstance</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../ghci/src/GHCi.RemoteTypes.html#ForeignRef"><span class="hs-identifier hs-type">ForeignRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/GHC.IORef.html#IORef"><span class="hs-identifier hs-type">IORef</span></a></span><span> </span><span class="annot"><a href="../../ghci/src/GHCi.Message.html#QState"><span class="hs-identifier hs-type">QState</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1369"></span><span id="getTHState"><span class="annot"><span class="annottext">getTHState :: IServInstance -&gt; TcM (ForeignRef (IORef QState))
</span><a href="GHC.Tc.Gen.Splice.html#getTHState"><span class="hs-identifier hs-var hs-var">getTHState</span></a></span></span><span> </span><span id="local-6989586621681124872"><span class="annot"><span class="annottext">IServInstance
</span><a href="#local-6989586621681124872"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1370"></span><span>  </span><span id="local-6989586621681124871"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681124871"><span class="hs-identifier hs-var">tcg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-1371"></span><span>  </span><span id="local-6989586621681124870"><span class="annot"><span class="annottext">Maybe (ForeignRef (IORef QState))
</span><a href="#local-6989586621681124870"><span class="hs-identifier hs-var">th_state</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRef (Maybe (ForeignRef (IORef QState)))
-&gt; TcRnIf TcGblEnv TcLclEnv (Maybe (ForeignRef (IORef QState)))
forall a gbl lcl. TcRef a -&gt; TcRnIf gbl lcl a
</span><a href="GHC.Tc.Utils.Monad.html#readTcRef"><span class="hs-identifier hs-var">readTcRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; TcRef (Maybe (ForeignRef (IORef QState)))
</span><a href="GHC.Tc.Types.html#tcg_th_remote_state"><span class="hs-identifier hs-var hs-var">tcg_th_remote_state</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681124871"><span class="hs-identifier hs-var">tcg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1372"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (ForeignRef (IORef QState))
</span><a href="#local-6989586621681124870"><span class="hs-identifier hs-var">th_state</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1373"></span><span>    </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681124869"><span class="annot"><span class="annottext">ForeignRef (IORef QState)
</span><a href="#local-6989586621681124869"><span class="hs-identifier hs-var">rhv</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ForeignRef (IORef QState) -&gt; TcM (ForeignRef (IORef QState))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignRef (IORef QState)
</span><a href="#local-6989586621681124869"><span class="hs-identifier hs-var">rhv</span></a></span><span>
</span><span id="line-1374"></span><span>    </span><span class="annot"><span class="annottext">Maybe (ForeignRef (IORef QState))
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1375"></span><span>      </span><span id="local-6989586621681124868"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681124868"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv HscEnv
forall gbl lcl. TcRnIf gbl lcl HscEnv
</span><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-var">getTopEnv</span></a></span><span>
</span><span id="line-1376"></span><span>      </span><span id="local-6989586621681124867"><span class="annot"><span class="annottext">ForeignRef (IORef QState)
</span><a href="#local-6989586621681124867"><span class="hs-identifier hs-var">fhv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (ForeignRef (IORef QState)) -&gt; TcM (ForeignRef (IORef QState))
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (ForeignRef (IORef QState)) -&gt; TcM (ForeignRef (IORef QState)))
-&gt; IO (ForeignRef (IORef QState))
-&gt; TcM (ForeignRef (IORef QState))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; RemoteRef (IORef QState) -&gt; IO (ForeignRef (IORef QState))
forall a. HscEnv -&gt; RemoteRef a -&gt; IO (ForeignRef a)
</span><a href="GHC.Runtime.Interpreter.html#mkFinalizedHValue"><span class="hs-identifier hs-var">mkFinalizedHValue</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681124868"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(RemoteRef (IORef QState) -&gt; IO (ForeignRef (IORef QState)))
-&gt; IO (RemoteRef (IORef QState)) -&gt; IO (ForeignRef (IORef QState))
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m b) -&gt; m a -&gt; m b
</span><a href="../../base/src/GHC.Base.html#%3D%3C%3C"><span class="hs-operator hs-var">=&lt;&lt;</span></a></span><span> </span><span class="annot"><span class="annottext">IServInstance
-&gt; Message (RemoteRef (IORef QState))
-&gt; IO (RemoteRef (IORef QState))
forall a. Binary a =&gt; IServInstance -&gt; Message a -&gt; IO a
</span><a href="GHC.Runtime.Interpreter.html#iservCall"><span class="hs-identifier hs-var">iservCall</span></a></span><span> </span><span class="annot"><span class="annottext">IServInstance
</span><a href="#local-6989586621681124872"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">Message (RemoteRef (IORef QState))
</span><a href="../../ghci/src/GHCi.Message.html#StartTH"><span class="hs-identifier hs-var">StartTH</span></a></span><span>
</span><span id="line-1377"></span><span>      </span><span class="annot"><span class="annottext">TcRef (Maybe (ForeignRef (IORef QState)))
-&gt; Maybe (ForeignRef (IORef QState)) -&gt; TcRn ()
forall a gbl lcl. TcRef a -&gt; a -&gt; TcRnIf gbl lcl ()
</span><a href="GHC.Tc.Utils.Monad.html#writeTcRef"><span class="hs-identifier hs-var">writeTcRef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; TcRef (Maybe (ForeignRef (IORef QState)))
</span><a href="GHC.Tc.Types.html#tcg_th_remote_state"><span class="hs-identifier hs-var hs-var">tcg_th_remote_state</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681124871"><span class="hs-identifier hs-var">tcg</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ForeignRef (IORef QState) -&gt; Maybe (ForeignRef (IORef QState))
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignRef (IORef QState)
</span><a href="#local-6989586621681124867"><span class="hs-identifier hs-var">fhv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1378"></span><span>      </span><span class="annot"><span class="annottext">ForeignRef (IORef QState) -&gt; TcM (ForeignRef (IORef QState))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignRef (IORef QState)
</span><a href="#local-6989586621681124867"><span class="hs-identifier hs-var">fhv</span></a></span><span>
</span><span id="line-1379"></span><span>
</span><span id="line-1380"></span><span id="local-6989586621681126506"><span class="annot"><a href="GHC.Tc.Gen.Splice.html#wrapTHResult"><span class="hs-identifier hs-type">wrapTHResult</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681126506"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../ghci/src/GHCi.Message.html#THResult"><span class="hs-identifier hs-type">THResult</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681126506"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1381"></span><span id="wrapTHResult"><span class="annot"><span class="annottext">wrapTHResult :: forall a. TcM a -&gt; TcM (THResult a)
</span><a href="GHC.Tc.Gen.Splice.html#wrapTHResult"><span class="hs-identifier hs-var hs-var">wrapTHResult</span></a></span></span><span> </span><span id="local-6989586621681124857"><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681124857"><span class="hs-identifier hs-var">tcm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1382"></span><span>  </span><span id="local-6989586621681124856"><span class="annot"><span class="annottext">Either IOEnvFailure a
</span><a href="#local-6989586621681124856"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM a -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Either IOEnvFailure a)
forall env r. IOEnv env r -&gt; IOEnv env (Either IOEnvFailure r)
</span><a href="GHC.Data.IOEnv.html#tryM"><span class="hs-identifier hs-var">tryM</span></a></span><span> </span><span class="annot"><span class="annottext">TcM a
</span><a href="#local-6989586621681124857"><span class="hs-identifier hs-var">tcm</span></a></span><span>   </span><span class="hs-comment">-- only catch 'fail', treat everything else as catastrophic</span><span>
</span><span id="line-1383"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either IOEnvFailure a
</span><a href="#local-6989586621681124856"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1384"></span><span>    </span><span class="annot"><a href="../../base/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621681124855"><span class="annot"><span class="annottext">IOEnvFailure
</span><a href="#local-6989586621681124855"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">THResult a -&gt; TcM (THResult a)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; THResult a
forall a. String -&gt; THResult a
</span><a href="../../ghci/src/GHCi.Message.html#THException"><span class="hs-identifier hs-var">THException</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IOEnvFailure -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../base/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">IOEnvFailure
</span><a href="#local-6989586621681124855"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1385"></span><span>    </span><span class="annot"><a href="../../base/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621681124853"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681124853"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">THResult a -&gt; TcM (THResult a)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; THResult a
forall a. a -&gt; THResult a
</span><a href="../../ghci/src/GHCi.Message.html#THComplete"><span class="hs-identifier hs-var">THComplete</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681124853"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1386"></span><span>
</span><span id="line-1387"></span><span id="local-6989586621681126516"><span class="annot"><a href="GHC.Tc.Gen.Splice.html#handleTHMessage"><span class="hs-identifier hs-type">handleTHMessage</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../ghci/src/GHCi.Message.html#THMessage"><span class="hs-identifier hs-type">THMessage</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681126516"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681126516"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-1388"></span><span id="handleTHMessage"><span class="annot"><span class="annottext">handleTHMessage :: forall a. THMessage a -&gt; TcM a
</span><a href="GHC.Tc.Gen.Splice.html#handleTHMessage"><span class="hs-identifier hs-var hs-var">handleTHMessage</span></a></span></span><span> </span><span id="local-6989586621681124849"><span class="annot"><span class="annottext">THMessage a
</span><a href="#local-6989586621681124849"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">THMessage a
</span><a href="#local-6989586621681124849"><span class="hs-identifier hs-var">msg</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1389"></span><span>  </span><span class="annot"><a href="../../ghci/src/GHCi.Message.html#NewName"><span class="hs-identifier hs-type">NewName</span></a></span><span> </span><span id="local-6989586621681124845"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681124845"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM Name -&gt; TcM (THResult Name)
forall a. TcM a -&gt; TcM (THResult a)
</span><a href="GHC.Tc.Gen.Splice.html#wrapTHResult"><span class="hs-identifier hs-var">wrapTHResult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM Name -&gt; TcM (THResult Name))
-&gt; TcM Name -&gt; TcM (THResult Name)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; TcM Name
forall (m :: * -&gt; *). Quasi m =&gt; String -&gt; m Name
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#qNewName"><span class="hs-identifier hs-var">TH.qNewName</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681124845"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-1390"></span><span>  </span><span class="annot"><a href="../../ghci/src/GHCi.Message.html#Report"><span class="hs-identifier hs-type">Report</span></a></span><span> </span><span id="local-6989586621681124841"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681124841"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621681124840"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681124840"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcRn () -&gt; TcM (THResult ())
forall a. TcM a -&gt; TcM (THResult a)
</span><a href="GHC.Tc.Gen.Splice.html#wrapTHResult"><span class="hs-identifier hs-var">wrapTHResult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcM (THResult ())) -&gt; TcRn () -&gt; TcM (THResult ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; String -&gt; TcRn ()
forall (m :: * -&gt; *). Quasi m =&gt; Bool -&gt; String -&gt; m ()
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#qReport"><span class="hs-identifier hs-var">TH.qReport</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681124841"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681124840"><span class="hs-identifier hs-var">str</span></a></span><span>
</span><span id="line-1391"></span><span>  </span><span class="annot"><a href="../../ghci/src/GHCi.Message.html#LookupName"><span class="hs-identifier hs-type">LookupName</span></a></span><span> </span><span id="local-6989586621681124836"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681124836"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span id="local-6989586621681124835"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681124835"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM (Maybe Name) -&gt; TcM (THResult (Maybe Name))
forall a. TcM a -&gt; TcM (THResult a)
</span><a href="GHC.Tc.Gen.Splice.html#wrapTHResult"><span class="hs-identifier hs-var">wrapTHResult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (Maybe Name) -&gt; TcM (THResult (Maybe Name)))
-&gt; TcM (Maybe Name) -&gt; TcM (THResult (Maybe Name))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; String -&gt; TcM (Maybe Name)
forall (m :: * -&gt; *). Quasi m =&gt; Bool -&gt; String -&gt; m (Maybe Name)
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#qLookupName"><span class="hs-identifier hs-var">TH.qLookupName</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681124836"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681124835"><span class="hs-identifier hs-var">str</span></a></span><span>
</span><span id="line-1392"></span><span>  </span><span class="annot"><a href="../../ghci/src/GHCi.Message.html#Reify"><span class="hs-identifier hs-type">Reify</span></a></span><span> </span><span id="local-6989586621681124831"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124831"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM Info -&gt; TcM (THResult Info)
forall a. TcM a -&gt; TcM (THResult a)
</span><a href="GHC.Tc.Gen.Splice.html#wrapTHResult"><span class="hs-identifier hs-var">wrapTHResult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM Info -&gt; TcM (THResult Info))
-&gt; TcM Info -&gt; TcM (THResult Info)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Info
forall (m :: * -&gt; *). Quasi m =&gt; Name -&gt; m Info
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#qReify"><span class="hs-identifier hs-var">TH.qReify</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124831"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1393"></span><span>  </span><span class="annot"><a href="../../ghci/src/GHCi.Message.html#ReifyFixity"><span class="hs-identifier hs-type">ReifyFixity</span></a></span><span> </span><span id="local-6989586621681124827"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124827"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM (Maybe Fixity) -&gt; TcM (THResult (Maybe Fixity))
forall a. TcM a -&gt; TcM (THResult a)
</span><a href="GHC.Tc.Gen.Splice.html#wrapTHResult"><span class="hs-identifier hs-var">wrapTHResult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (Maybe Fixity) -&gt; TcM (THResult (Maybe Fixity)))
-&gt; TcM (Maybe Fixity) -&gt; TcM (THResult (Maybe Fixity))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM (Maybe Fixity)
forall (m :: * -&gt; *). Quasi m =&gt; Name -&gt; m (Maybe Fixity)
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#qReifyFixity"><span class="hs-identifier hs-var">TH.qReifyFixity</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124827"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1394"></span><span>  </span><span class="annot"><a href="../../ghci/src/GHCi.Message.html#ReifyType"><span class="hs-identifier hs-type">ReifyType</span></a></span><span> </span><span id="local-6989586621681124823"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124823"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM Type -&gt; TcM (THResult Type)
forall a. TcM a -&gt; TcM (THResult a)
</span><a href="GHC.Tc.Gen.Splice.html#wrapTHResult"><span class="hs-identifier hs-var">wrapTHResult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM Type -&gt; TcM (THResult Type))
-&gt; TcM Type -&gt; TcM (THResult Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Type
forall (m :: * -&gt; *). Quasi m =&gt; Name -&gt; m Type
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#qReifyType"><span class="hs-identifier hs-var">TH.qReifyType</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124823"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1395"></span><span>  </span><span class="annot"><a href="../../ghci/src/GHCi.Message.html#ReifyInstances"><span class="hs-identifier hs-type">ReifyInstances</span></a></span><span> </span><span id="local-6989586621681124819"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124819"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681124818"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124818"><span class="hs-identifier hs-var">ts</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM [Dec] -&gt; TcM (THResult [Dec])
forall a. TcM a -&gt; TcM (THResult a)
</span><a href="GHC.Tc.Gen.Splice.html#wrapTHResult"><span class="hs-identifier hs-var">wrapTHResult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM [Dec] -&gt; TcM (THResult [Dec]))
-&gt; TcM [Dec] -&gt; TcM (THResult [Dec])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Type] -&gt; TcM [Dec]
forall (m :: * -&gt; *). Quasi m =&gt; Name -&gt; [Type] -&gt; m [Dec]
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#qReifyInstances"><span class="hs-identifier hs-var">TH.qReifyInstances</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124819"><span class="hs-identifier hs-var">n</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124818"><span class="hs-identifier hs-var">ts</span></a></span><span>
</span><span id="line-1396"></span><span>  </span><span class="annot"><a href="../../ghci/src/GHCi.Message.html#ReifyRoles"><span class="hs-identifier hs-type">ReifyRoles</span></a></span><span> </span><span id="local-6989586621681124814"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124814"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM [Role] -&gt; TcM (THResult [Role])
forall a. TcM a -&gt; TcM (THResult a)
</span><a href="GHC.Tc.Gen.Splice.html#wrapTHResult"><span class="hs-identifier hs-var">wrapTHResult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM [Role] -&gt; TcM (THResult [Role]))
-&gt; TcM [Role] -&gt; TcM (THResult [Role])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM [Role]
forall (m :: * -&gt; *). Quasi m =&gt; Name -&gt; m [Role]
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#qReifyRoles"><span class="hs-identifier hs-var">TH.qReifyRoles</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124814"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1397"></span><span>  </span><span class="annot"><a href="../../ghci/src/GHCi.Message.html#ReifyAnnotations"><span class="hs-identifier hs-type">ReifyAnnotations</span></a></span><span> </span><span id="local-6989586621681124810"><span class="annot"><span class="annottext">AnnLookup
</span><a href="#local-6989586621681124810"><span class="hs-identifier hs-var">lookup</span></a></span></span><span> </span><span id="local-6989586621681124809"><span class="annot"><span class="annottext">TypeRep
</span><a href="#local-6989586621681124809"><span class="hs-identifier hs-var">tyrep</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1398"></span><span>    </span><span class="annot"><span class="annottext">TcM [ByteString] -&gt; TcM (THResult [ByteString])
forall a. TcM a -&gt; TcM (THResult a)
</span><a href="GHC.Tc.Gen.Splice.html#wrapTHResult"><span class="hs-identifier hs-var">wrapTHResult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM [ByteString] -&gt; TcM (THResult [ByteString]))
-&gt; TcM [ByteString] -&gt; TcM (THResult [ByteString])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([Word8] -&gt; ByteString) -&gt; [[Word8]] -&gt; [ByteString]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">[Word8] -&gt; ByteString
</span><a href="../../bytestring/src/Data.ByteString.html#pack"><span class="hs-identifier hs-var">B.pack</span></a></span><span> </span><span class="annot"><span class="annottext">([[Word8]] -&gt; [ByteString])
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [[Word8]] -&gt; TcM [ByteString]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">AnnLookup -&gt; TypeRep -&gt; IOEnv (Env TcGblEnv TcLclEnv) [[Word8]]
</span><a href="GHC.Tc.Gen.Splice.html#getAnnotationsByTypeRep"><span class="hs-identifier hs-var">getAnnotationsByTypeRep</span></a></span><span> </span><span class="annot"><span class="annottext">AnnLookup
</span><a href="#local-6989586621681124810"><span class="hs-identifier hs-var">lookup</span></a></span><span> </span><span class="annot"><span class="annottext">TypeRep
</span><a href="#local-6989586621681124809"><span class="hs-identifier hs-var">tyrep</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1399"></span><span>  </span><span class="annot"><a href="../../ghci/src/GHCi.Message.html#ReifyModule"><span class="hs-identifier hs-type">ReifyModule</span></a></span><span> </span><span id="local-6989586621681124803"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681124803"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM ModuleInfo -&gt; TcM (THResult ModuleInfo)
forall a. TcM a -&gt; TcM (THResult a)
</span><a href="GHC.Tc.Gen.Splice.html#wrapTHResult"><span class="hs-identifier hs-var">wrapTHResult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM ModuleInfo -&gt; TcM (THResult ModuleInfo))
-&gt; TcM ModuleInfo -&gt; TcM (THResult ModuleInfo)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Module -&gt; TcM ModuleInfo
forall (m :: * -&gt; *). Quasi m =&gt; Module -&gt; m ModuleInfo
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#qReifyModule"><span class="hs-identifier hs-var">TH.qReifyModule</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681124803"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-1400"></span><span>  </span><span class="annot"><a href="../../ghci/src/GHCi.Message.html#ReifyConStrictness"><span class="hs-identifier hs-type">ReifyConStrictness</span></a></span><span> </span><span id="local-6989586621681124799"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124799"><span class="hs-identifier hs-var">nm</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM [DecidedStrictness] -&gt; TcM (THResult [DecidedStrictness])
forall a. TcM a -&gt; TcM (THResult a)
</span><a href="GHC.Tc.Gen.Splice.html#wrapTHResult"><span class="hs-identifier hs-var">wrapTHResult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM [DecidedStrictness] -&gt; TcM (THResult [DecidedStrictness]))
-&gt; TcM [DecidedStrictness] -&gt; TcM (THResult [DecidedStrictness])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM [DecidedStrictness]
forall (m :: * -&gt; *). Quasi m =&gt; Name -&gt; m [DecidedStrictness]
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#qReifyConStrictness"><span class="hs-identifier hs-var">TH.qReifyConStrictness</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124799"><span class="hs-identifier hs-var">nm</span></a></span><span>
</span><span id="line-1401"></span><span>  </span><span class="annot"><a href="../../ghci/src/GHCi.Message.html#AddDependentFile"><span class="hs-identifier hs-type">AddDependentFile</span></a></span><span> </span><span id="local-6989586621681124795"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681124795"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcRn () -&gt; TcM (THResult ())
forall a. TcM a -&gt; TcM (THResult a)
</span><a href="GHC.Tc.Gen.Splice.html#wrapTHResult"><span class="hs-identifier hs-var">wrapTHResult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcM (THResult ())) -&gt; TcRn () -&gt; TcM (THResult ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; TcRn ()
forall (m :: * -&gt; *). Quasi m =&gt; String -&gt; m ()
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#qAddDependentFile"><span class="hs-identifier hs-var">TH.qAddDependentFile</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681124795"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-1402"></span><span>  </span><span class="annot"><a href="../../ghci/src/GHCi.Message.html#AddTempFile"><span class="hs-identifier hs-type">AddTempFile</span></a></span><span> </span><span id="local-6989586621681124791"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681124791"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) String -&gt; TcM (THResult String)
forall a. TcM a -&gt; TcM (THResult a)
</span><a href="GHC.Tc.Gen.Splice.html#wrapTHResult"><span class="hs-identifier hs-var">wrapTHResult</span></a></span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) String -&gt; TcM (THResult String))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) String -&gt; TcM (THResult String)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; IOEnv (Env TcGblEnv TcLclEnv) String
forall (m :: * -&gt; *). Quasi m =&gt; String -&gt; m String
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#qAddTempFile"><span class="hs-identifier hs-var">TH.qAddTempFile</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681124791"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-1403"></span><span>  </span><span class="annot"><a href="../../ghci/src/GHCi.Message.html#AddModFinalizer"><span class="hs-identifier hs-type">AddModFinalizer</span></a></span><span> </span><span id="local-6989586621681124785"><span class="annot"><span class="annottext">RemoteRef (Q ())
</span><a href="#local-6989586621681124785"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1404"></span><span>    </span><span id="local-6989586621681124784"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681124784"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv HscEnv
forall gbl lcl. TcRnIf gbl lcl HscEnv
</span><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-var">getTopEnv</span></a></span><span>
</span><span id="line-1405"></span><span>    </span><span class="annot"><span class="annottext">TcRn () -&gt; TcM (THResult ())
forall a. TcM a -&gt; TcM (THResult a)
</span><a href="GHC.Tc.Gen.Splice.html#wrapTHResult"><span class="hs-identifier hs-var">wrapTHResult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcM (THResult ())) -&gt; TcRn () -&gt; TcM (THResult ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">IO (ForeignRef (Q ()))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) (ForeignRef (Q ()))
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; RemoteRef (Q ()) -&gt; IO (ForeignRef (Q ()))
forall a. HscEnv -&gt; RemoteRef a -&gt; IO (ForeignRef a)
</span><a href="GHC.Runtime.Interpreter.html#mkFinalizedHValue"><span class="hs-identifier hs-var">mkFinalizedHValue</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681124784"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">RemoteRef (Q ())
</span><a href="#local-6989586621681124785"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) (ForeignRef (Q ()))
-&gt; (ForeignRef (Q ()) -&gt; TcRn ()) -&gt; TcRn ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../base/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignRef (Q ()) -&gt; TcRn ()
</span><a href="GHC.Tc.Gen.Splice.html#addModFinalizerRef"><span class="hs-identifier hs-var">addModFinalizerRef</span></a></span><span>
</span><span id="line-1406"></span><span>  </span><span class="annot"><a href="../../ghci/src/GHCi.Message.html#AddCorePlugin"><span class="hs-identifier hs-type">AddCorePlugin</span></a></span><span> </span><span id="local-6989586621681124780"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681124780"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcRn () -&gt; TcM (THResult ())
forall a. TcM a -&gt; TcM (THResult a)
</span><a href="GHC.Tc.Gen.Splice.html#wrapTHResult"><span class="hs-identifier hs-var">wrapTHResult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcM (THResult ())) -&gt; TcRn () -&gt; TcM (THResult ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; TcRn ()
forall (m :: * -&gt; *). Quasi m =&gt; String -&gt; m ()
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#qAddCorePlugin"><span class="hs-identifier hs-var">TH.qAddCorePlugin</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681124780"><span class="hs-identifier hs-var">str</span></a></span><span>
</span><span id="line-1407"></span><span>  </span><span class="annot"><a href="../../ghci/src/GHCi.Message.html#AddTopDecls"><span class="hs-identifier hs-type">AddTopDecls</span></a></span><span> </span><span id="local-6989586621681124776"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621681124776"><span class="hs-identifier hs-var">decs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcRn () -&gt; TcM (THResult ())
forall a. TcM a -&gt; TcM (THResult a)
</span><a href="GHC.Tc.Gen.Splice.html#wrapTHResult"><span class="hs-identifier hs-var">wrapTHResult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcM (THResult ())) -&gt; TcRn () -&gt; TcM (THResult ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec] -&gt; TcRn ()
forall (m :: * -&gt; *). Quasi m =&gt; [Dec] -&gt; m ()
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#qAddTopDecls"><span class="hs-identifier hs-var">TH.qAddTopDecls</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621681124776"><span class="hs-identifier hs-var">decs</span></a></span><span>
</span><span id="line-1408"></span><span>  </span><span class="annot"><a href="../../ghci/src/GHCi.Message.html#AddForeignFilePath"><span class="hs-identifier hs-type">AddForeignFilePath</span></a></span><span> </span><span id="local-6989586621681124772"><span class="annot"><span class="annottext">ForeignSrcLang
</span><a href="#local-6989586621681124772"><span class="hs-identifier hs-var">lang</span></a></span></span><span> </span><span id="local-6989586621681124771"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681124771"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcRn () -&gt; TcM (THResult ())
forall a. TcM a -&gt; TcM (THResult a)
</span><a href="GHC.Tc.Gen.Splice.html#wrapTHResult"><span class="hs-identifier hs-var">wrapTHResult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRn () -&gt; TcM (THResult ())) -&gt; TcRn () -&gt; TcM (THResult ())
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignSrcLang -&gt; String -&gt; TcRn ()
forall (m :: * -&gt; *). Quasi m =&gt; ForeignSrcLang -&gt; String -&gt; m ()
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#qAddForeignFilePath"><span class="hs-identifier hs-var">TH.qAddForeignFilePath</span></a></span><span> </span><span class="annot"><span class="annottext">ForeignSrcLang
</span><a href="#local-6989586621681124772"><span class="hs-identifier hs-var">lang</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681124771"><span class="hs-identifier hs-var">str</span></a></span><span>
</span><span id="line-1409"></span><span>  </span><span class="annot"><a href="../../ghci/src/GHCi.Message.html#IsExtEnabled"><span class="hs-identifier hs-type">IsExtEnabled</span></a></span><span> </span><span id="local-6989586621681124767"><span class="annot"><span class="annottext">Extension
</span><a href="#local-6989586621681124767"><span class="hs-identifier hs-var">ext</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv Bool -&gt; TcM (THResult Bool)
forall a. TcM a -&gt; TcM (THResult a)
</span><a href="GHC.Tc.Gen.Splice.html#wrapTHResult"><span class="hs-identifier hs-var">wrapTHResult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcRnIf TcGblEnv TcLclEnv Bool -&gt; TcM (THResult Bool))
-&gt; TcRnIf TcGblEnv TcLclEnv Bool -&gt; TcM (THResult Bool)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Extension -&gt; TcRnIf TcGblEnv TcLclEnv Bool
forall (m :: * -&gt; *). Quasi m =&gt; Extension -&gt; m Bool
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#qIsExtEnabled"><span class="hs-identifier hs-var">TH.qIsExtEnabled</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><a href="#local-6989586621681124767"><span class="hs-identifier hs-var">ext</span></a></span><span>
</span><span id="line-1410"></span><span>  </span><span class="annot"><span class="annottext">THMessage a
</span><a href="../../ghci/src/GHCi.Message.html#ExtsEnabled"><span class="hs-identifier hs-var">ExtsEnabled</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcM [Extension] -&gt; TcM (THResult [Extension])
forall a. TcM a -&gt; TcM (THResult a)
</span><a href="GHC.Tc.Gen.Splice.html#wrapTHResult"><span class="hs-identifier hs-var">wrapTHResult</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM [Extension] -&gt; TcM (THResult [Extension]))
-&gt; TcM [Extension] -&gt; TcM (THResult [Extension])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TcM [Extension]
forall (m :: * -&gt; *). Quasi m =&gt; m [Extension]
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#qExtsEnabled"><span class="hs-identifier hs-var">TH.qExtsEnabled</span></a></span><span>
</span><span id="line-1411"></span><span>  </span><span class="annot"><span class="annottext">THMessage a
</span><a href="../../ghci/src/GHCi.Message.html#FailIfErrs"><span class="hs-identifier hs-var">FailIfErrs</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcRn () -&gt; TcM (THResult ())
forall a. TcM a -&gt; TcM (THResult a)
</span><a href="GHC.Tc.Gen.Splice.html#wrapTHResult"><span class="hs-identifier hs-var">wrapTHResult</span></a></span><span> </span><span class="annot"><span class="annottext">TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#failIfErrsM"><span class="hs-identifier hs-var">failIfErrsM</span></a></span><span>
</span><span id="line-1412"></span><span>  </span><span class="annot"><span class="annottext">THMessage a
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; TcM a
forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;handleTHMessage: unexpected message &quot;</span></span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">THMessage a -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../base/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">THMessage a
</span><a href="#local-6989586621681124849"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1413"></span><span>
</span><span id="line-1414"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#getAnnotationsByTypeRep"><span class="hs-identifier hs-type">getAnnotationsByTypeRep</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#AnnLookup"><span class="hs-identifier hs-type">TH.AnnLookup</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/Data.Typeable.html#TypeRep"><span class="hs-identifier hs-type">TypeRep</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><a href="../../base/src/GHC.Word.html#Word8"><span class="hs-identifier hs-type">Word8</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-1415"></span><span id="getAnnotationsByTypeRep"><span class="annot"><span class="annottext">getAnnotationsByTypeRep :: AnnLookup -&gt; TypeRep -&gt; IOEnv (Env TcGblEnv TcLclEnv) [[Word8]]
</span><a href="GHC.Tc.Gen.Splice.html#getAnnotationsByTypeRep"><span class="hs-identifier hs-var hs-var">getAnnotationsByTypeRep</span></a></span></span><span> </span><span id="local-6989586621681124761"><span class="annot"><span class="annottext">AnnLookup
</span><a href="#local-6989586621681124761"><span class="hs-identifier hs-var">th_name</span></a></span></span><span> </span><span id="local-6989586621681124760"><span class="annot"><span class="annottext">TypeRep
</span><a href="#local-6989586621681124760"><span class="hs-identifier hs-var">tyrep</span></a></span></span><span>
</span><span id="line-1416"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681124759"><span class="annot"><span class="annottext">CoreAnnTarget
</span><a href="#local-6989586621681124759"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">AnnLookup -&gt; TcM CoreAnnTarget
</span><a href="GHC.Tc.Gen.Splice.html#lookupThAnnLookup"><span class="hs-identifier hs-var">lookupThAnnLookup</span></a></span><span> </span><span class="annot"><span class="annottext">AnnLookup
</span><a href="#local-6989586621681124761"><span class="hs-identifier hs-var">th_name</span></a></span><span>
</span><span id="line-1417"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681124757"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681124757"><span class="hs-identifier hs-var">topEnv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv HscEnv
forall gbl lcl. TcRnIf gbl lcl HscEnv
</span><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-var">getTopEnv</span></a></span><span>
</span><span id="line-1418"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681124756"><span class="annot"><span class="annottext">AnnEnv
</span><a href="#local-6989586621681124756"><span class="hs-identifier hs-var">epsHptAnns</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO AnnEnv -&gt; IOEnv (Env TcGblEnv TcLclEnv) AnnEnv
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO AnnEnv -&gt; IOEnv (Env TcGblEnv TcLclEnv) AnnEnv)
-&gt; IO AnnEnv -&gt; IOEnv (Env TcGblEnv TcLclEnv) AnnEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Maybe ModGuts -&gt; IO AnnEnv
</span><a href="GHC.Driver.Types.html#prepareAnnotations"><span class="hs-identifier hs-var">prepareAnnotations</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681124757"><span class="hs-identifier hs-var">topEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ModGuts
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1419"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681124754"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681124754"><span class="hs-identifier hs-var">tcg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-1420"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681124753"><span class="annot"><span class="annottext">selectedEpsHptAnns :: [[Word8]]
</span><a href="#local-6989586621681124753"><span class="hs-identifier hs-var hs-var">selectedEpsHptAnns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AnnEnv -&gt; CoreAnnTarget -&gt; TypeRep -&gt; [[Word8]]
</span><a href="GHC.Types.Annotations.html#findAnnsByTypeRep"><span class="hs-identifier hs-var">findAnnsByTypeRep</span></a></span><span> </span><span class="annot"><span class="annottext">AnnEnv
</span><a href="#local-6989586621681124756"><span class="hs-identifier hs-var">epsHptAnns</span></a></span><span> </span><span class="annot"><span class="annottext">CoreAnnTarget
</span><a href="#local-6989586621681124759"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">TypeRep
</span><a href="#local-6989586621681124760"><span class="hs-identifier hs-var">tyrep</span></a></span><span>
</span><span id="line-1421"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681124751"><span class="annot"><span class="annottext">selectedTcgAnns :: [[Word8]]
</span><a href="#local-6989586621681124751"><span class="hs-identifier hs-var hs-var">selectedTcgAnns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AnnEnv -&gt; CoreAnnTarget -&gt; TypeRep -&gt; [[Word8]]
</span><a href="GHC.Types.Annotations.html#findAnnsByTypeRep"><span class="hs-identifier hs-var">findAnnsByTypeRep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; AnnEnv
</span><a href="GHC.Tc.Types.html#tcg_ann_env"><span class="hs-identifier hs-var hs-var">tcg_ann_env</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681124754"><span class="hs-identifier hs-var">tcg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoreAnnTarget
</span><a href="#local-6989586621681124759"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">TypeRep
</span><a href="#local-6989586621681124760"><span class="hs-identifier hs-var">tyrep</span></a></span><span>
</span><span id="line-1422"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">[[Word8]] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [[Word8]]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[[Word8]]
</span><a href="#local-6989586621681124753"><span class="hs-identifier hs-var">selectedEpsHptAnns</span></a></span><span> </span><span class="annot"><span class="annottext">[[Word8]] -&gt; [[Word8]] -&gt; [[Word8]]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[[Word8]]
</span><a href="#local-6989586621681124751"><span class="hs-identifier hs-var">selectedTcgAnns</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1423"></span><span>
</span><span id="line-1424"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
            Instance Testing
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-1431"></span><span>
</span><span id="line-1432"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyInstances"><span class="hs-identifier hs-type">reifyInstances</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Name"><span class="hs-identifier hs-type">TH.Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Type"><span class="hs-identifier hs-type">TH.Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Dec"><span class="hs-identifier hs-type">TH.Dec</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1433"></span><span id="reifyInstances"><span class="annot"><span class="annottext">reifyInstances :: Name -&gt; [Type] -&gt; TcM [Dec]
</span><a href="GHC.Tc.Gen.Splice.html#reifyInstances"><span class="hs-identifier hs-var hs-var">reifyInstances</span></a></span></span><span> </span><span id="local-6989586621681124749"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124749"><span class="hs-identifier hs-var">th_nm</span></a></span></span><span> </span><span id="local-6989586621681124748"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124748"><span class="hs-identifier hs-var">th_tys</span></a></span></span><span>
</span><span id="line-1434"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MsgDoc -&gt; TcM [Dec] -&gt; TcM [Dec]
forall a. MsgDoc -&gt; TcM a -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#addErrCtxt"><span class="hs-identifier hs-var">addErrCtxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;In the argument of reifyInstances:&quot;</span></span><span>
</span><span id="line-1435"></span><span>                 </span><span class="annot"><span class="annottext">MsgDoc -&gt; MsgDoc -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; MsgDoc
forall a. Ppr a =&gt; a -&gt; MsgDoc
</span><a href="GHC.Tc.Gen.Splice.html#ppr_th"><span class="hs-identifier hs-var">ppr_th</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124749"><span class="hs-identifier hs-var">th_nm</span></a></span><span> </span><span class="annot"><span class="annottext">MsgDoc -&gt; MsgDoc -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[MsgDoc] -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Type -&gt; MsgDoc) -&gt; [Type] -&gt; [MsgDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; MsgDoc
forall a. Ppr a =&gt; a -&gt; MsgDoc
</span><a href="GHC.Tc.Gen.Splice.html#ppr_th"><span class="hs-identifier hs-var">ppr_th</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124748"><span class="hs-identifier hs-var">th_tys</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(TcM [Dec] -&gt; TcM [Dec]) -&gt; TcM [Dec] -&gt; TcM [Dec]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1436"></span><span>     </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681124746"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681124746"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRn SrcSpan
</span><a href="GHC.Tc.Utils.Monad.html#getSrcSpanM"><span class="hs-identifier hs-var">getSrcSpanM</span></a></span><span>
</span><span id="line-1437"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681124745"><span class="annot"><span class="annottext">Origin
</span><a href="#local-6989586621681124745"><span class="hs-identifier hs-var">th_origin</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM Origin
</span><a href="GHC.Tc.Gen.Splice.html#getThSpliceOrigin"><span class="hs-identifier hs-var">getThSpliceOrigin</span></a></span><span>
</span><span id="line-1438"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681124744"><span class="annot"><span class="annottext">LHsType GhcPs
</span><a href="#local-6989586621681124744"><span class="hs-identifier hs-var">rdr_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Origin
-&gt; SrcSpan -&gt; Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) (LHsType GhcPs)
</span><a href="#local-6989586621681124743"><span class="hs-identifier hs-var">cvt</span></a></span><span> </span><span class="annot"><span class="annottext">Origin
</span><a href="#local-6989586621681124745"><span class="hs-identifier hs-var">th_origin</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681124746"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; [Type] -&gt; Type
</span><a href="GHC.Tc.Gen.Splice.html#mkThAppTs"><span class="hs-identifier hs-var">mkThAppTs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#ConT"><span class="hs-identifier hs-var">TH.ConT</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124749"><span class="hs-identifier hs-var">th_nm</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124748"><span class="hs-identifier hs-var">th_tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1439"></span><span>          </span><span class="hs-comment">-- #9262 says to bring vars into scope, like in HsForAllTy case</span><span>
</span><span id="line-1440"></span><span>          </span><span class="hs-comment">-- of rnHsTyKi</span><span>
</span><span id="line-1441"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681124740"><span class="annot"><span class="annottext">tv_rdrs :: FreeKiTyVars
</span><a href="#local-6989586621681124740"><span class="hs-identifier hs-var hs-var">tv_rdrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LHsType GhcPs -&gt; FreeKiTyVars
</span><a href="GHC.Rename.HsType.html#extractHsTyRdrTyVars"><span class="hs-identifier hs-var">extractHsTyRdrTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcPs
</span><a href="#local-6989586621681124744"><span class="hs-identifier hs-var">rdr_ty</span></a></span><span>
</span><span id="line-1442"></span><span>          </span><span class="hs-comment">-- Rename  to HsType Name</span><span>
</span><span id="line-1443"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621681124738"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621681124738"><span class="hs-identifier hs-var">tv_names</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681124737"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621681124737"><span class="hs-identifier hs-var">rn_ty</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span id="local-6989586621681124736"><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621681124736"><span class="hs-identifier hs-var">_fvs</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1444"></span><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM (([Name], LHsType GhcRn), FreeVars)
-&gt; TcM (([Name], LHsType GhcRn), FreeVars)
forall r. TcM r -&gt; TcM r
</span><a href="GHC.Tc.Utils.Monad.html#checkNoErrs"><span class="hs-identifier hs-var">checkNoErrs</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM (([Name], LHsType GhcRn), FreeVars)
 -&gt; TcM (([Name], LHsType GhcRn), FreeVars))
-&gt; TcM (([Name], LHsType GhcRn), FreeVars)
-&gt; TcM (([Name], LHsType GhcRn), FreeVars)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-comment">-- If there are out-of-scope Names here, then we</span><span>
</span><span id="line-1445"></span><span>                             </span><span class="hs-comment">-- must error before proceeding to typecheck the</span><span>
</span><span id="line-1446"></span><span>                             </span><span class="hs-comment">-- renamed type, as that will result in GHC</span><span>
</span><span id="line-1447"></span><span>                             </span><span class="hs-comment">-- internal errors (#13837).</span><span>
</span><span id="line-1448"></span><span>               </span><span class="annot"><span class="annottext">Maybe Any
-&gt; FreeKiTyVars
-&gt; ([Name] -&gt; TcM (([Name], LHsType GhcRn), FreeVars))
-&gt; TcM (([Name], LHsType GhcRn), FreeVars)
forall assoc a.
Maybe assoc
-&gt; FreeKiTyVars
-&gt; ([Name] -&gt; RnM (a, FreeVars))
-&gt; RnM (a, FreeVars)
</span><a href="GHC.Rename.HsType.html#rnImplicitBndrs"><span class="hs-identifier hs-var">rnImplicitBndrs</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Any
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">FreeKiTyVars
</span><a href="#local-6989586621681124740"><span class="hs-identifier hs-var">tv_rdrs</span></a></span><span> </span><span class="annot"><span class="annottext">(([Name] -&gt; TcM (([Name], LHsType GhcRn), FreeVars))
 -&gt; TcM (([Name], LHsType GhcRn), FreeVars))
-&gt; ([Name] -&gt; TcM (([Name], LHsType GhcRn), FreeVars))
-&gt; TcM (([Name], LHsType GhcRn), FreeVars)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span> </span><span id="local-6989586621681124734"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621681124734"><span class="hs-identifier hs-var">tv_names</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1449"></span><span>               </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681124733"><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621681124733"><span class="hs-identifier hs-var">rn_ty</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681124732"><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621681124732"><span class="hs-identifier hs-var">fvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HsDocContext -&gt; LHsType GhcPs -&gt; RnM (LHsType GhcRn, FreeVars)
</span><a href="GHC.Rename.HsType.html#rnLHsType"><span class="hs-identifier hs-var">rnLHsType</span></a></span><span> </span><span class="annot"><span class="annottext">HsDocContext
</span><a href="#local-6989586621681124730"><span class="hs-identifier hs-var">doc</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcPs
</span><a href="#local-6989586621681124744"><span class="hs-identifier hs-var">rdr_ty</span></a></span><span>
</span><span id="line-1450"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">(([Name], LHsType GhcRn), FreeVars)
-&gt; TcM (([Name], LHsType GhcRn), FreeVars)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621681124734"><span class="hs-identifier hs-var">tv_names</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621681124733"><span class="hs-identifier hs-var">rn_ty</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FreeVars
</span><a href="#local-6989586621681124732"><span class="hs-identifier hs-var">fvs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1451"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681124729"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681124729"><span class="hs-identifier hs-var">_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681124728"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124728"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1452"></span><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM ([Id], Type) -&gt; TcM ([Id], Type)
forall r. TcM r -&gt; TcM r
</span><a href="GHC.Tc.Utils.Monad.html#pushTcLevelM_"><span class="hs-identifier hs-var">pushTcLevelM_</span></a></span><span>   </span><span class="annot"><span class="annottext">(TcM ([Id], Type) -&gt; TcM ([Id], Type))
-&gt; TcM ([Id], Type) -&gt; TcM ([Id], Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1453"></span><span>               </span><span class="annot"><span class="annottext">TcM ([Id], Type) -&gt; TcM ([Id], Type)
forall r. TcM r -&gt; TcM r
</span><a href="GHC.Tc.Solver.html#solveEqualities"><span class="hs-identifier hs-var">solveEqualities</span></a></span><span> </span><span class="annot"><span class="annottext">(TcM ([Id], Type) -&gt; TcM ([Id], Type))
-&gt; TcM ([Id], Type) -&gt; TcM ([Id], Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-comment">-- Avoid error cascade if there are unsolved</span><span>
</span><span id="line-1454"></span><span>               </span><span class="annot"><span class="annottext">[Name] -&gt; IOEnv (Env TcGblEnv TcLclEnv) Type -&gt; TcM ([Id], Type)
forall a. [Name] -&gt; TcM a -&gt; TcM ([Id], a)
</span><a href="GHC.Tc.Gen.HsType.html#bindImplicitTKBndrs_Skol"><span class="hs-identifier hs-var">bindImplicitTKBndrs_Skol</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621681124738"><span class="hs-identifier hs-var">tv_names</span></a></span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) Type -&gt; TcM ([Id], Type))
-&gt; IOEnv (Env TcGblEnv TcLclEnv) Type -&gt; TcM ([Id], Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1455"></span><span>               </span><span class="annot"><span class="annottext">LHsType GhcRn -&gt; IOEnv (Env TcGblEnv TcLclEnv) Type
</span><a href="GHC.Tc.Gen.HsType.html#tcInferLHsType"><span class="hs-identifier hs-var">tcInferLHsType</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcRn
</span><a href="#local-6989586621681124737"><span class="hs-identifier hs-var">rn_ty</span></a></span><span>
</span><span id="line-1456"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681124723"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124723"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) Type
</span><a href="GHC.Tc.Utils.Zonk.html#zonkTcTypeToType"><span class="hs-identifier hs-var">zonkTcTypeToType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124728"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1457"></span><span>                </span><span class="hs-comment">-- Substitute out the meta type variables</span><span>
</span><span id="line-1458"></span><span>                </span><span class="hs-comment">-- In particular, the type might have kind</span><span>
</span><span id="line-1459"></span><span>                </span><span class="hs-comment">-- variables inside it (#7477)</span><span>
</span><span id="line-1460"></span><span>
</span><span id="line-1461"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; MsgDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;reifyInstances&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; MsgDoc
forall a. Outputable a =&gt; a -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124723"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">MsgDoc -&gt; MsgDoc -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; MsgDoc
forall a. Outputable a =&gt; a -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
Type -&gt; Type
</span><a href="GHC.Core.Type.html#tcTypeKind"><span class="hs-identifier hs-var">tcTypeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124723"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1462"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Maybe (TyCon, [Type])
Type -&gt; Maybe (TyCon, [Type])
</span><a href="GHC.Core.Type.html#splitTyConApp_maybe"><span class="hs-identifier hs-var">splitTyConApp_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124723"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>   </span><span class="hs-comment">-- This expands any type synonyms</span><span>
</span><span id="line-1463"></span><span>            </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681124719"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124719"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681124718"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124718"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span>                 </span><span class="hs-comment">-- See #7910</span><span>
</span><span id="line-1464"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681124717"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681124717"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Maybe Class
</span><a href="GHC.Core.TyCon.html#tyConClass_maybe"><span class="hs-identifier hs-var">tyConClass_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124719"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-1465"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681124715"><span class="annot"><span class="annottext">InstEnvs
</span><a href="#local-6989586621681124715"><span class="hs-identifier hs-var">inst_envs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM InstEnvs
</span><a href="GHC.Tc.Utils.Env.html#tcGetInstEnvs"><span class="hs-identifier hs-var">tcGetInstEnvs</span></a></span><span>
</span><span id="line-1466"></span><span>                     </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681124713"><span class="annot"><span class="annottext">[InstMatch]
</span><a href="#local-6989586621681124713"><span class="hs-identifier hs-var">matches</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681124712"><span class="annot"><span class="annottext">[ClsInst]
</span><a href="#local-6989586621681124712"><span class="hs-identifier hs-var">unifies</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[InstMatch]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; InstEnvs
-&gt; Class
-&gt; [Type]
-&gt; ([InstMatch], [ClsInst], [InstMatch])
</span><a href="GHC.Core.InstEnv.html#lookupInstEnv"><span class="hs-identifier hs-var">lookupInstEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">InstEnvs
</span><a href="#local-6989586621681124715"><span class="hs-identifier hs-var">inst_envs</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681124717"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124718"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-1467"></span><span>                     </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; MsgDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;reifyInstances1&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[InstMatch] -&gt; MsgDoc
forall a. Outputable a =&gt; a -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[InstMatch]
</span><a href="#local-6989586621681124713"><span class="hs-identifier hs-var">matches</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1468"></span><span>                     </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Class -&gt; [ClsInst] -&gt; TcM [Dec]
</span><a href="GHC.Tc.Gen.Splice.html#reifyClassInstances"><span class="hs-identifier hs-var">reifyClassInstances</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681124717"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(InstMatch -&gt; ClsInst) -&gt; [InstMatch] -&gt; [ClsInst]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">InstMatch -&gt; ClsInst
forall a b. (a, b) -&gt; a
</span><a href="../../base/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">[InstMatch]
</span><a href="#local-6989586621681124713"><span class="hs-identifier hs-var">matches</span></a></span><span> </span><span class="annot"><span class="annottext">[ClsInst] -&gt; [ClsInst] -&gt; [ClsInst]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[ClsInst]
</span><a href="#local-6989586621681124712"><span class="hs-identifier hs-var">unifies</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1469"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isOpenFamilyTyCon"><span class="hs-identifier hs-var">isOpenFamilyTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124719"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-1470"></span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681124708"><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621681124708"><span class="hs-identifier hs-var">inst_envs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM FamInstEnvs
</span><a href="GHC.Tc.Instance.Family.html#tcGetFamInstEnvs"><span class="hs-identifier hs-var">tcGetFamInstEnvs</span></a></span><span>
</span><span id="line-1471"></span><span>                     </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681124706"><span class="annot"><span class="annottext">matches :: [FamInstMatch]
</span><a href="#local-6989586621681124706"><span class="hs-identifier hs-var hs-var">matches</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FamInstEnvs -&gt; TyCon -&gt; [Type] -&gt; [FamInstMatch]
</span><a href="GHC.Core.FamInstEnv.html#lookupFamInstEnv"><span class="hs-identifier hs-var">lookupFamInstEnv</span></a></span><span> </span><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621681124708"><span class="hs-identifier hs-var">inst_envs</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124719"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124718"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-1472"></span><span>                     </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; MsgDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;reifyInstances2&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FamInstMatch] -&gt; MsgDoc
forall a. Outputable a =&gt; a -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[FamInstMatch]
</span><a href="#local-6989586621681124706"><span class="hs-identifier hs-var">matches</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1473"></span><span>                     </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [FamInst] -&gt; TcM [Dec]
</span><a href="GHC.Tc.Gen.Splice.html#reifyFamilyInstances"><span class="hs-identifier hs-var">reifyFamilyInstances</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124719"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(FamInstMatch -&gt; FamInst) -&gt; [FamInstMatch] -&gt; [FamInst]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">FamInstMatch -&gt; FamInst
</span><a href="GHC.Core.FamInstEnv.html#fim_instance"><span class="hs-identifier hs-var hs-var">fim_instance</span></a></span><span> </span><span class="annot"><span class="annottext">[FamInstMatch]
</span><a href="#local-6989586621681124706"><span class="hs-identifier hs-var">matches</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1474"></span><span>            </span><span class="annot"><span class="annottext">Maybe (TyCon, [Type])
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MsgDoc -&gt; TcM [Dec]
forall a. MsgDoc -&gt; TcM a
</span><a href="#local-6989586621681124702"><span class="hs-identifier hs-var">bale_out</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MsgDoc -&gt; Arity -&gt; MsgDoc -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;reifyInstances:&quot;</span></span><span> </span><span class="annot"><span class="annottext">MsgDoc -&gt; MsgDoc -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">MsgDoc -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; MsgDoc
forall a. Outputable a =&gt; a -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124723"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1475"></span><span>                               </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;is not a class constraint or type family application&quot;</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1476"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1477"></span><span>    </span><span id="local-6989586621681124730"><span class="annot"><span class="annottext">doc :: HsDocContext
</span><a href="#local-6989586621681124730"><span class="hs-identifier hs-var hs-var">doc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HsDocContext
</span><a href="GHC.Rename.Utils.html#ClassInstanceCtx"><span class="hs-identifier hs-var">ClassInstanceCtx</span></a></span><span>
</span><span id="line-1478"></span><span>    </span><span id="local-6989586621681124702"><span class="annot"><span class="annottext">bale_out :: MsgDoc -&gt; TcM a
</span><a href="#local-6989586621681124702"><span class="hs-identifier hs-var hs-var">bale_out</span></a></span></span><span> </span><span id="local-6989586621681124700"><span class="annot"><span class="annottext">MsgDoc
</span><a href="#local-6989586621681124700"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MsgDoc -&gt; TcM a
forall a. MsgDoc -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span> </span><span class="annot"><span class="annottext">MsgDoc
</span><a href="#local-6989586621681124700"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-1479"></span><span>
</span><span id="line-1480"></span><span>    </span><span class="annot"><a href="#local-6989586621681124743"><span class="hs-identifier hs-type">cvt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#Origin"><span class="hs-identifier hs-type">Origin</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Type"><span class="hs-identifier hs-type">TH.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Hs.Type.html#LHsType"><span class="hs-identifier hs-type">LHsType</span></a></span><span> </span><span class="annot"><a href="GHC.Hs.Extension.html#GhcPs"><span class="hs-identifier hs-type">GhcPs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1481"></span><span>    </span><span id="local-6989586621681124743"><span class="annot"><span class="annottext">cvt :: Origin
-&gt; SrcSpan -&gt; Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) (LHsType GhcPs)
</span><a href="#local-6989586621681124743"><span class="hs-identifier hs-var hs-var">cvt</span></a></span></span><span> </span><span id="local-6989586621681124699"><span class="annot"><span class="annottext">Origin
</span><a href="#local-6989586621681124699"><span class="hs-identifier hs-var">origin</span></a></span></span><span> </span><span id="local-6989586621681124698"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681124698"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681124697"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124697"><span class="hs-identifier hs-var">th_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Origin -&gt; SrcSpan -&gt; Type -&gt; Either MsgDoc (LHsType GhcPs)
</span><a href="GHC.ThToHs.html#convertToHsType"><span class="hs-identifier hs-var">convertToHsType</span></a></span><span> </span><span class="annot"><span class="annottext">Origin
</span><a href="#local-6989586621681124699"><span class="hs-identifier hs-var">origin</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681124698"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124697"><span class="hs-identifier hs-var">th_ty</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1482"></span><span>      </span><span class="annot"><a href="../../base/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621681124696"><span class="annot"><span class="annottext">MsgDoc
</span><a href="#local-6989586621681124696"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MsgDoc -&gt; IOEnv (Env TcGblEnv TcLclEnv) (LHsType GhcPs)
forall a. MsgDoc -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span> </span><span class="annot"><span class="annottext">MsgDoc
</span><a href="#local-6989586621681124696"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-1483"></span><span>      </span><span class="annot"><a href="../../base/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621681124695"><span class="annot"><span class="annottext">LHsType GhcPs
</span><a href="#local-6989586621681124695"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LHsType GhcPs -&gt; IOEnv (Env TcGblEnv TcLclEnv) (LHsType GhcPs)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">LHsType GhcPs
</span><a href="#local-6989586621681124695"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1484"></span><span>
</span><span id="line-1485"></span><span class="hs-comment">{-
************************************************************************
*                                                                      *
                        Reification
*                                                                      *
************************************************************************
-}</span><span>
</span><span id="line-1492"></span><span>
</span><span id="line-1493"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#lookupName"><span class="hs-identifier hs-type">lookupName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>      </span><span class="hs-comment">-- True  &lt;=&gt; type namespace</span><span>
</span><span id="line-1494"></span><span>                        </span><span class="hs-comment">-- False &lt;=&gt; value namespace</span><span>
</span><span id="line-1495"></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Name"><span class="hs-identifier hs-type">TH.Name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1496"></span><span id="lookupName"><span class="annot"><span class="annottext">lookupName :: Bool -&gt; String -&gt; TcM (Maybe Name)
</span><a href="GHC.Tc.Gen.Splice.html#lookupName"><span class="hs-identifier hs-var hs-var">lookupName</span></a></span></span><span> </span><span id="local-6989586621681124694"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681124694"><span class="hs-identifier hs-var">is_type_name</span></a></span></span><span> </span><span id="local-6989586621681124693"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681124693"><span class="hs-identifier hs-var">s</span></a></span></span><span>
</span><span id="line-1497"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681124692"><span class="annot"><span class="annottext">LocalRdrEnv
</span><a href="#local-6989586621681124692"><span class="hs-identifier hs-var">lcl_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RnM LocalRdrEnv
</span><a href="GHC.Tc.Utils.Monad.html#getLocalRdrEnv"><span class="hs-identifier hs-var">getLocalRdrEnv</span></a></span><span>
</span><span id="line-1498"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">LocalRdrEnv -&gt; RdrName -&gt; Maybe Name
</span><a href="GHC.Types.Name.Reader.html#lookupLocalRdrEnv"><span class="hs-identifier hs-var">lookupLocalRdrEnv</span></a></span><span> </span><span class="annot"><span class="annottext">LocalRdrEnv
</span><a href="#local-6989586621681124692"><span class="hs-identifier hs-var">lcl_env</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621681124689"><span class="hs-identifier hs-var">rdr_name</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1499"></span><span>           </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681124688"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124688"><span class="hs-identifier hs-var">n</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Name -&gt; TcM (Maybe Name)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Maybe Name
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124688"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1500"></span><span>           </span><span class="annot"><span class="annottext">Maybe Name
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681124686"><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621681124686"><span class="hs-identifier hs-var">mb_nm</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; RnM (Maybe Name)
</span><a href="GHC.Rename.Env.html#lookupGlobalOccRn_maybe"><span class="hs-identifier hs-var">lookupGlobalOccRn_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621681124689"><span class="hs-identifier hs-var">rdr_name</span></a></span><span>
</span><span id="line-1501"></span><span>                         </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Maybe Name -&gt; TcM (Maybe Name)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Name -&gt; Name) -&gt; Maybe Name -&gt; Maybe Name
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621681124686"><span class="hs-identifier hs-var">mb_nm</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1502"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1503"></span><span>    </span><span id="local-6989586621681124684"><span class="annot"><span class="annottext">th_name :: Name
</span><a href="#local-6989586621681124684"><span class="hs-identifier hs-var hs-var">th_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Name
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#mkName"><span class="hs-identifier hs-var">TH.mkName</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681124693"><span class="hs-identifier hs-var">s</span></a></span><span>       </span><span class="hs-comment">-- Parses M.x into a base of 'x' and a module of 'M'</span><span>
</span><span id="line-1504"></span><span>
</span><span id="line-1505"></span><span>    </span><span class="annot"><a href="#local-6989586621681124683"><span class="hs-identifier hs-type">occ_fs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span>
</span><span id="line-1506"></span><span>    </span><span id="local-6989586621681124683"><span class="annot"><span class="annottext">occ_fs :: FastString
</span><a href="#local-6989586621681124683"><span class="hs-identifier hs-var hs-var">occ_fs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; FastString
</span><a href="GHC.Data.FastString.html#mkFastString"><span class="hs-identifier hs-var">mkFastString</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; String
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#nameBase"><span class="hs-identifier hs-var">TH.nameBase</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124684"><span class="hs-identifier hs-var">th_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1507"></span><span>
</span><span id="line-1508"></span><span>    </span><span class="annot"><a href="#local-6989586621681124680"><span class="hs-identifier hs-type">occ</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.Occurrence.html#OccName"><span class="hs-identifier hs-type">OccName</span></a></span><span>
</span><span id="line-1509"></span><span>    </span><span id="local-6989586621681124680"><span class="annot"><span class="annottext">occ :: OccName
</span><a href="#local-6989586621681124680"><span class="hs-identifier hs-var hs-var">occ</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681124694"><span class="hs-identifier hs-var">is_type_name</span></a></span><span>
</span><span id="line-1510"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; Bool
</span><a href="GHC.Utils.Lexeme.html#isLexVarSym"><span class="hs-identifier hs-var">isLexVarSym</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621681124683"><span class="hs-identifier hs-var">occ_fs</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">FastString -&gt; Bool
</span><a href="GHC.Utils.Lexeme.html#isLexCon"><span class="hs-identifier hs-var">isLexCon</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621681124683"><span class="hs-identifier hs-var">occ_fs</span></a></span><span>
</span><span id="line-1511"></span><span>                             </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; OccName
</span><a href="GHC.Types.Name.Occurrence.html#mkTcOccFS"><span class="hs-identifier hs-var">mkTcOccFS</span></a></span><span>    </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621681124683"><span class="hs-identifier hs-var">occ_fs</span></a></span><span>
</span><span id="line-1512"></span><span>                             </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; OccName
</span><a href="GHC.Types.Name.Occurrence.html#mkTyVarOccFS"><span class="hs-identifier hs-var">mkTyVarOccFS</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621681124683"><span class="hs-identifier hs-var">occ_fs</span></a></span><span>
</span><span id="line-1513"></span><span>        </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1514"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; Bool
</span><a href="GHC.Utils.Lexeme.html#isLexCon"><span class="hs-identifier hs-var">isLexCon</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621681124683"><span class="hs-identifier hs-var">occ_fs</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; OccName
</span><a href="GHC.Types.Name.Occurrence.html#mkDataOccFS"><span class="hs-identifier hs-var">mkDataOccFS</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621681124683"><span class="hs-identifier hs-var">occ_fs</span></a></span><span>
</span><span id="line-1515"></span><span>                             </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; OccName
</span><a href="GHC.Types.Name.Occurrence.html#mkVarOccFS"><span class="hs-identifier hs-var">mkVarOccFS</span></a></span><span>  </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621681124683"><span class="hs-identifier hs-var">occ_fs</span></a></span><span>
</span><span id="line-1516"></span><span>
</span><span id="line-1517"></span><span>    </span><span id="local-6989586621681124689"><span class="annot"><span class="annottext">rdr_name :: RdrName
</span><a href="#local-6989586621681124689"><span class="hs-identifier hs-var hs-var">rdr_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Maybe String
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#nameModule"><span class="hs-identifier hs-var">TH.nameModule</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124684"><span class="hs-identifier hs-var">th_name</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1518"></span><span>                 </span><span class="annot"><span class="annottext">Maybe String
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; RdrName
</span><a href="GHC.Types.Name.Reader.html#mkRdrUnqual"><span class="hs-identifier hs-var">mkRdrUnqual</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621681124680"><span class="hs-identifier hs-var">occ</span></a></span><span>
</span><span id="line-1519"></span><span>                 </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681124670"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681124670"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; OccName -&gt; RdrName
</span><a href="GHC.Types.Name.Reader.html#mkRdrQual"><span class="hs-identifier hs-var">mkRdrQual</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; ModuleName
</span><a href="GHC.Unit.Module.Name.html#mkModuleName"><span class="hs-identifier hs-var">mkModuleName</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681124670"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621681124680"><span class="hs-identifier hs-var">occ</span></a></span><span>
</span><span id="line-1520"></span><span>
</span><span id="line-1521"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#getThing"><span class="hs-identifier hs-type">getThing</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Name"><span class="hs-identifier hs-type">TH.Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcTyThing"><span class="hs-identifier hs-type">TcTyThing</span></a></span><span>
</span><span id="line-1522"></span><span id="getThing"><span class="annot"><span class="annottext">getThing :: Name -&gt; TcM TcTyThing
</span><a href="GHC.Tc.Gen.Splice.html#getThing"><span class="hs-identifier hs-var hs-var">getThing</span></a></span></span><span> </span><span id="local-6989586621681124667"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124667"><span class="hs-identifier hs-var">th_name</span></a></span></span><span>
</span><span id="line-1523"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681124666"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124666"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Name
</span><a href="GHC.Tc.Gen.Splice.html#lookupThName"><span class="hs-identifier hs-var">lookupThName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124667"><span class="hs-identifier hs-var">th_name</span></a></span><span>
</span><span id="line-1524"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">MsgDoc -&gt; TcRn ()
forall m n. MsgDoc -&gt; TcRnIf m n ()
</span><a href="GHC.Tc.Utils.Monad.html#traceIf"><span class="hs-identifier hs-var">traceIf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;reify&quot;</span></span><span> </span><span class="annot"><span class="annottext">MsgDoc -&gt; MsgDoc -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">String -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../base/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124667"><span class="hs-identifier hs-var">th_name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MsgDoc -&gt; MsgDoc -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">MsgDoc -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#brackets"><span class="hs-identifier hs-var">brackets</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; MsgDoc
</span><a href="#local-6989586621681124663"><span class="hs-identifier hs-var">ppr_ns</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124667"><span class="hs-identifier hs-var">th_name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MsgDoc -&gt; MsgDoc -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; MsgDoc
forall a. Outputable a =&gt; a -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124666"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1525"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM TcTyThing
</span><a href="GHC.Tc.Gen.Splice.html#tcLookupTh"><span class="hs-identifier hs-var">tcLookupTh</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124666"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1526"></span><span>        </span><span class="hs-comment">-- ToDo: this tcLookup could fail, which would give a</span><span>
</span><span id="line-1527"></span><span>        </span><span class="hs-comment">--       rather unhelpful error message</span><span>
</span><span id="line-1528"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1529"></span><span>    </span><span id="local-6989586621681124663"><span class="annot"><span class="annottext">ppr_ns :: Name -&gt; MsgDoc
</span><a href="#local-6989586621681124663"><span class="hs-identifier hs-var hs-var">ppr_ns</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Name"><span class="hs-identifier hs-type">TH.Name</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#NameG"><span class="hs-identifier hs-type">TH.NameG</span></a></span><span> </span><span class="annot"><span class="annottext">NameSpace
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#DataName"><span class="hs-identifier hs-var">TH.DataName</span></a></span><span>  </span><span id="local-6989586621681124658"><span class="annot"><span class="annottext">PkgName
</span><a href="#local-6989586621681124658"><span class="hs-identifier hs-var">_pkg</span></a></span></span><span> </span><span id="local-6989586621681124657"><span class="annot"><span class="annottext">ModName
</span><a href="#local-6989586621681124657"><span class="hs-identifier hs-var">_mod</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;data&quot;</span></span><span>
</span><span id="line-1530"></span><span>    </span><span class="annot"><a href="#local-6989586621681124663"><span class="hs-identifier hs-var">ppr_ns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Name"><span class="hs-identifier hs-type">TH.Name</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#NameG"><span class="hs-identifier hs-type">TH.NameG</span></a></span><span> </span><span class="annot"><span class="annottext">NameSpace
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#TcClsName"><span class="hs-identifier hs-var">TH.TcClsName</span></a></span><span> </span><span id="local-6989586621681124655"><span class="annot"><span class="annottext">PkgName
</span><a href="#local-6989586621681124655"><span class="hs-identifier hs-var">_pkg</span></a></span></span><span> </span><span id="local-6989586621681124654"><span class="annot"><span class="annottext">ModName
</span><a href="#local-6989586621681124654"><span class="hs-identifier hs-var">_mod</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tc&quot;</span></span><span>
</span><span id="line-1531"></span><span>    </span><span class="annot"><a href="#local-6989586621681124663"><span class="hs-identifier hs-var">ppr_ns</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Name"><span class="hs-identifier hs-type">TH.Name</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#NameG"><span class="hs-identifier hs-type">TH.NameG</span></a></span><span> </span><span class="annot"><span class="annottext">NameSpace
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#VarName"><span class="hs-identifier hs-var">TH.VarName</span></a></span><span>   </span><span id="local-6989586621681124652"><span class="annot"><span class="annottext">PkgName
</span><a href="#local-6989586621681124652"><span class="hs-identifier hs-var">_pkg</span></a></span></span><span> </span><span id="local-6989586621681124651"><span class="annot"><span class="annottext">ModName
</span><a href="#local-6989586621681124651"><span class="hs-identifier hs-var">_mod</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;var&quot;</span></span><span>
</span><span id="line-1532"></span><span>    </span><span class="annot"><a href="#local-6989586621681124663"><span class="hs-identifier hs-var">ppr_ns</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; MsgDoc
forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;reify/ppr_ns&quot;</span></span><span>
</span><span id="line-1533"></span><span>
</span><span id="line-1534"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reify"><span class="hs-identifier hs-type">reify</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Name"><span class="hs-identifier hs-type">TH.Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Info"><span class="hs-identifier hs-type">TH.Info</span></a></span><span>
</span><span id="line-1535"></span><span id="reify"><span class="annot"><span class="annottext">reify :: Name -&gt; TcM Info
</span><a href="GHC.Tc.Gen.Splice.html#reify"><span class="hs-identifier hs-var hs-var">reify</span></a></span></span><span> </span><span id="local-6989586621681124650"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124650"><span class="hs-identifier hs-var">th_name</span></a></span></span><span>
</span><span id="line-1536"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">String -&gt; MsgDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;reify 1&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; String
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#showName"><span class="hs-identifier hs-var">TH.showName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124650"><span class="hs-identifier hs-var">th_name</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1537"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681124648"><span class="annot"><span class="annottext">TcTyThing
</span><a href="#local-6989586621681124648"><span class="hs-identifier hs-var">thing</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM TcTyThing
</span><a href="GHC.Tc.Gen.Splice.html#getThing"><span class="hs-identifier hs-var">getThing</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124650"><span class="hs-identifier hs-var">th_name</span></a></span><span>
</span><span id="line-1538"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">String -&gt; MsgDoc -&gt; TcRn ()
</span><a href="GHC.Tc.Utils.Monad.html#traceTc"><span class="hs-identifier hs-var">traceTc</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;reify 2&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyThing -&gt; MsgDoc
forall a. Outputable a =&gt; a -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyThing
</span><a href="#local-6989586621681124648"><span class="hs-identifier hs-var">thing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1539"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TcTyThing -&gt; TcM Info
</span><a href="GHC.Tc.Gen.Splice.html#reifyThing"><span class="hs-identifier hs-var">reifyThing</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyThing
</span><a href="#local-6989586621681124648"><span class="hs-identifier hs-var">thing</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1540"></span><span>
</span><span id="line-1541"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#lookupThName"><span class="hs-identifier hs-type">lookupThName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Name"><span class="hs-identifier hs-type">TH.Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span>
</span><span id="line-1542"></span><span id="lookupThName"><span class="annot"><span class="annottext">lookupThName :: Name -&gt; TcM Name
</span><a href="GHC.Tc.Gen.Splice.html#lookupThName"><span class="hs-identifier hs-var hs-var">lookupThName</span></a></span></span><span> </span><span id="local-6989586621681124646"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124646"><span class="hs-identifier hs-var">th_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1543"></span><span>    </span><span id="local-6989586621681124645"><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621681124645"><span class="hs-identifier hs-var">mb_name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; RnM (Maybe Name)
</span><a href="GHC.Tc.Gen.Splice.html#lookupThName_maybe"><span class="hs-identifier hs-var">lookupThName_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124646"><span class="hs-identifier hs-var">th_name</span></a></span><span>
</span><span id="line-1544"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621681124645"><span class="hs-identifier hs-var">mb_name</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1545"></span><span>        </span><span class="annot"><span class="annottext">Maybe Name
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MsgDoc -&gt; TcM Name
forall a. MsgDoc -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; MsgDoc
</span><a href="GHC.Tc.Gen.Splice.html#notInScope"><span class="hs-identifier hs-var">notInScope</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124646"><span class="hs-identifier hs-var">th_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1546"></span><span>        </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681124643"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124643"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM Name
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124643"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-1547"></span><span>
</span><span id="line-1548"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#lookupThName_maybe"><span class="hs-identifier hs-type">lookupThName_maybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Name"><span class="hs-identifier hs-type">TH.Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1549"></span><span id="lookupThName_maybe"><span class="annot"><span class="annottext">lookupThName_maybe :: Name -&gt; RnM (Maybe Name)
</span><a href="GHC.Tc.Gen.Splice.html#lookupThName_maybe"><span class="hs-identifier hs-var hs-var">lookupThName_maybe</span></a></span></span><span> </span><span id="local-6989586621681124642"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124642"><span class="hs-identifier hs-var">th_name</span></a></span></span><span>
</span><span id="line-1550"></span><span>  </span><span class="hs-glyph">=</span><span>  </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681124641"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621681124641"><span class="hs-identifier hs-var">names</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(RdrName -&gt; RnM (Maybe Name))
-&gt; [RdrName] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [Name]
forall (m :: * -&gt; *) a b.
Applicative m =&gt;
(a -&gt; m (Maybe b)) -&gt; [a] -&gt; m [b]
</span><a href="GHC.Utils.Monad.html#mapMaybeM"><span class="hs-identifier hs-var">mapMaybeM</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; RnM (Maybe Name)
</span><a href="#local-6989586621681124639"><span class="hs-identifier hs-var">lookup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; [RdrName]
</span><a href="GHC.ThToHs.html#thRdrNameGuesses"><span class="hs-identifier hs-var">thRdrNameGuesses</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124642"><span class="hs-identifier hs-var">th_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1551"></span><span>          </span><span class="hs-comment">-- Pick the first that works</span><span>
</span><span id="line-1552"></span><span>          </span><span class="hs-comment">-- E.g. reify (mkName &quot;A&quot;) will pick the class A in preference to the data constructor A</span><span>
</span><span id="line-1553"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Maybe Name -&gt; RnM (Maybe Name)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Name] -&gt; Maybe Name
forall a. [a] -&gt; Maybe a
</span><a href="../../base/src/Data.Maybe.html#listToMaybe"><span class="hs-identifier hs-var">listToMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621681124641"><span class="hs-identifier hs-var">names</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1554"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1555"></span><span>    </span><span id="local-6989586621681124639"><span class="annot"><span class="annottext">lookup :: RdrName -&gt; RnM (Maybe Name)
</span><a href="#local-6989586621681124639"><span class="hs-identifier hs-var hs-var">lookup</span></a></span></span><span> </span><span id="local-6989586621681124634"><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621681124634"><span class="hs-identifier hs-var">rdr_name</span></a></span></span><span>
</span><span id="line-1556"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span>  </span><span class="hs-comment">-- Repeat much of lookupOccRn, because we want</span><span>
</span><span id="line-1557"></span><span>                </span><span class="hs-comment">-- to report errors in a TH-relevant way</span><span>
</span><span id="line-1558"></span><span>             </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681124633"><span class="annot"><span class="annottext">LocalRdrEnv
</span><a href="#local-6989586621681124633"><span class="hs-identifier hs-var">rdr_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">RnM LocalRdrEnv
</span><a href="GHC.Tc.Utils.Monad.html#getLocalRdrEnv"><span class="hs-identifier hs-var">getLocalRdrEnv</span></a></span><span>
</span><span id="line-1559"></span><span>             </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">LocalRdrEnv -&gt; RdrName -&gt; Maybe Name
</span><a href="GHC.Types.Name.Reader.html#lookupLocalRdrEnv"><span class="hs-identifier hs-var">lookupLocalRdrEnv</span></a></span><span> </span><span class="annot"><span class="annottext">LocalRdrEnv
</span><a href="#local-6989586621681124633"><span class="hs-identifier hs-var">rdr_env</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621681124634"><span class="hs-identifier hs-var">rdr_name</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1560"></span><span>                 </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681124632"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124632"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Name -&gt; RnM (Maybe Name)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Maybe Name
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124632"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1561"></span><span>                 </span><span class="annot"><span class="annottext">Maybe Name
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">RdrName -&gt; RnM (Maybe Name)
</span><a href="GHC.Rename.Env.html#lookupGlobalOccRn_maybe"><span class="hs-identifier hs-var">lookupGlobalOccRn_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">RdrName
</span><a href="#local-6989586621681124634"><span class="hs-identifier hs-var">rdr_name</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1562"></span><span>
</span><span id="line-1563"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#tcLookupTh"><span class="hs-identifier hs-type">tcLookupTh</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcTyThing"><span class="hs-identifier hs-type">TcTyThing</span></a></span><span>
</span><span id="line-1564"></span><span class="hs-comment">-- This is a specialised version of GHC.Tc.Utils.Env.tcLookup; specialised mainly in that</span><span>
</span><span id="line-1565"></span><span class="hs-comment">-- it gives a reify-related error message on failure, whereas in the normal</span><span>
</span><span id="line-1566"></span><span class="hs-comment">-- tcLookup, failure is a bug.</span><span>
</span><span id="line-1567"></span><span id="tcLookupTh"><span class="annot"><span class="annottext">tcLookupTh :: Name -&gt; TcM TcTyThing
</span><a href="GHC.Tc.Gen.Splice.html#tcLookupTh"><span class="hs-identifier hs-var hs-var">tcLookupTh</span></a></span></span><span> </span><span id="local-6989586621681124631"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124631"><span class="hs-identifier hs-var">name</span></a></span></span><span>
</span><span id="line-1568"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681124630"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681124630"><span class="hs-identifier hs-var">gbl_env</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681124629"><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681124629"><span class="hs-identifier hs-var">lcl_env</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv (TcGblEnv, TcLclEnv)
forall gbl lcl. TcRnIf gbl lcl (gbl, lcl)
</span><a href="GHC.Tc.Utils.Monad.html#getEnvs"><span class="hs-identifier hs-var">getEnvs</span></a></span><span>
</span><span id="line-1569"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">NameEnv TcTyThing -&gt; Name -&gt; Maybe TcTyThing
forall a. NameEnv a -&gt; Name -&gt; Maybe a
</span><a href="GHC.Types.Name.Env.html#lookupNameEnv"><span class="hs-identifier hs-var">lookupNameEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcLclEnv -&gt; NameEnv TcTyThing
</span><a href="GHC.Tc.Types.html#tcl_env"><span class="hs-identifier hs-var hs-var">tcl_env</span></a></span><span> </span><span class="annot"><span class="annottext">TcLclEnv
</span><a href="#local-6989586621681124629"><span class="hs-identifier hs-var">lcl_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124631"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-1570"></span><span>                </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681124625"><span class="annot"><span class="annottext">TcTyThing
</span><a href="#local-6989586621681124625"><span class="hs-identifier hs-var">thing</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcTyThing -&gt; TcM TcTyThing
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyThing
</span><a href="#local-6989586621681124625"><span class="hs-identifier hs-var">thing</span></a></span><span class="hs-special">;</span><span>
</span><span id="line-1571"></span><span>                </span><span class="annot"><span class="annottext">Maybe TcTyThing
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1572"></span><span>
</span><span id="line-1573"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">NameEnv TyThing -&gt; Name -&gt; Maybe TyThing
forall a. NameEnv a -&gt; Name -&gt; Maybe a
</span><a href="GHC.Types.Name.Env.html#lookupNameEnv"><span class="hs-identifier hs-var">lookupNameEnv</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; NameEnv TyThing
</span><a href="GHC.Tc.Types.html#tcg_type_env"><span class="hs-identifier hs-var hs-var">tcg_type_env</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681124630"><span class="hs-identifier hs-var">gbl_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124631"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-1574"></span><span>                </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681124623"><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621681124623"><span class="hs-identifier hs-var">thing</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcTyThing -&gt; TcM TcTyThing
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyThing -&gt; TcTyThing
</span><a href="GHC.Tc.Types.html#AGlobal"><span class="hs-identifier hs-var">AGlobal</span></a></span><span> </span><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621681124623"><span class="hs-identifier hs-var">thing</span></a></span><span class="hs-special">)</span><span class="hs-special">;</span><span>
</span><span id="line-1575"></span><span>                </span><span class="annot"><span class="annottext">Maybe TyThing
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1576"></span><span>
</span><span id="line-1577"></span><span>          </span><span class="hs-comment">-- EZY: I don't think this choice matters, no TH in signatures!</span><span>
</span><span id="line-1578"></span><span>          </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">GenModule Unit -&gt; Name -&gt; Bool
</span><a href="GHC.Types.Name.html#nameIsLocalOrFrom"><span class="hs-identifier hs-var">nameIsLocalOrFrom</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; GenModule Unit
</span><a href="GHC.Tc.Types.html#tcg_semantic_mod"><span class="hs-identifier hs-var hs-var">tcg_semantic_mod</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681124630"><span class="hs-identifier hs-var">gbl_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124631"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-1579"></span><span>          </span><span class="hs-keyword">then</span><span>  </span><span class="hs-comment">-- It's defined in this module</span><span>
</span><span id="line-1580"></span><span>                </span><span class="annot"><span class="annottext">MsgDoc -&gt; TcM TcTyThing
forall a. MsgDoc -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; MsgDoc
</span><a href="GHC.Tc.Gen.Splice.html#notInEnv"><span class="hs-identifier hs-var">notInEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124631"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1581"></span><span>
</span><span id="line-1582"></span><span>          </span><span class="hs-keyword">else</span><span>
</span><span id="line-1583"></span><span>     </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681124618"><span class="annot"><span class="annottext">MaybeErr MsgDoc TyThing
</span><a href="#local-6989586621681124618"><span class="hs-identifier hs-var">mb_thing</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM (MaybeErr MsgDoc TyThing)
</span><a href="GHC.Iface.Load.html#tcLookupImported_maybe"><span class="hs-identifier hs-var">tcLookupImported_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124631"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-1584"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">MaybeErr MsgDoc TyThing
</span><a href="#local-6989586621681124618"><span class="hs-identifier hs-var">mb_thing</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1585"></span><span>            </span><span class="annot"><a href="GHC.Data.Maybe.html#Succeeded"><span class="hs-identifier hs-type">Succeeded</span></a></span><span> </span><span id="local-6989586621681124615"><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621681124615"><span class="hs-identifier hs-var">thing</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">TcTyThing -&gt; TcM TcTyThing
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyThing -&gt; TcTyThing
</span><a href="GHC.Tc.Types.html#AGlobal"><span class="hs-identifier hs-var">AGlobal</span></a></span><span> </span><span class="annot"><span class="annottext">TyThing
</span><a href="#local-6989586621681124615"><span class="hs-identifier hs-var">thing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1586"></span><span>            </span><span class="annot"><a href="GHC.Data.Maybe.html#Failed"><span class="hs-identifier hs-type">Failed</span></a></span><span> </span><span id="local-6989586621681124613"><span class="annot"><span class="annottext">MsgDoc
</span><a href="#local-6989586621681124613"><span class="hs-identifier hs-var">msg</span></a></span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MsgDoc -&gt; TcM TcTyThing
forall a. MsgDoc -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span> </span><span class="annot"><span class="annottext">MsgDoc
</span><a href="#local-6989586621681124613"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-1587"></span><span>    </span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span class="hs-special">}</span><span>
</span><span id="line-1588"></span><span>
</span><span id="line-1589"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#notInScope"><span class="hs-identifier hs-type">notInScope</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Name"><span class="hs-identifier hs-type">TH.Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-1590"></span><span id="notInScope"><span class="annot"><span class="annottext">notInScope :: Name -&gt; MsgDoc
</span><a href="GHC.Tc.Gen.Splice.html#notInScope"><span class="hs-identifier hs-var hs-var">notInScope</span></a></span></span><span> </span><span id="local-6989586621681124612"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124612"><span class="hs-identifier hs-var">th_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MsgDoc -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; String
forall a. Ppr a =&gt; a -&gt; String
</span><a href="../../template-haskell/src/Language.Haskell.TH.Ppr.html#pprint"><span class="hs-identifier hs-var">TH.pprint</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124612"><span class="hs-identifier hs-var">th_name</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MsgDoc -&gt; MsgDoc -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-1591"></span><span>                     </span><span class="annot"><span class="annottext">String -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;is not in scope at a reify&quot;</span></span><span>
</span><span id="line-1592"></span><span>        </span><span class="hs-comment">-- Ugh! Rather an indirect way to display the name</span><span>
</span><span id="line-1593"></span><span>
</span><span id="line-1594"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#notInEnv"><span class="hs-identifier hs-type">notInEnv</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-1595"></span><span id="notInEnv"><span class="annot"><span class="annottext">notInEnv :: Name -&gt; MsgDoc
</span><a href="GHC.Tc.Gen.Splice.html#notInEnv"><span class="hs-identifier hs-var hs-var">notInEnv</span></a></span></span><span> </span><span id="local-6989586621681124611"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124611"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MsgDoc -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; MsgDoc
forall a. Outputable a =&gt; a -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124611"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">MsgDoc -&gt; MsgDoc -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-1596"></span><span>                     </span><span class="annot"><span class="annottext">String -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;is not in the type environment at a reify&quot;</span></span><span>
</span><span id="line-1597"></span><span>
</span><span id="line-1598"></span><span class="hs-comment">------------------------------</span><span>
</span><span id="line-1599"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyRoles"><span class="hs-identifier hs-type">reifyRoles</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Name"><span class="hs-identifier hs-type">TH.Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Role"><span class="hs-identifier hs-type">TH.Role</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1600"></span><span id="reifyRoles"><span class="annot"><span class="annottext">reifyRoles :: Name -&gt; TcM [Role]
</span><a href="GHC.Tc.Gen.Splice.html#reifyRoles"><span class="hs-identifier hs-var hs-var">reifyRoles</span></a></span></span><span> </span><span id="local-6989586621681124610"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124610"><span class="hs-identifier hs-var">th_name</span></a></span></span><span>
</span><span id="line-1601"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681124609"><span class="annot"><span class="annottext">TcTyThing
</span><a href="#local-6989586621681124609"><span class="hs-identifier hs-var">thing</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM TcTyThing
</span><a href="GHC.Tc.Gen.Splice.html#getThing"><span class="hs-identifier hs-var">getThing</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124610"><span class="hs-identifier hs-var">th_name</span></a></span><span>
</span><span id="line-1602"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TcTyThing
</span><a href="#local-6989586621681124609"><span class="hs-identifier hs-var">thing</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1603"></span><span>           </span><span class="annot"><a href="GHC.Tc.Types.html#AGlobal"><span class="hs-identifier hs-type">AGlobal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ATyCon"><span class="hs-identifier hs-type">ATyCon</span></a></span><span> </span><span id="local-6989586621681124607"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124607"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Role] -&gt; TcM [Role]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Role -&gt; Role) -&gt; [Role] -&gt; [Role]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Role -&gt; Role
</span><a href="#local-6989586621681124606"><span class="hs-identifier hs-var">reify_role</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Role]
</span><a href="GHC.Core.TyCon.html#tyConRoles"><span class="hs-identifier hs-var">tyConRoles</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124607"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1604"></span><span>           </span><span class="annot"><span class="annottext">TcTyThing
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">MsgDoc -&gt; TcM [Role]
forall a. MsgDoc -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;No roles associated with&quot;</span></span><span> </span><span class="annot"><span class="annottext">MsgDoc -&gt; MsgDoc -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyThing -&gt; MsgDoc
forall a. Outputable a =&gt; a -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyThing
</span><a href="#local-6989586621681124609"><span class="hs-identifier hs-var">thing</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1605"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-1606"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1607"></span><span>    </span><span id="local-6989586621681124606"><span class="annot"><span class="annottext">reify_role :: Role -&gt; Role
</span><a href="#local-6989586621681124606"><span class="hs-identifier hs-var hs-var">reify_role</span></a></span></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Nominal"><span class="hs-identifier hs-var">Nominal</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#NominalR"><span class="hs-identifier hs-var">TH.NominalR</span></a></span><span>
</span><span id="line-1608"></span><span>    </span><span class="annot"><a href="#local-6989586621681124606"><span class="hs-identifier hs-var">reify_role</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Representational"><span class="hs-identifier hs-var">Representational</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#RepresentationalR"><span class="hs-identifier hs-var">TH.RepresentationalR</span></a></span><span>
</span><span id="line-1609"></span><span>    </span><span class="annot"><a href="#local-6989586621681124606"><span class="hs-identifier hs-var">reify_role</span></a></span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="GHC.Core.Coercion.Axiom.html#Phantom"><span class="hs-identifier hs-var">Phantom</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Role
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#PhantomR"><span class="hs-identifier hs-var">TH.PhantomR</span></a></span><span>
</span><span id="line-1610"></span><span>
</span><span id="line-1611"></span><span class="hs-comment">------------------------------</span><span>
</span><span id="line-1612"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyThing"><span class="hs-identifier hs-type">reifyThing</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcTyThing"><span class="hs-identifier hs-type">TcTyThing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Info"><span class="hs-identifier hs-type">TH.Info</span></a></span><span>
</span><span id="line-1613"></span><span class="hs-comment">-- The only reason this is monadic is for error reporting,</span><span>
</span><span id="line-1614"></span><span class="hs-comment">-- which in turn is mainly for the case when TH can't express</span><span>
</span><span id="line-1615"></span><span class="hs-comment">-- some random GHC extension</span><span>
</span><span id="line-1616"></span><span>
</span><span id="line-1617"></span><span id="reifyThing"><span class="annot"><span class="annottext">reifyThing :: TcTyThing -&gt; TcM Info
</span><a href="GHC.Tc.Gen.Splice.html#reifyThing"><span class="hs-identifier hs-var hs-var">reifyThing</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#AGlobal"><span class="hs-identifier hs-type">AGlobal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AnId"><span class="hs-identifier hs-type">AnId</span></a></span><span> </span><span id="local-6989586621681124597"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681124597"><span class="hs-identifier hs-var">id</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1618"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681124596"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124596"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681124597"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1619"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681124593"><span class="annot"><span class="annottext">v :: Name
</span><a href="#local-6989586621681124593"><span class="hs-identifier hs-var hs-var">v</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681124597"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-1620"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Id -&gt; IdDetails
</span><a href="GHC.Types.Var.html#idDetails"><span class="hs-identifier hs-var">idDetails</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681124597"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1621"></span><span>            </span><span class="annot"><a href="GHC.Types.Id.Info.html#ClassOpId"><span class="hs-identifier hs-type">ClassOpId</span></a></span><span> </span><span id="local-6989586621681124590"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681124590"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Info -&gt; TcM Info
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type -&gt; Name -&gt; Info
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#ClassOpI"><span class="hs-identifier hs-var">TH.ClassOpI</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124593"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124596"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681124590"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1622"></span><span>            </span><span class="annot"><a href="GHC.Types.Id.Info.html#RecSelId"><span class="hs-identifier hs-type">RecSelId</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">sel_tycon :: IdDetails -&gt; RecSelParent
</span><a href="GHC.Types.Id.Info.html#sel_tycon"><span class="hs-identifier hs-var">sel_tycon</span></a></span><span class="hs-glyph">=</span><span class="annot"><a href="GHC.Types.Id.Info.html#RecSelData"><span class="hs-identifier hs-type">RecSelData</span></a></span><span> </span><span id="local-6989586621681124585"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124585"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">}</span><span>
</span><span id="line-1623"></span><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Info -&gt; TcM Info
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type -&gt; Maybe Dec -&gt; Info
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#VarI"><span class="hs-identifier hs-var">TH.VarI</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; TyCon -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifySelector"><span class="hs-identifier hs-var">reifySelector</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681124597"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124585"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124596"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Dec
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1624"></span><span>            </span><span class="annot"><span class="annottext">IdDetails
</span><span class="hs-identifier">_</span></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Info -&gt; TcM Info
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type -&gt; Maybe Dec -&gt; Info
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#VarI"><span class="hs-identifier hs-var">TH.VarI</span></a></span><span>     </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124593"><span class="hs-identifier hs-var">v</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124596"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Dec
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1625"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-1626"></span><span>
</span><span id="line-1627"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyThing"><span class="hs-identifier hs-var">reifyThing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#AGlobal"><span class="hs-identifier hs-type">AGlobal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ATyCon"><span class="hs-identifier hs-type">ATyCon</span></a></span><span> </span><span id="local-6989586621681124582"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124582"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TcM Info
</span><a href="GHC.Tc.Gen.Splice.html#reifyTyCon"><span class="hs-identifier hs-var">reifyTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124582"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-1628"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyThing"><span class="hs-identifier hs-var">reifyThing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#AGlobal"><span class="hs-identifier hs-type">AGlobal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AConLike"><span class="hs-identifier hs-type">AConLike</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.ConLike.html#RealDataCon"><span class="hs-identifier hs-type">RealDataCon</span></a></span><span> </span><span id="local-6989586621681124578"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681124578"><span class="hs-identifier hs-var">dc</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1629"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681124577"><span class="annot"><span class="annottext">name :: Name
</span><a href="#local-6989586621681124577"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Name
</span><a href="GHC.Core.DataCon.html#dataConName"><span class="hs-identifier hs-var">dataConName</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681124578"><span class="hs-identifier hs-var">dc</span></a></span><span>
</span><span id="line-1630"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681124575"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124575"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; Id
</span><a href="GHC.Core.DataCon.html#dataConWrapId"><span class="hs-identifier hs-var">dataConWrapId</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681124578"><span class="hs-identifier hs-var">dc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1631"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Info -&gt; TcM Info
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type -&gt; Name -&gt; Info
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#DataConI"><span class="hs-identifier hs-var">TH.DataConI</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124577"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124575"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1632"></span><span>                              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; TyCon
</span><a href="GHC.Core.DataCon.html#dataConOrigTyCon"><span class="hs-identifier hs-var">dataConOrigTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681124578"><span class="hs-identifier hs-var">dc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1633"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-1634"></span><span>
</span><span id="line-1635"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyThing"><span class="hs-identifier hs-var">reifyThing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#AGlobal"><span class="hs-identifier hs-type">AGlobal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AConLike"><span class="hs-identifier hs-type">AConLike</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.ConLike.html#PatSynCon"><span class="hs-identifier hs-type">PatSynCon</span></a></span><span> </span><span id="local-6989586621681124570"><span class="annot"><span class="annottext">PatSyn
</span><a href="#local-6989586621681124570"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1636"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681124569"><span class="annot"><span class="annottext">name :: Name
</span><a href="#local-6989586621681124569"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PatSyn -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="annot"><span class="annottext">PatSyn
</span><a href="#local-6989586621681124570"><span class="hs-identifier hs-var">ps</span></a></span><span>
</span><span id="line-1637"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681124568"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124568"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">([InvisTVBinder], [Type], [InvisTVBinder], [Type], [Scaled Type],
 Type)
-&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyPatSynType"><span class="hs-identifier hs-var">reifyPatSynType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatSyn
-&gt; ([InvisTVBinder], [Type], [InvisTVBinder], [Type],
    [Scaled Type], Type)
</span><a href="GHC.Core.PatSyn.html#patSynSigBndr"><span class="hs-identifier hs-var">patSynSigBndr</span></a></span><span> </span><span class="annot"><span class="annottext">PatSyn
</span><a href="#local-6989586621681124570"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1638"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Info -&gt; TcM Info
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type -&gt; Info
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#PatSynI"><span class="hs-identifier hs-var">TH.PatSynI</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124569"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124568"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1639"></span><span>
</span><span id="line-1640"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyThing"><span class="hs-identifier hs-var">reifyThing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#ATcId"><span class="hs-identifier hs-type">ATcId</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">tct_id :: TcTyThing -&gt; Id
</span><a href="GHC.Tc.Types.html#tct_id"><span class="hs-identifier hs-var">tct_id</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681124562"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681124562"><span class="hs-identifier hs-var">id</span></a></span></span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1641"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681124561"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124561"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) Type
</span><a href="GHC.Tc.Utils.TcMType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681124562"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Make use of all the info we have, even</span><span>
</span><span id="line-1642"></span><span>                                        </span><span class="hs-comment">-- though it may be incomplete</span><span>
</span><span id="line-1643"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681124560"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124560"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124561"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-1644"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Info -&gt; TcM Info
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type -&gt; Maybe Dec -&gt; Info
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#VarI"><span class="hs-identifier hs-var">TH.VarI</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681124562"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124560"><span class="hs-identifier hs-var">ty2</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Dec
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1645"></span><span>
</span><span id="line-1646"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyThing"><span class="hs-identifier hs-var">reifyThing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Tc.Types.html#ATyVar"><span class="hs-identifier hs-type">ATyVar</span></a></span><span> </span><span id="local-6989586621681124558"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124558"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span id="local-6989586621681124557"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681124557"><span class="hs-identifier hs-var">tv1</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1647"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681124556"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124556"><span class="hs-identifier hs-var">ty1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Id -&gt; IOEnv (Env TcGblEnv TcLclEnv) Type
</span><a href="GHC.Tc.Utils.TcMType.html#zonkTcTyVar"><span class="hs-identifier hs-var">zonkTcTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681124557"><span class="hs-identifier hs-var">tv1</span></a></span><span>
</span><span id="line-1648"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681124554"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124554"><span class="hs-identifier hs-var">ty2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124556"><span class="hs-identifier hs-var">ty1</span></a></span><span>
</span><span id="line-1649"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Info -&gt; TcM Info
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type -&gt; Info
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#TyVarI"><span class="hs-identifier hs-var">TH.TyVarI</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124558"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124554"><span class="hs-identifier hs-var">ty2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1650"></span><span>
</span><span id="line-1651"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyThing"><span class="hs-identifier hs-var">reifyThing</span></a></span><span> </span><span id="local-6989586621681124552"><span class="annot"><span class="annottext">TcTyThing
</span><a href="#local-6989586621681124552"><span class="hs-identifier hs-var">thing</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; MsgDoc -&gt; TcM Info
forall a. HasCallStack =&gt; String -&gt; MsgDoc -&gt; a
</span><a href="GHC.Utils.Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;reifyThing&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcTyThing -&gt; MsgDoc
</span><a href="GHC.Tc.Types.html#pprTcTyThingCategory"><span class="hs-identifier hs-var">pprTcTyThingCategory</span></a></span><span> </span><span class="annot"><span class="annottext">TcTyThing
</span><a href="#local-6989586621681124552"><span class="hs-identifier hs-var">thing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1652"></span><span>
</span><span id="line-1653"></span><span class="hs-comment">-------------------------------------------</span><span>
</span><span id="line-1654"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyAxBranch"><span class="hs-identifier hs-type">reifyAxBranch</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#CoAxBranch"><span class="hs-identifier hs-type">CoAxBranch</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#TySynEqn"><span class="hs-identifier hs-type">TH.TySynEqn</span></a></span><span>
</span><span id="line-1655"></span><span id="reifyAxBranch"><span class="annot"><span class="annottext">reifyAxBranch :: TyCon -&gt; CoAxBranch -&gt; TcM TySynEqn
</span><a href="GHC.Tc.Gen.Splice.html#reifyAxBranch"><span class="hs-identifier hs-var hs-var">reifyAxBranch</span></a></span></span><span> </span><span id="local-6989586621681124549"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124549"><span class="hs-identifier hs-var">fam_tc</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#CoAxBranch"><span class="hs-identifier hs-type">CoAxBranch</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cab_tvs :: CoAxBranch -&gt; [Id]
</span><a href="GHC.Core.Coercion.Axiom.html#cab_tvs"><span class="hs-identifier hs-var">cab_tvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681124546"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681124546"><span class="hs-identifier hs-var">tvs</span></a></span></span><span>
</span><span id="line-1656"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cab_lhs :: CoAxBranch -&gt; [Type]
</span><a href="GHC.Core.Coercion.Axiom.html#cab_lhs"><span class="hs-identifier hs-var">cab_lhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681124544"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124544"><span class="hs-identifier hs-var">lhs</span></a></span></span><span>
</span><span id="line-1657"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cab_rhs :: CoAxBranch -&gt; Type
</span><a href="GHC.Core.Coercion.Axiom.html#cab_rhs"><span class="hs-identifier hs-var">cab_rhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681124542"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124542"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-1658"></span><span>            </span><span class="hs-comment">-- remove kind patterns (#8884)</span><span>
</span><span id="line-1659"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681124541"><span class="annot"><span class="annottext">Maybe [TyVarBndr ()]
</span><a href="#local-6989586621681124541"><span class="hs-identifier hs-var">tvs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; TcM (Maybe [TyVarBndr ()])
</span><a href="GHC.Tc.Gen.Splice.html#reifyTyVarsToMaybe"><span class="hs-identifier hs-var">reifyTyVarsToMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681124546"><span class="hs-identifier hs-var">tvs</span></a></span><span>
</span><span id="line-1660"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681124539"><span class="annot"><span class="annottext">lhs_types_only :: [Type]
</span><a href="#local-6989586621681124539"><span class="hs-identifier hs-var hs-var">lhs_types_only</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; [Type]
</span><a href="GHC.Core.Type.html#filterOutInvisibleTypes"><span class="hs-identifier hs-var">filterOutInvisibleTypes</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124549"><span class="hs-identifier hs-var">fam_tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124544"><span class="hs-identifier hs-var">lhs</span></a></span><span>
</span><span id="line-1661"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681124537"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124537"><span class="hs-identifier hs-var">lhs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; TcM [Type]
</span><a href="GHC.Tc.Gen.Splice.html#reifyTypes"><span class="hs-identifier hs-var">reifyTypes</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124539"><span class="hs-identifier hs-var">lhs_types_only</span></a></span><span>
</span><span id="line-1662"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681124535"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124535"><span class="hs-identifier hs-var">annot_th_lhs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Type -&gt; Type -&gt; TcM Type)
-&gt; [Bool] -&gt; [Type] -&gt; [Type] -&gt; TcM [Type]
forall (m :: * -&gt; *) a b c d.
Monad m =&gt;
(a -&gt; b -&gt; c -&gt; m d) -&gt; [a] -&gt; [b] -&gt; [c] -&gt; m [d]
</span><a href="GHC.Utils.Monad.html#zipWith3M"><span class="hs-identifier hs-var">zipWith3M</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Type -&gt; Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#annotThType"><span class="hs-identifier hs-var">annotThType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Bool]
</span><a href="GHC.Tc.Gen.Splice.html#tyConArgsPolyKinded"><span class="hs-identifier hs-var">tyConArgsPolyKinded</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124549"><span class="hs-identifier hs-var">fam_tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1663"></span><span>                                   </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124539"><span class="hs-identifier hs-var">lhs_types_only</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124537"><span class="hs-identifier hs-var">lhs'</span></a></span><span>
</span><span id="line-1664"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681124531"><span class="annot"><span class="annottext">lhs_type :: Type
</span><a href="#local-6989586621681124531"><span class="hs-identifier hs-var hs-var">lhs_type</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; [Type] -&gt; Type
</span><a href="GHC.Tc.Gen.Splice.html#mkThAppTs"><span class="hs-identifier hs-var">mkThAppTs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#ConT"><span class="hs-identifier hs-var">TH.ConT</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Type) -&gt; Name -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124549"><span class="hs-identifier hs-var">fam_tc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124535"><span class="hs-identifier hs-var">annot_th_lhs</span></a></span><span>
</span><span id="line-1665"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681124530"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124530"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124542"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-1666"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">TySynEqn -&gt; TcM TySynEqn
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe [TyVarBndr ()] -&gt; Type -&gt; Type -&gt; TySynEqn
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#TySynEqn"><span class="hs-identifier hs-var">TH.TySynEqn</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [TyVarBndr ()]
</span><a href="#local-6989586621681124541"><span class="hs-identifier hs-var">tvs'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124531"><span class="hs-identifier hs-var">lhs_type</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124530"><span class="hs-identifier hs-var">rhs'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1667"></span><span>
</span><span id="line-1668"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyTyCon"><span class="hs-identifier hs-type">reifyTyCon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Info"><span class="hs-identifier hs-type">TH.Info</span></a></span><span>
</span><span id="line-1669"></span><span id="reifyTyCon"><span class="annot"><span class="annottext">reifyTyCon :: TyCon -&gt; TcM Info
</span><a href="GHC.Tc.Gen.Splice.html#reifyTyCon"><span class="hs-identifier hs-var hs-var">reifyTyCon</span></a></span></span><span> </span><span id="local-6989586621681124528"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124528"><span class="hs-identifier hs-var">tc</span></a></span></span><span>
</span><span id="line-1670"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681124527"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681124527"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Maybe Class
</span><a href="GHC.Core.TyCon.html#tyConClass_maybe"><span class="hs-identifier hs-var">tyConClass_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124528"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-1671"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Class -&gt; TcM Info
</span><a href="GHC.Tc.Gen.Splice.html#reifyClass"><span class="hs-identifier hs-var">reifyClass</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681124527"><span class="hs-identifier hs-var">cls</span></a></span><span>
</span><span id="line-1672"></span><span>
</span><span id="line-1673"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isFunTyCon"><span class="hs-identifier hs-var">isFunTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124528"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-1674"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Info -&gt; TcM Info
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Arity -&gt; Bool -&gt; Info
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#PrimTyConI"><span class="hs-identifier hs-var">TH.PrimTyConI</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124528"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">2</span></span><span>                </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span class="hs-special">)</span><span>
</span><span id="line-1675"></span><span>
</span><span id="line-1676"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isPrimTyCon"><span class="hs-identifier hs-var">isPrimTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124528"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-1677"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Info -&gt; TcM Info
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Arity -&gt; Bool -&gt; Info
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#PrimTyConI"><span class="hs-identifier hs-var">TH.PrimTyConI</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124528"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; Arity
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Arity
</span><a href="../../base/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Id]
</span><a href="GHC.Core.TyCon.html#tyConVisibleTyVars"><span class="hs-identifier hs-var">tyConVisibleTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124528"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1678"></span><span>                          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isUnliftedTyCon"><span class="hs-identifier hs-var">isUnliftedTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124528"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1679"></span><span>
</span><span id="line-1680"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isTypeFamilyTyCon"><span class="hs-identifier hs-var">isTypeFamilyTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124528"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-1681"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681124518"><span class="annot"><span class="annottext">tvs :: [Id]
</span><a href="#local-6989586621681124518"><span class="hs-identifier hs-var hs-var">tvs</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Id]
</span><a href="GHC.Core.TyCon.html#tyConTyVars"><span class="hs-identifier hs-var hs-var">tyConTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124528"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-1682"></span><span>             </span><span id="local-6989586621681124516"><span class="annot"><span class="annottext">res_kind :: Type
</span><a href="#local-6989586621681124516"><span class="hs-identifier hs-var hs-var">res_kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Type
</span><a href="GHC.Core.TyCon.html#tyConResKind"><span class="hs-identifier hs-var hs-var">tyConResKind</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124528"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-1683"></span><span>             </span><span id="local-6989586621681124514"><span class="annot"><span class="annottext">resVar :: Maybe Name
</span><a href="#local-6989586621681124514"><span class="hs-identifier hs-var hs-var">resVar</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Maybe Name
</span><a href="GHC.Core.TyCon.html#famTcResVar"><span class="hs-identifier hs-var hs-var">famTcResVar</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124528"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-1684"></span><span>
</span><span id="line-1685"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681124512"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124512"><span class="hs-identifier hs-var">kind'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyKind"><span class="hs-identifier hs-var">reifyKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124516"><span class="hs-identifier hs-var">res_kind</span></a></span><span>
</span><span id="line-1686"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681124510"><span class="annot"><span class="annottext">FamilyResultSig
</span><a href="#local-6989586621681124510"><span class="hs-identifier hs-var">resultSig</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681124509"><span class="annot"><span class="annottext">Maybe InjectivityAnn
</span><a href="#local-6989586621681124509"><span class="hs-identifier hs-var">injectivity</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1687"></span><span>                 </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe Name
</span><a href="#local-6989586621681124514"><span class="hs-identifier hs-var">resVar</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1688"></span><span>                   </span><span class="annot"><span class="annottext">Maybe Name
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; FamilyResultSig
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#KindSig"><span class="hs-identifier hs-var">TH.KindSig</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124512"><span class="hs-identifier hs-var">kind'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe InjectivityAnn
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1689"></span><span>                   </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681124507"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124507"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1690"></span><span>                     </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681124506"><span class="annot"><span class="annottext">thName :: Name
</span><a href="#local-6989586621681124506"><span class="hs-identifier hs-var hs-var">thName</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124507"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-1691"></span><span>                         </span><span id="local-6989586621681124505"><span class="annot"><span class="annottext">injAnnot :: Injectivity
</span><a href="#local-6989586621681124505"><span class="hs-identifier hs-var hs-var">injAnnot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Injectivity
</span><a href="GHC.Core.TyCon.html#tyConInjectivityInfo"><span class="hs-identifier hs-var">tyConInjectivityInfo</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124528"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-1692"></span><span>                         </span><span id="local-6989586621681124503"><span class="annot"><span class="annottext">sig :: FamilyResultSig
</span><a href="#local-6989586621681124503"><span class="hs-identifier hs-var hs-var">sig</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyVarBndr () -&gt; FamilyResultSig
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#TyVarSig"><span class="hs-identifier hs-var">TH.TyVarSig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; () -&gt; Type -&gt; TyVarBndr ()
forall flag. Name -&gt; flag -&gt; Type -&gt; TyVarBndr flag
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#KindedTV"><span class="hs-identifier hs-var">TH.KindedTV</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124506"><span class="hs-identifier hs-var">thName</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124512"><span class="hs-identifier hs-var">kind'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1693"></span><span>                         </span><span id="local-6989586621681124500"><span class="annot"><span class="annottext">inj :: Maybe InjectivityAnn
</span><a href="#local-6989586621681124500"><span class="hs-identifier hs-var hs-var">inj</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Injectivity
</span><a href="#local-6989586621681124505"><span class="hs-identifier hs-var">injAnnot</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1694"></span><span>                                 </span><span class="annot"><span class="annottext">Injectivity
</span><a href="GHC.Core.TyCon.html#NotInjective"><span class="hs-identifier hs-var">NotInjective</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe InjectivityAnn
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1695"></span><span>                                 </span><span class="annot"><a href="GHC.Core.TyCon.html#Injective"><span class="hs-identifier hs-type">Injective</span></a></span><span> </span><span id="local-6989586621681124497"><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621681124497"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1696"></span><span>                                     </span><span class="annot"><span class="annottext">InjectivityAnn -&gt; Maybe InjectivityAnn
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; [Name] -&gt; InjectivityAnn
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#InjectivityAnn"><span class="hs-identifier hs-var">TH.InjectivityAnn</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124506"><span class="hs-identifier hs-var">thName</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621681124495"><span class="hs-identifier hs-var">injRHS</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1697"></span><span>                                   </span><span class="hs-keyword">where</span><span>
</span><span id="line-1698"></span><span>                                     </span><span id="local-6989586621681124495"><span class="annot"><span class="annottext">injRHS :: [Name]
</span><a href="#local-6989586621681124495"><span class="hs-identifier hs-var hs-var">injRHS</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Id -&gt; Name) -&gt; [Id] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Name) -&gt; (Id -&gt; Name) -&gt; Id -&gt; Name
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Name
</span><a href="GHC.Types.Var.html#tyVarName"><span class="hs-identifier hs-var">tyVarName</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1699"></span><span>                                                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Bool] -&gt; [Id] -&gt; [Id]
forall a. [Bool] -&gt; [a] -&gt; [a]
</span><a href="GHC.Utils.Misc.html#filterByList"><span class="hs-identifier hs-var">filterByList</span></a></span><span> </span><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621681124497"><span class="hs-identifier hs-var">ms</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681124518"><span class="hs-identifier hs-var">tvs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1700"></span><span>                     </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FamilyResultSig
</span><a href="#local-6989586621681124503"><span class="hs-identifier hs-var">sig</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe InjectivityAnn
</span><a href="#local-6989586621681124500"><span class="hs-identifier hs-var">inj</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1701"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681124492"><span class="annot"><span class="annottext">[TyVarBndr ()]
</span><a href="#local-6989586621681124492"><span class="hs-identifier hs-var">tvs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; TcM [TyVarBndr ()]
</span><a href="GHC.Tc.Gen.Splice.html#reifyTyVars"><span class="hs-identifier hs-var">reifyTyVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Id]
</span><a href="GHC.Core.TyCon.html#tyConVisibleTyVars"><span class="hs-identifier hs-var">tyConVisibleTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124528"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1702"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681124490"><span class="annot"><span class="annottext">tfHead :: TypeFamilyHead
</span><a href="#local-6989586621681124490"><span class="hs-identifier hs-var hs-var">tfHead</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1703"></span><span>               </span><span class="annot"><span class="annottext">Name
-&gt; [TyVarBndr ()]
-&gt; FamilyResultSig
-&gt; Maybe InjectivityAnn
-&gt; TypeFamilyHead
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#TypeFamilyHead"><span class="hs-identifier hs-var">TH.TypeFamilyHead</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124528"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TyVarBndr ()]
</span><a href="#local-6989586621681124492"><span class="hs-identifier hs-var">tvs'</span></a></span><span> </span><span class="annot"><span class="annottext">FamilyResultSig
</span><a href="#local-6989586621681124510"><span class="hs-identifier hs-var">resultSig</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe InjectivityAnn
</span><a href="#local-6989586621681124509"><span class="hs-identifier hs-var">injectivity</span></a></span><span>
</span><span id="line-1704"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isOpenTypeFamilyTyCon"><span class="hs-identifier hs-var">isOpenTypeFamilyTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124528"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-1705"></span><span>         </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681124487"><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621681124487"><span class="hs-identifier hs-var">fam_envs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM FamInstEnvs
</span><a href="GHC.Tc.Instance.Family.html#tcGetFamInstEnvs"><span class="hs-identifier hs-var">tcGetFamInstEnvs</span></a></span><span>
</span><span id="line-1706"></span><span>                 </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681124486"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621681124486"><span class="hs-identifier hs-var">instances</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [FamInst] -&gt; TcM [Dec]
</span><a href="GHC.Tc.Gen.Splice.html#reifyFamilyInstances"><span class="hs-identifier hs-var">reifyFamilyInstances</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124528"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-1707"></span><span>                                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FamInstEnvs -&gt; TyCon -&gt; [FamInst]
</span><a href="GHC.Core.FamInstEnv.html#familyInstances"><span class="hs-identifier hs-var">familyInstances</span></a></span><span> </span><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621681124487"><span class="hs-identifier hs-var">fam_envs</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124528"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1708"></span><span>                 </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Info -&gt; TcM Info
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dec -&gt; [Dec] -&gt; Info
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#FamilyI"><span class="hs-identifier hs-var">TH.FamilyI</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeFamilyHead -&gt; Dec
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#OpenTypeFamilyD"><span class="hs-identifier hs-var">TH.OpenTypeFamilyD</span></a></span><span> </span><span class="annot"><span class="annottext">TypeFamilyHead
</span><a href="#local-6989586621681124490"><span class="hs-identifier hs-var">tfHead</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621681124486"><span class="hs-identifier hs-var">instances</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1709"></span><span>         </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681124482"><span class="annot"><span class="annottext">[TySynEqn]
</span><a href="#local-6989586621681124482"><span class="hs-identifier hs-var">eqns</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1710"></span><span>                     </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Maybe (CoAxiom Branched)
</span><a href="GHC.Core.TyCon.html#isClosedSynFamilyTyConWithAxiom_maybe"><span class="hs-identifier hs-var">isClosedSynFamilyTyConWithAxiom_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124528"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1711"></span><span>                       </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681124480"><span class="annot"><span class="annottext">CoAxiom Branched
</span><a href="#local-6989586621681124480"><span class="hs-identifier hs-var">ax</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(CoAxBranch -&gt; TcM TySynEqn)
-&gt; [CoAxBranch] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [TySynEqn]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; CoAxBranch -&gt; TcM TySynEqn
</span><a href="GHC.Tc.Gen.Splice.html#reifyAxBranch"><span class="hs-identifier hs-var">reifyAxBranch</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124528"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([CoAxBranch] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [TySynEqn])
-&gt; [CoAxBranch] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [TySynEqn]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1712"></span><span>                                  </span><span class="annot"><span class="annottext">Branches Branched -&gt; [CoAxBranch]
forall (br :: BranchFlag). Branches br -&gt; [CoAxBranch]
</span><a href="GHC.Core.Coercion.Axiom.html#fromBranches"><span class="hs-identifier hs-var">fromBranches</span></a></span><span> </span><span class="annot"><span class="annottext">(Branches Branched -&gt; [CoAxBranch])
-&gt; Branches Branched -&gt; [CoAxBranch]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiom Branched -&gt; Branches Branched
forall (br :: BranchFlag). CoAxiom br -&gt; Branches br
</span><a href="GHC.Core.Coercion.Axiom.html#coAxiomBranches"><span class="hs-identifier hs-var">coAxiomBranches</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiom Branched
</span><a href="#local-6989586621681124480"><span class="hs-identifier hs-var">ax</span></a></span><span>
</span><span id="line-1713"></span><span>                       </span><span class="annot"><span class="annottext">Maybe (CoAxiom Branched)
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[TySynEqn] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [TySynEqn]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1714"></span><span>                 </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Info -&gt; TcM Info
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dec -&gt; [Dec] -&gt; Info
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#FamilyI"><span class="hs-identifier hs-var">TH.FamilyI</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TypeFamilyHead -&gt; [TySynEqn] -&gt; Dec
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#ClosedTypeFamilyD"><span class="hs-identifier hs-var">TH.ClosedTypeFamilyD</span></a></span><span> </span><span class="annot"><span class="annottext">TypeFamilyHead
</span><a href="#local-6989586621681124490"><span class="hs-identifier hs-var">tfHead</span></a></span><span> </span><span class="annot"><span class="annottext">[TySynEqn]
</span><a href="#local-6989586621681124482"><span class="hs-identifier hs-var">eqns</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1715"></span><span>                      </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1716"></span><span>
</span><span id="line-1717"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isDataFamilyTyCon"><span class="hs-identifier hs-var">isDataFamilyTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124528"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-1718"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681124475"><span class="annot"><span class="annottext">res_kind :: Type
</span><a href="#local-6989586621681124475"><span class="hs-identifier hs-var hs-var">res_kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Type
</span><a href="GHC.Core.TyCon.html#tyConResKind"><span class="hs-identifier hs-var hs-var">tyConResKind</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124528"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-1719"></span><span>
</span><span id="line-1720"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681124474"><span class="annot"><span class="annottext">Maybe Type
</span><a href="#local-6989586621681124474"><span class="hs-identifier hs-var">kind'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Maybe Type)
-&gt; TcM Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe Type)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe Type
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyKind"><span class="hs-identifier hs-var">reifyKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124475"><span class="hs-identifier hs-var">res_kind</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1721"></span><span>
</span><span id="line-1722"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681124473"><span class="annot"><span class="annottext">[TyVarBndr ()]
</span><a href="#local-6989586621681124473"><span class="hs-identifier hs-var">tvs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; TcM [TyVarBndr ()]
</span><a href="GHC.Tc.Gen.Splice.html#reifyTyVars"><span class="hs-identifier hs-var">reifyTyVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Id]
</span><a href="GHC.Core.TyCon.html#tyConVisibleTyVars"><span class="hs-identifier hs-var">tyConVisibleTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124528"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1723"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681124472"><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621681124472"><span class="hs-identifier hs-var">fam_envs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM FamInstEnvs
</span><a href="GHC.Tc.Instance.Family.html#tcGetFamInstEnvs"><span class="hs-identifier hs-var">tcGetFamInstEnvs</span></a></span><span>
</span><span id="line-1724"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681124471"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621681124471"><span class="hs-identifier hs-var">instances</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [FamInst] -&gt; TcM [Dec]
</span><a href="GHC.Tc.Gen.Splice.html#reifyFamilyInstances"><span class="hs-identifier hs-var">reifyFamilyInstances</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124528"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FamInstEnvs -&gt; TyCon -&gt; [FamInst]
</span><a href="GHC.Core.FamInstEnv.html#familyInstances"><span class="hs-identifier hs-var">familyInstances</span></a></span><span> </span><span class="annot"><span class="annottext">FamInstEnvs
</span><a href="#local-6989586621681124472"><span class="hs-identifier hs-var">fam_envs</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124528"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1725"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Info -&gt; TcM Info
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dec -&gt; [Dec] -&gt; Info
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#FamilyI"><span class="hs-identifier hs-var">TH.FamilyI</span></a></span><span>
</span><span id="line-1726"></span><span>                       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; [TyVarBndr ()] -&gt; Maybe Type -&gt; Dec
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#DataFamilyD"><span class="hs-identifier hs-var">TH.DataFamilyD</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124528"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TyVarBndr ()]
</span><a href="#local-6989586621681124473"><span class="hs-identifier hs-var">tvs'</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Type
</span><a href="#local-6989586621681124474"><span class="hs-identifier hs-var">kind'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621681124471"><span class="hs-identifier hs-var">instances</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1727"></span><span>
</span><span id="line-1728"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681124469"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124469"><span class="hs-identifier hs-var">rhs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Maybe ([Id], Type)
</span><a href="GHC.Core.TyCon.html#synTyConDefn_maybe"><span class="hs-identifier hs-var">synTyConDefn_maybe</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124528"><span class="hs-identifier hs-var">tc</span></a></span><span>  </span><span class="hs-comment">-- Vanilla type synonym</span><span>
</span><span id="line-1729"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681124467"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124467"><span class="hs-identifier hs-var">rhs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124469"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-1730"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681124466"><span class="annot"><span class="annottext">[TyVarBndr ()]
</span><a href="#local-6989586621681124466"><span class="hs-identifier hs-var">tvs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; TcM [TyVarBndr ()]
</span><a href="GHC.Tc.Gen.Splice.html#reifyTyVars"><span class="hs-identifier hs-var">reifyTyVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Id]
</span><a href="GHC.Core.TyCon.html#tyConVisibleTyVars"><span class="hs-identifier hs-var">tyConVisibleTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124528"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1731"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Info -&gt; TcM Info
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dec -&gt; Info
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#TyConI"><span class="hs-identifier hs-var">TH.TyConI</span></a></span><span>
</span><span id="line-1732"></span><span>                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; [TyVarBndr ()] -&gt; Type -&gt; Dec
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#TySynD"><span class="hs-identifier hs-var">TH.TySynD</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124528"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TyVarBndr ()]
</span><a href="#local-6989586621681124466"><span class="hs-identifier hs-var">tvs'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124467"><span class="hs-identifier hs-var">rhs'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1733"></span><span>       </span><span class="hs-special">}</span><span>
</span><span id="line-1734"></span><span>
</span><span id="line-1735"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1736"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681124463"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124463"><span class="hs-identifier hs-var">cxt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; TcM [Type]
</span><a href="GHC.Tc.Gen.Splice.html#reifyCxt"><span class="hs-identifier hs-var">reifyCxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Type]
</span><a href="GHC.Core.TyCon.html#tyConStupidTheta"><span class="hs-identifier hs-var">tyConStupidTheta</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124528"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1737"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681124460"><span class="annot"><span class="annottext">tvs :: [Id]
</span><a href="#local-6989586621681124460"><span class="hs-identifier hs-var hs-var">tvs</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Id]
</span><a href="GHC.Core.TyCon.html#tyConTyVars"><span class="hs-identifier hs-var hs-var">tyConTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124528"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-1738"></span><span>              </span><span id="local-6989586621681124459"><span class="annot"><span class="annottext">dataCons :: [DataCon]
</span><a href="#local-6989586621681124459"><span class="hs-identifier hs-var hs-var">dataCons</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [DataCon]
</span><a href="GHC.Core.TyCon.html#tyConDataCons"><span class="hs-identifier hs-var">tyConDataCons</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124528"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-1739"></span><span>              </span><span id="local-6989586621681124457"><span class="annot"><span class="annottext">isGadt :: Bool
</span><a href="#local-6989586621681124457"><span class="hs-identifier hs-var hs-var">isGadt</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isGadtSyntaxTyCon"><span class="hs-identifier hs-var">isGadtSyntaxTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124528"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-1740"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681124455"><span class="annot"><span class="annottext">[Con]
</span><a href="#local-6989586621681124455"><span class="hs-identifier hs-var">cons</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(DataCon -&gt; IOEnv (Env TcGblEnv TcLclEnv) Con)
-&gt; [DataCon] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [Con]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; [Type] -&gt; DataCon -&gt; IOEnv (Env TcGblEnv TcLclEnv) Con
</span><a href="GHC.Tc.Gen.Splice.html#reifyDataCon"><span class="hs-identifier hs-var">reifyDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681124457"><span class="hs-identifier hs-var">isGadt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; [Type]
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681124460"><span class="hs-identifier hs-var">tvs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[DataCon]
</span><a href="#local-6989586621681124459"><span class="hs-identifier hs-var">dataCons</span></a></span><span>
</span><span id="line-1741"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681124452"><span class="annot"><span class="annottext">[TyVarBndr ()]
</span><a href="#local-6989586621681124452"><span class="hs-identifier hs-var">r_tvs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; TcM [TyVarBndr ()]
</span><a href="GHC.Tc.Gen.Splice.html#reifyTyVars"><span class="hs-identifier hs-var">reifyTyVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Id]
</span><a href="GHC.Core.TyCon.html#tyConVisibleTyVars"><span class="hs-identifier hs-var">tyConVisibleTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124528"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1742"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681124451"><span class="annot"><span class="annottext">name :: Name
</span><a href="#local-6989586621681124451"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124528"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-1743"></span><span>              </span><span id="local-6989586621681124450"><span class="annot"><span class="annottext">deriv :: [a]
</span><a href="#local-6989586621681124450"><span class="hs-identifier hs-var hs-var">deriv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>        </span><span class="hs-comment">-- Don't know about deriving</span><span>
</span><span id="line-1744"></span><span>              </span><span id="local-6989586621681124449"><span class="annot"><span class="annottext">decl :: Dec
</span><a href="#local-6989586621681124449"><span class="hs-identifier hs-var hs-var">decl</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isNewTyCon"><span class="hs-identifier hs-var">isNewTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124528"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1745"></span><span>                       </span><span class="annot"><span class="annottext">[Type]
-&gt; Name
-&gt; [TyVarBndr ()]
-&gt; Maybe Type
-&gt; Con
-&gt; [DerivClause]
-&gt; Dec
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#NewtypeD"><span class="hs-identifier hs-var">TH.NewtypeD</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124463"><span class="hs-identifier hs-var">cxt</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124451"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndr ()]
</span><a href="#local-6989586621681124452"><span class="hs-identifier hs-var">r_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Type
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Con] -&gt; Con
forall a. [a] -&gt; a
</span><a href="../../base/src/GHC.List.html#head"><span class="hs-identifier hs-var">head</span></a></span><span> </span><span class="annot"><span class="annottext">[Con]
</span><a href="#local-6989586621681124455"><span class="hs-identifier hs-var">cons</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[DerivClause]
forall a. [a]
</span><a href="#local-6989586621681124450"><span class="hs-identifier hs-var">deriv</span></a></span><span>
</span><span id="line-1746"></span><span>                   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>     </span><span class="hs-glyph">=</span><span>
</span><span id="line-1747"></span><span>                       </span><span class="annot"><span class="annottext">[Type]
-&gt; Name
-&gt; [TyVarBndr ()]
-&gt; Maybe Type
-&gt; [Con]
-&gt; [DerivClause]
-&gt; Dec
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#DataD"><span class="hs-identifier hs-var">TH.DataD</span></a></span><span>    </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124463"><span class="hs-identifier hs-var">cxt</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124451"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndr ()]
</span><a href="#local-6989586621681124452"><span class="hs-identifier hs-var">r_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Type
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>       </span><span class="annot"><span class="annottext">[Con]
</span><a href="#local-6989586621681124455"><span class="hs-identifier hs-var">cons</span></a></span><span>  </span><span class="annot"><span class="annottext">[DerivClause]
forall a. [a]
</span><a href="#local-6989586621681124450"><span class="hs-identifier hs-var">deriv</span></a></span><span>
</span><span id="line-1748"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Info -&gt; TcM Info
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dec -&gt; Info
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#TyConI"><span class="hs-identifier hs-var">TH.TyConI</span></a></span><span> </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621681124449"><span class="hs-identifier hs-var">decl</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1749"></span><span>
</span><span id="line-1750"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyDataCon"><span class="hs-identifier hs-type">reifyDataCon</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#DataCon"><span class="hs-identifier hs-type">DataCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Con"><span class="hs-identifier hs-type">TH.Con</span></a></span><span>
</span><span id="line-1751"></span><span id="reifyDataCon"><span class="annot"><span class="annottext">reifyDataCon :: Bool -&gt; [Type] -&gt; DataCon -&gt; IOEnv (Env TcGblEnv TcLclEnv) Con
</span><a href="GHC.Tc.Gen.Splice.html#reifyDataCon"><span class="hs-identifier hs-var hs-var">reifyDataCon</span></a></span></span><span> </span><span id="local-6989586621681124444"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681124444"><span class="hs-identifier hs-var">isGadtDataCon</span></a></span></span><span> </span><span id="local-6989586621681124443"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124443"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span id="local-6989586621681124442"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681124442"><span class="hs-identifier hs-var">dc</span></a></span></span><span>
</span><span id="line-1752"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- used for H98 data constructors</span><span>
</span><span id="line-1753"></span><span>             </span><span class="hs-special">(</span><span id="local-6989586621681124441"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681124441"><span class="hs-identifier hs-var">ex_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681124440"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124440"><span class="hs-identifier hs-var">theta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681124439"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124439"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1754"></span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; [Type] -&gt; ([Id], [Type], [Type])
</span><a href="GHC.Core.DataCon.html#dataConInstSig"><span class="hs-identifier hs-var">dataConInstSig</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681124442"><span class="hs-identifier hs-var">dc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124443"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-1755"></span><span>             </span><span class="hs-comment">-- used for GADTs data constructors</span><span>
</span><span id="line-1756"></span><span>             </span><span id="local-6989586621681124437"><span class="annot"><span class="annottext">g_user_tvs' :: [InvisTVBinder]
</span><a href="#local-6989586621681124437"><span class="hs-identifier hs-var hs-var">g_user_tvs'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; [InvisTVBinder]
</span><a href="GHC.Core.DataCon.html#dataConUserTyVarBinders"><span class="hs-identifier hs-var">dataConUserTyVarBinders</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681124442"><span class="hs-identifier hs-var">dc</span></a></span><span>
</span><span id="line-1757"></span><span>             </span><span class="hs-special">(</span><span id="local-6989586621681124435"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681124435"><span class="hs-identifier hs-var">g_univ_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Id]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681124434"><span class="annot"><span class="annottext">[EqSpec]
</span><a href="#local-6989586621681124434"><span class="hs-identifier hs-var">g_eq_spec</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681124433"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124433"><span class="hs-identifier hs-var">g_theta'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681124432"><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621681124432"><span class="hs-identifier hs-var">g_arg_tys'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681124431"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124431"><span class="hs-identifier hs-var">g_res_ty'</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1758"></span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; ([Id], [Id], [EqSpec], [Type], [Scaled Type], Type)
</span><a href="GHC.Core.DataCon.html#dataConFullSig"><span class="hs-identifier hs-var">dataConFullSig</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681124442"><span class="hs-identifier hs-var">dc</span></a></span><span>
</span><span id="line-1759"></span><span>             </span><span class="hs-special">(</span><span id="local-6989586621681124429"><span class="annot"><span class="annottext">[SourceUnpackedness]
</span><a href="#local-6989586621681124429"><span class="hs-identifier hs-var">srcUnpks</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681124428"><span class="annot"><span class="annottext">[SourceStrictness]
</span><a href="#local-6989586621681124428"><span class="hs-identifier hs-var">srcStricts</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1760"></span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HsSrcBang -&gt; (SourceUnpackedness, SourceStrictness))
-&gt; [HsSrcBang] -&gt; ([SourceUnpackedness], [SourceStrictness])
forall a b c. (a -&gt; (b, c)) -&gt; [a] -&gt; ([b], [c])
</span><a href="GHC.Utils.Misc.html#mapAndUnzip"><span class="hs-identifier hs-var">mapAndUnzip</span></a></span><span> </span><span class="annot"><span class="annottext">HsSrcBang -&gt; (SourceUnpackedness, SourceStrictness)
</span><a href="GHC.Tc.Gen.Splice.html#reifySourceBang"><span class="hs-identifier hs-var">reifySourceBang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; [HsSrcBang]
</span><a href="GHC.Core.DataCon.html#dataConSrcBangs"><span class="hs-identifier hs-var">dataConSrcBangs</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681124442"><span class="hs-identifier hs-var">dc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1761"></span><span>             </span><span id="local-6989586621681124424"><span class="annot"><span class="annottext">dcdBangs :: [Bang]
</span><a href="#local-6989586621681124424"><span class="hs-identifier hs-var hs-var">dcdBangs</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SourceUnpackedness -&gt; SourceStrictness -&gt; Bang)
-&gt; [SourceUnpackedness] -&gt; [SourceStrictness] -&gt; [Bang]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><a href="../../base/src/GHC.List.html#zipWith"><span class="hs-identifier hs-var">zipWith</span></a></span><span> </span><span class="annot"><span class="annottext">SourceUnpackedness -&gt; SourceStrictness -&gt; Bang
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Bang"><span class="hs-identifier hs-var">TH.Bang</span></a></span><span> </span><span class="annot"><span class="annottext">[SourceUnpackedness]
</span><a href="#local-6989586621681124429"><span class="hs-identifier hs-var">srcUnpks</span></a></span><span> </span><span class="annot"><span class="annottext">[SourceStrictness]
</span><a href="#local-6989586621681124428"><span class="hs-identifier hs-var">srcStricts</span></a></span><span>
</span><span id="line-1762"></span><span>             </span><span id="local-6989586621681124421"><span class="annot"><span class="annottext">fields :: [FieldLabel]
</span><a href="#local-6989586621681124421"><span class="hs-identifier hs-var hs-var">fields</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; [FieldLabel]
</span><a href="GHC.Core.DataCon.html#dataConFieldLabels"><span class="hs-identifier hs-var">dataConFieldLabels</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681124442"><span class="hs-identifier hs-var">dc</span></a></span><span>
</span><span id="line-1763"></span><span>             </span><span id="local-6989586621681124419"><span class="annot"><span class="annottext">name :: Name
</span><a href="#local-6989586621681124419"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681124442"><span class="hs-identifier hs-var">dc</span></a></span><span>
</span><span id="line-1764"></span><span>             </span><span class="hs-comment">-- Universal tvs present in eq_spec need to be filtered out, as</span><span>
</span><span id="line-1765"></span><span>             </span><span class="hs-comment">-- they will not appear anywhere in the type.</span><span>
</span><span id="line-1766"></span><span>             </span><span id="local-6989586621681124418"><span class="annot"><span class="annottext">eq_spec_tvs :: VarSet
</span><a href="#local-6989586621681124418"><span class="hs-identifier hs-var hs-var">eq_spec_tvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#mkVarSet"><span class="hs-identifier hs-var">mkVarSet</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(EqSpec -&gt; Id) -&gt; [EqSpec] -&gt; [Id]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">EqSpec -&gt; Id
</span><a href="GHC.Core.DataCon.html#eqSpecTyVar"><span class="hs-identifier hs-var">eqSpecTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">[EqSpec]
</span><a href="#local-6989586621681124434"><span class="hs-identifier hs-var">g_eq_spec</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1767"></span><span>
</span><span id="line-1768"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681124415"><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681124415"><span class="hs-identifier hs-var">univ_subst</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Id]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-1769"></span><span>              </span><span class="hs-comment">-- See Note [Freshen reified GADT constructors' universal tyvars]</span><span>
</span><span id="line-1770"></span><span>           </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; TcM (TCvSubst, [Id])
</span><a href="GHC.Tc.Utils.Instantiate.html#freshenTyVarBndrs"><span class="hs-identifier hs-var">freshenTyVarBndrs</span></a></span><span> </span><span class="annot"><span class="annottext">([Id] -&gt; TcM (TCvSubst, [Id])) -&gt; [Id] -&gt; TcM (TCvSubst, [Id])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1771"></span><span>              </span><span class="annot"><span class="annottext">(Id -&gt; Bool) -&gt; [Id] -&gt; [Id]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="GHC.Utils.Misc.html#filterOut"><span class="hs-identifier hs-var">filterOut</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; VarSet -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#elemVarSet"><span class="hs-operator hs-var">`elemVarSet`</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet
</span><a href="#local-6989586621681124418"><span class="hs-identifier hs-var">eq_spec_tvs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681124435"><span class="hs-identifier hs-var">g_univ_tvs</span></a></span><span>
</span><span id="line-1772"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681124411"><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681124411"><span class="hs-identifier hs-var">tvb_subst</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681124410"><span class="annot"><span class="annottext">[InvisTVBinder]
</span><a href="#local-6989586621681124410"><span class="hs-identifier hs-var">g_user_tvs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TCvSubst -&gt; [InvisTVBinder] -&gt; (TCvSubst, [InvisTVBinder])
forall {argf}.
TCvSubst -&gt; [VarBndr Id argf] -&gt; (TCvSubst, [VarBndr Id argf])
</span><a href="#local-6989586621681124409"><span class="hs-identifier hs-var">subst_tv_binders</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681124415"><span class="hs-identifier hs-var">univ_subst</span></a></span><span> </span><span class="annot"><span class="annottext">[InvisTVBinder]
</span><a href="#local-6989586621681124437"><span class="hs-identifier hs-var">g_user_tvs'</span></a></span><span>
</span><span id="line-1773"></span><span>             </span><span id="local-6989586621681124408"><span class="annot"><span class="annottext">g_theta :: [Type]
</span><a href="#local-6989586621681124408"><span class="hs-identifier hs-var hs-var">g_theta</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; TCvSubst -&gt; [Type] -&gt; [Type]
TCvSubst -&gt; [Type] -&gt; [Type]
</span><a href="GHC.Core.TyCo.Subst.html#substTys"><span class="hs-identifier hs-var">substTys</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681124411"><span class="hs-identifier hs-var">tvb_subst</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124433"><span class="hs-identifier hs-var">g_theta'</span></a></span><span>
</span><span id="line-1774"></span><span>             </span><span id="local-6989586621681124406"><span class="annot"><span class="annottext">g_arg_tys :: [Type]
</span><a href="#local-6989586621681124406"><span class="hs-identifier hs-var hs-var">g_arg_tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; TCvSubst -&gt; [Type] -&gt; [Type]
TCvSubst -&gt; [Type] -&gt; [Type]
</span><a href="GHC.Core.TyCo.Subst.html#substTys"><span class="hs-identifier hs-var">substTys</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681124411"><span class="hs-identifier hs-var">tvb_subst</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Scaled Type -&gt; Type) -&gt; [Scaled Type] -&gt; [Type]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Scaled Type -&gt; Type
forall a. Scaled a -&gt; a
</span><a href="GHC.Core.TyCo.Rep.html#scaledThing"><span class="hs-identifier hs-var">scaledThing</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621681124432"><span class="hs-identifier hs-var">g_arg_tys'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1775"></span><span>             </span><span id="local-6989586621681124404"><span class="annot"><span class="annottext">g_res_ty :: Type
</span><a href="#local-6989586621681124404"><span class="hs-identifier hs-var hs-var">g_res_ty</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; TCvSubst -&gt; Type -&gt; Type
TCvSubst -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Subst.html#substTy"><span class="hs-identifier hs-var">substTy</span></a></span><span>  </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681124411"><span class="hs-identifier hs-var">tvb_subst</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124431"><span class="hs-identifier hs-var">g_res_ty'</span></a></span><span>
</span><span id="line-1776"></span><span>
</span><span id="line-1777"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681124402"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124402"><span class="hs-identifier hs-var">r_arg_tys</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; TcM [Type]
</span><a href="GHC.Tc.Gen.Splice.html#reifyTypes"><span class="hs-identifier hs-var">reifyTypes</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681124444"><span class="hs-identifier hs-var">isGadtDataCon</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124406"><span class="hs-identifier hs-var">g_arg_tys</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124439"><span class="hs-identifier hs-var">arg_tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1778"></span><span>
</span><span id="line-1779"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681124401"><span class="annot"><span class="annottext">Con
</span><a href="#local-6989586621681124401"><span class="hs-identifier hs-var">main_con</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1780"></span><span>           </span><span class="hs-keyword">if</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FieldLabel] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldLabel]
</span><a href="#local-6989586621681124421"><span class="hs-identifier hs-var">fields</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681124444"><span class="hs-identifier hs-var">isGadtDataCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1781"></span><span>                  </span><span class="annot"><span class="annottext">Con -&gt; IOEnv (Env TcGblEnv TcLclEnv) Con
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Con -&gt; IOEnv (Env TcGblEnv TcLclEnv) Con)
-&gt; Con -&gt; IOEnv (Env TcGblEnv TcLclEnv) Con
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; [VarBangType] -&gt; Con
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#RecC"><span class="hs-identifier hs-var">TH.RecC</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124419"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Name] -&gt; [Bang] -&gt; [Type] -&gt; [VarBangType]
forall a b c. [a] -&gt; [b] -&gt; [c] -&gt; [(a, b, c)]
</span><a href="../../base/src/GHC.List.html#zip3"><span class="hs-identifier hs-var">zip3</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(FieldLabel -&gt; Name) -&gt; [FieldLabel] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabel -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyFieldLabel"><span class="hs-identifier hs-var">reifyFieldLabel</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldLabel]
</span><a href="#local-6989586621681124421"><span class="hs-identifier hs-var">fields</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1782"></span><span>                                         </span><span class="annot"><span class="annottext">[Bang]
</span><a href="#local-6989586621681124424"><span class="hs-identifier hs-var">dcdBangs</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124402"><span class="hs-identifier hs-var">r_arg_tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1783"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[FieldLabel] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[FieldLabel]
</span><a href="#local-6989586621681124421"><span class="hs-identifier hs-var">fields</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1784"></span><span>                  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681124397"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124397"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124404"><span class="hs-identifier hs-var">g_res_ty</span></a></span><span>
</span><span id="line-1785"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Con -&gt; IOEnv (Env TcGblEnv TcLclEnv) Con
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Con -&gt; IOEnv (Env TcGblEnv TcLclEnv) Con)
-&gt; Con -&gt; IOEnv (Env TcGblEnv TcLclEnv) Con
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; [VarBangType] -&gt; Type -&gt; Con
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#RecGadtC"><span class="hs-identifier hs-var">TH.RecGadtC</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124419"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1786"></span><span>                                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Name] -&gt; [Bang] -&gt; [Type] -&gt; [VarBangType]
forall a b c. [a] -&gt; [b] -&gt; [c] -&gt; [(a, b, c)]
</span><a href="../../base/src/GHC.List.html#zip3"><span class="hs-identifier hs-var">zip3</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(FieldLabel -&gt; Name) -&gt; [FieldLabel] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Name) -&gt; (FieldLabel -&gt; Name) -&gt; FieldLabel -&gt; Name
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabel -&gt; Name
forall a. FieldLbl a -&gt; a
</span><a href="GHC.Types.FieldLabel.html#flSelector"><span class="hs-identifier hs-var hs-var">flSelector</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[FieldLabel]
</span><a href="#local-6989586621681124421"><span class="hs-identifier hs-var">fields</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1787"></span><span>                                      </span><span class="annot"><span class="annottext">[Bang]
</span><a href="#local-6989586621681124424"><span class="hs-identifier hs-var">dcdBangs</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124402"><span class="hs-identifier hs-var">r_arg_tys</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124397"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1788"></span><span>                </span><span class="hs-comment">-- We need to check not isGadtDataCon here because GADT</span><span>
</span><span id="line-1789"></span><span>                </span><span class="hs-comment">-- constructors can be declared infix.</span><span>
</span><span id="line-1790"></span><span>                </span><span class="hs-comment">-- See Note [Infix GADT constructors] in GHC.Tc.TyCl.</span><span>
</span><span id="line-1791"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DataCon -&gt; Bool
</span><a href="GHC.Core.DataCon.html#dataConIsInfix"><span class="hs-identifier hs-var">dataConIsInfix</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681124442"><span class="hs-identifier hs-var">dc</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681124444"><span class="hs-identifier hs-var">isGadtDataCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1792"></span><span>                  </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">r_arg_tys</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">lengthIs</span><span class="hs-special">`</span><span> </span><span class="hs-number">2</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1793"></span><span>                  </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">r_a1</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">r_a2</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">r_arg_tys</span><span>
</span><span id="line-1794"></span><span>                        </span><span class="hs-special">[</span><span class="hs-identifier">s1</span><span class="hs-special">,</span><span>   </span><span class="hs-identifier">s2</span><span class="hs-special">]</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">dcdBangs</span><span>
</span><span id="line-1795"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">TH.InfixC</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">s1</span><span class="hs-special">,</span><span class="hs-identifier">r_a1</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">name</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">s2</span><span class="hs-special">,</span><span class="hs-identifier">r_a2</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1796"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681124444"><span class="hs-identifier hs-var">isGadtDataCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1797"></span><span>                  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681124387"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124387"><span class="hs-identifier hs-var">res_ty</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124404"><span class="hs-identifier hs-var">g_res_ty</span></a></span><span>
</span><span id="line-1798"></span><span>                  </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Con -&gt; IOEnv (Env TcGblEnv TcLclEnv) Con
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Con -&gt; IOEnv (Env TcGblEnv TcLclEnv) Con)
-&gt; Con -&gt; IOEnv (Env TcGblEnv TcLclEnv) Con
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; [BangType] -&gt; Type -&gt; Con
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#GadtC"><span class="hs-identifier hs-var">TH.GadtC</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124419"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Bang]
</span><a href="#local-6989586621681124424"><span class="hs-identifier hs-var">dcdBangs</span></a></span><span> </span><span class="annot"><span class="annottext">[Bang] -&gt; [Type] -&gt; [BangType]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../../base/src/GHC.List.html#zip"><span class="hs-operator hs-var">`zip`</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124402"><span class="hs-identifier hs-var">r_arg_tys</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124387"><span class="hs-identifier hs-var">res_ty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1799"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1800"></span><span>                  </span><span class="annot"><span class="annottext">Con -&gt; IOEnv (Env TcGblEnv TcLclEnv) Con
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Con -&gt; IOEnv (Env TcGblEnv TcLclEnv) Con)
-&gt; Con -&gt; IOEnv (Env TcGblEnv TcLclEnv) Con
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; [BangType] -&gt; Con
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#NormalC"><span class="hs-identifier hs-var">TH.NormalC</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124419"><span class="hs-identifier hs-var">name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Bang]
</span><a href="#local-6989586621681124424"><span class="hs-identifier hs-var">dcdBangs</span></a></span><span> </span><span class="annot"><span class="annottext">[Bang] -&gt; [Type] -&gt; [BangType]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../../base/src/GHC.List.html#zip"><span class="hs-operator hs-var">`zip`</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124402"><span class="hs-identifier hs-var">r_arg_tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1801"></span><span>
</span><span id="line-1802"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681124384"><span class="annot"><span class="annottext">[InvisTVBinder]
</span><a href="#local-6989586621681124384"><span class="hs-identifier hs-var">ex_tvs'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681124383"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124383"><span class="hs-identifier hs-var">theta'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681124444"><span class="hs-identifier hs-var">isGadtDataCon</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[InvisTVBinder]
</span><a href="#local-6989586621681124410"><span class="hs-identifier hs-var">g_user_tvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124408"><span class="hs-identifier hs-var">g_theta</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1803"></span><span>                               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">all</span><span> </span><span class="hs-identifier">isTyVar</span><span> </span><span class="hs-identifier">ex_tvs</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-1804"></span><span>                                                 </span><span class="hs-comment">-- no covars for haskell syntax</span><span>
</span><span id="line-1805"></span><span>                                                 </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Id -&gt; InvisTVBinder) -&gt; [Id] -&gt; [InvisTVBinder]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; InvisTVBinder
forall {var}. var -&gt; VarBndr var Specificity
</span><a href="#local-6989586621681124380"><span class="hs-identifier hs-var">mk_specified</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681124441"><span class="hs-identifier hs-var">ex_tvs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124440"><span class="hs-identifier hs-var">theta</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1806"></span><span>             </span><span id="local-6989586621681124379"><span class="annot"><span class="annottext">ret_con :: IOEnv (Env TcGblEnv TcLclEnv) Con
</span><a href="#local-6989586621681124379"><span class="hs-identifier hs-var hs-var">ret_con</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[InvisTVBinder] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[InvisTVBinder]
</span><a href="#local-6989586621681124384"><span class="hs-identifier hs-var">ex_tvs'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124383"><span class="hs-identifier hs-var">theta'</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Con -&gt; IOEnv (Env TcGblEnv TcLclEnv) Con
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Con
</span><a href="#local-6989586621681124401"><span class="hs-identifier hs-var">main_con</span></a></span><span>
</span><span id="line-1807"></span><span>                     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1808"></span><span>                         </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681124378"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124378"><span class="hs-identifier hs-var">cxt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; TcM [Type]
</span><a href="GHC.Tc.Gen.Splice.html#reifyCxt"><span class="hs-identifier hs-var">reifyCxt</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124383"><span class="hs-identifier hs-var">theta'</span></a></span><span>
</span><span id="line-1809"></span><span>                         </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681124377"><span class="annot"><span class="annottext">[TyVarBndr Specificity]
</span><a href="#local-6989586621681124377"><span class="hs-identifier hs-var">ex_tvs''</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[InvisTVBinder] -&gt; TcM [TyVarBndr Specificity]
forall flag flag'.
ReifyFlag flag flag' =&gt;
[VarBndr Id flag] -&gt; TcM [TyVarBndr flag']
</span><a href="GHC.Tc.Gen.Splice.html#reifyTyVarBndrs"><span class="hs-identifier hs-var">reifyTyVarBndrs</span></a></span><span> </span><span class="annot"><span class="annottext">[InvisTVBinder]
</span><a href="#local-6989586621681124384"><span class="hs-identifier hs-var">ex_tvs'</span></a></span><span>
</span><span id="line-1810"></span><span>                         </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Con -&gt; IOEnv (Env TcGblEnv TcLclEnv) Con
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[TyVarBndr Specificity] -&gt; [Type] -&gt; Con -&gt; Con
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#ForallC"><span class="hs-identifier hs-var">TH.ForallC</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndr Specificity]
</span><a href="#local-6989586621681124377"><span class="hs-identifier hs-var">ex_tvs''</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124378"><span class="hs-identifier hs-var">cxt</span></a></span><span> </span><span class="annot"><span class="annottext">Con
</span><a href="#local-6989586621681124401"><span class="hs-identifier hs-var">main_con</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1811"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">r_arg_tys</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">equalLength</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">dcdBangs</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-1812"></span><span>         </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) Con
</span><a href="#local-6989586621681124379"><span class="hs-identifier hs-var">ret_con</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1813"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1814"></span><span>    </span><span id="local-6989586621681124380"><span class="annot"><span class="annottext">mk_specified :: var -&gt; VarBndr var Specificity
</span><a href="#local-6989586621681124380"><span class="hs-identifier hs-var hs-var">mk_specified</span></a></span></span><span> </span><span id="local-6989586621681124373"><span class="annot"><span class="annottext">var
</span><a href="#local-6989586621681124373"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">var -&gt; Specificity -&gt; VarBndr var Specificity
forall var argf. var -&gt; argf -&gt; VarBndr var argf
</span><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-var">Bndr</span></a></span><span> </span><span class="annot"><span class="annottext">var
</span><a href="#local-6989586621681124373"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">Specificity
</span><a href="GHC.Types.Var.html#SpecifiedSpec"><span class="hs-identifier hs-var">SpecifiedSpec</span></a></span><span>
</span><span id="line-1815"></span><span>
</span><span id="line-1816"></span><span>    </span><span id="local-6989586621681124409"><span class="annot"><span class="annottext">subst_tv_binders :: TCvSubst -&gt; [VarBndr Id argf] -&gt; (TCvSubst, [VarBndr Id argf])
</span><a href="#local-6989586621681124409"><span class="hs-identifier hs-var hs-var">subst_tv_binders</span></a></span></span><span> </span><span id="local-6989586621681124368"><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681124368"><span class="hs-identifier hs-var">subst</span></a></span></span><span> </span><span id="local-6989586621681124367"><span class="annot"><span class="annottext">[VarBndr Id argf]
</span><a href="#local-6989586621681124367"><span class="hs-identifier hs-var">tv_bndrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1817"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681124366"><span class="annot"><span class="annottext">tvs :: [Id]
</span><a href="#local-6989586621681124366"><span class="hs-identifier hs-var hs-var">tvs</span></a></span></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[VarBndr Id argf] -&gt; [Id]
forall tv argf. [VarBndr tv argf] -&gt; [tv]
</span><a href="GHC.Types.Var.html#binderVars"><span class="hs-identifier hs-var">binderVars</span></a></span><span> </span><span class="annot"><span class="annottext">[VarBndr Id argf]
</span><a href="#local-6989586621681124367"><span class="hs-identifier hs-var">tv_bndrs</span></a></span><span>
</span><span id="line-1818"></span><span>          </span><span id="local-6989586621681124364"><span class="annot"><span class="annottext">flags :: [argf]
</span><a href="#local-6989586621681124364"><span class="hs-identifier hs-var hs-var">flags</span></a></span></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(VarBndr Id argf -&gt; argf) -&gt; [VarBndr Id argf] -&gt; [argf]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">VarBndr Id argf -&gt; argf
forall tv argf. VarBndr tv argf -&gt; argf
</span><a href="GHC.Types.Var.html#binderArgFlag"><span class="hs-identifier hs-var">binderArgFlag</span></a></span><span> </span><span class="annot"><span class="annottext">[VarBndr Id argf]
</span><a href="#local-6989586621681124367"><span class="hs-identifier hs-var">tv_bndrs</span></a></span><span>
</span><span id="line-1819"></span><span>          </span><span class="hs-special">(</span><span id="local-6989586621681124362"><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681124362"><span class="hs-identifier hs-var">subst'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681124361"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681124361"><span class="hs-identifier hs-var">tvs'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasCallStack =&gt; TCvSubst -&gt; [Id] -&gt; (TCvSubst, [Id])
TCvSubst -&gt; [Id] -&gt; (TCvSubst, [Id])
</span><a href="GHC.Core.TyCo.Subst.html#substTyVarBndrs"><span class="hs-identifier hs-var">substTyVarBndrs</span></a></span><span> </span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681124368"><span class="hs-identifier hs-var">subst</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681124366"><span class="hs-identifier hs-var">tvs</span></a></span><span>
</span><span id="line-1820"></span><span>          </span><span id="local-6989586621681124359"><span class="annot"><span class="annottext">tv_bndrs' :: [VarBndr Id argf]
</span><a href="#local-6989586621681124359"><span class="hs-identifier hs-var hs-var">tv_bndrs'</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((Id, argf) -&gt; VarBndr Id argf)
-&gt; [(Id, argf)] -&gt; [VarBndr Id argf]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621681124358"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681124358"><span class="hs-identifier hs-var">tv</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681124357"><span class="annot"><span class="annottext">argf
</span><a href="#local-6989586621681124357"><span class="hs-identifier hs-var">fl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Id -&gt; argf -&gt; VarBndr Id argf
forall var argf. var -&gt; argf -&gt; VarBndr var argf
</span><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-var">Bndr</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681124358"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="annot"><span class="annottext">argf
</span><a href="#local-6989586621681124357"><span class="hs-identifier hs-var">fl</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; [argf] -&gt; [(Id, argf)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../../base/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681124361"><span class="hs-identifier hs-var">tvs'</span></a></span><span> </span><span class="annot"><span class="annottext">[argf]
</span><a href="#local-6989586621681124364"><span class="hs-identifier hs-var">flags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1821"></span><span>      </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TCvSubst
</span><a href="#local-6989586621681124362"><span class="hs-identifier hs-var">subst'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[VarBndr Id argf]
</span><a href="#local-6989586621681124359"><span class="hs-identifier hs-var">tv_bndrs'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1822"></span><span>
</span><span id="line-1823"></span><span class="hs-comment">{-
Note [Freshen reified GADT constructors' universal tyvars]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Suppose one were to reify this GADT:

  data a :~: b where
    Refl :: forall a b. (a ~ b) =&gt; a :~: b

We ought to be careful here about the uniques we give to the occurrences of `a`
and `b` in this definition. That is because in the original DataCon, all uses
of `a` and `b` have the same unique, since `a` and `b` are both universally
quantified type variables--that is, they are used in both the (:~:) tycon as
well as in the constructor type signature. But when we turn the DataCon
definition into the reified one, the `a` and `b` in the constructor type
signature becomes differently scoped than the `a` and `b` in `data a :~: b`.

While it wouldn't technically be *wrong* per se to re-use the same uniques for
`a` and `b` across these two different scopes, it's somewhat annoying for end
users of Template Haskell, since they wouldn't be able to rely on the
assumption that all TH names have globally distinct uniques (#13885). For this
reason, we freshen the universally quantified tyvars that go into the reified
GADT constructor type signature to give them distinct uniques from their
counterparts in the tycon.
-}</span><span>
</span><span id="line-1847"></span><span>
</span><span id="line-1848"></span><span class="hs-comment">------------------------------</span><span>
</span><span id="line-1849"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyClass"><span class="hs-identifier hs-type">reifyClass</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Info"><span class="hs-identifier hs-type">TH.Info</span></a></span><span>
</span><span id="line-1850"></span><span id="reifyClass"><span class="annot"><span class="annottext">reifyClass :: Class -&gt; TcM Info
</span><a href="GHC.Tc.Gen.Splice.html#reifyClass"><span class="hs-identifier hs-var hs-var">reifyClass</span></a></span></span><span> </span><span id="local-6989586621681124356"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681124356"><span class="hs-identifier hs-var">cls</span></a></span></span><span>
</span><span id="line-1851"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>  </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681124355"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124355"><span class="hs-identifier hs-var">cxt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; TcM [Type]
</span><a href="GHC.Tc.Gen.Splice.html#reifyCxt"><span class="hs-identifier hs-var">reifyCxt</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124354"><span class="hs-identifier hs-var">theta</span></a></span><span>
</span><span id="line-1852"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681124353"><span class="annot"><span class="annottext">InstEnvs
</span><a href="#local-6989586621681124353"><span class="hs-identifier hs-var">inst_envs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcM InstEnvs
</span><a href="GHC.Tc.Utils.Env.html#tcGetInstEnvs"><span class="hs-identifier hs-var">tcGetInstEnvs</span></a></span><span>
</span><span id="line-1853"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681124352"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621681124352"><span class="hs-identifier hs-var">insts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Class -&gt; [ClsInst] -&gt; TcM [Dec]
</span><a href="GHC.Tc.Gen.Splice.html#reifyClassInstances"><span class="hs-identifier hs-var">reifyClassInstances</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681124356"><span class="hs-identifier hs-var">cls</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InstEnvs -&gt; Class -&gt; [ClsInst]
</span><a href="GHC.Core.InstEnv.html#classInstances"><span class="hs-identifier hs-var">InstEnv.classInstances</span></a></span><span> </span><span class="annot"><span class="annottext">InstEnvs
</span><a href="#local-6989586621681124353"><span class="hs-identifier hs-var">inst_envs</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681124356"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1854"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681124350"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621681124350"><span class="hs-identifier hs-var">assocTys</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ClassATItem -&gt; TcM [Dec]) -&gt; [ClassATItem] -&gt; TcM [Dec]
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m [b]) -&gt; [a] -&gt; m [b]
</span><a href="GHC.Utils.Monad.html#concatMapM"><span class="hs-identifier hs-var">concatMapM</span></a></span><span> </span><span class="annot"><span class="annottext">ClassATItem -&gt; TcM [Dec]
</span><a href="#local-6989586621681124348"><span class="hs-identifier hs-var">reifyAT</span></a></span><span> </span><span class="annot"><span class="annottext">[ClassATItem]
</span><a href="#local-6989586621681124347"><span class="hs-identifier hs-var">ats</span></a></span><span>
</span><span id="line-1855"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681124346"><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621681124346"><span class="hs-identifier hs-var">ops</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">((Id, Maybe (Name, DefMethSpec Type)) -&gt; TcM [Dec])
-&gt; [(Id, Maybe (Name, DefMethSpec Type))] -&gt; TcM [Dec]
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; m [b]) -&gt; [a] -&gt; m [b]
</span><a href="GHC.Utils.Monad.html#concatMapM"><span class="hs-identifier hs-var">concatMapM</span></a></span><span> </span><span class="annot"><span class="annottext">(Id, Maybe (Name, DefMethSpec Type)) -&gt; TcM [Dec]
forall {a}. (Id, Maybe (a, DefMethSpec Type)) -&gt; TcM [Dec]
</span><a href="#local-6989586621681124345"><span class="hs-identifier hs-var">reify_op</span></a></span><span> </span><span class="annot"><span class="annottext">[(Id, Maybe (Name, DefMethSpec Type))]
</span><a href="#local-6989586621681124344"><span class="hs-identifier hs-var">op_stuff</span></a></span><span>
</span><span id="line-1856"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681124343"><span class="annot"><span class="annottext">[TyVarBndr ()]
</span><a href="#local-6989586621681124343"><span class="hs-identifier hs-var">tvs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; TcM [TyVarBndr ()]
</span><a href="GHC.Tc.Gen.Splice.html#reifyTyVars"><span class="hs-identifier hs-var">reifyTyVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Id]
</span><a href="GHC.Core.TyCon.html#tyConVisibleTyVars"><span class="hs-identifier hs-var">tyConVisibleTyVars</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; TyCon
</span><a href="GHC.Core.Class.html#classTyCon"><span class="hs-identifier hs-var hs-var">classTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681124356"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1857"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681124341"><span class="annot"><span class="annottext">dec :: Dec
</span><a href="#local-6989586621681124341"><span class="hs-identifier hs-var hs-var">dec</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; Name -&gt; [TyVarBndr ()] -&gt; [FunDep] -&gt; [Dec] -&gt; Dec
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#ClassD"><span class="hs-identifier hs-var">TH.ClassD</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124355"><span class="hs-identifier hs-var">cxt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681124356"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TyVarBndr ()]
</span><a href="#local-6989586621681124343"><span class="hs-identifier hs-var">tvs'</span></a></span><span> </span><span class="annot"><span class="annottext">[FunDep]
</span><a href="#local-6989586621681124339"><span class="hs-identifier hs-var">fds'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621681124350"><span class="hs-identifier hs-var">assocTys</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec] -&gt; [Dec] -&gt; [Dec]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621681124346"><span class="hs-identifier hs-var">ops</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1858"></span><span>        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Info -&gt; TcM Info
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dec -&gt; [Dec] -&gt; Info
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#ClassI"><span class="hs-identifier hs-var">TH.ClassI</span></a></span><span> </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621681124341"><span class="hs-identifier hs-var">dec</span></a></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><a href="#local-6989586621681124352"><span class="hs-identifier hs-var">insts</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1859"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1860"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681124337"><span class="annot"><span class="annottext">[FunDep Id]
</span><a href="#local-6989586621681124337"><span class="hs-identifier hs-var">fds</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681124354"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124354"><span class="hs-identifier hs-var">theta</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Id]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681124347"><span class="annot"><span class="annottext">[ClassATItem]
</span><a href="#local-6989586621681124347"><span class="hs-identifier hs-var">ats</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681124344"><span class="annot"><span class="annottext">[(Id, Maybe (Name, DefMethSpec Type))]
</span><a href="#local-6989586621681124344"><span class="hs-identifier hs-var">op_stuff</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Class
-&gt; ([Id], [FunDep Id], [Type], [Id], [ClassATItem],
    [(Id, Maybe (Name, DefMethSpec Type))])
</span><a href="GHC.Core.Class.html#classExtraBigSig"><span class="hs-identifier hs-var">classExtraBigSig</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681124356"><span class="hs-identifier hs-var">cls</span></a></span><span>
</span><span id="line-1861"></span><span>    </span><span id="local-6989586621681124339"><span class="annot"><span class="annottext">fds' :: [FunDep]
</span><a href="#local-6989586621681124339"><span class="hs-identifier hs-var hs-var">fds'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(FunDep Id -&gt; FunDep) -&gt; [FunDep Id] -&gt; [FunDep]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">FunDep Id -&gt; FunDep
</span><a href="GHC.Tc.Gen.Splice.html#reifyFunDep"><span class="hs-identifier hs-var">reifyFunDep</span></a></span><span> </span><span class="annot"><span class="annottext">[FunDep Id]
</span><a href="#local-6989586621681124337"><span class="hs-identifier hs-var">fds</span></a></span><span>
</span><span id="line-1862"></span><span>    </span><span id="local-6989586621681124345"><span class="annot"><span class="annottext">reify_op :: (Id, Maybe (a, DefMethSpec Type)) -&gt; TcM [Dec]
</span><a href="#local-6989586621681124345"><span class="hs-identifier hs-var hs-var">reify_op</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681124329"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681124329"><span class="hs-identifier hs-var">op</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681124328"><span class="annot"><span class="annottext">Maybe (a, DefMethSpec Type)
</span><a href="#local-6989586621681124328"><span class="hs-identifier hs-var">def_meth</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1863"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id]
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681124327"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124327"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ([Id], Type, Type)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitMethodTy"><span class="hs-identifier hs-var">tcSplitMethodTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681124329"><span class="hs-identifier hs-var">op</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1864"></span><span>               </span><span class="hs-comment">-- Use tcSplitMethodTy to get rid of the extraneous class</span><span>
</span><span id="line-1865"></span><span>               </span><span class="hs-comment">-- variables and predicates at the beginning of op's type</span><span>
</span><span id="line-1866"></span><span>               </span><span class="hs-comment">-- (see #15551).</span><span>
</span><span id="line-1867"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681124325"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124325"><span class="hs-identifier hs-var">ty'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124327"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1868"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681124324"><span class="annot"><span class="annottext">nm' :: Name
</span><a href="#local-6989586621681124324"><span class="hs-identifier hs-var hs-var">nm'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Id -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681124329"><span class="hs-identifier hs-var">op</span></a></span><span>
</span><span id="line-1869"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (a, DefMethSpec Type)
</span><a href="#local-6989586621681124328"><span class="hs-identifier hs-var">def_meth</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1870"></span><span>                </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#GenericDM"><span class="hs-identifier hs-type">GenericDM</span></a></span><span> </span><span id="local-6989586621681124322"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124322"><span class="hs-identifier hs-var">gdm_ty</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1871"></span><span>                  </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681124321"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124321"><span class="hs-identifier hs-var">gdm_ty'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124322"><span class="hs-identifier hs-var">gdm_ty</span></a></span><span>
</span><span id="line-1872"></span><span>                     </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">[Dec] -&gt; TcM [Dec]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name -&gt; Type -&gt; Dec
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#SigD"><span class="hs-identifier hs-var">TH.SigD</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124324"><span class="hs-identifier hs-var">nm'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124325"><span class="hs-identifier hs-var">ty'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type -&gt; Dec
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#DefaultSigD"><span class="hs-identifier hs-var">TH.DefaultSigD</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124324"><span class="hs-identifier hs-var">nm'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124321"><span class="hs-identifier hs-var">gdm_ty'</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1873"></span><span>                </span><span class="annot"><span class="annottext">Maybe (a, DefMethSpec Type)
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[Dec] -&gt; TcM [Dec]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Name -&gt; Type -&gt; Dec
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#SigD"><span class="hs-identifier hs-var">TH.SigD</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124324"><span class="hs-identifier hs-var">nm'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124325"><span class="hs-identifier hs-var">ty'</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1874"></span><span>
</span><span id="line-1875"></span><span>    </span><span class="annot"><a href="#local-6989586621681124348"><span class="hs-identifier hs-type">reifyAT</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#ClassATItem"><span class="hs-identifier hs-type">ClassATItem</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Dec"><span class="hs-identifier hs-type">TH.Dec</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1876"></span><span>    </span><span id="local-6989586621681124348"><span class="annot"><span class="annottext">reifyAT :: ClassATItem -&gt; TcM [Dec]
</span><a href="#local-6989586621681124348"><span class="hs-identifier hs-var hs-var">reifyAT</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.Class.html#ATI"><span class="hs-identifier hs-type">ATI</span></a></span><span> </span><span id="local-6989586621681124317"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124317"><span class="hs-identifier hs-var">tycon</span></a></span></span><span> </span><span id="local-6989586621681124316"><span class="annot"><span class="annottext">Maybe (Type, ATValidityInfo)
</span><a href="#local-6989586621681124316"><span class="hs-identifier hs-var">def</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1877"></span><span>      </span><span id="local-6989586621681124315"><span class="annot"><span class="annottext">Info
</span><a href="#local-6989586621681124315"><span class="hs-identifier hs-var">tycon'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; TcM Info
</span><a href="GHC.Tc.Gen.Splice.html#reifyTyCon"><span class="hs-identifier hs-var">reifyTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124317"><span class="hs-identifier hs-var">tycon</span></a></span><span>
</span><span id="line-1878"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Info
</span><a href="#local-6989586621681124315"><span class="hs-identifier hs-var">tycon'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1879"></span><span>        </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#FamilyI"><span class="hs-identifier hs-type">TH.FamilyI</span></a></span><span> </span><span id="local-6989586621681124314"><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621681124314"><span class="hs-identifier hs-var">dec</span></a></span></span><span> </span><span class="annot"><span class="annottext">[Dec]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1880"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681124313"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124313"><span class="hs-identifier hs-var">tyName</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681124312"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621681124312"><span class="hs-identifier hs-var">tyArgs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Dec -&gt; (Name, [Name])
</span><a href="#local-6989586621681124311"><span class="hs-identifier hs-var">tfNames</span></a></span><span> </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621681124314"><span class="hs-identifier hs-var">dec</span></a></span><span>
</span><span id="line-1881"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621681124314"><span class="hs-identifier hs-var">dec</span></a></span><span> </span><span class="annot"><span class="annottext">Dec -&gt; [Dec] -&gt; [Dec]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([Dec] -&gt; [Dec]) -&gt; TcM [Dec] -&gt; TcM [Dec]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">TcM [Dec]
-&gt; ((Type, ATValidityInfo) -&gt; TcM [Dec])
-&gt; Maybe (Type, ATValidityInfo)
-&gt; TcM [Dec]
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../base/src/Data.Maybe.html#maybe"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Dec] -&gt; TcM [Dec]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1882"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Dec -&gt; [Dec]) -&gt; IOEnv (Env TcGblEnv TcLclEnv) Dec -&gt; TcM [Dec]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dec -&gt; [Dec] -&gt; [Dec]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IOEnv (Env TcGblEnv TcLclEnv) Dec -&gt; TcM [Dec])
-&gt; ((Type, ATValidityInfo) -&gt; IOEnv (Env TcGblEnv TcLclEnv) Dec)
-&gt; (Type, ATValidityInfo)
-&gt; TcM [Dec]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; [Name] -&gt; Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) Dec
</span><a href="#local-6989586621681124309"><span class="hs-identifier hs-var">reifyDefImpl</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124313"><span class="hs-identifier hs-var">tyName</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621681124312"><span class="hs-identifier hs-var">tyArgs</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) Dec)
-&gt; ((Type, ATValidityInfo) -&gt; Type)
-&gt; (Type, ATValidityInfo)
-&gt; IOEnv (Env TcGblEnv TcLclEnv) Dec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Type, ATValidityInfo) -&gt; Type
forall a b. (a, b) -&gt; a
</span><a href="../../base/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1883"></span><span>                            </span><span class="annot"><span class="annottext">Maybe (Type, ATValidityInfo)
</span><a href="#local-6989586621681124316"><span class="hs-identifier hs-var">def</span></a></span><span>
</span><span id="line-1884"></span><span>        </span><span class="annot"><span class="annottext">Info
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; MsgDoc -&gt; TcM [Dec]
forall a. HasCallStack =&gt; String -&gt; MsgDoc -&gt; a
</span><a href="GHC.Utils.Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;reifyAT&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Info -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../base/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Info
</span><a href="#local-6989586621681124315"><span class="hs-identifier hs-var">tycon'</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1885"></span><span>
</span><span id="line-1886"></span><span>    </span><span class="annot"><a href="#local-6989586621681124309"><span class="hs-identifier hs-type">reifyDefImpl</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Name"><span class="hs-identifier hs-type">TH.Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Name"><span class="hs-identifier hs-type">TH.Name</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Dec"><span class="hs-identifier hs-type">TH.Dec</span></a></span><span>
</span><span id="line-1887"></span><span>    </span><span id="local-6989586621681124309"><span class="annot"><span class="annottext">reifyDefImpl :: Name -&gt; [Name] -&gt; Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) Dec
</span><a href="#local-6989586621681124309"><span class="hs-identifier hs-var hs-var">reifyDefImpl</span></a></span></span><span> </span><span id="local-6989586621681124308"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124308"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681124307"><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621681124307"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span id="local-6989586621681124306"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124306"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1888"></span><span>      </span><span class="annot"><span class="annottext">TySynEqn -&gt; Dec
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#TySynInstD"><span class="hs-identifier hs-var">TH.TySynInstD</span></a></span><span> </span><span class="annot"><span class="annottext">(TySynEqn -&gt; Dec) -&gt; (Type -&gt; TySynEqn) -&gt; Type -&gt; Dec
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [TyVarBndr ()] -&gt; Type -&gt; Type -&gt; TySynEqn
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#TySynEqn"><span class="hs-identifier hs-var">TH.TySynEqn</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [TyVarBndr ()]
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; [Type] -&gt; Type
</span><a href="GHC.Tc.Gen.Splice.html#mkThAppTs"><span class="hs-identifier hs-var">mkThAppTs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#ConT"><span class="hs-identifier hs-var">TH.ConT</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124308"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Name -&gt; Type) -&gt; [Name] -&gt; [Type]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#VarT"><span class="hs-identifier hs-var">TH.VarT</span></a></span><span> </span><span class="annot"><span class="annottext">[Name]
</span><a href="#local-6989586621681124307"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1889"></span><span>                                  </span><span class="annot"><span class="annottext">(Type -&gt; Dec) -&gt; TcM Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) Dec
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124306"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1890"></span><span>
</span><span id="line-1891"></span><span>    </span><span class="annot"><a href="#local-6989586621681124311"><span class="hs-identifier hs-type">tfNames</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Dec"><span class="hs-identifier hs-type">TH.Dec</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Name"><span class="hs-identifier hs-type">TH.Name</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Name"><span class="hs-identifier hs-type">TH.Name</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1892"></span><span>    </span><span id="local-6989586621681124311"><span class="annot"><span class="annottext">tfNames :: Dec -&gt; (Name, [Name])
</span><a href="#local-6989586621681124311"><span class="hs-identifier hs-var hs-var">tfNames</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#OpenTypeFamilyD"><span class="hs-identifier hs-type">TH.OpenTypeFamilyD</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#TypeFamilyHead"><span class="hs-identifier hs-type">TH.TypeFamilyHead</span></a></span><span> </span><span id="local-6989586621681124303"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124303"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span id="local-6989586621681124302"><span class="annot"><span class="annottext">[TyVarBndr ()]
</span><a href="#local-6989586621681124302"><span class="hs-identifier hs-var">args</span></a></span></span><span> </span><span class="annot"><span class="annottext">FamilyResultSig
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Maybe InjectivityAnn
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1893"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124303"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(TyVarBndr () -&gt; Name) -&gt; [TyVarBndr ()] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">TyVarBndr () -&gt; Name
forall flag. TyVarBndr flag -&gt; Name
</span><a href="#local-6989586621681124301"><span class="hs-identifier hs-var">bndrName</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndr ()]
</span><a href="#local-6989586621681124302"><span class="hs-identifier hs-var">args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1894"></span><span>    </span><span class="annot"><a href="#local-6989586621681124311"><span class="hs-identifier hs-var">tfNames</span></a></span><span> </span><span id="local-6989586621681124300"><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621681124300"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; MsgDoc -&gt; (Name, [Name])
forall a. HasCallStack =&gt; String -&gt; MsgDoc -&gt; a
</span><a href="GHC.Utils.Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;tfNames&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Dec -&gt; String
forall a. Show a =&gt; a -&gt; String
</span><a href="../../base/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Dec
</span><a href="#local-6989586621681124300"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1895"></span><span>
</span><span id="line-1896"></span><span>    </span><span id="local-6989586621681126391"><span class="annot"><a href="#local-6989586621681124301"><span class="hs-identifier hs-type">bndrName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#TyVarBndr"><span class="hs-identifier hs-type">TH.TyVarBndr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681126391"><span class="hs-identifier hs-type">flag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Name"><span class="hs-identifier hs-type">TH.Name</span></a></span></span><span>
</span><span id="line-1897"></span><span>    </span><span id="local-6989586621681124301"><span class="annot"><span class="annottext">bndrName :: forall flag. TyVarBndr flag -&gt; Name
</span><a href="#local-6989586621681124301"><span class="hs-identifier hs-var hs-var">bndrName</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#PlainTV"><span class="hs-identifier hs-type">TH.PlainTV</span></a></span><span> </span><span id="local-6989586621681124298"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124298"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="annottext">flag
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124298"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1898"></span><span>    </span><span class="annot"><a href="#local-6989586621681124301"><span class="hs-identifier hs-var">bndrName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#KindedTV"><span class="hs-identifier hs-type">TH.KindedTV</span></a></span><span> </span><span id="local-6989586621681124297"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124297"><span class="hs-identifier hs-var">n</span></a></span></span><span> </span><span class="annot"><span class="annottext">flag
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124297"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-1899"></span><span>
</span><span id="line-1900"></span><span class="hs-comment">------------------------------</span><span>
</span><span id="line-1901"></span><span class="hs-comment">-- | Annotate (with TH.SigT) a type if the first parameter is True</span><span>
</span><span id="line-1902"></span><span class="hs-comment">-- and if the type contains a free variable.</span><span>
</span><span id="line-1903"></span><span class="hs-comment">-- This is used to annotate type patterns for poly-kinded tyvars in</span><span>
</span><span id="line-1904"></span><span class="hs-comment">-- reifying class and type instances.</span><span>
</span><span id="line-1905"></span><span class="hs-comment">-- See @Note [Reified instances and explicit kind signatures]@.</span><span>
</span><span id="line-1906"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#annotThType"><span class="hs-identifier hs-type">annotThType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>   </span><span class="hs-comment">-- True &lt;=&gt; annotate</span><span>
</span><span id="line-1907"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">TyCoRep.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Type"><span class="hs-identifier hs-type">TH.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Type"><span class="hs-identifier hs-type">TH.Type</span></a></span><span>
</span><span id="line-1908"></span><span>  </span><span class="hs-comment">-- tiny optimization: if the type is annotated, don't annotate again.</span><span>
</span><span id="line-1909"></span><span id="annotThType"><span class="annot"><span class="annottext">annotThType :: Bool -&gt; Type -&gt; Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#annotThType"><span class="hs-identifier hs-var hs-var">annotThType</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span>    </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span>  </span><span id="local-6989586621681124296"><span class="annot"><span class="annottext">th_ty :: Type
</span><a href="#local-6989586621681124296"><span class="hs-identifier hs-var">th_ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#SigT"><span class="hs-identifier hs-type">TH.SigT</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124296"><span class="hs-identifier hs-var">th_ty</span></a></span><span>
</span><span id="line-1910"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#annotThType"><span class="hs-identifier hs-var">annotThType</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span id="local-6989586621681124294"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124294"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span id="local-6989586621681124293"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124293"><span class="hs-identifier hs-var">th_ty</span></a></span></span><span>
</span><span id="line-1911"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">VarSet -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#isEmptyVarSet"><span class="hs-identifier hs-var">isEmptyVarSet</span></a></span><span> </span><span class="annot"><span class="annottext">(VarSet -&gt; Bool) -&gt; VarSet -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(Id -&gt; Bool) -&gt; VarSet -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#filterVarSet"><span class="hs-identifier hs-var">filterVarSet</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Types.Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">(VarSet -&gt; VarSet) -&gt; VarSet -&gt; VarSet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124294"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1912"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681124289"><span class="annot"><span class="annottext">ki :: Type
</span><a href="#local-6989586621681124289"><span class="hs-identifier hs-var hs-var">ki</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
Type -&gt; Type
</span><a href="GHC.Core.Type.html#tcTypeKind"><span class="hs-identifier hs-var">tcTypeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124294"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1913"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681124288"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124288"><span class="hs-identifier hs-var">th_ki</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyKind"><span class="hs-identifier hs-var">reifyKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124289"><span class="hs-identifier hs-var">ki</span></a></span><span>
</span><span id="line-1914"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#SigT"><span class="hs-identifier hs-var">TH.SigT</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124293"><span class="hs-identifier hs-var">th_ty</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124288"><span class="hs-identifier hs-var">th_ki</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1915"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#annotThType"><span class="hs-identifier hs-var">annotThType</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span>    </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681124287"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124287"><span class="hs-identifier hs-var">th_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124287"><span class="hs-identifier hs-var">th_ty</span></a></span><span>
</span><span id="line-1916"></span><span>
</span><span id="line-1917"></span><span class="hs-comment">-- | For every argument type that a type constructor accepts,</span><span>
</span><span id="line-1918"></span><span class="hs-comment">-- report whether or not the argument is poly-kinded. This is used to</span><span>
</span><span id="line-1919"></span><span class="hs-comment">-- eventually feed into 'annotThType'.</span><span>
</span><span id="line-1920"></span><span class="hs-comment">-- See @Note [Reified instances and explicit kind signatures]@.</span><span>
</span><span id="line-1921"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#tyConArgsPolyKinded"><span class="hs-identifier hs-type">tyConArgsPolyKinded</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">]</span><span>
</span><span id="line-1922"></span><span id="tyConArgsPolyKinded"><span class="annot"><span class="annottext">tyConArgsPolyKinded :: TyCon -&gt; [Bool]
</span><a href="GHC.Tc.Gen.Splice.html#tyConArgsPolyKinded"><span class="hs-identifier hs-var hs-var">tyConArgsPolyKinded</span></a></span></span><span> </span><span id="local-6989586621681124286"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124286"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1923"></span><span>     </span><span class="annot"><span class="annottext">(Id -&gt; Bool) -&gt; [Id] -&gt; [Bool]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="#local-6989586621681124285"><span class="hs-identifier hs-var">is_poly_ty</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Bool) -&gt; (Id -&gt; Type) -&gt; Id -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a></span><span class="hs-special">)</span><span>      </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681124283"><span class="hs-identifier hs-var">tc_vis_tvs</span></a></span><span>
</span><span id="line-1924"></span><span>     </span><span class="hs-comment">-- See &quot;Wrinkle: Oversaturated data family instances&quot; in</span><span>
</span><span id="line-1925"></span><span>     </span><span class="hs-comment">-- @Note [Reified instances and explicit kind signatures]@</span><span>
</span><span id="line-1926"></span><span>  </span><span class="annot"><span class="annottext">[Bool] -&gt; [Bool] -&gt; [Bool]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">(TyCoBinder -&gt; Bool) -&gt; [TyCoBinder] -&gt; [Bool]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="#local-6989586621681124285"><span class="hs-identifier hs-var">is_poly_ty</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Bool) -&gt; (TyCoBinder -&gt; Type) -&gt; TyCoBinder -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoBinder -&gt; Type
</span><a href="GHC.Core.Type.html#tyCoBinderType"><span class="hs-identifier hs-var">tyCoBinderType</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TyCoBinder]
</span><a href="#local-6989586621681124281"><span class="hs-identifier hs-var">tc_res_kind_vis_bndrs</span></a></span><span> </span><span class="hs-comment">-- (1) in Wrinkle</span><span>
</span><span id="line-1927"></span><span>  </span><span class="annot"><span class="annottext">[Bool] -&gt; [Bool] -&gt; [Bool]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; [Bool]
forall a. a -&gt; [a]
</span><a href="../../base/src/GHC.List.html#repeat"><span class="hs-identifier hs-var">repeat</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>                                             </span><span class="hs-comment">-- (2) in Wrinkle</span><span>
</span><span id="line-1928"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1929"></span><span>    </span><span class="annot"><a href="#local-6989586621681124285"><span class="hs-identifier hs-type">is_poly_ty</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1930"></span><span>    </span><span id="local-6989586621681124285"><span class="annot"><span class="annottext">is_poly_ty :: Type -&gt; Bool
</span><a href="#local-6989586621681124285"><span class="hs-identifier hs-var hs-var">is_poly_ty</span></a></span></span><span> </span><span id="local-6989586621681124279"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124279"><span class="hs-identifier hs-var">ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1931"></span><span>                    </span><span class="annot"><span class="annottext">VarSet -&gt; Bool
</span><a href="GHC.Types.Var.Set.html#isEmptyVarSet"><span class="hs-identifier hs-var">isEmptyVarSet</span></a></span><span> </span><span class="annot"><span class="annottext">(VarSet -&gt; Bool) -&gt; VarSet -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1932"></span><span>                    </span><span class="annot"><span class="annottext">(Id -&gt; Bool) -&gt; VarSet -&gt; VarSet
</span><a href="GHC.Types.Var.Set.html#filterVarSet"><span class="hs-identifier hs-var">filterVarSet</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Bool
</span><a href="GHC.Types.Var.html#isTyVar"><span class="hs-identifier hs-var">isTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">(VarSet -&gt; VarSet) -&gt; VarSet -&gt; VarSet
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1933"></span><span>                    </span><span class="annot"><span class="annottext">Type -&gt; VarSet
</span><a href="GHC.Core.TyCo.FVs.html#tyCoVarsOfType"><span class="hs-identifier hs-var">tyCoVarsOfType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124279"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-1934"></span><span>
</span><span id="line-1935"></span><span>    </span><span class="annot"><a href="#local-6989586621681124283"><span class="hs-identifier hs-type">tc_vis_tvs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1936"></span><span>    </span><span id="local-6989586621681124283"><span class="annot"><span class="annottext">tc_vis_tvs :: [Id]
</span><a href="#local-6989586621681124283"><span class="hs-identifier hs-var hs-var">tc_vis_tvs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Id]
</span><a href="GHC.Core.TyCon.html#tyConVisibleTyVars"><span class="hs-identifier hs-var">tyConVisibleTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124286"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-1937"></span><span>
</span><span id="line-1938"></span><span>    </span><span class="annot"><a href="#local-6989586621681124281"><span class="hs-identifier hs-type">tc_res_kind_vis_bndrs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyCoBinder"><span class="hs-identifier hs-type">TyCoBinder</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1939"></span><span>    </span><span id="local-6989586621681124281"><span class="annot"><span class="annottext">tc_res_kind_vis_bndrs :: [TyCoBinder]
</span><a href="#local-6989586621681124281"><span class="hs-identifier hs-var hs-var">tc_res_kind_vis_bndrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TyCoBinder -&gt; Bool) -&gt; [TyCoBinder] -&gt; [TyCoBinder]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="annot"><span class="annottext">TyCoBinder -&gt; Bool
</span><a href="GHC.Core.TyCo.Rep.html#isVisibleBinder"><span class="hs-identifier hs-var">isVisibleBinder</span></a></span><span> </span><span class="annot"><span class="annottext">([TyCoBinder] -&gt; [TyCoBinder]) -&gt; [TyCoBinder] -&gt; [TyCoBinder]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">([TyCoBinder], Type) -&gt; [TyCoBinder]
forall a b. (a, b) -&gt; a
</span><a href="../../base/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">(([TyCoBinder], Type) -&gt; [TyCoBinder])
-&gt; ([TyCoBinder], Type) -&gt; [TyCoBinder]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; ([TyCoBinder], Type)
</span><a href="GHC.Core.Type.html#splitPiTys"><span class="hs-identifier hs-var">splitPiTys</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; ([TyCoBinder], Type)) -&gt; Type -&gt; ([TyCoBinder], Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Type
</span><a href="GHC.Core.TyCon.html#tyConResKind"><span class="hs-identifier hs-var hs-var">tyConResKind</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124286"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-1940"></span><span>
</span><span id="line-1941"></span><span class="hs-comment">{-
Note [Reified instances and explicit kind signatures]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Reified class instances and type family instances often include extra kind
information to disambiguate instances. Here is one such example that
illustrates this (#8953):

    type family Poly (a :: k) :: Type
    type instance Poly (x :: Bool)    = Int
    type instance Poly (x :: Maybe k) = Double

If you're not careful, reifying these instances might yield this:

    type instance Poly x = Int
    type instance Poly x = Double

To avoid this, we go through some care to annotate things with extra kind
information. Some functions which accomplish this feat include:

* annotThType: This annotates a type with a kind signature if the type contains
  a free variable.
* tyConArgsPolyKinded: This checks every argument that a type constructor can
  accept and reports if the type of the argument is poly-kinded. This
  information is ultimately fed into annotThType.

-----
-- Wrinkle: Oversaturated data family instances
-----

What constitutes an argument to a type constructor in the definition of
tyConArgsPolyKinded? For most type constructors, it's simply the visible
type variable binders (i.e., tyConVisibleTyVars). There is one corner case
we must keep in mind, however: data family instances can appear oversaturated
(#17296). For instance:

    data family   Foo :: Type -&gt; Type
    data instance Foo x

    data family Bar :: k
    data family Bar x

For these sorts of data family instances, tyConVisibleTyVars isn't enough,
as they won't give you the kinds of the oversaturated arguments. We must
also consult:

1. The kinds of the arguments in the result kind (i.e., the tyConResKind).
   This will tell us, e.g., the kind of `x` in `Foo x` above.
2. If we go beyond the number of arguments in the result kind (like the
   `x` in `Bar x`), then we conservatively assume that the argument's
   kind is poly-kinded.

-----
-- Wrinkle: data family instances with return kinds
-----

Another squirrelly corner case is this:

    data family Foo (a :: k)
    data instance Foo :: Bool -&gt; Type
    data instance Foo :: Char -&gt; Type

If you're not careful, reifying these instances might yield this:

    data instance Foo
    data instance Foo

We can fix this ambiguity by reifying the instances' explicit return kinds. We
should only do this if necessary (see
Note [When does a tycon application need an explicit kind signature?] in GHC.Core.Type),
but more importantly, we *only* do this if either of the following are true:

1. The data family instance has no constructors.
2. The data family instance is declared with GADT syntax.

If neither of these are true, then reifying the return kind would yield
something like this:

    data instance (Bar a :: Type) = MkBar a

Which is not valid syntax.
-}</span><span>
</span><span id="line-2022"></span><span>
</span><span id="line-2023"></span><span class="hs-comment">------------------------------</span><span>
</span><span id="line-2024"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyClassInstances"><span class="hs-identifier hs-type">reifyClassInstances</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.Class.html#Class"><span class="hs-identifier hs-type">Class</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Dec"><span class="hs-identifier hs-type">TH.Dec</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2025"></span><span id="reifyClassInstances"><span class="annot"><span class="annottext">reifyClassInstances :: Class -&gt; [ClsInst] -&gt; TcM [Dec]
</span><a href="GHC.Tc.Gen.Splice.html#reifyClassInstances"><span class="hs-identifier hs-var hs-var">reifyClassInstances</span></a></span></span><span> </span><span id="local-6989586621681124276"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681124276"><span class="hs-identifier hs-var">cls</span></a></span></span><span> </span><span id="local-6989586621681124275"><span class="annot"><span class="annottext">[ClsInst]
</span><a href="#local-6989586621681124275"><span class="hs-identifier hs-var">insts</span></a></span></span><span>
</span><span id="line-2026"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ClsInst -&gt; IOEnv (Env TcGblEnv TcLclEnv) Dec)
-&gt; [ClsInst] -&gt; TcM [Dec]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Bool] -&gt; ClsInst -&gt; IOEnv (Env TcGblEnv TcLclEnv) Dec
</span><a href="GHC.Tc.Gen.Splice.html#reifyClassInstance"><span class="hs-identifier hs-var">reifyClassInstance</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Bool]
</span><a href="GHC.Tc.Gen.Splice.html#tyConArgsPolyKinded"><span class="hs-identifier hs-var">tyConArgsPolyKinded</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; TyCon
</span><a href="GHC.Core.Class.html#classTyCon"><span class="hs-identifier hs-var hs-var">classTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681124276"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ClsInst]
</span><a href="#local-6989586621681124275"><span class="hs-identifier hs-var">insts</span></a></span><span>
</span><span id="line-2027"></span><span>
</span><span id="line-2028"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyClassInstance"><span class="hs-identifier hs-type">reifyClassInstance</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- True &lt;=&gt; the corresponding tv is poly-kinded</span><span>
</span><span id="line-2029"></span><span>                              </span><span class="hs-comment">-- includes only *visible* tvs</span><span>
</span><span id="line-2030"></span><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.InstEnv.html#ClsInst"><span class="hs-identifier hs-type">ClsInst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Dec"><span class="hs-identifier hs-type">TH.Dec</span></a></span><span>
</span><span id="line-2031"></span><span id="reifyClassInstance"><span class="annot"><span class="annottext">reifyClassInstance :: [Bool] -&gt; ClsInst -&gt; IOEnv (Env TcGblEnv TcLclEnv) Dec
</span><a href="GHC.Tc.Gen.Splice.html#reifyClassInstance"><span class="hs-identifier hs-var hs-var">reifyClassInstance</span></a></span></span><span> </span><span id="local-6989586621681124273"><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621681124273"><span class="hs-identifier hs-var">is_poly_tvs</span></a></span></span><span> </span><span id="local-6989586621681124272"><span class="annot"><span class="annottext">ClsInst
</span><a href="#local-6989586621681124272"><span class="hs-identifier hs-var">i</span></a></span></span><span>
</span><span id="line-2032"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681124271"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124271"><span class="hs-identifier hs-var">cxt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; TcM [Type]
</span><a href="GHC.Tc.Gen.Splice.html#reifyCxt"><span class="hs-identifier hs-var">reifyCxt</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124270"><span class="hs-identifier hs-var">theta</span></a></span><span>
</span><span id="line-2033"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681124269"><span class="annot"><span class="annottext">vis_types :: [Type]
</span><a href="#local-6989586621681124269"><span class="hs-identifier hs-var hs-var">vis_types</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; [Type]
</span><a href="GHC.Core.Type.html#filterOutInvisibleTypes"><span class="hs-identifier hs-var">filterOutInvisibleTypes</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124268"><span class="hs-identifier hs-var">cls_tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124267"><span class="hs-identifier hs-var">types</span></a></span><span>
</span><span id="line-2034"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681124266"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124266"><span class="hs-identifier hs-var">thtypes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; TcM [Type]
</span><a href="GHC.Tc.Gen.Splice.html#reifyTypes"><span class="hs-identifier hs-var">reifyTypes</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124269"><span class="hs-identifier hs-var">vis_types</span></a></span><span>
</span><span id="line-2035"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681124265"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124265"><span class="hs-identifier hs-var">annot_thtypes</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Type -&gt; Type -&gt; TcM Type)
-&gt; [Bool] -&gt; [Type] -&gt; [Type] -&gt; TcM [Type]
forall (m :: * -&gt; *) a b c d.
Monad m =&gt;
(a -&gt; b -&gt; c -&gt; m d) -&gt; [a] -&gt; [b] -&gt; [c] -&gt; m [d]
</span><a href="GHC.Utils.Monad.html#zipWith3M"><span class="hs-identifier hs-var">zipWith3M</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Type -&gt; Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#annotThType"><span class="hs-identifier hs-var">annotThType</span></a></span><span> </span><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621681124273"><span class="hs-identifier hs-var">is_poly_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124269"><span class="hs-identifier hs-var">vis_types</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124266"><span class="hs-identifier hs-var">thtypes</span></a></span><span>
</span><span id="line-2036"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681124264"><span class="annot"><span class="annottext">head_ty :: Type
</span><a href="#local-6989586621681124264"><span class="hs-identifier hs-var hs-var">head_ty</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; [Type] -&gt; Type
</span><a href="GHC.Tc.Gen.Splice.html#mkThAppTs"><span class="hs-identifier hs-var">mkThAppTs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#ConT"><span class="hs-identifier hs-var">TH.ConT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Class -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681124263"><span class="hs-identifier hs-var">cls</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124265"><span class="hs-identifier hs-var">annot_thtypes</span></a></span><span>
</span><span id="line-2037"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Dec -&gt; IOEnv (Env TcGblEnv TcLclEnv) Dec
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Dec -&gt; IOEnv (Env TcGblEnv TcLclEnv) Dec)
-&gt; Dec -&gt; IOEnv (Env TcGblEnv TcLclEnv) Dec
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Overlap -&gt; [Type] -&gt; Type -&gt; [Dec] -&gt; Dec
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#InstanceD"><span class="hs-identifier hs-var">TH.InstanceD</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Overlap
</span><a href="#local-6989586621681124261"><span class="hs-identifier hs-var">over</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124271"><span class="hs-identifier hs-var">cxt</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124264"><span class="hs-identifier hs-var">head_ty</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2038"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2039"></span><span>     </span><span class="hs-special">(</span><span id="local-6989586621681124260"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681124260"><span class="hs-identifier hs-var">_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681124270"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124270"><span class="hs-identifier hs-var">theta</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681124263"><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681124263"><span class="hs-identifier hs-var">cls</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681124267"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124267"><span class="hs-identifier hs-var">types</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ([Id], [Type], Class, [Type])
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitDFunTy"><span class="hs-identifier hs-var">tcSplitDFunTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681124258"><span class="hs-identifier hs-var">dfun</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2040"></span><span>     </span><span id="local-6989586621681124268"><span class="annot"><span class="annottext">cls_tc :: TyCon
</span><a href="#local-6989586621681124268"><span class="hs-identifier hs-var hs-var">cls_tc</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Class -&gt; TyCon
</span><a href="GHC.Core.Class.html#classTyCon"><span class="hs-identifier hs-var hs-var">classTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">Class
</span><a href="#local-6989586621681124263"><span class="hs-identifier hs-var">cls</span></a></span><span>
</span><span id="line-2041"></span><span>     </span><span id="local-6989586621681124258"><span class="annot"><span class="annottext">dfun :: Id
</span><a href="#local-6989586621681124258"><span class="hs-identifier hs-var hs-var">dfun</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ClsInst -&gt; Id
</span><a href="GHC.Core.InstEnv.html#instanceDFunId"><span class="hs-identifier hs-var">instanceDFunId</span></a></span><span> </span><span class="annot"><span class="annottext">ClsInst
</span><a href="#local-6989586621681124272"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-2042"></span><span>     </span><span id="local-6989586621681124261"><span class="annot"><span class="annottext">over :: Maybe Overlap
</span><a href="#local-6989586621681124261"><span class="hs-identifier hs-var hs-var">over</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">OverlapFlag -&gt; OverlapMode
</span><a href="GHC.Types.Basic.html#overlapMode"><span class="hs-identifier hs-var hs-var">overlapMode</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ClsInst -&gt; OverlapFlag
</span><a href="GHC.Core.InstEnv.html#is_flag"><span class="hs-identifier hs-var hs-var">is_flag</span></a></span><span> </span><span class="annot"><span class="annottext">ClsInst
</span><a href="#local-6989586621681124272"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2043"></span><span>                  </span><span class="annot"><a href="GHC.Types.Basic.html#NoOverlap"><span class="hs-identifier hs-type">NoOverlap</span></a></span><span> </span><span class="annot"><span class="annottext">SourceText
</span><span class="hs-identifier">_</span></span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe Overlap
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-2044"></span><span>                  </span><span class="annot"><a href="GHC.Types.Basic.html#Overlappable"><span class="hs-identifier hs-type">Overlappable</span></a></span><span> </span><span class="annot"><span class="annottext">SourceText
</span><span class="hs-identifier">_</span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Overlap -&gt; Maybe Overlap
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Overlap
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Overlappable"><span class="hs-identifier hs-var">TH.Overlappable</span></a></span><span>
</span><span id="line-2045"></span><span>                  </span><span class="annot"><a href="GHC.Types.Basic.html#Overlapping"><span class="hs-identifier hs-type">Overlapping</span></a></span><span> </span><span class="annot"><span class="annottext">SourceText
</span><span class="hs-identifier">_</span></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Overlap -&gt; Maybe Overlap
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Overlap
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Overlapping"><span class="hs-identifier hs-var">TH.Overlapping</span></a></span><span>
</span><span id="line-2046"></span><span>                  </span><span class="annot"><a href="GHC.Types.Basic.html#Overlaps"><span class="hs-identifier hs-type">Overlaps</span></a></span><span> </span><span class="annot"><span class="annottext">SourceText
</span><span class="hs-identifier">_</span></span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Overlap -&gt; Maybe Overlap
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Overlap
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Overlaps"><span class="hs-identifier hs-var">TH.Overlaps</span></a></span><span>
</span><span id="line-2047"></span><span>                  </span><span class="annot"><a href="GHC.Types.Basic.html#Incoherent"><span class="hs-identifier hs-type">Incoherent</span></a></span><span> </span><span class="annot"><span class="annottext">SourceText
</span><span class="hs-identifier">_</span></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Overlap -&gt; Maybe Overlap
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Overlap
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Incoherent"><span class="hs-identifier hs-var">TH.Incoherent</span></a></span><span>
</span><span id="line-2048"></span><span>
</span><span id="line-2049"></span><span class="hs-comment">------------------------------</span><span>
</span><span id="line-2050"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyFamilyInstances"><span class="hs-identifier hs-type">reifyFamilyInstances</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.FamInstEnv.html#FamInst"><span class="hs-identifier hs-type">FamInst</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Dec"><span class="hs-identifier hs-type">TH.Dec</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2051"></span><span id="reifyFamilyInstances"><span class="annot"><span class="annottext">reifyFamilyInstances :: TyCon -&gt; [FamInst] -&gt; TcM [Dec]
</span><a href="GHC.Tc.Gen.Splice.html#reifyFamilyInstances"><span class="hs-identifier hs-var hs-var">reifyFamilyInstances</span></a></span></span><span> </span><span id="local-6989586621681124249"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124249"><span class="hs-identifier hs-var">fam_tc</span></a></span></span><span> </span><span id="local-6989586621681124248"><span class="annot"><span class="annottext">[FamInst]
</span><a href="#local-6989586621681124248"><span class="hs-identifier hs-var">fam_insts</span></a></span></span><span>
</span><span id="line-2052"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(FamInst -&gt; IOEnv (Env TcGblEnv TcLclEnv) Dec)
-&gt; [FamInst] -&gt; TcM [Dec]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Bool] -&gt; FamInst -&gt; IOEnv (Env TcGblEnv TcLclEnv) Dec
</span><a href="GHC.Tc.Gen.Splice.html#reifyFamilyInstance"><span class="hs-identifier hs-var">reifyFamilyInstance</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Bool]
</span><a href="GHC.Tc.Gen.Splice.html#tyConArgsPolyKinded"><span class="hs-identifier hs-var">tyConArgsPolyKinded</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124249"><span class="hs-identifier hs-var">fam_tc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[FamInst]
</span><a href="#local-6989586621681124248"><span class="hs-identifier hs-var">fam_insts</span></a></span><span>
</span><span id="line-2053"></span><span>
</span><span id="line-2054"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyFamilyInstance"><span class="hs-identifier hs-type">reifyFamilyInstance</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- True &lt;=&gt; the corresponding tv is poly-kinded</span><span>
</span><span id="line-2055"></span><span>                              </span><span class="hs-comment">-- includes only *visible* tvs</span><span>
</span><span id="line-2056"></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.FamInstEnv.html#FamInst"><span class="hs-identifier hs-type">FamInst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Dec"><span class="hs-identifier hs-type">TH.Dec</span></a></span><span>
</span><span id="line-2057"></span><span id="reifyFamilyInstance"><span class="annot"><span class="annottext">reifyFamilyInstance :: [Bool] -&gt; FamInst -&gt; IOEnv (Env TcGblEnv TcLclEnv) Dec
</span><a href="GHC.Tc.Gen.Splice.html#reifyFamilyInstance"><span class="hs-identifier hs-var hs-var">reifyFamilyInstance</span></a></span></span><span> </span><span id="local-6989586621681124246"><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621681124246"><span class="hs-identifier hs-var">is_poly_tvs</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.FamInstEnv.html#FamInst"><span class="hs-identifier hs-type">FamInst</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">fi_flavor :: FamInst -&gt; FamFlavor
</span><a href="GHC.Core.FamInstEnv.html#fi_flavor"><span class="hs-identifier hs-var">fi_flavor</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681124243"><span class="annot"><span class="annottext">FamFlavor
</span><a href="#local-6989586621681124243"><span class="hs-identifier hs-var">flavor</span></a></span></span><span>
</span><span id="line-2058"></span><span>                                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fi_axiom :: FamInst -&gt; CoAxiom Unbranched
</span><a href="GHC.Core.FamInstEnv.html#fi_axiom"><span class="hs-identifier hs-var">fi_axiom</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681124241"><span class="annot"><span class="annottext">CoAxiom Unbranched
</span><a href="#local-6989586621681124241"><span class="hs-identifier hs-var">ax</span></a></span></span><span>
</span><span id="line-2059"></span><span>                                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">fi_fam :: FamInst -&gt; Name
</span><a href="GHC.Core.FamInstEnv.html#fi_fam"><span class="hs-identifier hs-var">fi_fam</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681124239"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124239"><span class="hs-identifier hs-var">fam</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-2060"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681124238"><span class="annot"><span class="annottext">fam_tc :: TyCon
</span><a href="#local-6989586621681124238"><span class="hs-identifier hs-var hs-var">fam_tc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoAxiom Unbranched -&gt; TyCon
forall (br :: BranchFlag). CoAxiom br -&gt; TyCon
</span><a href="GHC.Core.Coercion.Axiom.html#coAxiomTyCon"><span class="hs-identifier hs-var">coAxiomTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiom Unbranched
</span><a href="#local-6989586621681124241"><span class="hs-identifier hs-var">ax</span></a></span><span>
</span><span id="line-2061"></span><span>        </span><span id="local-6989586621681124236"><span class="annot"><span class="annottext">branch :: CoAxBranch
</span><a href="#local-6989586621681124236"><span class="hs-identifier hs-var hs-var">branch</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoAxiom Unbranched -&gt; CoAxBranch
</span><a href="GHC.Core.Coercion.Axiom.html#coAxiomSingleBranch"><span class="hs-identifier hs-var">coAxiomSingleBranch</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiom Unbranched
</span><a href="#local-6989586621681124241"><span class="hs-identifier hs-var">ax</span></a></span><span>
</span><span id="line-2062"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.Coercion.Axiom.html#CoAxBranch"><span class="hs-identifier hs-type">CoAxBranch</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">cab_tvs :: CoAxBranch -&gt; [Id]
</span><a href="GHC.Core.Coercion.Axiom.html#cab_tvs"><span class="hs-identifier hs-var">cab_tvs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681124234"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681124234"><span class="hs-identifier hs-var">tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cab_lhs :: CoAxBranch -&gt; [Type]
</span><a href="GHC.Core.Coercion.Axiom.html#cab_lhs"><span class="hs-identifier hs-var">cab_lhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681124233"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124233"><span class="hs-identifier hs-var">lhs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">cab_rhs :: CoAxBranch -&gt; Type
</span><a href="GHC.Core.Coercion.Axiom.html#cab_rhs"><span class="hs-identifier hs-var">cab_rhs</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681124232"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124232"><span class="hs-identifier hs-var">rhs</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">CoAxBranch
</span><a href="#local-6989586621681124236"><span class="hs-identifier hs-var">branch</span></a></span><span>
</span><span id="line-2063"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">FamFlavor
</span><a href="#local-6989586621681124243"><span class="hs-identifier hs-var">flavor</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2064"></span><span>      </span><span class="annot"><span class="annottext">FamFlavor
</span><a href="GHC.Core.FamInstEnv.html#SynFamilyInst"><span class="hs-identifier hs-var">SynFamilyInst</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2065"></span><span>               </span><span class="hs-comment">-- remove kind patterns (#8884)</span><span>
</span><span id="line-2066"></span><span>        </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681124230"><span class="annot"><span class="annottext">Maybe [TyVarBndr ()]
</span><a href="#local-6989586621681124230"><span class="hs-identifier hs-var">th_tvs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; TcM (Maybe [TyVarBndr ()])
</span><a href="GHC.Tc.Gen.Splice.html#reifyTyVarsToMaybe"><span class="hs-identifier hs-var">reifyTyVarsToMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681124234"><span class="hs-identifier hs-var">tvs</span></a></span><span>
</span><span id="line-2067"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681124229"><span class="annot"><span class="annottext">lhs_types_only :: [Type]
</span><a href="#local-6989586621681124229"><span class="hs-identifier hs-var hs-var">lhs_types_only</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; [Type]
</span><a href="GHC.Core.Type.html#filterOutInvisibleTypes"><span class="hs-identifier hs-var">filterOutInvisibleTypes</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124238"><span class="hs-identifier hs-var">fam_tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124233"><span class="hs-identifier hs-var">lhs</span></a></span><span>
</span><span id="line-2068"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681124228"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124228"><span class="hs-identifier hs-var">th_lhs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; TcM [Type]
</span><a href="GHC.Tc.Gen.Splice.html#reifyTypes"><span class="hs-identifier hs-var">reifyTypes</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124229"><span class="hs-identifier hs-var">lhs_types_only</span></a></span><span>
</span><span id="line-2069"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681124227"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124227"><span class="hs-identifier hs-var">annot_th_lhs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Type -&gt; Type -&gt; TcM Type)
-&gt; [Bool] -&gt; [Type] -&gt; [Type] -&gt; TcM [Type]
forall (m :: * -&gt; *) a b c d.
Monad m =&gt;
(a -&gt; b -&gt; c -&gt; m d) -&gt; [a] -&gt; [b] -&gt; [c] -&gt; m [d]
</span><a href="GHC.Utils.Monad.html#zipWith3M"><span class="hs-identifier hs-var">zipWith3M</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Type -&gt; Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#annotThType"><span class="hs-identifier hs-var">annotThType</span></a></span><span> </span><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621681124246"><span class="hs-identifier hs-var">is_poly_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124229"><span class="hs-identifier hs-var">lhs_types_only</span></a></span><span>
</span><span id="line-2070"></span><span>                                                   </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124228"><span class="hs-identifier hs-var">th_lhs</span></a></span><span>
</span><span id="line-2071"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681124226"><span class="annot"><span class="annottext">lhs_type :: Type
</span><a href="#local-6989586621681124226"><span class="hs-identifier hs-var hs-var">lhs_type</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; [Type] -&gt; Type
</span><a href="GHC.Tc.Gen.Splice.html#mkThAppTs"><span class="hs-identifier hs-var">mkThAppTs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#ConT"><span class="hs-identifier hs-var">TH.ConT</span></a></span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Type) -&gt; Name -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124239"><span class="hs-identifier hs-var">fam</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124227"><span class="hs-identifier hs-var">annot_th_lhs</span></a></span><span>
</span><span id="line-2072"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681124225"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124225"><span class="hs-identifier hs-var">th_rhs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124232"><span class="hs-identifier hs-var">rhs</span></a></span><span>
</span><span id="line-2073"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Dec -&gt; IOEnv (Env TcGblEnv TcLclEnv) Dec
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TySynEqn -&gt; Dec
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#TySynInstD"><span class="hs-identifier hs-var">TH.TySynInstD</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe [TyVarBndr ()] -&gt; Type -&gt; Type -&gt; TySynEqn
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#TySynEqn"><span class="hs-identifier hs-var">TH.TySynEqn</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [TyVarBndr ()]
</span><a href="#local-6989586621681124230"><span class="hs-identifier hs-var">th_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124226"><span class="hs-identifier hs-var">lhs_type</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124225"><span class="hs-identifier hs-var">th_rhs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2074"></span><span>
</span><span id="line-2075"></span><span>      </span><span class="annot"><a href="GHC.Core.FamInstEnv.html#DataFamilyInst"><span class="hs-identifier hs-type">DataFamilyInst</span></a></span><span> </span><span id="local-6989586621681124223"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124223"><span class="hs-identifier hs-var">rep_tc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2076"></span><span>        </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-comment">-- eta-expand lhs types, because sometimes data/newtype</span><span>
</span><span id="line-2077"></span><span>                 </span><span class="hs-comment">-- instances are eta-reduced; See #9692</span><span>
</span><span id="line-2078"></span><span>                 </span><span class="hs-comment">-- See Note [Eta reduction for data families] in GHC.Core.Coercion.Axiom</span><span>
</span><span id="line-2079"></span><span>                 </span><span class="hs-special">(</span><span id="local-6989586621681124222"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681124222"><span class="hs-identifier hs-var">ee_tvs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681124221"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124221"><span class="hs-identifier hs-var">ee_lhs</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoAxBranch -&gt; ([Id], [Type], Type)
</span><a href="GHC.Core.Coercion.html#etaExpandCoAxBranch"><span class="hs-identifier hs-var">etaExpandCoAxBranch</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxBranch
</span><a href="#local-6989586621681124236"><span class="hs-identifier hs-var">branch</span></a></span><span>
</span><span id="line-2080"></span><span>                 </span><span id="local-6989586621681124220"><span class="annot"><span class="annottext">fam' :: Name
</span><a href="#local-6989586621681124220"><span class="hs-identifier hs-var hs-var">fam'</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124239"><span class="hs-identifier hs-var">fam</span></a></span><span>
</span><span id="line-2081"></span><span>                 </span><span id="local-6989586621681124219"><span class="annot"><span class="annottext">dataCons :: [DataCon]
</span><a href="#local-6989586621681124219"><span class="hs-identifier hs-var hs-var">dataCons</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [DataCon]
</span><a href="GHC.Core.TyCon.html#tyConDataCons"><span class="hs-identifier hs-var">tyConDataCons</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124223"><span class="hs-identifier hs-var">rep_tc</span></a></span><span>
</span><span id="line-2082"></span><span>                 </span><span id="local-6989586621681124218"><span class="annot"><span class="annottext">isGadt :: Bool
</span><a href="#local-6989586621681124218"><span class="hs-identifier hs-var hs-var">isGadt</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isGadtSyntaxTyCon"><span class="hs-identifier hs-var">isGadtSyntaxTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124223"><span class="hs-identifier hs-var">rep_tc</span></a></span><span>
</span><span id="line-2083"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681124217"><span class="annot"><span class="annottext">Maybe [TyVarBndr ()]
</span><a href="#local-6989586621681124217"><span class="hs-identifier hs-var">th_tvs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; TcM (Maybe [TyVarBndr ()])
</span><a href="GHC.Tc.Gen.Splice.html#reifyTyVarsToMaybe"><span class="hs-identifier hs-var">reifyTyVarsToMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681124222"><span class="hs-identifier hs-var">ee_tvs</span></a></span><span>
</span><span id="line-2084"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681124216"><span class="annot"><span class="annottext">[Con]
</span><a href="#local-6989586621681124216"><span class="hs-identifier hs-var">cons</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(DataCon -&gt; IOEnv (Env TcGblEnv TcLclEnv) Con)
-&gt; [DataCon] -&gt; IOEnv (Env TcGblEnv TcLclEnv) [Con]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; [Type] -&gt; DataCon -&gt; IOEnv (Env TcGblEnv TcLclEnv) Con
</span><a href="GHC.Tc.Gen.Splice.html#reifyDataCon"><span class="hs-identifier hs-var">reifyDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681124218"><span class="hs-identifier hs-var">isGadt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Id] -&gt; [Type]
</span><a href="GHC.Core.TyCo.Rep.html#mkTyVarTys"><span class="hs-identifier hs-var">mkTyVarTys</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681124222"><span class="hs-identifier hs-var">ee_tvs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[DataCon]
</span><a href="#local-6989586621681124219"><span class="hs-identifier hs-var">dataCons</span></a></span><span>
</span><span id="line-2085"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681124215"><span class="annot"><span class="annottext">types_only :: [Type]
</span><a href="#local-6989586621681124215"><span class="hs-identifier hs-var hs-var">types_only</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; [Type]
</span><a href="GHC.Core.Type.html#filterOutInvisibleTypes"><span class="hs-identifier hs-var">filterOutInvisibleTypes</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124238"><span class="hs-identifier hs-var">fam_tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124221"><span class="hs-identifier hs-var">ee_lhs</span></a></span><span>
</span><span id="line-2086"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681124214"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124214"><span class="hs-identifier hs-var">th_tys</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; TcM [Type]
</span><a href="GHC.Tc.Gen.Splice.html#reifyTypes"><span class="hs-identifier hs-var">reifyTypes</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124215"><span class="hs-identifier hs-var">types_only</span></a></span><span>
</span><span id="line-2087"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681124213"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124213"><span class="hs-identifier hs-var">annot_th_tys</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Type -&gt; Type -&gt; TcM Type)
-&gt; [Bool] -&gt; [Type] -&gt; [Type] -&gt; TcM [Type]
forall (m :: * -&gt; *) a b c d.
Monad m =&gt;
(a -&gt; b -&gt; c -&gt; m d) -&gt; [a] -&gt; [b] -&gt; [c] -&gt; m [d]
</span><a href="GHC.Utils.Monad.html#zipWith3M"><span class="hs-identifier hs-var">zipWith3M</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Type -&gt; Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#annotThType"><span class="hs-identifier hs-var">annotThType</span></a></span><span> </span><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621681124246"><span class="hs-identifier hs-var">is_poly_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124215"><span class="hs-identifier hs-var">types_only</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124214"><span class="hs-identifier hs-var">th_tys</span></a></span><span>
</span><span id="line-2088"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681124212"><span class="annot"><span class="annottext">lhs_type :: Type
</span><a href="#local-6989586621681124212"><span class="hs-identifier hs-var hs-var">lhs_type</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; [Type] -&gt; Type
</span><a href="GHC.Tc.Gen.Splice.html#mkThAppTs"><span class="hs-identifier hs-var">mkThAppTs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#ConT"><span class="hs-identifier hs-var">TH.ConT</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124220"><span class="hs-identifier hs-var">fam'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124213"><span class="hs-identifier hs-var">annot_th_tys</span></a></span><span>
</span><span id="line-2089"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681124211"><span class="annot"><span class="annottext">Maybe Type
</span><a href="#local-6989586621681124211"><span class="hs-identifier hs-var">mb_sig</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-2090"></span><span>               </span><span class="hs-comment">-- See &quot;Wrinkle: data family instances with return kinds&quot; in</span><span>
</span><span id="line-2091"></span><span>               </span><span class="hs-comment">-- Note [Reified instances and explicit kind signatures]</span><span>
</span><span id="line-2092"></span><span>               </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Con] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[Con]
</span><a href="#local-6989586621681124216"><span class="hs-identifier hs-var">cons</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isGadtSyntaxTyCon"><span class="hs-identifier hs-var">isGadtSyntaxTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124223"><span class="hs-identifier hs-var">rep_tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2093"></span><span>                     </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TyCon -&gt; Arity -&gt; Bool
</span><a href="GHC.Core.Type.html#tyConAppNeedsKindSig"><span class="hs-identifier hs-var">tyConAppNeedsKindSig</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124238"><span class="hs-identifier hs-var">fam_tc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Type] -&gt; Arity
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Arity
</span><a href="../../base/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124221"><span class="hs-identifier hs-var">ee_lhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2094"></span><span>               </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681124209"><span class="annot"><span class="annottext">full_kind :: Type
</span><a href="#local-6989586621681124209"><span class="hs-identifier hs-var hs-var">full_kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
Type -&gt; Type
</span><a href="GHC.Core.Type.html#tcTypeKind"><span class="hs-identifier hs-var">tcTypeKind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124238"><span class="hs-identifier hs-var">fam_tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124221"><span class="hs-identifier hs-var">ee_lhs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2095"></span><span>                       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681124208"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124208"><span class="hs-identifier hs-var">th_full_kind</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyKind"><span class="hs-identifier hs-var">reifyKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124209"><span class="hs-identifier hs-var">full_kind</span></a></span><span>
</span><span id="line-2096"></span><span>                       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Maybe Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe Type)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe Type))
-&gt; Maybe Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe Type)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Maybe Type
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124208"><span class="hs-identifier hs-var">th_full_kind</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2097"></span><span>               </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) (Maybe Type)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Type
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-2098"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Dec -&gt; IOEnv (Env TcGblEnv TcLclEnv) Dec
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Dec -&gt; IOEnv (Env TcGblEnv TcLclEnv) Dec)
-&gt; Dec -&gt; IOEnv (Env TcGblEnv TcLclEnv) Dec
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2099"></span><span>               </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isNewTyCon"><span class="hs-identifier hs-var">isNewTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124223"><span class="hs-identifier hs-var">rep_tc</span></a></span><span>
</span><span id="line-2100"></span><span>               </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[Type]
-&gt; Maybe [TyVarBndr ()]
-&gt; Type
-&gt; Maybe Type
-&gt; Con
-&gt; [DerivClause]
-&gt; Dec
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#NewtypeInstD"><span class="hs-identifier hs-var">TH.NewtypeInstD</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Maybe [TyVarBndr ()]
</span><a href="#local-6989586621681124217"><span class="hs-identifier hs-var">th_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124212"><span class="hs-identifier hs-var">lhs_type</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Type
</span><a href="#local-6989586621681124211"><span class="hs-identifier hs-var">mb_sig</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Con] -&gt; Con
forall a. [a] -&gt; a
</span><a href="../../base/src/GHC.List.html#head"><span class="hs-identifier hs-var">head</span></a></span><span> </span><span class="annot"><span class="annottext">[Con]
</span><a href="#local-6989586621681124216"><span class="hs-identifier hs-var">cons</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2101"></span><span>               </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[Type]
-&gt; Maybe [TyVarBndr ()]
-&gt; Type
-&gt; Maybe Type
-&gt; [Con]
-&gt; [DerivClause]
-&gt; Dec
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#DataInstD"><span class="hs-identifier hs-var">TH.DataInstD</span></a></span><span>    </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Maybe [TyVarBndr ()]
</span><a href="#local-6989586621681124217"><span class="hs-identifier hs-var">th_tvs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124212"><span class="hs-identifier hs-var">lhs_type</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Type
</span><a href="#local-6989586621681124211"><span class="hs-identifier hs-var">mb_sig</span></a></span><span>       </span><span class="annot"><span class="annottext">[Con]
</span><a href="#local-6989586621681124216"><span class="hs-identifier hs-var">cons</span></a></span><span>  </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2102"></span><span>           </span><span class="hs-special">}</span><span>
</span><span id="line-2103"></span><span>
</span><span id="line-2104"></span><span class="hs-comment">------------------------------</span><span>
</span><span id="line-2105"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-type">reifyType</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">TyCoRep.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Type"><span class="hs-identifier hs-type">TH.Type</span></a></span><span>
</span><span id="line-2106"></span><span class="hs-comment">-- Monadic only because of failure</span><span>
</span><span id="line-2107"></span><span id="reifyType"><span class="annot"><span class="annottext">reifyType :: Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var hs-var">reifyType</span></a></span></span><span> </span><span id="local-6989586621681124205"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124205"><span class="hs-identifier hs-var">ty</span></a></span></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Type -&gt; Bool
</span><a href="GHC.Core.Type.html#tcIsLiftedTypeKind"><span class="hs-identifier hs-var">tcIsLiftedTypeKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124205"><span class="hs-identifier hs-var">ty</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#StarT"><span class="hs-identifier hs-var">TH.StarT</span></a></span><span>
</span><span id="line-2108"></span><span>  </span><span class="hs-comment">-- Make sure to use tcIsLiftedTypeKind here, since we don't want to confuse it</span><span>
</span><span id="line-2109"></span><span>  </span><span class="hs-comment">-- with Constraint (#14869).</span><span>
</span><span id="line-2110"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span> </span><span id="local-6989586621681124202"><span class="annot"><span class="annottext">ty :: Type
</span><a href="#local-6989586621681124202"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ForAllTy"><span class="hs-identifier hs-type">ForAllTy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-type">Bndr</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681124200"><span class="annot"><span class="annottext">ArgFlag
</span><a href="#local-6989586621681124200"><span class="hs-identifier hs-var">argf</span></a></span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Type
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-2111"></span><span>                            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArgFlag -&gt; Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reify_for_all"><span class="hs-identifier hs-var">reify_for_all</span></a></span><span> </span><span class="annot"><span class="annottext">ArgFlag
</span><a href="#local-6989586621681124200"><span class="hs-identifier hs-var">argf</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124202"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-2112"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#LitTy"><span class="hs-identifier hs-type">LitTy</span></a></span><span> </span><span id="local-6989586621681124197"><span class="annot"><span class="annottext">TyLit
</span><a href="#local-6989586621681124197"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681124196"><span class="annot"><span class="annottext">TyLit
</span><a href="#local-6989586621681124196"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TyLit -&gt; TcM TyLit
</span><a href="GHC.Tc.Gen.Splice.html#reifyTyLit"><span class="hs-identifier hs-var">reifyTyLit</span></a></span><span> </span><span class="annot"><span class="annottext">TyLit
</span><a href="#local-6989586621681124197"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyLit -&gt; Type
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#LitT"><span class="hs-identifier hs-var">TH.LitT</span></a></span><span> </span><span class="annot"><span class="annottext">TyLit
</span><a href="#local-6989586621681124196"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2113"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyVarTy"><span class="hs-identifier hs-type">TyVarTy</span></a></span><span> </span><span id="local-6989586621681124192"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681124192"><span class="hs-identifier hs-var">tv</span></a></span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Type
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#VarT"><span class="hs-identifier hs-var">TH.VarT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681124192"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2114"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyConApp"><span class="hs-identifier hs-type">TyConApp</span></a></span><span> </span><span id="local-6989586621681124190"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124190"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621681124189"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124189"><span class="hs-identifier hs-var">tys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reify_tc_app"><span class="hs-identifier hs-var">reify_tc_app</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124190"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124189"><span class="hs-identifier hs-var">tys</span></a></span><span>   </span><span class="hs-comment">-- Do not expand type synonyms here</span><span>
</span><span id="line-2115"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span> </span><span id="local-6989586621681124187"><span class="annot"><span class="annottext">ty :: Type
</span><a href="#local-6989586621681124187"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AppTy"><span class="hs-identifier hs-type">AppTy</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2116"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681124185"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124185"><span class="hs-identifier hs-var">ty_head</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681124184"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124184"><span class="hs-identifier hs-var">ty_args</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; (Type, [Type])
</span><a href="GHC.Core.Type.html#splitAppTys"><span class="hs-identifier hs-var">splitAppTys</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124187"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-2117"></span><span>  </span><span id="local-6989586621681124182"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124182"><span class="hs-identifier hs-var">ty_head'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124185"><span class="hs-identifier hs-var">ty_head</span></a></span><span>
</span><span id="line-2118"></span><span>  </span><span id="local-6989586621681124181"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124181"><span class="hs-identifier hs-var">ty_args'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; TcM [Type]
</span><a href="GHC.Tc.Gen.Splice.html#reifyTypes"><span class="hs-identifier hs-var">reifyTypes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; [Type] -&gt; [Type]
</span><a href="#local-6989586621681124180"><span class="hs-identifier hs-var">filter_out_invisible_args</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124185"><span class="hs-identifier hs-var">ty_head</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124184"><span class="hs-identifier hs-var">ty_args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2119"></span><span>  </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; TcM Type) -&gt; Type -&gt; TcM Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; [Type] -&gt; Type
</span><a href="GHC.Tc.Gen.Splice.html#mkThAppTs"><span class="hs-identifier hs-var">mkThAppTs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124182"><span class="hs-identifier hs-var">ty_head'</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124181"><span class="hs-identifier hs-var">ty_args'</span></a></span><span>
</span><span id="line-2120"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2121"></span><span>    </span><span class="hs-comment">-- Make sure to filter out any invisible arguments. For instance, if you</span><span>
</span><span id="line-2122"></span><span>    </span><span class="hs-comment">-- reify the following:</span><span>
</span><span id="line-2123"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-2124"></span><span>    </span><span class="hs-comment">--   newtype T (f :: forall a. a -&gt; Type) = MkT (f Bool)</span><span>
</span><span id="line-2125"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-2126"></span><span>    </span><span class="hs-comment">-- Then you should receive back `f Bool`, not `f Type Bool`, since the</span><span>
</span><span id="line-2127"></span><span>    </span><span class="hs-comment">-- `Type` argument is invisible (#15792).</span><span>
</span><span id="line-2128"></span><span>    </span><span class="annot"><a href="#local-6989586621681124180"><span class="hs-identifier hs-type">filter_out_invisible_args</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2129"></span><span>    </span><span id="local-6989586621681124180"><span class="annot"><span class="annottext">filter_out_invisible_args :: Type -&gt; [Type] -&gt; [Type]
</span><a href="#local-6989586621681124180"><span class="hs-identifier hs-var hs-var">filter_out_invisible_args</span></a></span></span><span> </span><span id="local-6989586621681124179"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124179"><span class="hs-identifier hs-var">ty_head</span></a></span></span><span> </span><span id="local-6989586621681124178"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124178"><span class="hs-identifier hs-var">ty_args</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2130"></span><span>      </span><span class="annot"><span class="annottext">[Bool] -&gt; [Type] -&gt; [Type]
forall a. [Bool] -&gt; [a] -&gt; [a]
</span><a href="GHC.Utils.Misc.html#filterByList"><span class="hs-identifier hs-var">filterByList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ArgFlag -&gt; Bool) -&gt; [ArgFlag] -&gt; [Bool]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">ArgFlag -&gt; Bool
</span><a href="GHC.Types.Var.html#isVisibleArgFlag"><span class="hs-identifier hs-var">isVisibleArgFlag</span></a></span><span> </span><span class="annot"><span class="annottext">([ArgFlag] -&gt; [Bool]) -&gt; [ArgFlag] -&gt; [Bool]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; [Type] -&gt; [ArgFlag]
</span><a href="GHC.Core.Type.html#appTyArgFlags"><span class="hs-identifier hs-var">appTyArgFlags</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124179"><span class="hs-identifier hs-var">ty_head</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124178"><span class="hs-identifier hs-var">ty_args</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2131"></span><span>                   </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124178"><span class="hs-identifier hs-var">ty_args</span></a></span><span>
</span><span id="line-2132"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span> </span><span id="local-6989586621681124175"><span class="annot"><span class="annottext">ty :: Type
</span><a href="#local-6989586621681124175"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#FunTy"><span class="hs-identifier hs-type">FunTy</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ft_af :: Type -&gt; AnonArgFlag
</span><a href="GHC.Core.TyCo.Rep.html#ft_af"><span class="hs-identifier hs-var">ft_af</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681124172"><span class="annot"><span class="annottext">AnonArgFlag
</span><a href="#local-6989586621681124172"><span class="hs-identifier hs-var">af</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ft_mult :: Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#ft_mult"><span class="hs-identifier hs-var">ft_mult</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="GHC.Core.Type.html#Many"><span class="hs-identifier hs-var">Many</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ft_arg :: Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#ft_arg"><span class="hs-identifier hs-var">ft_arg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681124169"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124169"><span class="hs-identifier hs-var">t1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ft_res :: Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#ft_res"><span class="hs-identifier hs-var">ft_res</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681124167"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124167"><span class="hs-identifier hs-var">t2</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-2133"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">AnonArgFlag
</span><a href="GHC.Types.Var.html#InvisArg"><span class="hs-identifier hs-var">InvisArg</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">AnonArgFlag
</span><a href="#local-6989586621681124172"><span class="hs-identifier hs-var">af</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ArgFlag -&gt; Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reify_for_all"><span class="hs-identifier hs-var">reify_for_all</span></a></span><span> </span><span class="annot"><span class="annottext">ArgFlag
</span><a href="GHC.Types.Var.html#Inferred"><span class="hs-identifier hs-var">Inferred</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124175"><span class="hs-identifier hs-var">ty</span></a></span><span>  </span><span class="hs-comment">-- Types like ((?x::Int) =&gt; Char -&gt; Char)</span><span>
</span><span id="line-2134"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">[</span><span id="local-6989586621681124164"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124164"><span class="hs-identifier hs-var">r1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681124163"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124163"><span class="hs-identifier hs-var">r2</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; TcM [Type]
</span><a href="GHC.Tc.Gen.Splice.html#reifyTypes"><span class="hs-identifier hs-var">reifyTypes</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124169"><span class="hs-identifier hs-var">t1</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124167"><span class="hs-identifier hs-var">t2</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2135"></span><span>                        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#ArrowT"><span class="hs-identifier hs-var">TH.ArrowT</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#AppT"><span class="hs-operator hs-var">`TH.AppT`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124164"><span class="hs-identifier hs-var">r1</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#AppT"><span class="hs-operator hs-var">`TH.AppT`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124163"><span class="hs-identifier hs-var">r2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2136"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span> </span><span id="local-6989586621681124160"><span class="annot"><span class="annottext">ty :: Type
</span><a href="#local-6989586621681124160"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#FunTy"><span class="hs-identifier hs-type">FunTy</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ft_af :: Type -&gt; AnonArgFlag
</span><a href="GHC.Core.TyCo.Rep.html#ft_af"><span class="hs-identifier hs-var">ft_af</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681124159"><span class="annot"><span class="annottext">AnonArgFlag
</span><a href="#local-6989586621681124159"><span class="hs-identifier hs-var">af</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ft_mult :: Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#ft_mult"><span class="hs-identifier hs-var">ft_mult</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681124158"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124158"><span class="hs-identifier hs-var">tm</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ft_arg :: Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#ft_arg"><span class="hs-identifier hs-var">ft_arg</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681124157"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124157"><span class="hs-identifier hs-var">t1</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ft_res :: Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#ft_res"><span class="hs-identifier hs-var">ft_res</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681124156"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124156"><span class="hs-identifier hs-var">t2</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-2137"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">AnonArgFlag
</span><a href="GHC.Types.Var.html#InvisArg"><span class="hs-identifier hs-var">InvisArg</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">AnonArgFlag
</span><a href="#local-6989586621681124159"><span class="hs-identifier hs-var">af</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PtrString -&gt; MsgDoc -&gt; TcM Type
forall a. PtrString -&gt; MsgDoc -&gt; TcM a
</span><a href="GHC.Tc.Gen.Splice.html#noTH"><span class="hs-identifier hs-var">noTH</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; PtrString
</span><a href="GHC.Data.FastString.html#sLit"><span class="hs-identifier hs-var">sLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;linear invisible argument&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; MsgDoc
forall a. Outputable a =&gt; a -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124160"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2138"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">[</span><span id="local-6989586621681124154"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124154"><span class="hs-identifier hs-var">rm</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681124153"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124153"><span class="hs-identifier hs-var">r1</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681124152"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124152"><span class="hs-identifier hs-var">r2</span></a></span></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; TcM [Type]
</span><a href="GHC.Tc.Gen.Splice.html#reifyTypes"><span class="hs-identifier hs-var">reifyTypes</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124158"><span class="hs-identifier hs-var">tm</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124157"><span class="hs-identifier hs-var">t1</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124156"><span class="hs-identifier hs-var">t2</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2139"></span><span>                        </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#MulArrowT"><span class="hs-identifier hs-var">TH.MulArrowT</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#AppT"><span class="hs-operator hs-var">`TH.AppT`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124154"><span class="hs-identifier hs-var">rm</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#AppT"><span class="hs-operator hs-var">`TH.AppT`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124153"><span class="hs-identifier hs-var">r1</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#AppT"><span class="hs-operator hs-var">`TH.AppT`</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124152"><span class="hs-identifier hs-var">r2</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2140"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CastTy"><span class="hs-identifier hs-type">CastTy</span></a></span><span> </span><span id="local-6989586621681124149"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124149"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="annot"><span class="annottext">KindCoercion
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124149"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="hs-comment">-- Casts are ignored in TH</span><span>
</span><span id="line-2141"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span> </span><span id="local-6989586621681124148"><span class="annot"><span class="annottext">ty :: Type
</span><a href="#local-6989586621681124148"><span class="hs-identifier hs-var">ty</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#CoercionTy"><span class="hs-identifier hs-type">CoercionTy</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PtrString -&gt; MsgDoc -&gt; TcM Type
forall a. PtrString -&gt; MsgDoc -&gt; TcM a
</span><a href="GHC.Tc.Gen.Splice.html#noTH"><span class="hs-identifier hs-var">noTH</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; PtrString
</span><a href="GHC.Data.FastString.html#sLit"><span class="hs-identifier hs-var">sLit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;coercions in types&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; MsgDoc
forall a. Outputable a =&gt; a -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124148"><span class="hs-identifier hs-var">ty</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2142"></span><span>
</span><span id="line-2143"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reify_for_all"><span class="hs-identifier hs-type">reify_for_all</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#ArgFlag"><span class="hs-identifier hs-type">TyCoRep.ArgFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">TyCoRep.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Type"><span class="hs-identifier hs-type">TH.Type</span></a></span><span>
</span><span id="line-2144"></span><span class="hs-comment">-- Arg of reify_for_all is always ForAllTy or a predicate FunTy</span><span>
</span><span id="line-2145"></span><span id="reify_for_all"><span class="annot"><span class="annottext">reify_for_all :: ArgFlag -&gt; Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reify_for_all"><span class="hs-identifier hs-var hs-var">reify_for_all</span></a></span></span><span> </span><span id="local-6989586621681124146"><span class="annot"><span class="annottext">ArgFlag
</span><a href="#local-6989586621681124146"><span class="hs-identifier hs-var">argf</span></a></span></span><span> </span><span id="local-6989586621681124145"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124145"><span class="hs-identifier hs-var">ty</span></a></span></span><span>
</span><span id="line-2146"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ArgFlag -&gt; Bool
</span><a href="GHC.Types.Var.html#isVisibleArgFlag"><span class="hs-identifier hs-var">isVisibleArgFlag</span></a></span><span> </span><span class="annot"><span class="annottext">ArgFlag
</span><a href="#local-6989586621681124146"><span class="hs-identifier hs-var">argf</span></a></span><span>
</span><span id="line-2147"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681124144"><span class="annot"><span class="annottext">[TcReqTVBinder]
</span><a href="#local-6989586621681124144"><span class="hs-identifier hs-var">req_bndrs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681124143"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124143"><span class="hs-identifier hs-var">phi</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ([TcReqTVBinder], Type)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitForAllTysReq"><span class="hs-identifier hs-var">tcSplitForAllTysReq</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124145"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-2148"></span><span>       </span><span id="local-6989586621681124141"><span class="annot"><span class="annottext">[TyVarBndr ()]
</span><a href="#local-6989586621681124141"><span class="hs-identifier hs-var">tvbndrs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[TcReqTVBinder] -&gt; TcM [TyVarBndr ()]
forall flag flag'.
ReifyFlag flag flag' =&gt;
[VarBndr Id flag] -&gt; TcM [TyVarBndr flag']
</span><a href="GHC.Tc.Gen.Splice.html#reifyTyVarBndrs"><span class="hs-identifier hs-var">reifyTyVarBndrs</span></a></span><span> </span><span class="annot"><span class="annottext">[TcReqTVBinder]
</span><a href="#local-6989586621681124144"><span class="hs-identifier hs-var">req_bndrs</span></a></span><span>
</span><span id="line-2149"></span><span>       </span><span id="local-6989586621681124140"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124140"><span class="hs-identifier hs-var">phi'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124143"><span class="hs-identifier hs-var">phi</span></a></span><span>
</span><span id="line-2150"></span><span>       </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; TcM Type) -&gt; Type -&gt; TcM Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndr ()] -&gt; Type -&gt; Type
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#ForallVisT"><span class="hs-identifier hs-var">TH.ForallVisT</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndr ()]
</span><a href="#local-6989586621681124141"><span class="hs-identifier hs-var">tvbndrs'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124140"><span class="hs-identifier hs-var">phi'</span></a></span><span>
</span><span id="line-2151"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-2152"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681124138"><span class="annot"><span class="annottext">[InvisTVBinder]
</span><a href="#local-6989586621681124138"><span class="hs-identifier hs-var">inv_bndrs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681124137"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124137"><span class="hs-identifier hs-var">phi</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ([InvisTVBinder], Type)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitForAllTysInvis"><span class="hs-identifier hs-var">tcSplitForAllTysInvis</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124145"><span class="hs-identifier hs-var">ty</span></a></span><span>
</span><span id="line-2153"></span><span>       </span><span id="local-6989586621681124135"><span class="annot"><span class="annottext">[TyVarBndr Specificity]
</span><a href="#local-6989586621681124135"><span class="hs-identifier hs-var">tvbndrs'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[InvisTVBinder] -&gt; TcM [TyVarBndr Specificity]
forall flag flag'.
ReifyFlag flag flag' =&gt;
[VarBndr Id flag] -&gt; TcM [TyVarBndr flag']
</span><a href="GHC.Tc.Gen.Splice.html#reifyTyVarBndrs"><span class="hs-identifier hs-var">reifyTyVarBndrs</span></a></span><span> </span><span class="annot"><span class="annottext">[InvisTVBinder]
</span><a href="#local-6989586621681124138"><span class="hs-identifier hs-var">inv_bndrs</span></a></span><span>
</span><span id="line-2154"></span><span>       </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681124134"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124134"><span class="hs-identifier hs-var">cxt</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681124133"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124133"><span class="hs-identifier hs-var">tau</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; ([Type], Type)
</span><a href="GHC.Tc.Utils.TcType.html#tcSplitPhiTy"><span class="hs-identifier hs-var">tcSplitPhiTy</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124137"><span class="hs-identifier hs-var">phi</span></a></span><span>
</span><span id="line-2155"></span><span>       </span><span id="local-6989586621681124131"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124131"><span class="hs-identifier hs-var">cxt'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; TcM [Type]
</span><a href="GHC.Tc.Gen.Splice.html#reifyCxt"><span class="hs-identifier hs-var">reifyCxt</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124134"><span class="hs-identifier hs-var">cxt</span></a></span><span>
</span><span id="line-2156"></span><span>       </span><span id="local-6989586621681124130"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124130"><span class="hs-identifier hs-var">tau'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124133"><span class="hs-identifier hs-var">tau</span></a></span><span>
</span><span id="line-2157"></span><span>       </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; TcM Type) -&gt; Type -&gt; TcM Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndr Specificity] -&gt; [Type] -&gt; Type -&gt; Type
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#ForallT"><span class="hs-identifier hs-var">TH.ForallT</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndr Specificity]
</span><a href="#local-6989586621681124135"><span class="hs-identifier hs-var">tvbndrs'</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124131"><span class="hs-identifier hs-var">cxt'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124130"><span class="hs-identifier hs-var">tau'</span></a></span><span>
</span><span id="line-2158"></span><span>
</span><span id="line-2159"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyTyLit"><span class="hs-identifier hs-type">reifyTyLit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#TyLit"><span class="hs-identifier hs-type">TyCoRep.TyLit</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#TyLit"><span class="hs-identifier hs-type">TH.TyLit</span></a></span><span>
</span><span id="line-2160"></span><span id="reifyTyLit"><span class="annot"><span class="annottext">reifyTyLit :: TyLit -&gt; TcM TyLit
</span><a href="GHC.Tc.Gen.Splice.html#reifyTyLit"><span class="hs-identifier hs-var hs-var">reifyTyLit</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#NumTyLit"><span class="hs-identifier hs-type">NumTyLit</span></a></span><span> </span><span id="local-6989586621681124127"><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621681124127"><span class="hs-identifier hs-var">n</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyLit -&gt; TcM TyLit
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Integer -&gt; TyLit
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#NumTyLit"><span class="hs-identifier hs-var">TH.NumTyLit</span></a></span><span> </span><span class="annot"><span class="annottext">Integer
</span><a href="#local-6989586621681124127"><span class="hs-identifier hs-var">n</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2161"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyTyLit"><span class="hs-identifier hs-var">reifyTyLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#StrTyLit"><span class="hs-identifier hs-type">StrTyLit</span></a></span><span> </span><span id="local-6989586621681124124"><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621681124124"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyLit -&gt; TcM TyLit
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; TyLit
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#StrTyLit"><span class="hs-identifier hs-var">TH.StrTyLit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FastString -&gt; String
</span><a href="GHC.Data.FastString.html#unpackFS"><span class="hs-identifier hs-var">unpackFS</span></a></span><span> </span><span class="annot"><span class="annottext">FastString
</span><a href="#local-6989586621681124124"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2162"></span><span>
</span><span id="line-2163"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyTypes"><span class="hs-identifier hs-type">reifyTypes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Type"><span class="hs-identifier hs-type">TH.Type</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2164"></span><span id="reifyTypes"><span class="annot"><span class="annottext">reifyTypes :: [Type] -&gt; TcM [Type]
</span><a href="GHC.Tc.Gen.Splice.html#reifyTypes"><span class="hs-identifier hs-var hs-var">reifyTypes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; TcM Type) -&gt; [Type] -&gt; TcM [Type]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span>
</span><span id="line-2165"></span><span>
</span><span id="line-2166"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyPatSynType"><span class="hs-identifier hs-type">reifyPatSynType</span></a></span><span>
</span><span id="line-2167"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#InvisTVBinder"><span class="hs-identifier hs-type">InvisTVBinder</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ThetaType"><span class="hs-identifier hs-type">ThetaType</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#InvisTVBinder"><span class="hs-identifier hs-type">InvisTVBinder</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ThetaType"><span class="hs-identifier hs-type">ThetaType</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Scaled"><span class="hs-identifier hs-type">Scaled</span></a></span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Type"><span class="hs-identifier hs-type">TH.Type</span></a></span><span>
</span><span id="line-2168"></span><span class="hs-comment">-- reifies a pattern synonym's type and returns its *complete* type</span><span>
</span><span id="line-2169"></span><span class="hs-comment">-- signature; see NOTE [Pattern synonym signatures and Template</span><span>
</span><span id="line-2170"></span><span class="hs-comment">-- Haskell]</span><span>
</span><span id="line-2171"></span><span id="reifyPatSynType"><span class="annot"><span class="annottext">reifyPatSynType :: ([InvisTVBinder], [Type], [InvisTVBinder], [Type], [Scaled Type],
 Type)
-&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyPatSynType"><span class="hs-identifier hs-var hs-var">reifyPatSynType</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681124121"><span class="annot"><span class="annottext">[InvisTVBinder]
</span><a href="#local-6989586621681124121"><span class="hs-identifier hs-var">univTyVars</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681124120"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124120"><span class="hs-identifier hs-var">req</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681124119"><span class="annot"><span class="annottext">[InvisTVBinder]
</span><a href="#local-6989586621681124119"><span class="hs-identifier hs-var">exTyVars</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681124118"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124118"><span class="hs-identifier hs-var">prov</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681124117"><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621681124117"><span class="hs-identifier hs-var">argTys</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681124116"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124116"><span class="hs-identifier hs-var">resTy</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2172"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681124115"><span class="annot"><span class="annottext">[TyVarBndr Specificity]
</span><a href="#local-6989586621681124115"><span class="hs-identifier hs-var">univTyVars'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[InvisTVBinder] -&gt; TcM [TyVarBndr Specificity]
forall flag flag'.
ReifyFlag flag flag' =&gt;
[VarBndr Id flag] -&gt; TcM [TyVarBndr flag']
</span><a href="GHC.Tc.Gen.Splice.html#reifyTyVarBndrs"><span class="hs-identifier hs-var">reifyTyVarBndrs</span></a></span><span> </span><span class="annot"><span class="annottext">[InvisTVBinder]
</span><a href="#local-6989586621681124121"><span class="hs-identifier hs-var">univTyVars</span></a></span><span>
</span><span id="line-2173"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681124114"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124114"><span class="hs-identifier hs-var">req'</span></a></span></span><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; TcM [Type]
</span><a href="GHC.Tc.Gen.Splice.html#reifyCxt"><span class="hs-identifier hs-var">reifyCxt</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124120"><span class="hs-identifier hs-var">req</span></a></span><span>
</span><span id="line-2174"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681124113"><span class="annot"><span class="annottext">[TyVarBndr Specificity]
</span><a href="#local-6989586621681124113"><span class="hs-identifier hs-var">exTyVars'</span></a></span></span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[InvisTVBinder] -&gt; TcM [TyVarBndr Specificity]
forall flag flag'.
ReifyFlag flag flag' =&gt;
[VarBndr Id flag] -&gt; TcM [TyVarBndr flag']
</span><a href="GHC.Tc.Gen.Splice.html#reifyTyVarBndrs"><span class="hs-identifier hs-var">reifyTyVarBndrs</span></a></span><span> </span><span class="annot"><span class="annottext">[InvisTVBinder]
</span><a href="#local-6989586621681124119"><span class="hs-identifier hs-var">exTyVars</span></a></span><span>
</span><span id="line-2175"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681124112"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124112"><span class="hs-identifier hs-var">prov'</span></a></span></span><span>       </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; TcM [Type]
</span><a href="GHC.Tc.Gen.Splice.html#reifyCxt"><span class="hs-identifier hs-var">reifyCxt</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124118"><span class="hs-identifier hs-var">prov</span></a></span><span>
</span><span id="line-2176"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681124111"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124111"><span class="hs-identifier hs-var">tau'</span></a></span></span><span>        </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Scaled Type] -&gt; Type -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkVisFunTys"><span class="hs-identifier hs-var">mkVisFunTys</span></a></span><span> </span><span class="annot"><span class="annottext">[Scaled Type]
</span><a href="#local-6989586621681124117"><span class="hs-identifier hs-var">argTys</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124116"><span class="hs-identifier hs-var">resTy</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2177"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Type -&gt; TcM Type) -&gt; Type -&gt; TcM Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndr Specificity] -&gt; [Type] -&gt; Type -&gt; Type
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#ForallT"><span class="hs-identifier hs-var">TH.ForallT</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndr Specificity]
</span><a href="#local-6989586621681124115"><span class="hs-identifier hs-var">univTyVars'</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124114"><span class="hs-identifier hs-var">req'</span></a></span><span>
</span><span id="line-2178"></span><span>                </span><span class="annot"><span class="annottext">(Type -&gt; Type) -&gt; Type -&gt; Type
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndr Specificity] -&gt; [Type] -&gt; Type -&gt; Type
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#ForallT"><span class="hs-identifier hs-var">TH.ForallT</span></a></span><span> </span><span class="annot"><span class="annottext">[TyVarBndr Specificity]
</span><a href="#local-6989586621681124113"><span class="hs-identifier hs-var">exTyVars'</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124112"><span class="hs-identifier hs-var">prov'</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124111"><span class="hs-identifier hs-var">tau'</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2179"></span><span>
</span><span id="line-2180"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyKind"><span class="hs-identifier hs-type">reifyKind</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Kind"><span class="hs-identifier hs-type">Kind</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Kind"><span class="hs-identifier hs-type">TH.Kind</span></a></span><span>
</span><span id="line-2181"></span><span id="reifyKind"><span class="annot"><span class="annottext">reifyKind :: Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyKind"><span class="hs-identifier hs-var hs-var">reifyKind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span>
</span><span id="line-2182"></span><span>
</span><span id="line-2183"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyCxt"><span class="hs-identifier hs-type">reifyCxt</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#PredType"><span class="hs-identifier hs-type">PredType</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Pred"><span class="hs-identifier hs-type">TH.Pred</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2184"></span><span id="reifyCxt"><span class="annot"><span class="annottext">reifyCxt :: [Type] -&gt; TcM [Type]
</span><a href="GHC.Tc.Gen.Splice.html#reifyCxt"><span class="hs-identifier hs-var hs-var">reifyCxt</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; TcM Type) -&gt; [Type] -&gt; TcM [Type]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span>
</span><span id="line-2185"></span><span>
</span><span id="line-2186"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyFunDep"><span class="hs-identifier hs-type">reifyFunDep</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#FunDep"><span class="hs-identifier hs-type">TH.FunDep</span></a></span><span>
</span><span id="line-2187"></span><span id="reifyFunDep"><span class="annot"><span class="annottext">reifyFunDep :: FunDep Id -&gt; FunDep
</span><a href="GHC.Tc.Gen.Splice.html#reifyFunDep"><span class="hs-identifier hs-var hs-var">reifyFunDep</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681124107"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681124107"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681124106"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681124106"><span class="hs-identifier hs-var">ys</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Name] -&gt; [Name] -&gt; FunDep
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#FunDep"><span class="hs-identifier hs-var">TH.FunDep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Id -&gt; Name) -&gt; [Id] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681124107"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Id -&gt; Name) -&gt; [Id] -&gt; [Name]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681124106"><span class="hs-identifier hs-var">ys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2188"></span><span>
</span><span id="line-2189"></span><span class="hs-keyword">class</span><span> </span><span id="ReifyFlag"><span class="annot"><a href="GHC.Tc.Gen.Splice.html#ReifyFlag"><span class="hs-identifier hs-var">ReifyFlag</span></a></span></span><span> </span><span id="local-6989586621681126374"><span class="annot"><a href="#local-6989586621681126374"><span class="hs-identifier hs-type">flag</span></a></span></span><span> </span><span id="local-6989586621681126373"><span class="annot"><a href="#local-6989586621681126373"><span class="hs-identifier hs-type">flag'</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="#local-6989586621681126374"><span class="hs-identifier hs-type">flag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681126373"><span class="hs-identifier hs-type">flag'</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2190"></span><span>    </span><span id="reifyFlag"><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyFlag"><span class="hs-identifier hs-type">reifyFlag</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621681126374"><span class="hs-identifier hs-type">flag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681126373"><span class="hs-identifier hs-type">flag'</span></a></span><span>
</span><span id="line-2191"></span><span>
</span><span id="line-2192"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#ReifyFlag"><span class="hs-identifier hs-type">ReifyFlag</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2193"></span><span>    </span><span id="local-6989586621681124101"><span class="annot"><span class="annottext">reifyFlag :: () -&gt; ()
</span><a href="#local-6989586621681124101"><span class="hs-identifier hs-var hs-var hs-var hs-var">reifyFlag</span></a></span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2194"></span><span>
</span><span id="line-2195"></span><span class="hs-keyword">instance</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#ReifyFlag"><span class="hs-identifier hs-type">ReifyFlag</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Specificity"><span class="hs-identifier hs-type">Specificity</span></a></span><span> </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Specificity"><span class="hs-identifier hs-type">TH.Specificity</span></a></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-2196"></span><span>    </span><span id="local-6989586621681124099"><span class="annot"><span class="annottext">reifyFlag :: Specificity -&gt; Specificity
</span><a href="#local-6989586621681124099"><span class="hs-identifier hs-var hs-var hs-var hs-var">reifyFlag</span></a></span></span><span> </span><span class="annot"><span class="annottext">Specificity
</span><a href="GHC.Types.Var.html#SpecifiedSpec"><span class="hs-identifier hs-var">SpecifiedSpec</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Specificity
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#SpecifiedSpec"><span class="hs-identifier hs-var">TH.SpecifiedSpec</span></a></span><span>
</span><span id="line-2197"></span><span>    </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyFlag"><span class="hs-identifier hs-var">reifyFlag</span></a></span><span> </span><span class="annot"><span class="annottext">Specificity
</span><a href="GHC.Types.Var.html#InferredSpec"><span class="hs-identifier hs-var">InferredSpec</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Specificity
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#InferredSpec"><span class="hs-identifier hs-var">TH.InferredSpec</span></a></span><span>
</span><span id="line-2198"></span><span>
</span><span id="line-2199"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyTyVars"><span class="hs-identifier hs-type">reifyTyVars</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#TyVarBndr"><span class="hs-identifier hs-type">TH.TyVarBndr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-2200"></span><span id="reifyTyVars"><span class="annot"><span class="annottext">reifyTyVars :: [Id] -&gt; TcM [TyVarBndr ()]
</span><a href="GHC.Tc.Gen.Splice.html#reifyTyVars"><span class="hs-identifier hs-var hs-var">reifyTyVars</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TcReqTVBinder] -&gt; TcM [TyVarBndr ()]
forall flag flag'.
ReifyFlag flag flag' =&gt;
[VarBndr Id flag] -&gt; TcM [TyVarBndr flag']
</span><a href="GHC.Tc.Gen.Splice.html#reifyTyVarBndrs"><span class="hs-identifier hs-var">reifyTyVarBndrs</span></a></span><span> </span><span class="annot"><span class="annottext">([TcReqTVBinder] -&gt; TcM [TyVarBndr ()])
-&gt; ([Id] -&gt; [TcReqTVBinder]) -&gt; [Id] -&gt; TcM [TyVarBndr ()]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(Id -&gt; TcReqTVBinder) -&gt; [Id] -&gt; [TcReqTVBinder]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Id -&gt; TcReqTVBinder
forall {var}. var -&gt; VarBndr var ()
</span><a href="#local-6989586621681124095"><span class="hs-identifier hs-var">mk_bndr</span></a></span><span>
</span><span id="line-2201"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2202"></span><span>    </span><span id="local-6989586621681124095"><span class="annot"><span class="annottext">mk_bndr :: var -&gt; VarBndr var ()
</span><a href="#local-6989586621681124095"><span class="hs-identifier hs-var hs-var">mk_bndr</span></a></span></span><span> </span><span id="local-6989586621681124094"><span class="annot"><span class="annottext">var
</span><a href="#local-6989586621681124094"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">var -&gt; () -&gt; VarBndr var ()
forall var argf. var -&gt; argf -&gt; VarBndr var argf
</span><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-var">Bndr</span></a></span><span> </span><span class="annot"><span class="annottext">var
</span><a href="#local-6989586621681124094"><span class="hs-identifier hs-var">tv</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2203"></span><span>
</span><span id="line-2204"></span><span id="local-6989586621681126410"><span id="local-6989586621681126411"><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyTyVarBndrs"><span class="hs-identifier hs-type">reifyTyVarBndrs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#ReifyFlag"><span class="hs-identifier hs-type">ReifyFlag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681126411"><span class="hs-identifier hs-type">flag</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681126410"><span class="hs-identifier hs-type">flag'</span></a></span><span>
</span><span id="line-2205"></span><span>                </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#VarBndr"><span class="hs-identifier hs-type">VarBndr</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681126411"><span class="hs-identifier hs-type">flag</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#TyVarBndr"><span class="hs-identifier hs-type">TH.TyVarBndr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681126410"><span class="hs-identifier hs-type">flag'</span></a></span><span class="hs-special">]</span></span></span><span>
</span><span id="line-2206"></span><span id="reifyTyVarBndrs"><span class="annot"><span class="annottext">reifyTyVarBndrs :: forall flag flag'.
ReifyFlag flag flag' =&gt;
[VarBndr Id flag] -&gt; TcM [TyVarBndr flag']
</span><a href="GHC.Tc.Gen.Splice.html#reifyTyVarBndrs"><span class="hs-identifier hs-var hs-var">reifyTyVarBndrs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(VarBndr Id flag
 -&gt; IOEnv (Env TcGblEnv TcLclEnv) (TyVarBndr flag'))
-&gt; [VarBndr Id flag]
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [TyVarBndr flag']
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">VarBndr Id flag -&gt; IOEnv (Env TcGblEnv TcLclEnv) (TyVarBndr flag')
forall {flag} {flag}.
ReifyFlag flag flag =&gt;
VarBndr Id flag -&gt; IOEnv (Env TcGblEnv TcLclEnv) (TyVarBndr flag)
</span><a href="#local-6989586621681124089"><span class="hs-identifier hs-var">reify_tvbndr</span></a></span><span>
</span><span id="line-2207"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2208"></span><span>    </span><span class="hs-comment">-- even if the kind is *, we need to include a kind annotation,</span><span>
</span><span id="line-2209"></span><span>    </span><span class="hs-comment">-- in case a poly-kind would be inferred without the annotation.</span><span>
</span><span id="line-2210"></span><span>    </span><span class="hs-comment">-- See #8953 or test th/T8953</span><span>
</span><span id="line-2211"></span><span>    </span><span id="local-6989586621681124089"><span class="annot"><span class="annottext">reify_tvbndr :: VarBndr Id flag -&gt; IOEnv (Env TcGblEnv TcLclEnv) (TyVarBndr flag)
</span><a href="#local-6989586621681124089"><span class="hs-identifier hs-var hs-var">reify_tvbndr</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Var.html#Bndr"><span class="hs-identifier hs-type">Bndr</span></a></span><span> </span><span id="local-6989586621681124084"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681124084"><span class="hs-identifier hs-var">tv</span></a></span></span><span> </span><span id="local-6989586621681124083"><span class="annot"><span class="annottext">flag
</span><a href="#local-6989586621681124083"><span class="hs-identifier hs-var">fl</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; flag -&gt; Type -&gt; TyVarBndr flag
forall flag. Name -&gt; flag -&gt; Type -&gt; TyVarBndr flag
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#KindedTV"><span class="hs-identifier hs-var">TH.KindedTV</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681124084"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2212"></span><span>                                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">flag -&gt; flag
forall flag flag'. ReifyFlag flag flag' =&gt; flag -&gt; flag'
</span><a href="GHC.Tc.Gen.Splice.html#reifyFlag"><span class="hs-identifier hs-var">reifyFlag</span></a></span><span> </span><span class="annot"><span class="annottext">flag
</span><a href="#local-6989586621681124083"><span class="hs-identifier hs-var">fl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2213"></span><span>                                            </span><span class="annot"><span class="annottext">(Type -&gt; TyVarBndr flag)
-&gt; TcM Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) (TyVarBndr flag)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyKind"><span class="hs-identifier hs-var">reifyKind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Var.html#tyVarKind"><span class="hs-identifier hs-var">tyVarKind</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681124084"><span class="hs-identifier hs-var">tv</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2214"></span><span>
</span><span id="line-2215"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyTyVarsToMaybe"><span class="hs-identifier hs-type">reifyTyVarsToMaybe</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Types.Var.html#TyVar"><span class="hs-identifier hs-type">TyVar</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#TyVarBndr"><span class="hs-identifier hs-type">TH.TyVarBndr</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2216"></span><span id="reifyTyVarsToMaybe"><span class="annot"><span class="annottext">reifyTyVarsToMaybe :: [Id] -&gt; TcM (Maybe [TyVarBndr ()])
</span><a href="GHC.Tc.Gen.Splice.html#reifyTyVarsToMaybe"><span class="hs-identifier hs-var hs-var">reifyTyVarsToMaybe</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe [TyVarBndr ()] -&gt; TcM (Maybe [TyVarBndr ()])
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe [TyVarBndr ()]
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-2217"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyTyVarsToMaybe"><span class="hs-identifier hs-var">reifyTyVarsToMaybe</span></a></span><span> </span><span id="local-6989586621681124082"><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681124082"><span class="hs-identifier hs-var">tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[TyVarBndr ()] -&gt; Maybe [TyVarBndr ()]
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">([TyVarBndr ()] -&gt; Maybe [TyVarBndr ()])
-&gt; TcM [TyVarBndr ()] -&gt; TcM (Maybe [TyVarBndr ()])
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[Id] -&gt; TcM [TyVarBndr ()]
</span><a href="GHC.Tc.Gen.Splice.html#reifyTyVars"><span class="hs-identifier hs-var">reifyTyVars</span></a></span><span> </span><span class="annot"><span class="annottext">[Id]
</span><a href="#local-6989586621681124082"><span class="hs-identifier hs-var">tys</span></a></span><span>
</span><span id="line-2218"></span><span>
</span><span id="line-2219"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reify_tc_app"><span class="hs-identifier hs-type">reify_tc_app</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#Type"><span class="hs-identifier hs-type">Type.Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Type"><span class="hs-identifier hs-type">TH.Type</span></a></span><span>
</span><span id="line-2220"></span><span id="reify_tc_app"><span class="annot"><span class="annottext">reify_tc_app :: TyCon -&gt; [Type] -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reify_tc_app"><span class="hs-identifier hs-var hs-var">reify_tc_app</span></a></span></span><span> </span><span id="local-6989586621681124081"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124081"><span class="hs-identifier hs-var">tc</span></a></span></span><span> </span><span id="local-6989586621681124080"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124080"><span class="hs-identifier hs-var">tys</span></a></span></span><span>
</span><span id="line-2221"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681124079"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124079"><span class="hs-identifier hs-var">tys'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Type] -&gt; TcM [Type]
</span><a href="GHC.Tc.Gen.Splice.html#reifyTypes"><span class="hs-identifier hs-var">reifyTypes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; [Type]
</span><a href="GHC.Core.Type.html#filterOutInvisibleTypes"><span class="hs-identifier hs-var">filterOutInvisibleTypes</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124081"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124080"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2222"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="#local-6989586621681124078"><span class="hs-identifier hs-var">maybe_sig_t</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; [Type] -&gt; Type
</span><a href="GHC.Tc.Gen.Splice.html#mkThAppTs"><span class="hs-identifier hs-var">mkThAppTs</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124077"><span class="hs-identifier hs-var">r_tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124079"><span class="hs-identifier hs-var">tys'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2223"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2224"></span><span>    </span><span id="local-6989586621681124076"><span class="annot"><span class="annottext">arity :: Arity
</span><a href="#local-6989586621681124076"><span class="hs-identifier hs-var hs-var">arity</span></a></span></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Arity
</span><a href="GHC.Core.TyCon.html#tyConArity"><span class="hs-identifier hs-var hs-var">tyConArity</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124081"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-2225"></span><span>
</span><span id="line-2226"></span><span>    </span><span id="local-6989586621681124077"><span class="annot"><span class="annottext">r_tc :: Type
</span><a href="#local-6989586621681124077"><span class="hs-identifier hs-var hs-var">r_tc</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isUnboxedSumTyCon"><span class="hs-identifier hs-var">isUnboxedSumTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124081"><span class="hs-identifier hs-var">tc</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Arity -&gt; Type
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#UnboxedSumT"><span class="hs-identifier hs-var">TH.UnboxedSumT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621681124076"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="annot"><span class="annottext">Arity -&gt; Arity -&gt; Arity
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><a href="../../base/src/GHC.Real.html#div"><span class="hs-operator hs-var">`div`</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-2227"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isUnboxedTupleTyCon"><span class="hs-identifier hs-var">isUnboxedTupleTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124081"><span class="hs-identifier hs-var">tc</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Arity -&gt; Type
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#UnboxedTupleT"><span class="hs-identifier hs-var">TH.UnboxedTupleT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621681124076"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="annot"><span class="annottext">Arity -&gt; Arity -&gt; Arity
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><a href="../../base/src/GHC.Real.html#div"><span class="hs-operator hs-var">`div`</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-2228"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isPromotedTupleTyCon"><span class="hs-identifier hs-var">isPromotedTupleTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124081"><span class="hs-identifier hs-var">tc</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Arity -&gt; Type
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#PromotedTupleT"><span class="hs-identifier hs-var">TH.PromotedTupleT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621681124076"><span class="hs-identifier hs-var">arity</span></a></span><span> </span><span class="annot"><span class="annottext">Arity -&gt; Arity -&gt; Arity
forall a. Integral a =&gt; a -&gt; a -&gt; a
</span><a href="../../base/src/GHC.Real.html#div"><span class="hs-operator hs-var">`div`</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">2</span></span><span class="hs-special">)</span><span>
</span><span id="line-2229"></span><span>             </span><span class="hs-comment">-- See Note [Unboxed tuple RuntimeRep vars] in GHC.Core.TyCon</span><span>
</span><span id="line-2230"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isTupleTyCon"><span class="hs-identifier hs-var">isTupleTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124081"><span class="hs-identifier hs-var">tc</span></a></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isPromotedDataCon"><span class="hs-identifier hs-var">isPromotedDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124081"><span class="hs-identifier hs-var">tc</span></a></span><span>
</span><span id="line-2231"></span><span>                                            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Arity -&gt; Type
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#PromotedTupleT"><span class="hs-identifier hs-var">TH.PromotedTupleT</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621681124076"><span class="hs-identifier hs-var">arity</span></a></span><span>
</span><span id="line-2232"></span><span>                                            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Arity -&gt; Type
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#TupleT"><span class="hs-identifier hs-var">TH.TupleT</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621681124076"><span class="hs-identifier hs-var">arity</span></a></span><span>
</span><span id="line-2233"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124081"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; Unique -&gt; Bool
</span><a href="GHC.Types.Unique.html#hasKey"><span class="hs-operator hs-var">`hasKey`</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#constraintKindTyConKey"><span class="hs-identifier hs-var">constraintKindTyConKey</span></a></span><span>
</span><span id="line-2234"></span><span>                                          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#ConstraintT"><span class="hs-identifier hs-var">TH.ConstraintT</span></a></span><span>
</span><span id="line-2235"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124081"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; Unique -&gt; Bool
</span><a href="GHC.Types.Unique.html#hasKey"><span class="hs-operator hs-var">`hasKey`</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#unrestrictedFunTyConKey"><span class="hs-identifier hs-var">unrestrictedFunTyConKey</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#ArrowT"><span class="hs-identifier hs-var">TH.ArrowT</span></a></span><span>
</span><span id="line-2236"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124081"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; Unique -&gt; Bool
</span><a href="GHC.Types.Unique.html#hasKey"><span class="hs-operator hs-var">`hasKey`</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#listTyConKey"><span class="hs-identifier hs-var">listTyConKey</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#ListT"><span class="hs-identifier hs-var">TH.ListT</span></a></span><span>
</span><span id="line-2237"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124081"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; Unique -&gt; Bool
</span><a href="GHC.Types.Unique.html#hasKey"><span class="hs-operator hs-var">`hasKey`</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#nilDataConKey"><span class="hs-identifier hs-var">nilDataConKey</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#PromotedNilT"><span class="hs-identifier hs-var">TH.PromotedNilT</span></a></span><span>
</span><span id="line-2238"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124081"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; Unique -&gt; Bool
</span><a href="GHC.Types.Unique.html#hasKey"><span class="hs-operator hs-var">`hasKey`</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#consDataConKey"><span class="hs-identifier hs-var">consDataConKey</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#PromotedConsT"><span class="hs-identifier hs-var">TH.PromotedConsT</span></a></span><span>
</span><span id="line-2239"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124081"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; Unique -&gt; Bool
</span><a href="GHC.Types.Unique.html#hasKey"><span class="hs-operator hs-var">`hasKey`</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#heqTyConKey"><span class="hs-identifier hs-var">heqTyConKey</span></a></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#EqualityT"><span class="hs-identifier hs-var">TH.EqualityT</span></a></span><span>
</span><span id="line-2240"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124081"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; Unique -&gt; Bool
</span><a href="GHC.Types.Unique.html#hasKey"><span class="hs-operator hs-var">`hasKey`</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#eqPrimTyConKey"><span class="hs-identifier hs-var">eqPrimTyConKey</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#EqualityT"><span class="hs-identifier hs-var">TH.EqualityT</span></a></span><span>
</span><span id="line-2241"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124081"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Unique -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; Unique -&gt; Bool
</span><a href="GHC.Types.Unique.html#hasKey"><span class="hs-operator hs-var">`hasKey`</span></a></span><span> </span><span class="annot"><span class="annottext">Unique
</span><a href="GHC.Builtin.Names.html#eqReprPrimTyConKey"><span class="hs-identifier hs-var">eqReprPrimTyConKey</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#ConT"><span class="hs-identifier hs-var">TH.ConT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="GHC.Builtin.Types.html#coercibleTyCon"><span class="hs-identifier hs-var">coercibleTyCon</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2242"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; Bool
</span><a href="GHC.Core.TyCon.html#isPromotedDataCon"><span class="hs-identifier hs-var">isPromotedDataCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124081"><span class="hs-identifier hs-var">tc</span></a></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#PromotedT"><span class="hs-identifier hs-var">TH.PromotedT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124081"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2243"></span><span>         </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>                      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Type
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#ConT"><span class="hs-identifier hs-var">TH.ConT</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Name
forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var">reifyName</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124081"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2244"></span><span>
</span><span id="line-2245"></span><span>    </span><span class="hs-comment">-- See Note [When does a tycon application need an explicit kind</span><span>
</span><span id="line-2246"></span><span>    </span><span class="hs-comment">-- signature?] in GHC.Core.TyCo.Rep</span><span>
</span><span id="line-2247"></span><span>    </span><span id="local-6989586621681124078"><span class="annot"><span class="annottext">maybe_sig_t :: Type -&gt; TcM Type
</span><a href="#local-6989586621681124078"><span class="hs-identifier hs-var hs-var">maybe_sig_t</span></a></span></span><span> </span><span id="local-6989586621681124048"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124048"><span class="hs-identifier hs-var">th_type</span></a></span></span><span>
</span><span id="line-2248"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; TyCon -&gt; Arity -&gt; Bool
</span><a href="GHC.Core.Type.html#tyConAppNeedsKindSig"><span class="hs-identifier hs-var">tyConAppNeedsKindSig</span></a></span><span>
</span><span id="line-2249"></span><span>          </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="hs-comment">-- We don't reify types using visible kind applications, so</span><span>
</span><span id="line-2250"></span><span>                </span><span class="hs-comment">-- don't count specified binders as contributing towards</span><span>
</span><span id="line-2251"></span><span>                </span><span class="hs-comment">-- injective positions in the kind of the tycon.</span><span>
</span><span id="line-2252"></span><span>          </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124081"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Type] -&gt; Arity
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Arity
</span><a href="../../base/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124080"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2253"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681124047"><span class="annot"><span class="annottext">full_kind :: Type
</span><a href="#local-6989586621681124047"><span class="hs-identifier hs-var hs-var">full_kind</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HasDebugCallStack =&gt; Type -&gt; Type
Type -&gt; Type
</span><a href="GHC.Core.Type.html#tcTypeKind"><span class="hs-identifier hs-var">tcTypeKind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [Type] -&gt; Type
</span><a href="GHC.Core.TyCo.Rep.html#mkTyConApp"><span class="hs-identifier hs-var">mkTyConApp</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124081"><span class="hs-identifier hs-var">tc</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681124080"><span class="hs-identifier hs-var">tys</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2254"></span><span>           </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681124046"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124046"><span class="hs-identifier hs-var">th_full_kind</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyKind"><span class="hs-identifier hs-var">reifyKind</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124047"><span class="hs-identifier hs-var">full_kind</span></a></span><span>
</span><span id="line-2255"></span><span>           </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#SigT"><span class="hs-identifier hs-var">TH.SigT</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124048"><span class="hs-identifier hs-var">th_type</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124046"><span class="hs-identifier hs-var">th_full_kind</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2256"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-2257"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681124048"><span class="hs-identifier hs-var">th_type</span></a></span><span>
</span><span id="line-2258"></span><span>
</span><span id="line-2259"></span><span class="hs-comment">------------------------------</span><span>
</span><span id="line-2260"></span><span id="local-6989586621681126485"><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-type">reifyName</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#NamedThing"><span class="hs-identifier hs-type">NamedThing</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681126485"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681126485"><span class="hs-identifier hs-type">n</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Name"><span class="hs-identifier hs-type">TH.Name</span></a></span></span><span>
</span><span id="line-2261"></span><span id="reifyName"><span class="annot"><span class="annottext">reifyName :: forall n. NamedThing n =&gt; n -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyName"><span class="hs-identifier hs-var hs-var">reifyName</span></a></span></span><span> </span><span id="local-6989586621681124036"><span class="annot"><span class="annottext">n
</span><a href="#local-6989586621681124036"><span class="hs-identifier hs-var">thing</span></a></span></span><span>
</span><span id="line-2262"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Name -&gt; Bool
</span><a href="GHC.Types.Name.html#isExternalName"><span class="hs-identifier hs-var">isExternalName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124034"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-2263"></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String -&gt; Name
</span><a href="#local-6989586621681124033"><span class="hs-identifier hs-var">mk_varg</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681124032"><span class="hs-identifier hs-var">pkg_str</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681124031"><span class="hs-identifier hs-var">mod_str</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681124030"><span class="hs-identifier hs-var">occ_str</span></a></span><span>
</span><span id="line-2264"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; Integer -&gt; Name
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#mkNameU"><span class="hs-identifier hs-var">TH.mkNameU</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681124030"><span class="hs-identifier hs-var">occ_str</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Arity -&gt; Integer
forall a. Integral a =&gt; a -&gt; Integer
</span><a href="../../base/src/GHC.Real.html#toInteger"><span class="hs-identifier hs-var">toInteger</span></a></span><span> </span><span class="annot"><span class="annottext">(Arity -&gt; Integer) -&gt; Arity -&gt; Integer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Unique -&gt; Arity
</span><a href="GHC.Types.Unique.html#getKey"><span class="hs-identifier hs-var">getKey</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; Unique
forall a. Uniquable a =&gt; a -&gt; Unique
</span><a href="GHC.Types.Unique.html#getUnique"><span class="hs-identifier hs-var">getUnique</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124034"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2265"></span><span>        </span><span class="hs-comment">-- Many of the things we reify have local bindings, and</span><span>
</span><span id="line-2266"></span><span>        </span><span class="hs-comment">-- NameL's aren't supposed to appear in binding positions, so</span><span>
</span><span id="line-2267"></span><span>        </span><span class="hs-comment">-- we use NameU.  When/if we start to reify nested things, that</span><span>
</span><span id="line-2268"></span><span>        </span><span class="hs-comment">-- have free variables, we may need to generate NameL's for them.</span><span>
</span><span id="line-2269"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2270"></span><span>    </span><span id="local-6989586621681124034"><span class="annot"><span class="annottext">name :: Name
</span><a href="#local-6989586621681124034"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">n -&gt; Name
forall a. NamedThing a =&gt; a -&gt; Name
</span><a href="GHC.Types.Name.html#getName"><span class="hs-identifier hs-var">getName</span></a></span><span> </span><span class="annot"><span class="annottext">n
</span><a href="#local-6989586621681124036"><span class="hs-identifier hs-var">thing</span></a></span><span>
</span><span id="line-2271"></span><span>    </span><span id="local-6989586621681124027"><span class="annot"><span class="annottext">mod :: GenModule Unit
</span><a href="#local-6989586621681124027"><span class="hs-identifier hs-var hs-var">mod</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isExternalName</span><span> </span><span class="hs-identifier">name</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-identifier">nameModule</span><span> </span><span class="hs-identifier">name</span><span>
</span><span id="line-2272"></span><span>    </span><span id="local-6989586621681124032"><span class="annot"><span class="annottext">pkg_str :: String
</span><a href="#local-6989586621681124032"><span class="hs-identifier hs-var hs-var">pkg_str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Unit -&gt; String
</span><a href="GHC.Unit.Types.html#unitString"><span class="hs-identifier hs-var">unitString</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenModule Unit -&gt; Unit
forall unit. GenModule unit -&gt; unit
</span><a href="GHC.Unit.Types.html#moduleUnit"><span class="hs-identifier hs-var hs-var">moduleUnit</span></a></span><span> </span><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621681124027"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2273"></span><span>    </span><span id="local-6989586621681124031"><span class="annot"><span class="annottext">mod_str :: String
</span><a href="#local-6989586621681124031"><span class="hs-identifier hs-var hs-var">mod_str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; String
</span><a href="GHC.Unit.Module.Name.html#moduleNameString"><span class="hs-identifier hs-var">moduleNameString</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenModule Unit -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621681124027"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2274"></span><span>    </span><span id="local-6989586621681124030"><span class="annot"><span class="annottext">occ_str :: String
</span><a href="#local-6989586621681124030"><span class="hs-identifier hs-var hs-var">occ_str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; String
</span><a href="GHC.Types.Name.Occurrence.html#occNameString"><span class="hs-identifier hs-var">occNameString</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621681124024"><span class="hs-identifier hs-var">occ</span></a></span><span>
</span><span id="line-2275"></span><span>    </span><span id="local-6989586621681124024"><span class="annot"><span class="annottext">occ :: OccName
</span><a href="#local-6989586621681124024"><span class="hs-identifier hs-var hs-var">occ</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name -&gt; OccName
</span><a href="GHC.Types.Name.html#nameOccName"><span class="hs-identifier hs-var">nameOccName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124034"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-2276"></span><span>    </span><span id="local-6989586621681124033"><span class="annot"><span class="annottext">mk_varg :: String -&gt; String -&gt; String -&gt; Name
</span><a href="#local-6989586621681124033"><span class="hs-identifier hs-var hs-var">mk_varg</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; Bool
</span><a href="GHC.Types.Name.Occurrence.html#isDataOcc"><span class="hs-identifier hs-var">OccName.isDataOcc</span></a></span><span> </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621681124024"><span class="hs-identifier hs-var">occ</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String -&gt; Name
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#mkNameG_d"><span class="hs-identifier hs-var">TH.mkNameG_d</span></a></span><span>
</span><span id="line-2277"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; Bool
</span><a href="GHC.Types.Name.Occurrence.html#isVarOcc"><span class="hs-identifier hs-var">OccName.isVarOcc</span></a></span><span>  </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621681124024"><span class="hs-identifier hs-var">occ</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String -&gt; Name
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#mkNameG_v"><span class="hs-identifier hs-var">TH.mkNameG_v</span></a></span><span>
</span><span id="line-2278"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; Bool
</span><a href="GHC.Types.Name.Occurrence.html#isTcOcc"><span class="hs-identifier hs-var">OccName.isTcOcc</span></a></span><span>   </span><span class="annot"><span class="annottext">OccName
</span><a href="#local-6989586621681124024"><span class="hs-identifier hs-var">occ</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String -&gt; Name
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#mkNameG_tc"><span class="hs-identifier hs-var">TH.mkNameG_tc</span></a></span><span>
</span><span id="line-2279"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>             </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; MsgDoc -&gt; String -&gt; String -&gt; String -&gt; Name
forall a. HasCallStack =&gt; String -&gt; MsgDoc -&gt; a
</span><a href="GHC.Utils.Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;reifyName&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; MsgDoc
forall a. Outputable a =&gt; a -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124034"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2280"></span><span>
</span><span id="line-2281"></span><span class="hs-comment">-- See Note [Reifying field labels]</span><span>
</span><span id="line-2282"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyFieldLabel"><span class="hs-identifier hs-type">reifyFieldLabel</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.FieldLabel.html#FieldLabel"><span class="hs-identifier hs-type">FieldLabel</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Name"><span class="hs-identifier hs-type">TH.Name</span></a></span><span>
</span><span id="line-2283"></span><span id="reifyFieldLabel"><span class="annot"><span class="annottext">reifyFieldLabel :: FieldLabel -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyFieldLabel"><span class="hs-identifier hs-var hs-var">reifyFieldLabel</span></a></span></span><span> </span><span id="local-6989586621681124019"><span class="annot"><span class="annottext">FieldLabel
</span><a href="#local-6989586621681124019"><span class="hs-identifier hs-var">fl</span></a></span></span><span>
</span><span id="line-2284"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">FieldLabel -&gt; Bool
forall a. FieldLbl a -&gt; Bool
</span><a href="GHC.Types.FieldLabel.html#flIsOverloaded"><span class="hs-identifier hs-var hs-var">flIsOverloaded</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabel
</span><a href="#local-6989586621681124019"><span class="hs-identifier hs-var">fl</span></a></span><span>
</span><span id="line-2285"></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">OccName -&gt; NameFlavour -&gt; Name
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Name"><span class="hs-identifier hs-var">TH.Name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; OccName
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#mkOccName"><span class="hs-identifier hs-var">TH.mkOccName</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681124016"><span class="hs-identifier hs-var">occ_str</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModName -&gt; NameFlavour
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#NameQ"><span class="hs-identifier hs-var">TH.NameQ</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; ModName
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#mkModName"><span class="hs-identifier hs-var">TH.mkModName</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681124014"><span class="hs-identifier hs-var">mod_str</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2286"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; String -&gt; String -&gt; Name
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#mkNameG_v"><span class="hs-identifier hs-var">TH.mkNameG_v</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681124013"><span class="hs-identifier hs-var">pkg_str</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681124014"><span class="hs-identifier hs-var">mod_str</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681124016"><span class="hs-identifier hs-var">occ_str</span></a></span><span>
</span><span id="line-2287"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2288"></span><span>    </span><span id="local-6989586621681124012"><span class="annot"><span class="annottext">name :: Name
</span><a href="#local-6989586621681124012"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FieldLabel -&gt; Name
forall a. FieldLbl a -&gt; a
</span><a href="GHC.Types.FieldLabel.html#flSelector"><span class="hs-identifier hs-var hs-var">flSelector</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabel
</span><a href="#local-6989586621681124019"><span class="hs-identifier hs-var">fl</span></a></span><span>
</span><span id="line-2289"></span><span>    </span><span id="local-6989586621681124011"><span class="annot"><span class="annottext">mod :: GenModule Unit
</span><a href="#local-6989586621681124011"><span class="hs-identifier hs-var hs-var">mod</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">isExternalName</span><span> </span><span class="hs-identifier">name</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-identifier">nameModule</span><span> </span><span class="hs-identifier">name</span><span>
</span><span id="line-2290"></span><span>    </span><span id="local-6989586621681124013"><span class="annot"><span class="annottext">pkg_str :: String
</span><a href="#local-6989586621681124013"><span class="hs-identifier hs-var hs-var">pkg_str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Unit -&gt; String
</span><a href="GHC.Unit.Types.html#unitString"><span class="hs-identifier hs-var">unitString</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenModule Unit -&gt; Unit
forall unit. GenModule unit -&gt; unit
</span><a href="GHC.Unit.Types.html#moduleUnit"><span class="hs-identifier hs-var hs-var">moduleUnit</span></a></span><span> </span><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621681124011"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2291"></span><span>    </span><span id="local-6989586621681124014"><span class="annot"><span class="annottext">mod_str :: String
</span><a href="#local-6989586621681124014"><span class="hs-identifier hs-var hs-var">mod_str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; String
</span><a href="GHC.Unit.Module.Name.html#moduleNameString"><span class="hs-identifier hs-var">moduleNameString</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenModule Unit -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621681124011"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2292"></span><span>    </span><span id="local-6989586621681124016"><span class="annot"><span class="annottext">occ_str :: String
</span><a href="#local-6989586621681124016"><span class="hs-identifier hs-var hs-var">occ_str</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; String
</span><a href="GHC.Data.FastString.html#unpackFS"><span class="hs-identifier hs-var">unpackFS</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FieldLabel -&gt; FastString
forall a. FieldLbl a -&gt; FastString
</span><a href="GHC.Types.FieldLabel.html#flLabel"><span class="hs-identifier hs-var hs-var">flLabel</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabel
</span><a href="#local-6989586621681124019"><span class="hs-identifier hs-var">fl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2293"></span><span>
</span><span id="line-2294"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifySelector"><span class="hs-identifier hs-type">reifySelector</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Var.html#Id"><span class="hs-identifier hs-type">Id</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Core.TyCon.html#TyCon"><span class="hs-identifier hs-type">TyCon</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Name"><span class="hs-identifier hs-type">TH.Name</span></a></span><span>
</span><span id="line-2295"></span><span id="reifySelector"><span class="annot"><span class="annottext">reifySelector :: Id -&gt; TyCon -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifySelector"><span class="hs-identifier hs-var hs-var">reifySelector</span></a></span></span><span> </span><span id="local-6989586621681124009"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681124009"><span class="hs-identifier hs-var">id</span></a></span></span><span> </span><span id="local-6989586621681124008"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124008"><span class="hs-identifier hs-var">tc</span></a></span></span><span>
</span><span id="line-2296"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">(FieldLabel -&gt; Bool) -&gt; [FieldLabel] -&gt; Maybe FieldLabel
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Maybe a
</span><a href="../../base/src/Data.Foldable.html#find"><span class="hs-identifier hs-var">find</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Name
</span><a href="GHC.Types.Id.html#idName"><span class="hs-identifier hs-var">idName</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681124009"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; Name -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; Bool) -&gt; (FieldLabel -&gt; Name) -&gt; FieldLabel -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabel -&gt; Name
forall a. FieldLbl a -&gt; a
</span><a href="GHC.Types.FieldLabel.html#flSelector"><span class="hs-identifier hs-var hs-var">flSelector</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; [FieldLabel]
</span><a href="GHC.Core.TyCon.html#tyConFieldLabels"><span class="hs-identifier hs-var">tyConFieldLabels</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124008"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2297"></span><span>      </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681124005"><span class="annot"><span class="annottext">FieldLabel
</span><a href="#local-6989586621681124005"><span class="hs-identifier hs-var">fl</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FieldLabel -&gt; Name
</span><a href="GHC.Tc.Gen.Splice.html#reifyFieldLabel"><span class="hs-identifier hs-var">reifyFieldLabel</span></a></span><span> </span><span class="annot"><span class="annottext">FieldLabel
</span><a href="#local-6989586621681124005"><span class="hs-identifier hs-var">fl</span></a></span><span>
</span><span id="line-2298"></span><span>      </span><span class="annot"><span class="annottext">Maybe FieldLabel
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; MsgDoc -&gt; Name
forall a. HasCallStack =&gt; String -&gt; MsgDoc -&gt; a
</span><a href="GHC.Utils.Outputable.html#pprPanic"><span class="hs-identifier hs-var">pprPanic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;reifySelector: missing field&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; MsgDoc
forall a. Outputable a =&gt; a -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681124009"><span class="hs-identifier hs-var">id</span></a></span><span> </span><span class="annot"><span class="annottext">MsgDoc -&gt; MsgDoc -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon -&gt; MsgDoc
forall a. Outputable a =&gt; a -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681124008"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2299"></span><span>
</span><span id="line-2300"></span><span class="hs-comment">------------------------------</span><span>
</span><span id="line-2301"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyFixity"><span class="hs-identifier hs-type">reifyFixity</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.Name.html#Name"><span class="hs-identifier hs-type">Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Fixity"><span class="hs-identifier hs-type">TH.Fixity</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2302"></span><span id="reifyFixity"><span class="annot"><span class="annottext">reifyFixity :: Name -&gt; TcM (Maybe Fixity)
</span><a href="GHC.Tc.Gen.Splice.html#reifyFixity"><span class="hs-identifier hs-var hs-var">reifyFixity</span></a></span></span><span> </span><span id="local-6989586621681124004"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124004"><span class="hs-identifier hs-var">name</span></a></span></span><span>
</span><span id="line-2303"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681124003"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681124003"><span class="hs-identifier hs-var">found</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681124002"><span class="annot"><span class="annottext">Fixity
</span><a href="#local-6989586621681124002"><span class="hs-identifier hs-var">fix</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; RnM (Bool, Fixity)
</span><a href="GHC.Rename.Fixity.html#lookupFixityRn_help"><span class="hs-identifier hs-var">lookupFixityRn_help</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681124004"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-2304"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Maybe Fixity -&gt; TcM (Maybe Fixity)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681124003"><span class="hs-identifier hs-var">found</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Fixity -&gt; Maybe Fixity
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Fixity -&gt; Fixity
</span><a href="#local-6989586621681124001"><span class="hs-identifier hs-var">conv_fix</span></a></span><span> </span><span class="annot"><span class="annottext">Fixity
</span><a href="#local-6989586621681124002"><span class="hs-identifier hs-var">fix</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe Fixity
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2305"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-2306"></span><span>      </span><span id="local-6989586621681124001"><span class="annot"><span class="annottext">conv_fix :: Fixity -&gt; Fixity
</span><a href="#local-6989586621681124001"><span class="hs-identifier hs-var hs-var">conv_fix</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Basic.html#Fixity"><span class="hs-identifier hs-type">BasicTypes.Fixity</span></a></span><span> </span><span class="annot"><span class="annottext">SourceText
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681123999"><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621681123999"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span id="local-6989586621681123998"><span class="annot"><span class="annottext">FixityDirection
</span><a href="#local-6989586621681123998"><span class="hs-identifier hs-var">d</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Arity -&gt; FixityDirection -&gt; Fixity
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Fixity"><span class="hs-identifier hs-var">TH.Fixity</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><a href="#local-6989586621681123999"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FixityDirection -&gt; FixityDirection
</span><a href="#local-6989586621681123996"><span class="hs-identifier hs-var">conv_dir</span></a></span><span> </span><span class="annot"><span class="annottext">FixityDirection
</span><a href="#local-6989586621681123998"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2307"></span><span>      </span><span id="local-6989586621681123996"><span class="annot"><span class="annottext">conv_dir :: FixityDirection -&gt; FixityDirection
</span><a href="#local-6989586621681123996"><span class="hs-identifier hs-var hs-var">conv_dir</span></a></span></span><span> </span><span class="annot"><span class="annottext">FixityDirection
</span><a href="GHC.Types.Basic.html#InfixR"><span class="hs-identifier hs-var">BasicTypes.InfixR</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FixityDirection
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#InfixR"><span class="hs-identifier hs-var">TH.InfixR</span></a></span><span>
</span><span id="line-2308"></span><span>      </span><span class="annot"><a href="#local-6989586621681123996"><span class="hs-identifier hs-var">conv_dir</span></a></span><span> </span><span class="annot"><span class="annottext">FixityDirection
</span><a href="GHC.Types.Basic.html#InfixL"><span class="hs-identifier hs-var">BasicTypes.InfixL</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FixityDirection
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#InfixL"><span class="hs-identifier hs-var">TH.InfixL</span></a></span><span>
</span><span id="line-2309"></span><span>      </span><span class="annot"><a href="#local-6989586621681123996"><span class="hs-identifier hs-var">conv_dir</span></a></span><span> </span><span class="annot"><span class="annottext">FixityDirection
</span><a href="GHC.Types.Basic.html#InfixN"><span class="hs-identifier hs-var">BasicTypes.InfixN</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FixityDirection
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#InfixN"><span class="hs-identifier hs-var">TH.InfixN</span></a></span><span>
</span><span id="line-2310"></span><span>
</span><span id="line-2311"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyUnpackedness"><span class="hs-identifier hs-type">reifyUnpackedness</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#SrcUnpackedness"><span class="hs-identifier hs-type">DataCon.SrcUnpackedness</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#SourceUnpackedness"><span class="hs-identifier hs-type">TH.SourceUnpackedness</span></a></span><span>
</span><span id="line-2312"></span><span id="reifyUnpackedness"><span class="annot"><span class="annottext">reifyUnpackedness :: SrcUnpackedness -&gt; SourceUnpackedness
</span><a href="GHC.Tc.Gen.Splice.html#reifyUnpackedness"><span class="hs-identifier hs-var hs-var">reifyUnpackedness</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcUnpackedness
</span><a href="GHC.Core.DataCon.html#NoSrcUnpack"><span class="hs-identifier hs-var">NoSrcUnpack</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourceUnpackedness
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#NoSourceUnpackedness"><span class="hs-identifier hs-var">TH.NoSourceUnpackedness</span></a></span><span>
</span><span id="line-2313"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyUnpackedness"><span class="hs-identifier hs-var">reifyUnpackedness</span></a></span><span> </span><span class="annot"><span class="annottext">SrcUnpackedness
</span><a href="GHC.Core.DataCon.html#SrcNoUnpack"><span class="hs-identifier hs-var">SrcNoUnpack</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourceUnpackedness
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#SourceNoUnpack"><span class="hs-identifier hs-var">TH.SourceNoUnpack</span></a></span><span>
</span><span id="line-2314"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyUnpackedness"><span class="hs-identifier hs-var">reifyUnpackedness</span></a></span><span> </span><span class="annot"><span class="annottext">SrcUnpackedness
</span><a href="GHC.Core.DataCon.html#SrcUnpack"><span class="hs-identifier hs-var">SrcUnpack</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourceUnpackedness
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#SourceUnpack"><span class="hs-identifier hs-var">TH.SourceUnpack</span></a></span><span>
</span><span id="line-2315"></span><span>
</span><span id="line-2316"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyStrictness"><span class="hs-identifier hs-type">reifyStrictness</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#SrcStrictness"><span class="hs-identifier hs-type">DataCon.SrcStrictness</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#SourceStrictness"><span class="hs-identifier hs-type">TH.SourceStrictness</span></a></span><span>
</span><span id="line-2317"></span><span id="reifyStrictness"><span class="annot"><span class="annottext">reifyStrictness :: SrcStrictness -&gt; SourceStrictness
</span><a href="GHC.Tc.Gen.Splice.html#reifyStrictness"><span class="hs-identifier hs-var hs-var">reifyStrictness</span></a></span></span><span> </span><span class="annot"><span class="annottext">SrcStrictness
</span><a href="GHC.Core.DataCon.html#NoSrcStrict"><span class="hs-identifier hs-var">NoSrcStrict</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourceStrictness
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#NoSourceStrictness"><span class="hs-identifier hs-var">TH.NoSourceStrictness</span></a></span><span>
</span><span id="line-2318"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyStrictness"><span class="hs-identifier hs-var">reifyStrictness</span></a></span><span> </span><span class="annot"><span class="annottext">SrcStrictness
</span><a href="GHC.Core.DataCon.html#SrcStrict"><span class="hs-identifier hs-var">SrcStrict</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourceStrictness
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#SourceStrict"><span class="hs-identifier hs-var">TH.SourceStrict</span></a></span><span>
</span><span id="line-2319"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyStrictness"><span class="hs-identifier hs-var">reifyStrictness</span></a></span><span> </span><span class="annot"><span class="annottext">SrcStrictness
</span><a href="GHC.Core.DataCon.html#SrcLazy"><span class="hs-identifier hs-var">SrcLazy</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SourceStrictness
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#SourceLazy"><span class="hs-identifier hs-var">TH.SourceLazy</span></a></span><span>
</span><span id="line-2320"></span><span>
</span><span id="line-2321"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifySourceBang"><span class="hs-identifier hs-type">reifySourceBang</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#HsSrcBang"><span class="hs-identifier hs-type">DataCon.HsSrcBang</span></a></span><span>
</span><span id="line-2322"></span><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#SourceUnpackedness"><span class="hs-identifier hs-type">TH.SourceUnpackedness</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#SourceStrictness"><span class="hs-identifier hs-type">TH.SourceStrictness</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2323"></span><span id="reifySourceBang"><span class="annot"><span class="annottext">reifySourceBang :: HsSrcBang -&gt; (SourceUnpackedness, SourceStrictness)
</span><a href="GHC.Tc.Gen.Splice.html#reifySourceBang"><span class="hs-identifier hs-var hs-var">reifySourceBang</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.DataCon.html#HsSrcBang"><span class="hs-identifier hs-type">HsSrcBang</span></a></span><span> </span><span class="annot"><span class="annottext">SourceText
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681123974"><span class="annot"><span class="annottext">SrcUnpackedness
</span><a href="#local-6989586621681123974"><span class="hs-identifier hs-var">u</span></a></span></span><span> </span><span id="local-6989586621681123973"><span class="annot"><span class="annottext">SrcStrictness
</span><a href="#local-6989586621681123973"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcUnpackedness -&gt; SourceUnpackedness
</span><a href="GHC.Tc.Gen.Splice.html#reifyUnpackedness"><span class="hs-identifier hs-var">reifyUnpackedness</span></a></span><span> </span><span class="annot"><span class="annottext">SrcUnpackedness
</span><a href="#local-6989586621681123974"><span class="hs-identifier hs-var">u</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">SrcStrictness -&gt; SourceStrictness
</span><a href="GHC.Tc.Gen.Splice.html#reifyStrictness"><span class="hs-identifier hs-var">reifyStrictness</span></a></span><span> </span><span class="annot"><span class="annottext">SrcStrictness
</span><a href="#local-6989586621681123973"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2324"></span><span>
</span><span id="line-2325"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyDecidedStrictness"><span class="hs-identifier hs-type">reifyDecidedStrictness</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#HsImplBang"><span class="hs-identifier hs-type">DataCon.HsImplBang</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#DecidedStrictness"><span class="hs-identifier hs-type">TH.DecidedStrictness</span></a></span><span>
</span><span id="line-2326"></span><span id="reifyDecidedStrictness"><span class="annot"><span class="annottext">reifyDecidedStrictness :: HsImplBang -&gt; DecidedStrictness
</span><a href="GHC.Tc.Gen.Splice.html#reifyDecidedStrictness"><span class="hs-identifier hs-var hs-var">reifyDecidedStrictness</span></a></span></span><span> </span><span class="annot"><span class="annottext">HsImplBang
</span><a href="GHC.Core.DataCon.html#HsLazy"><span class="hs-identifier hs-var">HsLazy</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DecidedStrictness
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#DecidedLazy"><span class="hs-identifier hs-var">TH.DecidedLazy</span></a></span><span>
</span><span id="line-2327"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyDecidedStrictness"><span class="hs-identifier hs-var">reifyDecidedStrictness</span></a></span><span> </span><span class="annot"><span class="annottext">HsImplBang
</span><a href="GHC.Core.DataCon.html#HsStrict"><span class="hs-identifier hs-var">HsStrict</span></a></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DecidedStrictness
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#DecidedStrict"><span class="hs-identifier hs-var">TH.DecidedStrict</span></a></span><span>
</span><span id="line-2328"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyDecidedStrictness"><span class="hs-identifier hs-var">reifyDecidedStrictness</span></a></span><span> </span><span class="annot"><a href="GHC.Core.DataCon.html#HsUnpack"><span class="hs-identifier hs-type">HsUnpack</span></a></span><span class="hs-special">{</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DecidedStrictness
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#DecidedUnpack"><span class="hs-identifier hs-var">TH.DecidedUnpack</span></a></span><span>
</span><span id="line-2329"></span><span>
</span><span id="line-2330"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyTypeOfThing"><span class="hs-identifier hs-type">reifyTypeOfThing</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Name"><span class="hs-identifier hs-type">TH.Name</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Type"><span class="hs-identifier hs-type">TH.Type</span></a></span><span>
</span><span id="line-2331"></span><span id="reifyTypeOfThing"><span class="annot"><span class="annottext">reifyTypeOfThing :: Name -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyTypeOfThing"><span class="hs-identifier hs-var hs-var">reifyTypeOfThing</span></a></span></span><span> </span><span id="local-6989586621681123966"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681123966"><span class="hs-identifier hs-var">th_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2332"></span><span>  </span><span id="local-6989586621681123965"><span class="annot"><span class="annottext">TcTyThing
</span><a href="#local-6989586621681123965"><span class="hs-identifier hs-var">thing</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Name -&gt; TcM TcTyThing
</span><a href="GHC.Tc.Gen.Splice.html#getThing"><span class="hs-identifier hs-var">getThing</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681123966"><span class="hs-identifier hs-var">th_name</span></a></span><span>
</span><span id="line-2333"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">TcTyThing
</span><a href="#local-6989586621681123965"><span class="hs-identifier hs-var">thing</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2334"></span><span>    </span><span class="annot"><a href="GHC.Tc.Types.html#AGlobal"><span class="hs-identifier hs-type">AGlobal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AnId"><span class="hs-identifier hs-type">AnId</span></a></span><span> </span><span id="local-6989586621681123964"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681123964"><span class="hs-identifier hs-var">id</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681123964"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2335"></span><span>    </span><span class="annot"><a href="GHC.Tc.Types.html#AGlobal"><span class="hs-identifier hs-type">AGlobal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ATyCon"><span class="hs-identifier hs-type">ATyCon</span></a></span><span> </span><span id="local-6989586621681123963"><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681123963"><span class="hs-identifier hs-var">tc</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyKind"><span class="hs-identifier hs-var">reifyKind</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TyCon -&gt; Type
</span><a href="GHC.Core.TyCon.html#tyConKind"><span class="hs-identifier hs-var hs-var">tyConKind</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><a href="#local-6989586621681123963"><span class="hs-identifier hs-var">tc</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2336"></span><span>    </span><span class="annot"><a href="GHC.Tc.Types.html#AGlobal"><span class="hs-identifier hs-type">AGlobal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AConLike"><span class="hs-identifier hs-type">AConLike</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.ConLike.html#RealDataCon"><span class="hs-identifier hs-type">RealDataCon</span></a></span><span> </span><span id="local-6989586621681123961"><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681123961"><span class="hs-identifier hs-var">dc</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2337"></span><span>      </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DataCon -&gt; Id
</span><a href="GHC.Core.DataCon.html#dataConWrapId"><span class="hs-identifier hs-var">dataConWrapId</span></a></span><span> </span><span class="annot"><span class="annottext">DataCon
</span><a href="#local-6989586621681123961"><span class="hs-identifier hs-var">dc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2338"></span><span>    </span><span class="annot"><a href="GHC.Tc.Types.html#AGlobal"><span class="hs-identifier hs-type">AGlobal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#AConLike"><span class="hs-identifier hs-type">AConLike</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.ConLike.html#PatSynCon"><span class="hs-identifier hs-type">PatSynCon</span></a></span><span> </span><span id="local-6989586621681123960"><span class="annot"><span class="annottext">PatSyn
</span><a href="#local-6989586621681123960"><span class="hs-identifier hs-var">ps</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2339"></span><span>      </span><span class="annot"><span class="annottext">([InvisTVBinder], [Type], [InvisTVBinder], [Type], [Scaled Type],
 Type)
-&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyPatSynType"><span class="hs-identifier hs-var">reifyPatSynType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PatSyn
-&gt; ([InvisTVBinder], [Type], [InvisTVBinder], [Type],
    [Scaled Type], Type)
</span><a href="GHC.Core.PatSyn.html#patSynSigBndr"><span class="hs-identifier hs-var">patSynSigBndr</span></a></span><span> </span><span class="annot"><span class="annottext">PatSyn
</span><a href="#local-6989586621681123960"><span class="hs-identifier hs-var">ps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2340"></span><span>    </span><span class="annot"><a href="GHC.Tc.Types.html#ATcId"><span class="hs-identifier hs-type">ATcId</span></a></span><span class="hs-special">{</span><span class="annot"><span class="annottext">tct_id :: TcTyThing -&gt; Id
</span><a href="GHC.Tc.Types.html#tct_id"><span class="hs-identifier hs-var">tct_id</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681123959"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681123959"><span class="hs-identifier hs-var">id</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Type -&gt; IOEnv (Env TcGblEnv TcLclEnv) Type
</span><a href="GHC.Tc.Utils.TcMType.html#zonkTcType"><span class="hs-identifier hs-var">zonkTcType</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Id -&gt; Type
</span><a href="GHC.Types.Id.html#idType"><span class="hs-identifier hs-var">idType</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681123959"><span class="hs-identifier hs-var">id</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) Type
-&gt; (Type -&gt; TcM Type) -&gt; TcM Type
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../base/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span>
</span><span id="line-2341"></span><span>    </span><span class="annot"><a href="GHC.Tc.Types.html#ATyVar"><span class="hs-identifier hs-type">ATyVar</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681123958"><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681123958"><span class="hs-identifier hs-var">tctv</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Id -&gt; IOEnv (Env TcGblEnv TcLclEnv) Type
</span><a href="GHC.Tc.Utils.TcMType.html#zonkTcTyVar"><span class="hs-identifier hs-var">zonkTcTyVar</span></a></span><span> </span><span class="annot"><span class="annottext">Id
</span><a href="#local-6989586621681123958"><span class="hs-identifier hs-var">tctv</span></a></span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) Type
-&gt; (Type -&gt; TcM Type) -&gt; TcM Type
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../base/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; TcM Type
</span><a href="GHC.Tc.Gen.Splice.html#reifyType"><span class="hs-identifier hs-var">reifyType</span></a></span><span>
</span><span id="line-2342"></span><span>    </span><span class="hs-comment">-- Impossible cases, supposedly:</span><span>
</span><span id="line-2343"></span><span>    </span><span class="annot"><a href="GHC.Tc.Types.html#AGlobal"><span class="hs-identifier hs-type">AGlobal</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Core.TyCo.Rep.html#ACoAxiom"><span class="hs-identifier hs-type">ACoAxiom</span></a></span><span> </span><span class="annot"><span class="annottext">CoAxiom Branched
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; TcM Type
forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;reifyTypeOfThing: ACoAxiom&quot;</span></span><span>
</span><span id="line-2344"></span><span>    </span><span class="annot"><a href="GHC.Tc.Types.html#ATcTyCon"><span class="hs-identifier hs-type">ATcTyCon</span></a></span><span> </span><span class="annot"><span class="annottext">TyCon
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; TcM Type
forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;reifyTypeOfThing: ATcTyCon&quot;</span></span><span>
</span><span id="line-2345"></span><span>    </span><span class="annot"><a href="GHC.Tc.Types.html#APromotionErr"><span class="hs-identifier hs-type">APromotionErr</span></a></span><span> </span><span class="annot"><span class="annottext">PromotionErr
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">String -&gt; TcM Type
forall a. String -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;reifyTypeOfThing: APromotionErr&quot;</span></span><span>
</span><span id="line-2346"></span><span>
</span><span id="line-2347"></span><span class="hs-comment">------------------------------</span><span>
</span><span id="line-2348"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#lookupThAnnLookup"><span class="hs-identifier hs-type">lookupThAnnLookup</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#AnnLookup"><span class="hs-identifier hs-type">TH.AnnLookup</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Annotations.html#CoreAnnTarget"><span class="hs-identifier hs-type">CoreAnnTarget</span></a></span><span>
</span><span id="line-2349"></span><span id="lookupThAnnLookup"><span class="annot"><span class="annottext">lookupThAnnLookup :: AnnLookup -&gt; TcM CoreAnnTarget
</span><a href="GHC.Tc.Gen.Splice.html#lookupThAnnLookup"><span class="hs-identifier hs-var hs-var">lookupThAnnLookup</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#AnnLookupName"><span class="hs-identifier hs-type">TH.AnnLookupName</span></a></span><span> </span><span id="local-6989586621681123953"><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681123953"><span class="hs-identifier hs-var">th_nm</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Name -&gt; CoreAnnTarget) -&gt; TcM Name -&gt; TcM CoreAnnTarget
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Name -&gt; CoreAnnTarget
forall name. name -&gt; AnnTarget name
</span><a href="GHC.Types.Annotations.html#NamedTarget"><span class="hs-identifier hs-var">NamedTarget</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Name -&gt; TcM Name
</span><a href="GHC.Tc.Gen.Splice.html#lookupThName"><span class="hs-identifier hs-var">lookupThName</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681123953"><span class="hs-identifier hs-var">th_nm</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2350"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#lookupThAnnLookup"><span class="hs-identifier hs-var">lookupThAnnLookup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#AnnLookupModule"><span class="hs-identifier hs-type">TH.AnnLookupModule</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Module"><span class="hs-identifier hs-type">TH.Module</span></a></span><span> </span><span id="local-6989586621681123949"><span class="annot"><span class="annottext">PkgName
</span><a href="#local-6989586621681123949"><span class="hs-identifier hs-var">pn</span></a></span></span><span> </span><span id="local-6989586621681123948"><span class="annot"><span class="annottext">ModName
</span><a href="#local-6989586621681123948"><span class="hs-identifier hs-var">mn</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2351"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CoreAnnTarget -&gt; TcM CoreAnnTarget
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(CoreAnnTarget -&gt; TcM CoreAnnTarget)
-&gt; CoreAnnTarget -&gt; TcM CoreAnnTarget
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">GenModule Unit -&gt; CoreAnnTarget
forall name. GenModule Unit -&gt; AnnTarget name
</span><a href="GHC.Types.Annotations.html#ModuleTarget"><span class="hs-identifier hs-var">ModuleTarget</span></a></span><span> </span><span class="annot"><span class="annottext">(GenModule Unit -&gt; CoreAnnTarget)
-&gt; GenModule Unit -&gt; CoreAnnTarget
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2352"></span><span>    </span><span class="annot"><span class="annottext">Unit -&gt; ModuleName -&gt; GenModule Unit
forall u. u -&gt; ModuleName -&gt; GenModule u
</span><a href="GHC.Unit.Types.html#mkModule"><span class="hs-identifier hs-var">mkModule</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Unit
</span><a href="GHC.Unit.Types.html#stringToUnit"><span class="hs-identifier hs-var">stringToUnit</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; Unit) -&gt; String -&gt; Unit
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">PkgName -&gt; String
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#pkgString"><span class="hs-identifier hs-var">TH.pkgString</span></a></span><span> </span><span class="annot"><span class="annottext">PkgName
</span><a href="#local-6989586621681123949"><span class="hs-identifier hs-var">pn</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; ModuleName
</span><a href="GHC.Unit.Module.Name.html#mkModuleName"><span class="hs-identifier hs-var">mkModuleName</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ModuleName) -&gt; String -&gt; ModuleName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ModName -&gt; String
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#modString"><span class="hs-identifier hs-var">TH.modString</span></a></span><span> </span><span class="annot"><span class="annottext">ModName
</span><a href="#local-6989586621681123948"><span class="hs-identifier hs-var">mn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2353"></span><span>
</span><span id="line-2354"></span><span id="local-6989586621681123942"><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyAnnotations"><span class="hs-identifier hs-type">reifyAnnotations</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base/src/Data.Data.html#Data"><span class="hs-identifier hs-type">Data</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681123942"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#AnnLookup"><span class="hs-identifier hs-type">TH.AnnLookup</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621681123942"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-2355"></span><span id="reifyAnnotations"><span class="annot"><span class="annottext">reifyAnnotations :: forall a. Data a =&gt; AnnLookup -&gt; TcM [a]
</span><a href="GHC.Tc.Gen.Splice.html#reifyAnnotations"><span class="hs-identifier hs-var hs-var">reifyAnnotations</span></a></span></span><span> </span><span id="local-6989586621681123929"><span class="annot"><span class="annottext">AnnLookup
</span><a href="#local-6989586621681123929"><span class="hs-identifier hs-var">th_name</span></a></span></span><span>
</span><span id="line-2356"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681123928"><span class="annot"><span class="annottext">CoreAnnTarget
</span><a href="#local-6989586621681123928"><span class="hs-identifier hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">AnnLookup -&gt; TcM CoreAnnTarget
</span><a href="GHC.Tc.Gen.Splice.html#lookupThAnnLookup"><span class="hs-identifier hs-var">lookupThAnnLookup</span></a></span><span> </span><span class="annot"><span class="annottext">AnnLookup
</span><a href="#local-6989586621681123929"><span class="hs-identifier hs-var">th_name</span></a></span><span>
</span><span id="line-2357"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681123927"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681123927"><span class="hs-identifier hs-var">topEnv</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv HscEnv
forall gbl lcl. TcRnIf gbl lcl HscEnv
</span><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-var">getTopEnv</span></a></span><span>
</span><span id="line-2358"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681123926"><span class="annot"><span class="annottext">AnnEnv
</span><a href="#local-6989586621681123926"><span class="hs-identifier hs-var">epsHptAnns</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO AnnEnv -&gt; IOEnv (Env TcGblEnv TcLclEnv) AnnEnv
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO AnnEnv -&gt; IOEnv (Env TcGblEnv TcLclEnv) AnnEnv)
-&gt; IO AnnEnv -&gt; IOEnv (Env TcGblEnv TcLclEnv) AnnEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Maybe ModGuts -&gt; IO AnnEnv
</span><a href="GHC.Driver.Types.html#prepareAnnotations"><span class="hs-identifier hs-var">prepareAnnotations</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681123927"><span class="hs-identifier hs-var">topEnv</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ModGuts
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-2359"></span><span>       </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681123925"><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681123925"><span class="hs-identifier hs-var">tcg</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv TcGblEnv
forall gbl lcl. TcRnIf gbl lcl gbl
</span><a href="GHC.Tc.Utils.Monad.html#getGblEnv"><span class="hs-identifier hs-var">getGblEnv</span></a></span><span>
</span><span id="line-2360"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681123924"><span class="annot"><span class="annottext">selectedEpsHptAnns :: [a]
</span><a href="#local-6989586621681123924"><span class="hs-identifier hs-var hs-var">selectedEpsHptAnns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Word8] -&gt; a) -&gt; AnnEnv -&gt; CoreAnnTarget -&gt; [a]
forall a.
Typeable a =&gt;
([Word8] -&gt; a) -&gt; AnnEnv -&gt; CoreAnnTarget -&gt; [a]
</span><a href="GHC.Types.Annotations.html#findAnns"><span class="hs-identifier hs-var">findAnns</span></a></span><span> </span><span class="annot"><span class="annottext">[Word8] -&gt; a
forall a. Data a =&gt; [Word8] -&gt; a
</span><a href="../../ghc-boot/src/GHC.Serialized.html#deserializeWithData"><span class="hs-identifier hs-var">deserializeWithData</span></a></span><span> </span><span class="annot"><span class="annottext">AnnEnv
</span><a href="#local-6989586621681123926"><span class="hs-identifier hs-var">epsHptAnns</span></a></span><span> </span><span class="annot"><span class="annottext">CoreAnnTarget
</span><a href="#local-6989586621681123928"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-2361"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681123921"><span class="annot"><span class="annottext">selectedTcgAnns :: [a]
</span><a href="#local-6989586621681123921"><span class="hs-identifier hs-var hs-var">selectedTcgAnns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Word8] -&gt; a) -&gt; AnnEnv -&gt; CoreAnnTarget -&gt; [a]
forall a.
Typeable a =&gt;
([Word8] -&gt; a) -&gt; AnnEnv -&gt; CoreAnnTarget -&gt; [a]
</span><a href="GHC.Types.Annotations.html#findAnns"><span class="hs-identifier hs-var">findAnns</span></a></span><span> </span><span class="annot"><span class="annottext">[Word8] -&gt; a
forall a. Data a =&gt; [Word8] -&gt; a
</span><a href="../../ghc-boot/src/GHC.Serialized.html#deserializeWithData"><span class="hs-identifier hs-var">deserializeWithData</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TcGblEnv -&gt; AnnEnv
</span><a href="GHC.Tc.Types.html#tcg_ann_env"><span class="hs-identifier hs-var hs-var">tcg_ann_env</span></a></span><span> </span><span class="annot"><span class="annottext">TcGblEnv
</span><a href="#local-6989586621681123925"><span class="hs-identifier hs-var">tcg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">CoreAnnTarget
</span><a href="#local-6989586621681123928"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-2362"></span><span>       </span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; TcM [a]
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621681123924"><span class="hs-identifier hs-var">selectedEpsHptAnns</span></a></span><span> </span><span class="annot"><span class="annottext">[a] -&gt; [a] -&gt; [a]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621681123921"><span class="hs-identifier hs-var">selectedTcgAnns</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2363"></span><span>
</span><span id="line-2364"></span><span class="hs-comment">------------------------------</span><span>
</span><span id="line-2365"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#modToTHMod"><span class="hs-identifier hs-type">modToTHMod</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Module"><span class="hs-identifier hs-type">TH.Module</span></a></span><span>
</span><span id="line-2366"></span><span id="modToTHMod"><span class="annot"><span class="annottext">modToTHMod :: GenModule Unit -&gt; Module
</span><a href="GHC.Tc.Gen.Splice.html#modToTHMod"><span class="hs-identifier hs-var hs-var">modToTHMod</span></a></span></span><span> </span><span id="local-6989586621681123918"><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621681123918"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PkgName -&gt; ModName -&gt; Module
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Module"><span class="hs-identifier hs-var">TH.Module</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; PkgName
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#PkgName"><span class="hs-identifier hs-var">TH.PkgName</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; PkgName) -&gt; String -&gt; PkgName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Unit -&gt; String
</span><a href="GHC.Unit.Types.html#unitString"><span class="hs-identifier hs-var">unitString</span></a></span><span>  </span><span class="annot"><span class="annottext">(Unit -&gt; String) -&gt; Unit -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">GenModule Unit -&gt; Unit
forall unit. GenModule unit -&gt; unit
</span><a href="GHC.Unit.Types.html#moduleUnit"><span class="hs-identifier hs-var hs-var">moduleUnit</span></a></span><span> </span><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621681123918"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2367"></span><span>                         </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; ModName
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#ModName"><span class="hs-identifier hs-var">TH.ModName</span></a></span><span> </span><span class="annot"><span class="annottext">(String -&gt; ModName) -&gt; String -&gt; ModName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; String
</span><a href="GHC.Unit.Module.Name.html#moduleNameString"><span class="hs-identifier hs-var">moduleNameString</span></a></span><span> </span><span class="annot"><span class="annottext">(ModuleName -&gt; String) -&gt; ModuleName -&gt; String
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">GenModule Unit -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621681123918"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2368"></span><span>
</span><span id="line-2369"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#reifyModule"><span class="hs-identifier hs-type">reifyModule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Module"><span class="hs-identifier hs-type">TH.Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#ModuleInfo"><span class="hs-identifier hs-type">TH.ModuleInfo</span></a></span><span>
</span><span id="line-2370"></span><span id="reifyModule"><span class="annot"><span class="annottext">reifyModule :: Module -&gt; TcM ModuleInfo
</span><a href="GHC.Tc.Gen.Splice.html#reifyModule"><span class="hs-identifier hs-var hs-var">reifyModule</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Module"><span class="hs-identifier hs-type">TH.Module</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#PkgName"><span class="hs-identifier hs-type">TH.PkgName</span></a></span><span> </span><span id="local-6989586621681123915"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681123915"><span class="hs-identifier hs-var">pkgString</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#ModName"><span class="hs-identifier hs-type">TH.ModName</span></a></span><span> </span><span id="local-6989586621681123914"><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681123914"><span class="hs-identifier hs-var">mString</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2371"></span><span>  </span><span id="local-6989586621681123913"><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621681123913"><span class="hs-identifier hs-var">this_mod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) (GenModule Unit)
forall (m :: * -&gt; *). HasModule m =&gt; m (GenModule Unit)
</span><a href="GHC.Unit.Module.html#getModule"><span class="hs-identifier hs-var">getModule</span></a></span><span>
</span><span id="line-2372"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681123912"><span class="annot"><span class="annottext">reifMod :: GenModule Unit
</span><a href="#local-6989586621681123912"><span class="hs-identifier hs-var hs-var">reifMod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Unit -&gt; ModuleName -&gt; GenModule Unit
forall u. u -&gt; ModuleName -&gt; GenModule u
</span><a href="GHC.Unit.Types.html#mkModule"><span class="hs-identifier hs-var">mkModule</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; Unit
</span><a href="GHC.Unit.Types.html#stringToUnit"><span class="hs-identifier hs-var">stringToUnit</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681123915"><span class="hs-identifier hs-var">pkgString</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; ModuleName
</span><a href="GHC.Unit.Module.Name.html#mkModuleName"><span class="hs-identifier hs-var">mkModuleName</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><a href="#local-6989586621681123914"><span class="hs-identifier hs-var">mString</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2373"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621681123912"><span class="hs-identifier hs-var">reifMod</span></a></span><span> </span><span class="annot"><span class="annottext">GenModule Unit -&gt; GenModule Unit -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621681123913"><span class="hs-identifier hs-var">this_mod</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">TcM ModuleInfo
</span><a href="#local-6989586621681123911"><span class="hs-identifier hs-var">reifyThisModule</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">GenModule Unit -&gt; TcM ModuleInfo
</span><a href="#local-6989586621681123910"><span class="hs-identifier hs-var">reifyFromIface</span></a></span><span> </span><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621681123912"><span class="hs-identifier hs-var">reifMod</span></a></span><span>
</span><span id="line-2374"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-2375"></span><span>      </span><span id="local-6989586621681123911"><span class="annot"><span class="annottext">reifyThisModule :: TcM ModuleInfo
</span><a href="#local-6989586621681123911"><span class="hs-identifier hs-var hs-var">reifyThisModule</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2376"></span><span>        </span><span id="local-6989586621681123906"><span class="annot"><span class="annottext">[Module]
</span><a href="#local-6989586621681123906"><span class="hs-identifier hs-var">usages</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(ImportAvails -&gt; [Module])
-&gt; IOEnv (Env TcGblEnv TcLclEnv) ImportAvails
-&gt; IOEnv (Env TcGblEnv TcLclEnv) [Module]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(GenModule Unit -&gt; Module) -&gt; [GenModule Unit] -&gt; [Module]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">GenModule Unit -&gt; Module
</span><a href="GHC.Tc.Gen.Splice.html#modToTHMod"><span class="hs-identifier hs-var">modToTHMod</span></a></span><span> </span><span class="annot"><span class="annottext">([GenModule Unit] -&gt; [Module])
-&gt; (ImportAvails -&gt; [GenModule Unit]) -&gt; ImportAvails -&gt; [Module]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleEnv [ImportedBy] -&gt; [GenModule Unit]
forall a. ModuleEnv a -&gt; [GenModule Unit]
</span><a href="GHC.Unit.Module.Env.html#moduleEnvKeys"><span class="hs-identifier hs-var">moduleEnvKeys</span></a></span><span> </span><span class="annot"><span class="annottext">(ModuleEnv [ImportedBy] -&gt; [GenModule Unit])
-&gt; (ImportAvails -&gt; ModuleEnv [ImportedBy])
-&gt; ImportAvails
-&gt; [GenModule Unit]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ImportAvails -&gt; ModuleEnv [ImportedBy]
</span><a href="GHC.Tc.Types.html#imp_mods"><span class="hs-identifier hs-var hs-var">imp_mods</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IOEnv (Env TcGblEnv TcLclEnv) ImportAvails
</span><a href="GHC.Tc.Utils.Monad.html#getImports"><span class="hs-identifier hs-var">getImports</span></a></span><span>
</span><span id="line-2377"></span><span>        </span><span class="annot"><span class="annottext">ModuleInfo -&gt; TcM ModuleInfo
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(ModuleInfo -&gt; TcM ModuleInfo) -&gt; ModuleInfo -&gt; TcM ModuleInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Module] -&gt; ModuleInfo
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#ModuleInfo"><span class="hs-identifier hs-var">TH.ModuleInfo</span></a></span><span> </span><span class="annot"><span class="annottext">[Module]
</span><a href="#local-6989586621681123906"><span class="hs-identifier hs-var">usages</span></a></span><span>
</span><span id="line-2378"></span><span>
</span><span id="line-2379"></span><span>      </span><span id="local-6989586621681123910"><span class="annot"><span class="annottext">reifyFromIface :: GenModule Unit -&gt; TcM ModuleInfo
</span><a href="#local-6989586621681123910"><span class="hs-identifier hs-var hs-var">reifyFromIface</span></a></span></span><span> </span><span id="local-6989586621681123897"><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621681123897"><span class="hs-identifier hs-var">reifMod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2380"></span><span>        </span><span id="local-6989586621681123896"><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621681123896"><span class="hs-identifier hs-var">iface</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MsgDoc -&gt; GenModule Unit -&gt; TcRn ModIface
</span><a href="GHC.Iface.Load.html#loadInterfaceForModule"><span class="hs-identifier hs-var">loadInterfaceForModule</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;reifying module from TH for&quot;</span></span><span> </span><span class="annot"><span class="annottext">MsgDoc -&gt; MsgDoc -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">GenModule Unit -&gt; MsgDoc
forall a. Outputable a =&gt; a -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621681123897"><span class="hs-identifier hs-var">reifMod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621681123897"><span class="hs-identifier hs-var">reifMod</span></a></span><span>
</span><span id="line-2381"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681123894"><span class="annot"><span class="annottext">usages :: [Module]
</span><a href="#local-6989586621681123894"><span class="hs-identifier hs-var hs-var">usages</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">GenModule Unit -&gt; Module
</span><a href="GHC.Tc.Gen.Splice.html#modToTHMod"><span class="hs-identifier hs-var">modToTHMod</span></a></span><span> </span><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621681123893"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681123892"><span class="annot"><span class="annottext">Usage
</span><a href="#local-6989586621681123892"><span class="hs-identifier hs-var">usage</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModIface -&gt; [Usage]
forall (phase :: ModIfacePhase). ModIface_ phase -&gt; [Usage]
</span><a href="GHC.Driver.Types.html#mi_usages"><span class="hs-identifier hs-var hs-var">mi_usages</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface
</span><a href="#local-6989586621681123896"><span class="hs-identifier hs-var">iface</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-2382"></span><span>                                     </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681123893"><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621681123893"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Unit -&gt; Usage -&gt; Maybe (GenModule Unit)
</span><a href="#local-6989586621681123890"><span class="hs-identifier hs-var">usageToModule</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenModule Unit -&gt; Unit
forall unit. GenModule unit -&gt; unit
</span><a href="GHC.Unit.Types.html#moduleUnit"><span class="hs-identifier hs-var hs-var">moduleUnit</span></a></span><span> </span><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621681123897"><span class="hs-identifier hs-var">reifMod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Usage
</span><a href="#local-6989586621681123892"><span class="hs-identifier hs-var">usage</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2383"></span><span>        </span><span class="annot"><span class="annottext">ModuleInfo -&gt; TcM ModuleInfo
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(ModuleInfo -&gt; TcM ModuleInfo) -&gt; ModuleInfo -&gt; TcM ModuleInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Module] -&gt; ModuleInfo
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#ModuleInfo"><span class="hs-identifier hs-var">TH.ModuleInfo</span></a></span><span> </span><span class="annot"><span class="annottext">[Module]
</span><a href="#local-6989586621681123894"><span class="hs-identifier hs-var">usages</span></a></span><span>
</span><span id="line-2384"></span><span>
</span><span id="line-2385"></span><span>      </span><span class="annot"><a href="#local-6989586621681123890"><span class="hs-identifier hs-type">usageToModule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Unit"><span class="hs-identifier hs-type">Unit</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#Usage"><span class="hs-identifier hs-type">Usage</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span>
</span><span id="line-2386"></span><span>      </span><span id="local-6989586621681123890"><span class="annot"><span class="annottext">usageToModule :: Unit -&gt; Usage -&gt; Maybe (GenModule Unit)
</span><a href="#local-6989586621681123890"><span class="hs-identifier hs-var hs-var">usageToModule</span></a></span></span><span> </span><span class="annot"><span class="annottext">Unit
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Types.html#UsageFile"><span class="hs-identifier hs-type">UsageFile</span></a></span><span> </span><span class="hs-special">{</span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (GenModule Unit)
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-2387"></span><span>      </span><span class="annot"><a href="#local-6989586621681123890"><span class="hs-identifier hs-var">usageToModule</span></a></span><span> </span><span id="local-6989586621681123888"><span class="annot"><span class="annottext">Unit
</span><a href="#local-6989586621681123888"><span class="hs-identifier hs-var">this_pkg</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Types.html#UsageHomeModule"><span class="hs-identifier hs-type">UsageHomeModule</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">usg_mod_name :: Usage -&gt; ModuleName
</span><a href="GHC.Driver.Types.html#usg_mod_name"><span class="hs-identifier hs-var">usg_mod_name</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681123885"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681123885"><span class="hs-identifier hs-var">mn</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenModule Unit -&gt; Maybe (GenModule Unit)
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(GenModule Unit -&gt; Maybe (GenModule Unit))
-&gt; GenModule Unit -&gt; Maybe (GenModule Unit)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Unit -&gt; ModuleName -&gt; GenModule Unit
forall u. u -&gt; ModuleName -&gt; GenModule u
</span><a href="GHC.Unit.Types.html#mkModule"><span class="hs-identifier hs-var">mkModule</span></a></span><span> </span><span class="annot"><span class="annottext">Unit
</span><a href="#local-6989586621681123888"><span class="hs-identifier hs-var">this_pkg</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681123885"><span class="hs-identifier hs-var">mn</span></a></span><span>
</span><span id="line-2388"></span><span>      </span><span class="annot"><a href="#local-6989586621681123890"><span class="hs-identifier hs-var">usageToModule</span></a></span><span> </span><span class="annot"><span class="annottext">Unit
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Types.html#UsagePackageModule"><span class="hs-identifier hs-type">UsagePackageModule</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">usg_mod :: Usage -&gt; GenModule Unit
</span><a href="GHC.Driver.Types.html#usg_mod"><span class="hs-identifier hs-var">usg_mod</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681123882"><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621681123882"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenModule Unit -&gt; Maybe (GenModule Unit)
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621681123882"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-2389"></span><span>      </span><span class="annot"><a href="#local-6989586621681123890"><span class="hs-identifier hs-var">usageToModule</span></a></span><span> </span><span class="annot"><span class="annottext">Unit
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Types.html#UsageMergedRequirement"><span class="hs-identifier hs-type">UsageMergedRequirement</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">usg_mod :: Usage -&gt; GenModule Unit
</span><a href="GHC.Driver.Types.html#usg_mod"><span class="hs-identifier hs-var">usg_mod</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681123880"><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621681123880"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenModule Unit -&gt; Maybe (GenModule Unit)
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">GenModule Unit
</span><a href="#local-6989586621681123880"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-2390"></span><span>
</span><span id="line-2391"></span><span class="hs-comment">------------------------------</span><span>
</span><span id="line-2392"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#mkThAppTs"><span class="hs-identifier hs-type">mkThAppTs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Type"><span class="hs-identifier hs-type">TH.Type</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Type"><span class="hs-identifier hs-type">TH.Type</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#Type"><span class="hs-identifier hs-type">TH.Type</span></a></span><span>
</span><span id="line-2393"></span><span id="mkThAppTs"><span class="annot"><span class="annottext">mkThAppTs :: Type -&gt; [Type] -&gt; Type
</span><a href="GHC.Tc.Gen.Splice.html#mkThAppTs"><span class="hs-identifier hs-var hs-var">mkThAppTs</span></a></span></span><span> </span><span id="local-6989586621681123879"><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681123879"><span class="hs-identifier hs-var">fun_ty</span></a></span></span><span> </span><span id="local-6989586621681123878"><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681123878"><span class="hs-identifier hs-var">arg_tys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Type -&gt; Type -&gt; Type) -&gt; Type -&gt; [Type] -&gt; Type
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base/src/Data.Foldable.html#foldl%27"><span class="hs-identifier hs-var">foldl'</span></a></span><span> </span><span class="annot"><span class="annottext">Type -&gt; Type -&gt; Type
</span><a href="../../template-haskell/src/Language.Haskell.TH.Syntax.html#AppT"><span class="hs-identifier hs-var">TH.AppT</span></a></span><span> </span><span class="annot"><span class="annottext">Type
</span><a href="#local-6989586621681123879"><span class="hs-identifier hs-var">fun_ty</span></a></span><span> </span><span class="annot"><span class="annottext">[Type]
</span><a href="#local-6989586621681123878"><span class="hs-identifier hs-var">arg_tys</span></a></span><span>
</span><span id="line-2394"></span><span>
</span><span id="line-2395"></span><span id="local-6989586621681126377"><span class="annot"><a href="GHC.Tc.Gen.Splice.html#noTH"><span class="hs-identifier hs-type">noTH</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#PtrString"><span class="hs-identifier hs-type">PtrString</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681126377"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-2396"></span><span id="noTH"><span class="annot"><span class="annottext">noTH :: forall a. PtrString -&gt; MsgDoc -&gt; TcM a
</span><a href="GHC.Tc.Gen.Splice.html#noTH"><span class="hs-identifier hs-var hs-var">noTH</span></a></span></span><span> </span><span id="local-6989586621681123876"><span class="annot"><span class="annottext">PtrString
</span><a href="#local-6989586621681123876"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span id="local-6989586621681123875"><span class="annot"><span class="annottext">MsgDoc
</span><a href="#local-6989586621681123875"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">MsgDoc -&gt; TcM a
forall a. MsgDoc -&gt; TcM a
</span><a href="GHC.Tc.Utils.Monad.html#failWithTc"><span class="hs-identifier hs-var">failWithTc</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[MsgDoc] -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#hsep"><span class="hs-identifier hs-var">hsep</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">String -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Can't represent&quot;</span></span><span> </span><span class="annot"><span class="annottext">MsgDoc -&gt; MsgDoc -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">PtrString -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#ptext"><span class="hs-identifier hs-var">ptext</span></a></span><span> </span><span class="annot"><span class="annottext">PtrString
</span><a href="#local-6989586621681123876"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">MsgDoc -&gt; MsgDoc -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-2397"></span><span>                                </span><span class="annot"><span class="annottext">String -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;in Template Haskell:&quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-2398"></span><span>                             </span><span class="annot"><span class="annottext">Arity -&gt; MsgDoc -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Arity
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">MsgDoc
</span><a href="#local-6989586621681123875"><span class="hs-identifier hs-var">d</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2399"></span><span>
</span><span id="line-2400"></span><span id="local-6989586621681126498"><span class="annot"><a href="GHC.Tc.Gen.Splice.html#ppr_th"><span class="hs-identifier hs-type">ppr_th</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../template-haskell/src/Language.Haskell.TH.Ppr.html#Ppr"><span class="hs-identifier hs-type">TH.Ppr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681126498"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681126498"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span></span><span>
</span><span id="line-2401"></span><span id="ppr_th"><span class="annot"><span class="annottext">ppr_th :: forall a. Ppr a =&gt; a -&gt; MsgDoc
</span><a href="GHC.Tc.Gen.Splice.html#ppr_th"><span class="hs-identifier hs-var hs-var">ppr_th</span></a></span></span><span> </span><span id="local-6989586621681123871"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681123871"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">String -&gt; MsgDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; String
forall a. Ppr a =&gt; a -&gt; String
</span><a href="../../template-haskell/src/Language.Haskell.TH.Ppr.html#pprint"><span class="hs-identifier hs-var">TH.pprint</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621681123871"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2402"></span><span>
</span><span id="line-2403"></span><span class="hs-comment">{-
Note [Reifying field labels]
~~~~~~~~~~~~~~~~~~~~~~~~~~~~
When reifying a datatype declared with DuplicateRecordFields enabled, we want
the reified names of the fields to be labels rather than selector functions.
That is, we want (reify ''T) and (reify 'foo) to produce

    data T = MkT { foo :: Int }
    foo :: T -&gt; Int

rather than

    data T = MkT { $sel:foo:MkT :: Int }
    $sel:foo:MkT :: T -&gt; Int

because otherwise TH code that uses the field names as strings will silently do
the wrong thing.  Thus we use the field label (e.g. foo) as the OccName, rather
than the selector (e.g. $sel:foo:MkT).  Since the Orig name M.foo isn't in the
environment, NameG can't be used to represent such fields.  Instead,
reifyFieldLabel uses NameQ.

However, this means that extracting the field name from the output of reify, and
trying to reify it again, may fail with an ambiguity error if there are multiple
such fields defined in the module (see the test case
overloadedrecflds/should_fail/T11103.hs).  The &quot;proper&quot; fix requires changes to
the TH AST to make it able to represent duplicate record fields.
-}</span><span>
</span><span id="line-2430"></span><span>
</span><span id="line-2431"></span><span class="annot"><a href="GHC.Tc.Gen.Splice.html#tcGetInterp"><span class="hs-identifier hs-type">tcGetInterp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Tc.Types.html#TcM"><span class="hs-identifier hs-type">TcM</span></a></span><span> </span><span class="annot"><a href="GHC.Runtime.Interpreter.Types.html#Interp"><span class="hs-identifier hs-type">Interp</span></a></span><span>
</span><span id="line-2432"></span><span id="tcGetInterp"><span class="annot"><span class="annottext">tcGetInterp :: TcM Interp
</span><a href="GHC.Tc.Gen.Splice.html#tcGetInterp"><span class="hs-identifier hs-var hs-var">tcGetInterp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2433"></span><span>   </span><span id="local-6989586621681123870"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681123870"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TcRnIf TcGblEnv TcLclEnv HscEnv
forall gbl lcl. TcRnIf gbl lcl HscEnv
</span><a href="GHC.Tc.Utils.Monad.html#getTopEnv"><span class="hs-identifier hs-var">getTopEnv</span></a></span><span>
</span><span id="line-2434"></span><span>   </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Maybe Interp
</span><a href="GHC.Driver.Types.html#hsc_interp"><span class="hs-identifier hs-var hs-var">hsc_interp</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681123870"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2435"></span><span>      </span><span class="annot"><span class="annottext">Maybe Interp
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO Interp -&gt; TcM Interp
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO Interp -&gt; TcM Interp) -&gt; IO Interp -&gt; TcM Interp
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">GhcException -&gt; IO Interp
forall e a. Exception e =&gt; e -&gt; IO a
</span><a href="../../base/src/GHC.IO.html#throwIO"><span class="hs-identifier hs-var">throwIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">String -&gt; GhcException
</span><a href="GHC.Utils.Panic.html#InstallationError"><span class="hs-identifier hs-var">InstallationError</span></a></span><span> </span><span class="annot"><span class="annottext">String
</span><span class="hs-string">&quot;Template haskell requires a target code interpreter&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-2436"></span><span>      </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681123868"><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621681123868"><span class="hs-identifier hs-var">i</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Interp -&gt; TcM Interp
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Interp
</span><a href="#local-6989586621681123868"><span class="hs-identifier hs-var">i</span></a></span><span>
</span><span id="line-2437"></span></pre></body></html>