<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE BangPatterns, CPP, NondecreasingIndentation, ScopedTypeVariables #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE RecordWildCards, NamedFieldPuns #-}</span><span>
</span><span id="line-3"></span><span>
</span><span id="line-4"></span><span class="hs-pragma">{-# OPTIONS_GHC -Wno-incomplete-uni-patterns #-}</span><span>
</span><span id="line-5"></span><span>
</span><span id="line-6"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-7"></span><span class="hs-comment">--</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- (c) The University of Glasgow, 2011</span><span>
</span><span id="line-9"></span><span class="hs-comment">--</span><span>
</span><span id="line-10"></span><span class="hs-comment">-- This module implements multi-module compilation, and is used</span><span>
</span><span id="line-11"></span><span class="hs-comment">-- by --make and GHCi.</span><span>
</span><span id="line-12"></span><span class="hs-comment">--</span><span>
</span><span id="line-13"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-14"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">GHC.Driver.Make</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-15"></span><span>        </span><span class="annot"><a href="GHC.Driver.Make.html#depanal"><span class="hs-identifier">depanal</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#depanalE"><span class="hs-identifier">depanalE</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#depanalPartial"><span class="hs-identifier">depanalPartial</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-16"></span><span>        </span><span class="annot"><a href="GHC.Driver.Make.html#load"><span class="hs-identifier">load</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#load%27"><span class="hs-identifier">load'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#LoadHowMuch"><span class="hs-identifier">LoadHowMuch</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-17"></span><span>
</span><span id="line-18"></span><span>        </span><span class="annot"><a href="GHC.Driver.Make.html#downsweep"><span class="hs-identifier">downsweep</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-19"></span><span>
</span><span id="line-20"></span><span>        </span><span class="annot"><a href="GHC.Driver.Make.html#topSortModuleGraph"><span class="hs-identifier">topSortModuleGraph</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span>        </span><span class="annot"><a href="GHC.Driver.Types.html#ms_home_srcimps"><span class="hs-identifier">ms_home_srcimps</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ms_home_imps"><span class="hs-identifier">ms_home_imps</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-23"></span><span>
</span><span id="line-24"></span><span>        </span><span class="annot"><a href="GHC.Driver.Make.html#summariseModule"><span class="hs-identifier">summariseModule</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span>        </span><span class="annot"><a href="GHC.Driver.Make.html#hscSourceToIsBoot"><span class="hs-identifier">hscSourceToIsBoot</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span>        </span><span class="annot"><a href="GHC.Tc.Utils.Backpack.html#findExtraSigImports"><span class="hs-identifier">findExtraSigImports</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-27"></span><span>        </span><span class="annot"><a href="GHC.Tc.Utils.Backpack.html#implicitRequirements"><span class="hs-identifier">implicitRequirements</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-28"></span><span>
</span><span id="line-29"></span><span>        </span><span class="annot"><a href="GHC.Driver.Make.html#noModError"><span class="hs-identifier">noModError</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#cyclicModuleErr"><span class="hs-identifier">cyclicModuleErr</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-30"></span><span>        </span><span class="annot"><a href="GHC.Driver.Make.html#moduleGraphNodes"><span class="hs-identifier">moduleGraphNodes</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#SummaryNode"><span class="hs-identifier">SummaryNode</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-31"></span><span>        </span><span class="annot"><a href="GHC.Unit.Types.html#IsBootInterface"><span class="hs-identifier">IsBootInterface</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-32"></span><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span class="hs-cpp">

#include &quot;HsVersions.h&quot;
</span><span>
</span><span id="line-36"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Prelude.html"><span class="hs-identifier">GHC.Prelude</span></a></span><span>
</span><span id="line-37"></span><span>
</span><span id="line-38"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.Runtime.Linker.html"><span class="hs-identifier">GHC.Runtime.Linker</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Linker</span></span><span>
</span><span id="line-39"></span><span>
</span><span id="line-40"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Phases.html"><span class="hs-identifier">GHC.Driver.Phases</span></a></span><span>
</span><span id="line-41"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Pipeline.html"><span class="hs-identifier">GHC.Driver.Pipeline</span></a></span><span>
</span><span id="line-42"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html"><span class="hs-identifier">GHC.Driver.Session</span></a></span><span>
</span><span id="line-43"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html"><span class="hs-identifier">GHC.Utils.Error</span></a></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Finder.html"><span class="hs-identifier">GHC.Driver.Finder</span></a></span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Monad.html"><span class="hs-identifier">GHC.Driver.Monad</span></a></span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Parser.Header.html"><span class="hs-identifier">GHC.Parser.Header</span></a></span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html"><span class="hs-identifier">GHC.Driver.Types</span></a></span><span>
</span><span id="line-48"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.Module.html"><span class="hs-identifier">GHC.Unit.Module</span></a></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.IfaceToCore.html"><span class="hs-identifier">GHC.IfaceToCore</span></a></span><span>     </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.IfaceToCore.html#typecheckIface"><span class="hs-identifier">typecheckIface</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html"><span class="hs-identifier">GHC.Tc.Utils.Monad</span></a></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Monad.html#initIfaceCheck"><span class="hs-identifier">initIfaceCheck</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Driver.Main.html"><span class="hs-identifier">GHC.Driver.Main</span></a></span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html"><span class="hs-identifier">GHC.Data.Bag</span></a></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html#unitBag"><span class="hs-identifier">unitBag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html#listToBag"><span class="hs-identifier">listToBag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html#unionManyBags"><span class="hs-identifier">unionManyBags</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Data.Bag.html#isEmptyBag"><span class="hs-identifier">isEmptyBag</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-54"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html"><span class="hs-identifier">GHC.Types.Basic</span></a></span><span>
</span><span id="line-55"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Graph.Directed.html"><span class="hs-identifier">GHC.Data.Graph.Directed</span></a></span><span>
</span><span id="line-56"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Exception.html"><span class="hs-identifier">GHC.Utils.Exception</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Utils.Exception.html#tryIO"><span class="hs-identifier">tryIO</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-57"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.FastString.html"><span class="hs-identifier">GHC.Data.FastString</span></a></span><span>
</span><span id="line-58"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html"><span class="hs-identifier">GHC.Data.Maybe</span></a></span><span>      </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Data.Maybe.html#expectJust"><span class="hs-identifier">expectJust</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-59"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.html"><span class="hs-identifier">GHC.Types.Name</span></a></span><span>
</span><span id="line-60"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Monad.html"><span class="hs-identifier">GHC.Utils.Monad</span></a></span><span>     </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Utils.Monad.html#allM"><span class="hs-identifier">allM</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-61"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html"><span class="hs-identifier">GHC.Utils.Outputable</span></a></span><span>
</span><span id="line-62"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Panic.html"><span class="hs-identifier">GHC.Utils.Panic</span></a></span><span>
</span><span id="line-63"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html"><span class="hs-identifier">GHC.Types.SrcLoc</span></a></span><span>
</span><span id="line-64"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Data.StringBuffer.html"><span class="hs-identifier">GHC.Data.StringBuffer</span></a></span><span>
</span><span id="line-65"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.FM.html"><span class="hs-identifier">GHC.Types.Unique.FM</span></a></span><span>
</span><span id="line-66"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.DSet.html"><span class="hs-identifier">GHC.Types.Unique.DSet</span></a></span><span>
</span><span id="line-67"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Tc.Utils.Backpack.html"><span class="hs-identifier">GHC.Tc.Utils.Backpack</span></a></span><span>
</span><span id="line-68"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Unit.State.html"><span class="hs-identifier">GHC.Unit.State</span></a></span><span>
</span><span id="line-69"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Set.html"><span class="hs-identifier">GHC.Types.Unique.Set</span></a></span><span>
</span><span id="line-70"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Utils.Misc.html"><span class="hs-identifier">GHC.Utils.Misc</span></a></span><span>
</span><span id="line-71"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../ghc-boot/src/GHC.LanguageExtensions.html#"><span class="hs-identifier">GHC.LanguageExtensions</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">LangExt</span></span><span>
</span><span id="line-72"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.Types.Name.Env.html"><span class="hs-identifier">GHC.Types.Name.Env</span></a></span><span>
</span><span id="line-73"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="GHC.SysTools.FileCleanup.html"><span class="hs-identifier">GHC.SysTools.FileCleanup</span></a></span><span>
</span><span id="line-74"></span><span>
</span><span id="line-75"></span><span>
</span><span id="line-76"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base/src/Data.Either.html#"><span class="hs-identifier">Data.Either</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../base/src/Data.Either.html#rights"><span class="hs-identifier">rights</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base/src/Data.Either.html#partitionEithers"><span class="hs-identifier">partitionEithers</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-77"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../containers/src/Data.Map.html#"><span class="hs-identifier">Data.Map</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span>
</span><span id="line-78"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../containers/src/Data.Map.html#"><span class="hs-identifier">Data.Map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers/src/Data.Map.Internal.html#Map"><span class="hs-identifier">Map</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-79"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../containers/src/Data.Set.html#"><span class="hs-identifier">Data.Set</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Set</span></span><span>
</span><span id="line-80"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="GHC.Data.FiniteMap.html"><span class="hs-identifier">GHC.Data.FiniteMap</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">Map</span></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Data.FiniteMap.html#insertListWith"><span class="hs-identifier">insertListWith</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-81"></span><span>
</span><span id="line-82"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base/src/Control.Concurrent.html#"><span class="hs-identifier">Control.Concurrent</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../base/src/GHC.Conc.Sync.html#forkIOWithUnmask"><span class="hs-identifier">forkIOWithUnmask</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base/src/GHC.Conc.Sync.html#killThread"><span class="hs-identifier">killThread</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-83"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../base/src/GHC.Conc.html#"><span class="hs-identifier">GHC.Conc</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">CC</span></span><span>
</span><span id="line-84"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base/src/Control.Concurrent.MVar.html#"><span class="hs-identifier">Control.Concurrent.MVar</span></a></span><span>
</span><span id="line-85"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base/src/Control.Concurrent.QSem.html#"><span class="hs-identifier">Control.Concurrent.QSem</span></a></span><span>
</span><span id="line-86"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base/src/Control.Exception.html#"><span class="hs-identifier">Control.Exception</span></a></span><span>
</span><span id="line-87"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base/src/Control.Monad.html#"><span class="hs-identifier">Control.Monad</span></a></span><span>
</span><span id="line-88"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../transformers/src/Control.Monad.Trans.Except.html#"><span class="hs-identifier">Control.Monad.Trans.Except</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../transformers/src/Control.Monad.Trans.Except.html#ExceptT"><span class="hs-identifier">ExceptT</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../transformers/src/Control.Monad.Trans.Except.html#runExceptT"><span class="hs-identifier">runExceptT</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../transformers/src/Control.Monad.Trans.Except.html#throwE"><span class="hs-identifier">throwE</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-89"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../exceptions/src/Control.Monad.Catch.html#"><span class="hs-identifier">Control.Monad.Catch</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">MC</span></span><span>
</span><span id="line-90"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base/src/Data.IORef.html#"><span class="hs-identifier">Data.IORef</span></a></span><span>
</span><span id="line-91"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base/src/Data.List.html#"><span class="hs-identifier">Data.List</span></a></span><span>
</span><span id="line-92"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><a href="../../base/src/Data.List.html#"><span class="hs-identifier">Data.List</span></a></span><span> </span><span class="hs-keyword">as</span><span> </span><span class="annot"><span class="hs-identifier">List</span></span><span>
</span><span id="line-93"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base/src/Data.Foldable.html#"><span class="hs-identifier">Data.Foldable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/Data.Foldable.html#toList"><span class="hs-identifier">toList</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-94"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base/src/Data.Maybe.html#"><span class="hs-identifier">Data.Maybe</span></a></span><span>
</span><span id="line-95"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base/src/Data.Ord.html#"><span class="hs-identifier">Data.Ord</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../base/src/Data.Ord.html#comparing"><span class="hs-identifier">comparing</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-96"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../time/src/Data.Time.html#"><span class="hs-identifier">Data.Time</span></a></span><span>
</span><span id="line-97"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../directory/src/System.Directory.html#"><span class="hs-identifier">System.Directory</span></a></span><span>
</span><span id="line-98"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../filepath/src/System.FilePath.html#"><span class="hs-identifier">System.FilePath</span></a></span><span>
</span><span id="line-99"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base/src/System.IO.html#"><span class="hs-identifier">System.IO</span></a></span><span>        </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../base/src/System.IO.html#fixIO"><span class="hs-identifier">fixIO</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-100"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base/src/System.IO.Error.html#"><span class="hs-identifier">System.IO.Error</span></a></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../base/src/System.IO.Error.html#isDoesNotExistError"><span class="hs-identifier">isDoesNotExistError</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-101"></span><span>
</span><span id="line-102"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="../../base/src/GHC.Conc.html#"><span class="hs-identifier">GHC.Conc</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="../../base/src/GHC.Conc.Sync.html#getNumProcessors"><span class="hs-identifier">getNumProcessors</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base/src/GHC.Conc.Sync.html#getNumCapabilities"><span class="hs-identifier">getNumCapabilities</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base/src/GHC.Conc.Sync.html#setNumCapabilities"><span class="hs-identifier">setNumCapabilities</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-103"></span><span>
</span><span id="line-104"></span><span class="annot"><a href="GHC.Driver.Make.html#label_self"><span class="hs-identifier hs-type">label_self</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-105"></span><span id="label_self"><span class="annot"><span class="annottext">label_self :: FilePath -&gt; IO ()
</span><a href="GHC.Driver.Make.html#label_self"><span class="hs-identifier hs-var hs-var">label_self</span></a></span></span><span> </span><span id="local-6989586621681204642"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681204642"><span class="hs-identifier hs-var">thread_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-106"></span><span>    </span><span id="local-6989586621681204641"><span class="annot"><span class="annottext">ThreadId
</span><a href="#local-6989586621681204641"><span class="hs-identifier hs-var">self_tid</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ThreadId
</span><a href="../../base/src/GHC.Conc.Sync.html#myThreadId"><span class="hs-identifier hs-var">CC.myThreadId</span></a></span><span>
</span><span id="line-107"></span><span>    </span><span class="annot"><span class="annottext">ThreadId -&gt; FilePath -&gt; IO ()
</span><a href="../../base/src/GHC.Conc.Sync.html#labelThread"><span class="hs-identifier hs-var">CC.labelThread</span></a></span><span> </span><span class="annot"><span class="annottext">ThreadId
</span><a href="#local-6989586621681204641"><span class="hs-identifier hs-var">self_tid</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681204642"><span class="hs-identifier hs-var">thread_name</span></a></span><span>
</span><span id="line-108"></span><span>
</span><span id="line-109"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-110"></span><span class="hs-comment">-- Loading the program</span><span>
</span><span id="line-111"></span><span>
</span><span id="line-112"></span><span class="hs-comment">-- | Perform a dependency analysis starting from the current targets</span><span>
</span><span id="line-113"></span><span class="hs-comment">-- and update the session with the new module graph.</span><span>
</span><span id="line-114"></span><span class="hs-comment">--</span><span>
</span><span id="line-115"></span><span class="hs-comment">-- Dependency analysis entails parsing the @import@ directives and may</span><span>
</span><span id="line-116"></span><span class="hs-comment">-- therefore require running certain preprocessors.</span><span>
</span><span id="line-117"></span><span class="hs-comment">--</span><span>
</span><span id="line-118"></span><span class="hs-comment">-- Note that each 'ModSummary' in the module graph caches its 'DynFlags'.</span><span>
</span><span id="line-119"></span><span class="hs-comment">-- These 'DynFlags' are determined by the /current/ session 'DynFlags' and the</span><span>
</span><span id="line-120"></span><span class="hs-comment">-- @OPTIONS@ and @LANGUAGE@ pragmas of the parsed module.  Thus if you want</span><span>
</span><span id="line-121"></span><span class="hs-comment">-- changes to the 'DynFlags' to take effect you need to call this function</span><span>
</span><span id="line-122"></span><span class="hs-comment">-- again.</span><span>
</span><span id="line-123"></span><span class="hs-comment">-- In case of errors, just throw them.</span><span>
</span><span id="line-124"></span><span class="hs-comment">--</span><span>
</span><span id="line-125"></span><span id="local-6989586621681205316"><span class="annot"><a href="GHC.Driver.Make.html#depanal"><span class="hs-identifier hs-type">depanal</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Monad.html#GhcMonad"><span class="hs-identifier hs-type">GhcMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681205316"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-126"></span><span>           </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- ^ excluded modules</span><span>
</span><span id="line-127"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>          </span><span class="hs-comment">-- ^ allow duplicate roots</span><span>
</span><span id="line-128"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681205316"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModuleGraph"><span class="hs-identifier hs-type">ModuleGraph</span></a></span></span><span>
</span><span id="line-129"></span><span id="depanal"><span class="annot"><span class="annottext">depanal :: forall (m :: * -&gt; *).
GhcMonad m =&gt;
[ModuleName] -&gt; Bool -&gt; m ModuleGraph
</span><a href="GHC.Driver.Make.html#depanal"><span class="hs-identifier hs-var hs-var">depanal</span></a></span></span><span> </span><span id="local-6989586621681204621"><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621681204621"><span class="hs-identifier hs-var">excluded_mods</span></a></span></span><span> </span><span id="local-6989586621681204620"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681204620"><span class="hs-identifier hs-var">allow_dup_roots</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-130"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681204619"><span class="annot"><span class="annottext">ErrorMessages
</span><a href="#local-6989586621681204619"><span class="hs-identifier hs-var">errs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681204618"><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621681204618"><span class="hs-identifier hs-var">mod_graph</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[ModuleName] -&gt; Bool -&gt; m (ErrorMessages, ModuleGraph)
forall (m :: * -&gt; *).
GhcMonad m =&gt;
[ModuleName] -&gt; Bool -&gt; m (ErrorMessages, ModuleGraph)
</span><a href="GHC.Driver.Make.html#depanalE"><span class="hs-identifier hs-var">depanalE</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621681204621"><span class="hs-identifier hs-var">excluded_mods</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681204620"><span class="hs-identifier hs-var">allow_dup_roots</span></a></span><span>
</span><span id="line-131"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">ErrorMessages -&gt; Bool
forall a. Bag a -&gt; Bool
</span><a href="GHC.Data.Bag.html#isEmptyBag"><span class="hs-identifier hs-var">isEmptyBag</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorMessages
</span><a href="#local-6989586621681204619"><span class="hs-identifier hs-var">errs</span></a></span><span>
</span><span id="line-132"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">ModuleGraph -&gt; m ModuleGraph
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621681204618"><span class="hs-identifier hs-var">mod_graph</span></a></span><span>
</span><span id="line-133"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">ErrorMessages -&gt; m ModuleGraph
forall (io :: * -&gt; *) a. MonadIO io =&gt; ErrorMessages -&gt; io a
</span><a href="GHC.Driver.Types.html#throwErrors"><span class="hs-identifier hs-var">throwErrors</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorMessages
</span><a href="#local-6989586621681204619"><span class="hs-identifier hs-var">errs</span></a></span><span>
</span><span id="line-134"></span><span>
</span><span id="line-135"></span><span class="hs-comment">-- | Perform dependency analysis like in 'depanal'.</span><span>
</span><span id="line-136"></span><span class="hs-comment">-- In case of errors, the errors and an empty module graph are returned.</span><span>
</span><span id="line-137"></span><span id="local-6989586621681205302"><span class="annot"><a href="GHC.Driver.Make.html#depanalE"><span class="hs-identifier hs-type">depanalE</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Monad.html#GhcMonad"><span class="hs-identifier hs-type">GhcMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681205302"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span>     </span><span class="hs-comment">-- New for #17459</span><span>
</span><span id="line-138"></span><span>            </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span class="hs-special">]</span><span>      </span><span class="hs-comment">-- ^ excluded modules</span><span>
</span><span id="line-139"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>           </span><span class="hs-comment">-- ^ allow duplicate roots</span><span>
</span><span id="line-140"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681205302"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Error.html#ErrorMessages"><span class="hs-identifier hs-type">ErrorMessages</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModuleGraph"><span class="hs-identifier hs-type">ModuleGraph</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-141"></span><span id="depanalE"><span class="annot"><span class="annottext">depanalE :: forall (m :: * -&gt; *).
GhcMonad m =&gt;
[ModuleName] -&gt; Bool -&gt; m (ErrorMessages, ModuleGraph)
</span><a href="GHC.Driver.Make.html#depanalE"><span class="hs-identifier hs-var hs-var">depanalE</span></a></span></span><span> </span><span id="local-6989586621681204596"><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621681204596"><span class="hs-identifier hs-var">excluded_mods</span></a></span></span><span> </span><span id="local-6989586621681204595"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681204595"><span class="hs-identifier hs-var">allow_dup_roots</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-142"></span><span>    </span><span id="local-6989586621681204594"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681204594"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m HscEnv
forall (m :: * -&gt; *). GhcMonad m =&gt; m HscEnv
</span><a href="GHC.Driver.Monad.html#getSession"><span class="hs-identifier hs-var">getSession</span></a></span><span>
</span><span id="line-143"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681204592"><span class="annot"><span class="annottext">ErrorMessages
</span><a href="#local-6989586621681204592"><span class="hs-identifier hs-var">errs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681204591"><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621681204591"><span class="hs-identifier hs-var">mod_graph</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[ModuleName] -&gt; Bool -&gt; m (ErrorMessages, ModuleGraph)
forall (m :: * -&gt; *).
GhcMonad m =&gt;
[ModuleName] -&gt; Bool -&gt; m (ErrorMessages, ModuleGraph)
</span><a href="GHC.Driver.Make.html#depanalPartial"><span class="hs-identifier hs-var">depanalPartial</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621681204596"><span class="hs-identifier hs-var">excluded_mods</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681204595"><span class="hs-identifier hs-var">allow_dup_roots</span></a></span><span>
</span><span id="line-144"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">ErrorMessages -&gt; Bool
forall a. Bag a -&gt; Bool
</span><a href="GHC.Data.Bag.html#isEmptyBag"><span class="hs-identifier hs-var">isEmptyBag</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorMessages
</span><a href="#local-6989586621681204592"><span class="hs-identifier hs-var">errs</span></a></span><span>
</span><span id="line-145"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-146"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681204590"><span class="annot"><span class="annottext">unused_home_mod_err :: [ErrMsg]
</span><a href="#local-6989586621681204590"><span class="hs-identifier hs-var hs-var">unused_home_mod_err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; ModuleGraph -&gt; [ErrMsg]
</span><a href="GHC.Driver.Make.html#warnMissingHomeModules"><span class="hs-identifier hs-var">warnMissingHomeModules</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681204594"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621681204591"><span class="hs-identifier hs-var">mod_graph</span></a></span><span>
</span><span id="line-147"></span><span>            </span><span id="local-6989586621681204588"><span class="annot"><span class="annottext">unused_pkg_err :: [ErrMsg]
</span><a href="#local-6989586621681204588"><span class="hs-identifier hs-var hs-var">unused_pkg_err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; ModuleGraph -&gt; [ErrMsg]
</span><a href="GHC.Driver.Make.html#warnUnusedPackages"><span class="hs-identifier hs-var">warnUnusedPackages</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681204594"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621681204591"><span class="hs-identifier hs-var">mod_graph</span></a></span><span>
</span><span id="line-148"></span><span>            </span><span id="local-6989586621681204586"><span class="annot"><span class="annottext">warns :: [ErrMsg]
</span><a href="#local-6989586621681204586"><span class="hs-identifier hs-var hs-var">warns</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ErrMsg]
</span><a href="#local-6989586621681204590"><span class="hs-identifier hs-var">unused_home_mod_err</span></a></span><span> </span><span class="annot"><span class="annottext">[ErrMsg] -&gt; [ErrMsg] -&gt; [ErrMsg]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[ErrMsg]
</span><a href="#local-6989586621681204588"><span class="hs-identifier hs-var">unused_pkg_err</span></a></span><span>
</span><span id="line-149"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[ErrMsg] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[ErrMsg]
</span><a href="#local-6989586621681204586"><span class="hs-identifier hs-var">warns</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-150"></span><span>          </span><span class="annot"><span class="annottext">ErrorMessages -&gt; m ()
forall (m :: * -&gt; *). GhcMonad m =&gt; ErrorMessages -&gt; m ()
</span><a href="GHC.Driver.Monad.html#logWarnings"><span class="hs-identifier hs-var">logWarnings</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ErrMsg] -&gt; ErrorMessages
forall a. [a] -&gt; Bag a
</span><a href="GHC.Data.Bag.html#listToBag"><span class="hs-identifier hs-var">listToBag</span></a></span><span> </span><span class="annot"><span class="annottext">[ErrMsg]
</span><a href="#local-6989586621681204586"><span class="hs-identifier hs-var">warns</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-151"></span><span>        </span><span class="annot"><span class="annottext">HscEnv -&gt; m ()
forall (m :: * -&gt; *). GhcMonad m =&gt; HscEnv -&gt; m ()
</span><a href="GHC.Driver.Monad.html#setSession"><span class="hs-identifier hs-var">setSession</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681204594"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hsc_mod_graph :: ModuleGraph
</span><a href="GHC.Driver.Types.html#hsc_mod_graph"><span class="hs-identifier hs-var">hsc_mod_graph</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621681204591"><span class="hs-identifier hs-var">mod_graph</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-152"></span><span>        </span><span class="annot"><span class="annottext">(ErrorMessages, ModuleGraph) -&gt; m (ErrorMessages, ModuleGraph)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ErrorMessages
</span><a href="#local-6989586621681204592"><span class="hs-identifier hs-var">errs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621681204591"><span class="hs-identifier hs-var">mod_graph</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-153"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-154"></span><span>        </span><span class="hs-comment">-- We don't have a complete module dependency graph,</span><span>
</span><span id="line-155"></span><span>        </span><span class="hs-comment">-- The graph may be disconnected and is unusable.</span><span>
</span><span id="line-156"></span><span>        </span><span class="annot"><span class="annottext">HscEnv -&gt; m ()
forall (m :: * -&gt; *). GhcMonad m =&gt; HscEnv -&gt; m ()
</span><a href="GHC.Driver.Monad.html#setSession"><span class="hs-identifier hs-var">setSession</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681204594"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hsc_mod_graph :: ModuleGraph
</span><a href="GHC.Driver.Types.html#hsc_mod_graph"><span class="hs-identifier hs-var">hsc_mod_graph</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="GHC.Driver.Types.html#emptyMG"><span class="hs-identifier hs-var">emptyMG</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-157"></span><span>        </span><span class="annot"><span class="annottext">(ErrorMessages, ModuleGraph) -&gt; m (ErrorMessages, ModuleGraph)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ErrorMessages
</span><a href="#local-6989586621681204592"><span class="hs-identifier hs-var">errs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="GHC.Driver.Types.html#emptyMG"><span class="hs-identifier hs-var">emptyMG</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-158"></span><span>
</span><span id="line-159"></span><span>
</span><span id="line-160"></span><span class="hs-comment">-- | Perform dependency analysis like 'depanal' but return a partial module</span><span>
</span><span id="line-161"></span><span class="hs-comment">-- graph even in the face of problems with some modules.</span><span>
</span><span id="line-162"></span><span class="hs-comment">--</span><span>
</span><span id="line-163"></span><span class="hs-comment">-- Modules which have parse errors in the module header, failing</span><span>
</span><span id="line-164"></span><span class="hs-comment">-- preprocessors or other issues preventing them from being summarised will</span><span>
</span><span id="line-165"></span><span class="hs-comment">-- simply be absent from the returned module graph.</span><span>
</span><span id="line-166"></span><span class="hs-comment">--</span><span>
</span><span id="line-167"></span><span class="hs-comment">-- Unlike 'depanal' this function will not update 'hsc_mod_graph' with the</span><span>
</span><span id="line-168"></span><span class="hs-comment">-- new module graph.</span><span>
</span><span id="line-169"></span><span id="local-6989586621681204578"><span class="annot"><a href="GHC.Driver.Make.html#depanalPartial"><span class="hs-identifier hs-type">depanalPartial</span></a></span><span>
</span><span id="line-170"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Monad.html#GhcMonad"><span class="hs-identifier hs-type">GhcMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681204578"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-171"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span class="hs-special">]</span><span>  </span><span class="hs-comment">-- ^ excluded modules</span><span>
</span><span id="line-172"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>          </span><span class="hs-comment">-- ^ allow duplicate roots</span><span>
</span><span id="line-173"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681204578"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Utils.Error.html#ErrorMessages"><span class="hs-identifier hs-type">ErrorMessages</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModuleGraph"><span class="hs-identifier hs-type">ModuleGraph</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-174"></span><span>    </span><span class="hs-comment">-- ^ possibly empty 'Bag' of errors and a module graph.</span><span>
</span><span id="line-175"></span><span id="depanalPartial"><span class="annot"><span class="annottext">depanalPartial :: forall (m :: * -&gt; *).
GhcMonad m =&gt;
[ModuleName] -&gt; Bool -&gt; m (ErrorMessages, ModuleGraph)
</span><a href="GHC.Driver.Make.html#depanalPartial"><span class="hs-identifier hs-var hs-var">depanalPartial</span></a></span></span><span> </span><span id="local-6989586621681204561"><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621681204561"><span class="hs-identifier hs-var">excluded_mods</span></a></span></span><span> </span><span id="local-6989586621681204560"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681204560"><span class="hs-identifier hs-var">allow_dup_roots</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-176"></span><span>  </span><span id="local-6989586621681204559"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681204559"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m HscEnv
forall (m :: * -&gt; *). GhcMonad m =&gt; m HscEnv
</span><a href="GHC.Driver.Monad.html#getSession"><span class="hs-identifier hs-var">getSession</span></a></span><span>
</span><span id="line-177"></span><span>  </span><span class="hs-keyword">let</span><span>
</span><span id="line-178"></span><span>         </span><span id="local-6989586621681204558"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621681204558"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681204559"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-179"></span><span>         </span><span id="local-6989586621681204556"><span class="annot"><span class="annottext">targets :: [Target]
</span><a href="#local-6989586621681204556"><span class="hs-identifier hs-var hs-var">targets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; [Target]
</span><a href="GHC.Driver.Types.html#hsc_targets"><span class="hs-identifier hs-var hs-var">hsc_targets</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681204559"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-180"></span><span>         </span><span id="local-6989586621681204554"><span class="annot"><span class="annottext">old_graph :: ModuleGraph
</span><a href="#local-6989586621681204554"><span class="hs-identifier hs-var hs-var">old_graph</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; ModuleGraph
</span><a href="GHC.Driver.Types.html#hsc_mod_graph"><span class="hs-identifier hs-var hs-var">hsc_mod_graph</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681204559"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-181"></span><span>
</span><span id="line-182"></span><span>  </span><span class="annot"><span class="annottext">DynFlags
-&gt; SDoc
-&gt; ((ErrorMessages, ModuleGraph) -&gt; ())
-&gt; m (ErrorMessages, ModuleGraph)
-&gt; m (ErrorMessages, ModuleGraph)
forall (m :: * -&gt; *) a.
MonadIO m =&gt;
DynFlags -&gt; SDoc -&gt; (a -&gt; ()) -&gt; m a -&gt; m a
</span><a href="GHC.Utils.Error.html#withTiming"><span class="hs-identifier hs-var">withTiming</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681204558"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;Chasing dependencies&quot;</span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; (ErrorMessages, ModuleGraph) -&gt; ()
forall a b. a -&gt; b -&gt; a
</span><a href="../../base/src/GHC.Base.html#const"><span class="hs-identifier hs-var">const</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m (ErrorMessages, ModuleGraph) -&gt; m (ErrorMessages, ModuleGraph))
-&gt; m (ErrorMessages, ModuleGraph) -&gt; m (ErrorMessages, ModuleGraph)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-183"></span><span>    </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Int -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681204558"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hcat"><span class="hs-identifier hs-var">hcat</span></a></span><span> </span><span class="hs-special">[</span><span>
</span><span id="line-184"></span><span>              </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;Chasing modules from: &quot;</span></span><span class="hs-special">,</span><span>
</span><span id="line-185"></span><span>              </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hcat"><span class="hs-identifier hs-var">hcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; [SDoc] -&gt; [SDoc]
</span><a href="GHC.Utils.Outputable.html#punctuate"><span class="hs-identifier hs-var">punctuate</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Target -&gt; SDoc) -&gt; [Target] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Target -&gt; SDoc
</span><a href="GHC.Driver.Types.html#pprTarget"><span class="hs-identifier hs-var">pprTarget</span></a></span><span> </span><span class="annot"><span class="annottext">[Target]
</span><a href="#local-6989586621681204556"><span class="hs-identifier hs-var">targets</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-186"></span><span>
</span><span id="line-187"></span><span>    </span><span class="hs-comment">-- Home package modules may have been moved or deleted, and new</span><span>
</span><span id="line-188"></span><span>    </span><span class="hs-comment">-- source files may have appeared in the home package that shadow</span><span>
</span><span id="line-189"></span><span>    </span><span class="hs-comment">-- external package modules, so we have to discard the existing</span><span>
</span><span id="line-190"></span><span>    </span><span class="hs-comment">-- cached finder data.</span><span>
</span><span id="line-191"></span><span>    </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; IO ()
</span><a href="GHC.Driver.Finder.html#flushFinderCaches"><span class="hs-identifier hs-var">flushFinderCaches</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681204559"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-192"></span><span>
</span><span id="line-193"></span><span>    </span><span id="local-6989586621681204543"><span class="annot"><span class="annottext">[Either ErrorMessages ModSummary]
</span><a href="#local-6989586621681204543"><span class="hs-identifier hs-var">mod_summariesE</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO [Either ErrorMessages ModSummary]
-&gt; m [Either ErrorMessages ModSummary]
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO [Either ErrorMessages ModSummary]
 -&gt; m [Either ErrorMessages ModSummary])
-&gt; IO [Either ErrorMessages ModSummary]
-&gt; m [Either ErrorMessages ModSummary]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; [ModSummary]
-&gt; [ModuleName]
-&gt; Bool
-&gt; IO [Either ErrorMessages ModSummary]
</span><a href="GHC.Driver.Make.html#downsweep"><span class="hs-identifier hs-var">downsweep</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681204559"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleGraph -&gt; [ModSummary]
</span><a href="GHC.Driver.Types.html#mgModSummaries"><span class="hs-identifier hs-var">mgModSummaries</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621681204554"><span class="hs-identifier hs-var">old_graph</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-194"></span><span>                                     </span><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621681204561"><span class="hs-identifier hs-var">excluded_mods</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681204560"><span class="hs-identifier hs-var">allow_dup_roots</span></a></span><span>
</span><span id="line-195"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-196"></span><span>           </span><span class="hs-special">(</span><span id="local-6989586621681204541"><span class="annot"><span class="annottext">[ErrorMessages]
</span><a href="#local-6989586621681204541"><span class="hs-identifier hs-var">errs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681204540"><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681204540"><span class="hs-identifier hs-var">mod_summaries</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Either ErrorMessages ModSummary]
-&gt; ([ErrorMessages], [ModSummary])
forall a b. [Either a b] -&gt; ([a], [b])
</span><a href="../../base/src/Data.Either.html#partitionEithers"><span class="hs-identifier hs-var">partitionEithers</span></a></span><span> </span><span class="annot"><span class="annottext">[Either ErrorMessages ModSummary]
</span><a href="#local-6989586621681204543"><span class="hs-identifier hs-var">mod_summariesE</span></a></span><span>
</span><span id="line-197"></span><span>           </span><span id="local-6989586621681204539"><span class="annot"><span class="annottext">mod_graph :: ModuleGraph
</span><a href="#local-6989586621681204539"><span class="hs-identifier hs-var hs-var">mod_graph</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ModSummary] -&gt; ModuleGraph
</span><a href="GHC.Driver.Types.html#mkModuleGraph"><span class="hs-identifier hs-var">mkModuleGraph</span></a></span><span> </span><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681204540"><span class="hs-identifier hs-var">mod_summaries</span></a></span><span>
</span><span id="line-198"></span><span>    </span><span class="annot"><span class="annottext">(ErrorMessages, ModuleGraph) -&gt; m (ErrorMessages, ModuleGraph)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ErrorMessages] -&gt; ErrorMessages
forall a. [Bag a] -&gt; Bag a
</span><a href="GHC.Data.Bag.html#unionManyBags"><span class="hs-identifier hs-var">unionManyBags</span></a></span><span> </span><span class="annot"><span class="annottext">[ErrorMessages]
</span><a href="#local-6989586621681204541"><span class="hs-identifier hs-var">errs</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621681204539"><span class="hs-identifier hs-var">mod_graph</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span class="hs-comment">-- Note [Missing home modules]</span><span>
</span><span id="line-201"></span><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><span id="line-202"></span><span class="hs-comment">-- Sometimes user doesn't want GHC to pick up modules, not explicitly listed</span><span>
</span><span id="line-203"></span><span class="hs-comment">-- in a command line. For example, cabal may want to enable this warning</span><span>
</span><span id="line-204"></span><span class="hs-comment">-- when building a library, so that GHC warns user about modules, not listed</span><span>
</span><span id="line-205"></span><span class="hs-comment">-- neither in `exposed-modules`, nor in `other-modules`.</span><span>
</span><span id="line-206"></span><span class="hs-comment">--</span><span>
</span><span id="line-207"></span><span class="hs-comment">-- Here &quot;home module&quot; means a module, that doesn't come from an other package.</span><span>
</span><span id="line-208"></span><span class="hs-comment">--</span><span>
</span><span id="line-209"></span><span class="hs-comment">-- For example, if GHC is invoked with modules &quot;A&quot; and &quot;B&quot; as targets,</span><span>
</span><span id="line-210"></span><span class="hs-comment">-- but &quot;A&quot; imports some other module &quot;C&quot;, then GHC will issue a warning</span><span>
</span><span id="line-211"></span><span class="hs-comment">-- about module &quot;C&quot; not being listed in a command line.</span><span>
</span><span id="line-212"></span><span class="hs-comment">--</span><span>
</span><span id="line-213"></span><span class="hs-comment">-- The warning in enabled by `-Wmissing-home-modules`. See #13129</span><span>
</span><span id="line-214"></span><span class="annot"><a href="GHC.Driver.Make.html#warnMissingHomeModules"><span class="hs-identifier hs-type">warnMissingHomeModules</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModuleGraph"><span class="hs-identifier hs-type">ModuleGraph</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Utils.Error.html#ErrMsg"><span class="hs-identifier hs-type">ErrMsg</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-215"></span><span id="warnMissingHomeModules"><span class="annot"><span class="annottext">warnMissingHomeModules :: HscEnv -&gt; ModuleGraph -&gt; [ErrMsg]
</span><a href="GHC.Driver.Make.html#warnMissingHomeModules"><span class="hs-identifier hs-var hs-var">warnMissingHomeModules</span></a></span></span><span> </span><span id="local-6989586621681204537"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681204537"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681204536"><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621681204536"><span class="hs-identifier hs-var">mod_graph</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-216"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WarningFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#wopt"><span class="hs-identifier hs-var">wopt</span></a></span><span> </span><span class="annot"><span class="annottext">WarningFlag
</span><a href="GHC.Driver.Flags.html#Opt_WarnMissingHomeModules"><span class="hs-identifier hs-var">Opt_WarnMissingHomeModules</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681204533"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ModuleName] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621681204531"><span class="hs-identifier hs-var">missing</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-217"></span><span>    </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ErrMsg
</span><a href="#local-6989586621681204530"><span class="hs-identifier hs-var">warn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-218"></span><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-219"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-220"></span><span>    </span><span id="local-6989586621681204533"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621681204533"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681204537"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-221"></span><span>    </span><span id="local-6989586621681204529"><span class="annot"><span class="annottext">targets :: [TargetId]
</span><a href="#local-6989586621681204529"><span class="hs-identifier hs-var hs-var">targets</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Target -&gt; TargetId) -&gt; [Target] -&gt; [TargetId]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">Target -&gt; TargetId
</span><a href="GHC.Driver.Types.html#targetId"><span class="hs-identifier hs-var hs-var">targetId</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; [Target]
</span><a href="GHC.Driver.Types.html#hsc_targets"><span class="hs-identifier hs-var hs-var">hsc_targets</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681204537"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-222"></span><span>
</span><span id="line-223"></span><span>    </span><span id="local-6989586621681204526"><span class="annot"><span class="annottext">is_known_module :: ModSummary -&gt; Bool
</span><a href="#local-6989586621681204526"><span class="hs-identifier hs-var hs-var">is_known_module</span></a></span></span><span> </span><span id="local-6989586621681204525"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681204525"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(TargetId -&gt; Bool) -&gt; [TargetId] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; TargetId -&gt; Bool
</span><a href="#local-6989586621681204523"><span class="hs-identifier hs-var">is_my_target</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681204525"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[TargetId]
</span><a href="#local-6989586621681204529"><span class="hs-identifier hs-var">targets</span></a></span><span>
</span><span id="line-224"></span><span>
</span><span id="line-225"></span><span>    </span><span class="hs-comment">-- We need to be careful to handle the case where (possibly</span><span>
</span><span id="line-226"></span><span>    </span><span class="hs-comment">-- path-qualified) filenames (aka 'TargetFile') rather than module</span><span>
</span><span id="line-227"></span><span>    </span><span class="hs-comment">-- names are being passed on the GHC command-line.</span><span>
</span><span id="line-228"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-229"></span><span>    </span><span class="hs-comment">-- For instance, `ghc --make src-exe/Main.hs` and</span><span>
</span><span id="line-230"></span><span>    </span><span class="hs-comment">-- `ghc --make -isrc-exe Main` are supposed to be equivalent.</span><span>
</span><span id="line-231"></span><span>    </span><span class="hs-comment">-- Note also that we can't always infer the associated module name</span><span>
</span><span id="line-232"></span><span>    </span><span class="hs-comment">-- directly from the filename argument.  See #13727.</span><span>
</span><span id="line-233"></span><span>    </span><span id="local-6989586621681204523"><span class="annot"><span class="annottext">is_my_target :: ModSummary -&gt; TargetId -&gt; Bool
</span><a href="#local-6989586621681204523"><span class="hs-identifier hs-var hs-var">is_my_target</span></a></span></span><span> </span><span id="local-6989586621681204517"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681204517"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Types.html#TargetModule"><span class="hs-identifier hs-type">TargetModule</span></a></span><span> </span><span id="local-6989586621681204515"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681204515"><span class="hs-identifier hs-var">name</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-234"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var hs-var">moduleName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; Module
</span><a href="GHC.Driver.Types.html#ms_mod"><span class="hs-identifier hs-var hs-var">ms_mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681204517"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; ModuleName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681204515"><span class="hs-identifier hs-var">name</span></a></span><span>
</span><span id="line-235"></span><span>    </span><span class="annot"><a href="#local-6989586621681204523"><span class="hs-identifier hs-var">is_my_target</span></a></span><span> </span><span id="local-6989586621681204512"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681204512"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Types.html#TargetFile"><span class="hs-identifier hs-type">TargetFile</span></a></span><span> </span><span id="local-6989586621681204510"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681204510"><span class="hs-identifier hs-var">target_file</span></a></span></span><span> </span><span class="annot"><span class="annottext">Maybe Phase
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-236"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681204509"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681204509"><span class="hs-identifier hs-var">mod_file</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModLocation -&gt; Maybe FilePath
</span><a href="GHC.Unit.Module.Location.html#ml_hs_file"><span class="hs-identifier hs-var hs-var">ml_hs_file</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; ModLocation
</span><a href="GHC.Driver.Types.html#ms_location"><span class="hs-identifier hs-var hs-var">ms_location</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681204512"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-237"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681204510"><span class="hs-identifier hs-var">target_file</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681204509"><span class="hs-identifier hs-var">mod_file</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span>
</span><span id="line-238"></span><span>
</span><span id="line-239"></span><span>           </span><span class="hs-comment">--  Don't warn on B.hs-boot if B.hs is specified (#16551)</span><span>
</span><span id="line-240"></span><span>           </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath
</span><a href="GHC.Unit.Module.Location.html#addBootSuffix"><span class="hs-identifier hs-var">addBootSuffix</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681204510"><span class="hs-identifier hs-var">target_file</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681204509"><span class="hs-identifier hs-var">mod_file</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span>
</span><span id="line-241"></span><span>
</span><span id="line-242"></span><span>           </span><span class="hs-comment">--  We can get a file target even if a module name was</span><span>
</span><span id="line-243"></span><span>           </span><span class="hs-comment">--  originally specified in a command line because it can</span><span>
</span><span id="line-244"></span><span>           </span><span class="hs-comment">--  be converted in guessTarget (by appending .hs/.lhs).</span><span>
</span><span id="line-245"></span><span>           </span><span class="hs-comment">--  So let's convert it back and compare with module name</span><span>
</span><span id="line-246"></span><span>           </span><span class="annot"><span class="annottext">FilePath -&gt; ModuleName
</span><a href="GHC.Unit.Module.Name.html#mkModuleName"><span class="hs-identifier hs-var">mkModuleName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(FilePath, FilePath) -&gt; FilePath
forall a b. (a, b) -&gt; a
</span><a href="../../base/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">((FilePath, FilePath) -&gt; FilePath)
-&gt; (FilePath, FilePath) -&gt; FilePath
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; (FilePath, FilePath)
</span><a href="../../filepath/src/System.FilePath.Windows.html#splitExtension"><span class="hs-identifier hs-var">splitExtension</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681204510"><span class="hs-identifier hs-var">target_file</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-247"></span><span>            </span><span class="annot"><span class="annottext">ModuleName -&gt; ModuleName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Module -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var hs-var">moduleName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; Module
</span><a href="GHC.Driver.Types.html#ms_mod"><span class="hs-identifier hs-var hs-var">ms_mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681204512"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-248"></span><span>    </span><span class="annot"><a href="#local-6989586621681204523"><span class="hs-identifier hs-var">is_my_target</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">TargetId
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-249"></span><span>
</span><span id="line-250"></span><span>    </span><span id="local-6989586621681204531"><span class="annot"><span class="annottext">missing :: [ModuleName]
</span><a href="#local-6989586621681204531"><span class="hs-identifier hs-var hs-var">missing</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ModSummary -&gt; ModuleName) -&gt; [ModSummary] -&gt; [ModuleName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">(Module -&gt; ModuleName)
-&gt; (ModSummary -&gt; Module) -&gt; ModSummary -&gt; ModuleName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; Module
</span><a href="GHC.Driver.Types.html#ms_mod"><span class="hs-identifier hs-var hs-var">ms_mod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([ModSummary] -&gt; [ModuleName]) -&gt; [ModSummary] -&gt; [ModuleName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-251"></span><span>      </span><span class="annot"><span class="annottext">(ModSummary -&gt; Bool) -&gt; [ModSummary] -&gt; [ModSummary]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; (ModSummary -&gt; Bool) -&gt; ModSummary -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; Bool
</span><a href="#local-6989586621681204526"><span class="hs-identifier hs-var">is_known_module</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleGraph -&gt; [ModSummary]
</span><a href="GHC.Driver.Types.html#mgModSummaries"><span class="hs-identifier hs-var">mgModSummaries</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621681204536"><span class="hs-identifier hs-var">mod_graph</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-252"></span><span>
</span><span id="line-253"></span><span>    </span><span id="local-6989586621681204499"><span class="annot"><span class="annottext">msg :: SDoc
</span><a href="#local-6989586621681204499"><span class="hs-identifier hs-var hs-var">msg</span></a></span></span><span>
</span><span id="line-254"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_BuildingCabalPackage"><span class="hs-identifier hs-var">Opt_BuildingCabalPackage</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681204533"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-255"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span>
</span><span id="line-256"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;These modules are needed for compilation but not listed in your .cabal file's other-modules: &quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-257"></span><span>          </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span>
</span><span id="line-258"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ModuleName -&gt; SDoc) -&gt; [ModuleName] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621681204531"><span class="hs-identifier hs-var">missing</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-259"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-260"></span><span>      </span><span class="hs-glyph">=</span><span>
</span><span id="line-261"></span><span>        </span><span class="annot"><span class="annottext">SDoc -&gt; Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span>
</span><span id="line-262"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;Modules are not listed in command line but needed for compilation: &quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-263"></span><span>          </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">4</span></span><span>
</span><span id="line-264"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ModuleName -&gt; SDoc) -&gt; [ModuleName] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621681204531"><span class="hs-identifier hs-var">missing</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-265"></span><span>    </span><span id="local-6989586621681204530"><span class="annot"><span class="annottext">warn :: ErrMsg
</span><a href="#local-6989586621681204530"><span class="hs-identifier hs-var hs-var">warn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WarnReason -&gt; ErrMsg -&gt; ErrMsg
</span><a href="GHC.Utils.Error.html#makeIntoWarning"><span class="hs-identifier hs-var">makeIntoWarning</span></a></span><span>
</span><span id="line-266"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WarningFlag -&gt; WarnReason
</span><a href="GHC.Driver.Flags.html#Reason"><span class="hs-identifier hs-var">Reason</span></a></span><span> </span><span class="annot"><span class="annottext">WarningFlag
</span><a href="GHC.Driver.Flags.html#Opt_WarnMissingHomeModules"><span class="hs-identifier hs-var">Opt_WarnMissingHomeModules</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-267"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; SrcSpan -&gt; SDoc -&gt; ErrMsg
</span><a href="GHC.Utils.Error.html#mkPlainErrMsg"><span class="hs-identifier hs-var">mkPlainErrMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681204533"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="GHC.Types.SrcLoc.html#noSrcSpan"><span class="hs-identifier hs-var">noSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681204499"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-268"></span><span>
</span><span id="line-269"></span><span class="hs-comment">-- | Describes which modules of the module graph need to be loaded.</span><span>
</span><span id="line-270"></span><span class="hs-keyword">data</span><span> </span><span id="LoadHowMuch"><span class="annot"><a href="GHC.Driver.Make.html#LoadHowMuch"><span class="hs-identifier hs-var">LoadHowMuch</span></a></span></span><span>
</span><span id="line-271"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span id="LoadAllTargets"><span class="annot"><a href="GHC.Driver.Make.html#LoadAllTargets"><span class="hs-identifier hs-var">LoadAllTargets</span></a></span></span><span>
</span><span id="line-272"></span><span>     </span><span class="hs-comment">-- ^ Load all targets and its dependencies.</span><span>
</span><span id="line-273"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span id="LoadUpTo"><span class="annot"><a href="GHC.Driver.Make.html#LoadUpTo"><span class="hs-identifier hs-var">LoadUpTo</span></a></span></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span>
</span><span id="line-274"></span><span>     </span><span class="hs-comment">-- ^ Load only the given module and its dependencies.</span><span>
</span><span id="line-275"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span id="LoadDependenciesOf"><span class="annot"><a href="GHC.Driver.Make.html#LoadDependenciesOf"><span class="hs-identifier hs-var">LoadDependenciesOf</span></a></span></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span>
</span><span id="line-276"></span><span>     </span><span class="hs-comment">-- ^ Load only the dependencies of the given module, but not the module</span><span>
</span><span id="line-277"></span><span>     </span><span class="hs-comment">-- itself.</span><span>
</span><span id="line-278"></span><span>
</span><span id="line-279"></span><span class="hs-comment">-- | Try to load the program.  See 'LoadHowMuch' for the different modes.</span><span>
</span><span id="line-280"></span><span class="hs-comment">--</span><span>
</span><span id="line-281"></span><span class="hs-comment">-- This function implements the core of GHC's @--make@ mode.  It preprocesses,</span><span>
</span><span id="line-282"></span><span class="hs-comment">-- compiles and loads the specified modules, avoiding re-compilation wherever</span><span>
</span><span id="line-283"></span><span class="hs-comment">-- possible.  Depending on the target (see 'GHC.Driver.Session.hscTarget') compiling</span><span>
</span><span id="line-284"></span><span class="hs-comment">-- and loading may result in files being created on disk.</span><span>
</span><span id="line-285"></span><span class="hs-comment">--</span><span>
</span><span id="line-286"></span><span class="hs-comment">-- Calls the 'defaultWarnErrLogger' after each compiling each module, whether</span><span>
</span><span id="line-287"></span><span class="hs-comment">-- successful or not.</span><span>
</span><span id="line-288"></span><span class="hs-comment">--</span><span>
</span><span id="line-289"></span><span class="hs-comment">-- If errors are encountered during dependency analysis, the module `depanalE`</span><span>
</span><span id="line-290"></span><span class="hs-comment">-- returns together with the errors an empty ModuleGraph.</span><span>
</span><span id="line-291"></span><span class="hs-comment">-- After processing this empty ModuleGraph, the errors of depanalE are thrown.</span><span>
</span><span id="line-292"></span><span class="hs-comment">-- All other errors are reported using the 'defaultWarnErrLogger'.</span><span>
</span><span id="line-293"></span><span class="hs-comment">--</span><span>
</span><span id="line-294"></span><span id="local-6989586621681205248"><span class="annot"><a href="GHC.Driver.Make.html#load"><span class="hs-identifier hs-type">load</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Monad.html#GhcMonad"><span class="hs-identifier hs-type">GhcMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681205248"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#LoadHowMuch"><span class="hs-identifier hs-type">LoadHowMuch</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681205248"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#SuccessFlag"><span class="hs-identifier hs-type">SuccessFlag</span></a></span></span><span>
</span><span id="line-295"></span><span id="load"><span class="annot"><span class="annottext">load :: forall (m :: * -&gt; *). GhcMonad m =&gt; LoadHowMuch -&gt; m SuccessFlag
</span><a href="GHC.Driver.Make.html#load"><span class="hs-identifier hs-var hs-var">load</span></a></span></span><span> </span><span id="local-6989586621681204473"><span class="annot"><span class="annottext">LoadHowMuch
</span><a href="#local-6989586621681204473"><span class="hs-identifier hs-var">how_much</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-296"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681204472"><span class="annot"><span class="annottext">ErrorMessages
</span><a href="#local-6989586621681204472"><span class="hs-identifier hs-var">errs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681204471"><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621681204471"><span class="hs-identifier hs-var">mod_graph</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[ModuleName] -&gt; Bool -&gt; m (ErrorMessages, ModuleGraph)
forall (m :: * -&gt; *).
GhcMonad m =&gt;
[ModuleName] -&gt; Bool -&gt; m (ErrorMessages, ModuleGraph)
</span><a href="GHC.Driver.Make.html#depanalE"><span class="hs-identifier hs-var">depanalE</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>                        </span><span class="hs-comment">-- #17459</span><span>
</span><span id="line-297"></span><span>    </span><span id="local-6989586621681204470"><span class="annot"><span class="annottext">SuccessFlag
</span><a href="#local-6989586621681204470"><span class="hs-identifier hs-var">success</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LoadHowMuch -&gt; Maybe Messager -&gt; ModuleGraph -&gt; m SuccessFlag
forall (m :: * -&gt; *).
GhcMonad m =&gt;
LoadHowMuch -&gt; Maybe Messager -&gt; ModuleGraph -&gt; m SuccessFlag
</span><a href="GHC.Driver.Make.html#load%27"><span class="hs-identifier hs-var">load'</span></a></span><span> </span><span class="annot"><span class="annottext">LoadHowMuch
</span><a href="#local-6989586621681204473"><span class="hs-identifier hs-var">how_much</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Messager -&gt; Maybe Messager
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Messager
</span><a href="GHC.Driver.Main.html#batchMsg"><span class="hs-identifier hs-var">batchMsg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621681204471"><span class="hs-identifier hs-var">mod_graph</span></a></span><span>
</span><span id="line-298"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">ErrorMessages -&gt; Bool
forall a. Bag a -&gt; Bool
</span><a href="GHC.Data.Bag.html#isEmptyBag"><span class="hs-identifier hs-var">isEmptyBag</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorMessages
</span><a href="#local-6989586621681204472"><span class="hs-identifier hs-var">errs</span></a></span><span>
</span><span id="line-299"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">SuccessFlag -&gt; m SuccessFlag
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">SuccessFlag
</span><a href="#local-6989586621681204470"><span class="hs-identifier hs-var">success</span></a></span><span>
</span><span id="line-300"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">ErrorMessages -&gt; m SuccessFlag
forall (io :: * -&gt; *) a. MonadIO io =&gt; ErrorMessages -&gt; io a
</span><a href="GHC.Driver.Types.html#throwErrors"><span class="hs-identifier hs-var">throwErrors</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorMessages
</span><a href="#local-6989586621681204472"><span class="hs-identifier hs-var">errs</span></a></span><span>
</span><span id="line-301"></span><span>
</span><span id="line-302"></span><span class="hs-comment">-- Note [Unused packages]</span><span>
</span><span id="line-303"></span><span class="hs-comment">--</span><span>
</span><span id="line-304"></span><span class="hs-comment">-- Cabal passes `--package-id` flag for each direct dependency. But GHC</span><span>
</span><span id="line-305"></span><span class="hs-comment">-- loads them lazily, so when compilation is done, we have a list of all</span><span>
</span><span id="line-306"></span><span class="hs-comment">-- actually loaded packages. All the packages, specified on command line,</span><span>
</span><span id="line-307"></span><span class="hs-comment">-- but never loaded, are probably unused dependencies.</span><span>
</span><span id="line-308"></span><span>
</span><span id="line-309"></span><span class="annot"><a href="GHC.Driver.Make.html#warnUnusedPackages"><span class="hs-identifier hs-type">warnUnusedPackages</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModuleGraph"><span class="hs-identifier hs-type">ModuleGraph</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Utils.Error.html#ErrMsg"><span class="hs-identifier hs-type">ErrMsg</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-310"></span><span id="warnUnusedPackages"><span class="annot"><span class="annottext">warnUnusedPackages :: HscEnv -&gt; ModuleGraph -&gt; [ErrMsg]
</span><a href="GHC.Driver.Make.html#warnUnusedPackages"><span class="hs-identifier hs-var hs-var">warnUnusedPackages</span></a></span></span><span> </span><span id="local-6989586621681204468"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681204468"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681204467"><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621681204467"><span class="hs-identifier hs-var">mod_graph</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-311"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681204466"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621681204466"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681204468"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-312"></span><span>        </span><span id="local-6989586621681204465"><span class="annot"><span class="annottext">state :: UnitState
</span><a href="#local-6989586621681204465"><span class="hs-identifier hs-var hs-var">state</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; UnitState
</span><a href="GHC.Driver.Session.html#unitState"><span class="hs-identifier hs-var hs-var">unitState</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681204466"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-313"></span><span>
</span><span id="line-314"></span><span>    </span><span class="hs-comment">-- Only need non-source imports here because SOURCE imports are always HPT</span><span>
</span><span id="line-315"></span><span>        </span><span id="local-6989586621681204461"><span class="annot"><span class="annottext">loadedPackages :: [UnitInfo]
</span><a href="#local-6989586621681204461"><span class="hs-identifier hs-var hs-var">loadedPackages</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[UnitInfo]] -&gt; [UnitInfo]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><a href="../../base/src/Data.Foldable.html#concat"><span class="hs-identifier hs-var">concat</span></a></span><span> </span><span class="annot"><span class="annottext">([[UnitInfo]] -&gt; [UnitInfo]) -&gt; [[UnitInfo]] -&gt; [UnitInfo]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-316"></span><span>          </span><span class="annot"><span class="annottext">((Maybe FastString, GenLocated SrcSpan ModuleName)
 -&gt; Maybe [UnitInfo])
-&gt; [(Maybe FastString, GenLocated SrcSpan ModuleName)]
-&gt; [[UnitInfo]]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/Data.Maybe.html#mapMaybe"><span class="hs-identifier hs-var">mapMaybe</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621681204458"><span class="annot"><span class="annottext">Maybe FastString
</span><a href="#local-6989586621681204458"><span class="hs-identifier hs-var">fs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681204457"><span class="annot"><span class="annottext">GenLocated SrcSpan ModuleName
</span><a href="#local-6989586621681204457"><span class="hs-identifier hs-var">mn</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UnitState -&gt; ModuleName -&gt; Maybe FastString -&gt; Maybe [UnitInfo]
</span><a href="GHC.Unit.State.html#lookupModulePackage"><span class="hs-identifier hs-var">lookupModulePackage</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681204465"><span class="hs-identifier hs-var">state</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpan ModuleName -&gt; ModuleName
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpan ModuleName
</span><a href="#local-6989586621681204457"><span class="hs-identifier hs-var">mn</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe FastString
</span><a href="#local-6989586621681204458"><span class="hs-identifier hs-var">fs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-317"></span><span>            </span><span class="annot"><span class="annottext">([(Maybe FastString, GenLocated SrcSpan ModuleName)]
 -&gt; [[UnitInfo]])
-&gt; [(Maybe FastString, GenLocated SrcSpan ModuleName)]
-&gt; [[UnitInfo]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(ModSummary -&gt; [(Maybe FastString, GenLocated SrcSpan ModuleName)])
-&gt; [ModSummary]
-&gt; [(Maybe FastString, GenLocated SrcSpan ModuleName)]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><a href="../../base/src/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; [(Maybe FastString, GenLocated SrcSpan ModuleName)]
</span><a href="GHC.Driver.Types.html#ms_imps"><span class="hs-identifier hs-var">ms_imps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleGraph -&gt; [ModSummary]
</span><a href="GHC.Driver.Types.html#mgModSummaries"><span class="hs-identifier hs-var">mgModSummaries</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621681204467"><span class="hs-identifier hs-var">mod_graph</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-318"></span><span>
</span><span id="line-319"></span><span>        </span><span id="local-6989586621681204452"><span class="annot"><span class="annottext">requestedArgs :: [PackageArg]
</span><a href="#local-6989586621681204452"><span class="hs-identifier hs-var hs-var">requestedArgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PackageFlag -&gt; Maybe PackageArg) -&gt; [PackageFlag] -&gt; [PackageArg]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/Data.Maybe.html#mapMaybe"><span class="hs-identifier hs-var">mapMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">PackageFlag -&gt; Maybe PackageArg
</span><a href="#local-6989586621681204451"><span class="hs-identifier hs-var">packageArg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; [PackageFlag]
</span><a href="GHC.Driver.Session.html#packageFlags"><span class="hs-identifier hs-var hs-var">packageFlags</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681204466"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-320"></span><span>
</span><span id="line-321"></span><span>        </span><span id="local-6989586621681204448"><span class="annot"><span class="annottext">unusedArgs :: [PackageArg]
</span><a href="#local-6989586621681204448"><span class="hs-identifier hs-var hs-var">unusedArgs</span></a></span></span><span>
</span><span id="line-322"></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PackageArg -&gt; Bool) -&gt; [PackageArg] -&gt; [PackageArg]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681204447"><span class="annot"><span class="annottext">PackageArg
</span><a href="#local-6989586621681204447"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(UnitInfo -&gt; Bool) -&gt; [UnitInfo] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitState -&gt; PackageArg -&gt; UnitInfo -&gt; Bool
</span><a href="#local-6989586621681204446"><span class="hs-identifier hs-var">matching</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681204465"><span class="hs-identifier hs-var">state</span></a></span><span> </span><span class="annot"><span class="annottext">PackageArg
</span><a href="#local-6989586621681204447"><span class="hs-identifier hs-var">arg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[UnitInfo]
</span><a href="#local-6989586621681204461"><span class="hs-identifier hs-var">loadedPackages</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-323"></span><span>                   </span><span class="annot"><span class="annottext">[PackageArg]
</span><a href="#local-6989586621681204452"><span class="hs-identifier hs-var">requestedArgs</span></a></span><span>
</span><span id="line-324"></span><span>
</span><span id="line-325"></span><span>        </span><span id="local-6989586621681204445"><span class="annot"><span class="annottext">warn :: ErrMsg
</span><a href="#local-6989586621681204445"><span class="hs-identifier hs-var hs-var">warn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">WarnReason -&gt; ErrMsg -&gt; ErrMsg
</span><a href="GHC.Utils.Error.html#makeIntoWarning"><span class="hs-identifier hs-var">makeIntoWarning</span></a></span><span>
</span><span id="line-326"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WarningFlag -&gt; WarnReason
</span><a href="GHC.Driver.Flags.html#Reason"><span class="hs-identifier hs-var">Reason</span></a></span><span> </span><span class="annot"><span class="annottext">WarningFlag
</span><a href="GHC.Driver.Flags.html#Opt_WarnUnusedPackages"><span class="hs-identifier hs-var">Opt_WarnUnusedPackages</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-327"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; SrcSpan -&gt; SDoc -&gt; ErrMsg
</span><a href="GHC.Utils.Error.html#mkPlainErrMsg"><span class="hs-identifier hs-var">mkPlainErrMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681204466"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="GHC.Types.SrcLoc.html#noSrcSpan"><span class="hs-identifier hs-var">noSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681204443"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-328"></span><span>        </span><span id="local-6989586621681204443"><span class="annot"><span class="annottext">msg :: SDoc
</span><a href="#local-6989586621681204443"><span class="hs-identifier hs-var hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;The following packages were specified&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-329"></span><span>                     </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;via -package or -package-id flags,&quot;</span></span><span>
</span><span id="line-330"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;but were not needed for compilation:&quot;</span></span><span>
</span><span id="line-331"></span><span>                   </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PackageArg -&gt; SDoc) -&gt; [PackageArg] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="#local-6989586621681204439"><span class="hs-identifier hs-var">withDash</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc) -&gt; (PackageArg -&gt; SDoc) -&gt; PackageArg -&gt; SDoc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">PackageArg -&gt; SDoc
</span><a href="#local-6989586621681204438"><span class="hs-identifier hs-var">pprUnusedArg</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[PackageArg]
</span><a href="#local-6989586621681204448"><span class="hs-identifier hs-var">unusedArgs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-332"></span><span>
</span><span id="line-333"></span><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[PackageArg] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[PackageArg]
</span><a href="#local-6989586621681204448"><span class="hs-identifier hs-var">unusedArgs</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">WarningFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#wopt"><span class="hs-identifier hs-var">wopt</span></a></span><span> </span><span class="annot"><span class="annottext">WarningFlag
</span><a href="GHC.Driver.Flags.html#Opt_WarnUnusedPackages"><span class="hs-identifier hs-var">Opt_WarnUnusedPackages</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681204466"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-334"></span><span>       </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ErrMsg
</span><a href="#local-6989586621681204445"><span class="hs-identifier hs-var">warn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-335"></span><span>       </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-336"></span><span>
</span><span id="line-337"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-338"></span><span>        </span><span id="local-6989586621681204451"><span class="annot"><span class="annottext">packageArg :: PackageFlag -&gt; Maybe PackageArg
</span><a href="#local-6989586621681204451"><span class="hs-identifier hs-var hs-var">packageArg</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Session.html#ExposePackage"><span class="hs-identifier hs-type">ExposePackage</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681204436"><span class="annot"><span class="annottext">PackageArg
</span><a href="#local-6989586621681204436"><span class="hs-identifier hs-var">arg</span></a></span></span><span> </span><span class="annot"><span class="annottext">ModRenaming
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PackageArg -&gt; Maybe PackageArg
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">PackageArg
</span><a href="#local-6989586621681204436"><span class="hs-identifier hs-var">arg</span></a></span><span>
</span><span id="line-339"></span><span>        </span><span class="annot"><a href="#local-6989586621681204451"><span class="hs-identifier hs-var">packageArg</span></a></span><span> </span><span class="annot"><span class="annottext">PackageFlag
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe PackageArg
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-340"></span><span>
</span><span id="line-341"></span><span>        </span><span id="local-6989586621681204438"><span class="annot"><span class="annottext">pprUnusedArg :: PackageArg -&gt; SDoc
</span><a href="#local-6989586621681204438"><span class="hs-identifier hs-var hs-var">pprUnusedArg</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Session.html#PackageArg"><span class="hs-identifier hs-type">PackageArg</span></a></span><span> </span><span id="local-6989586621681204432"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681204432"><span class="hs-identifier hs-var">str</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681204432"><span class="hs-identifier hs-var">str</span></a></span><span>
</span><span id="line-342"></span><span>        </span><span class="annot"><a href="#local-6989586621681204438"><span class="hs-identifier hs-var">pprUnusedArg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Session.html#UnitIdArg"><span class="hs-identifier hs-type">UnitIdArg</span></a></span><span> </span><span id="local-6989586621681204430"><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681204430"><span class="hs-identifier hs-var">uid</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681204430"><span class="hs-identifier hs-var">uid</span></a></span><span>
</span><span id="line-343"></span><span>
</span><span id="line-344"></span><span>        </span><span id="local-6989586621681204439"><span class="annot"><span class="annottext">withDash :: SDoc -&gt; SDoc
</span><a href="#local-6989586621681204439"><span class="hs-identifier hs-var hs-var">withDash</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">(&lt;+&gt;)</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;-&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-345"></span><span>
</span><span id="line-346"></span><span>        </span><span class="annot"><a href="#local-6989586621681204429"><span class="hs-identifier hs-type">matchingStr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-347"></span><span>        </span><span id="local-6989586621681204429"><span class="annot"><span class="annottext">matchingStr :: FilePath -&gt; UnitInfo -&gt; Bool
</span><a href="#local-6989586621681204429"><span class="hs-identifier hs-var hs-var">matchingStr</span></a></span></span><span> </span><span id="local-6989586621681204428"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681204428"><span class="hs-identifier hs-var">str</span></a></span></span><span> </span><span id="local-6989586621681204427"><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681204427"><span class="hs-identifier hs-var">p</span></a></span></span><span>
</span><span id="line-348"></span><span>                </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681204428"><span class="hs-identifier hs-var">str</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; FilePath
forall u. GenUnitInfo u -&gt; FilePath
</span><a href="GHC.Unit.Info.html#unitPackageIdString"><span class="hs-identifier hs-var">unitPackageIdString</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681204427"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-349"></span><span>                </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681204428"><span class="hs-identifier hs-var">str</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; FilePath
forall u. GenUnitInfo u -&gt; FilePath
</span><a href="GHC.Unit.Info.html#unitPackageNameString"><span class="hs-identifier hs-var">unitPackageNameString</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681204427"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-350"></span><span>
</span><span id="line-351"></span><span>        </span><span class="annot"><a href="#local-6989586621681204446"><span class="hs-identifier hs-type">matching</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitState"><span class="hs-identifier hs-type">UnitState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#PackageArg"><span class="hs-identifier hs-type">PackageArg</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-352"></span><span>        </span><span id="local-6989586621681204446"><span class="annot"><span class="annottext">matching :: UnitState -&gt; PackageArg -&gt; UnitInfo -&gt; Bool
</span><a href="#local-6989586621681204446"><span class="hs-identifier hs-var hs-var">matching</span></a></span></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Session.html#PackageArg"><span class="hs-identifier hs-type">PackageArg</span></a></span><span> </span><span id="local-6989586621681204424"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681204424"><span class="hs-identifier hs-var">str</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681204423"><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681204423"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; UnitInfo -&gt; Bool
</span><a href="#local-6989586621681204429"><span class="hs-identifier hs-var">matchingStr</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681204424"><span class="hs-identifier hs-var">str</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681204423"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-353"></span><span>        </span><span class="annot"><a href="#local-6989586621681204446"><span class="hs-identifier hs-var">matching</span></a></span><span> </span><span id="local-6989586621681204422"><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681204422"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Session.html#UnitIdArg"><span class="hs-identifier hs-type">UnitIdArg</span></a></span><span> </span><span id="local-6989586621681204421"><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681204421"><span class="hs-identifier hs-var">uid</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681204420"><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681204420"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681204421"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId -&gt; GenUnit UnitId -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">UnitState -&gt; UnitInfo -&gt; GenUnit UnitId
</span><a href="#local-6989586621681204419"><span class="hs-identifier hs-var">realUnit</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681204422"><span class="hs-identifier hs-var">state</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo
</span><a href="#local-6989586621681204420"><span class="hs-identifier hs-var">p</span></a></span><span>
</span><span id="line-354"></span><span>
</span><span id="line-355"></span><span>        </span><span class="hs-comment">-- For wired-in packages, we have to unwire their id,</span><span>
</span><span id="line-356"></span><span>        </span><span class="hs-comment">-- otherwise they won't match package flags</span><span>
</span><span id="line-357"></span><span>        </span><span class="annot"><a href="#local-6989586621681204419"><span class="hs-identifier hs-type">realUnit</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.State.html#UnitState"><span class="hs-identifier hs-type">UnitState</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Info.html#UnitInfo"><span class="hs-identifier hs-type">UnitInfo</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Unit"><span class="hs-identifier hs-type">Unit</span></a></span><span>
</span><span id="line-358"></span><span>        </span><span id="local-6989586621681204419"><span class="annot"><span class="annottext">realUnit :: UnitState -&gt; UnitInfo -&gt; GenUnit UnitId
</span><a href="#local-6989586621681204419"><span class="hs-identifier hs-var hs-var">realUnit</span></a></span></span><span> </span><span id="local-6989586621681204417"><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681204417"><span class="hs-identifier hs-var">state</span></a></span></span><span>
</span><span id="line-359"></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UnitState -&gt; GenUnit UnitId -&gt; GenUnit UnitId
</span><a href="GHC.Unit.State.html#unwireUnit"><span class="hs-identifier hs-var">unwireUnit</span></a></span><span> </span><span class="annot"><span class="annottext">UnitState
</span><a href="#local-6989586621681204417"><span class="hs-identifier hs-var">state</span></a></span><span>
</span><span id="line-360"></span><span>          </span><span class="annot"><span class="annottext">(GenUnit UnitId -&gt; GenUnit UnitId)
-&gt; (UnitInfo -&gt; GenUnit UnitId) -&gt; UnitInfo -&gt; GenUnit UnitId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">Definite UnitId -&gt; GenUnit UnitId
forall uid. Definite uid -&gt; GenUnit uid
</span><a href="GHC.Unit.Types.html#RealUnit"><span class="hs-identifier hs-var">RealUnit</span></a></span><span>
</span><span id="line-361"></span><span>          </span><span class="annot"><span class="annottext">(Definite UnitId -&gt; GenUnit UnitId)
-&gt; (UnitInfo -&gt; Definite UnitId) -&gt; UnitInfo -&gt; GenUnit UnitId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">UnitId -&gt; Definite UnitId
forall unit. unit -&gt; Definite unit
</span><a href="GHC.Unit.Types.html#Definite"><span class="hs-identifier hs-var">Definite</span></a></span><span>
</span><span id="line-362"></span><span>          </span><span class="annot"><span class="annottext">(UnitId -&gt; Definite UnitId)
-&gt; (UnitInfo -&gt; UnitId) -&gt; UnitInfo -&gt; Definite UnitId
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">UnitInfo -&gt; UnitId
forall compid srcpkgid srcpkgname uid modulename mod.
GenericUnitInfo compid srcpkgid srcpkgname uid modulename mod
-&gt; uid
</span><a href="../../ghc-boot/src/GHC.Unit.Database.html#unitId"><span class="hs-identifier hs-var hs-var">unitId</span></a></span><span>
</span><span id="line-363"></span><span>
</span><span id="line-364"></span><span class="hs-comment">-- | Generalized version of 'load' which also supports a custom</span><span>
</span><span id="line-365"></span><span class="hs-comment">-- 'Messager' (for reporting progress) and 'ModuleGraph' (generally</span><span>
</span><span id="line-366"></span><span class="hs-comment">-- produced by calling 'depanal'.</span><span>
</span><span id="line-367"></span><span id="local-6989586621681205243"><span class="annot"><a href="GHC.Driver.Make.html#load%27"><span class="hs-identifier hs-type">load'</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Monad.html#GhcMonad"><span class="hs-identifier hs-type">GhcMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681205243"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#LoadHowMuch"><span class="hs-identifier hs-type">LoadHowMuch</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#Messager"><span class="hs-identifier hs-type">Messager</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModuleGraph"><span class="hs-identifier hs-type">ModuleGraph</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681205243"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#SuccessFlag"><span class="hs-identifier hs-type">SuccessFlag</span></a></span></span><span>
</span><span id="line-368"></span><span id="load%27"><span class="annot"><span class="annottext">load' :: forall (m :: * -&gt; *).
GhcMonad m =&gt;
LoadHowMuch -&gt; Maybe Messager -&gt; ModuleGraph -&gt; m SuccessFlag
</span><a href="GHC.Driver.Make.html#load%27"><span class="hs-identifier hs-var hs-var">load'</span></a></span></span><span> </span><span id="local-6989586621681204347"><span class="annot"><span class="annottext">LoadHowMuch
</span><a href="#local-6989586621681204347"><span class="hs-identifier hs-var">how_much</span></a></span></span><span> </span><span id="local-6989586621681204346"><span class="annot"><span class="annottext">Maybe Messager
</span><a href="#local-6989586621681204346"><span class="hs-identifier hs-var">mHscMessage</span></a></span></span><span> </span><span id="local-6989586621681204345"><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621681204345"><span class="hs-identifier hs-var">mod_graph</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-369"></span><span>    </span><span class="annot"><span class="annottext">(HscEnv -&gt; HscEnv) -&gt; m ()
forall (m :: * -&gt; *). GhcMonad m =&gt; (HscEnv -&gt; HscEnv) -&gt; m ()
</span><a href="GHC.Driver.Monad.html#modifySession"><span class="hs-identifier hs-var">modifySession</span></a></span><span> </span><span class="annot"><span class="annottext">((HscEnv -&gt; HscEnv) -&gt; m ()) -&gt; (HscEnv -&gt; HscEnv) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681204343"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681204343"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681204343"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hsc_mod_graph :: ModuleGraph
</span><a href="GHC.Driver.Types.html#hsc_mod_graph"><span class="hs-identifier hs-var">hsc_mod_graph</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621681204345"><span class="hs-identifier hs-var">mod_graph</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-370"></span><span>    </span><span class="annot"><span class="annottext">m ()
forall (m :: * -&gt; *). GhcMonad m =&gt; m ()
</span><a href="GHC.Driver.Make.html#guessOutputFile"><span class="hs-identifier hs-var">guessOutputFile</span></a></span><span>
</span><span id="line-371"></span><span>    </span><span id="local-6989586621681204341"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681204341"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m HscEnv
forall (m :: * -&gt; *). GhcMonad m =&gt; m HscEnv
</span><a href="GHC.Driver.Monad.html#getSession"><span class="hs-identifier hs-var">getSession</span></a></span><span>
</span><span id="line-372"></span><span>
</span><span id="line-373"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681204340"><span class="annot"><span class="annottext">hpt1 :: HomePackageTable
</span><a href="#local-6989586621681204340"><span class="hs-identifier hs-var hs-var">hpt1</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; HomePackageTable
</span><a href="GHC.Driver.Types.html#hsc_HPT"><span class="hs-identifier hs-var hs-var">hsc_HPT</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681204341"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-374"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681204338"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621681204338"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681204341"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-375"></span><span>
</span><span id="line-376"></span><span>    </span><span class="hs-comment">-- The &quot;bad&quot; boot modules are the ones for which we have</span><span>
</span><span id="line-377"></span><span>    </span><span class="hs-comment">-- B.hs-boot in the module graph, but no B.hs</span><span>
</span><span id="line-378"></span><span>    </span><span class="hs-comment">-- The downsweep should have ensured this does not happen</span><span>
</span><span id="line-379"></span><span>    </span><span class="hs-comment">-- (see msDeps)</span><span>
</span><span id="line-380"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681204335"><span class="annot"><span class="annottext">all_home_mods :: UniqSet ModuleName
</span><a href="#local-6989586621681204335"><span class="hs-identifier hs-var hs-var">all_home_mods</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-381"></span><span>          </span><span class="annot"><span class="annottext">[ModuleName] -&gt; UniqSet ModuleName
forall a. Uniquable a =&gt; [a] -&gt; UniqSet a
</span><a href="GHC.Types.Unique.Set.html#mkUniqSet"><span class="hs-identifier hs-var">mkUniqSet</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; ModuleName
</span><a href="GHC.Driver.Types.html#ms_mod_name"><span class="hs-identifier hs-var">ms_mod_name</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681204332"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-382"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681204332"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681204332"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModuleGraph -&gt; [ModSummary]
</span><a href="GHC.Driver.Types.html#mgModSummaries"><span class="hs-identifier hs-var">mgModSummaries</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621681204345"><span class="hs-identifier hs-var">mod_graph</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; IsBootInterface
</span><a href="GHC.Driver.Types.html#isBootSummary"><span class="hs-identifier hs-var">isBootSummary</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681204332"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">IsBootInterface -&gt; IsBootInterface -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="GHC.Unit.Types.html#NotBoot"><span class="hs-identifier hs-var">NotBoot</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-383"></span><span>    </span><span class="hs-comment">-- TODO: Figure out what the correct form of this assert is. It's violated</span><span>
</span><span id="line-384"></span><span>    </span><span class="hs-comment">-- when you have HsBootMerge nodes in the graph: then you'll have hs-boot</span><span>
</span><span id="line-385"></span><span>    </span><span class="hs-comment">-- files without corresponding hs files.</span><span>
</span><span id="line-386"></span><span>    </span><span class="hs-comment">--  bad_boot_mods = [s        | s &lt;- mod_graph, isBootSummary s,</span><span>
</span><span id="line-387"></span><span>    </span><span class="hs-comment">--                              not (ms_mod_name s `elem` all_home_mods)]</span><span>
</span><span id="line-388"></span><span>    </span><span class="hs-comment">-- ASSERT( null bad_boot_mods ) return ()</span><span>
</span><span id="line-389"></span><span>
</span><span id="line-390"></span><span>    </span><span class="hs-comment">-- check that the module given in HowMuch actually exists, otherwise</span><span>
</span><span id="line-391"></span><span>    </span><span class="hs-comment">-- topSortModuleGraph will bomb later.</span><span>
</span><span id="line-392"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681204326"><span class="annot"><span class="annottext">checkHowMuch :: LoadHowMuch -&gt; m SuccessFlag -&gt; m SuccessFlag
</span><a href="#local-6989586621681204326"><span class="hs-identifier hs-var hs-var">checkHowMuch</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Make.html#LoadUpTo"><span class="hs-identifier hs-type">LoadUpTo</span></a></span><span> </span><span id="local-6989586621681204325"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681204325"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; m SuccessFlag -&gt; m SuccessFlag
forall {m :: * -&gt; *}.
MonadIO m =&gt;
ModuleName -&gt; m SuccessFlag -&gt; m SuccessFlag
</span><a href="#local-6989586621681204324"><span class="hs-identifier hs-var">checkMod</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681204325"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-393"></span><span>        </span><span class="annot"><a href="#local-6989586621681204326"><span class="hs-identifier hs-var">checkHowMuch</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Make.html#LoadDependenciesOf"><span class="hs-identifier hs-type">LoadDependenciesOf</span></a></span><span> </span><span id="local-6989586621681204323"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681204323"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; m SuccessFlag -&gt; m SuccessFlag
forall {m :: * -&gt; *}.
MonadIO m =&gt;
ModuleName -&gt; m SuccessFlag -&gt; m SuccessFlag
</span><a href="#local-6989586621681204324"><span class="hs-identifier hs-var">checkMod</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681204323"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-394"></span><span>        </span><span class="annot"><a href="#local-6989586621681204326"><span class="hs-identifier hs-var">checkHowMuch</span></a></span><span> </span><span class="annot"><span class="annottext">LoadHowMuch
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m SuccessFlag -&gt; m SuccessFlag
forall a. a -&gt; a
</span><a href="../../base/src/GHC.Base.html#id"><span class="hs-identifier hs-var">id</span></a></span><span>
</span><span id="line-395"></span><span>
</span><span id="line-396"></span><span>        </span><span id="local-6989586621681204324"><span class="annot"><span class="annottext">checkMod :: ModuleName -&gt; m SuccessFlag -&gt; m SuccessFlag
</span><a href="#local-6989586621681204324"><span class="hs-identifier hs-var hs-var">checkMod</span></a></span></span><span> </span><span id="local-6989586621681204313"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681204313"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span id="local-6989586621681204312"><span class="annot"><span class="annottext">m SuccessFlag
</span><a href="#local-6989586621681204312"><span class="hs-identifier hs-var">and_then</span></a></span></span><span>
</span><span id="line-397"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681204313"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; UniqSet ModuleName -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; UniqSet a -&gt; Bool
</span><a href="GHC.Types.Unique.Set.html#elementOfUniqSet"><span class="hs-operator hs-var">`elementOfUniqSet`</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSet ModuleName
</span><a href="#local-6989586621681204335"><span class="hs-identifier hs-var">all_home_mods</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m SuccessFlag
</span><a href="#local-6989586621681204312"><span class="hs-identifier hs-var">and_then</span></a></span><span>
</span><span id="line-398"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-399"></span><span>                    </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#errorMsg"><span class="hs-identifier hs-var">errorMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681204338"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;no such module:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-400"></span><span>                                     </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681204313"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-401"></span><span>                    </span><span class="annot"><span class="annottext">SuccessFlag -&gt; m SuccessFlag
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">SuccessFlag
</span><a href="GHC.Types.Basic.html#Failed"><span class="hs-identifier hs-var">Failed</span></a></span><span>
</span><span id="line-402"></span><span>
</span><span id="line-403"></span><span>    </span><span class="annot"><span class="annottext">LoadHowMuch -&gt; m SuccessFlag -&gt; m SuccessFlag
forall {m :: * -&gt; *}.
MonadIO m =&gt;
LoadHowMuch -&gt; m SuccessFlag -&gt; m SuccessFlag
</span><a href="#local-6989586621681204326"><span class="hs-identifier hs-var">checkHowMuch</span></a></span><span> </span><span class="annot"><span class="annottext">LoadHowMuch
</span><a href="#local-6989586621681204347"><span class="hs-identifier hs-var">how_much</span></a></span><span> </span><span class="annot"><span class="annottext">(m SuccessFlag -&gt; m SuccessFlag) -&gt; m SuccessFlag -&gt; m SuccessFlag
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-404"></span><span>
</span><span id="line-405"></span><span>    </span><span class="hs-comment">-- mg2_with_srcimps drops the hi-boot nodes, returning a</span><span>
</span><span id="line-406"></span><span>    </span><span class="hs-comment">-- graph with cycles.  Among other things, it is used for</span><span>
</span><span id="line-407"></span><span>    </span><span class="hs-comment">-- backing out partially complete cycles following a failed</span><span>
</span><span id="line-408"></span><span>    </span><span class="hs-comment">-- upsweep, and for removing from hpt all the modules</span><span>
</span><span id="line-409"></span><span>    </span><span class="hs-comment">-- not in strict downwards closure, during calls to compile.</span><span>
</span><span id="line-410"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621681204307"><span class="hs-identifier hs-type">mg2_with_srcimps</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../containers/src/Data.Graph.html#SCC"><span class="hs-identifier hs-type">SCC</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-411"></span><span>        </span><span id="local-6989586621681204307"><span class="annot"><span class="annottext">mg2_with_srcimps :: [SCC ModSummary]
</span><a href="#local-6989586621681204307"><span class="hs-identifier hs-var hs-var">mg2_with_srcimps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; ModuleGraph -&gt; Maybe ModuleName -&gt; [SCC ModSummary]
</span><a href="GHC.Driver.Make.html#topSortModuleGraph"><span class="hs-identifier hs-var">topSortModuleGraph</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621681204345"><span class="hs-identifier hs-var">mod_graph</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ModuleName
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-412"></span><span>
</span><span id="line-413"></span><span>    </span><span class="hs-comment">-- If we can determine that any of the {-# SOURCE #-} imports</span><span>
</span><span id="line-414"></span><span>    </span><span class="hs-comment">-- are definitely unnecessary, then emit a warning.</span><span>
</span><span id="line-415"></span><span>    </span><span class="annot"><span class="annottext">[SCC ModSummary] -&gt; m ()
forall (m :: * -&gt; *). GhcMonad m =&gt; [SCC ModSummary] -&gt; m ()
</span><a href="GHC.Driver.Make.html#warnUnnecessarySourceImports"><span class="hs-identifier hs-var">warnUnnecessarySourceImports</span></a></span><span> </span><span class="annot"><span class="annottext">[SCC ModSummary]
</span><a href="#local-6989586621681204307"><span class="hs-identifier hs-var">mg2_with_srcimps</span></a></span><span>
</span><span id="line-416"></span><span>
</span><span id="line-417"></span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-418"></span><span>        </span><span class="hs-comment">-- check the stability property for each module.</span><span>
</span><span id="line-419"></span><span>        </span><span id="local-6989586621681204305"><span class="annot"><span class="annottext">stable_mods :: (UniqSet ModuleName, UniqSet ModuleName)
</span><a href="#local-6989586621681204305"><span class="hs-identifier hs-var">stable_mods</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621681204304"><span class="annot"><span class="annottext">UniqSet ModuleName
</span><a href="#local-6989586621681204304"><span class="hs-identifier hs-var">stable_obj</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681204303"><span class="annot"><span class="annottext">UniqSet ModuleName
</span><a href="#local-6989586621681204303"><span class="hs-identifier hs-var">stable_bco</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-420"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HomePackageTable
-&gt; [SCC ModSummary]
-&gt; UniqSet ModuleName
-&gt; (UniqSet ModuleName, UniqSet ModuleName)
</span><a href="GHC.Driver.Make.html#checkStability"><span class="hs-identifier hs-var">checkStability</span></a></span><span> </span><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621681204340"><span class="hs-identifier hs-var">hpt1</span></a></span><span> </span><span class="annot"><span class="annottext">[SCC ModSummary]
</span><a href="#local-6989586621681204307"><span class="hs-identifier hs-var">mg2_with_srcimps</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSet ModuleName
</span><a href="#local-6989586621681204335"><span class="hs-identifier hs-var">all_home_mods</span></a></span><span>
</span><span id="line-421"></span><span>
</span><span id="line-422"></span><span>        </span><span class="hs-comment">-- prune bits of the HPT which are definitely redundant now,</span><span>
</span><span id="line-423"></span><span>        </span><span class="hs-comment">-- to save space.</span><span>
</span><span id="line-424"></span><span>        </span><span id="local-6989586621681204301"><span class="annot"><span class="annottext">pruned_hpt :: HomePackageTable
</span><a href="#local-6989586621681204301"><span class="hs-identifier hs-var hs-var">pruned_hpt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HomePackageTable
-&gt; [ModSummary]
-&gt; (UniqSet ModuleName, UniqSet ModuleName)
-&gt; HomePackageTable
</span><a href="GHC.Driver.Make.html#pruneHomePackageTable"><span class="hs-identifier hs-var">pruneHomePackageTable</span></a></span><span> </span><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621681204340"><span class="hs-identifier hs-var">hpt1</span></a></span><span>
</span><span id="line-425"></span><span>                            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SCC ModSummary] -&gt; [ModSummary]
forall a. [SCC a] -&gt; [a]
</span><a href="../../containers/src/Data.Graph.html#flattenSCCs"><span class="hs-identifier hs-var">flattenSCCs</span></a></span><span> </span><span class="annot"><span class="annottext">[SCC ModSummary]
</span><a href="#local-6989586621681204307"><span class="hs-identifier hs-var">mg2_with_srcimps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-426"></span><span>                            </span><span class="annot"><span class="annottext">(UniqSet ModuleName, UniqSet ModuleName)
</span><a href="#local-6989586621681204305"><span class="hs-identifier hs-var">stable_mods</span></a></span><span>
</span><span id="line-427"></span><span>
</span><span id="line-428"></span><span>    </span><span class="annot"><span class="annottext">HomePackageTable
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO HomePackageTable -&gt; m HomePackageTable
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO HomePackageTable -&gt; m HomePackageTable)
-&gt; IO HomePackageTable -&gt; m HomePackageTable
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HomePackageTable -&gt; IO HomePackageTable
forall a. a -&gt; IO a
</span><a href="../../base/src/GHC.IO.html#evaluate"><span class="hs-identifier hs-var">evaluate</span></a></span><span> </span><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621681204301"><span class="hs-identifier hs-var">pruned_hpt</span></a></span><span>
</span><span id="line-429"></span><span>
</span><span id="line-430"></span><span>    </span><span class="hs-comment">-- before we unload anything, make sure we don't leave an old</span><span>
</span><span id="line-431"></span><span>    </span><span class="hs-comment">-- interactive context around pointing to dead bindings.  Also,</span><span>
</span><span id="line-432"></span><span>    </span><span class="hs-comment">-- write the pruned HPT to allow the old HPT to be GC'd.</span><span>
</span><span id="line-433"></span><span>    </span><span class="annot"><span class="annottext">HscEnv -&gt; m ()
forall (m :: * -&gt; *). GhcMonad m =&gt; HscEnv -&gt; m ()
</span><a href="GHC.Driver.Monad.html#setSession"><span class="hs-identifier hs-var">setSession</span></a></span><span> </span><span class="annot"><span class="annottext">(HscEnv -&gt; m ()) -&gt; HscEnv -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; HscEnv
</span><a href="GHC.Driver.Make.html#discardIC"><span class="hs-identifier hs-var">discardIC</span></a></span><span> </span><span class="annot"><span class="annottext">(HscEnv -&gt; HscEnv) -&gt; HscEnv -&gt; HscEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681204341"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hsc_HPT :: HomePackageTable
</span><a href="GHC.Driver.Types.html#hsc_HPT"><span class="hs-identifier hs-var">hsc_HPT</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621681204301"><span class="hs-identifier hs-var">pruned_hpt</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-434"></span><span>
</span><span id="line-435"></span><span>    </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Int -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681204338"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;Stable obj:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSet ModuleName -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSet ModuleName
</span><a href="#local-6989586621681204304"><span class="hs-identifier hs-var">stable_obj</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-436"></span><span>                            </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;Stable BCO:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSet ModuleName -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSet ModuleName
</span><a href="#local-6989586621681204303"><span class="hs-identifier hs-var">stable_bco</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-437"></span><span>
</span><span id="line-438"></span><span>    </span><span class="hs-comment">-- Unload any modules which are going to be re-linked this time around.</span><span>
</span><span id="line-439"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681204295"><span class="annot"><span class="annottext">stable_linkables :: [Linkable]
</span><a href="#local-6989586621681204295"><span class="hs-identifier hs-var hs-var">stable_linkables</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621681204294"><span class="hs-identifier hs-var">linkable</span></a></span><span>
</span><span id="line-440"></span><span>                           </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681204293"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681204293"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">UniqSet ModuleName -&gt; [ModuleName]
forall elt. UniqSet elt -&gt; [elt]
</span><a href="GHC.Types.Unique.Set.html#nonDetEltsUniqSet"><span class="hs-identifier hs-var">nonDetEltsUniqSet</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSet ModuleName
</span><a href="#local-6989586621681204304"><span class="hs-identifier hs-var">stable_obj</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleName] -&gt; [ModuleName] -&gt; [ModuleName]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-441"></span><span>                                  </span><span class="annot"><span class="annottext">UniqSet ModuleName -&gt; [ModuleName]
forall elt. UniqSet elt -&gt; [elt]
</span><a href="GHC.Types.Unique.Set.html#nonDetEltsUniqSet"><span class="hs-identifier hs-var">nonDetEltsUniqSet</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSet ModuleName
</span><a href="#local-6989586621681204303"><span class="hs-identifier hs-var">stable_bco</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-442"></span><span>                             </span><span class="hs-comment">-- It's OK to use nonDetEltsUniqSet here</span><span>
</span><span id="line-443"></span><span>                             </span><span class="hs-comment">-- because it only affects linking. Besides</span><span>
</span><span id="line-444"></span><span>                             </span><span class="hs-comment">-- this list only serves as a poor man's set.</span><span>
</span><span id="line-445"></span><span>                             </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681204291"><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621681204291"><span class="hs-identifier hs-var">hmi</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">HomePackageTable -&gt; ModuleName -&gt; Maybe HomeModInfo
</span><a href="GHC.Driver.Types.html#lookupHpt"><span class="hs-identifier hs-var">lookupHpt</span></a></span><span> </span><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621681204301"><span class="hs-identifier hs-var">pruned_hpt</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681204293"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-446"></span><span>                             </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681204294"><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621681204294"><span class="hs-identifier hs-var">linkable</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">HomeModInfo -&gt; Maybe Linkable
</span><a href="GHC.Driver.Types.html#hm_linkable"><span class="hs-identifier hs-var hs-var">hm_linkable</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621681204291"><span class="hs-identifier hs-var">hmi</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-447"></span><span>    </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; [Linkable] -&gt; IO ()
</span><a href="GHC.Driver.Make.html#unload"><span class="hs-identifier hs-var">unload</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681204341"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">[Linkable]
</span><a href="#local-6989586621681204295"><span class="hs-identifier hs-var">stable_linkables</span></a></span><span>
</span><span id="line-448"></span><span>
</span><span id="line-449"></span><span>    </span><span class="hs-comment">-- We could at this point detect cycles which aren't broken by</span><span>
</span><span id="line-450"></span><span>    </span><span class="hs-comment">-- a source-import, and complain immediately, but it seems better</span><span>
</span><span id="line-451"></span><span>    </span><span class="hs-comment">-- to let upsweep_mods do this, so at least some useful work gets</span><span>
</span><span id="line-452"></span><span>    </span><span class="hs-comment">-- done before the upsweep is abandoned.</span><span>
</span><span id="line-453"></span><span>    </span><span class="hs-comment">--hPutStrLn stderr &quot;after tsort:\n&quot;</span><span>
</span><span id="line-454"></span><span>    </span><span class="hs-comment">--hPutStrLn stderr (showSDoc (vcat (map ppr mg2)))</span><span>
</span><span id="line-455"></span><span>
</span><span id="line-456"></span><span>    </span><span class="hs-comment">-- Now do the upsweep, calling compile for each module in</span><span>
</span><span id="line-457"></span><span>    </span><span class="hs-comment">-- turn.  Final result is version 3 of everything.</span><span>
</span><span id="line-458"></span><span>
</span><span id="line-459"></span><span>    </span><span class="hs-comment">-- Topologically sort the module graph, this time including hi-boot</span><span>
</span><span id="line-460"></span><span>    </span><span class="hs-comment">-- nodes, and possibly just including the portion of the graph</span><span>
</span><span id="line-461"></span><span>    </span><span class="hs-comment">-- reachable from the module specified in the 2nd argument to load.</span><span>
</span><span id="line-462"></span><span>    </span><span class="hs-comment">-- This graph should be cycle-free.</span><span>
</span><span id="line-463"></span><span>    </span><span class="hs-comment">-- If we're restricting the upsweep to a portion of the graph, we</span><span>
</span><span id="line-464"></span><span>    </span><span class="hs-comment">-- also want to retain everything that is still stable.</span><span>
</span><span id="line-465"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621681204287"><span class="hs-identifier hs-type">full_mg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../containers/src/Data.Graph.html#SCC"><span class="hs-identifier hs-type">SCC</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-466"></span><span>        </span><span id="local-6989586621681204287"><span class="annot"><span class="annottext">full_mg :: [SCC ModSummary]
</span><a href="#local-6989586621681204287"><span class="hs-identifier hs-var hs-var">full_mg</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; ModuleGraph -&gt; Maybe ModuleName -&gt; [SCC ModSummary]
</span><a href="GHC.Driver.Make.html#topSortModuleGraph"><span class="hs-identifier hs-var">topSortModuleGraph</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621681204345"><span class="hs-identifier hs-var">mod_graph</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ModuleName
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-467"></span><span>
</span><span id="line-468"></span><span>        </span><span id="local-6989586621681204286"><span class="annot"><span class="annottext">maybe_top_mod :: Maybe ModuleName
</span><a href="#local-6989586621681204286"><span class="hs-identifier hs-var hs-var">maybe_top_mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">LoadHowMuch
</span><a href="#local-6989586621681204347"><span class="hs-identifier hs-var">how_much</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-469"></span><span>                            </span><span class="annot"><a href="GHC.Driver.Make.html#LoadUpTo"><span class="hs-identifier hs-type">LoadUpTo</span></a></span><span> </span><span id="local-6989586621681204285"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681204285"><span class="hs-identifier hs-var">m</span></a></span></span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; Maybe ModuleName
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681204285"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-470"></span><span>                            </span><span class="annot"><a href="GHC.Driver.Make.html#LoadDependenciesOf"><span class="hs-identifier hs-type">LoadDependenciesOf</span></a></span><span> </span><span id="local-6989586621681204284"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681204284"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; Maybe ModuleName
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681204284"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-471"></span><span>                            </span><span class="annot"><span class="annottext">LoadHowMuch
</span><span class="hs-identifier">_</span></span><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe ModuleName
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-472"></span><span>
</span><span id="line-473"></span><span>        </span><span class="annot"><a href="#local-6989586621681204283"><span class="hs-identifier hs-type">partial_mg0</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../containers/src/Data.Graph.html#SCC"><span class="hs-identifier hs-type">SCC</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-474"></span><span>        </span><span id="local-6989586621681204283"><span class="annot"><span class="annottext">partial_mg0 :: [SCC ModSummary]
</span><a href="#local-6989586621681204283"><span class="hs-identifier hs-var hs-var">partial_mg0</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; ModuleGraph -&gt; Maybe ModuleName -&gt; [SCC ModSummary]
</span><a href="GHC.Driver.Make.html#topSortModuleGraph"><span class="hs-identifier hs-var">topSortModuleGraph</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621681204345"><span class="hs-identifier hs-var">mod_graph</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ModuleName
</span><a href="#local-6989586621681204286"><span class="hs-identifier hs-var">maybe_top_mod</span></a></span><span>
</span><span id="line-475"></span><span>
</span><span id="line-476"></span><span>        </span><span class="hs-comment">-- LoadDependenciesOf m: we want the upsweep to stop just</span><span>
</span><span id="line-477"></span><span>        </span><span class="hs-comment">-- short of the specified module (unless the specified module</span><span>
</span><span id="line-478"></span><span>        </span><span class="hs-comment">-- is stable).</span><span>
</span><span id="line-479"></span><span>        </span><span id="local-6989586621681204281"><span class="annot"><span class="annottext">partial_mg :: [SCC ModSummary]
</span><a href="#local-6989586621681204281"><span class="hs-identifier hs-var hs-var">partial_mg</span></a></span></span><span>
</span><span id="line-480"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#LoadDependenciesOf"><span class="hs-identifier hs-type">LoadDependenciesOf</span></a></span><span> </span><span id="local-6989586621681204280"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681204280"><span class="hs-identifier hs-var">_mod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">LoadHowMuch
</span><a href="#local-6989586621681204347"><span class="hs-identifier hs-var">how_much</span></a></span><span>
</span><span id="line-481"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">last</span><span> </span><span class="hs-identifier">partial_mg0</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-482"></span><span>                        </span><span class="hs-identifier">AcyclicSCC</span><span> </span><span class="hs-identifier">ms</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">ms_mod_name</span><span> </span><span class="hs-identifier">ms</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">_mod</span><span class="hs-special">;</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">False</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-483"></span><span>              </span><span class="annot"><span class="annottext">[SCC ModSummary] -&gt; [SCC ModSummary]
forall a. [a] -&gt; [a]
</span><a href="../../base/src/GHC.List.html#init"><span class="hs-identifier hs-var">List.init</span></a></span><span> </span><span class="annot"><span class="annottext">[SCC ModSummary]
</span><a href="#local-6989586621681204283"><span class="hs-identifier hs-var">partial_mg0</span></a></span><span>
</span><span id="line-484"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-485"></span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SCC ModSummary]
</span><a href="#local-6989586621681204283"><span class="hs-identifier hs-var">partial_mg0</span></a></span><span>
</span><span id="line-486"></span><span>
</span><span id="line-487"></span><span>        </span><span id="local-6989586621681204273"><span class="annot"><span class="annottext">stable_mg :: [SCC ModSummary]
</span><a href="#local-6989586621681204273"><span class="hs-identifier hs-var hs-var">stable_mg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-488"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; SCC ModSummary
forall vertex. vertex -&gt; SCC vertex
</span><a href="../../containers/src/Data.Graph.html#AcyclicSCC"><span class="hs-identifier hs-var">AcyclicSCC</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681204272"><span class="hs-identifier hs-var">ms</span></a></span><span>
</span><span id="line-489"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../containers/src/Data.Graph.html#AcyclicSCC"><span class="hs-identifier hs-type">AcyclicSCC</span></a></span><span> </span><span id="local-6989586621681204272"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681204272"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[SCC ModSummary]
</span><a href="#local-6989586621681204287"><span class="hs-identifier hs-var">full_mg</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-490"></span><span>              </span><span class="annot"><span class="annottext">ModSummary -&gt; Bool
</span><a href="#local-6989586621681204271"><span class="hs-identifier hs-var">stable_mod_summary</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681204272"><span class="hs-identifier hs-var">ms</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-491"></span><span>
</span><span id="line-492"></span><span>        </span><span id="local-6989586621681204271"><span class="annot"><span class="annottext">stable_mod_summary :: ModSummary -&gt; Bool
</span><a href="#local-6989586621681204271"><span class="hs-identifier hs-var hs-var">stable_mod_summary</span></a></span></span><span> </span><span id="local-6989586621681204268"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681204268"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-493"></span><span>          </span><span class="annot"><span class="annottext">ModSummary -&gt; ModuleName
</span><a href="GHC.Driver.Types.html#ms_mod_name"><span class="hs-identifier hs-var">ms_mod_name</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681204268"><span class="hs-identifier hs-var">ms</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; UniqSet ModuleName -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; UniqSet a -&gt; Bool
</span><a href="GHC.Types.Unique.Set.html#elementOfUniqSet"><span class="hs-operator hs-var">`elementOfUniqSet`</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSet ModuleName
</span><a href="#local-6989586621681204304"><span class="hs-identifier hs-var">stable_obj</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span>
</span><span id="line-494"></span><span>          </span><span class="annot"><span class="annottext">ModSummary -&gt; ModuleName
</span><a href="GHC.Driver.Types.html#ms_mod_name"><span class="hs-identifier hs-var">ms_mod_name</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681204268"><span class="hs-identifier hs-var">ms</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; UniqSet ModuleName -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; UniqSet a -&gt; Bool
</span><a href="GHC.Types.Unique.Set.html#elementOfUniqSet"><span class="hs-operator hs-var">`elementOfUniqSet`</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSet ModuleName
</span><a href="#local-6989586621681204303"><span class="hs-identifier hs-var">stable_bco</span></a></span><span>
</span><span id="line-495"></span><span>
</span><span id="line-496"></span><span>        </span><span class="hs-comment">-- the modules from partial_mg that are not also stable</span><span>
</span><span id="line-497"></span><span>        </span><span class="hs-comment">-- NB. also keep cycles, we need to emit an error message later</span><span>
</span><span id="line-498"></span><span>        </span><span id="local-6989586621681204267"><span class="annot"><span class="annottext">unstable_mg :: [SCC ModSummary]
</span><a href="#local-6989586621681204267"><span class="hs-identifier hs-var hs-var">unstable_mg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SCC ModSummary -&gt; Bool) -&gt; [SCC ModSummary] -&gt; [SCC ModSummary]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="annot"><span class="annottext">SCC ModSummary -&gt; Bool
</span><a href="#local-6989586621681204266"><span class="hs-identifier hs-var">not_stable</span></a></span><span> </span><span class="annot"><span class="annottext">[SCC ModSummary]
</span><a href="#local-6989586621681204281"><span class="hs-identifier hs-var">partial_mg</span></a></span><span>
</span><span id="line-499"></span><span>          </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681204266"><span class="annot"><span class="annottext">not_stable :: SCC ModSummary -&gt; Bool
</span><a href="#local-6989586621681204266"><span class="hs-identifier hs-var hs-var">not_stable</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers/src/Data.Graph.html#CyclicSCC"><span class="hs-identifier hs-type">CyclicSCC</span></a></span><span> </span><span class="annot"><span class="annottext">[ModSummary]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-500"></span><span>                </span><span class="annot"><a href="#local-6989586621681204266"><span class="hs-identifier hs-var">not_stable</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers/src/Data.Graph.html#AcyclicSCC"><span class="hs-identifier hs-type">AcyclicSCC</span></a></span><span> </span><span id="local-6989586621681204264"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681204264"><span class="hs-identifier hs-var">ms</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-501"></span><span>                   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; Bool
</span><a href="#local-6989586621681204271"><span class="hs-identifier hs-var">stable_mod_summary</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681204264"><span class="hs-identifier hs-var">ms</span></a></span><span>
</span><span id="line-502"></span><span>
</span><span id="line-503"></span><span>        </span><span class="hs-comment">-- Load all the stable modules first, before attempting to load</span><span>
</span><span id="line-504"></span><span>        </span><span class="hs-comment">-- an unstable module (#7231).</span><span>
</span><span id="line-505"></span><span>        </span><span id="local-6989586621681204263"><span class="annot"><span class="annottext">mg :: [SCC ModSummary]
</span><a href="#local-6989586621681204263"><span class="hs-identifier hs-var hs-var">mg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SCC ModSummary]
</span><a href="#local-6989586621681204273"><span class="hs-identifier hs-var">stable_mg</span></a></span><span> </span><span class="annot"><span class="annottext">[SCC ModSummary] -&gt; [SCC ModSummary] -&gt; [SCC ModSummary]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[SCC ModSummary]
</span><a href="#local-6989586621681204267"><span class="hs-identifier hs-var">unstable_mg</span></a></span><span>
</span><span id="line-506"></span><span>
</span><span id="line-507"></span><span>    </span><span class="hs-comment">-- clean up between compilations</span><span>
</span><span id="line-508"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681204262"><span class="annot"><span class="annottext">cleanup :: HscEnv -&gt; IO ()
</span><a href="#local-6989586621681204262"><span class="hs-identifier hs-var hs-var">cleanup</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; IO ()
</span><a href="GHC.SysTools.FileCleanup.html#cleanCurrentModuleTempFiles"><span class="hs-identifier hs-var">cleanCurrentModuleTempFiles</span></a></span><span> </span><span class="annot"><span class="annottext">(DynFlags -&gt; IO ()) -&gt; (HscEnv -&gt; DynFlags) -&gt; HscEnv -&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span>
</span><span id="line-509"></span><span>    </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Int -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681204338"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hang"><span class="hs-identifier hs-var">hang</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;Ready for upsweep&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-510"></span><span>                               </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SCC ModSummary] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[SCC ModSummary]
</span><a href="#local-6989586621681204263"><span class="hs-identifier hs-var">mg</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-511"></span><span>
</span><span id="line-512"></span><span>    </span><span id="local-6989586621681204260"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681204260"><span class="hs-identifier hs-var">n_jobs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Maybe Int
</span><a href="GHC.Driver.Session.html#parMakeCount"><span class="hs-identifier hs-var hs-var">parMakeCount</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681204338"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-513"></span><span>                    </span><span class="annot"><span class="annottext">Maybe Int
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO Int -&gt; m Int
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">IO Int
</span><a href="../../base/src/GHC.Conc.Sync.html#getNumProcessors"><span class="hs-identifier hs-var">getNumProcessors</span></a></span><span>
</span><span id="line-514"></span><span>                    </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681204258"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681204258"><span class="hs-identifier hs-var">n</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Int -&gt; m Int
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681204258"><span class="hs-identifier hs-var">n</span></a></span><span>
</span><span id="line-515"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681204252"><span class="annot"><span class="annottext">upsweep_fn :: Maybe Messager
-&gt; HomePackageTable
-&gt; (UniqSet ModuleName, UniqSet ModuleName)
-&gt; (HscEnv -&gt; IO ())
-&gt; [SCC ModSummary]
-&gt; m (SuccessFlag, [ModSummary])
</span><a href="#local-6989586621681204252"><span class="hs-identifier hs-var hs-var">upsweep_fn</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681204260"><span class="hs-identifier hs-var">n_jobs</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
-&gt; Maybe Messager
-&gt; HomePackageTable
-&gt; (UniqSet ModuleName, UniqSet ModuleName)
-&gt; (HscEnv -&gt; IO ())
-&gt; [SCC ModSummary]
-&gt; m (SuccessFlag, [ModSummary])
forall (m :: * -&gt; *).
GhcMonad m =&gt;
Int
-&gt; Maybe Messager
-&gt; HomePackageTable
-&gt; (UniqSet ModuleName, UniqSet ModuleName)
-&gt; (HscEnv -&gt; IO ())
-&gt; [SCC ModSummary]
-&gt; m (SuccessFlag, [ModSummary])
</span><a href="GHC.Driver.Make.html#parUpsweep"><span class="hs-identifier hs-var">parUpsweep</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681204260"><span class="hs-identifier hs-var">n_jobs</span></a></span><span>
</span><span id="line-516"></span><span>                   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Messager
-&gt; HomePackageTable
-&gt; (UniqSet ModuleName, UniqSet ModuleName)
-&gt; (HscEnv -&gt; IO ())
-&gt; [SCC ModSummary]
-&gt; m (SuccessFlag, [ModSummary])
forall (m :: * -&gt; *).
GhcMonad m =&gt;
Maybe Messager
-&gt; HomePackageTable
-&gt; (UniqSet ModuleName, UniqSet ModuleName)
-&gt; (HscEnv -&gt; IO ())
-&gt; [SCC ModSummary]
-&gt; m (SuccessFlag, [ModSummary])
</span><a href="GHC.Driver.Make.html#upsweep"><span class="hs-identifier hs-var">upsweep</span></a></span><span>
</span><span id="line-517"></span><span>
</span><span id="line-518"></span><span>    </span><span class="annot"><span class="annottext">HscEnv -&gt; m ()
forall (m :: * -&gt; *). GhcMonad m =&gt; HscEnv -&gt; m ()
</span><a href="GHC.Driver.Monad.html#setSession"><span class="hs-identifier hs-var">setSession</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681204341"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hsc_HPT :: HomePackageTable
</span><a href="GHC.Driver.Types.html#hsc_HPT"><span class="hs-identifier hs-var">hsc_HPT</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HomePackageTable
</span><a href="GHC.Driver.Types.html#emptyHomePackageTable"><span class="hs-identifier hs-var">emptyHomePackageTable</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-519"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681204247"><span class="annot"><span class="annottext">SuccessFlag
</span><a href="#local-6989586621681204247"><span class="hs-identifier hs-var">upsweep_ok</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681204246"><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681204246"><span class="hs-identifier hs-var">modsUpswept</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m (SuccessFlag, [ModSummary]) -&gt; m (SuccessFlag, [ModSummary])
forall (m :: * -&gt; *) a. GhcMonad m =&gt; m a -&gt; m a
</span><a href="GHC.Driver.Make.html#withDeferredDiagnostics"><span class="hs-identifier hs-var">withDeferredDiagnostics</span></a></span><span> </span><span class="annot"><span class="annottext">(m (SuccessFlag, [ModSummary]) -&gt; m (SuccessFlag, [ModSummary]))
-&gt; m (SuccessFlag, [ModSummary]) -&gt; m (SuccessFlag, [ModSummary])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-520"></span><span>      </span><span class="annot"><span class="annottext">Maybe Messager
-&gt; HomePackageTable
-&gt; (UniqSet ModuleName, UniqSet ModuleName)
-&gt; (HscEnv -&gt; IO ())
-&gt; [SCC ModSummary]
-&gt; m (SuccessFlag, [ModSummary])
</span><a href="#local-6989586621681204252"><span class="hs-identifier hs-var">upsweep_fn</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Messager
</span><a href="#local-6989586621681204346"><span class="hs-identifier hs-var">mHscMessage</span></a></span><span> </span><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621681204301"><span class="hs-identifier hs-var">pruned_hpt</span></a></span><span> </span><span class="annot"><span class="annottext">(UniqSet ModuleName, UniqSet ModuleName)
</span><a href="#local-6989586621681204305"><span class="hs-identifier hs-var">stable_mods</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; IO ()
</span><a href="#local-6989586621681204262"><span class="hs-identifier hs-var">cleanup</span></a></span><span> </span><span class="annot"><span class="annottext">[SCC ModSummary]
</span><a href="#local-6989586621681204263"><span class="hs-identifier hs-var">mg</span></a></span><span>
</span><span id="line-521"></span><span>
</span><span id="line-522"></span><span>    </span><span class="hs-comment">-- Make modsDone be the summaries for each home module now</span><span>
</span><span id="line-523"></span><span>    </span><span class="hs-comment">-- available; this should equal the domain of hpt3.</span><span>
</span><span id="line-524"></span><span>    </span><span class="hs-comment">-- Get in in a roughly top .. bottom order (hence reverse).</span><span>
</span><span id="line-525"></span><span>
</span><span id="line-526"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681204244"><span class="annot"><span class="annottext">modsDone :: [ModSummary]
</span><a href="#local-6989586621681204244"><span class="hs-identifier hs-var hs-var">modsDone</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ModSummary] -&gt; [ModSummary]
forall a. [a] -&gt; [a]
</span><a href="../../base/src/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681204246"><span class="hs-identifier hs-var">modsUpswept</span></a></span><span>
</span><span id="line-527"></span><span>
</span><span id="line-528"></span><span>    </span><span class="hs-comment">-- Try and do linking in some form, depending on whether the</span><span>
</span><span id="line-529"></span><span>    </span><span class="hs-comment">-- upsweep was completely or only partially successful.</span><span>
</span><span id="line-530"></span><span>
</span><span id="line-531"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">SuccessFlag -&gt; Bool
</span><a href="GHC.Types.Basic.html#succeeded"><span class="hs-identifier hs-var">succeeded</span></a></span><span> </span><span class="annot"><span class="annottext">SuccessFlag
</span><a href="#local-6989586621681204247"><span class="hs-identifier hs-var">upsweep_ok</span></a></span><span>
</span><span id="line-532"></span><span>
</span><span id="line-533"></span><span>     </span><span class="hs-keyword">then</span><span>
</span><span id="line-534"></span><span>       </span><span class="hs-comment">-- Easy; just relink it all.</span><span>
</span><span id="line-535"></span><span>       </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Int -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681204338"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;Upsweep completely successful.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-536"></span><span>
</span><span id="line-537"></span><span>          </span><span class="hs-comment">-- Clean up after ourselves</span><span>
</span><span id="line-538"></span><span>          </span><span id="local-6989586621681204241"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681204241"><span class="hs-identifier hs-var">hsc_env1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m HscEnv
forall (m :: * -&gt; *). GhcMonad m =&gt; m HscEnv
</span><a href="GHC.Driver.Monad.html#getSession"><span class="hs-identifier hs-var">getSession</span></a></span><span>
</span><span id="line-539"></span><span>          </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; IO ()
</span><a href="GHC.SysTools.FileCleanup.html#cleanCurrentModuleTempFiles"><span class="hs-identifier hs-var">cleanCurrentModuleTempFiles</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681204338"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-540"></span><span>
</span><span id="line-541"></span><span>          </span><span class="hs-comment">-- Issue a warning for the confusing case where the user</span><span>
</span><span id="line-542"></span><span>          </span><span class="hs-comment">-- said '-o foo' but we're not going to do any linking.</span><span>
</span><span id="line-543"></span><span>          </span><span class="hs-comment">-- We attempt linking if either (a) one of the modules is</span><span>
</span><span id="line-544"></span><span>          </span><span class="hs-comment">-- called Main, or (b) the user said -no-hs-main, indicating</span><span>
</span><span id="line-545"></span><span>          </span><span class="hs-comment">-- that main() is going to come from somewhere else.</span><span>
</span><span id="line-546"></span><span>          </span><span class="hs-comment">--</span><span>
</span><span id="line-547"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681204240"><span class="annot"><span class="annottext">ofile :: Maybe FilePath
</span><a href="#local-6989586621681204240"><span class="hs-identifier hs-var hs-var">ofile</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Maybe FilePath
</span><a href="GHC.Driver.Session.html#outputFile"><span class="hs-identifier hs-var hs-var">outputFile</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681204338"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-548"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681204238"><span class="annot"><span class="annottext">no_hs_main :: Bool
</span><a href="#local-6989586621681204238"><span class="hs-identifier hs-var hs-var">no_hs_main</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_NoHsMain"><span class="hs-identifier hs-var">Opt_NoHsMain</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681204338"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-549"></span><span>          </span><span class="hs-keyword">let</span><span>
</span><span id="line-550"></span><span>            </span><span id="local-6989586621681204236"><span class="annot"><span class="annottext">main_mod :: Module
</span><a href="#local-6989586621681204236"><span class="hs-identifier hs-var hs-var">main_mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Module
</span><a href="GHC.Driver.Session.html#mainModIs"><span class="hs-identifier hs-var hs-var">mainModIs</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681204338"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-551"></span><span>            </span><span id="local-6989586621681204234"><span class="annot"><span class="annottext">a_root_is_Main :: Bool
</span><a href="#local-6989586621681204234"><span class="hs-identifier hs-var hs-var">a_root_is_Main</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleGraph -&gt; Module -&gt; Bool
</span><a href="GHC.Driver.Types.html#mgElemModule"><span class="hs-identifier hs-var">mgElemModule</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621681204345"><span class="hs-identifier hs-var">mod_graph</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681204236"><span class="hs-identifier hs-var">main_mod</span></a></span><span>
</span><span id="line-552"></span><span>            </span><span id="local-6989586621681204230"><span class="annot"><span class="annottext">do_linking :: Bool
</span><a href="#local-6989586621681204230"><span class="hs-identifier hs-var hs-var">do_linking</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681204234"><span class="hs-identifier hs-var">a_root_is_Main</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681204238"><span class="hs-identifier hs-var">no_hs_main</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; GhcLink
</span><a href="GHC.Driver.Session.html#ghcLink"><span class="hs-identifier hs-var hs-var">ghcLink</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681204338"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">GhcLink -&gt; GhcLink -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">GhcLink
</span><a href="GHC.Driver.Session.html#LinkDynLib"><span class="hs-identifier hs-var">LinkDynLib</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; GhcLink
</span><a href="GHC.Driver.Session.html#ghcLink"><span class="hs-identifier hs-var hs-var">ghcLink</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681204338"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">GhcLink -&gt; GhcLink -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">GhcLink
</span><a href="GHC.Driver.Session.html#LinkStaticLib"><span class="hs-identifier hs-var">LinkStaticLib</span></a></span><span>
</span><span id="line-553"></span><span>
</span><span id="line-554"></span><span>          </span><span class="hs-comment">-- link everything together</span><span>
</span><span id="line-555"></span><span>          </span><span id="local-6989586621681204226"><span class="annot"><span class="annottext">SuccessFlag
</span><a href="#local-6989586621681204226"><span class="hs-identifier hs-var">linkresult</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO SuccessFlag -&gt; m SuccessFlag
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO SuccessFlag -&gt; m SuccessFlag)
-&gt; IO SuccessFlag -&gt; m SuccessFlag
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">GhcLink -&gt; DynFlags -&gt; Bool -&gt; HomePackageTable -&gt; IO SuccessFlag
</span><a href="GHC.Driver.Pipeline.html#link"><span class="hs-identifier hs-var">link</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; GhcLink
</span><a href="GHC.Driver.Session.html#ghcLink"><span class="hs-identifier hs-var hs-var">ghcLink</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681204338"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681204338"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681204230"><span class="hs-identifier hs-var">do_linking</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; HomePackageTable
</span><a href="GHC.Driver.Types.html#hsc_HPT"><span class="hs-identifier hs-var hs-var">hsc_HPT</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681204241"><span class="hs-identifier hs-var">hsc_env1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-556"></span><span>
</span><span id="line-557"></span><span>          </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; GhcLink
</span><a href="GHC.Driver.Session.html#ghcLink"><span class="hs-identifier hs-var hs-var">ghcLink</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681204338"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">GhcLink -&gt; GhcLink -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">GhcLink
</span><a href="GHC.Driver.Session.html#LinkBinary"><span class="hs-identifier hs-var">LinkBinary</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Maybe FilePath -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../../base/src/Data.Maybe.html#isJust"><span class="hs-identifier hs-var">isJust</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe FilePath
</span><a href="#local-6989586621681204240"><span class="hs-identifier hs-var">ofile</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681204230"><span class="hs-identifier hs-var">do_linking</span></a></span><span>
</span><span id="line-558"></span><span>             </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-559"></span><span>                </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#errorMsg"><span class="hs-identifier hs-var">errorMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681204338"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; IO ()) -&gt; SDoc -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span>
</span><span id="line-560"></span><span>                   </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;output was redirected with -o, &quot;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-561"></span><span>                    </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;but no output will be generated\n&quot;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-562"></span><span>                    </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;because there is no &quot;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-563"></span><span>                    </span><span class="annot"><span class="annottext">ModuleName -&gt; FilePath
</span><a href="GHC.Unit.Module.Name.html#moduleNameString"><span class="hs-identifier hs-var">moduleNameString</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681204236"><span class="hs-identifier hs-var">main_mod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot; module.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-564"></span><span>                </span><span class="hs-comment">-- This should be an error, not a warning (#10895).</span><span>
</span><span id="line-565"></span><span>                </span><span class="annot"><span class="annottext">SuccessFlag -&gt; SuccessFlag -&gt; m SuccessFlag
forall (m :: * -&gt; *).
GhcMonad m =&gt;
SuccessFlag -&gt; SuccessFlag -&gt; m SuccessFlag
</span><a href="GHC.Driver.Make.html#loadFinish"><span class="hs-identifier hs-var">loadFinish</span></a></span><span> </span><span class="annot"><span class="annottext">SuccessFlag
</span><a href="GHC.Types.Basic.html#Failed"><span class="hs-identifier hs-var">Failed</span></a></span><span> </span><span class="annot"><span class="annottext">SuccessFlag
</span><a href="#local-6989586621681204226"><span class="hs-identifier hs-var">linkresult</span></a></span><span>
</span><span id="line-566"></span><span>             </span><span class="hs-keyword">else</span><span>
</span><span id="line-567"></span><span>                </span><span class="annot"><span class="annottext">SuccessFlag -&gt; SuccessFlag -&gt; m SuccessFlag
forall (m :: * -&gt; *).
GhcMonad m =&gt;
SuccessFlag -&gt; SuccessFlag -&gt; m SuccessFlag
</span><a href="GHC.Driver.Make.html#loadFinish"><span class="hs-identifier hs-var">loadFinish</span></a></span><span> </span><span class="annot"><span class="annottext">SuccessFlag
</span><a href="GHC.Types.Basic.html#Succeeded"><span class="hs-identifier hs-var">Succeeded</span></a></span><span> </span><span class="annot"><span class="annottext">SuccessFlag
</span><a href="#local-6989586621681204226"><span class="hs-identifier hs-var">linkresult</span></a></span><span>
</span><span id="line-568"></span><span>
</span><span id="line-569"></span><span>     </span><span class="hs-keyword">else</span><span>
</span><span id="line-570"></span><span>       </span><span class="hs-comment">-- Tricky.  We need to back out the effects of compiling any</span><span>
</span><span id="line-571"></span><span>       </span><span class="hs-comment">-- half-done cycles, both so as to clean up the top level envs</span><span>
</span><span id="line-572"></span><span>       </span><span class="hs-comment">-- and to avoid telling the interactive linker to link them.</span><span>
</span><span id="line-573"></span><span>       </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Int -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681204338"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;Upsweep partially successful.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-574"></span><span>
</span><span id="line-575"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681204219"><span class="annot"><span class="annottext">modsDone_names :: [Module]
</span><a href="#local-6989586621681204219"><span class="hs-identifier hs-var hs-var">modsDone_names</span></a></span></span><span>
</span><span id="line-576"></span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ModSummary -&gt; Module) -&gt; [ModSummary] -&gt; [Module]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; Module
</span><a href="GHC.Driver.Types.html#ms_mod"><span class="hs-identifier hs-var hs-var">ms_mod</span></a></span><span> </span><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681204244"><span class="hs-identifier hs-var">modsDone</span></a></span><span>
</span><span id="line-577"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681204218"><span class="annot"><span class="annottext">mods_to_zap_names :: Set Module
</span><a href="#local-6989586621681204218"><span class="hs-identifier hs-var hs-var">mods_to_zap_names</span></a></span></span><span>
</span><span id="line-578"></span><span>                 </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Module] -&gt; [SCC ModSummary] -&gt; Set Module
</span><a href="GHC.Driver.Make.html#findPartiallyCompletedCycles"><span class="hs-identifier hs-var">findPartiallyCompletedCycles</span></a></span><span> </span><span class="annot"><span class="annottext">[Module]
</span><a href="#local-6989586621681204219"><span class="hs-identifier hs-var">modsDone_names</span></a></span><span>
</span><span id="line-579"></span><span>                      </span><span class="annot"><span class="annottext">[SCC ModSummary]
</span><a href="#local-6989586621681204307"><span class="hs-identifier hs-var">mg2_with_srcimps</span></a></span><span>
</span><span id="line-580"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681204214"><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681204214"><span class="hs-identifier hs-var">mods_to_clean</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681204213"><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681204213"><span class="hs-identifier hs-var">mods_to_keep</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-581"></span><span>                </span><span class="annot"><span class="annottext">(ModSummary -&gt; Bool)
-&gt; [ModSummary] -&gt; ([ModSummary], [ModSummary])
forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><a href="../../base/src/Data.OldList.html#partition"><span class="hs-identifier hs-var">partition</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; Set Module -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="../../containers/src/Data.Set.Internal.html#member"><span class="hs-operator hs-var">`Set.member`</span></a></span><span> </span><span class="annot"><span class="annottext">Set Module
</span><a href="#local-6989586621681204218"><span class="hs-identifier hs-var">mods_to_zap_names</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">(Module -&gt; Bool) -&gt; (ModSummary -&gt; Module) -&gt; ModSummary -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span class="annot"><span class="annottext">ModSummary -&gt; Module
</span><a href="GHC.Driver.Types.html#ms_mod"><span class="hs-identifier hs-var hs-var">ms_mod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681204244"><span class="hs-identifier hs-var">modsDone</span></a></span><span>
</span><span id="line-582"></span><span>          </span><span id="local-6989586621681204210"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681204210"><span class="hs-identifier hs-var">hsc_env1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m HscEnv
forall (m :: * -&gt; *). GhcMonad m =&gt; m HscEnv
</span><a href="GHC.Driver.Monad.html#getSession"><span class="hs-identifier hs-var">getSession</span></a></span><span>
</span><span id="line-583"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681204209"><span class="annot"><span class="annottext">hpt4 :: HomePackageTable
</span><a href="#local-6989586621681204209"><span class="hs-identifier hs-var hs-var">hpt4</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; HomePackageTable
</span><a href="GHC.Driver.Types.html#hsc_HPT"><span class="hs-identifier hs-var hs-var">hsc_HPT</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681204210"><span class="hs-identifier hs-var">hsc_env1</span></a></span><span>
</span><span id="line-584"></span><span>              </span><span class="hs-comment">-- We must change the lifetime to TFL_CurrentModule for any temp</span><span>
</span><span id="line-585"></span><span>              </span><span class="hs-comment">-- file created for an element of mod_to_clean during the upsweep.</span><span>
</span><span id="line-586"></span><span>              </span><span class="hs-comment">-- These include preprocessed files and object files for loaded</span><span>
</span><span id="line-587"></span><span>              </span><span class="hs-comment">-- modules.</span><span>
</span><span id="line-588"></span><span>              </span><span id="local-6989586621681204207"><span class="annot"><span class="annottext">unneeded_temps :: [FilePath]
</span><a href="#local-6989586621681204207"><span class="hs-identifier hs-var hs-var">unneeded_temps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[FilePath]] -&gt; [FilePath]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><a href="../../base/src/Data.Foldable.html#concat"><span class="hs-identifier hs-var">concat</span></a></span><span>
</span><span id="line-589"></span><span>                </span><span class="hs-special">[</span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681204206"><span class="hs-identifier hs-var">ms_hspp_file</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; [FilePath] -&gt; [FilePath]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621681204205"><span class="hs-identifier hs-var">object_files</span></a></span><span>
</span><span id="line-590"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">{</span><span id="local-6989586621681204203"><span class="annot"><span class="annottext">Module
ms_mod :: Module
ms_mod :: ModSummary -&gt; Module
</span><a href="#local-6989586621681204203"><span class="hs-identifier hs-var hs-var">ms_mod</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681204206"><span class="annot"><span class="annottext">FilePath
ms_hspp_file :: ModSummary -&gt; FilePath
ms_hspp_file :: FilePath
</span><a href="GHC.Driver.Types.html#ms_hspp_file"><span class="hs-identifier hs-var hs-var">ms_hspp_file</span></a></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681204214"><span class="hs-identifier hs-var">mods_to_clean</span></a></span><span>
</span><span id="line-591"></span><span>                </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681204205"><span class="annot"><span class="annottext">object_files :: [FilePath]
</span><a href="#local-6989586621681204205"><span class="hs-identifier hs-var hs-var">object_files</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[FilePath]
-&gt; (Linkable -&gt; [FilePath]) -&gt; Maybe Linkable -&gt; [FilePath]
forall b a. b -&gt; (a -&gt; b) -&gt; Maybe a -&gt; b
</span><a href="../../base/src/Data.Maybe.html#maybe"><span class="hs-identifier hs-var">maybe</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Linkable -&gt; [FilePath]
</span><a href="GHC.Driver.Types.html#linkableObjs"><span class="hs-identifier hs-var">linkableObjs</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Linkable -&gt; [FilePath]) -&gt; Maybe Linkable -&gt; [FilePath]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-592"></span><span>                        </span><span class="annot"><span class="annottext">HomePackageTable -&gt; ModuleName -&gt; Maybe HomeModInfo
</span><a href="GHC.Driver.Types.html#lookupHpt"><span class="hs-identifier hs-var">lookupHpt</span></a></span><span> </span><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621681204209"><span class="hs-identifier hs-var">hpt4</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681204203"><span class="hs-identifier hs-var">ms_mod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-593"></span><span>                        </span><span class="annot"><span class="annottext">Maybe HomeModInfo
-&gt; (HomeModInfo -&gt; Maybe Linkable) -&gt; Maybe Linkable
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../base/src/GHC.Base.html#%3E%3E%3D"><span class="hs-operator hs-var">&gt;&gt;=</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModInfo -&gt; Maybe Linkable
</span><a href="GHC.Driver.Types.html#hm_linkable"><span class="hs-identifier hs-var hs-var">hm_linkable</span></a></span><span>
</span><span id="line-594"></span><span>                </span><span class="hs-special">]</span><span>
</span><span id="line-595"></span><span>          </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-596"></span><span>            </span><span class="annot"><span class="annottext">DynFlags -&gt; TempFileLifetime -&gt; [FilePath] -&gt; IO ()
</span><a href="GHC.SysTools.FileCleanup.html#changeTempFilesLifetime"><span class="hs-identifier hs-var">changeTempFilesLifetime</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681204338"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">TempFileLifetime
</span><a href="GHC.SysTools.FileCleanup.html#TFL_CurrentModule"><span class="hs-identifier hs-var">TFL_CurrentModule</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621681204207"><span class="hs-identifier hs-var">unneeded_temps</span></a></span><span>
</span><span id="line-597"></span><span>          </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; IO ()
</span><a href="GHC.SysTools.FileCleanup.html#cleanCurrentModuleTempFiles"><span class="hs-identifier hs-var">cleanCurrentModuleTempFiles</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681204338"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-598"></span><span>
</span><span id="line-599"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681204195"><span class="annot"><span class="annottext">hpt5 :: HomePackageTable
</span><a href="#local-6989586621681204195"><span class="hs-identifier hs-var hs-var">hpt5</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ModuleName] -&gt; HomePackageTable -&gt; HomePackageTable
</span><a href="GHC.Driver.Make.html#retainInTopLevelEnvs"><span class="hs-identifier hs-var">retainInTopLevelEnvs</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ModSummary -&gt; ModuleName) -&gt; [ModSummary] -&gt; [ModuleName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; ModuleName
</span><a href="GHC.Driver.Types.html#ms_mod_name"><span class="hs-identifier hs-var">ms_mod_name</span></a></span><span> </span><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681204213"><span class="hs-identifier hs-var">mods_to_keep</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-600"></span><span>                                          </span><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621681204209"><span class="hs-identifier hs-var">hpt4</span></a></span><span>
</span><span id="line-601"></span><span>
</span><span id="line-602"></span><span>          </span><span class="hs-comment">-- Clean up after ourselves</span><span>
</span><span id="line-603"></span><span>
</span><span id="line-604"></span><span>          </span><span class="hs-comment">-- there should be no Nothings where linkables should be, now</span><span>
</span><span id="line-605"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681204192"><span class="annot"><span class="annottext">just_linkables :: Bool
</span><a href="#local-6989586621681204192"><span class="hs-identifier hs-var hs-var">just_linkables</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-606"></span><span>                    </span><span class="annot"><span class="annottext">GhcLink -&gt; Bool
</span><a href="GHC.Driver.Session.html#isNoLink"><span class="hs-identifier hs-var">isNoLink</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; GhcLink
</span><a href="GHC.Driver.Session.html#ghcLink"><span class="hs-identifier hs-var hs-var">ghcLink</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681204338"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-607"></span><span>                 </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">(HomeModInfo -&gt; Bool) -&gt; HomePackageTable -&gt; Bool
</span><a href="GHC.Driver.Types.html#allHpt"><span class="hs-identifier hs-var">allHpt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe Linkable -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../../base/src/Data.Maybe.html#isJust"><span class="hs-identifier hs-var">isJust</span></a></span><span class="annot"><span class="annottext">(Maybe Linkable -&gt; Bool)
-&gt; (HomeModInfo -&gt; Maybe Linkable) -&gt; HomeModInfo -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span class="annot"><span class="annottext">HomeModInfo -&gt; Maybe Linkable
</span><a href="GHC.Driver.Types.html#hm_linkable"><span class="hs-identifier hs-var hs-var">hm_linkable</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-608"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(HomeModInfo -&gt; Bool) -&gt; HomePackageTable -&gt; HomePackageTable
</span><a href="GHC.Driver.Types.html#filterHpt"><span class="hs-identifier hs-var">filterHpt</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscSource -&gt; HscSource -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="GHC.Driver.Phases.html#HsSrcFile"><span class="hs-identifier hs-var">HsSrcFile</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">(HscSource -&gt; Bool)
-&gt; (HomeModInfo -&gt; HscSource) -&gt; HomeModInfo -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span class="annot"><span class="annottext">ModIface_ 'ModIfaceFinal -&gt; HscSource
forall (phase :: ModIfacePhase). ModIface_ phase -&gt; HscSource
</span><a href="GHC.Driver.Types.html#mi_hsc_src"><span class="hs-identifier hs-var hs-var">mi_hsc_src</span></a></span><span class="annot"><span class="annottext">(ModIface_ 'ModIfaceFinal -&gt; HscSource)
-&gt; (HomeModInfo -&gt; ModIface_ 'ModIfaceFinal)
-&gt; HomeModInfo
-&gt; HscSource
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span class="annot"><span class="annottext">HomeModInfo -&gt; ModIface_ 'ModIfaceFinal
</span><a href="GHC.Driver.Types.html#hm_iface"><span class="hs-identifier hs-var hs-var">hm_iface</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-609"></span><span>                                </span><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621681204195"><span class="hs-identifier hs-var">hpt5</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-610"></span><span>          </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">just_linkables</span><span> </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-611"></span><span>
</span><span id="line-612"></span><span>          </span><span class="hs-comment">-- Link everything together</span><span>
</span><span id="line-613"></span><span>          </span><span class="hs-identifier">linkresult</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">liftIO</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">link</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ghcLink</span><span> </span><span class="hs-identifier">dflags</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">dflags</span><span> </span><span class="hs-identifier">False</span><span> </span><span class="hs-identifier">hpt5</span><span>
</span><span id="line-614"></span><span>
</span><span id="line-615"></span><span>          </span><span class="hs-identifier">modifySession</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">hsc_env</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">hsc_env</span><span class="hs-special">{</span><span> </span><span class="hs-identifier">hsc_HPT</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">hpt5</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-616"></span><span>          </span><span class="hs-identifier">loadFinish</span><span> </span><span class="hs-identifier">Failed</span><span> </span><span class="hs-identifier">linkresult</span><span>
</span><span id="line-617"></span><span>
</span><span id="line-618"></span><span>
</span><span id="line-619"></span><span class="hs-comment">-- | Finish up after a load.</span><span>
</span><span id="line-620"></span><span id="local-6989586621681205185"><span class="annot"><a href="GHC.Driver.Make.html#loadFinish"><span class="hs-identifier hs-type">loadFinish</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Monad.html#GhcMonad"><span class="hs-identifier hs-type">GhcMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681205185"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#SuccessFlag"><span class="hs-identifier hs-type">SuccessFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#SuccessFlag"><span class="hs-identifier hs-type">SuccessFlag</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681205185"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#SuccessFlag"><span class="hs-identifier hs-type">SuccessFlag</span></a></span></span><span>
</span><span id="line-621"></span><span>
</span><span id="line-622"></span><span class="hs-comment">-- If the link failed, unload everything and return.</span><span>
</span><span id="line-623"></span><span id="loadFinish"><span class="annot"><span class="annottext">loadFinish :: forall (m :: * -&gt; *).
GhcMonad m =&gt;
SuccessFlag -&gt; SuccessFlag -&gt; m SuccessFlag
</span><a href="GHC.Driver.Make.html#loadFinish"><span class="hs-identifier hs-var hs-var">loadFinish</span></a></span></span><span> </span><span id="local-6989586621681204167"><span class="annot"><span class="annottext">SuccessFlag
</span><a href="#local-6989586621681204167"><span class="hs-identifier hs-var">_all_ok</span></a></span></span><span> </span><span class="annot"><span class="annottext">SuccessFlag
</span><a href="GHC.Types.Basic.html#Failed"><span class="hs-identifier hs-var">Failed</span></a></span><span>
</span><span id="line-624"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621681204166"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681204166"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m HscEnv
forall (m :: * -&gt; *). GhcMonad m =&gt; m HscEnv
</span><a href="GHC.Driver.Monad.html#getSession"><span class="hs-identifier hs-var">getSession</span></a></span><span>
</span><span id="line-625"></span><span>       </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; [Linkable] -&gt; IO ()
</span><a href="GHC.Driver.Make.html#unload"><span class="hs-identifier hs-var">unload</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681204166"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-626"></span><span>       </span><span class="annot"><span class="annottext">(HscEnv -&gt; HscEnv) -&gt; m ()
forall (m :: * -&gt; *). GhcMonad m =&gt; (HscEnv -&gt; HscEnv) -&gt; m ()
</span><a href="GHC.Driver.Monad.html#modifySession"><span class="hs-identifier hs-var">modifySession</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; HscEnv
</span><a href="GHC.Driver.Make.html#discardProg"><span class="hs-identifier hs-var">discardProg</span></a></span><span>
</span><span id="line-627"></span><span>       </span><span class="annot"><span class="annottext">SuccessFlag -&gt; m SuccessFlag
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">SuccessFlag
</span><a href="GHC.Types.Basic.html#Failed"><span class="hs-identifier hs-var">Failed</span></a></span><span>
</span><span id="line-628"></span><span>
</span><span id="line-629"></span><span class="hs-comment">-- Empty the interactive context and set the module context to the topmost</span><span>
</span><span id="line-630"></span><span class="hs-comment">-- newly loaded module, or the Prelude if none were loaded.</span><span>
</span><span id="line-631"></span><span class="annot"><a href="GHC.Driver.Make.html#loadFinish"><span class="hs-identifier hs-var">loadFinish</span></a></span><span> </span><span id="local-6989586621681204164"><span class="annot"><span class="annottext">SuccessFlag
</span><a href="#local-6989586621681204164"><span class="hs-identifier hs-var">all_ok</span></a></span></span><span> </span><span class="annot"><span class="annottext">SuccessFlag
</span><a href="GHC.Types.Basic.html#Succeeded"><span class="hs-identifier hs-var">Succeeded</span></a></span><span>
</span><span id="line-632"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">(HscEnv -&gt; HscEnv) -&gt; m ()
forall (m :: * -&gt; *). GhcMonad m =&gt; (HscEnv -&gt; HscEnv) -&gt; m ()
</span><a href="GHC.Driver.Monad.html#modifySession"><span class="hs-identifier hs-var">modifySession</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; HscEnv
</span><a href="GHC.Driver.Make.html#discardIC"><span class="hs-identifier hs-var">discardIC</span></a></span><span>
</span><span id="line-633"></span><span>       </span><span class="annot"><span class="annottext">SuccessFlag -&gt; m SuccessFlag
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">SuccessFlag
</span><a href="#local-6989586621681204164"><span class="hs-identifier hs-var">all_ok</span></a></span><span>
</span><span id="line-634"></span><span>
</span><span id="line-635"></span><span>
</span><span id="line-636"></span><span class="hs-comment">-- | Forget the current program, but retain the persistent info in HscEnv</span><span>
</span><span id="line-637"></span><span class="annot"><a href="GHC.Driver.Make.html#discardProg"><span class="hs-identifier hs-type">discardProg</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-638"></span><span id="discardProg"><span class="annot"><span class="annottext">discardProg :: HscEnv -&gt; HscEnv
</span><a href="GHC.Driver.Make.html#discardProg"><span class="hs-identifier hs-var hs-var">discardProg</span></a></span></span><span> </span><span id="local-6989586621681204163"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681204163"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span>
</span><span id="line-639"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; HscEnv
</span><a href="GHC.Driver.Make.html#discardIC"><span class="hs-identifier hs-var">discardIC</span></a></span><span> </span><span class="annot"><span class="annottext">(HscEnv -&gt; HscEnv) -&gt; HscEnv -&gt; HscEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681204163"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hsc_mod_graph :: ModuleGraph
</span><a href="GHC.Driver.Types.html#hsc_mod_graph"><span class="hs-identifier hs-var">hsc_mod_graph</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="GHC.Driver.Types.html#emptyMG"><span class="hs-identifier hs-var">emptyMG</span></a></span><span>
</span><span id="line-640"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hsc_HPT :: HomePackageTable
</span><a href="GHC.Driver.Types.html#hsc_HPT"><span class="hs-identifier hs-var">hsc_HPT</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HomePackageTable
</span><a href="GHC.Driver.Types.html#emptyHomePackageTable"><span class="hs-identifier hs-var">emptyHomePackageTable</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-641"></span><span>
</span><span id="line-642"></span><span class="hs-comment">-- | Discard the contents of the InteractiveContext, but keep the DynFlags.</span><span>
</span><span id="line-643"></span><span class="hs-comment">-- It will also keep ic_int_print and ic_monad if their names are from</span><span>
</span><span id="line-644"></span><span class="hs-comment">-- external packages.</span><span>
</span><span id="line-645"></span><span class="annot"><a href="GHC.Driver.Make.html#discardIC"><span class="hs-identifier hs-type">discardIC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-646"></span><span id="discardIC"><span class="annot"><span class="annottext">discardIC :: HscEnv -&gt; HscEnv
</span><a href="GHC.Driver.Make.html#discardIC"><span class="hs-identifier hs-var hs-var">discardIC</span></a></span></span><span> </span><span id="local-6989586621681204162"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681204162"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span>
</span><span id="line-647"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681204162"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hsc_IC :: InteractiveContext
</span><a href="GHC.Driver.Types.html#hsc_IC"><span class="hs-identifier hs-var">hsc_IC</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InteractiveContext
</span><a href="#local-6989586621681204160"><span class="hs-identifier hs-var">empty_ic</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ic_int_print :: Name
</span><a href="GHC.Driver.Types.html#ic_int_print"><span class="hs-identifier hs-var">ic_int_print</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681204158"><span class="hs-identifier hs-var">new_ic_int_print</span></a></span><span>
</span><span id="line-648"></span><span>                                </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ic_monad :: Name
</span><a href="GHC.Driver.Types.html#ic_monad"><span class="hs-identifier hs-var">ic_monad</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681204156"><span class="hs-identifier hs-var">new_ic_monad</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-649"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-650"></span><span>  </span><span class="hs-comment">-- Force the new values for ic_int_print and ic_monad to avoid leaking old_ic</span><span>
</span><span id="line-651"></span><span>  </span><span class="hs-glyph">!</span><span id="local-6989586621681204158"><span class="annot"><span class="annottext">new_ic_int_print :: Name
</span><a href="#local-6989586621681204158"><span class="hs-identifier hs-var hs-var">new_ic_int_print</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(InteractiveContext -&gt; Name) -&gt; Name
</span><a href="#local-6989586621681204155"><span class="hs-identifier hs-var">keep_external_name</span></a></span><span> </span><span class="annot"><span class="annottext">InteractiveContext -&gt; Name
</span><a href="GHC.Driver.Types.html#ic_int_print"><span class="hs-identifier hs-var hs-var">ic_int_print</span></a></span><span>
</span><span id="line-652"></span><span>  </span><span class="hs-glyph">!</span><span id="local-6989586621681204156"><span class="annot"><span class="annottext">new_ic_monad :: Name
</span><a href="#local-6989586621681204156"><span class="hs-identifier hs-var hs-var">new_ic_monad</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(InteractiveContext -&gt; Name) -&gt; Name
</span><a href="#local-6989586621681204155"><span class="hs-identifier hs-var">keep_external_name</span></a></span><span> </span><span class="annot"><span class="annottext">InteractiveContext -&gt; Name
</span><a href="GHC.Driver.Types.html#ic_monad"><span class="hs-identifier hs-var hs-var">ic_monad</span></a></span><span>
</span><span id="line-653"></span><span>  </span><span id="local-6989586621681204154"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621681204154"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InteractiveContext -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#ic_dflags"><span class="hs-identifier hs-var hs-var">ic_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">InteractiveContext
</span><a href="#local-6989586621681204152"><span class="hs-identifier hs-var">old_ic</span></a></span><span>
</span><span id="line-654"></span><span>  </span><span id="local-6989586621681204152"><span class="annot"><span class="annottext">old_ic :: InteractiveContext
</span><a href="#local-6989586621681204152"><span class="hs-identifier hs-var hs-var">old_ic</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; InteractiveContext
</span><a href="GHC.Driver.Types.html#hsc_IC"><span class="hs-identifier hs-var hs-var">hsc_IC</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681204162"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-655"></span><span>  </span><span id="local-6989586621681204160"><span class="annot"><span class="annottext">empty_ic :: InteractiveContext
</span><a href="#local-6989586621681204160"><span class="hs-identifier hs-var hs-var">empty_ic</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; InteractiveContext
</span><a href="GHC.Driver.Types.html#emptyInteractiveContext"><span class="hs-identifier hs-var">emptyInteractiveContext</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681204154"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-656"></span><span>  </span><span id="local-6989586621681204155"><span class="annot"><span class="annottext">keep_external_name :: (InteractiveContext -&gt; Name) -&gt; Name
</span><a href="#local-6989586621681204155"><span class="hs-identifier hs-var hs-var">keep_external_name</span></a></span></span><span> </span><span id="local-6989586621681204150"><span class="annot"><span class="annottext">InteractiveContext -&gt; Name
</span><a href="#local-6989586621681204150"><span class="hs-identifier hs-var">ic_name</span></a></span></span><span>
</span><span id="line-657"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId -&gt; Name -&gt; Bool
</span><a href="GHC.Types.Name.html#nameIsFromExternalPackage"><span class="hs-identifier hs-var">nameIsFromExternalPackage</span></a></span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681204148"><span class="hs-identifier hs-var">this_pkg</span></a></span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681204147"><span class="hs-identifier hs-var">old_name</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Name
</span><a href="#local-6989586621681204147"><span class="hs-identifier hs-var">old_name</span></a></span><span>
</span><span id="line-658"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InteractiveContext -&gt; Name
</span><a href="#local-6989586621681204150"><span class="hs-identifier hs-var">ic_name</span></a></span><span> </span><span class="annot"><span class="annottext">InteractiveContext
</span><a href="#local-6989586621681204160"><span class="hs-identifier hs-var">empty_ic</span></a></span><span>
</span><span id="line-659"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-660"></span><span>    </span><span id="local-6989586621681204148"><span class="annot"><span class="annottext">this_pkg :: GenUnit UnitId
</span><a href="#local-6989586621681204148"><span class="hs-identifier hs-var hs-var">this_pkg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; GenUnit UnitId
</span><a href="GHC.Driver.Session.html#homeUnit"><span class="hs-identifier hs-var">homeUnit</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681204154"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-661"></span><span>    </span><span id="local-6989586621681204147"><span class="annot"><span class="annottext">old_name :: Name
</span><a href="#local-6989586621681204147"><span class="hs-identifier hs-var hs-var">old_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InteractiveContext -&gt; Name
</span><a href="#local-6989586621681204150"><span class="hs-identifier hs-var">ic_name</span></a></span><span> </span><span class="annot"><span class="annottext">InteractiveContext
</span><a href="#local-6989586621681204152"><span class="hs-identifier hs-var">old_ic</span></a></span><span>
</span><span id="line-662"></span><span>
</span><span id="line-663"></span><span class="hs-comment">-- | If there is no -o option, guess the name of target executable</span><span>
</span><span id="line-664"></span><span class="hs-comment">-- by using top-level source file name as a base.</span><span>
</span><span id="line-665"></span><span id="local-6989586621681205208"><span class="annot"><a href="GHC.Driver.Make.html#guessOutputFile"><span class="hs-identifier hs-type">guessOutputFile</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Monad.html#GhcMonad"><span class="hs-identifier hs-type">GhcMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681205208"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681205208"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-666"></span><span id="guessOutputFile"><span class="annot"><span class="annottext">guessOutputFile :: forall (m :: * -&gt; *). GhcMonad m =&gt; m ()
</span><a href="GHC.Driver.Make.html#guessOutputFile"><span class="hs-identifier hs-var hs-var">guessOutputFile</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HscEnv -&gt; HscEnv) -&gt; m ()
forall (m :: * -&gt; *). GhcMonad m =&gt; (HscEnv -&gt; HscEnv) -&gt; m ()
</span><a href="GHC.Driver.Monad.html#modifySession"><span class="hs-identifier hs-var">modifySession</span></a></span><span> </span><span class="annot"><span class="annottext">((HscEnv -&gt; HscEnv) -&gt; m ()) -&gt; (HscEnv -&gt; HscEnv) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681204142"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681204142"><span class="hs-identifier hs-var">env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-667"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681204141"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621681204141"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681204142"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-668"></span><span>        </span><span class="hs-comment">-- Force mod_graph to avoid leaking env</span><span>
</span><span id="line-669"></span><span>        </span><span class="hs-glyph">!</span><span id="local-6989586621681204140"><span class="annot"><span class="annottext">mod_graph :: ModuleGraph
</span><a href="#local-6989586621681204140"><span class="hs-identifier hs-var hs-var">mod_graph</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; ModuleGraph
</span><a href="GHC.Driver.Types.html#hsc_mod_graph"><span class="hs-identifier hs-var hs-var">hsc_mod_graph</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681204142"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-670"></span><span>        </span><span class="annot"><a href="#local-6989586621681204139"><span class="hs-identifier hs-type">mainModuleSrcPath</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../base/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span>
</span><span id="line-671"></span><span>        </span><span id="local-6989586621681204139"><span class="annot"><span class="annottext">mainModuleSrcPath :: Maybe FilePath
</span><a href="#local-6989586621681204139"><span class="hs-identifier hs-var hs-var">mainModuleSrcPath</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-672"></span><span>            </span><span id="local-6989586621681204138"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681204138"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModuleGraph -&gt; Module -&gt; Maybe ModSummary
</span><a href="GHC.Driver.Types.html#mgLookupModule"><span class="hs-identifier hs-var">mgLookupModule</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621681204140"><span class="hs-identifier hs-var">mod_graph</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; Module
</span><a href="GHC.Driver.Session.html#mainModIs"><span class="hs-identifier hs-var hs-var">mainModIs</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681204141"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-673"></span><span>            </span><span class="annot"><span class="annottext">ModLocation -&gt; Maybe FilePath
</span><a href="GHC.Unit.Module.Location.html#ml_hs_file"><span class="hs-identifier hs-var hs-var">ml_hs_file</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; ModLocation
</span><a href="GHC.Driver.Types.html#ms_location"><span class="hs-identifier hs-var hs-var">ms_location</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681204138"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-674"></span><span>        </span><span id="local-6989586621681204135"><span class="annot"><span class="annottext">name :: Maybe FilePath
</span><a href="#local-6989586621681204135"><span class="hs-identifier hs-var hs-var">name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; FilePath) -&gt; Maybe FilePath -&gt; Maybe FilePath
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath
</span><a href="../../filepath/src/System.FilePath.Windows.html#dropExtension"><span class="hs-identifier hs-var">dropExtension</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe FilePath
</span><a href="#local-6989586621681204139"><span class="hs-identifier hs-var">mainModuleSrcPath</span></a></span><span>
</span><span id="line-675"></span><span>
</span><span id="line-676"></span><span>        </span><span id="local-6989586621681204128"><span class="annot"><span class="annottext">name_exe :: Maybe FilePath
</span><a href="#local-6989586621681204128"><span class="hs-identifier hs-var hs-var">name_exe</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span class="hs-cpp">
#if defined(mingw32_HOST_OS)
</span><span>          </span><span class="hs-comment">-- we must add the .exe extension unconditionally here, otherwise</span><span>
</span><span id="line-679"></span><span>          </span><span class="hs-comment">-- when name has an extension of its own, the .exe extension will</span><span>
</span><span id="line-680"></span><span>          </span><span class="hs-comment">-- not be added by GHC.Driver.Pipeline.exeFileName.  See #2248</span><span>
</span><span id="line-681"></span><span>          </span><span id="local-6989586621681204127"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681204127"><span class="hs-identifier hs-var">name'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; FilePath) -&gt; Maybe FilePath -&gt; Maybe FilePath
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
</span><a href="../../filepath/src/System.FilePath.Windows.html#%3C.%3E"><span class="hs-operator hs-var">&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;exe&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe FilePath
</span><a href="#local-6989586621681204135"><span class="hs-identifier hs-var">name</span></a></span><span class="hs-cpp">
#else
</span><span>          </span><span class="hs-identifier">name'</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">name</span><span class="hs-cpp">
#endif
</span><span>          </span><span id="local-6989586621681204125"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681204125"><span class="hs-identifier hs-var">mainModuleSrcPath'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe FilePath
</span><a href="#local-6989586621681204139"><span class="hs-identifier hs-var">mainModuleSrcPath</span></a></span><span>
</span><span id="line-686"></span><span>          </span><span class="hs-comment">-- #9930: don't clobber input files (unless they ask for it)</span><span>
</span><span id="line-687"></span><span>          </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681204127"><span class="hs-identifier hs-var">name'</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681204125"><span class="hs-identifier hs-var">mainModuleSrcPath'</span></a></span><span>
</span><span id="line-688"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">GhcException -&gt; Maybe FilePath
forall a. GhcException -&gt; a
</span><a href="GHC.Utils.Panic.html#throwGhcException"><span class="hs-identifier hs-var">throwGhcException</span></a></span><span> </span><span class="annot"><span class="annottext">(GhcException -&gt; Maybe FilePath)
-&gt; (FilePath -&gt; GhcException) -&gt; FilePath -&gt; Maybe FilePath
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; GhcException
</span><a href="GHC.Utils.Panic.html#UsageError"><span class="hs-identifier hs-var">UsageError</span></a></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; Maybe FilePath) -&gt; FilePath -&gt; Maybe FilePath
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-689"></span><span>                 </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;default output name would overwrite the input file; &quot;</span></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-690"></span><span>                 </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;must specify -o explicitly&quot;</span></span><span>
</span><span id="line-691"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681204127"><span class="hs-identifier hs-var">name'</span></a></span><span>
</span><span id="line-692"></span><span>    </span><span class="hs-keyword">in</span><span>
</span><span id="line-693"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Maybe FilePath
</span><a href="GHC.Driver.Session.html#outputFile"><span class="hs-identifier hs-var hs-var">outputFile</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681204141"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-694"></span><span>        </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681204142"><span class="hs-identifier hs-var">env</span></a></span><span>
</span><span id="line-695"></span><span>        </span><span class="annot"><span class="annottext">Maybe FilePath
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681204142"><span class="hs-identifier hs-var">env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hsc_dflags :: DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681204141"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">outputFile :: Maybe FilePath
</span><a href="GHC.Driver.Session.html#outputFile"><span class="hs-identifier hs-var">outputFile</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe FilePath
</span><a href="#local-6989586621681204128"><span class="hs-identifier hs-var">name_exe</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-696"></span><span>
</span><span id="line-697"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-698"></span><span class="hs-comment">--</span><span>
</span><span id="line-699"></span><span class="hs-comment">-- | Prune the HomePackageTable</span><span>
</span><span id="line-700"></span><span class="hs-comment">--</span><span>
</span><span id="line-701"></span><span class="hs-comment">-- Before doing an upsweep, we can throw away:</span><span>
</span><span id="line-702"></span><span class="hs-comment">--</span><span>
</span><span id="line-703"></span><span class="hs-comment">--   - For non-stable modules:</span><span>
</span><span id="line-704"></span><span class="hs-comment">--      - all ModDetails, all linked code</span><span>
</span><span id="line-705"></span><span class="hs-comment">--   - all unlinked code that is out of date with respect to</span><span>
</span><span id="line-706"></span><span class="hs-comment">--     the source file</span><span>
</span><span id="line-707"></span><span class="hs-comment">--</span><span>
</span><span id="line-708"></span><span class="hs-comment">-- This is VERY IMPORTANT otherwise we'll end up requiring 2x the</span><span>
</span><span id="line-709"></span><span class="hs-comment">-- space at the end of the upsweep, because the topmost ModDetails of the</span><span>
</span><span id="line-710"></span><span class="hs-comment">-- old HPT holds on to the entire type environment from the previous</span><span>
</span><span id="line-711"></span><span class="hs-comment">-- compilation.</span><span>
</span><span id="line-712"></span><span class="annot"><a href="GHC.Driver.Make.html#pruneHomePackageTable"><span class="hs-identifier hs-type">pruneHomePackageTable</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HomePackageTable"><span class="hs-identifier hs-type">HomePackageTable</span></a></span><span>
</span><span id="line-713"></span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-714"></span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#StableModules"><span class="hs-identifier hs-type">StableModules</span></a></span><span>
</span><span id="line-715"></span><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HomePackageTable"><span class="hs-identifier hs-type">HomePackageTable</span></a></span><span>
</span><span id="line-716"></span><span id="pruneHomePackageTable"><span class="annot"><span class="annottext">pruneHomePackageTable :: HomePackageTable
-&gt; [ModSummary]
-&gt; (UniqSet ModuleName, UniqSet ModuleName)
-&gt; HomePackageTable
</span><a href="GHC.Driver.Make.html#pruneHomePackageTable"><span class="hs-identifier hs-var hs-var">pruneHomePackageTable</span></a></span></span><span> </span><span id="local-6989586621681204121"><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621681204121"><span class="hs-identifier hs-var">hpt</span></a></span></span><span> </span><span id="local-6989586621681204120"><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681204120"><span class="hs-identifier hs-var">summ</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681204119"><span class="annot"><span class="annottext">UniqSet ModuleName
</span><a href="#local-6989586621681204119"><span class="hs-identifier hs-var">stable_obj</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681204118"><span class="annot"><span class="annottext">UniqSet ModuleName
</span><a href="#local-6989586621681204118"><span class="hs-identifier hs-var">stable_bco</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-717"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HomeModInfo -&gt; HomeModInfo)
-&gt; HomePackageTable -&gt; HomePackageTable
</span><a href="GHC.Driver.Types.html#mapHpt"><span class="hs-identifier hs-var">mapHpt</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModInfo -&gt; HomeModInfo
</span><a href="#local-6989586621681204116"><span class="hs-identifier hs-var">prune</span></a></span><span> </span><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621681204121"><span class="hs-identifier hs-var">hpt</span></a></span><span>
</span><span id="line-718"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681204116"><span class="annot"><span class="annottext">prune :: HomeModInfo -&gt; HomeModInfo
</span><a href="#local-6989586621681204116"><span class="hs-identifier hs-var hs-var">prune</span></a></span></span><span> </span><span id="local-6989586621681204115"><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621681204115"><span class="hs-identifier hs-var">hmi</span></a></span></span><span>
</span><span id="line-719"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; Bool
</span><a href="#local-6989586621681204114"><span class="hs-identifier hs-var">is_stable</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681204113"><span class="hs-identifier hs-var">modl</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621681204112"><span class="hs-identifier hs-var">hmi'</span></a></span><span>
</span><span id="line-720"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621681204112"><span class="hs-identifier hs-var">hmi'</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hm_details :: ModDetails
</span><a href="GHC.Driver.Types.html#hm_details"><span class="hs-identifier hs-var">hm_details</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModDetails
</span><a href="GHC.Driver.Types.html#emptyModDetails"><span class="hs-identifier hs-var">emptyModDetails</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-721"></span><span>          </span><span class="hs-keyword">where</span><span>
</span><span id="line-722"></span><span>           </span><span id="local-6989586621681204113"><span class="annot"><span class="annottext">modl :: ModuleName
</span><a href="#local-6989586621681204113"><span class="hs-identifier hs-var hs-var">modl</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var hs-var">moduleName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModIface_ 'ModIfaceFinal -&gt; Module
forall (phase :: ModIfacePhase). ModIface_ phase -&gt; Module
</span><a href="GHC.Driver.Types.html#mi_module"><span class="hs-identifier hs-var hs-var">mi_module</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HomeModInfo -&gt; ModIface_ 'ModIfaceFinal
</span><a href="GHC.Driver.Types.html#hm_iface"><span class="hs-identifier hs-var hs-var">hm_iface</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621681204115"><span class="hs-identifier hs-var">hmi</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-723"></span><span>           </span><span id="local-6989586621681204112"><span class="annot"><span class="annottext">hmi' :: HomeModInfo
</span><a href="#local-6989586621681204112"><span class="hs-identifier hs-var hs-var">hmi'</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681204107"><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621681204107"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HomeModInfo -&gt; Maybe Linkable
</span><a href="GHC.Driver.Types.html#hm_linkable"><span class="hs-identifier hs-var hs-var">hm_linkable</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621681204115"><span class="hs-identifier hs-var">hmi</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Linkable -&gt; UTCTime
</span><a href="GHC.Runtime.Linker.Types.html#linkableTime"><span class="hs-identifier hs-var hs-var">linkableTime</span></a></span><span> </span><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621681204107"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime -&gt; UTCTime -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; UTCTime
</span><a href="GHC.Driver.Types.html#ms_hs_date"><span class="hs-identifier hs-var hs-var">ms_hs_date</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681204103"><span class="hs-identifier hs-var">ms</span></a></span><span>
</span><span id="line-724"></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621681204115"><span class="hs-identifier hs-var">hmi</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hm_linkable :: Maybe Linkable
</span><a href="GHC.Driver.Types.html#hm_linkable"><span class="hs-identifier hs-var">hm_linkable</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe Linkable
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-725"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-726"></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621681204115"><span class="hs-identifier hs-var">hmi</span></a></span><span>
</span><span id="line-727"></span><span>                </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681204103"><span class="annot"><span class="annottext">ms :: ModSummary
</span><a href="#local-6989586621681204103"><span class="hs-identifier hs-var hs-var">ms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe ModSummary -&gt; ModSummary
forall a. HasCallStack =&gt; FilePath -&gt; Maybe a -&gt; a
</span><a href="GHC.Data.Maybe.html#expectJust"><span class="hs-identifier hs-var">expectJust</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;prune&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UniqFM ModuleName ModSummary -&gt; ModuleName -&gt; Maybe ModSummary
forall key elt. Uniquable key =&gt; UniqFM key elt -&gt; key -&gt; Maybe elt
</span><a href="GHC.Types.Unique.FM.html#lookupUFM"><span class="hs-identifier hs-var">lookupUFM</span></a></span><span> </span><span class="annot"><span class="annottext">UniqFM ModuleName ModSummary
</span><a href="#local-6989586621681204098"><span class="hs-identifier hs-var">ms_map</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681204113"><span class="hs-identifier hs-var">modl</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-728"></span><span>
</span><span id="line-729"></span><span>        </span><span id="local-6989586621681204098"><span class="annot"><span class="annottext">ms_map :: UniqFM ModuleName ModSummary
</span><a href="#local-6989586621681204098"><span class="hs-identifier hs-var hs-var">ms_map</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(ModuleName, ModSummary)] -&gt; UniqFM ModuleName ModSummary
forall key elt. Uniquable key =&gt; [(key, elt)] -&gt; UniqFM key elt
</span><a href="GHC.Types.Unique.FM.html#listToUFM"><span class="hs-identifier hs-var">listToUFM</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; ModuleName
</span><a href="GHC.Driver.Types.html#ms_mod_name"><span class="hs-identifier hs-var">ms_mod_name</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681204095"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681204095"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681204095"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681204095"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681204120"><span class="hs-identifier hs-var">summ</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-730"></span><span>
</span><span id="line-731"></span><span>        </span><span id="local-6989586621681204114"><span class="annot"><span class="annottext">is_stable :: ModuleName -&gt; Bool
</span><a href="#local-6989586621681204114"><span class="hs-identifier hs-var hs-var">is_stable</span></a></span></span><span> </span><span id="local-6989586621681204092"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681204092"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-732"></span><span>          </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681204092"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; UniqSet ModuleName -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; UniqSet a -&gt; Bool
</span><a href="GHC.Types.Unique.Set.html#elementOfUniqSet"><span class="hs-operator hs-var">`elementOfUniqSet`</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSet ModuleName
</span><a href="#local-6989586621681204119"><span class="hs-identifier hs-var">stable_obj</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span>
</span><span id="line-733"></span><span>          </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681204092"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; UniqSet ModuleName -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; UniqSet a -&gt; Bool
</span><a href="GHC.Types.Unique.Set.html#elementOfUniqSet"><span class="hs-operator hs-var">`elementOfUniqSet`</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSet ModuleName
</span><a href="#local-6989586621681204118"><span class="hs-identifier hs-var">stable_bco</span></a></span><span>
</span><span id="line-734"></span><span>
</span><span id="line-735"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-736"></span><span class="hs-comment">--</span><span>
</span><span id="line-737"></span><span class="hs-comment">-- | Return (names of) all those in modsDone who are part of a cycle as defined</span><span>
</span><span id="line-738"></span><span class="hs-comment">-- by theGraph.</span><span>
</span><span id="line-739"></span><span class="annot"><a href="GHC.Driver.Make.html#findPartiallyCompletedCycles"><span class="hs-identifier hs-type">findPartiallyCompletedCycles</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../containers/src/Data.Graph.html#SCC"><span class="hs-identifier hs-type">SCC</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../containers/src/Data.Set.Internal.html#Set"><span class="hs-identifier hs-type">Set.Set</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span>
</span><span id="line-740"></span><span id="findPartiallyCompletedCycles"><span class="annot"><span class="annottext">findPartiallyCompletedCycles :: [Module] -&gt; [SCC ModSummary] -&gt; Set Module
</span><a href="GHC.Driver.Make.html#findPartiallyCompletedCycles"><span class="hs-identifier hs-var hs-var">findPartiallyCompletedCycles</span></a></span></span><span> </span><span id="local-6989586621681204091"><span class="annot"><span class="annottext">[Module]
</span><a href="#local-6989586621681204091"><span class="hs-identifier hs-var">modsDone</span></a></span></span><span> </span><span id="local-6989586621681204090"><span class="annot"><span class="annottext">[SCC ModSummary]
</span><a href="#local-6989586621681204090"><span class="hs-identifier hs-var">theGraph</span></a></span></span><span>
</span><span id="line-741"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Set Module] -&gt; Set Module
forall (f :: * -&gt; *) a. (Foldable f, Ord a) =&gt; f (Set a) -&gt; Set a
</span><a href="../../containers/src/Data.Set.Internal.html#unions"><span class="hs-identifier hs-var">Set.unions</span></a></span><span>
</span><span id="line-742"></span><span>       </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Set Module
</span><a href="#local-6989586621681204088"><span class="hs-identifier hs-var">mods_in_this_cycle</span></a></span><span>
</span><span id="line-743"></span><span>       </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../containers/src/Data.Graph.html#CyclicSCC"><span class="hs-identifier hs-type">CyclicSCC</span></a></span><span> </span><span id="local-6989586621681204087"><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681204087"><span class="hs-identifier hs-var">vs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[SCC ModSummary]
</span><a href="#local-6989586621681204090"><span class="hs-identifier hs-var">theGraph</span></a></span><span>  </span><span class="hs-comment">-- Acyclic? Not interesting.</span><span>
</span><span id="line-744"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681204084"><span class="annot"><span class="annottext">names_in_this_cycle :: Set Module
</span><a href="#local-6989586621681204084"><span class="hs-identifier hs-var hs-var">names_in_this_cycle</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Module] -&gt; Set Module
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="../../containers/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">Set.fromList</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ModSummary -&gt; Module) -&gt; [ModSummary] -&gt; [Module]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; Module
</span><a href="GHC.Driver.Types.html#ms_mod"><span class="hs-identifier hs-var hs-var">ms_mod</span></a></span><span> </span><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681204087"><span class="hs-identifier hs-var">vs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-745"></span><span>             </span><span id="local-6989586621681204088"><span class="annot"><span class="annottext">mods_in_this_cycle :: Set Module
</span><a href="#local-6989586621681204088"><span class="hs-identifier hs-var hs-var">mods_in_this_cycle</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-746"></span><span>                    </span><span class="annot"><span class="annottext">Set Module -&gt; Set Module -&gt; Set Module
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="../../containers/src/Data.Set.Internal.html#intersection"><span class="hs-identifier hs-var">Set.intersection</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Module] -&gt; Set Module
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="../../containers/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">Set.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">[Module]
</span><a href="#local-6989586621681204091"><span class="hs-identifier hs-var">modsDone</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Set Module
</span><a href="#local-6989586621681204084"><span class="hs-identifier hs-var">names_in_this_cycle</span></a></span><span>
</span><span id="line-747"></span><span>         </span><span class="hs-comment">-- If size mods_in_this_cycle == size names_in_this_cycle,</span><span>
</span><span id="line-748"></span><span>         </span><span class="hs-comment">-- then this cycle has already been completed and we're not</span><span>
</span><span id="line-749"></span><span>         </span><span class="hs-comment">-- interested.</span><span>
</span><span id="line-750"></span><span>       </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set Module -&gt; Int
forall a. Set a -&gt; Int
</span><a href="../../containers/src/Data.Set.Internal.html#size"><span class="hs-identifier hs-var">Set.size</span></a></span><span> </span><span class="annot"><span class="annottext">Set Module
</span><a href="#local-6989586621681204088"><span class="hs-identifier hs-var">mods_in_this_cycle</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&lt;</span></span><span> </span><span class="annot"><span class="annottext">Set Module -&gt; Int
forall a. Set a -&gt; Int
</span><a href="../../containers/src/Data.Set.Internal.html#size"><span class="hs-identifier hs-var">Set.size</span></a></span><span> </span><span class="annot"><span class="annottext">Set Module
</span><a href="#local-6989586621681204084"><span class="hs-identifier hs-var">names_in_this_cycle</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-751"></span><span>
</span><span id="line-752"></span><span>
</span><span id="line-753"></span><span class="hs-comment">-- ---------------------------------------------------------------------------</span><span>
</span><span id="line-754"></span><span class="hs-comment">--</span><span>
</span><span id="line-755"></span><span class="hs-comment">-- | Unloading</span><span>
</span><span id="line-756"></span><span class="annot"><a href="GHC.Driver.Make.html#unload"><span class="hs-identifier hs-type">unload</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Runtime.Linker.Types.html#Linkable"><span class="hs-identifier hs-type">Linkable</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-757"></span><span id="unload"><span class="annot"><span class="annottext">unload :: HscEnv -&gt; [Linkable] -&gt; IO ()
</span><a href="GHC.Driver.Make.html#unload"><span class="hs-identifier hs-var hs-var">unload</span></a></span></span><span> </span><span id="local-6989586621681204077"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681204077"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681204076"><span class="annot"><span class="annottext">[Linkable]
</span><a href="#local-6989586621681204076"><span class="hs-identifier hs-var">stable_linkables</span></a></span></span><span> </span><span class="hs-comment">-- Unload everything *except* 'stable_linkables'</span><span>
</span><span id="line-758"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; GhcLink
</span><a href="GHC.Driver.Session.html#ghcLink"><span class="hs-identifier hs-var hs-var">ghcLink</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681204077"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-759"></span><span>        </span><span class="annot"><span class="annottext">GhcLink
</span><a href="GHC.Driver.Session.html#LinkInMemory"><span class="hs-identifier hs-var">LinkInMemory</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; [Linkable] -&gt; IO ()
</span><a href="GHC.Runtime.Linker.html#unload"><span class="hs-identifier hs-var">Linker.unload</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681204077"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">[Linkable]
</span><a href="#local-6989586621681204076"><span class="hs-identifier hs-var">stable_linkables</span></a></span><span>
</span><span id="line-760"></span><span>        </span><span id="local-6989586621681204073"><span class="annot"><span class="annottext">GhcLink
</span><a href="#local-6989586621681204073"><span class="hs-identifier hs-var">_other</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-761"></span><span>
</span><span id="line-762"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-763"></span><span class="hs-comment">{- |

  Stability tells us which modules definitely do not need to be recompiled.
  There are two main reasons for having stability:

   - avoid doing a complete upsweep of the module graph in GHCi when
     modules near the bottom of the tree have not changed.

   - to tell GHCi when it can load object code: we can only load object code
     for a module when we also load object code fo  all of the imports of the
     module.  So we need to know that we will definitely not be recompiling
     any of these modules, and we can use the object code.

  The stability check is as follows.  Both stableObject and
  stableBCO are used during the upsweep phase later.

@
  stable m = stableObject m || stableBCO m

  stableObject m =
        all stableObject (imports m)
        &amp;&amp; old linkable does not exist, or is == on-disk .o
        &amp;&amp; date(on-disk .o) &gt; date(.hs)

  stableBCO m =
        all stable (imports m)
        &amp;&amp; date(BCO) &gt; date(.hs)
@

  These properties embody the following ideas:

    - if a module is stable, then:

        - if it has been compiled in a previous pass (present in HPT)
          then it does not need to be compiled or re-linked.

        - if it has not been compiled in a previous pass,
          then we only need to read its .hi file from disk and
          link it to produce a 'ModDetails'.

    - if a modules is not stable, we will definitely be at least
      re-linking, and possibly re-compiling it during the 'upsweep'.
      All non-stable modules can (and should) therefore be unlinked
      before the 'upsweep'.

    - Note that objects are only considered stable if they only depend
      on other objects.  We can't link object code against byte code.

    - Note that even if an object is stable, we may end up recompiling
      if the interface is out of date because an *external* interface
      has changed.  The current code in GHC.Driver.Make handles this case
      fairly poorly, so be careful.
-}</span><span>
</span><span id="line-816"></span><span>
</span><span id="line-817"></span><span class="hs-keyword">type</span><span> </span><span id="StableModules"><span class="annot"><a href="GHC.Driver.Make.html#StableModules"><span class="hs-identifier hs-var">StableModules</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-818"></span><span>  </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Set.html#UniqSet"><span class="hs-identifier hs-type">UniqSet</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span>  </span><span class="hs-comment">-- stableObject</span><span>
</span><span id="line-819"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Set.html#UniqSet"><span class="hs-identifier hs-type">UniqSet</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span>  </span><span class="hs-comment">-- stableBCO</span><span>
</span><span id="line-820"></span><span>  </span><span class="hs-special">)</span><span>
</span><span id="line-821"></span><span>
</span><span id="line-822"></span><span>
</span><span id="line-823"></span><span class="annot"><a href="GHC.Driver.Make.html#checkStability"><span class="hs-identifier hs-type">checkStability</span></a></span><span>
</span><span id="line-824"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HomePackageTable"><span class="hs-identifier hs-type">HomePackageTable</span></a></span><span>   </span><span class="hs-comment">-- HPT from last compilation</span><span>
</span><span id="line-825"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../containers/src/Data.Graph.html#SCC"><span class="hs-identifier hs-type">SCC</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">]</span><span>   </span><span class="hs-comment">-- current module graph (cyclic)</span><span>
</span><span id="line-826"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Set.html#UniqSet"><span class="hs-identifier hs-type">UniqSet</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span> </span><span class="hs-comment">-- all home modules</span><span>
</span><span id="line-827"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#StableModules"><span class="hs-identifier hs-type">StableModules</span></a></span><span>
</span><span id="line-828"></span><span>
</span><span id="line-829"></span><span id="checkStability"><span class="annot"><span class="annottext">checkStability :: HomePackageTable
-&gt; [SCC ModSummary]
-&gt; UniqSet ModuleName
-&gt; (UniqSet ModuleName, UniqSet ModuleName)
</span><a href="GHC.Driver.Make.html#checkStability"><span class="hs-identifier hs-var hs-var">checkStability</span></a></span></span><span> </span><span id="local-6989586621681204072"><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621681204072"><span class="hs-identifier hs-var">hpt</span></a></span></span><span> </span><span id="local-6989586621681204071"><span class="annot"><span class="annottext">[SCC ModSummary]
</span><a href="#local-6989586621681204071"><span class="hs-identifier hs-var">sccs</span></a></span></span><span> </span><span id="local-6989586621681204070"><span class="annot"><span class="annottext">UniqSet ModuleName
</span><a href="#local-6989586621681204070"><span class="hs-identifier hs-var">all_home_mods</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-830"></span><span>  </span><span class="annot"><span class="annottext">((UniqSet ModuleName, UniqSet ModuleName)
 -&gt; SCC ModSummary -&gt; (UniqSet ModuleName, UniqSet ModuleName))
-&gt; (UniqSet ModuleName, UniqSet ModuleName)
-&gt; [SCC ModSummary]
-&gt; (UniqSet ModuleName, UniqSet ModuleName)
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base/src/Data.Foldable.html#foldl%27"><span class="hs-identifier hs-var">foldl'</span></a></span><span> </span><span class="annot"><span class="annottext">(UniqSet ModuleName, UniqSet ModuleName)
-&gt; SCC ModSummary -&gt; (UniqSet ModuleName, UniqSet ModuleName)
</span><a href="#local-6989586621681204068"><span class="hs-identifier hs-var">checkSCC</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UniqSet ModuleName
forall a. UniqSet a
</span><a href="GHC.Types.Unique.Set.html#emptyUniqSet"><span class="hs-identifier hs-var">emptyUniqSet</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UniqSet ModuleName
forall a. UniqSet a
</span><a href="GHC.Types.Unique.Set.html#emptyUniqSet"><span class="hs-identifier hs-var">emptyUniqSet</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[SCC ModSummary]
</span><a href="#local-6989586621681204071"><span class="hs-identifier hs-var">sccs</span></a></span><span>
</span><span id="line-831"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-832"></span><span>   </span><span class="annot"><a href="#local-6989586621681204068"><span class="hs-identifier hs-type">checkSCC</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#StableModules"><span class="hs-identifier hs-type">StableModules</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../containers/src/Data.Graph.html#SCC"><span class="hs-identifier hs-type">SCC</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#StableModules"><span class="hs-identifier hs-type">StableModules</span></a></span><span>
</span><span id="line-833"></span><span>   </span><span id="local-6989586621681204068"><span class="annot"><span class="annottext">checkSCC :: (UniqSet ModuleName, UniqSet ModuleName)
-&gt; SCC ModSummary -&gt; (UniqSet ModuleName, UniqSet ModuleName)
</span><a href="#local-6989586621681204068"><span class="hs-identifier hs-var hs-var">checkSCC</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681204066"><span class="annot"><span class="annottext">UniqSet ModuleName
</span><a href="#local-6989586621681204066"><span class="hs-identifier hs-var">stable_obj</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681204065"><span class="annot"><span class="annottext">UniqSet ModuleName
</span><a href="#local-6989586621681204065"><span class="hs-identifier hs-var">stable_bco</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681204064"><span class="annot"><span class="annottext">SCC ModSummary
</span><a href="#local-6989586621681204064"><span class="hs-identifier hs-var">scc0</span></a></span></span><span>
</span><span id="line-834"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681204063"><span class="hs-identifier hs-var">stableObjects</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UniqSet ModuleName -&gt; [ModuleName] -&gt; UniqSet ModuleName
forall a. Uniquable a =&gt; UniqSet a -&gt; [a] -&gt; UniqSet a
</span><a href="GHC.Types.Unique.Set.html#addListToUniqSet"><span class="hs-identifier hs-var">addListToUniqSet</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSet ModuleName
</span><a href="#local-6989586621681204066"><span class="hs-identifier hs-var">stable_obj</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621681204061"><span class="hs-identifier hs-var">scc_mods</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UniqSet ModuleName
</span><a href="#local-6989586621681204065"><span class="hs-identifier hs-var">stable_bco</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-835"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681204060"><span class="hs-identifier hs-var">stableBCOs</span></a></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UniqSet ModuleName
</span><a href="#local-6989586621681204066"><span class="hs-identifier hs-var">stable_obj</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UniqSet ModuleName -&gt; [ModuleName] -&gt; UniqSet ModuleName
forall a. Uniquable a =&gt; UniqSet a -&gt; [a] -&gt; UniqSet a
</span><a href="GHC.Types.Unique.Set.html#addListToUniqSet"><span class="hs-identifier hs-var">addListToUniqSet</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSet ModuleName
</span><a href="#local-6989586621681204065"><span class="hs-identifier hs-var">stable_bco</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621681204061"><span class="hs-identifier hs-var">scc_mods</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-836"></span><span>     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UniqSet ModuleName
</span><a href="#local-6989586621681204066"><span class="hs-identifier hs-var">stable_obj</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">UniqSet ModuleName
</span><a href="#local-6989586621681204065"><span class="hs-identifier hs-var">stable_bco</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-837"></span><span>     </span><span class="hs-keyword">where</span><span>
</span><span id="line-838"></span><span>        </span><span id="local-6989586621681204059"><span class="annot"><span class="annottext">scc :: [ModSummary]
</span><a href="#local-6989586621681204059"><span class="hs-identifier hs-var hs-var">scc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SCC ModSummary -&gt; [ModSummary]
forall vertex. SCC vertex -&gt; [vertex]
</span><a href="../../containers/src/Data.Graph.html#flattenSCC"><span class="hs-identifier hs-var">flattenSCC</span></a></span><span> </span><span class="annot"><span class="annottext">SCC ModSummary
</span><a href="#local-6989586621681204064"><span class="hs-identifier hs-var">scc0</span></a></span><span>
</span><span id="line-839"></span><span>        </span><span id="local-6989586621681204061"><span class="annot"><span class="annottext">scc_mods :: [ModuleName]
</span><a href="#local-6989586621681204061"><span class="hs-identifier hs-var hs-var">scc_mods</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ModSummary -&gt; ModuleName) -&gt; [ModSummary] -&gt; [ModuleName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; ModuleName
</span><a href="GHC.Driver.Types.html#ms_mod_name"><span class="hs-identifier hs-var">ms_mod_name</span></a></span><span> </span><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681204059"><span class="hs-identifier hs-var">scc</span></a></span><span>
</span><span id="line-840"></span><span>        </span><span id="local-6989586621681204054"><span class="annot"><span class="annottext">home_module :: ModuleName -&gt; Bool
</span><a href="#local-6989586621681204054"><span class="hs-identifier hs-var hs-var">home_module</span></a></span></span><span> </span><span id="local-6989586621681204053"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681204053"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-841"></span><span>          </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681204053"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; UniqSet ModuleName -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; UniqSet a -&gt; Bool
</span><a href="GHC.Types.Unique.Set.html#elementOfUniqSet"><span class="hs-operator hs-var">`elementOfUniqSet`</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSet ModuleName
</span><a href="#local-6989586621681204070"><span class="hs-identifier hs-var">all_home_mods</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681204053"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; [ModuleName] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#notElem"><span class="hs-operator hs-var">`notElem`</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621681204061"><span class="hs-identifier hs-var">scc_mods</span></a></span><span>
</span><span id="line-842"></span><span>
</span><span id="line-843"></span><span>        </span><span id="local-6989586621681204049"><span class="annot"><span class="annottext">scc_allimps :: [ModuleName]
</span><a href="#local-6989586621681204049"><span class="hs-identifier hs-var hs-var">scc_allimps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ModuleName] -&gt; [ModuleName]
forall a. Eq a =&gt; [a] -&gt; [a]
</span><a href="../../base/src/Data.OldList.html#nub"><span class="hs-identifier hs-var">nub</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ModuleName -&gt; Bool) -&gt; [ModuleName] -&gt; [ModuleName]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; Bool
</span><a href="#local-6989586621681204054"><span class="hs-identifier hs-var">home_module</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ModSummary -&gt; [ModuleName]) -&gt; [ModSummary] -&gt; [ModuleName]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><a href="../../base/src/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; [ModuleName]
</span><a href="GHC.Driver.Types.html#ms_home_allimps"><span class="hs-identifier hs-var">ms_home_allimps</span></a></span><span> </span><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681204059"><span class="hs-identifier hs-var">scc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-844"></span><span>            </span><span class="hs-comment">-- all imports outside the current SCC, but in the home pkg</span><span>
</span><span id="line-845"></span><span>
</span><span id="line-846"></span><span>        </span><span id="local-6989586621681204045"><span class="annot"><span class="annottext">stable_obj_imps :: [Bool]
</span><a href="#local-6989586621681204045"><span class="hs-identifier hs-var hs-var">stable_obj_imps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ModuleName -&gt; Bool) -&gt; [ModuleName] -&gt; [Bool]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName -&gt; UniqSet ModuleName -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; UniqSet a -&gt; Bool
</span><a href="GHC.Types.Unique.Set.html#elementOfUniqSet"><span class="hs-operator hs-var">`elementOfUniqSet`</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSet ModuleName
</span><a href="#local-6989586621681204066"><span class="hs-identifier hs-var">stable_obj</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621681204049"><span class="hs-identifier hs-var">scc_allimps</span></a></span><span>
</span><span id="line-847"></span><span>        </span><span id="local-6989586621681204043"><span class="annot"><span class="annottext">stable_bco_imps :: [Bool]
</span><a href="#local-6989586621681204043"><span class="hs-identifier hs-var hs-var">stable_bco_imps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ModuleName -&gt; Bool) -&gt; [ModuleName] -&gt; [Bool]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName -&gt; UniqSet ModuleName -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; UniqSet a -&gt; Bool
</span><a href="GHC.Types.Unique.Set.html#elementOfUniqSet"><span class="hs-operator hs-var">`elementOfUniqSet`</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSet ModuleName
</span><a href="#local-6989586621681204065"><span class="hs-identifier hs-var">stable_bco</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621681204049"><span class="hs-identifier hs-var">scc_allimps</span></a></span><span>
</span><span id="line-848"></span><span>
</span><span id="line-849"></span><span>        </span><span id="local-6989586621681204063"><span class="annot"><span class="annottext">stableObjects :: Bool
</span><a href="#local-6989586621681204063"><span class="hs-identifier hs-var hs-var">stableObjects</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-850"></span><span>           </span><span class="annot"><span class="annottext">[Bool] -&gt; Bool
forall (t :: * -&gt; *). Foldable t =&gt; t Bool -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#and"><span class="hs-identifier hs-var">and</span></a></span><span> </span><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621681204045"><span class="hs-identifier hs-var">stable_obj_imps</span></a></span><span>
</span><span id="line-851"></span><span>           </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">(ModSummary -&gt; Bool) -&gt; [ModSummary] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#all"><span class="hs-identifier hs-var">all</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; Bool
</span><a href="#local-6989586621681204038"><span class="hs-identifier hs-var">object_ok</span></a></span><span> </span><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681204059"><span class="hs-identifier hs-var">scc</span></a></span><span>
</span><span id="line-852"></span><span>
</span><span id="line-853"></span><span>        </span><span id="local-6989586621681204060"><span class="annot"><span class="annottext">stableBCOs :: Bool
</span><a href="#local-6989586621681204060"><span class="hs-identifier hs-var hs-var">stableBCOs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-854"></span><span>           </span><span class="annot"><span class="annottext">[Bool] -&gt; Bool
forall (t :: * -&gt; *). Foldable t =&gt; t Bool -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#and"><span class="hs-identifier hs-var">and</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Bool -&gt; Bool -&gt; Bool) -&gt; [Bool] -&gt; [Bool] -&gt; [Bool]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><a href="../../base/src/GHC.List.html#zipWith"><span class="hs-identifier hs-var">zipWith</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">(||)</span></span><span> </span><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621681204045"><span class="hs-identifier hs-var">stable_obj_imps</span></a></span><span> </span><span class="annot"><span class="annottext">[Bool]
</span><a href="#local-6989586621681204043"><span class="hs-identifier hs-var">stable_bco_imps</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-855"></span><span>           </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">(ModSummary -&gt; Bool) -&gt; [ModSummary] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#all"><span class="hs-identifier hs-var">all</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; Bool
</span><a href="#local-6989586621681204034"><span class="hs-identifier hs-var">bco_ok</span></a></span><span> </span><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681204059"><span class="hs-identifier hs-var">scc</span></a></span><span>
</span><span id="line-856"></span><span>
</span><span id="line-857"></span><span>        </span><span id="local-6989586621681204038"><span class="annot"><span class="annottext">object_ok :: ModSummary -&gt; Bool
</span><a href="#local-6989586621681204038"><span class="hs-identifier hs-var hs-var">object_ok</span></a></span></span><span> </span><span id="local-6989586621681204032"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681204032"><span class="hs-identifier hs-var">ms</span></a></span></span><span>
</span><span id="line-858"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_ForceRecomp"><span class="hs-identifier hs-var">Opt_ForceRecomp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#ms_hspp_opts"><span class="hs-identifier hs-var hs-var">ms_hspp_opts</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681204032"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-859"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681204029"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621681204029"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; Maybe UTCTime
</span><a href="GHC.Driver.Types.html#ms_obj_date"><span class="hs-identifier hs-var hs-var">ms_obj_date</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681204032"><span class="hs-identifier hs-var">ms</span></a></span><span>  </span><span class="hs-glyph">=</span><span>  </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621681204029"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime -&gt; UTCTime -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; UTCTime
</span><a href="GHC.Driver.Types.html#ms_hs_date"><span class="hs-identifier hs-var hs-var">ms_hs_date</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681204032"><span class="hs-identifier hs-var">ms</span></a></span><span>
</span><span id="line-860"></span><span>                                         </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">UTCTime -&gt; Bool
</span><a href="#local-6989586621681204027"><span class="hs-identifier hs-var">same_as_prev</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621681204029"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-861"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-862"></span><span>          </span><span class="hs-keyword">where</span><span>
</span><span id="line-863"></span><span>             </span><span id="local-6989586621681204027"><span class="annot"><span class="annottext">same_as_prev :: UTCTime -&gt; Bool
</span><a href="#local-6989586621681204027"><span class="hs-identifier hs-var hs-var">same_as_prev</span></a></span></span><span> </span><span id="local-6989586621681204025"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621681204025"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HomePackageTable -&gt; ModuleName -&gt; Maybe HomeModInfo
</span><a href="GHC.Driver.Types.html#lookupHpt"><span class="hs-identifier hs-var">lookupHpt</span></a></span><span> </span><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621681204072"><span class="hs-identifier hs-var">hpt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; ModuleName
</span><a href="GHC.Driver.Types.html#ms_mod_name"><span class="hs-identifier hs-var">ms_mod_name</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681204032"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-864"></span><span>                                </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681204024"><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621681204024"><span class="hs-identifier hs-var">hmi</span></a></span></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681204023"><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621681204023"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HomeModInfo -&gt; Maybe Linkable
</span><a href="GHC.Driver.Types.html#hm_linkable"><span class="hs-identifier hs-var hs-var">hm_linkable</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621681204024"><span class="hs-identifier hs-var">hmi</span></a></span><span>
</span><span id="line-865"></span><span>                                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Linkable -&gt; Bool
</span><a href="GHC.Driver.Types.html#isObjectLinkable"><span class="hs-identifier hs-var">isObjectLinkable</span></a></span><span> </span><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621681204023"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621681204025"><span class="hs-identifier hs-var">t</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime -&gt; UTCTime -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Linkable -&gt; UTCTime
</span><a href="GHC.Runtime.Linker.Types.html#linkableTime"><span class="hs-identifier hs-var hs-var">linkableTime</span></a></span><span> </span><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621681204023"><span class="hs-identifier hs-var">l</span></a></span><span>
</span><span id="line-866"></span><span>                                </span><span id="local-6989586621681204021"><span class="annot"><span class="annottext">Maybe HomeModInfo
</span><a href="#local-6989586621681204021"><span class="hs-identifier hs-var">_other</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-867"></span><span>                </span><span class="hs-comment">-- why '&gt;=' rather than '&gt;' above?  If the filesystem stores</span><span>
</span><span id="line-868"></span><span>                </span><span class="hs-comment">-- times to the nearest second, we may occasionally find that</span><span>
</span><span id="line-869"></span><span>                </span><span class="hs-comment">-- the object &amp; source have the same modification time,</span><span>
</span><span id="line-870"></span><span>                </span><span class="hs-comment">-- especially if the source was automatically generated</span><span>
</span><span id="line-871"></span><span>                </span><span class="hs-comment">-- and compiled.  Using &gt;= is slightly unsafe, but it matches</span><span>
</span><span id="line-872"></span><span>                </span><span class="hs-comment">-- make's behaviour.</span><span>
</span><span id="line-873"></span><span>                </span><span class="hs-comment">--</span><span>
</span><span id="line-874"></span><span>                </span><span class="hs-comment">-- But see #5527, where someone ran into this and it caused</span><span>
</span><span id="line-875"></span><span>                </span><span class="hs-comment">-- a problem.</span><span>
</span><span id="line-876"></span><span>
</span><span id="line-877"></span><span>        </span><span id="local-6989586621681204034"><span class="annot"><span class="annottext">bco_ok :: ModSummary -&gt; Bool
</span><a href="#local-6989586621681204034"><span class="hs-identifier hs-var hs-var">bco_ok</span></a></span></span><span> </span><span id="local-6989586621681204019"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681204019"><span class="hs-identifier hs-var">ms</span></a></span></span><span>
</span><span id="line-878"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_ForceRecomp"><span class="hs-identifier hs-var">Opt_ForceRecomp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#ms_hspp_opts"><span class="hs-identifier hs-var hs-var">ms_hspp_opts</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681204019"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-879"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">HomePackageTable -&gt; ModuleName -&gt; Maybe HomeModInfo
</span><a href="GHC.Driver.Types.html#lookupHpt"><span class="hs-identifier hs-var">lookupHpt</span></a></span><span> </span><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621681204072"><span class="hs-identifier hs-var">hpt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; ModuleName
</span><a href="GHC.Driver.Types.html#ms_mod_name"><span class="hs-identifier hs-var">ms_mod_name</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681204019"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-880"></span><span>                </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681204018"><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621681204018"><span class="hs-identifier hs-var">hmi</span></a></span></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681204017"><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621681204017"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HomeModInfo -&gt; Maybe Linkable
</span><a href="GHC.Driver.Types.html#hm_linkable"><span class="hs-identifier hs-var hs-var">hm_linkable</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621681204018"><span class="hs-identifier hs-var">hmi</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-881"></span><span>                        </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Linkable -&gt; Bool
</span><a href="GHC.Driver.Types.html#isObjectLinkable"><span class="hs-identifier hs-var">isObjectLinkable</span></a></span><span> </span><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621681204017"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-882"></span><span>                        </span><span class="annot"><span class="annottext">Linkable -&gt; UTCTime
</span><a href="GHC.Runtime.Linker.Types.html#linkableTime"><span class="hs-identifier hs-var hs-var">linkableTime</span></a></span><span> </span><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621681204017"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime -&gt; UTCTime -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; UTCTime
</span><a href="GHC.Driver.Types.html#ms_hs_date"><span class="hs-identifier hs-var hs-var">ms_hs_date</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681204019"><span class="hs-identifier hs-var">ms</span></a></span><span>
</span><span id="line-883"></span><span>                </span><span id="local-6989586621681204016"><span class="annot"><span class="annottext">Maybe HomeModInfo
</span><a href="#local-6989586621681204016"><span class="hs-identifier hs-var">_other</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-884"></span><span>
</span><span id="line-885"></span><span class="hs-comment">{- Parallel Upsweep
 -
 - The parallel upsweep attempts to concurrently compile the modules in the
 - compilation graph using multiple Haskell threads.
 -
 - The Algorithm
 -
 - A Haskell thread is spawned for each module in the module graph, waiting for
 - its direct dependencies to finish building before it itself begins to build.
 -
 - Each module is associated with an initially empty MVar that stores the
 - result of that particular module's compile. If the compile succeeded, then
 - the HscEnv (synchronized by an MVar) is updated with the fresh HMI of that
 - module, and the module's HMI is deleted from the old HPT (synchronized by an
 - IORef) to save space.
 -
 - Instead of immediately outputting messages to the standard handles, all
 - compilation output is deferred to a per-module TQueue. A QSem is used to
 - limit the number of workers that are compiling simultaneously.
 -
 - Meanwhile, the main thread sequentially loops over all the modules in the
 - module graph, outputting the messages stored in each module's TQueue.
-}</span><span>
</span><span id="line-908"></span><span>
</span><span id="line-909"></span><span class="hs-comment">-- | Each module is given a unique 'LogQueue' to redirect compilation messages</span><span>
</span><span id="line-910"></span><span class="hs-comment">-- to. A 'Nothing' value contains the result of compilation, and denotes the</span><span>
</span><span id="line-911"></span><span class="hs-comment">-- end of the message queue.</span><span>
</span><span id="line-912"></span><span class="hs-keyword">data</span><span> </span><span id="LogQueue"><span class="annot"><a href="GHC.Driver.Make.html#LogQueue"><span class="hs-identifier hs-var">LogQueue</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="LogQueue"><span class="annot"><a href="GHC.Driver.Make.html#LogQueue"><span class="hs-identifier hs-var">LogQueue</span></a></span></span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/GHC.IORef.html#IORef"><span class="hs-identifier hs-type">IORef</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Flags.html#WarnReason"><span class="hs-identifier hs-type">WarnReason</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#Severity"><span class="hs-identifier hs-type">Severity</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#MsgDoc"><span class="hs-identifier hs-type">MsgDoc</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-913"></span><span>                         </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/GHC.MVar.html#MVar"><span class="hs-identifier hs-type">MVar</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-914"></span><span>
</span><span id="line-915"></span><span class="hs-comment">-- | The graph of modules to compile and their corresponding result 'MVar' and</span><span>
</span><span id="line-916"></span><span class="hs-comment">-- 'LogQueue'.</span><span>
</span><span id="line-917"></span><span class="hs-keyword">type</span><span> </span><span id="CompilationGraph"><span class="annot"><a href="GHC.Driver.Make.html#CompilationGraph"><span class="hs-identifier hs-var">CompilationGraph</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base/src/GHC.MVar.html#MVar"><span class="hs-identifier hs-type">MVar</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#SuccessFlag"><span class="hs-identifier hs-type">SuccessFlag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#LogQueue"><span class="hs-identifier hs-type">LogQueue</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-918"></span><span>
</span><span id="line-919"></span><span class="hs-comment">-- | Build a 'CompilationGraph' out of a list of strongly-connected modules,</span><span>
</span><span id="line-920"></span><span class="hs-comment">-- also returning the first, if any, encountered module cycle.</span><span>
</span><span id="line-921"></span><span class="annot"><a href="GHC.Driver.Make.html#buildCompGraph"><span class="hs-identifier hs-type">buildCompGraph</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../containers/src/Data.Graph.html#SCC"><span class="hs-identifier hs-type">SCC</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Make.html#CompilationGraph"><span class="hs-identifier hs-type">CompilationGraph</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-922"></span><span id="buildCompGraph"><span class="annot"><span class="annottext">buildCompGraph :: [SCC ModSummary] -&gt; IO (CompilationGraph, Maybe [ModSummary])
</span><a href="GHC.Driver.Make.html#buildCompGraph"><span class="hs-identifier hs-var hs-var">buildCompGraph</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(CompilationGraph, Maybe [ModSummary])
-&gt; IO (CompilationGraph, Maybe [ModSummary])
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe [ModSummary]
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-923"></span><span class="annot"><a href="GHC.Driver.Make.html#buildCompGraph"><span class="hs-identifier hs-var">buildCompGraph</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681204012"><span class="annot"><span class="annottext">SCC ModSummary
</span><a href="#local-6989586621681204012"><span class="hs-identifier hs-var">scc</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681204011"><span class="annot"><span class="annottext">[SCC ModSummary]
</span><a href="#local-6989586621681204011"><span class="hs-identifier hs-var">sccs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">SCC ModSummary
</span><a href="#local-6989586621681204012"><span class="hs-identifier hs-var">scc</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-924"></span><span>    </span><span class="annot"><a href="../../containers/src/Data.Graph.html#AcyclicSCC"><span class="hs-identifier hs-type">AcyclicSCC</span></a></span><span> </span><span id="local-6989586621681204010"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681204010"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-925"></span><span>        </span><span id="local-6989586621681204009"><span class="annot"><span class="annottext">MVar SuccessFlag
</span><a href="#local-6989586621681204009"><span class="hs-identifier hs-var">mvar</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (MVar SuccessFlag)
forall a. IO (MVar a)
</span><a href="../../base/src/GHC.MVar.html#newEmptyMVar"><span class="hs-identifier hs-var">newEmptyMVar</span></a></span><span>
</span><span id="line-926"></span><span>        </span><span id="local-6989586621681204007"><span class="annot"><span class="annottext">LogQueue
</span><a href="#local-6989586621681204007"><span class="hs-identifier hs-var">log_queue</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-927"></span><span>            </span><span id="local-6989586621681204006"><span class="annot"><span class="annottext">IORef [Maybe (WarnReason, Severity, SrcSpan, SDoc)]
</span><a href="#local-6989586621681204006"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Maybe (WarnReason, Severity, SrcSpan, SDoc)]
-&gt; IO (IORef [Maybe (WarnReason, Severity, SrcSpan, SDoc)])
forall a. a -&gt; IO (IORef a)
</span><a href="../../base/src/GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-928"></span><span>            </span><span id="local-6989586621681204004"><span class="annot"><span class="annottext">MVar ()
</span><a href="#local-6989586621681204004"><span class="hs-identifier hs-var">sem</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (MVar ())
forall a. IO (MVar a)
</span><a href="../../base/src/GHC.MVar.html#newEmptyMVar"><span class="hs-identifier hs-var">newEmptyMVar</span></a></span><span>
</span><span id="line-929"></span><span>            </span><span class="annot"><span class="annottext">LogQueue -&gt; IO LogQueue
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IORef [Maybe (WarnReason, Severity, SrcSpan, SDoc)]
-&gt; MVar () -&gt; LogQueue
</span><a href="GHC.Driver.Make.html#LogQueue"><span class="hs-identifier hs-var">LogQueue</span></a></span><span> </span><span class="annot"><span class="annottext">IORef [Maybe (WarnReason, Severity, SrcSpan, SDoc)]
</span><a href="#local-6989586621681204006"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">MVar ()
</span><a href="#local-6989586621681204004"><span class="hs-identifier hs-var">sem</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-930"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621681204003"><span class="annot"><span class="annottext">CompilationGraph
</span><a href="#local-6989586621681204003"><span class="hs-identifier hs-var">rest</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681204002"><span class="annot"><span class="annottext">Maybe [ModSummary]
</span><a href="#local-6989586621681204002"><span class="hs-identifier hs-var">cycle</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[SCC ModSummary] -&gt; IO (CompilationGraph, Maybe [ModSummary])
</span><a href="GHC.Driver.Make.html#buildCompGraph"><span class="hs-identifier hs-var">buildCompGraph</span></a></span><span> </span><span class="annot"><span class="annottext">[SCC ModSummary]
</span><a href="#local-6989586621681204011"><span class="hs-identifier hs-var">sccs</span></a></span><span>
</span><span id="line-931"></span><span>        </span><span class="annot"><span class="annottext">(CompilationGraph, Maybe [ModSummary])
-&gt; IO (CompilationGraph, Maybe [ModSummary])
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681204010"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">MVar SuccessFlag
</span><a href="#local-6989586621681204009"><span class="hs-identifier hs-var">mvar</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">LogQueue
</span><a href="#local-6989586621681204007"><span class="hs-identifier hs-var">log_queue</span></a></span><span class="hs-special">)</span><span class="annot"><span class="annottext">(ModSummary, MVar SuccessFlag, LogQueue)
-&gt; CompilationGraph -&gt; CompilationGraph
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">CompilationGraph
</span><a href="#local-6989586621681204003"><span class="hs-identifier hs-var">rest</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe [ModSummary]
</span><a href="#local-6989586621681204002"><span class="hs-identifier hs-var">cycle</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-932"></span><span>    </span><span class="annot"><a href="../../containers/src/Data.Graph.html#CyclicSCC"><span class="hs-identifier hs-type">CyclicSCC</span></a></span><span> </span><span id="local-6989586621681204001"><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681204001"><span class="hs-identifier hs-var">mss</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(CompilationGraph, Maybe [ModSummary])
-&gt; IO (CompilationGraph, Maybe [ModSummary])
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ModSummary] -&gt; Maybe [ModSummary]
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681204001"><span class="hs-identifier hs-var">mss</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-933"></span><span>
</span><span id="line-934"></span><span class="hs-comment">-- | A Module and whether it is a boot module.</span><span>
</span><span id="line-935"></span><span class="hs-comment">--</span><span>
</span><span id="line-936"></span><span class="hs-comment">-- We need to treat boot modules specially when building compilation graphs,</span><span>
</span><span id="line-937"></span><span class="hs-comment">-- since they break cycles. Regular source files and signature files are treated</span><span>
</span><span id="line-938"></span><span class="hs-comment">-- equivalently.</span><span>
</span><span id="line-939"></span><span class="hs-keyword">type</span><span> </span><span id="BuildModule"><span class="annot"><a href="GHC.Driver.Make.html#BuildModule"><span class="hs-identifier hs-var">BuildModule</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#ModuleWithIsBoot"><span class="hs-identifier hs-type">ModuleWithIsBoot</span></a></span><span>
</span><span id="line-940"></span><span>
</span><span id="line-941"></span><span class="hs-comment">-- | Tests if an 'HscSource' is a boot file, primarily for constructing elements</span><span>
</span><span id="line-942"></span><span class="hs-comment">-- of 'BuildModule'. We conflate signatures and modules because they are bound</span><span>
</span><span id="line-943"></span><span class="hs-comment">-- in the same namespace; only boot interfaces can be disambiguated with</span><span>
</span><span id="line-944"></span><span class="hs-comment">-- `import {-# SOURCE #-}`.</span><span>
</span><span id="line-945"></span><span class="annot"><a href="GHC.Driver.Make.html#hscSourceToIsBoot"><span class="hs-identifier hs-type">hscSourceToIsBoot</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Phases.html#HscSource"><span class="hs-identifier hs-type">HscSource</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#IsBootInterface"><span class="hs-identifier hs-type">IsBootInterface</span></a></span><span>
</span><span id="line-946"></span><span id="hscSourceToIsBoot"><span class="annot"><span class="annottext">hscSourceToIsBoot :: HscSource -&gt; IsBootInterface
</span><a href="GHC.Driver.Make.html#hscSourceToIsBoot"><span class="hs-identifier hs-var hs-var">hscSourceToIsBoot</span></a></span></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="GHC.Driver.Phases.html#HsBootFile"><span class="hs-identifier hs-var">HsBootFile</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="GHC.Unit.Types.html#IsBoot"><span class="hs-identifier hs-var">IsBoot</span></a></span><span>
</span><span id="line-947"></span><span class="annot"><a href="GHC.Driver.Make.html#hscSourceToIsBoot"><span class="hs-identifier hs-var">hscSourceToIsBoot</span></a></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="GHC.Unit.Types.html#NotBoot"><span class="hs-identifier hs-var">NotBoot</span></a></span><span>
</span><span id="line-948"></span><span>
</span><span id="line-949"></span><span class="annot"><a href="GHC.Driver.Make.html#mkBuildModule"><span class="hs-identifier hs-type">mkBuildModule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#BuildModule"><span class="hs-identifier hs-type">BuildModule</span></a></span><span>
</span><span id="line-950"></span><span id="mkBuildModule"><span class="annot"><span class="annottext">mkBuildModule :: ModSummary -&gt; BuildModule
</span><a href="GHC.Driver.Make.html#mkBuildModule"><span class="hs-identifier hs-var hs-var">mkBuildModule</span></a></span></span><span> </span><span id="local-6989586621681203996"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203996"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GWIB :: forall mod. mod -&gt; IsBootInterface -&gt; GenWithIsBoot mod
</span><a href="GHC.Unit.Types.html#GWIB"><span class="hs-identifier hs-type">GWIB</span></a></span><span>
</span><span id="line-951"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">gwib_mod :: Module
</span><a href="GHC.Unit.Types.html#gwib_mod"><span class="hs-identifier hs-var">gwib_mod</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; Module
</span><a href="GHC.Driver.Types.html#ms_mod"><span class="hs-identifier hs-var hs-var">ms_mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203996"><span class="hs-identifier hs-var">ms</span></a></span><span>
</span><span id="line-952"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">gwib_isBoot :: IsBootInterface
</span><a href="GHC.Unit.Types.html#gwib_isBoot"><span class="hs-identifier hs-var">gwib_isBoot</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; IsBootInterface
</span><a href="GHC.Driver.Types.html#isBootSummary"><span class="hs-identifier hs-var">isBootSummary</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203996"><span class="hs-identifier hs-var">ms</span></a></span><span>
</span><span id="line-953"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-954"></span><span>
</span><span id="line-955"></span><span class="annot"><a href="GHC.Driver.Make.html#mkHomeBuildModule"><span class="hs-identifier hs-type">mkHomeBuildModule</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#ModuleNameWithIsBoot"><span class="hs-identifier hs-type">ModuleNameWithIsBoot</span></a></span><span>
</span><span id="line-956"></span><span id="mkHomeBuildModule"><span class="annot"><span class="annottext">mkHomeBuildModule :: ModSummary -&gt; NodeKey
</span><a href="GHC.Driver.Make.html#mkHomeBuildModule"><span class="hs-identifier hs-var hs-var">mkHomeBuildModule</span></a></span></span><span> </span><span id="local-6989586621681203990"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203990"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GWIB :: forall mod. mod -&gt; IsBootInterface -&gt; GenWithIsBoot mod
</span><a href="GHC.Unit.Types.html#GWIB"><span class="hs-identifier hs-type">GWIB</span></a></span><span>
</span><span id="line-957"></span><span>  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">gwib_mod :: ModuleName
</span><a href="GHC.Unit.Types.html#gwib_mod"><span class="hs-identifier hs-var">gwib_mod</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">(Module -&gt; ModuleName) -&gt; Module -&gt; ModuleName
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; Module
</span><a href="GHC.Driver.Types.html#ms_mod"><span class="hs-identifier hs-var hs-var">ms_mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203990"><span class="hs-identifier hs-var">ms</span></a></span><span>
</span><span id="line-958"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">gwib_isBoot :: IsBootInterface
</span><a href="GHC.Unit.Types.html#gwib_isBoot"><span class="hs-identifier hs-var">gwib_isBoot</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; IsBootInterface
</span><a href="GHC.Driver.Types.html#isBootSummary"><span class="hs-identifier hs-var">isBootSummary</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203990"><span class="hs-identifier hs-var">ms</span></a></span><span>
</span><span id="line-959"></span><span>  </span><span class="hs-special">}</span><span>
</span><span id="line-960"></span><span>
</span><span id="line-961"></span><span class="hs-comment">-- | The entry point to the parallel upsweep.</span><span>
</span><span id="line-962"></span><span class="hs-comment">--</span><span>
</span><span id="line-963"></span><span class="hs-comment">-- See also the simpler, sequential 'upsweep'.</span><span>
</span><span id="line-964"></span><span id="local-6989586621681205190"><span class="annot"><a href="GHC.Driver.Make.html#parUpsweep"><span class="hs-identifier hs-type">parUpsweep</span></a></span><span>
</span><span id="line-965"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Monad.html#GhcMonad"><span class="hs-identifier hs-type">GhcMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681205190"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-966"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-967"></span><span>    </span><span class="hs-comment">-- ^ The number of workers we wish to run in parallel</span><span>
</span><span id="line-968"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#Messager"><span class="hs-identifier hs-type">Messager</span></a></span><span>
</span><span id="line-969"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HomePackageTable"><span class="hs-identifier hs-type">HomePackageTable</span></a></span><span>
</span><span id="line-970"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#StableModules"><span class="hs-identifier hs-type">StableModules</span></a></span><span>
</span><span id="line-971"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-972"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../containers/src/Data.Graph.html#SCC"><span class="hs-identifier hs-type">SCC</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-973"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681205190"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Basic.html#SuccessFlag"><span class="hs-identifier hs-type">SuccessFlag</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-974"></span><span>          </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span></span><span>
</span><span id="line-975"></span><span id="parUpsweep"><span class="annot"><span class="annottext">parUpsweep :: forall (m :: * -&gt; *).
GhcMonad m =&gt;
Int
-&gt; Maybe Messager
-&gt; HomePackageTable
-&gt; (UniqSet ModuleName, UniqSet ModuleName)
-&gt; (HscEnv -&gt; IO ())
-&gt; [SCC ModSummary]
-&gt; m (SuccessFlag, [ModSummary])
</span><a href="GHC.Driver.Make.html#parUpsweep"><span class="hs-identifier hs-var hs-var">parUpsweep</span></a></span></span><span> </span><span id="local-6989586621681203944"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681203944"><span class="hs-identifier hs-var">n_jobs</span></a></span></span><span> </span><span id="local-6989586621681203943"><span class="annot"><span class="annottext">Maybe Messager
</span><a href="#local-6989586621681203943"><span class="hs-identifier hs-var">mHscMessage</span></a></span></span><span> </span><span id="local-6989586621681203942"><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621681203942"><span class="hs-identifier hs-var">old_hpt</span></a></span></span><span> </span><span id="local-6989586621681203941"><span class="annot"><span class="annottext">(UniqSet ModuleName, UniqSet ModuleName)
</span><a href="#local-6989586621681203941"><span class="hs-identifier hs-var">stable_mods</span></a></span></span><span> </span><span id="local-6989586621681203940"><span class="annot"><span class="annottext">HscEnv -&gt; IO ()
</span><a href="#local-6989586621681203940"><span class="hs-identifier hs-var">cleanup</span></a></span></span><span> </span><span id="local-6989586621681203939"><span class="annot"><span class="annottext">[SCC ModSummary]
</span><a href="#local-6989586621681203939"><span class="hs-identifier hs-var">sccs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-976"></span><span>    </span><span id="local-6989586621681203938"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203938"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m HscEnv
forall (m :: * -&gt; *). GhcMonad m =&gt; m HscEnv
</span><a href="GHC.Driver.Monad.html#getSession"><span class="hs-identifier hs-var">getSession</span></a></span><span>
</span><span id="line-977"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681203937"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621681203937"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203938"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-978"></span><span>
</span><span id="line-979"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[GenUnit UnitId] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; [GenUnit UnitId]
</span><a href="GHC.Driver.Make.html#instantiatedUnitsToCheck"><span class="hs-identifier hs-var">instantiatedUnitsToCheck</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203937"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-980"></span><span>      </span><span class="annot"><span class="annottext">GhcException -&gt; m ()
forall a. GhcException -&gt; a
</span><a href="GHC.Utils.Panic.html#throwGhcException"><span class="hs-identifier hs-var">throwGhcException</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; GhcException
</span><a href="GHC.Utils.Panic.html#ProgramError"><span class="hs-identifier hs-var">ProgramError</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;Backpack typechecking not supported with -j&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-981"></span><span>
</span><span id="line-982"></span><span>    </span><span class="hs-comment">-- The bits of shared state we'll be using:</span><span>
</span><span id="line-983"></span><span>
</span><span id="line-984"></span><span>    </span><span class="hs-comment">-- The global HscEnv is updated with the module's HMI when a module</span><span>
</span><span id="line-985"></span><span>    </span><span class="hs-comment">-- successfully compiles.</span><span>
</span><span id="line-986"></span><span>    </span><span id="local-6989586621681203934"><span class="annot"><span class="annottext">MVar HscEnv
</span><a href="#local-6989586621681203934"><span class="hs-identifier hs-var">hsc_env_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (MVar HscEnv) -&gt; m (MVar HscEnv)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (MVar HscEnv) -&gt; m (MVar HscEnv))
-&gt; IO (MVar HscEnv) -&gt; m (MVar HscEnv)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; IO (MVar HscEnv)
forall a. a -&gt; IO (MVar a)
</span><a href="../../base/src/GHC.MVar.html#newMVar"><span class="hs-identifier hs-var">newMVar</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203938"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-987"></span><span>
</span><span id="line-988"></span><span>    </span><span class="hs-comment">-- The old HPT is used for recompilation checking in upsweep_mod. When a</span><span>
</span><span id="line-989"></span><span>    </span><span class="hs-comment">-- module successfully gets compiled, its HMI is pruned from the old HPT.</span><span>
</span><span id="line-990"></span><span>    </span><span id="local-6989586621681203932"><span class="annot"><span class="annottext">IORef HomePackageTable
</span><a href="#local-6989586621681203932"><span class="hs-identifier hs-var">old_hpt_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (IORef HomePackageTable) -&gt; m (IORef HomePackageTable)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (IORef HomePackageTable) -&gt; m (IORef HomePackageTable))
-&gt; IO (IORef HomePackageTable) -&gt; m (IORef HomePackageTable)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HomePackageTable -&gt; IO (IORef HomePackageTable)
forall a. a -&gt; IO (IORef a)
</span><a href="../../base/src/GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a></span><span> </span><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621681203942"><span class="hs-identifier hs-var">old_hpt</span></a></span><span>
</span><span id="line-991"></span><span>
</span><span id="line-992"></span><span>    </span><span class="hs-comment">-- What we use to limit parallelism with.</span><span>
</span><span id="line-993"></span><span>    </span><span id="local-6989586621681203931"><span class="annot"><span class="annottext">QSem
</span><a href="#local-6989586621681203931"><span class="hs-identifier hs-var">par_sem</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO QSem -&gt; m QSem
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO QSem -&gt; m QSem) -&gt; IO QSem -&gt; m QSem
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; IO QSem
</span><a href="../../base/src/Control.Concurrent.QSem.html#newQSem"><span class="hs-identifier hs-var">newQSem</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681203944"><span class="hs-identifier hs-var">n_jobs</span></a></span><span>
</span><span id="line-994"></span><span>
</span><span id="line-995"></span><span>
</span><span id="line-996"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681203920"><span class="annot"><span class="annottext">updNumCapabilities :: m Int
</span><a href="#local-6989586621681203920"><span class="hs-identifier hs-var hs-var">updNumCapabilities</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO Int -&gt; m Int
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO Int -&gt; m Int) -&gt; IO Int -&gt; m Int
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-997"></span><span>            </span><span id="local-6989586621681203919"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681203919"><span class="hs-identifier hs-var">n_capabilities</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Int
</span><a href="../../base/src/GHC.Conc.Sync.html#getNumCapabilities"><span class="hs-identifier hs-var">getNumCapabilities</span></a></span><span>
</span><span id="line-998"></span><span>            </span><span id="local-6989586621681203918"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681203918"><span class="hs-identifier hs-var">n_cpus</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Int
</span><a href="../../base/src/GHC.Conc.Sync.html#getNumProcessors"><span class="hs-identifier hs-var">getNumProcessors</span></a></span><span>
</span><span id="line-999"></span><span>            </span><span class="hs-comment">-- Setting number of capabilities more than</span><span>
</span><span id="line-1000"></span><span>            </span><span class="hs-comment">-- CPU count usually leads to high userspace</span><span>
</span><span id="line-1001"></span><span>            </span><span class="hs-comment">-- lock contention. #9221</span><span>
</span><span id="line-1002"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681203916"><span class="annot"><span class="annottext">n_caps :: Int
</span><a href="#local-6989586621681203916"><span class="hs-identifier hs-var hs-var">n_caps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Ord a =&gt; a -&gt; a -&gt; a
</span><span class="hs-identifier hs-var">min</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681203944"><span class="hs-identifier hs-var">n_jobs</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681203918"><span class="hs-identifier hs-var">n_cpus</span></a></span><span>
</span><span id="line-1003"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base/src/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681203919"><span class="hs-identifier hs-var">n_capabilities</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; IO ()
</span><a href="../../base/src/GHC.Conc.Sync.html#setNumCapabilities"><span class="hs-identifier hs-var">setNumCapabilities</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681203916"><span class="hs-identifier hs-var">n_caps</span></a></span><span>
</span><span id="line-1004"></span><span>            </span><span class="annot"><span class="annottext">Int -&gt; IO Int
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681203919"><span class="hs-identifier hs-var">n_capabilities</span></a></span><span>
</span><span id="line-1005"></span><span>    </span><span class="hs-comment">-- Reset the number of capabilities once the upsweep ends.</span><span>
</span><span id="line-1006"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681203910"><span class="annot"><span class="annottext">resetNumCapabilities :: Int -&gt; m ()
</span><a href="#local-6989586621681203910"><span class="hs-identifier hs-var hs-var">resetNumCapabilities</span></a></span></span><span> </span><span id="local-6989586621681203909"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681203909"><span class="hs-identifier hs-var">orig_n</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; IO ()
</span><a href="../../base/src/GHC.Conc.Sync.html#setNumCapabilities"><span class="hs-identifier hs-var">setNumCapabilities</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681203909"><span class="hs-identifier hs-var">orig_n</span></a></span><span>
</span><span id="line-1007"></span><span>
</span><span id="line-1008"></span><span>    </span><span class="annot"><span class="annottext">m Int
-&gt; (Int -&gt; m ())
-&gt; (Int -&gt; m (SuccessFlag, [ModSummary]))
-&gt; m (SuccessFlag, [ModSummary])
forall (m :: * -&gt; *) a c b.
MonadMask m =&gt;
m a -&gt; (a -&gt; m c) -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../exceptions/src/Control.Monad.Catch.html#bracket"><span class="hs-identifier hs-var">MC.bracket</span></a></span><span> </span><span class="annot"><span class="annottext">m Int
</span><a href="#local-6989586621681203920"><span class="hs-identifier hs-var">updNumCapabilities</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; m ()
forall {m :: * -&gt; *}. MonadIO m =&gt; Int -&gt; m ()
</span><a href="#local-6989586621681203910"><span class="hs-identifier hs-var">resetNumCapabilities</span></a></span><span> </span><span class="annot"><span class="annottext">((Int -&gt; m (SuccessFlag, [ModSummary]))
 -&gt; m (SuccessFlag, [ModSummary]))
-&gt; (Int -&gt; m (SuccessFlag, [ModSummary]))
-&gt; m (SuccessFlag, [ModSummary])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1009"></span><span>
</span><span id="line-1010"></span><span>    </span><span class="hs-comment">-- Sync the global session with the latest HscEnv once the upsweep ends.</span><span>
</span><span id="line-1011"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681203896"><span class="annot"><span class="annottext">finallySyncSession :: m a -&gt; m a
</span><a href="#local-6989586621681203896"><span class="hs-identifier hs-var hs-var">finallySyncSession</span></a></span></span><span> </span><span id="local-6989586621681203895"><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621681203895"><span class="hs-identifier hs-var">io</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621681203895"><span class="hs-identifier hs-var">io</span></a></span><span> </span><span class="annot"><span class="annottext">m a -&gt; m () -&gt; m a
forall (m :: * -&gt; *) a b. MonadMask m =&gt; m a -&gt; m b -&gt; m a
</span><a href="../../exceptions/src/Control.Monad.Catch.html#finally"><span class="hs-operator hs-var">`MC.finally`</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1012"></span><span>            </span><span id="local-6989586621681203893"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203893"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO HscEnv -&gt; m HscEnv
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO HscEnv -&gt; m HscEnv) -&gt; IO HscEnv -&gt; m HscEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">MVar HscEnv -&gt; IO HscEnv
forall a. MVar a -&gt; IO a
</span><a href="../../base/src/GHC.MVar.html#readMVar"><span class="hs-identifier hs-var">readMVar</span></a></span><span> </span><span class="annot"><span class="annottext">MVar HscEnv
</span><a href="#local-6989586621681203934"><span class="hs-identifier hs-var">hsc_env_var</span></a></span><span>
</span><span id="line-1013"></span><span>            </span><span class="annot"><span class="annottext">HscEnv -&gt; m ()
forall (m :: * -&gt; *). GhcMonad m =&gt; HscEnv -&gt; m ()
</span><a href="GHC.Driver.Monad.html#setSession"><span class="hs-identifier hs-var">setSession</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203893"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-1014"></span><span>
</span><span id="line-1015"></span><span>    </span><span class="annot"><span class="annottext">m (SuccessFlag, [ModSummary]) -&gt; m (SuccessFlag, [ModSummary])
forall (m :: * -&gt; *) a. GhcMonad m =&gt; m a -&gt; m a
</span><a href="#local-6989586621681203896"><span class="hs-identifier hs-var">finallySyncSession</span></a></span><span> </span><span class="annot"><span class="annottext">(m (SuccessFlag, [ModSummary]) -&gt; m (SuccessFlag, [ModSummary]))
-&gt; m (SuccessFlag, [ModSummary]) -&gt; m (SuccessFlag, [ModSummary])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1016"></span><span>
</span><span id="line-1017"></span><span>    </span><span class="hs-comment">-- Build the compilation graph out of the list of SCCs. Module cycles are</span><span>
</span><span id="line-1018"></span><span>    </span><span class="hs-comment">-- handled at the very end, after some useful work gets done. Note that</span><span>
</span><span id="line-1019"></span><span>    </span><span class="hs-comment">-- this list is topologically sorted (by virtue of 'sccs' being sorted so).</span><span>
</span><span id="line-1020"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681203891"><span class="annot"><span class="annottext">CompilationGraph
</span><a href="#local-6989586621681203891"><span class="hs-identifier hs-var">comp_graph</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681203890"><span class="annot"><span class="annottext">Maybe [ModSummary]
</span><a href="#local-6989586621681203890"><span class="hs-identifier hs-var">cycle</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (CompilationGraph, Maybe [ModSummary])
-&gt; m (CompilationGraph, Maybe [ModSummary])
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (CompilationGraph, Maybe [ModSummary])
 -&gt; m (CompilationGraph, Maybe [ModSummary]))
-&gt; IO (CompilationGraph, Maybe [ModSummary])
-&gt; m (CompilationGraph, Maybe [ModSummary])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[SCC ModSummary] -&gt; IO (CompilationGraph, Maybe [ModSummary])
</span><a href="GHC.Driver.Make.html#buildCompGraph"><span class="hs-identifier hs-var">buildCompGraph</span></a></span><span> </span><span class="annot"><span class="annottext">[SCC ModSummary]
</span><a href="#local-6989586621681203939"><span class="hs-identifier hs-var">sccs</span></a></span><span>
</span><span id="line-1021"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681203886"><span class="annot"><span class="annottext">comp_graph_w_idx :: [((ModSummary, MVar SuccessFlag, LogQueue), Int)]
</span><a href="#local-6989586621681203886"><span class="hs-identifier hs-var hs-var">comp_graph_w_idx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">CompilationGraph
-&gt; [Int] -&gt; [((ModSummary, MVar SuccessFlag, LogQueue), Int)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../../base/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">CompilationGraph
</span><a href="#local-6989586621681203891"><span class="hs-identifier hs-var">comp_graph</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span>
</span><span id="line-1022"></span><span>
</span><span id="line-1023"></span><span>    </span><span class="hs-comment">-- The list of all loops in the compilation graph.</span><span>
</span><span id="line-1024"></span><span>    </span><span class="hs-comment">-- NB: For convenience, the last module of each loop (aka the module that</span><span>
</span><span id="line-1025"></span><span>    </span><span class="hs-comment">-- finishes the loop) is prepended to the beginning of the loop.</span><span>
</span><span id="line-1026"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681203885"><span class="annot"><span class="annottext">graph :: [ModSummary]
</span><a href="#local-6989586621681203885"><span class="hs-identifier hs-var hs-var">graph</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((ModSummary, MVar SuccessFlag, LogQueue) -&gt; ModSummary)
-&gt; CompilationGraph -&gt; [ModSummary]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">(ModSummary, MVar SuccessFlag, LogQueue) -&gt; ModSummary
forall a b c. (a, b, c) -&gt; a
</span><a href="GHC.Utils.Misc.html#fstOf3"><span class="hs-identifier hs-var">fstOf3</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">CompilationGraph -&gt; CompilationGraph
forall a. [a] -&gt; [a]
</span><a href="../../base/src/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="annot"><span class="annottext">CompilationGraph
</span><a href="#local-6989586621681203891"><span class="hs-identifier hs-var">comp_graph</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1027"></span><span>        </span><span id="local-6989586621681203882"><span class="annot"><span class="annottext">boot_modules :: ModuleSet
</span><a href="#local-6989586621681203882"><span class="hs-identifier hs-var hs-var">boot_modules</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Module] -&gt; ModuleSet
</span><a href="GHC.Unit.Module.Env.html#mkModuleSet"><span class="hs-identifier hs-var">mkModuleSet</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ModSummary -&gt; Module
</span><a href="GHC.Driver.Types.html#ms_mod"><span class="hs-identifier hs-var hs-var">ms_mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203880"><span class="hs-identifier hs-var">ms</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681203880"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203880"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681203885"><span class="hs-identifier hs-var">graph</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; IsBootInterface
</span><a href="GHC.Driver.Types.html#isBootSummary"><span class="hs-identifier hs-var">isBootSummary</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203880"><span class="hs-identifier hs-var">ms</span></a></span><span> </span><span class="annot"><span class="annottext">IsBootInterface -&gt; IsBootInterface -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="GHC.Unit.Types.html#IsBoot"><span class="hs-identifier hs-var">IsBoot</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1028"></span><span>        </span><span id="local-6989586621681203879"><span class="annot"><span class="annottext">comp_graph_loops :: [[BuildModule]]
</span><a href="#local-6989586621681203879"><span class="hs-identifier hs-var hs-var">comp_graph_loops</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ModSummary] -&gt; ModuleSet -&gt; [[BuildModule]]
</span><a href="#local-6989586621681203878"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681203885"><span class="hs-identifier hs-var">graph</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleSet
</span><a href="#local-6989586621681203882"><span class="hs-identifier hs-var">boot_modules</span></a></span><span>
</span><span id="line-1029"></span><span>          </span><span class="hs-keyword">where</span><span>
</span><span id="line-1030"></span><span>            </span><span id="local-6989586621681203877"><span class="annot"><span class="annottext">remove :: ModSummary -&gt; ModuleSet -&gt; ModuleSet
</span><a href="#local-6989586621681203877"><span class="hs-identifier hs-var hs-var">remove</span></a></span></span><span> </span><span id="local-6989586621681203876"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203876"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span id="local-6989586621681203875"><span class="annot"><span class="annottext">ModuleSet
</span><a href="#local-6989586621681203875"><span class="hs-identifier hs-var">bm</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; IsBootInterface
</span><a href="GHC.Driver.Types.html#isBootSummary"><span class="hs-identifier hs-var">isBootSummary</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203876"><span class="hs-identifier hs-var">ms</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1031"></span><span>              </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="GHC.Unit.Types.html#IsBoot"><span class="hs-identifier hs-var">IsBoot</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModuleSet -&gt; Module -&gt; ModuleSet
</span><a href="GHC.Unit.Module.Env.html#delModuleSet"><span class="hs-identifier hs-var">delModuleSet</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleSet
</span><a href="#local-6989586621681203875"><span class="hs-identifier hs-var">bm</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; Module
</span><a href="GHC.Driver.Types.html#ms_mod"><span class="hs-identifier hs-var hs-var">ms_mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203876"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1032"></span><span>              </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="GHC.Unit.Types.html#NotBoot"><span class="hs-identifier hs-var">NotBoot</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModuleSet
</span><a href="#local-6989586621681203875"><span class="hs-identifier hs-var">bm</span></a></span><span>
</span><span id="line-1033"></span><span>            </span><span id="local-6989586621681203878"><span class="annot"><span class="annottext">go :: [ModSummary] -&gt; ModuleSet -&gt; [[BuildModule]]
</span><a href="#local-6989586621681203878"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">ModuleSet
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1034"></span><span>            </span><span class="annot"><a href="#local-6989586621681203878"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span id="local-6989586621681203873"><span class="annot"><span class="annottext">mg :: [ModSummary]
</span><a href="#local-6989586621681203873"><span class="hs-identifier hs-var">mg</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621681203872"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203872"><span class="hs-identifier hs-var">ms</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681203871"><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681203871"><span class="hs-identifier hs-var">mss</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681203870"><span class="annot"><span class="annottext">ModuleSet
</span><a href="#local-6989586621681203870"><span class="hs-identifier hs-var">boot_modules</span></a></span></span><span>
</span><span id="line-1035"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681203869"><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681203869"><span class="hs-identifier hs-var">loop</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModSummary
-&gt; [ModSummary] -&gt; (Module -&gt; Bool) -&gt; Maybe [ModSummary]
</span><a href="GHC.Driver.Make.html#getModLoop"><span class="hs-identifier hs-var">getModLoop</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203872"><span class="hs-identifier hs-var">ms</span></a></span><span> </span><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681203873"><span class="hs-identifier hs-var">mg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; ModuleSet -&gt; Bool
</span><a href="GHC.Unit.Module.Env.html#elemModuleSet"><span class="hs-operator hs-var">`elemModuleSet`</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleSet
</span><a href="#local-6989586621681203870"><span class="hs-identifier hs-var">boot_modules</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1036"></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ModSummary -&gt; BuildModule) -&gt; [ModSummary] -&gt; [BuildModule]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; BuildModule
</span><a href="GHC.Driver.Make.html#mkBuildModule"><span class="hs-identifier hs-var">mkBuildModule</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203872"><span class="hs-identifier hs-var">ms</span></a></span><span class="annot"><span class="annottext">ModSummary -&gt; [ModSummary] -&gt; [ModSummary]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681203869"><span class="hs-identifier hs-var">loop</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[BuildModule] -&gt; [[BuildModule]] -&gt; [[BuildModule]]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[ModSummary] -&gt; ModuleSet -&gt; [[BuildModule]]
</span><a href="#local-6989586621681203878"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681203871"><span class="hs-identifier hs-var">mss</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; ModuleSet -&gt; ModuleSet
</span><a href="#local-6989586621681203877"><span class="hs-identifier hs-var">remove</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203872"><span class="hs-identifier hs-var">ms</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleSet
</span><a href="#local-6989586621681203870"><span class="hs-identifier hs-var">boot_modules</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1037"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1038"></span><span>              </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ModSummary] -&gt; ModuleSet -&gt; [[BuildModule]]
</span><a href="#local-6989586621681203878"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681203871"><span class="hs-identifier hs-var">mss</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; ModuleSet -&gt; ModuleSet
</span><a href="#local-6989586621681203877"><span class="hs-identifier hs-var">remove</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203872"><span class="hs-identifier hs-var">ms</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleSet
</span><a href="#local-6989586621681203870"><span class="hs-identifier hs-var">boot_modules</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1039"></span><span>
</span><span id="line-1040"></span><span>    </span><span class="hs-comment">-- Build a Map out of the compilation graph with which we can efficiently</span><span>
</span><span id="line-1041"></span><span>    </span><span class="hs-comment">-- look up the result MVar associated with a particular home module.</span><span>
</span><span id="line-1042"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="#local-6989586621681203866"><span class="hs-identifier hs-type">home_mod_map</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../containers/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#BuildModule"><span class="hs-identifier hs-type">BuildModule</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/GHC.MVar.html#MVar"><span class="hs-identifier hs-type">MVar</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#SuccessFlag"><span class="hs-identifier hs-type">SuccessFlag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-1043"></span><span>        </span><span id="local-6989586621681203866"><span class="annot"><span class="annottext">home_mod_map :: Map BuildModule (MVar SuccessFlag, Int)
</span><a href="#local-6989586621681203866"><span class="hs-identifier hs-var hs-var">home_mod_map</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1044"></span><span>            </span><span class="annot"><span class="annottext">[(BuildModule, (MVar SuccessFlag, Int))]
-&gt; Map BuildModule (MVar SuccessFlag, Int)
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="../../containers/src/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">Map.fromList</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; BuildModule
</span><a href="GHC.Driver.Make.html#mkBuildModule"><span class="hs-identifier hs-var">mkBuildModule</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203864"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">MVar SuccessFlag
</span><a href="#local-6989586621681203863"><span class="hs-identifier hs-var">mvar</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681203862"><span class="hs-identifier hs-var">idx</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1045"></span><span>                         </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621681203864"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203864"><span class="hs-identifier hs-var">ms</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681203863"><span class="annot"><span class="annottext">MVar SuccessFlag
</span><a href="#local-6989586621681203863"><span class="hs-identifier hs-var">mvar</span></a></span></span><span class="hs-special">,</span><span class="annot"><span class="annottext">LogQueue
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span class="hs-special">,</span><span id="local-6989586621681203862"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681203862"><span class="hs-identifier hs-var">idx</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[((ModSummary, MVar SuccessFlag, LogQueue), Int)]
</span><a href="#local-6989586621681203886"><span class="hs-identifier hs-var">comp_graph_w_idx</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1046"></span><span>
</span><span id="line-1047"></span><span>
</span><span id="line-1048"></span><span>    </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO ()
</span><a href="GHC.Driver.Make.html#label_self"><span class="hs-identifier hs-var">label_self</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;main --make thread&quot;</span></span><span>
</span><span id="line-1049"></span><span>    </span><span class="hs-comment">-- For each module in the module graph, spawn a worker thread that will</span><span>
</span><span id="line-1050"></span><span>    </span><span class="hs-comment">-- compile this module.</span><span>
</span><span id="line-1051"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">{</span><span> </span><span id="local-6989586621681203824"><span class="annot"><span class="annottext">spawnWorkers :: IO [ThreadId]
</span><a href="#local-6989586621681203824"><span class="hs-identifier hs-var hs-var">spawnWorkers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[((ModSummary, MVar SuccessFlag, LogQueue), Int)]
-&gt; (((ModSummary, MVar SuccessFlag, LogQueue), Int) -&gt; IO ThreadId)
-&gt; IO [ThreadId]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><a href="../../base/src/Data.Traversable.html#forM"><span class="hs-identifier hs-var">forM</span></a></span><span> </span><span class="annot"><span class="annottext">[((ModSummary, MVar SuccessFlag, LogQueue), Int)]
</span><a href="#local-6989586621681203886"><span class="hs-identifier hs-var">comp_graph_w_idx</span></a></span><span> </span><span class="annot"><span class="annottext">((((ModSummary, MVar SuccessFlag, LogQueue), Int) -&gt; IO ThreadId)
 -&gt; IO [ThreadId])
-&gt; (((ModSummary, MVar SuccessFlag, LogQueue), Int) -&gt; IO ThreadId)
-&gt; IO [ThreadId]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-special">(</span><span id="local-6989586621681203822"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203822"><span class="hs-identifier hs-var">mod</span></a></span></span><span class="hs-special">,</span><span class="hs-glyph">!</span><span id="local-6989586621681203821"><span class="annot"><span class="annottext">MVar SuccessFlag
</span><a href="#local-6989586621681203821"><span class="hs-identifier hs-var">mvar</span></a></span></span><span class="hs-special">,</span><span class="hs-glyph">!</span><span id="local-6989586621681203820"><span class="annot"><span class="annottext">LogQueue
</span><a href="#local-6989586621681203820"><span class="hs-identifier hs-var">log_queue</span></a></span></span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-glyph">!</span><span id="local-6989586621681203819"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681203819"><span class="hs-identifier hs-var">mod_idx</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1052"></span><span>            </span><span class="annot"><span class="annottext">((forall a. IO a -&gt; IO a) -&gt; IO ()) -&gt; IO ThreadId
</span><a href="../../base/src/GHC.Conc.Sync.html#forkIOWithUnmask"><span class="hs-identifier hs-var">forkIOWithUnmask</span></a></span><span> </span><span class="annot"><span class="annottext">(((forall a. IO a -&gt; IO a) -&gt; IO ()) -&gt; IO ThreadId)
-&gt; ((forall a. IO a -&gt; IO a) -&gt; IO ()) -&gt; IO ThreadId
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681203818"><span class="annot"><span class="annottext">forall a. IO a -&gt; IO a
</span><a href="#local-6989586621681203818"><span class="hs-identifier hs-var">unmask</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1053"></span><span>                </span><span class="annot"><span class="annottext">IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO ()
</span><a href="GHC.Driver.Make.html#label_self"><span class="hs-identifier hs-var">label_self</span></a></span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; IO ()) -&gt; FilePath -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath] -&gt; FilePath
</span><a href="../../base/src/Data.OldList.html#unwords"><span class="hs-identifier hs-var">unwords</span></a></span><span>
</span><span id="line-1054"></span><span>                    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;worker --make thread&quot;</span></span><span>
</span><span id="line-1055"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;for module&quot;</span></span><span>
</span><span id="line-1056"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath
forall a. Show a =&gt; a -&gt; FilePath
</span><a href="../../base/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName -&gt; FilePath
</span><a href="GHC.Unit.Module.Name.html#moduleNameString"><span class="hs-identifier hs-var">moduleNameString</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; ModuleName
</span><a href="GHC.Driver.Types.html#ms_mod_name"><span class="hs-identifier hs-var">ms_mod_name</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203822"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1057"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;number&quot;</span></span><span>
</span><span id="line-1058"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; FilePath
forall a. Show a =&gt; a -&gt; FilePath
</span><a href="../../base/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681203819"><span class="hs-identifier hs-var">mod_idx</span></a></span><span>
</span><span id="line-1059"></span><span>                    </span><span class="hs-special">]</span><span>
</span><span id="line-1060"></span><span>                </span><span class="hs-comment">-- Replace the default log_action with one that writes each</span><span>
</span><span id="line-1061"></span><span>                </span><span class="hs-comment">-- message to the module's log_queue. The main thread will</span><span>
</span><span id="line-1062"></span><span>                </span><span class="hs-comment">-- deal with synchronously printing these messages.</span><span>
</span><span id="line-1063"></span><span>                </span><span class="hs-comment">--</span><span>
</span><span id="line-1064"></span><span>                </span><span class="hs-comment">-- Use a local filesToClean var so that we can clean up</span><span>
</span><span id="line-1065"></span><span>                </span><span class="hs-comment">-- intermediate files in a timely fashion (as soon as</span><span>
</span><span id="line-1066"></span><span>                </span><span class="hs-comment">-- compilation for that module is finished) without having to</span><span>
</span><span id="line-1067"></span><span>                </span><span class="hs-comment">-- worry about accidentally deleting a simultaneous compile's</span><span>
</span><span id="line-1068"></span><span>                </span><span class="hs-comment">-- important files.</span><span>
</span><span id="line-1069"></span><span>                </span><span id="local-6989586621681203815"><span class="annot"><span class="annottext">IORef FilesToClean
</span><a href="#local-6989586621681203815"><span class="hs-identifier hs-var">lcl_files_to_clean</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FilesToClean -&gt; IO (IORef FilesToClean)
forall a. a -&gt; IO (IORef a)
</span><a href="../../base/src/GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a></span><span> </span><span class="annot"><span class="annottext">FilesToClean
</span><a href="GHC.Driver.Session.html#emptyFilesToClean"><span class="hs-identifier hs-var">emptyFilesToClean</span></a></span><span>
</span><span id="line-1070"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681203813"><span class="annot"><span class="annottext">lcl_dflags :: DynFlags
</span><a href="#local-6989586621681203813"><span class="hs-identifier hs-var hs-var">lcl_dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203937"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">log_action :: LogAction
</span><a href="GHC.Driver.Session.html#log_action"><span class="hs-identifier hs-var">log_action</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LogQueue -&gt; LogAction
</span><a href="#local-6989586621681203811"><span class="hs-identifier hs-var">parLogAction</span></a></span><span> </span><span class="annot"><span class="annottext">LogQueue
</span><a href="#local-6989586621681203820"><span class="hs-identifier hs-var">log_queue</span></a></span><span>
</span><span id="line-1071"></span><span>                                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">filesToClean :: IORef FilesToClean
</span><a href="GHC.Driver.Session.html#filesToClean"><span class="hs-identifier hs-var">filesToClean</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IORef FilesToClean
</span><a href="#local-6989586621681203815"><span class="hs-identifier hs-var">lcl_files_to_clean</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1072"></span><span>
</span><span id="line-1073"></span><span>                </span><span class="hs-comment">-- Unmask asynchronous exceptions and perform the thread-local</span><span>
</span><span id="line-1074"></span><span>                </span><span class="hs-comment">-- work to compile the module (see parUpsweep_one).</span><span>
</span><span id="line-1075"></span><span>                </span><span id="local-6989586621681203809"><span class="annot"><span class="annottext">Either SomeException SuccessFlag
</span><a href="#local-6989586621681203809"><span class="hs-identifier hs-var">m_res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO SuccessFlag -&gt; IO (Either SomeException SuccessFlag)
forall (m :: * -&gt; *) e a.
(MonadCatch m, Exception e) =&gt;
m a -&gt; m (Either e a)
</span><a href="../../exceptions/src/Control.Monad.Catch.html#try"><span class="hs-identifier hs-var">MC.try</span></a></span><span> </span><span class="annot"><span class="annottext">(IO SuccessFlag -&gt; IO (Either SomeException SuccessFlag))
-&gt; IO SuccessFlag -&gt; IO (Either SomeException SuccessFlag)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">IO SuccessFlag -&gt; IO SuccessFlag
forall a. IO a -&gt; IO a
</span><a href="#local-6989586621681203818"><span class="hs-identifier hs-var">unmask</span></a></span><span> </span><span class="annot"><span class="annottext">(IO SuccessFlag -&gt; IO SuccessFlag)
-&gt; IO SuccessFlag -&gt; IO SuccessFlag
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; IO SuccessFlag -&gt; IO SuccessFlag
forall (m :: * -&gt; *) a. ExceptionMonad m =&gt; DynFlags -&gt; m a -&gt; m a
</span><a href="GHC.Utils.Error.html#prettyPrintGhcErrors"><span class="hs-identifier hs-var">prettyPrintGhcErrors</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203813"><span class="hs-identifier hs-var">lcl_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">(IO SuccessFlag -&gt; IO SuccessFlag)
-&gt; IO SuccessFlag -&gt; IO SuccessFlag
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1076"></span><span>                        </span><span class="annot"><span class="annottext">ModSummary
-&gt; Map BuildModule (MVar SuccessFlag, Int)
-&gt; [[BuildModule]]
-&gt; DynFlags
-&gt; Maybe Messager
-&gt; (HscEnv -&gt; IO ())
-&gt; QSem
-&gt; MVar HscEnv
-&gt; IORef HomePackageTable
-&gt; (UniqSet ModuleName, UniqSet ModuleName)
-&gt; Int
-&gt; Int
-&gt; IO SuccessFlag
</span><a href="GHC.Driver.Make.html#parUpsweep_one"><span class="hs-identifier hs-var">parUpsweep_one</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203822"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">Map BuildModule (MVar SuccessFlag, Int)
</span><a href="#local-6989586621681203866"><span class="hs-identifier hs-var">home_mod_map</span></a></span><span> </span><span class="annot"><span class="annottext">[[BuildModule]]
</span><a href="#local-6989586621681203879"><span class="hs-identifier hs-var">comp_graph_loops</span></a></span><span>
</span><span id="line-1077"></span><span>                                       </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203813"><span class="hs-identifier hs-var">lcl_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Messager
</span><a href="#local-6989586621681203943"><span class="hs-identifier hs-var">mHscMessage</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; IO ()
</span><a href="#local-6989586621681203940"><span class="hs-identifier hs-var">cleanup</span></a></span><span>
</span><span id="line-1078"></span><span>                                       </span><span class="annot"><span class="annottext">QSem
</span><a href="#local-6989586621681203931"><span class="hs-identifier hs-var">par_sem</span></a></span><span> </span><span class="annot"><span class="annottext">MVar HscEnv
</span><a href="#local-6989586621681203934"><span class="hs-identifier hs-var">hsc_env_var</span></a></span><span> </span><span class="annot"><span class="annottext">IORef HomePackageTable
</span><a href="#local-6989586621681203932"><span class="hs-identifier hs-var">old_hpt_var</span></a></span><span>
</span><span id="line-1079"></span><span>                                       </span><span class="annot"><span class="annottext">(UniqSet ModuleName, UniqSet ModuleName)
</span><a href="#local-6989586621681203941"><span class="hs-identifier hs-var">stable_mods</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681203819"><span class="hs-identifier hs-var">mod_idx</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SCC ModSummary] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[SCC ModSummary]
</span><a href="#local-6989586621681203939"><span class="hs-identifier hs-var">sccs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1080"></span><span>
</span><span id="line-1081"></span><span>                </span><span id="local-6989586621681203804"><span class="annot"><span class="annottext">SuccessFlag
</span><a href="#local-6989586621681203804"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either SomeException SuccessFlag
</span><a href="#local-6989586621681203809"><span class="hs-identifier hs-var">m_res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1082"></span><span>                    </span><span class="annot"><a href="../../base/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621681203803"><span class="annot"><span class="annottext">SuccessFlag
</span><a href="#local-6989586621681203803"><span class="hs-identifier hs-var">flag</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SuccessFlag -&gt; IO SuccessFlag
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">SuccessFlag
</span><a href="#local-6989586621681203803"><span class="hs-identifier hs-var">flag</span></a></span><span>
</span><span id="line-1083"></span><span>                    </span><span class="annot"><a href="../../base/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621681203802"><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621681203802"><span class="hs-identifier hs-var">exc</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1084"></span><span>                        </span><span class="hs-comment">-- Don't print ThreadKilled exceptions: they are used</span><span>
</span><span id="line-1085"></span><span>                        </span><span class="hs-comment">-- to kill the worker thread in the event of a user</span><span>
</span><span id="line-1086"></span><span>                        </span><span class="hs-comment">-- interrupt, and the user doesn't have to be informed</span><span>
</span><span id="line-1087"></span><span>                        </span><span class="hs-comment">-- about that.</span><span>
</span><span id="line-1088"></span><span>                        </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SomeException -&gt; Maybe AsyncException
forall e. Exception e =&gt; SomeException -&gt; Maybe e
</span><a href="../../base/src/GHC.Exception.Type.html#fromException"><span class="hs-identifier hs-var">fromException</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621681203802"><span class="hs-identifier hs-var">exc</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe AsyncException -&gt; Maybe AsyncException -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">AsyncException -&gt; Maybe AsyncException
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">AsyncException
</span><a href="../../base/src/GHC.IO.Exception.html#ThreadKilled"><span class="hs-identifier hs-var">ThreadKilled</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1089"></span><span>                             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#errorMsg"><span class="hs-identifier hs-var">errorMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203813"><span class="hs-identifier hs-var">lcl_dflags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SomeException -&gt; FilePath
forall a. Show a =&gt; a -&gt; FilePath
</span><a href="../../base/src/GHC.Show.html#show"><span class="hs-identifier hs-var">show</span></a></span><span> </span><span class="annot"><span class="annottext">SomeException
</span><a href="#local-6989586621681203802"><span class="hs-identifier hs-var">exc</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1090"></span><span>                        </span><span class="annot"><span class="annottext">SuccessFlag -&gt; IO SuccessFlag
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">SuccessFlag
</span><a href="GHC.Types.Basic.html#Failed"><span class="hs-identifier hs-var">Failed</span></a></span><span>
</span><span id="line-1091"></span><span>
</span><span id="line-1092"></span><span>                </span><span class="hs-comment">-- Populate the result MVar.</span><span>
</span><span id="line-1093"></span><span>                </span><span class="annot"><span class="annottext">MVar SuccessFlag -&gt; SuccessFlag -&gt; IO ()
forall a. MVar a -&gt; a -&gt; IO ()
</span><a href="../../base/src/GHC.MVar.html#putMVar"><span class="hs-identifier hs-var">putMVar</span></a></span><span> </span><span class="annot"><span class="annottext">MVar SuccessFlag
</span><a href="#local-6989586621681203821"><span class="hs-identifier hs-var">mvar</span></a></span><span> </span><span class="annot"><span class="annottext">SuccessFlag
</span><a href="#local-6989586621681203804"><span class="hs-identifier hs-var">res</span></a></span><span>
</span><span id="line-1094"></span><span>
</span><span id="line-1095"></span><span>                </span><span class="hs-comment">-- Write the end marker to the message queue, telling the main</span><span>
</span><span id="line-1096"></span><span>                </span><span class="hs-comment">-- thread that it can stop waiting for messages from this</span><span>
</span><span id="line-1097"></span><span>                </span><span class="hs-comment">-- particular compile.</span><span>
</span><span id="line-1098"></span><span>                </span><span class="annot"><span class="annottext">LogQueue -&gt; Maybe (WarnReason, Severity, SrcSpan, SDoc) -&gt; IO ()
</span><a href="#local-6989586621681203798"><span class="hs-identifier hs-var">writeLogQueue</span></a></span><span> </span><span class="annot"><span class="annottext">LogQueue
</span><a href="#local-6989586621681203820"><span class="hs-identifier hs-var">log_queue</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (WarnReason, Severity, SrcSpan, SDoc)
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1099"></span><span>
</span><span id="line-1100"></span><span>                </span><span class="hs-comment">-- Add the remaining files that weren't cleaned up to the</span><span>
</span><span id="line-1101"></span><span>                </span><span class="hs-comment">-- global filesToClean ref, for cleanup later.</span><span>
</span><span id="line-1102"></span><span>                </span><span class="annot"><a href="GHC.Driver.Session.html#FilesToClean"><span class="hs-identifier hs-type">FilesToClean</span></a></span><span>
</span><span id="line-1103"></span><span>                  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ftcCurrentModule :: FilesToClean -&gt; Set FilePath
</span><a href="GHC.Driver.Session.html#ftcCurrentModule"><span class="hs-identifier hs-var">ftcCurrentModule</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681203795"><span class="annot"><span class="annottext">Set FilePath
</span><a href="#local-6989586621681203795"><span class="hs-identifier hs-var">cm_files</span></a></span></span><span>
</span><span id="line-1104"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ftcGhcSession :: FilesToClean -&gt; Set FilePath
</span><a href="GHC.Driver.Session.html#ftcGhcSession"><span class="hs-identifier hs-var">ftcGhcSession</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681203793"><span class="annot"><span class="annottext">Set FilePath
</span><a href="#local-6989586621681203793"><span class="hs-identifier hs-var">gs_files</span></a></span></span><span>
</span><span id="line-1105"></span><span>                  </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef FilesToClean -&gt; IO FilesToClean
forall a. IORef a -&gt; IO a
</span><a href="../../base/src/GHC.IORef.html#readIORef"><span class="hs-identifier hs-var">readIORef</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; IORef FilesToClean
</span><a href="GHC.Driver.Session.html#filesToClean"><span class="hs-identifier hs-var hs-var">filesToClean</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203813"><span class="hs-identifier hs-var">lcl_dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1106"></span><span>                </span><span class="annot"><span class="annottext">DynFlags -&gt; TempFileLifetime -&gt; [FilePath] -&gt; IO ()
</span><a href="GHC.SysTools.FileCleanup.html#addFilesToClean"><span class="hs-identifier hs-var">addFilesToClean</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203937"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">TempFileLifetime
</span><a href="GHC.SysTools.FileCleanup.html#TFL_CurrentModule"><span class="hs-identifier hs-var">TFL_CurrentModule</span></a></span><span> </span><span class="annot"><span class="annottext">([FilePath] -&gt; IO ()) -&gt; [FilePath] -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Set FilePath -&gt; [FilePath]
forall a. Set a -&gt; [a]
</span><a href="../../containers/src/Data.Set.Internal.html#toList"><span class="hs-identifier hs-var">Set.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Set FilePath
</span><a href="#local-6989586621681203795"><span class="hs-identifier hs-var">cm_files</span></a></span><span>
</span><span id="line-1107"></span><span>                </span><span class="annot"><span class="annottext">DynFlags -&gt; TempFileLifetime -&gt; [FilePath] -&gt; IO ()
</span><a href="GHC.SysTools.FileCleanup.html#addFilesToClean"><span class="hs-identifier hs-var">addFilesToClean</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203937"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">TempFileLifetime
</span><a href="GHC.SysTools.FileCleanup.html#TFL_GhcSession"><span class="hs-identifier hs-var">TFL_GhcSession</span></a></span><span> </span><span class="annot"><span class="annottext">([FilePath] -&gt; IO ()) -&gt; [FilePath] -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Set FilePath -&gt; [FilePath]
forall a. Set a -&gt; [a]
</span><a href="../../containers/src/Data.Set.Internal.html#toList"><span class="hs-identifier hs-var">Set.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Set FilePath
</span><a href="#local-6989586621681203793"><span class="hs-identifier hs-var">gs_files</span></a></span><span>
</span><span id="line-1108"></span><span>
</span><span id="line-1109"></span><span>        </span><span class="hs-comment">-- Kill all the workers, masking interrupts (since killThread is</span><span>
</span><span id="line-1110"></span><span>        </span><span class="hs-comment">-- interruptible). XXX: This is not ideal.</span><span>
</span><span id="line-1111"></span><span>        </span><span class="hs-special">;</span><span> </span><span id="local-6989586621681203785"><span class="annot"><span class="annottext">killWorkers :: [ThreadId] -&gt; IO ()
</span><a href="#local-6989586621681203785"><span class="hs-identifier hs-var hs-var">killWorkers</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadMask m =&gt; m a -&gt; m a
</span><a href="../../exceptions/src/Control.Monad.Catch.html#uninterruptibleMask_"><span class="hs-identifier hs-var">MC.uninterruptibleMask_</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; ([ThreadId] -&gt; IO ()) -&gt; [ThreadId] -&gt; IO ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(ThreadId -&gt; IO ()) -&gt; [ThreadId] -&gt; IO ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><a href="../../base/src/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a></span><span> </span><span class="annot"><span class="annottext">ThreadId -&gt; IO ()
</span><a href="../../base/src/GHC.Conc.Sync.html#killThread"><span class="hs-identifier hs-var">killThread</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1112"></span><span>
</span><span id="line-1113"></span><span>
</span><span id="line-1114"></span><span>    </span><span class="hs-comment">-- Spawn the workers, making sure to kill them later. Collect the results</span><span>
</span><span id="line-1115"></span><span>    </span><span class="hs-comment">-- of each compile.</span><span>
</span><span id="line-1116"></span><span>    </span><span id="local-6989586621681203782"><span class="annot"><span class="annottext">[Maybe ModSummary]
</span><a href="#local-6989586621681203782"><span class="hs-identifier hs-var">results</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO [Maybe ModSummary] -&gt; m [Maybe ModSummary]
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO [Maybe ModSummary] -&gt; m [Maybe ModSummary])
-&gt; IO [Maybe ModSummary] -&gt; m [Maybe ModSummary]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">IO [ThreadId]
-&gt; ([ThreadId] -&gt; IO ())
-&gt; ([ThreadId] -&gt; IO [Maybe ModSummary])
-&gt; IO [Maybe ModSummary]
forall (m :: * -&gt; *) a c b.
MonadMask m =&gt;
m a -&gt; (a -&gt; m c) -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../exceptions/src/Control.Monad.Catch.html#bracket"><span class="hs-identifier hs-var">MC.bracket</span></a></span><span> </span><span class="annot"><span class="annottext">IO [ThreadId]
</span><a href="#local-6989586621681203824"><span class="hs-identifier hs-var">spawnWorkers</span></a></span><span> </span><span class="annot"><span class="annottext">[ThreadId] -&gt; IO ()
</span><a href="#local-6989586621681203785"><span class="hs-identifier hs-var">killWorkers</span></a></span><span> </span><span class="annot"><span class="annottext">(([ThreadId] -&gt; IO [Maybe ModSummary]) -&gt; IO [Maybe ModSummary])
-&gt; ([ThreadId] -&gt; IO [Maybe ModSummary]) -&gt; IO [Maybe ModSummary]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">[ThreadId]
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1117"></span><span>        </span><span class="hs-comment">-- Loop over each module in the compilation graph in order, printing</span><span>
</span><span id="line-1118"></span><span>        </span><span class="hs-comment">-- each message from its log_queue.</span><span>
</span><span id="line-1119"></span><span>        </span><span class="annot"><span class="annottext">CompilationGraph
-&gt; ((ModSummary, MVar SuccessFlag, LogQueue)
    -&gt; IO (Maybe ModSummary))
-&gt; IO [Maybe ModSummary]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m (t b)
</span><a href="../../base/src/Data.Traversable.html#forM"><span class="hs-identifier hs-var">forM</span></a></span><span> </span><span class="annot"><span class="annottext">CompilationGraph
</span><a href="#local-6989586621681203891"><span class="hs-identifier hs-var">comp_graph</span></a></span><span> </span><span class="annot"><span class="annottext">(((ModSummary, MVar SuccessFlag, LogQueue)
  -&gt; IO (Maybe ModSummary))
 -&gt; IO [Maybe ModSummary])
-&gt; ((ModSummary, MVar SuccessFlag, LogQueue)
    -&gt; IO (Maybe ModSummary))
-&gt; IO [Maybe ModSummary]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span id="local-6989586621681203781"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203781"><span class="hs-identifier hs-var">mod</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681203780"><span class="annot"><span class="annottext">MVar SuccessFlag
</span><a href="#local-6989586621681203780"><span class="hs-identifier hs-var">mvar</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681203779"><span class="annot"><span class="annottext">LogQueue
</span><a href="#local-6989586621681203779"><span class="hs-identifier hs-var">log_queue</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1120"></span><span>            </span><span class="annot"><span class="annottext">DynFlags -&gt; LogQueue -&gt; IO ()
</span><a href="#local-6989586621681203778"><span class="hs-identifier hs-var">printLogs</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203937"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">LogQueue
</span><a href="#local-6989586621681203779"><span class="hs-identifier hs-var">log_queue</span></a></span><span>
</span><span id="line-1121"></span><span>            </span><span id="local-6989586621681203777"><span class="annot"><span class="annottext">SuccessFlag
</span><a href="#local-6989586621681203777"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MVar SuccessFlag -&gt; IO SuccessFlag
forall a. MVar a -&gt; IO a
</span><a href="../../base/src/GHC.MVar.html#readMVar"><span class="hs-identifier hs-var">readMVar</span></a></span><span> </span><span class="annot"><span class="annottext">MVar SuccessFlag
</span><a href="#local-6989586621681203780"><span class="hs-identifier hs-var">mvar</span></a></span><span>
</span><span id="line-1122"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">SuccessFlag -&gt; Bool
</span><a href="GHC.Types.Basic.html#succeeded"><span class="hs-identifier hs-var">succeeded</span></a></span><span> </span><span class="annot"><span class="annottext">SuccessFlag
</span><a href="#local-6989586621681203777"><span class="hs-identifier hs-var">result</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Maybe ModSummary -&gt; IO (Maybe ModSummary)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; Maybe ModSummary
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203781"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe ModSummary -&gt; IO (Maybe ModSummary)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ModSummary
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1123"></span><span>
</span><span id="line-1124"></span><span>
</span><span id="line-1125"></span><span>    </span><span class="hs-comment">-- Collect and return the ModSummaries of all the successful compiles.</span><span>
</span><span id="line-1126"></span><span>    </span><span class="hs-comment">-- NB: Reverse this list to maintain output parity with the sequential upsweep.</span><span>
</span><span id="line-1127"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681203776"><span class="annot"><span class="annottext">ok_results :: [ModSummary]
</span><a href="#local-6989586621681203776"><span class="hs-identifier hs-var hs-var">ok_results</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ModSummary] -&gt; [ModSummary]
forall a. [a] -&gt; [a]
</span><a href="../../base/src/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Maybe ModSummary] -&gt; [ModSummary]
forall a. [Maybe a] -&gt; [a]
</span><a href="../../base/src/Data.Maybe.html#catMaybes"><span class="hs-identifier hs-var">catMaybes</span></a></span><span> </span><span class="annot"><span class="annottext">[Maybe ModSummary]
</span><a href="#local-6989586621681203782"><span class="hs-identifier hs-var">results</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1128"></span><span>
</span><span id="line-1129"></span><span>    </span><span class="hs-comment">-- Handle any cycle in the original compilation graph and return the result</span><span>
</span><span id="line-1130"></span><span>    </span><span class="hs-comment">-- of the upsweep.</span><span>
</span><span id="line-1131"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe [ModSummary]
</span><a href="#local-6989586621681203890"><span class="hs-identifier hs-var">cycle</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1132"></span><span>        </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681203774"><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681203774"><span class="hs-identifier hs-var">mss</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1133"></span><span>            </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#fatalErrorMsg"><span class="hs-identifier hs-var">fatalErrorMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203937"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ModSummary] -&gt; SDoc
</span><a href="GHC.Driver.Make.html#cyclicModuleErr"><span class="hs-identifier hs-var">cyclicModuleErr</span></a></span><span> </span><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681203774"><span class="hs-identifier hs-var">mss</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1134"></span><span>            </span><span class="annot"><span class="annottext">(SuccessFlag, [ModSummary]) -&gt; m (SuccessFlag, [ModSummary])
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SuccessFlag
</span><a href="GHC.Types.Basic.html#Failed"><span class="hs-identifier hs-var">Failed</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681203776"><span class="hs-identifier hs-var">ok_results</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1135"></span><span>        </span><span class="annot"><span class="annottext">Maybe [ModSummary]
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1136"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681203771"><span class="annot"><span class="annottext">success_flag :: SuccessFlag
</span><a href="#local-6989586621681203771"><span class="hs-identifier hs-var hs-var">success_flag</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; SuccessFlag
</span><a href="GHC.Types.Basic.html#successIf"><span class="hs-identifier hs-var">successIf</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Maybe ModSummary -&gt; Bool) -&gt; [Maybe ModSummary] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#all"><span class="hs-identifier hs-var">all</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe ModSummary -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../../base/src/Data.Maybe.html#isJust"><span class="hs-identifier hs-var">isJust</span></a></span><span> </span><span class="annot"><span class="annottext">[Maybe ModSummary]
</span><a href="#local-6989586621681203782"><span class="hs-identifier hs-var">results</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1137"></span><span>            </span><span class="annot"><span class="annottext">(SuccessFlag, [ModSummary]) -&gt; m (SuccessFlag, [ModSummary])
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SuccessFlag
</span><a href="#local-6989586621681203771"><span class="hs-identifier hs-var">success_flag</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681203776"><span class="hs-identifier hs-var">ok_results</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1138"></span><span>
</span><span id="line-1139"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1140"></span><span>    </span><span class="annot"><a href="#local-6989586621681203798"><span class="hs-identifier hs-type">writeLogQueue</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#LogQueue"><span class="hs-identifier hs-type">LogQueue</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Flags.html#WarnReason"><span class="hs-identifier hs-type">WarnReason</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Utils.Error.html#Severity"><span class="hs-identifier hs-type">Severity</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span class="hs-special">,</span><span class="annot"><a href="GHC.Utils.Error.html#MsgDoc"><span class="hs-identifier hs-type">MsgDoc</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1141"></span><span>    </span><span id="local-6989586621681203798"><span class="annot"><span class="annottext">writeLogQueue :: LogQueue -&gt; Maybe (WarnReason, Severity, SrcSpan, SDoc) -&gt; IO ()
</span><a href="#local-6989586621681203798"><span class="hs-identifier hs-var hs-var">writeLogQueue</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Make.html#LogQueue"><span class="hs-identifier hs-type">LogQueue</span></a></span><span> </span><span id="local-6989586621681203769"><span class="annot"><span class="annottext">IORef [Maybe (WarnReason, Severity, SrcSpan, SDoc)]
</span><a href="#local-6989586621681203769"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span id="local-6989586621681203768"><span class="annot"><span class="annottext">MVar ()
</span><a href="#local-6989586621681203768"><span class="hs-identifier hs-var">sem</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681203767"><span class="annot"><span class="annottext">Maybe (WarnReason, Severity, SrcSpan, SDoc)
</span><a href="#local-6989586621681203767"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1142"></span><span>        </span><span class="annot"><span class="annottext">IORef [Maybe (WarnReason, Severity, SrcSpan, SDoc)]
-&gt; ([Maybe (WarnReason, Severity, SrcSpan, SDoc)]
    -&gt; ([Maybe (WarnReason, Severity, SrcSpan, SDoc)], ()))
-&gt; IO ()
forall a b. IORef a -&gt; (a -&gt; (a, b)) -&gt; IO b
</span><a href="../../base/src/GHC.IORef.html#atomicModifyIORef%27"><span class="hs-identifier hs-var">atomicModifyIORef'</span></a></span><span> </span><span class="annot"><span class="annottext">IORef [Maybe (WarnReason, Severity, SrcSpan, SDoc)]
</span><a href="#local-6989586621681203769"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">(([Maybe (WarnReason, Severity, SrcSpan, SDoc)]
  -&gt; ([Maybe (WarnReason, Severity, SrcSpan, SDoc)], ()))
 -&gt; IO ())
-&gt; ([Maybe (WarnReason, Severity, SrcSpan, SDoc)]
    -&gt; ([Maybe (WarnReason, Severity, SrcSpan, SDoc)], ()))
-&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681203765"><span class="annot"><span class="annottext">[Maybe (WarnReason, Severity, SrcSpan, SDoc)]
</span><a href="#local-6989586621681203765"><span class="hs-identifier hs-var">msgs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe (WarnReason, Severity, SrcSpan, SDoc)
</span><a href="#local-6989586621681203767"><span class="hs-identifier hs-var">msg</span></a></span><span class="annot"><span class="annottext">Maybe (WarnReason, Severity, SrcSpan, SDoc)
-&gt; [Maybe (WarnReason, Severity, SrcSpan, SDoc)]
-&gt; [Maybe (WarnReason, Severity, SrcSpan, SDoc)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[Maybe (WarnReason, Severity, SrcSpan, SDoc)]
</span><a href="#local-6989586621681203765"><span class="hs-identifier hs-var">msgs</span></a></span><span class="hs-special">,</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1143"></span><span>        </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MVar () -&gt; () -&gt; IO Bool
forall a. MVar a -&gt; a -&gt; IO Bool
</span><a href="../../base/src/GHC.MVar.html#tryPutMVar"><span class="hs-identifier hs-var">tryPutMVar</span></a></span><span> </span><span class="annot"><span class="annottext">MVar ()
</span><a href="#local-6989586621681203768"><span class="hs-identifier hs-var">sem</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1144"></span><span>        </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1145"></span><span>
</span><span id="line-1146"></span><span>    </span><span class="hs-comment">-- The log_action callback that is used to synchronize messages from a</span><span>
</span><span id="line-1147"></span><span>    </span><span class="hs-comment">-- worker thread.</span><span>
</span><span id="line-1148"></span><span>    </span><span class="annot"><a href="#local-6989586621681203811"><span class="hs-identifier hs-type">parLogAction</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#LogQueue"><span class="hs-identifier hs-type">LogQueue</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#LogAction"><span class="hs-identifier hs-type">LogAction</span></a></span><span>
</span><span id="line-1149"></span><span>    </span><span id="local-6989586621681203811"><span class="annot"><span class="annottext">parLogAction :: LogQueue -&gt; LogAction
</span><a href="#local-6989586621681203811"><span class="hs-identifier hs-var hs-var">parLogAction</span></a></span></span><span> </span><span id="local-6989586621681203763"><span class="annot"><span class="annottext">LogQueue
</span><a href="#local-6989586621681203763"><span class="hs-identifier hs-var">log_queue</span></a></span></span><span> </span><span id="local-6989586621681203762"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203762"><span class="hs-identifier hs-var">_dflags</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681203761"><span class="annot"><span class="annottext">WarnReason
</span><a href="#local-6989586621681203761"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681203760"><span class="annot"><span class="annottext">Severity
</span><a href="#local-6989586621681203760"><span class="hs-identifier hs-var">severity</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681203759"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681203759"><span class="hs-identifier hs-var">srcSpan</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681203758"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681203758"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1150"></span><span>        </span><span class="annot"><span class="annottext">LogQueue -&gt; Maybe (WarnReason, Severity, SrcSpan, SDoc) -&gt; IO ()
</span><a href="#local-6989586621681203798"><span class="hs-identifier hs-var">writeLogQueue</span></a></span><span> </span><span class="annot"><span class="annottext">LogQueue
</span><a href="#local-6989586621681203763"><span class="hs-identifier hs-var">log_queue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(WarnReason, Severity, SrcSpan, SDoc)
-&gt; Maybe (WarnReason, Severity, SrcSpan, SDoc)
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WarnReason
</span><a href="#local-6989586621681203761"><span class="hs-identifier hs-var">reason</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">Severity
</span><a href="#local-6989586621681203760"><span class="hs-identifier hs-var">severity</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681203759"><span class="hs-identifier hs-var">srcSpan</span></a></span><span class="hs-special">,</span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681203758"><span class="hs-identifier hs-var">msg</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1151"></span><span>
</span><span id="line-1152"></span><span>    </span><span class="hs-comment">-- Print each message from the log_queue using the log_action from the</span><span>
</span><span id="line-1153"></span><span>    </span><span class="hs-comment">-- session's DynFlags.</span><span>
</span><span id="line-1154"></span><span>    </span><span class="annot"><a href="#local-6989586621681203778"><span class="hs-identifier hs-type">printLogs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#LogQueue"><span class="hs-identifier hs-type">LogQueue</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1155"></span><span>    </span><span id="local-6989586621681203778"><span class="annot"><span class="annottext">printLogs :: DynFlags -&gt; LogQueue -&gt; IO ()
</span><a href="#local-6989586621681203778"><span class="hs-identifier hs-var hs-var">printLogs</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681203757"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203757"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Make.html#LogQueue"><span class="hs-identifier hs-type">LogQueue</span></a></span><span> </span><span id="local-6989586621681203756"><span class="annot"><span class="annottext">IORef [Maybe (WarnReason, Severity, SrcSpan, SDoc)]
</span><a href="#local-6989586621681203756"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span id="local-6989586621681203755"><span class="annot"><span class="annottext">MVar ()
</span><a href="#local-6989586621681203755"><span class="hs-identifier hs-var">sem</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621681203754"><span class="hs-identifier hs-var">read_msgs</span></a></span><span>
</span><span id="line-1156"></span><span>      </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681203754"><span class="annot"><span class="annottext">read_msgs :: IO ()
</span><a href="#local-6989586621681203754"><span class="hs-identifier hs-var hs-var">read_msgs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1157"></span><span>                </span><span class="annot"><span class="annottext">MVar () -&gt; IO ()
forall a. MVar a -&gt; IO a
</span><a href="../../base/src/GHC.MVar.html#takeMVar"><span class="hs-identifier hs-var">takeMVar</span></a></span><span> </span><span class="annot"><span class="annottext">MVar ()
</span><a href="#local-6989586621681203755"><span class="hs-identifier hs-var">sem</span></a></span><span>
</span><span id="line-1158"></span><span>                </span><span id="local-6989586621681203748"><span class="annot"><span class="annottext">[Maybe (WarnReason, Severity, SrcSpan, SDoc)]
</span><a href="#local-6989586621681203748"><span class="hs-identifier hs-var">msgs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef [Maybe (WarnReason, Severity, SrcSpan, SDoc)]
-&gt; ([Maybe (WarnReason, Severity, SrcSpan, SDoc)]
    -&gt; ([Maybe (WarnReason, Severity, SrcSpan, SDoc)],
        [Maybe (WarnReason, Severity, SrcSpan, SDoc)]))
-&gt; IO [Maybe (WarnReason, Severity, SrcSpan, SDoc)]
forall a b. IORef a -&gt; (a -&gt; (a, b)) -&gt; IO b
</span><a href="../../base/src/GHC.IORef.html#atomicModifyIORef%27"><span class="hs-identifier hs-var">atomicModifyIORef'</span></a></span><span> </span><span class="annot"><span class="annottext">IORef [Maybe (WarnReason, Severity, SrcSpan, SDoc)]
</span><a href="#local-6989586621681203756"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">(([Maybe (WarnReason, Severity, SrcSpan, SDoc)]
  -&gt; ([Maybe (WarnReason, Severity, SrcSpan, SDoc)],
      [Maybe (WarnReason, Severity, SrcSpan, SDoc)]))
 -&gt; IO [Maybe (WarnReason, Severity, SrcSpan, SDoc)])
-&gt; ([Maybe (WarnReason, Severity, SrcSpan, SDoc)]
    -&gt; ([Maybe (WarnReason, Severity, SrcSpan, SDoc)],
        [Maybe (WarnReason, Severity, SrcSpan, SDoc)]))
-&gt; IO [Maybe (WarnReason, Severity, SrcSpan, SDoc)]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681203747"><span class="annot"><span class="annottext">[Maybe (WarnReason, Severity, SrcSpan, SDoc)]
</span><a href="#local-6989586621681203747"><span class="hs-identifier hs-var">xs</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[Maybe (WarnReason, Severity, SrcSpan, SDoc)]
-&gt; [Maybe (WarnReason, Severity, SrcSpan, SDoc)]
forall a. [a] -&gt; [a]
</span><a href="../../base/src/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="annot"><span class="annottext">[Maybe (WarnReason, Severity, SrcSpan, SDoc)]
</span><a href="#local-6989586621681203747"><span class="hs-identifier hs-var">xs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1159"></span><span>                </span><span class="annot"><span class="annottext">[Maybe (WarnReason, Severity, SrcSpan, SDoc)] -&gt; IO ()
</span><a href="#local-6989586621681203746"><span class="hs-identifier hs-var">print_loop</span></a></span><span> </span><span class="annot"><span class="annottext">[Maybe (WarnReason, Severity, SrcSpan, SDoc)]
</span><a href="#local-6989586621681203748"><span class="hs-identifier hs-var">msgs</span></a></span><span>
</span><span id="line-1160"></span><span>
</span><span id="line-1161"></span><span>            </span><span id="local-6989586621681203746"><span class="annot"><span class="annottext">print_loop :: [Maybe (WarnReason, Severity, SrcSpan, SDoc)] -&gt; IO ()
</span><a href="#local-6989586621681203746"><span class="hs-identifier hs-var hs-var">print_loop</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621681203754"><span class="hs-identifier hs-var">read_msgs</span></a></span><span>
</span><span id="line-1162"></span><span>            </span><span class="annot"><a href="#local-6989586621681203746"><span class="hs-identifier hs-var">print_loop</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681203745"><span class="annot"><span class="annottext">Maybe (WarnReason, Severity, SrcSpan, SDoc)
</span><a href="#local-6989586621681203745"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681203744"><span class="annot"><span class="annottext">[Maybe (WarnReason, Severity, SrcSpan, SDoc)]
</span><a href="#local-6989586621681203744"><span class="hs-identifier hs-var">xs</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (WarnReason, Severity, SrcSpan, SDoc)
</span><a href="#local-6989586621681203745"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1163"></span><span>                </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681203743"><span class="annot"><span class="annottext">WarnReason
</span><a href="#local-6989586621681203743"><span class="hs-identifier hs-var">reason</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681203742"><span class="annot"><span class="annottext">Severity
</span><a href="#local-6989586621681203742"><span class="hs-identifier hs-var">severity</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681203741"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681203741"><span class="hs-identifier hs-var">srcSpan</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681203740"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681203740"><span class="hs-identifier hs-var">msg</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1164"></span><span>                    </span><span class="annot"><span class="annottext">LogAction
</span><a href="GHC.Driver.Session.html#putLogMsg"><span class="hs-identifier hs-var">putLogMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203757"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">WarnReason
</span><a href="#local-6989586621681203743"><span class="hs-identifier hs-var">reason</span></a></span><span> </span><span class="annot"><span class="annottext">Severity
</span><a href="#local-6989586621681203742"><span class="hs-identifier hs-var">severity</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681203741"><span class="hs-identifier hs-var">srcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681203740"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-1165"></span><span>                    </span><span class="annot"><span class="annottext">[Maybe (WarnReason, Severity, SrcSpan, SDoc)] -&gt; IO ()
</span><a href="#local-6989586621681203746"><span class="hs-identifier hs-var">print_loop</span></a></span><span> </span><span class="annot"><span class="annottext">[Maybe (WarnReason, Severity, SrcSpan, SDoc)]
</span><a href="#local-6989586621681203744"><span class="hs-identifier hs-var">xs</span></a></span><span>
</span><span id="line-1166"></span><span>                </span><span class="hs-comment">-- Exit the loop once we encounter the end marker.</span><span>
</span><span id="line-1167"></span><span>                </span><span class="annot"><span class="annottext">Maybe (WarnReason, Severity, SrcSpan, SDoc)
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-1168"></span><span>
</span><span id="line-1169"></span><span class="hs-comment">-- The interruptible subset of the worker threads' work.</span><span>
</span><span id="line-1170"></span><span class="annot"><a href="GHC.Driver.Make.html#parUpsweep_one"><span class="hs-identifier hs-type">parUpsweep_one</span></a></span><span>
</span><span id="line-1171"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span>
</span><span id="line-1172"></span><span>    </span><span class="hs-comment">-- ^ The module we wish to compile</span><span>
</span><span id="line-1173"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../containers/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#BuildModule"><span class="hs-identifier hs-type">BuildModule</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/GHC.MVar.html#MVar"><span class="hs-identifier hs-type">MVar</span></a></span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#SuccessFlag"><span class="hs-identifier hs-type">SuccessFlag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">)</span><span>
</span><span id="line-1174"></span><span>    </span><span class="hs-comment">-- ^ The map of home modules and their result MVar</span><span>
</span><span id="line-1175"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Driver.Make.html#BuildModule"><span class="hs-identifier hs-type">BuildModule</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><span id="line-1176"></span><span>    </span><span class="hs-comment">-- ^ The list of all module loops within the compilation graph.</span><span>
</span><span id="line-1177"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span>
</span><span id="line-1178"></span><span>    </span><span class="hs-comment">-- ^ The thread-local DynFlags</span><span>
</span><span id="line-1179"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#Messager"><span class="hs-identifier hs-type">Messager</span></a></span><span>
</span><span id="line-1180"></span><span>    </span><span class="hs-comment">-- ^ The messager</span><span>
</span><span id="line-1181"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1182"></span><span>    </span><span class="hs-comment">-- ^ The callback for cleaning up intermediate files</span><span>
</span><span id="line-1183"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/Control.Concurrent.QSem.html#QSem"><span class="hs-identifier hs-type">QSem</span></a></span><span>
</span><span id="line-1184"></span><span>    </span><span class="hs-comment">-- ^ The semaphore for limiting the number of simultaneous compiles</span><span>
</span><span id="line-1185"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.MVar.html#MVar"><span class="hs-identifier hs-type">MVar</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-1186"></span><span>    </span><span class="hs-comment">-- ^ The MVar that synchronizes updates to the global HscEnv</span><span>
</span><span id="line-1187"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.IORef.html#IORef"><span class="hs-identifier hs-type">IORef</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HomePackageTable"><span class="hs-identifier hs-type">HomePackageTable</span></a></span><span>
</span><span id="line-1188"></span><span>    </span><span class="hs-comment">-- ^ The old HPT</span><span>
</span><span id="line-1189"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#StableModules"><span class="hs-identifier hs-type">StableModules</span></a></span><span>
</span><span id="line-1190"></span><span>    </span><span class="hs-comment">-- ^ Sets of stable objects and BCOs</span><span>
</span><span id="line-1191"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-1192"></span><span>    </span><span class="hs-comment">-- ^ The index of this module</span><span>
</span><span id="line-1193"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-1194"></span><span>    </span><span class="hs-comment">-- ^ The total number of modules</span><span>
</span><span id="line-1195"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Types.Basic.html#SuccessFlag"><span class="hs-identifier hs-type">SuccessFlag</span></a></span><span>
</span><span id="line-1196"></span><span>    </span><span class="hs-comment">-- ^ The result of this compile</span><span>
</span><span id="line-1197"></span><span id="parUpsweep_one"><span class="annot"><span class="annottext">parUpsweep_one :: ModSummary
-&gt; Map BuildModule (MVar SuccessFlag, Int)
-&gt; [[BuildModule]]
-&gt; DynFlags
-&gt; Maybe Messager
-&gt; (HscEnv -&gt; IO ())
-&gt; QSem
-&gt; MVar HscEnv
-&gt; IORef HomePackageTable
-&gt; (UniqSet ModuleName, UniqSet ModuleName)
-&gt; Int
-&gt; Int
-&gt; IO SuccessFlag
</span><a href="GHC.Driver.Make.html#parUpsweep_one"><span class="hs-identifier hs-var hs-var">parUpsweep_one</span></a></span></span><span> </span><span id="local-6989586621681203738"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203738"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span id="local-6989586621681203737"><span class="annot"><span class="annottext">Map BuildModule (MVar SuccessFlag, Int)
</span><a href="#local-6989586621681203737"><span class="hs-identifier hs-var">home_mod_map</span></a></span></span><span> </span><span id="local-6989586621681203736"><span class="annot"><span class="annottext">[[BuildModule]]
</span><a href="#local-6989586621681203736"><span class="hs-identifier hs-var">comp_graph_loops</span></a></span></span><span> </span><span id="local-6989586621681203735"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203735"><span class="hs-identifier hs-var">lcl_dflags</span></a></span></span><span> </span><span id="local-6989586621681203734"><span class="annot"><span class="annottext">Maybe Messager
</span><a href="#local-6989586621681203734"><span class="hs-identifier hs-var">mHscMessage</span></a></span></span><span> </span><span id="local-6989586621681203733"><span class="annot"><span class="annottext">HscEnv -&gt; IO ()
</span><a href="#local-6989586621681203733"><span class="hs-identifier hs-var">cleanup</span></a></span></span><span> </span><span id="local-6989586621681203732"><span class="annot"><span class="annottext">QSem
</span><a href="#local-6989586621681203732"><span class="hs-identifier hs-var">par_sem</span></a></span></span><span>
</span><span id="line-1198"></span><span>               </span><span id="local-6989586621681203731"><span class="annot"><span class="annottext">MVar HscEnv
</span><a href="#local-6989586621681203731"><span class="hs-identifier hs-var">hsc_env_var</span></a></span></span><span> </span><span id="local-6989586621681203730"><span class="annot"><span class="annottext">IORef HomePackageTable
</span><a href="#local-6989586621681203730"><span class="hs-identifier hs-var">old_hpt_var</span></a></span></span><span> </span><span id="local-6989586621681203729"><span class="annot"><span class="annottext">(UniqSet ModuleName, UniqSet ModuleName)
</span><a href="#local-6989586621681203729"><span class="hs-identifier hs-var">stable_mods</span></a></span></span><span> </span><span id="local-6989586621681203728"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681203728"><span class="hs-identifier hs-var">mod_index</span></a></span></span><span> </span><span id="local-6989586621681203727"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681203727"><span class="hs-identifier hs-var">num_mods</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1199"></span><span>
</span><span id="line-1200"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681203726"><span class="annot"><span class="annottext">this_build_mod :: BuildModule
</span><a href="#local-6989586621681203726"><span class="hs-identifier hs-var hs-var">this_build_mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; BuildModule
</span><a href="GHC.Driver.Make.html#mkBuildModule"><span class="hs-identifier hs-var">mkBuildModule</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203738"><span class="hs-identifier hs-var">mod</span></a></span><span>
</span><span id="line-1201"></span><span>
</span><span id="line-1202"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681203725"><span class="annot"><span class="annottext">home_imps :: [ModuleName]
</span><a href="#local-6989586621681203725"><span class="hs-identifier hs-var hs-var">home_imps</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpan ModuleName -&gt; ModuleName)
-&gt; [GenLocated SrcSpan ModuleName] -&gt; [ModuleName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpan ModuleName -&gt; ModuleName
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">([GenLocated SrcSpan ModuleName] -&gt; [ModuleName])
-&gt; [GenLocated SrcSpan ModuleName] -&gt; [ModuleName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; [GenLocated SrcSpan ModuleName]
</span><a href="GHC.Driver.Types.html#ms_home_imps"><span class="hs-identifier hs-var">ms_home_imps</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203738"><span class="hs-identifier hs-var">mod</span></a></span><span>
</span><span id="line-1203"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681203724"><span class="annot"><span class="annottext">home_src_imps :: [ModuleName]
</span><a href="#local-6989586621681203724"><span class="hs-identifier hs-var hs-var">home_src_imps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpan ModuleName -&gt; ModuleName)
-&gt; [GenLocated SrcSpan ModuleName] -&gt; [ModuleName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpan ModuleName -&gt; ModuleName
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">([GenLocated SrcSpan ModuleName] -&gt; [ModuleName])
-&gt; [GenLocated SrcSpan ModuleName] -&gt; [ModuleName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; [GenLocated SrcSpan ModuleName]
</span><a href="GHC.Driver.Types.html#ms_home_srcimps"><span class="hs-identifier hs-var">ms_home_srcimps</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203738"><span class="hs-identifier hs-var">mod</span></a></span><span>
</span><span id="line-1204"></span><span>
</span><span id="line-1205"></span><span>    </span><span class="hs-comment">-- All the textual imports of this module.</span><span>
</span><span id="line-1206"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681203720"><span class="annot"><span class="annottext">textual_deps :: Set BuildModule
</span><a href="#local-6989586621681203720"><span class="hs-identifier hs-var hs-var">textual_deps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[BuildModule] -&gt; Set BuildModule
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="../../containers/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">Set.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([BuildModule] -&gt; Set BuildModule)
-&gt; [BuildModule] -&gt; Set BuildModule
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1207"></span><span>            </span><span class="annot"><span class="annottext">(ModuleName -&gt; IsBootInterface -&gt; BuildModule)
-&gt; [ModuleName] -&gt; [IsBootInterface] -&gt; [BuildModule]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><a href="../../base/src/GHC.List.html#zipWith"><span class="hs-identifier hs-var">zipWith</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; IsBootInterface -&gt; BuildModule
</span><a href="#local-6989586621681203719"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621681203725"><span class="hs-identifier hs-var">home_imps</span></a></span><span>     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsBootInterface -&gt; [IsBootInterface]
forall a. a -&gt; [a]
</span><a href="../../base/src/GHC.List.html#repeat"><span class="hs-identifier hs-var">repeat</span></a></span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="GHC.Unit.Types.html#NotBoot"><span class="hs-identifier hs-var">NotBoot</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[BuildModule] -&gt; [BuildModule] -&gt; [BuildModule]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-1208"></span><span>            </span><span class="annot"><span class="annottext">(ModuleName -&gt; IsBootInterface -&gt; BuildModule)
-&gt; [ModuleName] -&gt; [IsBootInterface] -&gt; [BuildModule]
forall a b c. (a -&gt; b -&gt; c) -&gt; [a] -&gt; [b] -&gt; [c]
</span><a href="../../base/src/GHC.List.html#zipWith"><span class="hs-identifier hs-var">zipWith</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; IsBootInterface -&gt; BuildModule
</span><a href="#local-6989586621681203719"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621681203724"><span class="hs-identifier hs-var">home_src_imps</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IsBootInterface -&gt; [IsBootInterface]
forall a. a -&gt; [a]
</span><a href="../../base/src/GHC.List.html#repeat"><span class="hs-identifier hs-var">repeat</span></a></span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="GHC.Unit.Types.html#IsBoot"><span class="hs-identifier hs-var">IsBoot</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1209"></span><span>          </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681203719"><span class="annot"><span class="annottext">f :: ModuleName -&gt; IsBootInterface -&gt; BuildModule
</span><a href="#local-6989586621681203719"><span class="hs-identifier hs-var hs-var">f</span></a></span></span><span> </span><span id="local-6989586621681203717"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681203717"><span class="hs-identifier hs-var">mn</span></a></span></span><span> </span><span id="local-6989586621681203716"><span class="annot"><span class="annottext">IsBootInterface
</span><a href="#local-6989586621681203716"><span class="hs-identifier hs-var">isBoot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GWIB :: forall mod. mod -&gt; IsBootInterface -&gt; GenWithIsBoot mod
</span><a href="GHC.Unit.Types.html#GWIB"><span class="hs-identifier hs-type">GWIB</span></a></span><span>
</span><span id="line-1210"></span><span>                  </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">gwib_mod :: Module
</span><a href="GHC.Unit.Types.html#gwib_mod"><span class="hs-identifier hs-var">gwib_mod</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; ModuleName -&gt; Module
</span><a href="GHC.Driver.Session.html#mkHomeModule"><span class="hs-identifier hs-var">mkHomeModule</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203735"><span class="hs-identifier hs-var">lcl_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681203717"><span class="hs-identifier hs-var">mn</span></a></span><span>
</span><span id="line-1211"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">gwib_isBoot :: IsBootInterface
</span><a href="GHC.Unit.Types.html#gwib_isBoot"><span class="hs-identifier hs-var">gwib_isBoot</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="#local-6989586621681203716"><span class="hs-identifier hs-var">isBoot</span></a></span><span>
</span><span id="line-1212"></span><span>                  </span><span class="hs-special">}</span><span>
</span><span id="line-1213"></span><span>
</span><span id="line-1214"></span><span>    </span><span class="hs-comment">-- Dealing with module loops</span><span>
</span><span id="line-1215"></span><span>    </span><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><span id="line-1216"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1217"></span><span>    </span><span class="hs-comment">-- Not only do we have to deal with explicit textual dependencies, we also</span><span>
</span><span id="line-1218"></span><span>    </span><span class="hs-comment">-- have to deal with implicit dependencies introduced by import cycles that</span><span>
</span><span id="line-1219"></span><span>    </span><span class="hs-comment">-- are broken by an hs-boot file. We have to ensure that:</span><span>
</span><span id="line-1220"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1221"></span><span>    </span><span class="hs-comment">-- 1. A module that breaks a loop must depend on all the modules in the</span><span>
</span><span id="line-1222"></span><span>    </span><span class="hs-comment">--    loop (transitively or otherwise). This is normally always fulfilled</span><span>
</span><span id="line-1223"></span><span>    </span><span class="hs-comment">--    by the module's textual dependencies except in degenerate loops,</span><span>
</span><span id="line-1224"></span><span>    </span><span class="hs-comment">--    e.g.:</span><span>
</span><span id="line-1225"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1226"></span><span>    </span><span class="hs-comment">--    A.hs imports B.hs-boot</span><span>
</span><span id="line-1227"></span><span>    </span><span class="hs-comment">--    B.hs doesn't import A.hs</span><span>
</span><span id="line-1228"></span><span>    </span><span class="hs-comment">--    C.hs imports A.hs, B.hs</span><span>
</span><span id="line-1229"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1230"></span><span>    </span><span class="hs-comment">--    In this scenario, getModLoop will detect the module loop [A,B] but</span><span>
</span><span id="line-1231"></span><span>    </span><span class="hs-comment">--    the loop finisher B doesn't depend on A. So we have to explicitly add</span><span>
</span><span id="line-1232"></span><span>    </span><span class="hs-comment">--    A in as a dependency of B when we are compiling B.</span><span>
</span><span id="line-1233"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1234"></span><span>    </span><span class="hs-comment">-- 2. A module that depends on a module in an external loop can't proceed</span><span>
</span><span id="line-1235"></span><span>    </span><span class="hs-comment">--    until the entire loop is re-typechecked.</span><span>
</span><span id="line-1236"></span><span>    </span><span class="hs-comment">--</span><span>
</span><span id="line-1237"></span><span>    </span><span class="hs-comment">-- These two invariants have to be maintained to correctly build a</span><span>
</span><span id="line-1238"></span><span>    </span><span class="hs-comment">-- compilation graph with one or more loops.</span><span>
</span><span id="line-1239"></span><span>
</span><span id="line-1240"></span><span>
</span><span id="line-1241"></span><span>    </span><span class="hs-comment">-- The loop that this module will finish. After this module successfully</span><span>
</span><span id="line-1242"></span><span>    </span><span class="hs-comment">-- compiles, this loop is going to get re-typechecked.</span><span>
</span><span id="line-1243"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681203709"><span class="annot"><span class="annottext">finish_loop :: Maybe [BuildModule]
</span><a href="#local-6989586621681203709"><span class="hs-identifier hs-var hs-var">finish_loop</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[[BuildModule]] -&gt; Maybe [BuildModule]
forall a. [a] -&gt; Maybe a
</span><a href="../../base/src/Data.Maybe.html#listToMaybe"><span class="hs-identifier hs-var">listToMaybe</span></a></span><span>
</span><span id="line-1244"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[BuildModule] -&gt; [BuildModule]
forall a. [a] -&gt; [a]
</span><a href="../../base/src/GHC.List.html#tail"><span class="hs-identifier hs-var">tail</span></a></span><span> </span><span class="annot"><span class="annottext">[BuildModule]
</span><a href="#local-6989586621681203706"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681203706"><span class="annot"><span class="annottext">[BuildModule]
</span><a href="#local-6989586621681203706"><span class="hs-identifier hs-var">loop</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[[BuildModule]]
</span><a href="#local-6989586621681203736"><span class="hs-identifier hs-var">comp_graph_loops</span></a></span><span>
</span><span id="line-1245"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[BuildModule] -&gt; BuildModule
forall a. [a] -&gt; a
</span><a href="../../base/src/GHC.List.html#head"><span class="hs-identifier hs-var">head</span></a></span><span> </span><span class="annot"><span class="annottext">[BuildModule]
</span><a href="#local-6989586621681203706"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">BuildModule -&gt; BuildModule -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">BuildModule
</span><a href="#local-6989586621681203726"><span class="hs-identifier hs-var">this_build_mod</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1246"></span><span>
</span><span id="line-1247"></span><span>    </span><span class="hs-comment">-- If this module finishes a loop then it must depend on all the other</span><span>
</span><span id="line-1248"></span><span>    </span><span class="hs-comment">-- modules in that loop because the entire module loop is going to be</span><span>
</span><span id="line-1249"></span><span>    </span><span class="hs-comment">-- re-typechecked once this module gets compiled. These extra dependencies</span><span>
</span><span id="line-1250"></span><span>    </span><span class="hs-comment">-- are this module's &quot;internal&quot; loop dependencies, because this module is</span><span>
</span><span id="line-1251"></span><span>    </span><span class="hs-comment">-- inside the loop in question.</span><span>
</span><span id="line-1252"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681203698"><span class="annot"><span class="annottext">int_loop_deps :: Set BuildModule
</span><a href="#local-6989586621681203698"><span class="hs-identifier hs-var hs-var">int_loop_deps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[BuildModule] -&gt; Set BuildModule
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="../../containers/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">Set.fromList</span></a></span><span> </span><span class="annot"><span class="annottext">([BuildModule] -&gt; Set BuildModule)
-&gt; [BuildModule] -&gt; Set BuildModule
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1253"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe [BuildModule]
</span><a href="#local-6989586621681203709"><span class="hs-identifier hs-var">finish_loop</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1254"></span><span>                </span><span class="annot"><span class="annottext">Maybe [BuildModule]
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1255"></span><span>                </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681203697"><span class="annot"><span class="annottext">[BuildModule]
</span><a href="#local-6989586621681203697"><span class="hs-identifier hs-var">loop</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(BuildModule -&gt; Bool) -&gt; [BuildModule] -&gt; [BuildModule]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuildModule -&gt; BuildModule -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">BuildModule
</span><a href="#local-6989586621681203726"><span class="hs-identifier hs-var">this_build_mod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[BuildModule]
</span><a href="#local-6989586621681203697"><span class="hs-identifier hs-var">loop</span></a></span><span>
</span><span id="line-1256"></span><span>
</span><span id="line-1257"></span><span>    </span><span class="hs-comment">-- If this module depends on a module within a loop then it must wait for</span><span>
</span><span id="line-1258"></span><span>    </span><span class="hs-comment">-- that loop to get re-typechecked, i.e. it must wait on the module that</span><span>
</span><span id="line-1259"></span><span>    </span><span class="hs-comment">-- finishes that loop. These extra dependencies are this module's</span><span>
</span><span id="line-1260"></span><span>    </span><span class="hs-comment">-- &quot;external&quot; loop dependencies, because this module is outside of the</span><span>
</span><span id="line-1261"></span><span>    </span><span class="hs-comment">-- loop(s) in question.</span><span>
</span><span id="line-1262"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681203687"><span class="annot"><span class="annottext">ext_loop_deps :: Set BuildModule
</span><a href="#local-6989586621681203687"><span class="hs-identifier hs-var hs-var">ext_loop_deps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[BuildModule] -&gt; Set BuildModule
forall a. Ord a =&gt; [a] -&gt; Set a
</span><a href="../../containers/src/Data.Set.Internal.html#fromList"><span class="hs-identifier hs-var">Set.fromList</span></a></span><span>
</span><span id="line-1263"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">[BuildModule] -&gt; BuildModule
forall a. [a] -&gt; a
</span><a href="../../base/src/GHC.List.html#head"><span class="hs-identifier hs-var">head</span></a></span><span> </span><span class="annot"><span class="annottext">[BuildModule]
</span><a href="#local-6989586621681203686"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681203686"><span class="annot"><span class="annottext">[BuildModule]
</span><a href="#local-6989586621681203686"><span class="hs-identifier hs-var">loop</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[[BuildModule]]
</span><a href="#local-6989586621681203736"><span class="hs-identifier hs-var">comp_graph_loops</span></a></span><span>
</span><span id="line-1264"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">(BuildModule -&gt; Bool) -&gt; [BuildModule] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuildModule -&gt; Set BuildModule -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="../../containers/src/Data.Set.Internal.html#member"><span class="hs-operator hs-var">`Set.member`</span></a></span><span> </span><span class="annot"><span class="annottext">Set BuildModule
</span><a href="#local-6989586621681203720"><span class="hs-identifier hs-var">textual_deps</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[BuildModule]
</span><a href="#local-6989586621681203686"><span class="hs-identifier hs-var">loop</span></a></span><span>
</span><span id="line-1265"></span><span>                        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">BuildModule
</span><a href="#local-6989586621681203726"><span class="hs-identifier hs-var">this_build_mod</span></a></span><span> </span><span class="annot"><span class="annottext">BuildModule -&gt; [BuildModule] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#notElem"><span class="hs-operator hs-var">`notElem`</span></a></span><span> </span><span class="annot"><span class="annottext">[BuildModule]
</span><a href="#local-6989586621681203686"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1266"></span><span>
</span><span id="line-1267"></span><span>
</span><span id="line-1268"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681203681"><span class="annot"><span class="annottext">all_deps :: Set BuildModule
</span><a href="#local-6989586621681203681"><span class="hs-identifier hs-var hs-var">all_deps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Set BuildModule -&gt; Set BuildModule -&gt; Set BuildModule)
-&gt; [Set BuildModule] -&gt; Set BuildModule
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; a -&gt; a) -&gt; t a -&gt; a
</span><a href="../../base/src/Data.Foldable.html#foldl1"><span class="hs-identifier hs-var">foldl1</span></a></span><span> </span><span class="annot"><span class="annottext">Set BuildModule -&gt; Set BuildModule -&gt; Set BuildModule
forall a. Ord a =&gt; Set a -&gt; Set a -&gt; Set a
</span><a href="../../containers/src/Data.Set.Internal.html#union"><span class="hs-identifier hs-var">Set.union</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Set BuildModule
</span><a href="#local-6989586621681203720"><span class="hs-identifier hs-var">textual_deps</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set BuildModule
</span><a href="#local-6989586621681203698"><span class="hs-identifier hs-var">int_loop_deps</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Set BuildModule
</span><a href="#local-6989586621681203687"><span class="hs-identifier hs-var">ext_loop_deps</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1269"></span><span>
</span><span id="line-1270"></span><span>    </span><span class="hs-comment">-- All of the module's home-module dependencies.</span><span>
</span><span id="line-1271"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681203675"><span class="annot"><span class="annottext">home_deps_with_idx :: [(MVar SuccessFlag, Int)]
</span><a href="#local-6989586621681203675"><span class="hs-identifier hs-var hs-var">home_deps_with_idx</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1272"></span><span>            </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">(MVar SuccessFlag, Int)
</span><a href="#local-6989586621681203674"><span class="hs-identifier hs-var">home_dep</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681203673"><span class="annot"><span class="annottext">BuildModule
</span><a href="#local-6989586621681203673"><span class="hs-identifier hs-var">dep</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Set BuildModule -&gt; [BuildModule]
forall a. Set a -&gt; [a]
</span><a href="../../containers/src/Data.Set.Internal.html#toList"><span class="hs-identifier hs-var">Set.toList</span></a></span><span> </span><span class="annot"><span class="annottext">Set BuildModule
</span><a href="#local-6989586621681203681"><span class="hs-identifier hs-var">all_deps</span></a></span><span>
</span><span id="line-1273"></span><span>                       </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681203674"><span class="annot"><span class="annottext">(MVar SuccessFlag, Int)
</span><a href="#local-6989586621681203674"><span class="hs-identifier hs-var">home_dep</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">BuildModule
-&gt; Map BuildModule (MVar SuccessFlag, Int)
-&gt; Maybe (MVar SuccessFlag, Int)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../containers/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">BuildModule
</span><a href="#local-6989586621681203673"><span class="hs-identifier hs-var">dep</span></a></span><span> </span><span class="annot"><span class="annottext">Map BuildModule (MVar SuccessFlag, Int)
</span><a href="#local-6989586621681203737"><span class="hs-identifier hs-var">home_mod_map</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1274"></span><span>
</span><span id="line-1275"></span><span>    </span><span class="hs-comment">-- Sort the list of dependencies in reverse-topological order. This way, by</span><span>
</span><span id="line-1276"></span><span>    </span><span class="hs-comment">-- the time we get woken up by the result of an earlier dependency,</span><span>
</span><span id="line-1277"></span><span>    </span><span class="hs-comment">-- subsequent dependencies are more likely to have finished. This step</span><span>
</span><span id="line-1278"></span><span>    </span><span class="hs-comment">-- effectively reduces the number of MVars that each thread blocks on.</span><span>
</span><span id="line-1279"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681203670"><span class="annot"><span class="annottext">home_deps :: [MVar SuccessFlag]
</span><a href="#local-6989586621681203670"><span class="hs-identifier hs-var hs-var">home_deps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((MVar SuccessFlag, Int) -&gt; MVar SuccessFlag)
-&gt; [(MVar SuccessFlag, Int)] -&gt; [MVar SuccessFlag]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">(MVar SuccessFlag, Int) -&gt; MVar SuccessFlag
forall a b. (a, b) -&gt; a
</span><a href="../../base/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">([(MVar SuccessFlag, Int)] -&gt; [MVar SuccessFlag])
-&gt; [(MVar SuccessFlag, Int)] -&gt; [MVar SuccessFlag]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">((MVar SuccessFlag, Int) -&gt; (MVar SuccessFlag, Int) -&gt; Ordering)
-&gt; [(MVar SuccessFlag, Int)] -&gt; [(MVar SuccessFlag, Int)]
forall a. (a -&gt; a -&gt; Ordering) -&gt; [a] -&gt; [a]
</span><a href="../../base/src/Data.OldList.html#sortBy"><span class="hs-identifier hs-var">sortBy</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((MVar SuccessFlag, Int) -&gt; (MVar SuccessFlag, Int) -&gt; Ordering)
-&gt; (MVar SuccessFlag, Int) -&gt; (MVar SuccessFlag, Int) -&gt; Ordering
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#flip"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">((MVar SuccessFlag, Int) -&gt; Int)
-&gt; (MVar SuccessFlag, Int) -&gt; (MVar SuccessFlag, Int) -&gt; Ordering
forall a b. Ord a =&gt; (b -&gt; a) -&gt; b -&gt; b -&gt; Ordering
</span><a href="../../base/src/Data.Ord.html#comparing"><span class="hs-identifier hs-var">comparing</span></a></span><span> </span><span class="annot"><span class="annottext">(MVar SuccessFlag, Int) -&gt; Int
forall a b. (a, b) -&gt; b
</span><a href="../../base/src/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[(MVar SuccessFlag, Int)]
</span><a href="#local-6989586621681203675"><span class="hs-identifier hs-var">home_deps_with_idx</span></a></span><span>
</span><span id="line-1280"></span><span>
</span><span id="line-1281"></span><span>    </span><span class="hs-comment">-- Wait for the all the module's dependencies to finish building.</span><span>
</span><span id="line-1282"></span><span>    </span><span id="local-6989586621681203667"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681203667"><span class="hs-identifier hs-var">deps_ok</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(MVar SuccessFlag -&gt; IO Bool) -&gt; [MVar SuccessFlag] -&gt; IO Bool
forall (m :: * -&gt; *) a. Monad m =&gt; (a -&gt; m Bool) -&gt; [a] -&gt; m Bool
</span><a href="GHC.Utils.Monad.html#allM"><span class="hs-identifier hs-var">allM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SuccessFlag -&gt; Bool) -&gt; IO SuccessFlag -&gt; IO Bool
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">SuccessFlag -&gt; Bool
</span><a href="GHC.Types.Basic.html#succeeded"><span class="hs-identifier hs-var">succeeded</span></a></span><span> </span><span class="annot"><span class="annottext">(IO SuccessFlag -&gt; IO Bool)
-&gt; (MVar SuccessFlag -&gt; IO SuccessFlag)
-&gt; MVar SuccessFlag
-&gt; IO Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">MVar SuccessFlag -&gt; IO SuccessFlag
forall a. MVar a -&gt; IO a
</span><a href="../../base/src/GHC.MVar.html#readMVar"><span class="hs-identifier hs-var">readMVar</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[MVar SuccessFlag]
</span><a href="#local-6989586621681203670"><span class="hs-identifier hs-var">home_deps</span></a></span><span>
</span><span id="line-1283"></span><span>
</span><span id="line-1284"></span><span>    </span><span class="hs-comment">-- We can't build this module if any of its dependencies failed to build.</span><span>
</span><span id="line-1285"></span><span>    </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681203667"><span class="hs-identifier hs-var">deps_ok</span></a></span><span>
</span><span id="line-1286"></span><span>      </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">SuccessFlag -&gt; IO SuccessFlag
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">SuccessFlag
</span><a href="GHC.Types.Basic.html#Failed"><span class="hs-identifier hs-var">Failed</span></a></span><span>
</span><span id="line-1287"></span><span>      </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1288"></span><span>        </span><span class="hs-comment">-- Any hsc_env at this point is OK to use since we only really require</span><span>
</span><span id="line-1289"></span><span>        </span><span class="hs-comment">-- that the HPT contains the HMIs of our dependencies.</span><span>
</span><span id="line-1290"></span><span>        </span><span id="local-6989586621681203666"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203666"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MVar HscEnv -&gt; IO HscEnv
forall a. MVar a -&gt; IO a
</span><a href="../../base/src/GHC.MVar.html#readMVar"><span class="hs-identifier hs-var">readMVar</span></a></span><span> </span><span class="annot"><span class="annottext">MVar HscEnv
</span><a href="#local-6989586621681203731"><span class="hs-identifier hs-var">hsc_env_var</span></a></span><span>
</span><span id="line-1291"></span><span>        </span><span id="local-6989586621681203665"><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621681203665"><span class="hs-identifier hs-var">old_hpt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef HomePackageTable -&gt; IO HomePackageTable
forall a. IORef a -&gt; IO a
</span><a href="../../base/src/GHC.IORef.html#readIORef"><span class="hs-identifier hs-var">readIORef</span></a></span><span> </span><span class="annot"><span class="annottext">IORef HomePackageTable
</span><a href="#local-6989586621681203730"><span class="hs-identifier hs-var">old_hpt_var</span></a></span><span>
</span><span id="line-1292"></span><span>
</span><span id="line-1293"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681203664"><span class="annot"><span class="annottext">logger :: SourceError -&gt; IO ()
</span><a href="#local-6989586621681203664"><span class="hs-identifier hs-var hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621681203663"><span class="annot"><span class="annottext">SourceError
</span><a href="#local-6989586621681203663"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; ErrorMessages -&gt; IO ()
</span><a href="GHC.Utils.Error.html#printBagOfErrors"><span class="hs-identifier hs-var">printBagOfErrors</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203735"><span class="hs-identifier hs-var">lcl_dflags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceError -&gt; ErrorMessages
</span><a href="GHC.Driver.Types.html#srcErrorMessages"><span class="hs-identifier hs-var">srcErrorMessages</span></a></span><span> </span><span class="annot"><span class="annottext">SourceError
</span><a href="#local-6989586621681203663"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1294"></span><span>
</span><span id="line-1295"></span><span>        </span><span class="hs-comment">-- Limit the number of parallel compiles.</span><span>
</span><span id="line-1296"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681203659"><span class="annot"><span class="annottext">withSem :: QSem -&gt; IO b -&gt; IO b
</span><a href="#local-6989586621681203659"><span class="hs-identifier hs-var hs-var">withSem</span></a></span></span><span> </span><span id="local-6989586621681203658"><span class="annot"><span class="annottext">QSem
</span><a href="#local-6989586621681203658"><span class="hs-identifier hs-var">sem</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO () -&gt; IO b -&gt; IO b
forall (m :: * -&gt; *) a c b. MonadMask m =&gt; m a -&gt; m c -&gt; m b -&gt; m b
</span><a href="../../exceptions/src/Control.Monad.Catch.html#bracket_"><span class="hs-identifier hs-var">MC.bracket_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QSem -&gt; IO ()
</span><a href="../../base/src/Control.Concurrent.QSem.html#waitQSem"><span class="hs-identifier hs-var">waitQSem</span></a></span><span> </span><span class="annot"><span class="annottext">QSem
</span><a href="#local-6989586621681203658"><span class="hs-identifier hs-var">sem</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">QSem -&gt; IO ()
</span><a href="../../base/src/Control.Concurrent.QSem.html#signalQSem"><span class="hs-identifier hs-var">signalQSem</span></a></span><span> </span><span class="annot"><span class="annottext">QSem
</span><a href="#local-6989586621681203658"><span class="hs-identifier hs-var">sem</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1297"></span><span>        </span><span id="local-6989586621681203654"><span class="annot"><span class="annottext">Maybe HomeModInfo
</span><a href="#local-6989586621681203654"><span class="hs-identifier hs-var">mb_mod_info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">QSem -&gt; IO (Maybe HomeModInfo) -&gt; IO (Maybe HomeModInfo)
forall {b}. QSem -&gt; IO b -&gt; IO b
</span><a href="#local-6989586621681203659"><span class="hs-identifier hs-var">withSem</span></a></span><span> </span><span class="annot"><span class="annottext">QSem
</span><a href="#local-6989586621681203732"><span class="hs-identifier hs-var">par_sem</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (Maybe HomeModInfo) -&gt; IO (Maybe HomeModInfo))
-&gt; IO (Maybe HomeModInfo) -&gt; IO (Maybe HomeModInfo)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1298"></span><span>            </span><span class="annot"><span class="annottext">(SourceError -&gt; IO (Maybe HomeModInfo))
-&gt; IO (Maybe HomeModInfo) -&gt; IO (Maybe HomeModInfo)
forall (m :: * -&gt; *) a.
MonadCatch m =&gt;
(SourceError -&gt; m a) -&gt; m a -&gt; m a
</span><a href="GHC.Driver.Types.html#handleSourceError"><span class="hs-identifier hs-var">handleSourceError</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681203652"><span class="annot"><span class="annottext">SourceError
</span><a href="#local-6989586621681203652"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">SourceError -&gt; IO ()
</span><a href="#local-6989586621681203664"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">SourceError
</span><a href="#local-6989586621681203652"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Maybe HomeModInfo -&gt; IO (Maybe HomeModInfo)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe HomeModInfo
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO (Maybe HomeModInfo) -&gt; IO (Maybe HomeModInfo))
-&gt; IO (Maybe HomeModInfo) -&gt; IO (Maybe HomeModInfo)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1299"></span><span>                </span><span class="hs-comment">-- Have the ModSummary and HscEnv point to our local log_action</span><span>
</span><span id="line-1300"></span><span>                </span><span class="hs-comment">-- and filesToClean var.</span><span>
</span><span id="line-1301"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681203651"><span class="annot"><span class="annottext">lcl_mod :: ModSummary
</span><a href="#local-6989586621681203651"><span class="hs-identifier hs-var hs-var">lcl_mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; ModSummary
</span><a href="#local-6989586621681203650"><span class="hs-identifier hs-var">localize_mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203738"><span class="hs-identifier hs-var">mod</span></a></span><span>
</span><span id="line-1302"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681203649"><span class="annot"><span class="annottext">lcl_hsc_env :: HscEnv
</span><a href="#local-6989586621681203649"><span class="hs-identifier hs-var hs-var">lcl_hsc_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; HscEnv
</span><a href="#local-6989586621681203648"><span class="hs-identifier hs-var">localize_hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203666"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-1303"></span><span>
</span><span id="line-1304"></span><span>                </span><span class="hs-comment">-- Re-typecheck the loop</span><span>
</span><span id="line-1305"></span><span>                </span><span class="hs-comment">-- This is necessary to make sure the knot is tied when</span><span>
</span><span id="line-1306"></span><span>                </span><span class="hs-comment">-- we close a recursive module loop, see bug #12035.</span><span>
</span><span id="line-1307"></span><span>                </span><span id="local-6989586621681203647"><span class="annot"><span class="annottext">IORef (NameEnv TyThing)
</span><a href="#local-6989586621681203647"><span class="hs-identifier hs-var">type_env_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (IORef (NameEnv TyThing)) -&gt; IO (IORef (NameEnv TyThing))
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (IORef (NameEnv TyThing)) -&gt; IO (IORef (NameEnv TyThing)))
-&gt; IO (IORef (NameEnv TyThing)) -&gt; IO (IORef (NameEnv TyThing))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NameEnv TyThing -&gt; IO (IORef (NameEnv TyThing))
forall a. a -&gt; IO (IORef a)
</span><a href="../../base/src/GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a></span><span> </span><span class="annot"><span class="annottext">NameEnv TyThing
forall a. NameEnv a
</span><a href="GHC.Types.Name.Env.html#emptyNameEnv"><span class="hs-identifier hs-var">emptyNameEnv</span></a></span><span>
</span><span id="line-1308"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681203645"><span class="annot"><span class="annottext">lcl_hsc_env' :: HscEnv
</span><a href="#local-6989586621681203645"><span class="hs-identifier hs-var hs-var">lcl_hsc_env'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203649"><span class="hs-identifier hs-var">lcl_hsc_env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hsc_type_env_var :: Maybe (Module, IORef (NameEnv TyThing))
</span><a href="GHC.Driver.Types.html#hsc_type_env_var"><span class="hs-identifier hs-var">hsc_type_env_var</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1309"></span><span>                                    </span><span class="annot"><span class="annottext">(Module, IORef (NameEnv TyThing))
-&gt; Maybe (Module, IORef (NameEnv TyThing))
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; Module
</span><a href="GHC.Driver.Types.html#ms_mod"><span class="hs-identifier hs-var hs-var">ms_mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203651"><span class="hs-identifier hs-var">lcl_mod</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IORef (NameEnv TyThing)
</span><a href="#local-6989586621681203647"><span class="hs-identifier hs-var">type_env_var</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1310"></span><span>                </span><span id="local-6989586621681203643"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203643"><span class="hs-identifier hs-var">lcl_hsc_env''</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe [BuildModule]
</span><a href="#local-6989586621681203709"><span class="hs-identifier hs-var">finish_loop</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1311"></span><span>                    </span><span class="annot"><span class="annottext">Maybe [BuildModule]
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; IO HscEnv
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203645"><span class="hs-identifier hs-var">lcl_hsc_env'</span></a></span><span>
</span><span id="line-1312"></span><span>                    </span><span class="hs-comment">-- In the non-parallel case, the retypecheck prior to</span><span>
</span><span id="line-1313"></span><span>                    </span><span class="hs-comment">-- typechecking the loop closer includes all modules</span><span>
</span><span id="line-1314"></span><span>                    </span><span class="hs-comment">-- EXCEPT the loop closer.  However, our precomputed</span><span>
</span><span id="line-1315"></span><span>                    </span><span class="hs-comment">-- SCCs include the loop closer, so we have to filter</span><span>
</span><span id="line-1316"></span><span>                    </span><span class="hs-comment">-- it out.</span><span>
</span><span id="line-1317"></span><span>                    </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681203642"><span class="annot"><span class="annottext">[BuildModule]
</span><a href="#local-6989586621681203642"><span class="hs-identifier hs-var">loop</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; HscEnv -&gt; [ModuleName] -&gt; IO HscEnv
</span><a href="GHC.Driver.Make.html#typecheckLoop"><span class="hs-identifier hs-var">typecheckLoop</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203735"><span class="hs-identifier hs-var">lcl_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203645"><span class="hs-identifier hs-var">lcl_hsc_env'</span></a></span><span> </span><span class="annot"><span class="annottext">([ModuleName] -&gt; IO HscEnv) -&gt; [ModuleName] -&gt; IO HscEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1318"></span><span>                                 </span><span class="annot"><span class="annottext">(ModuleName -&gt; Bool) -&gt; [ModuleName] -&gt; [ModuleName]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName -&gt; ModuleName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">Module -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var hs-var">moduleName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">BuildModule -&gt; Module
forall mod. GenWithIsBoot mod -&gt; mod
</span><a href="GHC.Unit.Types.html#gwib_mod"><span class="hs-identifier hs-var hs-var">gwib_mod</span></a></span><span> </span><span class="annot"><span class="annottext">BuildModule
</span><a href="#local-6989586621681203726"><span class="hs-identifier hs-var">this_build_mod</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([ModuleName] -&gt; [ModuleName]) -&gt; [ModuleName] -&gt; [ModuleName]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1319"></span><span>                                 </span><span class="annot"><span class="annottext">(BuildModule -&gt; ModuleName) -&gt; [BuildModule] -&gt; [ModuleName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">(Module -&gt; ModuleName)
-&gt; (BuildModule -&gt; Module) -&gt; BuildModule -&gt; ModuleName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">BuildModule -&gt; Module
forall mod. GenWithIsBoot mod -&gt; mod
</span><a href="GHC.Unit.Types.html#gwib_mod"><span class="hs-identifier hs-var hs-var">gwib_mod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[BuildModule]
</span><a href="#local-6989586621681203642"><span class="hs-identifier hs-var">loop</span></a></span><span>
</span><span id="line-1320"></span><span>
</span><span id="line-1321"></span><span>                </span><span class="hs-comment">-- Compile the module.</span><span>
</span><span id="line-1322"></span><span>                </span><span id="local-6989586621681203640"><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621681203640"><span class="hs-identifier hs-var">mod_info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; Maybe Messager
-&gt; HomePackageTable
-&gt; (UniqSet ModuleName, UniqSet ModuleName)
-&gt; ModSummary
-&gt; Int
-&gt; Int
-&gt; IO HomeModInfo
</span><a href="GHC.Driver.Make.html#upsweep_mod"><span class="hs-identifier hs-var">upsweep_mod</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203643"><span class="hs-identifier hs-var">lcl_hsc_env''</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Messager
</span><a href="#local-6989586621681203734"><span class="hs-identifier hs-var">mHscMessage</span></a></span><span> </span><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621681203665"><span class="hs-identifier hs-var">old_hpt</span></a></span><span> </span><span class="annot"><span class="annottext">(UniqSet ModuleName, UniqSet ModuleName)
</span><a href="#local-6989586621681203729"><span class="hs-identifier hs-var">stable_mods</span></a></span><span>
</span><span id="line-1323"></span><span>                                        </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203651"><span class="hs-identifier hs-var">lcl_mod</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681203728"><span class="hs-identifier hs-var">mod_index</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681203727"><span class="hs-identifier hs-var">num_mods</span></a></span><span>
</span><span id="line-1324"></span><span>                </span><span class="annot"><span class="annottext">Maybe HomeModInfo -&gt; IO (Maybe HomeModInfo)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HomeModInfo -&gt; Maybe HomeModInfo
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621681203640"><span class="hs-identifier hs-var">mod_info</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1325"></span><span>
</span><span id="line-1326"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe HomeModInfo
</span><a href="#local-6989586621681203654"><span class="hs-identifier hs-var">mb_mod_info</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1327"></span><span>            </span><span class="annot"><span class="annottext">Maybe HomeModInfo
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">SuccessFlag -&gt; IO SuccessFlag
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">SuccessFlag
</span><a href="GHC.Types.Basic.html#Failed"><span class="hs-identifier hs-var">Failed</span></a></span><span>
</span><span id="line-1328"></span><span>            </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681203638"><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621681203638"><span class="hs-identifier hs-var">mod_info</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1329"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681203637"><span class="annot"><span class="annottext">this_mod :: ModuleName
</span><a href="#local-6989586621681203637"><span class="hs-identifier hs-var hs-var">this_mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; ModuleName
</span><a href="GHC.Driver.Types.html#ms_mod_name"><span class="hs-identifier hs-var">ms_mod_name</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203738"><span class="hs-identifier hs-var">mod</span></a></span><span>
</span><span id="line-1330"></span><span>
</span><span id="line-1331"></span><span>                </span><span class="hs-comment">-- Prune the old HPT unless this is an hs-boot module.</span><span>
</span><span id="line-1332"></span><span>                </span><span class="annot"><span class="annottext">Bool -&gt; IO () -&gt; IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base/src/Control.Monad.html#unless"><span class="hs-identifier hs-var">unless</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; IsBootInterface
</span><a href="GHC.Driver.Types.html#isBootSummary"><span class="hs-identifier hs-var">isBootSummary</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203738"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">IsBootInterface -&gt; IsBootInterface -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="GHC.Unit.Types.html#IsBoot"><span class="hs-identifier hs-var">IsBoot</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1333"></span><span>                    </span><span class="annot"><span class="annottext">IORef HomePackageTable
-&gt; (HomePackageTable -&gt; (HomePackageTable, ())) -&gt; IO ()
forall a b. IORef a -&gt; (a -&gt; (a, b)) -&gt; IO b
</span><a href="../../base/src/GHC.IORef.html#atomicModifyIORef%27"><span class="hs-identifier hs-var">atomicModifyIORef'</span></a></span><span> </span><span class="annot"><span class="annottext">IORef HomePackageTable
</span><a href="#local-6989586621681203730"><span class="hs-identifier hs-var">old_hpt_var</span></a></span><span> </span><span class="annot"><span class="annottext">((HomePackageTable -&gt; (HomePackageTable, ())) -&gt; IO ())
-&gt; (HomePackageTable -&gt; (HomePackageTable, ())) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681203636"><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621681203636"><span class="hs-identifier hs-var">old_hpt</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1334"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HomePackageTable -&gt; ModuleName -&gt; HomePackageTable
</span><a href="GHC.Driver.Types.html#delFromHpt"><span class="hs-identifier hs-var">delFromHpt</span></a></span><span> </span><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621681203636"><span class="hs-identifier hs-var">old_hpt</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681203637"><span class="hs-identifier hs-var">this_mod</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1335"></span><span>
</span><span id="line-1336"></span><span>                </span><span class="hs-comment">-- Update and fetch the global HscEnv.</span><span>
</span><span id="line-1337"></span><span>                </span><span id="local-6989586621681203634"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203634"><span class="hs-identifier hs-var">lcl_hsc_env'</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">MVar HscEnv -&gt; (HscEnv -&gt; IO (HscEnv, HscEnv)) -&gt; IO HscEnv
forall a b. MVar a -&gt; (a -&gt; IO (a, b)) -&gt; IO b
</span><a href="../../base/src/Control.Concurrent.MVar.html#modifyMVar"><span class="hs-identifier hs-var">modifyMVar</span></a></span><span> </span><span class="annot"><span class="annottext">MVar HscEnv
</span><a href="#local-6989586621681203731"><span class="hs-identifier hs-var">hsc_env_var</span></a></span><span> </span><span class="annot"><span class="annottext">((HscEnv -&gt; IO (HscEnv, HscEnv)) -&gt; IO HscEnv)
-&gt; (HscEnv -&gt; IO (HscEnv, HscEnv)) -&gt; IO HscEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681203632"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203632"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1338"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681203631"><span class="annot"><span class="annottext">hsc_env' :: HscEnv
</span><a href="#local-6989586621681203631"><span class="hs-identifier hs-var hs-var">hsc_env'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203632"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-1339"></span><span>                                     </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hsc_HPT :: HomePackageTable
</span><a href="GHC.Driver.Types.html#hsc_HPT"><span class="hs-identifier hs-var">hsc_HPT</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HomePackageTable -&gt; ModuleName -&gt; HomeModInfo -&gt; HomePackageTable
</span><a href="GHC.Driver.Types.html#addToHpt"><span class="hs-identifier hs-var">addToHpt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; HomePackageTable
</span><a href="GHC.Driver.Types.html#hsc_HPT"><span class="hs-identifier hs-var hs-var">hsc_HPT</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203632"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1340"></span><span>                                                           </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681203637"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621681203638"><span class="hs-identifier hs-var">mod_info</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1341"></span><span>                    </span><span class="hs-comment">-- We've finished typechecking the module, now we must</span><span>
</span><span id="line-1342"></span><span>                    </span><span class="hs-comment">-- retypecheck the loop AGAIN to ensure unfoldings are</span><span>
</span><span id="line-1343"></span><span>                    </span><span class="hs-comment">-- updated.  This time, however, we include the loop</span><span>
</span><span id="line-1344"></span><span>                    </span><span class="hs-comment">-- closer!</span><span>
</span><span id="line-1345"></span><span>                    </span><span id="local-6989586621681203629"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203629"><span class="hs-identifier hs-var">hsc_env''</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe [BuildModule]
</span><a href="#local-6989586621681203709"><span class="hs-identifier hs-var">finish_loop</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1346"></span><span>                        </span><span class="annot"><span class="annottext">Maybe [BuildModule]
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; IO HscEnv
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203631"><span class="hs-identifier hs-var">hsc_env'</span></a></span><span>
</span><span id="line-1347"></span><span>                        </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681203628"><span class="annot"><span class="annottext">[BuildModule]
</span><a href="#local-6989586621681203628"><span class="hs-identifier hs-var">loop</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; HscEnv -&gt; [ModuleName] -&gt; IO HscEnv
</span><a href="GHC.Driver.Make.html#typecheckLoop"><span class="hs-identifier hs-var">typecheckLoop</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203735"><span class="hs-identifier hs-var">lcl_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203631"><span class="hs-identifier hs-var">hsc_env'</span></a></span><span> </span><span class="annot"><span class="annottext">([ModuleName] -&gt; IO HscEnv) -&gt; [ModuleName] -&gt; IO HscEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1348"></span><span>                                     </span><span class="annot"><span class="annottext">(BuildModule -&gt; ModuleName) -&gt; [BuildModule] -&gt; [ModuleName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">(Module -&gt; ModuleName)
-&gt; (BuildModule -&gt; Module) -&gt; BuildModule -&gt; ModuleName
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">BuildModule -&gt; Module
forall mod. GenWithIsBoot mod -&gt; mod
</span><a href="GHC.Unit.Types.html#gwib_mod"><span class="hs-identifier hs-var hs-var">gwib_mod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[BuildModule]
</span><a href="#local-6989586621681203628"><span class="hs-identifier hs-var">loop</span></a></span><span>
</span><span id="line-1349"></span><span>                    </span><span class="annot"><span class="annottext">(HscEnv, HscEnv) -&gt; IO (HscEnv, HscEnv)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203629"><span class="hs-identifier hs-var">hsc_env''</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; HscEnv
</span><a href="#local-6989586621681203648"><span class="hs-identifier hs-var">localize_hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203629"><span class="hs-identifier hs-var">hsc_env''</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1350"></span><span>
</span><span id="line-1351"></span><span>                </span><span class="hs-comment">-- Clean up any intermediate files.</span><span>
</span><span id="line-1352"></span><span>                </span><span class="annot"><span class="annottext">HscEnv -&gt; IO ()
</span><a href="#local-6989586621681203733"><span class="hs-identifier hs-var">cleanup</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203634"><span class="hs-identifier hs-var">lcl_hsc_env'</span></a></span><span>
</span><span id="line-1353"></span><span>                </span><span class="annot"><span class="annottext">SuccessFlag -&gt; IO SuccessFlag
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">SuccessFlag
</span><a href="GHC.Types.Basic.html#Succeeded"><span class="hs-identifier hs-var">Succeeded</span></a></span><span>
</span><span id="line-1354"></span><span>
</span><span id="line-1355"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1356"></span><span>    </span><span id="local-6989586621681203650"><span class="annot"><span class="annottext">localize_mod :: ModSummary -&gt; ModSummary
</span><a href="#local-6989586621681203650"><span class="hs-identifier hs-var hs-var">localize_mod</span></a></span></span><span> </span><span id="local-6989586621681203627"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203627"><span class="hs-identifier hs-var">mod</span></a></span></span><span>
</span><span id="line-1357"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203627"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ms_hspp_opts :: DynFlags
</span><a href="GHC.Driver.Types.html#ms_hspp_opts"><span class="hs-identifier hs-var">ms_hspp_opts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#ms_hspp_opts"><span class="hs-identifier hs-var hs-var">ms_hspp_opts</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203627"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1358"></span><span>                 </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">log_action :: LogAction
</span><a href="GHC.Driver.Session.html#log_action"><span class="hs-identifier hs-var">log_action</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; LogAction
</span><a href="GHC.Driver.Session.html#log_action"><span class="hs-identifier hs-var hs-var">log_action</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203735"><span class="hs-identifier hs-var">lcl_dflags</span></a></span><span>
</span><span id="line-1359"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">filesToClean :: IORef FilesToClean
</span><a href="GHC.Driver.Session.html#filesToClean"><span class="hs-identifier hs-var">filesToClean</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; IORef FilesToClean
</span><a href="GHC.Driver.Session.html#filesToClean"><span class="hs-identifier hs-var hs-var">filesToClean</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203735"><span class="hs-identifier hs-var">lcl_dflags</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1360"></span><span>
</span><span id="line-1361"></span><span>    </span><span id="local-6989586621681203648"><span class="annot"><span class="annottext">localize_hsc_env :: HscEnv -&gt; HscEnv
</span><a href="#local-6989586621681203648"><span class="hs-identifier hs-var hs-var">localize_hsc_env</span></a></span></span><span> </span><span id="local-6989586621681203626"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203626"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span>
</span><span id="line-1362"></span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203626"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hsc_dflags :: DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203626"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1363"></span><span>                     </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">log_action :: LogAction
</span><a href="GHC.Driver.Session.html#log_action"><span class="hs-identifier hs-var">log_action</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; LogAction
</span><a href="GHC.Driver.Session.html#log_action"><span class="hs-identifier hs-var hs-var">log_action</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203735"><span class="hs-identifier hs-var">lcl_dflags</span></a></span><span>
</span><span id="line-1364"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">filesToClean :: IORef FilesToClean
</span><a href="GHC.Driver.Session.html#filesToClean"><span class="hs-identifier hs-var">filesToClean</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; IORef FilesToClean
</span><a href="GHC.Driver.Session.html#filesToClean"><span class="hs-identifier hs-var hs-var">filesToClean</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203735"><span class="hs-identifier hs-var">lcl_dflags</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1365"></span><span>
</span><span id="line-1366"></span><span class="hs-comment">-- -----------------------------------------------------------------------------</span><span>
</span><span id="line-1367"></span><span class="hs-comment">--</span><span>
</span><span id="line-1368"></span><span class="hs-comment">-- | The upsweep</span><span>
</span><span id="line-1369"></span><span class="hs-comment">--</span><span>
</span><span id="line-1370"></span><span class="hs-comment">-- This is where we compile each module in the module graph, in a pass</span><span>
</span><span id="line-1371"></span><span class="hs-comment">-- from the bottom to the top of the graph.</span><span>
</span><span id="line-1372"></span><span class="hs-comment">--</span><span>
</span><span id="line-1373"></span><span class="hs-comment">-- There better had not be any cyclic groups here -- we check for them.</span><span>
</span><span id="line-1374"></span><span id="local-6989586621681205189"><span class="annot"><a href="GHC.Driver.Make.html#upsweep"><span class="hs-identifier hs-type">upsweep</span></a></span><span>
</span><span id="line-1375"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Monad.html#GhcMonad"><span class="hs-identifier hs-type">GhcMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681205189"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-1376"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#Messager"><span class="hs-identifier hs-type">Messager</span></a></span><span>
</span><span id="line-1377"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HomePackageTable"><span class="hs-identifier hs-type">HomePackageTable</span></a></span><span>            </span><span class="hs-comment">-- ^ HPT from last time round (pruned)</span><span>
</span><span id="line-1378"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#StableModules"><span class="hs-identifier hs-type">StableModules</span></a></span><span>               </span><span class="hs-comment">-- ^ stable modules (see checkStability)</span><span>
</span><span id="line-1379"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>           </span><span class="hs-comment">-- ^ How to clean up unwanted tmp files</span><span>
</span><span id="line-1380"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../containers/src/Data.Graph.html#SCC"><span class="hs-identifier hs-type">SCC</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">]</span><span>            </span><span class="hs-comment">-- ^ Mods to do (the worklist)</span><span>
</span><span id="line-1381"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681205189"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Basic.html#SuccessFlag"><span class="hs-identifier hs-type">SuccessFlag</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1382"></span><span>          </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span></span><span>
</span><span id="line-1383"></span><span>       </span><span class="hs-comment">-- ^ Returns:</span><span>
</span><span id="line-1384"></span><span>       </span><span class="hs-comment">--</span><span>
</span><span id="line-1385"></span><span>       </span><span class="hs-comment">--  1. A flag whether the complete upsweep was successful.</span><span>
</span><span id="line-1386"></span><span>       </span><span class="hs-comment">--  2. The 'HscEnv' in the monad has an updated HPT</span><span>
</span><span id="line-1387"></span><span>       </span><span class="hs-comment">--  3. A list of modules which succeeded loading.</span><span>
</span><span id="line-1388"></span><span>
</span><span id="line-1389"></span><span id="upsweep"><span class="annot"><span class="annottext">upsweep :: forall (m :: * -&gt; *).
GhcMonad m =&gt;
Maybe Messager
-&gt; HomePackageTable
-&gt; (UniqSet ModuleName, UniqSet ModuleName)
-&gt; (HscEnv -&gt; IO ())
-&gt; [SCC ModSummary]
-&gt; m (SuccessFlag, [ModSummary])
</span><a href="GHC.Driver.Make.html#upsweep"><span class="hs-identifier hs-var hs-var">upsweep</span></a></span></span><span> </span><span id="local-6989586621681203614"><span class="annot"><span class="annottext">Maybe Messager
</span><a href="#local-6989586621681203614"><span class="hs-identifier hs-var">mHscMessage</span></a></span></span><span> </span><span id="local-6989586621681203613"><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621681203613"><span class="hs-identifier hs-var">old_hpt</span></a></span></span><span> </span><span id="local-6989586621681203612"><span class="annot"><span class="annottext">(UniqSet ModuleName, UniqSet ModuleName)
</span><a href="#local-6989586621681203612"><span class="hs-identifier hs-var">stable_mods</span></a></span></span><span> </span><span id="local-6989586621681203611"><span class="annot"><span class="annottext">HscEnv -&gt; IO ()
</span><a href="#local-6989586621681203611"><span class="hs-identifier hs-var">cleanup</span></a></span></span><span> </span><span id="local-6989586621681203610"><span class="annot"><span class="annottext">[SCC ModSummary]
</span><a href="#local-6989586621681203610"><span class="hs-identifier hs-var">sccs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1390"></span><span>   </span><span id="local-6989586621681203609"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203609"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m DynFlags
forall (m :: * -&gt; *). GhcMonad m =&gt; m DynFlags
</span><a href="GHC.Driver.Monad.html#getSessionDynFlags"><span class="hs-identifier hs-var">getSessionDynFlags</span></a></span><span>
</span><span id="line-1391"></span><span>   </span><span class="hs-special">(</span><span id="local-6989586621681203607"><span class="annot"><span class="annottext">SuccessFlag
</span><a href="#local-6989586621681203607"><span class="hs-identifier hs-var">res</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681203606"><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621681203606"><span class="hs-identifier hs-var">done</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HomePackageTable
-&gt; ModuleGraph
-&gt; [SCC ModSummary]
-&gt; Int
-&gt; Int
-&gt; [GenUnit UnitId]
-&gt; UniqSet ModuleName
-&gt; m (SuccessFlag, ModuleGraph)
forall (m :: * -&gt; *).
GhcMonad m =&gt;
HomePackageTable
-&gt; ModuleGraph
-&gt; [SCC ModSummary]
-&gt; Int
-&gt; Int
-&gt; [GenUnit UnitId]
-&gt; UniqSet ModuleName
-&gt; m (SuccessFlag, ModuleGraph)
</span><a href="#local-6989586621681203605"><span class="hs-identifier hs-var">upsweep'</span></a></span><span> </span><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621681203613"><span class="hs-identifier hs-var">old_hpt</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="GHC.Driver.Types.html#emptyMG"><span class="hs-identifier hs-var">emptyMG</span></a></span><span> </span><span class="annot"><span class="annottext">[SCC ModSummary]
</span><a href="#local-6989586621681203610"><span class="hs-identifier hs-var">sccs</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[SCC ModSummary] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[SCC ModSummary]
</span><a href="#local-6989586621681203610"><span class="hs-identifier hs-var">sccs</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1392"></span><span>                           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; [GenUnit UnitId]
</span><a href="GHC.Driver.Make.html#instantiatedUnitsToCheck"><span class="hs-identifier hs-var">instantiatedUnitsToCheck</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203609"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">UniqSet ModuleName
forall a. UniqSet a
</span><a href="#local-6989586621681203604"><span class="hs-identifier hs-var">done_holes</span></a></span><span>
</span><span id="line-1393"></span><span>   </span><span class="annot"><span class="annottext">(SuccessFlag, [ModSummary]) -&gt; m (SuccessFlag, [ModSummary])
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SuccessFlag
</span><a href="#local-6989586621681203607"><span class="hs-identifier hs-var">res</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[ModSummary] -&gt; [ModSummary]
forall a. [a] -&gt; [a]
</span><a href="../../base/src/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="annot"><span class="annottext">([ModSummary] -&gt; [ModSummary]) -&gt; [ModSummary] -&gt; [ModSummary]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraph -&gt; [ModSummary]
</span><a href="GHC.Driver.Types.html#mgModSummaries"><span class="hs-identifier hs-var">mgModSummaries</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621681203606"><span class="hs-identifier hs-var">done</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1394"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1395"></span><span>  </span><span id="local-6989586621681203604"><span class="annot"><span class="annottext">done_holes :: UniqSet a
</span><a href="#local-6989586621681203604"><span class="hs-identifier hs-var hs-var">done_holes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UniqSet a
forall a. UniqSet a
</span><a href="GHC.Types.Unique.Set.html#emptyUniqSet"><span class="hs-identifier hs-var">emptyUniqSet</span></a></span><span>
</span><span id="line-1396"></span><span>
</span><span id="line-1397"></span><span>  </span><span id="local-6989586621681203584"><span class="annot"><span class="annottext">keep_going :: [NodeKey]
-&gt; HomePackageTable
-&gt; ModuleGraph
-&gt; [SCC ModSummary]
-&gt; Int
-&gt; Int
-&gt; [GenUnit UnitId]
-&gt; UniqSet ModuleName
-&gt; m (SuccessFlag, ModuleGraph)
</span><a href="#local-6989586621681203584"><span class="hs-identifier hs-var hs-var">keep_going</span></a></span></span><span> </span><span id="local-6989586621681203583"><span class="annot"><span class="annottext">[NodeKey]
</span><a href="#local-6989586621681203583"><span class="hs-identifier hs-var">this_mods</span></a></span></span><span> </span><span id="local-6989586621681203582"><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621681203582"><span class="hs-identifier hs-var">old_hpt</span></a></span></span><span> </span><span id="local-6989586621681203581"><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621681203581"><span class="hs-identifier hs-var">done</span></a></span></span><span> </span><span id="local-6989586621681203580"><span class="annot"><span class="annottext">[SCC ModSummary]
</span><a href="#local-6989586621681203580"><span class="hs-identifier hs-var">mods</span></a></span></span><span> </span><span id="local-6989586621681203579"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681203579"><span class="hs-identifier hs-var">mod_index</span></a></span></span><span> </span><span id="local-6989586621681203578"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681203578"><span class="hs-identifier hs-var">nmods</span></a></span></span><span> </span><span id="local-6989586621681203577"><span class="annot"><span class="annottext">[GenUnit UnitId]
</span><a href="#local-6989586621681203577"><span class="hs-identifier hs-var">uids_to_check</span></a></span></span><span> </span><span id="local-6989586621681203576"><span class="annot"><span class="annottext">UniqSet ModuleName
</span><a href="#local-6989586621681203576"><span class="hs-identifier hs-var">done_holes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1398"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681203571"><span class="annot"><span class="annottext">sum_deps :: [NodeKey] -&gt; SCC ModSummary -&gt; [NodeKey]
</span><a href="#local-6989586621681203571"><span class="hs-identifier hs-var hs-var">sum_deps</span></a></span></span><span> </span><span id="local-6989586621681203570"><span class="annot"><span class="annottext">[NodeKey]
</span><a href="#local-6989586621681203570"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers/src/Data.Graph.html#AcyclicSCC"><span class="hs-identifier hs-type">AcyclicSCC</span></a></span><span> </span><span id="local-6989586621681203569"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203569"><span class="hs-identifier hs-var">mod</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1399"></span><span>          </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">(NodeKey -&gt; Bool) -&gt; [NodeKey] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; (a -&gt; Bool) -&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#any"><span class="hs-identifier hs-var">any</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(NodeKey -&gt; [NodeKey] -&gt; Bool) -&gt; [NodeKey] -&gt; NodeKey -&gt; Bool
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#flip"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">NodeKey -&gt; [NodeKey] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#elem"><span class="hs-identifier hs-var">elem</span></a></span><span> </span><span class="annot"><span class="annottext">([NodeKey] -&gt; NodeKey -&gt; Bool) -&gt; [NodeKey] -&gt; NodeKey -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; ModSummary -&gt; [NodeKey]
</span><a href="GHC.Driver.Make.html#unfilteredEdges"><span class="hs-identifier hs-var">unfilteredEdges</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203569"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[NodeKey]
</span><a href="#local-6989586621681203570"><span class="hs-identifier hs-var">ms</span></a></span><span>
</span><span id="line-1400"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; NodeKey
</span><a href="GHC.Driver.Make.html#mkHomeBuildModule"><span class="hs-identifier hs-var">mkHomeBuildModule</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203569"><span class="hs-identifier hs-var">mod</span></a></span><span class="annot"><span class="annottext">NodeKey -&gt; [NodeKey] -&gt; [NodeKey]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span class="annot"><span class="annottext">[NodeKey]
</span><a href="#local-6989586621681203570"><span class="hs-identifier hs-var">ms</span></a></span><span>
</span><span id="line-1401"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[NodeKey]
</span><a href="#local-6989586621681203570"><span class="hs-identifier hs-var">ms</span></a></span><span>
</span><span id="line-1402"></span><span>        </span><span class="annot"><a href="#local-6989586621681203571"><span class="hs-identifier hs-var">sum_deps</span></a></span><span> </span><span id="local-6989586621681203566"><span class="annot"><span class="annottext">[NodeKey]
</span><a href="#local-6989586621681203566"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="annot"><span class="annottext">SCC ModSummary
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[NodeKey]
</span><a href="#local-6989586621681203566"><span class="hs-identifier hs-var">ms</span></a></span><span>
</span><span id="line-1403"></span><span>        </span><span id="local-6989586621681203564"><span class="annot"><span class="annottext">dep_closure :: [NodeKey]
</span><a href="#local-6989586621681203564"><span class="hs-identifier hs-var hs-var">dep_closure</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([NodeKey] -&gt; SCC ModSummary -&gt; [NodeKey])
-&gt; [NodeKey] -&gt; [SCC ModSummary] -&gt; [NodeKey]
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base/src/Data.Foldable.html#foldl%27"><span class="hs-identifier hs-var">foldl'</span></a></span><span> </span><span class="annot"><span class="annottext">[NodeKey] -&gt; SCC ModSummary -&gt; [NodeKey]
</span><a href="#local-6989586621681203571"><span class="hs-identifier hs-var">sum_deps</span></a></span><span> </span><span class="annot"><span class="annottext">[NodeKey]
</span><a href="#local-6989586621681203583"><span class="hs-identifier hs-var">this_mods</span></a></span><span> </span><span class="annot"><span class="annottext">[SCC ModSummary]
</span><a href="#local-6989586621681203580"><span class="hs-identifier hs-var">mods</span></a></span><span>
</span><span id="line-1404"></span><span>        </span><span id="local-6989586621681203562"><span class="annot"><span class="annottext">dropped_ms :: [NodeKey]
</span><a href="#local-6989586621681203562"><span class="hs-identifier hs-var hs-var">dropped_ms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; [NodeKey] -&gt; [NodeKey]
forall a. Int -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.List.html#drop"><span class="hs-identifier hs-var">drop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[NodeKey] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[NodeKey]
</span><a href="#local-6989586621681203583"><span class="hs-identifier hs-var">this_mods</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[NodeKey] -&gt; [NodeKey]
forall a. [a] -&gt; [a]
</span><a href="../../base/src/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="annot"><span class="annottext">[NodeKey]
</span><a href="#local-6989586621681203564"><span class="hs-identifier hs-var">dep_closure</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1405"></span><span>        </span><span id="local-6989586621681203557"><span class="annot"><span class="annottext">prunable :: SCC ModSummary -&gt; Bool
</span><a href="#local-6989586621681203557"><span class="hs-identifier hs-var hs-var">prunable</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../containers/src/Data.Graph.html#AcyclicSCC"><span class="hs-identifier hs-type">AcyclicSCC</span></a></span><span> </span><span id="local-6989586621681203556"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203556"><span class="hs-identifier hs-var">mod</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NodeKey -&gt; [NodeKey] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#elem"><span class="hs-identifier hs-var">elem</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; NodeKey
</span><a href="GHC.Driver.Make.html#mkHomeBuildModule"><span class="hs-identifier hs-var">mkHomeBuildModule</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203556"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[NodeKey]
</span><a href="#local-6989586621681203564"><span class="hs-identifier hs-var">dep_closure</span></a></span><span>
</span><span id="line-1406"></span><span>        </span><span class="annot"><a href="#local-6989586621681203557"><span class="hs-identifier hs-var">prunable</span></a></span><span> </span><span class="annot"><span class="annottext">SCC ModSummary
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1407"></span><span>        </span><span id="local-6989586621681203555"><span class="annot"><span class="annottext">mods' :: [SCC ModSummary]
</span><a href="#local-6989586621681203555"><span class="hs-identifier hs-var hs-var">mods'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SCC ModSummary -&gt; Bool) -&gt; [SCC ModSummary] -&gt; [SCC ModSummary]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool)
-&gt; (SCC ModSummary -&gt; Bool) -&gt; SCC ModSummary -&gt; Bool
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">SCC ModSummary -&gt; Bool
</span><a href="#local-6989586621681203557"><span class="hs-identifier hs-var">prunable</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[SCC ModSummary]
</span><a href="#local-6989586621681203580"><span class="hs-identifier hs-var">mods</span></a></span><span>
</span><span id="line-1408"></span><span>        </span><span id="local-6989586621681203552"><span class="annot"><span class="annottext">nmods' :: Int
</span><a href="#local-6989586621681203552"><span class="hs-identifier hs-var hs-var">nmods'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681203578"><span class="hs-identifier hs-var">nmods</span></a></span><span> </span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base/src/GHC.Num.html#-"><span class="hs-glyph hs-var">-</span></a></span><span> </span><span class="annot"><span class="annottext">[NodeKey] -&gt; Int
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Int
</span><a href="../../base/src/Data.Foldable.html#length"><span class="hs-identifier hs-var">length</span></a></span><span> </span><span class="annot"><span class="annottext">[NodeKey]
</span><a href="#local-6989586621681203562"><span class="hs-identifier hs-var">dropped_ms</span></a></span><span>
</span><span id="line-1409"></span><span>
</span><span id="line-1410"></span><span>    </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[NodeKey] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[NodeKey]
</span><a href="#local-6989586621681203562"><span class="hs-identifier hs-var">dropped_ms</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1411"></span><span>        </span><span id="local-6989586621681203551"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203551"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m DynFlags
forall (m :: * -&gt; *). GhcMonad m =&gt; m DynFlags
</span><a href="GHC.Driver.Monad.html#getSessionDynFlags"><span class="hs-identifier hs-var">getSessionDynFlags</span></a></span><span>
</span><span id="line-1412"></span><span>        </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#fatalErrorMsg"><span class="hs-identifier hs-var">fatalErrorMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203551"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ModuleName] -&gt; SDoc
</span><a href="GHC.Driver.Make.html#keepGoingPruneErr"><span class="hs-identifier hs-var">keepGoingPruneErr</span></a></span><span> </span><span class="annot"><span class="annottext">([ModuleName] -&gt; SDoc) -&gt; [ModuleName] -&gt; SDoc
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NodeKey -&gt; ModuleName
forall mod. GenWithIsBoot mod -&gt; mod
</span><a href="GHC.Unit.Types.html#gwib_mod"><span class="hs-identifier hs-var hs-var">gwib_mod</span></a></span><span> </span><span class="annot"><span class="annottext">(NodeKey -&gt; ModuleName) -&gt; [NodeKey] -&gt; [ModuleName]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[NodeKey]
</span><a href="#local-6989586621681203562"><span class="hs-identifier hs-var">dropped_ms</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1413"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SuccessFlag
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681203548"><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621681203548"><span class="hs-identifier hs-var">done'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HomePackageTable
-&gt; ModuleGraph
-&gt; [SCC ModSummary]
-&gt; Int
-&gt; Int
-&gt; [GenUnit UnitId]
-&gt; UniqSet ModuleName
-&gt; m (SuccessFlag, ModuleGraph)
forall (m :: * -&gt; *).
GhcMonad m =&gt;
HomePackageTable
-&gt; ModuleGraph
-&gt; [SCC ModSummary]
-&gt; Int
-&gt; Int
-&gt; [GenUnit UnitId]
-&gt; UniqSet ModuleName
-&gt; m (SuccessFlag, ModuleGraph)
</span><a href="#local-6989586621681203605"><span class="hs-identifier hs-var">upsweep'</span></a></span><span> </span><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621681203582"><span class="hs-identifier hs-var">old_hpt</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621681203581"><span class="hs-identifier hs-var">done</span></a></span><span> </span><span class="annot"><span class="annottext">[SCC ModSummary]
</span><a href="#local-6989586621681203555"><span class="hs-identifier hs-var">mods'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681203579"><span class="hs-identifier hs-var">mod_index</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681203552"><span class="hs-identifier hs-var">nmods'</span></a></span><span> </span><span class="annot"><span class="annottext">[GenUnit UnitId]
</span><a href="#local-6989586621681203577"><span class="hs-identifier hs-var">uids_to_check</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSet ModuleName
</span><a href="#local-6989586621681203576"><span class="hs-identifier hs-var">done_holes</span></a></span><span>
</span><span id="line-1414"></span><span>    </span><span class="annot"><span class="annottext">(SuccessFlag, ModuleGraph) -&gt; m (SuccessFlag, ModuleGraph)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SuccessFlag
</span><a href="GHC.Types.Basic.html#Failed"><span class="hs-identifier hs-var">Failed</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621681203548"><span class="hs-identifier hs-var">done'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1415"></span><span>
</span><span id="line-1416"></span><span>  </span><span id="local-6989586621681205040"><span class="annot"><a href="#local-6989586621681203605"><span class="hs-identifier hs-type">upsweep'</span></a></span><span>
</span><span id="line-1417"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Monad.html#GhcMonad"><span class="hs-identifier hs-type">GhcMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681205040"><span class="hs-identifier hs-type">m</span></a></span><span>
</span><span id="line-1418"></span><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HomePackageTable"><span class="hs-identifier hs-type">HomePackageTable</span></a></span><span>
</span><span id="line-1419"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModuleGraph"><span class="hs-identifier hs-type">ModuleGraph</span></a></span><span>
</span><span id="line-1420"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../containers/src/Data.Graph.html#SCC"><span class="hs-identifier hs-type">SCC</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1421"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-1422"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-1423"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Types.html#Unit"><span class="hs-identifier hs-type">Unit</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1424"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.Unique.Set.html#UniqSet"><span class="hs-identifier hs-type">UniqSet</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span>
</span><span id="line-1425"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681205040"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.Basic.html#SuccessFlag"><span class="hs-identifier hs-type">SuccessFlag</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModuleGraph"><span class="hs-identifier hs-type">ModuleGraph</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-1426"></span><span>  </span><span id="local-6989586621681203605"><span class="annot"><span class="annottext">upsweep' :: forall (m :: * -&gt; *).
GhcMonad m =&gt;
HomePackageTable
-&gt; ModuleGraph
-&gt; [SCC ModSummary]
-&gt; Int
-&gt; Int
-&gt; [GenUnit UnitId]
-&gt; UniqSet ModuleName
-&gt; m (SuccessFlag, ModuleGraph)
</span><a href="#local-6989586621681203605"><span class="hs-identifier hs-var hs-var">upsweep'</span></a></span></span><span> </span><span id="local-6989586621681203480"><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621681203480"><span class="hs-identifier hs-var">_old_hpt</span></a></span></span><span> </span><span id="local-6989586621681203479"><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621681203479"><span class="hs-identifier hs-var">done</span></a></span></span><span>
</span><span id="line-1427"></span><span>     </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681203478"><span class="annot"><span class="annottext">[GenUnit UnitId]
</span><a href="#local-6989586621681203478"><span class="hs-identifier hs-var">uids_to_check</span></a></span></span><span> </span><span class="annot"><span class="annottext">UniqSet ModuleName
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-1428"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621681203477"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203477"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m HscEnv
forall (m :: * -&gt; *). GhcMonad m =&gt; m HscEnv
</span><a href="GHC.Driver.Monad.html#getSession"><span class="hs-identifier hs-var">getSession</span></a></span><span>
</span><span id="line-1429"></span><span>        </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; (Hsc () -&gt; IO ()) -&gt; Hsc () -&gt; m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Hsc () -&gt; IO ()
forall a. HscEnv -&gt; Hsc a -&gt; IO a
</span><a href="GHC.Driver.Types.html#runHsc"><span class="hs-identifier hs-var">runHsc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203477"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(Hsc () -&gt; m ()) -&gt; Hsc () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(GenUnit UnitId -&gt; Hsc ()) -&gt; [GenUnit UnitId] -&gt; Hsc ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><a href="../../base/src/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO (Messages, Maybe ()) -&gt; Hsc ()
forall a. IO (Messages, Maybe a) -&gt; Hsc a
</span><a href="GHC.Driver.Main.html#ioMsgMaybe"><span class="hs-identifier hs-var">ioMsgMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (Messages, Maybe ()) -&gt; Hsc ())
-&gt; (GenUnit UnitId -&gt; IO (Messages, Maybe ()))
-&gt; GenUnit UnitId
-&gt; Hsc ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; GenUnit UnitId -&gt; IO (Messages, Maybe ())
</span><a href="GHC.Tc.Utils.Backpack.html#tcRnCheckUnit"><span class="hs-identifier hs-var">tcRnCheckUnit</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203477"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[GenUnit UnitId]
</span><a href="#local-6989586621681203478"><span class="hs-identifier hs-var">uids_to_check</span></a></span><span>
</span><span id="line-1430"></span><span>        </span><span class="annot"><span class="annottext">(SuccessFlag, ModuleGraph) -&gt; m (SuccessFlag, ModuleGraph)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SuccessFlag
</span><a href="GHC.Types.Basic.html#Succeeded"><span class="hs-identifier hs-var">Succeeded</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621681203479"><span class="hs-identifier hs-var">done</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1431"></span><span>
</span><span id="line-1432"></span><span>  </span><span class="annot"><a href="#local-6989586621681203605"><span class="hs-identifier hs-var">upsweep'</span></a></span><span> </span><span id="local-6989586621681203473"><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621681203473"><span class="hs-identifier hs-var">_old_hpt</span></a></span></span><span> </span><span id="local-6989586621681203472"><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621681203472"><span class="hs-identifier hs-var">done</span></a></span></span><span>
</span><span id="line-1433"></span><span>     </span><span class="hs-special">(</span><span class="annot"><a href="../../containers/src/Data.Graph.html#CyclicSCC"><span class="hs-identifier hs-type">CyclicSCC</span></a></span><span> </span><span id="local-6989586621681203471"><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681203471"><span class="hs-identifier hs-var">ms</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681203470"><span class="annot"><span class="annottext">[SCC ModSummary]
</span><a href="#local-6989586621681203470"><span class="hs-identifier hs-var">mods</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681203469"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681203469"><span class="hs-identifier hs-var">mod_index</span></a></span></span><span> </span><span id="local-6989586621681203468"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681203468"><span class="hs-identifier hs-var">nmods</span></a></span></span><span> </span><span id="local-6989586621681203467"><span class="annot"><span class="annottext">[GenUnit UnitId]
</span><a href="#local-6989586621681203467"><span class="hs-identifier hs-var">uids_to_check</span></a></span></span><span> </span><span id="local-6989586621681203466"><span class="annot"><span class="annottext">UniqSet ModuleName
</span><a href="#local-6989586621681203466"><span class="hs-identifier hs-var">done_holes</span></a></span></span><span>
</span><span id="line-1434"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621681203465"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203465"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m DynFlags
forall (m :: * -&gt; *). GhcMonad m =&gt; m DynFlags
</span><a href="GHC.Driver.Monad.html#getSessionDynFlags"><span class="hs-identifier hs-var">getSessionDynFlags</span></a></span><span>
</span><span id="line-1435"></span><span>        </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#fatalErrorMsg"><span class="hs-identifier hs-var">fatalErrorMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203465"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ModSummary] -&gt; SDoc
</span><a href="GHC.Driver.Make.html#cyclicModuleErr"><span class="hs-identifier hs-var">cyclicModuleErr</span></a></span><span> </span><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681203471"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1436"></span><span>        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_KeepGoing"><span class="hs-identifier hs-var">Opt_KeepGoing</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203465"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1437"></span><span>          </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[NodeKey]
-&gt; HomePackageTable
-&gt; ModuleGraph
-&gt; [SCC ModSummary]
-&gt; Int
-&gt; Int
-&gt; [GenUnit UnitId]
-&gt; UniqSet ModuleName
-&gt; m (SuccessFlag, ModuleGraph)
forall {m :: * -&gt; *}.
GhcMonad m =&gt;
[NodeKey]
-&gt; HomePackageTable
-&gt; ModuleGraph
-&gt; [SCC ModSummary]
-&gt; Int
-&gt; Int
-&gt; [GenUnit UnitId]
-&gt; UniqSet ModuleName
-&gt; m (SuccessFlag, ModuleGraph)
</span><a href="#local-6989586621681203584"><span class="hs-identifier hs-var">keep_going</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; NodeKey
</span><a href="GHC.Driver.Make.html#mkHomeBuildModule"><span class="hs-identifier hs-var">mkHomeBuildModule</span></a></span><span> </span><span class="annot"><span class="annottext">(ModSummary -&gt; NodeKey) -&gt; [ModSummary] -&gt; [NodeKey]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681203471"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621681203613"><span class="hs-identifier hs-var">old_hpt</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621681203472"><span class="hs-identifier hs-var">done</span></a></span><span> </span><span class="annot"><span class="annottext">[SCC ModSummary]
</span><a href="#local-6989586621681203470"><span class="hs-identifier hs-var">mods</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681203469"><span class="hs-identifier hs-var">mod_index</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681203468"><span class="hs-identifier hs-var">nmods</span></a></span><span>
</span><span id="line-1438"></span><span>                          </span><span class="annot"><span class="annottext">[GenUnit UnitId]
</span><a href="#local-6989586621681203467"><span class="hs-identifier hs-var">uids_to_check</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSet ModuleName
</span><a href="#local-6989586621681203466"><span class="hs-identifier hs-var">done_holes</span></a></span><span>
</span><span id="line-1439"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">(SuccessFlag, ModuleGraph) -&gt; m (SuccessFlag, ModuleGraph)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SuccessFlag
</span><a href="GHC.Types.Basic.html#Failed"><span class="hs-identifier hs-var">Failed</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621681203472"><span class="hs-identifier hs-var">done</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1440"></span><span>
</span><span id="line-1441"></span><span>  </span><span class="annot"><a href="#local-6989586621681203605"><span class="hs-identifier hs-var">upsweep'</span></a></span><span> </span><span id="local-6989586621681203463"><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621681203463"><span class="hs-identifier hs-var">old_hpt</span></a></span></span><span> </span><span id="local-6989586621681203462"><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621681203462"><span class="hs-identifier hs-var">done</span></a></span></span><span>
</span><span id="line-1442"></span><span>     </span><span class="hs-special">(</span><span class="annot"><a href="../../containers/src/Data.Graph.html#AcyclicSCC"><span class="hs-identifier hs-type">AcyclicSCC</span></a></span><span> </span><span id="local-6989586621681203461"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203461"><span class="hs-identifier hs-var">mod</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681203460"><span class="annot"><span class="annottext">[SCC ModSummary]
</span><a href="#local-6989586621681203460"><span class="hs-identifier hs-var">mods</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681203459"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681203459"><span class="hs-identifier hs-var">mod_index</span></a></span></span><span> </span><span id="local-6989586621681203458"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681203458"><span class="hs-identifier hs-var">nmods</span></a></span></span><span> </span><span id="local-6989586621681203457"><span class="annot"><span class="annottext">[GenUnit UnitId]
</span><a href="#local-6989586621681203457"><span class="hs-identifier hs-var">uids_to_check</span></a></span></span><span> </span><span id="local-6989586621681203456"><span class="annot"><span class="annottext">UniqSet ModuleName
</span><a href="#local-6989586621681203456"><span class="hs-identifier hs-var">done_holes</span></a></span></span><span>
</span><span id="line-1443"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-comment">-- putStrLn (&quot;UPSWEEP_MOD: hpt = &quot; ++</span><span>
</span><span id="line-1444"></span><span>        </span><span class="hs-comment">--           show (map (moduleUserString.moduleName.mi_module.hm_iface)</span><span>
</span><span id="line-1445"></span><span>        </span><span class="hs-comment">--                     (moduleEnvElts (hsc_HPT hsc_env)))</span><span>
</span><span id="line-1446"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681203453"><span class="annot"><span class="annottext">logger :: p -&gt; Maybe SourceError -&gt; m ()
</span><a href="#local-6989586621681203453"><span class="hs-identifier hs-var hs-var">logger</span></a></span></span><span> </span><span id="local-6989586621681203452"><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621681203452"><span class="hs-identifier hs-var">_mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe SourceError -&gt; m ()
WarnErrLogger
</span><a href="GHC.Driver.Monad.html#defaultWarnErrLogger"><span class="hs-identifier hs-var">defaultWarnErrLogger</span></a></span><span>
</span><span id="line-1447"></span><span>
</span><span id="line-1448"></span><span>        </span><span id="local-6989586621681203450"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203450"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m HscEnv
forall (m :: * -&gt; *). GhcMonad m =&gt; m HscEnv
</span><a href="GHC.Driver.Monad.html#getSession"><span class="hs-identifier hs-var">getSession</span></a></span><span>
</span><span id="line-1449"></span><span>
</span><span id="line-1450"></span><span>        </span><span class="hs-comment">-- TODO: Cache this, so that we don't repeatedly re-check</span><span>
</span><span id="line-1451"></span><span>        </span><span class="hs-comment">-- our imports when you run --make.</span><span>
</span><span id="line-1452"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681203449"><span class="annot"><span class="annottext">[GenUnit UnitId]
</span><a href="#local-6989586621681203449"><span class="hs-identifier hs-var">ready_uids</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681203448"><span class="annot"><span class="annottext">[GenUnit UnitId]
</span><a href="#local-6989586621681203448"><span class="hs-identifier hs-var">uids_to_check'</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-1453"></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(GenUnit UnitId -&gt; Bool)
-&gt; [GenUnit UnitId] -&gt; ([GenUnit UnitId], [GenUnit UnitId])
forall a. (a -&gt; Bool) -&gt; [a] -&gt; ([a], [a])
</span><a href="../../base/src/Data.OldList.html#partition"><span class="hs-identifier hs-var">partition</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681203447"><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681203447"><span class="hs-identifier hs-var">uid</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UniqDSet ModuleName -&gt; Bool
forall a. UniqDSet a -&gt; Bool
</span><a href="GHC.Types.Unique.DSet.html#isEmptyUniqDSet"><span class="hs-identifier hs-var">isEmptyUniqDSet</span></a></span><span>
</span><span id="line-1454"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenUnit UnitId -&gt; UniqDSet ModuleName
forall u. GenUnit u -&gt; UniqDSet ModuleName
</span><a href="GHC.Unit.Types.html#unitFreeModuleHoles"><span class="hs-identifier hs-var">unitFreeModuleHoles</span></a></span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId
</span><a href="#local-6989586621681203447"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="annot"><span class="annottext">UniqDSet ModuleName -&gt; UniqSet ModuleName -&gt; UniqDSet ModuleName
forall a. UniqDSet a -&gt; UniqSet a -&gt; UniqDSet a
</span><a href="GHC.Types.Unique.DSet.html#uniqDSetMinusUniqSet"><span class="hs-operator hs-var">`uniqDSetMinusUniqSet`</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSet ModuleName
</span><a href="#local-6989586621681203456"><span class="hs-identifier hs-var">done_holes</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1455"></span><span>                     </span><span class="annot"><span class="annottext">[GenUnit UnitId]
</span><a href="#local-6989586621681203457"><span class="hs-identifier hs-var">uids_to_check</span></a></span><span>
</span><span id="line-1456"></span><span>            </span><span id="local-6989586621681203441"><span class="annot"><span class="annottext">done_holes' :: UniqSet ModuleName
</span><a href="#local-6989586621681203441"><span class="hs-identifier hs-var hs-var">done_holes'</span></a></span></span><span>
</span><span id="line-1457"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; HscSource
</span><a href="GHC.Driver.Types.html#ms_hsc_src"><span class="hs-identifier hs-var hs-var">ms_hsc_src</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203461"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">HscSource -&gt; HscSource -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="GHC.Driver.Phases.html#HsigFile"><span class="hs-identifier hs-var">HsigFile</span></a></span><span>
</span><span id="line-1458"></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UniqSet ModuleName -&gt; ModuleName -&gt; UniqSet ModuleName
forall a. Uniquable a =&gt; UniqSet a -&gt; a -&gt; UniqSet a
</span><a href="GHC.Types.Unique.Set.html#addOneToUniqSet"><span class="hs-identifier hs-var">addOneToUniqSet</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSet ModuleName
</span><a href="#local-6989586621681203456"><span class="hs-identifier hs-var">done_holes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; ModuleName
</span><a href="GHC.Driver.Types.html#ms_mod_name"><span class="hs-identifier hs-var">ms_mod_name</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203461"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1459"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UniqSet ModuleName
</span><a href="#local-6989586621681203456"><span class="hs-identifier hs-var">done_holes</span></a></span><span>
</span><span id="line-1460"></span><span>        </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; (Hsc () -&gt; IO ()) -&gt; Hsc () -&gt; m ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; Hsc () -&gt; IO ()
forall a. HscEnv -&gt; Hsc a -&gt; IO a
</span><a href="GHC.Driver.Types.html#runHsc"><span class="hs-identifier hs-var">runHsc</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203450"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(Hsc () -&gt; m ()) -&gt; Hsc () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(GenUnit UnitId -&gt; Hsc ()) -&gt; [GenUnit UnitId] -&gt; Hsc ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m ()
</span><a href="../../base/src/Data.Foldable.html#mapM_"><span class="hs-identifier hs-var">mapM_</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO (Messages, Maybe ()) -&gt; Hsc ()
forall a. IO (Messages, Maybe a) -&gt; Hsc a
</span><a href="GHC.Driver.Main.html#ioMsgMaybe"><span class="hs-identifier hs-var">ioMsgMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (Messages, Maybe ()) -&gt; Hsc ())
-&gt; (GenUnit UnitId -&gt; IO (Messages, Maybe ()))
-&gt; GenUnit UnitId
-&gt; Hsc ()
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; GenUnit UnitId -&gt; IO (Messages, Maybe ())
</span><a href="GHC.Tc.Utils.Backpack.html#tcRnCheckUnit"><span class="hs-identifier hs-var">tcRnCheckUnit</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203450"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[GenUnit UnitId]
</span><a href="#local-6989586621681203449"><span class="hs-identifier hs-var">ready_uids</span></a></span><span>
</span><span id="line-1461"></span><span>
</span><span id="line-1462"></span><span>        </span><span class="hs-comment">-- Remove unwanted tmp files between compilations</span><span>
</span><span id="line-1463"></span><span>        </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; IO ()
</span><a href="#local-6989586621681203611"><span class="hs-identifier hs-var">cleanup</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203450"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1464"></span><span>
</span><span id="line-1465"></span><span>        </span><span class="hs-comment">-- Get ready to tie the knot</span><span>
</span><span id="line-1466"></span><span>        </span><span id="local-6989586621681203437"><span class="annot"><span class="annottext">IORef (NameEnv TyThing)
</span><a href="#local-6989586621681203437"><span class="hs-identifier hs-var">type_env_var</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (IORef (NameEnv TyThing)) -&gt; m (IORef (NameEnv TyThing))
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (IORef (NameEnv TyThing)) -&gt; m (IORef (NameEnv TyThing)))
-&gt; IO (IORef (NameEnv TyThing)) -&gt; m (IORef (NameEnv TyThing))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NameEnv TyThing -&gt; IO (IORef (NameEnv TyThing))
forall a. a -&gt; IO (IORef a)
</span><a href="../../base/src/GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a></span><span> </span><span class="annot"><span class="annottext">NameEnv TyThing
forall a. NameEnv a
</span><a href="GHC.Types.Name.Env.html#emptyNameEnv"><span class="hs-identifier hs-var">emptyNameEnv</span></a></span><span>
</span><span id="line-1467"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681203436"><span class="annot"><span class="annottext">hsc_env1 :: HscEnv
</span><a href="#local-6989586621681203436"><span class="hs-identifier hs-var hs-var">hsc_env1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203450"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hsc_type_env_var :: Maybe (Module, IORef (NameEnv TyThing))
</span><a href="GHC.Driver.Types.html#hsc_type_env_var"><span class="hs-identifier hs-var">hsc_type_env_var</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1468"></span><span>                                    </span><span class="annot"><span class="annottext">(Module, IORef (NameEnv TyThing))
-&gt; Maybe (Module, IORef (NameEnv TyThing))
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; Module
</span><a href="GHC.Driver.Types.html#ms_mod"><span class="hs-identifier hs-var hs-var">ms_mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203461"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IORef (NameEnv TyThing)
</span><a href="#local-6989586621681203437"><span class="hs-identifier hs-var">type_env_var</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1469"></span><span>        </span><span class="annot"><span class="annottext">HscEnv -&gt; m ()
forall (m :: * -&gt; *). GhcMonad m =&gt; HscEnv -&gt; m ()
</span><a href="GHC.Driver.Monad.html#setSession"><span class="hs-identifier hs-var">setSession</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203436"><span class="hs-identifier hs-var">hsc_env1</span></a></span><span>
</span><span id="line-1470"></span><span>
</span><span id="line-1471"></span><span>        </span><span class="hs-comment">-- Lazily reload the HPT modules participating in the loop.</span><span>
</span><span id="line-1472"></span><span>        </span><span class="hs-comment">-- See Note [Tying the knot]--if we don't throw out the old HPT</span><span>
</span><span id="line-1473"></span><span>        </span><span class="hs-comment">-- and reinitalize the knot-tying process, anything that was forced</span><span>
</span><span id="line-1474"></span><span>        </span><span class="hs-comment">-- while we were previously typechecking won't get updated, this</span><span>
</span><span id="line-1475"></span><span>        </span><span class="hs-comment">-- was bug #12035.</span><span>
</span><span id="line-1476"></span><span>        </span><span id="local-6989586621681203435"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203435"><span class="hs-identifier hs-var">hsc_env2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO HscEnv -&gt; m HscEnv
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO HscEnv -&gt; m HscEnv) -&gt; IO HscEnv -&gt; m HscEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; ModSummary -&gt; ModuleGraph -&gt; IO HscEnv
</span><a href="GHC.Driver.Make.html#reTypecheckLoop"><span class="hs-identifier hs-var">reTypecheckLoop</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203436"><span class="hs-identifier hs-var">hsc_env1</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203461"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621681203462"><span class="hs-identifier hs-var">done</span></a></span><span>
</span><span id="line-1477"></span><span>        </span><span class="annot"><span class="annottext">HscEnv -&gt; m ()
forall (m :: * -&gt; *). GhcMonad m =&gt; HscEnv -&gt; m ()
</span><a href="GHC.Driver.Monad.html#setSession"><span class="hs-identifier hs-var">setSession</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203435"><span class="hs-identifier hs-var">hsc_env2</span></a></span><span>
</span><span id="line-1478"></span><span>
</span><span id="line-1479"></span><span>        </span><span id="local-6989586621681203433"><span class="annot"><span class="annottext">Maybe HomeModInfo
</span><a href="#local-6989586621681203433"><span class="hs-identifier hs-var">mb_mod_info</span></a></span></span><span>
</span><span id="line-1480"></span><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(SourceError -&gt; m (Maybe HomeModInfo))
-&gt; m (Maybe HomeModInfo) -&gt; m (Maybe HomeModInfo)
forall (m :: * -&gt; *) a.
MonadCatch m =&gt;
(SourceError -&gt; m a) -&gt; m a -&gt; m a
</span><a href="GHC.Driver.Types.html#handleSourceError"><span class="hs-identifier hs-var">handleSourceError</span></a></span><span>
</span><span id="line-1481"></span><span>                   </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681203432"><span class="annot"><span class="annottext">SourceError
</span><a href="#local-6989586621681203432"><span class="hs-identifier hs-var">err</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; Maybe SourceError -&gt; m ()
forall {m :: * -&gt; *} {p}.
GhcMonad m =&gt;
p -&gt; Maybe SourceError -&gt; m ()
</span><a href="#local-6989586621681203453"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203461"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SourceError -&gt; Maybe SourceError
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">SourceError
</span><a href="#local-6989586621681203432"><span class="hs-identifier hs-var">err</span></a></span><span class="hs-special">)</span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">Maybe HomeModInfo -&gt; m (Maybe HomeModInfo)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe HomeModInfo
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m (Maybe HomeModInfo) -&gt; m (Maybe HomeModInfo))
-&gt; m (Maybe HomeModInfo) -&gt; m (Maybe HomeModInfo)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1482"></span><span>                 </span><span id="local-6989586621681203431"><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621681203431"><span class="hs-identifier hs-var">mod_info</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO HomeModInfo -&gt; m HomeModInfo
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO HomeModInfo -&gt; m HomeModInfo)
-&gt; IO HomeModInfo -&gt; m HomeModInfo
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; Maybe Messager
-&gt; HomePackageTable
-&gt; (UniqSet ModuleName, UniqSet ModuleName)
-&gt; ModSummary
-&gt; Int
-&gt; Int
-&gt; IO HomeModInfo
</span><a href="GHC.Driver.Make.html#upsweep_mod"><span class="hs-identifier hs-var">upsweep_mod</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203435"><span class="hs-identifier hs-var">hsc_env2</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Messager
</span><a href="#local-6989586621681203614"><span class="hs-identifier hs-var">mHscMessage</span></a></span><span> </span><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621681203463"><span class="hs-identifier hs-var">old_hpt</span></a></span><span> </span><span class="annot"><span class="annottext">(UniqSet ModuleName, UniqSet ModuleName)
</span><a href="#local-6989586621681203612"><span class="hs-identifier hs-var">stable_mods</span></a></span><span>
</span><span id="line-1483"></span><span>                                                  </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203461"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681203459"><span class="hs-identifier hs-var">mod_index</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681203458"><span class="hs-identifier hs-var">nmods</span></a></span><span>
</span><span id="line-1484"></span><span>                 </span><span class="annot"><span class="annottext">ModSummary -&gt; Maybe SourceError -&gt; m ()
forall {m :: * -&gt; *} {p}.
GhcMonad m =&gt;
p -&gt; Maybe SourceError -&gt; m ()
</span><a href="#local-6989586621681203453"><span class="hs-identifier hs-var">logger</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203461"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe SourceError
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-comment">-- log warnings</span><span>
</span><span id="line-1485"></span><span>                 </span><span class="annot"><span class="annottext">Maybe HomeModInfo -&gt; m (Maybe HomeModInfo)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HomeModInfo -&gt; Maybe HomeModInfo
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621681203431"><span class="hs-identifier hs-var">mod_info</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1486"></span><span>
</span><span id="line-1487"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe HomeModInfo
</span><a href="#local-6989586621681203433"><span class="hs-identifier hs-var">mb_mod_info</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1488"></span><span>          </span><span class="annot"><span class="annottext">Maybe HomeModInfo
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1489"></span><span>                </span><span id="local-6989586621681203430"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203430"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m DynFlags
forall (m :: * -&gt; *). GhcMonad m =&gt; m DynFlags
</span><a href="GHC.Driver.Monad.html#getSessionDynFlags"><span class="hs-identifier hs-var">getSessionDynFlags</span></a></span><span>
</span><span id="line-1490"></span><span>                </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_KeepGoing"><span class="hs-identifier hs-var">Opt_KeepGoing</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203430"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1491"></span><span>                  </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[NodeKey]
-&gt; HomePackageTable
-&gt; ModuleGraph
-&gt; [SCC ModSummary]
-&gt; Int
-&gt; Int
-&gt; [GenUnit UnitId]
-&gt; UniqSet ModuleName
-&gt; m (SuccessFlag, ModuleGraph)
forall {m :: * -&gt; *}.
GhcMonad m =&gt;
[NodeKey]
-&gt; HomePackageTable
-&gt; ModuleGraph
-&gt; [SCC ModSummary]
-&gt; Int
-&gt; Int
-&gt; [GenUnit UnitId]
-&gt; UniqSet ModuleName
-&gt; m (SuccessFlag, ModuleGraph)
</span><a href="#local-6989586621681203584"><span class="hs-identifier hs-var">keep_going</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ModSummary -&gt; NodeKey
</span><a href="GHC.Driver.Make.html#mkHomeBuildModule"><span class="hs-identifier hs-var">mkHomeBuildModule</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203461"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621681203463"><span class="hs-identifier hs-var">old_hpt</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621681203462"><span class="hs-identifier hs-var">done</span></a></span><span> </span><span class="annot"><span class="annottext">[SCC ModSummary]
</span><a href="#local-6989586621681203460"><span class="hs-identifier hs-var">mods</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681203459"><span class="hs-identifier hs-var">mod_index</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681203458"><span class="hs-identifier hs-var">nmods</span></a></span><span>
</span><span id="line-1492"></span><span>                                  </span><span class="annot"><span class="annottext">[GenUnit UnitId]
</span><a href="#local-6989586621681203457"><span class="hs-identifier hs-var">uids_to_check</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSet ModuleName
</span><a href="#local-6989586621681203456"><span class="hs-identifier hs-var">done_holes</span></a></span><span>
</span><span id="line-1493"></span><span>                  </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">(SuccessFlag, ModuleGraph) -&gt; m (SuccessFlag, ModuleGraph)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SuccessFlag
</span><a href="GHC.Types.Basic.html#Failed"><span class="hs-identifier hs-var">Failed</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621681203462"><span class="hs-identifier hs-var">done</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1494"></span><span>          </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681203429"><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621681203429"><span class="hs-identifier hs-var">mod_info</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1495"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681203428"><span class="annot"><span class="annottext">this_mod :: ModuleName
</span><a href="#local-6989586621681203428"><span class="hs-identifier hs-var hs-var">this_mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; ModuleName
</span><a href="GHC.Driver.Types.html#ms_mod_name"><span class="hs-identifier hs-var">ms_mod_name</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203461"><span class="hs-identifier hs-var">mod</span></a></span><span>
</span><span id="line-1496"></span><span>
</span><span id="line-1497"></span><span>                        </span><span class="hs-comment">-- Add new info to hsc_env</span><span>
</span><span id="line-1498"></span><span>                    </span><span id="local-6989586621681203427"><span class="annot"><span class="annottext">hpt1 :: HomePackageTable
</span><a href="#local-6989586621681203427"><span class="hs-identifier hs-var hs-var">hpt1</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HomePackageTable -&gt; ModuleName -&gt; HomeModInfo -&gt; HomePackageTable
</span><a href="GHC.Driver.Types.html#addToHpt"><span class="hs-identifier hs-var">addToHpt</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; HomePackageTable
</span><a href="GHC.Driver.Types.html#hsc_HPT"><span class="hs-identifier hs-var hs-var">hsc_HPT</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203435"><span class="hs-identifier hs-var">hsc_env2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681203428"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621681203429"><span class="hs-identifier hs-var">mod_info</span></a></span><span>
</span><span id="line-1499"></span><span>                    </span><span id="local-6989586621681203426"><span class="annot"><span class="annottext">hsc_env3 :: HscEnv
</span><a href="#local-6989586621681203426"><span class="hs-identifier hs-var hs-var">hsc_env3</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203435"><span class="hs-identifier hs-var">hsc_env2</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hsc_HPT :: HomePackageTable
</span><a href="GHC.Driver.Types.html#hsc_HPT"><span class="hs-identifier hs-var">hsc_HPT</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621681203427"><span class="hs-identifier hs-var">hpt1</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">hsc_type_env_var :: Maybe (Module, IORef (NameEnv TyThing))
</span><a href="GHC.Driver.Types.html#hsc_type_env_var"><span class="hs-identifier hs-var">hsc_type_env_var</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Module, IORef (NameEnv TyThing))
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1500"></span><span>
</span><span id="line-1501"></span><span>                        </span><span class="hs-comment">-- Space-saving: delete the old HPT entry</span><span>
</span><span id="line-1502"></span><span>                        </span><span class="hs-comment">-- for mod BUT if mod is a hs-boot</span><span>
</span><span id="line-1503"></span><span>                        </span><span class="hs-comment">-- node, don't delete it.  For the</span><span>
</span><span id="line-1504"></span><span>                        </span><span class="hs-comment">-- interface, the HPT entry is probably for the</span><span>
</span><span id="line-1505"></span><span>                        </span><span class="hs-comment">-- main Haskell source file.  Deleting it</span><span>
</span><span id="line-1506"></span><span>                        </span><span class="hs-comment">-- would force the real module to be recompiled</span><span>
</span><span id="line-1507"></span><span>                        </span><span class="hs-comment">-- every time.</span><span>
</span><span id="line-1508"></span><span>                    </span><span id="local-6989586621681203425"><span class="annot"><span class="annottext">old_hpt1 :: HomePackageTable
</span><a href="#local-6989586621681203425"><span class="hs-identifier hs-var hs-var">old_hpt1</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; IsBootInterface
</span><a href="GHC.Driver.Types.html#isBootSummary"><span class="hs-identifier hs-var">isBootSummary</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203461"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1509"></span><span>                      </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="GHC.Unit.Types.html#IsBoot"><span class="hs-identifier hs-var">IsBoot</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621681203463"><span class="hs-identifier hs-var">old_hpt</span></a></span><span>
</span><span id="line-1510"></span><span>                      </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="GHC.Unit.Types.html#NotBoot"><span class="hs-identifier hs-var">NotBoot</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">HomePackageTable -&gt; ModuleName -&gt; HomePackageTable
</span><a href="GHC.Driver.Types.html#delFromHpt"><span class="hs-identifier hs-var">delFromHpt</span></a></span><span> </span><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621681203463"><span class="hs-identifier hs-var">old_hpt</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681203428"><span class="hs-identifier hs-var">this_mod</span></a></span><span>
</span><span id="line-1511"></span><span>
</span><span id="line-1512"></span><span>                    </span><span id="local-6989586621681203424"><span class="annot"><span class="annottext">done' :: ModuleGraph
</span><a href="#local-6989586621681203424"><span class="hs-identifier hs-var hs-var">done'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleGraph -&gt; ModSummary -&gt; ModuleGraph
</span><a href="GHC.Driver.Types.html#extendMG"><span class="hs-identifier hs-var">extendMG</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621681203462"><span class="hs-identifier hs-var">done</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203461"><span class="hs-identifier hs-var">mod</span></a></span><span>
</span><span id="line-1513"></span><span>
</span><span id="line-1514"></span><span>                        </span><span class="hs-comment">-- fixup our HomePackageTable after we've finished compiling</span><span>
</span><span id="line-1515"></span><span>                        </span><span class="hs-comment">-- a mutually-recursive loop.  We have to do this again</span><span>
</span><span id="line-1516"></span><span>                        </span><span class="hs-comment">-- to make sure we have the final unfoldings, which may</span><span>
</span><span id="line-1517"></span><span>                        </span><span class="hs-comment">-- not have been computed accurately in the previous</span><span>
</span><span id="line-1518"></span><span>                        </span><span class="hs-comment">-- retypecheck.</span><span>
</span><span id="line-1519"></span><span>                </span><span id="local-6989586621681203422"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203422"><span class="hs-identifier hs-var">hsc_env4</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO HscEnv -&gt; m HscEnv
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO HscEnv -&gt; m HscEnv) -&gt; IO HscEnv -&gt; m HscEnv
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; ModSummary -&gt; ModuleGraph -&gt; IO HscEnv
</span><a href="GHC.Driver.Make.html#reTypecheckLoop"><span class="hs-identifier hs-var">reTypecheckLoop</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203426"><span class="hs-identifier hs-var">hsc_env3</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203461"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621681203424"><span class="hs-identifier hs-var">done'</span></a></span><span>
</span><span id="line-1520"></span><span>                </span><span class="annot"><span class="annottext">HscEnv -&gt; m ()
forall (m :: * -&gt; *). GhcMonad m =&gt; HscEnv -&gt; m ()
</span><a href="GHC.Driver.Monad.html#setSession"><span class="hs-identifier hs-var">setSession</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203422"><span class="hs-identifier hs-var">hsc_env4</span></a></span><span>
</span><span id="line-1521"></span><span>
</span><span id="line-1522"></span><span>                        </span><span class="hs-comment">-- Add any necessary entries to the static pointer</span><span>
</span><span id="line-1523"></span><span>                        </span><span class="hs-comment">-- table. See Note [Grand plan for static forms] in</span><span>
</span><span id="line-1524"></span><span>                        </span><span class="hs-comment">-- GHC.Iface.Tidy.StaticPtrTable.</span><span>
</span><span id="line-1525"></span><span>                </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; HscTarget
</span><a href="GHC.Driver.Session.html#hscTarget"><span class="hs-identifier hs-var hs-var">hscTarget</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203422"><span class="hs-identifier hs-var">hsc_env4</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HscTarget -&gt; HscTarget -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">HscTarget
</span><a href="GHC.Driver.Session.html#HscInterpreted"><span class="hs-identifier hs-var">HscInterpreted</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(m () -&gt; m ()) -&gt; m () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1526"></span><span>                    </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; [SptEntry] -&gt; IO ()
</span><a href="GHC.Driver.Main.html#hscAddSptEntries"><span class="hs-identifier hs-var">hscAddSptEntries</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203422"><span class="hs-identifier hs-var">hsc_env4</span></a></span><span>
</span><span id="line-1527"></span><span>                                 </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">SptEntry
</span><a href="#local-6989586621681203418"><span class="hs-identifier hs-var">spt</span></a></span><span>
</span><span id="line-1528"></span><span>                                 </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681203417"><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621681203417"><span class="hs-identifier hs-var">linkable</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe Linkable -&gt; [Maybe Linkable]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe Linkable -&gt; [Maybe Linkable])
-&gt; Maybe Linkable -&gt; [Maybe Linkable]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModInfo -&gt; Maybe Linkable
</span><a href="GHC.Driver.Types.html#hm_linkable"><span class="hs-identifier hs-var hs-var">hm_linkable</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621681203429"><span class="hs-identifier hs-var">mod_info</span></a></span><span>
</span><span id="line-1529"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span id="local-6989586621681203416"><span class="annot"><span class="annottext">Unlinked
</span><a href="#local-6989586621681203416"><span class="hs-identifier hs-var">unlinked</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Linkable -&gt; [Unlinked]
</span><a href="GHC.Runtime.Linker.Types.html#linkableUnlinked"><span class="hs-identifier hs-var hs-var">linkableUnlinked</span></a></span><span> </span><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621681203417"><span class="hs-identifier hs-var">linkable</span></a></span><span>
</span><span id="line-1530"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Runtime.Linker.Types.html#BCOs"><span class="hs-identifier hs-type">BCOs</span></a></span><span> </span><span class="annot"><span class="annottext">CompiledByteCode
</span><span class="hs-identifier">_</span></span><span> </span><span id="local-6989586621681203413"><span class="annot"><span class="annottext">[SptEntry]
</span><a href="#local-6989586621681203413"><span class="hs-identifier hs-var">spts</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Unlinked -&gt; [Unlinked]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">Unlinked
</span><a href="#local-6989586621681203416"><span class="hs-identifier hs-var">unlinked</span></a></span><span>
</span><span id="line-1531"></span><span>                                 </span><span class="hs-special">,</span><span> </span><span id="local-6989586621681203418"><span class="annot"><span class="annottext">SptEntry
</span><a href="#local-6989586621681203418"><span class="hs-identifier hs-var">spt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[SptEntry]
</span><a href="#local-6989586621681203413"><span class="hs-identifier hs-var">spts</span></a></span><span>
</span><span id="line-1532"></span><span>                                 </span><span class="hs-special">]</span><span>
</span><span id="line-1533"></span><span>
</span><span id="line-1534"></span><span>                </span><span class="annot"><span class="annottext">HomePackageTable
-&gt; ModuleGraph
-&gt; [SCC ModSummary]
-&gt; Int
-&gt; Int
-&gt; [GenUnit UnitId]
-&gt; UniqSet ModuleName
-&gt; m (SuccessFlag, ModuleGraph)
forall (m :: * -&gt; *).
GhcMonad m =&gt;
HomePackageTable
-&gt; ModuleGraph
-&gt; [SCC ModSummary]
-&gt; Int
-&gt; Int
-&gt; [GenUnit UnitId]
-&gt; UniqSet ModuleName
-&gt; m (SuccessFlag, ModuleGraph)
</span><a href="#local-6989586621681203605"><span class="hs-identifier hs-var">upsweep'</span></a></span><span> </span><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621681203425"><span class="hs-identifier hs-var">old_hpt1</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621681203424"><span class="hs-identifier hs-var">done'</span></a></span><span> </span><span class="annot"><span class="annottext">[SCC ModSummary]
</span><a href="#local-6989586621681203460"><span class="hs-identifier hs-var">mods</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681203459"><span class="hs-identifier hs-var">mod_index</span></a></span><span class="annot"><span class="annottext">Int -&gt; Int -&gt; Int
forall a. Num a =&gt; a -&gt; a -&gt; a
</span><a href="../../base/src/GHC.Num.html#%2B"><span class="hs-operator hs-var">+</span></a></span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681203458"><span class="hs-identifier hs-var">nmods</span></a></span><span> </span><span class="annot"><span class="annottext">[GenUnit UnitId]
</span><a href="#local-6989586621681203448"><span class="hs-identifier hs-var">uids_to_check'</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSet ModuleName
</span><a href="#local-6989586621681203441"><span class="hs-identifier hs-var">done_holes'</span></a></span><span>
</span><span id="line-1535"></span><span>
</span><span id="line-1536"></span><span class="hs-comment">-- | Return a list of instantiated units to type check from the UnitState.</span><span>
</span><span id="line-1537"></span><span class="hs-comment">--</span><span>
</span><span id="line-1538"></span><span class="hs-comment">-- Use explicit (instantiated) units as roots and also return their</span><span>
</span><span id="line-1539"></span><span class="hs-comment">-- instantiations that are themselves instantiations and so on recursively.</span><span>
</span><span id="line-1540"></span><span class="annot"><a href="GHC.Driver.Make.html#instantiatedUnitsToCheck"><span class="hs-identifier hs-type">instantiatedUnitsToCheck</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Types.html#Unit"><span class="hs-identifier hs-type">Unit</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1541"></span><span id="instantiatedUnitsToCheck"><span class="annot"><span class="annottext">instantiatedUnitsToCheck :: DynFlags -&gt; [GenUnit UnitId]
</span><a href="GHC.Driver.Make.html#instantiatedUnitsToCheck"><span class="hs-identifier hs-var hs-var">instantiatedUnitsToCheck</span></a></span></span><span> </span><span id="local-6989586621681203412"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203412"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1542"></span><span>  </span><span class="annot"><span class="annottext">[GenUnit UnitId] -&gt; [GenUnit UnitId]
forall a. Ord a =&gt; [a] -&gt; [a]
</span><a href="GHC.Utils.Misc.html#nubSort"><span class="hs-identifier hs-var">nubSort</span></a></span><span> </span><span class="annot"><span class="annottext">([GenUnit UnitId] -&gt; [GenUnit UnitId])
-&gt; [GenUnit UnitId] -&gt; [GenUnit UnitId]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(GenUnit UnitId -&gt; [GenUnit UnitId])
-&gt; [GenUnit UnitId] -&gt; [GenUnit UnitId]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><a href="../../base/src/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a></span><span> </span><span class="annot"><span class="annottext">GenUnit UnitId -&gt; [GenUnit UnitId]
forall {unit}. GenUnit unit -&gt; [GenUnit unit]
</span><a href="#local-6989586621681203410"><span class="hs-identifier hs-var">goUnit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">UnitState -&gt; [GenUnit UnitId]
</span><a href="GHC.Unit.State.html#explicitUnits"><span class="hs-identifier hs-var hs-var">explicitUnits</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; UnitState
</span><a href="GHC.Driver.Session.html#unitState"><span class="hs-identifier hs-var hs-var">unitState</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203412"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1543"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1544"></span><span>  </span><span id="local-6989586621681203410"><span class="annot"><span class="annottext">goUnit :: GenUnit unit -&gt; [GenUnit unit]
</span><a href="#local-6989586621681203410"><span class="hs-identifier hs-var hs-var">goUnit</span></a></span></span><span> </span><span class="annot"><span class="annottext">GenUnit unit
</span><a href="GHC.Unit.Types.html#HoleUnit"><span class="hs-identifier hs-var">HoleUnit</span></a></span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1545"></span><span>  </span><span class="annot"><a href="#local-6989586621681203410"><span class="hs-identifier hs-var">goUnit</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#RealUnit"><span class="hs-identifier hs-type">RealUnit</span></a></span><span> </span><span class="annot"><span class="annottext">Definite unit
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-1546"></span><span>  </span><span class="annot"><a href="#local-6989586621681203410"><span class="hs-identifier hs-var">goUnit</span></a></span><span> </span><span id="local-6989586621681203406"><span class="annot"><span class="annottext">uid :: GenUnit unit
</span><a href="#local-6989586621681203406"><span class="hs-identifier hs-var">uid</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#VirtUnit"><span class="hs-identifier hs-type">VirtUnit</span></a></span><span> </span><span id="local-6989586621681203404"><span class="annot"><span class="annottext">GenInstantiatedUnit unit
</span><a href="#local-6989586621681203404"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenUnit unit
</span><a href="#local-6989586621681203406"><span class="hs-identifier hs-var">uid</span></a></span><span> </span><span class="annot"><span class="annottext">GenUnit unit -&gt; [GenUnit unit] -&gt; [GenUnit unit]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">((ModuleName, GenModule (GenUnit unit)) -&gt; [GenUnit unit])
-&gt; [(ModuleName, GenModule (GenUnit unit))] -&gt; [GenUnit unit]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><a href="../../base/src/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenUnit unit -&gt; [GenUnit unit]
</span><a href="#local-6989586621681203410"><span class="hs-identifier hs-var">goUnit</span></a></span><span> </span><span class="annot"><span class="annottext">(GenUnit unit -&gt; [GenUnit unit])
-&gt; ((ModuleName, GenModule (GenUnit unit)) -&gt; GenUnit unit)
-&gt; (ModuleName, GenModule (GenUnit unit))
-&gt; [GenUnit unit]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">GenModule (GenUnit unit) -&gt; GenUnit unit
forall unit. GenModule unit -&gt; unit
</span><a href="GHC.Unit.Types.html#moduleUnit"><span class="hs-identifier hs-var hs-var">moduleUnit</span></a></span><span> </span><span class="annot"><span class="annottext">(GenModule (GenUnit unit) -&gt; GenUnit unit)
-&gt; ((ModuleName, GenModule (GenUnit unit))
    -&gt; GenModule (GenUnit unit))
-&gt; (ModuleName, GenModule (GenUnit unit))
-&gt; GenUnit unit
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">(ModuleName, GenModule (GenUnit unit)) -&gt; GenModule (GenUnit unit)
forall a b. (a, b) -&gt; b
</span><a href="../../base/src/Data.Tuple.html#snd"><span class="hs-identifier hs-var">snd</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenInstantiatedUnit unit
-&gt; [(ModuleName, GenModule (GenUnit unit))]
forall unit. GenInstantiatedUnit unit -&gt; GenInstantiations unit
</span><a href="GHC.Unit.Types.html#instUnitInsts"><span class="hs-identifier hs-var hs-var">instUnitInsts</span></a></span><span> </span><span class="annot"><span class="annottext">GenInstantiatedUnit unit
</span><a href="#local-6989586621681203404"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1547"></span><span>
</span><span id="line-1548"></span><span class="annot"><a href="GHC.Driver.Make.html#maybeGetIfaceDate"><span class="hs-identifier hs-type">maybeGetIfaceDate</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Location.html#ModLocation"><span class="hs-identifier hs-type">ModLocation</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../time/src/Data.Time.Clock.Internal.UTCTime.html#UTCTime"><span class="hs-identifier hs-type">UTCTime</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1549"></span><span id="maybeGetIfaceDate"><span class="annot"><span class="annottext">maybeGetIfaceDate :: DynFlags -&gt; ModLocation -&gt; IO (Maybe UTCTime)
</span><a href="GHC.Driver.Make.html#maybeGetIfaceDate"><span class="hs-identifier hs-var hs-var">maybeGetIfaceDate</span></a></span></span><span> </span><span id="local-6989586621681203400"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203400"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621681203399"><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681203399"><span class="hs-identifier hs-var">location</span></a></span></span><span>
</span><span id="line-1550"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Driver.Pipeline.html#writeInterfaceOnlyMode"><span class="hs-identifier hs-var">writeInterfaceOnlyMode</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203400"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1551"></span><span>    </span><span class="hs-comment">-- Minor optimization: it should be harmless to check the hi file location</span><span>
</span><span id="line-1552"></span><span>    </span><span class="hs-comment">-- always, but it's better to avoid hitting the filesystem if possible.</span><span>
</span><span id="line-1553"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO (Maybe UTCTime)
</span><a href="GHC.Utils.Misc.html#modificationTimeIfExists"><span class="hs-identifier hs-var">modificationTimeIfExists</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModLocation -&gt; FilePath
</span><a href="GHC.Unit.Module.Location.html#ml_hi_file"><span class="hs-identifier hs-var hs-var">ml_hi_file</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681203399"><span class="hs-identifier hs-var">location</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1554"></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1555"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe UTCTime -&gt; IO (Maybe UTCTime)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe UTCTime
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1556"></span><span>
</span><span id="line-1557"></span><span class="hs-comment">-- | Compile a single module.  Always produce a Linkable for it if</span><span>
</span><span id="line-1558"></span><span class="hs-comment">-- successful.  If no compilation happened, return the old Linkable.</span><span>
</span><span id="line-1559"></span><span class="annot"><a href="GHC.Driver.Make.html#upsweep_mod"><span class="hs-identifier hs-type">upsweep_mod</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-1560"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Main.html#Messager"><span class="hs-identifier hs-type">Messager</span></a></span><span>
</span><span id="line-1561"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HomePackageTable"><span class="hs-identifier hs-type">HomePackageTable</span></a></span><span>
</span><span id="line-1562"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#StableModules"><span class="hs-identifier hs-type">StableModules</span></a></span><span>
</span><span id="line-1563"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span>
</span><span id="line-1564"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>  </span><span class="hs-comment">-- index of module</span><span>
</span><span id="line-1565"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>  </span><span class="hs-comment">-- total number of modules</span><span>
</span><span id="line-1566"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HomeModInfo"><span class="hs-identifier hs-type">HomeModInfo</span></a></span><span>
</span><span id="line-1567"></span><span id="upsweep_mod"><span class="annot"><span class="annottext">upsweep_mod :: HscEnv
-&gt; Maybe Messager
-&gt; HomePackageTable
-&gt; (UniqSet ModuleName, UniqSet ModuleName)
-&gt; ModSummary
-&gt; Int
-&gt; Int
-&gt; IO HomeModInfo
</span><a href="GHC.Driver.Make.html#upsweep_mod"><span class="hs-identifier hs-var hs-var">upsweep_mod</span></a></span></span><span> </span><span id="local-6989586621681203395"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203395"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681203394"><span class="annot"><span class="annottext">Maybe Messager
</span><a href="#local-6989586621681203394"><span class="hs-identifier hs-var">mHscMessage</span></a></span></span><span> </span><span id="local-6989586621681203393"><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621681203393"><span class="hs-identifier hs-var">old_hpt</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681203392"><span class="annot"><span class="annottext">UniqSet ModuleName
</span><a href="#local-6989586621681203392"><span class="hs-identifier hs-var">stable_obj</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681203391"><span class="annot"><span class="annottext">UniqSet ModuleName
</span><a href="#local-6989586621681203391"><span class="hs-identifier hs-var">stable_bco</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681203390"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203390"><span class="hs-identifier hs-var">summary</span></a></span></span><span> </span><span id="local-6989586621681203389"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681203389"><span class="hs-identifier hs-var">mod_index</span></a></span></span><span> </span><span id="local-6989586621681203388"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681203388"><span class="hs-identifier hs-var">nmods</span></a></span></span><span>
</span><span id="line-1568"></span><span>   </span><span class="hs-glyph">=</span><span>    </span><span class="hs-keyword">let</span><span>
</span><span id="line-1569"></span><span>            </span><span id="local-6989586621681203387"><span class="annot"><span class="annottext">this_mod_name :: ModuleName
</span><a href="#local-6989586621681203387"><span class="hs-identifier hs-var hs-var">this_mod_name</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; ModuleName
</span><a href="GHC.Driver.Types.html#ms_mod_name"><span class="hs-identifier hs-var">ms_mod_name</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203390"><span class="hs-identifier hs-var">summary</span></a></span><span>
</span><span id="line-1570"></span><span>            </span><span id="local-6989586621681203386"><span class="annot"><span class="annottext">this_mod :: Module
</span><a href="#local-6989586621681203386"><span class="hs-identifier hs-var hs-var">this_mod</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; Module
</span><a href="GHC.Driver.Types.html#ms_mod"><span class="hs-identifier hs-var hs-var">ms_mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203390"><span class="hs-identifier hs-var">summary</span></a></span><span>
</span><span id="line-1571"></span><span>            </span><span id="local-6989586621681203385"><span class="annot"><span class="annottext">mb_obj_date :: Maybe UTCTime
</span><a href="#local-6989586621681203385"><span class="hs-identifier hs-var hs-var">mb_obj_date</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; Maybe UTCTime
</span><a href="GHC.Driver.Types.html#ms_obj_date"><span class="hs-identifier hs-var hs-var">ms_obj_date</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203390"><span class="hs-identifier hs-var">summary</span></a></span><span>
</span><span id="line-1572"></span><span>            </span><span id="local-6989586621681203384"><span class="annot"><span class="annottext">mb_if_date :: Maybe UTCTime
</span><a href="#local-6989586621681203384"><span class="hs-identifier hs-var hs-var">mb_if_date</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; Maybe UTCTime
</span><a href="GHC.Driver.Types.html#ms_iface_date"><span class="hs-identifier hs-var hs-var">ms_iface_date</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203390"><span class="hs-identifier hs-var">summary</span></a></span><span>
</span><span id="line-1573"></span><span>            </span><span id="local-6989586621681203382"><span class="annot"><span class="annottext">obj_fn :: FilePath
</span><a href="#local-6989586621681203382"><span class="hs-identifier hs-var hs-var">obj_fn</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModLocation -&gt; FilePath
</span><a href="GHC.Unit.Module.Location.html#ml_obj_file"><span class="hs-identifier hs-var hs-var">ml_obj_file</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; ModLocation
</span><a href="GHC.Driver.Types.html#ms_location"><span class="hs-identifier hs-var hs-var">ms_location</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203390"><span class="hs-identifier hs-var">summary</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1574"></span><span>            </span><span id="local-6989586621681203380"><span class="annot"><span class="annottext">hs_date :: UTCTime
</span><a href="#local-6989586621681203380"><span class="hs-identifier hs-var hs-var">hs_date</span></a></span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; UTCTime
</span><a href="GHC.Driver.Types.html#ms_hs_date"><span class="hs-identifier hs-var hs-var">ms_hs_date</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203390"><span class="hs-identifier hs-var">summary</span></a></span><span>
</span><span id="line-1575"></span><span>
</span><span id="line-1576"></span><span>            </span><span id="local-6989586621681203378"><span class="annot"><span class="annottext">is_stable_obj :: Bool
</span><a href="#local-6989586621681203378"><span class="hs-identifier hs-var hs-var">is_stable_obj</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681203387"><span class="hs-identifier hs-var">this_mod_name</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; UniqSet ModuleName -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; UniqSet a -&gt; Bool
</span><a href="GHC.Types.Unique.Set.html#elementOfUniqSet"><span class="hs-operator hs-var">`elementOfUniqSet`</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSet ModuleName
</span><a href="#local-6989586621681203392"><span class="hs-identifier hs-var">stable_obj</span></a></span><span>
</span><span id="line-1577"></span><span>            </span><span id="local-6989586621681203376"><span class="annot"><span class="annottext">is_stable_bco :: Bool
</span><a href="#local-6989586621681203376"><span class="hs-identifier hs-var hs-var">is_stable_bco</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681203387"><span class="hs-identifier hs-var">this_mod_name</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; UniqSet ModuleName -&gt; Bool
forall a. Uniquable a =&gt; a -&gt; UniqSet a -&gt; Bool
</span><a href="GHC.Types.Unique.Set.html#elementOfUniqSet"><span class="hs-operator hs-var">`elementOfUniqSet`</span></a></span><span> </span><span class="annot"><span class="annottext">UniqSet ModuleName
</span><a href="#local-6989586621681203391"><span class="hs-identifier hs-var">stable_bco</span></a></span><span>
</span><span id="line-1578"></span><span>
</span><span id="line-1579"></span><span>            </span><span id="local-6989586621681203375"><span class="annot"><span class="annottext">old_hmi :: Maybe HomeModInfo
</span><a href="#local-6989586621681203375"><span class="hs-identifier hs-var hs-var">old_hmi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HomePackageTable -&gt; ModuleName -&gt; Maybe HomeModInfo
</span><a href="GHC.Driver.Types.html#lookupHpt"><span class="hs-identifier hs-var">lookupHpt</span></a></span><span> </span><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621681203393"><span class="hs-identifier hs-var">old_hpt</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681203387"><span class="hs-identifier hs-var">this_mod_name</span></a></span><span>
</span><span id="line-1580"></span><span>
</span><span id="line-1581"></span><span>            </span><span class="hs-comment">-- We're using the dflags for this module now, obtained by</span><span>
</span><span id="line-1582"></span><span>            </span><span class="hs-comment">-- applying any options in its LANGUAGE &amp; OPTIONS_GHC pragmas.</span><span>
</span><span id="line-1583"></span><span>            </span><span id="local-6989586621681203374"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621681203374"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#ms_hspp_opts"><span class="hs-identifier hs-var hs-var">ms_hspp_opts</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203390"><span class="hs-identifier hs-var">summary</span></a></span><span>
</span><span id="line-1584"></span><span>            </span><span id="local-6989586621681203373"><span class="annot"><span class="annottext">prevailing_target :: HscTarget
</span><a href="#local-6989586621681203373"><span class="hs-identifier hs-var hs-var">prevailing_target</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; HscTarget
</span><a href="GHC.Driver.Session.html#hscTarget"><span class="hs-identifier hs-var hs-var">hscTarget</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203395"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1585"></span><span>            </span><span id="local-6989586621681203372"><span class="annot"><span class="annottext">local_target :: HscTarget
</span><a href="#local-6989586621681203372"><span class="hs-identifier hs-var hs-var">local_target</span></a></span></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; HscTarget
</span><a href="GHC.Driver.Session.html#hscTarget"><span class="hs-identifier hs-var hs-var">hscTarget</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203374"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-1586"></span><span>
</span><span id="line-1587"></span><span>            </span><span class="hs-comment">-- If OPTIONS_GHC contains -fasm or -fllvm, be careful that</span><span>
</span><span id="line-1588"></span><span>            </span><span class="hs-comment">-- we don't do anything dodgy: these should only work to change</span><span>
</span><span id="line-1589"></span><span>            </span><span class="hs-comment">-- from -fllvm to -fasm and vice-versa, or away from -fno-code,</span><span>
</span><span id="line-1590"></span><span>            </span><span class="hs-comment">-- otherwise we could end up trying to link object code to byte</span><span>
</span><span id="line-1591"></span><span>            </span><span class="hs-comment">-- code.</span><span>
</span><span id="line-1592"></span><span>            </span><span id="local-6989586621681203368"><span class="annot"><span class="annottext">target :: HscTarget
</span><a href="#local-6989586621681203368"><span class="hs-identifier hs-var hs-var">target</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">HscTarget
</span><a href="#local-6989586621681203373"><span class="hs-identifier hs-var">prevailing_target</span></a></span><span> </span><span class="annot"><span class="annottext">HscTarget -&gt; HscTarget -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">HscTarget
</span><a href="#local-6989586621681203372"><span class="hs-identifier hs-var">local_target</span></a></span><span>
</span><span id="line-1593"></span><span>                        </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscTarget -&gt; Bool
</span><a href="GHC.Driver.Session.html#isObjectTarget"><span class="hs-identifier hs-var">isObjectTarget</span></a></span><span> </span><span class="annot"><span class="annottext">HscTarget
</span><a href="#local-6989586621681203373"><span class="hs-identifier hs-var">prevailing_target</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1594"></span><span>                            </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscTarget -&gt; Bool
</span><a href="GHC.Driver.Session.html#isObjectTarget"><span class="hs-identifier hs-var">isObjectTarget</span></a></span><span> </span><span class="annot"><span class="annottext">HscTarget
</span><a href="#local-6989586621681203372"><span class="hs-identifier hs-var">local_target</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1595"></span><span>                        </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscTarget
</span><a href="#local-6989586621681203373"><span class="hs-identifier hs-var">prevailing_target</span></a></span><span> </span><span class="annot"><span class="annottext">HscTarget -&gt; HscTarget -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">HscTarget
</span><a href="GHC.Driver.Session.html#HscNothing"><span class="hs-identifier hs-var">HscNothing</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1596"></span><span>                        </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscTarget
</span><a href="#local-6989586621681203373"><span class="hs-identifier hs-var">prevailing_target</span></a></span><span> </span><span class="annot"><span class="annottext">HscTarget -&gt; HscTarget -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">HscTarget
</span><a href="GHC.Driver.Session.html#HscInterpreted"><span class="hs-identifier hs-var">HscInterpreted</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1597"></span><span>                        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">HscTarget
</span><a href="#local-6989586621681203373"><span class="hs-identifier hs-var">prevailing_target</span></a></span><span>
</span><span id="line-1598"></span><span>                        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">HscTarget
</span><a href="#local-6989586621681203372"><span class="hs-identifier hs-var">local_target</span></a></span><span>
</span><span id="line-1599"></span><span>
</span><span id="line-1600"></span><span>            </span><span class="hs-comment">-- store the corrected hscTarget into the summary</span><span>
</span><span id="line-1601"></span><span>            </span><span id="local-6989586621681203365"><span class="annot"><span class="annottext">summary' :: ModSummary
</span><a href="#local-6989586621681203365"><span class="hs-identifier hs-var hs-var">summary'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203390"><span class="hs-identifier hs-var">summary</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ms_hspp_opts :: DynFlags
</span><a href="GHC.Driver.Types.html#ms_hspp_opts"><span class="hs-identifier hs-var">ms_hspp_opts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203374"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hscTarget :: HscTarget
</span><a href="GHC.Driver.Session.html#hscTarget"><span class="hs-identifier hs-var">hscTarget</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscTarget
</span><a href="#local-6989586621681203368"><span class="hs-identifier hs-var">target</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1602"></span><span>
</span><span id="line-1603"></span><span>            </span><span class="hs-comment">-- The old interface is ok if</span><span>
</span><span id="line-1604"></span><span>            </span><span class="hs-comment">--  a) we're compiling a source file, and the old HPT</span><span>
</span><span id="line-1605"></span><span>            </span><span class="hs-comment">--     entry is for a source file</span><span>
</span><span id="line-1606"></span><span>            </span><span class="hs-comment">--  b) we're compiling a hs-boot file</span><span>
</span><span id="line-1607"></span><span>            </span><span class="hs-comment">-- Case (b) allows an hs-boot file to get the interface of its</span><span>
</span><span id="line-1608"></span><span>            </span><span class="hs-comment">-- real source file on the second iteration of the compilation</span><span>
</span><span id="line-1609"></span><span>            </span><span class="hs-comment">-- manager, but that does no harm.  Otherwise the hs-boot file</span><span>
</span><span id="line-1610"></span><span>            </span><span class="hs-comment">-- will always be recompiled</span><span>
</span><span id="line-1611"></span><span>
</span><span id="line-1612"></span><span>            </span><span id="local-6989586621681203362"><span class="annot"><span class="annottext">mb_old_iface :: Maybe (ModIface_ 'ModIfaceFinal)
</span><a href="#local-6989586621681203362"><span class="hs-identifier hs-var hs-var">mb_old_iface</span></a></span></span><span>
</span><span id="line-1613"></span><span>                </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe HomeModInfo
</span><a href="#local-6989586621681203375"><span class="hs-identifier hs-var">old_hmi</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1614"></span><span>                     </span><span class="annot"><span class="annottext">Maybe HomeModInfo
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>                                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (ModIface_ 'ModIfaceFinal)
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1615"></span><span>                     </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681203361"><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621681203361"><span class="hs-identifier hs-var">hm_info</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; IsBootInterface
</span><a href="GHC.Driver.Types.html#isBootSummary"><span class="hs-identifier hs-var">isBootSummary</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203390"><span class="hs-identifier hs-var">summary</span></a></span><span> </span><span class="annot"><span class="annottext">IsBootInterface -&gt; IsBootInterface -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="GHC.Unit.Types.html#IsBoot"><span class="hs-identifier hs-var">IsBoot</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModIface_ 'ModIfaceFinal -&gt; Maybe (ModIface_ 'ModIfaceFinal)
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface_ 'ModIfaceFinal
</span><a href="#local-6989586621681203360"><span class="hs-identifier hs-var">iface</span></a></span><span>
</span><span id="line-1616"></span><span>                                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ModIface_ 'ModIfaceFinal -&gt; IsBootInterface
</span><a href="GHC.Driver.Types.html#mi_boot"><span class="hs-identifier hs-var">mi_boot</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface_ 'ModIfaceFinal
</span><a href="#local-6989586621681203360"><span class="hs-identifier hs-var">iface</span></a></span><span> </span><span class="annot"><span class="annottext">IsBootInterface -&gt; IsBootInterface -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="GHC.Unit.Types.html#NotBoot"><span class="hs-identifier hs-var">NotBoot</span></a></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModIface_ 'ModIfaceFinal -&gt; Maybe (ModIface_ 'ModIfaceFinal)
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ModIface_ 'ModIfaceFinal
</span><a href="#local-6989586621681203360"><span class="hs-identifier hs-var">iface</span></a></span><span>
</span><span id="line-1617"></span><span>                                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (ModIface_ 'ModIfaceFinal)
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1618"></span><span>                                   </span><span class="hs-keyword">where</span><span>
</span><span id="line-1619"></span><span>                                     </span><span id="local-6989586621681203360"><span class="annot"><span class="annottext">iface :: ModIface_ 'ModIfaceFinal
</span><a href="#local-6989586621681203360"><span class="hs-identifier hs-var hs-var">iface</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HomeModInfo -&gt; ModIface_ 'ModIfaceFinal
</span><a href="GHC.Driver.Types.html#hm_iface"><span class="hs-identifier hs-var hs-var">hm_iface</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621681203361"><span class="hs-identifier hs-var">hm_info</span></a></span><span>
</span><span id="line-1620"></span><span>
</span><span id="line-1621"></span><span>            </span><span class="annot"><a href="#local-6989586621681203358"><span class="hs-identifier hs-type">compile_it</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Runtime.Linker.Types.html#Linkable"><span class="hs-identifier hs-type">Linkable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#SourceModified"><span class="hs-identifier hs-type">SourceModified</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HomeModInfo"><span class="hs-identifier hs-type">HomeModInfo</span></a></span><span>
</span><span id="line-1622"></span><span>            </span><span id="local-6989586621681203358"><span class="annot"><span class="annottext">compile_it :: Maybe Linkable -&gt; SourceModified -&gt; IO HomeModInfo
</span><a href="#local-6989586621681203358"><span class="hs-identifier hs-var hs-var">compile_it</span></a></span></span><span>  </span><span id="local-6989586621681203357"><span class="annot"><span class="annottext">Maybe Linkable
</span><a href="#local-6989586621681203357"><span class="hs-identifier hs-var">mb_linkable</span></a></span></span><span> </span><span id="local-6989586621681203356"><span class="annot"><span class="annottext">SourceModified
</span><a href="#local-6989586621681203356"><span class="hs-identifier hs-var">src_modified</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1623"></span><span>                  </span><span class="annot"><span class="annottext">Maybe TcGblEnv
-&gt; Maybe Messager
-&gt; HscEnv
-&gt; ModSummary
-&gt; Int
-&gt; Int
-&gt; Maybe (ModIface_ 'ModIfaceFinal)
-&gt; Maybe Linkable
-&gt; SourceModified
-&gt; IO HomeModInfo
</span><a href="GHC.Driver.Pipeline.html#compileOne%27"><span class="hs-identifier hs-var">compileOne'</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TcGblEnv
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Messager
</span><a href="#local-6989586621681203394"><span class="hs-identifier hs-var">mHscMessage</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203395"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203365"><span class="hs-identifier hs-var">summary'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681203389"><span class="hs-identifier hs-var">mod_index</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681203388"><span class="hs-identifier hs-var">nmods</span></a></span><span>
</span><span id="line-1624"></span><span>                             </span><span class="annot"><span class="annottext">Maybe (ModIface_ 'ModIfaceFinal)
</span><a href="#local-6989586621681203362"><span class="hs-identifier hs-var">mb_old_iface</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Linkable
</span><a href="#local-6989586621681203357"><span class="hs-identifier hs-var">mb_linkable</span></a></span><span> </span><span class="annot"><span class="annottext">SourceModified
</span><a href="#local-6989586621681203356"><span class="hs-identifier hs-var">src_modified</span></a></span><span>
</span><span id="line-1625"></span><span>
</span><span id="line-1626"></span><span>            </span><span class="annot"><a href="#local-6989586621681203354"><span class="hs-identifier hs-type">compile_it_discard_iface</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Runtime.Linker.Types.html#Linkable"><span class="hs-identifier hs-type">Linkable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#SourceModified"><span class="hs-identifier hs-type">SourceModified</span></a></span><span>
</span><span id="line-1627"></span><span>                                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HomeModInfo"><span class="hs-identifier hs-type">HomeModInfo</span></a></span><span>
</span><span id="line-1628"></span><span>            </span><span id="local-6989586621681203354"><span class="annot"><span class="annottext">compile_it_discard_iface :: Maybe Linkable -&gt; SourceModified -&gt; IO HomeModInfo
</span><a href="#local-6989586621681203354"><span class="hs-identifier hs-var hs-var">compile_it_discard_iface</span></a></span></span><span> </span><span id="local-6989586621681203353"><span class="annot"><span class="annottext">Maybe Linkable
</span><a href="#local-6989586621681203353"><span class="hs-identifier hs-var">mb_linkable</span></a></span></span><span>  </span><span id="local-6989586621681203352"><span class="annot"><span class="annottext">SourceModified
</span><a href="#local-6989586621681203352"><span class="hs-identifier hs-var">src_modified</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1629"></span><span>                  </span><span class="annot"><span class="annottext">Maybe TcGblEnv
-&gt; Maybe Messager
-&gt; HscEnv
-&gt; ModSummary
-&gt; Int
-&gt; Int
-&gt; Maybe (ModIface_ 'ModIfaceFinal)
-&gt; Maybe Linkable
-&gt; SourceModified
-&gt; IO HomeModInfo
</span><a href="GHC.Driver.Pipeline.html#compileOne%27"><span class="hs-identifier hs-var">compileOne'</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe TcGblEnv
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Messager
</span><a href="#local-6989586621681203394"><span class="hs-identifier hs-var">mHscMessage</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203395"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203365"><span class="hs-identifier hs-var">summary'</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681203389"><span class="hs-identifier hs-var">mod_index</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681203388"><span class="hs-identifier hs-var">nmods</span></a></span><span>
</span><span id="line-1630"></span><span>                             </span><span class="annot"><span class="annottext">Maybe (ModIface_ 'ModIfaceFinal)
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Linkable
</span><a href="#local-6989586621681203353"><span class="hs-identifier hs-var">mb_linkable</span></a></span><span> </span><span class="annot"><span class="annottext">SourceModified
</span><a href="#local-6989586621681203352"><span class="hs-identifier hs-var">src_modified</span></a></span><span>
</span><span id="line-1631"></span><span>
</span><span id="line-1632"></span><span>            </span><span class="hs-comment">-- With the HscNothing target we create empty linkables to avoid</span><span>
</span><span id="line-1633"></span><span>            </span><span class="hs-comment">-- recompilation.  We have to detect these to recompile anyway if</span><span>
</span><span id="line-1634"></span><span>            </span><span class="hs-comment">-- the target changed since the last compile.</span><span>
</span><span id="line-1635"></span><span>            </span><span id="local-6989586621681203350"><span class="annot"><span class="annottext">is_fake_linkable :: Bool
</span><a href="#local-6989586621681203350"><span class="hs-identifier hs-var hs-var">is_fake_linkable</span></a></span></span><span>
</span><span id="line-1636"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681203349"><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621681203349"><span class="hs-identifier hs-var">hmi</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe HomeModInfo
</span><a href="#local-6989586621681203375"><span class="hs-identifier hs-var">old_hmi</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681203348"><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621681203348"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HomeModInfo -&gt; Maybe Linkable
</span><a href="GHC.Driver.Types.html#hm_linkable"><span class="hs-identifier hs-var hs-var">hm_linkable</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621681203349"><span class="hs-identifier hs-var">hmi</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1637"></span><span>                  </span><span class="annot"><span class="annottext">[Unlinked] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Linkable -&gt; [Unlinked]
</span><a href="GHC.Runtime.Linker.Types.html#linkableUnlinked"><span class="hs-identifier hs-var hs-var">linkableUnlinked</span></a></span><span> </span><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621681203348"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1638"></span><span>               </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1639"></span><span>                   </span><span class="hs-comment">-- we have no linkable, so it cannot be fake</span><span>
</span><span id="line-1640"></span><span>                   </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-1641"></span><span>
</span><span id="line-1642"></span><span>            </span><span id="local-6989586621681203347"><span class="annot"><span class="annottext">implies :: Bool -&gt; Bool -&gt; Bool
</span><a href="#local-6989586621681203347"><span class="hs-identifier hs-var hs-var">implies</span></a></span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-1643"></span><span>            </span><span class="annot"><a href="#local-6989586621681203347"><span class="hs-identifier hs-var">implies</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span> </span><span id="local-6989586621681203346"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681203346"><span class="hs-identifier hs-var">x</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681203346"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-1644"></span><span>
</span><span id="line-1645"></span><span>        </span><span class="hs-keyword">in</span><span>
</span><span id="line-1646"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1647"></span><span>         </span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span>
</span><span id="line-1648"></span><span>                </span><span class="hs-comment">-- Regardless of whether we're generating object code or</span><span>
</span><span id="line-1649"></span><span>                </span><span class="hs-comment">-- byte code, we can always use an existing object file</span><span>
</span><span id="line-1650"></span><span>                </span><span class="hs-comment">-- if it is *stable* (see checkStability).</span><span>
</span><span id="line-1651"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681203378"><span class="hs-identifier hs-var">is_stable_obj</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681203345"><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621681203345"><span class="hs-identifier hs-var">hmi</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe HomeModInfo
</span><a href="#local-6989586621681203375"><span class="hs-identifier hs-var">old_hmi</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1652"></span><span>                </span><span class="annot"><span class="annottext">IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Int -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203395"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span>
</span><span id="line-1653"></span><span>                           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;skipping stable obj mod:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681203387"><span class="hs-identifier hs-var">this_mod_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1654"></span><span>                </span><span class="annot"><span class="annottext">HomeModInfo -&gt; IO HomeModInfo
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621681203345"><span class="hs-identifier hs-var">hmi</span></a></span><span>
</span><span id="line-1655"></span><span>                </span><span class="hs-comment">-- object is stable, and we have an entry in the</span><span>
</span><span id="line-1656"></span><span>                </span><span class="hs-comment">-- old HPT: nothing to do</span><span>
</span><span id="line-1657"></span><span>
</span><span id="line-1658"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681203378"><span class="hs-identifier hs-var">is_stable_obj</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe HomeModInfo -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../../base/src/Data.Maybe.html#isNothing"><span class="hs-identifier hs-var">isNothing</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe HomeModInfo
</span><a href="#local-6989586621681203375"><span class="hs-identifier hs-var">old_hmi</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1659"></span><span>                </span><span class="annot"><span class="annottext">IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Int -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203395"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span>
</span><span id="line-1660"></span><span>                           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;compiling stable on-disk mod:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681203387"><span class="hs-identifier hs-var">this_mod_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1661"></span><span>                </span><span id="local-6989586621681203343"><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621681203343"><span class="hs-identifier hs-var">linkable</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Linkable -&gt; IO Linkable
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO Linkable -&gt; IO Linkable) -&gt; IO Linkable -&gt; IO Linkable
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Module -&gt; FilePath -&gt; UTCTime -&gt; IO Linkable
</span><a href="GHC.Driver.Finder.html#findObjectLinkable"><span class="hs-identifier hs-var">findObjectLinkable</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681203386"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681203382"><span class="hs-identifier hs-var">obj_fn</span></a></span><span>
</span><span id="line-1662"></span><span>                              </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; Maybe UTCTime -&gt; UTCTime
forall a. HasCallStack =&gt; FilePath -&gt; Maybe a -&gt; a
</span><a href="GHC.Data.Maybe.html#expectJust"><span class="hs-identifier hs-var">expectJust</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;upsweep1&quot;</span></span><span> </span><span class="annot"><span class="annottext">Maybe UTCTime
</span><a href="#local-6989586621681203385"><span class="hs-identifier hs-var">mb_obj_date</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1663"></span><span>                </span><span class="annot"><span class="annottext">Maybe Linkable -&gt; SourceModified -&gt; IO HomeModInfo
</span><a href="#local-6989586621681203358"><span class="hs-identifier hs-var">compile_it</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Linkable -&gt; Maybe Linkable
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621681203343"><span class="hs-identifier hs-var">linkable</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SourceModified
</span><a href="GHC.Driver.Types.html#SourceUnmodifiedAndStable"><span class="hs-identifier hs-var">SourceUnmodifiedAndStable</span></a></span><span>
</span><span id="line-1664"></span><span>                </span><span class="hs-comment">-- object is stable, but we need to load the interface</span><span>
</span><span id="line-1665"></span><span>                </span><span class="hs-comment">-- off disk to make a HMI.</span><span>
</span><span id="line-1666"></span><span>
</span><span id="line-1667"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscTarget -&gt; Bool
</span><a href="GHC.Driver.Session.html#isObjectTarget"><span class="hs-identifier hs-var">isObjectTarget</span></a></span><span> </span><span class="annot"><span class="annottext">HscTarget
</span><a href="#local-6989586621681203368"><span class="hs-identifier hs-var">target</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681203376"><span class="hs-identifier hs-var">is_stable_bco</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1668"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscTarget
</span><a href="#local-6989586621681203368"><span class="hs-identifier hs-var">target</span></a></span><span> </span><span class="annot"><span class="annottext">HscTarget -&gt; HscTarget -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">HscTarget
</span><a href="GHC.Driver.Session.html#HscNothing"><span class="hs-identifier hs-var">HscNothing</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="#local-6989586621681203347"><span class="hs-operator hs-var">`implies`</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681203350"><span class="hs-identifier hs-var">is_fake_linkable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1669"></span><span>                </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span class="hs-identifier">isJust</span><span> </span><span class="hs-identifier">old_hmi</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- must be in the old_hpt</span><span>
</span><span id="line-1670"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681203340"><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621681203340"><span class="hs-identifier hs-var">hmi</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe HomeModInfo
</span><a href="#local-6989586621681203375"><span class="hs-identifier hs-var">old_hmi</span></a></span><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1671"></span><span>                </span><span class="annot"><span class="annottext">IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Int -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203395"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span>
</span><span id="line-1672"></span><span>                           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;skipping stable BCO mod:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681203387"><span class="hs-identifier hs-var">this_mod_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1673"></span><span>                </span><span class="annot"><span class="annottext">HomeModInfo -&gt; IO HomeModInfo
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621681203340"><span class="hs-identifier hs-var">hmi</span></a></span><span>
</span><span id="line-1674"></span><span>                </span><span class="hs-comment">-- BCO is stable: nothing to do</span><span>
</span><span id="line-1675"></span><span>
</span><span id="line-1676"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscTarget -&gt; Bool
</span><a href="GHC.Driver.Session.html#isObjectTarget"><span class="hs-identifier hs-var">isObjectTarget</span></a></span><span> </span><span class="annot"><span class="annottext">HscTarget
</span><a href="#local-6989586621681203368"><span class="hs-identifier hs-var">target</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1677"></span><span>            </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681203339"><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621681203339"><span class="hs-identifier hs-var">hmi</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe HomeModInfo
</span><a href="#local-6989586621681203375"><span class="hs-identifier hs-var">old_hmi</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1678"></span><span>            </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681203338"><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621681203338"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HomeModInfo -&gt; Maybe Linkable
</span><a href="GHC.Driver.Types.html#hm_linkable"><span class="hs-identifier hs-var hs-var">hm_linkable</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621681203339"><span class="hs-identifier hs-var">hmi</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1679"></span><span>            </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Linkable -&gt; Bool
</span><a href="GHC.Driver.Types.html#isObjectLinkable"><span class="hs-identifier hs-var">isObjectLinkable</span></a></span><span> </span><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621681203338"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-1680"></span><span>            </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscTarget
</span><a href="#local-6989586621681203368"><span class="hs-identifier hs-var">target</span></a></span><span> </span><span class="annot"><span class="annottext">HscTarget -&gt; HscTarget -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">HscTarget
</span><a href="GHC.Driver.Session.html#HscNothing"><span class="hs-identifier hs-var">HscNothing</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><a href="#local-6989586621681203347"><span class="hs-operator hs-var">`implies`</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681203350"><span class="hs-identifier hs-var">is_fake_linkable</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1681"></span><span>            </span><span class="annot"><span class="annottext">Linkable -&gt; UTCTime
</span><a href="GHC.Runtime.Linker.Types.html#linkableTime"><span class="hs-identifier hs-var hs-var">linkableTime</span></a></span><span> </span><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621681203338"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime -&gt; UTCTime -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; UTCTime
</span><a href="GHC.Driver.Types.html#ms_hs_date"><span class="hs-identifier hs-var hs-var">ms_hs_date</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203390"><span class="hs-identifier hs-var">summary</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1682"></span><span>                </span><span class="annot"><span class="annottext">IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Int -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203395"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span>
</span><span id="line-1683"></span><span>                           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;compiling non-stable BCO mod:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681203387"><span class="hs-identifier hs-var">this_mod_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1684"></span><span>                </span><span class="annot"><span class="annottext">Maybe Linkable -&gt; SourceModified -&gt; IO HomeModInfo
</span><a href="#local-6989586621681203358"><span class="hs-identifier hs-var">compile_it</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Linkable -&gt; Maybe Linkable
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621681203338"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SourceModified
</span><a href="GHC.Driver.Types.html#SourceUnmodified"><span class="hs-identifier hs-var">SourceUnmodified</span></a></span><span>
</span><span id="line-1685"></span><span>                </span><span class="hs-comment">-- we have an old BCO that is up to date with respect</span><span>
</span><span id="line-1686"></span><span>                </span><span class="hs-comment">-- to the source: do a recompilation check as normal.</span><span>
</span><span id="line-1687"></span><span>
</span><span id="line-1688"></span><span>          </span><span class="hs-comment">-- When generating object code, if there's an up-to-date</span><span>
</span><span id="line-1689"></span><span>          </span><span class="hs-comment">-- object file on the disk, then we can use it.</span><span>
</span><span id="line-1690"></span><span>          </span><span class="hs-comment">-- However, if the object file is new (compared to any</span><span>
</span><span id="line-1691"></span><span>          </span><span class="hs-comment">-- linkable we had from a previous compilation), then we</span><span>
</span><span id="line-1692"></span><span>          </span><span class="hs-comment">-- must discard any in-memory interface, because this</span><span>
</span><span id="line-1693"></span><span>          </span><span class="hs-comment">-- means the user has compiled the source file</span><span>
</span><span id="line-1694"></span><span>          </span><span class="hs-comment">-- separately and generated a new interface, that we must</span><span>
</span><span id="line-1695"></span><span>          </span><span class="hs-comment">-- read from the disk.</span><span>
</span><span id="line-1696"></span><span>          </span><span class="hs-comment">--</span><span>
</span><span id="line-1697"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">HscTarget -&gt; Bool
</span><a href="GHC.Driver.Session.html#isObjectTarget"><span class="hs-identifier hs-var">isObjectTarget</span></a></span><span> </span><span class="annot"><span class="annottext">HscTarget
</span><a href="#local-6989586621681203368"><span class="hs-identifier hs-var">target</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1698"></span><span>            </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681203336"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621681203336"><span class="hs-identifier hs-var">obj_date</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe UTCTime
</span><a href="#local-6989586621681203385"><span class="hs-identifier hs-var">mb_obj_date</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1699"></span><span>            </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621681203336"><span class="hs-identifier hs-var">obj_date</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime -&gt; UTCTime -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621681203380"><span class="hs-identifier hs-var">hs_date</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1700"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe HomeModInfo
</span><a href="#local-6989586621681203375"><span class="hs-identifier hs-var">old_hmi</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1701"></span><span>                  </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681203335"><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621681203335"><span class="hs-identifier hs-var">hmi</span></a></span></span><span>
</span><span id="line-1702"></span><span>                    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681203334"><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621681203334"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HomeModInfo -&gt; Maybe Linkable
</span><a href="GHC.Driver.Types.html#hm_linkable"><span class="hs-identifier hs-var hs-var">hm_linkable</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621681203335"><span class="hs-identifier hs-var">hmi</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1703"></span><span>                      </span><span class="annot"><span class="annottext">Linkable -&gt; Bool
</span><a href="GHC.Driver.Types.html#isObjectLinkable"><span class="hs-identifier hs-var">isObjectLinkable</span></a></span><span> </span><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621681203334"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Linkable -&gt; UTCTime
</span><a href="GHC.Runtime.Linker.Types.html#linkableTime"><span class="hs-identifier hs-var hs-var">linkableTime</span></a></span><span> </span><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621681203334"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime -&gt; UTCTime -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621681203336"><span class="hs-identifier hs-var">obj_date</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1704"></span><span>                          </span><span class="annot"><span class="annottext">IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Int -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203395"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span>
</span><span id="line-1705"></span><span>                                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;compiling mod with new on-disk obj:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681203387"><span class="hs-identifier hs-var">this_mod_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1706"></span><span>                          </span><span class="annot"><span class="annottext">Maybe Linkable -&gt; SourceModified -&gt; IO HomeModInfo
</span><a href="#local-6989586621681203358"><span class="hs-identifier hs-var">compile_it</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Linkable -&gt; Maybe Linkable
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621681203334"><span class="hs-identifier hs-var">l</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SourceModified
</span><a href="GHC.Driver.Types.html#SourceUnmodified"><span class="hs-identifier hs-var">SourceUnmodified</span></a></span><span>
</span><span id="line-1707"></span><span>                  </span><span id="local-6989586621681203333"><span class="annot"><span class="annottext">Maybe HomeModInfo
</span><a href="#local-6989586621681203333"><span class="hs-identifier hs-var">_otherwise</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1708"></span><span>                          </span><span class="annot"><span class="annottext">IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Int -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203395"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span>
</span><span id="line-1709"></span><span>                                     </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;compiling mod with new on-disk obj2:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681203387"><span class="hs-identifier hs-var">this_mod_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1710"></span><span>                          </span><span id="local-6989586621681203332"><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621681203332"><span class="hs-identifier hs-var">linkable</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Linkable -&gt; IO Linkable
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO Linkable -&gt; IO Linkable) -&gt; IO Linkable -&gt; IO Linkable
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Module -&gt; FilePath -&gt; UTCTime -&gt; IO Linkable
</span><a href="GHC.Driver.Finder.html#findObjectLinkable"><span class="hs-identifier hs-var">findObjectLinkable</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681203386"><span class="hs-identifier hs-var">this_mod</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681203382"><span class="hs-identifier hs-var">obj_fn</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621681203336"><span class="hs-identifier hs-var">obj_date</span></a></span><span>
</span><span id="line-1711"></span><span>                          </span><span class="annot"><span class="annottext">Maybe Linkable -&gt; SourceModified -&gt; IO HomeModInfo
</span><a href="#local-6989586621681203354"><span class="hs-identifier hs-var">compile_it_discard_iface</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Linkable -&gt; Maybe Linkable
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">Linkable
</span><a href="#local-6989586621681203332"><span class="hs-identifier hs-var">linkable</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SourceModified
</span><a href="GHC.Driver.Types.html#SourceUnmodified"><span class="hs-identifier hs-var">SourceUnmodified</span></a></span><span>
</span><span id="line-1712"></span><span>
</span><span id="line-1713"></span><span>          </span><span class="hs-comment">-- See Note [Recompilation checking in -fno-code mode]</span><span>
</span><span id="line-1714"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Driver.Pipeline.html#writeInterfaceOnlyMode"><span class="hs-identifier hs-var">writeInterfaceOnlyMode</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203374"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1715"></span><span>            </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681203331"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621681203331"><span class="hs-identifier hs-var">if_date</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe UTCTime
</span><a href="#local-6989586621681203384"><span class="hs-identifier hs-var">mb_if_date</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-1716"></span><span>            </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621681203331"><span class="hs-identifier hs-var">if_date</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime -&gt; UTCTime -&gt; Bool
forall a. Ord a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">&gt;=</span></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621681203380"><span class="hs-identifier hs-var">hs_date</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1717"></span><span>                </span><span class="annot"><span class="annottext">IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Int -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203395"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span>
</span><span id="line-1718"></span><span>                           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;skipping tc'd mod:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681203387"><span class="hs-identifier hs-var">this_mod_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1719"></span><span>                </span><span class="annot"><span class="annottext">Maybe Linkable -&gt; SourceModified -&gt; IO HomeModInfo
</span><a href="#local-6989586621681203358"><span class="hs-identifier hs-var">compile_it</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Linkable
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">SourceModified
</span><a href="GHC.Driver.Types.html#SourceUnmodified"><span class="hs-identifier hs-var">SourceUnmodified</span></a></span><span>
</span><span id="line-1720"></span><span>
</span><span id="line-1721"></span><span>         </span><span id="local-6989586621681203330"><span class="annot"><span class="annottext">()
</span><a href="#local-6989586621681203330"><span class="hs-identifier hs-var">_otherwise</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1722"></span><span>                </span><span class="annot"><span class="annottext">IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; Int -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203395"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">5</span></span><span>
</span><span id="line-1723"></span><span>                           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;compiling mod:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681203387"><span class="hs-identifier hs-var">this_mod_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1724"></span><span>                </span><span class="annot"><span class="annottext">Maybe Linkable -&gt; SourceModified -&gt; IO HomeModInfo
</span><a href="#local-6989586621681203358"><span class="hs-identifier hs-var">compile_it</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Linkable
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">SourceModified
</span><a href="GHC.Driver.Types.html#SourceModified"><span class="hs-identifier hs-var">SourceModified</span></a></span><span>
</span><span id="line-1725"></span><span>
</span><span id="line-1726"></span><span>
</span><span id="line-1727"></span><span class="hs-comment">{- Note [-fno-code mode]
~~~~~~~~~~~~~~~~~~~~~~~~
GHC offers the flag -fno-code for the purpose of parsing and typechecking a
program without generating object files. This is intended to be used by tooling
and IDEs to provide quick feedback on any parser or type errors as cheaply as
possible.

When GHC is invoked with -fno-code no object files or linked output will be
generated. As many errors and warnings as possible will be generated, as if
-fno-code had not been passed. The session DynFlags will have
hscTarget == HscNothing.

-fwrite-interface
~~~~~~~~~~~~~~~~
Whether interface files are generated in -fno-code mode is controlled by the
-fwrite-interface flag. The -fwrite-interface flag is a no-op if -fno-code is
not also passed. Recompilation avoidance requires interface files, so passing
-fno-code without -fwrite-interface should be avoided. If -fno-code were
re-implemented today, -fwrite-interface would be discarded and it would be
considered always on; this behaviour is as it is for backwards compatibility.

================================================================
IN SUMMARY: ALWAYS PASS -fno-code AND -fwrite-interface TOGETHER
================================================================

Template Haskell
~~~~~~~~~~~~~~~~
A module using template haskell may invoke an imported function from inside a
splice. This will cause the type-checker to attempt to execute that code, which
would fail if no object files had been generated. See #8025. To rectify this,
during the downsweep we patch the DynFlags in the ModSummary of any home module
that is imported by a module that uses template haskell, to generate object
code.

The flavour of generated object code is chosen by defaultObjectTarget for the
target platform. It would likely be faster to generate bytecode, but this is not
supported on all platforms(?Please Confirm?), and does not support the entirety
of GHC haskell. See #1257.

The object files (and interface files if -fwrite-interface is disabled) produced
for template haskell are written to temporary files.

Note that since template haskell can run arbitrary IO actions, -fno-code mode
is no more secure than running without it.

Potential TODOS:
~~~~~
* Remove -fwrite-interface and have interface files always written in -fno-code
  mode
* Both .o and .dyn_o files are generated for template haskell, but we only need
  .dyn_o. Fix it.
* In make mode, a message like
  Compiling A (A.hs, /tmp/ghc_123.o)
  is shown if downsweep enabled object code generation for A. Perhaps we should
  show &quot;nothing&quot; or &quot;temporary object file&quot; instead. Note that one
  can currently use -keep-tmp-files and inspect the generated file with the
  current behaviour.
* Offer a -no-codedir command line option, and write what were temporary
  object files there. This would speed up recompilation.
* Use existing object files (if they are up to date) instead of always
  generating temporary ones.
-}</span><span>
</span><span id="line-1789"></span><span>
</span><span id="line-1790"></span><span class="hs-comment">-- Note [Recompilation checking in -fno-code mode]</span><span>
</span><span id="line-1791"></span><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><span id="line-1792"></span><span class="hs-comment">-- If we are compiling with -fno-code -fwrite-interface, there won't</span><span>
</span><span id="line-1793"></span><span class="hs-comment">-- be any object code that we can compare against, nor should there</span><span>
</span><span id="line-1794"></span><span class="hs-comment">-- be: we're *just* generating interface files.  In this case, we</span><span>
</span><span id="line-1795"></span><span class="hs-comment">-- want to check if the interface file is new, in lieu of the object</span><span>
</span><span id="line-1796"></span><span class="hs-comment">-- file.  See also #9243.</span><span>
</span><span id="line-1797"></span><span>
</span><span id="line-1798"></span><span class="hs-comment">-- Filter modules in the HPT</span><span>
</span><span id="line-1799"></span><span class="annot"><a href="GHC.Driver.Make.html#retainInTopLevelEnvs"><span class="hs-identifier hs-type">retainInTopLevelEnvs</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HomePackageTable"><span class="hs-identifier hs-type">HomePackageTable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HomePackageTable"><span class="hs-identifier hs-type">HomePackageTable</span></a></span><span>
</span><span id="line-1800"></span><span id="retainInTopLevelEnvs"><span class="annot"><span class="annottext">retainInTopLevelEnvs :: [ModuleName] -&gt; HomePackageTable -&gt; HomePackageTable
</span><a href="GHC.Driver.Make.html#retainInTopLevelEnvs"><span class="hs-identifier hs-var hs-var">retainInTopLevelEnvs</span></a></span></span><span> </span><span id="local-6989586621681203328"><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621681203328"><span class="hs-identifier hs-var">keep_these</span></a></span></span><span> </span><span id="local-6989586621681203327"><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621681203327"><span class="hs-identifier hs-var">hpt</span></a></span></span><span>
</span><span id="line-1801"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(ModuleName, HomeModInfo)] -&gt; HomePackageTable
</span><a href="GHC.Driver.Types.html#listToHpt"><span class="hs-identifier hs-var">listToHpt</span></a></span><span>   </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681203325"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe HomeModInfo -&gt; HomeModInfo
forall a. HasCallStack =&gt; FilePath -&gt; Maybe a -&gt; a
</span><a href="GHC.Data.Maybe.html#expectJust"><span class="hs-identifier hs-var">expectJust</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;retain&quot;</span></span><span> </span><span class="annot"><span class="annottext">Maybe HomeModInfo
</span><a href="#local-6989586621681203324"><span class="hs-identifier hs-var">mb_mod_info</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1802"></span><span>                 </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681203325"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681203325"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621681203328"><span class="hs-identifier hs-var">keep_these</span></a></span><span>
</span><span id="line-1803"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681203324"><span class="annot"><span class="annottext">mb_mod_info :: Maybe HomeModInfo
</span><a href="#local-6989586621681203324"><span class="hs-identifier hs-var hs-var">mb_mod_info</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HomePackageTable -&gt; ModuleName -&gt; Maybe HomeModInfo
</span><a href="GHC.Driver.Types.html#lookupHpt"><span class="hs-identifier hs-var">lookupHpt</span></a></span><span> </span><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621681203327"><span class="hs-identifier hs-var">hpt</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681203325"><span class="hs-identifier hs-var">mod</span></a></span><span>
</span><span id="line-1804"></span><span>                 </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe HomeModInfo -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../../base/src/Data.Maybe.html#isJust"><span class="hs-identifier hs-var">isJust</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe HomeModInfo
</span><a href="#local-6989586621681203324"><span class="hs-identifier hs-var">mb_mod_info</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1805"></span><span>
</span><span id="line-1806"></span><span class="hs-comment">-- ---------------------------------------------------------------------------</span><span>
</span><span id="line-1807"></span><span class="hs-comment">-- Typecheck module loops</span><span>
</span><span id="line-1808"></span><span class="hs-comment">{-
See bug #930.  This code fixes a long-standing bug in --make.  The
problem is that when compiling the modules *inside* a loop, a data
type that is only defined at the top of the loop looks opaque; but
after the loop is done, the structure of the data type becomes
apparent.

The difficulty is then that two different bits of code have
different notions of what the data type looks like.

The idea is that after we compile a module which also has an .hs-boot
file, we re-generate the ModDetails for each of the modules that
depends on the .hs-boot file, so that everyone points to the proper
TyCons, Ids etc. defined by the real module, not the boot module.
Fortunately re-generating a ModDetails from a ModIface is easy: the
function GHC.IfaceToCore.typecheckIface does exactly that.

Picking the modules to re-typecheck is slightly tricky.  Starting from
the module graph consisting of the modules that have already been
compiled, we reverse the edges (so they point from the imported module
to the importing module), and depth-first-search from the .hs-boot
node.  This gives us all the modules that depend transitively on the
.hs-boot module, and those are exactly the modules that we need to
re-typecheck.

Following this fix, GHC can compile itself with --make -O2.
-}</span><span>
</span><span id="line-1835"></span><span>
</span><span id="line-1836"></span><span class="annot"><a href="GHC.Driver.Make.html#reTypecheckLoop"><span class="hs-identifier hs-type">reTypecheckLoop</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModuleGraph"><span class="hs-identifier hs-type">ModuleGraph</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-1837"></span><span id="reTypecheckLoop"><span class="annot"><span class="annottext">reTypecheckLoop :: HscEnv -&gt; ModSummary -&gt; ModuleGraph -&gt; IO HscEnv
</span><a href="GHC.Driver.Make.html#reTypecheckLoop"><span class="hs-identifier hs-var hs-var">reTypecheckLoop</span></a></span></span><span> </span><span id="local-6989586621681203323"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203323"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681203322"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203322"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span id="local-6989586621681203321"><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621681203321"><span class="hs-identifier hs-var">graph</span></a></span></span><span>
</span><span id="line-1838"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681203320"><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681203320"><span class="hs-identifier hs-var">loop</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModSummary
-&gt; [ModSummary] -&gt; (Module -&gt; Bool) -&gt; Maybe [ModSummary]
</span><a href="GHC.Driver.Make.html#getModLoop"><span class="hs-identifier hs-var">getModLoop</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203322"><span class="hs-identifier hs-var">ms</span></a></span><span> </span><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681203319"><span class="hs-identifier hs-var">mss</span></a></span><span> </span><span class="annot"><span class="annottext">Module -&gt; Bool
</span><a href="#local-6989586621681203318"><span class="hs-identifier hs-var">appearsAsBoot</span></a></span><span>
</span><span id="line-1839"></span><span>  </span><span class="hs-comment">-- SOME hs-boot files should still</span><span>
</span><span id="line-1840"></span><span>  </span><span class="hs-comment">-- get used, just not the loop-closer.</span><span>
</span><span id="line-1841"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681203314"><span class="annot"><span class="annottext">non_boot :: [ModSummary]
</span><a href="#local-6989586621681203314"><span class="hs-identifier hs-var hs-var">non_boot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ModSummary -&gt; Bool) -&gt; [ModSummary] -&gt; [ModSummary]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.List.html#filter"><span class="hs-identifier hs-var">filter</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621681203313"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203313"><span class="hs-identifier hs-var">l</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; IsBootInterface
</span><a href="GHC.Driver.Types.html#isBootSummary"><span class="hs-identifier hs-var">isBootSummary</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203313"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">IsBootInterface -&gt; IsBootInterface -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="GHC.Unit.Types.html#IsBoot"><span class="hs-identifier hs-var">IsBoot</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-1842"></span><span>                                 </span><span class="annot"><span class="annottext">ModSummary -&gt; Module
</span><a href="GHC.Driver.Types.html#ms_mod"><span class="hs-identifier hs-var hs-var">ms_mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203313"><span class="hs-identifier hs-var">l</span></a></span><span> </span><span class="annot"><span class="annottext">Module -&gt; Module -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; Module
</span><a href="GHC.Driver.Types.html#ms_mod"><span class="hs-identifier hs-var hs-var">ms_mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203322"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681203320"><span class="hs-identifier hs-var">loop</span></a></span><span>
</span><span id="line-1843"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; HscEnv -&gt; [ModuleName] -&gt; IO HscEnv
</span><a href="GHC.Driver.Make.html#typecheckLoop"><span class="hs-identifier hs-var">typecheckLoop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203323"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203323"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ModSummary -&gt; ModuleName) -&gt; [ModSummary] -&gt; [ModuleName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; ModuleName
</span><a href="GHC.Driver.Types.html#ms_mod_name"><span class="hs-identifier hs-var">ms_mod_name</span></a></span><span> </span><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681203314"><span class="hs-identifier hs-var">non_boot</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1844"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1845"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; IO HscEnv
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203323"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-1846"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1847"></span><span>  </span><span id="local-6989586621681203319"><span class="annot"><span class="annottext">mss :: [ModSummary]
</span><a href="#local-6989586621681203319"><span class="hs-identifier hs-var hs-var">mss</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleGraph -&gt; [ModSummary]
</span><a href="GHC.Driver.Types.html#mgModSummaries"><span class="hs-identifier hs-var">mgModSummaries</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621681203321"><span class="hs-identifier hs-var">graph</span></a></span><span>
</span><span id="line-1848"></span><span>  </span><span id="local-6989586621681203318"><span class="annot"><span class="annottext">appearsAsBoot :: Module -&gt; Bool
</span><a href="#local-6989586621681203318"><span class="hs-identifier hs-var hs-var">appearsAsBoot</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; ModuleSet -&gt; Bool
</span><a href="GHC.Unit.Module.Env.html#elemModuleSet"><span class="hs-operator hs-var">`elemModuleSet`</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraph -&gt; ModuleSet
</span><a href="GHC.Driver.Types.html#mgBootModules"><span class="hs-identifier hs-var">mgBootModules</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621681203321"><span class="hs-identifier hs-var">graph</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1849"></span><span>
</span><span id="line-1850"></span><span class="hs-comment">-- | Given a non-boot ModSummary @ms@ of a module, for which there exists a</span><span>
</span><span id="line-1851"></span><span class="hs-comment">-- corresponding boot file in @graph@, return the set of modules which</span><span>
</span><span id="line-1852"></span><span class="hs-comment">-- transitively depend on this boot file.  This function is slightly misnamed,</span><span>
</span><span id="line-1853"></span><span class="hs-comment">-- but its name &quot;getModLoop&quot; alludes to the fact that, when getModLoop is called</span><span>
</span><span id="line-1854"></span><span class="hs-comment">-- with a graph that does not contain @ms@ (non-parallel case) or is an</span><span>
</span><span id="line-1855"></span><span class="hs-comment">-- SCC with hs-boot nodes dropped (parallel-case), the modules which</span><span>
</span><span id="line-1856"></span><span class="hs-comment">-- depend on the hs-boot file are typically (but not always) the</span><span>
</span><span id="line-1857"></span><span class="hs-comment">-- modules participating in the recursive module loop.  The returned</span><span>
</span><span id="line-1858"></span><span class="hs-comment">-- list includes the hs-boot file.</span><span>
</span><span id="line-1859"></span><span class="hs-comment">--</span><span>
</span><span id="line-1860"></span><span class="hs-comment">-- Example:</span><span>
</span><span id="line-1861"></span><span class="hs-comment">--      let g represent the module graph:</span><span>
</span><span id="line-1862"></span><span class="hs-comment">--          C.hs</span><span>
</span><span id="line-1863"></span><span class="hs-comment">--          A.hs-boot imports C.hs</span><span>
</span><span id="line-1864"></span><span class="hs-comment">--          B.hs imports A.hs-boot</span><span>
</span><span id="line-1865"></span><span class="hs-comment">--          A.hs imports B.hs</span><span>
</span><span id="line-1866"></span><span class="hs-comment">--      genModLoop A.hs g == Just [A.hs-boot, B.hs, A.hs]</span><span>
</span><span id="line-1867"></span><span class="hs-comment">--</span><span>
</span><span id="line-1868"></span><span class="hs-comment">--      It would also be permissible to omit A.hs from the graph,</span><span>
</span><span id="line-1869"></span><span class="hs-comment">--      in which case the result is [A.hs-boot, B.hs]</span><span>
</span><span id="line-1870"></span><span class="hs-comment">--</span><span>
</span><span id="line-1871"></span><span class="hs-comment">-- Example:</span><span>
</span><span id="line-1872"></span><span class="hs-comment">--      A counter-example to the claim that modules returned</span><span>
</span><span id="line-1873"></span><span class="hs-comment">--      by this function participate in the loop occurs here:</span><span>
</span><span id="line-1874"></span><span class="hs-comment">--</span><span>
</span><span id="line-1875"></span><span class="hs-comment">--      let g represent the module graph:</span><span>
</span><span id="line-1876"></span><span class="hs-comment">--          C.hs</span><span>
</span><span id="line-1877"></span><span class="hs-comment">--          A.hs-boot imports C.hs</span><span>
</span><span id="line-1878"></span><span class="hs-comment">--          B.hs imports A.hs-boot</span><span>
</span><span id="line-1879"></span><span class="hs-comment">--          A.hs imports B.hs</span><span>
</span><span id="line-1880"></span><span class="hs-comment">--          D.hs imports A.hs-boot</span><span>
</span><span id="line-1881"></span><span class="hs-comment">--      genModLoop A.hs g == Just [A.hs-boot, B.hs, A.hs, D.hs]</span><span>
</span><span id="line-1882"></span><span class="hs-comment">--</span><span>
</span><span id="line-1883"></span><span class="hs-comment">--      Arguably, D.hs should import A.hs, not A.hs-boot, but</span><span>
</span><span id="line-1884"></span><span class="hs-comment">--      a dependency on the boot file is not illegal.</span><span>
</span><span id="line-1885"></span><span class="hs-comment">--</span><span>
</span><span id="line-1886"></span><span class="annot"><a href="GHC.Driver.Make.html#getModLoop"><span class="hs-identifier hs-type">getModLoop</span></a></span><span>
</span><span id="line-1887"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span>
</span><span id="line-1888"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1889"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- check if a module appears as a boot module in 'graph'</span><span>
</span><span id="line-1890"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1891"></span><span id="getModLoop"><span class="annot"><span class="annottext">getModLoop :: ModSummary
-&gt; [ModSummary] -&gt; (Module -&gt; Bool) -&gt; Maybe [ModSummary]
</span><a href="GHC.Driver.Make.html#getModLoop"><span class="hs-identifier hs-var hs-var">getModLoop</span></a></span></span><span> </span><span id="local-6989586621681203311"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203311"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span id="local-6989586621681203310"><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681203310"><span class="hs-identifier hs-var">graph</span></a></span></span><span> </span><span id="local-6989586621681203309"><span class="annot"><span class="annottext">Module -&gt; Bool
</span><a href="#local-6989586621681203309"><span class="hs-identifier hs-var">appearsAsBoot</span></a></span></span><span>
</span><span id="line-1892"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; IsBootInterface
</span><a href="GHC.Driver.Types.html#isBootSummary"><span class="hs-identifier hs-var">isBootSummary</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203311"><span class="hs-identifier hs-var">ms</span></a></span><span> </span><span class="annot"><span class="annottext">IsBootInterface -&gt; IsBootInterface -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="GHC.Unit.Types.html#NotBoot"><span class="hs-identifier hs-var">NotBoot</span></a></span><span>
</span><span id="line-1893"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Module -&gt; Bool
</span><a href="#local-6989586621681203309"><span class="hs-identifier hs-var">appearsAsBoot</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681203308"><span class="hs-identifier hs-var">this_mod</span></a></span><span>
</span><span id="line-1894"></span><span>  </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681203307"><span class="annot"><span class="annottext">mss :: [ModSummary]
</span><a href="#local-6989586621681203307"><span class="hs-identifier hs-var hs-var">mss</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; [ModSummary] -&gt; [ModSummary]
</span><a href="GHC.Driver.Make.html#reachableBackwards"><span class="hs-identifier hs-var">reachableBackwards</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; ModuleName
</span><a href="GHC.Driver.Types.html#ms_mod_name"><span class="hs-identifier hs-var">ms_mod_name</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203311"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681203310"><span class="hs-identifier hs-var">graph</span></a></span><span>
</span><span id="line-1895"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ModSummary] -&gt; Maybe [ModSummary]
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681203307"><span class="hs-identifier hs-var">mss</span></a></span><span>
</span><span id="line-1896"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1897"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe [ModSummary]
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-1898"></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-1899"></span><span>  </span><span id="local-6989586621681203308"><span class="annot"><span class="annottext">this_mod :: Module
</span><a href="#local-6989586621681203308"><span class="hs-identifier hs-var hs-var">this_mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; Module
</span><a href="GHC.Driver.Types.html#ms_mod"><span class="hs-identifier hs-var hs-var">ms_mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203311"><span class="hs-identifier hs-var">ms</span></a></span><span>
</span><span id="line-1900"></span><span>
</span><span id="line-1901"></span><span class="hs-comment">-- NB: sometimes mods has duplicates; this is harmless because</span><span>
</span><span id="line-1902"></span><span class="hs-comment">-- any duplicates get clobbered in addListToHpt and never get forced.</span><span>
</span><span id="line-1903"></span><span class="annot"><a href="GHC.Driver.Make.html#typecheckLoop"><span class="hs-identifier hs-type">typecheckLoop</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-1904"></span><span id="typecheckLoop"><span class="annot"><span class="annottext">typecheckLoop :: DynFlags -&gt; HscEnv -&gt; [ModuleName] -&gt; IO HscEnv
</span><a href="GHC.Driver.Make.html#typecheckLoop"><span class="hs-identifier hs-var hs-var">typecheckLoop</span></a></span></span><span> </span><span id="local-6989586621681203305"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203305"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621681203304"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203304"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681203303"><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621681203303"><span class="hs-identifier hs-var">mods</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1905"></span><span>  </span><span class="annot"><span class="annottext">DynFlags -&gt; Int -&gt; SDoc -&gt; IO ()
</span><a href="GHC.Utils.Error.html#debugTraceMsg"><span class="hs-identifier hs-var">debugTraceMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203305"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; IO ()) -&gt; SDoc -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1906"></span><span>     </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;Re-typechecking loop: &quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleName] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621681203303"><span class="hs-identifier hs-var">mods</span></a></span><span>
</span><span id="line-1907"></span><span>  </span><span id="local-6989586621681203301"><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621681203301"><span class="hs-identifier hs-var">new_hpt</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-1908"></span><span>    </span><span class="annot"><span class="annottext">(HomePackageTable -&gt; IO HomePackageTable) -&gt; IO HomePackageTable
forall a. (a -&gt; IO a) -&gt; IO a
</span><a href="../../base/src/System.IO.html#fixIO"><span class="hs-identifier hs-var">fixIO</span></a></span><span> </span><span class="annot"><span class="annottext">((HomePackageTable -&gt; IO HomePackageTable) -&gt; IO HomePackageTable)
-&gt; (HomePackageTable -&gt; IO HomePackageTable) -&gt; IO HomePackageTable
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681203300"><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621681203300"><span class="hs-identifier hs-var">new_hpt</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-1909"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681203299"><span class="annot"><span class="annottext">new_hsc_env :: HscEnv
</span><a href="#local-6989586621681203299"><span class="hs-identifier hs-var hs-var">new_hsc_env</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203304"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hsc_HPT :: HomePackageTable
</span><a href="GHC.Driver.Types.html#hsc_HPT"><span class="hs-identifier hs-var">hsc_HPT</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621681203300"><span class="hs-identifier hs-var">new_hpt</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1910"></span><span>      </span><span id="local-6989586621681203298"><span class="annot"><span class="annottext">[ModDetails]
</span><a href="#local-6989586621681203298"><span class="hs-identifier hs-var">mds</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; HscEnv -&gt; IfG [ModDetails] -&gt; IO [ModDetails]
forall a. SDoc -&gt; HscEnv -&gt; IfG a -&gt; IO a
</span><a href="GHC.Tc.Utils.Monad.html#initIfaceCheck"><span class="hs-identifier hs-var">initIfaceCheck</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;typecheckLoop&quot;</span></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203299"><span class="hs-identifier hs-var">new_hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(IfG [ModDetails] -&gt; IO [ModDetails])
-&gt; IfG [ModDetails] -&gt; IO [ModDetails]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-1911"></span><span>                </span><span class="annot"><span class="annottext">(HomeModInfo -&gt; IOEnv (Env IfGblEnv ()) ModDetails)
-&gt; [HomeModInfo] -&gt; IfG [ModDetails]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModIface_ 'ModIfaceFinal -&gt; IOEnv (Env IfGblEnv ()) ModDetails
</span><a href="GHC.IfaceToCore.html#typecheckIface"><span class="hs-identifier hs-var">typecheckIface</span></a></span><span> </span><span class="annot"><span class="annottext">(ModIface_ 'ModIfaceFinal -&gt; IOEnv (Env IfGblEnv ()) ModDetails)
-&gt; (HomeModInfo -&gt; ModIface_ 'ModIfaceFinal)
-&gt; HomeModInfo
-&gt; IOEnv (Env IfGblEnv ()) ModDetails
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">HomeModInfo -&gt; ModIface_ 'ModIfaceFinal
</span><a href="GHC.Driver.Types.html#hm_iface"><span class="hs-identifier hs-var hs-var">hm_iface</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[HomeModInfo]
</span><a href="#local-6989586621681203296"><span class="hs-identifier hs-var">hmis</span></a></span><span>
</span><span id="line-1912"></span><span>      </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681203295"><span class="annot"><span class="annottext">new_hpt :: HomePackageTable
</span><a href="#local-6989586621681203295"><span class="hs-identifier hs-var hs-var">new_hpt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HomePackageTable -&gt; [(ModuleName, HomeModInfo)] -&gt; HomePackageTable
</span><a href="GHC.Driver.Types.html#addListToHpt"><span class="hs-identifier hs-var">addListToHpt</span></a></span><span> </span><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621681203293"><span class="hs-identifier hs-var">old_hpt</span></a></span><span>
</span><span id="line-1913"></span><span>                        </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ModuleName] -&gt; [HomeModInfo] -&gt; [(ModuleName, HomeModInfo)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../../base/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621681203303"><span class="hs-identifier hs-var">mods</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621681203292"><span class="hs-identifier hs-var">hmi</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hm_details :: ModDetails
</span><a href="GHC.Driver.Types.html#hm_details"><span class="hs-identifier hs-var">hm_details</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModDetails
</span><a href="#local-6989586621681203291"><span class="hs-identifier hs-var">details</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1914"></span><span>                                  </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681203292"><span class="annot"><span class="annottext">HomeModInfo
</span><a href="#local-6989586621681203292"><span class="hs-identifier hs-var">hmi</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681203291"><span class="annot"><span class="annottext">ModDetails
</span><a href="#local-6989586621681203291"><span class="hs-identifier hs-var">details</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[HomeModInfo] -&gt; [ModDetails] -&gt; [(HomeModInfo, ModDetails)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../../base/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[HomeModInfo]
</span><a href="#local-6989586621681203296"><span class="hs-identifier hs-var">hmis</span></a></span><span> </span><span class="annot"><span class="annottext">[ModDetails]
</span><a href="#local-6989586621681203298"><span class="hs-identifier hs-var">mds</span></a></span><span> </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-1915"></span><span>      </span><span class="annot"><span class="annottext">HomePackageTable -&gt; IO HomePackageTable
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621681203295"><span class="hs-identifier hs-var">new_hpt</span></a></span><span>
</span><span id="line-1916"></span><span>  </span><span class="annot"><span class="annottext">HscEnv -&gt; IO HscEnv
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203304"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hsc_HPT :: HomePackageTable
</span><a href="GHC.Driver.Types.html#hsc_HPT"><span class="hs-identifier hs-var">hsc_HPT</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621681203301"><span class="hs-identifier hs-var">new_hpt</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-1917"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1918"></span><span>    </span><span id="local-6989586621681203293"><span class="annot"><span class="annottext">old_hpt :: HomePackageTable
</span><a href="#local-6989586621681203293"><span class="hs-identifier hs-var hs-var">old_hpt</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; HomePackageTable
</span><a href="GHC.Driver.Types.html#hsc_HPT"><span class="hs-identifier hs-var hs-var">hsc_HPT</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203304"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-1919"></span><span>    </span><span id="local-6989586621681203296"><span class="annot"><span class="annottext">hmis :: [HomeModInfo]
</span><a href="#local-6989586621681203296"><span class="hs-identifier hs-var hs-var">hmis</span></a></span></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ModuleName -&gt; HomeModInfo) -&gt; [ModuleName] -&gt; [HomeModInfo]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; Maybe HomeModInfo -&gt; HomeModInfo
forall a. HasCallStack =&gt; FilePath -&gt; Maybe a -&gt; a
</span><a href="GHC.Data.Maybe.html#expectJust"><span class="hs-identifier hs-var">expectJust</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;typecheckLoop&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Maybe HomeModInfo -&gt; HomeModInfo)
-&gt; (ModuleName -&gt; Maybe HomeModInfo) -&gt; ModuleName -&gt; HomeModInfo
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">HomePackageTable -&gt; ModuleName -&gt; Maybe HomeModInfo
</span><a href="GHC.Driver.Types.html#lookupHpt"><span class="hs-identifier hs-var">lookupHpt</span></a></span><span> </span><span class="annot"><span class="annottext">HomePackageTable
</span><a href="#local-6989586621681203293"><span class="hs-identifier hs-var">old_hpt</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621681203303"><span class="hs-identifier hs-var">mods</span></a></span><span>
</span><span id="line-1920"></span><span>
</span><span id="line-1921"></span><span class="annot"><a href="GHC.Driver.Make.html#reachableBackwards"><span class="hs-identifier hs-type">reachableBackwards</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1922"></span><span id="reachableBackwards"><span class="annot"><span class="annottext">reachableBackwards :: ModuleName -&gt; [ModSummary] -&gt; [ModSummary]
</span><a href="GHC.Driver.Make.html#reachableBackwards"><span class="hs-identifier hs-var hs-var">reachableBackwards</span></a></span></span><span> </span><span id="local-6989586621681203288"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681203288"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span id="local-6989586621681203287"><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681203287"><span class="hs-identifier hs-var">summaries</span></a></span></span><span>
</span><span id="line-1923"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">Node Int ModSummary -&gt; ModSummary
forall key payload. Node key payload -&gt; payload
</span><a href="GHC.Data.Graph.Directed.html#node_payload"><span class="hs-identifier hs-var hs-var">node_payload</span></a></span><span> </span><span class="annot"><span class="annottext">Node Int ModSummary
</span><a href="#local-6989586621681203285"><span class="hs-identifier hs-var">node</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681203285"><span class="annot"><span class="annottext">Node Int ModSummary
</span><a href="#local-6989586621681203285"><span class="hs-identifier hs-var">node</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Graph (Node Int ModSummary)
-&gt; Node Int ModSummary -&gt; [Node Int ModSummary]
forall node. Graph node -&gt; node -&gt; [node]
</span><a href="GHC.Data.Graph.Directed.html#reachableG"><span class="hs-identifier hs-var">reachableG</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Graph (Node Int ModSummary) -&gt; Graph (Node Int ModSummary)
forall node. Graph node -&gt; Graph node
</span><a href="GHC.Data.Graph.Directed.html#transposeG"><span class="hs-identifier hs-var">transposeG</span></a></span><span> </span><span class="annot"><span class="annottext">Graph (Node Int ModSummary)
</span><a href="#local-6989586621681203282"><span class="hs-identifier hs-var">graph</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Node Int ModSummary
</span><a href="#local-6989586621681203281"><span class="hs-identifier hs-var">root</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-1924"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span class="hs-comment">-- the rest just sets up the graph:</span><span>
</span><span id="line-1925"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621681203282"><span class="annot"><span class="annottext">Graph (Node Int ModSummary)
</span><a href="#local-6989586621681203282"><span class="hs-identifier hs-var">graph</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681203280"><span class="annot"><span class="annottext">NodeKey -&gt; Maybe (Node Int ModSummary)
</span><a href="#local-6989586621681203280"><span class="hs-identifier hs-var">lookup_node</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
-&gt; [ModSummary]
-&gt; (Graph (Node Int ModSummary),
    NodeKey -&gt; Maybe (Node Int ModSummary))
</span><a href="GHC.Driver.Make.html#moduleGraphNodes"><span class="hs-identifier hs-var">moduleGraphNodes</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span> </span><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681203287"><span class="hs-identifier hs-var">summaries</span></a></span><span>
</span><span id="line-1926"></span><span>        </span><span id="local-6989586621681203281"><span class="annot"><span class="annottext">root :: Node Int ModSummary
</span><a href="#local-6989586621681203281"><span class="hs-identifier hs-var hs-var">root</span></a></span></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe (Node Int ModSummary) -&gt; Node Int ModSummary
forall a. HasCallStack =&gt; FilePath -&gt; Maybe a -&gt; a
</span><a href="GHC.Data.Maybe.html#expectJust"><span class="hs-identifier hs-var">expectJust</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;reachableBackwards&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NodeKey -&gt; Maybe (Node Int ModSummary)
</span><a href="#local-6989586621681203280"><span class="hs-identifier hs-var">lookup_node</span></a></span><span> </span><span class="annot"><span class="annottext">(NodeKey -&gt; Maybe (Node Int ModSummary))
-&gt; NodeKey -&gt; Maybe (Node Int ModSummary)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; IsBootInterface -&gt; NodeKey
forall mod. mod -&gt; IsBootInterface -&gt; GenWithIsBoot mod
</span><a href="GHC.Unit.Types.html#GWIB"><span class="hs-identifier hs-var">GWIB</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681203288"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="GHC.Unit.Types.html#IsBoot"><span class="hs-identifier hs-var">IsBoot</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1927"></span><span>
</span><span id="line-1928"></span><span class="hs-comment">-- ---------------------------------------------------------------------------</span><span>
</span><span id="line-1929"></span><span class="hs-comment">--</span><span>
</span><span id="line-1930"></span><span class="hs-comment">-- | Topological sort of the module graph</span><span>
</span><span id="line-1931"></span><span class="annot"><a href="GHC.Driver.Make.html#topSortModuleGraph"><span class="hs-identifier hs-type">topSortModuleGraph</span></a></span><span>
</span><span id="line-1932"></span><span>          </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-1933"></span><span>          </span><span class="hs-comment">-- ^ Drop hi-boot nodes? (see below)</span><span>
</span><span id="line-1934"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModuleGraph"><span class="hs-identifier hs-type">ModuleGraph</span></a></span><span>
</span><span id="line-1935"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span>
</span><span id="line-1936"></span><span>             </span><span class="hs-comment">-- ^ Root module name.  If @Nothing@, use the full graph.</span><span>
</span><span id="line-1937"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../containers/src/Data.Graph.html#SCC"><span class="hs-identifier hs-type">SCC</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1938"></span><span class="hs-comment">-- ^ Calculate SCCs of the module graph, possibly dropping the hi-boot nodes</span><span>
</span><span id="line-1939"></span><span class="hs-comment">-- The resulting list of strongly-connected-components is in topologically</span><span>
</span><span id="line-1940"></span><span class="hs-comment">-- sorted order, starting with the module(s) at the bottom of the</span><span>
</span><span id="line-1941"></span><span class="hs-comment">-- dependency graph (ie compile them first) and ending with the ones at</span><span>
</span><span id="line-1942"></span><span class="hs-comment">-- the top.</span><span>
</span><span id="line-1943"></span><span class="hs-comment">--</span><span>
</span><span id="line-1944"></span><span class="hs-comment">-- Drop hi-boot nodes (first boolean arg)?</span><span>
</span><span id="line-1945"></span><span class="hs-comment">--</span><span>
</span><span id="line-1946"></span><span class="hs-comment">-- - @False@:   treat the hi-boot summaries as nodes of the graph,</span><span>
</span><span id="line-1947"></span><span class="hs-comment">--              so the graph must be acyclic</span><span>
</span><span id="line-1948"></span><span class="hs-comment">--</span><span>
</span><span id="line-1949"></span><span class="hs-comment">-- - @True@:    eliminate the hi-boot nodes, and instead pretend</span><span>
</span><span id="line-1950"></span><span class="hs-comment">--              the a source-import of Foo is an import of Foo</span><span>
</span><span id="line-1951"></span><span class="hs-comment">--              The resulting graph has no hi-boot nodes, but can be cyclic</span><span>
</span><span id="line-1952"></span><span>
</span><span id="line-1953"></span><span id="topSortModuleGraph"><span class="annot"><span class="annottext">topSortModuleGraph :: Bool -&gt; ModuleGraph -&gt; Maybe ModuleName -&gt; [SCC ModSummary]
</span><a href="GHC.Driver.Make.html#topSortModuleGraph"><span class="hs-identifier hs-var hs-var">topSortModuleGraph</span></a></span></span><span> </span><span id="local-6989586621681203277"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681203277"><span class="hs-identifier hs-var">drop_hs_boot_nodes</span></a></span></span><span> </span><span id="local-6989586621681203276"><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621681203276"><span class="hs-identifier hs-var">module_graph</span></a></span></span><span> </span><span id="local-6989586621681203275"><span class="annot"><span class="annottext">Maybe ModuleName
</span><a href="#local-6989586621681203275"><span class="hs-identifier hs-var">mb_root_mod</span></a></span></span><span>
</span><span id="line-1954"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(SCC (Node Int ModSummary) -&gt; SCC ModSummary)
-&gt; [SCC (Node Int ModSummary)] -&gt; [SCC ModSummary]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Node Int ModSummary -&gt; ModSummary)
-&gt; SCC (Node Int ModSummary) -&gt; SCC ModSummary
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Node Int ModSummary -&gt; ModSummary
</span><a href="GHC.Driver.Make.html#summaryNodeSummary"><span class="hs-identifier hs-var">summaryNodeSummary</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">([SCC (Node Int ModSummary)] -&gt; [SCC ModSummary])
-&gt; [SCC (Node Int ModSummary)] -&gt; [SCC ModSummary]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Graph (Node Int ModSummary) -&gt; [SCC (Node Int ModSummary)]
forall node. Graph node -&gt; [SCC node]
</span><a href="GHC.Data.Graph.Directed.html#stronglyConnCompG"><span class="hs-identifier hs-var">stronglyConnCompG</span></a></span><span> </span><span class="annot"><span class="annottext">Graph (Node Int ModSummary)
</span><a href="#local-6989586621681203272"><span class="hs-identifier hs-var">initial_graph</span></a></span><span>
</span><span id="line-1955"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1956"></span><span>    </span><span id="local-6989586621681203271"><span class="annot"><span class="annottext">summaries :: [ModSummary]
</span><a href="#local-6989586621681203271"><span class="hs-identifier hs-var hs-var">summaries</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleGraph -&gt; [ModSummary]
</span><a href="GHC.Driver.Types.html#mgModSummaries"><span class="hs-identifier hs-var">mgModSummaries</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleGraph
</span><a href="#local-6989586621681203276"><span class="hs-identifier hs-var">module_graph</span></a></span><span>
</span><span id="line-1957"></span><span>    </span><span class="hs-comment">-- stronglyConnCompG flips the original order, so if we reverse</span><span>
</span><span id="line-1958"></span><span>    </span><span class="hs-comment">-- the summaries we get a stable topological sort.</span><span>
</span><span id="line-1959"></span><span>    </span><span class="hs-special">(</span><span id="local-6989586621681203270"><span class="annot"><span class="annottext">Graph (Node Int ModSummary)
</span><a href="#local-6989586621681203270"><span class="hs-identifier hs-var">graph</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681203269"><span class="annot"><span class="annottext">NodeKey -&gt; Maybe (Node Int ModSummary)
</span><a href="#local-6989586621681203269"><span class="hs-identifier hs-var">lookup_node</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1960"></span><span>      </span><span class="annot"><span class="annottext">Bool
-&gt; [ModSummary]
-&gt; (Graph (Node Int ModSummary),
    NodeKey -&gt; Maybe (Node Int ModSummary))
</span><a href="GHC.Driver.Make.html#moduleGraphNodes"><span class="hs-identifier hs-var">moduleGraphNodes</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681203277"><span class="hs-identifier hs-var">drop_hs_boot_nodes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ModSummary] -&gt; [ModSummary]
forall a. [a] -&gt; [a]
</span><a href="../../base/src/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681203271"><span class="hs-identifier hs-var">summaries</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-1961"></span><span>
</span><span id="line-1962"></span><span>    </span><span id="local-6989586621681203272"><span class="annot"><span class="annottext">initial_graph :: Graph (Node Int ModSummary)
</span><a href="#local-6989586621681203272"><span class="hs-identifier hs-var hs-var">initial_graph</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe ModuleName
</span><a href="#local-6989586621681203275"><span class="hs-identifier hs-var">mb_root_mod</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-1963"></span><span>        </span><span class="annot"><span class="annottext">Maybe ModuleName
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Graph (Node Int ModSummary)
</span><a href="#local-6989586621681203270"><span class="hs-identifier hs-var">graph</span></a></span><span>
</span><span id="line-1964"></span><span>        </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681203267"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681203267"><span class="hs-identifier hs-var">root_mod</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-1965"></span><span>            </span><span class="hs-comment">-- restrict the graph to just those modules reachable from</span><span>
</span><span id="line-1966"></span><span>            </span><span class="hs-comment">-- the specified module.  We do this by building a graph with</span><span>
</span><span id="line-1967"></span><span>            </span><span class="hs-comment">-- the full set of nodes, and determining the reachable set from</span><span>
</span><span id="line-1968"></span><span>            </span><span class="hs-comment">-- the specified node.</span><span>
</span><span id="line-1969"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681203266"><span class="annot"><span class="annottext">root :: Node Int ModSummary
</span><a href="#local-6989586621681203266"><span class="hs-identifier hs-var hs-var">root</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681203265"><span class="annot"><span class="annottext">Node Int ModSummary
</span><a href="#local-6989586621681203265"><span class="hs-identifier hs-var">node</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NodeKey -&gt; Maybe (Node Int ModSummary)
</span><a href="#local-6989586621681203269"><span class="hs-identifier hs-var">lookup_node</span></a></span><span> </span><span class="annot"><span class="annottext">(NodeKey -&gt; Maybe (Node Int ModSummary))
-&gt; NodeKey -&gt; Maybe (Node Int ModSummary)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; IsBootInterface -&gt; NodeKey
forall mod. mod -&gt; IsBootInterface -&gt; GenWithIsBoot mod
</span><a href="GHC.Unit.Types.html#GWIB"><span class="hs-identifier hs-var">GWIB</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681203267"><span class="hs-identifier hs-var">root_mod</span></a></span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="GHC.Unit.Types.html#NotBoot"><span class="hs-identifier hs-var">NotBoot</span></a></span><span>
</span><span id="line-1970"></span><span>                     </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Graph (Node Int ModSummary)
</span><a href="#local-6989586621681203270"><span class="hs-identifier hs-var">graph</span></a></span><span> </span><span class="annot"><span class="annottext">Graph (Node Int ModSummary) -&gt; Node Int ModSummary -&gt; Bool
forall node. Graph node -&gt; node -&gt; Bool
</span><a href="GHC.Data.Graph.Directed.html#hasVertexG"><span class="hs-operator hs-var">`hasVertexG`</span></a></span><span> </span><span class="annot"><span class="annottext">Node Int ModSummary
</span><a href="#local-6989586621681203265"><span class="hs-identifier hs-var">node</span></a></span><span>
</span><span id="line-1971"></span><span>                     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Node Int ModSummary
</span><a href="#local-6989586621681203265"><span class="hs-identifier hs-var">node</span></a></span><span>
</span><span id="line-1972"></span><span>                     </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-1973"></span><span>                     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GhcException -&gt; Node Int ModSummary
forall a. GhcException -&gt; a
</span><a href="GHC.Utils.Panic.html#throwGhcException"><span class="hs-identifier hs-var">throwGhcException</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; GhcException
</span><a href="GHC.Utils.Panic.html#ProgramError"><span class="hs-identifier hs-var">ProgramError</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;module does not exist&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-1974"></span><span>            </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">[Node Int ModSummary] -&gt; Graph (Node Int ModSummary)
forall key payload.
Uniquable key =&gt;
[Node key payload] -&gt; Graph (Node key payload)
</span><a href="GHC.Data.Graph.Directed.html#graphFromEdgedVerticesUniq"><span class="hs-identifier hs-var">graphFromEdgedVerticesUniq</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Node Int ModSummary
-&gt; [Node Int ModSummary] -&gt; [Node Int ModSummary]
</span><span class="hs-identifier hs-var">seq</span></span><span> </span><span class="annot"><span class="annottext">Node Int ModSummary
</span><a href="#local-6989586621681203266"><span class="hs-identifier hs-var">root</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Graph (Node Int ModSummary)
-&gt; Node Int ModSummary -&gt; [Node Int ModSummary]
forall node. Graph node -&gt; node -&gt; [node]
</span><a href="GHC.Data.Graph.Directed.html#reachableG"><span class="hs-identifier hs-var">reachableG</span></a></span><span> </span><span class="annot"><span class="annottext">Graph (Node Int ModSummary)
</span><a href="#local-6989586621681203270"><span class="hs-identifier hs-var">graph</span></a></span><span> </span><span class="annot"><span class="annottext">Node Int ModSummary
</span><a href="#local-6989586621681203266"><span class="hs-identifier hs-var">root</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-1975"></span><span>
</span><span id="line-1976"></span><span class="hs-keyword">type</span><span> </span><span id="SummaryNode"><span class="annot"><a href="GHC.Driver.Make.html#SummaryNode"><span class="hs-identifier hs-var">SummaryNode</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Data.Graph.Directed.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span>
</span><span id="line-1977"></span><span>
</span><span id="line-1978"></span><span class="annot"><a href="GHC.Driver.Make.html#summaryNodeKey"><span class="hs-identifier hs-type">summaryNodeKey</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#SummaryNode"><span class="hs-identifier hs-type">SummaryNode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-1979"></span><span id="summaryNodeKey"><span class="annot"><span class="annottext">summaryNodeKey :: Node Int ModSummary -&gt; Int
</span><a href="GHC.Driver.Make.html#summaryNodeKey"><span class="hs-identifier hs-var hs-var">summaryNodeKey</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Node Int ModSummary -&gt; Int
forall key payload. Node key payload -&gt; key
</span><a href="GHC.Data.Graph.Directed.html#node_key"><span class="hs-identifier hs-var hs-var">node_key</span></a></span><span>
</span><span id="line-1980"></span><span>
</span><span id="line-1981"></span><span class="annot"><a href="GHC.Driver.Make.html#summaryNodeSummary"><span class="hs-identifier hs-type">summaryNodeSummary</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#SummaryNode"><span class="hs-identifier hs-type">SummaryNode</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span>
</span><span id="line-1982"></span><span id="summaryNodeSummary"><span class="annot"><span class="annottext">summaryNodeSummary :: Node Int ModSummary -&gt; ModSummary
</span><a href="GHC.Driver.Make.html#summaryNodeSummary"><span class="hs-identifier hs-var hs-var">summaryNodeSummary</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Node Int ModSummary -&gt; ModSummary
forall key payload. Node key payload -&gt; payload
</span><a href="GHC.Data.Graph.Directed.html#node_payload"><span class="hs-identifier hs-var hs-var">node_payload</span></a></span><span>
</span><span id="line-1983"></span><span>
</span><span id="line-1984"></span><span class="annot"><a href="GHC.Driver.Make.html#unfilteredEdges"><span class="hs-identifier hs-type">unfilteredEdges</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Types.html#ModuleNameWithIsBoot"><span class="hs-identifier hs-type">ModuleNameWithIsBoot</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-1985"></span><span id="unfilteredEdges"><span class="annot"><span class="annottext">unfilteredEdges :: Bool -&gt; ModSummary -&gt; [NodeKey]
</span><a href="GHC.Driver.Make.html#unfilteredEdges"><span class="hs-identifier hs-var hs-var">unfilteredEdges</span></a></span></span><span> </span><span id="local-6989586621681203260"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681203260"><span class="hs-identifier hs-var">drop_hs_boot_nodes</span></a></span></span><span> </span><span id="local-6989586621681203259"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203259"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-1986"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ModuleName -&gt; IsBootInterface -&gt; NodeKey)
-&gt; IsBootInterface -&gt; ModuleName -&gt; NodeKey
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#flip"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; IsBootInterface -&gt; NodeKey
forall mod. mod -&gt; IsBootInterface -&gt; GenWithIsBoot mod
</span><a href="GHC.Unit.Types.html#GWIB"><span class="hs-identifier hs-var">GWIB</span></a></span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="#local-6989586621681203258"><span class="hs-identifier hs-var">hs_boot_key</span></a></span><span> </span><span class="annot"><span class="annottext">(ModuleName -&gt; NodeKey)
-&gt; (GenLocated SrcSpan ModuleName -&gt; ModuleName)
-&gt; GenLocated SrcSpan ModuleName
-&gt; NodeKey
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpan ModuleName -&gt; ModuleName
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpan ModuleName -&gt; NodeKey)
-&gt; [GenLocated SrcSpan ModuleName] -&gt; [NodeKey]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; [GenLocated SrcSpan ModuleName]
</span><a href="GHC.Driver.Types.html#ms_home_srcimps"><span class="hs-identifier hs-var">ms_home_srcimps</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203259"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[NodeKey] -&gt; [NodeKey] -&gt; [NodeKey]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-1987"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ModuleName -&gt; IsBootInterface -&gt; NodeKey)
-&gt; IsBootInterface -&gt; ModuleName -&gt; NodeKey
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#flip"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; IsBootInterface -&gt; NodeKey
forall mod. mod -&gt; IsBootInterface -&gt; GenWithIsBoot mod
</span><a href="GHC.Unit.Types.html#GWIB"><span class="hs-identifier hs-var">GWIB</span></a></span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="GHC.Unit.Types.html#NotBoot"><span class="hs-identifier hs-var">NotBoot</span></a></span><span>     </span><span class="annot"><span class="annottext">(ModuleName -&gt; NodeKey)
-&gt; (GenLocated SrcSpan ModuleName -&gt; ModuleName)
-&gt; GenLocated SrcSpan ModuleName
-&gt; NodeKey
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpan ModuleName -&gt; ModuleName
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpan ModuleName -&gt; NodeKey)
-&gt; [GenLocated SrcSpan ModuleName] -&gt; [NodeKey]
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; [GenLocated SrcSpan ModuleName]
</span><a href="GHC.Driver.Types.html#ms_home_imps"><span class="hs-identifier hs-var">ms_home_imps</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203259"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[NodeKey] -&gt; [NodeKey] -&gt; [NodeKey]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-1988"></span><span>    </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; IsBootInterface -&gt; NodeKey
forall mod. mod -&gt; IsBootInterface -&gt; GenWithIsBoot mod
</span><a href="GHC.Unit.Types.html#GWIB"><span class="hs-identifier hs-var">GWIB</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; ModuleName
</span><a href="GHC.Driver.Types.html#ms_mod_name"><span class="hs-identifier hs-var">ms_mod_name</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203259"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="GHC.Unit.Types.html#IsBoot"><span class="hs-identifier hs-var">IsBoot</span></a></span><span>
</span><span id="line-1989"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681203260"><span class="hs-identifier hs-var">drop_hs_boot_nodes</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; HscSource
</span><a href="GHC.Driver.Types.html#ms_hsc_src"><span class="hs-identifier hs-var hs-var">ms_hsc_src</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203259"><span class="hs-identifier hs-var">ms</span></a></span><span> </span><span class="annot"><span class="annottext">HscSource -&gt; HscSource -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="GHC.Driver.Phases.html#HsBootFile"><span class="hs-identifier hs-var">HsBootFile</span></a></span><span>
</span><span id="line-1990"></span><span>      </span><span class="hs-comment">-- see [boot-edges] below</span><span>
</span><span id="line-1991"></span><span>    </span><span class="hs-special">]</span><span>
</span><span id="line-1992"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-1993"></span><span>    </span><span class="hs-comment">-- [boot-edges] if this is a .hs and there is an equivalent</span><span>
</span><span id="line-1994"></span><span>    </span><span class="hs-comment">-- .hs-boot, add a link from the former to the latter.  This</span><span>
</span><span id="line-1995"></span><span>    </span><span class="hs-comment">-- has the effect of detecting bogus cases where the .hs-boot</span><span>
</span><span id="line-1996"></span><span>    </span><span class="hs-comment">-- depends on the .hs, by introducing a cycle.  Additionally,</span><span>
</span><span id="line-1997"></span><span>    </span><span class="hs-comment">-- it ensures that we will always process the .hs-boot before</span><span>
</span><span id="line-1998"></span><span>    </span><span class="hs-comment">-- the .hs, and so the HomePackageTable will always have the</span><span>
</span><span id="line-1999"></span><span>    </span><span class="hs-comment">-- most up to date information.</span><span>
</span><span id="line-2000"></span><span>
</span><span id="line-2001"></span><span>    </span><span class="hs-comment">-- Drop hs-boot nodes by using HsSrcFile as the key</span><span>
</span><span id="line-2002"></span><span>    </span><span id="local-6989586621681203258"><span class="annot"><span class="annottext">hs_boot_key :: IsBootInterface
</span><a href="#local-6989586621681203258"><span class="hs-identifier hs-var hs-var">hs_boot_key</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681203260"><span class="hs-identifier hs-var">drop_hs_boot_nodes</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="GHC.Unit.Types.html#NotBoot"><span class="hs-identifier hs-var">NotBoot</span></a></span><span> </span><span class="hs-comment">-- is regular mod or signature</span><span>
</span><span id="line-2003"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="GHC.Unit.Types.html#IsBoot"><span class="hs-identifier hs-var">IsBoot</span></a></span><span>
</span><span id="line-2004"></span><span>
</span><span id="line-2005"></span><span class="annot"><a href="GHC.Driver.Make.html#moduleGraphNodes"><span class="hs-identifier hs-type">moduleGraphNodes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2006"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.Graph.Directed.html#Graph"><span class="hs-identifier hs-type">Graph</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#SummaryNode"><span class="hs-identifier hs-type">SummaryNode</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#ModuleNameWithIsBoot"><span class="hs-identifier hs-type">ModuleNameWithIsBoot</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#SummaryNode"><span class="hs-identifier hs-type">SummaryNode</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2007"></span><span id="moduleGraphNodes"><span class="annot"><span class="annottext">moduleGraphNodes :: Bool
-&gt; [ModSummary]
-&gt; (Graph (Node Int ModSummary),
    NodeKey -&gt; Maybe (Node Int ModSummary))
</span><a href="GHC.Driver.Make.html#moduleGraphNodes"><span class="hs-identifier hs-var hs-var">moduleGraphNodes</span></a></span></span><span> </span><span id="local-6989586621681203257"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681203257"><span class="hs-identifier hs-var">drop_hs_boot_nodes</span></a></span></span><span> </span><span id="local-6989586621681203256"><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681203256"><span class="hs-identifier hs-var">summaries</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2008"></span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Node Int ModSummary] -&gt; Graph (Node Int ModSummary)
forall key payload.
Uniquable key =&gt;
[Node key payload] -&gt; Graph (Node key payload)
</span><a href="GHC.Data.Graph.Directed.html#graphFromEdgedVerticesUniq"><span class="hs-identifier hs-var">graphFromEdgedVerticesUniq</span></a></span><span> </span><span class="annot"><span class="annottext">[Node Int ModSummary]
</span><a href="#local-6989586621681203255"><span class="hs-identifier hs-var">nodes</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">NodeKey -&gt; Maybe (Node Int ModSummary)
</span><a href="#local-6989586621681203254"><span class="hs-identifier hs-var">lookup_node</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2009"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2010"></span><span>    </span><span id="local-6989586621681203251"><span class="annot"><span class="annottext">numbered_summaries :: [(ModSummary, Int)]
</span><a href="#local-6989586621681203251"><span class="hs-identifier hs-var hs-var">numbered_summaries</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ModSummary] -&gt; [Int] -&gt; [(ModSummary, Int)]
forall a b. [a] -&gt; [b] -&gt; [(a, b)]
</span><a href="../../base/src/GHC.List.html#zip"><span class="hs-identifier hs-var">zip</span></a></span><span> </span><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681203256"><span class="hs-identifier hs-var">summaries</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">1</span></span><span class="hs-glyph">..</span><span class="hs-special">]</span><span>
</span><span id="line-2011"></span><span>
</span><span id="line-2012"></span><span>    </span><span class="annot"><a href="#local-6989586621681203254"><span class="hs-identifier hs-type">lookup_node</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#ModuleNameWithIsBoot"><span class="hs-identifier hs-type">ModuleNameWithIsBoot</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#SummaryNode"><span class="hs-identifier hs-type">SummaryNode</span></a></span><span>
</span><span id="line-2013"></span><span>    </span><span id="local-6989586621681203254"><span class="annot"><span class="annottext">lookup_node :: NodeKey -&gt; Maybe (Node Int ModSummary)
</span><a href="#local-6989586621681203254"><span class="hs-identifier hs-var hs-var">lookup_node</span></a></span></span><span> </span><span id="local-6989586621681203250"><span class="annot"><span class="annottext">NodeKey
</span><a href="#local-6989586621681203250"><span class="hs-identifier hs-var">mnwib</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NodeKey
-&gt; Map NodeKey (Node Int ModSummary) -&gt; Maybe (Node Int ModSummary)
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../containers/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">NodeKey
</span><a href="#local-6989586621681203250"><span class="hs-identifier hs-var">mnwib</span></a></span><span> </span><span class="annot"><span class="annottext">Map NodeKey (Node Int ModSummary)
</span><a href="#local-6989586621681203249"><span class="hs-identifier hs-var">node_map</span></a></span><span>
</span><span id="line-2014"></span><span>
</span><span id="line-2015"></span><span>    </span><span class="annot"><a href="#local-6989586621681203248"><span class="hs-identifier hs-type">lookup_key</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#ModuleNameWithIsBoot"><span class="hs-identifier hs-type">ModuleNameWithIsBoot</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span>
</span><span id="line-2016"></span><span>    </span><span id="local-6989586621681203248"><span class="annot"><span class="annottext">lookup_key :: NodeKey -&gt; Maybe Int
</span><a href="#local-6989586621681203248"><span class="hs-identifier hs-var hs-var">lookup_key</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Node Int ModSummary -&gt; Int)
-&gt; Maybe (Node Int ModSummary) -&gt; Maybe Int
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/GHC.Base.html#fmap"><span class="hs-identifier hs-var">fmap</span></a></span><span> </span><span class="annot"><span class="annottext">Node Int ModSummary -&gt; Int
</span><a href="GHC.Driver.Make.html#summaryNodeKey"><span class="hs-identifier hs-var">summaryNodeKey</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe (Node Int ModSummary) -&gt; Maybe Int)
-&gt; (NodeKey -&gt; Maybe (Node Int ModSummary)) -&gt; NodeKey -&gt; Maybe Int
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">NodeKey -&gt; Maybe (Node Int ModSummary)
</span><a href="#local-6989586621681203254"><span class="hs-identifier hs-var">lookup_node</span></a></span><span>
</span><span id="line-2017"></span><span>
</span><span id="line-2018"></span><span>    </span><span class="annot"><a href="#local-6989586621681203249"><span class="hs-identifier hs-type">node_map</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#NodeMap"><span class="hs-identifier hs-type">NodeMap</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#SummaryNode"><span class="hs-identifier hs-type">SummaryNode</span></a></span><span>
</span><span id="line-2019"></span><span>    </span><span id="local-6989586621681203249"><span class="annot"><span class="annottext">node_map :: Map NodeKey (Node Int ModSummary)
</span><a href="#local-6989586621681203249"><span class="hs-identifier hs-var hs-var">node_map</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(NodeKey, Node Int ModSummary)]
-&gt; Map NodeKey (Node Int ModSummary)
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="../../containers/src/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">Map.fromList</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; NodeKey
</span><a href="GHC.Driver.Make.html#mkHomeBuildModule"><span class="hs-identifier hs-var">mkHomeBuildModule</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203247"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Node Int ModSummary
</span><a href="#local-6989586621681203246"><span class="hs-identifier hs-var">node</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2020"></span><span>                            </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681203246"><span class="annot"><span class="annottext">Node Int ModSummary
</span><a href="#local-6989586621681203246"><span class="hs-identifier hs-var">node</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Node Int ModSummary]
</span><a href="#local-6989586621681203255"><span class="hs-identifier hs-var">nodes</span></a></span><span>
</span><span id="line-2021"></span><span>                            </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681203247"><span class="annot"><span class="annottext">s :: ModSummary
</span><a href="#local-6989586621681203247"><span class="hs-identifier hs-var hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Node Int ModSummary -&gt; ModSummary
</span><a href="GHC.Driver.Make.html#summaryNodeSummary"><span class="hs-identifier hs-var">summaryNodeSummary</span></a></span><span> </span><span class="annot"><span class="annottext">Node Int ModSummary
</span><a href="#local-6989586621681203246"><span class="hs-identifier hs-var">node</span></a></span><span>
</span><span id="line-2022"></span><span>                            </span><span class="hs-special">]</span><span>
</span><span id="line-2023"></span><span>
</span><span id="line-2024"></span><span>    </span><span class="hs-comment">-- We use integers as the keys for the SCC algorithm</span><span>
</span><span id="line-2025"></span><span>    </span><span class="annot"><a href="#local-6989586621681203255"><span class="hs-identifier hs-type">nodes</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Driver.Make.html#SummaryNode"><span class="hs-identifier hs-type">SummaryNode</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2026"></span><span>    </span><span id="local-6989586621681203255"><span class="annot"><span class="annottext">nodes :: [Node Int ModSummary]
</span><a href="#local-6989586621681203255"><span class="hs-identifier hs-var hs-var">nodes</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; Int -&gt; [Int] -&gt; Node Int ModSummary
forall key payload. payload -&gt; key -&gt; [key] -&gt; Node key payload
</span><a href="GHC.Data.Graph.Directed.html#DigraphNode"><span class="hs-identifier hs-var">DigraphNode</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203244"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681203243"><span class="hs-identifier hs-var">key</span></a></span><span> </span><span class="annot"><span class="annottext">([Int] -&gt; Node Int ModSummary) -&gt; [Int] -&gt; Node Int ModSummary
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[NodeKey] -&gt; [Int]
</span><a href="#local-6989586621681203242"><span class="hs-identifier hs-var">out_edge_keys</span></a></span><span> </span><span class="annot"><span class="annottext">([NodeKey] -&gt; [Int]) -&gt; [NodeKey] -&gt; [Int]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; ModSummary -&gt; [NodeKey]
</span><a href="GHC.Driver.Make.html#unfilteredEdges"><span class="hs-identifier hs-var">unfilteredEdges</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681203257"><span class="hs-identifier hs-var">drop_hs_boot_nodes</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203244"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-2027"></span><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681203244"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203244"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681203243"><span class="annot"><span class="annottext">Int
</span><a href="#local-6989586621681203243"><span class="hs-identifier hs-var">key</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[(ModSummary, Int)]
</span><a href="#local-6989586621681203251"><span class="hs-identifier hs-var">numbered_summaries</span></a></span><span>
</span><span id="line-2028"></span><span>             </span><span class="hs-comment">-- Drop the hi-boot ones if told to do so</span><span>
</span><span id="line-2029"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; IsBootInterface
</span><a href="GHC.Driver.Types.html#isBootSummary"><span class="hs-identifier hs-var">isBootSummary</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203244"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">IsBootInterface -&gt; IsBootInterface -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="GHC.Unit.Types.html#IsBoot"><span class="hs-identifier hs-var">IsBoot</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681203257"><span class="hs-identifier hs-var">drop_hs_boot_nodes</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2030"></span><span>            </span><span class="hs-special">]</span><span>
</span><span id="line-2031"></span><span>
</span><span id="line-2032"></span><span>    </span><span class="annot"><a href="#local-6989586621681203242"><span class="hs-identifier hs-type">out_edge_keys</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Types.html#ModuleNameWithIsBoot"><span class="hs-identifier hs-type">ModuleNameWithIsBoot</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="hs-identifier hs-type">Int</span></span><span class="hs-special">]</span><span>
</span><span id="line-2033"></span><span>    </span><span id="local-6989586621681203242"><span class="annot"><span class="annottext">out_edge_keys :: [NodeKey] -&gt; [Int]
</span><a href="#local-6989586621681203242"><span class="hs-identifier hs-var hs-var">out_edge_keys</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(NodeKey -&gt; Maybe Int) -&gt; [NodeKey] -&gt; [Int]
forall a b. (a -&gt; Maybe b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/Data.Maybe.html#mapMaybe"><span class="hs-identifier hs-var">mapMaybe</span></a></span><span> </span><span class="annot"><span class="annottext">NodeKey -&gt; Maybe Int
</span><a href="#local-6989586621681203248"><span class="hs-identifier hs-var">lookup_key</span></a></span><span>
</span><span id="line-2034"></span><span>        </span><span class="hs-comment">-- If we want keep_hi_boot_nodes, then we do lookup_key with</span><span>
</span><span id="line-2035"></span><span>        </span><span class="hs-comment">-- IsBoot; else False</span><span>
</span><span id="line-2036"></span><span>
</span><span id="line-2037"></span><span class="hs-comment">-- The nodes of the graph are keyed by (mod, is boot?) pairs</span><span>
</span><span id="line-2038"></span><span class="hs-comment">-- NB: hsig files show up as *normal* nodes (not boot!), since they don't</span><span>
</span><span id="line-2039"></span><span class="hs-comment">-- participate in cycles (for now)</span><span>
</span><span id="line-2040"></span><span class="hs-keyword">type</span><span> </span><span id="NodeKey"><span class="annot"><a href="GHC.Driver.Make.html#NodeKey"><span class="hs-identifier hs-var">NodeKey</span></a></span></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#ModuleNameWithIsBoot"><span class="hs-identifier hs-type">ModuleNameWithIsBoot</span></a></span><span>
</span><span id="line-2041"></span><span class="hs-keyword">type</span><span> </span><span id="NodeMap"><span class="annot"><a href="GHC.Driver.Make.html#NodeMap"><span class="hs-identifier hs-var">NodeMap</span></a></span></span><span> </span><span id="local-6989586621681203241"><span class="annot"><a href="#local-6989586621681203241"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="../../containers/src/Data.Map.Internal.html#Map"><span class="hs-identifier hs-type">Map.Map</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#NodeKey"><span class="hs-identifier hs-type">NodeKey</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681203241"><span class="hs-identifier hs-type">a</span></a></span><span>
</span><span id="line-2042"></span><span>
</span><span id="line-2043"></span><span class="annot"><a href="GHC.Driver.Make.html#msKey"><span class="hs-identifier hs-type">msKey</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#NodeKey"><span class="hs-identifier hs-type">NodeKey</span></a></span><span>
</span><span id="line-2044"></span><span id="msKey"><span class="annot"><span class="annottext">msKey :: ModSummary -&gt; NodeKey
</span><a href="GHC.Driver.Make.html#msKey"><span class="hs-identifier hs-var hs-var">msKey</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ms_mod :: ModSummary -&gt; Module
</span><a href="GHC.Driver.Types.html#ms_mod"><span class="hs-identifier hs-var">ms_mod</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681203239"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681203239"><span class="hs-identifier hs-var">mod</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ms_hsc_src :: ModSummary -&gt; HscSource
</span><a href="GHC.Driver.Types.html#ms_hsc_src"><span class="hs-identifier hs-var">ms_hsc_src</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681203238"><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621681203238"><span class="hs-identifier hs-var">boot</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-2045"></span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GWIB :: forall mod. mod -&gt; IsBootInterface -&gt; GenWithIsBoot mod
</span><a href="GHC.Unit.Types.html#GWIB"><span class="hs-identifier hs-type">GWIB</span></a></span><span>
</span><span id="line-2046"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">gwib_mod :: ModuleName
</span><a href="GHC.Unit.Types.html#gwib_mod"><span class="hs-identifier hs-var">gwib_mod</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var hs-var">moduleName</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681203239"><span class="hs-identifier hs-var">mod</span></a></span><span>
</span><span id="line-2047"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">gwib_isBoot :: IsBootInterface
</span><a href="GHC.Unit.Types.html#gwib_isBoot"><span class="hs-identifier hs-var">gwib_isBoot</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscSource -&gt; IsBootInterface
</span><a href="GHC.Driver.Make.html#hscSourceToIsBoot"><span class="hs-identifier hs-var">hscSourceToIsBoot</span></a></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621681203238"><span class="hs-identifier hs-var">boot</span></a></span><span>
</span><span id="line-2048"></span><span>        </span><span class="hs-special">}</span><span>
</span><span id="line-2049"></span><span>
</span><span id="line-2050"></span><span class="annot"><a href="GHC.Driver.Make.html#mkNodeMap"><span class="hs-identifier hs-type">mkNodeMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#NodeMap"><span class="hs-identifier hs-type">NodeMap</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span>
</span><span id="line-2051"></span><span id="mkNodeMap"><span class="annot"><span class="annottext">mkNodeMap :: [ModSummary] -&gt; NodeMap ModSummary
</span><a href="GHC.Driver.Make.html#mkNodeMap"><span class="hs-identifier hs-var hs-var">mkNodeMap</span></a></span></span><span> </span><span id="local-6989586621681203236"><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681203236"><span class="hs-identifier hs-var">summaries</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(NodeKey, ModSummary)] -&gt; NodeMap ModSummary
forall k a. Ord k =&gt; [(k, a)] -&gt; Map k a
</span><a href="../../containers/src/Data.Map.Internal.html#fromList"><span class="hs-identifier hs-var">Map.fromList</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; NodeKey
</span><a href="GHC.Driver.Make.html#msKey"><span class="hs-identifier hs-var">msKey</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203235"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203235"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681203235"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203235"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681203236"><span class="hs-identifier hs-var">summaries</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2052"></span><span>
</span><span id="line-2053"></span><span id="local-6989586621681204983"><span class="annot"><a href="GHC.Driver.Make.html#nodeMapElts"><span class="hs-identifier hs-type">nodeMapElts</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#NodeMap"><span class="hs-identifier hs-type">NodeMap</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681204983"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621681204983"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span></span><span>
</span><span id="line-2054"></span><span id="nodeMapElts"><span class="annot"><span class="annottext">nodeMapElts :: forall a. NodeMap a -&gt; [a]
</span><a href="GHC.Driver.Make.html#nodeMapElts"><span class="hs-identifier hs-var hs-var">nodeMapElts</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Map NodeKey a -&gt; [a]
forall k a. Map k a -&gt; [a]
</span><a href="../../containers/src/Data.Map.Internal.html#elems"><span class="hs-identifier hs-var">Map.elems</span></a></span><span>
</span><span id="line-2055"></span><span>
</span><span id="line-2056"></span><span class="hs-comment">-- | If there are {-# SOURCE #-} imports between strongly connected</span><span>
</span><span id="line-2057"></span><span class="hs-comment">-- components in the topological sort, then those imports can</span><span>
</span><span id="line-2058"></span><span class="hs-comment">-- definitely be replaced by ordinary non-SOURCE imports: if SOURCE</span><span>
</span><span id="line-2059"></span><span class="hs-comment">-- were necessary, then the edge would be part of a cycle.</span><span>
</span><span id="line-2060"></span><span id="local-6989586621681205201"><span class="annot"><a href="GHC.Driver.Make.html#warnUnnecessarySourceImports"><span class="hs-identifier hs-type">warnUnnecessarySourceImports</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Monad.html#GhcMonad"><span class="hs-identifier hs-type">GhcMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681205201"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../containers/src/Data.Graph.html#SCC"><span class="hs-identifier hs-type">SCC</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681205201"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span></span><span>
</span><span id="line-2061"></span><span id="warnUnnecessarySourceImports"><span class="annot"><span class="annottext">warnUnnecessarySourceImports :: forall (m :: * -&gt; *). GhcMonad m =&gt; [SCC ModSummary] -&gt; m ()
</span><a href="GHC.Driver.Make.html#warnUnnecessarySourceImports"><span class="hs-identifier hs-var hs-var">warnUnnecessarySourceImports</span></a></span></span><span> </span><span id="local-6989586621681203218"><span class="annot"><span class="annottext">[SCC ModSummary]
</span><a href="#local-6989586621681203218"><span class="hs-identifier hs-var">sccs</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2062"></span><span>  </span><span id="local-6989586621681203217"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203217"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-2063"></span><span>  </span><span class="annot"><span class="annottext">Bool -&gt; m () -&gt; m ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">WarningFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#wopt"><span class="hs-identifier hs-var">wopt</span></a></span><span> </span><span class="annot"><span class="annottext">WarningFlag
</span><a href="GHC.Driver.Flags.html#Opt_WarnUnusedImports"><span class="hs-identifier hs-var">Opt_WarnUnusedImports</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203217"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2064"></span><span>    </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ErrorMessages -&gt; m ()
forall (m :: * -&gt; *). GhcMonad m =&gt; ErrorMessages -&gt; m ()
</span><a href="GHC.Driver.Monad.html#logWarnings"><span class="hs-identifier hs-var">logWarnings</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ErrMsg] -&gt; ErrorMessages
forall a. [a] -&gt; Bag a
</span><a href="GHC.Data.Bag.html#listToBag"><span class="hs-identifier hs-var">listToBag</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(SCC ModSummary -&gt; [ErrMsg]) -&gt; [SCC ModSummary] -&gt; [ErrMsg]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><a href="../../base/src/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; [ModSummary] -&gt; [ErrMsg]
</span><a href="#local-6989586621681203214"><span class="hs-identifier hs-var">check</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203217"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">([ModSummary] -&gt; [ErrMsg])
-&gt; (SCC ModSummary -&gt; [ModSummary]) -&gt; SCC ModSummary -&gt; [ErrMsg]
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">SCC ModSummary -&gt; [ModSummary]
forall vertex. SCC vertex -&gt; [vertex]
</span><a href="../../containers/src/Data.Graph.html#flattenSCC"><span class="hs-identifier hs-var">flattenSCC</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[SCC ModSummary]
</span><a href="#local-6989586621681203218"><span class="hs-identifier hs-var">sccs</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2065"></span><span>  </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621681203214"><span class="annot"><span class="annottext">check :: DynFlags -&gt; [ModSummary] -&gt; [ErrMsg]
</span><a href="#local-6989586621681203214"><span class="hs-identifier hs-var hs-var">check</span></a></span></span><span> </span><span id="local-6989586621681203211"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203211"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621681203210"><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681203210"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2066"></span><span>           </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681203209"><span class="annot"><span class="annottext">mods_in_this_cycle :: [ModuleName]
</span><a href="#local-6989586621681203209"><span class="hs-identifier hs-var hs-var">mods_in_this_cycle</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ModSummary -&gt; ModuleName) -&gt; [ModSummary] -&gt; [ModuleName]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; ModuleName
</span><a href="GHC.Driver.Types.html#ms_mod_name"><span class="hs-identifier hs-var">ms_mod_name</span></a></span><span> </span><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681203210"><span class="hs-identifier hs-var">ms</span></a></span><span> </span><span class="hs-keyword">in</span><span>
</span><span id="line-2067"></span><span>           </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; GenLocated SrcSpan ModuleName -&gt; ErrMsg
</span><a href="#local-6989586621681203208"><span class="hs-identifier hs-var">warn</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203211"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpan ModuleName
</span><a href="#local-6989586621681203207"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681203206"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203206"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681203210"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681203207"><span class="annot"><span class="annottext">GenLocated SrcSpan ModuleName
</span><a href="#local-6989586621681203207"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; [GenLocated SrcSpan ModuleName]
</span><a href="GHC.Driver.Types.html#ms_home_srcimps"><span class="hs-identifier hs-var">ms_home_srcimps</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203206"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-2068"></span><span>                             </span><span class="annot"><span class="annottext">GenLocated SrcSpan ModuleName -&gt; ModuleName
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpan ModuleName
</span><a href="#local-6989586621681203207"><span class="hs-identifier hs-var">i</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; [ModuleName] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#notElem"><span class="hs-operator hs-var">`notElem`</span></a></span><span>  </span><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621681203209"><span class="hs-identifier hs-var">mods_in_this_cycle</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2069"></span><span>
</span><span id="line-2070"></span><span>        </span><span class="annot"><a href="#local-6989586621681203208"><span class="hs-identifier hs-type">warn</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#WarnMsg"><span class="hs-identifier hs-type">WarnMsg</span></a></span><span>
</span><span id="line-2071"></span><span>        </span><span id="local-6989586621681203208"><span class="annot"><span class="annottext">warn :: DynFlags -&gt; GenLocated SrcSpan ModuleName -&gt; ErrMsg
</span><a href="#local-6989586621681203208"><span class="hs-identifier hs-var hs-var">warn</span></a></span></span><span> </span><span id="local-6989586621681203203"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203203"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681203201"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681203201"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681203200"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681203200"><span class="hs-identifier hs-var">mod</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2072"></span><span>           </span><span class="annot"><span class="annottext">DynFlags -&gt; SrcSpan -&gt; SDoc -&gt; ErrMsg
</span><a href="GHC.Utils.Error.html#mkPlainErrMsg"><span class="hs-identifier hs-var">mkPlainErrMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203203"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681203201"><span class="hs-identifier hs-var">loc</span></a></span><span>
</span><span id="line-2073"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;Warning: {-# SOURCE #-} unnecessary in import of &quot;</span></span><span>
</span><span id="line-2074"></span><span>                 </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681203200"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2075"></span><span>
</span><span id="line-2076"></span><span>
</span><span id="line-2077"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-2078"></span><span class="hs-comment">--</span><span>
</span><span id="line-2079"></span><span class="hs-comment">-- | Downsweep (dependency analysis)</span><span>
</span><span id="line-2080"></span><span class="hs-comment">--</span><span>
</span><span id="line-2081"></span><span class="hs-comment">-- Chase downwards from the specified root set, returning summaries</span><span>
</span><span id="line-2082"></span><span class="hs-comment">-- for all home modules encountered.  Only follow source-import</span><span>
</span><span id="line-2083"></span><span class="hs-comment">-- links.</span><span>
</span><span id="line-2084"></span><span class="hs-comment">--</span><span>
</span><span id="line-2085"></span><span class="hs-comment">-- We pass in the previous collection of summaries, which is used as a</span><span>
</span><span id="line-2086"></span><span class="hs-comment">-- cache to avoid recalculating a module summary if the source is</span><span>
</span><span id="line-2087"></span><span class="hs-comment">-- unchanged.</span><span>
</span><span id="line-2088"></span><span class="hs-comment">--</span><span>
</span><span id="line-2089"></span><span class="hs-comment">-- The returned list of [ModSummary] nodes has one node for each home-package</span><span>
</span><span id="line-2090"></span><span class="hs-comment">-- module, plus one for any hs-boot files.  The imports of these nodes</span><span>
</span><span id="line-2091"></span><span class="hs-comment">-- are all there, including the imports of non-home-package modules.</span><span>
</span><span id="line-2092"></span><span class="annot"><a href="GHC.Driver.Make.html#downsweep"><span class="hs-identifier hs-type">downsweep</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-2093"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">]</span><span>       </span><span class="hs-comment">-- Old summaries</span><span>
</span><span id="line-2094"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span class="hs-special">]</span><span>       </span><span class="hs-comment">-- Ignore dependencies on these; treat</span><span>
</span><span id="line-2095"></span><span>                                </span><span class="hs-comment">-- them as if they were package modules</span><span>
</span><span id="line-2096"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>               </span><span class="hs-comment">-- True &lt;=&gt; allow multiple targets to have</span><span>
</span><span id="line-2097"></span><span>                                </span><span class="hs-comment">--          the same module name; this is</span><span>
</span><span id="line-2098"></span><span>                                </span><span class="hs-comment">--          very useful for ghc -M</span><span>
</span><span id="line-2099"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../base/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#ErrorMessages"><span class="hs-identifier hs-type">ErrorMessages</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2100"></span><span>                </span><span class="hs-comment">-- The elts of [ModSummary] all have distinct</span><span>
</span><span id="line-2101"></span><span>                </span><span class="hs-comment">-- (Modules, IsBoot) identifiers, unless the Bool is true</span><span>
</span><span id="line-2102"></span><span>                </span><span class="hs-comment">-- in which case there can be repeats</span><span>
</span><span id="line-2103"></span><span id="downsweep"><span class="annot"><span class="annottext">downsweep :: HscEnv
-&gt; [ModSummary]
-&gt; [ModuleName]
-&gt; Bool
-&gt; IO [Either ErrorMessages ModSummary]
</span><a href="GHC.Driver.Make.html#downsweep"><span class="hs-identifier hs-var hs-var">downsweep</span></a></span></span><span> </span><span id="local-6989586621681203199"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203199"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681203198"><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681203198"><span class="hs-identifier hs-var">old_summaries</span></a></span></span><span> </span><span id="local-6989586621681203197"><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621681203197"><span class="hs-identifier hs-var">excl_mods</span></a></span></span><span> </span><span id="local-6989586621681203196"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681203196"><span class="hs-identifier hs-var">allow_dup_roots</span></a></span></span><span>
</span><span id="line-2104"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2105"></span><span>       </span><span id="local-6989586621681203195"><span class="annot"><span class="annottext">[Either ErrorMessages ModSummary]
</span><a href="#local-6989586621681203195"><span class="hs-identifier hs-var">rootSummaries</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">(Target -&gt; IO (Either ErrorMessages ModSummary))
-&gt; [Target] -&gt; IO [Either ErrorMessages ModSummary]
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Traversable t, Monad m) =&gt;
(a -&gt; m b) -&gt; t a -&gt; m (t b)
</span><a href="../../base/src/Data.Traversable.html#mapM"><span class="hs-identifier hs-var">mapM</span></a></span><span> </span><span class="annot"><span class="annottext">Target -&gt; IO (Either ErrorMessages ModSummary)
</span><a href="#local-6989586621681203194"><span class="hs-identifier hs-var">getRootSummary</span></a></span><span> </span><span class="annot"><span class="annottext">[Target]
</span><a href="#local-6989586621681203193"><span class="hs-identifier hs-var">roots</span></a></span><span>
</span><span id="line-2106"></span><span>       </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681203192"><span class="annot"><span class="annottext">[ErrorMessages]
</span><a href="#local-6989586621681203192"><span class="hs-identifier hs-var">errs</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681203191"><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681203191"><span class="hs-identifier hs-var">rootSummariesOk</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[Either ErrorMessages ModSummary]
-&gt; ([ErrorMessages], [ModSummary])
forall a b. [Either a b] -&gt; ([a], [b])
</span><a href="../../base/src/Data.Either.html#partitionEithers"><span class="hs-identifier hs-var">partitionEithers</span></a></span><span> </span><span class="annot"><span class="annottext">[Either ErrorMessages ModSummary]
</span><a href="#local-6989586621681203195"><span class="hs-identifier hs-var">rootSummaries</span></a></span><span> </span><span class="hs-comment">-- #17549</span><span>
</span><span id="line-2107"></span><span>           </span><span id="local-6989586621681203190"><span class="annot"><span class="annottext">root_map :: NodeMap [Either ErrorMessages ModSummary]
</span><a href="#local-6989586621681203190"><span class="hs-identifier hs-var hs-var">root_map</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ModSummary] -&gt; NodeMap [Either ErrorMessages ModSummary]
</span><a href="GHC.Driver.Make.html#mkRootMap"><span class="hs-identifier hs-var">mkRootMap</span></a></span><span> </span><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681203191"><span class="hs-identifier hs-var">rootSummariesOk</span></a></span><span>
</span><span id="line-2108"></span><span>       </span><span class="annot"><span class="annottext">NodeMap [Either ErrorMessages ModSummary] -&gt; IO ()
</span><a href="#local-6989586621681203188"><span class="hs-identifier hs-var">checkDuplicates</span></a></span><span> </span><span class="annot"><span class="annottext">NodeMap [Either ErrorMessages ModSummary]
</span><a href="#local-6989586621681203190"><span class="hs-identifier hs-var">root_map</span></a></span><span>
</span><span id="line-2109"></span><span>       </span><span id="local-6989586621681203187"><span class="annot"><span class="annottext">NodeMap [Either ErrorMessages ModSummary]
</span><a href="#local-6989586621681203187"><span class="hs-identifier hs-var">map0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[GenWithIsBoot (GenLocated SrcSpan ModuleName)]
-&gt; NodeMap [Either ErrorMessages ModSummary]
-&gt; IO (NodeMap [Either ErrorMessages ModSummary])
</span><a href="#local-6989586621681203186"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ModSummary -&gt; [GenWithIsBoot (GenLocated SrcSpan ModuleName)])
-&gt; [ModSummary] -&gt; [GenWithIsBoot (GenLocated SrcSpan ModuleName)]
forall (t :: * -&gt; *) a b. Foldable t =&gt; (a -&gt; [b]) -&gt; t a -&gt; [b]
</span><a href="../../base/src/Data.Foldable.html#concatMap"><span class="hs-identifier hs-var">concatMap</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; [GenWithIsBoot (GenLocated SrcSpan ModuleName)]
</span><a href="#local-6989586621681203185"><span class="hs-identifier hs-var">calcDeps</span></a></span><span> </span><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681203191"><span class="hs-identifier hs-var">rootSummariesOk</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NodeMap [Either ErrorMessages ModSummary]
</span><a href="#local-6989586621681203190"><span class="hs-identifier hs-var">root_map</span></a></span><span>
</span><span id="line-2110"></span><span>       </span><span class="hs-comment">-- if we have been passed -fno-code, we enable code generation</span><span>
</span><span id="line-2111"></span><span>       </span><span class="hs-comment">-- for dependencies of modules that have -XTemplateHaskell,</span><span>
</span><span id="line-2112"></span><span>       </span><span class="hs-comment">-- otherwise those modules will fail to compile.</span><span>
</span><span id="line-2113"></span><span>       </span><span class="hs-comment">-- See Note [-fno-code mode] #8025</span><span>
</span><span id="line-2114"></span><span>       </span><span id="local-6989586621681203184"><span class="annot"><span class="annottext">NodeMap [Either ErrorMessages ModSummary]
</span><a href="#local-6989586621681203184"><span class="hs-identifier hs-var">map1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; HscTarget
</span><a href="GHC.Driver.Session.html#hscTarget"><span class="hs-identifier hs-var hs-var">hscTarget</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203183"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscTarget -&gt; HscTarget -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">HscTarget
</span><a href="GHC.Driver.Session.html#HscNothing"><span class="hs-identifier hs-var">HscNothing</span></a></span><span>
</span><span id="line-2115"></span><span>         </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">HscTarget
-&gt; NodeMap [Either ErrorMessages ModSummary]
-&gt; IO (NodeMap [Either ErrorMessages ModSummary])
</span><a href="GHC.Driver.Make.html#enableCodeGenForTH"><span class="hs-identifier hs-var">enableCodeGenForTH</span></a></span><span>
</span><span id="line-2116"></span><span>           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; HscTarget
</span><a href="GHC.Driver.Session.html#defaultObjectTarget"><span class="hs-identifier hs-var">defaultObjectTarget</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203183"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2117"></span><span>           </span><span class="annot"><span class="annottext">NodeMap [Either ErrorMessages ModSummary]
</span><a href="#local-6989586621681203187"><span class="hs-identifier hs-var">map0</span></a></span><span>
</span><span id="line-2118"></span><span>         </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; HscTarget
</span><a href="GHC.Driver.Session.html#hscTarget"><span class="hs-identifier hs-var hs-var">hscTarget</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203183"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscTarget -&gt; HscTarget -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">HscTarget
</span><a href="GHC.Driver.Session.html#HscInterpreted"><span class="hs-identifier hs-var">HscInterpreted</span></a></span><span>
</span><span id="line-2119"></span><span>           </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">HscTarget
-&gt; NodeMap [Either ErrorMessages ModSummary]
-&gt; IO (NodeMap [Either ErrorMessages ModSummary])
</span><a href="GHC.Driver.Make.html#enableCodeGenForUnboxedTuplesOrSums"><span class="hs-identifier hs-var">enableCodeGenForUnboxedTuplesOrSums</span></a></span><span>
</span><span id="line-2120"></span><span>             </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; HscTarget
</span><a href="GHC.Driver.Session.html#defaultObjectTarget"><span class="hs-identifier hs-var">defaultObjectTarget</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203183"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2121"></span><span>             </span><span class="annot"><span class="annottext">NodeMap [Either ErrorMessages ModSummary]
</span><a href="#local-6989586621681203187"><span class="hs-identifier hs-var">map0</span></a></span><span>
</span><span id="line-2122"></span><span>           </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">NodeMap [Either ErrorMessages ModSummary]
-&gt; IO (NodeMap [Either ErrorMessages ModSummary])
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">NodeMap [Either ErrorMessages ModSummary]
</span><a href="#local-6989586621681203187"><span class="hs-identifier hs-var">map0</span></a></span><span>
</span><span id="line-2123"></span><span>       </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[ErrorMessages] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[ErrorMessages]
</span><a href="#local-6989586621681203192"><span class="hs-identifier hs-var">errs</span></a></span><span>
</span><span id="line-2124"></span><span>         </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">[Either ErrorMessages ModSummary]
-&gt; IO [Either ErrorMessages ModSummary]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">([Either ErrorMessages ModSummary]
 -&gt; IO [Either ErrorMessages ModSummary])
-&gt; [Either ErrorMessages ModSummary]
-&gt; IO [Either ErrorMessages ModSummary]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[[Either ErrorMessages ModSummary]]
-&gt; [Either ErrorMessages ModSummary]
forall (t :: * -&gt; *) a. Foldable t =&gt; t [a] -&gt; [a]
</span><a href="../../base/src/Data.Foldable.html#concat"><span class="hs-identifier hs-var">concat</span></a></span><span> </span><span class="annot"><span class="annottext">([[Either ErrorMessages ModSummary]]
 -&gt; [Either ErrorMessages ModSummary])
-&gt; [[Either ErrorMessages ModSummary]]
-&gt; [Either ErrorMessages ModSummary]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NodeMap [Either ErrorMessages ModSummary]
-&gt; [[Either ErrorMessages ModSummary]]
forall a. NodeMap a -&gt; [a]
</span><a href="GHC.Driver.Make.html#nodeMapElts"><span class="hs-identifier hs-var">nodeMapElts</span></a></span><span> </span><span class="annot"><span class="annottext">NodeMap [Either ErrorMessages ModSummary]
</span><a href="#local-6989586621681203184"><span class="hs-identifier hs-var">map1</span></a></span><span>
</span><span id="line-2125"></span><span>         </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">[Either ErrorMessages ModSummary]
-&gt; IO [Either ErrorMessages ModSummary]
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><a href="../../base/src/GHC.Base.html#pure"><span class="hs-identifier hs-var">pure</span></a></span><span> </span><span class="annot"><span class="annottext">([Either ErrorMessages ModSummary]
 -&gt; IO [Either ErrorMessages ModSummary])
-&gt; [Either ErrorMessages ModSummary]
-&gt; IO [Either ErrorMessages ModSummary]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrorMessages -&gt; Either ErrorMessages ModSummary)
-&gt; [ErrorMessages] -&gt; [Either ErrorMessages ModSummary]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorMessages -&gt; Either ErrorMessages ModSummary
forall a b. a -&gt; Either a b
</span><a href="../../base/src/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">[ErrorMessages]
</span><a href="#local-6989586621681203192"><span class="hs-identifier hs-var">errs</span></a></span><span>
</span><span id="line-2126"></span><span>     </span><span class="hs-keyword">where</span><span>
</span><span id="line-2127"></span><span>        </span><span id="local-6989586621681203185"><span class="annot"><span class="annottext">calcDeps :: ModSummary -&gt; [GenWithIsBoot (GenLocated SrcSpan ModuleName)]
</span><a href="#local-6989586621681203185"><span class="hs-identifier hs-var hs-var">calcDeps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; [GenWithIsBoot (GenLocated SrcSpan ModuleName)]
</span><a href="GHC.Driver.Make.html#msDeps"><span class="hs-identifier hs-var">msDeps</span></a></span><span>
</span><span id="line-2128"></span><span>
</span><span id="line-2129"></span><span>        </span><span id="local-6989586621681203183"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621681203183"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203199"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2130"></span><span>        </span><span id="local-6989586621681203193"><span class="annot"><span class="annottext">roots :: [Target]
</span><a href="#local-6989586621681203193"><span class="hs-identifier hs-var hs-var">roots</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; [Target]
</span><a href="GHC.Driver.Types.html#hsc_targets"><span class="hs-identifier hs-var hs-var">hsc_targets</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203199"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2131"></span><span>
</span><span id="line-2132"></span><span>        </span><span class="annot"><a href="#local-6989586621681203178"><span class="hs-identifier hs-type">old_summary_map</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#NodeMap"><span class="hs-identifier hs-type">NodeMap</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span>
</span><span id="line-2133"></span><span>        </span><span id="local-6989586621681203178"><span class="annot"><span class="annottext">old_summary_map :: NodeMap ModSummary
</span><a href="#local-6989586621681203178"><span class="hs-identifier hs-var hs-var">old_summary_map</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ModSummary] -&gt; NodeMap ModSummary
</span><a href="GHC.Driver.Make.html#mkNodeMap"><span class="hs-identifier hs-var">mkNodeMap</span></a></span><span> </span><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681203198"><span class="hs-identifier hs-var">old_summaries</span></a></span><span>
</span><span id="line-2134"></span><span>
</span><span id="line-2135"></span><span>        </span><span class="annot"><a href="#local-6989586621681203194"><span class="hs-identifier hs-type">getRootSummary</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#Target"><span class="hs-identifier hs-type">Target</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#ErrorMessages"><span class="hs-identifier hs-type">ErrorMessages</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2136"></span><span>        </span><span id="local-6989586621681203194"><span class="annot"><span class="annottext">getRootSummary :: Target -&gt; IO (Either ErrorMessages ModSummary)
</span><a href="#local-6989586621681203194"><span class="hs-identifier hs-var hs-var">getRootSummary</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Types.html#Target"><span class="hs-identifier hs-type">Target</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Types.html#TargetFile"><span class="hs-identifier hs-type">TargetFile</span></a></span><span> </span><span id="local-6989586621681203176"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681203176"><span class="hs-identifier hs-var">file</span></a></span></span><span> </span><span id="local-6989586621681203175"><span class="annot"><span class="annottext">Maybe Phase
</span><a href="#local-6989586621681203175"><span class="hs-identifier hs-var">mb_phase</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681203174"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681203174"><span class="hs-identifier hs-var">obj_allowed</span></a></span></span><span> </span><span id="local-6989586621681203173"><span class="annot"><span class="annottext">Maybe (InputFileBuffer, UTCTime)
</span><a href="#local-6989586621681203173"><span class="hs-identifier hs-var">maybe_buf</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2137"></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621681203172"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681203172"><span class="hs-identifier hs-var">exists</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Bool -&gt; IO Bool
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO Bool -&gt; IO Bool) -&gt; IO Bool -&gt; IO Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO Bool
</span><a href="../../directory/src/System.Directory.html#doesFileExist"><span class="hs-identifier hs-var">doesFileExist</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681203176"><span class="hs-identifier hs-var">file</span></a></span><span>
</span><span id="line-2138"></span><span>                </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681203172"><span class="hs-identifier hs-var">exists</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Maybe (InputFileBuffer, UTCTime) -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../../base/src/Data.Maybe.html#isJust"><span class="hs-identifier hs-var">isJust</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (InputFileBuffer, UTCTime)
</span><a href="#local-6989586621681203173"><span class="hs-identifier hs-var">maybe_buf</span></a></span><span>
</span><span id="line-2139"></span><span>                    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; [ModSummary]
-&gt; FilePath
-&gt; Maybe Phase
-&gt; Bool
-&gt; Maybe (InputFileBuffer, UTCTime)
-&gt; IO (Either ErrorMessages ModSummary)
</span><a href="GHC.Driver.Make.html#summariseFile"><span class="hs-identifier hs-var">summariseFile</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203199"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681203198"><span class="hs-identifier hs-var">old_summaries</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681203176"><span class="hs-identifier hs-var">file</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Phase
</span><a href="#local-6989586621681203175"><span class="hs-identifier hs-var">mb_phase</span></a></span><span>
</span><span id="line-2140"></span><span>                                       </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681203174"><span class="hs-identifier hs-var">obj_allowed</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (InputFileBuffer, UTCTime)
</span><a href="#local-6989586621681203173"><span class="hs-identifier hs-var">maybe_buf</span></a></span><span>
</span><span id="line-2141"></span><span>                    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Either ErrorMessages ModSummary
-&gt; IO (Either ErrorMessages ModSummary)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Either ErrorMessages ModSummary
 -&gt; IO (Either ErrorMessages ModSummary))
-&gt; Either ErrorMessages ModSummary
-&gt; IO (Either ErrorMessages ModSummary)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorMessages -&gt; Either ErrorMessages ModSummary
forall a b. a -&gt; Either a b
</span><a href="../../base/src/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrorMessages -&gt; Either ErrorMessages ModSummary)
-&gt; ErrorMessages -&gt; Either ErrorMessages ModSummary
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ErrMsg -&gt; ErrorMessages
forall a. a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#unitBag"><span class="hs-identifier hs-var">unitBag</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrMsg -&gt; ErrorMessages) -&gt; ErrMsg -&gt; ErrorMessages
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; SrcSpan -&gt; SDoc -&gt; ErrMsg
</span><a href="GHC.Utils.Error.html#mkPlainErrMsg"><span class="hs-identifier hs-var">mkPlainErrMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203183"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="GHC.Types.SrcLoc.html#noSrcSpan"><span class="hs-identifier hs-var">noSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; ErrMsg) -&gt; SDoc -&gt; ErrMsg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2142"></span><span>                           </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;can't find file:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681203176"><span class="hs-identifier hs-var">file</span></a></span><span>
</span><span id="line-2143"></span><span>        </span><span class="annot"><a href="#local-6989586621681203194"><span class="hs-identifier hs-var">getRootSummary</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Types.html#Target"><span class="hs-identifier hs-type">Target</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Types.html#TargetModule"><span class="hs-identifier hs-type">TargetModule</span></a></span><span> </span><span id="local-6989586621681203169"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681203169"><span class="hs-identifier hs-var">modl</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681203168"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681203168"><span class="hs-identifier hs-var">obj_allowed</span></a></span></span><span> </span><span id="local-6989586621681203167"><span class="annot"><span class="annottext">Maybe (InputFileBuffer, UTCTime)
</span><a href="#local-6989586621681203167"><span class="hs-identifier hs-var">maybe_buf</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2144"></span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621681203166"><span class="annot"><span class="annottext">Maybe (Either ErrorMessages ModSummary)
</span><a href="#local-6989586621681203166"><span class="hs-identifier hs-var">maybe_summary</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; NodeMap ModSummary
-&gt; IsBootInterface
-&gt; GenLocated SrcSpan ModuleName
-&gt; Bool
-&gt; Maybe (InputFileBuffer, UTCTime)
-&gt; [ModuleName]
-&gt; IO (Maybe (Either ErrorMessages ModSummary))
</span><a href="GHC.Driver.Make.html#summariseModule"><span class="hs-identifier hs-var">summariseModule</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203199"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">NodeMap ModSummary
</span><a href="#local-6989586621681203178"><span class="hs-identifier hs-var">old_summary_map</span></a></span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="GHC.Unit.Types.html#NotBoot"><span class="hs-identifier hs-var">NotBoot</span></a></span><span>
</span><span id="line-2145"></span><span>                                           </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SrcSpan -&gt; ModuleName -&gt; GenLocated SrcSpan ModuleName
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681203165"><span class="hs-identifier hs-var">rootLoc</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681203169"><span class="hs-identifier hs-var">modl</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681203168"><span class="hs-identifier hs-var">obj_allowed</span></a></span><span>
</span><span id="line-2146"></span><span>                                           </span><span class="annot"><span class="annottext">Maybe (InputFileBuffer, UTCTime)
</span><a href="#local-6989586621681203167"><span class="hs-identifier hs-var">maybe_buf</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621681203197"><span class="hs-identifier hs-var">excl_mods</span></a></span><span>
</span><span id="line-2147"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Either ErrorMessages ModSummary)
</span><a href="#local-6989586621681203166"><span class="hs-identifier hs-var">maybe_summary</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2148"></span><span>                   </span><span class="annot"><span class="annottext">Maybe (Either ErrorMessages ModSummary)
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either ErrorMessages ModSummary
-&gt; IO (Either ErrorMessages ModSummary)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Either ErrorMessages ModSummary
 -&gt; IO (Either ErrorMessages ModSummary))
-&gt; Either ErrorMessages ModSummary
-&gt; IO (Either ErrorMessages ModSummary)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorMessages -&gt; Either ErrorMessages ModSummary
forall a b. a -&gt; Either a b
</span><a href="../../base/src/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrorMessages -&gt; Either ErrorMessages ModSummary)
-&gt; ErrorMessages -&gt; Either ErrorMessages ModSummary
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; ModuleName -&gt; ErrorMessages
</span><a href="GHC.Driver.Make.html#moduleNotFoundErr"><span class="hs-identifier hs-var">moduleNotFoundErr</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203183"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681203169"><span class="hs-identifier hs-var">modl</span></a></span><span>
</span><span id="line-2149"></span><span>                   </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681203163"><span class="annot"><span class="annottext">Either ErrorMessages ModSummary
</span><a href="#local-6989586621681203163"><span class="hs-identifier hs-var">s</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either ErrorMessages ModSummary
-&gt; IO (Either ErrorMessages ModSummary)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Either ErrorMessages ModSummary
</span><a href="#local-6989586621681203163"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-2150"></span><span>
</span><span id="line-2151"></span><span>        </span><span id="local-6989586621681203165"><span class="annot"><span class="annottext">rootLoc :: SrcSpan
</span><a href="#local-6989586621681203165"><span class="hs-identifier hs-var hs-var">rootLoc</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FastString -&gt; SrcSpan
</span><a href="GHC.Types.SrcLoc.html#mkGeneralSrcSpan"><span class="hs-identifier hs-var">mkGeneralSrcSpan</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; FastString
</span><a href="GHC.Data.FastString.html#fsLit"><span class="hs-identifier hs-var">fsLit</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;&lt;command line&gt;&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-2152"></span><span>
</span><span id="line-2153"></span><span>        </span><span class="hs-comment">-- In a root module, the filename is allowed to diverge from the module</span><span>
</span><span id="line-2154"></span><span>        </span><span class="hs-comment">-- name, so we have to check that there aren't multiple root files</span><span>
</span><span id="line-2155"></span><span>        </span><span class="hs-comment">-- defining the same module (otherwise the duplicates will be silently</span><span>
</span><span id="line-2156"></span><span>        </span><span class="hs-comment">-- ignored, leading to confusing behaviour).</span><span>
</span><span id="line-2157"></span><span>        </span><span class="annot"><a href="#local-6989586621681203188"><span class="hs-identifier hs-type">checkDuplicates</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#NodeMap"><span class="hs-identifier hs-type">NodeMap</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../base/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#ErrorMessages"><span class="hs-identifier hs-type">ErrorMessages</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2158"></span><span>        </span><span id="local-6989586621681203188"><span class="annot"><span class="annottext">checkDuplicates :: NodeMap [Either ErrorMessages ModSummary] -&gt; IO ()
</span><a href="#local-6989586621681203188"><span class="hs-identifier hs-var hs-var">checkDuplicates</span></a></span></span><span> </span><span id="local-6989586621681203160"><span class="annot"><span class="annottext">NodeMap [Either ErrorMessages ModSummary]
</span><a href="#local-6989586621681203160"><span class="hs-identifier hs-var">root_map</span></a></span></span><span>
</span><span id="line-2159"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681203196"><span class="hs-identifier hs-var">allow_dup_roots</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2160"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">[[ModSummary]] -&gt; Bool
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">[[ModSummary]]
</span><a href="#local-6989586621681203159"><span class="hs-identifier hs-var">dup_roots</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">() -&gt; IO ()
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2161"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; IO ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; IO ()) -&gt; IO () -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [ModSummary] -&gt; IO ()
</span><a href="GHC.Driver.Make.html#multiRootsErr"><span class="hs-identifier hs-var">multiRootsErr</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203183"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[[ModSummary]] -&gt; [ModSummary]
forall a. [a] -&gt; a
</span><a href="../../base/src/GHC.List.html#head"><span class="hs-identifier hs-var">head</span></a></span><span> </span><span class="annot"><span class="annottext">[[ModSummary]]
</span><a href="#local-6989586621681203159"><span class="hs-identifier hs-var">dup_roots</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2162"></span><span>           </span><span class="hs-keyword">where</span><span>
</span><span id="line-2163"></span><span>             </span><span class="annot"><a href="#local-6989586621681203159"><span class="hs-identifier hs-type">dup_roots</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">[</span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">]</span><span class="hs-special">]</span><span>        </span><span class="hs-comment">-- Each at least of length 2</span><span>
</span><span id="line-2164"></span><span>             </span><span id="local-6989586621681203159"><span class="annot"><span class="annottext">dup_roots :: [[ModSummary]]
</span><a href="#local-6989586621681203159"><span class="hs-identifier hs-var hs-var">dup_roots</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([ModSummary] -&gt; Bool) -&gt; [[ModSummary]] -&gt; [[ModSummary]]
forall a. (a -&gt; Bool) -&gt; [a] -&gt; [a]
</span><a href="GHC.Utils.Misc.html#filterOut"><span class="hs-identifier hs-var">filterOut</span></a></span><span> </span><span class="annot"><span class="annottext">[ModSummary] -&gt; Bool
forall a. [a] -&gt; Bool
</span><a href="GHC.Utils.Misc.html#isSingleton"><span class="hs-identifier hs-var">isSingleton</span></a></span><span> </span><span class="annot"><span class="annottext">([[ModSummary]] -&gt; [[ModSummary]])
-&gt; [[ModSummary]] -&gt; [[ModSummary]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">([Either ErrorMessages ModSummary] -&gt; [ModSummary])
-&gt; [[Either ErrorMessages ModSummary]] -&gt; [[ModSummary]]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">[Either ErrorMessages ModSummary] -&gt; [ModSummary]
forall a b. [Either a b] -&gt; [b]
</span><a href="../../base/src/Data.Either.html#rights"><span class="hs-identifier hs-var">rights</span></a></span><span> </span><span class="annot"><span class="annottext">([[Either ErrorMessages ModSummary]] -&gt; [[ModSummary]])
-&gt; [[Either ErrorMessages ModSummary]] -&gt; [[ModSummary]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NodeMap [Either ErrorMessages ModSummary]
-&gt; [[Either ErrorMessages ModSummary]]
forall a. NodeMap a -&gt; [a]
</span><a href="GHC.Driver.Make.html#nodeMapElts"><span class="hs-identifier hs-var">nodeMapElts</span></a></span><span> </span><span class="annot"><span class="annottext">NodeMap [Either ErrorMessages ModSummary]
</span><a href="#local-6989586621681203160"><span class="hs-identifier hs-var">root_map</span></a></span><span>
</span><span id="line-2165"></span><span>
</span><span id="line-2166"></span><span>        </span><span class="annot"><a href="#local-6989586621681203186"><span class="hs-identifier hs-type">loop</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Types.html#GenWithIsBoot"><span class="hs-identifier hs-type">GenWithIsBoot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-2167"></span><span>                        </span><span class="hs-comment">-- Work list: process these modules</span><span>
</span><span id="line-2168"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#NodeMap"><span class="hs-identifier hs-type">NodeMap</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../base/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#ErrorMessages"><span class="hs-identifier hs-type">ErrorMessages</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2169"></span><span>                        </span><span class="hs-comment">-- Visited set; the range is a list because</span><span>
</span><span id="line-2170"></span><span>                        </span><span class="hs-comment">-- the roots can have the same module names</span><span>
</span><span id="line-2171"></span><span>                        </span><span class="hs-comment">-- if allow_dup_roots is True</span><span>
</span><span id="line-2172"></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Make.html#NodeMap"><span class="hs-identifier hs-type">NodeMap</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../base/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#ErrorMessages"><span class="hs-identifier hs-type">ErrorMessages</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2173"></span><span>                        </span><span class="hs-comment">-- The result is the completed NodeMap</span><span>
</span><span id="line-2174"></span><span>        </span><span id="local-6989586621681203186"><span class="annot"><span class="annottext">loop :: [GenWithIsBoot (GenLocated SrcSpan ModuleName)]
-&gt; NodeMap [Either ErrorMessages ModSummary]
-&gt; IO (NodeMap [Either ErrorMessages ModSummary])
</span><a href="#local-6989586621681203186"><span class="hs-identifier hs-var hs-var">loop</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span id="local-6989586621681203155"><span class="annot"><span class="annottext">NodeMap [Either ErrorMessages ModSummary]
</span><a href="#local-6989586621681203155"><span class="hs-identifier hs-var">done</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">NodeMap [Either ErrorMessages ModSummary]
-&gt; IO (NodeMap [Either ErrorMessages ModSummary])
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">NodeMap [Either ErrorMessages ModSummary]
</span><a href="#local-6989586621681203155"><span class="hs-identifier hs-var">done</span></a></span><span>
</span><span id="line-2175"></span><span>        </span><span class="annot"><a href="#local-6989586621681203186"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681203154"><span class="annot"><span class="annottext">GenWithIsBoot (GenLocated SrcSpan ModuleName)
</span><a href="#local-6989586621681203154"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621681203153"><span class="annot"><span class="annottext">[GenWithIsBoot (GenLocated SrcSpan ModuleName)]
</span><a href="#local-6989586621681203153"><span class="hs-identifier hs-var">ss</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621681203152"><span class="annot"><span class="annottext">NodeMap [Either ErrorMessages ModSummary]
</span><a href="#local-6989586621681203152"><span class="hs-identifier hs-var">done</span></a></span></span><span>
</span><span id="line-2176"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681203151"><span class="annot"><span class="annottext">[Either ErrorMessages ModSummary]
</span><a href="#local-6989586621681203151"><span class="hs-identifier hs-var">summs</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NodeKey
-&gt; NodeMap [Either ErrorMessages ModSummary]
-&gt; Maybe [Either ErrorMessages ModSummary]
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../containers/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="annot"><span class="annottext">NodeKey
</span><a href="#local-6989586621681203150"><span class="hs-identifier hs-var">key</span></a></span><span> </span><span class="annot"><span class="annottext">NodeMap [Either ErrorMessages ModSummary]
</span><a href="#local-6989586621681203152"><span class="hs-identifier hs-var">done</span></a></span><span>
</span><span id="line-2177"></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">[Either ErrorMessages ModSummary] -&gt; Bool
forall a. [a] -&gt; Bool
</span><a href="GHC.Utils.Misc.html#isSingleton"><span class="hs-identifier hs-var">isSingleton</span></a></span><span> </span><span class="annot"><span class="annottext">[Either ErrorMessages ModSummary]
</span><a href="#local-6989586621681203151"><span class="hs-identifier hs-var">summs</span></a></span><span> </span><span class="hs-keyword">then</span><span>
</span><span id="line-2178"></span><span>                </span><span class="annot"><span class="annottext">[GenWithIsBoot (GenLocated SrcSpan ModuleName)]
-&gt; NodeMap [Either ErrorMessages ModSummary]
-&gt; IO (NodeMap [Either ErrorMessages ModSummary])
</span><a href="#local-6989586621681203186"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">[GenWithIsBoot (GenLocated SrcSpan ModuleName)]
</span><a href="#local-6989586621681203153"><span class="hs-identifier hs-var">ss</span></a></span><span> </span><span class="annot"><span class="annottext">NodeMap [Either ErrorMessages ModSummary]
</span><a href="#local-6989586621681203152"><span class="hs-identifier hs-var">done</span></a></span><span>
</span><span id="line-2179"></span><span>            </span><span class="hs-keyword">else</span><span>
</span><span id="line-2180"></span><span>                </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [ModSummary] -&gt; IO ()
</span><a href="GHC.Driver.Make.html#multiRootsErr"><span class="hs-identifier hs-var">multiRootsErr</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203183"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[Either ErrorMessages ModSummary] -&gt; [ModSummary]
forall a b. [Either a b] -&gt; [b]
</span><a href="../../base/src/Data.Either.html#rights"><span class="hs-identifier hs-var">rights</span></a></span><span> </span><span class="annot"><span class="annottext">[Either ErrorMessages ModSummary]
</span><a href="#local-6989586621681203151"><span class="hs-identifier hs-var">summs</span></a></span><span class="hs-special">)</span><span class="hs-special">;</span><span> </span><span class="annot"><span class="annottext">NodeMap [Either ErrorMessages ModSummary]
-&gt; IO (NodeMap [Either ErrorMessages ModSummary])
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">NodeMap [Either ErrorMessages ModSummary]
forall k a. Map k a
</span><a href="../../containers/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">Map.empty</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2181"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-2182"></span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621681203148"><span class="annot"><span class="annottext">Maybe (Either ErrorMessages ModSummary)
</span><a href="#local-6989586621681203148"><span class="hs-identifier hs-var">mb_s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; NodeMap ModSummary
-&gt; IsBootInterface
-&gt; GenLocated SrcSpan ModuleName
-&gt; Bool
-&gt; Maybe (InputFileBuffer, UTCTime)
-&gt; [ModuleName]
-&gt; IO (Maybe (Either ErrorMessages ModSummary))
</span><a href="GHC.Driver.Make.html#summariseModule"><span class="hs-identifier hs-var">summariseModule</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203199"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">NodeMap ModSummary
</span><a href="#local-6989586621681203178"><span class="hs-identifier hs-var">old_summary_map</span></a></span><span>
</span><span id="line-2183"></span><span>                                       </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="#local-6989586621681203147"><span class="hs-identifier hs-var">is_boot</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpan ModuleName
</span><a href="#local-6989586621681203146"><span class="hs-identifier hs-var">wanted_mod</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-2184"></span><span>                                       </span><span class="annot"><span class="annottext">Maybe (InputFileBuffer, UTCTime)
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621681203197"><span class="hs-identifier hs-var">excl_mods</span></a></span><span>
</span><span id="line-2185"></span><span>               </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Either ErrorMessages ModSummary)
</span><a href="#local-6989586621681203148"><span class="hs-identifier hs-var">mb_s</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2186"></span><span>                   </span><span class="annot"><span class="annottext">Maybe (Either ErrorMessages ModSummary)
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[GenWithIsBoot (GenLocated SrcSpan ModuleName)]
-&gt; NodeMap [Either ErrorMessages ModSummary]
-&gt; IO (NodeMap [Either ErrorMessages ModSummary])
</span><a href="#local-6989586621681203186"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">[GenWithIsBoot (GenLocated SrcSpan ModuleName)]
</span><a href="#local-6989586621681203153"><span class="hs-identifier hs-var">ss</span></a></span><span> </span><span class="annot"><span class="annottext">NodeMap [Either ErrorMessages ModSummary]
</span><a href="#local-6989586621681203152"><span class="hs-identifier hs-var">done</span></a></span><span>
</span><span id="line-2187"></span><span>                   </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621681203145"><span class="annot"><span class="annottext">ErrorMessages
</span><a href="#local-6989586621681203145"><span class="hs-identifier hs-var">e</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[GenWithIsBoot (GenLocated SrcSpan ModuleName)]
-&gt; NodeMap [Either ErrorMessages ModSummary]
-&gt; IO (NodeMap [Either ErrorMessages ModSummary])
</span><a href="#local-6989586621681203186"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">[GenWithIsBoot (GenLocated SrcSpan ModuleName)]
</span><a href="#local-6989586621681203153"><span class="hs-identifier hs-var">ss</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NodeKey
-&gt; [Either ErrorMessages ModSummary]
-&gt; NodeMap [Either ErrorMessages ModSummary]
-&gt; NodeMap [Either ErrorMessages ModSummary]
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="../../containers/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">Map.insert</span></a></span><span> </span><span class="annot"><span class="annottext">NodeKey
</span><a href="#local-6989586621681203150"><span class="hs-identifier hs-var">key</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ErrorMessages -&gt; Either ErrorMessages ModSummary
forall a b. a -&gt; Either a b
</span><a href="../../base/src/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorMessages
</span><a href="#local-6989586621681203145"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">NodeMap [Either ErrorMessages ModSummary]
</span><a href="#local-6989586621681203152"><span class="hs-identifier hs-var">done</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2188"></span><span>                   </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621681203143"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203143"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">)</span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2189"></span><span>                     </span><span id="local-6989586621681203142"><span class="annot"><span class="annottext">NodeMap [Either ErrorMessages ModSummary]
</span><a href="#local-6989586621681203142"><span class="hs-identifier hs-var">new_map</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-2190"></span><span>                       </span><span class="annot"><span class="annottext">[GenWithIsBoot (GenLocated SrcSpan ModuleName)]
-&gt; NodeMap [Either ErrorMessages ModSummary]
-&gt; IO (NodeMap [Either ErrorMessages ModSummary])
</span><a href="#local-6989586621681203186"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; [GenWithIsBoot (GenLocated SrcSpan ModuleName)]
</span><a href="#local-6989586621681203185"><span class="hs-identifier hs-var">calcDeps</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203143"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">NodeKey
-&gt; [Either ErrorMessages ModSummary]
-&gt; NodeMap [Either ErrorMessages ModSummary]
-&gt; NodeMap [Either ErrorMessages ModSummary]
forall k a. Ord k =&gt; k -&gt; a -&gt; Map k a -&gt; Map k a
</span><a href="../../containers/src/Data.Map.Internal.html#insert"><span class="hs-identifier hs-var">Map.insert</span></a></span><span> </span><span class="annot"><span class="annottext">NodeKey
</span><a href="#local-6989586621681203150"><span class="hs-identifier hs-var">key</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ModSummary -&gt; Either ErrorMessages ModSummary
forall a b. b -&gt; Either a b
</span><a href="../../base/src/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203143"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">NodeMap [Either ErrorMessages ModSummary]
</span><a href="#local-6989586621681203152"><span class="hs-identifier hs-var">done</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2191"></span><span>                     </span><span class="annot"><span class="annottext">[GenWithIsBoot (GenLocated SrcSpan ModuleName)]
-&gt; NodeMap [Either ErrorMessages ModSummary]
-&gt; IO (NodeMap [Either ErrorMessages ModSummary])
</span><a href="#local-6989586621681203186"><span class="hs-identifier hs-var">loop</span></a></span><span> </span><span class="annot"><span class="annottext">[GenWithIsBoot (GenLocated SrcSpan ModuleName)]
</span><a href="#local-6989586621681203153"><span class="hs-identifier hs-var">ss</span></a></span><span> </span><span class="annot"><span class="annottext">NodeMap [Either ErrorMessages ModSummary]
</span><a href="#local-6989586621681203142"><span class="hs-identifier hs-var">new_map</span></a></span><span>
</span><span id="line-2192"></span><span>          </span><span class="hs-keyword">where</span><span>
</span><span id="line-2193"></span><span>            </span><span class="annot"><a href="GHC.Unit.Types.html#GWIB"><span class="hs-identifier hs-type">GWIB</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">gwib_mod :: forall mod. GenWithIsBoot mod -&gt; mod
</span><a href="GHC.Unit.Types.html#gwib_mod"><span class="hs-identifier hs-var">gwib_mod</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681203141"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681203141"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681203140"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681203140"><span class="hs-identifier hs-var">mod</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">gwib_isBoot :: forall mod. GenWithIsBoot mod -&gt; IsBootInterface
</span><a href="GHC.Unit.Types.html#gwib_isBoot"><span class="hs-identifier hs-var">gwib_isBoot</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681203147"><span class="annot"><span class="annottext">IsBootInterface
</span><a href="#local-6989586621681203147"><span class="hs-identifier hs-var">is_boot</span></a></span></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenWithIsBoot (GenLocated SrcSpan ModuleName)
</span><a href="#local-6989586621681203154"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-2194"></span><span>            </span><span id="local-6989586621681203146"><span class="annot"><span class="annottext">wanted_mod :: GenLocated SrcSpan ModuleName
</span><a href="#local-6989586621681203146"><span class="hs-identifier hs-var hs-var">wanted_mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SrcSpan -&gt; ModuleName -&gt; GenLocated SrcSpan ModuleName
forall l e. l -&gt; e -&gt; GenLocated l e
</span><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-var">L</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681203141"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681203140"><span class="hs-identifier hs-var">mod</span></a></span><span>
</span><span id="line-2195"></span><span>            </span><span id="local-6989586621681203150"><span class="annot"><span class="annottext">key :: NodeKey
</span><a href="#local-6989586621681203150"><span class="hs-identifier hs-var hs-var">key</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GWIB :: forall mod. mod -&gt; IsBootInterface -&gt; GenWithIsBoot mod
</span><a href="GHC.Unit.Types.html#GWIB"><span class="hs-identifier hs-type">GWIB</span></a></span><span>
</span><span id="line-2196"></span><span>                    </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">gwib_mod :: ModuleName
</span><a href="GHC.Unit.Types.html#gwib_mod"><span class="hs-identifier hs-var">gwib_mod</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpan ModuleName -&gt; ModuleName
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpan ModuleName
</span><a href="#local-6989586621681203146"><span class="hs-identifier hs-var">wanted_mod</span></a></span><span>
</span><span id="line-2197"></span><span>                    </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">gwib_isBoot :: IsBootInterface
</span><a href="GHC.Unit.Types.html#gwib_isBoot"><span class="hs-identifier hs-var">gwib_isBoot</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="#local-6989586621681203147"><span class="hs-identifier hs-var">is_boot</span></a></span><span>
</span><span id="line-2198"></span><span>                    </span><span class="hs-special">}</span><span>
</span><span id="line-2199"></span><span>
</span><span id="line-2200"></span><span class="hs-comment">-- | Update the every ModSummary that is depended on</span><span>
</span><span id="line-2201"></span><span class="hs-comment">-- by a module that needs template haskell. We enable codegen to</span><span>
</span><span id="line-2202"></span><span class="hs-comment">-- the specified target, disable optimization and change the .hi</span><span>
</span><span id="line-2203"></span><span class="hs-comment">-- and .o file locations to be temporary files.</span><span>
</span><span id="line-2204"></span><span class="hs-comment">-- See Note [-fno-code mode]</span><span>
</span><span id="line-2205"></span><span class="annot"><a href="GHC.Driver.Make.html#enableCodeGenForTH"><span class="hs-identifier hs-type">enableCodeGenForTH</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#HscTarget"><span class="hs-identifier hs-type">HscTarget</span></a></span><span>
</span><span id="line-2206"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#NodeMap"><span class="hs-identifier hs-type">NodeMap</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../base/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#ErrorMessages"><span class="hs-identifier hs-type">ErrorMessages</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2207"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Make.html#NodeMap"><span class="hs-identifier hs-type">NodeMap</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../base/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#ErrorMessages"><span class="hs-identifier hs-type">ErrorMessages</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2208"></span><span id="enableCodeGenForTH"><span class="annot"><span class="annottext">enableCodeGenForTH :: HscTarget
-&gt; NodeMap [Either ErrorMessages ModSummary]
-&gt; IO (NodeMap [Either ErrorMessages ModSummary])
</span><a href="GHC.Driver.Make.html#enableCodeGenForTH"><span class="hs-identifier hs-var hs-var">enableCodeGenForTH</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2209"></span><span>  </span><span class="annot"><span class="annottext">(ModSummary -&gt; Bool)
-&gt; (ModSummary -&gt; Bool)
-&gt; TempFileLifetime
-&gt; TempFileLifetime
-&gt; HscTarget
-&gt; NodeMap [Either ErrorMessages ModSummary]
-&gt; IO (NodeMap [Either ErrorMessages ModSummary])
</span><a href="GHC.Driver.Make.html#enableCodeGenWhen"><span class="hs-identifier hs-var">enableCodeGenWhen</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; Bool
</span><a href="#local-6989586621681203138"><span class="hs-identifier hs-var">condition</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; Bool
</span><a href="#local-6989586621681203137"><span class="hs-identifier hs-var">should_modify</span></a></span><span> </span><span class="annot"><span class="annottext">TempFileLifetime
</span><a href="GHC.SysTools.FileCleanup.html#TFL_CurrentModule"><span class="hs-identifier hs-var">TFL_CurrentModule</span></a></span><span> </span><span class="annot"><span class="annottext">TempFileLifetime
</span><a href="GHC.SysTools.FileCleanup.html#TFL_GhcSession"><span class="hs-identifier hs-var">TFL_GhcSession</span></a></span><span>
</span><span id="line-2210"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2211"></span><span>    </span><span id="local-6989586621681203138"><span class="annot"><span class="annottext">condition :: ModSummary -&gt; Bool
</span><a href="#local-6989586621681203138"><span class="hs-identifier hs-var hs-var">condition</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; Bool
</span><a href="GHC.Driver.Types.html#isTemplateHaskellOrQQNonBoot"><span class="hs-identifier hs-var">isTemplateHaskellOrQQNonBoot</span></a></span><span>
</span><span id="line-2212"></span><span>    </span><span id="local-6989586621681203137"><span class="annot"><span class="annottext">should_modify :: ModSummary -&gt; Bool
</span><a href="#local-6989586621681203137"><span class="hs-identifier hs-var hs-var">should_modify</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ms_hspp_opts :: ModSummary -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#ms_hspp_opts"><span class="hs-identifier hs-var">ms_hspp_opts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681203134"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203134"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2213"></span><span>      </span><span class="annot"><span class="annottext">DynFlags -&gt; HscTarget
</span><a href="GHC.Driver.Session.html#hscTarget"><span class="hs-identifier hs-var hs-var">hscTarget</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203134"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscTarget -&gt; HscTarget -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">HscTarget
</span><a href="GHC.Driver.Session.html#HscNothing"><span class="hs-identifier hs-var">HscNothing</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-2214"></span><span>      </span><span class="hs-comment">-- Don't enable codegen for TH on indefinite packages; we</span><span>
</span><span id="line-2215"></span><span>      </span><span class="hs-comment">-- can't compile anything anyway! See #16219.</span><span>
</span><span id="line-2216"></span><span>      </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="GHC.Unit.State.html#homeUnitIsDefinite"><span class="hs-identifier hs-var">homeUnitIsDefinite</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203134"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-2217"></span><span>
</span><span id="line-2218"></span><span class="hs-comment">-- | Update the every ModSummary that is depended on</span><span>
</span><span id="line-2219"></span><span class="hs-comment">-- by a module that needs unboxed tuples. We enable codegen to</span><span>
</span><span id="line-2220"></span><span class="hs-comment">-- the specified target, disable optimization and change the .hi</span><span>
</span><span id="line-2221"></span><span class="hs-comment">-- and .o file locations to be temporary files.</span><span>
</span><span id="line-2222"></span><span class="hs-comment">--</span><span>
</span><span id="line-2223"></span><span class="hs-comment">-- This is used in order to load code that uses unboxed tuples</span><span>
</span><span id="line-2224"></span><span class="hs-comment">-- or sums into GHCi while still allowing some code to be interpreted.</span><span>
</span><span id="line-2225"></span><span class="annot"><a href="GHC.Driver.Make.html#enableCodeGenForUnboxedTuplesOrSums"><span class="hs-identifier hs-type">enableCodeGenForUnboxedTuplesOrSums</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#HscTarget"><span class="hs-identifier hs-type">HscTarget</span></a></span><span>
</span><span id="line-2226"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#NodeMap"><span class="hs-identifier hs-type">NodeMap</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../base/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#ErrorMessages"><span class="hs-identifier hs-type">ErrorMessages</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2227"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Make.html#NodeMap"><span class="hs-identifier hs-type">NodeMap</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../base/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#ErrorMessages"><span class="hs-identifier hs-type">ErrorMessages</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2228"></span><span id="enableCodeGenForUnboxedTuplesOrSums"><span class="annot"><span class="annottext">enableCodeGenForUnboxedTuplesOrSums :: HscTarget
-&gt; NodeMap [Either ErrorMessages ModSummary]
-&gt; IO (NodeMap [Either ErrorMessages ModSummary])
</span><a href="GHC.Driver.Make.html#enableCodeGenForUnboxedTuplesOrSums"><span class="hs-identifier hs-var hs-var">enableCodeGenForUnboxedTuplesOrSums</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2229"></span><span>  </span><span class="annot"><span class="annottext">(ModSummary -&gt; Bool)
-&gt; (ModSummary -&gt; Bool)
-&gt; TempFileLifetime
-&gt; TempFileLifetime
-&gt; HscTarget
-&gt; NodeMap [Either ErrorMessages ModSummary]
-&gt; IO (NodeMap [Either ErrorMessages ModSummary])
</span><a href="GHC.Driver.Make.html#enableCodeGenWhen"><span class="hs-identifier hs-var">enableCodeGenWhen</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; Bool
</span><a href="#local-6989586621681203132"><span class="hs-identifier hs-var">condition</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; Bool
</span><a href="#local-6989586621681203131"><span class="hs-identifier hs-var">should_modify</span></a></span><span> </span><span class="annot"><span class="annottext">TempFileLifetime
</span><a href="GHC.SysTools.FileCleanup.html#TFL_GhcSession"><span class="hs-identifier hs-var">TFL_GhcSession</span></a></span><span> </span><span class="annot"><span class="annottext">TempFileLifetime
</span><a href="GHC.SysTools.FileCleanup.html#TFL_CurrentModule"><span class="hs-identifier hs-var">TFL_CurrentModule</span></a></span><span>
</span><span id="line-2230"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2231"></span><span>    </span><span id="local-6989586621681203132"><span class="annot"><span class="annottext">condition :: ModSummary -&gt; Bool
</span><a href="#local-6989586621681203132"><span class="hs-identifier hs-var hs-var">condition</span></a></span></span><span> </span><span id="local-6989586621681203129"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203129"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2232"></span><span>      </span><span class="annot"><span class="annottext">DynFlags -&gt; Bool
</span><a href="#local-6989586621681203128"><span class="hs-identifier hs-var">unboxed_tuples_or_sums</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#ms_hspp_opts"><span class="hs-identifier hs-var hs-var">ms_hspp_opts</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203129"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-2233"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_ByteCodeIfUnboxed"><span class="hs-identifier hs-var">Opt_ByteCodeIfUnboxed</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#ms_hspp_opts"><span class="hs-identifier hs-var hs-var">ms_hspp_opts</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203129"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-2234"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; IsBootInterface
</span><a href="GHC.Driver.Types.html#isBootSummary"><span class="hs-identifier hs-var">isBootSummary</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203129"><span class="hs-identifier hs-var">ms</span></a></span><span> </span><span class="annot"><span class="annottext">IsBootInterface -&gt; IsBootInterface -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="GHC.Unit.Types.html#NotBoot"><span class="hs-identifier hs-var">NotBoot</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2235"></span><span>    </span><span id="local-6989586621681203128"><span class="annot"><span class="annottext">unboxed_tuples_or_sums :: DynFlags -&gt; Bool
</span><a href="#local-6989586621681203128"><span class="hs-identifier hs-var hs-var">unboxed_tuples_or_sums</span></a></span></span><span> </span><span id="local-6989586621681203126"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203126"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2236"></span><span>      </span><span class="annot"><span class="annottext">Extension -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#xopt"><span class="hs-identifier hs-var">xopt</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><a href="../../ghc-boot-th/src/GHC.LanguageExtensions.Type.html#UnboxedTuples"><span class="hs-identifier hs-var">LangExt.UnboxedTuples</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203126"><span class="hs-identifier hs-var">d</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Extension -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#xopt"><span class="hs-identifier hs-var">xopt</span></a></span><span> </span><span class="annot"><span class="annottext">Extension
</span><a href="../../ghc-boot-th/src/GHC.LanguageExtensions.Type.html#UnboxedSums"><span class="hs-identifier hs-var">LangExt.UnboxedSums</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203126"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-2237"></span><span>    </span><span id="local-6989586621681203131"><span class="annot"><span class="annottext">should_modify :: ModSummary -&gt; Bool
</span><a href="#local-6989586621681203131"><span class="hs-identifier hs-var hs-var">should_modify</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ms_hspp_opts :: ModSummary -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#ms_hspp_opts"><span class="hs-identifier hs-var">ms_hspp_opts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681203121"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203121"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2238"></span><span>      </span><span class="annot"><span class="annottext">DynFlags -&gt; HscTarget
</span><a href="GHC.Driver.Session.html#hscTarget"><span class="hs-identifier hs-var hs-var">hscTarget</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203121"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscTarget -&gt; HscTarget -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">HscTarget
</span><a href="GHC.Driver.Session.html#HscInterpreted"><span class="hs-identifier hs-var">HscInterpreted</span></a></span><span>
</span><span id="line-2239"></span><span>
</span><span id="line-2240"></span><span class="hs-comment">-- | Helper used to implement 'enableCodeGenForTH' and</span><span>
</span><span id="line-2241"></span><span class="hs-comment">-- 'enableCodeGenForUnboxedTuples'. In particular, this enables</span><span>
</span><span id="line-2242"></span><span class="hs-comment">-- unoptimized code generation for all modules that meet some</span><span>
</span><span id="line-2243"></span><span class="hs-comment">-- condition (first parameter), or are dependencies of those</span><span>
</span><span id="line-2244"></span><span class="hs-comment">-- modules. The second parameter is a condition to check before</span><span>
</span><span id="line-2245"></span><span class="hs-comment">-- marking modules for code generation.</span><span>
</span><span id="line-2246"></span><span class="annot"><a href="GHC.Driver.Make.html#enableCodeGenWhen"><span class="hs-identifier hs-type">enableCodeGenWhen</span></a></span><span>
</span><span id="line-2247"></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span>
</span><span id="line-2248"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span class="hs-special">)</span><span>
</span><span id="line-2249"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.SysTools.FileCleanup.html#TempFileLifetime"><span class="hs-identifier hs-type">TempFileLifetime</span></a></span><span>
</span><span id="line-2250"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.SysTools.FileCleanup.html#TempFileLifetime"><span class="hs-identifier hs-type">TempFileLifetime</span></a></span><span>
</span><span id="line-2251"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#HscTarget"><span class="hs-identifier hs-type">HscTarget</span></a></span><span>
</span><span id="line-2252"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#NodeMap"><span class="hs-identifier hs-type">NodeMap</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../base/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#ErrorMessages"><span class="hs-identifier hs-type">ErrorMessages</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2253"></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Driver.Make.html#NodeMap"><span class="hs-identifier hs-type">NodeMap</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../base/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#ErrorMessages"><span class="hs-identifier hs-type">ErrorMessages</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2254"></span><span id="enableCodeGenWhen"><span class="annot"><span class="annottext">enableCodeGenWhen :: (ModSummary -&gt; Bool)
-&gt; (ModSummary -&gt; Bool)
-&gt; TempFileLifetime
-&gt; TempFileLifetime
-&gt; HscTarget
-&gt; NodeMap [Either ErrorMessages ModSummary]
-&gt; IO (NodeMap [Either ErrorMessages ModSummary])
</span><a href="GHC.Driver.Make.html#enableCodeGenWhen"><span class="hs-identifier hs-var hs-var">enableCodeGenWhen</span></a></span></span><span> </span><span id="local-6989586621681203120"><span class="annot"><span class="annottext">ModSummary -&gt; Bool
</span><a href="#local-6989586621681203120"><span class="hs-identifier hs-var">condition</span></a></span></span><span> </span><span id="local-6989586621681203119"><span class="annot"><span class="annottext">ModSummary -&gt; Bool
</span><a href="#local-6989586621681203119"><span class="hs-identifier hs-var">should_modify</span></a></span></span><span> </span><span id="local-6989586621681203118"><span class="annot"><span class="annottext">TempFileLifetime
</span><a href="#local-6989586621681203118"><span class="hs-identifier hs-var">staticLife</span></a></span></span><span> </span><span id="local-6989586621681203117"><span class="annot"><span class="annottext">TempFileLifetime
</span><a href="#local-6989586621681203117"><span class="hs-identifier hs-var">dynLife</span></a></span></span><span> </span><span id="local-6989586621681203116"><span class="annot"><span class="annottext">HscTarget
</span><a href="#local-6989586621681203116"><span class="hs-identifier hs-var">target</span></a></span></span><span> </span><span id="local-6989586621681203115"><span class="annot"><span class="annottext">NodeMap [Either ErrorMessages ModSummary]
</span><a href="#local-6989586621681203115"><span class="hs-identifier hs-var">nodemap</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2255"></span><span>  </span><span class="annot"><span class="annottext">([Either ErrorMessages ModSummary]
 -&gt; IO [Either ErrorMessages ModSummary])
-&gt; NodeMap [Either ErrorMessages ModSummary]
-&gt; IO (NodeMap [Either ErrorMessages ModSummary])
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><a href="../../base/src/Data.Traversable.html#traverse"><span class="hs-identifier hs-var">traverse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(Either ErrorMessages ModSummary
 -&gt; IO (Either ErrorMessages ModSummary))
-&gt; [Either ErrorMessages ModSummary]
-&gt; IO [Either ErrorMessages ModSummary]
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><a href="../../base/src/Data.Traversable.html#traverse"><span class="hs-identifier hs-var">traverse</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(ModSummary -&gt; IO ModSummary)
-&gt; Either ErrorMessages ModSummary
-&gt; IO (Either ErrorMessages ModSummary)
forall (t :: * -&gt; *) (f :: * -&gt; *) a b.
(Traversable t, Applicative f) =&gt;
(a -&gt; f b) -&gt; t a -&gt; f (t b)
</span><a href="../../base/src/Data.Traversable.html#traverse"><span class="hs-identifier hs-var">traverse</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; IO ModSummary
</span><a href="#local-6989586621681203113"><span class="hs-identifier hs-var">enable_code_gen</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NodeMap [Either ErrorMessages ModSummary]
</span><a href="#local-6989586621681203115"><span class="hs-identifier hs-var">nodemap</span></a></span><span>
</span><span id="line-2256"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2257"></span><span>    </span><span id="local-6989586621681203113"><span class="annot"><span class="annottext">enable_code_gen :: ModSummary -&gt; IO ModSummary
</span><a href="#local-6989586621681203113"><span class="hs-identifier hs-var hs-var">enable_code_gen</span></a></span></span><span> </span><span id="local-6989586621681203104"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203104"><span class="hs-identifier hs-var">ms</span></a></span></span><span>
</span><span id="line-2258"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span>
</span><span id="line-2259"></span><span>        </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ms_mod :: ModSummary -&gt; Module
</span><a href="GHC.Driver.Types.html#ms_mod"><span class="hs-identifier hs-var">ms_mod</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681203103"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681203103"><span class="hs-identifier hs-var">ms_mod</span></a></span></span><span>
</span><span id="line-2260"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ms_location :: ModSummary -&gt; ModLocation
</span><a href="GHC.Driver.Types.html#ms_location"><span class="hs-identifier hs-var">ms_location</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681203102"><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681203102"><span class="hs-identifier hs-var">ms_location</span></a></span></span><span>
</span><span id="line-2261"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ms_hsc_src :: ModSummary -&gt; HscSource
</span><a href="GHC.Driver.Types.html#ms_hsc_src"><span class="hs-identifier hs-var">ms_hsc_src</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="GHC.Driver.Phases.html#HsSrcFile"><span class="hs-identifier hs-var">HsSrcFile</span></a></span><span>
</span><span id="line-2262"></span><span>        </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ms_hspp_opts :: ModSummary -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#ms_hspp_opts"><span class="hs-identifier hs-var">ms_hspp_opts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="local-6989586621681203101"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203101"><span class="hs-identifier hs-var">dflags</span></a></span></span><span>
</span><span id="line-2263"></span><span>        </span><span class="hs-special">}</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203104"><span class="hs-identifier hs-var">ms</span></a></span><span>
</span><span id="line-2264"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; Bool
</span><a href="#local-6989586621681203119"><span class="hs-identifier hs-var">should_modify</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203104"><span class="hs-identifier hs-var">ms</span></a></span><span>
</span><span id="line-2265"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681203103"><span class="hs-identifier hs-var">ms_mod</span></a></span><span> </span><span class="annot"><span class="annottext">Module -&gt; Set Module -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="../../containers/src/Data.Set.Internal.html#member"><span class="hs-operator hs-var">`Set.member`</span></a></span><span> </span><span class="annot"><span class="annottext">Set Module
</span><a href="#local-6989586621681203100"><span class="hs-identifier hs-var">needs_codegen_set</span></a></span><span>
</span><span id="line-2266"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2267"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681203096"><span class="annot"><span class="annottext">new_temp_file :: FilePath -&gt; FilePath -&gt; IO FilePath
</span><a href="#local-6989586621681203096"><span class="hs-identifier hs-var hs-var">new_temp_file</span></a></span></span><span> </span><span id="local-6989586621681203095"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681203095"><span class="hs-identifier hs-var">suf</span></a></span></span><span> </span><span id="local-6989586621681203094"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681203094"><span class="hs-identifier hs-var">dynsuf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2268"></span><span>              </span><span id="local-6989586621681203093"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681203093"><span class="hs-identifier hs-var">tn</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; TempFileLifetime -&gt; FilePath -&gt; IO FilePath
</span><a href="GHC.SysTools.FileCleanup.html#newTempName"><span class="hs-identifier hs-var">newTempName</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203101"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">TempFileLifetime
</span><a href="#local-6989586621681203118"><span class="hs-identifier hs-var">staticLife</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681203095"><span class="hs-identifier hs-var">suf</span></a></span><span>
</span><span id="line-2269"></span><span>              </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681203091"><span class="annot"><span class="annottext">dyn_tn :: FilePath
</span><a href="#local-6989586621681203091"><span class="hs-identifier hs-var hs-var">dyn_tn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681203093"><span class="hs-identifier hs-var">tn</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; FilePath
</span><a href="../../filepath/src/System.FilePath.Windows.html#-%3C.%3E"><span class="hs-operator hs-var">-&lt;.&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681203094"><span class="hs-identifier hs-var">dynsuf</span></a></span><span>
</span><span id="line-2270"></span><span>              </span><span class="annot"><span class="annottext">DynFlags -&gt; TempFileLifetime -&gt; [FilePath] -&gt; IO ()
</span><a href="GHC.SysTools.FileCleanup.html#addFilesToClean"><span class="hs-identifier hs-var">addFilesToClean</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203101"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">TempFileLifetime
</span><a href="#local-6989586621681203117"><span class="hs-identifier hs-var">dynLife</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681203091"><span class="hs-identifier hs-var">dyn_tn</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2271"></span><span>              </span><span class="annot"><span class="annottext">FilePath -&gt; IO FilePath
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681203093"><span class="hs-identifier hs-var">tn</span></a></span><span>
</span><span id="line-2272"></span><span>          </span><span class="hs-comment">-- We don't want to create .o or .hi files unless we have been asked</span><span>
</span><span id="line-2273"></span><span>          </span><span class="hs-comment">-- to by the user. But we need them, so we patch their locations in</span><span>
</span><span id="line-2274"></span><span>          </span><span class="hs-comment">-- the ModSummary with temporary files.</span><span>
</span><span id="line-2275"></span><span>          </span><span class="hs-comment">--</span><span>
</span><span id="line-2276"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621681203089"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681203089"><span class="hs-identifier hs-var">hi_file</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681203088"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681203088"><span class="hs-identifier hs-var">o_file</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-2277"></span><span>          </span><span class="hs-comment">-- If ``-fwrite-interface` is specified, then the .o and .hi files</span><span>
</span><span id="line-2278"></span><span>          </span><span class="hs-comment">-- are written into `-odir` and `-hidir` respectively.  #16670</span><span>
</span><span id="line-2279"></span><span>          </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_WriteInterface"><span class="hs-identifier hs-var">Opt_WriteInterface</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203101"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-2280"></span><span>            </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">(FilePath, FilePath) -&gt; IO (FilePath, FilePath)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModLocation -&gt; FilePath
</span><a href="GHC.Unit.Module.Location.html#ml_hi_file"><span class="hs-identifier hs-var hs-var">ml_hi_file</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681203102"><span class="hs-identifier hs-var">ms_location</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModLocation -&gt; FilePath
</span><a href="GHC.Unit.Module.Location.html#ml_obj_file"><span class="hs-identifier hs-var hs-var">ml_obj_file</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681203102"><span class="hs-identifier hs-var">ms_location</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2281"></span><span>            </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(FilePath -&gt; FilePath -&gt; (FilePath, FilePath))
-&gt; IO FilePath -&gt; IO (FilePath -&gt; (FilePath, FilePath))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; IO FilePath
</span><a href="#local-6989586621681203096"><span class="hs-identifier hs-var">new_temp_file</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; FilePath
</span><a href="GHC.Driver.Session.html#hiSuf"><span class="hs-identifier hs-var hs-var">hiSuf</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203101"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; FilePath
</span><a href="GHC.Driver.Session.html#dynHiSuf"><span class="hs-identifier hs-var hs-var">dynHiSuf</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203101"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2282"></span><span>                     </span><span class="annot"><span class="annottext">IO (FilePath -&gt; (FilePath, FilePath))
-&gt; IO FilePath -&gt; IO (FilePath, FilePath)
forall (f :: * -&gt; *) a b. Applicative f =&gt; f (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/GHC.Base.html#%3C%2A%3E"><span class="hs-operator hs-var">&lt;*&gt;</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; IO FilePath
</span><a href="#local-6989586621681203096"><span class="hs-identifier hs-var">new_temp_file</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; FilePath
</span><a href="GHC.Driver.Session.html#objectSuf"><span class="hs-identifier hs-var hs-var">objectSuf</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203101"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; FilePath
</span><a href="GHC.Driver.Session.html#dynObjectSuf"><span class="hs-identifier hs-var hs-var">dynObjectSuf</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203101"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2283"></span><span>        </span><span class="annot"><span class="annottext">ModSummary -&gt; IO ModSummary
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(ModSummary -&gt; IO ModSummary) -&gt; ModSummary -&gt; IO ModSummary
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2284"></span><span>          </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203104"><span class="hs-identifier hs-var">ms</span></a></span><span>
</span><span id="line-2285"></span><span>          </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ms_location :: ModLocation
</span><a href="GHC.Driver.Types.html#ms_location"><span class="hs-identifier hs-var">ms_location</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2286"></span><span>              </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681203102"><span class="hs-identifier hs-var">ms_location</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">ml_hi_file :: FilePath
</span><a href="GHC.Unit.Module.Location.html#ml_hi_file"><span class="hs-identifier hs-var">ml_hi_file</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681203089"><span class="hs-identifier hs-var">hi_file</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ml_obj_file :: FilePath
</span><a href="GHC.Unit.Module.Location.html#ml_obj_file"><span class="hs-identifier hs-var">ml_obj_file</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681203088"><span class="hs-identifier hs-var">o_file</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-2287"></span><span>          </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ms_hspp_opts :: DynFlags
</span><a href="GHC.Driver.Types.html#ms_hspp_opts"><span class="hs-identifier hs-var">ms_hspp_opts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Int -&gt; DynFlags -&gt; DynFlags
</span><a href="GHC.Driver.Session.html#updOptLevel"><span class="hs-identifier hs-var">updOptLevel</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">0</span></span><span> </span><span class="annot"><span class="annottext">(DynFlags -&gt; DynFlags) -&gt; DynFlags -&gt; DynFlags
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203101"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">hscTarget :: HscTarget
</span><a href="GHC.Driver.Session.html#hscTarget"><span class="hs-identifier hs-var">hscTarget</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscTarget
</span><a href="#local-6989586621681203116"><span class="hs-identifier hs-var">target</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-2288"></span><span>          </span><span class="hs-special">}</span><span>
</span><span id="line-2289"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; IO ModSummary
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203104"><span class="hs-identifier hs-var">ms</span></a></span><span>
</span><span id="line-2290"></span><span>
</span><span id="line-2291"></span><span>    </span><span id="local-6989586621681203100"><span class="annot"><span class="annottext">needs_codegen_set :: Set Module
</span><a href="#local-6989586621681203100"><span class="hs-identifier hs-var hs-var">needs_codegen_set</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[ModSummary] -&gt; Set Module
forall {t :: * -&gt; *}. Foldable t =&gt; t ModSummary -&gt; Set Module
</span><a href="#local-6989586621681203080"><span class="hs-identifier hs-var">transitive_deps_set</span></a></span><span>
</span><span id="line-2292"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203079"><span class="hs-identifier hs-var">ms</span></a></span><span>
</span><span id="line-2293"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681203078"><span class="annot"><span class="annottext">[Either ErrorMessages ModSummary]
</span><a href="#local-6989586621681203078"><span class="hs-identifier hs-var">mss</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NodeMap [Either ErrorMessages ModSummary]
-&gt; [[Either ErrorMessages ModSummary]]
forall k a. Map k a -&gt; [a]
</span><a href="../../containers/src/Data.Map.Internal.html#elems"><span class="hs-identifier hs-var">Map.elems</span></a></span><span> </span><span class="annot"><span class="annottext">NodeMap [Either ErrorMessages ModSummary]
</span><a href="#local-6989586621681203115"><span class="hs-identifier hs-var">nodemap</span></a></span><span>
</span><span id="line-2294"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../base/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621681203079"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203079"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Either ErrorMessages ModSummary]
</span><a href="#local-6989586621681203078"><span class="hs-identifier hs-var">mss</span></a></span><span>
</span><span id="line-2295"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; Bool
</span><a href="#local-6989586621681203120"><span class="hs-identifier hs-var">condition</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203079"><span class="hs-identifier hs-var">ms</span></a></span><span>
</span><span id="line-2296"></span><span>      </span><span class="hs-special">]</span><span>
</span><span id="line-2297"></span><span>
</span><span id="line-2298"></span><span>    </span><span class="hs-comment">-- find the set of all transitive dependencies of a list of modules.</span><span>
</span><span id="line-2299"></span><span>    </span><span id="local-6989586621681203080"><span class="annot"><span class="annottext">transitive_deps_set :: t ModSummary -&gt; Set Module
</span><a href="#local-6989586621681203080"><span class="hs-identifier hs-var hs-var">transitive_deps_set</span></a></span></span><span> </span><span id="local-6989586621681203075"><span class="annot"><span class="annottext">t ModSummary
</span><a href="#local-6989586621681203075"><span class="hs-identifier hs-var">modSums</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(Set Module -&gt; ModSummary -&gt; Set Module)
-&gt; Set Module -&gt; t ModSummary -&gt; Set Module
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base/src/Data.Foldable.html#foldl%27"><span class="hs-identifier hs-var">foldl'</span></a></span><span> </span><span class="annot"><span class="annottext">Set Module -&gt; ModSummary -&gt; Set Module
</span><a href="#local-6989586621681203074"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Set Module
forall a. Set a
</span><a href="../../containers/src/Data.Set.Internal.html#empty"><span class="hs-identifier hs-var">Set.empty</span></a></span><span> </span><span class="annot"><span class="annottext">t ModSummary
</span><a href="#local-6989586621681203075"><span class="hs-identifier hs-var">modSums</span></a></span><span>
</span><span id="line-2300"></span><span>      </span><span class="hs-keyword">where</span><span>
</span><span id="line-2301"></span><span>        </span><span id="local-6989586621681203074"><span class="annot"><span class="annottext">go :: Set Module -&gt; ModSummary -&gt; Set Module
</span><a href="#local-6989586621681203074"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span id="local-6989586621681203069"><span class="annot"><span class="annottext">Set Module
</span><a href="#local-6989586621681203069"><span class="hs-identifier hs-var">marked_mods</span></a></span></span><span> </span><span id="local-6989586621681203068"><span class="annot"><span class="annottext">ms :: ModSummary
</span><a href="#local-6989586621681203068"><span class="hs-identifier hs-var">ms</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">{</span><span id="local-6989586621681203067"><span class="annot"><span class="annottext">Module
ms_mod :: Module
ms_mod :: ModSummary -&gt; Module
</span><a href="#local-6989586621681203067"><span class="hs-identifier hs-var hs-var">ms_mod</span></a></span></span><span class="hs-special">}</span><span>
</span><span id="line-2302"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681203067"><span class="hs-identifier hs-var">ms_mod</span></a></span><span> </span><span class="annot"><span class="annottext">Module -&gt; Set Module -&gt; Bool
forall a. Ord a =&gt; a -&gt; Set a -&gt; Bool
</span><a href="../../containers/src/Data.Set.Internal.html#member"><span class="hs-operator hs-var">`Set.member`</span></a></span><span> </span><span class="annot"><span class="annottext">Set Module
</span><a href="#local-6989586621681203069"><span class="hs-identifier hs-var">marked_mods</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Set Module
</span><a href="#local-6989586621681203069"><span class="hs-identifier hs-var">marked_mods</span></a></span><span>
</span><span id="line-2303"></span><span>          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2304"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681203056"><span class="annot"><span class="annottext">deps :: [ModSummary]
</span><a href="#local-6989586621681203056"><span class="hs-identifier hs-var hs-var">deps</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2305"></span><span>                  </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203055"><span class="hs-identifier hs-var">dep_ms</span></a></span><span>
</span><span id="line-2306"></span><span>                  </span><span class="hs-comment">-- If a module imports a boot module, msDeps helpfully adds a</span><span>
</span><span id="line-2307"></span><span>                  </span><span class="hs-comment">-- dependency to that non-boot module in it's result. This</span><span>
</span><span id="line-2308"></span><span>                  </span><span class="hs-comment">-- means we don't have to think about boot modules here.</span><span>
</span><span id="line-2309"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681203054"><span class="annot"><span class="annottext">GenWithIsBoot (GenLocated SrcSpan ModuleName)
</span><a href="#local-6989586621681203054"><span class="hs-identifier hs-var">dep</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; [GenWithIsBoot (GenLocated SrcSpan ModuleName)]
</span><a href="GHC.Driver.Make.html#msDeps"><span class="hs-identifier hs-var">msDeps</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203068"><span class="hs-identifier hs-var">ms</span></a></span><span>
</span><span id="line-2310"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="GHC.Unit.Types.html#NotBoot"><span class="hs-identifier hs-var">NotBoot</span></a></span><span> </span><span class="annot"><span class="annottext">IsBootInterface -&gt; IsBootInterface -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">GenWithIsBoot (GenLocated SrcSpan ModuleName) -&gt; IsBootInterface
forall mod. GenWithIsBoot mod -&gt; IsBootInterface
</span><a href="GHC.Unit.Types.html#gwib_isBoot"><span class="hs-identifier hs-var hs-var">gwib_isBoot</span></a></span><span> </span><span class="annot"><span class="annottext">GenWithIsBoot (GenLocated SrcSpan ModuleName)
</span><a href="#local-6989586621681203054"><span class="hs-identifier hs-var">dep</span></a></span><span>
</span><span id="line-2311"></span><span>                  </span><span class="hs-special">,</span><span> </span><span id="local-6989586621681203053"><span class="annot"><span class="annottext">[Either ErrorMessages ModSummary]
</span><a href="#local-6989586621681203053"><span class="hs-identifier hs-var">dep_ms_0</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Maybe [Either ErrorMessages ModSummary]
-&gt; [[Either ErrorMessages ModSummary]]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><a href="../../base/src/Data.Foldable.html#toList"><span class="hs-identifier hs-var">toList</span></a></span><span> </span><span class="annot"><span class="annottext">(Maybe [Either ErrorMessages ModSummary]
 -&gt; [[Either ErrorMessages ModSummary]])
-&gt; Maybe [Either ErrorMessages ModSummary]
-&gt; [[Either ErrorMessages ModSummary]]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">NodeKey
-&gt; NodeMap [Either ErrorMessages ModSummary]
-&gt; Maybe [Either ErrorMessages ModSummary]
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../containers/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GenLocated SrcSpan ModuleName -&gt; ModuleName
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">(GenLocated SrcSpan ModuleName -&gt; ModuleName)
-&gt; GenWithIsBoot (GenLocated SrcSpan ModuleName) -&gt; NodeKey
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">GenWithIsBoot (GenLocated SrcSpan ModuleName)
</span><a href="#local-6989586621681203054"><span class="hs-identifier hs-var">dep</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">NodeMap [Either ErrorMessages ModSummary]
</span><a href="#local-6989586621681203115"><span class="hs-identifier hs-var">nodemap</span></a></span><span>
</span><span id="line-2312"></span><span>                  </span><span class="hs-special">,</span><span> </span><span id="local-6989586621681203052"><span class="annot"><span class="annottext">Either ErrorMessages ModSummary
</span><a href="#local-6989586621681203052"><span class="hs-identifier hs-var">dep_ms_1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[Either ErrorMessages ModSummary]
-&gt; [Either ErrorMessages ModSummary]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><a href="../../base/src/Data.Foldable.html#toList"><span class="hs-identifier hs-var">toList</span></a></span><span> </span><span class="annot"><span class="annottext">([Either ErrorMessages ModSummary]
 -&gt; [Either ErrorMessages ModSummary])
-&gt; [Either ErrorMessages ModSummary]
-&gt; [Either ErrorMessages ModSummary]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[Either ErrorMessages ModSummary]
</span><a href="#local-6989586621681203053"><span class="hs-identifier hs-var">dep_ms_0</span></a></span><span>
</span><span id="line-2313"></span><span>                  </span><span class="hs-special">,</span><span> </span><span id="local-6989586621681203055"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203055"><span class="hs-identifier hs-var">dep_ms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Either ErrorMessages ModSummary -&gt; [ModSummary]
forall (t :: * -&gt; *) a. Foldable t =&gt; t a -&gt; [a]
</span><a href="../../base/src/Data.Foldable.html#toList"><span class="hs-identifier hs-var">toList</span></a></span><span> </span><span class="annot"><span class="annottext">(Either ErrorMessages ModSummary -&gt; [ModSummary])
-&gt; Either ErrorMessages ModSummary -&gt; [ModSummary]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">Either ErrorMessages ModSummary
</span><a href="#local-6989586621681203052"><span class="hs-identifier hs-var">dep_ms_1</span></a></span><span>
</span><span id="line-2314"></span><span>                  </span><span class="hs-special">]</span><span>
</span><span id="line-2315"></span><span>                </span><span id="local-6989586621681203049"><span class="annot"><span class="annottext">new_marked_mods :: Set Module
</span><a href="#local-6989586621681203049"><span class="hs-identifier hs-var hs-var">new_marked_mods</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module -&gt; Set Module -&gt; Set Module
forall a. Ord a =&gt; a -&gt; Set a -&gt; Set a
</span><a href="../../containers/src/Data.Set.Internal.html#insert"><span class="hs-identifier hs-var">Set.insert</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681203067"><span class="hs-identifier hs-var">ms_mod</span></a></span><span> </span><span class="annot"><span class="annottext">Set Module
</span><a href="#local-6989586621681203069"><span class="hs-identifier hs-var">marked_mods</span></a></span><span>
</span><span id="line-2316"></span><span>            </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">(Set Module -&gt; ModSummary -&gt; Set Module)
-&gt; Set Module -&gt; [ModSummary] -&gt; Set Module
forall (t :: * -&gt; *) b a.
Foldable t =&gt;
(b -&gt; a -&gt; b) -&gt; b -&gt; t a -&gt; b
</span><a href="../../base/src/Data.Foldable.html#foldl%27"><span class="hs-identifier hs-var">foldl'</span></a></span><span> </span><span class="annot"><span class="annottext">Set Module -&gt; ModSummary -&gt; Set Module
</span><a href="#local-6989586621681203074"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">Set Module
</span><a href="#local-6989586621681203049"><span class="hs-identifier hs-var">new_marked_mods</span></a></span><span> </span><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681203056"><span class="hs-identifier hs-var">deps</span></a></span><span>
</span><span id="line-2317"></span><span>
</span><span id="line-2318"></span><span class="annot"><a href="GHC.Driver.Make.html#mkRootMap"><span class="hs-identifier hs-type">mkRootMap</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#NodeMap"><span class="hs-identifier hs-type">NodeMap</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="../../base/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#ErrorMessages"><span class="hs-identifier hs-type">ErrorMessages</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2319"></span><span id="mkRootMap"><span class="annot"><span class="annottext">mkRootMap :: [ModSummary] -&gt; NodeMap [Either ErrorMessages ModSummary]
</span><a href="GHC.Driver.Make.html#mkRootMap"><span class="hs-identifier hs-var hs-var">mkRootMap</span></a></span></span><span> </span><span id="local-6989586621681203047"><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681203047"><span class="hs-identifier hs-var">summaries</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">([Either ErrorMessages ModSummary]
 -&gt; [Either ErrorMessages ModSummary]
 -&gt; [Either ErrorMessages ModSummary])
-&gt; [(NodeKey, [Either ErrorMessages ModSummary])]
-&gt; NodeMap [Either ErrorMessages ModSummary]
-&gt; NodeMap [Either ErrorMessages ModSummary]
forall key elt.
Ord key =&gt;
(elt -&gt; elt -&gt; elt) -&gt; [(key, elt)] -&gt; Map key elt -&gt; Map key elt
</span><a href="GHC.Data.FiniteMap.html#insertListWith"><span class="hs-identifier hs-var">Map.insertListWith</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">([Either ErrorMessages ModSummary]
 -&gt; [Either ErrorMessages ModSummary]
 -&gt; [Either ErrorMessages ModSummary])
-&gt; [Either ErrorMessages ModSummary]
-&gt; [Either ErrorMessages ModSummary]
-&gt; [Either ErrorMessages ModSummary]
forall a b c. (a -&gt; b -&gt; c) -&gt; b -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#flip"><span class="hs-identifier hs-var">flip</span></a></span><span> </span><span class="annot"><span class="annottext">[Either ErrorMessages ModSummary]
-&gt; [Either ErrorMessages ModSummary]
-&gt; [Either ErrorMessages ModSummary]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">(++)</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2320"></span><span>                                         </span><span class="hs-special">[</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; NodeKey
</span><a href="GHC.Driver.Make.html#msKey"><span class="hs-identifier hs-var">msKey</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203046"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ModSummary -&gt; Either ErrorMessages ModSummary
forall a b. b -&gt; Either a b
</span><a href="../../base/src/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203046"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681203046"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203046"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681203047"><span class="hs-identifier hs-var">summaries</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2321"></span><span>                                         </span><span class="annot"><span class="annottext">NodeMap [Either ErrorMessages ModSummary]
forall k a. Map k a
</span><a href="../../containers/src/Data.Map.Internal.html#empty"><span class="hs-identifier hs-var">Map.empty</span></a></span><span>
</span><span id="line-2322"></span><span>
</span><span id="line-2323"></span><span class="hs-comment">-- | Returns the dependencies of the ModSummary s.</span><span>
</span><span id="line-2324"></span><span class="hs-comment">-- A wrinkle is that for a {-# SOURCE #-} import we return</span><span>
</span><span id="line-2325"></span><span class="hs-comment">--      *both* the hs-boot file</span><span>
</span><span id="line-2326"></span><span class="hs-comment">--      *and* the source file</span><span>
</span><span id="line-2327"></span><span class="hs-comment">-- as &quot;dependencies&quot;.  That ensures that the list of all relevant</span><span>
</span><span id="line-2328"></span><span class="hs-comment">-- modules always contains B.hs if it contains B.hs-boot.</span><span>
</span><span id="line-2329"></span><span class="hs-comment">-- Remember, this pass isn't doing the topological sort.  It's</span><span>
</span><span id="line-2330"></span><span class="hs-comment">-- just gathering the list of all relevant ModSummaries</span><span>
</span><span id="line-2331"></span><span class="annot"><a href="GHC.Driver.Make.html#msDeps"><span class="hs-identifier hs-type">msDeps</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Types.html#GenWithIsBoot"><span class="hs-identifier hs-type">GenWithIsBoot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-2332"></span><span id="msDeps"><span class="annot"><span class="annottext">msDeps :: ModSummary -&gt; [GenWithIsBoot (GenLocated SrcSpan ModuleName)]
</span><a href="GHC.Driver.Make.html#msDeps"><span class="hs-identifier hs-var hs-var">msDeps</span></a></span></span><span> </span><span id="local-6989586621681203045"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203045"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">GenWithIsBoot (GenLocated SrcSpan ModuleName)
</span><a href="#local-6989586621681203044"><span class="hs-identifier hs-var">d</span></a></span><span>
</span><span id="line-2333"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681203043"><span class="annot"><span class="annottext">GenLocated SrcSpan ModuleName
</span><a href="#local-6989586621681203043"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; [GenLocated SrcSpan ModuleName]
</span><a href="GHC.Driver.Types.html#ms_home_srcimps"><span class="hs-identifier hs-var">ms_home_srcimps</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203045"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-2334"></span><span>           </span><span class="hs-special">,</span><span> </span><span id="local-6989586621681203044"><span class="annot"><span class="annottext">GenWithIsBoot (GenLocated SrcSpan ModuleName)
</span><a href="#local-6989586621681203044"><span class="hs-identifier hs-var">d</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">GWIB :: forall mod. mod -&gt; IsBootInterface -&gt; GenWithIsBoot mod
</span><a href="GHC.Unit.Types.html#GWIB"><span class="hs-identifier hs-type">GWIB</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">gwib_mod :: GenLocated SrcSpan ModuleName
</span><a href="GHC.Unit.Types.html#gwib_mod"><span class="hs-identifier hs-var">gwib_mod</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpan ModuleName
</span><a href="#local-6989586621681203043"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">gwib_isBoot :: IsBootInterface
</span><a href="GHC.Unit.Types.html#gwib_isBoot"><span class="hs-identifier hs-var">gwib_isBoot</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="GHC.Unit.Types.html#IsBoot"><span class="hs-identifier hs-var">IsBoot</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2335"></span><span>                  </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">GWIB :: forall mod. mod -&gt; IsBootInterface -&gt; GenWithIsBoot mod
</span><a href="GHC.Unit.Types.html#GWIB"><span class="hs-identifier hs-type">GWIB</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">gwib_mod :: GenLocated SrcSpan ModuleName
</span><a href="GHC.Unit.Types.html#gwib_mod"><span class="hs-identifier hs-var">gwib_mod</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpan ModuleName
</span><a href="#local-6989586621681203043"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">gwib_isBoot :: IsBootInterface
</span><a href="GHC.Unit.Types.html#gwib_isBoot"><span class="hs-identifier hs-var">gwib_isBoot</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="GHC.Unit.Types.html#NotBoot"><span class="hs-identifier hs-var">NotBoot</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2336"></span><span>                  </span><span class="hs-special">]</span><span>
</span><span id="line-2337"></span><span>           </span><span class="hs-special">]</span><span>
</span><span id="line-2338"></span><span>        </span><span class="annot"><span class="annottext">[GenWithIsBoot (GenLocated SrcSpan ModuleName)]
-&gt; [GenWithIsBoot (GenLocated SrcSpan ModuleName)]
-&gt; [GenWithIsBoot (GenLocated SrcSpan ModuleName)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">GWIB :: forall mod. mod -&gt; IsBootInterface -&gt; GenWithIsBoot mod
</span><a href="GHC.Unit.Types.html#GWIB"><span class="hs-identifier hs-type">GWIB</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">gwib_mod :: GenLocated SrcSpan ModuleName
</span><a href="GHC.Unit.Types.html#gwib_mod"><span class="hs-identifier hs-var">gwib_mod</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpan ModuleName
</span><a href="#local-6989586621681203042"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">gwib_isBoot :: IsBootInterface
</span><a href="GHC.Unit.Types.html#gwib_isBoot"><span class="hs-identifier hs-var">gwib_isBoot</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="GHC.Unit.Types.html#NotBoot"><span class="hs-identifier hs-var">NotBoot</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2339"></span><span>           </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681203042"><span class="annot"><span class="annottext">GenLocated SrcSpan ModuleName
</span><a href="#local-6989586621681203042"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; [GenLocated SrcSpan ModuleName]
</span><a href="GHC.Driver.Types.html#ms_home_imps"><span class="hs-identifier hs-var">ms_home_imps</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203045"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-2340"></span><span>           </span><span class="hs-special">]</span><span>
</span><span id="line-2341"></span><span>
</span><span id="line-2342"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-2343"></span><span class="hs-comment">-- Summarising modules</span><span>
</span><span id="line-2344"></span><span>
</span><span id="line-2345"></span><span class="hs-comment">-- We have two types of summarisation:</span><span>
</span><span id="line-2346"></span><span class="hs-comment">--</span><span>
</span><span id="line-2347"></span><span class="hs-comment">--    * Summarise a file.  This is used for the root module(s) passed to</span><span>
</span><span id="line-2348"></span><span class="hs-comment">--      cmLoadModules.  The file is read, and used to determine the root</span><span>
</span><span id="line-2349"></span><span class="hs-comment">--      module name.  The module name may differ from the filename.</span><span>
</span><span id="line-2350"></span><span class="hs-comment">--</span><span>
</span><span id="line-2351"></span><span class="hs-comment">--    * Summarise a module.  We are given a module name, and must provide</span><span>
</span><span id="line-2352"></span><span class="hs-comment">--      a summary.  The finder is used to locate the file in which the module</span><span>
</span><span id="line-2353"></span><span class="hs-comment">--      resides.</span><span>
</span><span id="line-2354"></span><span>
</span><span id="line-2355"></span><span class="annot"><a href="GHC.Driver.Make.html#summariseFile"><span class="hs-identifier hs-type">summariseFile</span></a></span><span>
</span><span id="line-2356"></span><span>        </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-2357"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">]</span><span>                 </span><span class="hs-comment">-- old summaries</span><span>
</span><span id="line-2358"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>                     </span><span class="hs-comment">-- source file name</span><span>
</span><span id="line-2359"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Phases.html#Phase"><span class="hs-identifier hs-type">Phase</span></a></span><span>                  </span><span class="hs-comment">-- start phase</span><span>
</span><span id="line-2360"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>                         </span><span class="hs-comment">-- object code allowed?</span><span>
</span><span id="line-2361"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.StringBuffer.html#StringBuffer"><span class="hs-identifier hs-type">StringBuffer</span></a></span><span class="hs-special">,</span><span class="annot"><a href="../../time/src/Data.Time.Clock.Internal.UTCTime.html#UTCTime"><span class="hs-identifier hs-type">UTCTime</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2362"></span><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#ErrorMessages"><span class="hs-identifier hs-type">ErrorMessages</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2363"></span><span>
</span><span id="line-2364"></span><span id="summariseFile"><span class="annot"><span class="annottext">summariseFile :: HscEnv
-&gt; [ModSummary]
-&gt; FilePath
-&gt; Maybe Phase
-&gt; Bool
-&gt; Maybe (InputFileBuffer, UTCTime)
-&gt; IO (Either ErrorMessages ModSummary)
</span><a href="GHC.Driver.Make.html#summariseFile"><span class="hs-identifier hs-var hs-var">summariseFile</span></a></span></span><span> </span><span id="local-6989586621681203040"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203040"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681203039"><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681203039"><span class="hs-identifier hs-var">old_summaries</span></a></span></span><span> </span><span id="local-6989586621681203038"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681203038"><span class="hs-identifier hs-var">src_fn</span></a></span></span><span> </span><span id="local-6989586621681203037"><span class="annot"><span class="annottext">Maybe Phase
</span><a href="#local-6989586621681203037"><span class="hs-identifier hs-var">mb_phase</span></a></span></span><span> </span><span id="local-6989586621681203036"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681203036"><span class="hs-identifier hs-var">obj_allowed</span></a></span></span><span> </span><span id="local-6989586621681203035"><span class="annot"><span class="annottext">Maybe (InputFileBuffer, UTCTime)
</span><a href="#local-6989586621681203035"><span class="hs-identifier hs-var">maybe_buf</span></a></span></span><span>
</span><span id="line-2365"></span><span>        </span><span class="hs-comment">-- we can use a cached summary if one is available and the</span><span>
</span><span id="line-2366"></span><span>        </span><span class="hs-comment">-- source file hasn't changed,  But we have to look up the summary</span><span>
</span><span id="line-2367"></span><span>        </span><span class="hs-comment">-- by source file, rather than module name as we do in summarise.</span><span>
</span><span id="line-2368"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681203034"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203034"><span class="hs-identifier hs-var">old_summary</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[ModSummary] -&gt; FilePath -&gt; Maybe ModSummary
</span><a href="GHC.Driver.Make.html#findSummaryBySourceFile"><span class="hs-identifier hs-var">findSummaryBySourceFile</span></a></span><span> </span><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681203039"><span class="hs-identifier hs-var">old_summaries</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681203038"><span class="hs-identifier hs-var">src_fn</span></a></span><span>
</span><span id="line-2369"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2370"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681203032"><span class="annot"><span class="annottext">location :: ModLocation
</span><a href="#local-6989586621681203032"><span class="hs-identifier hs-var hs-var">location</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; ModLocation
</span><a href="GHC.Driver.Types.html#ms_location"><span class="hs-identifier hs-var hs-var">ms_location</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203034"><span class="hs-identifier hs-var">old_summary</span></a></span><span>
</span><span id="line-2371"></span><span>            </span><span id="local-6989586621681203031"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621681203031"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203040"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2372"></span><span>
</span><span id="line-2373"></span><span>        </span><span id="local-6989586621681203030"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621681203030"><span class="hs-identifier hs-var">src_timestamp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO UTCTime
</span><a href="#local-6989586621681203029"><span class="hs-identifier hs-var">get_src_timestamp</span></a></span><span>
</span><span id="line-2374"></span><span>                </span><span class="hs-comment">-- The file exists; we checked in getRootSummary above.</span><span>
</span><span id="line-2375"></span><span>                </span><span class="hs-comment">-- If it gets removed subsequently, then this</span><span>
</span><span id="line-2376"></span><span>                </span><span class="hs-comment">-- getModificationUTCTime may fail, but that's the right</span><span>
</span><span id="line-2377"></span><span>                </span><span class="hs-comment">-- behaviour.</span><span>
</span><span id="line-2378"></span><span>
</span><span id="line-2379"></span><span>                </span><span class="hs-comment">-- return the cached summary if the source didn't change</span><span>
</span><span id="line-2380"></span><span>        </span><span class="annot"><span class="annottext">HscEnv
-&gt; DynFlags
-&gt; Bool
-&gt; IsBootInterface
-&gt; (UTCTime -&gt; IO (Either ErrorMessages ModSummary))
-&gt; ModSummary
-&gt; ModLocation
-&gt; UTCTime
-&gt; IO (Either ErrorMessages ModSummary)
forall e.
HscEnv
-&gt; DynFlags
-&gt; Bool
-&gt; IsBootInterface
-&gt; (UTCTime -&gt; IO (Either e ModSummary))
-&gt; ModSummary
-&gt; ModLocation
-&gt; UTCTime
-&gt; IO (Either e ModSummary)
</span><a href="GHC.Driver.Make.html#checkSummaryTimestamp"><span class="hs-identifier hs-var">checkSummaryTimestamp</span></a></span><span>
</span><span id="line-2381"></span><span>            </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203040"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681203031"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681203036"><span class="hs-identifier hs-var">obj_allowed</span></a></span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="GHC.Unit.Types.html#NotBoot"><span class="hs-identifier hs-var">NotBoot</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; UTCTime -&gt; IO (Either ErrorMessages ModSummary)
</span><a href="#local-6989586621681203027"><span class="hs-identifier hs-var">new_summary</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681203038"><span class="hs-identifier hs-var">src_fn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2382"></span><span>            </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681203034"><span class="hs-identifier hs-var">old_summary</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681203032"><span class="hs-identifier hs-var">location</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621681203030"><span class="hs-identifier hs-var">src_timestamp</span></a></span><span>
</span><span id="line-2383"></span><span>
</span><span id="line-2384"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>
</span><span id="line-2385"></span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span> </span><span id="local-6989586621681203026"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621681203026"><span class="hs-identifier hs-var">src_timestamp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO UTCTime
</span><a href="#local-6989586621681203029"><span class="hs-identifier hs-var">get_src_timestamp</span></a></span><span>
</span><span id="line-2386"></span><span>        </span><span class="annot"><span class="annottext">FilePath -&gt; UTCTime -&gt; IO (Either ErrorMessages ModSummary)
</span><a href="#local-6989586621681203027"><span class="hs-identifier hs-var">new_summary</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681203038"><span class="hs-identifier hs-var">src_fn</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621681203026"><span class="hs-identifier hs-var">src_timestamp</span></a></span><span>
</span><span id="line-2387"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2388"></span><span>    </span><span id="local-6989586621681203029"><span class="annot"><span class="annottext">get_src_timestamp :: IO UTCTime
</span><a href="#local-6989586621681203029"><span class="hs-identifier hs-var hs-var">get_src_timestamp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (InputFileBuffer, UTCTime)
</span><a href="#local-6989586621681203035"><span class="hs-identifier hs-var">maybe_buf</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2389"></span><span>                           </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InputFileBuffer
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621681203023"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621681203023"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">UTCTime -&gt; IO UTCTime
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621681203023"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-2390"></span><span>                           </span><span class="annot"><span class="annottext">Maybe (InputFileBuffer, UTCTime)
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO UTCTime -&gt; IO UTCTime
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO UTCTime -&gt; IO UTCTime) -&gt; IO UTCTime -&gt; IO UTCTime
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO UTCTime
</span><a href="GHC.Utils.Misc.html#getModificationUTCTime"><span class="hs-identifier hs-var">getModificationUTCTime</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681203038"><span class="hs-identifier hs-var">src_fn</span></a></span><span>
</span><span id="line-2391"></span><span>                        </span><span class="hs-comment">-- getModificationUTCTime may fail</span><span>
</span><span id="line-2392"></span><span>
</span><span id="line-2393"></span><span>    </span><span id="local-6989586621681203027"><span class="annot"><span class="annottext">new_summary :: FilePath -&gt; UTCTime -&gt; IO (Either ErrorMessages ModSummary)
</span><a href="#local-6989586621681203027"><span class="hs-identifier hs-var hs-var">new_summary</span></a></span></span><span> </span><span id="local-6989586621681203013"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681203013"><span class="hs-identifier hs-var">src_fn</span></a></span></span><span> </span><span id="local-6989586621681203012"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621681203012"><span class="hs-identifier hs-var">src_timestamp</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrorMessages IO ModSummary
-&gt; IO (Either ErrorMessages ModSummary)
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><a href="../../transformers/src/Control.Monad.Trans.Except.html#runExceptT"><span class="hs-identifier hs-var">runExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrorMessages IO ModSummary
 -&gt; IO (Either ErrorMessages ModSummary))
-&gt; ExceptT ErrorMessages IO ModSummary
-&gt; IO (Either ErrorMessages ModSummary)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2394"></span><span>        </span><span id="local-6989586621681203011"><span class="annot"><span class="annottext">preimps :: PreprocessedImports
</span><a href="#local-6989586621681203011"><span class="hs-identifier hs-var">preimps</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.Driver.Make.html#PreprocessedImports"><span class="hs-identifier hs-type">PreprocessedImports</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621681203003"><span id="local-6989586621681203004"><span id="local-6989586621681203005"><span id="local-6989586621681203006"><span id="local-6989586621681203007"><span id="local-6989586621681203008"><span id="local-6989586621681203009"><span class="annot"><span class="annottext">FilePath
[(Maybe FastString, GenLocated SrcSpan ModuleName)]
ModuleName
DynFlags
InputFileBuffer
SrcSpan
pi_mod_name :: PreprocessedImports -&gt; ModuleName
pi_mod_name_loc :: PreprocessedImports -&gt; SrcSpan
pi_hspp_buf :: PreprocessedImports -&gt; InputFileBuffer
pi_hspp_fn :: PreprocessedImports -&gt; FilePath
pi_theimps :: PreprocessedImports
-&gt; [(Maybe FastString, GenLocated SrcSpan ModuleName)]
pi_srcimps :: PreprocessedImports
-&gt; [(Maybe FastString, GenLocated SrcSpan ModuleName)]
pi_local_dflags :: PreprocessedImports -&gt; DynFlags
pi_mod_name :: ModuleName
pi_mod_name_loc :: SrcSpan
pi_hspp_buf :: InputFileBuffer
pi_hspp_fn :: FilePath
pi_theimps :: [(Maybe FastString, GenLocated SrcSpan ModuleName)]
pi_srcimps :: [(Maybe FastString, GenLocated SrcSpan ModuleName)]
pi_local_dflags :: DynFlags
</span><a href="GHC.Driver.Make.html#pi_mod_name"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span>
</span><span id="line-2395"></span><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; FilePath
-&gt; Maybe Phase
-&gt; Maybe (InputFileBuffer, UTCTime)
-&gt; ExceptT ErrorMessages IO PreprocessedImports
</span><a href="GHC.Driver.Make.html#getPreprocessedImports"><span class="hs-identifier hs-var">getPreprocessedImports</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203040"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681203013"><span class="hs-identifier hs-var">src_fn</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Phase
</span><a href="#local-6989586621681203037"><span class="hs-identifier hs-var">mb_phase</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (InputFileBuffer, UTCTime)
</span><a href="#local-6989586621681203035"><span class="hs-identifier hs-var">maybe_buf</span></a></span><span>
</span><span id="line-2396"></span><span>
</span><span id="line-2397"></span><span>
</span><span id="line-2398"></span><span>        </span><span class="hs-comment">-- Make a ModLocation for this file</span><span>
</span><span id="line-2399"></span><span>        </span><span id="local-6989586621681202994"><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681202994"><span class="hs-identifier hs-var">location</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO ModLocation -&gt; ExceptT ErrorMessages IO ModLocation
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ModLocation -&gt; ExceptT ErrorMessages IO ModLocation)
-&gt; IO ModLocation -&gt; ExceptT ErrorMessages IO ModLocation
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; ModuleName -&gt; FilePath -&gt; IO ModLocation
</span><a href="GHC.Driver.Finder.html#mkHomeModLocation"><span class="hs-identifier hs-var">mkHomeModLocation</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203040"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681203003"><span class="hs-identifier hs-var">pi_mod_name</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681203013"><span class="hs-identifier hs-var">src_fn</span></a></span><span>
</span><span id="line-2400"></span><span>
</span><span id="line-2401"></span><span>        </span><span class="hs-comment">-- Tell the Finder cache where it is, so that subsequent calls</span><span>
</span><span id="line-2402"></span><span>        </span><span class="hs-comment">-- to findModule will find it, even if it's not on any search path</span><span>
</span><span id="line-2403"></span><span>        </span><span id="local-6989586621681202992"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681202992"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO Module -&gt; ExceptT ErrorMessages IO Module
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO Module -&gt; ExceptT ErrorMessages IO Module)
-&gt; IO Module -&gt; ExceptT ErrorMessages IO Module
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; ModuleName -&gt; ModLocation -&gt; IO Module
</span><a href="GHC.Driver.Finder.html#addHomeModuleToFinder"><span class="hs-identifier hs-var">addHomeModuleToFinder</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203040"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681203003"><span class="hs-identifier hs-var">pi_mod_name</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681202994"><span class="hs-identifier hs-var">location</span></a></span><span>
</span><span id="line-2404"></span><span>
</span><span id="line-2405"></span><span>        </span><span class="annot"><span class="annottext">IO ModSummary -&gt; ExceptT ErrorMessages IO ModSummary
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ModSummary -&gt; ExceptT ErrorMessages IO ModSummary)
-&gt; IO ModSummary -&gt; ExceptT ErrorMessages IO ModSummary
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; MakeNewModSummary -&gt; IO ModSummary
</span><a href="GHC.Driver.Make.html#makeNewModSummary"><span class="hs-identifier hs-var">makeNewModSummary</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681203040"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(MakeNewModSummary -&gt; IO ModSummary)
-&gt; MakeNewModSummary -&gt; IO ModSummary
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">MakeNewModSummary :: FilePath
-&gt; UTCTime
-&gt; IsBootInterface
-&gt; HscSource
-&gt; ModLocation
-&gt; Module
-&gt; Bool
-&gt; PreprocessedImports
-&gt; MakeNewModSummary
</span><a href="GHC.Driver.Make.html#MakeNewModSummary"><span class="hs-identifier hs-type">MakeNewModSummary</span></a></span><span>
</span><span id="line-2406"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">nms_src_fn :: FilePath
</span><a href="GHC.Driver.Make.html#nms_src_fn"><span class="hs-identifier hs-var">nms_src_fn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681203013"><span class="hs-identifier hs-var">src_fn</span></a></span><span>
</span><span id="line-2407"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">nms_src_timestamp :: UTCTime
</span><a href="GHC.Driver.Make.html#nms_src_timestamp"><span class="hs-identifier hs-var">nms_src_timestamp</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621681203012"><span class="hs-identifier hs-var">src_timestamp</span></a></span><span>
</span><span id="line-2408"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">nms_is_boot :: IsBootInterface
</span><a href="GHC.Driver.Make.html#nms_is_boot"><span class="hs-identifier hs-var">nms_is_boot</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="GHC.Unit.Types.html#NotBoot"><span class="hs-identifier hs-var">NotBoot</span></a></span><span>
</span><span id="line-2409"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">nms_hsc_src :: HscSource
</span><a href="GHC.Driver.Make.html#nms_hsc_src"><span class="hs-identifier hs-var">nms_hsc_src</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2410"></span><span>                </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Bool
</span><a href="GHC.Driver.Phases.html#isHaskellSigFilename"><span class="hs-identifier hs-var">isHaskellSigFilename</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681203013"><span class="hs-identifier hs-var">src_fn</span></a></span><span>
</span><span id="line-2411"></span><span>                   </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="GHC.Driver.Phases.html#HsigFile"><span class="hs-identifier hs-var">HsigFile</span></a></span><span>
</span><span id="line-2412"></span><span>                   </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="GHC.Driver.Phases.html#HsSrcFile"><span class="hs-identifier hs-var">HsSrcFile</span></a></span><span>
</span><span id="line-2413"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">nms_location :: ModLocation
</span><a href="GHC.Driver.Make.html#nms_location"><span class="hs-identifier hs-var">nms_location</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681202994"><span class="hs-identifier hs-var">location</span></a></span><span>
</span><span id="line-2414"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">nms_mod :: Module
</span><a href="GHC.Driver.Make.html#nms_mod"><span class="hs-identifier hs-var">nms_mod</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681202992"><span class="hs-identifier hs-var">mod</span></a></span><span>
</span><span id="line-2415"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">nms_obj_allowed :: Bool
</span><a href="GHC.Driver.Make.html#nms_obj_allowed"><span class="hs-identifier hs-var">nms_obj_allowed</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681203036"><span class="hs-identifier hs-var">obj_allowed</span></a></span><span>
</span><span id="line-2416"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">nms_preimps :: PreprocessedImports
</span><a href="GHC.Driver.Make.html#nms_preimps"><span class="hs-identifier hs-var">nms_preimps</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PreprocessedImports
</span><a href="#local-6989586621681203011"><span class="hs-identifier hs-var">preimps</span></a></span><span>
</span><span id="line-2417"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-2418"></span><span>
</span><span id="line-2419"></span><span class="annot"><a href="GHC.Driver.Make.html#findSummaryBySourceFile"><span class="hs-identifier hs-type">findSummaryBySourceFile</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span>
</span><span id="line-2420"></span><span id="findSummaryBySourceFile"><span class="annot"><span class="annottext">findSummaryBySourceFile :: [ModSummary] -&gt; FilePath -&gt; Maybe ModSummary
</span><a href="GHC.Driver.Make.html#findSummaryBySourceFile"><span class="hs-identifier hs-var hs-var">findSummaryBySourceFile</span></a></span></span><span> </span><span id="local-6989586621681202979"><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681202979"><span class="hs-identifier hs-var">summaries</span></a></span></span><span> </span><span id="local-6989586621681202978"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681202978"><span class="hs-identifier hs-var">file</span></a></span></span><span>
</span><span id="line-2421"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681202977"><span class="hs-identifier hs-var">ms</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681202977"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681202977"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681202979"><span class="hs-identifier hs-var">summaries</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="GHC.Driver.Phases.html#HsSrcFile"><span class="hs-identifier hs-var">HsSrcFile</span></a></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">ModSummary -&gt; HscSource
</span><a href="GHC.Driver.Types.html#ms_hsc_src"><span class="hs-identifier hs-var hs-var">ms_hsc_src</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681202977"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">]</span><span class="hs-special">,</span><span>
</span><span id="line-2422"></span><span>                                 </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath -&gt; FilePath
forall a. HasCallStack =&gt; FilePath -&gt; Maybe a -&gt; a
</span><a href="GHC.Data.Maybe.html#expectJust"><span class="hs-identifier hs-var">expectJust</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;findSummaryBySourceFile&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModLocation -&gt; Maybe FilePath
</span><a href="GHC.Unit.Module.Location.html#ml_hs_file"><span class="hs-identifier hs-var hs-var">ml_hs_file</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; ModLocation
</span><a href="GHC.Driver.Types.html#ms_location"><span class="hs-identifier hs-var hs-var">ms_location</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681202977"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; FilePath -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681202978"><span class="hs-identifier hs-var">file</span></a></span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2423"></span><span>        </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe ModSummary
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-2424"></span><span>        </span><span class="hs-special">(</span><span id="local-6989586621681202976"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681202976"><span class="hs-identifier hs-var">x</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[ModSummary]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; Maybe ModSummary
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681202976"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-2425"></span><span>
</span><span id="line-2426"></span><span id="local-6989586621681204949"><span class="annot"><a href="GHC.Driver.Make.html#checkSummaryTimestamp"><span class="hs-identifier hs-type">checkSummaryTimestamp</span></a></span><span>
</span><span id="line-2427"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#IsBootInterface"><span class="hs-identifier hs-type">IsBootInterface</span></a></span><span>
</span><span id="line-2428"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../time/src/Data.Time.Clock.Internal.UTCTime.html#UTCTime"><span class="hs-identifier hs-type">UTCTime</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681204949"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2429"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Location.html#ModLocation"><span class="hs-identifier hs-type">ModLocation</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../time/src/Data.Time.Clock.Internal.UTCTime.html#UTCTime"><span class="hs-identifier hs-type">UTCTime</span></a></span><span>
</span><span id="line-2430"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681204949"><span class="hs-identifier hs-type">e</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-2431"></span><span id="checkSummaryTimestamp"><span class="annot"><span class="annottext">checkSummaryTimestamp :: forall e.
HscEnv
-&gt; DynFlags
-&gt; Bool
-&gt; IsBootInterface
-&gt; (UTCTime -&gt; IO (Either e ModSummary))
-&gt; ModSummary
-&gt; ModLocation
-&gt; UTCTime
-&gt; IO (Either e ModSummary)
</span><a href="GHC.Driver.Make.html#checkSummaryTimestamp"><span class="hs-identifier hs-var hs-var">checkSummaryTimestamp</span></a></span></span><span>
</span><span id="line-2432"></span><span>  </span><span id="local-6989586621681202967"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681202967"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681202966"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681202966"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621681202965"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681202965"><span class="hs-identifier hs-var">obj_allowed</span></a></span></span><span> </span><span id="local-6989586621681202964"><span class="annot"><span class="annottext">IsBootInterface
</span><a href="#local-6989586621681202964"><span class="hs-identifier hs-var">is_boot</span></a></span></span><span> </span><span id="local-6989586621681202963"><span class="annot"><span class="annottext">UTCTime -&gt; IO (Either e ModSummary)
</span><a href="#local-6989586621681202963"><span class="hs-identifier hs-var">new_summary</span></a></span></span><span>
</span><span id="line-2433"></span><span>  </span><span id="local-6989586621681202962"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681202962"><span class="hs-identifier hs-var">old_summary</span></a></span></span><span> </span><span id="local-6989586621681202961"><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681202961"><span class="hs-identifier hs-var">location</span></a></span></span><span> </span><span id="local-6989586621681202960"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621681202960"><span class="hs-identifier hs-var">src_timestamp</span></a></span></span><span>
</span><span id="line-2434"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; UTCTime
</span><a href="GHC.Driver.Types.html#ms_hs_date"><span class="hs-identifier hs-var hs-var">ms_hs_date</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681202962"><span class="hs-identifier hs-var">old_summary</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime -&gt; UTCTime -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621681202960"><span class="hs-identifier hs-var">src_timestamp</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span>
</span><span id="line-2435"></span><span>      </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_ForceRecomp"><span class="hs-identifier hs-var">Opt_ForceRecomp</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681202967"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2436"></span><span>           </span><span class="hs-comment">-- update the object-file timestamp</span><span>
</span><span id="line-2437"></span><span>           </span><span id="local-6989586621681202959"><span class="annot"><span class="annottext">Maybe UTCTime
</span><a href="#local-6989586621681202959"><span class="hs-identifier hs-var">obj_timestamp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span>
</span><span id="line-2438"></span><span>             </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">HscTarget -&gt; Bool
</span><a href="GHC.Driver.Session.html#isObjectTarget"><span class="hs-identifier hs-var">isObjectTarget</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; HscTarget
</span><a href="GHC.Driver.Session.html#hscTarget"><span class="hs-identifier hs-var hs-var">hscTarget</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681202967"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2439"></span><span>                 </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681202965"><span class="hs-identifier hs-var">obj_allowed</span></a></span><span> </span><span class="hs-comment">-- bug #1205</span><span>
</span><span id="line-2440"></span><span>                 </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">IO (Maybe UTCTime) -&gt; IO (Maybe UTCTime)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (Maybe UTCTime) -&gt; IO (Maybe UTCTime))
-&gt; IO (Maybe UTCTime) -&gt; IO (Maybe UTCTime)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation -&gt; IsBootInterface -&gt; IO (Maybe UTCTime)
</span><a href="GHC.Driver.Make.html#getObjTimestamp"><span class="hs-identifier hs-var">getObjTimestamp</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681202961"><span class="hs-identifier hs-var">location</span></a></span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="#local-6989586621681202964"><span class="hs-identifier hs-var">is_boot</span></a></span><span>
</span><span id="line-2441"></span><span>                 </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe UTCTime -&gt; IO (Maybe UTCTime)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe UTCTime
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-2442"></span><span>
</span><span id="line-2443"></span><span>           </span><span class="hs-comment">-- We have to repopulate the Finder's cache for file targets</span><span>
</span><span id="line-2444"></span><span>           </span><span class="hs-comment">-- because the file might not even be on the regular search path</span><span>
</span><span id="line-2445"></span><span>           </span><span class="hs-comment">-- and it was likely flushed in depanal. This is not technically</span><span>
</span><span id="line-2446"></span><span>           </span><span class="hs-comment">-- needed when we're called from sumariseModule but it shouldn't</span><span>
</span><span id="line-2447"></span><span>           </span><span class="hs-comment">-- hurt.</span><span>
</span><span id="line-2448"></span><span>           </span><span class="annot"><span class="annottext">Module
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; ModuleName -&gt; ModLocation -&gt; IO Module
</span><a href="GHC.Driver.Finder.html#addHomeModuleToFinder"><span class="hs-identifier hs-var">addHomeModuleToFinder</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681202967"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2449"></span><span>                  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var hs-var">moduleName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; Module
</span><a href="GHC.Driver.Types.html#ms_mod"><span class="hs-identifier hs-var hs-var">ms_mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681202962"><span class="hs-identifier hs-var">old_summary</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681202961"><span class="hs-identifier hs-var">location</span></a></span><span>
</span><span id="line-2450"></span><span>
</span><span id="line-2451"></span><span>           </span><span id="local-6989586621681202957"><span class="annot"><span class="annottext">Maybe UTCTime
</span><a href="#local-6989586621681202957"><span class="hs-identifier hs-var">hi_timestamp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; ModLocation -&gt; IO (Maybe UTCTime)
</span><a href="GHC.Driver.Make.html#maybeGetIfaceDate"><span class="hs-identifier hs-var">maybeGetIfaceDate</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681202966"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681202961"><span class="hs-identifier hs-var">location</span></a></span><span>
</span><span id="line-2452"></span><span>           </span><span id="local-6989586621681202956"><span class="annot"><span class="annottext">Maybe UTCTime
</span><a href="#local-6989586621681202956"><span class="hs-identifier hs-var">hie_timestamp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO (Maybe UTCTime)
</span><a href="GHC.Utils.Misc.html#modificationTimeIfExists"><span class="hs-identifier hs-var">modificationTimeIfExists</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModLocation -&gt; FilePath
</span><a href="GHC.Unit.Module.Location.html#ml_hie_file"><span class="hs-identifier hs-var hs-var">ml_hie_file</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681202961"><span class="hs-identifier hs-var">location</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2453"></span><span>
</span><span id="line-2454"></span><span>           </span><span class="annot"><span class="annottext">Either e ModSummary -&gt; IO (Either e ModSummary)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Either e ModSummary -&gt; IO (Either e ModSummary))
-&gt; Either e ModSummary -&gt; IO (Either e ModSummary)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; Either e ModSummary
forall a b. b -&gt; Either a b
</span><a href="../../base/src/Data.Either.html#Right"><span class="hs-identifier hs-var">Right</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681202962"><span class="hs-identifier hs-var">old_summary</span></a></span><span>
</span><span id="line-2455"></span><span>               </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ms_obj_date :: Maybe UTCTime
</span><a href="GHC.Driver.Types.html#ms_obj_date"><span class="hs-identifier hs-var">ms_obj_date</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe UTCTime
</span><a href="#local-6989586621681202959"><span class="hs-identifier hs-var">obj_timestamp</span></a></span><span>
</span><span id="line-2456"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ms_iface_date :: Maybe UTCTime
</span><a href="GHC.Driver.Types.html#ms_iface_date"><span class="hs-identifier hs-var">ms_iface_date</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe UTCTime
</span><a href="#local-6989586621681202957"><span class="hs-identifier hs-var">hi_timestamp</span></a></span><span>
</span><span id="line-2457"></span><span>               </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ms_hie_date :: Maybe UTCTime
</span><a href="GHC.Driver.Types.html#ms_hie_date"><span class="hs-identifier hs-var">ms_hie_date</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe UTCTime
</span><a href="#local-6989586621681202956"><span class="hs-identifier hs-var">hie_timestamp</span></a></span><span>
</span><span id="line-2458"></span><span>               </span><span class="hs-special">}</span><span>
</span><span id="line-2459"></span><span>
</span><span id="line-2460"></span><span>   </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2461"></span><span>           </span><span class="hs-comment">-- source changed: re-summarise.</span><span>
</span><span id="line-2462"></span><span>           </span><span class="annot"><span class="annottext">UTCTime -&gt; IO (Either e ModSummary)
</span><a href="#local-6989586621681202963"><span class="hs-identifier hs-var">new_summary</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621681202960"><span class="hs-identifier hs-var">src_timestamp</span></a></span><span>
</span><span id="line-2463"></span><span>
</span><span id="line-2464"></span><span class="hs-comment">-- Summarise a module, and pick up source and timestamp.</span><span>
</span><span id="line-2465"></span><span class="annot"><a href="GHC.Driver.Make.html#summariseModule"><span class="hs-identifier hs-type">summariseModule</span></a></span><span>
</span><span id="line-2466"></span><span>          </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-2467"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#NodeMap"><span class="hs-identifier hs-type">NodeMap</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span> </span><span class="hs-comment">-- Map of old summaries</span><span>
</span><span id="line-2468"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#IsBootInterface"><span class="hs-identifier hs-type">IsBootInterface</span></a></span><span>    </span><span class="hs-comment">-- True &lt;=&gt; a {-# SOURCE #-} import</span><span>
</span><span id="line-2469"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span> </span><span class="hs-comment">-- Imported module to be summarised</span><span>
</span><span id="line-2470"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>               </span><span class="hs-comment">-- object code allowed?</span><span>
</span><span id="line-2471"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.StringBuffer.html#StringBuffer"><span class="hs-identifier hs-type">StringBuffer</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../time/src/Data.Time.Clock.Internal.UTCTime.html#UTCTime"><span class="hs-identifier hs-type">UTCTime</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2472"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span class="hs-special">]</span><span>               </span><span class="hs-comment">-- Modules to exclude</span><span>
</span><span id="line-2473"></span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/Data.Either.html#Either"><span class="hs-identifier hs-type">Either</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#ErrorMessages"><span class="hs-identifier hs-type">ErrorMessages</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>      </span><span class="hs-comment">-- Its new summary</span><span>
</span><span id="line-2474"></span><span>
</span><span id="line-2475"></span><span id="summariseModule"><span class="annot"><span class="annottext">summariseModule :: HscEnv
-&gt; NodeMap ModSummary
-&gt; IsBootInterface
-&gt; GenLocated SrcSpan ModuleName
-&gt; Bool
-&gt; Maybe (InputFileBuffer, UTCTime)
-&gt; [ModuleName]
-&gt; IO (Maybe (Either ErrorMessages ModSummary))
</span><a href="GHC.Driver.Make.html#summariseModule"><span class="hs-identifier hs-var hs-var">summariseModule</span></a></span></span><span> </span><span id="local-6989586621681202953"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681202953"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681202952"><span class="annot"><span class="annottext">NodeMap ModSummary
</span><a href="#local-6989586621681202952"><span class="hs-identifier hs-var">old_summary_map</span></a></span></span><span> </span><span id="local-6989586621681202951"><span class="annot"><span class="annottext">IsBootInterface
</span><a href="#local-6989586621681202951"><span class="hs-identifier hs-var">is_boot</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681202950"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681202950"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681202949"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681202949"><span class="hs-identifier hs-var">wanted_mod</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2476"></span><span>                </span><span id="local-6989586621681202948"><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681202948"><span class="hs-identifier hs-var">obj_allowed</span></a></span></span><span> </span><span id="local-6989586621681202947"><span class="annot"><span class="annottext">Maybe (InputFileBuffer, UTCTime)
</span><a href="#local-6989586621681202947"><span class="hs-identifier hs-var">maybe_buf</span></a></span></span><span> </span><span id="local-6989586621681202946"><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621681202946"><span class="hs-identifier hs-var">excl_mods</span></a></span></span><span>
</span><span id="line-2477"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681202949"><span class="hs-identifier hs-var">wanted_mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; [ModuleName] -&gt; Bool
forall (t :: * -&gt; *) a. (Foldable t, Eq a) =&gt; a -&gt; t a -&gt; Bool
</span><a href="../../base/src/Data.Foldable.html#elem"><span class="hs-operator hs-var">`elem`</span></a></span><span> </span><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621681202946"><span class="hs-identifier hs-var">excl_mods</span></a></span><span>
</span><span id="line-2478"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe (Either ErrorMessages ModSummary)
-&gt; IO (Maybe (Either ErrorMessages ModSummary))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Either ErrorMessages ModSummary)
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-2479"></span><span>
</span><span id="line-2480"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681202945"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681202945"><span class="hs-identifier hs-var">old_summary</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">NodeKey -&gt; NodeMap ModSummary -&gt; Maybe ModSummary
forall k a. Ord k =&gt; k -&gt; Map k a -&gt; Maybe a
</span><a href="../../containers/src/Data.Map.Internal.html#lookup"><span class="hs-identifier hs-var">Map.lookup</span></a></span><span>
</span><span id="line-2481"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">GWIB :: forall mod. mod -&gt; IsBootInterface -&gt; GenWithIsBoot mod
</span><a href="GHC.Unit.Types.html#GWIB"><span class="hs-identifier hs-type">GWIB</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">gwib_mod :: ModuleName
</span><a href="GHC.Unit.Types.html#gwib_mod"><span class="hs-identifier hs-var">gwib_mod</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681202949"><span class="hs-identifier hs-var">wanted_mod</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">gwib_isBoot :: IsBootInterface
</span><a href="GHC.Unit.Types.html#gwib_isBoot"><span class="hs-identifier hs-var">gwib_isBoot</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="#local-6989586621681202951"><span class="hs-identifier hs-var">is_boot</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-2482"></span><span>      </span><span class="annot"><span class="annottext">NodeMap ModSummary
</span><a href="#local-6989586621681202952"><span class="hs-identifier hs-var">old_summary_map</span></a></span><span>
</span><span id="line-2483"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>          </span><span class="hs-comment">-- Find its new timestamp; all the</span><span>
</span><span id="line-2484"></span><span>                </span><span class="hs-comment">-- ModSummaries in the old map have valid ml_hs_files</span><span>
</span><span id="line-2485"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681202944"><span class="annot"><span class="annottext">location :: ModLocation
</span><a href="#local-6989586621681202944"><span class="hs-identifier hs-var hs-var">location</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; ModLocation
</span><a href="GHC.Driver.Types.html#ms_location"><span class="hs-identifier hs-var hs-var">ms_location</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681202945"><span class="hs-identifier hs-var">old_summary</span></a></span><span>
</span><span id="line-2486"></span><span>            </span><span id="local-6989586621681202941"><span class="annot"><span class="annottext">src_fn :: FilePath
</span><a href="#local-6989586621681202941"><span class="hs-identifier hs-var hs-var">src_fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath -&gt; FilePath
forall a. HasCallStack =&gt; FilePath -&gt; Maybe a -&gt; a
</span><a href="GHC.Data.Maybe.html#expectJust"><span class="hs-identifier hs-var">expectJust</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;summariseModule&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModLocation -&gt; Maybe FilePath
</span><a href="GHC.Unit.Module.Location.html#ml_hs_file"><span class="hs-identifier hs-var hs-var">ml_hs_file</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681202944"><span class="hs-identifier hs-var">location</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2487"></span><span>
</span><span id="line-2488"></span><span>                </span><span class="hs-comment">-- check the modification time on the source file, and</span><span>
</span><span id="line-2489"></span><span>                </span><span class="hs-comment">-- return the cached summary if it hasn't changed.  If the</span><span>
</span><span id="line-2490"></span><span>                </span><span class="hs-comment">-- file has disappeared, we need to call the Finder again.</span><span>
</span><span id="line-2491"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (InputFileBuffer, UTCTime)
</span><a href="#local-6989586621681202947"><span class="hs-identifier hs-var">maybe_buf</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2492"></span><span>           </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InputFileBuffer
</span><span class="hs-identifier">_</span></span><span class="hs-special">,</span><span id="local-6989586621681202940"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621681202940"><span class="hs-identifier hs-var">t</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2493"></span><span>               </span><span class="annot"><span class="annottext">Either ErrorMessages ModSummary
-&gt; Maybe (Either ErrorMessages ModSummary)
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(Either ErrorMessages ModSummary
 -&gt; Maybe (Either ErrorMessages ModSummary))
-&gt; IO (Either ErrorMessages ModSummary)
-&gt; IO (Maybe (Either ErrorMessages ModSummary))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
-&gt; ModLocation
-&gt; FilePath
-&gt; UTCTime
-&gt; IO (Either ErrorMessages ModSummary)
</span><a href="#local-6989586621681202939"><span class="hs-identifier hs-var">check_timestamp</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681202945"><span class="hs-identifier hs-var">old_summary</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681202944"><span class="hs-identifier hs-var">location</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681202941"><span class="hs-identifier hs-var">src_fn</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621681202940"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-2494"></span><span>           </span><span class="annot"><span class="annottext">Maybe (InputFileBuffer, UTCTime)
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2495"></span><span>                </span><span id="local-6989586621681202938"><span class="annot"><span class="annottext">Either IOException UTCTime
</span><a href="#local-6989586621681202938"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO UTCTime -&gt; IO (Either IOException UTCTime)
forall a. IO a -&gt; IO (Either IOException a)
</span><a href="GHC.Utils.Exception.html#tryIO"><span class="hs-identifier hs-var">tryIO</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; IO UTCTime
</span><a href="GHC.Utils.Misc.html#getModificationUTCTime"><span class="hs-identifier hs-var">getModificationUTCTime</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681202941"><span class="hs-identifier hs-var">src_fn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2496"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either IOException UTCTime
</span><a href="#local-6989586621681202938"><span class="hs-identifier hs-var">m</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2497"></span><span>                   </span><span class="annot"><a href="../../base/src/Data.Either.html#Right"><span class="hs-identifier hs-type">Right</span></a></span><span> </span><span id="local-6989586621681202937"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621681202937"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2498"></span><span>                       </span><span class="annot"><span class="annottext">Either ErrorMessages ModSummary
-&gt; Maybe (Either ErrorMessages ModSummary)
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(Either ErrorMessages ModSummary
 -&gt; Maybe (Either ErrorMessages ModSummary))
-&gt; IO (Either ErrorMessages ModSummary)
-&gt; IO (Maybe (Either ErrorMessages ModSummary))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
-&gt; ModLocation
-&gt; FilePath
-&gt; UTCTime
-&gt; IO (Either ErrorMessages ModSummary)
</span><a href="#local-6989586621681202939"><span class="hs-identifier hs-var">check_timestamp</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681202945"><span class="hs-identifier hs-var">old_summary</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681202944"><span class="hs-identifier hs-var">location</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681202941"><span class="hs-identifier hs-var">src_fn</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621681202937"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-2499"></span><span>                   </span><span class="annot"><a href="../../base/src/Data.Either.html#Left"><span class="hs-identifier hs-type">Left</span></a></span><span> </span><span id="local-6989586621681202936"><span class="annot"><span class="annottext">IOException
</span><a href="#local-6989586621681202936"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">IOException -&gt; Bool
</span><a href="../../base/src/System.IO.Error.html#isDoesNotExistError"><span class="hs-identifier hs-var">isDoesNotExistError</span></a></span><span> </span><span class="annot"><span class="annottext">IOException
</span><a href="#local-6989586621681202936"><span class="hs-identifier hs-var">e</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO (Maybe (Either ErrorMessages ModSummary))
</span><a href="#local-6989586621681202935"><span class="hs-identifier hs-var">find_it</span></a></span><span>
</span><span id="line-2500"></span><span>                          </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IOException -&gt; IO (Maybe (Either ErrorMessages ModSummary))
forall a. IOException -&gt; IO a
</span><a href="../../base/src/GHC.IO.Exception.html#ioError"><span class="hs-identifier hs-var">ioError</span></a></span><span> </span><span class="annot"><span class="annottext">IOException
</span><a href="#local-6989586621681202936"><span class="hs-identifier hs-var">e</span></a></span><span>
</span><span id="line-2501"></span><span>
</span><span id="line-2502"></span><span>  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO (Maybe (Either ErrorMessages ModSummary))
</span><a href="#local-6989586621681202935"><span class="hs-identifier hs-var">find_it</span></a></span><span>
</span><span id="line-2503"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2504"></span><span>    </span><span id="local-6989586621681202933"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621681202933"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681202953"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2505"></span><span>
</span><span id="line-2506"></span><span>    </span><span id="local-6989586621681202939"><span class="annot"><span class="annottext">check_timestamp :: ModSummary
-&gt; ModLocation
-&gt; FilePath
-&gt; UTCTime
-&gt; IO (Either ErrorMessages ModSummary)
</span><a href="#local-6989586621681202939"><span class="hs-identifier hs-var hs-var">check_timestamp</span></a></span></span><span> </span><span id="local-6989586621681202932"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681202932"><span class="hs-identifier hs-var">old_summary</span></a></span></span><span> </span><span id="local-6989586621681202931"><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681202931"><span class="hs-identifier hs-var">location</span></a></span></span><span> </span><span id="local-6989586621681202930"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681202930"><span class="hs-identifier hs-var">src_fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2507"></span><span>        </span><span class="annot"><span class="annottext">HscEnv
-&gt; DynFlags
-&gt; Bool
-&gt; IsBootInterface
-&gt; (UTCTime -&gt; IO (Either ErrorMessages ModSummary))
-&gt; ModSummary
-&gt; ModLocation
-&gt; UTCTime
-&gt; IO (Either ErrorMessages ModSummary)
forall e.
HscEnv
-&gt; DynFlags
-&gt; Bool
-&gt; IsBootInterface
-&gt; (UTCTime -&gt; IO (Either e ModSummary))
-&gt; ModSummary
-&gt; ModLocation
-&gt; UTCTime
-&gt; IO (Either e ModSummary)
</span><a href="GHC.Driver.Make.html#checkSummaryTimestamp"><span class="hs-identifier hs-var">checkSummaryTimestamp</span></a></span><span>
</span><span id="line-2508"></span><span>          </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681202953"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681202933"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681202948"><span class="hs-identifier hs-var">obj_allowed</span></a></span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="#local-6989586621681202951"><span class="hs-identifier hs-var">is_boot</span></a></span><span>
</span><span id="line-2509"></span><span>          </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModLocation
-&gt; Module
-&gt; FilePath
-&gt; UTCTime
-&gt; IO (Either ErrorMessages ModSummary)
</span><a href="#local-6989586621681202929"><span class="hs-identifier hs-var">new_summary</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681202931"><span class="hs-identifier hs-var">location</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; Module
</span><a href="GHC.Driver.Types.html#ms_mod"><span class="hs-identifier hs-var hs-var">ms_mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681202932"><span class="hs-identifier hs-var">old_summary</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681202930"><span class="hs-identifier hs-var">src_fn</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2510"></span><span>          </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681202932"><span class="hs-identifier hs-var">old_summary</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681202931"><span class="hs-identifier hs-var">location</span></a></span><span>
</span><span id="line-2511"></span><span>
</span><span id="line-2512"></span><span>    </span><span id="local-6989586621681202935"><span class="annot"><span class="annottext">find_it :: IO (Maybe (Either ErrorMessages ModSummary))
</span><a href="#local-6989586621681202935"><span class="hs-identifier hs-var hs-var">find_it</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2513"></span><span>        </span><span id="local-6989586621681202925"><span class="annot"><span class="annottext">FindResult
</span><a href="#local-6989586621681202925"><span class="hs-identifier hs-var">found</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; ModuleName -&gt; Maybe FastString -&gt; IO FindResult
</span><a href="GHC.Driver.Finder.html#findImportedModule"><span class="hs-identifier hs-var">findImportedModule</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681202953"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681202949"><span class="hs-identifier hs-var">wanted_mod</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe FastString
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-2514"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">FindResult
</span><a href="#local-6989586621681202925"><span class="hs-identifier hs-var">found</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2515"></span><span>             </span><span class="annot"><a href="GHC.Driver.Types.html#Found"><span class="hs-identifier hs-type">Found</span></a></span><span> </span><span id="local-6989586621681202922"><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681202922"><span class="hs-identifier hs-var">location</span></a></span></span><span> </span><span id="local-6989586621681202921"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681202921"><span class="hs-identifier hs-var">mod</span></a></span></span><span>
</span><span id="line-2516"></span><span>                </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Maybe FilePath -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../../base/src/Data.Maybe.html#isJust"><span class="hs-identifier hs-var">isJust</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModLocation -&gt; Maybe FilePath
</span><a href="GHC.Unit.Module.Location.html#ml_hs_file"><span class="hs-identifier hs-var hs-var">ml_hs_file</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681202922"><span class="hs-identifier hs-var">location</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2517"></span><span>                        </span><span class="hs-comment">-- Home package</span><span>
</span><span id="line-2518"></span><span>                         </span><span class="annot"><span class="annottext">Either ErrorMessages ModSummary
-&gt; Maybe (Either ErrorMessages ModSummary)
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">(Either ErrorMessages ModSummary
 -&gt; Maybe (Either ErrorMessages ModSummary))
-&gt; IO (Either ErrorMessages ModSummary)
-&gt; IO (Maybe (Either ErrorMessages ModSummary))
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation -&gt; Module -&gt; IO (Either ErrorMessages ModSummary)
</span><a href="#local-6989586621681202920"><span class="hs-identifier hs-var">just_found</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681202922"><span class="hs-identifier hs-var">location</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681202921"><span class="hs-identifier hs-var">mod</span></a></span><span>
</span><span id="line-2519"></span><span>
</span><span id="line-2520"></span><span>             </span><span class="annot"><span class="annottext">FindResult
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (Either ErrorMessages ModSummary)
-&gt; IO (Maybe (Either ErrorMessages ModSummary))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Either ErrorMessages ModSummary)
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-2521"></span><span>                        </span><span class="hs-comment">-- Not found</span><span>
</span><span id="line-2522"></span><span>                        </span><span class="hs-comment">-- (If it is TRULY not found at all, we'll</span><span>
</span><span id="line-2523"></span><span>                        </span><span class="hs-comment">-- error when we actually try to compile)</span><span>
</span><span id="line-2524"></span><span>
</span><span id="line-2525"></span><span>    </span><span id="local-6989586621681202920"><span class="annot"><span class="annottext">just_found :: ModLocation -&gt; Module -&gt; IO (Either ErrorMessages ModSummary)
</span><a href="#local-6989586621681202920"><span class="hs-identifier hs-var hs-var">just_found</span></a></span></span><span> </span><span id="local-6989586621681202917"><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681202917"><span class="hs-identifier hs-var">location</span></a></span></span><span> </span><span id="local-6989586621681202916"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681202916"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2526"></span><span>                </span><span class="hs-comment">-- Adjust location to point to the hs-boot source file,</span><span>
</span><span id="line-2527"></span><span>                </span><span class="hs-comment">-- hi file, object file, when is_boot says so</span><span>
</span><span id="line-2528"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681202915"><span class="annot"><span class="annottext">location' :: ModLocation
</span><a href="#local-6989586621681202915"><span class="hs-identifier hs-var hs-var">location'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="#local-6989586621681202951"><span class="hs-identifier hs-var">is_boot</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2529"></span><span>              </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="GHC.Unit.Types.html#IsBoot"><span class="hs-identifier hs-var">IsBoot</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModLocation -&gt; ModLocation
</span><a href="GHC.Unit.Module.Location.html#addBootSuffixLocn"><span class="hs-identifier hs-var">addBootSuffixLocn</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681202917"><span class="hs-identifier hs-var">location</span></a></span><span>
</span><span id="line-2530"></span><span>              </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="GHC.Unit.Types.html#NotBoot"><span class="hs-identifier hs-var">NotBoot</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681202917"><span class="hs-identifier hs-var">location</span></a></span><span>
</span><span id="line-2531"></span><span>            </span><span id="local-6989586621681202911"><span class="annot"><span class="annottext">src_fn :: FilePath
</span><a href="#local-6989586621681202911"><span class="hs-identifier hs-var hs-var">src_fn</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath -&gt; FilePath
forall a. HasCallStack =&gt; FilePath -&gt; Maybe a -&gt; a
</span><a href="GHC.Data.Maybe.html#expectJust"><span class="hs-identifier hs-var">expectJust</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;summarise2&quot;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModLocation -&gt; Maybe FilePath
</span><a href="GHC.Unit.Module.Location.html#ml_hs_file"><span class="hs-identifier hs-var hs-var">ml_hs_file</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681202915"><span class="hs-identifier hs-var">location'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2532"></span><span>
</span><span id="line-2533"></span><span>                </span><span class="hs-comment">-- Check that it exists</span><span>
</span><span id="line-2534"></span><span>                </span><span class="hs-comment">-- It might have been deleted since the Finder last found it</span><span>
</span><span id="line-2535"></span><span>        </span><span id="local-6989586621681202910"><span class="annot"><span class="annottext">Maybe UTCTime
</span><a href="#local-6989586621681202910"><span class="hs-identifier hs-var">maybe_t</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO (Maybe UTCTime)
</span><a href="GHC.Utils.Misc.html#modificationTimeIfExists"><span class="hs-identifier hs-var">modificationTimeIfExists</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681202911"><span class="hs-identifier hs-var">src_fn</span></a></span><span>
</span><span id="line-2536"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe UTCTime
</span><a href="#local-6989586621681202910"><span class="hs-identifier hs-var">maybe_t</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2537"></span><span>          </span><span class="annot"><span class="annottext">Maybe UTCTime
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either ErrorMessages ModSummary
-&gt; IO (Either ErrorMessages ModSummary)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(Either ErrorMessages ModSummary
 -&gt; IO (Either ErrorMessages ModSummary))
-&gt; Either ErrorMessages ModSummary
-&gt; IO (Either ErrorMessages ModSummary)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ErrorMessages -&gt; Either ErrorMessages ModSummary
forall a b. a -&gt; Either a b
</span><a href="../../base/src/Data.Either.html#Left"><span class="hs-identifier hs-var">Left</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrorMessages -&gt; Either ErrorMessages ModSummary)
-&gt; ErrorMessages -&gt; Either ErrorMessages ModSummary
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; SrcSpan -&gt; FilePath -&gt; ErrorMessages
</span><a href="GHC.Driver.Make.html#noHsFileErr"><span class="hs-identifier hs-var">noHsFileErr</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681202933"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681202950"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681202911"><span class="hs-identifier hs-var">src_fn</span></a></span><span>
</span><span id="line-2538"></span><span>          </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681202908"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621681202908"><span class="hs-identifier hs-var">t</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ModLocation
-&gt; Module
-&gt; FilePath
-&gt; UTCTime
-&gt; IO (Either ErrorMessages ModSummary)
</span><a href="#local-6989586621681202929"><span class="hs-identifier hs-var">new_summary</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681202915"><span class="hs-identifier hs-var">location'</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681202916"><span class="hs-identifier hs-var">mod</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681202911"><span class="hs-identifier hs-var">src_fn</span></a></span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621681202908"><span class="hs-identifier hs-var">t</span></a></span><span>
</span><span id="line-2539"></span><span>
</span><span id="line-2540"></span><span>    </span><span id="local-6989586621681202929"><span class="annot"><span class="annottext">new_summary :: ModLocation
-&gt; Module
-&gt; FilePath
-&gt; UTCTime
-&gt; IO (Either ErrorMessages ModSummary)
</span><a href="#local-6989586621681202929"><span class="hs-identifier hs-var hs-var">new_summary</span></a></span></span><span> </span><span id="local-6989586621681202887"><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681202887"><span class="hs-identifier hs-var">location</span></a></span></span><span> </span><span id="local-6989586621681202886"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681202886"><span class="hs-identifier hs-var">mod</span></a></span></span><span> </span><span id="local-6989586621681202885"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681202885"><span class="hs-identifier hs-var">src_fn</span></a></span></span><span> </span><span id="local-6989586621681202884"><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621681202884"><span class="hs-identifier hs-var">src_timestamp</span></a></span></span><span>
</span><span id="line-2541"></span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ExceptT ErrorMessages IO ModSummary
-&gt; IO (Either ErrorMessages ModSummary)
forall e (m :: * -&gt; *) a. ExceptT e m a -&gt; m (Either e a)
</span><a href="../../transformers/src/Control.Monad.Trans.Except.html#runExceptT"><span class="hs-identifier hs-var">runExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrorMessages IO ModSummary
 -&gt; IO (Either ErrorMessages ModSummary))
-&gt; ExceptT ErrorMessages IO ModSummary
-&gt; IO (Either ErrorMessages ModSummary)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2542"></span><span>        </span><span id="local-6989586621681202883"><span class="annot"><span class="annottext">preimps :: PreprocessedImports
</span><a href="#local-6989586621681202883"><span class="hs-identifier hs-var">preimps</span></a></span></span><span class="hs-glyph">@</span><span class="annot"><a href="GHC.Driver.Make.html#PreprocessedImports"><span class="hs-identifier hs-type">PreprocessedImports</span></a></span><span> </span><span class="hs-special">{</span><span id="local-6989586621681202876"><span id="local-6989586621681202877"><span id="local-6989586621681202878"><span id="local-6989586621681202879"><span id="local-6989586621681202880"><span id="local-6989586621681202881"><span id="local-6989586621681202882"><span class="annot"><span class="annottext">FilePath
[(Maybe FastString, GenLocated SrcSpan ModuleName)]
ModuleName
DynFlags
InputFileBuffer
SrcSpan
pi_mod_name :: ModuleName
pi_mod_name_loc :: SrcSpan
pi_hspp_buf :: InputFileBuffer
pi_hspp_fn :: FilePath
pi_theimps :: [(Maybe FastString, GenLocated SrcSpan ModuleName)]
pi_srcimps :: [(Maybe FastString, GenLocated SrcSpan ModuleName)]
pi_local_dflags :: DynFlags
pi_mod_name :: PreprocessedImports -&gt; ModuleName
pi_mod_name_loc :: PreprocessedImports -&gt; SrcSpan
pi_hspp_buf :: PreprocessedImports -&gt; InputFileBuffer
pi_hspp_fn :: PreprocessedImports -&gt; FilePath
pi_theimps :: PreprocessedImports
-&gt; [(Maybe FastString, GenLocated SrcSpan ModuleName)]
pi_srcimps :: PreprocessedImports
-&gt; [(Maybe FastString, GenLocated SrcSpan ModuleName)]
pi_local_dflags :: PreprocessedImports -&gt; DynFlags
</span><a href="#local-6989586621681202876"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span>
</span><span id="line-2543"></span><span>            </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; FilePath
-&gt; Maybe Phase
-&gt; Maybe (InputFileBuffer, UTCTime)
-&gt; ExceptT ErrorMessages IO PreprocessedImports
</span><a href="GHC.Driver.Make.html#getPreprocessedImports"><span class="hs-identifier hs-var">getPreprocessedImports</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681202953"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681202885"><span class="hs-identifier hs-var">src_fn</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe Phase
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (InputFileBuffer, UTCTime)
</span><a href="#local-6989586621681202947"><span class="hs-identifier hs-var">maybe_buf</span></a></span><span>
</span><span id="line-2544"></span><span>
</span><span id="line-2545"></span><span>        </span><span class="hs-comment">-- NB: Despite the fact that is_boot is a top-level parameter, we</span><span>
</span><span id="line-2546"></span><span>        </span><span class="hs-comment">-- don't actually know coming into this function what the HscSource</span><span>
</span><span id="line-2547"></span><span>        </span><span class="hs-comment">-- of the module in question is.  This is because we may be processing</span><span>
</span><span id="line-2548"></span><span>        </span><span class="hs-comment">-- this module because another module in the graph imported it: in this</span><span>
</span><span id="line-2549"></span><span>        </span><span class="hs-comment">-- case, we know if it's a boot or not because of the {-# SOURCE #-}</span><span>
</span><span id="line-2550"></span><span>        </span><span class="hs-comment">-- annotation, but we don't know if it's a signature or a regular</span><span>
</span><span id="line-2551"></span><span>        </span><span class="hs-comment">-- module until we actually look it up on the filesystem.</span><span>
</span><span id="line-2552"></span><span>        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681202874"><span class="annot"><span class="annottext">hsc_src :: HscSource
</span><a href="#local-6989586621681202874"><span class="hs-identifier hs-var hs-var">hsc_src</span></a></span></span><span>
</span><span id="line-2553"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="#local-6989586621681202951"><span class="hs-identifier hs-var">is_boot</span></a></span><span> </span><span class="annot"><span class="annottext">IsBootInterface -&gt; IsBootInterface -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="GHC.Unit.Types.html#IsBoot"><span class="hs-identifier hs-var">IsBoot</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="GHC.Driver.Phases.html#HsBootFile"><span class="hs-identifier hs-var">HsBootFile</span></a></span><span>
</span><span id="line-2554"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; Bool
</span><a href="GHC.Driver.Phases.html#isHaskellSigFilename"><span class="hs-identifier hs-var">isHaskellSigFilename</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681202885"><span class="hs-identifier hs-var">src_fn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="GHC.Driver.Phases.html#HsigFile"><span class="hs-identifier hs-var">HsigFile</span></a></span><span>
</span><span id="line-2555"></span><span>              </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="../../base/src/GHC.Base.html#otherwise"><span class="hs-identifier hs-var">otherwise</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="GHC.Driver.Phases.html#HsSrcFile"><span class="hs-identifier hs-var">HsSrcFile</span></a></span><span>
</span><span id="line-2556"></span><span>
</span><span id="line-2557"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; ExceptT ErrorMessages IO () -&gt; ExceptT ErrorMessages IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681202876"><span class="hs-identifier hs-var">pi_mod_name</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; ModuleName -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">/=</span></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681202949"><span class="hs-identifier hs-var">wanted_mod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrorMessages IO () -&gt; ExceptT ErrorMessages IO ())
-&gt; ExceptT ErrorMessages IO () -&gt; ExceptT ErrorMessages IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2558"></span><span>                </span><span class="annot"><span class="annottext">ErrorMessages -&gt; ExceptT ErrorMessages IO ()
forall (m :: * -&gt; *) e a. Monad m =&gt; e -&gt; ExceptT e m a
</span><a href="../../transformers/src/Control.Monad.Trans.Except.html#throwE"><span class="hs-identifier hs-var">throwE</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrorMessages -&gt; ExceptT ErrorMessages IO ())
-&gt; ErrorMessages -&gt; ExceptT ErrorMessages IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ErrMsg -&gt; ErrorMessages
forall a. a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#unitBag"><span class="hs-identifier hs-var">unitBag</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrMsg -&gt; ErrorMessages) -&gt; ErrMsg -&gt; ErrorMessages
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; SrcSpan -&gt; SDoc -&gt; ErrMsg
</span><a href="GHC.Utils.Error.html#mkPlainErrMsg"><span class="hs-identifier hs-var">mkPlainErrMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681202882"><span class="hs-identifier hs-var">pi_local_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681202877"><span class="hs-identifier hs-var">pi_mod_name_loc</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; ErrMsg) -&gt; SDoc -&gt; ErrMsg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2559"></span><span>                              </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;File name does not match module name:&quot;</span></span><span>
</span><span id="line-2560"></span><span>                              </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;Saw:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681202876"><span class="hs-identifier hs-var">pi_mod_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2561"></span><span>                              </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;Expected:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681202949"><span class="hs-identifier hs-var">wanted_mod</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2562"></span><span>
</span><span id="line-2563"></span><span>        </span><span class="annot"><span class="annottext">Bool -&gt; ExceptT ErrorMessages IO () -&gt; ExceptT ErrorMessages IO ()
forall (f :: * -&gt; *). Applicative f =&gt; Bool -&gt; f () -&gt; f ()
</span><a href="../../base/src/GHC.Base.html#when"><span class="hs-identifier hs-var">when</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621681202874"><span class="hs-identifier hs-var">hsc_src</span></a></span><span> </span><span class="annot"><span class="annottext">HscSource -&gt; HscSource -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="GHC.Driver.Phases.html#HsigFile"><span class="hs-identifier hs-var">HsigFile</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="annot"><span class="annottext">Maybe Module -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><a href="../../base/src/Data.Maybe.html#isNothing"><span class="hs-identifier hs-var">isNothing</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName -&gt; [(ModuleName, Module)] -&gt; Maybe Module
forall a b. Eq a =&gt; a -&gt; [(a, b)] -&gt; Maybe b
</span><a href="../../base/src/GHC.List.html#lookup"><span class="hs-identifier hs-var">lookup</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681202876"><span class="hs-identifier hs-var">pi_mod_name</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; [(ModuleName, Module)]
</span><a href="GHC.Driver.Session.html#homeUnitInstantiations"><span class="hs-identifier hs-var hs-var">homeUnitInstantiations</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681202933"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">(ExceptT ErrorMessages IO () -&gt; ExceptT ErrorMessages IO ())
-&gt; ExceptT ErrorMessages IO () -&gt; ExceptT ErrorMessages IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2564"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681202869"><span class="annot"><span class="annottext">suggested_instantiated_with :: SDoc
</span><a href="#local-6989586621681202869"><span class="hs-identifier hs-var hs-var">suggested_instantiated_with</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2565"></span><span>                    </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#hcat"><span class="hs-identifier hs-var">hcat</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; [SDoc] -&gt; [SDoc]
</span><a href="GHC.Utils.Outputable.html#punctuate"><span class="hs-identifier hs-var">punctuate</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="GHC.Utils.Outputable.html#comma"><span class="hs-identifier hs-var">comma</span></a></span><span> </span><span class="annot"><span class="annottext">([SDoc] -&gt; [SDoc]) -&gt; [SDoc] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2566"></span><span>                        </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681202868"><span class="hs-identifier hs-var">k</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;=&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Module -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681202867"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-2567"></span><span>                        </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><span id="local-6989586621681202868"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681202868"><span class="hs-identifier hs-var">k</span></a></span></span><span class="hs-special">,</span><span id="local-6989586621681202867"><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681202867"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681202876"><span class="hs-identifier hs-var">pi_mod_name</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; Module
forall u. ModuleName -&gt; GenModule (GenUnit u)
</span><a href="GHC.Unit.Module.html#mkHoleModule"><span class="hs-identifier hs-var">mkHoleModule</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681202876"><span class="hs-identifier hs-var">pi_mod_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2568"></span><span>                                </span><span class="annot"><span class="annottext">(ModuleName, Module)
-&gt; [(ModuleName, Module)] -&gt; [(ModuleName, Module)]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; [(ModuleName, Module)]
</span><a href="GHC.Driver.Session.html#homeUnitInstantiations"><span class="hs-identifier hs-var hs-var">homeUnitInstantiations</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681202933"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2569"></span><span>                        </span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-2570"></span><span>            </span><span class="hs-keyword">in</span><span> </span><span class="annot"><span class="annottext">ErrorMessages -&gt; ExceptT ErrorMessages IO ()
forall (m :: * -&gt; *) e a. Monad m =&gt; e -&gt; ExceptT e m a
</span><a href="../../transformers/src/Control.Monad.Trans.Except.html#throwE"><span class="hs-identifier hs-var">throwE</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrorMessages -&gt; ExceptT ErrorMessages IO ())
-&gt; ErrorMessages -&gt; ExceptT ErrorMessages IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ErrMsg -&gt; ErrorMessages
forall a. a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#unitBag"><span class="hs-identifier hs-var">unitBag</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrMsg -&gt; ErrorMessages) -&gt; ErrMsg -&gt; ErrorMessages
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; SrcSpan -&gt; SDoc -&gt; ErrMsg
</span><a href="GHC.Utils.Error.html#mkPlainErrMsg"><span class="hs-identifier hs-var">mkPlainErrMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681202882"><span class="hs-identifier hs-var">pi_local_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681202877"><span class="hs-identifier hs-var">pi_mod_name_loc</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; ErrMsg) -&gt; SDoc -&gt; ErrMsg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2571"></span><span>                </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;Unexpected signature:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681202876"><span class="hs-identifier hs-var">pi_mod_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2572"></span><span>                </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_BuildingCabalPackage"><span class="hs-identifier hs-var">Opt_BuildingCabalPackage</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681202933"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-2573"></span><span>                    </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;Try adding&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681202876"><span class="hs-identifier hs-var">pi_mod_name</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2574"></span><span>                            </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;to the&quot;</span></span><span>
</span><span id="line-2575"></span><span>                            </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;signatures&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-2576"></span><span>                            </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;field in your Cabal file.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-2577"></span><span>                    </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;Try passing -instantiated-with=\&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span>
</span><span id="line-2578"></span><span>                                 </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681202869"><span class="hs-identifier hs-var">suggested_instantiated_with</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;\&quot;&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%24%24"><span class="hs-operator hs-var">$$</span></a></span><span>
</span><span id="line-2579"></span><span>                                </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;replacing &lt;&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681202876"><span class="hs-identifier hs-var">pi_mod_name</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%3E"><span class="hs-operator hs-var">&lt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;&gt; as necessary.&quot;</span></span><span class="hs-special">)</span><span>
</span><span id="line-2580"></span><span>
</span><span id="line-2581"></span><span>        </span><span class="annot"><span class="annottext">IO ModSummary -&gt; ExceptT ErrorMessages IO ModSummary
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO ModSummary -&gt; ExceptT ErrorMessages IO ModSummary)
-&gt; IO ModSummary -&gt; ExceptT ErrorMessages IO ModSummary
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; MakeNewModSummary -&gt; IO ModSummary
</span><a href="GHC.Driver.Make.html#makeNewModSummary"><span class="hs-identifier hs-var">makeNewModSummary</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681202953"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">(MakeNewModSummary -&gt; IO ModSummary)
-&gt; MakeNewModSummary -&gt; IO ModSummary
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">MakeNewModSummary :: FilePath
-&gt; UTCTime
-&gt; IsBootInterface
-&gt; HscSource
-&gt; ModLocation
-&gt; Module
-&gt; Bool
-&gt; PreprocessedImports
-&gt; MakeNewModSummary
</span><a href="GHC.Driver.Make.html#MakeNewModSummary"><span class="hs-identifier hs-type">MakeNewModSummary</span></a></span><span>
</span><span id="line-2582"></span><span>            </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">nms_src_fn :: FilePath
</span><a href="GHC.Driver.Make.html#nms_src_fn"><span class="hs-identifier hs-var">nms_src_fn</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681202885"><span class="hs-identifier hs-var">src_fn</span></a></span><span>
</span><span id="line-2583"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">nms_src_timestamp :: UTCTime
</span><a href="GHC.Driver.Make.html#nms_src_timestamp"><span class="hs-identifier hs-var">nms_src_timestamp</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621681202884"><span class="hs-identifier hs-var">src_timestamp</span></a></span><span>
</span><span id="line-2584"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">nms_is_boot :: IsBootInterface
</span><a href="GHC.Driver.Make.html#nms_is_boot"><span class="hs-identifier hs-var">nms_is_boot</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="#local-6989586621681202951"><span class="hs-identifier hs-var">is_boot</span></a></span><span>
</span><span id="line-2585"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">nms_hsc_src :: HscSource
</span><a href="GHC.Driver.Make.html#nms_hsc_src"><span class="hs-identifier hs-var">nms_hsc_src</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621681202874"><span class="hs-identifier hs-var">hsc_src</span></a></span><span>
</span><span id="line-2586"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">nms_location :: ModLocation
</span><a href="GHC.Driver.Make.html#nms_location"><span class="hs-identifier hs-var">nms_location</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681202887"><span class="hs-identifier hs-var">location</span></a></span><span>
</span><span id="line-2587"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">nms_mod :: Module
</span><a href="GHC.Driver.Make.html#nms_mod"><span class="hs-identifier hs-var">nms_mod</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681202886"><span class="hs-identifier hs-var">mod</span></a></span><span>
</span><span id="line-2588"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">nms_obj_allowed :: Bool
</span><a href="GHC.Driver.Make.html#nms_obj_allowed"><span class="hs-identifier hs-var">nms_obj_allowed</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681202948"><span class="hs-identifier hs-var">obj_allowed</span></a></span><span>
</span><span id="line-2589"></span><span>            </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">nms_preimps :: PreprocessedImports
</span><a href="GHC.Driver.Make.html#nms_preimps"><span class="hs-identifier hs-var">nms_preimps</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PreprocessedImports
</span><a href="#local-6989586621681202883"><span class="hs-identifier hs-var">preimps</span></a></span><span>
</span><span id="line-2590"></span><span>            </span><span class="hs-special">}</span><span>
</span><span id="line-2591"></span><span>
</span><span id="line-2592"></span><span class="hs-comment">-- | Convenience named arguments for 'makeNewModSummary' only used to make</span><span>
</span><span id="line-2593"></span><span class="hs-comment">-- code more readable, not exported.</span><span>
</span><span id="line-2594"></span><span class="hs-keyword">data</span><span> </span><span id="MakeNewModSummary"><span class="annot"><a href="GHC.Driver.Make.html#MakeNewModSummary"><span class="hs-identifier hs-var">MakeNewModSummary</span></a></span></span><span>
</span><span id="line-2595"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="MakeNewModSummary"><span class="annot"><a href="GHC.Driver.Make.html#MakeNewModSummary"><span class="hs-identifier hs-var">MakeNewModSummary</span></a></span></span><span>
</span><span id="line-2596"></span><span>      </span><span class="hs-special">{</span><span> </span><span id="nms_src_fn"><span class="annot"><span class="annottext">MakeNewModSummary -&gt; FilePath
</span><a href="GHC.Driver.Make.html#nms_src_fn"><span class="hs-identifier hs-var hs-var">nms_src_fn</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>
</span><span id="line-2597"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="nms_src_timestamp"><span class="annot"><span class="annottext">MakeNewModSummary -&gt; UTCTime
</span><a href="GHC.Driver.Make.html#nms_src_timestamp"><span class="hs-identifier hs-var hs-var">nms_src_timestamp</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../time/src/Data.Time.Clock.Internal.UTCTime.html#UTCTime"><span class="hs-identifier hs-type">UTCTime</span></a></span><span>
</span><span id="line-2598"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="nms_is_boot"><span class="annot"><span class="annottext">MakeNewModSummary -&gt; IsBootInterface
</span><a href="GHC.Driver.Make.html#nms_is_boot"><span class="hs-identifier hs-var hs-var">nms_is_boot</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#IsBootInterface"><span class="hs-identifier hs-type">IsBootInterface</span></a></span><span>
</span><span id="line-2599"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="nms_hsc_src"><span class="annot"><span class="annottext">MakeNewModSummary -&gt; HscSource
</span><a href="GHC.Driver.Make.html#nms_hsc_src"><span class="hs-identifier hs-var hs-var">nms_hsc_src</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Phases.html#HscSource"><span class="hs-identifier hs-type">HscSource</span></a></span><span>
</span><span id="line-2600"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="nms_location"><span class="annot"><span class="annottext">MakeNewModSummary -&gt; ModLocation
</span><a href="GHC.Driver.Make.html#nms_location"><span class="hs-identifier hs-var hs-var">nms_location</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Location.html#ModLocation"><span class="hs-identifier hs-type">ModLocation</span></a></span><span>
</span><span id="line-2601"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="nms_mod"><span class="annot"><span class="annottext">MakeNewModSummary -&gt; Module
</span><a href="GHC.Driver.Make.html#nms_mod"><span class="hs-identifier hs-var hs-var">nms_mod</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#Module"><span class="hs-identifier hs-type">Module</span></a></span><span>
</span><span id="line-2602"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="nms_obj_allowed"><span class="annot"><span class="annottext">MakeNewModSummary -&gt; Bool
</span><a href="GHC.Driver.Make.html#nms_obj_allowed"><span class="hs-identifier hs-var hs-var">nms_obj_allowed</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span><span>
</span><span id="line-2603"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="nms_preimps"><span class="annot"><span class="annottext">MakeNewModSummary -&gt; PreprocessedImports
</span><a href="GHC.Driver.Make.html#nms_preimps"><span class="hs-identifier hs-var hs-var">nms_preimps</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#PreprocessedImports"><span class="hs-identifier hs-type">PreprocessedImports</span></a></span><span>
</span><span id="line-2604"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-2605"></span><span>
</span><span id="line-2606"></span><span class="annot"><a href="GHC.Driver.Make.html#makeNewModSummary"><span class="hs-identifier hs-type">makeNewModSummary</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#MakeNewModSummary"><span class="hs-identifier hs-type">MakeNewModSummary</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span>
</span><span id="line-2607"></span><span id="makeNewModSummary"><span class="annot"><span class="annottext">makeNewModSummary :: HscEnv -&gt; MakeNewModSummary -&gt; IO ModSummary
</span><a href="GHC.Driver.Make.html#makeNewModSummary"><span class="hs-identifier hs-var hs-var">makeNewModSummary</span></a></span></span><span> </span><span id="local-6989586621681202864"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681202864"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#MakeNewModSummary"><span class="hs-identifier hs-type">MakeNewModSummary</span></a></span><span class="hs-special">{</span><span id="local-6989586621681202856"><span id="local-6989586621681202857"><span id="local-6989586621681202858"><span id="local-6989586621681202859"><span id="local-6989586621681202860"><span id="local-6989586621681202861"><span id="local-6989586621681202862"><span id="local-6989586621681202863"><span class="annot"><span class="annottext">Bool
FilePath
UTCTime
Module
IsBootInterface
ModLocation
HscSource
PreprocessedImports
nms_preimps :: PreprocessedImports
nms_obj_allowed :: Bool
nms_mod :: Module
nms_location :: ModLocation
nms_hsc_src :: HscSource
nms_is_boot :: IsBootInterface
nms_src_timestamp :: UTCTime
nms_src_fn :: FilePath
nms_preimps :: MakeNewModSummary -&gt; PreprocessedImports
nms_obj_allowed :: MakeNewModSummary -&gt; Bool
nms_mod :: MakeNewModSummary -&gt; Module
nms_location :: MakeNewModSummary -&gt; ModLocation
nms_hsc_src :: MakeNewModSummary -&gt; HscSource
nms_is_boot :: MakeNewModSummary -&gt; IsBootInterface
nms_src_timestamp :: MakeNewModSummary -&gt; UTCTime
nms_src_fn :: MakeNewModSummary -&gt; FilePath
</span><a href="#local-6989586621681202856"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2608"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#PreprocessedImports"><span class="hs-identifier hs-type">PreprocessedImports</span></a></span><span class="hs-special">{</span><span id="local-6989586621681202849"><span id="local-6989586621681202850"><span id="local-6989586621681202851"><span id="local-6989586621681202852"><span id="local-6989586621681202853"><span id="local-6989586621681202854"><span id="local-6989586621681202855"><span class="annot"><span class="annottext">FilePath
[(Maybe FastString, GenLocated SrcSpan ModuleName)]
ModuleName
DynFlags
InputFileBuffer
SrcSpan
pi_mod_name :: ModuleName
pi_mod_name_loc :: SrcSpan
pi_hspp_buf :: InputFileBuffer
pi_hspp_fn :: FilePath
pi_theimps :: [(Maybe FastString, GenLocated SrcSpan ModuleName)]
pi_srcimps :: [(Maybe FastString, GenLocated SrcSpan ModuleName)]
pi_local_dflags :: DynFlags
pi_mod_name :: PreprocessedImports -&gt; ModuleName
pi_mod_name_loc :: PreprocessedImports -&gt; SrcSpan
pi_hspp_buf :: PreprocessedImports -&gt; InputFileBuffer
pi_hspp_fn :: PreprocessedImports -&gt; FilePath
pi_theimps :: PreprocessedImports
-&gt; [(Maybe FastString, GenLocated SrcSpan ModuleName)]
pi_srcimps :: PreprocessedImports
-&gt; [(Maybe FastString, GenLocated SrcSpan ModuleName)]
pi_local_dflags :: PreprocessedImports -&gt; DynFlags
</span><a href="#local-6989586621681202849"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span></span></span></span></span></span></span></span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PreprocessedImports
</span><a href="#local-6989586621681202856"><span class="hs-identifier hs-var">nms_preimps</span></a></span><span>
</span><span id="line-2609"></span><span>  </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681202848"><span class="annot"><span class="annottext">dflags :: DynFlags
</span><a href="#local-6989586621681202848"><span class="hs-identifier hs-var hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681202864"><span class="hs-identifier hs-var">hsc_env</span></a></span><span>
</span><span id="line-2610"></span><span>
</span><span id="line-2611"></span><span>  </span><span class="hs-comment">-- when the user asks to load a source file by name, we only</span><span>
</span><span id="line-2612"></span><span>  </span><span class="hs-comment">-- use an object file if -fobject-code is on.  See #1205.</span><span>
</span><span id="line-2613"></span><span>  </span><span id="local-6989586621681202847"><span class="annot"><span class="annottext">Maybe UTCTime
</span><a href="#local-6989586621681202847"><span class="hs-identifier hs-var">obj_timestamp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Maybe UTCTime) -&gt; IO (Maybe UTCTime)
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (Maybe UTCTime) -&gt; IO (Maybe UTCTime))
-&gt; IO (Maybe UTCTime) -&gt; IO (Maybe UTCTime)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2614"></span><span>      </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">HscTarget -&gt; Bool
</span><a href="GHC.Driver.Session.html#isObjectTarget"><span class="hs-identifier hs-var">isObjectTarget</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; HscTarget
</span><a href="GHC.Driver.Session.html#hscTarget"><span class="hs-identifier hs-var hs-var">hscTarget</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681202848"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2615"></span><span>         </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Bool
</span><a href="#local-6989586621681202857"><span class="hs-identifier hs-var">nms_obj_allowed</span></a></span><span> </span><span class="hs-comment">-- bug #1205</span><span>
</span><span id="line-2616"></span><span>          </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">ModLocation -&gt; IsBootInterface -&gt; IO (Maybe UTCTime)
</span><a href="GHC.Driver.Make.html#getObjTimestamp"><span class="hs-identifier hs-var">getObjTimestamp</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681202859"><span class="hs-identifier hs-var">nms_location</span></a></span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="#local-6989586621681202861"><span class="hs-identifier hs-var">nms_is_boot</span></a></span><span>
</span><span id="line-2617"></span><span>          </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Maybe UTCTime -&gt; IO (Maybe UTCTime)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe UTCTime
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-2618"></span><span>
</span><span id="line-2619"></span><span>  </span><span id="local-6989586621681202846"><span class="annot"><span class="annottext">Maybe UTCTime
</span><a href="#local-6989586621681202846"><span class="hs-identifier hs-var">hi_timestamp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; ModLocation -&gt; IO (Maybe UTCTime)
</span><a href="GHC.Driver.Make.html#maybeGetIfaceDate"><span class="hs-identifier hs-var">maybeGetIfaceDate</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681202848"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681202859"><span class="hs-identifier hs-var">nms_location</span></a></span><span>
</span><span id="line-2620"></span><span>  </span><span id="local-6989586621681202845"><span class="annot"><span class="annottext">Maybe UTCTime
</span><a href="#local-6989586621681202845"><span class="hs-identifier hs-var">hie_timestamp</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO (Maybe UTCTime)
</span><a href="GHC.Utils.Misc.html#modificationTimeIfExists"><span class="hs-identifier hs-var">modificationTimeIfExists</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModLocation -&gt; FilePath
</span><a href="GHC.Unit.Module.Location.html#ml_hie_file"><span class="hs-identifier hs-var hs-var">ml_hie_file</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681202859"><span class="hs-identifier hs-var">nms_location</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2621"></span><span>
</span><span id="line-2622"></span><span>  </span><span id="local-6989586621681202844"><span class="annot"><span class="annottext">[(Maybe FastString, GenLocated SrcSpan ModuleName)]
</span><a href="#local-6989586621681202844"><span class="hs-identifier hs-var">extra_sig_imports</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; HscSource
-&gt; ModuleName
-&gt; IO [(Maybe FastString, GenLocated SrcSpan ModuleName)]
</span><a href="GHC.Tc.Utils.Backpack.html#findExtraSigImports"><span class="hs-identifier hs-var">findExtraSigImports</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681202864"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621681202860"><span class="hs-identifier hs-var">nms_hsc_src</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681202849"><span class="hs-identifier hs-var">pi_mod_name</span></a></span><span>
</span><span id="line-2623"></span><span>  </span><span id="local-6989586621681202843"><span class="annot"><span class="annottext">[(Maybe FastString, GenLocated SrcSpan ModuleName)]
</span><a href="#local-6989586621681202843"><span class="hs-identifier hs-var">required_by_imports</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; [(Maybe FastString, GenLocated SrcSpan ModuleName)]
-&gt; IO [(Maybe FastString, GenLocated SrcSpan ModuleName)]
</span><a href="GHC.Tc.Utils.Backpack.html#implicitRequirements"><span class="hs-identifier hs-var">implicitRequirements</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681202864"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">[(Maybe FastString, GenLocated SrcSpan ModuleName)]
</span><a href="#local-6989586621681202853"><span class="hs-identifier hs-var">pi_theimps</span></a></span><span>
</span><span id="line-2624"></span><span>
</span><span id="line-2625"></span><span>  </span><span class="annot"><span class="annottext">ModSummary -&gt; IO ModSummary
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">(ModSummary -&gt; IO ModSummary) -&gt; ModSummary -&gt; IO ModSummary
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary :: Module
-&gt; HscSource
-&gt; ModLocation
-&gt; UTCTime
-&gt; Maybe UTCTime
-&gt; Maybe UTCTime
-&gt; Maybe UTCTime
-&gt; [(Maybe FastString, GenLocated SrcSpan ModuleName)]
-&gt; [(Maybe FastString, GenLocated SrcSpan ModuleName)]
-&gt; Maybe HsParsedModule
-&gt; FilePath
-&gt; DynFlags
-&gt; Maybe InputFileBuffer
-&gt; ModSummary
</span><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span>
</span><span id="line-2626"></span><span>      </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">ms_mod :: Module
</span><a href="GHC.Driver.Types.html#ms_mod"><span class="hs-identifier hs-var">ms_mod</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681202858"><span class="hs-identifier hs-var">nms_mod</span></a></span><span>
</span><span id="line-2627"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ms_hsc_src :: HscSource
</span><a href="GHC.Driver.Types.html#ms_hsc_src"><span class="hs-identifier hs-var">ms_hsc_src</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">HscSource
</span><a href="#local-6989586621681202860"><span class="hs-identifier hs-var">nms_hsc_src</span></a></span><span>
</span><span id="line-2628"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ms_location :: ModLocation
</span><a href="GHC.Driver.Types.html#ms_location"><span class="hs-identifier hs-var">ms_location</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681202859"><span class="hs-identifier hs-var">nms_location</span></a></span><span>
</span><span id="line-2629"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ms_hspp_file :: FilePath
</span><a href="GHC.Driver.Types.html#ms_hspp_file"><span class="hs-identifier hs-var">ms_hspp_file</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681202852"><span class="hs-identifier hs-var">pi_hspp_fn</span></a></span><span>
</span><span id="line-2630"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ms_hspp_opts :: DynFlags
</span><a href="GHC.Driver.Types.html#ms_hspp_opts"><span class="hs-identifier hs-var">ms_hspp_opts</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681202855"><span class="hs-identifier hs-var">pi_local_dflags</span></a></span><span>
</span><span id="line-2631"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ms_hspp_buf :: Maybe InputFileBuffer
</span><a href="GHC.Driver.Types.html#ms_hspp_buf"><span class="hs-identifier hs-var">ms_hspp_buf</span></a></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">InputFileBuffer -&gt; Maybe InputFileBuffer
forall a. a -&gt; Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-var">Just</span></a></span><span> </span><span class="annot"><span class="annottext">InputFileBuffer
</span><a href="#local-6989586621681202851"><span class="hs-identifier hs-var">pi_hspp_buf</span></a></span><span>
</span><span id="line-2632"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ms_parsed_mod :: Maybe HsParsedModule
</span><a href="GHC.Driver.Types.html#ms_parsed_mod"><span class="hs-identifier hs-var">ms_parsed_mod</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe HsParsedModule
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-2633"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ms_srcimps :: [(Maybe FastString, GenLocated SrcSpan ModuleName)]
</span><a href="GHC.Driver.Types.html#ms_srcimps"><span class="hs-identifier hs-var">ms_srcimps</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[(Maybe FastString, GenLocated SrcSpan ModuleName)]
</span><a href="#local-6989586621681202854"><span class="hs-identifier hs-var">pi_srcimps</span></a></span><span>
</span><span id="line-2634"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ms_textual_imps :: [(Maybe FastString, GenLocated SrcSpan ModuleName)]
</span><a href="GHC.Driver.Types.html#ms_textual_imps"><span class="hs-identifier hs-var">ms_textual_imps</span></a></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2635"></span><span>          </span><span class="annot"><span class="annottext">[(Maybe FastString, GenLocated SrcSpan ModuleName)]
</span><a href="#local-6989586621681202853"><span class="hs-identifier hs-var">pi_theimps</span></a></span><span> </span><span class="annot"><span class="annottext">[(Maybe FastString, GenLocated SrcSpan ModuleName)]
-&gt; [(Maybe FastString, GenLocated SrcSpan ModuleName)]
-&gt; [(Maybe FastString, GenLocated SrcSpan ModuleName)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[(Maybe FastString, GenLocated SrcSpan ModuleName)]
</span><a href="#local-6989586621681202844"><span class="hs-identifier hs-var">extra_sig_imports</span></a></span><span> </span><span class="annot"><span class="annottext">[(Maybe FastString, GenLocated SrcSpan ModuleName)]
-&gt; [(Maybe FastString, GenLocated SrcSpan ModuleName)]
-&gt; [(Maybe FastString, GenLocated SrcSpan ModuleName)]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span> </span><span class="annot"><span class="annottext">[(Maybe FastString, GenLocated SrcSpan ModuleName)]
</span><a href="#local-6989586621681202843"><span class="hs-identifier hs-var">required_by_imports</span></a></span><span>
</span><span id="line-2636"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ms_hs_date :: UTCTime
</span><a href="GHC.Driver.Types.html#ms_hs_date"><span class="hs-identifier hs-var">ms_hs_date</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">UTCTime
</span><a href="#local-6989586621681202862"><span class="hs-identifier hs-var">nms_src_timestamp</span></a></span><span>
</span><span id="line-2637"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ms_iface_date :: Maybe UTCTime
</span><a href="GHC.Driver.Types.html#ms_iface_date"><span class="hs-identifier hs-var">ms_iface_date</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe UTCTime
</span><a href="#local-6989586621681202846"><span class="hs-identifier hs-var">hi_timestamp</span></a></span><span>
</span><span id="line-2638"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ms_hie_date :: Maybe UTCTime
</span><a href="GHC.Driver.Types.html#ms_hie_date"><span class="hs-identifier hs-var">ms_hie_date</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe UTCTime
</span><a href="#local-6989586621681202845"><span class="hs-identifier hs-var">hie_timestamp</span></a></span><span>
</span><span id="line-2639"></span><span>      </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">ms_obj_date :: Maybe UTCTime
</span><a href="GHC.Driver.Types.html#ms_obj_date"><span class="hs-identifier hs-var">ms_obj_date</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Maybe UTCTime
</span><a href="#local-6989586621681202847"><span class="hs-identifier hs-var">obj_timestamp</span></a></span><span>
</span><span id="line-2640"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-2641"></span><span>
</span><span id="line-2642"></span><span class="annot"><a href="GHC.Driver.Make.html#getObjTimestamp"><span class="hs-identifier hs-type">getObjTimestamp</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Location.html#ModLocation"><span class="hs-identifier hs-type">ModLocation</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Types.html#IsBootInterface"><span class="hs-identifier hs-type">IsBootInterface</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="../../time/src/Data.Time.Clock.Internal.UTCTime.html#UTCTime"><span class="hs-identifier hs-type">UTCTime</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2643"></span><span id="getObjTimestamp"><span class="annot"><span class="annottext">getObjTimestamp :: ModLocation -&gt; IsBootInterface -&gt; IO (Maybe UTCTime)
</span><a href="GHC.Driver.Make.html#getObjTimestamp"><span class="hs-identifier hs-var hs-var">getObjTimestamp</span></a></span></span><span> </span><span id="local-6989586621681202838"><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681202838"><span class="hs-identifier hs-var">location</span></a></span></span><span> </span><span id="local-6989586621681202837"><span class="annot"><span class="annottext">IsBootInterface
</span><a href="#local-6989586621681202837"><span class="hs-identifier hs-var">is_boot</span></a></span></span><span>
</span><span id="line-2644"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="#local-6989586621681202837"><span class="hs-identifier hs-var">is_boot</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2645"></span><span>      </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="GHC.Unit.Types.html#IsBoot"><span class="hs-identifier hs-var">IsBoot</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe UTCTime -&gt; IO (Maybe UTCTime)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe UTCTime
forall a. Maybe a
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>
</span><span id="line-2646"></span><span>      </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="GHC.Unit.Types.html#NotBoot"><span class="hs-identifier hs-var">NotBoot</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO (Maybe UTCTime)
</span><a href="GHC.Utils.Misc.html#modificationTimeIfExists"><span class="hs-identifier hs-var">modificationTimeIfExists</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModLocation -&gt; FilePath
</span><a href="GHC.Unit.Module.Location.html#ml_obj_file"><span class="hs-identifier hs-var hs-var">ml_obj_file</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation
</span><a href="#local-6989586621681202838"><span class="hs-identifier hs-var">location</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2647"></span><span>
</span><span id="line-2648"></span><span class="hs-keyword">data</span><span> </span><span id="PreprocessedImports"><span class="annot"><a href="GHC.Driver.Make.html#PreprocessedImports"><span class="hs-identifier hs-var">PreprocessedImports</span></a></span></span><span>
</span><span id="line-2649"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span id="PreprocessedImports"><span class="annot"><a href="GHC.Driver.Make.html#PreprocessedImports"><span class="hs-identifier hs-var">PreprocessedImports</span></a></span></span><span>
</span><span id="line-2650"></span><span>      </span><span class="hs-special">{</span><span> </span><span id="pi_local_dflags"><span class="annot"><span class="annottext">PreprocessedImports -&gt; DynFlags
</span><a href="GHC.Driver.Make.html#pi_local_dflags"><span class="hs-identifier hs-var hs-var">pi_local_dflags</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span>
</span><span id="line-2651"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="pi_srcimps"><span class="annot"><span class="annottext">PreprocessedImports
-&gt; [(Maybe FastString, GenLocated SrcSpan ModuleName)]
</span><a href="GHC.Driver.Make.html#pi_srcimps"><span class="hs-identifier hs-var hs-var">pi_srcimps</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-2652"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="pi_theimps"><span class="annot"><span class="annottext">PreprocessedImports
-&gt; [(Maybe FastString, GenLocated SrcSpan ModuleName)]
</span><a href="GHC.Driver.Make.html#pi_theimps"><span class="hs-identifier hs-var hs-var">pi_theimps</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Data.FastString.html#FastString"><span class="hs-identifier hs-type">FastString</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#Located"><span class="hs-identifier hs-type">Located</span></a></span><span> </span><span class="annot"><a href="GHC.Unit.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><span id="line-2653"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="pi_hspp_fn"><span class="annot"><span class="annottext">PreprocessedImports -&gt; FilePath
</span><a href="GHC.Driver.Make.html#pi_hspp_fn"><span class="hs-identifier hs-var hs-var">pi_hspp_fn</span></a></span></span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="../../base/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>
</span><span id="line-2654"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="pi_hspp_buf"><span class="annot"><span class="annottext">PreprocessedImports -&gt; InputFileBuffer
</span><a href="GHC.Driver.Make.html#pi_hspp_buf"><span class="hs-identifier hs-var hs-var">pi_hspp_buf</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Data.StringBuffer.html#StringBuffer"><span class="hs-identifier hs-type">StringBuffer</span></a></span><span>
</span><span id="line-2655"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="pi_mod_name_loc"><span class="annot"><span class="annottext">PreprocessedImports -&gt; SrcSpan
</span><a href="GHC.Driver.Make.html#pi_mod_name_loc"><span class="hs-identifier hs-var hs-var">pi_mod_name_loc</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span>
</span><span id="line-2656"></span><span>      </span><span class="hs-special">,</span><span> </span><span id="pi_mod_name"><span class="annot"><span class="annottext">PreprocessedImports -&gt; ModuleName
</span><a href="GHC.Driver.Make.html#pi_mod_name"><span class="hs-identifier hs-var hs-var">pi_mod_name</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span>
</span><span id="line-2657"></span><span>      </span><span class="hs-special">}</span><span>
</span><span id="line-2658"></span><span>
</span><span id="line-2659"></span><span class="hs-comment">-- Preprocess the source file and get its imports</span><span>
</span><span id="line-2660"></span><span class="hs-comment">-- The pi_local_dflags contains the OPTIONS pragmas</span><span>
</span><span id="line-2661"></span><span class="annot"><a href="GHC.Driver.Make.html#getPreprocessedImports"><span class="hs-identifier hs-type">getPreprocessedImports</span></a></span><span>
</span><span id="line-2662"></span><span>    </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#HscEnv"><span class="hs-identifier hs-type">HscEnv</span></a></span><span>
</span><span id="line-2663"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.IO.html#FilePath"><span class="hs-identifier hs-type">FilePath</span></a></span><span>
</span><span id="line-2664"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Phases.html#Phase"><span class="hs-identifier hs-type">Phase</span></a></span><span>
</span><span id="line-2665"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Maybe"><span class="hs-identifier hs-type">Maybe</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="GHC.Data.StringBuffer.html#StringBuffer"><span class="hs-identifier hs-type">StringBuffer</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="../../time/src/Data.Time.Clock.Internal.UTCTime.html#UTCTime"><span class="hs-identifier hs-type">UTCTime</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2666"></span><span>    </span><span class="hs-comment">-- ^ optional source code buffer and modification time</span><span>
</span><span id="line-2667"></span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../transformers/src/Control.Monad.Trans.Except.html#ExceptT"><span class="hs-identifier hs-type">ExceptT</span></a></span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#ErrorMessages"><span class="hs-identifier hs-type">ErrorMessages</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#PreprocessedImports"><span class="hs-identifier hs-type">PreprocessedImports</span></a></span><span>
</span><span id="line-2668"></span><span id="getPreprocessedImports"><span class="annot"><span class="annottext">getPreprocessedImports :: HscEnv
-&gt; FilePath
-&gt; Maybe Phase
-&gt; Maybe (InputFileBuffer, UTCTime)
-&gt; ExceptT ErrorMessages IO PreprocessedImports
</span><a href="GHC.Driver.Make.html#getPreprocessedImports"><span class="hs-identifier hs-var hs-var">getPreprocessedImports</span></a></span></span><span> </span><span id="local-6989586621681202836"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681202836"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span id="local-6989586621681202835"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681202835"><span class="hs-identifier hs-var">src_fn</span></a></span></span><span> </span><span id="local-6989586621681202834"><span class="annot"><span class="annottext">Maybe Phase
</span><a href="#local-6989586621681202834"><span class="hs-identifier hs-var">mb_phase</span></a></span></span><span> </span><span id="local-6989586621681202833"><span class="annot"><span class="annottext">Maybe (InputFileBuffer, UTCTime)
</span><a href="#local-6989586621681202833"><span class="hs-identifier hs-var">maybe_buf</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2669"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621681202832"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681202832"><span class="hs-identifier hs-var">pi_local_dflags</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681202831"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681202831"><span class="hs-identifier hs-var">pi_hspp_fn</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2670"></span><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (Either ErrorMessages (DynFlags, FilePath))
-&gt; ExceptT ErrorMessages IO (DynFlags, FilePath)
forall e (m :: * -&gt; *) a. m (Either e a) -&gt; ExceptT e m a
</span><a href="../../transformers/src/Control.Monad.Trans.Except.html#ExceptT"><span class="hs-identifier hs-var">ExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (Either ErrorMessages (DynFlags, FilePath))
 -&gt; ExceptT ErrorMessages IO (DynFlags, FilePath))
-&gt; IO (Either ErrorMessages (DynFlags, FilePath))
-&gt; ExceptT ErrorMessages IO (DynFlags, FilePath)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
-&gt; FilePath
-&gt; Maybe InputFileBuffer
-&gt; Maybe Phase
-&gt; IO (Either ErrorMessages (DynFlags, FilePath))
</span><a href="GHC.Driver.Pipeline.html#preprocess"><span class="hs-identifier hs-var">preprocess</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681202836"><span class="hs-identifier hs-var">hsc_env</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681202835"><span class="hs-identifier hs-var">src_fn</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(InputFileBuffer, UTCTime) -&gt; InputFileBuffer
forall a b. (a, b) -&gt; a
</span><a href="../../base/src/Data.Tuple.html#fst"><span class="hs-identifier hs-var">fst</span></a></span><span> </span><span class="annot"><span class="annottext">((InputFileBuffer, UTCTime) -&gt; InputFileBuffer)
-&gt; Maybe (InputFileBuffer, UTCTime) -&gt; Maybe InputFileBuffer
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><a href="../../base/src/Data.Functor.html#%3C%24%3E"><span class="hs-operator hs-var">&lt;$&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (InputFileBuffer, UTCTime)
</span><a href="#local-6989586621681202833"><span class="hs-identifier hs-var">maybe_buf</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Maybe Phase
</span><a href="#local-6989586621681202834"><span class="hs-identifier hs-var">mb_phase</span></a></span><span>
</span><span id="line-2671"></span><span>  </span><span id="local-6989586621681202828"><span class="annot"><span class="annottext">InputFileBuffer
</span><a href="#local-6989586621681202828"><span class="hs-identifier hs-var">pi_hspp_buf</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO InputFileBuffer -&gt; ExceptT ErrorMessages IO InputFileBuffer
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO InputFileBuffer -&gt; ExceptT ErrorMessages IO InputFileBuffer)
-&gt; IO InputFileBuffer -&gt; ExceptT ErrorMessages IO InputFileBuffer
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO InputFileBuffer
</span><a href="GHC.Data.StringBuffer.html#hGetStringBuffer"><span class="hs-identifier hs-var">hGetStringBuffer</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681202831"><span class="hs-identifier hs-var">pi_hspp_fn</span></a></span><span>
</span><span id="line-2672"></span><span>  </span><span class="hs-special">(</span><span id="local-6989586621681202826"><span class="annot"><span class="annottext">[(Maybe FastString, GenLocated SrcSpan ModuleName)]
</span><a href="#local-6989586621681202826"><span class="hs-identifier hs-var">pi_srcimps</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621681202825"><span class="annot"><span class="annottext">[(Maybe FastString, GenLocated SrcSpan ModuleName)]
</span><a href="#local-6989586621681202825"><span class="hs-identifier hs-var">pi_theimps</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#L"><span class="hs-identifier hs-type">L</span></a></span><span> </span><span id="local-6989586621681202824"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681202824"><span class="hs-identifier hs-var">pi_mod_name_loc</span></a></span></span><span> </span><span id="local-6989586621681202823"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681202823"><span class="hs-identifier hs-var">pi_mod_name</span></a></span></span><span class="hs-special">)</span><span>
</span><span id="line-2673"></span><span>      </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO
  (Either
     ErrorMessages
     ([(Maybe FastString, GenLocated SrcSpan ModuleName)],
      [(Maybe FastString, GenLocated SrcSpan ModuleName)],
      GenLocated SrcSpan ModuleName))
-&gt; ExceptT
     ErrorMessages
     IO
     ([(Maybe FastString, GenLocated SrcSpan ModuleName)],
      [(Maybe FastString, GenLocated SrcSpan ModuleName)],
      GenLocated SrcSpan ModuleName)
forall e (m :: * -&gt; *) a. m (Either e a) -&gt; ExceptT e m a
</span><a href="../../transformers/src/Control.Monad.Trans.Except.html#ExceptT"><span class="hs-identifier hs-var">ExceptT</span></a></span><span> </span><span class="annot"><span class="annottext">(IO
   (Either
      ErrorMessages
      ([(Maybe FastString, GenLocated SrcSpan ModuleName)],
       [(Maybe FastString, GenLocated SrcSpan ModuleName)],
       GenLocated SrcSpan ModuleName))
 -&gt; ExceptT
      ErrorMessages
      IO
      ([(Maybe FastString, GenLocated SrcSpan ModuleName)],
       [(Maybe FastString, GenLocated SrcSpan ModuleName)],
       GenLocated SrcSpan ModuleName))
-&gt; IO
     (Either
        ErrorMessages
        ([(Maybe FastString, GenLocated SrcSpan ModuleName)],
         [(Maybe FastString, GenLocated SrcSpan ModuleName)],
         GenLocated SrcSpan ModuleName))
-&gt; ExceptT
     ErrorMessages
     IO
     ([(Maybe FastString, GenLocated SrcSpan ModuleName)],
      [(Maybe FastString, GenLocated SrcSpan ModuleName)],
      GenLocated SrcSpan ModuleName)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
-&gt; InputFileBuffer
-&gt; FilePath
-&gt; FilePath
-&gt; IO
     (Either
        ErrorMessages
        ([(Maybe FastString, GenLocated SrcSpan ModuleName)],
         [(Maybe FastString, GenLocated SrcSpan ModuleName)],
         GenLocated SrcSpan ModuleName))
</span><a href="GHC.Parser.Header.html#getImports"><span class="hs-identifier hs-var">getImports</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681202832"><span class="hs-identifier hs-var">pi_local_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">InputFileBuffer
</span><a href="#local-6989586621681202828"><span class="hs-identifier hs-var">pi_hspp_buf</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681202831"><span class="hs-identifier hs-var">pi_hspp_fn</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681202835"><span class="hs-identifier hs-var">src_fn</span></a></span><span>
</span><span id="line-2674"></span><span>  </span><span class="annot"><span class="annottext">PreprocessedImports -&gt; ExceptT ErrorMessages IO PreprocessedImports
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><a href="../../base/src/GHC.Base.html#return"><span class="hs-identifier hs-var">return</span></a></span><span> </span><span class="annot"><span class="annottext">PreprocessedImports :: DynFlags
-&gt; [(Maybe FastString, GenLocated SrcSpan ModuleName)]
-&gt; [(Maybe FastString, GenLocated SrcSpan ModuleName)]
-&gt; FilePath
-&gt; InputFileBuffer
-&gt; SrcSpan
-&gt; ModuleName
-&gt; PreprocessedImports
</span><a href="GHC.Driver.Make.html#PreprocessedImports"><span class="hs-identifier hs-type">PreprocessedImports</span></a></span><span> </span><span class="hs-special">{</span><span class="annot"><span class="annottext">FilePath
[(Maybe FastString, GenLocated SrcSpan ModuleName)]
ModuleName
DynFlags
InputFileBuffer
SrcSpan
pi_mod_name :: ModuleName
pi_mod_name_loc :: SrcSpan
pi_theimps :: [(Maybe FastString, GenLocated SrcSpan ModuleName)]
pi_srcimps :: [(Maybe FastString, GenLocated SrcSpan ModuleName)]
pi_hspp_buf :: InputFileBuffer
pi_hspp_fn :: FilePath
pi_local_dflags :: DynFlags
pi_mod_name :: ModuleName
pi_mod_name_loc :: SrcSpan
pi_hspp_buf :: InputFileBuffer
pi_hspp_fn :: FilePath
pi_theimps :: [(Maybe FastString, GenLocated SrcSpan ModuleName)]
pi_srcimps :: [(Maybe FastString, GenLocated SrcSpan ModuleName)]
pi_local_dflags :: DynFlags
</span><a href="#local-6989586621681202823"><span class="hs-glyph hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">..</span></a></span><span class="hs-special">}</span><span>
</span><span id="line-2675"></span><span>
</span><span id="line-2676"></span><span>
</span><span id="line-2677"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-2678"></span><span class="hs-comment">--                      Error messages</span><span>
</span><span id="line-2679"></span><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><span id="line-2680"></span><span>
</span><span id="line-2681"></span><span class="hs-comment">-- Defer and group warning, error and fatal messages so they will not get lost</span><span>
</span><span id="line-2682"></span><span class="hs-comment">-- in the regular output.</span><span>
</span><span id="line-2683"></span><span id="local-6989586621681205187"><span id="local-6989586621681205188"><span class="annot"><a href="GHC.Driver.Make.html#withDeferredDiagnostics"><span class="hs-identifier hs-type">withDeferredDiagnostics</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Monad.html#GhcMonad"><span class="hs-identifier hs-type">GhcMonad</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681205188"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681205188"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681205187"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621681205188"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621681205187"><span class="hs-identifier hs-type">a</span></a></span></span></span><span>
</span><span id="line-2684"></span><span id="withDeferredDiagnostics"><span class="annot"><span class="annottext">withDeferredDiagnostics :: forall (m :: * -&gt; *) a. GhcMonad m =&gt; m a -&gt; m a
</span><a href="GHC.Driver.Make.html#withDeferredDiagnostics"><span class="hs-identifier hs-var hs-var">withDeferredDiagnostics</span></a></span></span><span> </span><span id="local-6989586621681202801"><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621681202801"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2685"></span><span>  </span><span id="local-6989586621681202800"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681202800"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m DynFlags
forall (m :: * -&gt; *). HasDynFlags m =&gt; m DynFlags
</span><a href="GHC.Driver.Session.html#getDynFlags"><span class="hs-identifier hs-var">getDynFlags</span></a></span><span>
</span><span id="line-2686"></span><span>  </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool
</span><span class="hs-identifier hs-var">not</span></span><span> </span><span class="annot"><span class="annottext">(Bool -&gt; Bool) -&gt; Bool -&gt; Bool
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag -&gt; DynFlags -&gt; Bool
</span><a href="GHC.Driver.Session.html#gopt"><span class="hs-identifier hs-var">gopt</span></a></span><span> </span><span class="annot"><span class="annottext">GeneralFlag
</span><a href="GHC.Driver.Flags.html#Opt_DeferDiagnostics"><span class="hs-identifier hs-var">Opt_DeferDiagnostics</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681202800"><span class="hs-identifier hs-var">dflags</span></a></span><span>
</span><span id="line-2687"></span><span>  </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621681202801"><span class="hs-identifier hs-var">f</span></a></span><span>
</span><span id="line-2688"></span><span>  </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2689"></span><span>    </span><span id="local-6989586621681202798"><span class="annot"><span class="annottext">IORef [IO ()]
</span><a href="#local-6989586621681202798"><span class="hs-identifier hs-var">warnings</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (IORef [IO ()]) -&gt; m (IORef [IO ()])
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (IORef [IO ()]) -&gt; m (IORef [IO ()]))
-&gt; IO (IORef [IO ()]) -&gt; m (IORef [IO ()])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[IO ()] -&gt; IO (IORef [IO ()])
forall a. a -&gt; IO (IORef a)
</span><a href="../../base/src/GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2690"></span><span>    </span><span id="local-6989586621681202797"><span class="annot"><span class="annottext">IORef [IO ()]
</span><a href="#local-6989586621681202797"><span class="hs-identifier hs-var">errors</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (IORef [IO ()]) -&gt; m (IORef [IO ()])
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (IORef [IO ()]) -&gt; m (IORef [IO ()]))
-&gt; IO (IORef [IO ()]) -&gt; m (IORef [IO ()])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[IO ()] -&gt; IO (IORef [IO ()])
forall a. a -&gt; IO (IORef a)
</span><a href="../../base/src/GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2691"></span><span>    </span><span id="local-6989586621681202796"><span class="annot"><span class="annottext">IORef [IO ()]
</span><a href="#local-6989586621681202796"><span class="hs-identifier hs-var">fatals</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IO (IORef [IO ()]) -&gt; m (IORef [IO ()])
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO (IORef [IO ()]) -&gt; m (IORef [IO ()]))
-&gt; IO (IORef [IO ()]) -&gt; m (IORef [IO ()])
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[IO ()] -&gt; IO (IORef [IO ()])
forall a. a -&gt; IO (IORef a)
</span><a href="../../base/src/GHC.IORef.html#newIORef"><span class="hs-identifier hs-var">newIORef</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><span id="line-2692"></span><span>
</span><span id="line-2693"></span><span>    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681202795"><span class="annot"><span class="annottext">deferDiagnostics :: p -&gt; WarnReason -&gt; Severity -&gt; SrcSpan -&gt; SDoc -&gt; IO ()
</span><a href="#local-6989586621681202795"><span class="hs-identifier hs-var hs-var">deferDiagnostics</span></a></span></span><span> </span><span id="local-6989586621681202794"><span class="annot"><span class="annottext">p
</span><a href="#local-6989586621681202794"><span class="hs-identifier hs-var">_dflags</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681202793"><span class="annot"><span class="annottext">WarnReason
</span><a href="#local-6989586621681202793"><span class="hs-identifier hs-var">reason</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681202792"><span class="annot"><span class="annottext">Severity
</span><a href="#local-6989586621681202792"><span class="hs-identifier hs-var">severity</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681202791"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681202791"><span class="hs-identifier hs-var">srcSpan</span></a></span></span><span> </span><span class="hs-glyph">!</span><span id="local-6989586621681202790"><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681202790"><span class="hs-identifier hs-var">msg</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2694"></span><span>          </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621681202789"><span class="annot"><span class="annottext">action :: IO ()
</span><a href="#local-6989586621681202789"><span class="hs-identifier hs-var hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LogAction
</span><a href="GHC.Driver.Session.html#putLogMsg"><span class="hs-identifier hs-var">putLogMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681202800"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">WarnReason
</span><a href="#local-6989586621681202793"><span class="hs-identifier hs-var">reason</span></a></span><span> </span><span class="annot"><span class="annottext">Severity
</span><a href="#local-6989586621681202792"><span class="hs-identifier hs-var">severity</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681202791"><span class="hs-identifier hs-var">srcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc
</span><a href="#local-6989586621681202790"><span class="hs-identifier hs-var">msg</span></a></span><span>
</span><span id="line-2695"></span><span>          </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Severity
</span><a href="#local-6989586621681202792"><span class="hs-identifier hs-var">severity</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2696"></span><span>            </span><span class="annot"><span class="annottext">Severity
</span><a href="GHC.Utils.Error.html#SevWarning"><span class="hs-identifier hs-var">SevWarning</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IORef [IO ()] -&gt; ([IO ()] -&gt; ([IO ()], ())) -&gt; IO ()
forall a b. IORef a -&gt; (a -&gt; (a, b)) -&gt; IO b
</span><a href="../../base/src/GHC.IORef.html#atomicModifyIORef%27"><span class="hs-identifier hs-var">atomicModifyIORef'</span></a></span><span> </span><span class="annot"><span class="annottext">IORef [IO ()]
</span><a href="#local-6989586621681202798"><span class="hs-identifier hs-var">warnings</span></a></span><span> </span><span class="annot"><span class="annottext">(([IO ()] -&gt; ([IO ()], ())) -&gt; IO ())
-&gt; ([IO ()] -&gt; ([IO ()], ())) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681202787"><span class="annot"><span class="annottext">[IO ()]
</span><a href="#local-6989586621681202787"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621681202789"><span class="hs-identifier hs-var">action</span></a></span><span class="annot"><span class="annottext">IO () -&gt; [IO ()] -&gt; [IO ()]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[IO ()]
</span><a href="#local-6989586621681202787"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2697"></span><span>            </span><span class="annot"><span class="annottext">Severity
</span><a href="GHC.Utils.Error.html#SevError"><span class="hs-identifier hs-var">SevError</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IORef [IO ()] -&gt; ([IO ()] -&gt; ([IO ()], ())) -&gt; IO ()
forall a b. IORef a -&gt; (a -&gt; (a, b)) -&gt; IO b
</span><a href="../../base/src/GHC.IORef.html#atomicModifyIORef%27"><span class="hs-identifier hs-var">atomicModifyIORef'</span></a></span><span> </span><span class="annot"><span class="annottext">IORef [IO ()]
</span><a href="#local-6989586621681202797"><span class="hs-identifier hs-var">errors</span></a></span><span> </span><span class="annot"><span class="annottext">(([IO ()] -&gt; ([IO ()], ())) -&gt; IO ())
-&gt; ([IO ()] -&gt; ([IO ()], ())) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681202785"><span class="annot"><span class="annottext">[IO ()]
</span><a href="#local-6989586621681202785"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621681202789"><span class="hs-identifier hs-var">action</span></a></span><span class="annot"><span class="annottext">IO () -&gt; [IO ()] -&gt; [IO ()]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[IO ()]
</span><a href="#local-6989586621681202785"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2698"></span><span>            </span><span class="annot"><span class="annottext">Severity
</span><a href="GHC.Utils.Error.html#SevFatal"><span class="hs-identifier hs-var">SevFatal</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IORef [IO ()] -&gt; ([IO ()] -&gt; ([IO ()], ())) -&gt; IO ()
forall a b. IORef a -&gt; (a -&gt; (a, b)) -&gt; IO b
</span><a href="../../base/src/GHC.IORef.html#atomicModifyIORef%27"><span class="hs-identifier hs-var">atomicModifyIORef'</span></a></span><span> </span><span class="annot"><span class="annottext">IORef [IO ()]
</span><a href="#local-6989586621681202796"><span class="hs-identifier hs-var">fatals</span></a></span><span> </span><span class="annot"><span class="annottext">(([IO ()] -&gt; ([IO ()], ())) -&gt; IO ())
-&gt; ([IO ()] -&gt; ([IO ()], ())) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681202783"><span class="annot"><span class="annottext">[IO ()]
</span><a href="#local-6989586621681202783"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621681202789"><span class="hs-identifier hs-var">action</span></a></span><span class="annot"><span class="annottext">IO () -&gt; [IO ()] -&gt; [IO ()]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[IO ()]
</span><a href="#local-6989586621681202783"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2699"></span><span>            </span><span class="annot"><span class="annottext">Severity
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO ()
</span><a href="#local-6989586621681202789"><span class="hs-identifier hs-var">action</span></a></span><span>
</span><span id="line-2700"></span><span>
</span><span id="line-2701"></span><span>        </span><span id="local-6989586621681202776"><span class="annot"><span class="annottext">printDeferredDiagnostics :: m ()
</span><a href="#local-6989586621681202776"><span class="hs-identifier hs-var hs-var">printDeferredDiagnostics</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IO () -&gt; m ()
forall (m :: * -&gt; *) a. MonadIO m =&gt; IO a -&gt; m a
</span><a href="../../base/src/Control.Monad.IO.Class.html#liftIO"><span class="hs-identifier hs-var">liftIO</span></a></span><span> </span><span class="annot"><span class="annottext">(IO () -&gt; m ()) -&gt; IO () -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2702"></span><span>          </span><span class="annot"><span class="annottext">[IORef [IO ()]] -&gt; (IORef [IO ()] -&gt; IO ()) -&gt; IO ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a b.
(Foldable t, Monad m) =&gt;
t a -&gt; (a -&gt; m b) -&gt; m ()
</span><a href="../../base/src/Data.Foldable.html#forM_"><span class="hs-identifier hs-var">forM_</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">IORef [IO ()]
</span><a href="#local-6989586621681202798"><span class="hs-identifier hs-var">warnings</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IORef [IO ()]
</span><a href="#local-6989586621681202797"><span class="hs-identifier hs-var">errors</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">IORef [IO ()]
</span><a href="#local-6989586621681202796"><span class="hs-identifier hs-var">fatals</span></a></span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">((IORef [IO ()] -&gt; IO ()) -&gt; IO ())
-&gt; (IORef [IO ()] -&gt; IO ()) -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681202774"><span class="annot"><span class="annottext">IORef [IO ()]
</span><a href="#local-6989586621681202774"><span class="hs-identifier hs-var">ref</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-2703"></span><span>            </span><span class="hs-comment">-- This IORef can leak when the dflags leaks, so let us always</span><span>
</span><span id="line-2704"></span><span>            </span><span class="hs-comment">-- reset the content.</span><span>
</span><span id="line-2705"></span><span>            </span><span id="local-6989586621681202773"><span class="annot"><span class="annottext">[IO ()]
</span><a href="#local-6989586621681202773"><span class="hs-identifier hs-var">actions</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">IORef [IO ()] -&gt; ([IO ()] -&gt; ([IO ()], [IO ()])) -&gt; IO [IO ()]
forall a b. IORef a -&gt; (a -&gt; (a, b)) -&gt; IO b
</span><a href="../../base/src/GHC.IORef.html#atomicModifyIORef%27"><span class="hs-identifier hs-var">atomicModifyIORef'</span></a></span><span> </span><span class="annot"><span class="annottext">IORef [IO ()]
</span><a href="#local-6989586621681202774"><span class="hs-identifier hs-var">ref</span></a></span><span> </span><span class="annot"><span class="annottext">(([IO ()] -&gt; ([IO ()], [IO ()])) -&gt; IO [IO ()])
-&gt; ([IO ()] -&gt; ([IO ()], [IO ()])) -&gt; IO [IO ()]
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681202772"><span class="annot"><span class="annottext">[IO ()]
</span><a href="#local-6989586621681202772"><span class="hs-identifier hs-var">i</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[IO ()]
</span><a href="#local-6989586621681202772"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2706"></span><span>            </span><span class="annot"><span class="annottext">[IO ()] -&gt; IO ()
forall (t :: * -&gt; *) (m :: * -&gt; *) a.
(Foldable t, Monad m) =&gt;
t (m a) -&gt; m ()
</span><a href="../../base/src/Data.Foldable.html#sequence_"><span class="hs-identifier hs-var">sequence_</span></a></span><span> </span><span class="annot"><span class="annottext">([IO ()] -&gt; IO ()) -&gt; [IO ()] -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">[IO ()] -&gt; [IO ()]
forall a. [a] -&gt; [a]
</span><a href="../../base/src/GHC.List.html#reverse"><span class="hs-identifier hs-var">reverse</span></a></span><span> </span><span class="annot"><span class="annottext">[IO ()]
</span><a href="#local-6989586621681202773"><span class="hs-identifier hs-var">actions</span></a></span><span>
</span><span id="line-2707"></span><span>
</span><span id="line-2708"></span><span>        </span><span id="local-6989586621681202768"><span class="annot"><span class="annottext">setLogAction :: LogAction -&gt; m ()
</span><a href="#local-6989586621681202768"><span class="hs-identifier hs-var hs-var">setLogAction</span></a></span></span><span> </span><span id="local-6989586621681202767"><span class="annot"><span class="annottext">LogAction
</span><a href="#local-6989586621681202767"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(HscEnv -&gt; HscEnv) -&gt; m ()
forall (m :: * -&gt; *). GhcMonad m =&gt; (HscEnv -&gt; HscEnv) -&gt; m ()
</span><a href="GHC.Driver.Monad.html#modifySession"><span class="hs-identifier hs-var">modifySession</span></a></span><span> </span><span class="annot"><span class="annottext">((HscEnv -&gt; HscEnv) -&gt; m ()) -&gt; (HscEnv -&gt; HscEnv) -&gt; m ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="hs-glyph">\</span><span id="local-6989586621681202766"><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681202766"><span class="hs-identifier hs-var">hsc_env</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-2709"></span><span>          </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681202766"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">hsc_dflags :: DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var">hsc_dflags</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">HscEnv -&gt; DynFlags
</span><a href="GHC.Driver.Types.html#hsc_dflags"><span class="hs-identifier hs-var hs-var">hsc_dflags</span></a></span><span> </span><span class="annot"><span class="annottext">HscEnv
</span><a href="#local-6989586621681202766"><span class="hs-identifier hs-var">hsc_env</span></a></span><span class="hs-special">)</span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">log_action :: LogAction
</span><a href="GHC.Driver.Session.html#log_action"><span class="hs-identifier hs-var">log_action</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">LogAction
</span><a href="#local-6989586621681202767"><span class="hs-identifier hs-var">action</span></a></span><span> </span><span class="hs-special">}</span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2710"></span><span>
</span><span id="line-2711"></span><span>    </span><span class="annot"><span class="annottext">m () -&gt; (() -&gt; m ()) -&gt; (() -&gt; m a) -&gt; m a
forall (m :: * -&gt; *) a c b.
MonadMask m =&gt;
m a -&gt; (a -&gt; m c) -&gt; (a -&gt; m b) -&gt; m b
</span><a href="../../exceptions/src/Control.Monad.Catch.html#bracket"><span class="hs-identifier hs-var">MC.bracket</span></a></span><span>
</span><span id="line-2712"></span><span>      </span><span class="hs-special">(</span><span class="annot"><span class="annottext">LogAction -&gt; m ()
forall {m :: * -&gt; *}. GhcMonad m =&gt; LogAction -&gt; m ()
</span><a href="#local-6989586621681202768"><span class="hs-identifier hs-var">setLogAction</span></a></span><span> </span><span class="annot"><span class="annottext">LogAction
forall {p}. p -&gt; WarnReason -&gt; Severity -&gt; SrcSpan -&gt; SDoc -&gt; IO ()
</span><a href="#local-6989586621681202795"><span class="hs-identifier hs-var">deferDiagnostics</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2713"></span><span>      </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">LogAction -&gt; m ()
forall {m :: * -&gt; *}. GhcMonad m =&gt; LogAction -&gt; m ()
</span><a href="#local-6989586621681202768"><span class="hs-identifier hs-var">setLogAction</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">DynFlags -&gt; LogAction
</span><a href="GHC.Driver.Session.html#log_action"><span class="hs-identifier hs-var hs-var">log_action</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681202800"><span class="hs-identifier hs-var">dflags</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">m () -&gt; m () -&gt; m ()
forall (m :: * -&gt; *) a b. Monad m =&gt; m a -&gt; m b -&gt; m b
</span><a href="../../base/src/GHC.Base.html#%3E%3E"><span class="hs-operator hs-var">&gt;&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">m ()
</span><a href="#local-6989586621681202776"><span class="hs-identifier hs-var">printDeferredDiagnostics</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2714"></span><span>      </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="annot"><span class="annottext">()
</span><span class="hs-identifier">_</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m a
</span><a href="#local-6989586621681202801"><span class="hs-identifier hs-var">f</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2715"></span><span>
</span><span id="line-2716"></span><span class="annot"><a href="GHC.Driver.Make.html#noModError"><span class="hs-identifier hs-type">noModError</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#FindResult"><span class="hs-identifier hs-type">FindResult</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#ErrMsg"><span class="hs-identifier hs-type">ErrMsg</span></a></span><span>
</span><span id="line-2717"></span><span class="hs-comment">-- ToDo: we don't have a proper line number for this error</span><span>
</span><span id="line-2718"></span><span id="noModError"><span class="annot"><span class="annottext">noModError :: DynFlags -&gt; SrcSpan -&gt; ModuleName -&gt; FindResult -&gt; ErrMsg
</span><a href="GHC.Driver.Make.html#noModError"><span class="hs-identifier hs-var hs-var">noModError</span></a></span></span><span> </span><span id="local-6989586621681202765"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681202765"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621681202764"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681202764"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681202763"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681202763"><span class="hs-identifier hs-var">wanted_mod</span></a></span></span><span> </span><span id="local-6989586621681202762"><span class="annot"><span class="annottext">FindResult
</span><a href="#local-6989586621681202762"><span class="hs-identifier hs-var">err</span></a></span></span><span>
</span><span id="line-2719"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; SrcSpan -&gt; SDoc -&gt; ErrMsg
</span><a href="GHC.Utils.Error.html#mkPlainErrMsg"><span class="hs-identifier hs-var">mkPlainErrMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681202765"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681202764"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; ErrMsg) -&gt; SDoc -&gt; ErrMsg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; ModuleName -&gt; FindResult -&gt; SDoc
</span><a href="GHC.Driver.Finder.html#cannotFindModule"><span class="hs-identifier hs-var">cannotFindModule</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681202765"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681202763"><span class="hs-identifier hs-var">wanted_mod</span></a></span><span> </span><span class="annot"><span class="annottext">FindResult
</span><a href="#local-6989586621681202762"><span class="hs-identifier hs-var">err</span></a></span><span>
</span><span id="line-2720"></span><span>
</span><span id="line-2721"></span><span class="annot"><a href="GHC.Driver.Make.html#noHsFileErr"><span class="hs-identifier hs-type">noHsFileErr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Types.SrcLoc.html#SrcSpan"><span class="hs-identifier hs-type">SrcSpan</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="../../base/src/GHC.Base.html#String"><span class="hs-identifier hs-type">String</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#ErrorMessages"><span class="hs-identifier hs-type">ErrorMessages</span></a></span><span>
</span><span id="line-2722"></span><span id="noHsFileErr"><span class="annot"><span class="annottext">noHsFileErr :: DynFlags -&gt; SrcSpan -&gt; FilePath -&gt; ErrorMessages
</span><a href="GHC.Driver.Make.html#noHsFileErr"><span class="hs-identifier hs-var hs-var">noHsFileErr</span></a></span></span><span> </span><span id="local-6989586621681202760"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681202760"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621681202759"><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681202759"><span class="hs-identifier hs-var">loc</span></a></span></span><span> </span><span id="local-6989586621681202758"><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681202758"><span class="hs-identifier hs-var">path</span></a></span></span><span>
</span><span id="line-2723"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ErrMsg -&gt; ErrorMessages
forall a. a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#unitBag"><span class="hs-identifier hs-var">unitBag</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrMsg -&gt; ErrorMessages) -&gt; ErrMsg -&gt; ErrorMessages
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; SrcSpan -&gt; SDoc -&gt; ErrMsg
</span><a href="GHC.Utils.Error.html#mkPlainErrMsg"><span class="hs-identifier hs-var">mkPlainErrMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681202760"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="#local-6989586621681202759"><span class="hs-identifier hs-var">loc</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; ErrMsg) -&gt; SDoc -&gt; ErrMsg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;Can't find&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><a href="#local-6989586621681202758"><span class="hs-identifier hs-var">path</span></a></span><span>
</span><span id="line-2724"></span><span>
</span><span id="line-2725"></span><span class="annot"><a href="GHC.Driver.Make.html#moduleNotFoundErr"><span class="hs-identifier hs-type">moduleNotFoundErr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Unit.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Error.html#ErrorMessages"><span class="hs-identifier hs-type">ErrorMessages</span></a></span><span>
</span><span id="line-2726"></span><span id="moduleNotFoundErr"><span class="annot"><span class="annottext">moduleNotFoundErr :: DynFlags -&gt; ModuleName -&gt; ErrorMessages
</span><a href="GHC.Driver.Make.html#moduleNotFoundErr"><span class="hs-identifier hs-var hs-var">moduleNotFoundErr</span></a></span></span><span> </span><span id="local-6989586621681202757"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681202757"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621681202756"><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681202756"><span class="hs-identifier hs-var">mod</span></a></span></span><span>
</span><span id="line-2727"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ErrMsg -&gt; ErrorMessages
forall a. a -&gt; Bag a
</span><a href="GHC.Data.Bag.html#unitBag"><span class="hs-identifier hs-var">unitBag</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrMsg -&gt; ErrorMessages) -&gt; ErrMsg -&gt; ErrorMessages
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; SrcSpan -&gt; SDoc -&gt; ErrMsg
</span><a href="GHC.Utils.Error.html#mkPlainErrMsg"><span class="hs-identifier hs-var">mkPlainErrMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681202757"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="GHC.Types.SrcLoc.html#noSrcSpan"><span class="hs-identifier hs-var">noSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; ErrMsg) -&gt; SDoc -&gt; ErrMsg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2728"></span><span>        </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;module&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName
</span><a href="#local-6989586621681202756"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;cannot be found locally&quot;</span></span><span>
</span><span id="line-2729"></span><span>
</span><span id="line-2730"></span><span class="annot"><a href="GHC.Driver.Make.html#multiRootsErr"><span class="hs-identifier hs-type">multiRootsErr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Session.html#DynFlags"><span class="hs-identifier hs-type">DynFlags</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-2731"></span><span id="multiRootsErr"><span class="annot"><span class="annottext">multiRootsErr :: DynFlags -&gt; [ModSummary] -&gt; IO ()
</span><a href="GHC.Driver.Make.html#multiRootsErr"><span class="hs-identifier hs-var hs-var">multiRootsErr</span></a></span></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><span class="hs-identifier">_</span></span><span>      </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; IO ()
forall a. FilePath -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;multiRootsErr&quot;</span></span><span>
</span><span id="line-2732"></span><span class="annot"><a href="GHC.Driver.Make.html#multiRootsErr"><span class="hs-identifier hs-var">multiRootsErr</span></a></span><span> </span><span id="local-6989586621681202754"><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681202754"><span class="hs-identifier hs-var">dflags</span></a></span></span><span> </span><span id="local-6989586621681202753"><span class="annot"><span class="annottext">summs :: [ModSummary]
</span><a href="#local-6989586621681202753"><span class="hs-identifier hs-var">summs</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621681202752"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681202752"><span class="hs-identifier hs-var">summ1</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span class="annot"><span class="annottext">[ModSummary]
</span><span class="hs-identifier">_</span></span><span class="hs-special">)</span><span>
</span><span id="line-2733"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ErrMsg -&gt; IO ()
forall (io :: * -&gt; *) a. MonadIO io =&gt; ErrMsg -&gt; io a
</span><a href="GHC.Driver.Types.html#throwOneError"><span class="hs-identifier hs-var">throwOneError</span></a></span><span> </span><span class="annot"><span class="annottext">(ErrMsg -&gt; IO ()) -&gt; ErrMsg -&gt; IO ()
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags -&gt; SrcSpan -&gt; SDoc -&gt; ErrMsg
</span><a href="GHC.Utils.Error.html#mkPlainErrMsg"><span class="hs-identifier hs-var">mkPlainErrMsg</span></a></span><span> </span><span class="annot"><span class="annottext">DynFlags
</span><a href="#local-6989586621681202754"><span class="hs-identifier hs-var">dflags</span></a></span><span> </span><span class="annot"><span class="annottext">SrcSpan
</span><a href="GHC.Types.SrcLoc.html#noSrcSpan"><span class="hs-identifier hs-var">noSrcSpan</span></a></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; ErrMsg) -&gt; SDoc -&gt; ErrMsg
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><a href="../../base/src/GHC.Base.html#%24"><span class="hs-operator hs-var">$</span></a></span><span>
</span><span id="line-2734"></span><span>        </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;module&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">Module
</span><a href="#local-6989586621681202750"><span class="hs-identifier hs-var">mod</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-2735"></span><span>        </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;is defined in multiple files:&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-2736"></span><span>        </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#sep"><span class="hs-identifier hs-var">sep</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(FilePath -&gt; SDoc) -&gt; [FilePath] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">[FilePath]
</span><a href="#local-6989586621681202749"><span class="hs-identifier hs-var">files</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2737"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2738"></span><span>    </span><span id="local-6989586621681202750"><span class="annot"><span class="annottext">mod :: Module
</span><a href="#local-6989586621681202750"><span class="hs-identifier hs-var hs-var">mod</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; Module
</span><a href="GHC.Driver.Types.html#ms_mod"><span class="hs-identifier hs-var hs-var">ms_mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681202752"><span class="hs-identifier hs-var">summ1</span></a></span><span>
</span><span id="line-2739"></span><span>    </span><span id="local-6989586621681202749"><span class="annot"><span class="annottext">files :: [FilePath]
</span><a href="#local-6989586621681202749"><span class="hs-identifier hs-var hs-var">files</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(ModSummary -&gt; FilePath) -&gt; [ModSummary] -&gt; [FilePath]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; Maybe FilePath -&gt; FilePath
forall a. HasCallStack =&gt; FilePath -&gt; Maybe a -&gt; a
</span><a href="GHC.Data.Maybe.html#expectJust"><span class="hs-identifier hs-var">expectJust</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;checkDup&quot;</span></span><span> </span><span class="annot"><span class="annottext">(Maybe FilePath -&gt; FilePath)
-&gt; (ModSummary -&gt; Maybe FilePath) -&gt; ModSummary -&gt; FilePath
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ModLocation -&gt; Maybe FilePath
</span><a href="GHC.Unit.Module.Location.html#ml_hs_file"><span class="hs-identifier hs-var hs-var">ml_hs_file</span></a></span><span> </span><span class="annot"><span class="annottext">(ModLocation -&gt; Maybe FilePath)
-&gt; (ModSummary -&gt; ModLocation) -&gt; ModSummary -&gt; Maybe FilePath
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; ModLocation
</span><a href="GHC.Driver.Types.html#ms_location"><span class="hs-identifier hs-var hs-var">ms_location</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681202753"><span class="hs-identifier hs-var">summs</span></a></span><span>
</span><span id="line-2740"></span><span>
</span><span id="line-2741"></span><span class="annot"><a href="GHC.Driver.Make.html#keepGoingPruneErr"><span class="hs-identifier hs-type">keepGoingPruneErr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Unit.Module.Name.html#ModuleName"><span class="hs-identifier hs-type">ModuleName</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-2742"></span><span id="keepGoingPruneErr"><span class="annot"><span class="annottext">keepGoingPruneErr :: [ModuleName] -&gt; SDoc
</span><a href="GHC.Driver.Make.html#keepGoingPruneErr"><span class="hs-identifier hs-var hs-var">keepGoingPruneErr</span></a></span></span><span> </span><span id="local-6989586621681202746"><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621681202746"><span class="hs-identifier hs-var">ms</span></a></span></span><span>
</span><span id="line-2743"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;-fkeep-going in use, removing the following&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-2744"></span><span>            </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;dependencies and continuing:&quot;</span></span><span class="hs-special">)</span><span class="annot"><span class="annottext">SDoc -&gt; [SDoc] -&gt; [SDoc]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span>
</span><span id="line-2745"></span><span>          </span><span class="annot"><span class="annottext">(ModuleName -&gt; SDoc) -&gt; [ModuleName] -&gt; [SDoc]
forall a b. (a -&gt; b) -&gt; [a] -&gt; [b]
</span><a href="../../base/src/GHC.Base.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">6</span></span><span> </span><span class="annot"><span class="annottext">(SDoc -&gt; SDoc) -&gt; (ModuleName -&gt; SDoc) -&gt; ModuleName -&gt; SDoc
forall b c a. (b -&gt; c) -&gt; (a -&gt; b) -&gt; a -&gt; c
</span><a href="../../base/src/GHC.Base.html#."><span class="hs-operator hs-var">.</span></a></span><span> </span><span class="annot"><span class="annottext">ModuleName -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[ModuleName]
</span><a href="#local-6989586621681202746"><span class="hs-identifier hs-var">ms</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-2746"></span><span>
</span><span id="line-2747"></span><span class="annot"><a href="GHC.Driver.Make.html#cyclicModuleErr"><span class="hs-identifier hs-type">cyclicModuleErr</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-2748"></span><span class="hs-comment">-- From a strongly connected component we find</span><span>
</span><span id="line-2749"></span><span class="hs-comment">-- a single cycle to report</span><span>
</span><span id="line-2750"></span><span id="cyclicModuleErr"><span class="annot"><span class="annottext">cyclicModuleErr :: [ModSummary] -&gt; SDoc
</span><a href="GHC.Driver.Make.html#cyclicModuleErr"><span class="hs-identifier hs-var hs-var">cyclicModuleErr</span></a></span></span><span> </span><span id="local-6989586621681202745"><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681202745"><span class="hs-identifier hs-var">mss</span></a></span></span><span>
</span><span id="line-2751"></span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ASSERT</span><span class="hs-special">(</span><span> </span><span class="hs-identifier">not</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">null</span><span> </span><span class="hs-identifier">mss</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-2752"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[Node NodeKey ModSummary] -&gt; Maybe [ModSummary]
forall payload key.
Ord key =&gt;
[Node key payload] -&gt; Maybe [payload]
</span><a href="GHC.Data.Graph.Directed.html#findCycle"><span class="hs-identifier hs-var">findCycle</span></a></span><span> </span><span class="annot"><span class="annottext">[Node NodeKey ModSummary]
</span><a href="#local-6989586621681202743"><span class="hs-identifier hs-var">graph</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-2753"></span><span>       </span><span class="annot"><span class="annottext">Maybe [ModSummary]
</span><a href="../../base/src/GHC.Maybe.html#Nothing"><span class="hs-identifier hs-var">Nothing</span></a></span><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;Unexpected non-cycle&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">[ModSummary] -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681202745"><span class="hs-identifier hs-var">mss</span></a></span><span>
</span><span id="line-2754"></span><span>       </span><span class="annot"><a href="../../base/src/GHC.Maybe.html#Just"><span class="hs-identifier hs-type">Just</span></a></span><span> </span><span id="local-6989586621681202742"><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681202742"><span class="hs-identifier hs-var">path</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;Module imports form a cycle:&quot;</span></span><span>
</span><span id="line-2755"></span><span>                         </span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">2</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">[ModSummary] -&gt; SDoc
</span><a href="#local-6989586621681202741"><span class="hs-identifier hs-var">show_path</span></a></span><span> </span><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681202742"><span class="hs-identifier hs-var">path</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2756"></span><span>  </span><span class="hs-keyword">where</span><span>
</span><span id="line-2757"></span><span>    </span><span class="annot"><a href="#local-6989586621681202743"><span class="hs-identifier hs-type">graph</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Data.Graph.Directed.html#Node"><span class="hs-identifier hs-type">Node</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Make.html#NodeKey"><span class="hs-identifier hs-type">NodeKey</span></a></span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2758"></span><span>    </span><span id="local-6989586621681202743"><span class="annot"><span class="annottext">graph :: [Node NodeKey ModSummary]
</span><a href="#local-6989586621681202743"><span class="hs-identifier hs-var hs-var">graph</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; NodeKey -&gt; [NodeKey] -&gt; Node NodeKey ModSummary
forall key payload. payload -&gt; key -&gt; [key] -&gt; Node key payload
</span><a href="GHC.Data.Graph.Directed.html#DigraphNode"><span class="hs-identifier hs-var">DigraphNode</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681202740"><span class="hs-identifier hs-var">ms</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; NodeKey
</span><a href="GHC.Driver.Make.html#msKey"><span class="hs-identifier hs-var">msKey</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681202740"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; [NodeKey]
</span><a href="#local-6989586621681202739"><span class="hs-identifier hs-var">get_deps</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681202740"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681202740"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681202740"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681202745"><span class="hs-identifier hs-var">mss</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2759"></span><span>
</span><span id="line-2760"></span><span>    </span><span class="annot"><a href="#local-6989586621681202739"><span class="hs-identifier hs-type">get_deps</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="GHC.Driver.Make.html#NodeKey"><span class="hs-identifier hs-type">NodeKey</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2761"></span><span>    </span><span id="local-6989586621681202739"><span class="annot"><span class="annottext">get_deps :: ModSummary -&gt; [NodeKey]
</span><a href="#local-6989586621681202739"><span class="hs-identifier hs-var hs-var">get_deps</span></a></span></span><span> </span><span id="local-6989586621681202738"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681202738"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-2762"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">GWIB :: forall mod. mod -&gt; IsBootInterface -&gt; GenWithIsBoot mod
</span><a href="GHC.Unit.Types.html#GWIB"><span class="hs-identifier hs-type">GWIB</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">gwib_mod :: ModuleName
</span><a href="GHC.Unit.Types.html#gwib_mod"><span class="hs-identifier hs-var">gwib_mod</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpan ModuleName -&gt; ModuleName
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpan ModuleName
</span><a href="#local-6989586621681202737"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">gwib_isBoot :: IsBootInterface
</span><a href="GHC.Unit.Types.html#gwib_isBoot"><span class="hs-identifier hs-var">gwib_isBoot</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="GHC.Unit.Types.html#IsBoot"><span class="hs-identifier hs-var">IsBoot</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2763"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681202737"><span class="annot"><span class="annottext">GenLocated SrcSpan ModuleName
</span><a href="#local-6989586621681202737"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; [GenLocated SrcSpan ModuleName]
</span><a href="GHC.Driver.Types.html#ms_home_srcimps"><span class="hs-identifier hs-var">ms_home_srcimps</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681202738"><span class="hs-identifier hs-var">ms</span></a></span><span> </span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[NodeKey] -&gt; [NodeKey] -&gt; [NodeKey]
forall a. [a] -&gt; [a] -&gt; [a]
</span><a href="../../base/src/GHC.Base.html#%2B%2B"><span class="hs-operator hs-var">++</span></a></span><span>
</span><span id="line-2764"></span><span>      </span><span class="hs-special">[</span><span> </span><span class="annot"><span class="annottext">GWIB :: forall mod. mod -&gt; IsBootInterface -&gt; GenWithIsBoot mod
</span><a href="GHC.Unit.Types.html#GWIB"><span class="hs-identifier hs-type">GWIB</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><span class="annottext">gwib_mod :: ModuleName
</span><a href="GHC.Unit.Types.html#gwib_mod"><span class="hs-identifier hs-var">gwib_mod</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpan ModuleName -&gt; ModuleName
forall l e. GenLocated l e -&gt; e
</span><a href="GHC.Types.SrcLoc.html#unLoc"><span class="hs-identifier hs-var">unLoc</span></a></span><span> </span><span class="annot"><span class="annottext">GenLocated SrcSpan ModuleName
</span><a href="#local-6989586621681202736"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">gwib_isBoot :: IsBootInterface
</span><a href="GHC.Unit.Types.html#gwib_isBoot"><span class="hs-identifier hs-var">gwib_isBoot</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">IsBootInterface
</span><a href="GHC.Unit.Types.html#NotBoot"><span class="hs-identifier hs-var">NotBoot</span></a></span><span> </span><span class="hs-special">}</span><span>
</span><span id="line-2765"></span><span>      </span><span class="hs-glyph">|</span><span> </span><span id="local-6989586621681202736"><span class="annot"><span class="annottext">GenLocated SrcSpan ModuleName
</span><a href="#local-6989586621681202736"><span class="hs-identifier hs-var">m</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; [GenLocated SrcSpan ModuleName]
</span><a href="GHC.Driver.Types.html#ms_home_imps"><span class="hs-identifier hs-var">ms_home_imps</span></a></span><span>    </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681202738"><span class="hs-identifier hs-var">ms</span></a></span><span> </span><span class="hs-special">]</span><span>
</span><span id="line-2766"></span><span>
</span><span id="line-2767"></span><span>    </span><span id="local-6989586621681202741"><span class="annot"><span class="annottext">show_path :: [ModSummary] -&gt; SDoc
</span><a href="#local-6989586621681202741"><span class="hs-identifier hs-var hs-var">show_path</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
forall a. FilePath -&gt; a
</span><a href="GHC.Utils.Panic.Plain.html#panic"><span class="hs-identifier hs-var">panic</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;show_path&quot;</span></span><span>
</span><span id="line-2768"></span><span>    </span><span class="annot"><a href="#local-6989586621681202741"><span class="hs-identifier hs-var">show_path</span></a></span><span> </span><span class="hs-special">[</span><span id="local-6989586621681202735"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681202735"><span class="hs-identifier hs-var">m</span></a></span></span><span class="hs-special">]</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;module&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; SDoc
</span><a href="#local-6989586621681202734"><span class="hs-identifier hs-var">ppr_ms</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681202735"><span class="hs-identifier hs-var">m</span></a></span><span>
</span><span id="line-2769"></span><span>                           </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;imports itself&quot;</span></span><span>
</span><span id="line-2770"></span><span>    </span><span class="annot"><a href="#local-6989586621681202741"><span class="hs-identifier hs-var">show_path</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681202733"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681202733"><span class="hs-identifier hs-var">m1</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681202732"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681202732"><span class="hs-identifier hs-var">m2</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681202731"><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681202731"><span class="hs-identifier hs-var">ms</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[SDoc] -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#vcat"><span class="hs-identifier hs-var">vcat</span></a></span><span> </span><span class="hs-special">(</span><span> </span><span class="annot"><span class="annottext">Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">7</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;module&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; SDoc
</span><a href="#local-6989586621681202734"><span class="hs-identifier hs-var">ppr_ms</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681202733"><span class="hs-identifier hs-var">m1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2771"></span><span>                                </span><span class="annot"><span class="annottext">SDoc -&gt; [SDoc] -&gt; [SDoc]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">Int -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#nest"><span class="hs-identifier hs-var">nest</span></a></span><span> </span><span class="annot"><span class="annottext">Int
</span><span class="hs-number">6</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;imports&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; SDoc
</span><a href="#local-6989586621681202734"><span class="hs-identifier hs-var">ppr_ms</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681202732"><span class="hs-identifier hs-var">m2</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-2772"></span><span>                                </span><span class="annot"><span class="annottext">SDoc -&gt; [SDoc] -&gt; [SDoc]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[ModSummary] -&gt; [SDoc]
</span><a href="#local-6989586621681202730"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681202731"><span class="hs-identifier hs-var">ms</span></a></span><span> </span><span class="hs-special">)</span><span>
</span><span id="line-2773"></span><span>       </span><span class="hs-keyword">where</span><span>
</span><span id="line-2774"></span><span>         </span><span id="local-6989586621681202730"><span class="annot"><span class="annottext">go :: [ModSummary] -&gt; [SDoc]
</span><a href="#local-6989586621681202730"><span class="hs-identifier hs-var hs-var">go</span></a></span></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;which imports&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; SDoc
</span><a href="#local-6989586621681202734"><span class="hs-identifier hs-var">ppr_ms</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681202733"><span class="hs-identifier hs-var">m1</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-2775"></span><span>         </span><span class="annot"><a href="#local-6989586621681202730"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621681202729"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681202729"><span class="hs-identifier hs-var">m</span></a></span></span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span id="local-6989586621681202728"><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681202728"><span class="hs-identifier hs-var">ms</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="annot"><span class="annottext">FilePath
</span><span class="hs-string">&quot;which imports&quot;</span></span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary -&gt; SDoc
</span><a href="#local-6989586621681202734"><span class="hs-identifier hs-var">ppr_ms</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681202729"><span class="hs-identifier hs-var">m</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; [SDoc] -&gt; [SDoc]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[ModSummary] -&gt; [SDoc]
</span><a href="#local-6989586621681202730"><span class="hs-identifier hs-var">go</span></a></span><span> </span><span class="annot"><span class="annottext">[ModSummary]
</span><a href="#local-6989586621681202728"><span class="hs-identifier hs-var">ms</span></a></span><span>
</span><span id="line-2776"></span><span>
</span><span id="line-2777"></span><span>
</span><span id="line-2778"></span><span>    </span><span class="annot"><a href="#local-6989586621681202734"><span class="hs-identifier hs-type">ppr_ms</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="GHC.Driver.Types.html#ModSummary"><span class="hs-identifier hs-type">ModSummary</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="GHC.Utils.Outputable.html#SDoc"><span class="hs-identifier hs-type">SDoc</span></a></span><span>
</span><span id="line-2779"></span><span>    </span><span id="local-6989586621681202734"><span class="annot"><span class="annottext">ppr_ms :: ModSummary -&gt; SDoc
</span><a href="#local-6989586621681202734"><span class="hs-identifier hs-var hs-var">ppr_ms</span></a></span></span><span> </span><span id="local-6989586621681202727"><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681202727"><span class="hs-identifier hs-var">ms</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#quotes"><span class="hs-identifier hs-var">quotes</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModuleName -&gt; SDoc
forall a. Outputable a =&gt; a -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#ppr"><span class="hs-identifier hs-var">ppr</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Module -&gt; ModuleName
forall unit. GenModule unit -&gt; ModuleName
</span><a href="GHC.Unit.Types.html#moduleName"><span class="hs-identifier hs-var hs-var">moduleName</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; Module
</span><a href="GHC.Driver.Types.html#ms_mod"><span class="hs-identifier hs-var hs-var">ms_mod</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681202727"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">SDoc -&gt; SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#%3C%2B%3E"><span class="hs-operator hs-var">&lt;+&gt;</span></a></span><span>
</span><span id="line-2780"></span><span>                </span><span class="hs-special">(</span><span class="annot"><span class="annottext">SDoc -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#parens"><span class="hs-identifier hs-var">parens</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">FilePath -&gt; SDoc
</span><a href="GHC.Utils.Outputable.html#text"><span class="hs-identifier hs-var">text</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ModSummary -&gt; FilePath
</span><a href="GHC.Driver.Types.html#msHsFilePath"><span class="hs-identifier hs-var">msHsFilePath</span></a></span><span> </span><span class="annot"><span class="annottext">ModSummary
</span><a href="#local-6989586621681202727"><span class="hs-identifier hs-var">ms</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-2781"></span></pre></body></html>